{"project":"joyent/illumos-extra","branch":"master","id":"I50fc49fc354720d4ac7fa6f39979457efab1c270","number":"2301","subject":"OS-6256 g11n doesn\u0027t always properly clean up when running gmake clean Reviewed by: Joshua M. Clulow \u003cjmc@joyent.com\u003e Reviewed by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e Approved by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e","owner":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"url":"https://cr.joyent.us/2301","commitMessage":"OS-6256 g11n doesn\u0027t always properly clean up when running gmake clean\nReviewed by: Joshua M. Clulow \u003cjmc@joyent.com\u003e\nReviewed by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e\nApproved by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e\n","createdOn":1501382023,"lastUpdated":1502497326,"open":false,"status":"MERGED","comments":[{"timestamp":1501382023,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Uploaded patch set 1."},{"timestamp":1501382454,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Patch Set 1:\n\n(2 comments)"},{"timestamp":1501383000,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1501524909,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1501525560,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Uploaded patch set 2."},{"timestamp":1501525591,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Uploaded patch set 3."},{"timestamp":1501525618,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 1:\n\n(2 comments)"},{"timestamp":1501525748,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1501527304,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 3: Code-Review+1 Integration-Approval+1"},{"timestamp":1502497319,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Uploaded patch set 4: Commit message was updated."},{"timestamp":1502497326,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Robert Mustacchi"}],"currentPatchSet":{"number":"4","revision":"50fc49fc354720d4ac7fa6f39979457efab1c270","parents":["591c23412e2f32c1bd57db71d578014c73984613"],"ref":"refs/changes/01/2301/4","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1502497319,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1501525748,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1501527304,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1501527304,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"SUBM","value":"1","grantedOn":1502497326,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"g11n/Makefile","type":"MODIFIED","insertions":17,"deletions":-18}],"sizeInsertions":17,"sizeDeletions":-18},"patchSets":[{"number":"1","revision":"73982249d210f5ef2037521738ab32ae235f2526","parents":["591c23412e2f32c1bd57db71d578014c73984613"],"ref":"refs/changes/01/2301/1","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1501382023,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"REWORK","comments":[{"file":"g11n/Makefile","line":13,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Trailing whitespace?"},{"file":"g11n/Makefile","line":13,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"},{"file":"g11n/Makefile","line":48,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Can we add a new line to the rule; e.g.,\n\n    clean:\n            test -x /opt/local/bin/dmake\n            @cd src \u0026\u0026 pwd \u0026\u0026 unset MAKE \u0026\u0026 SR....\n\nThat way, if this dmake is missing, we can fail explicitly.  Also, I\u0027m not really sure why the existing rule is _in_ a subshell, or why it doesn\u0027t use \"\u0026\u0026\" to chain commands together."},{"file":"g11n/Makefile","line":48,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Sure, I\u0027m happy to add the test.\n\nI think I\u0027m a little less certain on getting rid of the subshell at the moment only because so much is probably relying on this failing implicitly. Do you think I should add a test that proto is a directory or not a symlink before the removal?"},{"file":"g11n/Makefile","line":48,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"I think because you\u0027re referring to it by name, rather than using $DESTDIR (or similar), it\u0027s fine to just remove it.\n\nAlso, sure, it seems fine to leave the other stuff for now."},{"file":"g11n/Makefile","line":48,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"g11n/Makefile","type":"MODIFIED","insertions":16,"deletions":-18}],"sizeInsertions":16,"sizeDeletions":-18},{"number":"2","revision":"b6e13cd35e3f1925e7d505b2088822a1416081d7","parents":["591c23412e2f32c1bd57db71d578014c73984613"],"ref":"refs/changes/01/2301/2","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1501525560,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"g11n/Makefile","type":"MODIFIED","insertions":17,"deletions":-18}],"sizeInsertions":17,"sizeDeletions":-18},{"number":"3","revision":"d27fbda09ccbe628bf97337a3633d4d0cf9a05bf","parents":["591c23412e2f32c1bd57db71d578014c73984613"],"ref":"refs/changes/01/2301/3","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1501525591,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1501525748,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1501527304,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1501527304,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"g11n/Makefile","type":"MODIFIED","insertions":17,"deletions":-18}],"sizeInsertions":17,"sizeDeletions":-18},{"number":"4","revision":"50fc49fc354720d4ac7fa6f39979457efab1c270","parents":["591c23412e2f32c1bd57db71d578014c73984613"],"ref":"refs/changes/01/2301/4","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1502497319,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"SUBM","value":"1","grantedOn":1502497326,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1501525748,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1501527304,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1501527304,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"g11n/Makefile","type":"MODIFIED","insertions":17,"deletions":-18}],"sizeInsertions":17,"sizeDeletions":-18}],"allReviewers":[{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}]}