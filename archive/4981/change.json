{"project":"joyent/sdc-cloudapi","branch":"master","topic":"triton-880","id":"I9872496207b213f3c6cf9517fe33c1c8300a8754","number":"4981","subject":"TRITON-880 want ufds to store and understand Yubikey attestation certs Reviewed by: Marsell Kukuljevic \u003cmarsell@joyent.com\u003e Approved by: Marsell Kukuljevic \u003cmarsell@joyent.com\u003e","owner":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"url":"https://cr.joyent.us/4981","commitMessage":"TRITON-880 want ufds to store and understand Yubikey attestation certs\nReviewed by: Marsell Kukuljevic \u003cmarsell@joyent.com\u003e\nApproved by: Marsell Kukuljevic \u003cmarsell@joyent.com\u003e\n","createdOn":1539984593,"lastUpdated":1540249956,"open":false,"status":"MERGED","comments":[{"timestamp":1539984593,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 1."},{"timestamp":1539984643,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1539984991,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 2."},{"timestamp":1539985032,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1539985968,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 3."},{"timestamp":1539986019,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1539987543,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 3: Code-Review+1\n\n(1 comment)\n\nIs it possible for a test to work without a hardware key?"},{"timestamp":1539987609,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Topic set to triton-880"},{"timestamp":1539987859,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 3:\n\n(1 comment)\n\nWe don\u0027t really need the hardware key itself present in order to make a test of this code, just provide a key + cert from a real hardware key, so I\u0027ll look at adding one (I don\u0027t think it matters if we can\u0027t sign requests with it right now for this code)\n\nIn future when we\u0027re adding actual features that use this info I made it so that there\u0027s some SAPI metadata you can set to add your own device manufacturer cert to UFDS\u0027 trusted list, so what I want to do is generate our own and add it there and thus make \"fake\" hardware keys for testing."},{"timestamp":1539989740,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 4."},{"timestamp":1539989783,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1539991514,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 3:\n\n(2 comments)"},{"timestamp":1540243025,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 4:\n\n(1 comment)"},{"timestamp":1540243288,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 5."},{"timestamp":1540243334,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1540243655,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 6."},{"timestamp":1540243698,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 6: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1540244136,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 6: Code-Review+1 Integration-Approval+1"},{"timestamp":1540248099,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 7: Commit message was updated."},{"timestamp":1540249956,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Alex Wilson"}],"currentPatchSet":{"number":"7","revision":"d84abb5c01b4003d0ac1934d52ae03a6dd210ea9","parents":["43f8ad622c6aee821b6456d50091434513d6b4da"],"ref":"refs/changes/81/4981/7","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1540248099,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1540243698,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1540244136,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1540244136,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}},{"type":"SUBM","value":"1","grantedOn":1540249956,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":36,"deletions":-5},{"file":"lib/keys.js","type":"MODIFIED","insertions":36,"deletions":-1},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/keys.test.js","type":"MODIFIED","insertions":102,"deletions":0}],"sizeInsertions":176,"sizeDeletions":-8},"patchSets":[{"number":"1","revision":"240f05c4e9c9ac258d29ce95ff2f064da3a4a772","parents":["43f8ad622c6aee821b6456d50091434513d6b4da"],"ref":"refs/changes/81/4981/1","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1539984593,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1539984643,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/keys.js","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":7,"sizeDeletions":-2},{"number":"2","revision":"e52fcbaf2eaabc774b7e0286c62197d59407681f","parents":["43f8ad622c6aee821b6456d50091434513d6b4da"],"ref":"refs/changes/81/4981/2","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1539984991,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1539985032,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/keys.js","type":"MODIFIED","insertions":20,"deletions":-1},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":21,"sizeDeletions":-2},{"number":"3","revision":"229e015e726bb2542e6fffa6f878228879d05ede","parents":["43f8ad622c6aee821b6456d50091434513d6b4da"],"ref":"refs/changes/81/4981/3","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1539985968,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1539986019,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1539987543,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}}],"comments":[{"file":"lib/keys.js","line":94,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Since 1.4.0 isn\u0027t out, I can\u0027t tell if this will be validated as an array of strings before the actual call to UFDS. Will it?"},{"file":"lib/keys.js","line":94,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Seems like a good idea... should we do it here or in node-ufds? The node-ufds change is https://cr.joyent.us/#/c/4980 -- doesn\u0027t currently assert on it,but it\u0027s easy enough to change."},{"file":"lib/keys.js","line":94,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"I see it\u0027s already in node-ufds -- nice!\n\nI think it\u0027d be a good idea to add checks here too. We\u0027d rather return InvalidArgumentError() than a 500 on invalid input.\n\nI just noticed req.params.key doesn\u0027t validate it\u0027s a string. If someone passes in { key: true } we\u0027ll get an exception on key.split()."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":36,"deletions":-5},{"file":"lib/keys.js","type":"MODIFIED","insertions":20,"deletions":-1},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":58,"sizeDeletions":-8},{"number":"4","revision":"333a0799a00a83a26cc1d9fc24d3ef187cbc9d74","parents":["43f8ad622c6aee821b6456d50091434513d6b4da"],"ref":"refs/changes/81/4981/4","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1539989740,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1539989783,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"test/keys.test.js","line":181,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"I just noticed none of the CreateKey tests use OTHER. We need at least one OTHER.post() test just to be safe. See the other OTHER tests in this file.\n\nSorry to ask to stuff it in this commit, but since we\u0027re here anyway, it\u0027s a small addition."},{"file":"test/keys.test.js","line":181,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"After chatting with Alex about this, I don\u0027t know what I was thinking. This is clearly not a problem here."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":36,"deletions":-5},{"file":"lib/keys.js","type":"MODIFIED","insertions":20,"deletions":-1},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/keys.test.js","type":"MODIFIED","insertions":102,"deletions":0}],"sizeInsertions":160,"sizeDeletions":-8},{"number":"5","revision":"d53a1e9fbc877df47fc75a2412129feee2c23037","parents":["43f8ad622c6aee821b6456d50091434513d6b4da"],"ref":"refs/changes/81/4981/5","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1540243288,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1540243334,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":36,"deletions":-5},{"file":"lib/keys.js","type":"MODIFIED","insertions":35,"deletions":-1},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/keys.test.js","type":"MODIFIED","insertions":102,"deletions":0}],"sizeInsertions":175,"sizeDeletions":-8},{"number":"6","revision":"9872496207b213f3c6cf9517fe33c1c8300a8754","parents":["43f8ad622c6aee821b6456d50091434513d6b4da"],"ref":"refs/changes/81/4981/6","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1540243655,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1540243698,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1540244136,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1540244136,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":36,"deletions":-5},{"file":"lib/keys.js","type":"MODIFIED","insertions":36,"deletions":-1},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/keys.test.js","type":"MODIFIED","insertions":102,"deletions":0}],"sizeInsertions":176,"sizeDeletions":-8},{"number":"7","revision":"d84abb5c01b4003d0ac1934d52ae03a6dd210ea9","parents":["43f8ad622c6aee821b6456d50091434513d6b4da"],"ref":"refs/changes/81/4981/7","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1540248099,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"SUBM","value":"1","grantedOn":1540249956,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1540243698,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1540244136,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1540244136,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":36,"deletions":-5},{"file":"lib/keys.js","type":"MODIFIED","insertions":36,"deletions":-1},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/keys.test.js","type":"MODIFIED","insertions":102,"deletions":0}],"sizeInsertions":176,"sizeDeletions":-8}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}]}