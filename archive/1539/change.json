{"project":"joyent/node-workflow-moray-backend","branch":"master","id":"I92fa4fd69606559212b18f906863de4bbaf89872","number":"1539","subject":"WORKFLOW-217 wf-moray-backend leaks Moray clients","owner":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"url":"https://cr.joyent.us/1539","commitMessage":"WORKFLOW-217 wf-moray-backend leaks Moray clients\n","createdOn":1487605832,"lastUpdated":1490264338,"open":false,"status":"MERGED","comments":[{"timestamp":1487605832,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 1."},{"timestamp":1487605865,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1487606289,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 1:\n\nHey Cody, I\u0027ve just decided to go with a very conservative change here: make sure we call `client.close()` before we make a new client when needed. Previously, it was working like you suggested into the JIRA issue, waiting for moray client to emit the `connect` event, but that was giving us problems described at WORKFLOW-193/WORKFLOW-194 so, for now, I\u0027d wait until we take a similar approach using the newest moray client, which is being tested as part of workflow update to node v4. Sounds reasonable?"},{"timestamp":1489072836,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 2: Patch Set 1 was rebased."},{"timestamp":1489072859,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2:\n\n\"make check\" passed ok"},{"timestamp":1489192663,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 2: Code-Review+1"},{"timestamp":1489533760,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 2: Integration-Approval+1"},{"timestamp":1490264338,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Pedro Palazón Candel"}],"currentPatchSet":{"number":"2","revision":"92fa4fd69606559212b18f906863de4bbaf89872","parents":["4be75d0b8468fd70b75b05a8cb9a0aeffce3eca6"],"ref":"refs/changes/39/1539/2","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1489072836,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1487605865,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1489192663,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1489533760,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}},{"type":"SUBM","value":"1","grantedOn":1490264338,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/workflow-moray-backend.js","type":"MODIFIED","insertions":4,"deletions":-1}],"sizeInsertions":4,"sizeDeletions":-1},"patchSets":[{"number":"1","revision":"6b314c0cfcd1c700f44c17ae5c2363e688124723","parents":["e34e69830c63c10ac0ede4992ef58815f82b6f40"],"ref":"refs/changes/39/1539/1","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1487605832,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1487605865,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/workflow-moray-backend.js","type":"MODIFIED","insertions":4,"deletions":-1}],"sizeInsertions":4,"sizeDeletions":-1},{"number":"2","revision":"92fa4fd69606559212b18f906863de4bbaf89872","parents":["4be75d0b8468fd70b75b05a8cb9a0aeffce3eca6"],"ref":"refs/changes/39/1539/2","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1489072836,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1489192663,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1487605865,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"SUBM","value":"1","grantedOn":1490264338,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1489533760,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/workflow-moray-backend.js","type":"MODIFIED","insertions":4,"deletions":-1}],"sizeInsertions":4,"sizeDeletions":-1}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}]}