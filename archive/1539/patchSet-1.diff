commit 6b314c0cfcd1c700f44c17ae5c2363e688124723 (refs/changes/39/1539/1)
Author: Pedro Palazon Candel <pedro@joyent.com>
Date:   2017-02-20T16:50:24+01:00 (2 years, 8 months ago)
    
    WORKFLOW-217 wf-moray-backend leaks Moray clients

diff --git a/lib/workflow-moray-backend.js b/lib/workflow-moray-backend.js
index 69fd7ef..f499b30 100644
--- a/lib/workflow-moray-backend.js
+++ b/lib/workflow-moray-backend.js
@@ -5,7 +5,7 @@
  */
 
 /*
- * Copyright (c) 2014, Joyent, Inc.
+ * Copyright 2017 Joyent, Inc.
  */
 
 var util = require('util');
@@ -515,6 +515,9 @@ var WorkflowMorayBackend = module.exports = function (config) {
                 retry.reset();
                 connectCb();
             } else {
+                if (client) {
+                    client.close();
+                }
                 client = makeClient();
                 client.on('connect', onConnect);
                 client.on('error', onError);
