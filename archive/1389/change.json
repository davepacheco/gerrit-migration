{"project":"joyent/haproxy-1.5","branch":"joyent/v1.5.19","id":"I836df3bc832e572c42e2618fcb1a10a81d63df3c","number":"1389","subject":"MANTA-3130 update muppet to haproxy 1.5.19 with event ports support Reviewed by: Robert Mustacchi \u003crm@joyent.com\u003e Approved by: David Pacheco \u003cdap@joyent.com\u003e","owner":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"url":"https://cr.joyent.us/1389","commitMessage":"MANTA-3130 update muppet to haproxy 1.5.19 with event ports support\nReviewed by: Robert Mustacchi \u003crm@joyent.com\u003e\nApproved by: David Pacheco \u003cdap@joyent.com\u003e\n","createdOn":1485938794,"lastUpdated":1494451564,"open":false,"status":"MERGED","comments":[{"timestamp":1485938794,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Uploaded patch set 1."},{"timestamp":1486428652,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 1:\n\n(4 comments)"},{"timestamp":1486600008,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Uploaded patch set 2."},{"timestamp":1486600044,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Patch Set 1:\n\n(4 comments)"},{"timestamp":1486669102,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 2: Code-Review+1"},{"timestamp":1494449960,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 2: Integration-Approval+1"},{"timestamp":1494450882,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Uploaded patch set 3: Commit message was updated."},{"timestamp":1494451564,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Joshua M. Clulow"}],"currentPatchSet":{"number":"3","revision":"836df3bc832e572c42e2618fcb1a10a81d63df3c","parents":["cc64100e05d0608a4c0aa11021045776eac9ca4a"],"ref":"refs/changes/89/1389/3","uploader":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"createdOn":1494450882,"author":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1486669102,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1494449960,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"SUBM","value":"1","grantedOn":1494451564,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"VERSION","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"doc/configuration.txt","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"doc/haproxy.1","type":"MODIFIED","insertions":5,"deletions":0},{"file":"include/types/global.h","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"src/cfgparse.c","type":"MODIFIED","insertions":3,"deletions":0},{"file":"src/ev_evports.c","type":"ADDED","insertions":377,"deletions":0},{"file":"src/haproxy.c","type":"MODIFIED","insertions":13,"deletions":0}],"sizeInsertions":420,"sizeDeletions":-5},"patchSets":[{"number":"1","revision":"5ed4cde021c72d4e37e3f1efcd93ffcc70567ef9","parents":["cc64100e05d0608a4c0aa11021045776eac9ca4a"],"ref":"refs/changes/89/1389/1","uploader":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"createdOn":1485938794,"author":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"isDraft":false,"kind":"REWORK","comments":[{"file":"src/ev_evports.c","line":0,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Might be nice to add a general discussion of rearming events with respect to the broader event loop and cache somewhere."},{"file":"src/ev_evports.c","line":0,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"I will flesh this out in the poller routine comments."},{"file":"src/ev_evports.c","line":62,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Is there a reason we don\u0027t need POLLRDNORM?"},{"file":"src/ev_evports.c","line":62,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"According to the POSIX documentation for poll(), POLLIN is equivalent to the combination of POLLRDNORM and POLLRDBAND:\n\nhttp://pubs.opengroup.org/onlinepubs/9699919799/functions/poll.html\n\nLooking in some of the sockfs code, it seems like we set whichever of POLLRDNORM or POLLIN (or both) that you asked for in \"events\" in all of the places where we seek to signal that read will not block."},{"file":"src/ev_evports.c","line":344,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Should we warn somehow about this?"},{"file":"src/ev_evports.c","line":344,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Not warning appears to match the style of the existing pollers.  In the current implementation, MAX_POLLERS has the value 10, and I believe there are only 5 polling mechanisms."},{"file":"src/ev_evports.c","line":361,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"All of these functions should probably have the appropriate REGPRM bits to match the actual signatures. As much as it pains me to say that."},{"file":"src/ev_evports.c","line":361,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"VERSION","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"doc/configuration.txt","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"doc/haproxy.1","type":"MODIFIED","insertions":5,"deletions":0},{"file":"include/types/global.h","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"src/cfgparse.c","type":"MODIFIED","insertions":3,"deletions":0},{"file":"src/ev_evports.c","type":"ADDED","insertions":362,"deletions":0},{"file":"src/haproxy.c","type":"MODIFIED","insertions":13,"deletions":0}],"sizeInsertions":405,"sizeDeletions":-5},{"number":"2","revision":"49d1a535417143b9525c11b07f77628a025ccf09","parents":["cc64100e05d0608a4c0aa11021045776eac9ca4a"],"ref":"refs/changes/89/1389/2","uploader":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"createdOn":1486600008,"author":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1494449960,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1486669102,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"VERSION","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"doc/configuration.txt","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"doc/haproxy.1","type":"MODIFIED","insertions":5,"deletions":0},{"file":"include/types/global.h","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"src/cfgparse.c","type":"MODIFIED","insertions":3,"deletions":0},{"file":"src/ev_evports.c","type":"ADDED","insertions":377,"deletions":0},{"file":"src/haproxy.c","type":"MODIFIED","insertions":13,"deletions":0}],"sizeInsertions":420,"sizeDeletions":-5},{"number":"3","revision":"836df3bc832e572c42e2618fcb1a10a81d63df3c","parents":["cc64100e05d0608a4c0aa11021045776eac9ca4a"],"ref":"refs/changes/89/1389/3","uploader":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"createdOn":1494450882,"author":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1494449960,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1486669102,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"SUBM","value":"1","grantedOn":1494451564,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"VERSION","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"doc/configuration.txt","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"doc/haproxy.1","type":"MODIFIED","insertions":5,"deletions":0},{"file":"include/types/global.h","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"src/cfgparse.c","type":"MODIFIED","insertions":3,"deletions":0},{"file":"src/ev_evports.c","type":"ADDED","insertions":377,"deletions":0},{"file":"src/haproxy.c","type":"MODIFIED","insertions":13,"deletions":0}],"sizeInsertions":420,"sizeDeletions":-5}],"allReviewers":[{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}]}