From 7ec72234afd22982a19425563ba9bd54e31f4647 Mon Sep 17 00:00:00 2001
From: Angela Fong <angela.fong@joyent.com>
Date: Thu, 10 Nov 2016 14:53:02 -0800
Subject: [PATCH] HEAD-2330 sdc-useradm should not hardcode UFDS passwords

---
 lib/sdc-useradm.js          | 4 ++--
 sapi_manifests/sdc/template | 6 ++++++
 2 files changed, 8 insertions(+), 2 deletions(-)

diff --git a/lib/sdc-useradm.js b/lib/sdc-useradm.js
index 83d87f9..535ac24 100755
--- a/lib/sdc-useradm.js
+++ b/lib/sdc-useradm.js
@@ -198,7 +198,7 @@ CLI.prototype.getLocalUfdsClient = function (callback) {
 
     var options = {
         bindDN: 'cn=root',
-        bindPassword: 'secret',
+        bindPassword: config.ufds_ldap_root_pw,
         log: log.child({ufds: 'local'}, true),
         url: 'ldaps://' + config.ufds_domain,
         connectTimeout: 15000,
@@ -223,7 +223,7 @@ CLI.prototype.getMasterUfdsClient = function (callback) {
 
     var options = {
         bindDN: 'cn=root',
-        bindPassword: 'secret',
+        bindPassword: config.ufds_remote_ldap_root_pw,
         log: log.child({ufds: 'master'}, true),
         url: 'ldaps://' + config.ufds_remote_ip,
         connectTimeout: 10000,
diff --git a/sapi_manifests/sdc/template b/sapi_manifests/sdc/template
index b7bc722..a171415 100644
--- a/sapi_manifests/sdc/template
+++ b/sapi_manifests/sdc/template
@@ -21,6 +21,12 @@
     "ufds_ldap_root_dn": "{{{ufds_ldap_root_dn}}}",
     "ufds_ldap_root_pw": "{{{ufds_ldap_root_pw}}}",
     "ufds_remote_ip": "{{{ufds_remote_ip}}}",
+    {{^ufds_remote_ldap_root_pw}}
+    "ufds_remote_ldap_root_pw": "{{{ufds_ldap_root_pw}}}",
+    {{/ufds_remote_ldap_root_pw}}
+    {{#ufds_remote_ldap_root_pw}}
+    "ufds_remote_ldap_root_pw": "{{{ufds_remote_ldap_root_pw}}}",
+    {{/ufds_remote_ldap_root_pw}}
     "vmapi_domain": "{{{vmapi_domain}}}",
     "workflow_domain": "{{{workflow_domain}}}"
 }
-- 
2.21.0

