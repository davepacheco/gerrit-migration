{"project":"joyent/illumos-joyent","branch":"master","id":"I7f072df6d4905b9c58c1d1b3df55d14a71be3739","number":"3270","subject":"OS-6577 ofdlock(): assertion failed: lckdat-\u003el_start \u003d\u003d 0 Reviewed by: Dan McDonald \u003cdanmcd@joyent.com\u003e Reviewed by: Cody Mello \u003ccody.mello@joyent.com\u003e Reviewed by: John Levon \u003cjohn.levon@joyent.com\u003e Approved by: Cody Mello \u003ccody.mello@joyent.com\u003e","owner":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"url":"https://cr.joyent.us/3270","commitMessage":"OS-6577 ofdlock(): assertion failed: lckdat-\u003el_start \u003d\u003d 0\nReviewed by: Dan McDonald \u003cdanmcd@joyent.com\u003e\nReviewed by: Cody Mello \u003ccody.mello@joyent.com\u003e\nReviewed by: John Levon \u003cjohn.levon@joyent.com\u003e\nApproved by: Cody Mello \u003ccody.mello@joyent.com\u003e\n","createdOn":1516978465,"lastUpdated":1516998527,"open":false,"status":"MERGED","comments":[{"timestamp":1516978465,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 1."},{"timestamp":1516978854,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 1: Code-Review+1"},{"timestamp":1516982673,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 1:\n\nTo test this I wrote a simple test program which reproduced the panic, then ran it again after the fix to confirm we get EINVAL as expected."},{"timestamp":1516982684,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 1:\n\nTo test this I wrote a simple test program which reproduced the panic, then ran it again after the fix to confirm we get EINVAL as expected."},{"timestamp":1516986455,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 1:\n\nusr/src/test/os-tests/tests/file-locking should probably be updated to make sure it covers this case, too."},{"timestamp":1516989733,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 2."},{"timestamp":1516990490,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 2:\n\nI placed the new test output in the ticket"},{"timestamp":1516990585,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 2: Code-Review+1"},{"timestamp":1516993211,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 2: Code-Review+1 Integration-Approval+1\n\nThanks for fixing this Jerry!"},{"timestamp":1516994461,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 2: Code-Review+1"},{"timestamp":1516998319,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 3: Patch Set 2 was rebased."},{"timestamp":1516998509,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 4: Commit message was updated."},{"timestamp":1516998527,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Jerry Jelinek"}],"currentPatchSet":{"number":"4","revision":"7f072df6d4905b9c58c1d1b3df55d14a71be3739","parents":["b8fef42ed91e3b916b058421d1783c5cba2a73bf"],"ref":"refs/changes/70/3270/4","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1516998509,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1516990585,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1516993211,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1516993211,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1516994461,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}},{"type":"SUBM","value":"1","grantedOn":1516998527,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"usr/src/test/os-tests/tests/file-locking/runtests.c","type":"MODIFIED","insertions":29,"deletions":-1},{"file":"usr/src/test/os-tests/tests/file-locking/util.c","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"usr/src/uts/common/syscall/fcntl.c","type":"MODIFIED","insertions":3,"deletions":-2}],"sizeInsertions":41,"sizeDeletions":-4},"patchSets":[{"number":"1","revision":"697cbcbd8f5b1053121665f1e43206ac41437d9b","parents":["a8da368ba60a3b5c5d9b4ca9a216514f9a652c8e"],"ref":"refs/changes/70/3270/1","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1516978465,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1516978854,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/syscall/fcntl.c","type":"MODIFIED","insertions":3,"deletions":-2}],"sizeInsertions":3,"sizeDeletions":-2},{"number":"2","revision":"d615e10e0ef5c0efabf7d16af1e3c0fb769e9302","parents":["65ca2e35d394f5308fbe6b2b05c65e86e9ca098b"],"ref":"refs/changes/70/3270/2","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1516989733,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1516993211,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1516993211,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1516990585,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1516994461,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/test/os-tests/tests/file-locking/runtests.c","type":"MODIFIED","insertions":29,"deletions":-1},{"file":"usr/src/test/os-tests/tests/file-locking/util.c","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"usr/src/uts/common/syscall/fcntl.c","type":"MODIFIED","insertions":3,"deletions":-2}],"sizeInsertions":41,"sizeDeletions":-4},{"number":"3","revision":"601fd590099c64ddc44261b8b9428f74903f8990","parents":["b8fef42ed91e3b916b058421d1783c5cba2a73bf"],"ref":"refs/changes/70/3270/3","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1516998319,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1516993211,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1516993211,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1516990585,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1516994461,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/test/os-tests/tests/file-locking/runtests.c","type":"MODIFIED","insertions":29,"deletions":-1},{"file":"usr/src/test/os-tests/tests/file-locking/util.c","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"usr/src/uts/common/syscall/fcntl.c","type":"MODIFIED","insertions":3,"deletions":-2}],"sizeInsertions":41,"sizeDeletions":-4},{"number":"4","revision":"7f072df6d4905b9c58c1d1b3df55d14a71be3739","parents":["b8fef42ed91e3b916b058421d1783c5cba2a73bf"],"ref":"refs/changes/70/3270/4","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1516998509,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1516993211,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1516993211,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"SUBM","value":"1","grantedOn":1516998527,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1516990585,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1516994461,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"usr/src/test/os-tests/tests/file-locking/runtests.c","type":"MODIFIED","insertions":29,"deletions":-1},{"file":"usr/src/test/os-tests/tests/file-locking/util.c","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"usr/src/uts/common/syscall/fcntl.c","type":"MODIFIED","insertions":3,"deletions":-2}],"sizeInsertions":41,"sizeDeletions":-4}],"allReviewers":[{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}]}