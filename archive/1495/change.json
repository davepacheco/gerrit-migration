{"project":"joyent/smartos-live","branch":"master","id":"Ib74b87364dd8e811de5c7a41379f68936a106aab","number":"1495","subject":"OS-5956 need javascript module to calculate object differences Reviewed by: Julien Gilli \u003cjulien.gilli@joyent.com\u003e","owner":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"url":"https://cr.joyent.us/1495","commitMessage":"OS-5956 need javascript module to calculate object differences\nReviewed by: Julien Gilli \u003cjulien.gilli@joyent.com\u003e\n","createdOn":1486765474,"lastUpdated":1513703873,"open":false,"status":"ABANDONED","comments":[{"timestamp":1486765474,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Uploaded patch set 1."},{"timestamp":1486765477,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit 1a199d4b8691956426b990934daedc5324f2ace6\n    \n    initial commit"},{"timestamp":1486765518,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1487970236,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Uploaded patch set 2: Patch Set 1 was rebased."},{"timestamp":1487970239,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit 507373d661551eefb84dec616d65ffa578d1113a\n    \n    initial commit"},{"timestamp":1487970278,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2:\n\n\"make check\" passed ok"},{"timestamp":1487971872,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Uploaded patch set 3."},{"timestamp":1487971875,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 3:\n\nNew commits:\n    \n    commit 451cf47b5585417a825ddf1a39df748ebef53942\n    \n    add docs for map"},{"timestamp":1487971914,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1491434806,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 3:\n\n(19 comments)"},{"timestamp":1491436978,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 3:\n\n(3 comments)"},{"timestamp":1491489175,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 3:\n\n(1 comment)"},{"timestamp":1491584215,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 3:\n\n(21 comments)\n\nThanks for the review! I\u0027ll make all of the changes I\u0027ve noted in my inline comments and push a new changeset.  Adding jsprim for deepCopy to the OS is something that could happen in the future outside of this change (noted in the comments regarding the JSON.parse(JSON.stringify()) hack)."},{"timestamp":1491585958,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Uploaded patch set 4."},{"timestamp":1491585962,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 4:\n\nNew commits:\n    \n    commit 93d01d87a374616884db5d99b6567d200fbeeb2c\n    \n    changes based on julien review"},{"timestamp":1491585996,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1491587410,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Uploaded patch set 5."},{"timestamp":1491587414,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 5:\n\nNew commits:\n    \n    commit 2769e188ca55e0309a3c53ed10896a363d3ab052\n    \n    fixes surrounding path vs prefix\n    \n    commit c2baae2865765a8fb2ad83a1d156d567697d648a\n    \n    changes based on julien review\n    \n    commit 9416c92298fb1c8fdf34540e9f44cb832255f289\n    \n    add docs for map\n    \n    commit 4cd2bc3bb5789a3ec27e5f897cba78134fb0e2db\n    \n    initial commit"},{"timestamp":1491587449,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1491587742,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Uploaded patch set 6."},{"timestamp":1491587745,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 6:\n\nNew commits:\n    \n    commit 24a60e5396de4ef07c720031228c32dfc6d8c99b\n    \n    add functions to test-diff"},{"timestamp":1491587784,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 6: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1491932695,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 6:\n\n(4 comments)"},{"timestamp":1492098431,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 3:\n\n(2 comments)"},{"timestamp":1492098575,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Uploaded patch set 7."},{"timestamp":1492098578,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 7:\n\nNew commits:\n    \n    commit d6379b692714075fc59113e1a1da948f64e4d6f6\n    \n    changes based on julien review"},{"timestamp":1492098613,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 7: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1492099142,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 3:\n\n(1 comment)"},{"timestamp":1492736408,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 7: Code-Review+1\n\n(1 comment)"},{"timestamp":1493139188,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 3:\n\n(1 comment)"},{"timestamp":1493139201,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Uploaded patch set 8."},{"timestamp":1493139204,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 8:\n\nNew commits:\n    \n    commit f61d0644857ec9a7c104088a079b939e6e90c39f\n    \n    document diff.js entry point"},{"timestamp":1493139244,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 8: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1493145563,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 8: Code-Review+1"},{"timestamp":1493324988,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Uploaded patch set 9."},{"timestamp":1493324991,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 9:\n\nNew commits:\n    \n    commit ac6d9e35c7dddaeefe4fb7eb6ef8e038934a8829\n    \n    add diff.js to make check"},{"timestamp":1493325026,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 9: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1493402601,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 9: Code-Review+1"},{"timestamp":1503593720,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Uploaded patch set 10: Patch Set 9 was rebased."},{"timestamp":1503593723,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 10:\n\nNew commits:\n    \n    commit 9033096838f16510bd221300e74fef9926811cfe\n    \n    Merge branch \u0027master\u0027 into grr-OS-5956"},{"timestamp":1503593765,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 10:\n\n\"make check\" passed ok"},{"timestamp":1507153323,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Uploaded patch set 11: Patch Set 10 was rebased."},{"timestamp":1507153327,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 11:\n\nNew commits:\n    \n    commit 4de3f8c9ab937907b566f748b0f63be31d1850f0\n    \n    add diff.js to make check\n    \n    commit bfdc4780b5fbf75f7390cd170b6930139606691e\n    \n    document diff.js entry point\n    \n    commit 03d9f03b8876f1a9e6703e33557e213bd27fb511\n    \n    changes based on julien review\n    \n    commit a265c37707f3181d1fb96c9b7d653b57cfc7a49d\n    \n    add functions to test-diff\n    \n    commit 503daf780c051a3acc9c78f15d32c345ff96295d\n    \n    fixes surrounding path vs prefix\n    \n    commit 5b96368792870d8447ce6c337961f3c1b3668406\n    \n    changes based on julien review\n    \n    commit b680fa30c36675beea1eba878615a2de5df2fbe7\n    \n    add docs for map\n    \n    commit 81c8ecca65aa51de2528332415a1a298b495cd58\n    \n    initial commit"},{"timestamp":1507153369,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 11:\n\n\"make check\" passed ok"},{"timestamp":1513703873,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Abandoned\n\nin OS-2647"}],"currentPatchSet":{"number":"11","revision":"b74b87364dd8e811de5c7a41379f68936a106aab","parents":["85545cdfed4dc84ad7968b2c3a6f2017733899f2"],"ref":"refs/changes/95/1495/11","uploader":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"createdOn":1507153323,"author":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1493325026,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1493402601,"by":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"src/Makefile","type":"MODIFIED","insertions":1,"deletions":0},{"file":"src/manifest","type":"MODIFIED","insertions":1,"deletions":0},{"file":"src/vm/node_modules/diff.js","type":"ADDED","insertions":505,"deletions":0},{"file":"src/vm/tests/test-diff.js","type":"ADDED","insertions":241,"deletions":0}],"sizeInsertions":748,"sizeDeletions":0},"patchSets":[{"number":"1","revision":"611d07891ea8242d6db7215a1ee6792f368d2a52","parents":["a6518ae5c88afd42324ce0c92a809adf798249ba"],"ref":"refs/changes/95/1495/1","uploader":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"createdOn":1486765474,"author":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1486765518,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/manifest","type":"MODIFIED","insertions":1,"deletions":0},{"file":"src/vm/node_modules/diff.js","type":"ADDED","insertions":320,"deletions":0},{"file":"src/vm/tests/test-diff.js","type":"ADDED","insertions":235,"deletions":0}],"sizeInsertions":556,"sizeDeletions":0},{"number":"2","revision":"b1b529d809f4af535b91730add855dfed8bb5ae4","parents":["93cf21d1496f0afe67d89cbf870b22c27bb713bf"],"ref":"refs/changes/95/1495/2","uploader":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"createdOn":1487970236,"author":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1486765518,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/manifest","type":"MODIFIED","insertions":1,"deletions":0},{"file":"src/vm/node_modules/diff.js","type":"ADDED","insertions":320,"deletions":0},{"file":"src/vm/tests/test-diff.js","type":"ADDED","insertions":235,"deletions":0}],"sizeInsertions":556,"sizeDeletions":0},{"number":"3","revision":"5610711c5d4b180e4461d237a755d092de24c52a","parents":["93cf21d1496f0afe67d89cbf870b22c27bb713bf"],"ref":"refs/changes/95/1495/3","uploader":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"createdOn":1487971872,"author":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1487971914,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"src/vm/node_modules/diff.js","line":170,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Is it worth it to assert on the type and form of parameters \"a\" and \"b\"?"},{"file":"src/vm/node_modules/diff.js","line":170,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"This `diff` function is the entry point for the module, it\u0027s job is to determine the type of input and call the appropriate internal diff function (objDiff or arrayDiff).  I don\u0027t think the input should be asserted as this function should technically be able to take any form of input."},{"file":"src/vm/node_modules/diff.js","line":170,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Should we still assert of the correct type of \"opts\" and \"opts.map\" if provided?\n\nRegarding asserting the types of \"a\" and \"b\", thinking out loud, sorry for the long comment:\n\nOK, I was wondering for instance if a user passes a function, or a map, or a symbol, or anything that we\u0027re not sure this function would handle properly and for which there would be a valid use case, is it worth it to not assert?\n\nUsing symbols as an example, what does it mean to diff symbols? I would think they should always return false, maybe the current implementation handles that correctly, but maybe we shouldn\u0027t commit to supporting that to avoid making the implementation overly complex if it needs special handling to support symbols.\n\nAnother example would be String instances. What should that code output:\n\nvar fooStr \u003d new String(\u0027foo\u0027);\nfooStr.someBooleanProperty \u003d true;\n\nvar barStr \u003d new String(\u0027bar\u0027);\nbarStr.someBooleanProperty \u003d true;\n\nconsole.log(diff(fooStr, barStr));\n\n? It seems that currently it would output \"true\", even though it seems fooStr and barStr should be considered \"different\".\n\nIn other words, it seems to me that the function \"diff\" is really about computing the difference in terms of properties of javascript objects, not about checking whether two objects are isomorphic.\n\nMaybe we just need to call out more explicitly that \"diff\"\u0027s role is to compute the difference in terms of *properties* of two objects, not whether these two objects are \"different\".\n\nCurrently the lack of clear statement about diff\u0027s purpose makes this a bit confusing. It only states:\n\n\"diff\" 2 JavaScript objects\n\nwhich is too open to interpretation in my opinion."},{"file":"src/vm/node_modules/diff.js","line":170,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"I really don\u0027t know what we should do in a lot of these cases; I ran a couple tests on String objects and the results are... surprising.\n\nhttps://gist.github.com/bahamas10/e04fb346a7118020d851bf976d3bbc15\n\nTo deal with cases like a String instance, or a function passed in as a parameter, I imagine would require a lot of extra code and extra logic.  Would it just be enough to notate in the comments what objects are expected for this function to perform correctly?\n\nI could add a comment with regard to this module 1. only checking the properties of objects, not the objects themselves, and 2. working in unexpected ways for more complex or rare objects passed in."},{"file":"src/vm/node_modules/diff.js","line":170,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"So it seems I was actually mistaken when I said that:\n\nvar fooStr \u003d new String(\u0027foo\u0027);\nfooStr.someBooleanProperty \u003d true;\nvar barStr \u003d new String(\u0027bar\u0027);\nbarStr.someBooleanProperty \u003d true;\nconsole.log(diff(fooStr, barStr));\n\nwould output true. Thus, I would think that it\u0027s ok to not document that \"diff\" only check the properties of objects. Not necessarily because it\u0027s not true, but more because e.g String instances have properties that are not set in the code explicitly.\n\nHowever, I agree we should document what types of objects are supported."},{"file":"src/vm/node_modules/diff.js","line":170,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Done"},{"file":"src/vm/node_modules/diff.js","line":180,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"What if \"opts\" is the boolean value true? In general, I think \"value || {}\" without any additional runtime type checking is an antipattern. I think the following:\n\nassert.optionalObject(opts, \u0027opts\u0027);\nopts \u003d opts || {};\n\nis more robust."},{"file":"src/vm/node_modules/diff.js","line":180,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Good call, most of my other code is like that I\u0027m surprised this slipped in - I probably wrote a lot of this diffing code a while back."},{"file":"src/vm/node_modules/diff.js","line":183,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Is \"opts.prefix\" documented above? I couldn\u0027t find it. In general, I would suggest adding a comment that documents the parameters that \"objDiff\" accepts."},{"file":"src/vm/node_modules/diff.js","line":183,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"`opts` to all of these functions is strictly internal only - no consumer should ever pass in this parameter.   Still, I\u0027ll go through and document its purpose."},{"file":"src/vm/node_modules/diff.js","line":184,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"nit, order variable declarations alphabetically."},{"file":"src/vm/node_modules/diff.js","line":184,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Done"},{"file":"src/vm/node_modules/diff.js","line":190,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"I would advocate for naming callback functions, so that the function name shows up when inspecting core files with mdb_v8."},{"file":"src/vm/node_modules/diff.js","line":190,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Done"},{"file":"src/vm/node_modules/diff.js","line":191,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"nit: use \"path\" instead of \"p\" for the variable\u0027s name. Otherwise it\u0027s not clear at first what value this variable holds."},{"file":"src/vm/node_modules/diff.js","line":191,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"I automatically stay away from using `path` simply because I use the node.js core \"path\" module in a lot of code I write.  Either way, `p` is incredibly terse and hides the actual intent."},{"file":"src/vm/node_modules/diff.js","line":191,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Dave Pacheco introduced a nice pattern (in my opinion) to deal with that issue: naming variables referencing modules with a \"mod_\" prefix, e.g \"mod_path \u003d require(\u0027path\u0027)\" so that one can declare a variable named \"path\" in the rest of the code without having to worry about the name clash."},{"file":"src/vm/node_modules/diff.js","line":196,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"nit: the name \"hap\" is a bit difficult to understand in this context. It seems using the name \"hasProperty\" would make the code easier to read and you might not need that comment."},{"file":"src/vm/node_modules/diff.js","line":196,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Done"},{"file":"src/vm/node_modules/diff.js","line":206,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"I don\u0027t think this comment helps understanding why or how the code is doing this, and instead describes what it does, which the code already does well. My concern is that\u0027s the kind of comments that is bound to become obsolete, and that doesn\u0027t help understand the code, since the code expresses _what_ it does better than the comment."},{"file":"src/vm/node_modules/diff.js","line":206,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Agreed.  I\u0027ll change this to match the actual intent of the code, not the details of its implementation."},{"file":"src/vm/node_modules/diff.js","line":210,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Shouldn\u0027t the comment read like:\n\n// If either one of a or b are _not_ objects, then the value has changed\n\n? \"Neither\" seems to indicate that none of a _and_ b are _not_ objects, which doesn\u0027t correspond to the code.\n\nI would actually suggest removing the comment, as it seems to basically express the same thing as the code does, and so doesn\u0027t seem to add any value."},{"file":"src/vm/node_modules/diff.js","line":210,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Ah, good catch, the comment is actually incorrect.  I\u0027ll omit it."},{"file":"src/vm/node_modules/diff.js","line":257,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"It would help when reading the code to have some comment that documents the input, output and purpose of this function.\n\nAlso, should we assert on parameters\u0027 types?"},{"file":"src/vm/node_modules/diff.js","line":257,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Done"},{"file":"src/vm/node_modules/diff.js","line":258,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Same comment as above regarding the \"opts \u003d opts || {}\" anti-pattern without more runtime type checking."},{"file":"src/vm/node_modules/diff.js","line":258,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Done"},{"file":"src/vm/node_modules/diff.js","line":264,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"A comment on _why_ we push \"null\" would be helpful."},{"file":"src/vm/node_modules/diff.js","line":264,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"This is covered on line 114 - i\u0027ll add a note here though so it\u0027s less obtuse."},{"file":"src/vm/node_modules/diff.js","line":273,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"All callback functions should be named. For functions part of assignment expressions, it\u0027s a bit more subtle when we use a node version \u003e\u003d 6.x, but that\u0027s not the version we\u0027re using in the platform for all (or even any currently) CN."},{"file":"src/vm/node_modules/diff.js","line":273,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Done"},{"file":"src/vm/node_modules/diff.js","line":290,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"I tend to try to declare all variables at the top of the function\u0027s scope, whenever it is possible. Since variable declarations are hoisted anyway, it makes this hoisting more explicit, and sometimes avoids the illusion that variable might not be defined in the whole function\u0027s scope."},{"file":"src/vm/node_modules/diff.js","line":290,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Done"},{"file":"src/vm/node_modules/diff.js","line":378,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Typo in \"soley\" -\u003e \"solely\"."},{"file":"src/vm/node_modules/diff.js","line":378,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"good catch!"},{"file":"src/vm/node_modules/diff.js","line":392,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Should we assert on the type of \"arr\"?"},{"file":"src/vm/node_modules/diff.js","line":392,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"yes! I don\u0027t know how I missed this."},{"file":"src/vm/node_modules/diff.js","line":393,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"This function should be named."},{"file":"src/vm/node_modules/diff.js","line":393,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Done"},{"file":"src/vm/node_modules/diff.js","line":414,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Why not name this \"safeHasOwnProperty\", or even just \"hasProperty\"?"},{"file":"src/vm/node_modules/diff.js","line":414,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"I like \"hasProperty\""},{"file":"src/vm/tests/test-diff.js","line":1,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"There\u0027s no need to have a CDDL license header in this file?"},{"file":"src/vm/tests/test-diff.js","line":1,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"I\u0027m just following suit - no tests inside smartos-live have the CDDL header"},{"file":"src/vm/tests/test-diff.js","line":13,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"What about edge cases like copying objects with values that are not stringifyable (like functions, or maps, sets, etc.) and circular references? Do we care about these use cases in this test?"},{"file":"src/vm/tests/test-diff.js","line":13,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"I just needed a simple copy for this test.  Inside VM.js I added `deepCopy`... it may time to include dap\u0027s jsprim somewhere in the OS"},{"file":"src/vm/tests/test-diff.js","line":17,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"What happens if we add a function to this array? Are there other types of objects/values that are not numbers, instances of \"Object\", strings and arrays?"},{"file":"src/vm/tests/test-diff.js","line":17,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"I have no idea... I can add some of these tests."},{"file":"src/vm/tests/test-diff.js","line":236,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"It seems there\u0027s no test for calling \"diff\" with both arguments being arrays. Should we add some of these tests?"},{"file":"src/vm/tests/test-diff.js","line":236,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Actually, after taking another look, there are such tests: the first test includes test cases for diffing identical arrays, and the latest test diffs objects for which one of their properties is an array."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/manifest","type":"MODIFIED","insertions":1,"deletions":0},{"file":"src/vm/node_modules/diff.js","type":"ADDED","insertions":435,"deletions":0},{"file":"src/vm/tests/test-diff.js","type":"ADDED","insertions":236,"deletions":0}],"sizeInsertions":672,"sizeDeletions":0},{"number":"4","revision":"21fe3eb2c4ae0eb4969abab95c955319d485cfd8","parents":["6b833549a5739a30c623198e9029765e2b1fa3ff"],"ref":"refs/changes/95/1495/4","uploader":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"createdOn":1491585958,"author":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1491585996,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/manifest","type":"MODIFIED","insertions":1,"deletions":0},{"file":"src/vm/node_modules/diff.js","type":"ADDED","insertions":491,"deletions":0},{"file":"src/vm/tests/test-diff.js","type":"ADDED","insertions":236,"deletions":0}],"sizeInsertions":728,"sizeDeletions":0},{"number":"5","revision":"706497cba34c7e3ddb4cbd350c29115acd8dd67e","parents":["6b833549a5739a30c623198e9029765e2b1fa3ff"],"ref":"refs/changes/95/1495/5","uploader":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"createdOn":1491587410,"author":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1491587449,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/manifest","type":"MODIFIED","insertions":1,"deletions":0},{"file":"src/vm/node_modules/diff.js","type":"ADDED","insertions":491,"deletions":0},{"file":"src/vm/tests/test-diff.js","type":"ADDED","insertions":236,"deletions":0}],"sizeInsertions":728,"sizeDeletions":0},{"number":"6","revision":"c8f7d246a60351b2325111b077fb7f8f61d04555","parents":["6b833549a5739a30c623198e9029765e2b1fa3ff"],"ref":"refs/changes/95/1495/6","uploader":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"createdOn":1491587742,"author":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1491587784,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"src/vm/node_modules/diff.js","line":220,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"nit: I think JS variable names use camel case in that code base, but I could be mistaken."},{"file":"src/vm/node_modules/diff.js","line":220,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Sadly, in the VM.js code base they have a mixture of both.  However, in this code base I\u0027ve used mostly camelCase (see prettyPath below) so i\u0027ll modify this to match, good catch."},{"file":"src/vm/node_modules/diff.js","line":292,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"What does the \"TODO\" mean?"},{"file":"src/vm/node_modules/diff.js","line":292,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"TODO was a note for me to finish describing this :p.  I have it written in a text document but I never transferred it over... I\u0027ll push it with the next patch, my fault!"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/manifest","type":"MODIFIED","insertions":1,"deletions":0},{"file":"src/vm/node_modules/diff.js","type":"ADDED","insertions":491,"deletions":0},{"file":"src/vm/tests/test-diff.js","type":"ADDED","insertions":241,"deletions":0}],"sizeInsertions":733,"sizeDeletions":0},{"number":"7","revision":"b1b9ceb06fa076ec8db0f6efa27419cd4c5b3a3d","parents":["37fa0b13a2503039ea0e9ba785f1951785d941ad"],"ref":"refs/changes/95/1495/7","uploader":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"createdOn":1492098575,"author":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1492098613,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1492736408,"by":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/manifest","type":"MODIFIED","insertions":1,"deletions":0},{"file":"src/vm/node_modules/diff.js","type":"ADDED","insertions":494,"deletions":0},{"file":"src/vm/tests/test-diff.js","type":"ADDED","insertions":241,"deletions":0}],"sizeInsertions":736,"sizeDeletions":0},{"number":"8","revision":"a99fa892f1c4c60158b9c90126681a30ffe4c99c","parents":["b7272e9a8d0bc947e9e85b9ebae9237a8024a55d"],"ref":"refs/changes/95/1495/8","uploader":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"createdOn":1493139201,"author":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1493139244,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1493145563,"by":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"src/manifest","type":"MODIFIED","insertions":1,"deletions":0},{"file":"src/vm/node_modules/diff.js","type":"ADDED","insertions":505,"deletions":0},{"file":"src/vm/tests/test-diff.js","type":"ADDED","insertions":241,"deletions":0}],"sizeInsertions":747,"sizeDeletions":0},{"number":"9","revision":"7efbbf4f481ade7c56739697a488b4c83f99d161","parents":["b7272e9a8d0bc947e9e85b9ebae9237a8024a55d"],"ref":"refs/changes/95/1495/9","uploader":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"createdOn":1493324988,"author":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1493325026,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1493402601,"by":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"src/Makefile","type":"MODIFIED","insertions":1,"deletions":0},{"file":"src/manifest","type":"MODIFIED","insertions":1,"deletions":0},{"file":"src/vm/node_modules/diff.js","type":"ADDED","insertions":505,"deletions":0},{"file":"src/vm/tests/test-diff.js","type":"ADDED","insertions":241,"deletions":0}],"sizeInsertions":748,"sizeDeletions":0},{"number":"10","revision":"185d5d21cf11eaf18a348226f5123dd2052a3724","parents":["ed7577cb855337d9a93e66fa0eb73eb604fe8f04"],"ref":"refs/changes/95/1495/10","uploader":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"createdOn":1503593720,"author":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1493325026,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1493402601,"by":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"src/Makefile","type":"MODIFIED","insertions":1,"deletions":0},{"file":"src/manifest","type":"MODIFIED","insertions":1,"deletions":0},{"file":"src/vm/node_modules/diff.js","type":"ADDED","insertions":505,"deletions":0},{"file":"src/vm/tests/test-diff.js","type":"ADDED","insertions":241,"deletions":0}],"sizeInsertions":748,"sizeDeletions":0},{"number":"11","revision":"b74b87364dd8e811de5c7a41379f68936a106aab","parents":["85545cdfed4dc84ad7968b2c3a6f2017733899f2"],"ref":"refs/changes/95/1495/11","uploader":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"createdOn":1507153323,"author":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1493325026,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1493402601,"by":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"src/Makefile","type":"MODIFIED","insertions":1,"deletions":0},{"file":"src/manifest","type":"MODIFIED","insertions":1,"deletions":0},{"file":"src/vm/node_modules/diff.js","type":"ADDED","insertions":505,"deletions":0},{"file":"src/vm/tests/test-diff.js","type":"ADDED","insertions":241,"deletions":0}],"sizeInsertions":748,"sizeDeletions":0}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"}]}