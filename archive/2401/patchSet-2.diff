commit a6668c455d23e15c21d65f7ecb4e5deca2aeb08e (refs/changes/01/2401/2)
Author: Brittany Wald <brittany.wald@joyent.com>
Date:   2017-08-22T17:59:24+00:00 (2 years, 2 months ago)
    
    MANTA-3371 triggers cannot be installed with any vnodes in read-only mode

diff --git a/lib/moray.js b/lib/moray.js
index fe8050c..ca89840 100644
--- a/lib/moray.js
+++ b/lib/moray.js
@@ -228,11 +228,14 @@ function setupMantaTrigger(log, client, cb) {
 
         function updateTrigger(callback) {
             var sql, req;
+            var opts = {
+                readOnlyOverride: true
+            };
 
             sql = updatesql + '\n' + funcsql;
             log.info({ 'sql': sql }, 'setupMantaTrigger: apply update');
             callback = once(callback);
-            req = client.sql(sql);
+            req = client.sql(sql, opts);
             req.on('record', function (row) {
                 log.info(row, 'setupMantaTrigger: row');
             });
diff --git a/package.json b/package.json
index 624b6e3..82e16e9 100644
--- a/package.json
+++ b/package.json
@@ -15,7 +15,7 @@
         "bunyan": "0.22.1",
         "jsprim": "^1.3.1",
         "lru-cache": "2.3.1",
-        "moray": "3.0.0",
+        "moray": "3.3.0",
         "once": "1.3.0",
         "restify": "2.6.3",
         "redis": "0.10.1",
