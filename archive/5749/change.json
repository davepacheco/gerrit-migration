{"project":"joyent/illumos-kvm-cmd","branch":"master","topic":"live migration","id":"I4bf9f99a9c8bcd2a8d76b6a01be3efbd8ce5f762","number":"5749","subject":"fix live migration","owner":{"name":"Jan Poctavek","email":"janci@binaryparadise.com","username":"YanChii"},"url":"https://cr.joyent.us/5749","commitMessage":"fix live migration\n","createdOn":1552149988,"lastUpdated":1555501551,"open":true,"status":"NEW","comments":[{"timestamp":1552149988,"reviewer":{"name":"Jan Poctavek","email":"janci@binaryparadise.com","username":"YanChii"},"message":"Uploaded patch set 1."},{"timestamp":1552937547,"reviewer":{"name":"Jan Poctavek","email":"janci@binaryparadise.com","username":"YanChii"},"message":"Uploaded patch set 2: Patch Set 1 was rebased."},{"timestamp":1554131057,"reviewer":{"name":"Jan Poctavek","email":"janci@binaryparadise.com","username":"YanChii"},"message":"Topic set to live migration"},{"timestamp":1554474446,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1554567420,"reviewer":{"name":"Jan Poctavek","email":"janci@binaryparadise.com","username":"YanChii"},"message":"Uploaded patch set 3: Patch Set 2 was rebased."},{"timestamp":1554567782,"reviewer":{"name":"Jan Poctavek","email":"janci@binaryparadise.com","username":"YanChii"},"message":"Uploaded patch set 4."},{"timestamp":1554758065,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 4:\n\n(1 comment)"},{"timestamp":1554765185,"reviewer":{"name":"Jan Poctavek","email":"janci@binaryparadise.com","username":"YanChii"},"message":"Patch Set 4:\n\n(1 comment)"},{"timestamp":1554765447,"reviewer":{"name":"Jan Poctavek","email":"janci@binaryparadise.com","username":"YanChii"},"message":"Uploaded patch set 5."},{"timestamp":1555427367,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 4:\n\n(1 comment)"},{"timestamp":1555501430,"reviewer":{"name":"Jan Poctavek","email":"janci@binaryparadise.com","username":"YanChii"},"message":"Patch Set 5:\n\n(1 comment)"},{"timestamp":1555501551,"reviewer":{"name":"Jan Poctavek","email":"janci@binaryparadise.com","username":"YanChii"},"message":"Uploaded patch set 6."}],"currentPatchSet":{"number":"6","revision":"4bf9f99a9c8bcd2a8d76b6a01be3efbd8ce5f762","parents":["1e9a87038f5bc0a65a32da476e324864c23fcc8d"],"ref":"refs/changes/49/5749/6","uploader":{"name":"Jan Poctavek","email":"janci@binaryparadise.com","username":"YanChii"},"createdOn":1555501551,"author":{"name":"Jan Poctavek","email":"janci@binaryparadise.com","username":"YanChii"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"qemu-kvm-x86.c","type":"MODIFIED","insertions":20,"deletions":-6},{"file":"target-i386/kvm.c","type":"MODIFIED","insertions":12,"deletions":-10}],"sizeInsertions":32,"sizeDeletions":-16},"patchSets":[{"number":"1","revision":"7ec908f2b13f8012cfd4834c51104e00888e2b07","parents":["c59cf16e7e66a37554f66a7b858f3a5f15a1474a"],"ref":"refs/changes/49/5749/1","uploader":{"name":"Jan Poctavek","email":"janci@binaryparadise.com","username":"YanChii"},"createdOn":1552149988,"author":{"name":"Jan Poctavek","email":"janci@binaryparadise.com","username":"YanChii"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"qemu-kvm-x86.c","type":"MODIFIED","insertions":10,"deletions":-1}],"sizeInsertions":10,"sizeDeletions":-1},{"number":"2","revision":"a1c3a4684ac3cfc9d14eb9ee896d504bbe0c08c2","parents":["980ed28b9c31e9e2355003fe02343412a0b2e57d"],"ref":"refs/changes/49/5749/2","uploader":{"name":"Jan Poctavek","email":"janci@binaryparadise.com","username":"YanChii"},"createdOn":1552937547,"author":{"name":"Jan Poctavek","email":"janci@binaryparadise.com","username":"YanChii"},"isDraft":false,"kind":"TRIVIAL_REBASE","comments":[{"file":"qemu-kvm-x86.c","line":517,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"It seems like what you care about is whether or not the kernel is 64-bit. If that\u0027s the case, the correct way to do this is to look at the architecture returned by sysinfo(2) using the SI_ARCHITECTURE_K command."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"qemu-kvm-x86.c","type":"MODIFIED","insertions":10,"deletions":-1}],"sizeInsertions":10,"sizeDeletions":-1},{"number":"3","revision":"94bc071e8912071714d052fbfa15afaeeca83da7","parents":["1e9a87038f5bc0a65a32da476e324864c23fcc8d"],"ref":"refs/changes/49/5749/3","uploader":{"name":"Jan Poctavek","email":"janci@binaryparadise.com","username":"YanChii"},"createdOn":1554567420,"author":{"name":"Jan Poctavek","email":"janci@binaryparadise.com","username":"YanChii"},"isDraft":false,"kind":"TRIVIAL_REBASE","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"qemu-kvm-x86.c","type":"MODIFIED","insertions":10,"deletions":-1}],"sizeInsertions":10,"sizeDeletions":-1},{"number":"4","revision":"4fea34d1671ccd044b933f7fac210dcd52aa6e0c","parents":["1e9a87038f5bc0a65a32da476e324864c23fcc8d"],"ref":"refs/changes/49/5749/4","uploader":{"name":"Jan Poctavek","email":"janci@binaryparadise.com","username":"YanChii"},"createdOn":1554567782,"author":{"name":"Jan Poctavek","email":"janci@binaryparadise.com","username":"YanChii"},"isDraft":false,"kind":"REWORK","comments":[{"file":"qemu-kvm-x86.c","line":517,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Please see my previous comment about how this should be implemented."},{"file":"qemu-kvm-x86.c","line":517,"reviewer":{"name":"Jan Poctavek","email":"janci@binaryparadise.com","username":"YanChii"},"message":"Sorry, I missed this. Will fix.\nBut actually this check is not needed. Correct me if I\u0027m wrong but combination KVM+qemu+SunOS+live_migration will always result in 64-bit OS. This code is not used for any other purpose."},{"file":"qemu-kvm-x86.c","line":517,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"This, as written, is saying that if qemu is 64-bit, then it\u0027s fine. While we don\u0027t plan on having a 32-bit qemu, a 32-bit qemu could run on a 64-bit OS. If you want something that\u0027s actually the equivalent of the existing Linux check, then we should actually do what I suggested. If we\u0027re going to assume that we\u0027re only ever 64-bit, then we should set it to 1, and explicitly #error if we\u0027re not building 64-bit.\n\nAlso, the cstyle of the else statement needs to be fixed here."},{"file":"qemu-kvm-x86.c","line":517,"reviewer":{"name":"Jan Poctavek","email":"janci@binaryparadise.com","username":"YanChii"},"message":"Even if never used, I feel the most proper way is to implement SI_ARCHITECTURE_K. Other ways seem too lazy to me.\nPushing the fix."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"qemu-kvm-x86.c","type":"MODIFIED","insertions":16,"deletions":-6},{"file":"target-i386/kvm.c","type":"MODIFIED","insertions":12,"deletions":-10}],"sizeInsertions":28,"sizeDeletions":-16},{"number":"5","revision":"10d01499dc302f501c63949a7c7d8c7e6c148470","parents":["1e9a87038f5bc0a65a32da476e324864c23fcc8d"],"ref":"refs/changes/49/5749/5","uploader":{"name":"Jan Poctavek","email":"janci@binaryparadise.com","username":"YanChii"},"createdOn":1554765447,"author":{"name":"Jan Poctavek","email":"janci@binaryparadise.com","username":"YanChii"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"qemu-kvm-x86.c","type":"MODIFIED","insertions":10,"deletions":-6},{"file":"target-i386/kvm.c","type":"MODIFIED","insertions":12,"deletions":-10}],"sizeInsertions":22,"sizeDeletions":-16},{"number":"6","revision":"4bf9f99a9c8bcd2a8d76b6a01be3efbd8ce5f762","parents":["1e9a87038f5bc0a65a32da476e324864c23fcc8d"],"ref":"refs/changes/49/5749/6","uploader":{"name":"Jan Poctavek","email":"janci@binaryparadise.com","username":"YanChii"},"createdOn":1555501551,"author":{"name":"Jan Poctavek","email":"janci@binaryparadise.com","username":"YanChii"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"qemu-kvm-x86.c","type":"MODIFIED","insertions":20,"deletions":-6},{"file":"target-i386/kvm.c","type":"MODIFIED","insertions":12,"deletions":-10}],"sizeInsertions":32,"sizeDeletions":-16}],"allReviewers":[{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},{"name":"Jan Poctavek","email":"janci@binaryparadise.com","username":"YanChii"}]}