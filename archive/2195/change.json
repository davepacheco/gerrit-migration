{"project":"joyent/manatee","branch":"master","id":"Ic6e5e60d202566db1a0b1833f89220dce0d9edc6","number":"2195","subject":"MANATEE-341 \"manatee-adm rebuild\" hangs when rebuilding a sync peer MANATEE-344 Rebuild should not exit if postgres hasn\u0027t started on its first attempt Reviewed by: Dave Pacheco \u003cdap@joyent.com\u003e Approved by: Dave Pacheco \u003cdap@joyent.com\u003e","owner":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"url":"https://cr.joyent.us/2195","commitMessage":"MANATEE-341 \"manatee-adm rebuild\" hangs when rebuilding a sync peer\nMANATEE-344 Rebuild should not exit if postgres hasn\u0027t started on its first attempt\nReviewed by: Dave Pacheco \u003cdap@joyent.com\u003e\nApproved by: Dave Pacheco \u003cdap@joyent.com\u003e\n","createdOn":1499685006,"lastUpdated":1507543217,"open":false,"status":"MERGED","comments":[{"timestamp":1499685006,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"Uploaded patch set 1."},{"timestamp":1499685040,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1507142852,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 1: Code-Review+1 Integration-Approval+1\n\n(1 comment)"},{"timestamp":1507277206,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"Uploaded patch set 2."},{"timestamp":1507277240,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1507277261,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"Uploaded patch set 3: Patch Set 2 was rebased."},{"timestamp":1507277296,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3:\n\n\"make check\" passed ok"},{"timestamp":1507277524,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"Uploaded patch set 4: Patch Set 3 was rebased."},{"timestamp":1507278036,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"Patch Set 4:\n\n(1 comment)\n\nThanks for checking this out! I\u0027ve incorporated your feedback and rebased on master. I\u0027ve tested these changes in the same way as noted in MANATEE-341 and they work as expected.\n\n`make prepush` is clean as it was before, but I must note that my dev cluster is running an old commit (pre MANATEE-335, specifically c525bc705fff52644471bd5c9ab7286ca368dbfb) due to MANATEE-375. lib/adm.js doesn\u0027t appear to have been touched by MANATEE-335, and given the clean rebases I\u0027m confident that my testing is still applicable."},{"timestamp":1507307409,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 4: Code-Review+1 Integration-Approval+1"},{"timestamp":1507543055,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"Uploaded patch set 5: Patch Set 4 was rebased."},{"timestamp":1507543085,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5:\n\n\"make check\" passed ok"},{"timestamp":1507543119,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"Uploaded patch set 6: Commit message was updated."},{"timestamp":1507543217,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Richard Bradley"}],"currentPatchSet":{"number":"6","revision":"c6e5e60d202566db1a0b1833f89220dce0d9edc6","parents":["6a769d9776687839537739bda72656e282c676c4"],"ref":"refs/changes/95/2195/6","uploader":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"createdOn":1507543119,"author":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1507277240,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1507307409,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1507307409,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"SUBM","value":"1","grantedOn":1507543217,"by":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"lib/adm.js","type":"MODIFIED","insertions":14,"deletions":-18}],"sizeInsertions":14,"sizeDeletions":-18},"patchSets":[{"number":"1","revision":"5554d94a79a43e470a521a1b4fe4933b79d2bcb0","parents":["c525bc705fff52644471bd5c9ab7286ca368dbfb"],"ref":"refs/changes/95/2195/1","uploader":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"createdOn":1499685006,"author":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1507142852,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1507142852,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1499685040,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/adm.js","line":1515,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"This could just be an \"else\" (and skip the `!thisPeer` in the next \"if\")."},{"file":"lib/adm.js","line":1515,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"Thanks! This looks cleaner, so I\u0027ve pushed a change to incorporate it (and to also use \"\u003d\u003d\u003d\" when checking for async zoneIds below for consistency)."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"lib/adm.js","type":"MODIFIED","insertions":15,"deletions":-18}],"sizeInsertions":15,"sizeDeletions":-18},{"number":"2","revision":"ca4ce9552cafe0d2bd12b963ed7273eaa0e06330","parents":["c525bc705fff52644471bd5c9ab7286ca368dbfb"],"ref":"refs/changes/95/2195/2","uploader":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"createdOn":1507277206,"author":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1507277240,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"lib/adm.js","type":"MODIFIED","insertions":14,"deletions":-18}],"sizeInsertions":14,"sizeDeletions":-18},{"number":"3","revision":"30548c1433a4c33e6bbc64ff36f9b193a2942d54","parents":["34238c257d3cb6fe7eba247c7e40a1dd49c4f3e8"],"ref":"refs/changes/95/2195/3","uploader":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"createdOn":1507277261,"author":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1507277240,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"lib/adm.js","type":"MODIFIED","insertions":14,"deletions":-18}],"sizeInsertions":14,"sizeDeletions":-18},{"number":"4","revision":"8a99c5eef30d5a3e47ef29483f14dc3437c32270","parents":["7f808daeb347b1b40c39e7c83e0eec2389f29403"],"ref":"refs/changes/95/2195/4","uploader":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"createdOn":1507277524,"author":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"isDraft":false,"kind":"NO_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1507307409,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1507307409,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1507277240,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"lib/adm.js","type":"MODIFIED","insertions":14,"deletions":-18}],"sizeInsertions":14,"sizeDeletions":-18},{"number":"5","revision":"2d227d38bff3d8d187046d1167b71470b7ad9e45","parents":["6a769d9776687839537739bda72656e282c676c4"],"ref":"refs/changes/95/2195/5","uploader":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"createdOn":1507543055,"author":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1507307409,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1507307409,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1507277240,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"lib/adm.js","type":"MODIFIED","insertions":14,"deletions":-18}],"sizeInsertions":14,"sizeDeletions":-18},{"number":"6","revision":"c6e5e60d202566db1a0b1833f89220dce0d9edc6","parents":["6a769d9776687839537739bda72656e282c676c4"],"ref":"refs/changes/95/2195/6","uploader":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"createdOn":1507543119,"author":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1507307409,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1507307409,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1507277240,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"SUBM","value":"1","grantedOn":1507543217,"by":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"lib/adm.js","type":"MODIFIED","insertions":14,"deletions":-18}],"sizeInsertions":14,"sizeDeletions":-18}],"allReviewers":[{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"}]}