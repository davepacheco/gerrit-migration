From 7edb59a285380a79ce23d16cc3296911129744cc Mon Sep 17 00:00:00 2001
From: Trent Mick <trentm@gmail.com>
Date: Thu, 23 May 2019 15:19:30 -0700
Subject: [PATCH] TRITON-1701 sdcadm.test.js test for 'sdcadm --version'
 doesn't handle branch names with dots

---
 test/sdcadm.test.js | 7 +++++--
 1 file changed, 5 insertions(+), 2 deletions(-)

diff --git a/test/sdcadm.test.js b/test/sdcadm.test.js
index 2e2279d..868cfe3 100644
--- a/test/sdcadm.test.js
+++ b/test/sdcadm.test.js
@@ -9,8 +9,9 @@
  */
 
 
-var test = require('tape').test;
 var exec = require('child_process').exec;
+var format = require('util').format;
+var test = require('tape').test;
 
 
 test('sdcadm', function (t) {
@@ -41,7 +42,9 @@ test('sdcadm --help', function (t) {
 test('sdcadm --version', function (t) {
     exec('sdcadm --version', function (err, stdout, stderr) {
         t.ifError(err, 'no version error');
-        t.ok(stdout.match(/^sdcadm \d+\.\d+\.\d+ \([\w-]+-\d+T\d+Z-.+\)/));
+        var verRe = /^sdcadm \d+\.\d+\.\d+ \(.+-\d+T\d+Z-g[0-9a-f]{7}\)$/;
+        t.ok(verRe.test(stdout.trim()),
+            format('version should match %s: %j', verRe, stdout.trim()));
         t.equal(stderr, '');
 
         t.end();
-- 
2.21.0

