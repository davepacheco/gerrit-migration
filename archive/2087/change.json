{"project":"joyent/illumos-joyent","branch":"master","id":"I1416b1e2a16159ff983fcf470d4aae4fc859dab1","number":"2087","subject":"OS-6046 gettid incorrect for first thread in init process Reviewed by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e Approved by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e","owner":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"url":"https://cr.joyent.us/2087","commitMessage":"OS-6046 gettid incorrect for first thread in init process\nReviewed by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e\nApproved by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e\n","createdOn":1497459201,"lastUpdated":1497471701,"open":false,"status":"MERGED","comments":[{"timestamp":1497459201,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 1."},{"timestamp":1497460530,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 1:\n\n(2 comments)"},{"timestamp":1497464778,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 1:\n\n(2 comments)"},{"timestamp":1497464785,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 2."},{"timestamp":1497466964,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 3."},{"timestamp":1497467253,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 4."},{"timestamp":1497468429,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 4: Code-Review+1"},{"timestamp":1497470020,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 4:\n\nI added test notes to the ticket. I also re-ran LTP and lx-tests with the latest patch set 4."},{"timestamp":1497470279,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 4: Integration-Approval+1"},{"timestamp":1497471632,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 5: Patch Set 4 was rebased."},{"timestamp":1497471689,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 6: Commit message was updated."},{"timestamp":1497471701,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Jerry Jelinek"}],"currentPatchSet":{"number":"6","revision":"1416b1e2a16159ff983fcf470d4aae4fc859dab1","parents":["4a59c82cb2b671eb549104db3913704c1180d16b"],"ref":"refs/changes/87/2087/6","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1497471689,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1497468429,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1497470279,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"SUBM","value":"1","grantedOn":1497471701,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/uts/common/brand/lx/syscall/lx_futex.c","type":"MODIFIED","insertions":7,"deletions":-2},{"file":"usr/src/uts/common/brand/lx/syscall/lx_getpid.c","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":9,"sizeDeletions":-4},"patchSets":[{"number":"1","revision":"0d79763a417897efe0e4253c3f1ef13c98a26453","parents":["ed2be6056f1a63f70c5bb561b80d8b87900dad32"],"ref":"refs/changes/87/2087/1","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1497459201,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/uts/common/brand/lx/syscall/lx_futex.c","line":835,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Do these fit on one line if using \u0027curzone\u0027 instead of \u0027curproc-\u003ep_zone\u0027?"},{"file":"usr/src/uts/common/brand/lx/syscall/lx_futex.c","line":835,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Yes, they are exactly 80 chars. Fixed."},{"file":"usr/src/uts/intel/lx_brand/Makefile","line":74,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"What errors did gcc start throwing that required this override?"},{"file":"usr/src/uts/intel/lx_brand/Makefile","line":74,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"This is the same gcc warning as I got when I first wrote this code. Gcc is complaining that mytid might be clobbered by the longjmp. Originally I was able to get gcc to stop whining by placing the assignment on the declaration line, but that trick no longer works with the more complex change."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/brand/lx/syscall/lx_futex.c","type":"MODIFIED","insertions":8,"deletions":-2},{"file":"usr/src/uts/common/brand/lx/syscall/lx_getpid.c","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/uts/intel/lx_brand/Makefile","type":"MODIFIED","insertions":2,"deletions":0}],"sizeInsertions":13,"sizeDeletions":-4},{"number":"2","revision":"dd6ca780a83cfff32df78211453d99644d0a91af","parents":["ed2be6056f1a63f70c5bb561b80d8b87900dad32"],"ref":"refs/changes/87/2087/2","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1497464785,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/brand/lx/syscall/lx_futex.c","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"usr/src/uts/common/brand/lx/syscall/lx_getpid.c","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/uts/intel/lx_brand/Makefile","type":"MODIFIED","insertions":2,"deletions":0}],"sizeInsertions":11,"sizeDeletions":-4},{"number":"3","revision":"951d261337cd62f33e42237cd7eb5667d6f83f11","parents":["ed2be6056f1a63f70c5bb561b80d8b87900dad32"],"ref":"refs/changes/87/2087/3","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1497466964,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/brand/lx/syscall/lx_futex.c","type":"MODIFIED","insertions":7,"deletions":-2},{"file":"usr/src/uts/common/brand/lx/syscall/lx_getpid.c","type":"MODIFIED","insertions":3,"deletions":-2}],"sizeInsertions":10,"sizeDeletions":-4},{"number":"4","revision":"d46fe9367f38900c10aea3aae52ec66fd110844b","parents":["ed2be6056f1a63f70c5bb561b80d8b87900dad32"],"ref":"refs/changes/87/2087/4","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1497467253,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1497468429,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1497470279,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/brand/lx/syscall/lx_futex.c","type":"MODIFIED","insertions":7,"deletions":-2},{"file":"usr/src/uts/common/brand/lx/syscall/lx_getpid.c","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":9,"sizeDeletions":-4},{"number":"5","revision":"bc39bbd5153fef42cf6afdd3779cde36352cd28c","parents":["4a59c82cb2b671eb549104db3913704c1180d16b"],"ref":"refs/changes/87/2087/5","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1497471632,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1497468429,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1497470279,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/brand/lx/syscall/lx_futex.c","type":"MODIFIED","insertions":7,"deletions":-2},{"file":"usr/src/uts/common/brand/lx/syscall/lx_getpid.c","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":9,"sizeDeletions":-4},{"number":"6","revision":"1416b1e2a16159ff983fcf470d4aae4fc859dab1","parents":["4a59c82cb2b671eb549104db3913704c1180d16b"],"ref":"refs/changes/87/2087/6","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1497471689,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"SUBM","value":"1","grantedOn":1497471701,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1497468429,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1497470279,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/uts/common/brand/lx/syscall/lx_futex.c","type":"MODIFIED","insertions":7,"deletions":-2},{"file":"usr/src/uts/common/brand/lx/syscall/lx_getpid.c","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":9,"sizeDeletions":-4}],"allReviewers":[{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}]}