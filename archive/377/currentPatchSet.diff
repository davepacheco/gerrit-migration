From 978914c52f277dca99b7e6fb48d29b60ffe5ebcb Mon Sep 17 00:00:00 2001
From: Nick Zivkovic <nick.zivkovic@joyent.com>
Date: Thu, 25 Aug 2016 00:08:35 +0000
Subject: [PATCH] MANATEE-312 manatee should not set snapdir to visible
 Reviewed by: Joshua M. Clulow <jmc@joyent.com> Approved by: Dave Pacheco
 <dap@joyent.com>

---
 boot/setup.sh | 7 +++----
 1 file changed, 3 insertions(+), 4 deletions(-)

diff --git a/boot/setup.sh b/boot/setup.sh
index de6a6b3..3b8b3c5 100755
--- a/boot/setup.sh
+++ b/boot/setup.sh
@@ -90,6 +90,9 @@ function common_manatee_setup {
     echo "creating manatee dataset"
     zfs create -o canmount=noauto $DATASET
 
+    echo "make snapdir property match the ancestor's"
+    zfs inherit -r snapdir $DATASET
+
     # create postgres user
     echo "creating postgres user"
     useradd postgres
@@ -118,10 +121,6 @@ function common_manatee_setup {
     chown postgres $PG_DIR
     chmod 700 $PG_DIR
 
-    # make .zfs dir visible for snapshots
-    echo "make snapshot dir visible"
-    zfs set snapdir=visible $DATASET
-
     # add pg log dir
     mkdir -p $PG_LOG_DIR
     chown -R postgres $PG_LOG_DIR
-- 
2.21.0

