{"project":"joyent/manta-muskie","branch":"master","topic":"3475","id":"I60728930887445c78f466c050e4af386b039598a","number":"2872","subject":"MANTA-3475 muskie should report 503 errors when moray hits its max queue length","owner":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"url":"https://cr.joyent.us/2872","commitMessage":"MANTA-3475 muskie should report 503 errors when moray hits its max queue length\n","createdOn":1508969712,"lastUpdated":1508978025,"open":false,"status":"ABANDONED","comments":[{"timestamp":1508969712,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Uploaded patch set 1."},{"timestamp":1508969751,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1508969852,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Topic set to 3475"},{"timestamp":1508970900,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1508973387,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Uploaded patch set 2."},{"timestamp":1508973414,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1508973426,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1508973573,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1508978025,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Abandoned\n\nDid this poorly. We can just perform this translation in the JSON formatter, which performs the translation between muskie errors and http errors"}],"currentPatchSet":{"number":"2","revision":"60728930887445c78f466c050e4af386b039598a","parents":["a612da71491efd1e926b986741f30f2f2055b685"],"ref":"refs/changes/72/2872/2","uploader":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"createdOn":1508973387,"author":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1508973414,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/common.js","line":514,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"We used to pass \"req\" as a second argument to the callback.  Do we not need to?\n\nWhere\u0027s the code that actually translates this error into a status code?  Would it not be possible to translate it to ServiceUnavailableError there, instead if in a bunch of different places?"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/common.js","type":"MODIFIED","insertions":5,"deletions":0},{"file":"lib/dir.js","type":"MODIFIED","insertions":12,"deletions":0},{"file":"lib/errors.js","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"lib/jobs/create.js","type":"MODIFIED","insertions":6,"deletions":0},{"file":"lib/link.js","type":"MODIFIED","insertions":6,"deletions":0},{"file":"lib/obj.js","type":"MODIFIED","insertions":15,"deletions":0},{"file":"lib/server.js","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"lib/uploads/commit.js","type":"MODIFIED","insertions":15,"deletions":-4},{"file":"lib/uploads/common.js","type":"MODIFIED","insertions":25,"deletions":0},{"file":"lib/uploads/create.js","type":"MODIFIED","insertions":11,"deletions":0}],"sizeInsertions":107,"sizeDeletions":-7},"patchSets":[{"number":"1","revision":"45432ff60a74e8ca19c8a9d109f8be3fbaecd5dc","parents":["a612da71491efd1e926b986741f30f2f2055b685"],"ref":"refs/changes/72/2872/1","uploader":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"createdOn":1508969712,"author":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1508969751,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/obj.js","line":347,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Does this clause get hit ? That is, we only get here if VError.findCauseByName for object-not-found is non-null."},{"file":"lib/obj.js","line":347,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Ah yes thanks for catching this."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/common.js","type":"MODIFIED","insertions":5,"deletions":0},{"file":"lib/dir.js","type":"MODIFIED","insertions":12,"deletions":0},{"file":"lib/errors.js","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"lib/jobs/create.js","type":"MODIFIED","insertions":6,"deletions":0},{"file":"lib/link.js","type":"MODIFIED","insertions":6,"deletions":0},{"file":"lib/obj.js","type":"MODIFIED","insertions":17,"deletions":0},{"file":"lib/server.js","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"lib/uploads/commit.js","type":"MODIFIED","insertions":15,"deletions":-4},{"file":"lib/uploads/common.js","type":"MODIFIED","insertions":25,"deletions":0},{"file":"lib/uploads/create.js","type":"MODIFIED","insertions":11,"deletions":0}],"sizeInsertions":109,"sizeDeletions":-7},{"number":"2","revision":"60728930887445c78f466c050e4af386b039598a","parents":["a612da71491efd1e926b986741f30f2f2055b685"],"ref":"refs/changes/72/2872/2","uploader":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"createdOn":1508973387,"author":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1508973414,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/common.js","line":514,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"We used to pass \"req\" as a second argument to the callback.  Do we not need to?\n\nWhere\u0027s the code that actually translates this error into a status code?  Would it not be possible to translate it to ServiceUnavailableError there, instead if in a bunch of different places?"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/common.js","type":"MODIFIED","insertions":5,"deletions":0},{"file":"lib/dir.js","type":"MODIFIED","insertions":12,"deletions":0},{"file":"lib/errors.js","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"lib/jobs/create.js","type":"MODIFIED","insertions":6,"deletions":0},{"file":"lib/link.js","type":"MODIFIED","insertions":6,"deletions":0},{"file":"lib/obj.js","type":"MODIFIED","insertions":15,"deletions":0},{"file":"lib/server.js","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"lib/uploads/commit.js","type":"MODIFIED","insertions":15,"deletions":-4},{"file":"lib/uploads/common.js","type":"MODIFIED","insertions":25,"deletions":0},{"file":"lib/uploads/create.js","type":"MODIFIED","insertions":11,"deletions":0}],"sizeInsertions":107,"sizeDeletions":-7}],"allReviewers":[{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},{"name":"Joyent Automation","username":"joyent-automation"}]}