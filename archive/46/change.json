{"project":"joyent/illumos-joyent","branch":"master","id":"Ifbd2a8b32f0c8bf34be54f0d80445db6574a722b","number":"46","subject":"OS-5440 pfexec and the case of the missing error message Reviewed by: Joshua M. Clulow \u003cjmc@joyent.com\u003e Reviewed by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e","owner":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"url":"https://cr.joyent.us/46","commitMessage":"OS-5440 pfexec and the case of the missing error message\nReviewed by: Joshua M. Clulow \u003cjmc@joyent.com\u003e\nReviewed by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e\n","createdOn":1468016090,"lastUpdated":1468627727,"open":false,"status":"MERGED","comments":[{"timestamp":1468016090,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 1."},{"timestamp":1468016448,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 2."},{"timestamp":1468022239,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1468022250,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Patch Set 2: Code-Review-1"},{"timestamp":1468022721,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 3."},{"timestamp":1468022781,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 3:\n\n(1 comment)"},{"timestamp":1468178518,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Patch Set 3: Code-Review+1\n\nHave you tested this change with the thing that broke with the last pfexecd change?  If so, I should like to approve!"},{"timestamp":1468250901,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1468273703,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 4."},{"timestamp":1468273788,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 4:\n\n\u003e Have you tested this change with the thing that broke with the last\n \u003e pfexecd change?  If so, I should like to approve!\n\nYes, which has precipitated OS-5507 and OS-5508. I used some dtrace SDT probes to help with those, so I\u0027ve added them to the latest patchset."},{"timestamp":1468273983,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 5."},{"timestamp":1468274018,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 4:\n\nPatchset 5 is to make the names of the SDT probes more idiomatic (using __)"},{"timestamp":1468289211,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Patch Set 5:\n\n(1 comment)"},{"timestamp":1468289396,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 5: Code-Review-1\n\n(1 comment)"},{"timestamp":1468289838,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 6."},{"timestamp":1468334487,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 6: Code-Review+1\n\n(1 comment)"},{"timestamp":1468343969,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 7."},{"timestamp":1468344386,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 7: Code-Review+1"},{"timestamp":1468344920,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Patch Set 7: Code-Review+1"},{"timestamp":1468352365,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 7:\n\nI\u0027ve booted my CoaL onto an image built from this commit and had no trouble other than lots of messages from sysinfo at boot (see earlier comment and matching bugs). Manatee snapshots are working correctly (the thing that failed on JPC after the last version of OS-5440), and the new dtrace probes are functional (and I have verified using each of the arguments to them in my probes)"},{"timestamp":1468352655,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Patch Set 7:\n\n\u003e I\u0027ve booted my CoaL onto an image built from this commit and had no\n \u003e trouble other than lots of messages from sysinfo at boot (see\n \u003e earlier comment and matching bugs). Manatee snapshots are working\n \u003e correctly (the thing that failed on JPC after the last version of\n \u003e OS-5440), and the new dtrace probes are functional (and I have\n \u003e verified using each of the arguments to them in my probes)\n\nI\u0027m going to try and get MANATEE-310 today.  It\u0027d probably be best to hold off on putting this back until after that."},{"timestamp":1468627642,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 8: Patch Set 7 was rebased"},{"timestamp":1468627707,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Patch Set 8: Code-Review+2"},{"timestamp":1468627727,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Alex Wilson"}],"currentPatchSet":{"number":"8","revision":"862fc303a41b09aea047548a1d6e4482d294982e","parents":["8bac7aa9ec0b55ac4edf509a5300d3161f8b774d"],"ref":"refs/changes/46/46/8","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1468627642,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1468344386,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Code-Review","description":"Code-Review","value":"2","grantedOn":1468627707,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}},{"type":"SUBM","value":"1","grantedOn":1468627727,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/man/man1/pfexec.1","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"usr/src/uts/common/os/klpd.c","type":"MODIFIED","insertions":11,"deletions":-1}],"sizeInsertions":17,"sizeDeletions":-2},"patchSets":[{"number":"1","revision":"9abd49d437af420936a47e2dac1927842bd41191","parents":["3329e6c9dfdd34ddafb87dedcdeedb6c617e78e5"],"ref":"refs/changes/46/46/1","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1468016090,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/man/man1/pfexec.1","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"usr/src/uts/common/os/klpd.c","type":"MODIFIED","insertions":4,"deletions":-1}],"sizeInsertions":10,"sizeDeletions":-2},{"number":"2","revision":"438b09d407fe9945f0b2b9db900b4354abeac221","parents":["3329e6c9dfdd34ddafb87dedcdeedb6c617e78e5"],"ref":"refs/changes/46/46/2","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1468016448,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"-1","grantedOn":1468022250,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}}],"comments":[{"file":"usr/src/uts/common/os/klpd.c","line":866,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"I would probably try and make this shorter.  Perhaps something like:\n\n    \"pfexecd not running; pid %u privileges not elevated\"\n\nAlso, is \"pid_t\" unsigned or signed?"},{"file":"usr/src/uts/common/os/klpd.c","line":866,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"signed. zomg. fixed."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/man/man1/pfexec.1","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"usr/src/uts/common/os/klpd.c","type":"MODIFIED","insertions":5,"deletions":-1}],"sizeInsertions":11,"sizeDeletions":-2},{"number":"3","revision":"6d8cfcd0d0b448c92b357bcd8713ef81e2195511","parents":["3329e6c9dfdd34ddafb87dedcdeedb6c617e78e5"],"ref":"refs/changes/46/46/3","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1468022721,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1468178518,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1468250901,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"usr/src/man/man1/pfexec.1","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"usr/src/uts/common/os/klpd.c","type":"MODIFIED","insertions":5,"deletions":-1}],"sizeInsertions":11,"sizeDeletions":-2},{"number":"4","revision":"a845e04af1b823c9f9f35f9dce158ef94a8f28eb","parents":["0b6b2f4c8d89cfbd42ed5a584cd417e013d330e6"],"ref":"refs/changes/46/46/4","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1468273703,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/man/man1/pfexec.1","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"usr/src/uts/common/os/klpd.c","type":"MODIFIED","insertions":11,"deletions":-1}],"sizeInsertions":17,"sizeDeletions":-2},{"number":"5","revision":"4d80d76301b890a8b20b8c587694803291557077","parents":["0b6b2f4c8d89cfbd42ed5a584cd417e013d330e6"],"ref":"refs/changes/46/46/5","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1468273983,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"-1","grantedOn":1468289396,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}}],"comments":[{"file":"usr/src/uts/common/os/klpd.c","line":908,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Should you include \"dres\" in the probe arguments here?"},{"file":"usr/src/uts/common/os/klpd.c","line":908,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Oh yeah, like the most important detail in debugging this, which you couldn\u0027t get any other way easily, let\u0027s leave it out of the dtrace probe, what a great idea\n\n*slaps self*"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/man/man1/pfexec.1","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"usr/src/uts/common/os/klpd.c","type":"MODIFIED","insertions":11,"deletions":-1}],"sizeInsertions":17,"sizeDeletions":-2},{"number":"6","revision":"4cc7d4dcdd18d0dd1d18de03d696e767eaee7d98","parents":["0b6b2f4c8d89cfbd42ed5a584cd417e013d330e6"],"ref":"refs/changes/46/46/6","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1468289838,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1468334487,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"comments":[{"file":"usr/src/uts/common/os/klpd.c","line":908,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"It might be worth yielding rphp-\u003epn_path for a plain string."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/man/man1/pfexec.1","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"usr/src/uts/common/os/klpd.c","type":"MODIFIED","insertions":11,"deletions":-1}],"sizeInsertions":17,"sizeDeletions":-2},{"number":"7","revision":"fbd2a8b32f0c8bf34be54f0d80445db6574a722b","parents":["0b6b2f4c8d89cfbd42ed5a584cd417e013d330e6"],"ref":"refs/changes/46/46/7","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1468343969,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1468344920,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1468344386,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/man/man1/pfexec.1","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"usr/src/uts/common/os/klpd.c","type":"MODIFIED","insertions":11,"deletions":-1}],"sizeInsertions":17,"sizeDeletions":-2},{"number":"8","revision":"862fc303a41b09aea047548a1d6e4482d294982e","parents":["8bac7aa9ec0b55ac4edf509a5300d3161f8b774d"],"ref":"refs/changes/46/46/8","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1468627642,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"SUBM","value":"1","grantedOn":1468627727,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"Code-Review","description":"Code-Review","value":"2","grantedOn":1468627707,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1468344386,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/man/man1/pfexec.1","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"usr/src/uts/common/os/klpd.c","type":"MODIFIED","insertions":11,"deletions":-1}],"sizeInsertions":17,"sizeDeletions":-2}],"allReviewers":[{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}]}