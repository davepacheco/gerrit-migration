From d62c8a35c3d728cf72ff9439093a45e5c5efa0d0 Mon Sep 17 00:00:00 2001
From: John Levon <john.levon@joyent.com>
Date: Tue, 23 Jul 2019 16:09:18 +0000
Subject: [PATCH] OS-7790 enable smatch build for illumos-joyent (fix gcc7
 build)

---
 usr/contrib/freebsd/dev/nvme/nvme.h | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/usr/contrib/freebsd/dev/nvme/nvme.h b/usr/contrib/freebsd/dev/nvme/nvme.h
index 73d4e2d2db..c7f6496426 100644
--- a/usr/contrib/freebsd/dev/nvme/nvme.h
+++ b/usr/contrib/freebsd/dev/nvme/nvme.h
@@ -26,6 +26,8 @@
  * SUCH DAMAGE.
  *
  * $FreeBSD$
+ *
+ * Copyright 2019 Joyent, Inc.
  */
 
 #ifndef __NVME_H__
@@ -1076,7 +1078,10 @@ struct nvme_health_information_page {
 	uint8_t			reserved2[296];
 } __packed __aligned(4);
 
+/* Currently sparse/smatch incorrectly packs this struct in some situations. */
+#ifndef __CHECKER__
 _Static_assert(sizeof(struct nvme_health_information_page) == 512, "bad size for nvme_health_information_page");
+#endif
 
 struct nvme_firmware_page {
 
-- 
2.21.0

