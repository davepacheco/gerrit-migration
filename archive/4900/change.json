{"project":"joyent/gerritbot","branch":"master","id":"I7fcfd38dea87a5dddc7e97254f6753e7b3a68e0d","number":"4900","subject":"joyent/gerritbot#7 websocket connection failures lead to double-connections and sadness joyent/gerritbot#6 want status display","owner":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"url":"https://cr.joyent.us/4900","commitMessage":"joyent/gerritbot#7 websocket connection failures lead to double-connections and sadness\njoyent/gerritbot#6 want status display\n","createdOn":1538179976,"lastUpdated":1559587322,"open":false,"status":"MERGED","comments":[{"timestamp":1538179976,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 1."},{"timestamp":1538180518,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing-1\n\n(5 comments)\n\n\"make check\" exited with status 2"},{"timestamp":1538180850,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 2."},{"timestamp":1538180869,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1538181680,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 3."},{"timestamp":1538181850,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 4."},{"timestamp":1538182198,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1538182203,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing-1\n\n(1 comment)\n\n\"make check\" exited with status 2"},{"timestamp":1538681398,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Patch Set 4:\n\n(12 comments)"},{"timestamp":1559587322,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Change has been successfully pushed."}],"currentPatchSet":{"number":"3","revision":"b0fa9ca91b75b7eee7346ce5606d1bc6195e3362","parents":["920ef55334b5043762de2667c41ac6072fe1ec92"],"ref":"refs/changes/00/4900/3","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1538181680,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1538182203,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"server.js","line":235,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"\u0027formdata\u0027 is already defined"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"agent.js","type":"MODIFIED","insertions":83,"deletions":-45},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":0},{"file":"server.js","type":"MODIFIED","insertions":110,"deletions":-7},{"file":"status.html.tpl","type":"ADDED","insertions":82,"deletions":0}],"sizeInsertions":276,"sizeDeletions":-52},"patchSets":[{"number":"1","revision":"4ce4b15083e76eb06cdf5eef43a70b4f86259d3d","parents":["920ef55334b5043762de2667c41ac6072fe1ec92"],"ref":"refs/changes/00/4900/1","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1538179976,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1538180518,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"agent.js","line":96,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Missing semicolon"},{"file":"server.js","line":167,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Missing semicolon"},{"file":"server.js","line":167,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Strings must use singlequote"},{"file":"server.js","line":197,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"\u0027html\u0027 is already defined"},{"file":"server.js","line":223,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"\u0027evs\u0027 was used before it was defined"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"agent.js","type":"MODIFIED","insertions":83,"deletions":-45},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":0},{"file":"server.js","type":"MODIFIED","insertions":78,"deletions":-4},{"file":"status.html.tpl","type":"ADDED","insertions":65,"deletions":0}],"sizeInsertions":227,"sizeDeletions":-49},{"number":"2","revision":"10a29e09b03cb51c8e826b23db03a7e25786d548","parents":["920ef55334b5043762de2667c41ac6072fe1ec92"],"ref":"refs/changes/00/4900/2","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1538180850,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1538180869,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"agent.js","type":"MODIFIED","insertions":83,"deletions":-45},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":0},{"file":"server.js","type":"MODIFIED","insertions":83,"deletions":-5},{"file":"status.html.tpl","type":"ADDED","insertions":65,"deletions":0}],"sizeInsertions":232,"sizeDeletions":-50},{"number":"3","revision":"b0fa9ca91b75b7eee7346ce5606d1bc6195e3362","parents":["920ef55334b5043762de2667c41ac6072fe1ec92"],"ref":"refs/changes/00/4900/3","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1538181680,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1538182203,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"server.js","line":235,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"\u0027formdata\u0027 is already defined"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"agent.js","type":"MODIFIED","insertions":83,"deletions":-45},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":0},{"file":"server.js","type":"MODIFIED","insertions":110,"deletions":-7},{"file":"status.html.tpl","type":"ADDED","insertions":82,"deletions":0}],"sizeInsertions":276,"sizeDeletions":-52},{"number":"4","revision":"7fcfd38dea87a5dddc7e97254f6753e7b3a68e0d","parents":["920ef55334b5043762de2667c41ac6072fe1ec92"],"ref":"refs/changes/00/4900/4","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1538181850,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1538182198,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"agent.js","line":7,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"2018?"},{"file":"agent.js","line":76,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"If we get here, what happens (to the broader system)?"},{"file":"agent.js","line":88,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"It feels like we should have a max timeout of something not outrageous like 30 seconds, even if the retry count doesn\u0027t (today) cause us to hit it."},{"file":"package.json","line":15,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Apparently \"jade\" has been renamed to \"pug\" -- should we be using that instead?"},{"file":"server.js","line":154,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"This is going to throw on ENOENT."},{"file":"server.js","line":159,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Perhaps move this load inside the \"try\" block?"},{"file":"server.js","line":188,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Constrain this to \"GET\" requests perhaps?"},{"file":"server.js","line":202,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"If we get to the \"catch\" block above, this should probably be 500 instead of 200."},{"file":"server.js","line":216,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Should probably confirm that the Content-Type is \"application/x-www-form-urlencoded\" here first.\n\nAlso, it feels like this is all complicated enough that we could just use restify with the query/body parser."},{"file":"server.js","line":253,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Even if we don\u0027t switch to restify, I think most of this should at least be a common function for use here and in \"/override\" above."},{"file":"server.js","line":298,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"This looks like it could just be \".some()\" which returns a boolean I believe?"},{"file":"status.html.tpl","line":0,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Is there a reasonable place to look that describes how this language works?  There\u0027s a lot of that seems to be implicit; e.g., why does \"section\" have a period on the front?  Why does \"style\" have a period on the _end_?  It\u0027s not especially obvious from the limited documentation on http://jade-lang.com"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"agent.js","type":"MODIFIED","insertions":83,"deletions":-45},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":0},{"file":"server.js","type":"MODIFIED","insertions":111,"deletions":-7},{"file":"status.html.tpl","type":"ADDED","insertions":82,"deletions":0}],"sizeInsertions":277,"sizeDeletions":-52}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}]}