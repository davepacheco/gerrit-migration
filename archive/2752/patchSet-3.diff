commit e3671ccc7fab799ceb76a839d07de09324dd1504 (refs/changes/52/2752/3)
Author: Joshua M. Clulow <jmc@joyent.com>
Date:   2017-10-09T17:17:54+00:00 (2 years ago)
    
    TOOLS-1882 older git versions do not support recursive submodule sync
    Reviewed by: Dan McDonald <danmcd@joyent.com>
    Reviewed by: Kody A Kantor <kody.kantor@joyent.com>
    Approved by: Kody A Kantor <kody.kantor@joyent.com>

diff --git a/configure b/configure
index 424223f..9556013 100755
--- a/configure
+++ b/configure
@@ -7,7 +7,7 @@
 #
 
 #
-# Copyright (c) 2014, Joyent, Inc.
+# Copyright (c) 2017, Joyent, Inc.
 #
 
 #
@@ -57,6 +57,16 @@ else
 fi
 CURL="curl --fail --connect-timeout 10 -s"
 
+#
+# Git has not always supported the "--recursive" option to "git submodule sync".
+#
+GIT_SUBMODULE_SYNC_FLAGS=''
+if git submodule -h | grep 'git submodule .* sync .*--recursive' \
+    >/dev/null; then
+
+    GIT_SUBMODULE_SYNC_FLAGS='--recursive'
+fi
+
 
 #---- internal support functions
 
@@ -396,7 +406,7 @@ function get_repo_cache() {
     fi
     if [[ "$submodule_update" == "true" ]]; then
         (cd "$MG_CACHE_DIR/repos/$repo_dir" &&
-            git submodule sync --recursive &&
+            git submodule sync $GIT_SUBMODULE_SYNC_FLAGS &&
             git submodule update --init --recursive)
     fi
 
@@ -444,7 +454,7 @@ function get_repo2() {
     fi
     if [[ "$submodule_update" == "true" ]]; then
         (cd "build/$repo_dir" &&
-            git submodule sync --recursive &&
+            git submodule sync $GIT_SUBMODULE_SYNC_FLAGS &&
             git submodule update --init --recursive)
     fi
 }
