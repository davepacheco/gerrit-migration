From 70ad2f1db2ea94f93165b6d596e01767b82475dc Mon Sep 17 00:00:00 2001
From: "Joshua M. Clulow" <jmc@joyent.com>
Date: Mon, 9 Oct 2017 15:58:55 +0000
Subject: [PATCH] TOOLS-1882 older git versions do not support recursive
 submodule sync

---
 configure | 16 +++++++++++++---
 1 file changed, 13 insertions(+), 3 deletions(-)

diff --git a/configure b/configure
index 424223f..9556013 100755
--- a/configure
+++ b/configure
@@ -7,7 +7,7 @@
 #
 
 #
-# Copyright (c) 2014, Joyent, Inc.
+# Copyright (c) 2017, Joyent, Inc.
 #
 
 #
@@ -57,6 +57,16 @@ else
 fi
 CURL="curl --fail --connect-timeout 10 -s"
 
+#
+# Git has not always supported the "--recursive" option to "git submodule sync".
+#
+GIT_SUBMODULE_SYNC_FLAGS=''
+if git submodule -h | grep 'git submodule .* sync .*--recursive' \
+    >/dev/null; then
+
+    GIT_SUBMODULE_SYNC_FLAGS='--recursive'
+fi
+
 
 #---- internal support functions
 
@@ -396,7 +406,7 @@ function get_repo_cache() {
     fi
     if [[ "$submodule_update" == "true" ]]; then
         (cd "$MG_CACHE_DIR/repos/$repo_dir" &&
-            git submodule sync --recursive &&
+            git submodule sync $GIT_SUBMODULE_SYNC_FLAGS &&
             git submodule update --init --recursive)
     fi
 
@@ -444,7 +454,7 @@ function get_repo2() {
     fi
     if [[ "$submodule_update" == "true" ]]; then
         (cd "build/$repo_dir" &&
-            git submodule sync --recursive &&
+            git submodule sync $GIT_SUBMODULE_SYNC_FLAGS &&
             git submodule update --init --recursive)
     fi
 }
-- 
2.21.0

