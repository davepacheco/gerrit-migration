From b4581ec2177155baad63322bf1897c4487a0d06d Mon Sep 17 00:00:00 2001
From: Jan Wyszynski <jan.wyszynski@joyent.com>
Date: Mon, 21 Aug 2017 21:31:31 +0000
Subject: [PATCH] MANTA-3363 Some MPU operations don't log shard information in
 muskie audit entry

---
 lib/uploads/common.js | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/lib/uploads/common.js b/lib/uploads/common.js
index e22ca84..68da4fe 100644
--- a/lib/uploads/common.js
+++ b/lib/uploads/common.js
@@ -490,6 +490,10 @@ function loadUploadRecord(upload, cb) {
             assert.ok(wrap._etag);
             record.toSave._etag = wrap._etag;
 
+            if (wrap && wrap._node) {
+                upload.req.entryShard = wrap._node.pnode;
+            }
+
             cb(null, record.loaded.upload);
         }
     });
-- 
2.21.0

