{"project":"joyent/sdc-vmapi","branch":"master","id":"I6d10766d1bcc32aebd335f2b19388ae0916c15bb","number":"6236","subject":"TRITON-1663 vmapi can accidentally return 200 and close the connection on some validation errors (part 2, improve name of errors.*Err helper funcs) Reviewed by: Chris Burroughs \u003cchris.burroughs@joyent.com\u003e Reviewed by: Josh Wilsdon \u003cjosh@wilsdon.ca\u003e Appro","owner":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"url":"https://cr.joyent.us/6236","commitMessage":"TRITON-1663 vmapi can accidentally return 200 and close the connection on some validation errors (part 2, improve name of errors.*Err helper funcs)\nReviewed by: Chris Burroughs \u003cchris.burroughs@joyent.com\u003e\nReviewed by: Josh Wilsdon \u003cjosh@wilsdon.ca\u003e\nApproved by: Chris Burroughs \u003cchris.burroughs@joyent.com\u003e\n","createdOn":1557530598,"lastUpdated":1558047182,"open":false,"status":"MERGED","comments":[{"timestamp":1557530598,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Uploaded patch set 1."},{"timestamp":1557530600,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit 13538af53329d7f8b69ce2fdf3453fc50ace84d7\n    \n    document these helper functions, it is totally not obvious to most that this is about the JEG \u0027error handling\u0027 spec\n    \n    commit fc2b208076be31eeb76c7adbdc9e404f7e3afa9d\n    \n    part 2: improve name of these helper functions"},{"timestamp":1557530633,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1557764968,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Uploaded patch set 2."},{"timestamp":1557764970,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit b1954060e498839e97e6188406433cdc81df9e1b\n    \n    fix tests broken by part 1 commit that has already gone in"},{"timestamp":1557765003,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1558025837,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 2:\n\nChris, would you like to CR this for me? It (a) fixes that test-vmapi failure and (b) does part-2 of the changes for this ticket as described in a comment on the ticket."},{"timestamp":1558027318,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Uploaded patch set 3."},{"timestamp":1558027320,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 3:\n\nNew commits:\n    \n    commit 119a3632044aa1a6234bad1437dd789c0fe7c4e4\n    \n    get added errors.invalidParamErr usages from the last 2 commits to beat this one in\n    \n    commit 2a7083b6b8fdd085738a3c14250de0d5eb86af47\n    \n    fix tests broken by part 1 commit that has already gone in\n    \n    commit 3bb4ecf16adc408b70374112f56602361e5f49db\n    \n    document these helper functions, it is totally not obvious to most that this is about the JEG \u0027error handling\u0027 spec\n    \n    commit eacdc29ef792c84c76a41a76db6dc3da2749b7a1\n    \n    part 2: improve name of these helper functions"},{"timestamp":1558027356,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1558040660,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Patch Set 3: Code-Review+1 Integration-Approval+1"},{"timestamp":1558042721,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 3: Code-Review+1\n\n(2 comments)\n\nnot really a fan of the *ErrorsElem naming, but I guess the code looks ok."},{"timestamp":1558047153,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 3:\n\n(2 comments)\n\n\u003e not really a fan of the *ErrorsElem naming, but I guess the code looks ok.\n\nThanks for the praise!   Suggestions for other naming welcome, for now I think this naming is less potentially error prone."},{"timestamp":1558047170,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Uploaded patch set 4: Commit message was updated."},{"timestamp":1558047182,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Trent Mick"}],"currentPatchSet":{"number":"4","revision":"6d10766d1bcc32aebd335f2b19388ae0916c15bb","parents":["b507968cbbe5fb87cb2d305b77e6d9ea5ba8d48c"],"ref":"refs/changes/36/6236/4","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1558047170,"author":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1558027356,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1558040660,"by":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1558040660,"by":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1558042721,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"SUBM","value":"1","grantedOn":1558047182,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/apis/moray.js","type":"MODIFIED","insertions":10,"deletions":-9},{"file":"lib/common/validation.js","type":"MODIFIED","insertions":120,"deletions":-106},{"file":"lib/endpoints/metadata.js","type":"MODIFIED","insertions":5,"deletions":-5},{"file":"lib/endpoints/role-tags.js","type":"MODIFIED","insertions":5,"deletions":-5},{"file":"lib/endpoints/vms.js","type":"MODIFIED","insertions":63,"deletions":-52},{"file":"lib/errors.js","type":"MODIFIED","insertions":23,"deletions":-17},{"file":"test/vms.validate.test.js","type":"MODIFIED","insertions":9,"deletions":-14}],"sizeInsertions":237,"sizeDeletions":-210},"patchSets":[{"number":"1","revision":"271c4d8ed989fc3d887f4b9255b2036c7107af9a","parents":["64192456fa44660a92661766410d3ff4ed0d5480"],"ref":"refs/changes/36/6236/1","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1557530598,"author":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1557530633,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/apis/moray.js","type":"MODIFIED","insertions":10,"deletions":-9},{"file":"lib/common/validation.js","type":"MODIFIED","insertions":114,"deletions":-102},{"file":"lib/endpoints/metadata.js","type":"MODIFIED","insertions":5,"deletions":-5},{"file":"lib/endpoints/role-tags.js","type":"MODIFIED","insertions":5,"deletions":-5},{"file":"lib/endpoints/vms.js","type":"MODIFIED","insertions":62,"deletions":-51},{"file":"lib/errors.js","type":"MODIFIED","insertions":23,"deletions":-17}],"sizeInsertions":221,"sizeDeletions":-191},{"number":"2","revision":"e37a5043dcf4ee32945770efadd7f7a55bc5100d","parents":["64192456fa44660a92661766410d3ff4ed0d5480"],"ref":"refs/changes/36/6236/2","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1557764968,"author":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1557765003,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/apis/moray.js","type":"MODIFIED","insertions":10,"deletions":-9},{"file":"lib/common/validation.js","type":"MODIFIED","insertions":114,"deletions":-102},{"file":"lib/endpoints/metadata.js","type":"MODIFIED","insertions":5,"deletions":-5},{"file":"lib/endpoints/role-tags.js","type":"MODIFIED","insertions":5,"deletions":-5},{"file":"lib/endpoints/vms.js","type":"MODIFIED","insertions":62,"deletions":-51},{"file":"lib/errors.js","type":"MODIFIED","insertions":23,"deletions":-17},{"file":"test/vms.validate.test.js","type":"MODIFIED","insertions":9,"deletions":-14}],"sizeInsertions":230,"sizeDeletions":-205},{"number":"3","revision":"821c76de9485ebed7f96c56de7fa0e98528baa18","parents":["b507968cbbe5fb87cb2d305b77e6d9ea5ba8d48c"],"ref":"refs/changes/36/6236/3","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1558027318,"author":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1558027356,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1558042721,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1558040660,"by":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1558040660,"by":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"}}],"comments":[{"file":"lib/common/validation.js","line":552,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"If we\u0027re adding the {} to the conditional above, should we not do that here as well? And all the other places we\u0027ve changed conditionals here and they\u0027re lacking?"},{"file":"lib/common/validation.js","line":552,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Yes. But in another change please. IMO we should always have the braces, then no more debates. I suppose I should feel a little bad that I added the braces in the one, then not in the others when coming back for a rebase (which added the 3 extra conditionals here)."},{"file":"lib/endpoints/vms.js","line":1195,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"seems unfortunate is there a separate ticket for this?"},{"file":"lib/endpoints/vms.js","line":1195,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"I came across this when going through a rebasing. I\u0027ll open a separate ticket for it."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/apis/moray.js","type":"MODIFIED","insertions":10,"deletions":-9},{"file":"lib/common/validation.js","type":"MODIFIED","insertions":120,"deletions":-106},{"file":"lib/endpoints/metadata.js","type":"MODIFIED","insertions":5,"deletions":-5},{"file":"lib/endpoints/role-tags.js","type":"MODIFIED","insertions":5,"deletions":-5},{"file":"lib/endpoints/vms.js","type":"MODIFIED","insertions":63,"deletions":-52},{"file":"lib/errors.js","type":"MODIFIED","insertions":23,"deletions":-17},{"file":"test/vms.validate.test.js","type":"MODIFIED","insertions":9,"deletions":-14}],"sizeInsertions":237,"sizeDeletions":-210},{"number":"4","revision":"6d10766d1bcc32aebd335f2b19388ae0916c15bb","parents":["b507968cbbe5fb87cb2d305b77e6d9ea5ba8d48c"],"ref":"refs/changes/36/6236/4","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1558047170,"author":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1558027356,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"SUBM","value":"1","grantedOn":1558047182,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1558042721,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1558040660,"by":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1558040660,"by":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/apis/moray.js","type":"MODIFIED","insertions":10,"deletions":-9},{"file":"lib/common/validation.js","type":"MODIFIED","insertions":120,"deletions":-106},{"file":"lib/endpoints/metadata.js","type":"MODIFIED","insertions":5,"deletions":-5},{"file":"lib/endpoints/role-tags.js","type":"MODIFIED","insertions":5,"deletions":-5},{"file":"lib/endpoints/vms.js","type":"MODIFIED","insertions":63,"deletions":-52},{"file":"lib/errors.js","type":"MODIFIED","insertions":23,"deletions":-17},{"file":"test/vms.validate.test.js","type":"MODIFIED","insertions":9,"deletions":-14}],"sizeInsertions":237,"sizeDeletions":-210}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}]}