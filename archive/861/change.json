{"project":"joyent/illumos-joyent","branch":"master","id":"Iaefd5a8c21e439a1955ccb6b19739e9bf7e8cec3","number":"861","subject":"OS-3506 dls and mac lock ordering isn\u0027t honored Reviewed by: Robert Mustacchi \u003crm@joyent.com\u003e Reviewed by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e Approved by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e","owner":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"url":"https://cr.joyent.us/861","commitMessage":"OS-3506 dls and mac lock ordering isn\u0027t honored\nReviewed by: Robert Mustacchi \u003crm@joyent.com\u003e\nReviewed by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e\nApproved by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e\n","createdOn":1478653471,"lastUpdated":1485796827,"open":false,"status":"MERGED","comments":[{"timestamp":1478653471,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Uploaded patch set 1."},{"timestamp":1478653517,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Patch Set 1: Code-Review-1\n\nThis is not ready for official review yet."},{"timestamp":1481826118,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Uploaded patch set 2."},{"timestamp":1481827128,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Patch Set 2: -Code-Review"},{"timestamp":1481917866,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 2:\n\nIs the evaluation on the ticket still correct? I am not sure where is the call chain you take i_dls_devnet_lock before entering the mac perimeter. If that is happening and I just don\u0027t see it, would it be worth adding an ASSERT that the lock is held before you enter the perimiter?"},{"timestamp":1482168377,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Patch Set 2:\n\nJerry, did you see my last comment in the ticket (and the dtrace output in the comment before that)? dls_devnet_destroy is taking the i_dls_devnet_lock before entering the MAC perim, but everything else expects the order to be MAC -\u003e DLS. \n\nI\u0027m not sure where we would add the assert. There is no common function for grabbing the internal DLS lock and even if there was I\u0027m not sure it\u0027s always true that if you are grabbing DLS you must be in the MAC perim."},{"timestamp":1482189338,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 2:\n\nRyan, I did see your comment and that is what is confusing me. The first sentence says: \"...I have come to the opposite conclusion of Robert\u0027s initial analysis: i.e., that the typical order should be to grab the i_dls_devnet_lock and then enter the MAC perimeter.\" You then go on to discuss different ordering, but this is a long comment and I am unclear on what the final conclusion is, since some of these sentences seem contradictory, or perhaps I am not seeing the definitive statement of what the ordering should be. Maybe you could add one short comment stating the correct ordering."},{"timestamp":1482189484,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 2:\n\nI think perhaps I am misinterpreting your comment and that in the first sentence you meant to summarize Robert\u0027s conclusion and not your own. If that is what you meant, sorry that I have misunderstood."},{"timestamp":1482189769,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Patch Set 2:\n\nJerry. Yea, sorry, that first paragraph could be more clear.\n\nI start by restating Robert\u0027s original assessment: that it should be DLS -\u003e MAC. I then state that it should actually be MAC -\u003e DLS, and go into various reasons why it should be in that order.\n\nDoes that clear it up?"},{"timestamp":1482189908,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 2: Code-Review+1\n\nRyan, yes, thanks, sorry for the confusion."},{"timestamp":1482770237,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 2: Code-Review+1"},{"timestamp":1484985294,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Uploaded patch set 3."},{"timestamp":1484985618,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Uploaded patch set 4."},{"timestamp":1484986475,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Patch Set 4:\n\nAfter my initial fix in patch sets 1 \u0026 2 I uncovered another deadlock which I fixed in patch sets 3 \u0026 4. The deadlock scenario is this:\n\n1. dls_devnet_destroy() enters the mac perim and calls dls_devnet_unset() with wait \u003d B_TRUE (to wait for all temporary references).\n\n2. dladm, or some other consumer, calls drv_ioc_prop_common() or drv_ioc_attr() which first grab a dls tref (dls_devnet_hold_tmp()) and then tries to enter the mac perim.\n\nThis causes deadlock because the owner of the mac perim is waiting for all trefs to be released but the holder of the tref is waiting for the mac perim to do its work.\n\nI fixed this by switching the order (and you\u0027ll see the same order in the mac_flow code)."},{"timestamp":1484986782,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Uploaded patch set 5."},{"timestamp":1485119243,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 5:\n\n(1 comment)"},{"timestamp":1485191460,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Patch Set 5:\n\n(1 comment)"},{"timestamp":1485263756,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 5: Code-Review+1\n\nI agree on the comment Robert asked for, but since was there previously I think the rest looks fine."},{"timestamp":1485272638,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Patch Set 5:\n\n(1 comment)"},{"timestamp":1485272954,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 5:\n\n(1 comment)"},{"timestamp":1485277160,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Uploaded patch set 6."},{"timestamp":1485296805,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 6:\n\n(1 comment)"},{"timestamp":1485299065,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Uploaded patch set 7."},{"timestamp":1485302647,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 7: Code-Review+1"},{"timestamp":1485471827,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 7:\n\n(1 comment)"},{"timestamp":1485472889,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Patch Set 7:\n\n(1 comment)"},{"timestamp":1485474015,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 7:\n\n(1 comment)"},{"timestamp":1485474517,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Uploaded patch set 8."},{"timestamp":1485475105,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 8: Code-Review+1"},{"timestamp":1485548021,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 8: Code-Review+1"},{"timestamp":1485580690,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Patch Set 8:\n\nTesting notes:\n\nThe short of it: I ran a mass zone start/stop along with a dladm stress script which produced deadlocks on the current PI but didn\u0027t on my patched PI. I am confident that these changes are an improvement on the existing code and should greatly reduce if not completely eliminate our \"Manta has stuck zones\" issue.\n\nI merged the OS-3506, OS-5363 and OS-5919 patches into one branch and tested them as a single unit (though I think they should be pushed separate so that the patches can be easily differentiated during code archeology). But before I tested my patches I first made sure I could replicate the bugs on the existing PI (20161222T003450Z). The zone lock file was actually doing it\u0027s job and preventing the concurrency needed to induce the deadlock; but if you induce enough load there is a provision in the lock file code to force drop the lock after 60s of waiting and give it to a new owner, thus allowing concurrent access when there should be none. So I just modified the zone lock logic to immediately drop the lock after acquiring it to fake this 60s timeout and allow more concurrency. Sure enough after making this change I was able to easily replicate several occurrences of the OS-3506 deadlock. I was never able to replicate OS-5363, probably because it\u0027s a trickier three-way deadlock and is hard to hit before hitting OS-3506. After a few days of chasing OS-5363 I gave up and ran my tests on my patched PI. I found a new deadlock introduced by my fix in OS-3506 but then I found a way to fix that deadlock without reintroducing the original one. After that modification I was able to run my stress test many times with no deadlock. With enough dladm load and concurrent zone shutdowns I can induce some EBUSY failures but the zones can eventually be stopped with \"vmadm stop -f\" when needed. Since this is not a deadlock I consider it out of scope for this ticket and is something we should potentially improve under another ticket. So what was my actual test? Here is the rundown:\n\n* Create 121 native zones. There is noting special about 121, I actually meant to do 120 but had an off-by-one error.\n\n* Write a script to loop through all zones and either start or stop them depending on a) if the zone was even or odd and b) the argument to the script. I would type \"./dlt-test ping\" and that would start half and stop half; then I would type \"./dlt-test pong\" and that would stop the half that was previously started and start the other half. Each start/stop command was run as a background process. Between every 9 operations there was a sleep for 1 second as an attempt to get more concurrency between start/stop operations (the stop op is quicker than start).\n\n* I would run the above script a few times as an initial test to make sure mass start/stop didn\u0027t cause an issue. If it passed this test I added dladm load.\n\n* I created another script to generate dladm load. I would do a dladm show-link, show-vnic, and show-phys in a for loop, typically 8 times, and run each command as a background process. This for loop was then put in a while true loop where it slept 1 second between each for loop. So each second 24 dladm commands were generated.\n\n* My main stress test was to run the mass start/stop script and the dladm load script concurrently. I would let the dladm script run in the background while I continuously ran the dlt-test ping/pong stages. I would first wait for each stage to finish by looking on pgrep \u0027^zoneadm$\u0027 and waiting for all requests to finish. This stress test not only generated plenty of deadlocks but also locked up my machine at least 7 times -- so it was definitely stressing the system.\n\n* On some tests I also added various dtrace probes to dlmgmtd/dls/mac just to slow things down even more and try to induce more unique concurrent executions."},{"timestamp":1485789610,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 8: Integration-Approval+1"},{"timestamp":1485796396,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Uploaded patch set 9: Patch Set 8 was rebased."},{"timestamp":1485796515,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Uploaded patch set 10: Commit message was updated."},{"timestamp":1485796827,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Ryan Zezeski"}],"currentPatchSet":{"number":"10","revision":"aefd5a8c21e439a1955ccb6b19739e9bf7e8cec3","parents":["65823f66c8745c2c8da123b632a68cabacd94799"],"ref":"refs/changes/61/861/10","uploader":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"createdOn":1485796515,"author":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1485475105,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1485548021,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1485789610,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"SUBM","value":"1","grantedOn":1485796827,"by":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/uts/common/io/dld/dld_drv.c","type":"MODIFIED","insertions":8,"deletions":-21},{"file":"usr/src/uts/common/io/dls/dls_mgmt.c","type":"MODIFIED","insertions":44,"deletions":-6},{"file":"usr/src/uts/common/io/mac/mac.c","type":"MODIFIED","insertions":3,"deletions":-3}],"sizeInsertions":55,"sizeDeletions":-30},"patchSets":[{"number":"1","revision":"49cbfff127ecafc58e5d94686e893f2ae60a9667","parents":["6dc43d4776202e8cb24b5027cfeceed1106af8f2"],"ref":"refs/changes/61/861/1","uploader":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"createdOn":1478653471,"author":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"-1","grantedOn":1478653517,"by":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/io/dls/dls_mgmt.c","type":"MODIFIED","insertions":14,"deletions":-3}],"sizeInsertions":14,"sizeDeletions":-3},{"number":"2","revision":"af8c94c7e3c1f535efaf123317425eebc638b6e7","parents":["6dec4b8146b2d4a9b4bc5b69d92611009b363154"],"ref":"refs/changes/61/861/2","uploader":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"createdOn":1481826118,"author":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1482770237,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1482189908,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/io/dls/dls_mgmt.c","type":"MODIFIED","insertions":9,"deletions":-5}],"sizeInsertions":9,"sizeDeletions":-5},{"number":"3","revision":"3aabd883e43302927883ef8a1bf16332b763fa77","parents":["39356c1d4443c2428f28abe318c71c6ebb2ed256"],"ref":"refs/changes/61/861/3","uploader":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"createdOn":1484985294,"author":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/io/dld/dld_drv.c","type":"MODIFIED","insertions":8,"deletions":-21},{"file":"usr/src/uts/common/io/dls/dls_mgmt.c","type":"MODIFIED","insertions":9,"deletions":-5}],"sizeInsertions":17,"sizeDeletions":-26},{"number":"4","revision":"ad7936718c7587c664e5d65d87d10535fee7d6b3","parents":["39356c1d4443c2428f28abe318c71c6ebb2ed256"],"ref":"refs/changes/61/861/4","uploader":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"createdOn":1484985618,"author":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/io/dld/dld_drv.c","type":"MODIFIED","insertions":8,"deletions":-21},{"file":"usr/src/uts/common/io/dls/dls_mgmt.c","type":"MODIFIED","insertions":9,"deletions":-5}],"sizeInsertions":17,"sizeDeletions":-26},{"number":"5","revision":"fd8f54916fb6b5d85e4a97144b5b80f875a55b8d","parents":["39356c1d4443c2428f28abe318c71c6ebb2ed256"],"ref":"refs/changes/61/861/5","uploader":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"createdOn":1484986782,"author":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1485263756,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"comments":[{"file":"usr/src/uts/common/io/dls/dls_mgmt.c","line":1861,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Can you explain why we carry on in the face of ENOENT here? This is probably worth a comment."},{"file":"usr/src/uts/common/io/dls/dls_mgmt.c","line":1861,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"I\u0027m not sure but the code was this way before I made my changes. I did a quick look and nothing stuck out (perhaps because it was outside of the mac perim?). I\u0027ll give it a closer look later when I have the time."},{"file":"usr/src/uts/common/io/dls/dls_mgmt.c","line":1861,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"I believe the ENOENT case is here because the deletion of the devnet\nhash entry and DLS link hash entry are not atomic and there exist a\ncase where the devnet hash entry may be removed while the DLS link\nhash entry still exists.\n\nE.g., the dls_devnet_unset() returns success but\ndls_link_rele_by_name() fails with ENOTEMTPY indicating the mac still\nhas flows. This will cause err to be non-zero and dls_devnet_destroy()\nto call dls_devnet_set() (to recreate the devnet entry) but then that\ncall could fail for several reasons and we may have a situation where\nthe devnet hash entry doesn\u0027t exist but the DLS link hash entry does.\nThis problem could be avoided if we called mac_disable() before\ndls_devnet_destroy() (in vnic_dev_delete()) because it would verify\nthere are no flows earlier but that can\u0027t happen because of a long\noutstanding bug (OpenSolaris 6791335).\n\nShall I proceed with writing up a comment?"},{"file":"usr/src/uts/common/io/dls/dls_mgmt.c","line":1861,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Ryan, yes, I think capturing this info in the code would be great."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/io/dld/dld_drv.c","type":"MODIFIED","insertions":8,"deletions":-21},{"file":"usr/src/uts/common/io/dls/dls_mgmt.c","type":"MODIFIED","insertions":9,"deletions":-5},{"file":"usr/src/uts/common/io/mac/mac.c","type":"MODIFIED","insertions":3,"deletions":-3}],"sizeInsertions":20,"sizeDeletions":-29},{"number":"6","revision":"9cfa204c46ee8cc946560181b545775c47af2351","parents":["39356c1d4443c2428f28abe318c71c6ebb2ed256"],"ref":"refs/changes/61/861/6","uploader":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"createdOn":1485277160,"author":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/uts/common/io/dls/dls_mgmt.c","line":1889,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Referencing bugs like this in comments is usually not a good idea. For example, there are a lot of references to bugs which are no longer visible because Oracle closed their bugtracker. I don\u0027t mind seeing the bugid but it would be nice to summarize the bug so this has meaning in this context."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/io/dld/dld_drv.c","type":"MODIFIED","insertions":8,"deletions":-21},{"file":"usr/src/uts/common/io/dls/dls_mgmt.c","type":"MODIFIED","insertions":40,"deletions":-6},{"file":"usr/src/uts/common/io/mac/mac.c","type":"MODIFIED","insertions":3,"deletions":-3}],"sizeInsertions":51,"sizeDeletions":-30},{"number":"7","revision":"d8979539633ff638c20bb3325d35358b559dad86","parents":["39356c1d4443c2428f28abe318c71c6ebb2ed256"],"ref":"refs/changes/61/861/7","uploader":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"createdOn":1485299065,"author":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1485302647,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"comments":[{"file":"usr/src/uts/common/io/dls/dls_mgmt.c","line":1870,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"It looks like there was supposed to be more to this sentence."},{"file":"usr/src/uts/common/io/dls/dls_mgmt.c","line":1870,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Nope, that\u0027s the entire phrase. The comma is there to demarcate number 3 (just like I did between number 1 \u0026 2). But it should be \"exist\" instead of \"exists\". If you want I could also add \"because flows still exist on the mac\", that might make it more clear?"},{"file":"usr/src/uts/common/io/dls/dls_mgmt.c","line":1870,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I think changing it to the singular will at least make it seem complete. I\u0027ll admit the comma threw me off initially, but I guess it\u0027s just trying to join the numbered parts. Not something I\u0027m used to seeing, but seems fine."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/io/dld/dld_drv.c","type":"MODIFIED","insertions":8,"deletions":-21},{"file":"usr/src/uts/common/io/dls/dls_mgmt.c","type":"MODIFIED","insertions":44,"deletions":-6},{"file":"usr/src/uts/common/io/mac/mac.c","type":"MODIFIED","insertions":3,"deletions":-3}],"sizeInsertions":55,"sizeDeletions":-30},{"number":"8","revision":"fbb70d586fd2c2f5db9795ebf2b07ebc20489f9a","parents":["39356c1d4443c2428f28abe318c71c6ebb2ed256"],"ref":"refs/changes/61/861/8","uploader":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"createdOn":1485474517,"author":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1485548021,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1485475105,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1485789610,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/io/dld/dld_drv.c","type":"MODIFIED","insertions":8,"deletions":-21},{"file":"usr/src/uts/common/io/dls/dls_mgmt.c","type":"MODIFIED","insertions":44,"deletions":-6},{"file":"usr/src/uts/common/io/mac/mac.c","type":"MODIFIED","insertions":3,"deletions":-3}],"sizeInsertions":55,"sizeDeletions":-30},{"number":"9","revision":"9cecb23b5a9200f111449fe8dc0033bcad0048df","parents":["65823f66c8745c2c8da123b632a68cabacd94799"],"ref":"refs/changes/61/861/9","uploader":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"createdOn":1485796396,"author":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1485548021,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1485475105,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1485789610,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/io/dld/dld_drv.c","type":"MODIFIED","insertions":8,"deletions":-21},{"file":"usr/src/uts/common/io/dls/dls_mgmt.c","type":"MODIFIED","insertions":44,"deletions":-6},{"file":"usr/src/uts/common/io/mac/mac.c","type":"MODIFIED","insertions":3,"deletions":-3}],"sizeInsertions":55,"sizeDeletions":-30},{"number":"10","revision":"aefd5a8c21e439a1955ccb6b19739e9bf7e8cec3","parents":["65823f66c8745c2c8da123b632a68cabacd94799"],"ref":"refs/changes/61/861/10","uploader":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"createdOn":1485796515,"author":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1485548021,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1485475105,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1485789610,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"SUBM","value":"1","grantedOn":1485796827,"by":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/uts/common/io/dld/dld_drv.c","type":"MODIFIED","insertions":8,"deletions":-21},{"file":"usr/src/uts/common/io/dls/dls_mgmt.c","type":"MODIFIED","insertions":44,"deletions":-6},{"file":"usr/src/uts/common/io/mac/mac.c","type":"MODIFIED","insertions":3,"deletions":-3}],"sizeInsertions":55,"sizeDeletions":-30}],"allReviewers":[{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}]}