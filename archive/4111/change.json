{"project":"joyent/moray","branch":"master","topic":"MORAY-418","id":"I89b0a67d084475e530b734496bc9e1638d8f8ddc","number":"4111","subject":"MORAY-418 Moray should queue requests when new PG connections fail MORAY-339 Moray needs to use exponential backoff when connecting to Postgres MORAY-294 Suspect Moray doesn\u0027t honor its connection limit properly MORAY-427 Moray queuing needs work Co-Autho","owner":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"url":"https://cr.joyent.us/4111","commitMessage":"MORAY-418 Moray should queue requests when new PG connections fail\nMORAY-339 Moray needs to use exponential backoff when connecting to Postgres\nMORAY-294 Suspect Moray doesn\u0027t honor its connection limit properly\nMORAY-427 Moray queuing needs work\nCo-Author: Tim Kordas \u003ctim.kordas@joyent.com\u003e\nReviewed by: Jan Wyszynski \u003cjan.wyszynski@joyent.com\u003e\nReviewed by: Kody Kantor \u003ckody.kantor@joyent.com\u003e\nApproved by: Kody Kantor \u003ckody.kantor@joyent.com\u003e\n","createdOn":1527880347,"lastUpdated":1529543150,"open":false,"status":"MERGED","comments":[{"timestamp":1527880347,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 1."},{"timestamp":1527880402,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1527897140,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 2."},{"timestamp":1527897192,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1528150398,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 3."},{"timestamp":1528150446,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1528214941,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 3:\n\n(8 comments)\n\nGreat! Looks good."},{"timestamp":1528398093,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 4: Patch Set 3 was rebased."},{"timestamp":1528401386,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Patch Set 4:\n\n(2 comments)"},{"timestamp":1528844370,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 5."},{"timestamp":1528844420,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1528902475,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 5: Code-Review+1\n\nLooks good. If you want me to look at the cueball \u0027pool-stats\u0027 CR too, feel free to add me to it."},{"timestamp":1528928560,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 6."},{"timestamp":1528928609,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 6: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1528929280,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 6:\n\n(9 comments)"},{"timestamp":1528930179,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 6:\n\nI\u0027ve updated bin/moraystat.d to use a newly added probe, since the node-pooling probes will no longer be present."},{"timestamp":1528987164,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 6: Code-Review+1\n\n(3 comments)"},{"timestamp":1529031801,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 7."},{"timestamp":1529031826,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 7:\n\n(1 comment)"},{"timestamp":1529031850,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 7: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1529088720,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Patch Set 7: Code-Review+1"},{"timestamp":1529333144,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 7: Code-Review+1\n\nI\u0027ll take a look at this for IA too. Thanks Cody!"},{"timestamp":1529521432,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 8."},{"timestamp":1529521480,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 9: Commit message was updated."},{"timestamp":1529521488,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 8: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1529526952,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Patch Set 9: Code-Review+1\n\nThis looks good to me, thank you for adding the comment about the totalConnections/pendingConnections gap."},{"timestamp":1529527052,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 9: Code-Review+1"},{"timestamp":1529531212,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 9: Integration-Approval+1"},{"timestamp":1529542595,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Topic set to MORAY-418"},{"timestamp":1529543150,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Cody Peter Mello"}],"currentPatchSet":{"number":"9","revision":"89b0a67d084475e530b734496bc9e1638d8f8ddc","parents":["16b90a46e3938e544077b489e4dff00201a7a484"],"ref":"refs/changes/11/4111/9","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1529521480,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1529526952,"by":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1529527052,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1529531212,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}},{"type":"SUBM","value":"1","grantedOn":1529543150,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":14,"deletions":0},{"file":"bin/moraystat.d","type":"MODIFIED","insertions":13,"deletions":-21},{"file":"lib/dtrace.js","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"lib/manatee.js","type":"DELETED","insertions":0,"deletions":-276},{"file":"lib/pg.js","type":"MODIFIED","insertions":250,"deletions":-143},{"file":"lib/schema.js","type":"MODIFIED","insertions":20,"deletions":-3},{"file":"lib/server.js","type":"MODIFIED","insertions":49,"deletions":-28},{"file":"lib/standalone.js","type":"DELETED","insertions":0,"deletions":-218},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"sapi_manifests/moray/template","type":"MODIFIED","insertions":3,"deletions":0}],"sizeInsertions":341,"sizeDeletions":-692},"patchSets":[{"number":"1","revision":"3fd74ffe5596090d2263c21ae218b1f13d49b2af","parents":["c8867955e0858e3d121e6f0f78b31bc94d98c6bf"],"ref":"refs/changes/11/4111/1","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1527880347,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1527880402,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"lib/manatee.js","type":"DELETED","insertions":0,"deletions":-276},{"file":"lib/pg.js","type":"MODIFIED","insertions":220,"deletions":-116},{"file":"lib/schema.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/server.js","type":"MODIFIED","insertions":38,"deletions":-27},{"file":"lib/standalone.js","type":"DELETED","insertions":0,"deletions":-218},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"sapi_manifests/moray/template","type":"MODIFIED","insertions":3,"deletions":0}],"sizeInsertions":265,"sizeDeletions":-639},{"number":"2","revision":"7c55fb9340bbeb661d9b78693b3f2eda1f9b11a7","parents":["c8867955e0858e3d121e6f0f78b31bc94d98c6bf"],"ref":"refs/changes/11/4111/2","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1527897140,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1527897192,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"lib/manatee.js","type":"DELETED","insertions":0,"deletions":-276},{"file":"lib/pg.js","type":"MODIFIED","insertions":214,"deletions":-133},{"file":"lib/schema.js","type":"MODIFIED","insertions":20,"deletions":-3},{"file":"lib/server.js","type":"MODIFIED","insertions":38,"deletions":-27},{"file":"lib/standalone.js","type":"DELETED","insertions":0,"deletions":-218},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"sapi_manifests/moray/template","type":"MODIFIED","insertions":3,"deletions":0}],"sizeInsertions":277,"sizeDeletions":-659},{"number":"3","revision":"134d7cdc89bdff134e82c2c2fb2cb5afb0b9dd63","parents":["f19a8c6c4ead3cf31a4fb1a6b4f59925caf60d14"],"ref":"refs/changes/11/4111/3","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1528150398,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1528150446,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/pg.js","line":39,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"I see that we\u0027ve always taken the moray db name from an environment variable instead of the config file. It\u0027s a little annoying that this looks to be the only field we take from the environment instead of the config file. You don\u0027t have to change this, I\u0027m just pointing it out."},{"file":"lib/pg.js","line":68,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Should there be parentheses around the return value? It looks like it passed \u0027make check\u0027, so maybe not."},{"file":"lib/pg.js","line":68,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Moray doesn\u0027t require that style, although it is used in several functions."},{"file":"lib/pg.js","line":540,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Would it be useful to log the backend\u0027s user/address/dbname too?"},{"file":"lib/pg.js","line":540,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Done."},{"file":"lib/pg.js","line":546,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"When we terminate the connection this way, I think the result is an unexpected termination from node-postgres\u0027 perspective (https://github.com/brianc/node-postgres/blob/v6.2.4/lib/client.js#L224), which causes it to emit another \u0027error\u0027 event on top of the one we may have already received (provided that it was received while the client was connecting). Is this why we handle the pg.Client \u0027error\u0027 event once (on L553 below)? \n\nIt feels a little weird to me that we\u0027re reaching into members of the client object to close the connection, but maybe this is the best way to do it. The alternative I see is calling .end()?"},{"file":"lib/pg.js","line":546,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"This is what we currently do:\n\nhttps://github.com/joyent/moray/blob/16b90a46e3938e544077b489e4dff00201a7a484/lib/pg.js#L481-L487\n\nI agree that reaching into the object here is not great, and liable to breakage on update of \"pg\". We should probably investigate if this is really needed in the future, but it seems that destroying the connection here has been fine so far."},{"file":"lib/pg.js","line":636,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"It looks like a couple things aren\u0027t asserted (targetClaimDelay, minSpareConnections)"},{"file":"lib/pg.js","line":636,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Done"},{"file":"lib/pg.js","line":694,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"FWIW I\u0027ve found it useful to fill this in with the address or hostname used for the backend. Cueball still uses this field for logging, so it can be helpful to have a real value in the logs.\n\nThis isn\u0027t exactly possible here, but maybe we could put something else in (shard name?). It\u0027s totally not critical since we probably already know the shard name when we\u0027re looking at the log file."},{"file":"lib/pg.js","line":694,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Done"},{"file":"lib/pg.js","line":710,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"The maxDelay and maxTimeout values seem a little high to me. I would suggest at least halving these, but maybe I\u0027m not understanding why they have their current values."},{"file":"lib/pg.js","line":710,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Lowering these would mean that when Manatee goes away the pool would fail sooner, and claims would get PoolFailedErrors until a connection succeeds. I\u0027m not sure which is best here: rejecting RPCs quickly so that everything fails more quickly upstack, or holding onto the claims until they timeout, in case a connection succeeds and we can serve it. Thoughts?"},{"file":"lib/pg.js","line":710,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"I guess my bias is to fail the requests sooner.\n\nI\u0027m just imagining a situation where the queue piles up with work that\u0027s waiting on connections that won\u0027t succeed. Then new work comes in that _would_ succeed (because manatee came back) but it has to wait behind the existing requests (because they\u0027re waiting up to 30 seconds to retry). I don\u0027t think this is as much of a risk with cueball (vs node-pooling) though, so having large timeouts might be totally fine."},{"file":"lib/pg.js","line":760,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Can we have a comment explaining the \u0027\u003d\u003d\u0027 case? Or maybe a pointer to the docs."},{"file":"lib/pg.js","line":760,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Done"},{"file":"lib/server.js","line":8,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Could update copyright"},{"file":"lib/server.js","line":8,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Done"},{"file":"lib/server.js","line":93,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"It\u0027s a little confusing that these look like real values but will be ignored, but it\u0027s not a big deal."},{"file":"lib/server.js","line":93,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"I\u0027ve added an explanatory comment here. Let me know if it need more detail."},{"file":"lib/server.js","line":93,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Looks good!"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"lib/manatee.js","type":"DELETED","insertions":0,"deletions":-276},{"file":"lib/pg.js","type":"MODIFIED","insertions":212,"deletions":-133},{"file":"lib/schema.js","type":"MODIFIED","insertions":20,"deletions":-3},{"file":"lib/server.js","type":"MODIFIED","insertions":38,"deletions":-27},{"file":"lib/standalone.js","type":"DELETED","insertions":0,"deletions":-218},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"sapi_manifests/moray/template","type":"MODIFIED","insertions":3,"deletions":0}],"sizeInsertions":275,"sizeDeletions":-659},{"number":"4","revision":"19ce4501d0b1ffde1ea60a8dcaa7f69006ef83c5","parents":["16b90a46e3938e544077b489e4dff00201a7a484"],"ref":"refs/changes/11/4111/4","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1528398093,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"NO_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1528150446,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"lib/manatee.js","type":"DELETED","insertions":0,"deletions":-276},{"file":"lib/pg.js","type":"MODIFIED","insertions":212,"deletions":-133},{"file":"lib/schema.js","type":"MODIFIED","insertions":20,"deletions":-3},{"file":"lib/server.js","type":"MODIFIED","insertions":38,"deletions":-27},{"file":"lib/standalone.js","type":"DELETED","insertions":0,"deletions":-218},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"sapi_manifests/moray/template","type":"MODIFIED","insertions":3,"deletions":0}],"sizeInsertions":275,"sizeDeletions":-659},{"number":"5","revision":"3d52011f7c0ce70cf066544e232a3454a32ec49e","parents":["16b90a46e3938e544077b489e4dff00201a7a484"],"ref":"refs/changes/11/4111/5","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1528844370,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1528844420,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1528902475,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"lib/manatee.js","type":"DELETED","insertions":0,"deletions":-276},{"file":"lib/pg.js","type":"MODIFIED","insertions":227,"deletions":-143},{"file":"lib/schema.js","type":"MODIFIED","insertions":20,"deletions":-3},{"file":"lib/server.js","type":"MODIFIED","insertions":49,"deletions":-28},{"file":"lib/standalone.js","type":"DELETED","insertions":0,"deletions":-218},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"sapi_manifests/moray/template","type":"MODIFIED","insertions":3,"deletions":0}],"sizeInsertions":301,"sizeDeletions":-670},{"number":"6","revision":"3aca7e0235ca5d2a176370b04108ca1ead4f4481","parents":["16b90a46e3938e544077b489e4dff00201a7a484"],"ref":"refs/changes/11/4111/6","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1528928560,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1528928609,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1528987164,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}}],"comments":[{"file":"lib/dtrace.js","line":8,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"copyright could be updated"},{"file":"lib/dtrace.js","line":8,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"bin/moraystat.d","type":"MODIFIED","insertions":4,"deletions":-21},{"file":"lib/dtrace.js","type":"MODIFIED","insertions":3,"deletions":0},{"file":"lib/manatee.js","type":"DELETED","insertions":0,"deletions":-276},{"file":"lib/pg.js","type":"MODIFIED","insertions":242,"deletions":-143},{"file":"lib/schema.js","type":"MODIFIED","insertions":20,"deletions":-3},{"file":"lib/server.js","type":"MODIFIED","insertions":49,"deletions":-28},{"file":"lib/standalone.js","type":"DELETED","insertions":0,"deletions":-218},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"sapi_manifests/moray/template","type":"MODIFIED","insertions":3,"deletions":0}],"sizeInsertions":323,"sizeDeletions":-691},{"number":"7","revision":"1230c10ec05aa24a54d7d9d0dd19659814aa0ca7","parents":["16b90a46e3938e544077b489e4dff00201a7a484"],"ref":"refs/changes/11/4111/7","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1529031801,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1529031850,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1529333144,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1529088720,"by":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":13,"deletions":0},{"file":"bin/moraystat.d","type":"MODIFIED","insertions":13,"deletions":-21},{"file":"lib/dtrace.js","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"lib/manatee.js","type":"DELETED","insertions":0,"deletions":-276},{"file":"lib/pg.js","type":"MODIFIED","insertions":242,"deletions":-143},{"file":"lib/schema.js","type":"MODIFIED","insertions":20,"deletions":-3},{"file":"lib/server.js","type":"MODIFIED","insertions":49,"deletions":-28},{"file":"lib/standalone.js","type":"DELETED","insertions":0,"deletions":-218},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"sapi_manifests/moray/template","type":"MODIFIED","insertions":3,"deletions":0}],"sizeInsertions":333,"sizeDeletions":-692},{"number":"8","revision":"7edb6f7c7c91c5dd9f2548377550dfe9ae1ad668","parents":["16b90a46e3938e544077b489e4dff00201a7a484"],"ref":"refs/changes/11/4111/8","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1529521432,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1529521488,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":13,"deletions":0},{"file":"bin/moraystat.d","type":"MODIFIED","insertions":13,"deletions":-21},{"file":"lib/dtrace.js","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"lib/manatee.js","type":"DELETED","insertions":0,"deletions":-276},{"file":"lib/pg.js","type":"MODIFIED","insertions":250,"deletions":-143},{"file":"lib/schema.js","type":"MODIFIED","insertions":20,"deletions":-3},{"file":"lib/server.js","type":"MODIFIED","insertions":49,"deletions":-28},{"file":"lib/standalone.js","type":"DELETED","insertions":0,"deletions":-218},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"sapi_manifests/moray/template","type":"MODIFIED","insertions":3,"deletions":0}],"sizeInsertions":341,"sizeDeletions":-692},{"number":"9","revision":"89b0a67d084475e530b734496bc9e1638d8f8ddc","parents":["16b90a46e3938e544077b489e4dff00201a7a484"],"ref":"refs/changes/11/4111/9","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1529521480,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"SUBM","value":"1","grantedOn":1529543150,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1529527052,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1529531212,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1529526952,"by":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":14,"deletions":0},{"file":"bin/moraystat.d","type":"MODIFIED","insertions":13,"deletions":-21},{"file":"lib/dtrace.js","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"lib/manatee.js","type":"DELETED","insertions":0,"deletions":-276},{"file":"lib/pg.js","type":"MODIFIED","insertions":250,"deletions":-143},{"file":"lib/schema.js","type":"MODIFIED","insertions":20,"deletions":-3},{"file":"lib/server.js","type":"MODIFIED","insertions":49,"deletions":-28},{"file":"lib/standalone.js","type":"DELETED","insertions":0,"deletions":-218},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"sapi_manifests/moray/template","type":"MODIFIED","insertions":3,"deletions":0}],"sizeInsertions":341,"sizeDeletions":-692}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}]}