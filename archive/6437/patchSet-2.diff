From ea6a287ea9c27a1d3066bf1c2957b5526ff11923 Mon Sep 17 00:00:00 2001
From: Orlando Vazquez <ovazquez@gmail.com>
Date: Thu, 13 Jun 2019 09:27:49 -0700
Subject: [PATCH] SWSUP-1216 Package resize from portal, CLI, and admin-ui
 ignoring package traits.

---
 lib/machines.js | 6 ++++++
 package.json    | 2 +-
 2 files changed, 7 insertions(+), 1 deletion(-)

diff --git a/lib/machines.js b/lib/machines.js
index 72aacf2..3b82b4a 100644
--- a/lib/machines.js
+++ b/lib/machines.js
@@ -2136,6 +2136,12 @@ function resize(req, res, next) {
                     pkgRam, imgReq.max_ram));
     }
 
+
+    if (!jsprim.deepEqual(req.pkg.traits, req.machine.package.traits)) {
+        return next(new InvalidArgumentError(
+            'Resizing to package with differing traits not supported'));
+    }
+
     var callback = updateCallback(req, res, next),
         params = {
             uuid: req.params.machine,
diff --git a/package.json b/package.json
index 4c9a230..f7abc45 100644
--- a/package.json
+++ b/package.json
@@ -1,7 +1,7 @@
 {
     "name": "cloudapi",
     "description": "Triton CloudAPI",
-    "version": "9.6.0",
+    "version": "9.7.1",
     "author": "Joyent (joyent.com)",
     "private": true,
     "engines": {
-- 
2.21.0

