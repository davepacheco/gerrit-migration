From b13adc15a6ae99d8920e7dd3a836419d7b8f72cf Mon Sep 17 00:00:00 2001
From: Orlando Vazquez <ovazquez@gmail.com>
Date: Fri, 21 Jun 2019 15:50:28 -0700
Subject: [PATCH] =?UTF-8?q?SWSUP-1216=20Package=20resize=20from=20portal,?=
 =?UTF-8?q?=20CLI,=20and=20admin-ui=20ignoring=20package=20traits.=20Revie?=
 =?UTF-8?q?wed=20by:=20Pedro=20Palaz=C3=B3n=20Candel=20<pedro@joyent.com>?=
 =?UTF-8?q?=20Approved=20by:=20Pedro=20Palaz=C3=B3n=20Candel=20<pedro@joye?=
 =?UTF-8?q?nt.com>?=
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

---
 lib/machines.js | 6 ++++++
 package.json    | 2 +-
 2 files changed, 7 insertions(+), 1 deletion(-)

diff --git a/lib/machines.js b/lib/machines.js
index 8cb4bb8..d18832a 100644
--- a/lib/machines.js
+++ b/lib/machines.js
@@ -2134,6 +2134,12 @@ function resize(req, res, next) {
                     pkgRam, imgReq.max_ram));
     }
 
+
+    if (!jsprim.deepEqual(req.pkg.traits, req.machine.package.traits)) {
+        return next(new InvalidArgumentError(
+            'Resizing to package with differing traits not supported'));
+    }
+
     var callback = updateCallback(req, res, next),
         params = {
             uuid: req.params.machine,
diff --git a/package.json b/package.json
index 4c9a230..f7abc45 100644
--- a/package.json
+++ b/package.json
@@ -1,7 +1,7 @@
 {
     "name": "cloudapi",
     "description": "Triton CloudAPI",
-    "version": "9.6.0",
+    "version": "9.7.1",
     "author": "Joyent (joyent.com)",
     "private": true,
     "engines": {
-- 
2.21.0

