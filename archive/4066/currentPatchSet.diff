From 01d84c23b10012b19b7275fc592453220547ad37 Mon Sep 17 00:00:00 2001
From: Trent Mick <trentm@gmail.com>
Date: Thu, 31 May 2018 15:09:58 -0700
Subject: [PATCH] TRITON-457 sdc-scripts update in TRITON-380 broke cns and
 sdc-manatee Reviewed by: Josh Wilsdon <josh@wilsdon.ca> Approved by: Josh
 Wilsdon <josh@wilsdon.ca>

---
 boot/setup.sh    | 12 +++++-------
 deps/sdc-scripts |  2 +-
 2 files changed, 6 insertions(+), 8 deletions(-)

diff --git a/boot/setup.sh b/boot/setup.sh
index 276563e..49b403a 100755
--- a/boot/setup.sh
+++ b/boot/setup.sh
@@ -7,7 +7,7 @@
 #
 
 #
-# Copyright (c) 2014, Joyent, Inc.
+# Copyright (c) 2018, Joyent, Inc.
 #
 
 export PS4='[\D{%FT%TZ}] ${BASH_SOURCE}:${LINENO}: ${FUNCNAME[0]:+${FUNCNAME[0]}(): }'
@@ -60,8 +60,6 @@ function sdc_manatee_setup {
     # rotate pgdump logs
     sdc_log_rotation_add pgdump /var/log/manatee/pgdump.log 1g
 
-    sdc_log_rotation_setup_end
-
     common_manatee_setup
 
     common_enable_services
@@ -183,6 +181,10 @@ CONFIG_AGENT_LOCAL_MANIFESTS_DIRS=/opt/smartdc/$role
 source /opt/smartdc/boot/lib/util.sh
 sdc_common_setup
 
+# Do the SDC-specific manatee stuff.
+sdc_manatee_setup
+add_manatee_profile_functions
+
 # add log rotation
 sdc_log_rotation_add manatee-sitter /var/svc/log/*manatee-sitter*.log 1g
 sdc_log_rotation_add manatee-snapshotter /var/svc/log/*manatee-snapshotter*.log 1g
@@ -190,10 +192,6 @@ sdc_log_rotation_add manatee-backupserver /var/svc/log/*manatee-backupserver*.lo
 sdc_log_rotation_add manatee-postgres /var/pg/postgresql.log 1g
 sdc_log_rotation_setup_end
 
-# Do the SDC-specific manatee stuff.
-sdc_manatee_setup
-add_manatee_profile_functions
-
 # All done, run boilerplate end-of-setup
 sdc_setup_complete
 
diff --git a/deps/sdc-scripts b/deps/sdc-scripts
index 6bfa4a2..deefaef 160000
--- a/deps/sdc-scripts
+++ b/deps/sdc-scripts
@@ -1 +1 @@
-Subproject commit 6bfa4a298d753685c6e083d10b70b5abdc39f66f
+Subproject commit deefaef587ed3bee2706cb6e53ee3468e682932e
-- 
2.21.0

