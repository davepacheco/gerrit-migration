{"project":"joyent/illumos-joyent","branch":"master","id":"I16d1a54ce8901bd60aed9a1ec2217832ed696481","number":"2141","subject":"OS-6202 fdisk -l core dumps in CentOS 7 Reviewed by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e Approved by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e","owner":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"url":"https://cr.joyent.us/2141","commitMessage":"OS-6202 fdisk -l core dumps in CentOS 7\nReviewed by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e\nApproved by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e\n","createdOn":1498219485,"lastUpdated":1498234708,"open":false,"status":"MERGED","comments":[{"timestamp":1498219485,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 1."},{"timestamp":1498223177,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 1:\n\n(4 comments)"},{"timestamp":1498226223,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 1:\n\n(4 comments)"},{"timestamp":1498226245,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 2."},{"timestamp":1498233577,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 2: Code-Review+1"},{"timestamp":1498234508,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 2:\n\nRunning \u0027fdisk -l\u0027 on centos 7 no longer core dumps. I also added ioctl tests for /dev/zfs into the vdisk test in lx-tests. Those pass. I also wrote a little test program and ran it to verify the correct size and blocksize for /dev/zfs, based on the dataset quota."},{"timestamp":1498234574,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 2: Integration-Approval+1"},{"timestamp":1498234694,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 3: Commit message was updated."},{"timestamp":1498234708,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Jerry Jelinek"}],"currentPatchSet":{"number":"3","revision":"16d1a54ce8901bd60aed9a1ec2217832ed696481","parents":["c94ca3d49b9a7d5d1c8f4ec4898f969d57366fae"],"ref":"refs/changes/41/2141/3","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1498234694,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1498233577,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1498234574,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"SUBM","value":"1","grantedOn":1498234708,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/uts/common/brand/lx/syscall/lx_ioctl.c","type":"MODIFIED","insertions":55,"deletions":-21}],"sizeInsertions":55,"sizeDeletions":-21},"patchSets":[{"number":"1","revision":"18110dcce67dd6877b46e02e37618e85f629935f","parents":["c94ca3d49b9a7d5d1c8f4ec4898f969d57366fae"],"ref":"refs/changes/41/2141/1","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1498219485,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/uts/common/brand/lx/syscall/lx_ioctl.c","line":598,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"append comma"},{"file":"usr/src/uts/common/brand/lx/syscall/lx_ioctl.c","line":598,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"done"},{"file":"usr/src/uts/common/brand/lx/syscall/lx_ioctl.c","line":607,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Would it make sense to lookup the zfs major at some point during startup to compare as well, or is this enough for adequate accuracy?"},{"file":"usr/src/uts/common/brand/lx/syscall/lx_ioctl.c","line":607,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"That is already done in all of the callers of this function. That is how they determine this function should be called in the first place."},{"file":"usr/src/uts/common/brand/lx/syscall/lx_ioctl.c","line":612,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Perhaps use curzone-\u003ezone_rootvp here, rather than doing the lookup?"},{"file":"usr/src/uts/common/brand/lx/syscall/lx_ioctl.c","line":612,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Good suggestion, done."},{"file":"usr/src/uts/common/brand/lx/syscall/lx_ioctl.c","line":621,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Should we be using f_frsize here instead?"},{"file":"usr/src/uts/common/brand/lx/syscall/lx_ioctl.c","line":621,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Since this all a lie, I was thinking it was unnecessary, but I have gone ahead and done that anyway."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/brand/lx/syscall/lx_ioctl.c","type":"MODIFIED","insertions":58,"deletions":-21}],"sizeInsertions":58,"sizeDeletions":-21},{"number":"2","revision":"1df799ba4ce8cf76e93f048944095381003384df","parents":["c94ca3d49b9a7d5d1c8f4ec4898f969d57366fae"],"ref":"refs/changes/41/2141/2","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1498226245,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1498233577,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1498234574,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/brand/lx/syscall/lx_ioctl.c","type":"MODIFIED","insertions":55,"deletions":-21}],"sizeInsertions":55,"sizeDeletions":-21},{"number":"3","revision":"16d1a54ce8901bd60aed9a1ec2217832ed696481","parents":["c94ca3d49b9a7d5d1c8f4ec4898f969d57366fae"],"ref":"refs/changes/41/2141/3","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1498234694,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"SUBM","value":"1","grantedOn":1498234708,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1498233577,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1498234574,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/uts/common/brand/lx/syscall/lx_ioctl.c","type":"MODIFIED","insertions":55,"deletions":-21}],"sizeInsertions":55,"sizeDeletions":-21}],"allReviewers":[{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}]}