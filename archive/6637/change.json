{"project":"joyent/illumos-joyent","branch":"master","id":"Iec6335ff2d187135730376f34f2fe1cae4189572","number":"6637","subject":"OS-7899 LX handing of SO_REUSEADDR needs to be closer to Linux Reviewed by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e Reviewed by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e Approved by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e","owner":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"url":"https://cr.joyent.us/6637","commitMessage":"OS-7899 LX handing of SO_REUSEADDR needs to be closer to Linux\nReviewed by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e\nReviewed by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e\nApproved by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e\n","createdOn":1563907322,"lastUpdated":1564609379,"open":false,"status":"MERGED","comments":[{"timestamp":1563907322,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Uploaded patch set 1."},{"timestamp":1564007954,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 1:\n\nSmoke-tested using newer program put in bug report."},{"timestamp":1564071286,"reviewer":{"name":"Jorge Schrauwen","email":"sjorge@blackdot.be","username":"sjorge"},"message":"Patch Set 1:\n\nI was building a fresh PI today and I included your patches, I know plex uses SO_REUSEADDR too. Still working fine with this patch."},{"timestamp":1564072955,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 1:\n\n@mk has performed further testing, now documented in the bug report too."},{"timestamp":1564081420,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 1: Code-Review+1\n\n(1 comment)\n\nJust one comment nit which you can feel free to ignore if you like."},{"timestamp":1564083120,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1564084202,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 1:\n\n(3 comments)"},{"timestamp":1564084361,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1564084421,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1564087569,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Uploaded patch set 2."},{"timestamp":1564087690,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 2:\n\nI\u0027m going to need to test on both real Linux on here combinations of SO_REUSE{PORT,ADDR} to see if my state-table behaves correctly, or is even SPECIFIED correctly vs. real Linux behavior."},{"timestamp":1564089316,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 2: Code-Review+1"},{"timestamp":1564443287,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Uploaded patch set 3: Patch Set 2 was rebased."},{"timestamp":1564443361,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 3:\n\nFurther testing included in the bug report.  I\u0027m now happy with the testing, and would appreciate output inspections if people have cycles."},{"timestamp":1564596569,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Uploaded patch set 4: Patch Set 3 was rebased."},{"timestamp":1564604613,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 4:\n\n(2 comments)"},{"timestamp":1564604905,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 4:\n\n(2 comments)\n\nWill fix."},{"timestamp":1564605097,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Uploaded patch set 5."},{"timestamp":1564606632,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 5: Code-Review+1"},{"timestamp":1564609177,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 5: Code-Review+1 Integration-Approval+1"},{"timestamp":1564609362,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Uploaded patch set 6: Commit message was updated."},{"timestamp":1564609379,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Dan McDonald"}],"currentPatchSet":{"number":"6","revision":"ec6335ff2d187135730376f34f2fe1cae4189572","parents":["25bc4d84f6e57bd873e9b5135cd49fc329aa0876"],"ref":"refs/changes/37/6637/6","uploader":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"createdOn":1564609362,"author":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1564606632,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1564609177,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1564609177,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"SUBM","value":"1","grantedOn":1564609379,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/uts/common/brand/lx/syscall/lx_socket.c","type":"MODIFIED","insertions":227,"deletions":-5}],"sizeInsertions":227,"sizeDeletions":-5},"patchSets":[{"number":"1","revision":"dcaab7c63cd79c4a095866efa4ae42a1e300139f","parents":["c69b5d8dd030b09837cba039acde55abedd6f408"],"ref":"refs/changes/37/6637/1","uploader":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"createdOn":1563907322,"author":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1564081420,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"comments":[{"file":"usr/src/uts/common/brand/lx/syscall/lx_socket.c","line":3030,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Note to self: \"that set\". Thanks @MK."},{"file":"usr/src/uts/common/brand/lx/syscall/lx_socket.c","line":3050,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"This should be NO."},{"file":"usr/src/uts/common/brand/lx/syscall/lx_socket.c","line":3050,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Well actually, it should be still YES.  Sorry about that."},{"file":"usr/src/uts/common/brand/lx/syscall/lx_socket.c","line":3076,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"You\u0027re missing this case altogether."},{"file":"usr/src/uts/common/brand/lx/syscall/lx_socket.c","line":3165,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Missing case above should go here.  Basically set error to 0 if disabling an enabled REUSEPORT but REUSEADDR is also set."},{"file":"usr/src/uts/common/brand/lx/syscall/lx_socket.c","line":3210,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"This comment seems odd to me, since presumably most of the time it won\u0027t be an error at all for the explicit REUSEPORT, but simply the normal exit path. However, all of the other comments are excellent. It\u0027s up to you if you want to leave this as-is."},{"file":"usr/src/uts/common/brand/lx/syscall/lx_socket.c","line":3210,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Will fix."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/brand/lx/syscall/lx_socket.c","type":"MODIFIED","insertions":216,"deletions":-5}],"sizeInsertions":216,"sizeDeletions":-5},{"number":"2","revision":"7699336d84ef9bdee215bc30c1e9cf0e2c72e05f","parents":["cc6c88bea3292da402331c560e619ecaaef8e669"],"ref":"refs/changes/37/6637/2","uploader":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"createdOn":1564087569,"author":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1564089316,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/brand/lx/syscall/lx_socket.c","type":"MODIFIED","insertions":227,"deletions":-5}],"sizeInsertions":227,"sizeDeletions":-5},{"number":"3","revision":"3e3eb81b550f6d5ba097c7069a99f0b86caaef25","parents":["6f421ca6ecc53bb3a0db68f7360f6f7e826350e6"],"ref":"refs/changes/37/6637/3","uploader":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"createdOn":1564443287,"author":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1564089316,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/brand/lx/syscall/lx_socket.c","type":"MODIFIED","insertions":227,"deletions":-5}],"sizeInsertions":227,"sizeDeletions":-5},{"number":"4","revision":"62eae0b39b152b82b1789e001aa0d780ba5014a5","parents":["25bc4d84f6e57bd873e9b5135cd49fc329aa0876"],"ref":"refs/changes/37/6637/4","uploader":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"createdOn":1564596569,"author":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1564089316,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"comments":[{"file":"usr/src/uts/common/brand/lx/syscall/lx_socket.c","line":3033,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Seems like kind of a run-on.  Is it missing some punctuation or additional words?"},{"file":"usr/src/uts/common/brand/lx/syscall/lx_socket.c","line":3033,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Eeesh, yeah, needs editing."},{"file":"usr/src/uts/common/brand/lx/syscall/lx_socket.c","line":3035,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"REUSEPORT?"},{"file":"usr/src/uts/common/brand/lx/syscall/lx_socket.c","line":3035,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Yes."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/brand/lx/syscall/lx_socket.c","type":"MODIFIED","insertions":227,"deletions":-5}],"sizeInsertions":227,"sizeDeletions":-5},{"number":"5","revision":"7d5b997671e0b99b5760e5040fde6d83d902266f","parents":["25bc4d84f6e57bd873e9b5135cd49fc329aa0876"],"ref":"refs/changes/37/6637/5","uploader":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"createdOn":1564605097,"author":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1564609177,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1564609177,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1564606632,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/brand/lx/syscall/lx_socket.c","type":"MODIFIED","insertions":227,"deletions":-5}],"sizeInsertions":227,"sizeDeletions":-5},{"number":"6","revision":"ec6335ff2d187135730376f34f2fe1cae4189572","parents":["25bc4d84f6e57bd873e9b5135cd49fc329aa0876"],"ref":"refs/changes/37/6637/6","uploader":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"createdOn":1564609362,"author":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1564609177,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1564609177,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1564606632,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"SUBM","value":"1","grantedOn":1564609379,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/uts/common/brand/lx/syscall/lx_socket.c","type":"MODIFIED","insertions":227,"deletions":-5}],"sizeInsertions":227,"sizeDeletions":-5}],"allReviewers":[{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},{"name":"Jorge Schrauwen","email":"sjorge@blackdot.be","username":"sjorge"},{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"}]}