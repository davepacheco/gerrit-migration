{"project":"joyent/node-libmanta","branch":"master","id":"I2ab2c0c7596ac003e2169b634924784b8f6a268a","number":"4230","subject":"MANTA-3764 Create manta_fastdelete_queue bucket in moray for fast GC","owner":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"url":"https://cr.joyent.us/4230","commitMessage":"MANTA-3764 Create manta_fastdelete_queue bucket in moray for fast GC\n","createdOn":1529072885,"lastUpdated":1532380106,"open":false,"status":"MERGED","comments":[{"timestamp":1529072885,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"Uploaded patch set 1."},{"timestamp":1529072911,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1529076088,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1529082582,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1529084327,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"Uploaded patch set 2."},{"timestamp":1529084352,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1529342433,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Patch Set 2: Code-Review+1\n\nI think this basically does what we need it to do."},{"timestamp":1531947316,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Patch Set 2: Integration-Approval+1"},{"timestamp":1532380106,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Jared Morrow"}],"currentPatchSet":{"number":"2","revision":"2ab2c0c7596ac003e2169b634924784b8f6a268a","parents":["f5a457f684fe3ef41354975864757260270fa22a"],"ref":"refs/changes/30/4230/2","uploader":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"createdOn":1529084327,"author":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1529084352,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1529342433,"by":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1531947316,"by":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"}},{"type":"SUBM","value":"1","grantedOn":1532380106,"by":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/moray.js","type":"MODIFIED","insertions":13,"deletions":0}],"sizeInsertions":13,"sizeDeletions":0},"patchSets":[{"number":"1","revision":"e02a294c5d7cea0dcf17652417cc7d1ac3169955","parents":["f5a457f684fe3ef41354975864757260270fa22a"],"ref":"refs/changes/30/4230/1","uploader":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"createdOn":1529072885,"author":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1529072911,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/moray.js","line":75,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"I think this will created a separate column with for the objectId with an \u0027manta_objectid_idx\u0027 just like the one for the manta_delete_log. From the discussion yesterday I thought we\u0027d decided to omit this and store the object id in the _key column of the table (which is created by default - https://github.com/joyent/moray/blob/master/lib/buckets/creat.js#L170), but I could be wrong. \n\nIf we did want to omit this we could get rid of FASTDELETE_QUEUE_SCHEMA altogether and just not pass anything in the \u0027index\u0027 field in \u0027setupMantaBuckets\u0027 below (or pass an empty object -- which should have the same effect). \n\nLet me know if I am misunderstanding something."},{"file":"lib/moray.js","line":75,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"You are understanding correctly.  I knew from our conversation we just wanted to use the _key as the index and not have a separate field.  I looked through some of the moray code and couldn\u0027t figure out how to specify it.  So it seems like I just leave *everything* out of this and we end up with a pretty empty bucket.  It just seemed so wrong to not pass anything in I suppose!"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/moray.js","type":"MODIFIED","insertions":19,"deletions":0}],"sizeInsertions":19,"sizeDeletions":0},{"number":"2","revision":"2ab2c0c7596ac003e2169b634924784b8f6a268a","parents":["f5a457f684fe3ef41354975864757260270fa22a"],"ref":"refs/changes/30/4230/2","uploader":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"createdOn":1529084327,"author":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1529084352,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"SUBM","value":"1","grantedOn":1532380106,"by":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1529342433,"by":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1531947316,"by":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/moray.js","type":"MODIFIED","insertions":13,"deletions":0}],"sizeInsertions":13,"sizeDeletions":0}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"}]}