{"project":"joyent/sdc-cn-agent","branch":"master","id":"I95ca9d0386500f97e939fbe8167ad1236426e556","number":"5732","subject":"TRITON-897 RFD 34 Triton instance migration Reviewed by: Orlando Vazquez \u003corlando@joyent.com\u003e Approved by: Orlando Vazquez \u003corlando@joyent.com\u003e","owner":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"url":"https://cr.joyent.us/5732","commitMessage":"TRITON-897 RFD 34 Triton instance migration\nReviewed by: Orlando Vazquez \u003corlando@joyent.com\u003e\nApproved by: Orlando Vazquez \u003corlando@joyent.com\u003e\n","createdOn":1551981209,"lastUpdated":1554749461,"open":false,"status":"MERGED","comments":[{"timestamp":1551981209,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Uploaded patch set 1."},{"timestamp":1551981210,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit 49491667c3f9c45c7c67f0d5d65ce1af3599030d\n    \n    allow passing of an \u0027include_dni\u0027 parameter\n    \n    commit 757034160679a23e1ebff90df28b9047d9c2a0ee\n    \n    allow for overiding the target vm uuid in setupFilesystem\n    \n    commit 7a134f748d516a95f64e5494d959b427a857bab4\n    \n    when mounting, use the zfs_dataset from the vm object\n    \n    commit a5269387ed9328a56f20ba9abe5cef969764bad7\n    \n    round the progress entry numbers\n    \n    commit d01199a0a08ba5c2647a6c9186a593476d7d444c\n    \n    sync replication for docker needs to sync from the origin dataset\n    \n    commit 8a24ec55964f2bc718d65b3eeb7f874fe051693e\n    \n    update progress events - add transfer speed and eta estimate\n    \n    commit 5c55cf9e8f88a5a953a6cd427d4e0ded3882af6d\n    \n    update sync stop/abort handling\n    \n    commit 1fa176eea3f85eff2281d27968c6891cd25e3669\n    \n    add check against proc pid number\n    \n    commit 8ce74c51c28d7e9157733d28ca6015f36fc99220\n    \n    update estimate for a resuming incremental send\n    \n    commit e7473167b27ba3382969ba502074ffe3f4df9ee1\n    \n    remove ppid, use the vm_uuid as a script marker\n    \n    commit 6e5d27f18b36ddcbbd974661dfa2cb7718eebc81\n    \n    provide alternative method to find the zfs send size, used to resume\n    \n    commit c4875f1fba6a56f0faaa0e5c297478f94844f815\n    \n    add migration estimate support\n    \n    commit fc2b353633d27ca54dcb1d30e99b418bfb3aee3d\n    \n    correct snapshot handling for bhyve and kvm zones\n    \n    commit 56b18b6eaf193c644f08640e41c4d5ee7a4d212e\n    \n    remove final sync snapshots on switch success\n    \n    commit ad13d397473bbd8318fd0fae1238d7cb6a97c720\n    \n    wrap sync handlers in a once handler\n    \n    commit a4c01186f1999aa17d282ba5cb6a274b4af66638\n    \n    remove unneeded sync snapshots after a successful sync\n    \n    commit 3c43b45c0d58ef2cf0e8b8af97246b5a40e91840\n    \n    make the sync snapshot name handling more strict\n    \n    commit 2b2e03cec413c70c2d404af3035cb38699e769d8\n    \n    Only sync the zfs_filesystem disks for KVM\n    \n    commit 38412e9cba79d4d57c92cf14cd874aaf32bf6851\n    \n    force rollback of the receiving filesystem, in case of outside changes\n    \n    commit 77d4422bb69a9dd48db57c6cff0945db8a6232ce\n    \n    handle KVM disks, cleanup target socket connection when done\n    \n    commit d5a8a416e2f046e42539cef54c980fc13cb177ad\n    \n    use the migrate task for receiving, drop migrate-receive task\n    \n    commit ba904de13aa9d2b0479d42f8dcb28a7daa84d462\n    \n    add migration switch helper functions\n    \n    commit 99e35c9e011f2c23c561264154f57a376b65927f\n    \n    get snapshots from target first, use it to determine what to do\n    \n    commit 4638cc54120a2f67c844cb6a8372b7ebe593eafd\n    \n    load target snapshot names to avoid case where a snapshot already exists\n    \n    commit f0c8d53aa3cb0e7f5f1b396ff36bff11731c5eb9\n    \n    implement migration sync send/receive workers\n    \n    commit 13b0a8632fa8611330b9a2c58b0c2d22d97efe24\n    \n    use env.logtimestamp in log name\n    \n    commit 3aa40482ca85524013d2fc7cdfbf41d5977d1368\n    \n    TRITON-897 RFD 34 Triton instance migration"},{"timestamp":1553117696,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Patch Set 1:\n\n(31 comments)\n\nFirst cut of feedback..."},{"timestamp":1553281223,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Patch Set 1:\n\n(31 comments)"},{"timestamp":1553538690,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Uploaded patch set 2."},{"timestamp":1553538691,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit a61af17251e47bc495e24da5f9008a412f9758c3\n    \n    bump version\n    \n    commit 558552300319e6fee02e7f14b68634cf4d0caa05\n    \n    add asserts for function arguments\n    \n    commit 1c984197944d5e118f0f1264db45f5e50f353f4f\n    \n    increase the child_process.execFile maxBuffer size\n    \n    commit 8b45fed1ebf5216048089b0e15bf2692ac9a3dbb\n    \n    increase the child_process.execFile maxBuffer size\n    \n    commit 71f9b0cf5f512b7adc098ca017c4afe5cb488cc7\n    \n    the include_dni parameter coming from CNAPI is a boolean\n    \n    commit e3849e00c13edea7a6f3fae78f7c20ac6ab3f169\n    \n    allow passing of an \u0027include_dni\u0027 parameter\n    \n    commit 87de81c69eb9a909615c2f290fafaaf3d4571391\n    \n    allow for overiding the target vm uuid in setupFilesystem\n    \n    commit c22680e078984d45eed152a1aa2d63c9a61e876d\n    \n    when mounting, use the zfs_dataset from the vm object\n    \n    commit a3b9b12bcfa1680416210b6b50cf571790db988e\n    \n    round the progress entry numbers\n    \n    commit 2b43c53e2fdaa348e77b5bbf6f9b40009d137b76\n    \n    sync replication for docker needs to sync from the origin dataset\n    \n    commit 88912a1b1b30b0047df6e6e23d562e95394ee427\n    \n    update progress events - add transfer speed and eta estimate\n    \n    commit 16d57d04dc4898b28d3cb7f76dcfe1f5c4e4c455\n    \n    update sync stop/abort handling\n    \n    commit 8bbfaa2929f4d45e48c35b539e4fdd0a30b3834f\n    \n    add check against proc pid number\n    \n    commit 404e9c709a25a3112c18b110cafacd72fbaab667\n    \n    update estimate for a resuming incremental send\n    \n    commit 95ec4abe5d37c543f5b5db914ab1a9258564f917\n    \n    remove ppid, use the vm_uuid as a script marker\n    \n    commit a7d1707f0e1b94b1d105c31eea4cd6b0e12647ba\n    \n    provide alternative method to find the zfs send size, used to resume\n    \n    commit 6dad223f1a1f38299e3924c8baabca9c313d517a\n    \n    add migration estimate support\n    \n    commit cff758f00255d66674972988367b20d6510fef91\n    \n    correct snapshot handling for bhyve and kvm zones\n    \n    commit 66b7be44e5dc95cf4e804534b9e8c4de2a039fea\n    \n    remove final sync snapshots on switch success\n    \n    commit 23cec19554e808154b41f3397dfcd58f636d272a\n    \n    wrap sync handlers in a once handler\n    \n    commit 4aa401115cf5150d246fae52987c643e7fea898d\n    \n    remove unneeded sync snapshots after a successful sync\n    \n    commit 59505f12606ec1627a46348c1ad1c733f05eaf28\n    \n    make the sync snapshot name handling more strict\n    \n    commit 529c45d044f61f601d22b3126a1501bc4336b7dd\n    \n    Only sync the zfs_filesystem disks for KVM\n    \n    commit a06003bef0e5bc3731a467422587a02f781095ad\n    \n    force rollback of the receiving filesystem, in case of outside changes\n    \n    commit 554673e6c85b921b6d7ab881a95da30b6a4c1ca8\n    \n    handle KVM disks, cleanup target socket connection when done\n    \n    commit 321d4ddfa64487d0e5cbeb431c2b6ffb54fe9c29\n    \n    use the migrate task for receiving, drop migrate-receive task\n    \n    commit dc1466bd93e953e447ff114344208fa31bb25eb4\n    \n    add migration switch helper functions\n    \n    commit 1fd2c9a82fe2619c96c73cd5de2752f5a4c9a27d\n    \n    get snapshots from target first, use it to determine what to do\n    \n    commit d00c64a80e40f12d9edbc59454206e9e47875150\n    \n    load target snapshot names to avoid case where a snapshot already exists\n    \n    commit b14baa8cf0a15f9f5c1db3dd4c02b0b7b0030fdb\n    \n    implement migration sync send/receive workers\n    \n    commit 51ee88747854b798fb49cf0ca647d6c7c56361ea\n    \n    use env.logtimestamp in log name\n    \n    commit cd5889dc0414ce811a09b0a1ed50bb49f6764797\n    \n    TRITON-897 RFD 34 Triton instance migration"},{"timestamp":1553618811,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Uploaded patch set 3."},{"timestamp":1553618812,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Patch Set 3:\n\nNew commits:\n    \n    commit 7f4fcd069d6d74e8a3bc2888f69c98183ce29111\n    \n    allow include_dni option to be a string or a boolean"},{"timestamp":1553818765,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Patch Set 3: Code-Review+1 Integration-Approval+1"},{"timestamp":1554491911,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Uploaded patch set 4."},{"timestamp":1554491913,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Patch Set 4:\n\nNew commits:\n    \n    commit 11fb3dc15c44517b676effe82154398feecda378\n    \n    bump version\n    \n    commit 5ebe2fddef262e6d0cd08ec35c26b7e4c6f617fc\n    \n    allow include_dni option to be a string or a boolean\n    \n    commit dd5089754d066afed13762725c9d317edb508ff3\n    \n    add asserts for function arguments\n    \n    commit a0dbe316f7b1e0185a0090829a694737c2dcc09b\n    \n    increase the child_process.execFile maxBuffer size\n    \n    commit fafe02d3a5100fa0d8e624d6603ead1f5ce6fdcd\n    \n    increase the child_process.execFile maxBuffer size\n    \n    commit b0b845b2a2ce831a68965177d7bfd40e4dd2b816\n    \n    the include_dni parameter coming from CNAPI is a boolean\n    \n    commit 8865ffcd0c3e03919211579889913fbd113247be\n    \n    allow passing of an \u0027include_dni\u0027 parameter\n    \n    commit 4daca659083158fb6470727cf61a0ae37cd43412\n    \n    allow for overiding the target vm uuid in setupFilesystem\n    \n    commit 2ba47a8bdb74781205a521b7786dd5b391b5ffd4\n    \n    when mounting, use the zfs_dataset from the vm object\n    \n    commit 526d2e154e0fc7df38306f3e73c19d70872b21bb\n    \n    round the progress entry numbers\n    \n    commit 6d3b8c10086341560bb635add624ab344d221e64\n    \n    sync replication for docker needs to sync from the origin dataset\n    \n    commit eca503d6b0883f80b18f47c047460d28ae1581ab\n    \n    update progress events - add transfer speed and eta estimate\n    \n    commit 5f612b51f1709b03d018d61d11b43f63a163000f\n    \n    update sync stop/abort handling\n    \n    commit bc26cff4c29d82583de4e50a592032de21bb782d\n    \n    add check against proc pid number\n    \n    commit ab0623111590dd60e81700e90b13b45877909a23\n    \n    update estimate for a resuming incremental send\n    \n    commit 48b0890fd0d7bd1be44015944c2157dd197c50d9\n    \n    remove ppid, use the vm_uuid as a script marker\n    \n    commit 314b0edd1b17faa4e346c985a736a97580cf2530\n    \n    provide alternative method to find the zfs send size, used to resume\n    \n    commit 569813339fc87c5492979023418073526ee18d8c\n    \n    add migration estimate support\n    \n    commit 01fdcc5e4dbcde89884329aea76183078531456b\n    \n    correct snapshot handling for bhyve and kvm zones\n    \n    commit fba1fdc8ba960d257159aa99716520e41bfad003\n    \n    remove final sync snapshots on switch success\n    \n    commit 082762d5483b2b4719ba895941e16eaa52064d5e\n    \n    wrap sync handlers in a once handler\n    \n    commit b04671e604c2060d87394921d85cdf0a545fd844\n    \n    remove unneeded sync snapshots after a successful sync\n    \n    commit 08eb2fb6200d81cc327927787613e47f66a7fe99\n    \n    make the sync snapshot name handling more strict\n    \n    commit 59ca60232afba3a2f139456c43710cc340d8fa6e\n    \n    Only sync the zfs_filesystem disks for KVM\n    \n    commit 0b00022db2cc8d7f30f0782ebc66c26019bd2726\n    \n    force rollback of the receiving filesystem, in case of outside changes\n    \n    commit 89019e8a0b673325e905179e48ad811d4ccaaa58\n    \n    handle KVM disks, cleanup target socket connection when done\n    \n    commit 7120f3d019c529ffbbfba5078c42a2bc8e462a0c\n    \n    use the migrate task for receiving, drop migrate-receive task\n    \n    commit 0790a74e4713bd15508b269f3caa03878c182b8c\n    \n    add migration switch helper functions\n    \n    commit 2231d197a804c2acd9cfa3bc863126466db1e7c5\n    \n    get snapshots from target first, use it to determine what to do\n    \n    commit b9304304a95e52f42949a5e4805c0d47d87dc660\n    \n    load target snapshot names to avoid case where a snapshot already exists\n    \n    commit 7f616ae22f91e278e8f98c571ce4fefe73237155\n    \n    implement migration sync send/receive workers\n    \n    commit c446359afcdb6d9b5d90542dc291fbf8967df016\n    \n    use env.logtimestamp in log name\n    \n    commit 2a8cee8ec820be7e626ddf95ff4728ec2e11d47b\n    \n    TRITON-897 RFD 34 Triton instance migration"},{"timestamp":1554494235,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Patch Set 4: Code-Review+1 Integration-Approval+1"},{"timestamp":1554749461,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Todd Whiteman"}],"currentPatchSet":{"number":"4","revision":"95ca9d0386500f97e939fbe8167ad1236426e556","parents":["d200e87d961401a335cd48bb8e1c2be715e783b9"],"ref":"refs/changes/32/5732/4","uploader":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"createdOn":1554491911,"author":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1554494235,"by":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1554494235,"by":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"}},{"type":"SUBM","value":"1","grantedOn":1554749461,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/backends/smartos/bin/machine-migrate-receive.js","type":"ADDED","insertions":804,"deletions":0},{"file":"lib/backends/smartos/bin/machine-migrate-send.js","type":"ADDED","insertions":1686,"deletions":0},{"file":"lib/backends/smartos/index.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"lib/backends/smartos/tasks/machine_create.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/backends/smartos/tasks/machine_destroy.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/backends/smartos/tasks/machine_load.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"lib/backends/smartos/tasks/machine_migrate.js","type":"ADDED","insertions":676,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-1}],"sizeInsertions":3178,"sizeDeletions":-3},"patchSets":[{"number":"1","revision":"7e1cc881f79dced00cc40f16dd8bdeb964da3f38","parents":["7e38009d38247001900906f204274bfb87db545f"],"ref":"refs/changes/32/5732/1","uploader":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"createdOn":1551981209,"author":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"isDraft":false,"kind":"REWORK","comments":[{"file":"lib/backends/smartos/bin/machine-migrate-receive.js","line":8,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"2019"},{"file":"lib/backends/smartos/bin/machine-migrate-receive.js","line":8,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Done"},{"file":"lib/backends/smartos/bin/machine-migrate-receive.js","line":148,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"I\u0027d remove this if it was left in by accident, or write a little comment elaborating on why it\u0027s significant."},{"file":"lib/backends/smartos/bin/machine-migrate-receive.js","line":148,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Done"},{"file":"lib/backends/smartos/bin/machine-migrate-receive.js","line":175,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Need this?"},{"file":"lib/backends/smartos/bin/machine-migrate-receive.js","line":175,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Done"},{"file":"lib/backends/smartos/bin/machine-migrate-receive.js","line":178,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"I can\u0027t find any reference to \u003cprocess\u003e.signalCode in the node 6.x docs, do we support that there?"},{"file":"lib/backends/smartos/bin/machine-migrate-receive.js","line":178,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"These properties in this log statement are private properties of the child_process.ChildProcess class (well, killed is public). It\u0027s just useful information for debugging purposes.\n\nSince this is a log, even if these properties become undefined in the future, that will not break anything."},{"file":"lib/backends/smartos/bin/machine-migrate-receive.js","line":258,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Need this?"},{"file":"lib/backends/smartos/bin/machine-migrate-receive.js","line":258,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Nope - gone."},{"file":"lib/backends/smartos/bin/machine-migrate-receive.js","line":360,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"commandSync"},{"file":"lib/backends/smartos/bin/machine-migrate-receive.js","line":360,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Done"},{"file":"lib/backends/smartos/bin/machine-migrate-receive.js","line":528,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"The default value for the execFile maxBuffer option value is actually ridiculously small and easy to blow up (in my experience). You may want to consider setting much larger values for it any time you\u0027re execFile\u0027ing."},{"file":"lib/backends/smartos/bin/machine-migrate-receive.js","line":528,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Good point - updated all calls to execFile and execFileSync."},{"file":"lib/backends/smartos/bin/machine-migrate-send.js","line":8,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"2019"},{"file":"lib/backends/smartos/bin/machine-migrate-send.js","line":8,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Done"},{"file":"lib/backends/smartos/bin/machine-migrate-send.js","line":30,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"I could be wrong here, but it might be better to create a constant of the error\nmessage, and use that value to create new Error(...) in the actual code. I\n*think* when you create the Error object some stack information is recorded.\n\n    // create an error object\n    var A \u003d new Error(\u0027error A\u0027);\n\n    function myFun(callback) {\n        var B \u003d new Error(\u0027error B\u0027);\n        callback(A, B);\n    }\n\n    myFun(function onMyFun(err1, err2) {\n        console.log(err1.message);\n        console.log(err1.stack);\n\n        console.log(err2.message);\n        console.log(err2.stack);\n    });\n\nPrints:\n\n    error A\n    Error: error A\n        at Object.\u003canonymous\u003e (/Users/orlando/foo.js:2:13)\n        at Module._compile (module.js:409:26)\n        at Object.Module._extensions..js (module.js:416:10)\n        at Module.load (module.js:343:32)\n        at Function.Module._load (module.js:300:12)\n        at Function.Module.runMain (module.js:441:10)\n        at startup (node.js:140:18)\n        at node.js:1043:3\n    error B\n    Error: error B\n        at myFun (/Users/orlando/foo.js:5:17)\n        at Object.\u003canonymous\u003e (/Users/orlando/foo.js:9:5)\n        at Module._compile (module.js:409:26)\n        at Object.Module._extensions..js (module.js:416:10)\n        at Module.load (module.js:343:32)\n        at Function.Module._load (module.js:300:12)\n        at Function.Module.runMain (module.js:441:10)\n        at startup (node.js:140:18)\n        at node.js:1043:3"},{"file":"lib/backends/smartos/bin/machine-migrate-send.js","line":30,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Done"},{"file":"lib/backends/smartos/bin/machine-migrate-send.js","line":352,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Assert ctx properties we use"},{"file":"lib/backends/smartos/bin/machine-migrate-send.js","line":352,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Done"},{"file":"lib/backends/smartos/bin/machine-migrate-send.js","line":386,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Assert ctx properties we use"},{"file":"lib/backends/smartos/bin/machine-migrate-send.js","line":386,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Done"},{"file":"lib/backends/smartos/bin/machine-migrate-send.js","line":512,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Assert ctx properties we use"},{"file":"lib/backends/smartos/bin/machine-migrate-send.js","line":512,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Done"},{"file":"lib/backends/smartos/bin/machine-migrate-send.js","line":584,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Assert ctx properties we use"},{"file":"lib/backends/smartos/bin/machine-migrate-send.js","line":584,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Done"},{"file":"lib/backends/smartos/bin/machine-migrate-send.js","line":594,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"_runCommandCb or _getSnapshotNamesCb"},{"file":"lib/backends/smartos/bin/machine-migrate-send.js","line":594,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Done"},{"file":"lib/backends/smartos/bin/machine-migrate-send.js","line":615,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Assert ctx properties we use"},{"file":"lib/backends/smartos/bin/machine-migrate-send.js","line":615,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Done"},{"file":"lib/backends/smartos/bin/machine-migrate-send.js","line":713,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Assert ctx properties we use"},{"file":"lib/backends/smartos/bin/machine-migrate-send.js","line":713,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Done"},{"file":"lib/backends/smartos/bin/machine-migrate-send.js","line":750,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Assert ctx properties we use"},{"file":"lib/backends/smartos/bin/machine-migrate-send.js","line":750,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Done"},{"file":"lib/backends/smartos/bin/machine-migrate-send.js","line":907,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Assert ctx properties we use"},{"file":"lib/backends/smartos/bin/machine-migrate-send.js","line":907,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Done"},{"file":"lib/backends/smartos/bin/machine-migrate-send.js","line":1024,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Assert ctx properties we use"},{"file":"lib/backends/smartos/bin/machine-migrate-send.js","line":1024,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Done"},{"file":"lib/backends/smartos/bin/machine-migrate-send.js","line":1040,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Assert ctx properties we use"},{"file":"lib/backends/smartos/bin/machine-migrate-send.js","line":1040,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Done"},{"file":"lib/backends/smartos/bin/machine-migrate-send.js","line":1084,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Assert ctx properties we use"},{"file":"lib/backends/smartos/bin/machine-migrate-send.js","line":1084,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Done"},{"file":"lib/backends/smartos/bin/machine-migrate-send.js","line":1393,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Remove"},{"file":"lib/backends/smartos/bin/machine-migrate-send.js","line":1393,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Done"},{"file":"lib/backends/smartos/bin/machine-migrate-send.js","line":1406,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Remove"},{"file":"lib/backends/smartos/bin/machine-migrate-send.js","line":1406,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Done"},{"file":"lib/backends/smartos/bin/machine-migrate-send.js","line":1427,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Remove"},{"file":"lib/backends/smartos/bin/machine-migrate-send.js","line":1427,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Done"},{"file":"lib/backends/smartos/bin/machine-migrate-send.js","line":1446,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Remove"},{"file":"lib/backends/smartos/bin/machine-migrate-send.js","line":1446,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Done"},{"file":"lib/backends/smartos/bin/machine-migrate-send.js","line":1504,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Should we mark these as TBD or do we not need this in here?"},{"file":"lib/backends/smartos/bin/machine-migrate-send.js","line":1504,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Removed - not needed. The pause command makes use of the \u0027commandStop\u0027 command above, \u0027abort\u0027 not needed as it only works on a stopped sync."},{"file":"lib/backends/smartos/bin/machine-migrate-send.js","line":1550,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"assert opts.adminIp"},{"file":"lib/backends/smartos/bin/machine-migrate-send.js","line":1550,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Done"},{"file":"lib/backends/smartos/tasks/machine_destroy.js","line":40,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"This is a bool coming out of CNAPI"},{"file":"lib/backends/smartos/tasks/machine_destroy.js","line":40,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Good spotting - updated."},{"file":"lib/backends/smartos/tasks/machine_load.js","line":26,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"I believe in the sdc-cnapi CR (https://cr.joyent.us/#/c/5733/) we\u0027re already testing if the value \u003d\u003d\u003d \u0027true\u0027 (so the value cnapi will be passing will be a bool, not a str)."},{"file":"lib/backends/smartos/tasks/machine_load.js","line":26,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Yes, good spotting, updated to boolean format."},{"file":"lib/backends/smartos/tasks/machine_migrate.js","line":8,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"2019"},{"file":"lib/backends/smartos/tasks/machine_migrate.js","line":8,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Done"},{"file":"package.json","line":4,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"bump version"},{"file":"package.json","line":4,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/backends/smartos/bin/machine-migrate-receive.js","type":"ADDED","insertions":813,"deletions":0},{"file":"lib/backends/smartos/bin/machine-migrate-send.js","type":"ADDED","insertions":1630,"deletions":0},{"file":"lib/backends/smartos/index.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"lib/backends/smartos/tasks/machine_destroy.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"lib/backends/smartos/tasks/machine_load.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/backends/smartos/tasks/machine_migrate.js","type":"ADDED","insertions":672,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":0}],"sizeInsertions":3122,"sizeDeletions":-2},{"number":"2","revision":"6c3c5650d531f52e497d25a591da0ef9c2a8d523","parents":["44e76f43c30766be4c0aad0ac4bfb23f92cab79e"],"ref":"refs/changes/32/5732/2","uploader":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"createdOn":1553538690,"author":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/backends/smartos/bin/machine-migrate-receive.js","type":"ADDED","insertions":804,"deletions":0},{"file":"lib/backends/smartos/bin/machine-migrate-send.js","type":"ADDED","insertions":1686,"deletions":0},{"file":"lib/backends/smartos/index.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"lib/backends/smartos/tasks/machine_destroy.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"lib/backends/smartos/tasks/machine_load.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/backends/smartos/tasks/machine_migrate.js","type":"ADDED","insertions":676,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-1}],"sizeInsertions":3174,"sizeDeletions":-3},{"number":"3","revision":"2b3933bf1324baeaeb1285c30d1fcaf1a6392ecb","parents":["44e76f43c30766be4c0aad0ac4bfb23f92cab79e"],"ref":"refs/changes/32/5732/3","uploader":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"createdOn":1553618811,"author":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1553818765,"by":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1553818765,"by":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/backends/smartos/bin/machine-migrate-receive.js","type":"ADDED","insertions":804,"deletions":0},{"file":"lib/backends/smartos/bin/machine-migrate-send.js","type":"ADDED","insertions":1686,"deletions":0},{"file":"lib/backends/smartos/index.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"lib/backends/smartos/tasks/machine_create.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/backends/smartos/tasks/machine_destroy.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/backends/smartos/tasks/machine_load.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"lib/backends/smartos/tasks/machine_migrate.js","type":"ADDED","insertions":676,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-1}],"sizeInsertions":3178,"sizeDeletions":-3},{"number":"4","revision":"95ca9d0386500f97e939fbe8167ad1236426e556","parents":["d200e87d961401a335cd48bb8e1c2be715e783b9"],"ref":"refs/changes/32/5732/4","uploader":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"createdOn":1554491911,"author":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1554494235,"by":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1554494235,"by":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"}},{"type":"SUBM","value":"1","grantedOn":1554749461,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/backends/smartos/bin/machine-migrate-receive.js","type":"ADDED","insertions":804,"deletions":0},{"file":"lib/backends/smartos/bin/machine-migrate-send.js","type":"ADDED","insertions":1686,"deletions":0},{"file":"lib/backends/smartos/index.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"lib/backends/smartos/tasks/machine_create.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/backends/smartos/tasks/machine_destroy.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/backends/smartos/tasks/machine_load.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"lib/backends/smartos/tasks/machine_migrate.js","type":"ADDED","insertions":676,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-1}],"sizeInsertions":3178,"sizeDeletions":-3}],"allReviewers":[{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}]}