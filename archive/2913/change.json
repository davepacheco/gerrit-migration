{"project":"joyent/sdc-headnode","branch":"master","id":"I7c21ba34406455645be24c9ee7b136b311636cce","number":"2913","subject":"HEAD-2372 sapi-url in SAPI service metadata should use sapi_domain, not sapi_admin_ips Reviewed by: Josh Wilsdon \u003cjosh@wilsdon.ca\u003e Approved by: Josh Wilsdon \u003cjosh@wilsdon.ca\u003e","owner":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"url":"https://cr.joyent.us/2913","commitMessage":"HEAD-2372 sapi-url in SAPI service metadata should use sapi_domain, not sapi_admin_ips\nReviewed by: Josh Wilsdon \u003cjosh@wilsdon.ca\u003e\nApproved by: Josh Wilsdon \u003cjosh@wilsdon.ca\u003e\n","createdOn":1509987949,"lastUpdated":1510154403,"open":false,"status":"MERGED","comments":[{"timestamp":1509987949,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 1."},{"timestamp":1509988028,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1510026546,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 1:\n\n(4 comments)"},{"timestamp":1510026557,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 1: Code-Review+1"},{"timestamp":1510067831,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 2."},{"timestamp":1510067917,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1510067961,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 2:\n\n(4 comments)\n\nJosh, added the comments and took the vmadm update approach you suggested. Thanks!"},{"timestamp":1510088535,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 2: Code-Review+1 Integration-Approval+1\n\nGreat work!"},{"timestamp":1510154389,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 3: Commit message was updated."},{"timestamp":1510154403,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Pedro Palazón Candel"}],"currentPatchSet":{"number":"3","revision":"7c21ba34406455645be24c9ee7b136b311636cce","parents":["dd9ef5591da27eadcee4ebb3d69f0e43639bb21b"],"ref":"refs/changes/13/2913/3","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1510154389,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1510067917,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1510088535,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1510088535,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"SUBM","value":"1","grantedOn":1510154403,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"scripts/build-payload.js","type":"MODIFIED","insertions":10,"deletions":-2},{"file":"scripts/headnode.sh","type":"MODIFIED","insertions":31,"deletions":-2},{"file":"scripts/sdc-init.js","type":"MODIFIED","insertions":14,"deletions":-4}],"sizeInsertions":55,"sizeDeletions":-8},"patchSets":[{"number":"1","revision":"89a11702b36793d29a79a719d16575837bc252b8","parents":["dd9ef5591da27eadcee4ebb3d69f0e43639bb21b"],"ref":"refs/changes/13/2913/1","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1509987949,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1509988028,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1510026557,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}}],"comments":[{"file":"scripts/build-payload.js","line":286,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Might be worth a quick comment here about why we use the IP for these ones?"},{"file":"scripts/build-payload.js","line":286,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"scripts/headnode.sh","line":503,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Same here, maybe a short comment why these 3 are special?"},{"file":"scripts/headnode.sh","line":503,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"scripts/headnode.sh","line":847,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Where is the util.sh getting the config? Is it doing something magical here, or could we skip the zlogin and just do something like:\n\n    vmadm update $(vmadm lookup -1 tags.smartdc_role\u003dassets) \u003c\u003cEOF\n    {\"set_customer_metadata\": {\"sapi-url\": \"http://${CONFIG_sapi_domain}\"}}\n    EOF\n\nsince we also have the config loaded here? Sam question for binder below."},{"file":"scripts/headnode.sh","line":847,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"No magic at all! Just went ahead with the same approach we were following for the SAPI zone, but I\u0027ve just rebuilt with the change you suggest and it worked like a charm. Sold!"},{"file":"scripts/sdc-init.js","line":462,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Same comment. :)"},{"file":"scripts/sdc-init.js","line":462,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"scripts/build-payload.js","type":"MODIFIED","insertions":7,"deletions":-2},{"file":"scripts/headnode.sh","type":"MODIFIED","insertions":31,"deletions":-2},{"file":"scripts/sdc-init.js","type":"MODIFIED","insertions":11,"deletions":-4}],"sizeInsertions":49,"sizeDeletions":-8},{"number":"2","revision":"941da956f06fb892b9e9872239b9a0caa22cb74b","parents":["dd9ef5591da27eadcee4ebb3d69f0e43639bb21b"],"ref":"refs/changes/13/2913/2","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1510067831,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1510067917,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1510088535,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1510088535,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"scripts/build-payload.js","type":"MODIFIED","insertions":10,"deletions":-2},{"file":"scripts/headnode.sh","type":"MODIFIED","insertions":31,"deletions":-2},{"file":"scripts/sdc-init.js","type":"MODIFIED","insertions":14,"deletions":-4}],"sizeInsertions":55,"sizeDeletions":-8},{"number":"3","revision":"7c21ba34406455645be24c9ee7b136b311636cce","parents":["dd9ef5591da27eadcee4ebb3d69f0e43639bb21b"],"ref":"refs/changes/13/2913/3","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1510154389,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1510067917,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1510088535,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1510088535,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"SUBM","value":"1","grantedOn":1510154403,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"scripts/build-payload.js","type":"MODIFIED","insertions":10,"deletions":-2},{"file":"scripts/headnode.sh","type":"MODIFIED","insertions":31,"deletions":-2},{"file":"scripts/sdc-init.js","type":"MODIFIED","insertions":14,"deletions":-4}],"sizeInsertions":55,"sizeDeletions":-8}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}]}