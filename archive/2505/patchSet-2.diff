commit 8a27a7b656a2a1ca5e419abe2679e926475b6a85 (refs/changes/05/2505/2)
Author: Trent Mick <trentm@gmail.com>
Date:   2017-09-06T14:57:12-07:00 (2 years, 1 month ago)
    
    CNAPI-721 CNAPI passing to node-moray `limit` and `offset` as strings

diff --git a/lib/endpoints/servers.js b/lib/endpoints/servers.js
index b0e58c9..4c4d066 100644
--- a/lib/endpoints/servers.js
+++ b/lib/endpoints/servers.js
@@ -112,8 +112,9 @@ Server.list = function handlerSeverList(req, res, next) {
         return;
     }
 
-    if (req.params.hasOwnProperty('limit')) {
-        var limit = Number(req.params.limit); // TODO: int guard, do it above?
+    var limit;
+    if (req.params.limit !== undefined) {
+        limit = Number(req.params.limit);
         if (limit < SERVER_LIST_MIN_LIMIT || SERVER_LIST_MAX_LIMIT < limit) {
             res.send(400, validation.formatValidationErrors([ {
                 param: 'limit',
@@ -140,11 +141,12 @@ Server.list = function handlerSeverList(req, res, next) {
             options.default = false;
 
             // Set up paging
-            ['limit', 'offset'].forEach(function (f) {
-                if (req.params.hasOwnProperty(f)) {
-                    options[f] = req.params[f];
-                }
-            });
+            if (limit !== undefined) {
+                options.limit = limit; // Already converted to a Number above.
+            }
+            if (req.params.offset !== undefined) {
+                options.offset = Number(req.params.offset);
+            }
 
             // Set up extras
             if (req.params.extras) {
diff --git a/lib/models/server.js b/lib/models/server.js
index 12716bb..be310fb 100644
--- a/lib/models/server.js
+++ b/lib/models/server.js
@@ -133,6 +133,9 @@ ModelServer.createComputeNodeAgentHandler = function (app, jobuuid) {
  */
 
 ModelServer.list = function (params, callback) {
+    assert.optionalNumber(params.limit, 'params.limit');
+    assert.optionalNumber(params.offset, 'params.offset');
+
     var self = this;
 
     var uuid = params.uuid;
@@ -204,11 +207,12 @@ ModelServer.list = function (params, callback) {
             }
         };
 
-    ['limit', 'offset'].forEach(function (f) {
-        if (params.hasOwnProperty(f)) {
-            findOpts[f] = params[f];
-        }
-    });
+    if (params.limit !== undefined) {
+        findOpts.limit = params.limit;
+    }
+    if (params.offset !== undefined) {
+        findOpts.offset = params.offset;
+    }
 
     var servers = [];
     var serverStatus = {};
