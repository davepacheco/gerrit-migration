{"project":"joyent/illumos-joyent","branch":"master","id":"I013c08b381c1e8cc28bd46bdd263cb85da061774","number":"2884","subject":"OS-6428 bad free in ctf_dwarf_init_die","owner":{"name":"Jonathan Perkin","email":"jperkin@joyent.com","username":"jperkin"},"url":"https://cr.joyent.us/2884","commitMessage":"OS-6428 bad free in ctf_dwarf_init_die\n","createdOn":1509387783,"lastUpdated":1571935029,"open":false,"status":"ABANDONED","comments":[{"timestamp":1509387783,"reviewer":{"name":"Jonathan Perkin","email":"jperkin@joyent.com","username":"jperkin"},"message":"Uploaded patch set 1."},{"timestamp":1509394983,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1512411119,"reviewer":{"name":"Jonathan Perkin","email":"jperkin@joyent.com","username":"jperkin"},"message":"Uploaded patch set 2."},{"timestamp":1512412941,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 2: Code-Review+1\n\nThis looks good. If you can put some testing notes in the ticket, I\u0027ll be happy to approve."},{"timestamp":1512477580,"reviewer":{"name":"Jonathan Perkin","email":"jperkin@joyent.com","username":"jperkin"},"message":"Uploaded patch set 3."},{"timestamp":1512509829,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 3:\n\n(1 comment)"},{"timestamp":1512561829,"reviewer":{"name":"Jonathan Perkin","email":"jperkin@joyent.com","username":"jperkin"},"message":"Uploaded patch set 4."},{"timestamp":1512565102,"reviewer":{"name":"Jonathan Perkin","email":"jperkin@joyent.com","username":"jperkin"},"message":"Patch Set 1:\n\n(2 comments)"},{"timestamp":1512604895,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 4: Code-Review+1\n\nI like the inited idea. I think that makes things clearer."},{"timestamp":1512673449,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 4: Code-Review+1"},{"timestamp":1513010313,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 4: Integration-Approval+1"},{"timestamp":1571935029,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Abandoned\n\nstale"}],"currentPatchSet":{"number":"4","revision":"013c08b381c1e8cc28bd46bdd263cb85da061774","parents":["86aa638917f0ec83401d6523f879fbdf56cde0b9"],"ref":"refs/changes/84/2884/4","uploader":{"name":"Jonathan Perkin","email":"jperkin@joyent.com","username":"jperkin"},"createdOn":1512561829,"author":{"name":"Jonathan Perkin","email":"jperkin@joyent.com","username":"jperkin"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1512604895,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1512673449,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1513010313,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/libctf/common/ctf_dwarf.c","type":"MODIFIED","insertions":14,"deletions":-13}],"sizeInsertions":14,"sizeDeletions":-13},"patchSets":[{"number":"1","revision":"b2898cb30fbece18a0f36f4634a15278ba311f4d","parents":["e61cabe8be450c327a73340e13c0eb1d4ba537c7"],"ref":"refs/changes/84/2884/1","uploader":{"name":"Jonathan Perkin","email":"jperkin@joyent.com","username":"jperkin"},"createdOn":1509387783,"author":{"name":"Jonathan Perkin","email":"jperkin@joyent.com","username":"jperkin"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/lib/libctf/common/ctf_dwarf.c","line":2878,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I don\u0027t believe this is what we want universally. This means that if you incorrectly built things, we might tell you that there\u0027s no CTF. I think what we might want to do is pass the detected type and effectively the -i determination into here to determine what we should do. Thoughts?"},{"file":"usr/src/lib/libctf/common/ctf_dwarf.c","line":2878,"reviewer":{"name":"Jonathan Perkin","email":"jperkin@joyent.com","username":"jperkin"},"message":"Yes you\u0027re right. I wasn\u0027t aware of -i handling when I wrote this first cut, and since then have found a few other issues related to -i, so I\u0027ve removed this part of the patch and just concentrated on the ctf_free\u0027s for now, and will deal with the -i handling in a separate ticket."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/libctf/common/ctf_dwarf.c","type":"MODIFIED","insertions":2,"deletions":-12}],"sizeInsertions":2,"sizeDeletions":-12},{"number":"2","revision":"a6a6fa6ab5361c2f22a7ad79bcd809fed151ceb1","parents":["e61cabe8be450c327a73340e13c0eb1d4ba537c7"],"ref":"refs/changes/84/2884/2","uploader":{"name":"Jonathan Perkin","email":"jperkin@joyent.com","username":"jperkin"},"createdOn":1512411119,"author":{"name":"Jonathan Perkin","email":"jperkin@joyent.com","username":"jperkin"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1512412941,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/libctf/common/ctf_dwarf.c","type":"MODIFIED","insertions":0,"deletions":-6}],"sizeInsertions":0,"sizeDeletions":-6},{"number":"3","revision":"abcd21aaafa386c4fd468b328cb38bc061698c4b","parents":["758ae53701bec2fed98db901e5af051af2ac0c6d"],"ref":"refs/changes/84/2884/3","uploader":{"name":"Jonathan Perkin","email":"jperkin@joyent.com","username":"jperkin"},"createdOn":1512477580,"author":{"name":"Jonathan Perkin","email":"jperkin@joyent.com","username":"jperkin"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/lib/libctf/common/ctf_dwarf.c","line":2657,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I think I understand why we\u0027re using the cd_elf as our sentinel. Do you think you could add a comment explaining why that is?"},{"file":"usr/src/lib/libctf/common/ctf_dwarf.c","line":2657,"reviewer":{"name":"Jonathan Perkin","email":"jperkin@joyent.com","username":"jperkin"},"message":"I was actually thinking yesterday while working on a related fix that I\u0027d prefer to be a bit more explicit about this, so I\u0027ve added a cd_inited boolean_t we can check instead. I\u0027ve also found a couple of other issues in ctf_dwarf_free_die after deliberately trying to free dies that have already been freed, and have pushed a new patchset which resolves both of those issues."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/libctf/common/ctf_dwarf.c","type":"MODIFIED","insertions":6,"deletions":-13}],"sizeInsertions":6,"sizeDeletions":-13},{"number":"4","revision":"013c08b381c1e8cc28bd46bdd263cb85da061774","parents":["86aa638917f0ec83401d6523f879fbdf56cde0b9"],"ref":"refs/changes/84/2884/4","uploader":{"name":"Jonathan Perkin","email":"jperkin@joyent.com","username":"jperkin"},"createdOn":1512561829,"author":{"name":"Jonathan Perkin","email":"jperkin@joyent.com","username":"jperkin"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1512604895,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1512673449,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1513010313,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/libctf/common/ctf_dwarf.c","type":"MODIFIED","insertions":14,"deletions":-13}],"sizeInsertions":14,"sizeDeletions":-13}],"allReviewers":[{"name":"Jonathan Perkin","email":"jperkin@joyent.com","username":"jperkin"},{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}]}