commit a6a6fa6ab5361c2f22a7ad79bcd809fed151ceb1 (refs/changes/84/2884/2)
Author: Jonathan Perkin <jperkin@joyent.com>
Date:   2017-12-04T18:11:14+00:00 (1 year, 10 months ago)
    
    OS-6428 bad free in ctf_dwarf_init_die

diff --git a/usr/src/lib/libctf/common/ctf_dwarf.c b/usr/src/lib/libctf/common/ctf_dwarf.c
index 811a55bc64..3b90f9608d 100644
--- a/usr/src/lib/libctf/common/ctf_dwarf.c
+++ b/usr/src/lib/libctf/common/ctf_dwarf.c
@@ -2746,33 +2746,28 @@ ctf_dwarf_init_die(int fd, Elf *elf, ctf_die_t *cdp, int ndie, char *errbuf,
 		if ((ret = ctf_dwarf_die_elfenc(elf, cdp, errbuf,
 		    errlen)) != 0) {
 			avl_destroy(&cdp->cd_map);
-			ctf_free(cdp, sizeof (ctf_die_t));
 			return (ret);
 		}
 
 		if ((ret = ctf_dwarf_sib(cdp, NULL, &cu)) != 0) {
 			avl_destroy(&cdp->cd_map);
-			ctf_free(cdp, sizeof (ctf_die_t));
 			return (ret);
 		}
 		if (cu == NULL) {
 			(void) snprintf(errbuf, errlen,
 			    "file does not contain DWARF data\n");
 			avl_destroy(&cdp->cd_map);
-			ctf_free(cdp, sizeof (ctf_die_t));
 			return (ECTF_CONVBKERR);
 		}
 
 		if ((ret = ctf_dwarf_child(cdp, cu, &child)) != 0) {
 			avl_destroy(&cdp->cd_map);
-			ctf_free(cdp, sizeof (ctf_die_t));
 			return (ret);
 		}
 		if (child == NULL) {
 			(void) snprintf(errbuf, errlen,
 			    "file does not contain DWARF data\n");
 			avl_destroy(&cdp->cd_map);
-			ctf_free(cdp, sizeof (ctf_die_t));
 			return (ECTF_CONVBKERR);
 		}
 
@@ -2781,7 +2776,6 @@ ctf_dwarf_init_die(int fd, Elf *elf, ctf_die_t *cdp, int ndie, char *errbuf,
 
 		if ((cdp->cd_cmh = ctf_merge_init(fd, &ret)) == NULL) {
 			avl_destroy(&cdp->cd_map);
-			ctf_free(cdp, sizeof (ctf_die_t));
 			return (ret);
 		}
 
