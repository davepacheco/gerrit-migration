{"project":"joyent/illumos-joyent","branch":"master","id":"Ib6c5025eb114df32b1833139e44508466d5e3f75","number":"4777","subject":"OS-7206 Multi-TRB xhci transfers should use event data OS-7207 xhci needs to always set slot context OS-7208 increase xhci bulk transfer sgl count OS-7210 xhci_transfer_get_tdsize can return values that are too large Reviewed by: Alex Wilson \u003calex.wilson@","owner":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"url":"https://cr.joyent.us/4777","commitMessage":"OS-7206 Multi-TRB xhci transfers should use event data\nOS-7207 xhci needs to always set slot context\nOS-7208 increase xhci bulk transfer sgl count\nOS-7210 xhci_transfer_get_tdsize can return values that are too large\nReviewed by: Alex Wilson \u003calex.wilson@joyent.com\u003e\nReviewed by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e\nApproved by: Alex Wilson \u003calex.wilson@joyent.com\u003e\n","createdOn":1535762386,"lastUpdated":1536272738,"open":false,"status":"MERGED","comments":[{"timestamp":1535762386,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Uploaded patch set 1."},{"timestamp":1536107477,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 1:\n\n(2 comments)"},{"timestamp":1536109834,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Uploaded patch set 2."},{"timestamp":1536109846,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 1:\n\n(2 comments)"},{"timestamp":1536111174,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 2: Code-Review+1"},{"timestamp":1536185710,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 2:\n\n(4 comments)\n\nThis looks good to me, I just saw a few small nits."},{"timestamp":1536186000,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Uploaded patch set 3."},{"timestamp":1536186110,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 2:\n\n(4 comments)"},{"timestamp":1536187638,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1536268854,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 3: Integration-Approval+1"},{"timestamp":1536271154,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1536272646,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Uploaded patch set 4: Patch Set 3 was rebased."},{"timestamp":1536272714,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Uploaded patch set 5: Commit message was updated."},{"timestamp":1536272738,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Robert Mustacchi"}],"currentPatchSet":{"number":"5","revision":"b6c5025eb114df32b1833139e44508466d5e3f75","parents":["93e19c9346ce9d27b339cc14132d82b2e8a668e4"],"ref":"refs/changes/77/4777/5","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1536272714,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1536187638,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1536268854,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1536271154,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"SUBM","value":"1","grantedOn":1536272738,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":13,"deletions":0},{"file":"usr/src/uts/common/io/usb/hcd/xhci/xhci_dma.c","type":"MODIFIED","insertions":95,"deletions":-40},{"file":"usr/src/uts/common/io/usb/hcd/xhci/xhci_endpoint.c","type":"MODIFIED","insertions":138,"deletions":-48},{"file":"usr/src/uts/common/io/usb/hcd/xhci/xhci_ring.c","type":"MODIFIED","insertions":17,"deletions":-3},{"file":"usr/src/uts/common/io/usb/hcd/xhci/xhci_usba.c","type":"MODIFIED","insertions":15,"deletions":-9},{"file":"usr/src/uts/common/sys/usb/hcd/xhci/xhci.h","type":"MODIFIED","insertions":53,"deletions":-26}],"sizeInsertions":318,"sizeDeletions":-126},"patchSets":[{"number":"1","revision":"0b12db68104ab5a44b8b74ed221c4ff48416b631","parents":["6e567b7bf9c30262784d63ef8e2ad150be55b6c1"],"ref":"refs/changes/77/4777/1","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1535762386,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/uts/common/io/usb/hcd/xhci/xhci_usba.c","line":946,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"I think \"inttterupt\" got interrupted with some extra Ts. Also \"htis\""},{"file":"usr/src/uts/common/io/usb/hcd/xhci/xhci_usba.c","line":946,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"},{"file":"usr/src/uts/common/sys/usb/hcd/xhci/xhci.h","line":743,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Just a nit, but this is declared in the .c as a uint64_t*"},{"file":"usr/src/uts/common/sys/usb/hcd/xhci/xhci.h","line":743,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/uts/common/io/usb/hcd/xhci/xhci_dma.c","type":"MODIFIED","insertions":95,"deletions":-40},{"file":"usr/src/uts/common/io/usb/hcd/xhci/xhci_endpoint.c","type":"MODIFIED","insertions":138,"deletions":-48},{"file":"usr/src/uts/common/io/usb/hcd/xhci/xhci_ring.c","type":"MODIFIED","insertions":17,"deletions":-3},{"file":"usr/src/uts/common/io/usb/hcd/xhci/xhci_usba.c","type":"MODIFIED","insertions":14,"deletions":-8},{"file":"usr/src/uts/common/sys/usb/hcd/xhci/xhci.h","type":"MODIFIED","insertions":53,"deletions":-26}],"sizeInsertions":317,"sizeDeletions":-125},{"number":"2","revision":"e4dc12861d7f4d405223a149aaf288fdd644d52a","parents":["6e567b7bf9c30262784d63ef8e2ad150be55b6c1"],"ref":"refs/changes/77/4777/2","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1536109834,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1536111174,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}}],"comments":[{"file":"usr/src/uts/common/io/usb/hcd/xhci/xhci_dma.c","line":284,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"I think this is supposed to be xt_trbs_pa"},{"file":"usr/src/uts/common/io/usb/hcd/xhci/xhci_dma.c","line":284,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"},{"file":"usr/src/uts/common/io/usb/hcd/xhci/xhci_dma.c","line":377,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Its kind of a nit, but it would be a little nicer if this matched what you allocated (i.e. sizeof (uint64_t))."},{"file":"usr/src/uts/common/io/usb/hcd/xhci/xhci_dma.c","line":377,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"It should. Sorry, that got missed in refactoring."},{"file":"usr/src/uts/common/io/usb/hcd/xhci/xhci_dma.c","line":505,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"missing a word?"},{"file":"usr/src/uts/common/io/usb/hcd/xhci/xhci_dma.c","line":505,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"},{"file":"usr/src/uts/common/io/usb/hcd/xhci/xhci_endpoint.c","line":1465,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"this"},{"file":"usr/src/uts/common/io/usb/hcd/xhci/xhci_endpoint.c","line":1465,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/uts/common/io/usb/hcd/xhci/xhci_dma.c","type":"MODIFIED","insertions":95,"deletions":-40},{"file":"usr/src/uts/common/io/usb/hcd/xhci/xhci_endpoint.c","type":"MODIFIED","insertions":138,"deletions":-48},{"file":"usr/src/uts/common/io/usb/hcd/xhci/xhci_ring.c","type":"MODIFIED","insertions":17,"deletions":-3},{"file":"usr/src/uts/common/io/usb/hcd/xhci/xhci_usba.c","type":"MODIFIED","insertions":15,"deletions":-9},{"file":"usr/src/uts/common/sys/usb/hcd/xhci/xhci.h","type":"MODIFIED","insertions":53,"deletions":-26}],"sizeInsertions":318,"sizeDeletions":-126},{"number":"3","revision":"53530b55291038343c45f77f1916b357c76d8f37","parents":["6e567b7bf9c30262784d63ef8e2ad150be55b6c1"],"ref":"refs/changes/77/4777/3","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1536186000,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1536271154,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1536268854,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1536187638,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/uts/common/io/usb/hcd/xhci/xhci_dma.c","type":"MODIFIED","insertions":95,"deletions":-40},{"file":"usr/src/uts/common/io/usb/hcd/xhci/xhci_endpoint.c","type":"MODIFIED","insertions":138,"deletions":-48},{"file":"usr/src/uts/common/io/usb/hcd/xhci/xhci_ring.c","type":"MODIFIED","insertions":17,"deletions":-3},{"file":"usr/src/uts/common/io/usb/hcd/xhci/xhci_usba.c","type":"MODIFIED","insertions":15,"deletions":-9},{"file":"usr/src/uts/common/sys/usb/hcd/xhci/xhci.h","type":"MODIFIED","insertions":53,"deletions":-26}],"sizeInsertions":318,"sizeDeletions":-126},{"number":"4","revision":"fae2f06aa390e60ed28aa78c1a3d1f9ba780cf9e","parents":["93e19c9346ce9d27b339cc14132d82b2e8a668e4"],"ref":"refs/changes/77/4777/4","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1536272646,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1536271154,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1536268854,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1536187638,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/uts/common/io/usb/hcd/xhci/xhci_dma.c","type":"MODIFIED","insertions":95,"deletions":-40},{"file":"usr/src/uts/common/io/usb/hcd/xhci/xhci_endpoint.c","type":"MODIFIED","insertions":138,"deletions":-48},{"file":"usr/src/uts/common/io/usb/hcd/xhci/xhci_ring.c","type":"MODIFIED","insertions":17,"deletions":-3},{"file":"usr/src/uts/common/io/usb/hcd/xhci/xhci_usba.c","type":"MODIFIED","insertions":15,"deletions":-9},{"file":"usr/src/uts/common/sys/usb/hcd/xhci/xhci.h","type":"MODIFIED","insertions":53,"deletions":-26}],"sizeInsertions":318,"sizeDeletions":-126},{"number":"5","revision":"b6c5025eb114df32b1833139e44508466d5e3f75","parents":["93e19c9346ce9d27b339cc14132d82b2e8a668e4"],"ref":"refs/changes/77/4777/5","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1536272714,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"SUBM","value":"1","grantedOn":1536272738,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1536271154,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1536268854,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1536187638,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":13,"deletions":0},{"file":"usr/src/uts/common/io/usb/hcd/xhci/xhci_dma.c","type":"MODIFIED","insertions":95,"deletions":-40},{"file":"usr/src/uts/common/io/usb/hcd/xhci/xhci_endpoint.c","type":"MODIFIED","insertions":138,"deletions":-48},{"file":"usr/src/uts/common/io/usb/hcd/xhci/xhci_ring.c","type":"MODIFIED","insertions":17,"deletions":-3},{"file":"usr/src/uts/common/io/usb/hcd/xhci/xhci_usba.c","type":"MODIFIED","insertions":15,"deletions":-9},{"file":"usr/src/uts/common/sys/usb/hcd/xhci/xhci.h","type":"MODIFIED","insertions":53,"deletions":-26}],"sizeInsertions":318,"sizeDeletions":-126}],"allReviewers":[{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}]}