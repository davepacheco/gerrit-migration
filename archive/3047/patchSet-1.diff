From ce032b2cf514fd55a2ff7781e81ab73e755a1e79 Mon Sep 17 00:00:00 2001
From: Cody Peter Mello <cody.mello@joyent.com>
Date: Wed, 6 Dec 2017 01:29:00 +0000
Subject: [PATCH] OS-5269 dladm(1M) should describe the "protection" link
 property Reviewed by: Patrick Mooney <patrick.mooney@joyent.com> Reviewed by:
 Robert Mustacchi <rm@joyent.com> Reviewed by: Dave Eddy
 <dave.eddy@joyent.com>

---
 usr/src/man/man1m/dladm.1m | 63 +++++++++++++++++++++++++++++++++++++-
 1 file changed, 62 insertions(+), 1 deletion(-)

diff --git a/usr/src/man/man1m/dladm.1m b/usr/src/man/man1m/dladm.1m
index 0fd6ec2294..583afcb210 100644
--- a/usr/src/man/man1m/dladm.1m
+++ b/usr/src/man/man1m/dladm.1m
@@ -4948,7 +4948,7 @@ is not bound to any specific processor or processor set.
 .ad
 .sp .6
 .RS 4n
-When using IP spoofing protection (see \fBprotections\fR), addresses can be
+When using IP spoofing protection (see \fBprotection\fR), addresses can be
 learned dynamically by monitoring certain network traffic, like DHCP
 transactions. By default, all learning methods are permitted, but if
 \fBallowed-ips\fR contains any addresses, then all methods are disabled, and
@@ -5010,6 +5010,67 @@ Sets the relative priority for the link. The value can be given as one of the
 tokens \fBhigh\fR, \fBmedium\fR, or \fBlow\fR. The default is \fBhigh\fR.
 .RE
 
+.sp
+.ne 2
+.na
+\fB\fBprotection\fR\fR
+.ad
+.sp .6
+.RS 4n
+This property enables various forms of link protections, which prevent sending
+applicable traffic out of this link. Note that since this enforcement happens
+late in the networking stack, some observability tools like \fBsnoop\fR(1M) may
+still see dropped outbound packets.
+
+This property should be set to a comma-separated list of protections to enable
+on this link, where available protections are:
+.sp
+.ne 2
+.na
+\fBipnospoof\fR
+.ad
+.sp .6
+.RS 4n
+Prevents sending from IP addresses that have not been permitted
+over the NIC. Addresses can be learned dynamically (see \fBdynamic-methods\fR)
+or specified explicitly (see \fBallowed-ips\fR).
+.RE
+.sp
+.ne 2
+.na
+\fBdhcpnospoof\fR
+.ad
+.sp .6
+.RS 4n
+Prevents sending DHCP packets whose client hardware address
+(CHADDR) field differs from the link-layer address, or from using a Client
+Identifier whose value cannot be confirmed to be derived from the link-layer
+address. Additional Client Identifiers can be permitted through the
+\fBallowed-dhcp-cids\fR and \fBallow-all-dhcp-cids\fR link properties.
+.RE
+.sp
+.ne 2
+.na
+\fBmacnospoof\fR
+.ad
+.sp .6
+.RS 4n
+Prevents sending packets with a link-layer address that
+differs from the one associated with the NIC.
+.RE
+.sp
+.ne 2
+.na
+\fBrestricted\fR
+.ad
+.sp .6
+.RS 4n
+Will prevent
+using a VLAN ID not associated with the NIC and sending packets that are not
+IPv4, IPv6 or ARP.
+.RE
+.RE
+
 .sp
 .ne 2
 .na
-- 
2.21.0

