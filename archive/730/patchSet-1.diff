From 8fd95cf0ce3d4cad72306a418ed6d06d9598e34d Mon Sep 17 00:00:00 2001
From: Trent Mick <trentm@gmail.com>
Date: Tue, 18 Oct 2016 12:19:51 -0700
Subject: [PATCH] RELENG-729 purge-mg-builds is failing (pipefail) on a grep
 with no hits

---
 tools/purge-mg-builds | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/tools/purge-mg-builds b/tools/purge-mg-builds
index 0a6a5f9..55db846 100755
--- a/tools/purge-mg-builds
+++ b/tools/purge-mg-builds
@@ -299,7 +299,7 @@ function purge_mg_builds
     branches=$(echo "$dirs" | sed -E 's/-[0-9]{8}T[0-9]{6}Z$//' | sort | uniq)
 
     for branch in $branches; do
-        branch_dirs=$(echo "$dirs" | grep "^$branch-")
+        branch_dirs=$(echo "$dirs" | (grep "^$branch-" || true))
 
         # Determine which dirs for this branch that we will be purging.
         branch_dirs_to_purge=
@@ -313,12 +313,12 @@ function purge_mg_builds
 
         # The "master" branch is special: if we would end up purging *all*
         # remaining master branch dirs, then save that latest one.
+        purge_all_in_branch=no
         if [[ "$branch_dirs" == "$branch_dirs_to_purge" ]]; then
             if [[ "$branch" == "master" ]]; then
                 log "#   retain last master branch build:" \
                     $(echo "$branch_dirs_to_purge" | tail -1)
                 branch_dirs_to_purge=$(echo "$branch_dirs_to_purge" | sed '$ d')
-                purge_all_in_branch=no
             else
                 purge_all_in_branch=yes
             fi
-- 
2.21.0

