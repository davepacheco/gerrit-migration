From 68e25103c004d01e7e937ef0a183ac261a736a8f Mon Sep 17 00:00:00 2001
From: Pedro Palazon Candel <pedro@joyent.com>
Date: Fri, 4 Nov 2016 18:32:07 +0100
Subject: [PATCH] TOOLS-1601 `sdcadm insts` error when a CN is deleted Reviewed
 by: Trent Mick <trent.mick@joyent.com>

---
 lib/sdcadm.js | 13 +++++++++----
 1 file changed, 9 insertions(+), 4 deletions(-)

diff --git a/lib/sdcadm.js b/lib/sdcadm.js
index 4e3e4e5..8849c11 100644
--- a/lib/sdcadm.js
+++ b/lib/sdcadm.js
@@ -715,10 +715,15 @@ SdcAdm.prototype.listInsts = function listInsts(opts, cb) {
                 // 'server_uuid'.
                 if (vm.server_uuid) {
                     inst.server = vm.server_uuid;
-                    inst.hostname = ctx.serverFromUuid[
-                        vm.server_uuid].hostname;
-                    inst.server_ip = ctx.serverAdminIpFromUuid[
-                        vm.server_uuid];
+                    if (ctx.serverFromUuid[vm.server_uuid]) {
+                        inst.hostname = ctx.serverFromUuid[
+                            vm.server_uuid].hostname;
+                    }
+
+                    if (ctx.serverAdminIpFromUuid) {
+                        inst.server_ip = ctx.serverAdminIpFromUuid[
+                            vm.server_uuid];
+                    }
                 }
 
                 var adminIp = vm.nics.filter(function (nic) {
-- 
2.21.0

