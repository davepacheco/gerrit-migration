commit 8acae0dbf7c3ec3fdd4c45ad6e68a7cd9ff25a1b (refs/changes/49/849/2)
Author: Pedro Palazon Candel <pedro@joyent.com>
Date:   2016-11-04T18:36:10+01:00 (2 years, 11 months ago)
    
    TOOLS-1601 `sdcadm insts` error when a CN is deleted

diff --git a/lib/sdcadm.js b/lib/sdcadm.js
index 4e3e4e5..8849c11 100644
--- a/lib/sdcadm.js
+++ b/lib/sdcadm.js
@@ -715,10 +715,15 @@ SdcAdm.prototype.listInsts = function listInsts(opts, cb) {
                 // 'server_uuid'.
                 if (vm.server_uuid) {
                     inst.server = vm.server_uuid;
-                    inst.hostname = ctx.serverFromUuid[
-                        vm.server_uuid].hostname;
-                    inst.server_ip = ctx.serverAdminIpFromUuid[
-                        vm.server_uuid];
+                    if (ctx.serverFromUuid[vm.server_uuid]) {
+                        inst.hostname = ctx.serverFromUuid[
+                            vm.server_uuid].hostname;
+                    }
+
+                    if (ctx.serverAdminIpFromUuid) {
+                        inst.server_ip = ctx.serverAdminIpFromUuid[
+                            vm.server_uuid];
+                    }
                 }
 
                 var adminIp = vm.nics.filter(function (nic) {
