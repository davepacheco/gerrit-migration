{"project":"joyent/illumos-joyent","branch":"master","id":"Id78c4ca74e47a36eb7759ccc148b752017aef6bc","number":"2622","subject":"OS-6357 proto_promiscoff_req() doesn\u0027t always exit the MAC perimeter Reviewed by: Ryan Zezeski \u003crpz@joyent.com\u003e Reviewed by: Robert Mustacchi \u003crm@joyent.com\u003e Reviewed by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e Approved by: Patrick Mooney \u003cpatrick.moon","owner":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"url":"https://cr.joyent.us/2622","commitMessage":"OS-6357 proto_promiscoff_req() doesn\u0027t always exit the MAC perimeter\nReviewed by: Ryan Zezeski \u003crpz@joyent.com\u003e\nReviewed by: Robert Mustacchi \u003crm@joyent.com\u003e\nReviewed by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e\nApproved by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e\n","createdOn":1505866337,"lastUpdated":1505948608,"open":false,"status":"MERGED","comments":[{"timestamp":1505866337,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Uploaded patch set 1."},{"timestamp":1505866473,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 1:\n\nPretty much did what other functions in this file do:  \"failed\" \u003d\u003d\u003e bail w/o perimeter exit.  \"failed2\" \u003d\u003d\u003e bail with perimeter exit."},{"timestamp":1505876661,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Patch Set 1: Code-Review+1"},{"timestamp":1505913969,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Uploaded patch set 2: Commit message was updated."},{"timestamp":1505915696,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 2: Code-Review+1"},{"timestamp":1505918419,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 2:\n\nDrive-by: What are you thoughts about restructuring a little to knock down the \u0027goto\u0027 footprint here?  It seems like the conditions that lead to the accident in the first place are still present with the fix.\n\nThat being said, if you\u0027re happy with the state of things, I\u0027m fine with it too."},{"timestamp":1505921135,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 2:\n\n\u003e Drive-by: What are you thoughts about restructuring a little to\n \u003e knock down the \u0027goto\u0027 footprint here?\n\nThe perimeter hold must happen as early as it does.  That\u0027s the whole point of illumos#1918.  I\u0027m okay with goto reductions or other changes, but make sure we don\u0027t reintroduce the horror that was 1918."},{"timestamp":1505922370,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 2:\n\n\u003e I\u0027m okay with goto reductions or\n \u003e other changes, but make sure we don\u0027t reintroduce the horror that\n \u003e was 1918.\n\nI think I may have something.  Watch for the next patch set."},{"timestamp":1505922956,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Patch Set 2:\n\n\u003e Drive-by: What are you thoughts about restructuring a little to knock down the \u0027goto\u0027 footprint here?  It seems like the conditions that lead to the accident in the first place are still present with the fix.\nThat being said, if you\u0027re happy with the state of things, I\u0027m fine with it too.\n\nI had a similar thought at first but I think it\u0027s just a case of six in one half a dozen in another. Also, the way Dan did it is consistent with the rest of the file which I think is more important."},{"timestamp":1505923291,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 2:\n\nUpon further review...\n\nI wrote a less-goto-intensive manner of fixing this, but it ended up being not that easier to read, and as Ryan just pointed out, less consistent with the rest of the file. (Which I did audit for missing perimeter closes... only this function was lacking.)"},{"timestamp":1505923424,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Uploaded patch set 3: Patch Set 2 was rebased."},{"timestamp":1505923486,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Uploaded patch set 4: Commit message was updated."},{"timestamp":1505936872,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 4:\n\nTested under my own SmartOS environment both before and after, with the DTrace script in the bug report finding the bug before, and being silent after."},{"timestamp":1505937460,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 4: Code-Review+1 Integration-Approval+1"},{"timestamp":1505948442,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Uploaded patch set 5: Patch Set 4 was rebased."},{"timestamp":1505948532,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Uploaded patch set 6: Commit message was updated."},{"timestamp":1505948608,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Dan McDonald"}],"currentPatchSet":{"number":"6","revision":"d78c4ca74e47a36eb7759ccc148b752017aef6bc","parents":["99904952625e1dc1714a1b464929cc92420b01dc"],"ref":"refs/changes/22/2622/6","uploader":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"createdOn":1505948532,"author":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1505876661,"by":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1505915696,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1505937460,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1505937460,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"SUBM","value":"1","grantedOn":1505948608,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"usr/src/uts/common/io/dld/dld_proto.c","type":"MODIFIED","insertions":10,"deletions":-9}],"sizeInsertions":10,"sizeDeletions":-9},"patchSets":[{"number":"1","revision":"6fd9eec40c40daaf20155cd1ff4f5876daa92288","parents":["5f08c4f76a87c4eccd6faed949f31aae4d5c24ea"],"ref":"refs/changes/22/2622/1","uploader":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"createdOn":1505866337,"author":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1505876661,"by":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/io/dld/dld_proto.c","type":"MODIFIED","insertions":10,"deletions":-9}],"sizeInsertions":10,"sizeDeletions":-9},{"number":"2","revision":"97e877a1fba2b7c34a9d345bafb97fd63dfa429f","parents":["5f08c4f76a87c4eccd6faed949f31aae4d5c24ea"],"ref":"refs/changes/22/2622/2","uploader":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"createdOn":1505913969,"author":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1505915696,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1505876661,"by":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"usr/src/uts/common/io/dld/dld_proto.c","type":"MODIFIED","insertions":10,"deletions":-9}],"sizeInsertions":10,"sizeDeletions":-9},{"number":"3","revision":"05fa0b634a5db200dd0efd4929bd9572a35f42ba","parents":["97f2cda0aba36f25db5cda594bb8946108b944c7"],"ref":"refs/changes/22/2622/3","uploader":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"createdOn":1505923424,"author":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1505915696,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1505876661,"by":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"usr/src/uts/common/io/dld/dld_proto.c","type":"MODIFIED","insertions":10,"deletions":-9}],"sizeInsertions":10,"sizeDeletions":-9},{"number":"4","revision":"d1474271cd935a41dea0bf3d58cee1f024e66aeb","parents":["97f2cda0aba36f25db5cda594bb8946108b944c7"],"ref":"refs/changes/22/2622/4","uploader":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"createdOn":1505923486,"author":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1505915696,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1505937460,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1505937460,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1505876661,"by":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/uts/common/io/dld/dld_proto.c","type":"MODIFIED","insertions":10,"deletions":-9}],"sizeInsertions":10,"sizeDeletions":-9},{"number":"5","revision":"8964de4e85f2f87fc1b11f855171096005df4b30","parents":["99904952625e1dc1714a1b464929cc92420b01dc"],"ref":"refs/changes/22/2622/5","uploader":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"createdOn":1505948442,"author":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1505915696,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1505937460,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1505937460,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1505876661,"by":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/uts/common/io/dld/dld_proto.c","type":"MODIFIED","insertions":10,"deletions":-9}],"sizeInsertions":10,"sizeDeletions":-9},{"number":"6","revision":"d78c4ca74e47a36eb7759ccc148b752017aef6bc","parents":["99904952625e1dc1714a1b464929cc92420b01dc"],"ref":"refs/changes/22/2622/6","uploader":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"createdOn":1505948532,"author":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1505915696,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1505937460,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1505937460,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1505876661,"by":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"}},{"type":"SUBM","value":"1","grantedOn":1505948608,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"usr/src/uts/common/io/dld/dld_proto.c","type":"MODIFIED","insertions":10,"deletions":-9}],"sizeInsertions":10,"sizeDeletions":-9}],"allReviewers":[{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}]}