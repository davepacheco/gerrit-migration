{"project":"joyent/sdc-napi","branch":"master","id":"Id6f0b07982ba6f23b643c6296ed4f7edf3e563d0","number":"1913","subject":"NAPI-402 Require IPv4 resources in some NIC fields Reviewed by: Robert Mustacchi \u003crm@joyent.com\u003e Approved by: Jason King \u003cjason.king@joyent.com\u003e","owner":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"url":"https://cr.joyent.us/1913","commitMessage":"NAPI-402 Require IPv4 resources in some NIC fields\nReviewed by: Robert Mustacchi \u003crm@joyent.com\u003e\nApproved by: Jason King \u003cjason.king@joyent.com\u003e\n","createdOn":1494011884,"lastUpdated":1494890225,"open":false,"status":"MERGED","comments":[{"timestamp":1494011884,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 1."},{"timestamp":1494012100,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1494463026,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 1:\n\n(2 comments)\n\nIn general, I think this looks good. I have a few follow up notes."},{"timestamp":1494530587,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 1:\n\n(2 comments)"},{"timestamp":1494545496,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 2: Patch Set 1 was rebased."},{"timestamp":1494545581,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2:\n\n\"make check\" passed ok"},{"timestamp":1494614059,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 1:\n\n(2 comments)"},{"timestamp":1494871420,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 3: Patch Set 2 was rebased."},{"timestamp":1494871520,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3:\n\n\"make check\" passed ok"},{"timestamp":1494873417,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 4."},{"timestamp":1494873502,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 4:\n\n(2 comments)"},{"timestamp":1494873507,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1494875353,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 4: Code-Review+1"},{"timestamp":1494890125,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 4: Integration-Approval+1"},{"timestamp":1494890219,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 5: Commit message was updated."},{"timestamp":1494890225,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Cody Peter Mello"}],"currentPatchSet":{"number":"5","revision":"ae9673a3756e1318436ce16ca5cd53f59ec7742e","parents":["d2e3d228cd421b562ed0961d2754bfd1dfde175a"],"ref":"refs/changes/13/1913/5","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1494890219,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1494873507,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1494875353,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1494890125,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"SUBM","value":"1","grantedOn":1494890225,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/endpoints/networks/ips.js","type":"MODIFIED","insertions":9,"deletions":-6},{"file":"lib/models/ip/common.js","type":"MODIFIED","insertions":12,"deletions":0},{"file":"lib/models/network.js","type":"MODIFIED","insertions":36,"deletions":-60},{"file":"lib/models/nic/common.js","type":"MODIFIED","insertions":33,"deletions":-5},{"file":"lib/models/nic/create.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/models/nic/obj.js","type":"MODIFIED","insertions":2,"deletions":-18},{"file":"lib/models/nic/update.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/util/constants.js","type":"MODIFIED","insertions":3,"deletions":0},{"file":"lib/util/ip.js","type":"MODIFIED","insertions":17,"deletions":0},{"file":"lib/util/validate.js","type":"MODIFIED","insertions":20,"deletions":0},{"file":"test/unit/networks.test.js","type":"MODIFIED","insertions":51,"deletions":-22},{"file":"test/unit/nics.test.js","type":"MODIFIED","insertions":32,"deletions":-1},{"file":"test/unit/util-ip.test.js","type":"MODIFIED","insertions":52,"deletions":-1}],"sizeInsertions":271,"sizeDeletions":-117},"patchSets":[{"number":"1","revision":"02702090fc69f22698414028582280f78fef8708","parents":["28805916b4a1de5e483f505a1dc48ff570c7befb"],"ref":"refs/changes/13/1913/1","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1494011884,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1494012100,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/models/nic/common.js","line":275,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Do you believe that it\u0027s impossible to have both of these ever set?"},{"file":"lib/models/nic/common.js","line":275,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Yes. The validateNetwork() function first tries to find the network, and sets \"network\". If it can\u0027t find it, it finds the pool, and sets \"network_pool\". If both fail, then \"err\" is returned, and we don\u0027t make it here."},{"file":"lib/models/nic/common.js","line":275,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Yeah, I saw that flow, just wasn\u0027t sure if it was worth asserting this or not."},{"file":"lib/models/nic/common.js","line":275,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"I\u0027ve decided to leave this as it currently is."},{"file":"lib/util/ip.js","line":128,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"While this is strictly correct, I\u0027m not sure that it\u0027s necessarily what we want as fc00::/8 hasn\u0027t been assigned, it\u0027s not clear that we\u0027d want folks to allocate from it. That may not be the intent, but that\u0027s what this seems set up to make folks think we want."},{"file":"lib/util/ip.js","line":128,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"I could set this to fd00::/8, then. I mostly just wanted to make sure that we were returning more reasonable messages to attempts to create IPv6 fabrics."},{"file":"lib/util/ip.js","line":128,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"May just be worth adding a comment to specify its purpose in that regard. Not sure we need to change it, but just want to make sure we\u0027re thinking about it. I defer to your judgement on what you want to do here."},{"file":"lib/util/ip.js","line":128,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"I\u0027ve changed it to fd00::/8 and added a comment."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/endpoints/networks/ips.js","type":"MODIFIED","insertions":9,"deletions":-6},{"file":"lib/models/ip/common.js","type":"MODIFIED","insertions":12,"deletions":0},{"file":"lib/models/network.js","type":"MODIFIED","insertions":36,"deletions":-60},{"file":"lib/models/nic/common.js","type":"MODIFIED","insertions":33,"deletions":-5},{"file":"lib/models/nic/create.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/models/nic/obj.js","type":"MODIFIED","insertions":2,"deletions":-18},{"file":"lib/models/nic/update.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/util/constants.js","type":"MODIFIED","insertions":3,"deletions":0},{"file":"lib/util/ip.js","type":"MODIFIED","insertions":12,"deletions":0},{"file":"lib/util/validate.js","type":"MODIFIED","insertions":20,"deletions":0},{"file":"test/unit/networks.test.js","type":"MODIFIED","insertions":51,"deletions":-22},{"file":"test/unit/nics.test.js","type":"MODIFIED","insertions":32,"deletions":-1},{"file":"test/unit/util-ip.test.js","type":"MODIFIED","insertions":47,"deletions":-1}],"sizeInsertions":261,"sizeDeletions":-117},{"number":"2","revision":"e43a70d3d1b031c4d85f9a507e2f4f4317d442f0","parents":["7c46d4ffd8e1e3ed071b57185ac0afb9cd5e01f3"],"ref":"refs/changes/13/1913/2","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1494545496,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1494012100,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/endpoints/networks/ips.js","type":"MODIFIED","insertions":9,"deletions":-6},{"file":"lib/models/ip/common.js","type":"MODIFIED","insertions":12,"deletions":0},{"file":"lib/models/network.js","type":"MODIFIED","insertions":36,"deletions":-60},{"file":"lib/models/nic/common.js","type":"MODIFIED","insertions":33,"deletions":-5},{"file":"lib/models/nic/create.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/models/nic/obj.js","type":"MODIFIED","insertions":2,"deletions":-18},{"file":"lib/models/nic/update.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/util/constants.js","type":"MODIFIED","insertions":3,"deletions":0},{"file":"lib/util/ip.js","type":"MODIFIED","insertions":12,"deletions":0},{"file":"lib/util/validate.js","type":"MODIFIED","insertions":20,"deletions":0},{"file":"test/unit/networks.test.js","type":"MODIFIED","insertions":51,"deletions":-22},{"file":"test/unit/nics.test.js","type":"MODIFIED","insertions":32,"deletions":-1},{"file":"test/unit/util-ip.test.js","type":"MODIFIED","insertions":47,"deletions":-1}],"sizeInsertions":261,"sizeDeletions":-117},{"number":"3","revision":"0d7e0ce45b0bfdf9095974829ce70fd51eae6bde","parents":["d2e3d228cd421b562ed0961d2754bfd1dfde175a"],"ref":"refs/changes/13/1913/3","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1494871420,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1494012100,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/endpoints/networks/ips.js","type":"MODIFIED","insertions":9,"deletions":-6},{"file":"lib/models/ip/common.js","type":"MODIFIED","insertions":12,"deletions":0},{"file":"lib/models/network.js","type":"MODIFIED","insertions":36,"deletions":-60},{"file":"lib/models/nic/common.js","type":"MODIFIED","insertions":33,"deletions":-5},{"file":"lib/models/nic/create.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/models/nic/obj.js","type":"MODIFIED","insertions":2,"deletions":-18},{"file":"lib/models/nic/update.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/util/constants.js","type":"MODIFIED","insertions":3,"deletions":0},{"file":"lib/util/ip.js","type":"MODIFIED","insertions":12,"deletions":0},{"file":"lib/util/validate.js","type":"MODIFIED","insertions":20,"deletions":0},{"file":"test/unit/networks.test.js","type":"MODIFIED","insertions":51,"deletions":-22},{"file":"test/unit/nics.test.js","type":"MODIFIED","insertions":32,"deletions":-1},{"file":"test/unit/util-ip.test.js","type":"MODIFIED","insertions":47,"deletions":-1}],"sizeInsertions":261,"sizeDeletions":-117},{"number":"4","revision":"d6f0b07982ba6f23b643c6296ed4f7edf3e563d0","parents":["d2e3d228cd421b562ed0961d2754bfd1dfde175a"],"ref":"refs/changes/13/1913/4","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1494873417,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1494875353,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1494873507,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1494890125,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/endpoints/networks/ips.js","type":"MODIFIED","insertions":9,"deletions":-6},{"file":"lib/models/ip/common.js","type":"MODIFIED","insertions":12,"deletions":0},{"file":"lib/models/network.js","type":"MODIFIED","insertions":36,"deletions":-60},{"file":"lib/models/nic/common.js","type":"MODIFIED","insertions":33,"deletions":-5},{"file":"lib/models/nic/create.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/models/nic/obj.js","type":"MODIFIED","insertions":2,"deletions":-18},{"file":"lib/models/nic/update.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/util/constants.js","type":"MODIFIED","insertions":3,"deletions":0},{"file":"lib/util/ip.js","type":"MODIFIED","insertions":17,"deletions":0},{"file":"lib/util/validate.js","type":"MODIFIED","insertions":20,"deletions":0},{"file":"test/unit/networks.test.js","type":"MODIFIED","insertions":51,"deletions":-22},{"file":"test/unit/nics.test.js","type":"MODIFIED","insertions":32,"deletions":-1},{"file":"test/unit/util-ip.test.js","type":"MODIFIED","insertions":52,"deletions":-1}],"sizeInsertions":271,"sizeDeletions":-117},{"number":"5","revision":"ae9673a3756e1318436ce16ca5cd53f59ec7742e","parents":["d2e3d228cd421b562ed0961d2754bfd1dfde175a"],"ref":"refs/changes/13/1913/5","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1494890219,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1494875353,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"SUBM","value":"1","grantedOn":1494890225,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1494873507,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1494890125,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/endpoints/networks/ips.js","type":"MODIFIED","insertions":9,"deletions":-6},{"file":"lib/models/ip/common.js","type":"MODIFIED","insertions":12,"deletions":0},{"file":"lib/models/network.js","type":"MODIFIED","insertions":36,"deletions":-60},{"file":"lib/models/nic/common.js","type":"MODIFIED","insertions":33,"deletions":-5},{"file":"lib/models/nic/create.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/models/nic/obj.js","type":"MODIFIED","insertions":2,"deletions":-18},{"file":"lib/models/nic/update.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/util/constants.js","type":"MODIFIED","insertions":3,"deletions":0},{"file":"lib/util/ip.js","type":"MODIFIED","insertions":17,"deletions":0},{"file":"lib/util/validate.js","type":"MODIFIED","insertions":20,"deletions":0},{"file":"test/unit/networks.test.js","type":"MODIFIED","insertions":51,"deletions":-22},{"file":"test/unit/nics.test.js","type":"MODIFIED","insertions":32,"deletions":-1},{"file":"test/unit/util-ip.test.js","type":"MODIFIED","insertions":52,"deletions":-1}],"sizeInsertions":271,"sizeDeletions":-117}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}]}