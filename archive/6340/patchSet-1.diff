From 9c0d4aa242baa025de15f520432a7eff252a734c Mon Sep 17 00:00:00 2001
From: Alex Wilson <alex.wilson@joyent.com>
Date: Tue, 21 May 2019 14:35:52 -0700
Subject: [PATCH] TRITON-1690 update cloudapi node-mahi dep for new RBAC
 features

---
 lib/auth.js  | 3 ++-
 package.json | 2 +-
 2 files changed, 3 insertions(+), 2 deletions(-)

diff --git a/lib/auth.js b/lib/auth.js
index 2826fd8..9d95ae2 100644
--- a/lib/auth.js
+++ b/lib/auth.js
@@ -627,7 +627,8 @@ function authorize(req, res, next) {
                 'user-agent': req.headers['user-agent'],
                 sourceip: req.connection._xff,
                 method:   req.method.toLowerCase(),
-                activeRoles: activeRoles.map(function (r) { return (r.uuid); })
+                activeRoles: activeRoles.map(function (r) { return (r.uuid); }),
+                datacenter: req.config.datacenter_name
             }
         };
 
diff --git a/package.json b/package.json
index fad2cdb..6700250 100644
--- a/package.json
+++ b/package.json
@@ -30,7 +30,7 @@
         "keyapi": "git+https://github.com/joyent/keyapi.git#e14b3d582e1d9d338b7082d61f34ba8d1bbc540a",
         "krill": "1.0.1",
         "libuuid": "0.2.1",
-        "mahi": "2.0.1",
+        "mahi": "2.3.0",
         "mime": "1.2.7",
         "nodemailer": "0.7.1",
         "nopt": "2.0.0",
-- 
2.21.0

