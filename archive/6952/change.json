{"project":"joyent/muppet","branch":"master","id":"I3e006c3e23c9824bedc3880c00d005c8a226a000","number":"6952","subject":"MANTA-3479 want haproxy metrics from loadbalancer instances Reviewed by: Richard Kiene \u003crichard.kiene@joyent.com\u003e Approved by: Richard Kiene \u003crichard.kiene@joyent.com\u003e","owner":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"url":"https://cr.joyent.us/6952","commitMessage":"MANTA-3479 want haproxy metrics from loadbalancer instances\nReviewed by: Richard Kiene \u003crichard.kiene@joyent.com\u003e\nApproved by: Richard Kiene \u003crichard.kiene@joyent.com\u003e\n","createdOn":1570058171,"lastUpdated":1570495178,"open":false,"status":"MERGED","comments":[{"timestamp":1570058171,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Uploaded patch set 1."},{"timestamp":1570058205,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1570058248,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Uploaded patch set 2."},{"timestamp":1570058282,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1570060217,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Uploaded patch set 3."},{"timestamp":1570060251,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1570136585,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Uploaded patch set 4."},{"timestamp":1570136619,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1570136876,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Patch Set 4:\n\n(1 comment)"},{"timestamp":1570142798,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Uploaded patch set 5."},{"timestamp":1570142832,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1570492874,"reviewer":{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"},"message":"Patch Set 5:\n\n(4 comments)"},{"timestamp":1570493992,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Patch Set 5:\n\n(4 comments)"},{"timestamp":1570494009,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Uploaded patch set 6."},{"timestamp":1570494046,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 6: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1570494633,"reviewer":{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"},"message":"Patch Set 6: Code-Review+1 Integration-Approval+1"},{"timestamp":1570495158,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Uploaded patch set 7: Commit message was updated."},{"timestamp":1570495178,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Mohamed Khalfella"}],"currentPatchSet":{"number":"7","revision":"3e006c3e23c9824bedc3880c00d005c8a226a000","parents":["cf87c4f5f5ec8b4f9d3ee749e0b71dd99be9b02a"],"ref":"refs/changes/52/6952/7","uploader":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"createdOn":1570495158,"author":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1570494046,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1570494633,"by":{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1570494633,"by":{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"}},{"type":"SUBM","value":"1","grantedOn":1570495178,"by":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/app.js","type":"MODIFIED","insertions":23,"deletions":0},{"file":"lib/haproxy_sock.js","type":"MODIFIED","insertions":52,"deletions":-6},{"file":"lib/metrics_exporter.js","type":"ADDED","insertions":873,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"test/metrics_exports.test.js","type":"ADDED","insertions":128,"deletions":0}],"sizeInsertions":1078,"sizeDeletions":-7},"patchSets":[{"number":"1","revision":"ac0babe8b10ecdf9ea77c9c9efcb080c05abcc80","parents":["cf87c4f5f5ec8b4f9d3ee749e0b71dd99be9b02a"],"ref":"refs/changes/52/6952/1","uploader":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"createdOn":1570058171,"author":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1570058205,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/app.js","type":"MODIFIED","insertions":18,"deletions":0},{"file":"lib/haproxy_sock.js","type":"MODIFIED","insertions":16,"deletions":-2},{"file":"lib/metrics_exporter.js","type":"ADDED","insertions":868,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":0},{"file":"test/metrics_exports.test.js","type":"ADDED","insertions":121,"deletions":0}],"sizeInsertions":1024,"sizeDeletions":-2},{"number":"2","revision":"19a10018f99025fe5431c45f6baf5823e7d08377","parents":["cf87c4f5f5ec8b4f9d3ee749e0b71dd99be9b02a"],"ref":"refs/changes/52/6952/2","uploader":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"createdOn":1570058248,"author":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1570058282,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/app.js","type":"MODIFIED","insertions":18,"deletions":0},{"file":"lib/haproxy_sock.js","type":"MODIFIED","insertions":16,"deletions":-2},{"file":"lib/metrics_exporter.js","type":"ADDED","insertions":868,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"test/metrics_exports.test.js","type":"ADDED","insertions":121,"deletions":0}],"sizeInsertions":1025,"sizeDeletions":-3},{"number":"3","revision":"ce2922905227f6b40c84a2bfb2d43175ca81f1f6","parents":["cf87c4f5f5ec8b4f9d3ee749e0b71dd99be9b02a"],"ref":"refs/changes/52/6952/3","uploader":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"createdOn":1570060217,"author":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1570060251,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/app.js","line":62,"reviewer":{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"},"message":"Do we have to punt on this? What is stopping us from setting this value in metadata like binder and others?"},{"file":"lib/app.js","line":62,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Nothing is stopping us from doing that work. However, I think that work needs to be done on a separate ticket. So yes, we have punt on this for now."},{"file":"lib/metrics_exporter.js","line":844,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"It makes more sense to prefix these metrics with `loadbalancer` instead of `muppet` because they are related to haproxy -- which is the true loadbalancer. In the future, if we add metrics related to muppet, we can use `muppet` prefix."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/app.js","type":"MODIFIED","insertions":18,"deletions":0},{"file":"lib/haproxy_sock.js","type":"MODIFIED","insertions":16,"deletions":-2},{"file":"lib/metrics_exporter.js","type":"ADDED","insertions":868,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"test/metrics_exports.test.js","type":"ADDED","insertions":121,"deletions":0}],"sizeInsertions":1025,"sizeDeletions":-3},{"number":"4","revision":"0c309bab7e85f53aec9b4c6bae8fad7d986c3936","parents":["cf87c4f5f5ec8b4f9d3ee749e0b71dd99be9b02a"],"ref":"refs/changes/52/6952/4","uploader":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"createdOn":1570136585,"author":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1570136619,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/app.js","type":"MODIFIED","insertions":23,"deletions":0},{"file":"lib/haproxy_sock.js","type":"MODIFIED","insertions":52,"deletions":-6},{"file":"lib/metrics_exporter.js","type":"ADDED","insertions":872,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"test/metrics_exports.test.js","type":"ADDED","insertions":128,"deletions":0}],"sizeInsertions":1077,"sizeDeletions":-7},{"number":"5","revision":"cc775e3aefe8702a1ef2b3cf1e3e872ab0ce7e41","parents":["cf87c4f5f5ec8b4f9d3ee749e0b71dd99be9b02a"],"ref":"refs/changes/52/6952/5","uploader":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"createdOn":1570142798,"author":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1570142832,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/app.js","line":65,"reviewer":{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"},"message":"Why not do that as a part of this commit?"},{"file":"lib/app.js","line":65,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"We can certainly do all the work on a single commit. However, I don\u0027t think that work is related to how we export the metrics, which is what we are doing in this commit. Also, adding dynamic metric ports is not going to be useful until we start using Prometheus core instance, which we are not doing now."},{"file":"lib/metrics_exporter.js","line":51,"reviewer":{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"},"message":"s/arrary/array\n\nAlso it would probably be nice to call out that you\u0027re using the exact same metric names as are in the official HAProxy exporter."},{"file":"lib/metrics_exporter.js","line":51,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Fixed"},{"file":"lib/metrics_exporter.js","line":841,"reviewer":{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"},"message":"s/Strop/Stop/g"},{"file":"lib/metrics_exporter.js","line":841,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"fixed"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/app.js","type":"MODIFIED","insertions":23,"deletions":0},{"file":"lib/haproxy_sock.js","type":"MODIFIED","insertions":52,"deletions":-6},{"file":"lib/metrics_exporter.js","type":"ADDED","insertions":872,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"test/metrics_exports.test.js","type":"ADDED","insertions":128,"deletions":0}],"sizeInsertions":1077,"sizeDeletions":-7},{"number":"6","revision":"b3b001d92d2ae4f18c9b64305c08cb5bf7634e3e","parents":["cf87c4f5f5ec8b4f9d3ee749e0b71dd99be9b02a"],"ref":"refs/changes/52/6952/6","uploader":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"createdOn":1570494009,"author":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1570494046,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1570494633,"by":{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1570494633,"by":{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/app.js","type":"MODIFIED","insertions":23,"deletions":0},{"file":"lib/haproxy_sock.js","type":"MODIFIED","insertions":52,"deletions":-6},{"file":"lib/metrics_exporter.js","type":"ADDED","insertions":873,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"test/metrics_exports.test.js","type":"ADDED","insertions":128,"deletions":0}],"sizeInsertions":1078,"sizeDeletions":-7},{"number":"7","revision":"3e006c3e23c9824bedc3880c00d005c8a226a000","parents":["cf87c4f5f5ec8b4f9d3ee749e0b71dd99be9b02a"],"ref":"refs/changes/52/6952/7","uploader":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"createdOn":1570495158,"author":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1570494046,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1570494633,"by":{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1570494633,"by":{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"}},{"type":"SUBM","value":"1","grantedOn":1570495178,"by":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/app.js","type":"MODIFIED","insertions":23,"deletions":0},{"file":"lib/haproxy_sock.js","type":"MODIFIED","insertions":52,"deletions":-6},{"file":"lib/metrics_exporter.js","type":"ADDED","insertions":873,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"test/metrics_exports.test.js","type":"ADDED","insertions":128,"deletions":0}],"sizeInsertions":1078,"sizeDeletions":-7}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"},{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}]}