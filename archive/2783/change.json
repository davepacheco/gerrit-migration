{"project":"joyent/illumos-joyent","branch":"master","id":"Id9007788046bcbe2e8cdcbb51b85463b9f96d6ae","number":"2783","subject":"OS-6390 hati_demap_func should take pagesize into account Reviewed by: Robert Mustacchi \u003crm@joyent.com\u003e Reviewed by: Tim Kordas \u003ctim.kordas@joyent.com\u003e Approved by: Robert Mustacchi \u003crm@joyent.com\u003e","owner":{"name":"Sam Gwydir","email":"sam.gwydir@joyent.com","username":"gwydirsam"},"url":"https://cr.joyent.us/2783","commitMessage":"OS-6390 hati_demap_func should take pagesize into account\nReviewed by: Robert Mustacchi \u003crm@joyent.com\u003e\nReviewed by: Tim Kordas \u003ctim.kordas@joyent.com\u003e\nApproved by: Robert Mustacchi \u003crm@joyent.com\u003e\n","createdOn":1507932053,"lastUpdated":1509127329,"open":false,"status":"MERGED","comments":[{"timestamp":1507932053,"reviewer":{"name":"Sam Gwydir","email":"sam.gwydir@joyent.com","username":"gwydirsam"},"message":"Uploaded patch set 1."},{"timestamp":1507932488,"reviewer":{"name":"Sam Gwydir","email":"sam.gwydir@joyent.com","username":"gwydirsam"},"message":"Patch Set 1:\n\n(2 comments)"},{"timestamp":1507932620,"reviewer":{"name":"Sam Gwydir","email":"sam.gwydir@joyent.com","username":"gwydirsam"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1507937731,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 1:\n\n(4 comments)"},{"timestamp":1507938902,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Patch Set 1:\n\n(3 comments)"},{"timestamp":1508176495,"reviewer":{"name":"Sam Gwydir","email":"sam.gwydir@joyent.com","username":"gwydirsam"},"message":"Uploaded patch set 2."},{"timestamp":1508176508,"reviewer":{"name":"Sam Gwydir","email":"sam.gwydir@joyent.com","username":"gwydirsam"},"message":"Patch Set 2:\n\n(5 comments)"},{"timestamp":1508177343,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 2: Code-Review+1"},{"timestamp":1508185376,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Patch Set 2: Code-Review+1"},{"timestamp":1509124005,"reviewer":{"name":"Sam Gwydir","email":"sam.gwydir@joyent.com","username":"gwydirsam"},"message":"Patch Set 3: Patch Set 2 was rebased"},{"timestamp":1509125895,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 3: Integration-Approval+1"},{"timestamp":1509127310,"reviewer":{"name":"Sam Gwydir","email":"sam.gwydir@joyent.com","username":"gwydirsam"},"message":"Patch Set 4: Commit message was updated."},{"timestamp":1509127329,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Sam Gwydir"}],"currentPatchSet":{"number":"4","revision":"9b585dfd2bf2c7ba29cfa2e32228f85636b11e5c","parents":["99e0ea6f8add1cf97455a780f409f34b33c9d6d0"],"ref":"refs/changes/83/2783/4","uploader":{"name":"Sam Gwydir","email":"sam.gwydir@joyent.com","username":"gwydirsam"},"createdOn":1509127310,"author":{"name":"Sam Gwydir","email":"sam.gwydir@joyent.com","username":"gwydirsam"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1508177343,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1508185376,"by":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1509125895,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"SUBM","value":"1","grantedOn":1509127329,"by":{"name":"Sam Gwydir","email":"sam.gwydir@joyent.com","username":"gwydirsam"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/uts/i86pc/vm/hat_i86.c","type":"MODIFIED","insertions":36,"deletions":-26},{"file":"usr/src/uts/i86pc/vm/hat_pte.h","type":"MODIFIED","insertions":2,"deletions":0}],"sizeInsertions":38,"sizeDeletions":-26},"patchSets":[{"number":"1","revision":"f8626e1131cf300ab95d8c9511ddf939e357c76a","parents":["fbf515b2ad3675e210bb520b4b32cac85a0eb529"],"ref":"refs/changes/83/2783/1","uploader":{"name":"Sam Gwydir","email":"sam.gwydir@joyent.com","username":"gwydirsam"},"createdOn":1507932053,"author":{"name":"Sam Gwydir","email":"sam.gwydir@joyent.com","username":"gwydirsam"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/uts/i86pc/vm/hat_i86.c","line":31,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"You should leave this in place and just update the year. You don\u0027t need to move it to the bottom."},{"file":"usr/src/uts/i86pc/vm/hat_i86.c","line":31,"reviewer":{"name":"Sam Gwydir","email":"sam.gwydir@joyent.com","username":"gwydirsam"},"message":"Done"},{"file":"usr/src/uts/i86pc/vm/hat_i86.c","line":1919,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"This structure isn\u0027t yours originally, but I think we should add some additional docs to the comment.\n\nva: address\ncnt: count of entries\nlevel: specifies the size of entries in pages via the shift.."},{"file":"usr/src/uts/i86pc/vm/hat_i86.c","line":1919,"reviewer":{"name":"Sam Gwydir","email":"sam.gwydir@joyent.com","username":"gwydirsam"},"message":"Done"},{"file":"usr/src/uts/i86pc/vm/hat_i86.c","line":1927,"reviewer":{"name":"Sam Gwydir","email":"sam.gwydir@joyent.com","username":"gwydirsam"},"message":"There\u0027s an extraneous enter here that I didn\u0027t catch -- will fix in next patchset."},{"file":"usr/src/uts/i86pc/vm/hat_i86.c","line":2056,"reviewer":{"name":"Sam Gwydir","email":"sam.gwydir@joyent.com","username":"gwydirsam"},"message":"I debated back and forth on calculating len here or later in hati_demap_func because all the relevant information is inside range. I chose to leave it here because xen uses len. \n\nXen probably suffers from the same issue we do, so I could probably apply the same fix I did for i86pc but I\u0027m not sure how the shared memory promotion works inside that world -- so I\u0027m leaving it."},{"file":"usr/src/uts/i86pc/vm/hat_i86.c","line":2056,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I think it\u0027s reasonable to leave it that way for now."},{"file":"usr/src/uts/i86pc/vm/hat_i86.c","line":2056,"reviewer":{"name":"Sam Gwydir","email":"sam.gwydir@joyent.com","username":"gwydirsam"},"message":"Done"},{"file":"usr/src/uts/i86pc/vm/hat_i86.c","line":2184,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"add a comment \"1 page\""},{"file":"usr/src/uts/i86pc/vm/hat_i86.c","line":2184,"reviewer":{"name":"Sam Gwydir","email":"sam.gwydir@joyent.com","username":"gwydirsam"},"message":"Done"},{"file":"usr/src/uts/i86pc/vm/hat_i86.c","line":2185,"reviewer":{"name":"Sam Gwydir","email":"sam.gwydir@joyent.com","username":"gwydirsam"},"message":"LEVEL_SIZE(0) \u003d\u003d MMU_PAGESIZE -- so these are equivalent."},{"file":"usr/src/uts/i86pc/vm/hat_i86.c","line":2185,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"If there\u0027s no macro that can do the conversion, then we should add this to the comment at +2180 so that it\u0027s clear where it came from. While the rng_va and rng_cnt is pretty clear, rng_level is less so."},{"file":"usr/src/uts/i86pc/vm/hat_i86.c","line":2185,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"worth a comment that this is one MMU_PAGESIZE page."},{"file":"usr/src/uts/i86pc/vm/hat_i86.c","line":2361,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Isn\u0027t len unused now? We should probably either remove it or restore the use of it."},{"file":"usr/src/uts/i86pc/vm/hat_i86.c","line":2361,"reviewer":{"name":"Sam Gwydir","email":"sam.gwydir@joyent.com","username":"gwydirsam"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/i86pc/vm/hat_i86.c","type":"MODIFIED","insertions":37,"deletions":-24}],"sizeInsertions":37,"sizeDeletions":-24},{"number":"2","revision":"d9007788046bcbe2e8cdcbb51b85463b9f96d6ae","parents":["fbf515b2ad3675e210bb520b4b32cac85a0eb529"],"ref":"refs/changes/83/2783/2","uploader":{"name":"Sam Gwydir","email":"sam.gwydir@joyent.com","username":"gwydirsam"},"createdOn":1508176495,"author":{"name":"Sam Gwydir","email":"sam.gwydir@joyent.com","username":"gwydirsam"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1508177343,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1508185376,"by":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/i86pc/vm/hat_i86.c","type":"MODIFIED","insertions":36,"deletions":-26},{"file":"usr/src/uts/i86pc/vm/hat_pte.h","type":"MODIFIED","insertions":2,"deletions":0}],"sizeInsertions":38,"sizeDeletions":-26},{"number":"3","revision":"f0ba8ad0e404fb586fb0b71c2281f71a3eccbb6c","parents":["99e0ea6f8add1cf97455a780f409f34b33c9d6d0"],"ref":"refs/changes/83/2783/3","uploader":{"name":"Sam Gwydir","email":"sam.gwydir@joyent.com","username":"gwydirsam"},"createdOn":1509124005,"author":{"name":"Sam Gwydir","email":"sam.gwydir@joyent.com","username":"gwydirsam"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1508177343,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1509125895,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1508185376,"by":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/i86pc/vm/hat_i86.c","type":"MODIFIED","insertions":36,"deletions":-26},{"file":"usr/src/uts/i86pc/vm/hat_pte.h","type":"MODIFIED","insertions":2,"deletions":0}],"sizeInsertions":38,"sizeDeletions":-26},{"number":"4","revision":"9b585dfd2bf2c7ba29cfa2e32228f85636b11e5c","parents":["99e0ea6f8add1cf97455a780f409f34b33c9d6d0"],"ref":"refs/changes/83/2783/4","uploader":{"name":"Sam Gwydir","email":"sam.gwydir@joyent.com","username":"gwydirsam"},"createdOn":1509127310,"author":{"name":"Sam Gwydir","email":"sam.gwydir@joyent.com","username":"gwydirsam"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1508177343,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1509125895,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"SUBM","value":"1","grantedOn":1509127329,"by":{"name":"Sam Gwydir","email":"sam.gwydir@joyent.com","username":"gwydirsam"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1508185376,"by":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/uts/i86pc/vm/hat_i86.c","type":"MODIFIED","insertions":36,"deletions":-26},{"file":"usr/src/uts/i86pc/vm/hat_pte.h","type":"MODIFIED","insertions":2,"deletions":0}],"sizeInsertions":38,"sizeDeletions":-26}],"allReviewers":[{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},{"name":"Sam Gwydir","email":"sam.gwydir@joyent.com","username":"gwydirsam"}]}