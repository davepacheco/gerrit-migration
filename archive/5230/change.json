{"project":"joyent/node-triton-netconfig","branch":"master","id":"I5371f2c957939c331793d7b5f30cb8d4c89b6feb","number":"5230","subject":"TRITON-831 Create common module for triton and manta services/agents to determine networks Reviewed by: Trent Mick \u003ctrentm@gmail.com\u003e Approved by: Trent Mick \u003ctrentm@gmail.com\u003e","owner":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"url":"https://cr.joyent.us/5230","commitMessage":"TRITON-831 Create common module for triton and manta services/agents to determine networks\nReviewed by: Trent Mick \u003ctrentm@gmail.com\u003e\nApproved by: Trent Mick \u003ctrentm@gmail.com\u003e\n","createdOn":1544557352,"lastUpdated":1544649939,"open":false,"status":"MERGED","comments":[{"timestamp":1544557352,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 1."},{"timestamp":1544557367,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing-1\n\n\"make check\" exited with status 2\n\n fatal: ref HEAD is not a symbolic ref\n version is: 1.0.0\n [[ `cat package.json | json version` \u003d\u003d `grep \u0027^## \u0027 CHANGES.md | head -2 | tail -1 | awk \u0027{print $2}\u0027` ]]\n node node_modules/.bin/eslint  lib/index.js\n \n /tmp/repo/node_modules/eslint/bin/eslint.js:16\n const useStdIn \u003d (process.argv.indexOf(\"--stdin\") \u003e -1),\n ^^^^^\n SyntaxError: Use of const in strict mode.\n     at Module._compile (module.js:439:25)\n     at Object.Module._extensions..js (module.js:474:10)\n     at Module.load (module.js:356:32)\n     at Function.Module._load (module.js:312:12)\n     at Function.Module.runMain (module.js:497:10)\n     at startup (node.js:119:16)\n     at node.js:945:3\n tools/mk/Makefile.targ:201: recipe for target \u0027check-eslint\u0027 failed\n gmake: *** [check-eslint] Error 8"},{"timestamp":1544559710,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 2."},{"timestamp":1544559729,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing-1\n\n\"make check\" exited with status 2\n\n fatal: ref HEAD is not a symbolic ref\n version is: 1.0.0\n [[ `cat package.json | json version` \u003d\u003d `grep \u0027^## \u0027 CHANGES.md | head -2 | tail -1 | awk \u0027{print $2}\u0027` ]]\n node node_modules/.bin/eslint  lib/index.js\n \n /tmp/repo/node_modules/eslint/bin/eslint.js:16\n const useStdIn \u003d (process.argv.indexOf(\"--stdin\") \u003e -1),\n ^^^^^\n SyntaxError: Use of const in strict mode.\n     at Module._compile (module.js:439:25)\n     at Object.Module._extensions..js (module.js:474:10)\n     at Module.load (module.js:356:32)\n     at Function.Module._load (module.js:312:12)\n     at Function.Module.runMain (module.js:497:10)\n     at startup (node.js:119:16)\n     at node.js:945:3\n tools/mk/Makefile.targ:201: recipe for target \u0027check-eslint\u0027 failed\n gmake: *** [check-eslint] Error 8"},{"timestamp":1544563929,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 3."},{"timestamp":1544563947,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1544574750,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 3:\n\n(5 comments)\n\nOtherwise, LGTM."},{"timestamp":1544627016,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 4."},{"timestamp":1544627026,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Patch Set 3:\n\n(5 comments)"},{"timestamp":1544627035,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1544648648,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 4: Code-Review+1 Integration-Approval+1"},{"timestamp":1544649575,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 5: Commit message was updated."},{"timestamp":1544649939,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Rui"}],"currentPatchSet":{"number":"5","revision":"5371f2c957939c331793d7b5f30cb8d4c89b6feb","parents":["a1928e730d9a13c67bd75198558e08f32e6c3a9f"],"ref":"refs/changes/30/5230/5","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1544649575,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1544627035,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1544648648,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1544648648,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1544649939,"by":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":".eslintrc","type":"ADDED","insertions":19,"deletions":0},{"file":".gitignore","type":"ADDED","insertions":5,"deletions":0},{"file":"CHANGES.md","type":"ADDED","insertions":5,"deletions":0},{"file":"Makefile","type":"ADDED","insertions":110,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":91,"deletions":0},{"file":"lib/index.js","type":"ADDED","insertions":148,"deletions":0},{"file":"package.json","type":"ADDED","insertions":28,"deletions":0},{"file":"test/unit/main.test.js","type":"ADDED","insertions":155,"deletions":0},{"file":"test/unit/testdata.json","type":"ADDED","insertions":510,"deletions":0},{"file":"tools/mk/Makefile.defs","type":"ADDED","insertions":105,"deletions":0},{"file":"tools/mk/Makefile.deps","type":"ADDED","insertions":87,"deletions":0},{"file":"tools/mk/Makefile.node_modules.defs","type":"ADDED","insertions":68,"deletions":0},{"file":"tools/mk/Makefile.node_modules.targ","type":"ADDED","insertions":31,"deletions":0},{"file":"tools/mk/Makefile.node_prebuilt.defs","type":"ADDED","insertions":159,"deletions":0},{"file":"tools/mk/Makefile.node_prebuilt.targ","type":"ADDED","insertions":42,"deletions":0},{"file":"tools/mk/Makefile.targ","type":"ADDED","insertions":348,"deletions":0},{"file":"tools/pre-commit.sh","type":"ADDED","insertions":14,"deletions":0}],"sizeInsertions":1925,"sizeDeletions":0},"patchSets":[{"number":"1","revision":"300179c8cca7d6830bdced40d5b3ec5fee73a903","parents":["a1928e730d9a13c67bd75198558e08f32e6c3a9f"],"ref":"refs/changes/30/5230/1","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1544557352,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1544557367,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".gitignore","type":"ADDED","insertions":5,"deletions":0},{"file":"CHANGES.md","type":"ADDED","insertions":5,"deletions":0},{"file":"Makefile","type":"ADDED","insertions":96,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":96,"deletions":0},{"file":"lib/index.js","type":"ADDED","insertions":148,"deletions":0},{"file":"package.json","type":"ADDED","insertions":26,"deletions":0},{"file":"test/unit/main.test.js","type":"ADDED","insertions":155,"deletions":0},{"file":"test/unit/testdata.json","type":"ADDED","insertions":510,"deletions":0},{"file":"tools/mk/Makefile.defs","type":"ADDED","insertions":105,"deletions":0},{"file":"tools/mk/Makefile.deps","type":"ADDED","insertions":87,"deletions":0},{"file":"tools/mk/Makefile.node_modules.defs","type":"ADDED","insertions":68,"deletions":0},{"file":"tools/mk/Makefile.node_modules.targ","type":"ADDED","insertions":31,"deletions":0},{"file":"tools/mk/Makefile.targ","type":"ADDED","insertions":345,"deletions":0},{"file":"tools/pre-commit.sh","type":"ADDED","insertions":14,"deletions":0}],"sizeInsertions":1691,"sizeDeletions":0},{"number":"2","revision":"8b17ff1e253ebf0bd13ace82373dda5325160a84","parents":["a1928e730d9a13c67bd75198558e08f32e6c3a9f"],"ref":"refs/changes/30/5230/2","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1544559710,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1544559729,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".gitignore","type":"ADDED","insertions":5,"deletions":0},{"file":"CHANGES.md","type":"ADDED","insertions":5,"deletions":0},{"file":"Makefile","type":"ADDED","insertions":103,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":96,"deletions":0},{"file":"lib/index.js","type":"ADDED","insertions":148,"deletions":0},{"file":"package.json","type":"ADDED","insertions":26,"deletions":0},{"file":"test/unit/main.test.js","type":"ADDED","insertions":155,"deletions":0},{"file":"test/unit/testdata.json","type":"ADDED","insertions":510,"deletions":0},{"file":"tools/mk/Makefile.defs","type":"ADDED","insertions":105,"deletions":0},{"file":"tools/mk/Makefile.deps","type":"ADDED","insertions":87,"deletions":0},{"file":"tools/mk/Makefile.node_modules.defs","type":"ADDED","insertions":68,"deletions":0},{"file":"tools/mk/Makefile.node_modules.targ","type":"ADDED","insertions":31,"deletions":0},{"file":"tools/mk/Makefile.targ","type":"ADDED","insertions":345,"deletions":0},{"file":"tools/pre-commit.sh","type":"ADDED","insertions":14,"deletions":0}],"sizeInsertions":1698,"sizeDeletions":0},{"number":"3","revision":"335703a6822016aba19bc79fb8cb3908eeee6c0e","parents":["a1928e730d9a13c67bd75198558e08f32e6c3a9f"],"ref":"refs/changes/30/5230/3","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1544563929,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1544563947,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"Makefile","line":97,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"This is totally my fault, because this comes from the boilerplate module, but perhaps we should make this `\"v$$ver\"` because while we have both patterns in our various node module repos, I think there is a slight preference in node-land for \"v1.2.3\" over \"1.2.3\" for tag names."},{"file":"Makefile","line":97,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"},{"file":"README.md","line":74,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Could just drop this section?  THis was a pretty poor and incomplete section from the boilerplate repo."},{"file":"README.md","line":74,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"},{"file":"package.json","line":2,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Drop the \"node-\" here."},{"file":"package.json","line":2,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"},{"file":"package.json","line":17,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Add a:\n\n    \"files\": [\"lib\"],\n\nwhich is one way (https://docs.npmjs.com/files/package.json#files) to limit which files are included in the published npm bits. Another way is .npmignore. I\u0027m preferring \"files\" these days because it is an explicit include list (whitelist) rather than an exclude list which can surprisingly add stuff if one has files kicking around in ones working copy when publishing.\n\nWithout that \"files\" entry:\n\n```\n$ npm pack \u003e/dev/null \u0026\u0026 tar tf node-triton-netconfig-1.0.0.tgz\npackage/package.json\npackage/.npmignore\npackage/README.md\npackage/LICENSE\npackage/Makefile\npackage/CHANGES.md\npackage/lib/index.js\npackage/test/unit/main.test.js\npackage/test/unit/testdata.json\npackage/.eslintrc\npackage/tools/mk/Makefile.defs\npackage/tools/mk/Makefile.deps\npackage/tools/mk/Makefile.node_modules.defs\npackage/tools/mk/Makefile.node_modules.targ\npackage/tools/mk/Makefile.node_prebuilt.defs\npackage/tools/mk/Makefile.node_prebuilt.targ\npackage/tools/mk/Makefile.targ\npackage/tools/pre-commit.sh\n```\n\nand with it here is what would be published:\n\n```\n$ npm pack \u003e/dev/null \u0026\u0026 tar tf node-triton-netconfig-1.0.0.tgz\npackage/package.json\npackage/README.md\npackage/LICENSE\npackage/CHANGES.md\npackage/lib/index.js\n```"},{"file":"package.json","line":17,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"},{"file":"package.json","line":20,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"missing \u0027jsprim\u0027 dep in here:\n\n```\n./node_modules/.bin/tap --jobs\u003d4 --output-file\u003d/Users/trentm/joy/node-triton-netconfig/build/test.unit.tap test/unit/**/*.test.js\nError: Cannot find module \u0027jsprim\u0027\n    at Function.Module._resolveFilename (module.js:325:15)\n    at Function.Module._load (module.js:276:25)\n    at Module.require (module.js:353:17)\n    at require (internal/module.js:12:17)\n    at Object.\u003canonymous\u003e (/Users/trentm/joy/node-triton-netconfig/test/unit/main.test.js:15:16)\n```"},{"file":"package.json","line":20,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"added."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".eslintrc","type":"ADDED","insertions":19,"deletions":0},{"file":".gitignore","type":"ADDED","insertions":5,"deletions":0},{"file":"CHANGES.md","type":"ADDED","insertions":5,"deletions":0},{"file":"Makefile","type":"ADDED","insertions":110,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":96,"deletions":0},{"file":"lib/index.js","type":"ADDED","insertions":148,"deletions":0},{"file":"package.json","type":"ADDED","insertions":26,"deletions":0},{"file":"test/unit/main.test.js","type":"ADDED","insertions":155,"deletions":0},{"file":"test/unit/testdata.json","type":"ADDED","insertions":510,"deletions":0},{"file":"tools/mk/Makefile.defs","type":"ADDED","insertions":105,"deletions":0},{"file":"tools/mk/Makefile.deps","type":"ADDED","insertions":87,"deletions":0},{"file":"tools/mk/Makefile.node_modules.defs","type":"ADDED","insertions":68,"deletions":0},{"file":"tools/mk/Makefile.node_modules.targ","type":"ADDED","insertions":31,"deletions":0},{"file":"tools/mk/Makefile.node_prebuilt.defs","type":"ADDED","insertions":159,"deletions":0},{"file":"tools/mk/Makefile.node_prebuilt.targ","type":"ADDED","insertions":42,"deletions":0},{"file":"tools/mk/Makefile.targ","type":"ADDED","insertions":348,"deletions":0},{"file":"tools/pre-commit.sh","type":"ADDED","insertions":14,"deletions":0}],"sizeInsertions":1928,"sizeDeletions":0},{"number":"4","revision":"c38c3509035b5cd31d884d8f693ab2adea47ae2e","parents":["a1928e730d9a13c67bd75198558e08f32e6c3a9f"],"ref":"refs/changes/30/5230/4","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1544627016,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1544627035,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1544648648,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1544648648,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".eslintrc","type":"ADDED","insertions":19,"deletions":0},{"file":".gitignore","type":"ADDED","insertions":5,"deletions":0},{"file":"CHANGES.md","type":"ADDED","insertions":5,"deletions":0},{"file":"Makefile","type":"ADDED","insertions":110,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":91,"deletions":0},{"file":"lib/index.js","type":"ADDED","insertions":148,"deletions":0},{"file":"package.json","type":"ADDED","insertions":28,"deletions":0},{"file":"test/unit/main.test.js","type":"ADDED","insertions":155,"deletions":0},{"file":"test/unit/testdata.json","type":"ADDED","insertions":510,"deletions":0},{"file":"tools/mk/Makefile.defs","type":"ADDED","insertions":105,"deletions":0},{"file":"tools/mk/Makefile.deps","type":"ADDED","insertions":87,"deletions":0},{"file":"tools/mk/Makefile.node_modules.defs","type":"ADDED","insertions":68,"deletions":0},{"file":"tools/mk/Makefile.node_modules.targ","type":"ADDED","insertions":31,"deletions":0},{"file":"tools/mk/Makefile.node_prebuilt.defs","type":"ADDED","insertions":159,"deletions":0},{"file":"tools/mk/Makefile.node_prebuilt.targ","type":"ADDED","insertions":42,"deletions":0},{"file":"tools/mk/Makefile.targ","type":"ADDED","insertions":348,"deletions":0},{"file":"tools/pre-commit.sh","type":"ADDED","insertions":14,"deletions":0}],"sizeInsertions":1925,"sizeDeletions":0},{"number":"5","revision":"5371f2c957939c331793d7b5f30cb8d4c89b6feb","parents":["a1928e730d9a13c67bd75198558e08f32e6c3a9f"],"ref":"refs/changes/30/5230/5","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1544649575,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1544627035,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1544648648,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1544648648,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1544649939,"by":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":".eslintrc","type":"ADDED","insertions":19,"deletions":0},{"file":".gitignore","type":"ADDED","insertions":5,"deletions":0},{"file":"CHANGES.md","type":"ADDED","insertions":5,"deletions":0},{"file":"Makefile","type":"ADDED","insertions":110,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":91,"deletions":0},{"file":"lib/index.js","type":"ADDED","insertions":148,"deletions":0},{"file":"package.json","type":"ADDED","insertions":28,"deletions":0},{"file":"test/unit/main.test.js","type":"ADDED","insertions":155,"deletions":0},{"file":"test/unit/testdata.json","type":"ADDED","insertions":510,"deletions":0},{"file":"tools/mk/Makefile.defs","type":"ADDED","insertions":105,"deletions":0},{"file":"tools/mk/Makefile.deps","type":"ADDED","insertions":87,"deletions":0},{"file":"tools/mk/Makefile.node_modules.defs","type":"ADDED","insertions":68,"deletions":0},{"file":"tools/mk/Makefile.node_modules.targ","type":"ADDED","insertions":31,"deletions":0},{"file":"tools/mk/Makefile.node_prebuilt.defs","type":"ADDED","insertions":159,"deletions":0},{"file":"tools/mk/Makefile.node_prebuilt.targ","type":"ADDED","insertions":42,"deletions":0},{"file":"tools/mk/Makefile.targ","type":"ADDED","insertions":348,"deletions":0},{"file":"tools/pre-commit.sh","type":"ADDED","insertions":14,"deletions":0}],"sizeInsertions":1925,"sizeDeletions":0}],"allReviewers":[{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"}]}