{"project":"joyent/manta-muskie","branch":"master","id":"I612b0d734be50e424bf477b99c63eecae23ec3a5","number":"2434","subject":"MANTA-3368 MPU commit does not return the computed MD5 Reviewed by: Jordan Hendricks \u003cjordan.hendricks@joyent.com\u003e Reviewed by: David Pacheco \u003cdap@joyent.com\u003e Approved by: Jordan Hendricks \u003cjordan.hendricks@joyent.com\u003e","owner":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"url":"https://cr.joyent.us/2434","commitMessage":"MANTA-3368 MPU commit does not return the computed MD5\nReviewed by: Jordan Hendricks \u003cjordan.hendricks@joyent.com\u003e\nReviewed by: David Pacheco \u003cdap@joyent.com\u003e\nApproved by: Jordan Hendricks \u003cjordan.hendricks@joyent.com\u003e\n","createdOn":1503104155,"lastUpdated":1504737726,"open":false,"status":"MERGED","comments":[{"timestamp":1503104155,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Uploaded patch set 1."},{"timestamp":1503104188,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1503337164,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Patch Set 1: Code-Review+1"},{"timestamp":1503341834,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Patch Set 1:\n\nFor IA, I think it would also be good to see the output of an `mmpu commit -v` piped to bunyan so that it\u0027s clear the header is in the response."},{"timestamp":1503511974,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Patch Set 1:\n\nSorry, I should\u0027ve probably mentioned this earlier -- I think in the manual tests we should also show that the computed-md5 header matches the MD5 value on the object record of the final committed object as well."},{"timestamp":1503520100,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 1:\n\n(1 comment)\n\nCan we add a test case for this that also checks that the computed-md5 matches what we expect for a given piece of content?"},{"timestamp":1503520299,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1503529432,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Uploaded patch set 2."},{"timestamp":1503529465,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1503601188,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 2:\n\n(5 comments)"},{"timestamp":1503610820,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Patch Set 2:\n\n(5 comments)"},{"timestamp":1503612374,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1503616715,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Uploaded patch set 3."},{"timestamp":1503616753,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1503617036,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Patch Set 3:\n\n(1 comment)"},{"timestamp":1503617333,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Uploaded patch set 4."},{"timestamp":1503617386,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1503617406,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Uploaded patch set 5."},{"timestamp":1503617450,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1503620605,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 5:\n\n(1 comment)"},{"timestamp":1503620619,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 5:\n\nI meant to mention: the rest looks great!  Thanks for adding the test."},{"timestamp":1503683304,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Patch Set 5:\n\n(1 comment)"},{"timestamp":1504302532,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Uploaded patch set 6."},{"timestamp":1504302565,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 6: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1504627097,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Patch Set 6:\n\n(3 comments)\n\nThanks for the updates. I have a few more comments about the new test."},{"timestamp":1504631359,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Patch Set 6:\n\n(2 comments)"},{"timestamp":1504633321,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Uploaded patch set 7."},{"timestamp":1504633360,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 7: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1504633483,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Uploaded patch set 8."},{"timestamp":1504633522,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 8: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1504638073,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 8: Code-Review+1"},{"timestamp":1504644154,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Patch Set 8:\n\nHave the testing notes been updated? I wouldn\u0027t expect `mpu-get` to expose the computedMD5 (I\u0027m thinking that\u0027s a holdover from the previous implementation).\n\nFor the manual testing, it\u0027s good that we test the zero-byte MPUs. It would be good to test some non-zero byte MPUs as well (perhaps 1 or 2 parts)."},{"timestamp":1504644190,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Patch Set 8: Code-Review+1"},{"timestamp":1504661472,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Patch Set 8:\n\nI\u0027ve updated the testing notes. With regards to mpu-get: the behavior I\u0027m seeing is that partsMD5Summary is returned if the UUID corresponds to a multipart upload that has already been committed, but not if it hasn\u0027t yet been committed - this is the same behavior I see on the master branch. Am I missing something here?"},{"timestamp":1504716551,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Patch Set 8:\n\n\u003e I\u0027ve updated the testing notes. With regards to mpu-get: the\n \u003e behavior I\u0027m seeing is that partsMD5Summary is returned if the UUID\n \u003e corresponds to a multipart upload that has already been committed,\n \u003e but not if it hasn\u0027t yet been committed - this is the same behavior\n \u003e I see on the master branch. Am I missing something here?\n\nThat\u0027s right for the `partsMD5DSummary` value, but that represents something different from the value returned in the \"Content-MD5\" header. The `partsMD5Summary` is the MD5 sum of the etags of all the parts committed, in order. This is useful for the client to confirm that the parts they thought were committed for an MPU are the same as what was committed. The Content-MD5 represents the value of the object that was committed by an MPU, and I don\u0027t think that is returned by `mpu-get`. \n\nNote that in the case of a zero-byte MPU, there are no parts (and thus no etags to MD5 sum), so `partsMD5Summary` and Content-MD5 values will be the same."},{"timestamp":1504732785,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Patch Set 8: Integration-Approval+1"},{"timestamp":1504732798,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Patch Set 8:\n\nLooks good! Thanks for being so thorough in testing."},{"timestamp":1504736839,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Uploaded patch set 9."},{"timestamp":1504736873,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 9: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1504737033,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Patch Set 10: Commit message was updated."},{"timestamp":1504737655,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Patch Set 10: Code-Review+1 Integration-Approval+1"},{"timestamp":1504737726,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Jan Wyszynski"}],"currentPatchSet":{"number":"10","revision":"6bc61b0034f83a303ce1c29ac345cc2592ce6990","parents":["d7bc4e23cf25eeb67cec242c3ac7ad4fa0f8389b"],"ref":"refs/changes/34/2434/10","uploader":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"createdOn":1504737033,"author":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1504736873,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1504737655,"by":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1504737655,"by":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"}},{"type":"SUBM","value":"1","grantedOn":1504737726,"by":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"lib/uploads/commit.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/mpu/commit.test.js","type":"MODIFIED","insertions":59,"deletions":0},{"file":"test/mpu/helper.js","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":64,"sizeDeletions":-4},"patchSets":[{"number":"1","revision":"3ee93841e356b31d325a68070b6a054462694c7e","parents":["c69a24c82305739298e3d41cfcd73fafd0b4be66"],"ref":"refs/changes/34/2434/1","uploader":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"createdOn":1503104155,"author":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1503104188,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1503337164,"by":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"}}],"comments":[{"file":"lib/uploads/commit.js","line":519,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Is this the right md5sum?  I would have thought it would have been \"md5\" in this context.  I thought this was the md5sum of the list of parts uploaded."},{"file":"lib/uploads/commit.js","line":519,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"I think this explains the behavior I noticed in the ticket (that is, the partsMD5Summary matches the content-md5)."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/uploads/commit.js","type":"MODIFIED","insertions":1,"deletions":0}],"sizeInsertions":1,"sizeDeletions":0},{"number":"2","revision":"a9480d770aa0a090421698f101d9a13ab1f117d1","parents":["c69a24c82305739298e3d41cfcd73fafd0b4be66"],"ref":"refs/changes/34/2434/2","uploader":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"createdOn":1503529432,"author":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1503529465,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"test/mpu/commit.test.js","line":115,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"This test looks good, but I was also envisioning that we would check against the md5 we actually expect here (to catch the bug from the earlier patchset)."},{"file":"test/mpu/commit.test.js","line":115,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"What do you mean by \"against the md5 we actually expect here\"? I was under the impression that the expected md5 was the one returned in the content-md5 field of the minfo endpoint?"},{"file":"test/mpu/commit.test.js","line":115,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I mean the md5 checksum of the data that we actually uploaded.  That\u0027s a property of the data itself, not anything Manta does.  See, for example, the \"put/get zero bytes\" test, which checks the returned md5sum against a specific checksum (which presumably the author calculated when they wrote the test)."},{"file":"test/mpu/commit.test.js","line":117,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I think this would be clearer with vasync.waterfall (you wouldn\u0027t need err3, err4, etc., and the indenting wouldn\u0027t increase with each level)."},{"file":"test/mpu/commit.test.js","line":117,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Okay, will change it to use that."},{"file":"test/mpu/commit.test.js","line":122,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"This doesn\u0027t seem used except on the next line.  Should we just use \"0\" directly there?"},{"file":"test/mpu/commit.test.js","line":122,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Yeah, I was emulating a pattern I saw in some other tests, but it does make sense to just pass in a \"0.\""},{"file":"test/mpu/commit.test.js","line":124,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Is this supposed to say something like \"upload part\"?"},{"file":"test/mpu/commit.test.js","line":124,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Will change."},{"file":"test/mpu/commit.test.js","line":149,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Should we fail the test in the case the `info` isn\u0027t present?"},{"file":"test/mpu/helper.js","line":340,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"This change depends on https://cr.joyent.us/#/c/2448/. Once it is reviewed and integrated I will update package.json to reflect this dependency."},{"file":"test/mpu/helper.js","line":342,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Same comment as elsewhere about this."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/uploads/commit.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"test/mpu/commit.test.js","type":"MODIFIED","insertions":45,"deletions":0},{"file":"test/mpu/helper.js","type":"MODIFIED","insertions":3,"deletions":-3}],"sizeInsertions":49,"sizeDeletions":-3},{"number":"3","revision":"8b09a444fffcde282603db95c61c25b460597fe5","parents":["c69a24c82305739298e3d41cfcd73fafd0b4be66"],"ref":"refs/changes/34/2434/3","uploader":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"createdOn":1503616715,"author":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1503616753,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"package.json","line":36,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"need this version bump to use vasync.waterfall"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/uploads/commit.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/mpu/commit.test.js","type":"MODIFIED","insertions":55,"deletions":0},{"file":"test/mpu/helper.js","type":"MODIFIED","insertions":3,"deletions":-3}],"sizeInsertions":61,"sizeDeletions":-5},{"number":"4","revision":"991db9db1da48c019f3624e753097749128b945b","parents":["c69a24c82305739298e3d41cfcd73fafd0b4be66"],"ref":"refs/changes/34/2434/4","uploader":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"createdOn":1503617333,"author":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1503617386,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/uploads/commit.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/mpu/commit.test.js","type":"MODIFIED","insertions":59,"deletions":0},{"file":"test/mpu/helper.js","type":"MODIFIED","insertions":3,"deletions":-3}],"sizeInsertions":65,"sizeDeletions":-5},{"number":"5","revision":"d8ea6ef63ffeba08f4003676a85feb4140aba22c","parents":["c69a24c82305739298e3d41cfcd73fafd0b4be66"],"ref":"refs/changes/34/2434/5","uploader":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"createdOn":1503617406,"author":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1503617450,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"package.json","line":43,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Seems like this needs to be updated before integration."},{"file":"package.json","line":43,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Right,  I forgot that I\u0027m depending on another change here. Will ping Alex about the dependency."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/uploads/commit.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/mpu/commit.test.js","type":"MODIFIED","insertions":59,"deletions":0},{"file":"test/mpu/helper.js","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":64,"sizeDeletions":-4},{"number":"6","revision":"3b328fc5bc5e0e45931b51e2178488b96bf7fea1","parents":["c69a24c82305739298e3d41cfcd73fafd0b4be66"],"ref":"refs/changes/34/2434/6","uploader":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"createdOn":1504302532,"author":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1504302565,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"test/mpu/commit.test.js","line":121,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Shouldn\u0027t we be failing the test if there\u0027s an error? Same for the other cases."},{"file":"test/mpu/commit.test.js","line":121,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Update after talking offline: The possible errors encountered at each stage in the waterfall should fail due to the use of `t.ifError()` within the `ifErr` helper. I suggested we should fail the test with a more explicit error message if possible, but I defer to your judgment here."},{"file":"test/mpu/commit.test.js","line":160,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Wouldn\u0027t we also expect the test to fail if there\u0027s no `info` object returned?"},{"file":"test/mpu/commit.test.js","line":160,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Update after talking offline: This test will fail if the expression in line 159 isn\u0027t truthy, but I think it would be nice here, and for all possible failures, to give an explicit failure message (either passed to t.ok() or passed to t.fail())."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/uploads/commit.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/mpu/commit.test.js","type":"MODIFIED","insertions":59,"deletions":0},{"file":"test/mpu/helper.js","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":64,"sizeDeletions":-4},{"number":"7","revision":"d3b02d046a3156043864aa384d34fd03edda32bc","parents":["c69a24c82305739298e3d41cfcd73fafd0b4be66"],"ref":"refs/changes/34/2434/7","uploader":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"createdOn":1504633321,"author":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1504633360,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/uploads/commit.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/mpu/commit.test.js","type":"MODIFIED","insertions":63,"deletions":0},{"file":"test/mpu/helper.js","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":68,"sizeDeletions":-4},{"number":"8","revision":"31a7d8b8631390a25d441c6bc7d708bf6924d291","parents":["c69a24c82305739298e3d41cfcd73fafd0b4be66"],"ref":"refs/changes/34/2434/8","uploader":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"createdOn":1504633483,"author":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1504638073,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1504633522,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1504644190,"by":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1504732785,"by":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/uploads/commit.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/mpu/commit.test.js","type":"MODIFIED","insertions":59,"deletions":0},{"file":"test/mpu/helper.js","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":64,"sizeDeletions":-4},{"number":"9","revision":"612b0d734be50e424bf477b99c63eecae23ec3a5","parents":["d7bc4e23cf25eeb67cec242c3ac7ad4fa0f8389b"],"ref":"refs/changes/34/2434/9","uploader":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"createdOn":1504736839,"author":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1504736873,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/uploads/commit.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/mpu/commit.test.js","type":"MODIFIED","insertions":59,"deletions":0},{"file":"test/mpu/helper.js","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":64,"sizeDeletions":-4},{"number":"10","revision":"6bc61b0034f83a303ce1c29ac345cc2592ce6990","parents":["d7bc4e23cf25eeb67cec242c3ac7ad4fa0f8389b"],"ref":"refs/changes/34/2434/10","uploader":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"createdOn":1504737033,"author":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1504736873,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1504737655,"by":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1504737655,"by":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"}},{"type":"SUBM","value":"1","grantedOn":1504737726,"by":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"lib/uploads/commit.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/mpu/commit.test.js","type":"MODIFIED","insertions":59,"deletions":0},{"file":"test/mpu/helper.js","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":64,"sizeDeletions":-4}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"}]}