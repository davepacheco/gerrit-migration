{"project":"joyent/sdc-docker","branch":"master","topic":"DOCKER-1101","id":"I6cfc0bdb2568beb76d2f5e1a018598ee5a5fcb9a","number":"2545","subject":"DOCKER-1101 Cleanup containers.js","owner":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"url":"https://cr.joyent.us/2545","commitMessage":"DOCKER-1101 Cleanup containers.js\n","createdOn":1505190189,"lastUpdated":1538503854,"open":false,"status":"ABANDONED","comments":[{"timestamp":1505190189,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Uploaded patch set 1."},{"timestamp":1505190227,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing-1\n\n(5 comments)\n\n\"make check\" exited with status 2"},{"timestamp":1505205246,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Uploaded patch set 2."},{"timestamp":1505205280,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing-1\n\n(5 comments)\n\n\"make check\" exited with status 2"},{"timestamp":1505239315,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Uploaded patch set 3."},{"timestamp":1505239354,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing-1\n\n(9 comments)\n\n\"make check\" exited with status 2"},{"timestamp":1505242603,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Uploaded patch set 4: Patch Set 3 was rebased."},{"timestamp":1505242646,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4:\n\n(9 comments)\n\n\"make check\" exited with status 2"},{"timestamp":1505375915,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Uploaded patch set 5."},{"timestamp":1505375953,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing-1\n\n(5 comments)\n\n\"make check\" exited with status 2"},{"timestamp":1505376303,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Uploaded patch set 6."},{"timestamp":1505376336,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 6: CI-Testing-1\n\n(1 comment)\n\n\"make check\" exited with status 2"},{"timestamp":1505376351,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Topic set to DOCKER-1101"},{"timestamp":1505376489,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Uploaded patch set 7."},{"timestamp":1505376532,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 7: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1505427731,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Uploaded patch set 8."},{"timestamp":1505427771,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 8: CI-Testing-1\n\n(3 comments)\n\n\"make check\" exited with status 2"},{"timestamp":1505427896,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Patch Set 9: Commit message was updated."},{"timestamp":1505427951,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Patch Set 10: Commit message was updated."},{"timestamp":1505428900,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Uploaded patch set 11."},{"timestamp":1505428930,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 11: CI-Testing-1\n\n(2 comments)\n\n\"make check\" exited with status 2"},{"timestamp":1505508551,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Uploaded patch set 12: Patch Set 11 was rebased."},{"timestamp":1505508586,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 12:\n\n(2 comments)\n\n\"make check\" exited with status 2"},{"timestamp":1505508716,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Uploaded patch set 13."},{"timestamp":1505508750,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 13: CI-Testing-1\n\n(2 comments)\n\n\"make check\" exited with status 2"},{"timestamp":1505509165,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Uploaded patch set 14."},{"timestamp":1505509202,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 14: CI-Testing-1\n\n(4 comments)\n\n\"make check\" exited with status 2"},{"timestamp":1505509469,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Uploaded patch set 15."},{"timestamp":1505509540,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 15: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1505769008,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Uploaded patch set 16."},{"timestamp":1505769047,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 16: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1505775738,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Uploaded patch set 17."},{"timestamp":1505775786,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 17: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1505854351,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 17: Code-Review-1\n\n(6 comments)\n\nI tried to go through and add some comments on each of the issues I found but gerrit didn\u0027t seem to be able to handle it. The biggest problems I see with this I think fall into two categories:\n\n1) The cropOpts and assertCommon functions I don\u0027t think are helpful here as I think they make the the code less readable and assertCommon function makes it less explicit what is being asserted. I\u0027d recommend undoing both of those.\n\n2) The functions where function1 and function2 have been replaced with a new function that looks like function1OrFunction2(..., [\u0027function1\u0027, \u0027function2\u0027], ...).  Examples include:\n\n * listOrCountDockerVms\n * attachOrLogs\n * doToContainer\n \nI think we\u0027d be better off if we really need a refactor here (and I\u0027m not sure what the motivation was in this case) taking some of the common functionality into smaller functions which are used by both rather than a generic function with a bunch of cases in it. E.g. if there\u0027s a substantial block of code that is copied in multiple functions that performs the same mutation on some object, replacing just that bit with a mutateObject call would be better than creating a single function that does function1OrFunction2OrFunction3... and performs the mutation in that function.\n\nIf there are other refactors here that I missed (I was having trouble with gerrit  here) that are of a different sort and you feel are still valuable, it might be helpful to submit those again without the other more problematic parts I mentioned above.\n\nOtherwise I think we might be better off forgoing this change and instead do smaller refactors just on an individual piece as it is being worked on, rather than doing a big refactor here just for the sake of refactoring. If there was some other requirement for this refactoring, perhaps focussing on refactoring just on that piece would be more helpful."},{"timestamp":1505873971,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Patch Set 17:\n\n(6 comments)\n\nFirst of all, thanks for taking a look at this large change! So, I\u0027ve given justifications for assertCommon and cropOpts as replies to your comments in the source files. That said, if you guys find these abstractions to be too inappropriate (or unclear, unusual, ugly, etc) for this repo, I can undo them. Same goes for `AaaaOrBbbbOrCccc` type functions. Even if we do away with those mentioned above, I do think that we should keep the parts of the refactor that involve `generateExpose` and `containerRWStream`. They are the reason I kicked this refactor off: they were extremely similar (more similar than any of the others that have been refactored), yet differed in subtle ways. As for what the motivation was for this refactor, it was to make the code clearer. Staring at 2 (or more) functions for an eternity, carefully trying to ascertain that they are not functionally identical, is an incredible waste of time and error-prone. The refactored functions are meant to communicate that funcA is *like* funcB, but differs (which you can determine by looking at the args) in some way (which you can better understand by looking at the implementation). I do think that refactoring this code, makes the similarities and differences between functions more explicit and more stark. I think that a refactor is worthwhile, and I also think that this refactor could be improved. At any rate, maybe this change is too big of a bite to swallow. So, instead of the whole thing, maybe we can look only at `generateExpose` and `containerRWStream`? If they are deemed worthwhile (minus the assertCommon calls), I can undo all the other changes, push a new patchset that only contains the changes related to those two functions."},{"timestamp":1505891718,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 17:\n\nIf you want to update to just including `generateExpose` and `containerRWStream` I\u0027d be willing to give those two a more thorough review since there\u0027d be a lot less to go through."},{"timestamp":1505944288,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Uploaded patch set 18."},{"timestamp":1505944327,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 18: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1506116359,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 18: -Code-Review\n\n(1 comment)\n\nI\u0027ve looked through the updated patchset and I still don\u0027t think I understand the value in making these changes. So I think it\u0027s best if I just leave it for someone else to review."},{"timestamp":1506122194,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Patch Set 18:\n\nVery well, I\u0027ll wait for some of the other reviewers to weigh in. But thanks for taking a look at it either way!"},{"timestamp":1506447922,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 18:\n\nI\u0027m also not sure it\u0027s clear that this change is a net positive. I can definitely duplication in the current code, but these changes seem to make the implementation harder to read and understand."},{"timestamp":1506450494,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Patch Set 18:\n\nWhilst I\u0027m -1 on this change as is, I still think there is value in some of the containerArchive* method changes in here.\n\nMy proposal would be to leave the two ExposePorts functions as they were, leave containerStats as it was and just have the containerArchive* changes, i.e. drop the \u0027dockerVerbToMethod\u0027 function and all the verb handling in containerArchiveRWStream - keep it simple.\n\n@josh, @julien would that be acceptable?\n\n@nick I understand that my proposal creates more work - don\u0027t feel like you need to do this - you are also free to drop this CR if don\u0027t feel like these changes are worth it."},{"timestamp":1506450914,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 18:\n\n@todd\n\n\u003e @josh, @julien would that be acceptable?\n\nAbsolutely, thanks for taking a look!"},{"timestamp":1506531483,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Patch Set 18:\n\nHey guys, thanks for taking a look at this. I\u0027ll happily make the changes that Todd proposed, as soon as I find some spare cycles (probably not before the weekend though)."},{"timestamp":1538503854,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Abandoned\n\nNo longer needed."}],"currentPatchSet":{"number":"18","revision":"6cfc0bdb2568beb76d2f5e1a018598ee5a5fcb9a","parents":["bdba952122b612d820611b584388951129d30c14"],"ref":"refs/changes/45/2545/18","uploader":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"createdOn":1505944288,"author":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1505944327,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/backends/sdc/containers.js","line":4265,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"nit: This should probably be:\n\n    if (verb \u003d\u003d\u003d \u0027copy\u0027) {\n        assert.ok(mode \u003d\u003d\u003d \u0027read\u0027 || mode \u003d\u003d\u003d \u0027write\u0027 || mode \u003d\u003d\u003d \u0027stat\u0027, \u0027invalid mode\u0027);\n    }\n\nto match the style in use elsewhere here."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/backends/sdc/containers.js","type":"MODIFIED","insertions":93,"deletions":-191},{"file":"lib/backends/sdc/utils.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/endpoints/containers.js","type":"MODIFIED","insertions":1,"deletions":-2}],"sizeInsertions":95,"sizeDeletions":-194},"patchSets":[{"number":"1","revision":"fdbb7b1dd89603f15400986b208ded27b469aea3","parents":["ade9dd9f71902a99d1d457cd77c24c32d0c0001d"],"ref":"refs/changes/45/2545/1","uploader":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"createdOn":1505190189,"author":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1505190227,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/backends/sdc/containers.js","line":1862,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"line \u003e 80 characters"},{"file":"lib/backends/sdc/containers.js","line":2903,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"indent is 18 not a multiple of 4 spaces"},{"file":"lib/backends/sdc/containers.js","line":3636,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"extra space between function name and left paren"},{"file":"lib/backends/sdc/containers.js","line":3728,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"line \u003e 80 characters"},{"file":"lib/backends/sdc/containers.js","line":3790,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"improper continuation"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/backends/sdc/containers.js","type":"MODIFIED","insertions":304,"deletions":-568},{"file":"lib/backends/sdc/index.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/backends/sdc/networks.js","type":"MODIFIED","insertions":122,"deletions":-9},{"file":"lib/endpoints/networks.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/integration/api-create.test.js","type":"MODIFIED","insertions":35,"deletions":0},{"file":"test/integration/helpers.js","type":"MODIFIED","insertions":23,"deletions":0}],"sizeInsertions":488,"sizeDeletions":-580},{"number":"2","revision":"23a5dc19d34b12ff58d3d2daebdba070f7b39dad","parents":["ade9dd9f71902a99d1d457cd77c24c32d0c0001d"],"ref":"refs/changes/45/2545/2","uploader":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"createdOn":1505205246,"author":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1505205280,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/backends/sdc/containers.js","line":1862,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"line \u003e 80 characters"},{"file":"lib/backends/sdc/containers.js","line":2903,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"indent is 18 not a multiple of 4 spaces"},{"file":"lib/backends/sdc/containers.js","line":3638,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"extra space between function name and left paren"},{"file":"lib/backends/sdc/containers.js","line":3730,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"line \u003e 80 characters"},{"file":"lib/backends/sdc/containers.js","line":3792,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"improper continuation"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/backends/sdc/containers.js","type":"MODIFIED","insertions":318,"deletions":-603},{"file":"lib/backends/sdc/index.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/backends/sdc/networks.js","type":"MODIFIED","insertions":122,"deletions":-9},{"file":"lib/endpoints/containers.js","type":"MODIFIED","insertions":1,"deletions":-2},{"file":"lib/endpoints/networks.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/integration/api-create.test.js","type":"MODIFIED","insertions":35,"deletions":0},{"file":"test/integration/helpers.js","type":"MODIFIED","insertions":23,"deletions":0}],"sizeInsertions":503,"sizeDeletions":-617},{"number":"3","revision":"2f846362f2ccf68e4c3cef3ca471b1c3608f52cc","parents":["ade9dd9f71902a99d1d457cd77c24c32d0c0001d"],"ref":"refs/changes/45/2545/3","uploader":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"createdOn":1505239315,"author":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1505239354,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/backends/sdc/containers.js","line":1513,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"indent is 18 not a multiple of 4 spaces"},{"file":"lib/backends/sdc/containers.js","line":1514,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"indent is 22 not a multiple of 4 spaces"},{"file":"lib/backends/sdc/containers.js","line":1515,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"indent is 22 not a multiple of 4 spaces"},{"file":"lib/backends/sdc/containers.js","line":1516,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"indent is 18 not a multiple of 4 spaces"},{"file":"lib/backends/sdc/containers.js","line":1865,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"line \u003e 80 characters"},{"file":"lib/backends/sdc/containers.js","line":2878,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"indent is 18 not a multiple of 4 spaces"},{"file":"lib/backends/sdc/containers.js","line":3613,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"extra space between function name and left paren"},{"file":"lib/backends/sdc/containers.js","line":3705,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"line \u003e 80 characters"},{"file":"lib/backends/sdc/containers.js","line":3767,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"improper continuation"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/backends/sdc/containers.js","type":"MODIFIED","insertions":339,"deletions":-651},{"file":"lib/endpoints/containers.js","type":"MODIFIED","insertions":1,"deletions":-2}],"sizeInsertions":340,"sizeDeletions":-653},{"number":"4","revision":"1cf1b0d512fd9d7cac36baacdfe7d24d283bd4f1","parents":["94fa554d7402b61ddfa643d4e76f5169797d049e"],"ref":"refs/changes/45/2545/4","uploader":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"createdOn":1505242603,"author":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1505239354,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/backends/sdc/containers.js","line":1513,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"indent is 18 not a multiple of 4 spaces"},{"file":"lib/backends/sdc/containers.js","line":1514,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"indent is 22 not a multiple of 4 spaces"},{"file":"lib/backends/sdc/containers.js","line":1515,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"indent is 22 not a multiple of 4 spaces"},{"file":"lib/backends/sdc/containers.js","line":1516,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"indent is 18 not a multiple of 4 spaces"},{"file":"lib/backends/sdc/containers.js","line":1865,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"line \u003e 80 characters"},{"file":"lib/backends/sdc/containers.js","line":2878,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"indent is 18 not a multiple of 4 spaces"},{"file":"lib/backends/sdc/containers.js","line":3613,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"extra space between function name and left paren"},{"file":"lib/backends/sdc/containers.js","line":3705,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"line \u003e 80 characters"},{"file":"lib/backends/sdc/containers.js","line":3767,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"improper continuation"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/backends/sdc/containers.js","type":"MODIFIED","insertions":339,"deletions":-651},{"file":"lib/endpoints/containers.js","type":"MODIFIED","insertions":1,"deletions":-2}],"sizeInsertions":340,"sizeDeletions":-653},{"number":"5","revision":"715951584f5dd498e5b5cd42bfa6324eb2f9702b","parents":["94fa554d7402b61ddfa643d4e76f5169797d049e"],"ref":"refs/changes/45/2545/5","uploader":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"createdOn":1505375915,"author":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1505375953,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/backends/sdc/containers.js","line":1871,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"line \u003e 80 characters"},{"file":"lib/backends/sdc/containers.js","line":2888,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"indent is 18 not a multiple of 4 spaces"},{"file":"lib/backends/sdc/containers.js","line":3624,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"extra space between function name and left paren"},{"file":"lib/backends/sdc/containers.js","line":3716,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"line \u003e 80 characters"},{"file":"lib/backends/sdc/containers.js","line":3778,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"improper continuation"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/backends/sdc/containers.js","type":"MODIFIED","insertions":372,"deletions":-703},{"file":"lib/backends/sdc/utils.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/endpoints/containers.js","type":"MODIFIED","insertions":1,"deletions":-2}],"sizeInsertions":374,"sizeDeletions":-706},{"number":"6","revision":"63006ae7c378b29d9c4dac99f6e9e587509991d5","parents":["94fa554d7402b61ddfa643d4e76f5169797d049e"],"ref":"refs/changes/45/2545/6","uploader":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"createdOn":1505376303,"author":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1505376336,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/backends/sdc/containers.js","line":3717,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"improper continuation"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/backends/sdc/containers.js","type":"MODIFIED","insertions":374,"deletions":-703},{"file":"lib/backends/sdc/utils.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/endpoints/containers.js","type":"MODIFIED","insertions":1,"deletions":-2}],"sizeInsertions":376,"sizeDeletions":-706},{"number":"7","revision":"d546acd5b944c572d01d971504f68ca8d914b574","parents":["94fa554d7402b61ddfa643d4e76f5169797d049e"],"ref":"refs/changes/45/2545/7","uploader":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"createdOn":1505376489,"author":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1505376532,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/backends/sdc/containers.js","type":"MODIFIED","insertions":374,"deletions":-703},{"file":"lib/backends/sdc/utils.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/endpoints/containers.js","type":"MODIFIED","insertions":1,"deletions":-2}],"sizeInsertions":376,"sizeDeletions":-706},{"number":"8","revision":"5126225c06f140576982b9b0101c81adc3583ddb","parents":["94fa554d7402b61ddfa643d4e76f5169797d049e"],"ref":"refs/changes/45/2545/8","uploader":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"createdOn":1505427731,"author":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1505427771,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/backends/sdc/containers.js","line":2935,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"warning: missing default case in switch statement"},{"file":"lib/backends/sdc/containers.js","line":2950,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"warning: missing default case in switch statement"},{"file":"lib/backends/sdc/containers.js","line":2990,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"warning: identifer opts hides an identifier in a parent scope"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/backends/sdc/containers.js","type":"MODIFIED","insertions":389,"deletions":-723},{"file":"lib/backends/sdc/utils.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/endpoints/containers.js","type":"MODIFIED","insertions":1,"deletions":-2}],"sizeInsertions":391,"sizeDeletions":-726},{"number":"9","revision":"4b218ac05f0f0b3322d9ecc2956af5e64d1b71ea","parents":["94fa554d7402b61ddfa643d4e76f5169797d049e"],"ref":"refs/changes/45/2545/9","uploader":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"createdOn":1505427896,"author":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1505427771,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"lib/backends/sdc/containers.js","type":"MODIFIED","insertions":389,"deletions":-723},{"file":"lib/backends/sdc/utils.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/endpoints/containers.js","type":"MODIFIED","insertions":1,"deletions":-2}],"sizeInsertions":391,"sizeDeletions":-726},{"number":"10","revision":"09f23e99d59c44dc3e9ddfd8f56d31005f5bf65d","parents":["94fa554d7402b61ddfa643d4e76f5169797d049e"],"ref":"refs/changes/45/2545/10","uploader":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"createdOn":1505427951,"author":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1505427771,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/backends/sdc/containers.js","type":"MODIFIED","insertions":389,"deletions":-723},{"file":"lib/backends/sdc/utils.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/endpoints/containers.js","type":"MODIFIED","insertions":1,"deletions":-2}],"sizeInsertions":391,"sizeDeletions":-726},{"number":"11","revision":"ff4c2088f0c94b20b7cdd9202f762486475c8cef","parents":["94fa554d7402b61ddfa643d4e76f5169797d049e"],"ref":"refs/changes/45/2545/11","uploader":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"createdOn":1505428900,"author":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1505428930,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/backends/sdc/containers.js","line":2935,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"warning: missing default case in switch statement"},{"file":"lib/backends/sdc/containers.js","line":2950,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"warning: missing default case in switch statement"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/backends/sdc/containers.js","type":"MODIFIED","insertions":389,"deletions":-723},{"file":"lib/backends/sdc/utils.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/endpoints/containers.js","type":"MODIFIED","insertions":1,"deletions":-2}],"sizeInsertions":391,"sizeDeletions":-726},{"number":"12","revision":"8e058fd638878cf7e7f8a3e68fd8c8b07008fd9d","parents":["b751d9dc133205bf1a81b28b8eec0ddc2a1cc19f"],"ref":"refs/changes/45/2545/12","uploader":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"createdOn":1505508551,"author":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1505428930,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/backends/sdc/containers.js","line":2935,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"warning: missing default case in switch statement"},{"file":"lib/backends/sdc/containers.js","line":2950,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"warning: missing default case in switch statement"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/backends/sdc/containers.js","type":"MODIFIED","insertions":389,"deletions":-723},{"file":"lib/backends/sdc/utils.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/endpoints/containers.js","type":"MODIFIED","insertions":1,"deletions":-2}],"sizeInsertions":391,"sizeDeletions":-726},{"number":"13","revision":"ef78a9c01bcc48224f642628fc07dda881a6bd2e","parents":["b751d9dc133205bf1a81b28b8eec0ddc2a1cc19f"],"ref":"refs/changes/45/2545/13","uploader":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"createdOn":1505508716,"author":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1505508750,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/backends/sdc/containers.js","line":2948,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"warning: missing break statement for last case in switch"},{"file":"lib/backends/sdc/containers.js","line":2957,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"warning: missing break statement for last case in switch"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/backends/sdc/containers.js","type":"MODIFIED","insertions":392,"deletions":-723},{"file":"lib/backends/sdc/utils.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/endpoints/containers.js","type":"MODIFIED","insertions":1,"deletions":-2}],"sizeInsertions":394,"sizeDeletions":-726},{"number":"14","revision":"e1b7dbf07b25e35486483a99c63403f040398ae7","parents":["b751d9dc133205bf1a81b28b8eec0ddc2a1cc19f"],"ref":"refs/changes/45/2545/14","uploader":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"createdOn":1505509165,"author":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1505509202,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/backends/sdc/containers.js","line":2933,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"extra space between function name and left paren"},{"file":"lib/backends/sdc/containers.js","line":2969,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"improper continuation"},{"file":"lib/backends/sdc/containers.js","line":2970,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"improper continuation"},{"file":"lib/backends/sdc/containers.js","line":2979,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"indent is 18 not a multiple of 4 spaces"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/backends/sdc/containers.js","type":"MODIFIED","insertions":394,"deletions":-723},{"file":"lib/backends/sdc/utils.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/endpoints/containers.js","type":"MODIFIED","insertions":1,"deletions":-2}],"sizeInsertions":396,"sizeDeletions":-726},{"number":"15","revision":"18d2e980bb6c44be63e45fd3231c4123d7af666c","parents":["b751d9dc133205bf1a81b28b8eec0ddc2a1cc19f"],"ref":"refs/changes/45/2545/15","uploader":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"createdOn":1505509469,"author":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1505509540,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/backends/sdc/containers.js","type":"MODIFIED","insertions":392,"deletions":-723},{"file":"lib/backends/sdc/utils.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/endpoints/containers.js","type":"MODIFIED","insertions":1,"deletions":-2}],"sizeInsertions":394,"sizeDeletions":-726},{"number":"16","revision":"c86affc314041d8990a3cac1db96d06021ecef15","parents":["04cf7dc199e379b8248a798467a8f44d1f25743b"],"ref":"refs/changes/45/2545/16","uploader":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"createdOn":1505769008,"author":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1505769047,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/backends/sdc/containers.js","type":"MODIFIED","insertions":388,"deletions":-716},{"file":"lib/backends/sdc/utils.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/endpoints/containers.js","type":"MODIFIED","insertions":1,"deletions":-2}],"sizeInsertions":390,"sizeDeletions":-719},{"number":"17","revision":"fc70e9faa63caa711f900289dac4ef1fd0953a76","parents":["04cf7dc199e379b8248a798467a8f44d1f25743b"],"ref":"refs/changes/45/2545/17","uploader":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"createdOn":1505775738,"author":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1505775786,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/backends/sdc/containers.js","line":713,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"In my opinion we\u0027d be better off not doing this. This assertCommon function makes it much less obvious when we\u0027re looking at a given function which parameters have been asserted. Explicitly listing the parameters also gives a better idea of what is being used."},{"file":"lib/backends/sdc/containers.js","line":713,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Well, kind of. The whole point of assertCommon is that we make it clear that many functions share assertions in some way. Also, before assertCommon came along we were \"forgetting\" to assert parameters before we used them. The only thing that saved us from our forgetfulness was that we likely asserted on the parameter in a caller. Also, putting common assertions in one place means we would only have to make changes in one place. In the context of this file, one would know what\u0027s being asserted if one knows the implementation of assertCommon -- calls to which are much more concise and clearer than a wall of asserts. Also by encapsulating the common asserts in assertCommon, we can see which asserts are un-common in the function in question (for example, payload, app.config.datacenterName, etc). In general I thought that abstracting the common asserts would clarify the code, and make it apparent which members are _commonly_ expected in the various functions. I do think it is possible to achieve greater clarity than what `assertCommon` offers, but I don\u0027t think _inlining_ all of our asserts -- usually by copy-pasting from a different function -- is the way to do it. In fact, copy-pasting is what got us here to begin with."},{"file":"lib/backends/sdc/containers.js","line":1494,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"I don\u0027t like the idea of a function having an \u0027Or\u0027 in the name. In general I\u0027d consider that a code smell, since it indicates the function is doing more than one thing. In this case it clearly is. I also don\u0027t think merging two functions into one is valuable in general.\n\nIn looking at getContainerCount and listDockerVms I really don\u0027t see the reason we need to break this up. I think this listOrCountDockerVms actually makes the code *more* complicated. So I\u0027d say we should stick to the originals. The minimal code the two functions shared was also helpful in that when something goes wrong the core would have a better name for the callback function."},{"file":"lib/backends/sdc/containers.js","line":1494,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Good point on the core-file having more useful information. I will take post-mortem debuggability over abstraction any day. However, FWIW, I do think that the value in merging 2 functions into 1 is that it makes it explicit that they are related and makes their differences starkly visible."},{"file":"lib/backends/sdc/containers.js","line":1497,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"I think:\n\n    assert.object(opts.vmapi, \u0027opts.vmapi\u0027);\n\nis better here because when the assert blows you\u0027ll get:\n\n    AssertionError: opts.vmapi (object) is required\n        at repl:1:8\n        at REPLServer.defaultEval (repl.js:272:27)\n        at bound (domain.js:287:14)\n        at REPLServer.runBound [as eval] (domain.js:300:12)\n        at REPLServer.\u003canonymous\u003e (repl.js:441:12)\n        at emitOne (events.js:82:20)\n        at REPLServer.emit (events.js:169:7)\n        at REPLServer.Interface._onLine (readline.js:203:10)\n        at REPLServer.Interface._line (readline.js:542:8)\n        at REPLServer.Interface._ttyWrite (readline.js:819:14)\n\ninstead of:\n\n    AssertionError: undefined (object) is required\n        at repl:1:8\n        at REPLServer.defaultEval (repl.js:272:27)\n        at bound (domain.js:287:14)\n        at REPLServer.runBound [as eval] (domain.js:300:12)\n        at REPLServer.\u003canonymous\u003e (repl.js:441:12)\n        at emitOne (events.js:82:20)\n        at REPLServer.emit (events.js:169:7)\n        at REPLServer.Interface._onLine (readline.js:203:10)\n        at REPLServer.Interface._line (readline.js:542:8)\n        at REPLServer.Interface._ttyWrite (readline.js:819:14)\n\nwhich you\u0027ll get with your modified version."},{"file":"lib/backends/sdc/containers.js","line":1497,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"I see, good point. I\u0027ll change this back."},{"file":"lib/backends/sdc/containers.js","line":1530,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"in general we prefer to always name functions."},{"file":"lib/backends/sdc/containers.js","line":1530,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Sure, but this was the only way that I could think of that would allow us to readably switch between 2 different but related pieces of functionality (vmapi[\u0027listVms\u0027] and vmapi[\u0027countVms\u0027]), which is clearer than branching (which would involve duplicating each invocation of a vmapi method and its callback (which would negate the whole point of the refactor)."},{"file":"lib/backends/sdc/containers.js","line":1863,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"I think this cropOpts does not improve the readability of this code here. One needs to read the cropOpts function to understand what\u0027s being assigned here whereas with the existing code, it\u0027s clear without needing to go elsewhere."},{"file":"lib/backends/sdc/containers.js","line":1863,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Yeah, but by that logic we should always inline our function calls. The cropOpts function is also easy to understand -- it returns an object that has a subset of the members of its input object. Using cropOpts, communicates something meaningful -- namely that 2 objects are related because their contents intersect. Whereas using an object literal requires that the user read all 4 lines, and even then the relation might not be clear because they may have missed the definition of `log` above. Either way, I\u0027m not terribly attached to cropOpts -- it\u0027s used in only 2 places."},{"file":"lib/backends/sdc/containers.js","line":2356,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"again: this doesn\u0027t seem to help readability."},{"file":"lib/backends/sdc/containers.js","line":2356,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"See above."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/backends/sdc/containers.js","type":"MODIFIED","insertions":383,"deletions":-716},{"file":"lib/backends/sdc/utils.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/endpoints/containers.js","type":"MODIFIED","insertions":1,"deletions":-2}],"sizeInsertions":385,"sizeDeletions":-719},{"number":"18","revision":"6cfc0bdb2568beb76d2f5e1a018598ee5a5fcb9a","parents":["bdba952122b612d820611b584388951129d30c14"],"ref":"refs/changes/45/2545/18","uploader":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"createdOn":1505944288,"author":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1505944327,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/backends/sdc/containers.js","line":4265,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"nit: This should probably be:\n\n    if (verb \u003d\u003d\u003d \u0027copy\u0027) {\n        assert.ok(mode \u003d\u003d\u003d \u0027read\u0027 || mode \u003d\u003d\u003d \u0027write\u0027 || mode \u003d\u003d\u003d \u0027stat\u0027, \u0027invalid mode\u0027);\n    }\n\nto match the style in use elsewhere here."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/backends/sdc/containers.js","type":"MODIFIED","insertions":93,"deletions":-191},{"file":"lib/backends/sdc/utils.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/endpoints/containers.js","type":"MODIFIED","insertions":1,"deletions":-2}],"sizeInsertions":95,"sizeDeletions":-194}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}]}