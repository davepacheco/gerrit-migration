From 0fabc2be10a12b10f37299c4442814af0d668b7f Mon Sep 17 00:00:00 2001
From: Jerry Jelinek <jerry.jelinek@joyent.com>
Date: Wed, 10 Aug 2016 20:18:33 +0000
Subject: [PATCH] OS-5576 harden random pool for zones Reviewed by: Patrick
 Mooney <patrick.mooney@joyent.com>

---
 usr/src/uts/common/io/random.c | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/usr/src/uts/common/io/random.c b/usr/src/uts/common/io/random.c
index c4984e956f..b5401b17cd 100644
--- a/usr/src/uts/common/io/random.c
+++ b/usr/src/uts/common/io/random.c
@@ -20,6 +20,8 @@
  *
  * Copyright 2009 Sun Microsystems, Inc.  All rights reserved.
  * Use is subject to license terms.
+ *
+ * Copyright 2016 Joyent, Inc.
  */
 
 
@@ -289,6 +291,9 @@ rnd_write(dev_t dev, struct uio *uiop, cred_t *credp)
 		if ((error = uiomove(buf, bytes, UIO_WRITE, uiop)) != 0)
 			return (error);
 
+		if (crgetzone(credp) != global_zone)
+			continue;
+
 		switch (devno) {
 		case DEVRANDOM:
 			if ((error = random_add_entropy(buf, bytes, 0)) != 0)
-- 
2.21.0

