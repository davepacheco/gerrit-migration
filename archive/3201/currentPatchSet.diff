From ead7f5dbd7d974a9ea6f14999a89befc8c94abf8 Mon Sep 17 00:00:00 2001
From: Marsell Kukuljevic <marsell@joyent.com>
Date: Wed, 6 Dec 2017 15:33:41 +1300
Subject: [PATCH] TRITON-19 Triton equivalent to AWS' termination protection

---
 lib/index.js      |  9 ++++++++-
 test/unit.test.js | 23 +++++++++++++++++++++--
 2 files changed, 29 insertions(+), 3 deletions(-)

diff --git a/lib/index.js b/lib/index.js
index 7be9f55..fee3caa 100644
--- a/lib/index.js
+++ b/lib/index.js
@@ -5,7 +5,7 @@
  */
 
 /*
- * Copyright 2017, Joyent, Inc.
+ * Copyright 2018, Joyent, Inc.
  */
 
 /*
@@ -42,6 +42,7 @@ var typeFromKey = {
     'triton.cns.disable': 'boolean',
     'triton.cns.reverse_ptr': 'string',
     'triton.network.public': 'string',
+    'triton.instance.undeletable': 'boolean',
 
     // Internal testing Triton tags
     'triton._test.string': 'string',
@@ -144,6 +145,12 @@ var validatorFromKey = {
         return null;
     },
 
+    'triton.instance.undeletable':
+    function validateTritonInstanceUndeletable(val) {
+        assert.bool(val, 'val');
+        return null;
+    },
+
     /*
      * Triton tags used for internal testing.
      */
diff --git a/test/unit.test.js b/test/unit.test.js
index c66aa65..c9ebef2 100644
--- a/test/unit.test.js
+++ b/test/unit.test.js
@@ -5,7 +5,7 @@
  */
 
 /*
- * Copyright 2016, Joyent, Inc.
+ * Copyright 2018, Joyent, Inc.
  */
 
 /*
@@ -181,9 +181,28 @@ var cases = [
         key: 'triton.cns.services',
         str: '5foobar',
         val: '5foobar'
-    }
+    },
 
     // TODO: triton.cns.reverse_ptr
+
+    {
+        key: 'triton.instance.undeletable',
+        str: 'true',
+        val: true
+    },
+    {
+        key: 'triton.instance.undeletable',
+        str: 'false',
+        val: false
+    },
+    {
+        key: 'triton.instance.undeletable',
+        str: 'booga',
+        /* JSSTYLED */
+        err: /Triton tag "triton.instance.undeletable" value must be "true" or "false": "booga"/,
+        /* JSSTYLED */
+        errmsg: /Triton tag "triton.instance.undeletable" value must be a boolean: "booga"/
+    }
 ];
 
 
-- 
2.21.0

