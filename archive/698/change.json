{"project":"joyent/illumos-joyent","branch":"master","id":"I9da8cf47c514f040c3b3b8111c2e76cb0501d52c","number":"698","subject":"OS-5710 sdev_create() doesn\u0027t enforce EISDIR in non-GZ Reviewed by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e Reviewed by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e Approved by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e","owner":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"url":"https://cr.joyent.us/698","commitMessage":"OS-5710 sdev_create() doesn\u0027t enforce EISDIR in non-GZ\nReviewed by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e\nReviewed by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e\nApproved by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e\n","createdOn":1476495688,"lastUpdated":1477426629,"open":false,"status":"MERGED","comments":[{"timestamp":1476495688,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Uploaded patch set 1."},{"timestamp":1476496024,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1476718339,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 1:\n\nI agree with Patrick on adding a comment in sdev_vnops.c"},{"timestamp":1476761657,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Uploaded patch set 2."},{"timestamp":1476788339,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 2: Code-Review+1"},{"timestamp":1476822334,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 2: Code-Review+1"},{"timestamp":1476889803,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Uploaded patch set 3."},{"timestamp":1476890029,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1476890161,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 3: Code-Review+1 Integration-Approval+1"},{"timestamp":1476890484,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Uploaded patch set 4: Commit message was updated."},{"timestamp":1477426135,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Uploaded patch set 5."},{"timestamp":1477426293,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 5: Code-Review+1"},{"timestamp":1477426344,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Patch Set 5:\n\ntruss output with patch (now both EISDIR as they should):\n\n open(\"/dev/zvol/..\", O_RDWR)                    Err#21 EISDIR\n open(\"/dev/zvol/..\", O_RDWR|O_CREAT, 0)         Err#21 EISDIR"},{"timestamp":1477426470,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 5: Code-Review+1"},{"timestamp":1477426517,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 5: Integration-Approval+1"},{"timestamp":1477426536,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Patch Set 5: Integration-Approval+1"},{"timestamp":1477426629,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Ryan Zezeski"}],"currentPatchSet":{"number":"5","revision":"9da8cf47c514f040c3b3b8111c2e76cb0501d52c","parents":["3125ad3bb6fb793491e3fc152ef05eb4cd221797"],"ref":"refs/changes/98/698/5","uploader":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"createdOn":1477426135,"author":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1477426293,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1477426470,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1477426517,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1477426536,"by":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"}},{"type":"SUBM","value":"1","grantedOn":1477426629,"by":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/test/os-tests/runfiles/default.run","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/test/os-tests/tests/Makefile","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/test/os-tests/tests/sdevfs/Makefile","type":"ADDED","insertions":47,"deletions":0},{"file":"usr/src/test/os-tests/tests/sdevfs/sdevfs_eisdir.c","type":"ADDED","insertions":73,"deletions":0},{"file":"usr/src/uts/common/fs/dev/sdev_vnops.c","type":"MODIFIED","insertions":30,"deletions":-2}],"sizeInsertions":157,"sizeDeletions":-3},"patchSets":[{"number":"1","revision":"9da5450cc56f12afc1ef1c71782aa728bb89c4e9","parents":["117f0c39091e1c03d4d64b1177693bf952c81c97"],"ref":"refs/changes/98/698/1","uploader":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"createdOn":1476495688,"author":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/uts/common/fs/dev/sdev_vnops.c","line":670,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Assuming there\u0027s more nuance to this check than meets the eye, it might be a good place to a block comment explaining specifically why the additional tests are needed."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/test/os-tests/runfiles/default.run","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/test/os-tests/tests/Makefile","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/test/os-tests/tests/sdevfs/Makefile","type":"ADDED","insertions":47,"deletions":0},{"file":"usr/src/test/os-tests/tests/sdevfs/sdevfs_eisdir.c","type":"ADDED","insertions":73,"deletions":0},{"file":"usr/src/uts/common/fs/dev/sdev_vnops.c","type":"MODIFIED","insertions":18,"deletions":-2}],"sizeInsertions":145,"sizeDeletions":-3},{"number":"2","revision":"813b6852c8ab7977ba21088da5e3b570104d52d6","parents":["117f0c39091e1c03d4d64b1177693bf952c81c97"],"ref":"refs/changes/98/698/2","uploader":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"createdOn":1476761657,"author":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1476788339,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1476822334,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/test/os-tests/runfiles/default.run","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/test/os-tests/tests/Makefile","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/test/os-tests/tests/sdevfs/Makefile","type":"ADDED","insertions":47,"deletions":0},{"file":"usr/src/test/os-tests/tests/sdevfs/sdevfs_eisdir.c","type":"ADDED","insertions":73,"deletions":0},{"file":"usr/src/uts/common/fs/dev/sdev_vnops.c","type":"MODIFIED","insertions":29,"deletions":-2}],"sizeInsertions":156,"sizeDeletions":-3},{"number":"3","revision":"92ff72a778b240b5e701f84aca854037a33cafc7","parents":["5373bfca1478d6f817b11a8735b557503f35e7a8"],"ref":"refs/changes/98/698/3","uploader":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"createdOn":1476889803,"author":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1476890161,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1476890161,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1476890029,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/test/os-tests/runfiles/default.run","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/test/os-tests/tests/Makefile","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/test/os-tests/tests/sdevfs/Makefile","type":"ADDED","insertions":47,"deletions":0},{"file":"usr/src/test/os-tests/tests/sdevfs/sdevfs_eisdir.c","type":"ADDED","insertions":73,"deletions":0},{"file":"usr/src/uts/common/fs/dev/sdev_vnops.c","type":"MODIFIED","insertions":29,"deletions":-2}],"sizeInsertions":156,"sizeDeletions":-3},{"number":"4","revision":"b4feb1d9694649669f15c1ff4358f583560ecf4c","parents":["5373bfca1478d6f817b11a8735b557503f35e7a8"],"ref":"refs/changes/98/698/4","uploader":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"createdOn":1476890484,"author":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1476890161,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1476890161,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1476890029,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/test/os-tests/runfiles/default.run","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/test/os-tests/tests/Makefile","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/test/os-tests/tests/sdevfs/Makefile","type":"ADDED","insertions":47,"deletions":0},{"file":"usr/src/test/os-tests/tests/sdevfs/sdevfs_eisdir.c","type":"ADDED","insertions":73,"deletions":0},{"file":"usr/src/uts/common/fs/dev/sdev_vnops.c","type":"MODIFIED","insertions":29,"deletions":-2}],"sizeInsertions":156,"sizeDeletions":-3},{"number":"5","revision":"9da8cf47c514f040c3b3b8111c2e76cb0501d52c","parents":["3125ad3bb6fb793491e3fc152ef05eb4cd221797"],"ref":"refs/changes/98/698/5","uploader":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"createdOn":1477426135,"author":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1477426293,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1477426517,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1477426470,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1477426536,"by":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"}},{"type":"SUBM","value":"1","grantedOn":1477426629,"by":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/test/os-tests/runfiles/default.run","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/test/os-tests/tests/Makefile","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/test/os-tests/tests/sdevfs/Makefile","type":"ADDED","insertions":47,"deletions":0},{"file":"usr/src/test/os-tests/tests/sdevfs/sdevfs_eisdir.c","type":"ADDED","insertions":73,"deletions":0},{"file":"usr/src/uts/common/fs/dev/sdev_vnops.c","type":"MODIFIED","insertions":30,"deletions":-2}],"sizeInsertions":157,"sizeDeletions":-3}],"allReviewers":[{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"}]}