{"project":"joyent/sdcadm","branch":"master","id":"I9be5e6870224b7e3214716e51381568ed5eecda8","number":"3247","subject":"TRITON-66 \u0027sdcadm experimental update-other\u0027 crashes on a non-master/non-release SAPI image version Reviewed by: Pedro Palazón Candel \u003cpedro@joyent.com\u003e Approved by: Pedro Palazón Candel \u003cpedro@joyent.com\u003e","owner":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"url":"https://cr.joyent.us/3247","commitMessage":"TRITON-66 \u0027sdcadm experimental update-other\u0027 crashes on a non-master/non-release SAPI image version\nReviewed by: Pedro Palazón Candel \u003cpedro@joyent.com\u003e\nApproved by: Pedro Palazón Candel \u003cpedro@joyent.com\u003e\n","createdOn":1516661987,"lastUpdated":1516729584,"open":false,"status":"MERGED","comments":[{"timestamp":1516661987,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Uploaded patch set 1."},{"timestamp":1516661988,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit 2dadbf78cd2539c78eafc439d4148ddf25e9b44a\n    \n    handle exp. sapi images with a warning; correct SDCClientError usage"},{"timestamp":1516662020,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1516662334,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 1:\n\nPedro,\n\nI hit this while attempting to test SAPI-294. I\u0027ve tested my change in COAL, first hacked up to show that SDCClientError is properly being called now:\n\n```\n[root@headnode (coal) ~]# /opt/smartdc/bin/sdcadm experimental update-other\nRunning VMAPI migrations\nsdcadm experimental update-other: error (SDCClient): sapi client error: SAPI in this datacenter is using image version SAPI-294-20180118T215558Z-gd42affe, which is not the minimum version required for adding service agents (20140703). Please upgrade SAPI and then retry.\n```\n\nand second with the full patch:\n\n```\n[root@headnode (coal) ~]# /opt/smartdc/bin/sdcadm experimental update-other\nRunning VMAPI migrations\nWarning: cannot verify that SAPI is at least of 20140703 vintage, because a non-master/non-release SAPI image is being used.\n[root@headnode (coal) ~]# echo $?\n0\n```"},{"timestamp":1516723201,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 1: Code-Review+1 Integration-Approval+1"},{"timestamp":1516729577,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Uploaded patch set 2: Commit message was updated."},{"timestamp":1516729584,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Trent Mick"}],"currentPatchSet":{"number":"2","revision":"9be5e6870224b7e3214716e51381568ed5eecda8","parents":["bbde4fd33163212e524744b66f8831670198c947"],"ref":"refs/changes/47/3247/2","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1516729577,"author":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1516662020,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1516723201,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1516723201,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"SUBM","value":"1","grantedOn":1516729584,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/steps/sapi.js","type":"MODIFIED","insertions":12,"deletions":-4}],"sizeInsertions":12,"sizeDeletions":-4},"patchSets":[{"number":"1","revision":"4406a67cc3a726e21a429166eb80a1e3e321bab5","parents":["bbde4fd33163212e524744b66f8831670198c947"],"ref":"refs/changes/47/3247/1","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1516661987,"author":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1516662020,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1516723201,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1516723201,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/steps/sapi.js","type":"MODIFIED","insertions":12,"deletions":-4}],"sizeInsertions":12,"sizeDeletions":-4},{"number":"2","revision":"9be5e6870224b7e3214716e51381568ed5eecda8","parents":["bbde4fd33163212e524744b66f8831670198c947"],"ref":"refs/changes/47/3247/2","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1516729577,"author":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1516662020,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"SUBM","value":"1","grantedOn":1516729584,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1516723201,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1516723201,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/steps/sapi.js","type":"MODIFIED","insertions":12,"deletions":-4}],"sizeInsertions":12,"sizeDeletions":-4}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}]}