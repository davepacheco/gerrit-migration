{"project":"joyent/sdc-docker","branch":"master","id":"Ic6bb433c75816f2d7479633794ea911cd2d90647","number":"3357","subject":"TRITON-122 docker tests can end up with a lot of binary data in the output process invoked by execPlus function fails Reviewed by: Trent Mick \u003ctrentm@gmail.com\u003e Approved by: Trent Mick \u003ctrentm@gmail.com\u003e","owner":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"url":"https://cr.joyent.us/3357","commitMessage":"TRITON-122 docker tests can end up with a lot of binary data in the output process invoked by execPlus function fails\nReviewed by: Trent Mick \u003ctrentm@gmail.com\u003e\nApproved by: Trent Mick \u003ctrentm@gmail.com\u003e\n","createdOn":1518556012,"lastUpdated":1519082702,"open":false,"status":"MERGED","comments":[{"timestamp":1518556012,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Uploaded patch set 1."},{"timestamp":1518556014,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit 105eb35127c79cb2eb3b9923dbdb6e650026824c\n    \n    Add option to prevent stdout from being dumped to console"},{"timestamp":1518556047,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1518585904,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Uploaded patch set 2."},{"timestamp":1518585906,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit 25af2b6761d8f1d5150e64944bd0e9b29ada884f\n    \n    Add support for parameter indicating how much stdio to display on console"},{"timestamp":1518585945,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1518633962,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Uploaded patch set 3."},{"timestamp":1518633963,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Patch Set 3:\n\nNew commits:\n    \n    commit 62086ca0a4108528a586587131e734f57db96ad7\n    \n    Use variable rather than hardcoding value"},{"timestamp":1518634001,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1518636050,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 3:\n\n(3 comments)"},{"timestamp":1518636838,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Uploaded patch set 4."},{"timestamp":1518636839,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Patch Set 4:\n\nNew commits:\n    \n    commit c51fce5727b2a3a4565cbbc9a6e08edd876782fa\n    \n    wrong variable name"},{"timestamp":1518637309,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Uploaded patch set 5."},{"timestamp":1518637310,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Patch Set 5:\n\nNew commits:\n    \n    commit c7060c0e0fc18cae9382be447bb42c2c63e4049d\n    \n    wrong variable name\n    \n    commit 62086ca0a4108528a586587131e734f57db96ad7\n    \n    Use variable rather than hardcoding value\n    \n    commit 25af2b6761d8f1d5150e64944bd0e9b29ada884f\n    \n    Add support for parameter indicating how much stdio to display on console\n    \n    commit 105eb35127c79cb2eb3b9923dbdb6e650026824c\n    \n    Add option to prevent stdout from being dumped to console"},{"timestamp":1518637474,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Uploaded patch set 6."},{"timestamp":1518637475,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Patch Set 6:\n\nNew commits:\n    \n    commit 0afa8cd8fdaf2c3d0d678830ccc02a9f1809b8df\n    \n    apply trent\u0027s feedback"},{"timestamp":1518637489,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Patch Set 3:\n\n(3 comments)"},{"timestamp":1518639629,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 6:\n\n(1 comment)"},{"timestamp":1518647232,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Uploaded patch set 7."},{"timestamp":1518647233,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Patch Set 7:\n\nNew commits:\n    \n    commit 61003550ed16fe48e881613312098b211b17f14b\n    \n    address trent\u0027s feedback"},{"timestamp":1518647453,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Patch Set 6:\n\n(1 comment)"},{"timestamp":1518647617,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 7:\n\n(2 comments)"},{"timestamp":1518671299,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Uploaded patch set 8."},{"timestamp":1518671300,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Patch Set 8:\n\nNew commits:\n    \n    commit 7706fdff7ce7a8a7cfeb886a24db3206e59ed483\n    \n    Simplify code a bit\n    \n    commit 54c34a705886eb12810dfdf5bcc5122eb4e750cb\n    \n    more fixes"},{"timestamp":1518722324,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Patch Set 7:\n\n(2 comments)"},{"timestamp":1518727138,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 8: Code-Review+1 Integration-Approval+1"},{"timestamp":1518727206,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Uploaded patch set 9: Commit message was updated."},{"timestamp":1518727223,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Orlando Vazquez"},{"timestamp":1519082092,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 6:\n\n\"make check\" passed ok"},{"timestamp":1519082582,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 7:\n\n\"make check\" passed ok"},{"timestamp":1519082702,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 8:\n\n\"make check\" passed ok"}],"currentPatchSet":{"number":"9","revision":"c6bb433c75816f2d7479633794ea911cd2d90647","parents":["81d83dc015004ffc71da484ae319ff23f20b656d"],"ref":"refs/changes/57/3357/9","uploader":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"createdOn":1518727206,"author":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1518727138,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1518727138,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1518727223,"by":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"test/integration/cli-copy.test.js","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"test/integration/helpers.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/lib/common.js","type":"MODIFIED","insertions":14,"deletions":-3}],"sizeInsertions":20,"sizeDeletions":-4},"patchSets":[{"number":"1","revision":"464c959ceb13ce147a25ca522dce9d04d9691276","parents":["81d83dc015004ffc71da484ae319ff23f20b656d"],"ref":"refs/changes/57/3357/1","uploader":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"createdOn":1518556012,"author":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1518556047,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"test/integration/cli-copy.test.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"test/integration/helpers.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/lib/common.js","type":"MODIFIED","insertions":10,"deletions":-1}],"sizeInsertions":14,"sizeDeletions":-2},{"number":"2","revision":"9faab07e262c4b00d972dfa8be849d40b6882f64","parents":["81d83dc015004ffc71da484ae319ff23f20b656d"],"ref":"refs/changes/57/3357/2","uploader":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"createdOn":1518585904,"author":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1518585945,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"test/integration/cli-copy.test.js","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"test/integration/helpers.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/lib/common.js","type":"MODIFIED","insertions":20,"deletions":-1}],"sizeInsertions":26,"sizeDeletions":-2},{"number":"3","revision":"983f69188947fc5797252584455e57acde64ed63","parents":["81d83dc015004ffc71da484ae319ff23f20b656d"],"ref":"refs/changes/57/3357/3","uploader":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"createdOn":1518633962,"author":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1518634001,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"test/lib/common.js","line":96,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"You want these to be a *number* right? ... and then if passed to truncateOutput, any boolean would have asserted on `assert.optionalNumber` there."},{"file":"test/lib/common.js","line":96,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Done"},{"file":"test/lib/common.js","line":113,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"drop that part right, else we are assigning to `renderedStdout` twice"},{"file":"test/lib/common.js","line":113,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Done"},{"file":"test/lib/common.js","line":117,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"drop this part"},{"file":"test/lib/common.js","line":117,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"test/integration/cli-copy.test.js","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"test/integration/helpers.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/lib/common.js","type":"MODIFIED","insertions":20,"deletions":-1}],"sizeInsertions":26,"sizeDeletions":-2},{"number":"4","revision":"e84609fec7c2769efad6ca61995fdb5fff387a90","parents":["81d83dc015004ffc71da484ae319ff23f20b656d"],"ref":"refs/changes/57/3357/4","uploader":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"createdOn":1518636838,"author":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"test/integration/cli-copy.test.js","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"test/integration/helpers.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/lib/common.js","type":"MODIFIED","insertions":20,"deletions":-1},{"file":"tools/rsync-to","type":"MODIFIED","insertions":1,"deletions":0}],"sizeInsertions":27,"sizeDeletions":-2},{"number":"5","revision":"a947731543b48f3888512177b628dbfe0d7ed9b8","parents":["81d83dc015004ffc71da484ae319ff23f20b656d"],"ref":"refs/changes/57/3357/5","uploader":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"createdOn":1518637309,"author":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"test/integration/cli-copy.test.js","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"test/integration/helpers.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/lib/common.js","type":"MODIFIED","insertions":20,"deletions":-1}],"sizeInsertions":26,"sizeDeletions":-2},{"number":"6","revision":"165a87ef2935704dfdd36594cd06e0cb9cde4429","parents":["81d83dc015004ffc71da484ae319ff23f20b656d"],"ref":"refs/changes/57/3357/6","uploader":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"createdOn":1518637474,"author":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"isDraft":false,"kind":"REWORK","comments":[{"file":"test/lib/common.js","line":139,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"How about this (carrying on from the discussion in ~triton-dev just now):\n\n- The trunc function *just* does the truncation to \u0027size\u0027.\n- Where the `new VError` is created, let\u0027s *always* do JSON.stringify on stdout and stderr, regardless of whether the `max*` opts are passed in, to be consistent.\n- Change the error message to have a *space* instead of a newline after `stdout:` and `stderr:`.\n- Don\u0027t bother with the `.replace(...)` to drop the double-quotes around stdout/stderr. I think leaving them in will (a) make it clearer that this is a representation of stdout/stderr and (b) it makes it easier to cut \u0027n paste the whole thing into a node REPL to print it out if wanted."},{"file":"test/lib/common.js","line":139,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"test/integration/cli-copy.test.js","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"test/integration/helpers.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/lib/common.js","type":"MODIFIED","insertions":20,"deletions":-1}],"sizeInsertions":26,"sizeDeletions":-2},{"number":"7","revision":"a92d9b7071fa17b9529efcb92986e3432c55376d","parents":["81d83dc015004ffc71da484ae319ff23f20b656d"],"ref":"refs/changes/57/3357/7","uploader":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"createdOn":1518647232,"author":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"isDraft":false,"kind":"REWORK","comments":[{"file":"test/lib/common.js","line":115,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Did you test this? I think that\u0027ll fail with:\n\n```\n$ node\n\u003e a \u003d 42\n42\n\u003e a()\nTypeError: a is not a function\n    at repl:1:1\n    at REPLServer.defaultEval (repl.js:272:27)\n```"},{"file":"test/lib/common.js","line":115,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Ugh yeah, good catch. I ran this but I didn\u0027t get any errors on those runs. I\u0027ll force some and put the output in the JIRA ticket."},{"file":"test/lib/common.js","line":136,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Drop the JSON.stringify here. We are doing it above."},{"file":"test/lib/common.js","line":136,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"test/integration/cli-copy.test.js","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"test/integration/helpers.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/lib/common.js","type":"MODIFIED","insertions":20,"deletions":-3}],"sizeInsertions":26,"sizeDeletions":-4},{"number":"8","revision":"3bcc30d3ccb507493a8ce8a31b0de72c0d25949b","parents":["81d83dc015004ffc71da484ae319ff23f20b656d"],"ref":"refs/changes/57/3357/8","uploader":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"createdOn":1518671299,"author":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1518727138,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1518727138,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"test/integration/cli-copy.test.js","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"test/integration/helpers.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/lib/common.js","type":"MODIFIED","insertions":14,"deletions":-3}],"sizeInsertions":20,"sizeDeletions":-4},{"number":"9","revision":"c6bb433c75816f2d7479633794ea911cd2d90647","parents":["81d83dc015004ffc71da484ae319ff23f20b656d"],"ref":"refs/changes/57/3357/9","uploader":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"createdOn":1518727206,"author":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1518727138,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1518727138,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1518727223,"by":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"test/integration/cli-copy.test.js","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"test/integration/helpers.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/lib/common.js","type":"MODIFIED","insertions":14,"deletions":-3}],"sizeInsertions":20,"sizeDeletions":-4}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"}]}