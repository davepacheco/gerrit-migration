{"project":"joyent/illumos-joyent","branch":"master","id":"If3195f72a46cb863b80329145921191a60882155","number":"3695","subject":"OS-6791 sdev_plugin_unregister() can deadlock Reviewed by: Robert Mustacchi \u003crm@joyent.com\u003e Approved by: Hans Rosenfeld \u003chans.rosenfeld@joyent.com\u003e","owner":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"url":"https://cr.joyent.us/3695","commitMessage":"OS-6791 sdev_plugin_unregister() can deadlock\nReviewed by: Robert Mustacchi \u003crm@joyent.com\u003e\nApproved by: Hans Rosenfeld \u003chans.rosenfeld@joyent.com\u003e\n","createdOn":1521549639,"lastUpdated":1521661381,"open":false,"status":"MERGED","comments":[{"timestamp":1521549639,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Uploaded patch set 1."},{"timestamp":1521550079,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 1:\n\nWe can take a look at moving the plugin register/unregister into _init/_fini later: but for now, as we\u0027re on something like our 3rd or 4th bug related to the sdev plugin, I\u0027d like to avoid further breakage."},{"timestamp":1521576876,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 1: Code-Review+1\n\nGiven what\u0027s going on, this is probably the best way to deal with this. Unfortunately."},{"timestamp":1521579064,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Uploaded patch set 2: Commit message was updated."},{"timestamp":1521579124,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Uploaded patch set 3: Commit message was updated."},{"timestamp":1521660962,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 4: Patch Set 3 was rebased"},{"timestamp":1521661140,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Patch Set 4: Integration-Approval+1"},{"timestamp":1521661305,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Uploaded patch set 5: Commit message was updated."},{"timestamp":1521661381,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by John Levon"}],"currentPatchSet":{"number":"5","revision":"f3195f72a46cb863b80329145921191a60882155","parents":["15c41273372517a01fee3e63e3ce3edbe11a8de1"],"ref":"refs/changes/95/3695/5","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1521661305,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1521576876,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1521661140,"by":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"}},{"type":"SUBM","value":"1","grantedOn":1521661381,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/uts/common/fs/dev/sdev_plugin.c","type":"MODIFIED","insertions":9,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/vmm_sol_dev.c","type":"MODIFIED","insertions":7,"deletions":-6}],"sizeInsertions":16,"sizeDeletions":-6},"patchSets":[{"number":"1","revision":"336f327716e307e26a542ce30d241a8acd0a407d","parents":["1932f584055941bdb546ada1524aa809fe6c9041"],"ref":"refs/changes/95/3695/1","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1521549639,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1521576876,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/fs/dev/sdev_plugin.c","type":"MODIFIED","insertions":9,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/vmm_sol_dev.c","type":"MODIFIED","insertions":7,"deletions":-6}],"sizeInsertions":16,"sizeDeletions":-6},{"number":"2","revision":"12d447c829811501c3720c5098d025bed5f1e6c7","parents":["1932f584055941bdb546ada1524aa809fe6c9041"],"ref":"refs/changes/95/3695/2","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1521579064,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1521576876,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/uts/common/fs/dev/sdev_plugin.c","type":"MODIFIED","insertions":9,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/vmm_sol_dev.c","type":"MODIFIED","insertions":7,"deletions":-6}],"sizeInsertions":16,"sizeDeletions":-6},{"number":"3","revision":"afc9b98bd3780a3e26cda374799db3b348568f26","parents":["1932f584055941bdb546ada1524aa809fe6c9041"],"ref":"refs/changes/95/3695/3","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1521579124,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1521576876,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"usr/src/uts/common/fs/dev/sdev_plugin.c","type":"MODIFIED","insertions":9,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/vmm_sol_dev.c","type":"MODIFIED","insertions":7,"deletions":-6}],"sizeInsertions":16,"sizeDeletions":-6},{"number":"4","revision":"ac5dd860f142914dac2b2d93c565f665f6ea4ec0","parents":["15c41273372517a01fee3e63e3ce3edbe11a8de1"],"ref":"refs/changes/95/3695/4","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1521660962,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1521576876,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1521661140,"by":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"usr/src/uts/common/fs/dev/sdev_plugin.c","type":"MODIFIED","insertions":9,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/vmm_sol_dev.c","type":"MODIFIED","insertions":7,"deletions":-6}],"sizeInsertions":16,"sizeDeletions":-6},{"number":"5","revision":"f3195f72a46cb863b80329145921191a60882155","parents":["15c41273372517a01fee3e63e3ce3edbe11a8de1"],"ref":"refs/changes/95/3695/5","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1521661305,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1521576876,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1521661140,"by":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"}},{"type":"SUBM","value":"1","grantedOn":1521661381,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/uts/common/fs/dev/sdev_plugin.c","type":"MODIFIED","insertions":9,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/vmm_sol_dev.c","type":"MODIFIED","insertions":7,"deletions":-6}],"sizeInsertions":16,"sizeDeletions":-6}],"allReviewers":[{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}]}