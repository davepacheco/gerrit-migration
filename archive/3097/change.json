{"project":"joyent/sdc-booter","branch":"master","id":"I77fface37522084ca78027e7b47ec724ddec98af","number":"3097","subject":"HEAD-2207 booter should warm cache by writing out files for every CN Reviewed by: Trent Mick \u003ctrentm@gmail.com\u003e Approved by: Trent Mick \u003ctrentm@gmail.com\u003e","owner":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"url":"https://cr.joyent.us/3097","commitMessage":"HEAD-2207 booter should warm cache by writing out files for every CN\nReviewed by: Trent Mick \u003ctrentm@gmail.com\u003e\nApproved by: Trent Mick \u003ctrentm@gmail.com\u003e\n","createdOn":1513097091,"lastUpdated":1515784297,"open":false,"status":"MERGED","comments":[{"timestamp":1513097091,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Uploaded patch set 1."},{"timestamp":1513097118,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1513097620,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Patch Set 1:\n\nI\u0027ve done local manual testing and I think this is ready for an initial review.\n\nQuestions:\n * There is currently no great way for an operator to verify this is working short of arbitrary bash.  I\u0027m leaning towards defering that until artedi integration.\n * I\u0027m unclear how the log level for services is typically configured.  Refreshing the cache for all CNs in a large DC will generate much more output than we currently had.\n * The \u0027allowed modules\u0027 for mocking is totally cargo culted.\n * I\u0027m not super happy with the hard coded test config and  unclear on node object graph\n   construction idioms.  Should CacheSentinel be optional for DHCPD, if only for testing?\n * I don\u0027t understand what config.json.sample is used for.\n * Not sure about docs for new config values.  I\u0027m normally expect comments in the config file, but json doesn\u0027t do that.   I think I\u0027ve seen javadoc-esque comments before, but do not see prior art in this repo.\n * Not sure about best automatic testing approach and still don\u0027t feel like\n   idiomatic callback code is agreeable with unit testing. I have not looked at\n   globe theater yet."},{"timestamp":1513105175,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Uploaded patch set 2."},{"timestamp":1513105201,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1513892424,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Uploaded patch set 3."},{"timestamp":1513892450,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1513892533,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Patch Set 3:\n\nThe latest update should handle the related \"slowness case\" and adds a manual bulk refresh command.   I think that covers the learning from the recent east3b adventure."},{"timestamp":1513980373,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 3:\n\n(22 comments)"},{"timestamp":1515185723,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Uploaded patch set 4."},{"timestamp":1515185748,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1515435946,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Patch Set 3:\n\n(19 comments)"},{"timestamp":1515458129,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 4:\n\n(5 comments)\n\nThis basically looks good to me. I haven\u0027t had a chance to try it out yet. Do you have a build of it?"},{"timestamp":1515536965,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 4:\n\nTested the TRY_BRANCH build with headnode setup in COAL: WFM.\n\nI assume you\u0027ve tested with CN setup for some scenarios?"},{"timestamp":1515700042,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Uploaded patch set 5."},{"timestamp":1515700054,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Patch Set 4:\n\n(4 comments)"},{"timestamp":1515700069,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1515783503,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 5: Code-Review+1 Integration-Approval+1\n\n(1 comment)"},{"timestamp":1515784279,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Patch Set 6: Commit message was updated."},{"timestamp":1515784297,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Chris Burroughs"}],"currentPatchSet":{"number":"6","revision":"24dac37325308403f08668b8d27acb3cc8533388","parents":["5f665800fdbd42846bc7ee83a9fd356c59babb8f"],"ref":"refs/changes/97/3097/6","uploader":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"createdOn":1515784279,"author":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1515700069,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1515783503,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1515783503,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1515784297,"by":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/boot-files.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/booter.js","type":"MODIFIED","insertions":14,"deletions":-6},{"file":"lib/bootparams.js","type":"MODIFIED","insertions":60,"deletions":-2},{"file":"lib/cache.js","type":"ADDED","insertions":287,"deletions":0},{"file":"lib/dhcpd.js","type":"MODIFIED","insertions":45,"deletions":-13},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"sapi_manifests/dhcpd/template","type":"MODIFIED","insertions":9,"deletions":-2},{"file":"test/lib/mocks.js","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"test/lib/server.js","type":"MODIFIED","insertions":11,"deletions":-2}],"sizeInsertions":434,"sizeDeletions":-29},"patchSets":[{"number":"1","revision":"b33468ff6bff32b2f07322a22cb38e6ae1aad679","parents":["5f665800fdbd42846bc7ee83a9fd356c59babb8f"],"ref":"refs/changes/97/3097/1","uploader":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"createdOn":1513097091,"author":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1513097118,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":15,"deletions":0},{"file":"lib/boot-files.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/booter.js","type":"MODIFIED","insertions":4,"deletions":-5},{"file":"lib/cache.js","type":"ADDED","insertions":266,"deletions":0},{"file":"lib/dhcpd.js","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"sapi_manifests/dhcpd/template","type":"MODIFIED","insertions":8,"deletions":-1},{"file":"test/lib/mocks.js","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"test/lib/server.js","type":"MODIFIED","insertions":11,"deletions":-2}],"sizeInsertions":304,"sizeDeletions":-13},{"number":"2","revision":"56946cee27875f5c474bfe0560b6cc2c0869deeb","parents":["5f665800fdbd42846bc7ee83a9fd356c59babb8f"],"ref":"refs/changes/97/3097/2","uploader":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"createdOn":1513105175,"author":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1513105201,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/boot-files.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/booter.js","type":"MODIFIED","insertions":4,"deletions":-5},{"file":"lib/cache.js","type":"ADDED","insertions":288,"deletions":0},{"file":"lib/dhcpd.js","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"sapi_manifests/dhcpd/template","type":"MODIFIED","insertions":8,"deletions":-1},{"file":"test/lib/mocks.js","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"test/lib/server.js","type":"MODIFIED","insertions":11,"deletions":-2}],"sizeInsertions":326,"sizeDeletions":-13},{"number":"3","revision":"cff78261026395175f7b9c59eebf87f4f4b50acc","parents":["5f665800fdbd42846bc7ee83a9fd356c59babb8f"],"ref":"refs/changes/97/3097/3","uploader":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"createdOn":1513892424,"author":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1513892450,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/booter.js","line":112,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"ooooh, nice."},{"file":"lib/bootparams.js","line":122,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Should doc that this is in *seconds*.\nPerhaps move (part of?) the block comment you added below to be the block comment for the whole function?"},{"file":"lib/bootparams.js","line":122,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Done"},{"file":"lib/bootparams.js","line":149,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Might be confusing that a value of zero changes to 28 seconds?"},{"file":"lib/bootparams.js","line":149,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"I don\u0027t think so since setTimeout already ignores 0.  But maybe a distinction between 0 and -1 with timers has some common meaning to humans I am not aware of?"},{"file":"lib/bootparams.js","line":330,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"How about, instead of `pipelineComplete`, this does `if (timeout) { clearTimeout(timeout); }`? I think it would be nice to clear the timeout anyway, and if you do, you don\u0027t need to coordinate with `pipelineComplete`."},{"file":"lib/bootparams.js","line":330,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Done"},{"file":"lib/bootparams.js","line":331,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"There are code paths below here that will call `callback` without checking if the `_timeout` has already done so: i.e. double-call of the callback. \n\nSome other services of ours use the `once` module for this kind of case. Or you could manually do the same with a separate `finish` function (or whatever name) that handled calling `callback` exactly once."},{"file":"lib/bootparams.js","line":331,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Wouldn\u0027t any  double calling of the callback still be a bug?  Would once mask that bug? Or would once.strict give a better error message?\n\nI *think* the code path you are referring to stem from their being async calls within the pipeline callback.  I think a check at the beginning would catch that."},{"file":"lib/cache.js","line":21,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"style nit: We could do  `const VError \u003d require(\u0027verror\u0027);` and then don\u0027t need the `verror.` prefix is code below."},{"file":"lib/cache.js","line":47,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"periodic"},{"file":"lib/cache.js","line":47,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Done"},{"file":"lib/cache.js","line":51,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"with"},{"file":"lib/cache.js","line":51,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Done"},{"file":"lib/cache.js","line":59,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Lovely."},{"file":"lib/cache.js","line":143,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"FYI: In other APIs we\u0027ve been calling this `ctx` for \"context\".  Don\u0027t change if you\u0027d rather not though. This isn\u0027t a strong pattern or rule at all."},{"file":"lib/cache.js","line":143,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Done"},{"file":"lib/cache.js","line":161,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"indentation?"},{"file":"lib/cache.js","line":161,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"I\u0027m not sure I see what is off."},{"file":"lib/cache.js","line":161,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"The \"return next\" is not indented under the preceding `if`."},{"file":"lib/cache.js","line":161,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Done"},{"file":"lib/cache.js","line":185,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Is this really a const?"},{"file":"lib/cache.js","line":185,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"I believe so.  The \"qErrors\" reference is read only  (but the underlying object is not immutable.)"},{"file":"lib/cache.js","line":185,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Okay, fine.\nSeparate (related Q :): Isn\u0027t every array ref constant then?"},{"file":"lib/cache.js","line":185,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"\u003e Separate (related Q :): Isn\u0027t every array ref constant then?\n\nI think that most declarations probably could (should?) be const, but something like this could not be:\n\n\u003e var bar \u003d [1];\nundefined\n\u003e bar \u003d [2]; \n[ 2 ]"},{"file":"lib/cache.js","line":185,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Interesting! This is beer-time discussion though: coding style, in a modern world where JS has `const` now. :)  Actually it isn\u0027t until node **v6** where `const` will do anything. In node v4:\n\n```\n\u003e process.version\n\u0027v4.8.0\u0027\n\u003e const foo \u003d 1\nundefined\n\u003e foo \u003d 2\n2\n```\n\nIn any case, no point belabouring on this here anymore. I.e. all good as is."},{"file":"lib/cache.js","line":198,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Perhaps call this `qTaskDone`."},{"file":"lib/cache.js","line":198,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"queue.push can take an array of tasks."},{"file":"lib/cache.js","line":198,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Done"},{"file":"lib/cache.js","line":198,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Done"},{"file":"lib/cache.js","line":250,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Spelling error there. `VError`."},{"file":"lib/cache.js","line":250,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Done"},{"file":"lib/cache.js","line":265,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Does that error typically include the cacheDir path? Else\nmight be nice to have a log msg here."},{"file":"lib/cache.js","line":265,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"It should look something like:\n\n```\n{ [Error: ENOENT: no such file or directory, scandir \u0027/tmp/yolo\u0027]\n  errno: -2,\n  code: \u0027ENOENT\u0027,\n  syscall: \u0027scandir\u0027,\n  path: \u0027/tmp/yolo\u0027 }\n```\n\nso I think the helpful context is already included."},{"file":"lib/cache.js","line":270,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Would be nice to have a concurrency here. My bad for never having finished https://github.com/joyent/node-vasync/issues/27\n\nWould it be bad to have 1000 concurrent fs.stat\u0027s happening here?"},{"file":"lib/cache.js","line":270,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"I have stumbled upon  issue #27 several times :-)\n\nSince this is in the purge path it doesn\u0027t matter how long it takes, only if it interferes with other things. 1k syscalls does not sound like \"a lot\" to me, nor does an array with 1k functions in it.  I don\u0027t have a clear mental model for how vasync.parrallel performs, but even if we blocked the event loop by dispatching all 1k fs.stat calls serially, I don\u0027t think that would be a problem for a service that has multiple seconds to respond to requests."},{"file":"lib/dhcpd.js","line":8,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Form is:\n\nCopyright (c) YYYY, Joyent, Inc."},{"file":"lib/dhcpd.js","line":8,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Do you want that form changed  in every file touched?"},{"file":"lib/dhcpd.js","line":8,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Meh, just as you come across them. I\u0027m not religious."},{"file":"lib/dhcpd.js","line":8,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Done"},{"file":"lib/dhcpd.js","line":46,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"having a log.child(\u0027cache-sentinel\u0027) for this might be nice."},{"file":"lib/dhcpd.js","line":46,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"From \u003chttps://github.com/trentm/node-bunyan#logchild\u003e it looks like I could use a child logger to always include certain fields.  Which fields would always be included?  Or does using a child do something else?"},{"file":"lib/dhcpd.js","line":46,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Yes, you are correct about child usage."},{"file":"package.json","line":4,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Could consider bumping the version for this change. I\u0027m not sure this version is currently *used* anywhere. Not yet at least."},{"file":"package.json","line":4,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"If it does nothing -- which I think is true --  I\u0027d prefer not to leave something for a future puzzled soul to cargo cult."},{"file":"sapi_manifests/dhcpd/template","line":35,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Given that we now have the \"cache\" key at the end of the JSON file, we should be able to drop having this `{{#allow_missing_class_id}}` *before* the trailing comma. That was a game to make sure the JSON was always valid.\n\nMoving this to the same line as `{{/allow_missing_class_id}}` should be a little clearer."},{"file":"sapi_manifests/dhcpd/template","line":35,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Done"},{"file":"sapi_manifests/dhcpd/template","line":38,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Ignorant Q: does the cache.dir need to be under  the config.tftpRoot dir?"},{"file":"sapi_manifests/dhcpd/template","line":38,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"I have not seen any reason that it would need to be.  My assumption is that I can soon move it to a delegated dataset (under /data or whatever the convention is)."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/boot-files.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/booter.js","type":"MODIFIED","insertions":14,"deletions":-6},{"file":"lib/bootparams.js","type":"MODIFIED","insertions":60,"deletions":-1},{"file":"lib/cache.js","type":"ADDED","insertions":289,"deletions":0},{"file":"lib/dhcpd.js","type":"MODIFIED","insertions":45,"deletions":-13},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"sapi_manifests/dhcpd/template","type":"MODIFIED","insertions":8,"deletions":-1},{"file":"test/lib/mocks.js","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"test/lib/server.js","type":"MODIFIED","insertions":11,"deletions":-2}],"sizeInsertions":435,"sizeDeletions":-27},{"number":"4","revision":"55cb54622a40e49c51c84abd0fbf59a64ba4fbae","parents":["5f665800fdbd42846bc7ee83a9fd356c59babb8f"],"ref":"refs/changes/97/3097/4","uploader":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"createdOn":1515185723,"author":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1515185748,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/bootparams.js","line":444,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"IIUC, in the current code this cannot be true. Either the pipelineTimedOut earlier and we aborted this code path, or we\u0027ve cleared the timeout object. IOW, I think you could drop this `if (pipelineTimedOut)` block."},{"file":"lib/bootparams.js","line":444,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"I believe I convinced myself that you are correct here."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/boot-files.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/booter.js","type":"MODIFIED","insertions":14,"deletions":-6},{"file":"lib/bootparams.js","type":"MODIFIED","insertions":65,"deletions":-2},{"file":"lib/cache.js","type":"ADDED","insertions":287,"deletions":0},{"file":"lib/dhcpd.js","type":"MODIFIED","insertions":45,"deletions":-13},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"sapi_manifests/dhcpd/template","type":"MODIFIED","insertions":9,"deletions":-2},{"file":"test/lib/mocks.js","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"test/lib/server.js","type":"MODIFIED","insertions":11,"deletions":-2}],"sizeInsertions":439,"sizeDeletions":-29},{"number":"5","revision":"77fface37522084ca78027e7b47ec724ddec98af","parents":["5f665800fdbd42846bc7ee83a9fd356c59babb8f"],"ref":"refs/changes/97/3097/5","uploader":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"createdOn":1515700042,"author":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1515700069,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1515783503,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1515783503,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/boot-files.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/booter.js","type":"MODIFIED","insertions":14,"deletions":-6},{"file":"lib/bootparams.js","type":"MODIFIED","insertions":60,"deletions":-2},{"file":"lib/cache.js","type":"ADDED","insertions":287,"deletions":0},{"file":"lib/dhcpd.js","type":"MODIFIED","insertions":45,"deletions":-13},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"sapi_manifests/dhcpd/template","type":"MODIFIED","insertions":9,"deletions":-2},{"file":"test/lib/mocks.js","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"test/lib/server.js","type":"MODIFIED","insertions":11,"deletions":-2}],"sizeInsertions":434,"sizeDeletions":-29},{"number":"6","revision":"24dac37325308403f08668b8d27acb3cc8533388","parents":["5f665800fdbd42846bc7ee83a9fd356c59babb8f"],"ref":"refs/changes/97/3097/6","uploader":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"createdOn":1515784279,"author":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1515700069,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1515783503,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1515783503,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1515784297,"by":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/boot-files.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/booter.js","type":"MODIFIED","insertions":14,"deletions":-6},{"file":"lib/bootparams.js","type":"MODIFIED","insertions":60,"deletions":-2},{"file":"lib/cache.js","type":"ADDED","insertions":287,"deletions":0},{"file":"lib/dhcpd.js","type":"MODIFIED","insertions":45,"deletions":-13},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"sapi_manifests/dhcpd/template","type":"MODIFIED","insertions":9,"deletions":-2},{"file":"test/lib/mocks.js","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"test/lib/server.js","type":"MODIFIED","insertions":11,"deletions":-2}],"sizeInsertions":434,"sizeDeletions":-29}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}]}