{"project":"joyent/pgstatsmon","branch":"master","id":"I769a1a67f64f7590157cb4a7e8d2f0561cc9a384","number":"6419","subject":"MANTA-4212 Postgres 11 Replication Queries Fail for pgstatsmon Reviewed by: Kody A Kantor \u003ckody@kkantor.com\u003e Approved by: Kody A Kantor \u003ckody@kkantor.com\u003e","owner":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"url":"https://cr.joyent.us/6419","commitMessage":"MANTA-4212 Postgres 11 Replication Queries Fail for pgstatsmon\nReviewed by: Kody A Kantor \u003ckody@kkantor.com\u003e\nApproved by: Kody A Kantor \u003ckody@kkantor.com\u003e\n","createdOn":1560245306,"lastUpdated":1561650211,"open":false,"status":"MERGED","comments":[{"timestamp":1560245306,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"Uploaded patch set 1."},{"timestamp":1560245340,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1560842010,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"Uploaded patch set 2."},{"timestamp":1560842044,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1560842877,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"Patch Set 2:\n\nPS2 fixes an issue I saw while testing that metrics return the right values/types.\n\nI was finding that for a given metric, the values at first appeared correct, but the results were not for the exact key that I was expecting. For example, looking at pg_stat_user_tables_n_live_tup using pgstatsmon on master might show that 2.postgres.emy-14.joyent.us-0026143f has 211 live tuples, but with this change that value would be reported for test.postgres.emy-14.joyent.us-7286896b instead.\n\nThis is because there\u0027s a few independent data structures in pgstatsmon, and all of them depend on a specific ordering of indexes. For example, a given database might be at index 2 in the pm_pools array, and its data would also be expected to be at index 2 in pm_data.\n\nThis was fine before because all of those structures were initialised together, but with my change pm_pools was initialised and ordered by when we cueball reported that the backend was added, and the others were ordered by when that backend had finished its setup routine, which would basically depend on what backend performed those queries the fastest.\n\nTo fix this in PS2 I\u0027ve attempted to make sure this order is maintained across these separate structures. Perhaps these should all be keyed in one single data structure instead, but that\u0027s not what I\u0027ve opted for in this change.\n\nI\u0027ll be sure to include this in my testing notes!"},{"timestamp":1560895252,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 2:\n\n(14 comments)"},{"timestamp":1560954742,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"Uploaded patch set 3."},{"timestamp":1560954775,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1560954843,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"Patch Set 2:\n\n(14 comments)\n\nThanks for checking this out!"},{"timestamp":1560977594,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 3: Code-Review+1\n\nLooks good. I\u0027m going to try this out myself too, if you don\u0027t mind."},{"timestamp":1561046920,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 3:\n\nWhat do you think about adding to the docs/overview.md file explaining a little bit about how query selection works now?"},{"timestamp":1561370078,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"Uploaded patch set 4."},{"timestamp":1561370111,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1561370714,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"Patch Set 4:\n\nPS4 splits the pm_pgs initialisation from the initialisation of the other data structures (state, metrics data, etc.).\n\nI was finding that backends weren\u0027t being discovered if they were added while pgstatsmon was already running. I think this had something to do with my removal of the setImmediate when performing a backend setup, but simply adding that back in meant that only one backend was being setup and the other was seeing query timeouts when starting pgstatsmon.\n\nI\u0027m still not 100% on the reason, but ensuring pm_pgs was initialised before backend setup happened lead to all backends being setup properly, and pgstatsmon noticing backends coming and going.\n\n\u003e What do you think about adding to the docs/overview.md file explaining a little bit about how query selection works now?\n\nSounds like a good idea! I\u0027ll get this included in another patch set. I also plan on addressing your comment from MANTA-4212 about query counts as well. I wanted to get this problem I was having sorted as a single push so it was clear what resolved my issues."},{"timestamp":1561456428,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"Uploaded patch set 5."},{"timestamp":1561456461,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1561456738,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"Patch Set 5:\n\nPS5 updates overview.md to include these query changes. I really wanted to point to some postgres docs, but I couldn\u0027t find anything of use. Instead, I opted to include an example in our docs.\n\nAs I was writing this I noticed that the version string schema/regex wasn\u0027t as tight as I\u0027d like, so PS5 also includes a small change there and a minor addition to the test suite. pgstatsmon would have thrown on an assertion on the response from jsprim.parseInteger previously, but now this is a schema error.\n\nLastly, the new \"pg_query_count\" metric is in PS5. It is included as part of the testing notes in MANTA-4212."},{"timestamp":1561561946,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 5: Code-Review+1 Integration-Approval+1\n\nGreat! Thank you. If you think this is good to go then fire away."},{"timestamp":1561650187,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"Uploaded patch set 6: Commit message was updated."},{"timestamp":1561650211,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Richard Bradley"}],"currentPatchSet":{"number":"6","revision":"769a1a67f64f7590157cb4a7e8d2f0561cc9a384","parents":["fb8d355a2caaafd02b46eff5b73dd6f748e99b52"],"ref":"refs/changes/19/6419/6","uploader":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"createdOn":1561650187,"author":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1561456461,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1561561946,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1561561946,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}},{"type":"SUBM","value":"1","grantedOn":1561650211,"by":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"docs/overview.md","type":"MODIFIED","insertions":19,"deletions":0},{"file":"lib/dbinit.js","type":"MODIFIED","insertions":10,"deletions":-5},{"file":"lib/pgstatsmon.js","type":"MODIFIED","insertions":82,"deletions":-62},{"file":"lib/queries.js","type":"MODIFIED","insertions":562,"deletions":-341},{"file":"test/badquery.tst.js","type":"MODIFIED","insertions":10,"deletions":-9},{"file":"test/get_queries.tst.js","type":"ADDED","insertions":47,"deletions":0},{"file":"test/validate_queries.tst.js","type":"ADDED","insertions":133,"deletions":0}],"sizeInsertions":863,"sizeDeletions":-417},"patchSets":[{"number":"1","revision":"9a8a9cb9777ce18fefdc18372c9da07f3fa17bf6","parents":["fb8d355a2caaafd02b46eff5b73dd6f748e99b52"],"ref":"refs/changes/19/6419/1","uploader":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"createdOn":1560245306,"author":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1560245340,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/dbinit.js","line":357,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"This looks good. It might be useful to make the return value an object so we can add things more easily later. I don\u0027t know what we would want to add off the top of my head though, so this looks good as it is."},{"file":"lib/dbinit.js","line":357,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"Done"},{"file":"lib/pgstatsmon.js","line":316,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"What do you think about having this be a member of the pm_pgs objects rather than the pm_pools objects? It looks like pm_pgs was meant to hold Postgres information and this structure was meant to hold connection/initialization information."},{"file":"lib/pgstatsmon.js","line":316,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"Sounds good to me! I\u0027ve changed this in PS3."},{"file":"lib/pgstatsmon.js","line":319,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"IIUC this blocks us from receiving \u0027added\u0027 events until the backend is set up now, but it will help us set up the pm_pools and related data structures (because the index won\u0027t be changing?)?"},{"file":"lib/pgstatsmon.js","line":319,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"I can see this comment is on PS1. Is your comment referring to its removal in PS2? Or that it\u0027s still in place as of PS1?\n\nThis call to setImmediate was removed in PS2 because I found it was the only way to get all backends to finish setup, but I don\u0027t really understand why I needed to do that. Could you help me understand?\n\nI\u0027m worried I\u0027m meddling with the wrong things here because this setImmediate call is also done a few times in `tick()`."},{"file":"test/badquery.tst.js","line":110,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Do the tests still work if we don\u0027t call tick() here?"},{"file":"test/badquery.tst.js","line":110,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"It appears so, but I\u0027m not sure why. I\u0027ve put this back in PS3, if only to err on the side of not changing something if it doesn\u0027t need to be."},{"file":"test/badquery.tst.js","line":160,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"I think we had to use initializeMetrics() here previously because if the backend target had been scraped there was some garbage data left behind when this test ran. If we overwrote the queries then pgstatsmon would get confused due to the mismatch of old vs new queries. Is it safe to skip this call now?"},{"file":"test/badquery.tst.js","line":160,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"I don\u0027t recall why I removed this in order for the test suite to pass. I\u0027ve put this back in PS3, though I admit that I don\u0027t fully understand why (the test appeared to be working without it)."},{"file":"test/badquery.tst.js","line":166,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Could we pull this out so it\u0027s not in the vasync pipeline?"},{"file":"test/badquery.tst.js","line":166,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"Yep! Done in PS3.\n\nThough the comments for the other parts of this test suite make me wonder if this (or in its new position) is the right place to set these queries.\n\nWhat do you think? The test suite seems to work in PS3."},{"file":"test/get_queries.tst.js","line":6,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Looks like our new copyright guidance says to not include a comma here."},{"file":"test/get_queries.tst.js","line":6,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"Done (and across the other files touched by this change)."},{"file":"test/get_queries.tst.js","line":24,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Should we also have a test for Postgres 11?"},{"file":"test/get_queries.tst.js","line":24,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/dbinit.js","type":"MODIFIED","insertions":6,"deletions":-4},{"file":"lib/pgstatsmon.js","type":"MODIFIED","insertions":47,"deletions":-45},{"file":"lib/queries.js","type":"MODIFIED","insertions":518,"deletions":-339},{"file":"test/badquery.tst.js","type":"MODIFIED","insertions":12,"deletions":-12},{"file":"test/get_queries.tst.js","type":"ADDED","insertions":36,"deletions":0},{"file":"test/validate_queries.tst.js","type":"ADDED","insertions":122,"deletions":0}],"sizeInsertions":741,"sizeDeletions":-400},{"number":"2","revision":"a4738c7f598ae333e561b84ea9bc57325a07c9f7","parents":["fb8d355a2caaafd02b46eff5b73dd6f748e99b52"],"ref":"refs/changes/19/6419/2","uploader":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"createdOn":1560842010,"author":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1560842044,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/queries.js","line":216,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"I wonder if we should add a comment under each version that explains how/why we changed the query for each Postgres version. It seems like it would be helpful for readers when there are only very small changes like this sent_[location|lsn]. But it might be too much maintenance overhead.\n\nWhat do you think?"},{"file":"lib/queries.js","line":216,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"I think it\u0027s worthwhile. The QUERIES structure is quite hard on the eyes as it is, so perhaps a summary at the start will be enough. I\u0027ve added this in PS3. Let me know what you think!"},{"file":"lib/queries.js","line":530,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Can we assert instead of throwing?"},{"file":"lib/queries.js","line":530,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"Sure thing! With a bit of juggling for your later logging comment I\u0027ve made some changes to PS3 that makes this part a little cleaner."},{"file":"lib/queries.js","line":540,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Can we pull that comment explaining the expiry value back in?"},{"file":"lib/queries.js","line":540,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"Thanks for catching that! Re-added in PS3."},{"file":"lib/queries.js","line":572,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Postgres formats their numbers in a way that makes them always ascending as minor versions are released, right? Like Postgres 9.6.3 is 90603, and 9.6.10 (if such a thing exists) is 90610?"},{"file":"lib/queries.js","line":572,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"Yes, as far as I\u0027ve been able to tell.\n\nOnce upon a time I found a really great resource that explained how this works, but I\u0027ve struggled to find it since.\n\nI headed to the source to find this out and the best I could find was how this is gathered at compile time (which I think is accurate based on the docs: https://www.postgresql.org/docs/9.6/runtime-config-preset.html).\n\nThe following is the commit that moved from the old version number scheme to the new: https://github.com/postgres/postgres/commit/d0c80c17f1a6d0b93d2ca14fe47d83b131ce9108#diff-e2d5a00791bce9a01f99bc6fd613a39dL16810\n\nAnd some example versions passed through that `awk` (old and new, as close to source as I could get): https://gist.github.com/chudley/e55e3180f450ab3a769f4743d861e7ba"},{"file":"lib/queries.js","line":580,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Should we log at debug level if a query isn\u0027t applicable?\n\nAlso, do you think we should log at error level or assert if no queries are applicable (which should never happen except in the case of programmer error)?"},{"file":"lib/queries.js","line":580,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"\u003e Should we log at debug level if a query isn\u0027t applicable?\n\nI think so! This way, if a user is needs to find out why their pgstatsmon is performing less queries depending on the version, it\u0027s possible to determine this from the logs instead of heading to the source. I\u0027ve added a debug log message in PS3 that should explain why a query was skipped.\n\n\u003e Also, do you think we should log at error level or assert if no queries are applicable (which should never happen except in the case of programmer error)?\n\nI think today it is fine to make an assertion on at least some queries being returned. I\u0027m struggling to think of a situation where no queries is OK. Maybe in the future we move to a situation where the query list comes from outside of pgstatsmon, in which case a log message would be better. Until then I think an assertion is fine. I\u0027ve added an assertion for no applicable queries in PS3."},{"file":"lib/queries.js","line":587,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"This is only exported for the tests, right? Maybe we should add a comment here so that others don\u0027t inadvertently use it at a later date somewhere else."},{"file":"lib/queries.js","line":587,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/dbinit.js","type":"MODIFIED","insertions":6,"deletions":-4},{"file":"lib/pgstatsmon.js","type":"MODIFIED","insertions":55,"deletions":-54},{"file":"lib/queries.js","type":"MODIFIED","insertions":518,"deletions":-339},{"file":"test/badquery.tst.js","type":"MODIFIED","insertions":12,"deletions":-12},{"file":"test/get_queries.tst.js","type":"ADDED","insertions":36,"deletions":0},{"file":"test/validate_queries.tst.js","type":"ADDED","insertions":122,"deletions":0}],"sizeInsertions":749,"sizeDeletions":-409},{"number":"3","revision":"2a1c4f5ee365a94caba1a981a3b64667e999f9e5","parents":["fb8d355a2caaafd02b46eff5b73dd6f748e99b52"],"ref":"refs/changes/19/6419/3","uploader":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"createdOn":1560954742,"author":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1560954775,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1560977594,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/dbinit.js","type":"MODIFIED","insertions":10,"deletions":-5},{"file":"lib/pgstatsmon.js","type":"MODIFIED","insertions":59,"deletions":-61},{"file":"lib/queries.js","type":"MODIFIED","insertions":562,"deletions":-341},{"file":"test/badquery.tst.js","type":"MODIFIED","insertions":10,"deletions":-9},{"file":"test/get_queries.tst.js","type":"ADDED","insertions":47,"deletions":0},{"file":"test/validate_queries.tst.js","type":"ADDED","insertions":122,"deletions":0}],"sizeInsertions":810,"sizeDeletions":-416},{"number":"4","revision":"9fd8a9c3aa52cfd411958270aebfcc3d74ad2706","parents":["fb8d355a2caaafd02b46eff5b73dd6f748e99b52"],"ref":"refs/changes/19/6419/4","uploader":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"createdOn":1561370078,"author":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1561370111,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/dbinit.js","type":"MODIFIED","insertions":10,"deletions":-5},{"file":"lib/pgstatsmon.js","type":"MODIFIED","insertions":71,"deletions":-62},{"file":"lib/queries.js","type":"MODIFIED","insertions":562,"deletions":-341},{"file":"test/badquery.tst.js","type":"MODIFIED","insertions":10,"deletions":-9},{"file":"test/get_queries.tst.js","type":"ADDED","insertions":47,"deletions":0},{"file":"test/validate_queries.tst.js","type":"ADDED","insertions":122,"deletions":0}],"sizeInsertions":822,"sizeDeletions":-417},{"number":"5","revision":"6dd198f0bc823b9692b7cedd23cb510443f19ff0","parents":["fb8d355a2caaafd02b46eff5b73dd6f748e99b52"],"ref":"refs/changes/19/6419/5","uploader":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"createdOn":1561456428,"author":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1561456461,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1561561946,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1561561946,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"docs/overview.md","type":"MODIFIED","insertions":19,"deletions":0},{"file":"lib/dbinit.js","type":"MODIFIED","insertions":10,"deletions":-5},{"file":"lib/pgstatsmon.js","type":"MODIFIED","insertions":82,"deletions":-62},{"file":"lib/queries.js","type":"MODIFIED","insertions":562,"deletions":-341},{"file":"test/badquery.tst.js","type":"MODIFIED","insertions":10,"deletions":-9},{"file":"test/get_queries.tst.js","type":"ADDED","insertions":47,"deletions":0},{"file":"test/validate_queries.tst.js","type":"ADDED","insertions":133,"deletions":0}],"sizeInsertions":863,"sizeDeletions":-417},{"number":"6","revision":"769a1a67f64f7590157cb4a7e8d2f0561cc9a384","parents":["fb8d355a2caaafd02b46eff5b73dd6f748e99b52"],"ref":"refs/changes/19/6419/6","uploader":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"createdOn":1561650187,"author":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1561456461,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"SUBM","value":"1","grantedOn":1561650211,"by":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1561561946,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1561561946,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"docs/overview.md","type":"MODIFIED","insertions":19,"deletions":0},{"file":"lib/dbinit.js","type":"MODIFIED","insertions":10,"deletions":-5},{"file":"lib/pgstatsmon.js","type":"MODIFIED","insertions":82,"deletions":-62},{"file":"lib/queries.js","type":"MODIFIED","insertions":562,"deletions":-341},{"file":"test/badquery.tst.js","type":"MODIFIED","insertions":10,"deletions":-9},{"file":"test/get_queries.tst.js","type":"ADDED","insertions":47,"deletions":0},{"file":"test/validate_queries.tst.js","type":"ADDED","insertions":133,"deletions":0}],"sizeInsertions":863,"sizeDeletions":-417}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"}]}