From d15e2bda704aa6bcae5f86ddef94727310a66f62 Mon Sep 17 00:00:00 2001
From: Todd Whiteman <todd.whiteman@joyent.com>
Date: Tue, 12 Dec 2017 12:51:46 -0800
Subject: [PATCH] DOCKER-1132 fix failing docker rmi test

---
 test/integration/api-images.test.js | 14 +++++++++++++-
 1 file changed, 13 insertions(+), 1 deletion(-)

diff --git a/test/integration/api-images.test.js b/test/integration/api-images.test.js
index 93a4a09..9a98625 100644
--- a/test/integration/api-images.test.js
+++ b/test/integration/api-images.test.js
@@ -199,10 +199,22 @@ test('docker images', function (tt) {
         });
     });
 
+    // Try and delete 'ubuntu:latest' - should be a 404 error, as the image
+    // was pulled by digest, which means no tag was assigned to the image.
     tt.test('delete image', function (t) {
         DOCKER_ALICE.del('/images/ubuntu', ondel);
         function ondel(err, req, res) {
-            t.error(err, 'should be no error retrieving images');
+            t.ok(err, 'should be an error deleting ubuntu image by tag');
+            t.end();
+        }
+    });
+
+    // Delete ubuntu image using it's manifest digest.
+    tt.test('delete image', function (t) {
+        var repoDigest = img.RepoDigests[0];
+        DOCKER_ALICE.del('/images/' + repoDigest, ondel);
+        function ondel(err, req, res) {
+            t.error(err, 'no error deleting image by manifest digest');
             t.end();
         }
     });
-- 
2.21.0

