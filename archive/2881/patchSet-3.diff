From ad05045d3b7babce7cdb78c3e9b89fc259954203 Mon Sep 17 00:00:00 2001
From: Jan Wyszynski <jan.wyszynski@joyent.com>
Date: Thu, 26 Oct 2017 20:14:03 +0000
Subject: [PATCH] MANTA-2412 Allow addition of content-disposition header to
 manta objects

---
 lib/common.js | 1 +
 lib/obj.js    | 2 ++
 package.json  | 2 +-
 3 files changed, 4 insertions(+), 1 deletion(-)

diff --git a/lib/common.js b/lib/common.js
index fcced7c..b436fc1 100644
--- a/lib/common.js
+++ b/lib/common.js
@@ -226,6 +226,7 @@ function createMetadata(req, type, cb) {
         break;
 
     case 'object':
+        md.contentDisposition = req.header('content-disposition');
         md.contentLength = req._size !== undefined ?
             req._size : prev.contentLength;
         md.contentMD5 = req._contentMD5 || prev.contentMD5;
diff --git a/lib/obj.js b/lib/obj.js
index 59993b3..653514e 100644
--- a/lib/obj.js
+++ b/lib/obj.js
@@ -709,6 +709,7 @@ function streamFromSharks(req, res, next) {
     if (md.contentLength === 0 || req.method === 'HEAD') {
         log.debug('streamFromSharks: HEAD || zero-byte object');
         res.header('Durability-Level', req.metadata.sharks.length);
+        res.header('Content-Disposition', req.metadata.contentDisposition);
         res.header('Content-Length', md.contentLength);
         res.header('Content-MD5', md.contentMD5);
         res.header('Content-Type', md.contentType);
@@ -732,6 +733,7 @@ function streamFromSharks(req, res, next) {
             res.header('Content-MD5', md.contentMD5);
         }
 
+        res.header('Content-Disposition', req.metadata.contentDisposition);
         res.header('Content-Length', sh['content-length']);
         res.header('Durability-Level', req.metadata.sharks.length);
 
diff --git a/package.json b/package.json
index 5c32f40..a9421f4 100644
--- a/package.json
+++ b/package.json
@@ -26,7 +26,7 @@
         "kang": "1.1.0",
         "keep-alive-agent": "0.0.1",
         "keyapi": "git+https://github.com/joyent/keyapi.git#e14b3d58",
-        "libmanta": "git+https://github.com/joyent/node-libmanta.git#master",
+        "libmanta": "file:../node-libmanta",
         "libuuid": "0.1.2",
         "lru-cache": "2.3.1",
         "lstream": "0.0.4",
-- 
2.21.0

