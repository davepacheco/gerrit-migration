{"project":"joyent/illumos-joyent","branch":"master","id":"I82b4be020e584aa3ec7288d22c6f956ed0a8c31c","number":"3608","subject":"OS-6665 Would like mechanism to determine how many vcpus bhyve supports Reviewed by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e Reviewed by: Mike Gerdts \u003cmike.gerdts@joyent.com\u003e Approved by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e","owner":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"url":"https://cr.joyent.us/3608","commitMessage":"OS-6665 Would like mechanism to determine how many vcpus bhyve supports\nReviewed by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e\nReviewed by: Mike Gerdts \u003cmike.gerdts@joyent.com\u003e\nApproved by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e\n","createdOn":1520944592,"lastUpdated":1521143791,"open":false,"status":"MERGED","comments":[{"timestamp":1520944592,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 1."},{"timestamp":1520948368,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1520949049,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 1:\n\nIt would be easy to make that change but it feels to me like these are answers to two different questions which might be asked by two different consumers (or at least at different times during configuration) so that\u0027s why I didn\u0027t couple them together. However, I don\u0027t know what the consumer(s) will actually want and I don\u0027t feel strongly about it, so I can change this if you want me to."},{"timestamp":1520949496,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 1:\n\nI don\u0027t feel strongly about it.  Let\u0027s see what Patrick thinks."},{"timestamp":1520949687,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 1:\n\nsounds good to me"},{"timestamp":1521138173,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 1:\n\nI lean toward the \u0027-c\u0027 option returning non-success if bhyve isn\u0027t available for use. (although printing MAXCPU still seems fine)\n\nIf in the future, MAXCPU is a runtime tunable (which seems at least possible), then callers would need to handle failure from -c if it\u0027s not supported.  Or maybe, we should emit 0 for MAXCPUS?"},{"timestamp":1521139900,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 1:\n\nI\u0027ve updated the code so that it still performs the HW compat. check on -c."},{"timestamp":1521139919,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 2."},{"timestamp":1521141422,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 2: Code-Review+1"},{"timestamp":1521143432,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 2: Code-Review+1"},{"timestamp":1521143461,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 2: Integration-Approval+1"},{"timestamp":1521143776,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 3: Commit message was updated."},{"timestamp":1521143791,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Jerry Jelinek"}],"currentPatchSet":{"number":"3","revision":"82b4be020e584aa3ec7288d22c6f956ed0a8c31c","parents":["d8aa9216af8c1d23eaddba43fdd00ffe3f59da7a"],"ref":"refs/changes/08/3608/3","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1521143776,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1521141422,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1521143432,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1521143461,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"SUBM","value":"1","grantedOn":1521143791,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/lib/brand/bhyve/zone/bhhwcompat.c","type":"MODIFIED","insertions":17,"deletions":-5}],"sizeInsertions":17,"sizeDeletions":-5},"patchSets":[{"number":"1","revision":"030f8e772c34ef61ef1e8e508d4551fcf3905c43","parents":["b13e485c93c36fd37d5470756bc0f7d7bd44d018"],"ref":"refs/changes/08/3608/1","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1520944592,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/lib/brand/bhyve/zone/bhhwcompat.c","line":22,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Is it useful to know how many vcpus the build supports if you are running on unsupported hardware?  My gut feeling is that to avoid being misleading, it would be better to do the max_cpu check after the ioctl() succeeds."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/brand/bhyve/zone/bhhwcompat.c","type":"MODIFIED","insertions":18,"deletions":-5}],"sizeInsertions":18,"sizeDeletions":-5},{"number":"2","revision":"48d9ea26d2c11f464ac506c6a3b2fd073373f61e","parents":["d8aa9216af8c1d23eaddba43fdd00ffe3f59da7a"],"ref":"refs/changes/08/3608/2","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1521139919,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1521143432,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1521143461,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1521141422,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/brand/bhyve/zone/bhhwcompat.c","type":"MODIFIED","insertions":17,"deletions":-5}],"sizeInsertions":17,"sizeDeletions":-5},{"number":"3","revision":"82b4be020e584aa3ec7288d22c6f956ed0a8c31c","parents":["d8aa9216af8c1d23eaddba43fdd00ffe3f59da7a"],"ref":"refs/changes/08/3608/3","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1521143776,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"SUBM","value":"1","grantedOn":1521143791,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1521143432,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1521143461,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1521141422,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/lib/brand/bhyve/zone/bhhwcompat.c","type":"MODIFIED","insertions":17,"deletions":-5}],"sizeInsertions":17,"sizeDeletions":-5}],"allReviewers":[{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}]}