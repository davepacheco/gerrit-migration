From 728ec04e90102fe24d13bcf36d863ce5d85d8db9 Mon Sep 17 00:00:00 2001
From: Julien Gilli <julien.gilli@joyent.com>
Date: Thu, 22 Feb 2018 19:43:27 -0800
Subject: [PATCH] TOOLS-1983 How to avoid hard failure of most builds on Feb 22
 from GitHub weak crypto removal

---
 Makefile | 14 +++++++++-----
 1 file changed, 9 insertions(+), 5 deletions(-)

diff --git a/Makefile b/Makefile
index 8420e01..afbc590 100644
--- a/Makefile
+++ b/Makefile
@@ -22,12 +22,16 @@ JSL_FILES_NODE	 = $(JS_FILES)
 JSSTYLE_FILES	 = $(JS_FILES)
 JSSTYLE_FLAGS	 = -f tools/jsstyle.conf
 
-# Use sdc-smartos/1.6.3 builds, but don't really care because we use the 'gz'
-# tag.
-NODE_PREBUILT_IMAGE=fd2cc906-8938-11e3-beab-4359c665ac99
+# sdc-minimal-multiarch-lts 15.4.1
+NODE_PREBUILT_IMAGE=18b094b0-eb01-11e5-80c1-175dac7ddf02
 ifeq ($(shell uname -s),SunOS)
-	NODE_PREBUILT_VERSION=v0.10.26
-	NODE_PREBUILT_TAG=gz
+	NODE_PREBUILT_VERSION=v0.10.48
+	# Even if sdc-system-tests runs in the GZ, we use a node build with a "zone"
+	# tag because a "gz" node build is not currently available for
+	# multiarch-15.4.1 images. However, a "gz" build would not differ from the
+	# one with the "zone" tag, so it's safe to use the "zone" one until the "gz"
+	# one is available.
+	NODE_PREBUILT_TAG=zone
 else
 	NPM	:= $(shell which npm)
 endif
-- 
2.21.0

