{"project":"joyent/sdc-designation","branch":"master","id":"I60c37113eb745741fd2d374090a26c08150fa426","number":"5911","subject":"TRITON-9 affinity is racy Reviewed by: Pedro Palazón Candel \u003cpedro@joyent.com\u003e Approved by: Pedro Palazón Candel \u003cpedro@joyent.com\u003e","owner":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"url":"https://cr.joyent.us/5911","commitMessage":"TRITON-9 affinity is racy\nReviewed by: Pedro Palazón Candel \u003cpedro@joyent.com\u003e\nApproved by: Pedro Palazón Candel \u003cpedro@joyent.com\u003e\n","createdOn":1552947704,"lastUpdated":1554478142,"open":false,"status":"MERGED","comments":[{"timestamp":1552947704,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Uploaded patch set 1."},{"timestamp":1552947732,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1552948062,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Uploaded patch set 2: Patch Set 1 was rebased."},{"timestamp":1552948090,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2:\n\n\"make check\" passed ok"},{"timestamp":1554223109,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Uploaded patch set 3."},{"timestamp":1554223136,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1554306088,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 3: Code-Review+1\n\n(5 comments)\n\nLooks Ok but for some minor nits. Shall I assume tests are passing as expected too?"},{"timestamp":1554311225,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Uploaded patch set 4."},{"timestamp":1554311252,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1554477917,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 4:\n\n\u003e Shall I assume tests are passing as expected too?\n\nYep."},{"timestamp":1554478079,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 4: Code-Review+1 Integration-Approval+1"},{"timestamp":1554478137,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 5: Commit message was updated."},{"timestamp":1554478142,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Marsell Kukuljevic"}],"currentPatchSet":{"number":"5","revision":"f2b4e8dac18b400a64fedb27db869b8d32ef009b","parents":["c5b0700ec15f7091c6e22ac75a8ae6b939d38f46"],"ref":"refs/changes/11/5911/5","uploader":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"createdOn":1554478137,"author":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1554311252,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1554478079,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1554478079,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"SUBM","value":"1","grantedOn":1554478142,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":62,"deletions":-2},{"file":"lib/algorithms/calculate-affinity.js","type":"ADDED","insertions":125,"deletions":0},{"file":"lib/algorithms/hard-filter-volumes-from.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/algorithms/shared/affinity.js","type":"ADDED","insertions":575,"deletions":0},{"file":"lib/validations.js","type":"MODIFIED","insertions":45,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"test/algorithms/calculate-affinity.test.js","type":"ADDED","insertions":822,"deletions":0},{"file":"test/algorithms/common.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/algorithms/hard-filter-volumes-from.test.js","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"test/allocator.test.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"test/common.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"test/integration.test.js","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"test/validations.test.js","type":"MODIFIED","insertions":68,"deletions":0}],"sizeInsertions":1717,"sizeDeletions":-11},"patchSets":[{"number":"1","revision":"e262c738ac7da5a7f04ce9cb76df05aade36e9c7","parents":["296a786be98c325c9f30eff4dce16ed04047c9b5"],"ref":"refs/changes/11/5911/1","uploader":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"createdOn":1552947704,"author":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1552947732,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":62,"deletions":-2},{"file":"lib/algorithms/calculate-affinity.js","type":"ADDED","insertions":114,"deletions":0},{"file":"lib/algorithms/hard-filter-volumes-from.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/algorithms/shared/affinity.js","type":"ADDED","insertions":575,"deletions":0},{"file":"lib/validations.js","type":"MODIFIED","insertions":45,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"test/algorithms/calculate-affinity.test.js","type":"ADDED","insertions":822,"deletions":0},{"file":"test/algorithms/common.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/algorithms/hard-filter-volumes-from.test.js","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"test/allocator.test.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"test/common.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"test/integration.test.js","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"test/validations.test.js","type":"MODIFIED","insertions":68,"deletions":0}],"sizeInsertions":1706,"sizeDeletions":-11},{"number":"2","revision":"7bcd187cabd7a04d46b5a644b0aee062f5110920","parents":["c5b0700ec15f7091c6e22ac75a8ae6b939d38f46"],"ref":"refs/changes/11/5911/2","uploader":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"createdOn":1552948062,"author":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1552947732,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":62,"deletions":-2},{"file":"lib/algorithms/calculate-affinity.js","type":"ADDED","insertions":114,"deletions":0},{"file":"lib/algorithms/hard-filter-volumes-from.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/algorithms/shared/affinity.js","type":"ADDED","insertions":575,"deletions":0},{"file":"lib/validations.js","type":"MODIFIED","insertions":45,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"test/algorithms/calculate-affinity.test.js","type":"ADDED","insertions":822,"deletions":0},{"file":"test/algorithms/common.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/algorithms/hard-filter-volumes-from.test.js","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"test/allocator.test.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"test/common.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"test/integration.test.js","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"test/validations.test.js","type":"MODIFIED","insertions":68,"deletions":0}],"sizeInsertions":1706,"sizeDeletions":-11},{"number":"3","revision":"f3243aa3647c3100d157181a4d8dacaa89fa6c8b","parents":["c5b0700ec15f7091c6e22ac75a8ae6b939d38f46"],"ref":"refs/changes/11/5911/3","uploader":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"createdOn":1554223109,"author":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1554223136,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1554306088,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"comments":[{"file":"docs/index.md","line":658,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"\"for\"?"},{"file":"docs/index.md","line":672,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"\"they are the same thing\""},{"file":"lib/algorithms/calculate-affinity.js","line":39,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"\"colocation\""},{"file":"lib/algorithms/calculate-affinity.js","line":63,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Nit: it would be great to define the expected arguments here, together with the callback methods signature."},{"file":"lib/algorithms/shared/affinity.js","line":7,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"The whole file?"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":62,"deletions":-2},{"file":"lib/algorithms/calculate-affinity.js","type":"ADDED","insertions":135,"deletions":0},{"file":"lib/algorithms/hard-filter-volumes-from.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/algorithms/shared/affinity.js","type":"ADDED","insertions":575,"deletions":0},{"file":"lib/validations.js","type":"MODIFIED","insertions":45,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"test/algorithms/calculate-affinity.test.js","type":"ADDED","insertions":822,"deletions":0},{"file":"test/algorithms/common.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/algorithms/hard-filter-volumes-from.test.js","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"test/allocator.test.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"test/common.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"test/integration.test.js","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"test/validations.test.js","type":"MODIFIED","insertions":68,"deletions":0}],"sizeInsertions":1727,"sizeDeletions":-11},{"number":"4","revision":"60c37113eb745741fd2d374090a26c08150fa426","parents":["c5b0700ec15f7091c6e22ac75a8ae6b939d38f46"],"ref":"refs/changes/11/5911/4","uploader":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"createdOn":1554311225,"author":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1554311252,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1554478079,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1554478079,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":62,"deletions":-2},{"file":"lib/algorithms/calculate-affinity.js","type":"ADDED","insertions":125,"deletions":0},{"file":"lib/algorithms/hard-filter-volumes-from.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/algorithms/shared/affinity.js","type":"ADDED","insertions":575,"deletions":0},{"file":"lib/validations.js","type":"MODIFIED","insertions":45,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"test/algorithms/calculate-affinity.test.js","type":"ADDED","insertions":822,"deletions":0},{"file":"test/algorithms/common.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/algorithms/hard-filter-volumes-from.test.js","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"test/allocator.test.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"test/common.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"test/integration.test.js","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"test/validations.test.js","type":"MODIFIED","insertions":68,"deletions":0}],"sizeInsertions":1717,"sizeDeletions":-11},{"number":"5","revision":"f2b4e8dac18b400a64fedb27db869b8d32ef009b","parents":["c5b0700ec15f7091c6e22ac75a8ae6b939d38f46"],"ref":"refs/changes/11/5911/5","uploader":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"createdOn":1554478137,"author":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1554311252,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1554478079,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1554478079,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"SUBM","value":"1","grantedOn":1554478142,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":62,"deletions":-2},{"file":"lib/algorithms/calculate-affinity.js","type":"ADDED","insertions":125,"deletions":0},{"file":"lib/algorithms/hard-filter-volumes-from.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/algorithms/shared/affinity.js","type":"ADDED","insertions":575,"deletions":0},{"file":"lib/validations.js","type":"MODIFIED","insertions":45,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"test/algorithms/calculate-affinity.test.js","type":"ADDED","insertions":822,"deletions":0},{"file":"test/algorithms/common.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/algorithms/hard-filter-volumes-from.test.js","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"test/allocator.test.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"test/common.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"test/integration.test.js","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"test/validations.test.js","type":"MODIFIED","insertions":68,"deletions":0}],"sizeInsertions":1717,"sizeDeletions":-11}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"}]}