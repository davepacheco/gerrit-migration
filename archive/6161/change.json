{"project":"joyent/schemas","branch":"master","topic":"TRITON-1353","id":"I5daa8511e8aad151596f03abfc97cef59d88ccfd","number":"6161","subject":"TRITON-1353 Triton systems should be able to disable SMT Reviewed by: Trent Mick \u003ctrentm@gmail.com\u003e Approved by: Trent Mick \u003ctrentm@gmail.com\u003e","owner":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"url":"https://cr.joyent.us/6161","commitMessage":"TRITON-1353 Triton systems should be able to disable SMT\nReviewed by: Trent Mick \u003ctrentm@gmail.com\u003e\nApproved by: Trent Mick \u003ctrentm@gmail.com\u003e\n","createdOn":1556208804,"lastUpdated":1557837411,"open":false,"status":"MERGED","comments":[{"timestamp":1556208804,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Uploaded patch set 1."},{"timestamp":1556208805,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit d45f38bacb8c0d9adbf52e447cffbf16ad5342e3\n    \n    m"},{"timestamp":1556208827,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1556208838,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Topic set to TRITON-1353"},{"timestamp":1556712399,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Uploaded patch set 2."},{"timestamp":1556712400,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit 97f3d3fcfbfa3e4d7be3b892d84ac17bc126b438\n    \n    m"},{"timestamp":1556712422,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1556909375,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1557243148,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Uploaded patch set 3: Commit message was updated."},{"timestamp":1557306322,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1557362115,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1557396689,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1557421700,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1557423147,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1557424960,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1557788492,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 3: Code-Review+1 Integration-Approval+1"},{"timestamp":1557836464,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Uploaded patch set 4: Commit message was updated."},{"timestamp":1557837411,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by John Levon"}],"currentPatchSet":{"number":"4","revision":"5daa8511e8aad151596f03abfc97cef59d88ccfd","parents":["f920a0d76e7047de7df2fd2b20103874c355bffb"],"ref":"refs/changes/61/6161/4","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1557836464,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1556712422,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1557788492,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1557788492,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1557837411,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/cnapi/server.js","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"lib/dapi/server.js","type":"MODIFIED","insertions":5,"deletions":-1}],"sizeInsertions":11,"sizeDeletions":-3},"patchSets":[{"number":"1","revision":"26e197eee1ac8c178826a3375667936b6268d0e2","parents":["f920a0d76e7047de7df2fd2b20103874c355bffb"],"ref":"refs/changes/61/6161/1","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1556208804,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1556208827,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/cnapi/server.js","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"lib/dapi/server.js","type":"MODIFIED","insertions":4,"deletions":0}],"sizeInsertions":10,"sizeDeletions":-2},{"number":"2","revision":"31dd4a5e5afd46082b242c123b0e8b9b821a4024","parents":["f920a0d76e7047de7df2fd2b20103874c355bffb"],"ref":"refs/changes/61/6161/2","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1556712399,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1556712422,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/cnapi/server.js","line":206,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"These are changing to be optional from a schema perspective because the idea is that we\u0027ll have the newer values. Is something else that uses this schema going through and verifying that that\u0027s the case?\n\nThis also holds for the DAPI case."},{"file":"lib/cnapi/server.js","line":206,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Sorry, realised I\u0027d not responded to this. I\u0027m not quite sure of your referent. If you mean, do we have something that actually uses this schema against a CN that doesn\u0027t report \u0027CPU Physical Cores\u0027 ? Then no, as that doesn\u0027t exist. Certainly this schema is validating what we do see.\n\nThis is just looking ahead to such a time, although the chances are it will never happen."},{"file":"lib/cnapi/server.js","line":206,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"The reason I was asking about this was I assumed that we considered information about the number of CPUs, in some form, required. I also assumed that the reason that this field had been marked optional was because the new fields were there and if the new fields were there, then we don\u0027t need this. However, that constraint isn\u0027t expressed in the schema. Does that make any more sense or am I just confusing things further?"},{"file":"lib/cnapi/server.js","line":206,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Oh, I see, yes, the schema doesn\u0027t say we expect at least one of the old or new settings. I don\u0027t think this is representable from reading https://tools.ietf.org/html/draft-zyp-json-schema-03"},{"file":"lib/cnapi/server.js","line":206,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Right, so that\u0027s why I was asking if the consumer of the schemas will be updated to account for that."},{"file":"lib/cnapi/server.js","line":206,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"AFAIK there\u0027s no consumer of the cnapi schema.\n\nFor DAPI, I think you\u0027re asking me to add some special code to sdc-designation\u0027s lib/validations.js:validateServer() that will hand-check that at least one of the two sets is in place.\n\nI guess I could, but given that the only user of this would be hard-filter-invalid-servers, which just ignores such an invalid server anyway, I\u0027m not sure what the point would be. That is, unless I\u0027ve got things wrong, there\u0027s nothing in the normal flow that would actually meaningfully catch a mistake of the kind you\u0027re worrying about."},{"file":"lib/cnapi/server.js","line":206,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"OK, if that\u0027s the case, that makes sense. Thanks."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/cnapi/server.js","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"lib/dapi/server.js","type":"MODIFIED","insertions":5,"deletions":-1}],"sizeInsertions":11,"sizeDeletions":-3},{"number":"3","revision":"d1ffd9434fc769ef0f6ee6dafad9f50d4b12ef19","parents":["f920a0d76e7047de7df2fd2b20103874c355bffb"],"ref":"refs/changes/61/6161/3","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1557243148,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1556712422,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1557788492,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1557788492,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/cnapi/server.js","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"lib/dapi/server.js","type":"MODIFIED","insertions":5,"deletions":-1}],"sizeInsertions":11,"sizeDeletions":-3},{"number":"4","revision":"5daa8511e8aad151596f03abfc97cef59d88ccfd","parents":["f920a0d76e7047de7df2fd2b20103874c355bffb"],"ref":"refs/changes/61/6161/4","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1557836464,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1556712422,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1557788492,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1557788492,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1557837411,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/cnapi/server.js","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"lib/dapi/server.js","type":"MODIFIED","insertions":5,"deletions":-1}],"sizeInsertions":11,"sizeDeletions":-3}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}]}