From d1ffd9434fc769ef0f6ee6dafad9f50d4b12ef19 Mon Sep 17 00:00:00 2001
From: John Levon <john.levon@joyent.com>
Date: Tue, 7 May 2019 15:32:27 +0000
Subject: [PATCH] TRITON-1353 Triton systems should be able to disable SMT

---
 lib/cnapi/server.js | 8 ++++++--
 lib/dapi/server.js  | 6 +++++-
 2 files changed, 11 insertions(+), 3 deletions(-)

diff --git a/lib/cnapi/server.js b/lib/cnapi/server.js
index 21770f2..d9cd53d 100644
--- a/lib/cnapi/server.js
+++ b/lib/cnapi/server.js
@@ -203,13 +203,17 @@ var s_sysinfo = {
 		'Bhyve Max Vcpus': base.intg.nonneg.opt,
 		'CPU Type': base.str.nonempty.req,
 		'CPU Virtualization': base.str.req,
-		'CPU Physical Cores': base.intg.pos.req,
+		'CPU Physical Cores': base.intg.pos.opt,
 		'Admin NIC Tag': base.str.opt, // OS-7075 (20180719)
 		'Admin IP': base.str.v4addr.opt, // TRITON-841 (20181206)
 		'UUID': base.str.uuid.req,
 		'Hostname': base.str.hostname.opt,
 		'HVM API': base.bool.opt,
-		'CPU Total Cores': base.intg.pos.req,
+		'CPU Total Cores': base.intg.pos.opt,
+		'CPU Socket Count': base.intg.pos.opt,
+		'CPU Core Count': base.intg.pos.opt,
+		'CPU Online Count': base.intg.pos.opt,
+		'CPU Count': base.intg.pos.opt,
 		'MiB of Memory': base.intg.pos.req,
 		'Zpool': base.str.nonempty.req,
 		'Zpool Disks': s_si_disklist_r,
diff --git a/lib/dapi/server.js b/lib/dapi/server.js
index c9e24b2..63ca6b4 100644
--- a/lib/dapi/server.js
+++ b/lib/dapi/server.js
@@ -49,7 +49,11 @@ var s_sysinfo = {
 	'properties': {
 		'Bhyve Capable': base.bool.opt,
 		'Bhyve Max Vcpus': base.intg.nonneg.opt,
-		'CPU Total Cores': base.intg.pos.req,
+		'CPU Total Cores': base.intg.pos.opt,
+		'CPU Socket Count': base.intg.pos.opt,
+		'CPU Core Count': base.intg.pos.opt,
+		'CPU Online Count': base.intg.pos.opt,
+		'CPU Count': base.intg.pos.opt,
 		'Admin NIC Tag': base.str.opt, // OS-7075 (20180719)
 		'Admin IP': base.str.v4addr.opt, // TRITON-841 (20181206)
 		'HVM API': base.bool.opt,
-- 
2.21.0

