{"project":"joyent/sdc-cloudapi","branch":"master","id":"I08f89b020c20fe0b2a5f37fcc2089c2bc7051762","number":"3552","subject":"TRITON-210 cloudapi should use package.brand Reviewed by: Trent Mick \u003ctrentm@gmail.com\u003e Approved by: Trent Mick \u003ctrentm@gmail.com\u003e","owner":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"url":"https://cr.joyent.us/3552","commitMessage":"TRITON-210 cloudapi should use package.brand\nReviewed by: Trent Mick \u003ctrentm@gmail.com\u003e\nApproved by: Trent Mick \u003ctrentm@gmail.com\u003e\n","createdOn":1520383745,"lastUpdated":1520559791,"open":false,"status":"MERGED","comments":[{"timestamp":1520383745,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Uploaded patch set 1."},{"timestamp":1520383746,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit 1d70237baf744dae9b3876c8924183b2065d1054\n    \n    use package.brand to determine brand for payload, fix bugs, do some refactoring, add tests"},{"timestamp":1520413303,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 1:\n\n(4 comments)"},{"timestamp":1520452548,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Uploaded patch set 2."},{"timestamp":1520452550,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit acaa84672bb12919f1025eabcbb891a378bc6479\n    \n    rearrange functions in attempt to fix gerrit display of diff"},{"timestamp":1520452937,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Uploaded patch set 3."},{"timestamp":1520452938,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 3:\n\nNew commits:\n    \n    commit 12dbb270aa18da6c3f472a13df957409a4715b3e\n    \n    re-inline the getNetworks because gerrit just can\u0027t handle it"},{"timestamp":1520456328,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Patch Set 3:\n\n(4 comments)"},{"timestamp":1520457664,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 1:\n\n(4 comments)"},{"timestamp":1520458075,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 3:\n\n(3 comments)"},{"timestamp":1520462938,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Uploaded patch set 4."},{"timestamp":1520462940,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 4:\n\nNew commits:\n    \n    commit d8bb546fd9ea50ac2cba07b80afb960d51b2fae9\n    \n    address CR feedback"},{"timestamp":1520464468,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Uploaded patch set 5."},{"timestamp":1520464469,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 5:\n\nNew commits:\n    \n    commit 64073195e34c0cfc986eece128da25de654059ee\n    \n    more addressing review feedback"},{"timestamp":1520476143,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing-1\n\n(4 comments)\n\n\"make check\" exited with status 2"},{"timestamp":1520476503,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing-1\n\n(4 comments)\n\n\"make check\" exited with status 2"},{"timestamp":1520476503,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing-1\n\n(4 comments)\n\n\"make check\" exited with status 2"},{"timestamp":1520476609,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing-1\n\n(4 comments)\n\n\"make check\" exited with status 2"},{"timestamp":1520476614,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing-1\n\n(4 comments)\n\n\"make check\" exited with status 2"},{"timestamp":1520481642,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Uploaded patch set 6."},{"timestamp":1520481643,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 6:\n\nNew commits:\n    \n    commit 13acb962ec98a388296672c93bae7329a801461b\n    \n    fix broken \u0027make check\u0027"},{"timestamp":1520481676,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 6: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1520483287,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 6: Code-Review+1\n\n(1 comment)"},{"timestamp":1520484426,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1520490292,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Uploaded patch set 7: Commit message was updated."},{"timestamp":1520497949,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 7:\n\nI don\u0027t mind giving IA, but I\u0027m not sure if anybody else wants to comment first."},{"timestamp":1520536544,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 7:\n\n(5 comments)"},{"timestamp":1520551092,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 7:\n\n(5 comments)"},{"timestamp":1520556076,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Uploaded patch set 8."},{"timestamp":1520556078,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 8:\n\nNew commits:\n    \n    commit 28d187e0955beca991c2511ed6980d331d0c3fbb\n    \n    address CR feedback"},{"timestamp":1520556110,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 8: CI-Testing-1\n\n(3 comments)\n\n\"make check\" exited with status 2"},{"timestamp":1520557459,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Uploaded patch set 9."},{"timestamp":1520557461,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 9:\n\nNew commits:\n    \n    commit d053a77202fa3268ef6278b79bd9a3691877094c\n    \n    fix broken \u0027make check\u0027"},{"timestamp":1520557493,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 9: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1520558396,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 9: Code-Review+1 Integration-Approval+1"},{"timestamp":1520559744,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Uploaded patch set 10: Commit message was updated."},{"timestamp":1520559791,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Josh Wilsdon"}],"currentPatchSet":{"number":"10","revision":"08f89b020c20fe0b2a5f37fcc2089c2bc7051762","parents":["be3d217e813682e0be247ee03211e3abb13eb710"],"ref":"refs/changes/52/3552/10","uploader":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"createdOn":1520559744,"author":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1520557493,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1520558396,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1520558396,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1520559791,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":6,"deletions":0},{"file":"lib/machines.js","type":"MODIFIED","insertions":60,"deletions":-20},{"file":"lib/packages.js","type":"MODIFIED","insertions":16,"deletions":-18},{"file":"package.json","type":"MODIFIED","insertions":22,"deletions":-22},{"file":"test/getCreateOptions.test.js","type":"ADDED","insertions":346,"deletions":0},{"file":"test/packages.test.js","type":"MODIFIED","insertions":197,"deletions":-54}],"sizeInsertions":647,"sizeDeletions":-114},"patchSets":[{"number":"1","revision":"e5944bd89de618e91374e8c9b3faff60967d1a21","parents":["be3d217e813682e0be247ee03211e3abb13eb710"],"ref":"refs/changes/52/3552/1","uploader":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"createdOn":1520383745,"author":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1520476143,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/machines.js","line":576,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"This seem like something that should be left to imgapi. What do we gain by allowing arbitrary brands in imgapi?"},{"file":"lib/machines.js","line":576,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"If I understand correctly, you\u0027re advocating that cloudapi do no validation here, and that all validation be done at imgapi.\n\nWhether or not we do validation at imgapi, I think we should do validation here for a few reasons:\n\n a) existing imgapis wouldn\u0027t do validation, so if we don\u0027t, we have either a flag day or a bad failure mode here\n b) even if we add validation at imgapi when setting a manifest, existing data in moray could have brands cloudapi doesn\u0027t handle (sngl exists in some of our DCs\u0027 images for example, but is no longer provisionable)\n c) it seems always good to validate where possible that data is what you expect\n\nAs for imgapi itself, I\u0027ll discuss with trentm, but I suspect one reason we don\u0027t do validation there right now is to avoid such flag days as we\u0027d have here if we added it now. If we do the validation there, it mea\nns imgapi needs to be updated before the new brand is usable at cloudapi. And if imgapi is not updated, cloudapi will not fail fast, but will fail later at some less-obvious point."},{"file":"lib/machines.js","line":576,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"I\u0027m fine with this being deferred for imgapi for now, but we need to eventually restrict the values that can be set for brand in imgapi. It\u0027s less code, and better feedback to ops."},{"file":"lib/machines.js","line":582,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"papi doesn\u0027t allow unknown brands to be set in packages."},{"file":"lib/machines.js","line":582,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"You\u0027re suggesting I add a comment indicating that here?\n\nOr are you suggesting that we not do validation here?"},{"file":"lib/machines.js","line":582,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"If papi is doing the validation, should cloudapi too?"},{"file":"lib/machines.js","line":595,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"indent is 9 not a multiple of 4 spaces"},{"file":"lib/machines.js","line":596,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"indent is 13 not a multiple of 4 spaces"},{"file":"lib/machines.js","line":626,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"And bhyve too?"},{"file":"lib/machines.js","line":626,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"bhyve didn\u0027t exist at that time. But I\u0027ll make a note in the comment here about what the bhyve situation is."},{"file":"lib/packages.js","line":52,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"I don\u0027t think this makes any difference once it hits JSON.stringify()? E.g.\n\nJSON.stringify({ foo: undefined }) \u003d\u003d\u003d \u0027{}\u0027\n\nIf so, then these conditionals could be elided and the values set in p above.\n\nIf not, then brand should also be in a conditional block."},{"file":"lib/packages.js","line":52,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Good point. I looked through the restify code and we do eventually get to a JSON.stringify via the formatter. I\u0027ll fix. Thanks."},{"file":"test/getCreateOptions.test.js","line":37,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"indent is 10 not a multiple of 4 spaces"},{"file":"test/packages.test.js","line":280,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"whitespace before right paren"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":6,"deletions":0},{"file":"lib/machines.js","type":"MODIFIED","insertions":127,"deletions":-75},{"file":"lib/packages.js","type":"MODIFIED","insertions":14,"deletions":-10},{"file":"package.json","type":"MODIFIED","insertions":22,"deletions":-22},{"file":"test/getCreateOptions.test.js","type":"ADDED","insertions":312,"deletions":0},{"file":"test/packages.test.js","type":"MODIFIED","insertions":197,"deletions":-54}],"sizeInsertions":678,"sizeDeletions":-161},{"number":"2","revision":"56287f42d1d15027e55e4769cc419577f41998ca","parents":["be3d217e813682e0be247ee03211e3abb13eb710"],"ref":"refs/changes/52/3552/2","uploader":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"createdOn":1520452548,"author":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1520476503,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/machines.js","line":386,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"indent is 9 not a multiple of 4 spaces"},{"file":"lib/machines.js","line":387,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"indent is 13 not a multiple of 4 spaces"},{"file":"test/getCreateOptions.test.js","line":37,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"indent is 10 not a multiple of 4 spaces"},{"file":"test/packages.test.js","line":280,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"whitespace before right paren"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":6,"deletions":0},{"file":"lib/machines.js","type":"MODIFIED","insertions":191,"deletions":-138},{"file":"lib/packages.js","type":"MODIFIED","insertions":14,"deletions":-10},{"file":"package.json","type":"MODIFIED","insertions":22,"deletions":-22},{"file":"test/getCreateOptions.test.js","type":"ADDED","insertions":312,"deletions":0},{"file":"test/packages.test.js","type":"MODIFIED","insertions":197,"deletions":-54}],"sizeInsertions":742,"sizeDeletions":-224},{"number":"3","revision":"c4dd81f2cabe4a8b9eef91459002592cd3699366","parents":["be3d217e813682e0be247ee03211e3abb13eb710"],"ref":"refs/changes/52/3552/3","uploader":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"createdOn":1520452937,"author":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1520476503,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/machines.js","line":386,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Is this necessary? `brand` won\u0027t ever be undefined (right..?), so if pkg.brand is undefined, `pkg.brand !\u003d\u003d brand` will evaluate to true."},{"file":"lib/machines.js","line":386,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"good point!"},{"file":"lib/machines.js","line":387,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"indent is 9 not a multiple of 4 spaces"},{"file":"lib/machines.js","line":388,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"indent is 13 not a multiple of 4 spaces"},{"file":"test/getCreateOptions.test.js","line":37,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"indent is 10 not a multiple of 4 spaces"},{"file":"test/getCreateOptions.test.js","line":277,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"lol"},{"file":"test/packages.test.js","line":195,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Should we return here?"},{"file":"test/packages.test.js","line":195,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"yes! great catch."},{"file":"test/packages.test.js","line":259,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"I\u0027d add some short messages indicating what this assertion is checking, where it\u0027s not clear what\u0027s being compared to what (unlike t.equal, though I think we should have messages for those too)."},{"file":"test/packages.test.js","line":259,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"This is what happens when you copy a stranger\u0027s code in the Alps!\n\nI\u0027ll fix."},{"file":"test/packages.test.js","line":280,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"whitespace before right paren"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":6,"deletions":0},{"file":"lib/machines.js","type":"MODIFIED","insertions":41,"deletions":-20},{"file":"lib/packages.js","type":"MODIFIED","insertions":14,"deletions":-10},{"file":"package.json","type":"MODIFIED","insertions":22,"deletions":-22},{"file":"test/getCreateOptions.test.js","type":"ADDED","insertions":312,"deletions":0},{"file":"test/packages.test.js","type":"MODIFIED","insertions":197,"deletions":-54}],"sizeInsertions":592,"sizeDeletions":-106},{"number":"4","revision":"8cd74299095de995a2dc88f0e3ba09978754c2e0","parents":["be3d217e813682e0be247ee03211e3abb13eb710"],"ref":"refs/changes/52/3552/4","uploader":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"createdOn":1520462938,"author":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1520476609,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/machines.js","line":387,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"indent is 9 not a multiple of 4 spaces"},{"file":"lib/machines.js","line":388,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"indent is 13 not a multiple of 4 spaces"},{"file":"test/getCreateOptions.test.js","line":37,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"indent is 10 not a multiple of 4 spaces"},{"file":"test/packages.test.js","line":281,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"whitespace before right paren"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":6,"deletions":0},{"file":"lib/machines.js","type":"MODIFIED","insertions":44,"deletions":-20},{"file":"lib/packages.js","type":"MODIFIED","insertions":16,"deletions":-18},{"file":"package.json","type":"MODIFIED","insertions":22,"deletions":-22},{"file":"test/getCreateOptions.test.js","type":"ADDED","insertions":312,"deletions":0},{"file":"test/packages.test.js","type":"MODIFIED","insertions":198,"deletions":-54}],"sizeInsertions":598,"sizeDeletions":-114},{"number":"5","revision":"bfe1946942bc0304f97ae6547dcf2d1070ac1185","parents":["be3d217e813682e0be247ee03211e3abb13eb710"],"ref":"refs/changes/52/3552/5","uploader":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"createdOn":1520464468,"author":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1520476614,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/machines.js","line":387,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"indent is 9 not a multiple of 4 spaces"},{"file":"lib/machines.js","line":388,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"indent is 13 not a multiple of 4 spaces"},{"file":"test/getCreateOptions.test.js","line":37,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"indent is 10 not a multiple of 4 spaces"},{"file":"test/packages.test.js","line":281,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"whitespace before right paren"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":6,"deletions":0},{"file":"lib/machines.js","type":"MODIFIED","insertions":44,"deletions":-20},{"file":"lib/packages.js","type":"MODIFIED","insertions":16,"deletions":-18},{"file":"package.json","type":"MODIFIED","insertions":22,"deletions":-22},{"file":"test/getCreateOptions.test.js","type":"ADDED","insertions":312,"deletions":0},{"file":"test/packages.test.js","type":"MODIFIED","insertions":198,"deletions":-54}],"sizeInsertions":598,"sizeDeletions":-114},{"number":"6","revision":"fc662d19659decffe2ee324c3245011ffa3fea3f","parents":["be3d217e813682e0be247ee03211e3abb13eb710"],"ref":"refs/changes/52/3552/6","uploader":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"createdOn":1520481642,"author":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1520481676,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1520483287,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":6,"deletions":0},{"file":"lib/machines.js","type":"MODIFIED","insertions":44,"deletions":-20},{"file":"lib/packages.js","type":"MODIFIED","insertions":16,"deletions":-18},{"file":"package.json","type":"MODIFIED","insertions":22,"deletions":-22},{"file":"test/getCreateOptions.test.js","type":"ADDED","insertions":312,"deletions":0},{"file":"test/packages.test.js","type":"MODIFIED","insertions":197,"deletions":-54}],"sizeInsertions":597,"sizeDeletions":-114},{"number":"7","revision":"f6b22b773b0b69b8a542c0a7c5cd52a901bccde9","parents":["be3d217e813682e0be247ee03211e3abb13eb710"],"ref":"refs/changes/52/3552/7","uploader":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"createdOn":1520490292,"author":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1520481676,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1520483287,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}}],"comments":[{"file":"lib/machines.js","line":370,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Perhaps add the specific img.requirements.brand value to the error message?"},{"file":"lib/machines.js","line":370,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"ok"},{"file":"lib/machines.js","line":376,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Perhaps add the specific pkg.brand value to the error message?"},{"file":"lib/machines.js","line":376,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"ok"},{"file":"lib/machines.js","line":380,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"`img.brand`? AFAIK that has never been a thing. I know that existed before this change however. If you like you could remove it."},{"file":"lib/machines.js","line":380,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"ok"},{"file":"lib/machines.js","line":386,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"If we took the first branch above, we might have `brand` set to img.requirements.brand, but a pkg that doesn\u0027t have a brand set, right? That means this could fail unnecessarily.\n\nAnd if pkg.brand *is* set here, then we are using it without having validated it is in VALID_BRANDS."},{"file":"lib/machines.js","line":386,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Ugh. I had:\n\n    if (pkg.brand !\u003d\u003d undefined \u0026\u0026 pkg.brand !\u003d\u003d brand) {\n\noriginally but removed that due to a CR comment that it was unnecessary. Turns out it was necessary after all!"},{"file":"lib/machines.js","line":388,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Perhaps add the specific brand values to the error message?"},{"file":"lib/machines.js","line":388,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"ok"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":6,"deletions":0},{"file":"lib/machines.js","type":"MODIFIED","insertions":44,"deletions":-20},{"file":"lib/packages.js","type":"MODIFIED","insertions":16,"deletions":-18},{"file":"package.json","type":"MODIFIED","insertions":22,"deletions":-22},{"file":"test/getCreateOptions.test.js","type":"ADDED","insertions":312,"deletions":0},{"file":"test/packages.test.js","type":"MODIFIED","insertions":197,"deletions":-54}],"sizeInsertions":597,"sizeDeletions":-114},{"number":"8","revision":"f2dcdae111c2d02bd4129a7e56ff808f19700e6f","parents":["be3d217e813682e0be247ee03211e3abb13eb710"],"ref":"refs/changes/52/3552/8","uploader":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"createdOn":1520556076,"author":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1520556110,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"test/getCreateOptions.test.js","line":308,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"literal string using double-quote instead of single"},{"file":"test/getCreateOptions.test.js","line":331,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"line \u003e 80 characters"},{"file":"test/getCreateOptions.test.js","line":345,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"last line in file is blank"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":6,"deletions":0},{"file":"lib/machines.js","type":"MODIFIED","insertions":60,"deletions":-20},{"file":"lib/packages.js","type":"MODIFIED","insertions":16,"deletions":-18},{"file":"package.json","type":"MODIFIED","insertions":22,"deletions":-22},{"file":"test/getCreateOptions.test.js","type":"ADDED","insertions":345,"deletions":0},{"file":"test/packages.test.js","type":"MODIFIED","insertions":197,"deletions":-54}],"sizeInsertions":646,"sizeDeletions":-114},{"number":"9","revision":"acaec9599a4858087debd2e1cd1647d2cb99036e","parents":["be3d217e813682e0be247ee03211e3abb13eb710"],"ref":"refs/changes/52/3552/9","uploader":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"createdOn":1520557459,"author":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1520557493,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1520558396,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1520558396,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":6,"deletions":0},{"file":"lib/machines.js","type":"MODIFIED","insertions":60,"deletions":-20},{"file":"lib/packages.js","type":"MODIFIED","insertions":16,"deletions":-18},{"file":"package.json","type":"MODIFIED","insertions":22,"deletions":-22},{"file":"test/getCreateOptions.test.js","type":"ADDED","insertions":346,"deletions":0},{"file":"test/packages.test.js","type":"MODIFIED","insertions":197,"deletions":-54}],"sizeInsertions":647,"sizeDeletions":-114},{"number":"10","revision":"08f89b020c20fe0b2a5f37fcc2089c2bc7051762","parents":["be3d217e813682e0be247ee03211e3abb13eb710"],"ref":"refs/changes/52/3552/10","uploader":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"createdOn":1520559744,"author":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1520557493,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1520558396,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1520558396,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1520559791,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":6,"deletions":0},{"file":"lib/machines.js","type":"MODIFIED","insertions":60,"deletions":-20},{"file":"lib/packages.js","type":"MODIFIED","insertions":16,"deletions":-18},{"file":"package.json","type":"MODIFIED","insertions":22,"deletions":-22},{"file":"test/getCreateOptions.test.js","type":"ADDED","insertions":346,"deletions":0},{"file":"test/packages.test.js","type":"MODIFIED","insertions":197,"deletions":-54}],"sizeInsertions":647,"sizeDeletions":-114}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"}]}