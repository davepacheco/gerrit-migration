From b59a8efbe831b50c32b7008e247f833521c7d103 Mon Sep 17 00:00:00 2001
From: Josh Wilsdon <jwilsdon@joyent.com>
Date: Fri, 20 Jan 2017 23:41:16 -0800
Subject: [PATCH] HEAD-2344 headnode setup fails to adopt cmon-agent which
 leads to config-agent not starting up

---
 config/sapi/services/cmon-agent/service.json | 16 ++++++++++++++++
 scripts/headnode.sh                          |  2 +-
 2 files changed, 17 insertions(+), 1 deletion(-)
 create mode 100644 config/sapi/services/cmon-agent/service.json

diff --git a/config/sapi/services/cmon-agent/service.json b/config/sapi/services/cmon-agent/service.json
new file mode 100644
index 00000000..7f9f47c6
--- /dev/null
+++ b/config/sapi/services/cmon-agent/service.json
@@ -0,0 +1,16 @@
+{
+    "name": "cmon-agent",
+    "type": "agent",
+    "params": {
+        "tags": {
+            "smartdc_role": "cmon-agent",
+            "smartdc_type": "core"
+        }
+    },
+    "metadata": {
+        "SERVICE_NAME": "cmon-agent",
+        "CMON_AGENT_LOG_LEVEL": "info"
+    },
+    "manifests": {
+    }
+}
diff --git a/scripts/headnode.sh b/scripts/headnode.sh
index a4ce47c7..196da9ef 100755
--- a/scripts/headnode.sh
+++ b/scripts/headnode.sh
@@ -749,7 +749,7 @@ function adopt_agents()
         CONFIGURABLE_AGENTS="net-agent vm-agent cn-agent \
           agents_core amon-agent amon-relay \
           config-agent firewaller smartlogin \
-          cabase cainstsvc hagfish-watcher"
+          cabase cainstsvc hagfish-watcher cmon-agent"
 
         for agent in $CONFIGURABLE_AGENTS; do
             local instance_uuid
-- 
2.21.0

