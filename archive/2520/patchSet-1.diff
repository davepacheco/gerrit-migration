From a48acb0f437049fd9a683de4ef4b9ffeb0b8d61b Mon Sep 17 00:00:00 2001
From: Hans Rosenfeld <hans.rosenfeld@joyent.com>
Date: Thu, 7 Sep 2017 13:01:18 +0200
Subject: [PATCH] OS-6335 provide ACPI headers in /usr/include

---
 manifest                                      |  65 +++++++++++
 .../manifests/system-header-header-acpi.mf    | 101 ++++++++++++++++++
 usr/src/uts/intel/sys/Makefile                |  79 +++++++++++++-
 3 files changed, 241 insertions(+), 4 deletions(-)
 create mode 100644 usr/src/pkg/manifests/system-header-header-acpi.mf

diff --git a/manifest b/manifest
index 40ddef12eb..43fff8ecb5 100644
--- a/manifest
+++ b/manifest
@@ -3385,6 +3385,71 @@ f usr/include/sys/acct.h 0644 root bin
 f usr/include/sys/acctctl.h 0644 root bin
 f usr/include/sys/acl.h 0644 root bin
 f usr/include/sys/acl_impl.h 0644 root bin
+d usr/include/sys/acpi 0755 root bin
+f usr/include/sys/acpi/acapps.h 0644 root bin
+f usr/include/sys/acpi/acbuffer.h 0644 root bin
+f usr/include/sys/acpi/acclib.h 0644 root bin
+f usr/include/sys/acpi/accommon.h 0644 root bin
+f usr/include/sys/acpi/acconfig.h 0644 root bin
+f usr/include/sys/acpi/acdebug.h 0644 root bin
+f usr/include/sys/acpi/acdisasm.h 0644 root bin
+f usr/include/sys/acpi/acdispat.h 0644 root bin
+f usr/include/sys/acpi/acevents.h 0644 root bin
+f usr/include/sys/acpi/acexcep.h 0644 root bin
+f usr/include/sys/acpi/acglobal.h 0644 root bin
+f usr/include/sys/acpi/achware.h 0644 root bin
+f usr/include/sys/acpi/acinterp.h 0644 root bin
+f usr/include/sys/acpi/aclocal.h 0644 root bin
+f usr/include/sys/acpi/acmacros.h 0644 root bin
+f usr/include/sys/acpi/acnames.h 0644 root bin
+f usr/include/sys/acpi/acnamesp.h 0644 root bin
+f usr/include/sys/acpi/acobject.h 0644 root bin
+f usr/include/sys/acpi/acopcode.h 0644 root bin
+f usr/include/sys/acpi/acoutput.h 0644 root bin
+f usr/include/sys/acpi/acparser.h 0644 root bin
+f usr/include/sys/acpi/acpi.h 0644 root bin
+f usr/include/sys/acpi/acpi_enum.h 0644 root bin
+f usr/include/sys/acpi/acpi_pci.h 0644 root bin
+f usr/include/sys/acpi/acpiosxf.h 0644 root bin
+f usr/include/sys/acpi/acpixf.h 0644 root bin
+f usr/include/sys/acpi/acpredef.h 0644 root bin
+f usr/include/sys/acpi/acresrc.h 0644 root bin
+f usr/include/sys/acpi/acrestyp.h 0644 root bin
+f usr/include/sys/acpi/acstruct.h 0644 root bin
+f usr/include/sys/acpi/actables.h 0644 root bin
+f usr/include/sys/acpi/actbl.h 0644 root bin
+f usr/include/sys/acpi/actbl1.h 0644 root bin
+f usr/include/sys/acpi/actbl2.h 0644 root bin
+f usr/include/sys/acpi/actbl3.h 0644 root bin
+f usr/include/sys/acpi/actypes.h 0644 root bin
+f usr/include/sys/acpi/acutils.h 0644 root bin
+f usr/include/sys/acpi/acuuid.h 0644 root bin
+f usr/include/sys/acpi/amlcode.h 0644 root bin
+f usr/include/sys/acpi/amlresrc.h 0644 root bin
+d usr/include/sys/acpi/platform 0755 root bin
+f usr/include/sys/acpi/platform/accygwin.h 0644 root bin
+f usr/include/sys/acpi/platform/acdragonfly.h 0644 root bin
+f usr/include/sys/acpi/platform/acdragonflyex.h 0644 root bin
+f usr/include/sys/acpi/platform/acefi.h 0644 root bin
+f usr/include/sys/acpi/platform/acefiex.h 0644 root bin
+f usr/include/sys/acpi/platform/acenv.h 0644 root bin
+f usr/include/sys/acpi/platform/acenvex.h 0644 root bin
+f usr/include/sys/acpi/platform/acfreebsd.h 0644 root bin
+f usr/include/sys/acpi/platform/acgcc.h 0644 root bin
+f usr/include/sys/acpi/platform/achaiku.h 0644 root bin
+f usr/include/sys/acpi/platform/acintel.h 0644 root bin
+f usr/include/sys/acpi/platform/aclinux.h 0644 root bin
+f usr/include/sys/acpi/platform/aclinuxex.h 0644 root bin
+f usr/include/sys/acpi/platform/acmacosx.h 0644 root bin
+f usr/include/sys/acpi/platform/acmsvc.h 0644 root bin
+f usr/include/sys/acpi/platform/acmsvcex.h 0644 root bin
+f usr/include/sys/acpi/platform/acnetbsd.h 0644 root bin
+f usr/include/sys/acpi/platform/acos2.h 0644 root bin
+f usr/include/sys/acpi/platform/acqnx.h 0644 root bin
+f usr/include/sys/acpi/platform/acsolaris.h 0644 root bin
+f usr/include/sys/acpi/platform/acwin.h 0644 root bin
+f usr/include/sys/acpi/platform/acwin64.h 0644 root bin
+f usr/include/sys/acpi/platform/acwinex.h 0644 root bin
 f usr/include/sys/acpi_drv.h 0644 root bin
 f usr/include/sys/aggr.h 0644 root bin
 f usr/include/sys/aggr_impl.h 0644 root bin
diff --git a/usr/src/pkg/manifests/system-header-header-acpi.mf b/usr/src/pkg/manifests/system-header-header-acpi.mf
new file mode 100644
index 0000000000..68e21b6b04
--- /dev/null
+++ b/usr/src/pkg/manifests/system-header-header-acpi.mf
@@ -0,0 +1,101 @@
+#
+# CDDL HEADER START
+#
+# The contents of this file are subject to the terms of the
+# Common Development and Distribution License (the "License").
+# You may not use this file except in compliance with the License.
+#
+# You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE
+# or http://www.opensolaris.org/os/licensing.
+# See the License for the specific language governing permissions
+# and limitations under the License.
+#
+# When distributing Covered Code, include this CDDL HEADER in each
+# file and include the License file at usr/src/OPENSOLARIS.LICENSE.
+# If applicable, add the following below this CDDL HEADER, with the
+# fields enclosed by brackets "[]" replaced with your own identifying
+# information: Portions Copyright [yyyy] [name of copyright owner]
+#
+# CDDL HEADER END
+#
+
+#
+# Copyright (c) 2010, Oracle and/or its affiliates. All rights reserved.
+#
+
+set name=pkg.fmri value=pkg:/system/header/header-acpi@$(PKGVERS)
+set name=pkg.description value="ACPI Header Files for x86 systems"
+set name=pkg.summary value="ACPI Header Files"
+set name=info.classification \
+    value=org.opensolaris.category.2008:Development/System
+set name=org.opensolaris.noincorp value=true
+set name=variant.arch value=i386
+dir path=usr group=sys
+dir path=usr/include
+dir path=usr/include/sys
+dir path=usr/include/sys/acpi
+dir path=usr/include/sys/acpi/platform
+file path=usr/include/sys/acpi/acapps.h
+file path=usr/include/sys/acpi/acbuffer.h
+file path=usr/include/sys/acpi/acclib.h
+file path=usr/include/sys/acpi/accommon.h
+file path=usr/include/sys/acpi/acconfig.h
+file path=usr/include/sys/acpi/acdebug.h
+file path=usr/include/sys/acpi/acdisasm.h
+file path=usr/include/sys/acpi/acdispat.h
+file path=usr/include/sys/acpi/acevents.h
+file path=usr/include/sys/acpi/acexcep.h
+file path=usr/include/sys/acpi/acglobal.h
+file path=usr/include/sys/acpi/achware.h
+file path=usr/include/sys/acpi/acinterp.h
+file path=usr/include/sys/acpi/aclocal.h
+file path=usr/include/sys/acpi/acmacros.h
+file path=usr/include/sys/acpi/acnames.h
+file path=usr/include/sys/acpi/acnamesp.h
+file path=usr/include/sys/acpi/acobject.h
+file path=usr/include/sys/acpi/acopcode.h
+file path=usr/include/sys/acpi/acoutput.h
+file path=usr/include/sys/acpi/acparser.h
+file path=usr/include/sys/acpi/acpi.h
+file path=usr/include/sys/acpi/acpi_enum.h
+file path=usr/include/sys/acpi/acpi_pci.h
+file path=usr/include/sys/acpi/acpiosxf.h
+file path=usr/include/sys/acpi/acpixf.h
+file path=usr/include/sys/acpi/acpredef.h
+file path=usr/include/sys/acpi/acresrc.h
+file path=usr/include/sys/acpi/acrestyp.h
+file path=usr/include/sys/acpi/acstruct.h
+file path=usr/include/sys/acpi/actables.h
+file path=usr/include/sys/acpi/actbl.h
+file path=usr/include/sys/acpi/actbl1.h
+file path=usr/include/sys/acpi/actbl2.h
+file path=usr/include/sys/acpi/actbl3.h
+file path=usr/include/sys/acpi/actypes.h
+file path=usr/include/sys/acpi/acutils.h
+file path=usr/include/sys/acpi/acuuid.h
+file path=usr/include/sys/acpi/amlcode.h
+file path=usr/include/sys/acpi/amlresrc.h
+file path=usr/include/sys/acpi/platform/accygwin.h
+file path=usr/include/sys/acpi/platform/acdragonfly.h
+file path=usr/include/sys/acpi/platform/acdragonflyex.h
+file path=usr/include/sys/acpi/platform/acefi.h
+file path=usr/include/sys/acpi/platform/acefiex.h
+file path=usr/include/sys/acpi/platform/acenv.h
+file path=usr/include/sys/acpi/platform/acenvex.h
+file path=usr/include/sys/acpi/platform/acfreebsd.h
+file path=usr/include/sys/acpi/platform/acgcc.h
+file path=usr/include/sys/acpi/platform/achaiku.h
+file path=usr/include/sys/acpi/platform/acintel.h
+file path=usr/include/sys/acpi/platform/aclinux.h
+file path=usr/include/sys/acpi/platform/aclinuxex.h
+file path=usr/include/sys/acpi/platform/acmacosx.h
+file path=usr/include/sys/acpi/platform/acmsvc.h
+file path=usr/include/sys/acpi/platform/acmsvcex.h
+file path=usr/include/sys/acpi/platform/acnetbsd.h
+file path=usr/include/sys/acpi/platform/acos2.h
+file path=usr/include/sys/acpi/platform/acqnx.h
+file path=usr/include/sys/acpi/platform/acsolaris.h
+file path=usr/include/sys/acpi/platform/acwin.h
+file path=usr/include/sys/acpi/platform/acwin64.h
+file path=usr/include/sys/acpi/platform/acwinex.h
+license license_in_headers license=license_in_headers
diff --git a/usr/src/uts/intel/sys/Makefile b/usr/src/uts/intel/sys/Makefile
index 5cfbdec4fc..c02eb39783 100644
--- a/usr/src/uts/intel/sys/Makefile
+++ b/usr/src/uts/intel/sys/Makefile
@@ -91,17 +91,88 @@ HDRS	=			\
 	x86_archext.h		\
 	xen_errno.h
 
+ACPIHDRS=			\
+	acapps.h		\
+	acbuffer.h		\
+	acclib.h		\
+	accommon.h		\
+	acconfig.h		\
+	acdebug.h		\
+	acdisasm.h		\
+	acdispat.h		\
+	acevents.h		\
+	acexcep.h		\
+	acglobal.h		\
+	achware.h		\
+	acinterp.h		\
+	aclocal.h		\
+	acmacros.h		\
+	acnames.h		\
+	acnamesp.h		\
+	acobject.h		\
+	acopcode.h		\
+	acoutput.h		\
+	acparser.h		\
+	acpi.h			\
+	acpi_enum.h		\
+	acpi_pci.h		\
+	acpiosxf.h		\
+	acpixf.h		\
+	acpredef.h		\
+	acresrc.h		\
+	acrestyp.h		\
+	acstruct.h		\
+	actables.h		\
+	actbl.h			\
+	actbl1.h		\
+	actbl2.h		\
+	actbl3.h		\
+	actypes.h		\
+	acutils.h		\
+	acuuid.h		\
+	amlcode.h		\
+	amlresrc.h
+
+ACPIPLATFORMHDRS=		\
+	accygwin.h		\
+	acdragonfly.h		\
+	acdragonflyex.h		\
+	acefi.h			\
+	acefiex.h		\
+	acenv.h			\
+	acenvex.h		\
+	acfreebsd.h		\
+	acgcc.h			\
+	achaiku.h		\
+	acintel.h		\
+	aclinux.h		\
+	aclinuxex.h		\
+	acmacosx.h		\
+	acmsvc.h		\
+	acmsvcex.h		\
+	acnetbsd.h		\
+	acos2.h			\
+	acqnx.h			\
+	acsolaris.h		\
+	acwin.h			\
+	acwin64.h		\
+	acwinex.h
+
 ROOTDIR=	$(ROOT)/usr/include/sys
 SCSIDIR=	$(ROOTDIR)/scsi
 SCSIDIRS=	$(SCSIDIR) $(SCSIDIR)/conf $(SCSIDIR)/generic \
 		$(SCSIDIR)/impl $(SCSIDIR)/targets
+ROOTACPIDIR=	$(ROOTDIR)/acpi
+ROOTACPIPLATFORMDIR=	$(ROOTACPIDIR)/platform
 ROOTFSDIR=	$(ROOTDIR)/fs
-ROOTDIRS=	$(ROOTDIR) $(ROOTFSDIR)
+ROOTDIRS=	$(ROOTDIR) $(ROOTACPIDIR) $(ROOTACPIPLATFORMDIR) $(ROOTFSDIR)
 
 ROOTHDRS= $(HDRS:%=$(ROOTDIR)/%)
+ROOTACPIHDRS= $(ACPIHDRS:%=$(ROOTACPIDIR)/%)
+ROOTACPIPLATFORMHDRS= $(ACPIPLATFORMHDRS:%=$(ROOTACPIPLATFORMDIR)/%)
 
 CHECKHDRS= 			\
-	$(HDRS:%.h=%.check)
+	$(HDRS:%.h=%.check)	\
 
 # install rules
 $(ROOTDIR)/%: %
@@ -109,9 +180,9 @@ $(ROOTDIR)/%: %
 
 .KEEP_STATE:
 
-.PARALLEL: $(CHECKHDRS) $(ROOTHDRS)
+.PARALLEL: $(CHECKHDRS) $(ROOTHDRS) $(ROOTACPIHDRS) $(ROOTACPIPLATFORMHDRS)
 
-install_h: $(ROOTDIRS) .WAIT $(ROOTHDRS)
+install_h: $(ROOTDIRS) .WAIT $(ROOTHDRS) $(ROOTACPIHDRS) $(ROOTACPIPLATFORMHDRS)
 
 $(ROOTDIRS):
 	$(INS.dir)
-- 
2.21.0

