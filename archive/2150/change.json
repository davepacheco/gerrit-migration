{"project":"joyent/manta-mako","branch":"master","id":"I1b7598990670b18e30868cbe18830099ad234fd5","number":"2150","subject":"MANTA-3325 mako_gc.sh is unconscionably slow Reviewed by: Kody A Kantor \u003ckody.kantor@joyent.com\u003e Reviewed by: Jason King \u003cjason.king@joyent.com\u003e Reviewed by: David Pacheco \u003cdap@joyent.com\u003e Approved by: David Pacheco \u003cdap@joyent.com\u003e","owner":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"url":"https://cr.joyent.us/2150","commitMessage":"MANTA-3325 mako_gc.sh is unconscionably slow\nReviewed by: Kody A Kantor \u003ckody.kantor@joyent.com\u003e\nReviewed by: Jason King \u003cjason.king@joyent.com\u003e\nReviewed by: David Pacheco \u003cdap@joyent.com\u003e\nApproved by: David Pacheco \u003cdap@joyent.com\u003e\n","createdOn":1498245063,"lastUpdated":1498251450,"open":false,"status":"MERGED","comments":[{"timestamp":1498245063,"reviewer":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"message":"Uploaded patch set 1."},{"timestamp":1498245594,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 1: Code-Review+1"},{"timestamp":1498246229,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 1: Code-Review+1\n\n(1 comment)\n\nThanks for doing this! Looks good to me. I have just one comment for your consideration."},{"timestamp":1498248427,"reviewer":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"message":"Patch Set 1:\n\n\u003e (1 comment)\n \u003e \n \u003e Thanks for doing this! Looks good to me. I have just one comment\n \u003e for your consideration.\n\nYes, that\u0027s a good observation. Removing the cat(1) is not much of a win because the actual transfer of data from cat(1) to mako_gc.sh does end up being a blocking factor: with these fixes, we are going to be blocked mainly on I/O to do the lookup and move.  The cat(1) is certainly unnecessary (and would likely be better to redirect from the file), but it could also have unintended side effects with respect to memory usage -- and I\u0027m very much looking to keep this change as small as possible."},{"timestamp":1498249734,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 1: Code-Review+1\n\n(1 comment)"},{"timestamp":1498250642,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1498251227,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 1: Integration-Approval+1"},{"timestamp":1498251433,"reviewer":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"message":"Patch Set 2: Commit message was updated."},{"timestamp":1498251450,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Bryan Cantrill"}],"currentPatchSet":{"number":"2","revision":"93a32e0703184e3f60b8534678687b20b96c0169","parents":["13a92bfbd534d9f237f38b048be2740c26f6749e"],"ref":"refs/changes/50/2150/2","uploader":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"createdOn":1498251433,"author":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1498245594,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1498246229,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1498249734,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1498250642,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1498251227,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"SUBM","value":"1","grantedOn":1498251450,"by":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"bin/mako_gc.sh","type":"MODIFIED","insertions":29,"deletions":-8}],"sizeInsertions":29,"sizeDeletions":-8},"patchSets":[{"number":"1","revision":"1b7598990670b18e30868cbe18830099ad234fd5","parents":["13a92bfbd534d9f237f38b048be2740c26f6749e"],"ref":"refs/changes/50/2150/1","uploader":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"createdOn":1498245063,"author":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1498249734,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1498251227,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1498250642,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1498246229,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1498245594,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}}],"comments":[{"file":"bin/mako_gc.sh","line":77,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I believe this will do a string comparison rather than a numeric one, but I can\u0027t think of a case where that would matter here."},{"file":"bin/mako_gc.sh","line":244,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Would removing the \u0027cat\u0027 here, and instead redirecting-in the file give us any performance improvement for large files?  There\u0027s an example at the end of the read(1) manpage."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"bin/mako_gc.sh","type":"MODIFIED","insertions":29,"deletions":-8}],"sizeInsertions":29,"sizeDeletions":-8},{"number":"2","revision":"93a32e0703184e3f60b8534678687b20b96c0169","parents":["13a92bfbd534d9f237f38b048be2740c26f6749e"],"ref":"refs/changes/50/2150/2","uploader":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"createdOn":1498251433,"author":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1498249734,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1498251227,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1498250642,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"SUBM","value":"1","grantedOn":1498251450,"by":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1498246229,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1498245594,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"bin/mako_gc.sh","type":"MODIFIED","insertions":29,"deletions":-8}],"sizeInsertions":29,"sizeDeletions":-8}],"allReviewers":[{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"}]}