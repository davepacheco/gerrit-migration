From 827b5463b5d684677a47a32143446f44c2fe44af Mon Sep 17 00:00:00 2001
From: Mike Gerdts <mike.gerdts@joyent.com>
Date: Wed, 21 Aug 2019 13:23:36 +0000
Subject: [PATCH] first build

---
 Makefile     |  4 +++-
 README.md    | 25 ++++++++++++++++++++++++-
 package.json |  4 +---
 3 files changed, 28 insertions(+), 5 deletions(-)

diff --git a/Makefile b/Makefile
index 0ea0047..7fbf27c 100644
--- a/Makefile
+++ b/Makefile
@@ -5,7 +5,7 @@
 #
 
 #
-# Copyright (c) 2019, Joyent, Inc.
+# Copyright 2019 Joyent, Inc.
 #
 
 #
@@ -62,9 +62,11 @@ RELEASE_TARBALL :=	$(NAME)-$(STAMP).tgz
 RELEASE_MANIFEST :=	$(NAME)-$(STAMP).manifest
 RELSTAGEDIR :=		/tmp/$(NAME)-$(STAMP)
 NODEUNIT =		$(TOP)/node_modules/.bin/nodeunit
+ifeq ($(shell uname -s),SunOS)
 ZFS_SNAPSHOT_TAR :=	$(TOP)/deps/zfs_snapshot_tar/zfs_snapshot_tar
 NOMKNOD :=	$(TOP)/src/nomknod/nomknod.32.so \
 	$(TOP)/src/nomknod/nomknod.64.so
+endif
 
 COAL ?= root@10.99.99.7
 
diff --git a/README.md b/README.md
index 2ea9d9f..1de349c 100644
--- a/README.md
+++ b/README.md
@@ -5,11 +5,13 @@
 -->
 
 <!--
-    Copyright 2016, Joyent, Inc.
+    Copyright 2019 Joyent, Inc.
 -->
 
 # sdc-cn-agent
 
+**This branch is used for the port of cn-agent to Linux.  It is not complete.**
+
 This repository is part of the Joyent Triton project. See the [contribution
 guidelines](https://github.com/joyent/triton/blob/master/CONTRIBUTING.md) --
 *Triton does not use GitHub PRs* -- and general documentation at the main
@@ -29,6 +31,8 @@ ZFS datasets.
 
 Some notable parts of the repo:
 
+XXX this is bogus!
+
     node_modules/fw         This is a copy of smartos-live.git:src/fw
                             and should be kept in sync. It is used to
                             provide a node API to `fw.{update,del,add}`
@@ -42,3 +46,22 @@ To run the cn-agent:
     git clone git@github.com:joyent/sdc-cn-agent.git
     cd sdc-cn-agent
     git submodule update --init
+
+## Linux port
+
+To build, you need node 6, as this requires lockfd, which has not yet been
+updated for node 8+.
+
+```
+$ curl https://nodejs.org/dist/v6.17.1/node-v6.17.1-linux-x64.tar.gz | sudo tar xzf - -C /opt
+$ PATH=/opt/node-v6.17.1-linux-x64/bin:$PATH make
+```
+
+The plan:
+
+- Initially no support for:
+  - Docker
+  - Snapshots
+  - Migration
+- Explore the use of [node-libvirt](https://github.com/hooklift/node-libvirt) to
+  implement the required tasks.
diff --git a/package.json b/package.json
index 52664b5..b3acf0d 100644
--- a/package.json
+++ b/package.json
@@ -15,9 +15,8 @@
     "forkexec": "1.1.0",
     "imgmanifest": "3.1.0",
     "jsprim": "2.0.0",
-    "kstat": "1.0.1",
     "lazy-property": "1.0.0",
-    "lockfd": "1.2.0",
+    "lockfd": "git+https://github.com/joyent/node-lockfd.git#eca14e0401d88ebb20ea5933b8818550461748c1",
     "lstream": "0.0.4",
     "mkdirp": "^0.3.4",
     "nodeunit": "0.9.1",
@@ -26,7 +25,6 @@
     "restify": "4.3.0",
     "rimraf": "2.4.3",
     "sdc-clients": "11.3.1",
-    "sdc-docker-build": "0.3.3",
     "semver": "5.4.1",
     "sprintf": "0.1.5",
     "stream-throttle": "0.1.3",
-- 
2.17.2 (Apple Git-113)

