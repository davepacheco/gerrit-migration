From 5cb515a2592fefd70958d8b07efbb816645b6404 Mon Sep 17 00:00:00 2001
From: Kelly McLaughlin <kelly.mclaughlin@joyent.com>
Date: Wed, 13 Sep 2017 13:44:10 -0600
Subject: [PATCH] MORAY-433 Bunyan serializer for postgres connection pool logs
 empty object

---
 lib/manatee.js    | 14 ++++++++------
 lib/standalone.js | 14 ++++++++------
 2 files changed, 16 insertions(+), 12 deletions(-)

diff --git a/lib/manatee.js b/lib/manatee.js
index a7263b3..e87b128 100644
--- a/lib/manatee.js
+++ b/lib/manatee.js
@@ -49,13 +49,15 @@ var SERIALIZERS = {
         return (c ? c._moray_id : undefined);
     },
     pool: function (pool) {
-        var obj = {};
-
-        Object.keys(pool).forEach(function (k) {
-            obj[k] = pool[k] ? pool[k].url : undefined;
+        return ({
+            available: pool.available.length,
+            max: pool.max,
+            size: pool.resources.length,
+            waiting: pool.queue.length,
+            pending: pool.pendingResources,
+            stopped: pool.stopped,
+            stopping: pool.stopping
         });
-
-        return (obj);
     },
     db: function (db) {
         try {
diff --git a/lib/standalone.js b/lib/standalone.js
index 0e9e080..2a4a776 100644
--- a/lib/standalone.js
+++ b/lib/standalone.js
@@ -30,13 +30,15 @@ var SERIALIZERS = {
         return (c ? c._moray_id : undefined);
     },
     pool: function (pool) {
-        var obj = {};
-
-        Object.keys(pool).forEach(function (k) {
-            obj[k] = pool[k] ? pool[k].url : undefined;
+        return ({
+            available: pool.available.length,
+            max: pool.max,
+            size: pool.resources.length,
+            waiting: pool.queue.length,
+            pending: pool.pendingResources,
+            stopped: pool.stopped,
+            stopping: pool.stopping
         });
-
-        return (obj);
     },
     db: function (db) {
         var p = db.pool;
-- 
2.21.0

