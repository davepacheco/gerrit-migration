From c1b8a3667ffcc2d5e30603e59ecc16b2c4d2c6a0 Mon Sep 17 00:00:00 2001
From: Patrick Mooney <pmooney@pfmooney.com>
Date: Fri, 18 Nov 2016 16:33:52 +0000
Subject: [PATCH] OS-5806 timer_create leaks itimer_t

---
 usr/src/uts/common/os/timer.c | 7 ++-----
 1 file changed, 2 insertions(+), 5 deletions(-)

diff --git a/usr/src/uts/common/os/timer.c b/usr/src/uts/common/os/timer.c
index 9e4bfe190e..845b93da6e 100644
--- a/usr/src/uts/common/os/timer.c
+++ b/usr/src/uts/common/os/timer.c
@@ -661,12 +661,9 @@ timer_create(clockid_t clock, struct sigevent *evp, timer_t *tid)
 	}
 
 	/*
-	 * We'll allocate our timer and sigqueue now, before we grab p_lock.
-	 * If we can't find an empty slot, we'll free them before returning.
+	 * We'll allocate our sigqueue now, before we grab p_lock.
+	 * If we can't find an empty slot, we'll free it before returning.
 	 */
-	it = kmem_cache_alloc(clock_timer_cache, KM_SLEEP);
-	bzero(it, sizeof (itimer_t));
-	mutex_init(&it->it_mutex, NULL, MUTEX_DEFAULT, NULL);
 	sigq = kmem_zalloc(sizeof (sigqueue_t), KM_SLEEP);
 
 	/*
-- 
2.21.0

