{"project":"joyent/illumos-joyent","branch":"master","id":"Ic577c5708efcaaf4f49f1b402abbff44b40901ab","number":"5013","subject":"OS-7335 atomic ops in syscall_mstate() induce significant overhead OS-7339 zone secflags are not initialized correctly Reviewed by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e Reviewed by: Robert Mustacchi \u003crm@joyent.com\u003e Reviewed by: Jerry Jelinek \u003cjerry.","owner":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"url":"https://cr.joyent.us/5013","commitMessage":"OS-7335 atomic ops in syscall_mstate() induce significant overhead\nOS-7339 zone secflags are not initialized correctly\nReviewed by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e\nReviewed by: Robert Mustacchi \u003crm@joyent.com\u003e\nReviewed by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e\nApproved by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e\n","createdOn":1540932990,"lastUpdated":1542034547,"open":false,"status":"MERGED","comments":[{"timestamp":1540932990,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Uploaded patch set 1."},{"timestamp":1540932993,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit f460c2affc462a99b9e67f97428f55978154e3c6\n    \n    OS-7335 atomic ops in syscall_mstate() induce significant overhead"},{"timestamp":1540938495,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 1:\n\n(3 comments)"},{"timestamp":1540989929,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Uploaded patch set 2."},{"timestamp":1540989932,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit 24a5093e27973e597eda4171c8ed71e73d8d58be\n    \n    m"},{"timestamp":1540990566,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 2:\n\nI hadn\u0027t actually meant for that to be reviewed quite yet, but nonetheless, this new version has the changes you asked for indeed :)\n\nRobert: I noticed the psecflags thing while passing by. Seems like a copy/paste error? Also doesn\u0027t seem to matter much"},{"timestamp":1540992094,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 2: Code-Review+1\n\nSorry for jumping the gun on the previous review, but this draft looks good to me."},{"timestamp":1541002141,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Uploaded patch set 3."},{"timestamp":1541002144,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 3:\n\nNew commits:\n    \n    commit c65464d2d21aded133b339a92518da58637a87f3\n    \n    m"},{"timestamp":1541002705,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 3:\n\n(2 comments)"},{"timestamp":1541003868,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 3:\n\n(2 comments)"},{"timestamp":1541007065,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Uploaded patch set 4."},{"timestamp":1541012359,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 4: Code-Review+1"},{"timestamp":1541016531,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 4: Code-Review+1"},{"timestamp":1541542771,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Uploaded patch set 5."},{"timestamp":1541542773,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 5:\n\nNew commits:\n    \n    commit 3861a0b2bc3a2f86a9eb1caac76736386bd8f0da\n    \n    m\n    \n    commit 9625a46690720a94fff663ea882e89a82cf9823b\n    \n    m\n    \n    commit 0d828be60f4fbbbb1356938a5457d300deac083d\n    \n    uarray-128\n    \n    commit b78c55f5e6bb148cced812c571579a612f060bdf\n    \n    OS-7335 atomic ops in syscall_mstate() induce significant overhead\n    OS-7339 zone secflags are not initialized correctly\n    \n    commit b9e062ca08c34e1a9774695a14a3c31899d1f414\n    \n            [illumos-gate merge]\n    commit 0c54f6ba1331ba286857bec48422da0a9893d269\n        9933 libefi: Simplify the EFI delay() function by calling BS-\u003eStall()\n    \n    commit 0c54f6ba1331ba286857bec48422da0a9893d269\n    \n    9933 libefi: Simplify the EFI delay() function by calling BS-\u003eStall()\n    Reviewed by: Andy Fiddaman \u003candy@omniosce.org\u003e\n    Approved by: Dan McDonald \u003cdanmcd@joyent.com\u003e\n    \n    commit 40fc639cb57bbbbb360437ad5d4934c7635d14a8\n    \n            [illumos-gate merge]\n    commit c540c5554db983fb615df293797142edc10b4c62\n        9927 refetch_read_once() would like a p please bob\n    commit b6c711cc370ad66a5c9391c71936f34bb8616e93\n        9939 Need to stop GCC reordering functions\n    commit b75eb7e6b5e51c1d1a8023c478487c4f4542768f\n        9840 loader: do not repeat int13 calls when we have no media\n        9841 loader: issue edd probe before legacy ah\u003d08\n    commit 3602e97d70b31e6f0ae7e1d6fdcd52f4c0e0fbaf\n        9949 loader: do not probe floppy devices for zfs\n    \n    commit 9b539c3a538225ff8d6ffa0132e51db9a678401f\n    \n    OS-7313 Samsung PM1635a breaks when using power conditions\n    Reviewed by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e\n    Reviewed by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e\n    Reviewed by: Robert Mustacchi \u003crm@joyent.com\u003e\n    Approved by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e\n    \n    commit c540c5554db983fb615df293797142edc10b4c62\n    \n    9927 refetch_read_once() would like a p please bob\n    Reviewed by: John Levon \u003cjohn.levon@joyent.com\u003e\n    Reviewed by: Toomas Soome \u003ctsoome@me.com\u003e\n    Approved by: Dan McDonald \u003cdanmcd@joyent.com\u003e\n    \n    commit b6c711cc370ad66a5c9391c71936f34bb8616e93\n    \n    9939 Need to stop GCC reordering functions\n    Reviewed by: John Levon \u003cjohn.levon@joyent.com\u003e\n    Reviewed by: Toomas Soome \u003ctsoome@me.com\u003e\n    Approved by: Dan McDonald \u003cdanmcd@joyent.com\u003e\n    \n    commit 1169729f845efa9db60803c6cfd33e594a2954f3\n    \n    OS-4311 asynchronous socket errors should be better documented\n    Reviewed by: David Pacheco \u003cdap@joyent.com\u003e\n    Reviewed by: Jason King \u003cjason.king@joyent.com\u003e\n    Approved by: Jason King \u003cjason.king@joyent.com\u003e\n    \n    commit bab4dcafbe412880696fcb05ab46ef0d48abb18f\n    \n    OS-5558 libmd should leverage SHA extensions\n    Reviewed by: Dan McDonald \u003cdanmcd@joyent.com\u003e\n    Approved by: Jason King \u003cjason.king@joyent.com\u003e\n    \n    commit b75eb7e6b5e51c1d1a8023c478487c4f4542768f\n    \n    9840 loader: do not repeat int13 calls when we have no media\n    9841 loader: issue edd probe before legacy ah\u003d08\n    Reviewed by: Yuri Pankov \u003cyuripv@yuripv.net\u003e\n    Reviewed by: Andy Fiddaman \u003candy@omniosce.org\u003e\n    Approved by: Dan McDonald \u003cdanmcd@joyent.com\u003e\n    \n    commit 3602e97d70b31e6f0ae7e1d6fdcd52f4c0e0fbaf\n    \n    9949 loader: do not probe floppy devices for zfs\n    Reviewed by: Yuri Pankov \u003cyuripv@yuripv.net\u003e\n    Approved by: Dan McDonald \u003cdanmcd@joyent.com\u003e\n    \n    commit e6151003c8efce19988229b39ba3dbb5551dc6f1\n    \n    OS-2340 vnics should support LSO\n    OS-6778 MAC loopback traffic should avoid cksum work\n    OS-6794 want LSO support in viona\n    OS-7319 dangling ref in mac_sw_cksum()\n    OS-7331 mac_sw_cksum() drops valid UDP traffic\n    Reviewed by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e\n    Reviewed by: Dan McDonald \u003cdanmcd@joyent.com\u003e\n    Approved by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e\n    \n    commit 6382b25ab1c6dc8c5a3b13b52fa0389bfb4de681\n    \n    OS-7199 bhyve upstream sync 2018 Sept\n    Reviewed by: Mike Gerdts \u003cmike.gerdts@joyent.com\u003e\n    Reviewed by: Hans Rosenfeld \u003chans.rosenfeld@joyent.com\u003e\n    Reviewed by: Mike Zeller \u003cmike.zeller@joyent.com\u003e\n    Approved by: Mike Zeller \u003cmike.zeller@joyent.com\u003e\n    \n    commit 08172908f2f2e814cd937510f5f086917ebaca41\n    \n            [illumos-gate merge]\n    commit 05e627dc484199c2d1bcdec2c07e471897d93354\n        9935 update tzdata to 2018g\n    commit 508de9f313d4260d23954085ed866e727901964c\n        9940 _kobj_printf must use va_list\n    \n    commit 05e627dc484199c2d1bcdec2c07e471897d93354\n    \n    9935 update tzdata to 2018g\n    Reviewed by: Marcel Telka \u003cmarcel@telka.sk\u003e\n    Reviewed by: Yuri Pankov \u003cyuri.pankov@nexenta.com\u003e\n    Approved by: Dan McDonald \u003cdanmcd@joyent.com\u003e\n    \n    commit 508de9f313d4260d23954085ed866e727901964c\n    \n    9940 _kobj_printf must use va_list\n    Reviewed by: John Levon \u003cjohn.levon@joyent.com\u003e\n    Reviewed by: Richard Lowe \u003crichlowe@richlowe.net\u003e\n    Reviewed by: Andy Fiddaman \u003candy@omniosce.org\u003e\n    Approved by: Dan McDonald \u003cdanmcd@joyent.com\u003e"},{"timestamp":1541542805,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Uploaded patch set 6: Commit message was updated."},{"timestamp":1541543074,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Uploaded patch set 7."},{"timestamp":1541698597,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 7:\n\n(9 comments)\n\nLooks reasonable overall."},{"timestamp":1541700467,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 7:\n\n(1 comment)"},{"timestamp":1541720110,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 7:\n\n(8 comments)"},{"timestamp":1541720224,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Uploaded patch set 8."},{"timestamp":1541785796,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 8: Code-Review+1\n\n(1 comment)"},{"timestamp":1541791933,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 8: Code-Review+1\n\n(1 comment)"},{"timestamp":1541793201,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Uploaded patch set 9."},{"timestamp":1541793203,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 9:\n\nNew commits:\n    \n    commit 01156d63e3c81cd1f88a2061a225e12f45649508\n    \n    m\n    \n    commit 9bc488ba188266a0b4d0dbb08d53539141b985d7\n    \n    OS-7335 atomic ops in syscall_mstate() induce significant overhead\n    OS-7339 zone secflags are not initialized correctly"},{"timestamp":1541793328,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Uploaded patch set 10."},{"timestamp":1541793332,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 10:\n\nNew commits:\n    \n    commit 1cb3039011b1cb5d1ecb6c38642f8f355f884527\n    \n    m"},{"timestamp":1541793376,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 10: Code-Review+1"},{"timestamp":1541793807,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 10: Code-Review+1"},{"timestamp":1542029288,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 10: Code-Review+1"},{"timestamp":1542030863,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 10: Integration-Approval+1"},{"timestamp":1542031433,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Uploaded patch set 11: Commit message was updated."},{"timestamp":1542031449,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 12: Patch Set 11 was rebased"},{"timestamp":1542034547,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by John Levon"}],"currentPatchSet":{"number":"12","revision":"aa694ffb2f51c06ac16cadc3685f0e847b680409","parents":["13722208fb412a293031522d6f42992cae1f60a3"],"ref":"refs/changes/13/5013/12","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1542031449,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1541793376,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1541793807,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1542029288,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1542030863,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"SUBM","value":"1","grantedOn":1542034547,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":12,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/pkg/manifests/system-header.mf","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/uts/common/Makefile.files","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/common/os/cpu_uarray.c","type":"ADDED","insertions":79,"deletions":0},{"file":"usr/src/uts/common/os/msacct.c","type":"MODIFIED","insertions":35,"deletions":-19},{"file":"usr/src/uts/common/os/zone.c","type":"MODIFIED","insertions":30,"deletions":-21},{"file":"usr/src/uts/common/sys/Makefile","type":"MODIFIED","insertions":7,"deletions":-6},{"file":"usr/src/uts/common/sys/cpu_uarray.h","type":"ADDED","insertions":77,"deletions":0},{"file":"usr/src/uts/common/sys/sysmacros.h","type":"MODIFIED","insertions":13,"deletions":0},{"file":"usr/src/uts/common/sys/zone.h","type":"MODIFIED","insertions":23,"deletions":-23}],"sizeInsertions":268,"sizeDeletions":-69},"patchSets":[{"number":"1","revision":"433e61303f9d3e98a6d349c356c47cbccf6c9483","parents":["7a70cf1aae9b2e74d5a5f7a0ef7cc6f4b2c6e4c5"],"ref":"refs/changes/13/5013/1","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1540932990,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/uts/common/os/zone.c","line":2387,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"you could do the summation in one loop and scale \u0026 assign afterwards"},{"file":"usr/src/uts/common/os/zone.c","line":3799,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"why not do this in one loop?"},{"file":"usr/src/uts/common/os/zone.c","line":5176,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"I think you\u0027re missing the kmem_free calls in zone_destroy"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/os/msacct.c","type":"MODIFIED","insertions":27,"deletions":-19},{"file":"usr/src/uts/common/os/zone.c","type":"MODIFIED","insertions":40,"deletions":-22},{"file":"usr/src/uts/common/sys/zone.h","type":"MODIFIED","insertions":21,"deletions":-23}],"sizeInsertions":88,"sizeDeletions":-64},{"number":"2","revision":"167d7fdaa4412b0da4aaa30e28901ae2903e0a81","parents":["7a70cf1aae9b2e74d5a5f7a0ef7cc6f4b2c6e4c5"],"ref":"refs/changes/13/5013/2","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1540989929,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1540992094,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/os/msacct.c","type":"MODIFIED","insertions":27,"deletions":-19},{"file":"usr/src/uts/common/os/zone.c","type":"MODIFIED","insertions":38,"deletions":-22},{"file":"usr/src/uts/common/sys/zone.h","type":"MODIFIED","insertions":21,"deletions":-23}],"sizeInsertions":86,"sizeDeletions":-64},{"number":"3","revision":"f37cf18b3d397de6221c9c3a922fa36d65549d3f","parents":["7a70cf1aae9b2e74d5a5f7a0ef7cc6f4b2c6e4c5"],"ref":"refs/changes/13/5013/3","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1541002141,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/uts/common/os/zone.c","line":5149,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Why is this here? Seems like there should be another bug at least for this?"},{"file":"usr/src/uts/common/os/zone.c","line":5149,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"A drive-by fix I noticed. I\u0027ll file a separate bug"},{"file":"usr/src/uts/common/sys/zone.h","line":692,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"These are volatile just to help the compiler try and let us reload the data since we\u0027re reading cross-thread without locks to serialize?"},{"file":"usr/src/uts/common/sys/zone.h","line":692,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Right, in theory the compiler could decide not to reload somewhat arbitrarily. In practice I don\u0027t think it makes any difference"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"usr/src/uts/common/os/msacct.c","type":"MODIFIED","insertions":27,"deletions":-19},{"file":"usr/src/uts/common/os/zone.c","type":"MODIFIED","insertions":38,"deletions":-22},{"file":"usr/src/uts/common/sys/zone.h","type":"MODIFIED","insertions":21,"deletions":-23}],"sizeInsertions":86,"sizeDeletions":-64},{"number":"4","revision":"c9b2593c05daaef502296d58028b9dbbd8c1e447","parents":["8fe8a39ea9f7811d9c1e2e48a46932561906883f"],"ref":"refs/changes/13/5013/4","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1541007065,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1541016531,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1541012359,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"usr/src/uts/common/os/msacct.c","type":"MODIFIED","insertions":27,"deletions":-19},{"file":"usr/src/uts/common/os/zone.c","type":"MODIFIED","insertions":38,"deletions":-22},{"file":"usr/src/uts/common/sys/zone.h","type":"MODIFIED","insertions":21,"deletions":-23}],"sizeInsertions":86,"sizeDeletions":-64},{"number":"5","revision":"b5f740a1146fd424c7dabaf79b8751d264afa455","parents":["7a70cf1aae9b2e74d5a5f7a0ef7cc6f4b2c6e4c5"],"ref":"refs/changes/13/5013/5","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1541542771,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/contrib/freebsd/dev/nvme/nvme.h","type":"ADDED","insertions":1506,"deletions":0},{"file":"usr/src/Makefile.master","type":"MODIFIED","insertions":15,"deletions":-7},{"file":"usr/src/boot/sys/boot/efi/libefi/delay.c","type":"MODIFIED","insertions":2,"deletions":-13},{"file":"usr/src/boot/sys/boot/i386/libi386/biosdisk.c","type":"MODIFIED","insertions":203,"deletions":-75},{"file":"usr/src/boot/sys/boot/i386/loader/main.c","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/cmd/bhyve/Makefile","type":"MODIFIED","insertions":16,"deletions":0},{"file":"usr/src/cmd/bhyve/acpi.c","type":"MODIFIED","insertions":6,"deletions":-37},{"file":"usr/src/cmd/bhyve/ahci.h","type":"MODIFIED","insertions":248,"deletions":-248},{"file":"usr/src/cmd/bhyve/atkbdc.c","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/cmd/bhyve/bhyvegc.c","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/cmd/bhyve/bhyvegc.h","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/cmd/bhyve/bhyverun.c","type":"MODIFIED","insertions":58,"deletions":-39},{"file":"usr/src/cmd/bhyve/block_if.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/cmd/bhyve/block_if.h","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/cmd/bhyve/bootrom.c","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/cmd/bhyve/bootrom.h","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/cmd/bhyve/console.c","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/cmd/bhyve/console.h","type":"MODIFIED","insertions":10,"deletions":-8},{"file":"usr/src/cmd/bhyve/consport.c","type":"MODIFIED","insertions":7,"deletions":-7},{"file":"usr/src/cmd/bhyve/dbgport.c","type":"MODIFIED","insertions":8,"deletions":-8},{"file":"usr/src/cmd/bhyve/fwctl.c","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/cmd/bhyve/fwctl.h","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/cmd/bhyve/inout.c","type":"MODIFIED","insertions":15,"deletions":-15},{"file":"usr/src/cmd/bhyve/iov.c","type":"ADDED","insertions":141,"deletions":0},{"file":"usr/src/cmd/bhyve/iov.h","type":"ADDED","insertions":43,"deletions":0},{"file":"usr/src/cmd/bhyve/mem.c","type":"MODIFIED","insertions":31,"deletions":-18},{"file":"usr/src/cmd/bhyve/mem.h","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/cmd/bhyve/mevent.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/cmd/bhyve/mevent_test.c","type":"MODIFIED","insertions":17,"deletions":-17},{"file":"usr/src/cmd/bhyve/pci_e82545.c","type":"MODIFIED","insertions":9,"deletions":-7},{"file":"usr/src/cmd/bhyve/pci_emul.c","type":"MODIFIED","insertions":17,"deletions":-6},{"file":"usr/src/cmd/bhyve/pci_emul.h","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/cmd/bhyve/pci_fbuf.c","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/cmd/bhyve/pci_irq.c","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/cmd/bhyve/pci_irq.h","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/cmd/bhyve/pci_lpc.c","type":"MODIFIED","insertions":10,"deletions":0},{"file":"usr/src/cmd/bhyve/pci_lpc.h","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/cmd/bhyve/pci_nvme.c","type":"ADDED","insertions":1873,"deletions":0},{"file":"usr/src/cmd/bhyve/pci_virtio_block.c","type":"MODIFIED","insertions":8,"deletions":-8},{"file":"usr/src/cmd/bhyve/pci_virtio_console.c","type":"MODIFIED","insertions":6,"deletions":-11},{"file":"usr/src/cmd/bhyve/pci_virtio_net.c","type":"MODIFIED","insertions":17,"deletions":-16},{"file":"usr/src/cmd/bhyve/pci_virtio_rnd.c","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/cmd/bhyve/pci_virtio_scsi.c","type":"ADDED","insertions":718,"deletions":0},{"file":"usr/src/cmd/bhyve/pci_xhci.c","type":"MODIFIED","insertions":11,"deletions":-9},{"file":"usr/src/cmd/bhyve/pci_xhci.h","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/cmd/bhyve/ps2kbd.c","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/cmd/bhyve/ps2kbd.h","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/cmd/bhyve/ps2mouse.c","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/cmd/bhyve/ps2mouse.h","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/cmd/bhyve/rfb.c","type":"MODIFIED","insertions":13,"deletions":-11},{"file":"usr/src/cmd/bhyve/rfb.h","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/cmd/bhyve/rtc.c","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/cmd/bhyve/sockstream.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/cmd/bhyve/sockstream.h","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/cmd/bhyve/task_switch.c","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/cmd/bhyve/uart_emul.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/cmd/bhyve/usb_emul.c","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/cmd/bhyve/usb_emul.h","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/cmd/bhyve/usb_mouse.c","type":"MODIFIED","insertions":12,"deletions":-10},{"file":"usr/src/cmd/bhyve/vga.c","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/cmd/bhyve/vga.h","type":"MODIFIED","insertions":40,"deletions":-38},{"file":"usr/src/cmd/bhyve/virtio.c","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/cmd/bhyve/virtio.h","type":"MODIFIED","insertions":16,"deletions":-15},{"file":"usr/src/cmd/bhyvectl/bhyvectl.c","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"usr/src/common/crypto/sha1/amd64/THIRDPARTYLICENSE.sha1-ni","type":"ADDED","insertions":31,"deletions":0},{"file":"usr/src/common/crypto/sha1/amd64/THIRDPARTYLICENSE.sha1-ni.descrip","type":"ADDED","insertions":1,"deletions":0},{"file":"usr/src/common/crypto/sha1/amd64/sha1-ni.s","type":"ADDED","insertions":319,"deletions":0},{"file":"usr/src/common/crypto/sha2/amd64/THIRDPARTYLICENSE.sha256-ni","type":"ADDED","insertions":32,"deletions":0},{"file":"usr/src/common/crypto/sha2/amd64/THIRDPARTYLICENSE.sha256-ni.descrip","type":"ADDED","insertions":1,"deletions":0},{"file":"usr/src/common/crypto/sha2/amd64/sha256-ni.s","type":"ADDED","insertions":378,"deletions":0},{"file":"usr/src/compat/freebsd/amd64/machine/atomic.h","type":"MODIFIED","insertions":35,"deletions":0},{"file":"usr/src/compat/freebsd/amd64/machine/reg.h","type":"ADDED","insertions":23,"deletions":0},{"file":"usr/src/compat/freebsd/sys/endian.h","type":"MODIFIED","insertions":11,"deletions":0},{"file":"usr/src/data/zoneinfo/africa","type":"MODIFIED","insertions":50,"deletions":-71},{"file":"usr/src/data/zoneinfo/antarctica","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/data/zoneinfo/asia","type":"MODIFIED","insertions":267,"deletions":-47},{"file":"usr/src/data/zoneinfo/australasia","type":"MODIFIED","insertions":11,"deletions":-2},{"file":"usr/src/data/zoneinfo/backward","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/data/zoneinfo/etcetera","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/data/zoneinfo/europe","type":"MODIFIED","insertions":67,"deletions":-10},{"file":"usr/src/data/zoneinfo/northamerica","type":"MODIFIED","insertions":17,"deletions":-4},{"file":"usr/src/data/zoneinfo/southamerica","type":"MODIFIED","insertions":33,"deletions":-3},{"file":"usr/src/data/zoneinfo/systemv","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/data/zoneinfo/zone.tab.txt","type":"MODIFIED","insertions":7,"deletions":-7},{"file":"usr/src/data/zoneinfo/zone_sun.tab","type":"MODIFIED","insertions":6,"deletions":-6},{"file":"usr/src/lib/libmd/amd64/Makefile","type":"MODIFIED","insertions":28,"deletions":-3},{"file":"usr/src/lib/libmd/amd64/capabilities/sha.cap","type":"ADDED","insertions":29,"deletions":0},{"file":"usr/src/lib/libmd/common/mapfile-vers","type":"MODIFIED","insertions":19,"deletions":0},{"file":"usr/src/lib/libvmmapi/common/vmmapi.c","type":"MODIFIED","insertions":15,"deletions":-22},{"file":"usr/src/man/man2/read.2","type":"MODIFIED","insertions":16,"deletions":-3},{"file":"usr/src/man/man2/write.2","type":"MODIFIED","insertions":15,"deletions":-3},{"file":"usr/src/man/man3socket/recv.3socket","type":"MODIFIED","insertions":15,"deletions":-6},{"file":"usr/src/man/man3socket/send.3socket","type":"MODIFIED","insertions":11,"deletions":-3},{"file":"usr/src/man/man3xnet/recv.3xnet","type":"MODIFIED","insertions":9,"deletions":-2},{"file":"usr/src/man/man3xnet/recvfrom.3xnet","type":"MODIFIED","insertions":9,"deletions":-2},{"file":"usr/src/man/man3xnet/recvmsg.3xnet","type":"MODIFIED","insertions":8,"deletions":-8},{"file":"usr/src/man/man3xnet/send.3xnet","type":"MODIFIED","insertions":9,"deletions":-2},{"file":"usr/src/man/man3xnet/sendmsg.3xnet","type":"MODIFIED","insertions":9,"deletions":-2},{"file":"usr/src/man/man3xnet/sendto.3xnet","type":"MODIFIED","insertions":9,"deletions":-2},{"file":"usr/src/pkg/manifests/system-data-zoneinfo.mf","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/pkg/manifests/system-header.mf","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/uts/Makefile.uts","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/common/Makefile.files","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/common/inet/ip/ip_input.c","type":"MODIFIED","insertions":10,"deletions":-6},{"file":"usr/src/uts/common/inet/ip_impl.h","type":"MODIFIED","insertions":21,"deletions":-2},{"file":"usr/src/uts/common/io/bridge.c","type":"MODIFIED","insertions":149,"deletions":-43},{"file":"usr/src/uts/common/io/dls/dls_link.c","type":"MODIFIED","insertions":47,"deletions":0},{"file":"usr/src/uts/common/io/mac/mac.c","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/common/io/mac/mac_bcast.c","type":"MODIFIED","insertions":2,"deletions":-8},{"file":"usr/src/uts/common/io/mac/mac_client.c","type":"MODIFIED","insertions":54,"deletions":-23},{"file":"usr/src/uts/common/io/mac/mac_datapath_setup.c","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/common/io/mac/mac_flow.c","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/io/mac/mac_provider.c","type":"MODIFIED","insertions":13,"deletions":-6},{"file":"usr/src/uts/common/io/mac/mac_sched.c","type":"MODIFIED","insertions":46,"deletions":-59},{"file":"usr/src/uts/common/io/mac/mac_soft_ring.c","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/common/io/mac/mac_util.c","type":"MODIFIED","insertions":1172,"deletions":-260},{"file":"usr/src/uts/common/io/scsi/targets/sd.c","type":"MODIFIED","insertions":14,"deletions":-15},{"file":"usr/src/uts/common/io/simnet/simnet.c","type":"MODIFIED","insertions":2,"deletions":-6},{"file":"usr/src/uts/common/io/vnic/vnic_dev.c","type":"MODIFIED","insertions":23,"deletions":0},{"file":"usr/src/uts/common/krtld/bootrd.c","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/krtld/kobj.c","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/krtld/kobj_subr.c","type":"MODIFIED","insertions":12,"deletions":-5},{"file":"usr/src/uts/common/os/msacct.c","type":"MODIFIED","insertions":35,"deletions":-19},{"file":"usr/src/uts/common/os/zone.c","type":"MODIFIED","insertions":22,"deletions":-16},{"file":"usr/src/uts/common/sys/Makefile","type":"MODIFIED","insertions":7,"deletions":-6},{"file":"usr/src/uts/common/sys/kobj_impl.h","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/common/sys/mac.h","type":"MODIFIED","insertions":31,"deletions":-1},{"file":"usr/src/uts/common/sys/mac_client.h","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/uts/common/sys/mac_client_impl.h","type":"MODIFIED","insertions":1,"deletions":-2},{"file":"usr/src/uts/common/sys/mac_impl.h","type":"MODIFIED","insertions":14,"deletions":-3},{"file":"usr/src/uts/common/sys/pattr.h","type":"MODIFIED","insertions":20,"deletions":0},{"file":"usr/src/uts/common/sys/vnic_impl.h","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/sys/zone.h","type":"MODIFIED","insertions":19,"deletions":-23},{"file":"usr/src/uts/common/xen/io/xnb.c","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/uts/i86pc/io/viona/viona.c","type":"MODIFIED","insertions":180,"deletions":-40},{"file":"usr/src/uts/i86pc/io/vmm/README.sync","type":"MODIFIED","insertions":12,"deletions":-16},{"file":"usr/src/uts/i86pc/io/vmm/amd/amdvi_hw.c","type":"ADDED","insertions":1461,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/amd/amdvi_priv.h","type":"ADDED","insertions":431,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/amd/ivrs_drv.c","type":"ADDED","insertions":735,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/amd/npt.c","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/amd/npt.h","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/amd/svm.c","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"usr/src/uts/i86pc/io/vmm/amd/svm.h","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/amd/svm_msr.c","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/amd/svm_msr.h","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/amd/svm_softc.h","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/amd/vmcb.c","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/amd/vmcb.h","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/intel/vmx.c","type":"MODIFIED","insertions":70,"deletions":-2},{"file":"usr/src/uts/i86pc/io/vmm/io/vatpic.c","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/io/vatpit.h","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/io/vpmtmr.c","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/io/vpmtmr.h","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/io/vrtc.c","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/io/vrtc.h","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/vmm.c","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"usr/src/uts/i86pc/io/vmm/vmm_ioport.c","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/vmm_ioport.h","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/uts/i86pc/os/fakebop.c","type":"MODIFIED","insertions":12,"deletions":-6},{"file":"usr/src/uts/i86pc/sys/vmm.h","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/uts/intel/asm/cpu.h","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/intel/sys/bootconf.h","type":"MODIFIED","insertions":6,"deletions":-4},{"file":"usr/src/uts/sparc/os/bootops.c","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"usr/src/uts/sun/sys/bootconf.h","type":"MODIFIED","insertions":2,"deletions":-1}],"sizeInsertions":11344,"sizeDeletions":-1442},{"number":"6","revision":"32015a75af3a5cd854c2b24de991adbd594f969c","parents":["b9e062ca08c34e1a9774695a14a3c31899d1f414"],"ref":"refs/changes/13/5013/6","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1541542805,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"NO_CODE_CHANGE","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/pkg/manifests/system-header.mf","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/uts/common/Makefile.files","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/common/os/msacct.c","type":"MODIFIED","insertions":35,"deletions":-19},{"file":"usr/src/uts/common/os/zone.c","type":"MODIFIED","insertions":22,"deletions":-16},{"file":"usr/src/uts/common/sys/Makefile","type":"MODIFIED","insertions":7,"deletions":-6},{"file":"usr/src/uts/common/sys/zone.h","type":"MODIFIED","insertions":19,"deletions":-23}],"sizeInsertions":87,"sizeDeletions":-64},{"number":"7","revision":"44401d600d3cb517d3e1ab392a1707e836b382aa","parents":["b9e062ca08c34e1a9774695a14a3c31899d1f414"],"ref":"refs/changes/13/5013/7","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1541543074,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/uts/common/os/cpu_uarray.c","line":27,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Worth overflow checking any of this?"},{"file":"usr/src/uts/common/os/cpu_uarray.c","line":27,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"I decided to leave this on a \"boil the ocean\" basis"},{"file":"usr/src/uts/common/os/cpu_uarray.c","line":55,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"VERIFY3U?"},{"file":"usr/src/uts/common/os/cpu_uarray.c","line":55,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Done"},{"file":"usr/src/uts/common/os/cpu_uarray.c","line":58,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Do we care about overflow here?"},{"file":"usr/src/uts/common/os/cpu_uarray.c","line":58,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"I made these additions saturate. For now, we can\u0027t use the overflow builtins - not in GCC 4 - but we might want to later. As it is now gcc7 seems to leave the tests alone optimization wise but..."},{"file":"usr/src/uts/common/os/zone.c","line":3786,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I know we didn\u0027t in the past, but should we care about any overflow possibilities here?"},{"file":"usr/src/uts/common/os/zone.c","line":3786,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Done"},{"file":"usr/src/uts/common/sys/cpu_uarray.h","line":46,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"What happened?"},{"file":"usr/src/uts/common/sys/cpu_uarray.h","line":46,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"sysmacros.h has getmajor() and friends, which clashes in both the kernel and userspace with real functions. While there\u0027s a couple of places that try to undefine them first, the ordering here - since we\u0027re included from zone.h and hence pretty much everywhere - became intractable."},{"file":"usr/src/uts/common/sys/cpu_uarray.h","line":50,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Can you document the arguments to this? While I don\u0027t usually like them, maybe the type safety of an inline function is warranted here?"},{"file":"usr/src/uts/common/sys/cpu_uarray.h","line":50,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"I rewrote this for clarity. We can\u0027t use an inline function as the lvalue is really convenient here"},{"file":"usr/src/uts/common/sys/cpu_uarray.h","line":56,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Use the c99 cu_vals[]? This will prevent some compilers from overagressive optimizations and assumptions that accessing cu_vals[1] or higher is undefined. Since this is all ifdef _KERNEL and the kernel is c99, seems better?"},{"file":"usr/src/uts/common/sys/cpu_uarray.h","line":56,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Done"},{"file":"usr/src/uts/common/sys/zone.h","line":689,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Worth still having parts of this comment in the definition of the stats?"},{"file":"usr/src/uts/common/sys/zone.h","line":689,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Done"},{"file":"usr/src/uts/common/sys/zone.h","line":357,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Comment that these are for keeping track of stats and the member they\u0027re associated with in the zone_t?"},{"file":"usr/src/uts/common/sys/zone.h","line":357,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/pkg/manifests/system-header.mf","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/uts/common/Makefile.files","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/common/os/cpu_uarray.c","type":"ADDED","insertions":61,"deletions":0},{"file":"usr/src/uts/common/os/msacct.c","type":"MODIFIED","insertions":35,"deletions":-19},{"file":"usr/src/uts/common/os/zone.c","type":"MODIFIED","insertions":22,"deletions":-16},{"file":"usr/src/uts/common/sys/Makefile","type":"MODIFIED","insertions":7,"deletions":-6},{"file":"usr/src/uts/common/sys/cpu_uarray.h","type":"ADDED","insertions":69,"deletions":0},{"file":"usr/src/uts/common/sys/zone.h","type":"MODIFIED","insertions":19,"deletions":-23}],"sizeInsertions":217,"sizeDeletions":-64},{"number":"8","revision":"9bc488ba188266a0b4d0dbb08d53539141b985d7","parents":["b9e062ca08c34e1a9774695a14a3c31899d1f414"],"ref":"refs/changes/13/5013/8","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1541720224,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1541785796,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1541791933,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"comments":[{"file":"usr/src/uts/common/os/cpu_uarray.c","line":27,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Minor nit, but I think this can now just be sizeof (cpu_uarrray_t)."},{"file":"usr/src/uts/common/sys/cpu_uarray.h","line":20,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"nit: Worth noting that all the of the testing was done on modern amd64 machines?"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/pkg/manifests/system-header.mf","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/uts/common/Makefile.files","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/common/os/cpu_uarray.c","type":"ADDED","insertions":79,"deletions":0},{"file":"usr/src/uts/common/os/msacct.c","type":"MODIFIED","insertions":35,"deletions":-19},{"file":"usr/src/uts/common/os/zone.c","type":"MODIFIED","insertions":30,"deletions":-21},{"file":"usr/src/uts/common/sys/Makefile","type":"MODIFIED","insertions":7,"deletions":-6},{"file":"usr/src/uts/common/sys/cpu_uarray.h","type":"ADDED","insertions":75,"deletions":0},{"file":"usr/src/uts/common/sys/sysmacros.h","type":"MODIFIED","insertions":13,"deletions":0},{"file":"usr/src/uts/common/sys/zone.h","type":"MODIFIED","insertions":23,"deletions":-23}],"sizeInsertions":266,"sizeDeletions":-69},{"number":"9","revision":"7c0101f620e6ddbf874bd93f56e356faa99f215b","parents":["b9e062ca08c34e1a9774695a14a3c31899d1f414"],"ref":"refs/changes/13/5013/9","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1541793201,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/pkg/manifests/system-header.mf","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/uts/common/Makefile.files","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/common/os/cpu_uarray.c","type":"ADDED","insertions":79,"deletions":0},{"file":"usr/src/uts/common/os/msacct.c","type":"MODIFIED","insertions":35,"deletions":-19},{"file":"usr/src/uts/common/os/zone.c","type":"MODIFIED","insertions":30,"deletions":-21},{"file":"usr/src/uts/common/sys/Makefile","type":"MODIFIED","insertions":7,"deletions":-6},{"file":"usr/src/uts/common/sys/cpu_uarray.h","type":"ADDED","insertions":75,"deletions":0},{"file":"usr/src/uts/common/sys/sysmacros.h","type":"MODIFIED","insertions":13,"deletions":0},{"file":"usr/src/uts/common/sys/zone.h","type":"MODIFIED","insertions":23,"deletions":-23}],"sizeInsertions":266,"sizeDeletions":-69},{"number":"10","revision":"d7b1a661176710b00122cfa8e32a65c27c8e5f0a","parents":["b9e062ca08c34e1a9774695a14a3c31899d1f414"],"ref":"refs/changes/13/5013/10","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1541793328,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1541793807,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1542029288,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1542030863,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1541793376,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/pkg/manifests/system-header.mf","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/uts/common/Makefile.files","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/common/os/cpu_uarray.c","type":"ADDED","insertions":79,"deletions":0},{"file":"usr/src/uts/common/os/msacct.c","type":"MODIFIED","insertions":35,"deletions":-19},{"file":"usr/src/uts/common/os/zone.c","type":"MODIFIED","insertions":30,"deletions":-21},{"file":"usr/src/uts/common/sys/Makefile","type":"MODIFIED","insertions":7,"deletions":-6},{"file":"usr/src/uts/common/sys/cpu_uarray.h","type":"ADDED","insertions":77,"deletions":0},{"file":"usr/src/uts/common/sys/sysmacros.h","type":"MODIFIED","insertions":13,"deletions":0},{"file":"usr/src/uts/common/sys/zone.h","type":"MODIFIED","insertions":23,"deletions":-23}],"sizeInsertions":268,"sizeDeletions":-69},{"number":"11","revision":"c577c5708efcaaf4f49f1b402abbff44b40901ab","parents":["b9e062ca08c34e1a9774695a14a3c31899d1f414"],"ref":"refs/changes/13/5013/11","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1542031433,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1541793807,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1542029288,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1542030863,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1541793376,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":12,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/pkg/manifests/system-header.mf","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/uts/common/Makefile.files","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/common/os/cpu_uarray.c","type":"ADDED","insertions":79,"deletions":0},{"file":"usr/src/uts/common/os/msacct.c","type":"MODIFIED","insertions":35,"deletions":-19},{"file":"usr/src/uts/common/os/zone.c","type":"MODIFIED","insertions":30,"deletions":-21},{"file":"usr/src/uts/common/sys/Makefile","type":"MODIFIED","insertions":7,"deletions":-6},{"file":"usr/src/uts/common/sys/cpu_uarray.h","type":"ADDED","insertions":77,"deletions":0},{"file":"usr/src/uts/common/sys/sysmacros.h","type":"MODIFIED","insertions":13,"deletions":0},{"file":"usr/src/uts/common/sys/zone.h","type":"MODIFIED","insertions":23,"deletions":-23}],"sizeInsertions":268,"sizeDeletions":-69},{"number":"12","revision":"aa694ffb2f51c06ac16cadc3685f0e847b680409","parents":["13722208fb412a293031522d6f42992cae1f60a3"],"ref":"refs/changes/13/5013/12","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1542031449,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1541793807,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1542029288,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1542030863,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1541793376,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"SUBM","value":"1","grantedOn":1542034547,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":12,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/pkg/manifests/system-header.mf","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/uts/common/Makefile.files","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/common/os/cpu_uarray.c","type":"ADDED","insertions":79,"deletions":0},{"file":"usr/src/uts/common/os/msacct.c","type":"MODIFIED","insertions":35,"deletions":-19},{"file":"usr/src/uts/common/os/zone.c","type":"MODIFIED","insertions":30,"deletions":-21},{"file":"usr/src/uts/common/sys/Makefile","type":"MODIFIED","insertions":7,"deletions":-6},{"file":"usr/src/uts/common/sys/cpu_uarray.h","type":"ADDED","insertions":77,"deletions":0},{"file":"usr/src/uts/common/sys/sysmacros.h","type":"MODIFIED","insertions":13,"deletions":0},{"file":"usr/src/uts/common/sys/zone.h","type":"MODIFIED","insertions":23,"deletions":-23}],"sizeInsertions":268,"sizeDeletions":-69}],"allReviewers":[{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}]}