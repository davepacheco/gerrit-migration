{"project":"joyent/sdc-cnapi","branch":"master","id":"Iba575c6136179f74ca16f086d1d71b9032e44e8d","number":"891","subject":"CNAPI-677 Add support for disklayout params to server setup FIXED Reviewed by: Orlando Vazquez \u003corlando@joyent.com\u003e Reviewed by: Trent Mick \u003ctrent.mick@joyent.com\u003e Reviewed by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e","owner":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"url":"https://cr.joyent.us/891","commitMessage":"CNAPI-677 Add support for disklayout params to server setup FIXED\nReviewed by: Orlando Vazquez \u003corlando@joyent.com\u003e\nReviewed by: Trent Mick \u003ctrent.mick@joyent.com\u003e\nReviewed by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e\n\nThis reverts commit 7034ad8ebfa08cfaacf0bd914580d2173f985e7d.\n","createdOn":1479122126,"lastUpdated":1479151859,"open":false,"status":"MERGED","comments":[{"timestamp":1479122126,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 1."},{"timestamp":1479122195,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1479124079,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 1:\n\nFor what I can tell, the issue is with these lines here: https://github.com/joyent/sdc-cnapi/blob/master/lib/validation/endpoints.js#L94-L98. That defines every property set to optional to a value which, most of the times is undefined (second member of size 1 array). Therefore, hasOwnProperty always return true, but the values are always undefined.\n\nI don\u0027t think that\u0027s the desired behavior, b/c all those hasOwnProperty checks for req.params are useless and will return always true for every param you validate.\n\nAnyway, I\u0027ve just modified the check for the disk related properties in order to be able to re-apply the changes made for this issue and would left any other required changes for other issue."},{"timestamp":1479127561,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 2: Commit message was updated."},{"timestamp":1479136750,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 2: Code-Review+1\n\nFrom the explanation given, this looks good to me."},{"timestamp":1479148472,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Patch Set 2: Code-Review+1 Integration-Approval+1\n\nI opened CNAPI-678 to tackle the issue Pedro raised, but the way it\u0027s addressed here LGTM."},{"timestamp":1479148839,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Patch Set 2:\n\nI opened CNAPI-678 to tackle the issue Pedro raised, but the way it\u0027s addressed here LGTM."},{"timestamp":1479149712,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 2: Code-Review-1\n\n(2 comments)"},{"timestamp":1479151426,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 3."},{"timestamp":1479151514,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 3: Code-Review+1 Integration-Approval+1"},{"timestamp":1479151828,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1479151859,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Pedro Palazón Candel"}],"currentPatchSet":{"number":"3","revision":"ba575c6136179f74ca16f086d1d71b9032e44e8d","parents":["7034ad8ebfa08cfaacf0bd914580d2173f985e7d"],"ref":"refs/changes/91/891/3","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1479151426,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1479151514,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1479151514,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1479151828,"by":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"}},{"type":"SUBM","value":"1","grantedOn":1479151859,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":12,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":3,"deletions":0},{"file":"lib/endpoints/servers.js","type":"MODIFIED","insertions":38,"deletions":-2},{"file":"lib/models/server.js","type":"MODIFIED","insertions":15,"deletions":0},{"file":"lib/workflows/server-setup.js","type":"MODIFIED","insertions":16,"deletions":-5}],"sizeInsertions":72,"sizeDeletions":-7},"patchSets":[{"number":"1","revision":"90fcc606cd55456d510bc228916eb7a2b511ca12","parents":["7034ad8ebfa08cfaacf0bd914580d2173f985e7d"],"ref":"refs/changes/91/891/1","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1479122126,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1479122195,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":3,"deletions":0},{"file":"lib/endpoints/servers.js","type":"MODIFIED","insertions":38,"deletions":-2},{"file":"lib/models/server.js","type":"MODIFIED","insertions":15,"deletions":0},{"file":"lib/workflows/server-setup.js","type":"MODIFIED","insertions":16,"deletions":-5}],"sizeInsertions":72,"sizeDeletions":-7},{"number":"2","revision":"8f856e5383b87619aba063338b727d16f6bb6fae","parents":["7034ad8ebfa08cfaacf0bd914580d2173f985e7d"],"ref":"refs/changes/91/891/2","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1479127561,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1479122195,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1479136750,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"-1","grantedOn":1479149712,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1479148472,"by":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1479148472,"by":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"}}],"comments":[{"file":"docs/index.md","line":1159,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Could all of these please state that they are optional. Also list the valid values for disk_layout, *and* what the default value is if not specified."},{"file":"lib/endpoints/servers.js","line":658,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"FWIW, I prefer `if (req.params.disk_spaces !\u003d\u003d undefined)` to avoid the \u0027typeof\u0027, but either is fine."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":3,"deletions":0},{"file":"lib/endpoints/servers.js","type":"MODIFIED","insertions":38,"deletions":-2},{"file":"lib/models/server.js","type":"MODIFIED","insertions":15,"deletions":0},{"file":"lib/workflows/server-setup.js","type":"MODIFIED","insertions":16,"deletions":-5}],"sizeInsertions":72,"sizeDeletions":-7},{"number":"3","revision":"ba575c6136179f74ca16f086d1d71b9032e44e8d","parents":["7034ad8ebfa08cfaacf0bd914580d2173f985e7d"],"ref":"refs/changes/91/891/3","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1479151426,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1479151514,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1479151514,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1479151859,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1479151828,"by":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":12,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":3,"deletions":0},{"file":"lib/endpoints/servers.js","type":"MODIFIED","insertions":38,"deletions":-2},{"file":"lib/models/server.js","type":"MODIFIED","insertions":15,"deletions":0},{"file":"lib/workflows/server-setup.js","type":"MODIFIED","insertions":16,"deletions":-5}],"sizeInsertions":72,"sizeDeletions":-7}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}]}