commit 775c44aebf5fde274d7a079b9c4eee9cfeac280f (refs/changes/84/5084/4)
Author: Tim Foster <tim.foster@joyent.com>
Date:   2018-11-21T18:12:11+00:00 (11 months ago)
    
    MANTA-4024 madtom doesn't use its nodeunit dependency

diff --git a/Makefile b/Makefile
index 27176bc..9be8549 100644
--- a/Makefile
+++ b/Makefile
@@ -5,7 +5,7 @@
 #
 
 #
-# Copyright (c) 2017, Joyent, Inc.
+# Copyright (c) 2018, Joyent, Inc.
 #
 
 #
@@ -25,7 +25,6 @@
 #
 # Tools
 #
-NODEUNIT        := ./node_modules/.bin/nodeunit
 NPM             := npm
 
 #
@@ -74,17 +73,15 @@ NPM_ENV		 = MAKE_OVERRIDES="CTFCONVERT=/bin/true CTFMERGE=/bin/true"
 # Repo-specific targets
 #
 .PHONY: all
-all: $(SMF_MANIFESTS) | $(NODEUNIT) $(REPO_DEPS) scripts
-	$(NPM) install
-$(NODEUNIT): | $(NPM_EXEC)
+all: $(SMF_MANIFESTS) | $(REPO_DEPS) scripts
 	$(NPM) install
 
 CLEAN_FILES += $(NODEUNIT) ./node_modules/nodeunit
 
 .PHONY: test
-test: $(NODEUNIT)
+test:
 	mkdir -p ./tmp
-	find test/ -name '*.test.js' | xargs -t -L1 ctrun -o noorphan node
+	find test/ -name '*.test.js' | xargs -t -L1 ctrun -o noorphan $(NODE_EXEC)
 
 .PHONY: scripts
 scripts: deps/manta-scripts/.git
diff --git a/package.json b/package.json
index 3992d81..906aa06 100644
--- a/package.json
+++ b/package.json
@@ -17,7 +17,8 @@
                 "vasync": "1.5.0"
         },
         "devDependencies": {
-                "nodeunit": "0.7.4"
+		"//": "One of our modules has a '*' dependency on 'debug' that uses syntax incompatible with our prebuilt node version. Force it to an older version.",
+                "debug": "3.1.0"
         },
         "engines": {
                 "node": "0.8.18"
