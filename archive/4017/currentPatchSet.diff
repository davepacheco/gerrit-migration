From f7a8ddb2d2c164d738d61f4194fbd0e7f8429f22 Mon Sep 17 00:00:00 2001
From: Jason King <jason.king@joyent.com>
Date: Tue, 29 May 2018 09:05:49 -0500
Subject: [PATCH] OS-6980 small leak in libvarpd

---
 usr/src/lib/varpd/libvarpd/common/libvarpd_overlay.c | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/usr/src/lib/varpd/libvarpd/common/libvarpd_overlay.c b/usr/src/lib/varpd/libvarpd/common/libvarpd_overlay.c
index f557f4cbc6..28b4005dbe 100644
--- a/usr/src/lib/varpd/libvarpd/common/libvarpd_overlay.c
+++ b/usr/src/lib/varpd/libvarpd/common/libvarpd_overlay.c
@@ -522,6 +522,8 @@ libvarpd_plugin_query_reply(varpd_query_handle_t *vqh, int action)
 	else
 		libvarpd_panic("plugin %s passed in an invalid action: %d",
 		    vqp->vq_instance->vri_plugin->vpp_name, action);
+
+	umem_cache_free(vqp->vq_instance->vri_impl->vdi_qcache, vqp);
 }
 
 void
-- 
2.21.0

