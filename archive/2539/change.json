{"project":"joyent/manta-manatee","branch":"master","id":"I0141368bee1615b6a52b19319965702db200af98","number":"2539","subject":"MANATEE-357 RST flood protection turns active failures into timeouts when PostgreSQL not running Reviewed by: Robert Mustacchi \u003crm@joyent.com\u003e Approved by: David Pacheco \u003cdap@joyent.com\u003e","owner":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"url":"https://cr.joyent.us/2539","commitMessage":"MANATEE-357 RST flood protection turns active failures into timeouts when PostgreSQL not running\nReviewed by: Robert Mustacchi \u003crm@joyent.com\u003e\nApproved by: David Pacheco \u003cdap@joyent.com\u003e\n","createdOn":1505099924,"lastUpdated":1505196798,"open":false,"status":"MERGED","comments":[{"timestamp":1505099924,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Uploaded patch set 1."},{"timestamp":1505099933,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1505099985,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Patch Set 2: Commit message was updated."},{"timestamp":1505105565,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 2:\n\n(1 comment)\n\nTesting looks good to me. Thanks for putting this together."},{"timestamp":1505106012,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1505106971,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1505162644,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Uploaded patch set 3."},{"timestamp":1505162653,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1505162845,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1505163110,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 3: Integration-Approval+1"},{"timestamp":1505196763,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Uploaded patch set 4: Commit message was updated."},{"timestamp":1505196798,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Joshua M. Clulow"}],"currentPatchSet":{"number":"4","revision":"0141368bee1615b6a52b19319965702db200af98","parents":["2162801457399b3efeab96a9454825f36be60e48"],"ref":"refs/changes/39/2539/4","uploader":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"createdOn":1505196763,"author":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1505162653,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1505162845,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1505163110,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"SUBM","value":"1","grantedOn":1505196798,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"boot/configure.sh","type":"MODIFIED","insertions":15,"deletions":-3}],"sizeInsertions":15,"sizeDeletions":-3},"patchSets":[{"number":"1","revision":"2a13677cd6d5855c3a83809b5661a5277c13e4d0","parents":["2162801457399b3efeab96a9454825f36be60e48"],"ref":"refs/changes/39/2539/1","uploader":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"createdOn":1505099924,"author":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1505099933,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"boot/configure.sh","type":"MODIFIED","insertions":11,"deletions":-3}],"sizeInsertions":11,"sizeDeletions":-3},{"number":"2","revision":"cb90bf04e6193e684969ff2688ec5e4b82849397","parents":["2162801457399b3efeab96a9454825f36be60e48"],"ref":"refs/changes/39/2539/2","uploader":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"createdOn":1505099985,"author":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1505099933,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"boot/configure.sh","line":22,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Should we be checking the error status here? I presume that even if it fails, we still want to bring up manatee."},{"file":"boot/configure.sh","line":22,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"I had copied the style of a similar set of tuning done in muppet:\n\nhttps://github.com/joyent/muppet/blob/8ee80ee/boot/configure.sh#L22-L23\n\nThe stability of this interface (\"ndd\" and \"/dev/tcp\") is somewhat unclear.  This seems like the sort of property that should really be exposed through ipadm(1M), but does not appear to be today.\n\nI think it is fine to drive on in the face of this particular failure as I\u0027d rather not have a subsequent platform change prevent older Manatee images from starting.  Because \"xtrace\" is enabled, I believe the exit status will be logged either way."},{"file":"boot/configure.sh","line":22,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Can we add a comment describing why we ignore the return value? The reasoning seems reasonable."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"boot/configure.sh","type":"MODIFIED","insertions":11,"deletions":-3}],"sizeInsertions":11,"sizeDeletions":-3},{"number":"3","revision":"86623bf6036e1a6bf9cdf255203776948a75f62c","parents":["2162801457399b3efeab96a9454825f36be60e48"],"ref":"refs/changes/39/2539/3","uploader":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"createdOn":1505162644,"author":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1505163110,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1505162845,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1505162653,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"boot/configure.sh","type":"MODIFIED","insertions":15,"deletions":-3}],"sizeInsertions":15,"sizeDeletions":-3},{"number":"4","revision":"0141368bee1615b6a52b19319965702db200af98","parents":["2162801457399b3efeab96a9454825f36be60e48"],"ref":"refs/changes/39/2539/4","uploader":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"createdOn":1505196763,"author":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1505163110,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1505162845,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"SUBM","value":"1","grantedOn":1505196798,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1505162653,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"boot/configure.sh","type":"MODIFIED","insertions":15,"deletions":-3}],"sizeInsertions":15,"sizeDeletions":-3}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}]}