{"project":"joyent/node-cueball","branch":"master","id":"Ie51b2048c014ea36ce32f1a0512e0b3a32119232","number":"966","subject":"joyent/node-cueball#54 skip AAAA lookups on machines with no v6 address Reviewed by: David Pacheco \u003cdap@joyent.com\u003e","owner":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"url":"https://cr.joyent.us/966","commitMessage":"joyent/node-cueball#54 skip AAAA lookups on machines with no v6 address\nReviewed by: David Pacheco \u003cdap@joyent.com\u003e\n","createdOn":1480424916,"lastUpdated":1480556323,"open":false,"status":"MERGED","comments":[{"timestamp":1480424916,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 1."},{"timestamp":1480425119,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1480462245,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 1:\n\n(1 comment)\n\nIs there a reasonable way we could test this?  Is there an existing test where we could insert a test case that fakes up a return value for os.networkInterfaces()?  Or does that fall under the future work of joyent/node-cueball#38?"},{"timestamp":1480537146,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 2."},{"timestamp":1480537253,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1480541652,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 3."},{"timestamp":1480541739,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 1:\n\n(1 comment)\n\n\u003e (1 comment)\n \u003e \n \u003e Is there a reasonable way we could test this?  Is there an existing\n \u003e test where we could insert a test case that fakes up a return value\n \u003e for os.networkInterfaces()?  Or does that fall under the future\n \u003e work of joyent/node-cueball#38?\n\nI\u0027ve added a test case in dns.test.js that mocks up os.networkInterfaces() to cover this."},{"timestamp":1480541751,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1480551503,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 4."},{"timestamp":1480551608,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1480551996,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 4: Code-Review+1"},{"timestamp":1480556228,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 5: Patch Set 4 was rebased"},{"timestamp":1480556247,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 6: Commit message was updated."},{"timestamp":1480556258,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 6: Integration-Approval+1"},{"timestamp":1480556259,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Alex Wilson"},{"timestamp":1480556323,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5:\n\n\"make check\" passed ok"}],"currentPatchSet":{"number":"6","revision":"812407c530e453a079eb694150670812c350599f","parents":["428853f8620d2aa04c2800a03fbe5883d2ff69d7"],"ref":"refs/changes/66/966/6","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1480556247,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1480551608,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1480551996,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1480556258,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"SUBM","value":"1","grantedOn":1480556259,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"lib/resolver.js","type":"MODIFIED","insertions":25,"deletions":-3},{"file":"test/dns.test.js","type":"MODIFIED","insertions":70,"deletions":0}],"sizeInsertions":95,"sizeDeletions":-3},"patchSets":[{"number":"1","revision":"ab2fb0c7aaeeef7e1411564663a9da041146f0d3","parents":["18dff0cef1268dfb4fb5fc2de84b89d2e55e1295"],"ref":"refs/changes/66/966/1","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1480424916,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1480425119,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/resolver.js","line":473,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"This seems reasonable given what we have, but there\u0027s essentially no documentation from Node about what these fields mean.  Do you know what \"internal\" actually means?\n\nHow often does this function run?  Would we run it, say, every 5 seconds if the TTL on the records was 5 seconds?  Would it be worth caching the result so that we don\u0027t run it so often?"},{"file":"lib/resolver.js","line":473,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"So I\u0027ve changed to using a test for ::1 there instead of .internal. Turns out, surprise surprise, it has a checkered past.\n\nThis function runs every time the resolver wakes up. As I understand it all we when we call this is make a few fairly cheap syscalls, it shouldn\u0027t be expensive to do it all the time."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/resolver.js","type":"MODIFIED","insertions":16,"deletions":-3}],"sizeInsertions":16,"sizeDeletions":-3},{"number":"2","revision":"6ba4b0ae7788fa79d43a7735ddf769be6fbec738","parents":["18dff0cef1268dfb4fb5fc2de84b89d2e55e1295"],"ref":"refs/changes/66/966/2","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1480537146,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1480537253,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/resolver.js","type":"MODIFIED","insertions":16,"deletions":-3}],"sizeInsertions":16,"sizeDeletions":-3},{"number":"3","revision":"cfa4a26b05d1fe2a51f294dfbfa4bf35f3bb5ff7","parents":["18dff0cef1268dfb4fb5fc2de84b89d2e55e1295"],"ref":"refs/changes/66/966/3","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1480541652,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1480541751,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/resolver.js","type":"MODIFIED","insertions":16,"deletions":-3},{"file":"test/dns.test.js","type":"MODIFIED","insertions":69,"deletions":0}],"sizeInsertions":85,"sizeDeletions":-3},{"number":"4","revision":"e51b2048c014ea36ce32f1a0512e0b3a32119232","parents":["18dff0cef1268dfb4fb5fc2de84b89d2e55e1295"],"ref":"refs/changes/66/966/4","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1480551503,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1480551996,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1480551608,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/resolver.js","type":"MODIFIED","insertions":25,"deletions":-3},{"file":"test/dns.test.js","type":"MODIFIED","insertions":70,"deletions":0}],"sizeInsertions":95,"sizeDeletions":-3},{"number":"5","revision":"2a5a9383cce78cddadc9864195fbe8e528684002","parents":["428853f8620d2aa04c2800a03fbe5883d2ff69d7"],"ref":"refs/changes/66/966/5","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1480556228,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1480551996,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1480551608,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/resolver.js","type":"MODIFIED","insertions":25,"deletions":-3},{"file":"test/dns.test.js","type":"MODIFIED","insertions":70,"deletions":0}],"sizeInsertions":95,"sizeDeletions":-3},{"number":"6","revision":"812407c530e453a079eb694150670812c350599f","parents":["428853f8620d2aa04c2800a03fbe5883d2ff69d7"],"ref":"refs/changes/66/966/6","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1480556247,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1480551996,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1480556258,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"SUBM","value":"1","grantedOn":1480556259,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1480551608,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"lib/resolver.js","type":"MODIFIED","insertions":25,"deletions":-3},{"file":"test/dns.test.js","type":"MODIFIED","insertions":70,"deletions":0}],"sizeInsertions":95,"sizeDeletions":-3}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}]}