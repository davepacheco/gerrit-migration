{"project":"joyent/sdc-vmapi","branch":"master","id":"Idd962afdd4ac74b8580cec072d1abc1a888d6771","number":"5157","subject":"TRITON-961 Add \"flexible_disk_space\" support to VMAPI Reviewed by: Mike Gerdts \u003cmike.gerdts@joyent.com\u003e Reviewed by: Marsell Kukuljevic \u003cmarsell@joyent.com\u003e Approved by: Marsell Kukuljevic \u003cmarsell@joyent.com\u003e","owner":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"url":"https://cr.joyent.us/5157","commitMessage":"TRITON-961 Add \"flexible_disk_space\" support to VMAPI\nReviewed by: Mike Gerdts \u003cmike.gerdts@joyent.com\u003e\nReviewed by: Marsell Kukuljevic \u003cmarsell@joyent.com\u003e\nApproved by: Marsell Kukuljevic \u003cmarsell@joyent.com\u003e\n","createdOn":1543425856,"lastUpdated":1543590543,"open":false,"status":"MERGED","comments":[{"timestamp":1543425856,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 1."},{"timestamp":1543425861,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit 696400689d518effc8dc3fe2c6f35be6b93ffb50\n    \n    Add flexible_disk_space support to VMAPI"},{"timestamp":1543425895,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1543425902,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 2: Patch Set 1 was rebased."},{"timestamp":1543425906,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit 70a46bbfc27b8e0cc75fc6bfb4cbad90e9099173\n    \n    Add flexible_disk_space support to VMAPI"},{"timestamp":1543425939,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2:\n\n\"make check\" passed ok"},{"timestamp":1543426107,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 2:\n\nTests missing for Bhyve VMs until we tackle TRITON-977. For this case, it\u0027ll be a pretty simple test: Create a package with `flexible_disk` set to true, a quota different that 10GiB (The default) and then provision a bhyve machine with the package. The `flexible_disk_size` value of the machine must be set to the package\u0027s quota and that value should be displayed when rendering the machine through VMAPI.\n\nI\u0027m not sure if we should add changes to such value when \"updating\" machine package, if that\u0027s possible. Thoughts?\n\nMarsell: Note you\u0027ll possibly need this for the disks stuff to work, though"},{"timestamp":1543433875,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 2:\n\n(2 comments)"},{"timestamp":1543452433,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 2:\n\nlgtm, aside from things Marsell mentioned."},{"timestamp":1543505159,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 3."},{"timestamp":1543505164,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 3:\n\nNew commits:\n    \n    commit 8e452253eb7d0caf93845a35dad0e80f7c184b61\n    \n    Add flexible_disk_space support to VMAPI"},{"timestamp":1543505196,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1543505205,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 2:\n\n(2 comments)\n\nDone with the suggested changes. Behavior remain as expected."},{"timestamp":1543508795,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1543517730,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 3: Code-Review+1 Integration-Approval+1"},{"timestamp":1543590529,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 4: Commit message was updated."},{"timestamp":1543590543,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Pedro Palazón Candel"}],"currentPatchSet":{"number":"4","revision":"dd962afdd4ac74b8580cec072d1abc1a888d6771","parents":["d7e12c10e7596b0b4a8a9b79e044cb3a5f78d2d3"],"ref":"refs/changes/57/5157/4","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1543590529,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1543505196,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1543508795,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1543517730,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1543517730,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}},{"type":"SUBM","value":"1","grantedOn":1543590543,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"lib/common/validation.js","type":"MODIFIED","insertions":7,"deletions":-3},{"file":"lib/common/vm-common.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/workflows/provision.js","type":"MODIFIED","insertions":6,"deletions":-2}],"sizeInsertions":15,"sizeDeletions":-6},"patchSets":[{"number":"1","revision":"3f7d425fa9664cb820933784b371ba45afd729fe","parents":["aad2339bfe7abd80202881e30f331ff2671bbf39"],"ref":"refs/changes/57/5157/1","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1543425856,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1543425895,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/common/validation.js","type":"MODIFIED","insertions":7,"deletions":-3},{"file":"lib/common/vm-common.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/workflows/provision.js","type":"MODIFIED","insertions":4,"deletions":-2}],"sizeInsertions":13,"sizeDeletions":-6},{"number":"2","revision":"76fc293ac518d023bcc09930d7c9ddd8c4395d8a","parents":["a3b078c4bd6f9d612379122e18e6e35d67c87222"],"ref":"refs/changes/57/5157/2","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1543425902,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1543425895,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/workflows/provision.js","line":299,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"This is a bhyve-only feature, right? Do we need to worry about this here?"},{"file":"lib/workflows/provision.js","line":299,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Let\u0027s do, given it\u0027s pretty cheap!"},{"file":"lib/workflows/provision.js","line":300,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Might as well name it."},{"file":"lib/workflows/provision.js","line":300,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/common/validation.js","type":"MODIFIED","insertions":7,"deletions":-3},{"file":"lib/common/vm-common.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/workflows/provision.js","type":"MODIFIED","insertions":4,"deletions":-2}],"sizeInsertions":13,"sizeDeletions":-6},{"number":"3","revision":"c3d192cfb5cb5f18fe389d76fe7a6105771c8deb","parents":["d7e12c10e7596b0b4a8a9b79e044cb3a5f78d2d3"],"ref":"refs/changes/57/5157/3","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1543505159,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1543505196,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1543517730,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1543517730,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1543508795,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/common/validation.js","type":"MODIFIED","insertions":7,"deletions":-3},{"file":"lib/common/vm-common.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/workflows/provision.js","type":"MODIFIED","insertions":6,"deletions":-2}],"sizeInsertions":15,"sizeDeletions":-6},{"number":"4","revision":"dd962afdd4ac74b8580cec072d1abc1a888d6771","parents":["d7e12c10e7596b0b4a8a9b79e044cb3a5f78d2d3"],"ref":"refs/changes/57/5157/4","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1543590529,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1543505196,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"SUBM","value":"1","grantedOn":1543590543,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1543517730,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1543517730,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1543508795,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"lib/common/validation.js","type":"MODIFIED","insertions":7,"deletions":-3},{"file":"lib/common/vm-common.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/workflows/provision.js","type":"MODIFIED","insertions":6,"deletions":-2}],"sizeInsertions":15,"sizeDeletions":-6}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}]}