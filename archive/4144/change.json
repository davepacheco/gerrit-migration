{"project":"joyent/illumos-joyent","branch":"master","id":"I8118caaf6ac0df6a54351bfd800aea92a6ac3cca","number":"4144","subject":"OS-6967 LDT still not happy under KPTI Reviewed by: Robert Mustacchi \u003crm@joyent.com\u003e Reviewed by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e Reviewed by: Alex Wilson \u003calex.wilson@joyent.com\u003e Approved by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e Approved by:","owner":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"url":"https://cr.joyent.us/4144","commitMessage":"OS-6967 LDT still not happy under KPTI\nReviewed by: Robert Mustacchi \u003crm@joyent.com\u003e\nReviewed by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e\nReviewed by: Alex Wilson \u003calex.wilson@joyent.com\u003e\nApproved by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e\nApproved by: Alex Wilson \u003calex.wilson@joyent.com\u003e\n","createdOn":1528227264,"lastUpdated":1528930545,"open":false,"status":"MERGED","comments":[{"timestamp":1528227264,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Uploaded patch set 1."},{"timestamp":1528227266,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit e53e0b8d2b8d603d5bcc91e3e3cd80d5cf1fecc6\n    \n    m\n    \n    commit ac5b8abdef7de435374b78ddebe214194a80b516\n    \n    m"},{"timestamp":1528227286,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 1: Code-Review-1\n\nnot yet"},{"timestamp":1528275215,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Uploaded patch set 2."},{"timestamp":1528275225,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit 25d09fc0f657d8138b9886781eb0a4f3f1141bbd\n    \n    mm\n    \n    commit 5934fad711cba9ad5d1517933e15f35adfc49e56\n    \n    m"},{"timestamp":1528278819,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Uploaded patch set 3."},{"timestamp":1528278835,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 3:\n\nNew commits:\n    \n    commit 14006e3a9230e09dee5ee3a0c99831797a8c28a6\n    \n    m"},{"timestamp":1528293661,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 3: -Code-Review"},{"timestamp":1528294567,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 3: Code-Review-1\n\nActually, not quite yet..."},{"timestamp":1528445932,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Uploaded patch set 4."},{"timestamp":1528445956,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 4:\n\nNew commits:\n    \n    commit de2a499a4be2e04a44ae14ba407c9dfeb37b7bbd\n    \n    m\n    \n    commit fc3c106d6f8418b04dee2826a34dd184fd18a46a\n    \n    m"},{"timestamp":1528447532,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Uploaded patch set 5."},{"timestamp":1528447563,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 5:\n\nNew commits:\n    \n    commit b621c7647d1c3964ac5b4979a5737f8ecaca1088\n    \n    m"},{"timestamp":1528464458,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 5: -Code-Review"},{"timestamp":1528490092,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 5: Code-Review+1\n\n(5 comments)\n\nIn general I\u0027m happy with those, though some of the minor things could be fixed if you wanted."},{"timestamp":1528535380,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 5:\n\n(4 comments)"},{"timestamp":1528713053,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Uploaded patch set 6."},{"timestamp":1528713055,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 6:\n\nNew commits:\n    \n    commit 095f95b3583cfffef17b3b6579e2857ef743a281\n    \n    m"},{"timestamp":1528736849,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 6: Code-Review+1\n\n(2 comments)"},{"timestamp":1528749638,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 6: Code-Review+1\n\n(1 comment)"},{"timestamp":1528752318,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 6:\n\n(1 comment)"},{"timestamp":1528752558,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Uploaded patch set 7."},{"timestamp":1528752560,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 7:\n\nNew commits:\n    \n    commit 37182f9efbb6534001a5e52302fe24276002257e\n    \n    m"},{"timestamp":1528799453,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Uploaded patch set 8."},{"timestamp":1528799492,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 8:\n\nNew commits:\n    \n    commit 6852b7ab5620adb47ef777aebfea3d07adab3b6e\n    \n    m\n    \n    commit 1081d02aca155e4d54dcbd16273ab474197f71ab\n    \n    m\n    \n    commit 1ce81be9757a9f7850cdfdb814eea8ba002892e8\n    \n    m\n    \n    commit 967ca6bd8b0a7bca3333dbff33322077395f7c55\n    \n    m\n    \n    commit fc0d472243e723294f7a0066cd840fdd936fb832\n    \n    m\n    \n    commit 36cd68369fae744d49614472fc077fbb248ce03d\n    \n    m\n    \n    commit e6633abbbbe086499be39cdd754fb2c4c4430076\n    \n    mm\n    \n    commit 539586b4ffb90f15c4134c41413cc0ae5b32ab83\n    \n    m\n    \n    commit ab0f383bb1b54e1f756170df1b03be7bedfabeac\n    \n    m\n    \n    commit ed207af7b8c366860e114ad6f1f9dd2f6c8706b4\n    \n    m"},{"timestamp":1528811057,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 9: Patch Set 8 was rebased"},{"timestamp":1528825590,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 9: Code-Review+1"},{"timestamp":1528892412,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 10: Patch Set 9 was rebased"},{"timestamp":1528929621,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 10: Code-Review+1 Integration-Approval+1"},{"timestamp":1528929803,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 11: Patch Set 10 was rebased"},{"timestamp":1528929807,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 10: Code-Review+1 Integration-Approval+1"},{"timestamp":1528930450,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Uploaded patch set 12: Commit message was updated."},{"timestamp":1528930452,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 12:\n\nNew commits:\n    \n    commit eeca316ace2474c29609030937d991a2984729e4\n    \n    m\n    \n    commit 5f16062d7c9c2c158f8f168653bf8f449ef8d10a\n    \n    m\n    \n    commit 3457666868970e2b82068bf5ec310a5a5e13578f\n    \n    m\n    \n    commit 4fe90672a343191f08a10d5f5373d0ee88edc815\n    \n    m\n    \n    commit aa678cab252414a671a67de8e7998935c274a987\n    \n    m\n    \n    commit 2ac3f8a4af8928358db404e7bb09808a1c777dc7\n    \n    m\n    \n    commit 01c93971a0bccfd65d14ae7b4d80e1a4b741cb14\n    \n    mm\n    \n    commit 56513c0073741bac1b89c640ecf621f3c198a835\n    \n    m\n    \n    commit fcb21333cd4fc41b4fad296b8c46bcd3d3f8590e\n    \n    m\n    \n    commit 63518178482dae81688de12d7ea448b4a1067284\n    \n    m"},{"timestamp":1528930545,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by John Levon"}],"currentPatchSet":{"number":"12","revision":"8118caaf6ac0df6a54351bfd800aea92a6ac3cca","parents":["f48e1a4f1d835afe9a2607058270907434313e19"],"ref":"refs/changes/44/4144/12","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1528930450,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1528825590,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1528929621,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1528929621,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1528929807,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1528929807,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"SUBM","value":"1","grantedOn":1528930545,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":12,"deletions":0},{"file":"usr/src/pkg/manifests/system-test-ostest.mf","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/test/os-tests/runfiles/default.run","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"usr/src/test/os-tests/tests/Makefile","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"usr/src/test/os-tests/tests/i386/Makefile","type":"ADDED","insertions":46,"deletions":0},{"file":"usr/src/test/os-tests/tests/i386/ldt.c","type":"ADDED","insertions":80,"deletions":0},{"file":"usr/src/test/test-runner/cmd/run","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"usr/src/uts/common/sys/proc.h","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/uts/i86pc/ml/offsets.in","type":"MODIFIED","insertions":0,"deletions":-2},{"file":"usr/src/uts/i86pc/os/mlsetup.c","type":"MODIFIED","insertions":0,"deletions":-5},{"file":"usr/src/uts/i86pc/os/mp_startup.c","type":"MODIFIED","insertions":2,"deletions":-4},{"file":"usr/src/uts/intel/ia32/os/sysi86.c","type":"MODIFIED","insertions":50,"deletions":-71},{"file":"usr/src/uts/intel/sys/x86_archext.h","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":203,"sizeDeletions":-91},"patchSets":[{"number":"1","revision":"13ee18e54352dda94e1f72675881a267a4a3f62f","parents":["65e782538ba0e28b5bae27b0357c8afba9e788a6"],"ref":"refs/changes/44/4144/1","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1528227264,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"-1","grantedOn":1528227286,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/pkg/manifests/system-test-ostest.mf","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/test/os-tests/runfiles/default.run","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/test/os-tests/tests/Makefile","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"usr/src/test/os-tests/tests/i386/Makefile","type":"ADDED","insertions":46,"deletions":0},{"file":"usr/src/test/os-tests/tests/i386/ldt.c","type":"ADDED","insertions":75,"deletions":0},{"file":"usr/src/test/test-runner/cmd/run","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"usr/src/uts/intel/ia32/os/sysi86.c","type":"MODIFIED","insertions":13,"deletions":-40}],"sizeInsertions":152,"sizeDeletions":-43},{"number":"2","revision":"6c99cf18c91d42f362f24474ffbdd700d878400b","parents":["65e782538ba0e28b5bae27b0357c8afba9e788a6"],"ref":"refs/changes/44/4144/2","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1528275215,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"-1","grantedOn":1528227286,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/pkg/manifests/system-test-ostest.mf","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/test/os-tests/runfiles/default.run","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"usr/src/test/os-tests/tests/Makefile","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"usr/src/test/os-tests/tests/i386/Makefile","type":"ADDED","insertions":46,"deletions":0},{"file":"usr/src/test/os-tests/tests/i386/ldt.c","type":"ADDED","insertions":80,"deletions":0},{"file":"usr/src/test/test-runner/cmd/run","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"usr/src/uts/intel/ia32/os/sysi86.c","type":"MODIFIED","insertions":14,"deletions":-41}],"sizeInsertions":160,"sizeDeletions":-46},{"number":"3","revision":"df5fcf01e80e342573a10e3d4fcb46c64d77ff57","parents":["65e782538ba0e28b5bae27b0357c8afba9e788a6"],"ref":"refs/changes/44/4144/3","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1528278819,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"-1","grantedOn":1528294567,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/pkg/manifests/system-test-ostest.mf","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/test/os-tests/runfiles/default.run","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"usr/src/test/os-tests/tests/Makefile","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"usr/src/test/os-tests/tests/i386/Makefile","type":"ADDED","insertions":46,"deletions":0},{"file":"usr/src/test/os-tests/tests/i386/ldt.c","type":"ADDED","insertions":80,"deletions":0},{"file":"usr/src/test/test-runner/cmd/run","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"usr/src/uts/intel/ia32/os/sysi86.c","type":"MODIFIED","insertions":14,"deletions":-41}],"sizeInsertions":160,"sizeDeletions":-46},{"number":"4","revision":"e28df1fc12739d144f14f3518c95d99eb6016a81","parents":["65e782538ba0e28b5bae27b0357c8afba9e788a6"],"ref":"refs/changes/44/4144/4","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1528445932,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"-1","grantedOn":1528294567,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/pkg/manifests/system-test-ostest.mf","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/test/os-tests/runfiles/default.run","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"usr/src/test/os-tests/tests/Makefile","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"usr/src/test/os-tests/tests/i386/Makefile","type":"ADDED","insertions":46,"deletions":0},{"file":"usr/src/test/os-tests/tests/i386/ldt.c","type":"ADDED","insertions":80,"deletions":0},{"file":"usr/src/test/test-runner/cmd/run","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"usr/src/uts/common/sys/proc.h","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/uts/i86pc/ml/offsets.in","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"usr/src/uts/i86pc/os/mlsetup.c","type":"MODIFIED","insertions":0,"deletions":-5},{"file":"usr/src/uts/i86pc/os/mp_startup.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/intel/ia32/os/sysi86.c","type":"MODIFIED","insertions":31,"deletions":-66},{"file":"usr/src/uts/intel/sys/x86_archext.h","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":184,"sizeDeletions":-83},{"number":"5","revision":"fe60f1095b5aec4dc7029009449b0848ec0fbfa6","parents":["65e782538ba0e28b5bae27b0357c8afba9e788a6"],"ref":"refs/changes/44/4144/5","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1528447532,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1528490092,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}}],"comments":[{"file":"usr/src/uts/common/sys/proc.h","line":312,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Should they be uintptr_t to better reflect that they were actually pointeres? Also, why can\u0027t we remove these?"},{"file":"usr/src/uts/common/sys/proc.h","line":312,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Could be, though padding is usually a scalar type. We *could* remove them, but it means re-compiling the world as -\u003ep_zone then moves. In general for the benefit of the wider world, I prefer not to needlessly break things. Any preference?"},{"file":"usr/src/uts/common/sys/proc.h","line":312,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Historically here we haven\u0027t cared. But it doesn\u0027t terribly matter I guess."},{"file":"usr/src/uts/i86pc/os/mp_startup.c","line":2057,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Do we still need the argused?"},{"file":"usr/src/uts/intel/ia32/os/sysi86.c","line":754,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I guess it\u0027s safe to defer this load until later because we basically have an empty LDT and if we error before installing any entries in the LDT (say we hit the error case at 671, that\u0027s fine. And it seems like when we come back on cpu in the future, we\u0027ll still end up paying the fast system call disable cost and we\u0027ll still install the ldt. Which is our current behavior and probably fine. The only real difference is that for the current thread in this system call, they\u0027ll return to userland without the ldt actually installed, but then again, it\u0027s not like they were able to install a successful entry."},{"file":"usr/src/uts/intel/ia32/os/sysi86.c","line":754,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Well *this* line itself never does anything. But on the assumption your comments are about the ldt_load() on line :758, then yes, as long as we maintain the invariant that we have the context ops installed if -\u003ep_ldt, we are fine, even if we hit that error path."},{"file":"usr/src/uts/intel/ia32/os/sysi86.c","line":894,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I think the same way that the ldt_alloc() case is probably okay for the same reasons. Mostly that it\u0027s okay if we return without having installed the larger entry on this CPU because we won\u0027t have added the larger entry and if something else needs us to do so, we\u0027ll end up pulled into the kernel and get the updated ldt reinstalled. Do you agree?"},{"file":"usr/src/uts/intel/ia32/os/sysi86.c","line":894,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Right, exactly. A thread that gets an error back can\u0027t start using that new entry that\u0027s in the grown portion, so it\u0027s fine.\n\nDo you think it\u0027s worth commenting?"},{"file":"usr/src/uts/intel/ia32/os/sysi86.c","line":894,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I think the updated comments make this clear."},{"file":"usr/src/uts/intel/ia32/os/sysi86.c","line":435,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"These words seem like they don\u0027t fit the sentence."},{"file":"usr/src/uts/intel/ia32/os/sysi86.c","line":435,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"It\u0027s essential to the description of the problem, but badly worded. I\u0027ll have another go"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/pkg/manifests/system-test-ostest.mf","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/test/os-tests/runfiles/default.run","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"usr/src/test/os-tests/tests/Makefile","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"usr/src/test/os-tests/tests/i386/Makefile","type":"ADDED","insertions":46,"deletions":0},{"file":"usr/src/test/os-tests/tests/i386/ldt.c","type":"ADDED","insertions":80,"deletions":0},{"file":"usr/src/test/test-runner/cmd/run","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"usr/src/uts/common/sys/proc.h","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/uts/i86pc/ml/offsets.in","type":"MODIFIED","insertions":0,"deletions":-2},{"file":"usr/src/uts/i86pc/os/mlsetup.c","type":"MODIFIED","insertions":0,"deletions":-5},{"file":"usr/src/uts/i86pc/os/mp_startup.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/intel/ia32/os/sysi86.c","type":"MODIFIED","insertions":31,"deletions":-66},{"file":"usr/src/uts/intel/sys/x86_archext.h","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":184,"sizeDeletions":-84},{"number":"6","revision":"8e388ef4fd0cb9c463b882c2529f6d8cc687b141","parents":["65e782538ba0e28b5bae27b0357c8afba9e788a6"],"ref":"refs/changes/44/4144/6","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1528713053,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1528736849,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1528749638,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}}],"comments":[{"file":"usr/src/uts/intel/ia32/os/sysi86.c","line":663,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"This seems super amazingly paranoid? Or am I missing something?"},{"file":"usr/src/uts/intel/ia32/os/sysi86.c","line":663,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"(I mentioned on IRC this made sense in a previous iteration, but now it is indeed just weird.)"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"usr/src/pkg/manifests/system-test-ostest.mf","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/test/os-tests/runfiles/default.run","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"usr/src/test/os-tests/tests/Makefile","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"usr/src/test/os-tests/tests/i386/Makefile","type":"ADDED","insertions":46,"deletions":0},{"file":"usr/src/test/os-tests/tests/i386/ldt.c","type":"ADDED","insertions":80,"deletions":0},{"file":"usr/src/test/test-runner/cmd/run","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"usr/src/uts/common/sys/proc.h","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/uts/i86pc/ml/offsets.in","type":"MODIFIED","insertions":0,"deletions":-2},{"file":"usr/src/uts/i86pc/os/mlsetup.c","type":"MODIFIED","insertions":0,"deletions":-5},{"file":"usr/src/uts/i86pc/os/mp_startup.c","type":"MODIFIED","insertions":2,"deletions":-4},{"file":"usr/src/uts/intel/ia32/os/sysi86.c","type":"MODIFIED","insertions":52,"deletions":-71},{"file":"usr/src/uts/intel/sys/x86_archext.h","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":205,"sizeDeletions":-91},{"number":"7","revision":"9dcf9adc3da6528d69e0e7c0bb804ffa519d1be5","parents":["65e782538ba0e28b5bae27b0357c8afba9e788a6"],"ref":"refs/changes/44/4144/7","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1528752558,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/pkg/manifests/system-test-ostest.mf","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/test/os-tests/runfiles/default.run","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"usr/src/test/os-tests/tests/Makefile","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"usr/src/test/os-tests/tests/i386/Makefile","type":"ADDED","insertions":46,"deletions":0},{"file":"usr/src/test/os-tests/tests/i386/ldt.c","type":"ADDED","insertions":80,"deletions":0},{"file":"usr/src/test/test-runner/cmd/run","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"usr/src/uts/common/sys/proc.h","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/uts/i86pc/ml/offsets.in","type":"MODIFIED","insertions":0,"deletions":-2},{"file":"usr/src/uts/i86pc/os/mlsetup.c","type":"MODIFIED","insertions":0,"deletions":-5},{"file":"usr/src/uts/i86pc/os/mp_startup.c","type":"MODIFIED","insertions":2,"deletions":-4},{"file":"usr/src/uts/intel/ia32/os/sysi86.c","type":"MODIFIED","insertions":50,"deletions":-71},{"file":"usr/src/uts/intel/sys/x86_archext.h","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":203,"sizeDeletions":-91},{"number":"8","revision":"98282a43be446fea560a712d49589cb4700c45dc","parents":["76d673bac97855d00448cd767b6f3439f4be8d12"],"ref":"refs/changes/44/4144/8","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1528799453,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/pkg/manifests/system-test-ostest.mf","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/test/os-tests/runfiles/default.run","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"usr/src/test/os-tests/tests/Makefile","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"usr/src/test/os-tests/tests/i386/Makefile","type":"ADDED","insertions":46,"deletions":0},{"file":"usr/src/test/os-tests/tests/i386/ldt.c","type":"ADDED","insertions":80,"deletions":0},{"file":"usr/src/test/test-runner/cmd/run","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"usr/src/uts/common/sys/proc.h","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/uts/i86pc/ml/offsets.in","type":"MODIFIED","insertions":0,"deletions":-2},{"file":"usr/src/uts/i86pc/os/mlsetup.c","type":"MODIFIED","insertions":0,"deletions":-5},{"file":"usr/src/uts/i86pc/os/mp_startup.c","type":"MODIFIED","insertions":2,"deletions":-4},{"file":"usr/src/uts/intel/ia32/os/sysi86.c","type":"MODIFIED","insertions":50,"deletions":-71},{"file":"usr/src/uts/intel/sys/x86_archext.h","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":203,"sizeDeletions":-91},{"number":"9","revision":"1129c96bcfa7fb7af78dc3fe3b1ecfdcbec10174","parents":["6ef09a959366317e841f19565e06a536c6e88a49"],"ref":"refs/changes/44/4144/9","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1528811057,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1528825590,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/pkg/manifests/system-test-ostest.mf","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/test/os-tests/runfiles/default.run","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"usr/src/test/os-tests/tests/Makefile","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"usr/src/test/os-tests/tests/i386/Makefile","type":"ADDED","insertions":46,"deletions":0},{"file":"usr/src/test/os-tests/tests/i386/ldt.c","type":"ADDED","insertions":80,"deletions":0},{"file":"usr/src/test/test-runner/cmd/run","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"usr/src/uts/common/sys/proc.h","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/uts/i86pc/ml/offsets.in","type":"MODIFIED","insertions":0,"deletions":-2},{"file":"usr/src/uts/i86pc/os/mlsetup.c","type":"MODIFIED","insertions":0,"deletions":-5},{"file":"usr/src/uts/i86pc/os/mp_startup.c","type":"MODIFIED","insertions":2,"deletions":-4},{"file":"usr/src/uts/intel/ia32/os/sysi86.c","type":"MODIFIED","insertions":50,"deletions":-71},{"file":"usr/src/uts/intel/sys/x86_archext.h","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":203,"sizeDeletions":-91},{"number":"10","revision":"14441ea9aba00018242f6949f3891d96ec8b3b38","parents":["f7d0086cff41f34796511cdbb454eedbaa8ee9c8"],"ref":"refs/changes/44/4144/10","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1528892412,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1528825590,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1528929807,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1528929807,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1528929621,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1528929621,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/pkg/manifests/system-test-ostest.mf","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/test/os-tests/runfiles/default.run","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"usr/src/test/os-tests/tests/Makefile","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"usr/src/test/os-tests/tests/i386/Makefile","type":"ADDED","insertions":46,"deletions":0},{"file":"usr/src/test/os-tests/tests/i386/ldt.c","type":"ADDED","insertions":80,"deletions":0},{"file":"usr/src/test/test-runner/cmd/run","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"usr/src/uts/common/sys/proc.h","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/uts/i86pc/ml/offsets.in","type":"MODIFIED","insertions":0,"deletions":-2},{"file":"usr/src/uts/i86pc/os/mlsetup.c","type":"MODIFIED","insertions":0,"deletions":-5},{"file":"usr/src/uts/i86pc/os/mp_startup.c","type":"MODIFIED","insertions":2,"deletions":-4},{"file":"usr/src/uts/intel/ia32/os/sysi86.c","type":"MODIFIED","insertions":50,"deletions":-71},{"file":"usr/src/uts/intel/sys/x86_archext.h","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":203,"sizeDeletions":-91},{"number":"11","revision":"a9e7867427d3c7bd2d3bb998eeedabea50a80d38","parents":["f48e1a4f1d835afe9a2607058270907434313e19"],"ref":"refs/changes/44/4144/11","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1528929803,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1528825590,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1528929807,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1528929807,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1528929621,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1528929621,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/pkg/manifests/system-test-ostest.mf","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/test/os-tests/runfiles/default.run","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"usr/src/test/os-tests/tests/Makefile","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"usr/src/test/os-tests/tests/i386/Makefile","type":"ADDED","insertions":46,"deletions":0},{"file":"usr/src/test/os-tests/tests/i386/ldt.c","type":"ADDED","insertions":80,"deletions":0},{"file":"usr/src/test/test-runner/cmd/run","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"usr/src/uts/common/sys/proc.h","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/uts/i86pc/ml/offsets.in","type":"MODIFIED","insertions":0,"deletions":-2},{"file":"usr/src/uts/i86pc/os/mlsetup.c","type":"MODIFIED","insertions":0,"deletions":-5},{"file":"usr/src/uts/i86pc/os/mp_startup.c","type":"MODIFIED","insertions":2,"deletions":-4},{"file":"usr/src/uts/intel/ia32/os/sysi86.c","type":"MODIFIED","insertions":50,"deletions":-71},{"file":"usr/src/uts/intel/sys/x86_archext.h","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":203,"sizeDeletions":-91},{"number":"12","revision":"8118caaf6ac0df6a54351bfd800aea92a6ac3cca","parents":["f48e1a4f1d835afe9a2607058270907434313e19"],"ref":"refs/changes/44/4144/12","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1528930450,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1528825590,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1528929807,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1528929807,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1528929621,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1528929621,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"SUBM","value":"1","grantedOn":1528930545,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":12,"deletions":0},{"file":"usr/src/pkg/manifests/system-test-ostest.mf","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/test/os-tests/runfiles/default.run","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"usr/src/test/os-tests/tests/Makefile","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"usr/src/test/os-tests/tests/i386/Makefile","type":"ADDED","insertions":46,"deletions":0},{"file":"usr/src/test/os-tests/tests/i386/ldt.c","type":"ADDED","insertions":80,"deletions":0},{"file":"usr/src/test/test-runner/cmd/run","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"usr/src/uts/common/sys/proc.h","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/uts/i86pc/ml/offsets.in","type":"MODIFIED","insertions":0,"deletions":-2},{"file":"usr/src/uts/i86pc/os/mlsetup.c","type":"MODIFIED","insertions":0,"deletions":-5},{"file":"usr/src/uts/i86pc/os/mp_startup.c","type":"MODIFIED","insertions":2,"deletions":-4},{"file":"usr/src/uts/intel/ia32/os/sysi86.c","type":"MODIFIED","insertions":50,"deletions":-71},{"file":"usr/src/uts/intel/sys/x86_archext.h","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":203,"sizeDeletions":-91}],"allReviewers":[{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}]}