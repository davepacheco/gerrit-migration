{"project":"joyent/node-manta","branch":"master","id":"I0d1bdfa360a55e773a254a0e5e07930fa84de90d","number":"3107","subject":"joyent/node-manta#301 Add an option to  that will upload a file using the Manta multipart upload API","owner":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"url":"https://cr.joyent.us/3107","commitMessage":"joyent/node-manta#301 Add an option to  that will upload a file using the Manta multipart upload API\n","createdOn":1513200146,"lastUpdated":1516900564,"open":true,"status":"NEW","comments":[{"timestamp":1513200146,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Uploaded patch set 1."},{"timestamp":1513200170,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing-1\n\n(18 comments)\n\n\"make check\" exited with status 2"},{"timestamp":1513200841,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Uploaded patch set 2."},{"timestamp":1513200867,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1513208801,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Uploaded patch set 3."},{"timestamp":1513208828,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1513209572,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Uploaded patch set 4."},{"timestamp":1513209598,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1513365096,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Uploaded patch set 5."},{"timestamp":1513365121,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing-1\n\n(2 comments)\n\n\"make check\" exited with status 2"},{"timestamp":1513365335,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Uploaded patch set 6."},{"timestamp":1513365397,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 6: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1514916292,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Patch Set 6:\n\n(13 comments)\n\nThanks for taking this on! Sorry for the delay getting to reviewing it.\n\nOut of curiosity, was there a reason you wanted to do this under `mmpu` (instead of `mput` as I suggested in the ticket)? I think it could make sense under either command, but just wanted to know what your thoughts were."},{"timestamp":1514932630,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Uploaded patch set 7."},{"timestamp":1514932639,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Patch Set 7:\n\n(7 comments)"},{"timestamp":1514932657,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 7: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1515717574,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Patch Set 7:\n\nPS 6 looks good! I have a few comments from the first round of review I don\u0027t see responses on -- I wasn\u0027t sure if you were working on feedback for those or not.\n\nThanks again for doing this!"},{"timestamp":1515781195,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Patch Set 7:\n\n(5 comments)"},{"timestamp":1515785628,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Uploaded patch set 8."},{"timestamp":1515785653,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 8: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1515794424,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Uploaded patch set 9."},{"timestamp":1515794450,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 9: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1516644425,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Patch Set 9:\n\n(9 comments)"},{"timestamp":1516663813,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Uploaded patch set 10."},{"timestamp":1516663840,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 10: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1516663920,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Patch Set 10:\n\n(9 comments)"},{"timestamp":1516900564,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Patch Set 10:\n\n(5 comments)"}],"currentPatchSet":{"number":"10","revision":"0d1bdfa360a55e773a254a0e5e07930fa84de90d","parents":["db26e1bc598de7e9b1fc20649f03cf9d2b4bc272"],"ref":"refs/changes/07/3107/10","uploader":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"createdOn":1516663813,"author":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1516663840,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"bin/mmpu","line":593,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"I think this should probably be logged to stderr. Same with the other warning(s)."},{"file":"bin/mmpu","line":672,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"I think cmdln will print the error for you if it\u0027s passed to the callback, as it is here."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"bin/mmpu","type":"MODIFIED","insertions":259,"deletions":-1},{"file":"test/mmpu.test.js","type":"MODIFIED","insertions":105,"deletions":-2}],"sizeInsertions":364,"sizeDeletions":-3},"patchSets":[{"number":"1","revision":"31289d4fbde0f6c20a3485994442540100d23638","parents":["db26e1bc598de7e9b1fc20649f03cf9d2b4bc272"],"ref":"refs/changes/07/3107/1","uploader":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"createdOn":1513200146,"author":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1513200170,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"bin/mmpu","line":515,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"warning: identifer ctx hides an identifier in a parent scope"},{"file":"bin/mmpu","line":517,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"warning: identifer filename hides an identifier in a parent scope"},{"file":"bin/mmpu","line":524,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"warning: undeclared identifier: size"},{"file":"bin/mmpu","line":529,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"warning: undeclared identifier: size"},{"file":"bin/mmpu","line":529,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"warning: undeclared identifier: size"},{"file":"bin/mmpu","line":535,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"warning: empty statement or extra semicolon"},{"file":"bin/mmpu","line":537,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"warning: identifer ctx hides an identifier in a parent scope"},{"file":"bin/mmpu","line":560,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"warning: identifer ctx hides an identifier in a parent scope"},{"file":"bin/mmpu","line":562,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"warning: undeclared identifier: parts"},{"file":"bin/mmpu","line":565,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"warning: undeclared identifier: funcs"},{"file":"bin/mmpu","line":569,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"warning: undeclared identifier: upload_part"},{"file":"bin/mmpu","line":569,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"warning: identifer callback hides an identifier in a parent scope"},{"file":"bin/mmpu","line":581,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"warning: undeclared identifier: upload_part"},{"file":"bin/mmpu","line":581,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"warning: undeclared identifier: funcs"},{"file":"bin/mmpu","line":584,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"warning: undeclared identifier: funcs"},{"file":"bin/mmpu","line":592,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"warning: empty statement or extra semicolon"},{"file":"bin/mmpu","line":594,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"warning: identifer ctx hides an identifier in a parent scope"},{"file":"bin/mmpu","line":609,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"warning: empty statement or extra semicolon"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"bin/mmpu","type":"MODIFIED","insertions":223,"deletions":0}],"sizeInsertions":223,"sizeDeletions":0},{"number":"2","revision":"244b34fabe6128fa0cf7076b8bf4cbb5aaa00302","parents":["db26e1bc598de7e9b1fc20649f03cf9d2b4bc272"],"ref":"refs/changes/07/3107/2","uploader":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"createdOn":1513200841,"author":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1513200867,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"bin/mmpu","type":"MODIFIED","insertions":213,"deletions":0}],"sizeInsertions":213,"sizeDeletions":0},{"number":"3","revision":"da3cc08f15b581591d711910d931142023635227","parents":["db26e1bc598de7e9b1fc20649f03cf9d2b4bc272"],"ref":"refs/changes/07/3107/3","uploader":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"createdOn":1513208801,"author":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1513208828,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"bin/mmpu","type":"MODIFIED","insertions":214,"deletions":-2}],"sizeInsertions":214,"sizeDeletions":-2},{"number":"4","revision":"665ecf145a156f0ded54da95a72b5010677f738b","parents":["db26e1bc598de7e9b1fc20649f03cf9d2b4bc272"],"ref":"refs/changes/07/3107/4","uploader":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"createdOn":1513209572,"author":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1513209598,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"bin/mmpu","line":272,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"This seems like an unintentional deletion."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"bin/mmpu","type":"MODIFIED","insertions":215,"deletions":-2}],"sizeInsertions":215,"sizeDeletions":-2},{"number":"5","revision":"cefd7c17644fc12a0a336cfd1a890a75f506e178","parents":["db26e1bc598de7e9b1fc20649f03cf9d2b4bc272"],"ref":"refs/changes/07/3107/5","uploader":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"createdOn":1513365096,"author":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1513365121,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"test/mmpu.test.js","line":683,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"warning: variable is declared but never referenced: largeFileMd5Digest"},{"file":"test/mmpu.test.js","line":683,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"warning: missing semicolon"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"bin/mmpu","type":"MODIFIED","insertions":215,"deletions":-2},{"file":"test/mmpu.test.js","type":"MODIFIED","insertions":107,"deletions":-2}],"sizeInsertions":322,"sizeDeletions":-4},{"number":"6","revision":"25d1fedd70bc2f18f20d0a9d176ebff9ed7ea3cd","parents":["db26e1bc598de7e9b1fc20649f03cf9d2b4bc272"],"ref":"refs/changes/07/3107/6","uploader":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"createdOn":1513365335,"author":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1513365397,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"bin/mmpu","line":272,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"This seems unintentional."},{"file":"bin/mmpu","line":272,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"indeed. I probably accidentally stripped it out when I pulled some other debugging out. thanks!"},{"file":"bin/mmpu","line":541,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"As I noted below, I think we would probably want the program to calculate this for the user."},{"file":"bin/mmpu","line":541,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"sure! I didn\u0027t realize I was doing this wrong. So by re-ordering the steps in the pipeline below (calling splitFile first) I think we get this \"for free.\""},{"file":"bin/mmpu","line":547,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"If you get an error from create-mpu, it\u0027s expected that you don\u0027t need to abort the MPU (because it doesn\u0027t exist)."},{"file":"bin/mmpu","line":547,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"great!"},{"file":"bin/mmpu","line":564,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"This is tricky. To deal with transient errors, I think we would want retry uploading some reasonable number of times, like `mput` does. In the case of a non-transient error, I think we would probably want to let the user deal with it. If, for instance, all but 1 parts of a large file uploaded successfully, it would be inconvenient of the program aborted the MPU. On the other hand, as it is now, I think it would be difficult to retry the upload by hand as a user, since you would need to manually split the file based on which parts failed.\n\nWhat do you think about having an option to retry uploading parts for a given MPU ID? A really basic implementation would do the entire split/upload process again, only without initiating the MPU. (This could be under another ticket too.)"},{"file":"bin/mmpu","line":564,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"the retries make sense to me, I\u0027ll try to put something together which does that."},{"file":"bin/mmpu","line":574,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Would it be better to use the vasync.parallel construct here, so we can upload many parts at once?"},{"file":"bin/mmpu","line":574,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"I guess I assumed we\u0027d be I/O bound, so didn\u0027t see the advantage. but sure!"},{"file":"bin/mmpu","line":593,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"I think my comments on the similar situation in doUploads() apply here, too."},{"file":"bin/mmpu","line":593,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"this one is maybe tricker, and depends on what the nature of the failure is. I\u0027ll have to think about it a bit."},{"file":"bin/mmpu","line":625,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"I think we need to close the client and invoke the callback in either case, right?"},{"file":"bin/mmpu","line":625,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"that sounds right to me."},{"file":"bin/mmpu","line":653,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"It seems like this option wouldn\u0027t be needed since the program can stat the file."},{"file":"bin/mmpu","line":653,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Done"},{"file":"bin/mmpu","line":659,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Would it be better to call this something like \"PARTSIZE\" to better mirror the API terminology? Or is that confusing?"},{"file":"bin/mmpu","line":659,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Done"},{"file":"bin/mmpu","line":669,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"`mput` has an option to calculate the MD5 for the user. I think that\u0027s probably what we would want to do here, too. What do you think?"},{"file":"bin/mmpu","line":669,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"ah, I was mirroring the API of the mmpu-create call; but your suggestion makes more sense.\n\nI\u0027ll make this a boolean and do the calculation (and will upate this help text)."},{"file":"bin/mmpu","line":680,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"I think I would do a more use-case oriented summary here. Something like:\n\n\"Given a local file and a path in Manta, upload the file to Manta as a multipart upload.\""},{"file":"bin/mmpu","line":680,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Done"},{"file":"bin/mmpu","line":685,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"s/mpu/mmpu"},{"file":"bin/mmpu","line":685,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"bin/mmpu","type":"MODIFIED","insertions":215,"deletions":-2},{"file":"test/mmpu.test.js","type":"MODIFIED","insertions":105,"deletions":-2}],"sizeInsertions":320,"sizeDeletions":-4},{"number":"7","revision":"528cdd9154211577d601779062f4d9c3dafbf755","parents":["db26e1bc598de7e9b1fc20649f03cf9d2b4bc272"],"ref":"refs/changes/07/3107/7","uploader":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"createdOn":1514932630,"author":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1514932657,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"bin/mmpu","type":"MODIFIED","insertions":211,"deletions":-1},{"file":"test/mmpu.test.js","type":"MODIFIED","insertions":105,"deletions":-2}],"sizeInsertions":316,"sizeDeletions":-3},{"number":"8","revision":"f9b4fc5991033bf773cd08e6dd0351124eb6c643","parents":["db26e1bc598de7e9b1fc20649f03cf9d2b4bc272"],"ref":"refs/changes/07/3107/8","uploader":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"createdOn":1515785628,"author":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1515785653,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"bin/mmpu","type":"MODIFIED","insertions":211,"deletions":-1},{"file":"test/mmpu.test.js","type":"MODIFIED","insertions":105,"deletions":-2}],"sizeInsertions":316,"sizeDeletions":-3},{"number":"9","revision":"e3e028eb1ecfbaa93f867c1221cb7168a5e9c2ae","parents":["db26e1bc598de7e9b1fc20649f03cf9d2b4bc272"],"ref":"refs/changes/07/3107/9","uploader":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"createdOn":1515794424,"author":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1515794450,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"bin/mmpu","line":496,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"nit: pull this code into a helper function (since do_create uses it as well)?"},{"file":"bin/mmpu","line":496,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"that somewhat breaks the parallel structure (all of the commands in this file have quite similar pre-ambles), and is not super-great looking when the error-callback stuff is added in. I\u0027ll try."},{"file":"bin/mmpu","line":496,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Sure. It\u0027s not a big deal if it\u0027s not easy to do."},{"file":"bin/mmpu","line":546,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"nit: I like to use brackets for if/else blocks to improve readability."},{"file":"bin/mmpu","line":546,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"sure. I\u0027ll fix all similar occurrences. I prefer the braces, but BSD KNF requires their *absence*, so I\u0027ve been trying to do it their way."},{"file":"bin/mmpu","line":546,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Hah. I think I\u0027ve just been bitten by one too many \"forgot to add brackets when adding code to an else block\" bugs!"},{"file":"bin/mmpu","line":562,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Assert that `ctx.calculatedMd5` exists in this case?"},{"file":"bin/mmpu","line":562,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Done"},{"file":"bin/mmpu","line":585,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Let\u0027s print a warning in this case notifying the user they may want to abort the MPU?"},{"file":"bin/mmpu","line":585,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Done"},{"file":"bin/mmpu","line":586,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Should we be calling partCallback here?"},{"file":"bin/mmpu","line":586,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"yes, thanks."},{"file":"bin/mmpu","line":595,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Should this be a `vasync.parallel` call?"},{"file":"bin/mmpu","line":595,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"it isn\u0027t clear to me that that\u0027s better or necessary. Is it ?"},{"file":"bin/mmpu","line":595,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"I\u0027m not sure how it would make it worse, and I assumed it would be the same level of code complexity to change it. But I haven\u0027t measured it, so I could be wrong."},{"file":"bin/mmpu","line":615,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"I would probably print a warning here telling the user they might want to abort the MPU if it can\u0027t be retried."},{"file":"bin/mmpu","line":615,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Done"},{"file":"bin/mmpu","line":693,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"\"Manta\""},{"file":"bin/mmpu","line":693,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Done"},{"file":"bin/mmpu","line":699,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"The \"--md5\" option differs for `mmpu create` and `mmpu put`."},{"file":"bin/mmpu","line":699,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"bin/mmpu","type":"MODIFIED","insertions":229,"deletions":-1},{"file":"test/mmpu.test.js","type":"MODIFIED","insertions":105,"deletions":-2}],"sizeInsertions":334,"sizeDeletions":-3},{"number":"10","revision":"0d1bdfa360a55e773a254a0e5e07930fa84de90d","parents":["db26e1bc598de7e9b1fc20649f03cf9d2b4bc272"],"ref":"refs/changes/07/3107/10","uploader":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"createdOn":1516663813,"author":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1516663840,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"bin/mmpu","line":593,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"I think this should probably be logged to stderr. Same with the other warning(s)."},{"file":"bin/mmpu","line":672,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"I think cmdln will print the error for you if it\u0027s passed to the callback, as it is here."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"bin/mmpu","type":"MODIFIED","insertions":259,"deletions":-1},{"file":"test/mmpu.test.js","type":"MODIFIED","insertions":105,"deletions":-2}],"sizeInsertions":364,"sizeDeletions":-3}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"}]}