From b3af29da2393c547762b2f58415399591ba7a450 Mon Sep 17 00:00:00 2001
From: Jason King <jason.king@joyent.com>
Date: Tue, 12 Jun 2018 15:36:06 -0500
Subject: [PATCH] fix overlay_ip_avl

---
 usr/src/uts/common/io/overlay/overlay_target.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/usr/src/uts/common/io/overlay/overlay_target.c b/usr/src/uts/common/io/overlay/overlay_target.c
index e4bf78bd41..1584e912a1 100644
--- a/usr/src/uts/common/io/overlay/overlay_target.c
+++ b/usr/src/uts/common/io/overlay/overlay_target.c
@@ -252,10 +252,10 @@ overlay_ip_avl(const void *a, const void *b)
 
 	if ((ret = memcmp(&l_vl3->otvl3_src, &r_vl3->otvl3_src,
 	    sizeof (l_vl3->otvl3_src))) != 0)
-		return (ret);
+		return (ret < 0 ? -1 : 1);
 	if ((ret = memcmp(&l_vl3->otvl3_dst, &r_vl3->otvl3_dst,
 	    sizeof (l_vl3->otvl3_dst))) != 0)
-		return (ret);
+		return (ret < 0 ? -1 : 1);
 	if (l_vl3->otvl3_src_vlan < r_vl3->otvl3_src_vlan)
 		return (-1);
 	if (l_vl3->otvl3_src_vlan > r_vl3->otvl3_src_vlan)
-- 
2.21.0

