{"project":"joyent/sdcadm","branch":"master","id":"I46ca60efb1ff540f109407bfc7f95bd7be8cc576","number":"6457","subject":"TRITON-1696 sdcadm should verify that triton_cns_enabled is set for the admin user before deploying prometheus Reviewed by: Trent Mick \u003ctrentm@gmail.com\u003e Approved by: Trent Mick \u003ctrentm@gmail.com\u003e","owner":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"url":"https://cr.joyent.us/6457","commitMessage":"TRITON-1696 sdcadm should verify that triton_cns_enabled is set for the admin user before deploying prometheus\nReviewed by: Trent Mick \u003ctrentm@gmail.com\u003e\nApproved by: Trent Mick \u003ctrentm@gmail.com\u003e\n","createdOn":1560809669,"lastUpdated":1560812420,"open":false,"status":"MERGED","comments":[{"timestamp":1560809669,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Uploaded patch set 1."},{"timestamp":1560809709,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1560809764,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Uploaded patch set 2: Commit message was updated."},{"timestamp":1560809890,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Uploaded patch set 3."},{"timestamp":1560809928,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1560810381,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 3:\n\n(3 comments)\n\nA ver bump for this change would be good as well."},{"timestamp":1560811643,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Uploaded patch set 4."},{"timestamp":1560811687,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1560811739,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Patch Set 4:\n\n(2 comments)\n\nRan through testing notes with new patchset."},{"timestamp":1560811955,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 4: Code-Review+1 Integration-Approval+1"},{"timestamp":1560812417,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Patch Set 5: Commit message was updated."},{"timestamp":1560812420,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Isaac Davis"}],"currentPatchSet":{"number":"5","revision":"b576aba4b1fe08b7c8f6f7e33044937c99cb46c7","parents":["735d265d796dfd1bc25a1c7fa06cfc3907bedbc6"],"ref":"refs/changes/57/6457/5","uploader":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"createdOn":1560812417,"author":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1560811687,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1560811955,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1560811955,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1560812420,"by":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":5,"deletions":0},{"file":"lib/post-setup/prometheus.js","type":"MODIFIED","insertions":46,"deletions":-7},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":52,"sizeDeletions":-8},"patchSets":[{"number":"1","revision":"24b04af39bc240710e72572cb97788afa547b83e","parents":["735d265d796dfd1bc25a1c7fa06cfc3907bedbc6"],"ref":"refs/changes/57/6457/1","uploader":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"createdOn":1560809669,"author":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1560809709,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/post-setup/prometheus.js","type":"MODIFIED","insertions":55,"deletions":-7}],"sizeInsertions":55,"sizeDeletions":-7},{"number":"2","revision":"f8a8714b41aa14ec330f7748a66e680e2eae66d2","parents":["735d265d796dfd1bc25a1c7fa06cfc3907bedbc6"],"ref":"refs/changes/57/6457/2","uploader":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"createdOn":1560809764,"author":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1560809709,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/post-setup/prometheus.js","type":"MODIFIED","insertions":55,"deletions":-7}],"sizeInsertions":55,"sizeDeletions":-7},{"number":"3","revision":"cbfdd06dd13bb140ca0b2ebc867b26ff782cd0a8","parents":["735d265d796dfd1bc25a1c7fa06cfc3907bedbc6"],"ref":"refs/changes/57/6457/3","uploader":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"createdOn":1560809890,"author":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1560809928,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/post-setup/prometheus.js","line":90,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"From the node-ufds code:\n\n```\n/**\n * Looks up a user by login to UFDS.\n *\n * This function is extremely imprecise and should not be used.  In\n * particular, the function will return an account where \"login\" matches\n * _either_ the UUID _or_ the login field.  Callers should be explicit about\n * the type of identifier used in a lookup, which is possible via the\n * improved \"getUserEx()\" method.\n *\n * @param {String} login (or uuid) for a customer.\n * @param {String} (Optional) account uuid for a customer sub-user.\n * @param {Function} callback of the form f(err, user).\n * @throws {TypeError} on bad input.\n */\nUFDS.prototype.getUser \u003d function getUser(login, account, cb, noCache) {\n```\n\nThere is a getUserEx that should be slightly better."},{"file":"lib/post-setup/prometheus.js","line":90,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Done -- switched to lookup by uuid as well."},{"file":"lib/post-setup/prometheus.js","line":106,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Yah, this whole sdcadm.ufds object thing is lame."},{"file":"lib/post-setup/prometheus.js","line":122,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Use https://github.com/joyent/node-verror#verrorerrorfromlisterrors"},{"file":"lib/post-setup/prometheus.js","line":122,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"This is exactly what I needed -- done."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/post-setup/prometheus.js","type":"MODIFIED","insertions":55,"deletions":-7}],"sizeInsertions":55,"sizeDeletions":-7},{"number":"4","revision":"46ca60efb1ff540f109407bfc7f95bd7be8cc576","parents":["735d265d796dfd1bc25a1c7fa06cfc3907bedbc6"],"ref":"refs/changes/57/6457/4","uploader":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"createdOn":1560811643,"author":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1560811687,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1560811955,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1560811955,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":5,"deletions":0},{"file":"lib/post-setup/prometheus.js","type":"MODIFIED","insertions":46,"deletions":-7},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":52,"sizeDeletions":-8},{"number":"5","revision":"b576aba4b1fe08b7c8f6f7e33044937c99cb46c7","parents":["735d265d796dfd1bc25a1c7fa06cfc3907bedbc6"],"ref":"refs/changes/57/6457/5","uploader":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"createdOn":1560812417,"author":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1560811687,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1560811955,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1560811955,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1560812420,"by":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":5,"deletions":0},{"file":"lib/post-setup/prometheus.js","type":"MODIFIED","insertions":46,"deletions":-7},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":52,"sizeDeletions":-8}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"}]}