commit a27783a812de76bdd6084cd9baf187e50ef1d6d5 (refs/changes/40/340/1)
Author: Josh Wilsdon <jwilsdon@joyent.com>
Date:   2016-08-24T12:26:02-07:00 (3 years, 1 month ago)
    
    OS-5618 vmadm should only write what it read

diff --git a/src/vm/node_modules/VM.js b/src/vm/node_modules/VM.js
index c85ed286..bd361429 100644
--- a/src/vm/node_modules/VM.js
+++ b/src/vm/node_modules/VM.js
@@ -6677,9 +6677,10 @@ exports.markVMFailure = function (vmobj, options, callback)
                     fs.read(fd, buffer, 0, 4096, startpos,
                         function (read_err, bytesRead, buff) {
 
-                        log.info({'zoneinit_log': buff.toString()},
-                            'data from ' + zoneinit_log + ' ('
-                            + startpos + '/' + stats.size + ')');
+                        log.info({
+                            'zoneinit_log': buff.toString('utf8', 0, bytesRead)
+                        }, 'data from ' + zoneinit_log + ' (' + startpos + '/'
+                            + stats.size + ')');
 
                         startpos += bytesRead;
                         cb();
