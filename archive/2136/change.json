{"project":"joyent/sdc-cloudapi","branch":"master","id":"Ib4e03f3c033ea8f0336ca2c9419510286b9668a9","number":"2136","subject":"PUBAPI-1405: GetConfig fails if the account doesn\u0027t yet have a dclocalconfig Reviewed by: Julien Gilli \u003cjulien.gilli@joyent.com\u003e","owner":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"url":"https://cr.joyent.us/2136","commitMessage":"PUBAPI-1405: GetConfig fails if the account doesn\u0027t yet have a dclocalconfig\nReviewed by: Julien Gilli \u003cjulien.gilli@joyent.com\u003e\n","createdOn":1498133431,"lastUpdated":1499204009,"open":false,"status":"MERGED","comments":[{"timestamp":1498133431,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Uploaded patch set 1."},{"timestamp":1498154215,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1498595532,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 1:\n\n(1 comment)\n\nDoes that fix the UpdateConfig use case described in the ticket? If so, how?\nIt would be great if that change came with tests for both use cases mentioned in the ticket."},{"timestamp":1498606901,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 1:\n\n(1 comment)\n\n\u003e Does that fix the UpdateConfig use case described in the ticket?\n\nNope. See my comment in the ticket why."},{"timestamp":1498732421,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Uploaded patch set 2."},{"timestamp":1498732466,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1498749211,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 2:\n\n(4 comments)"},{"timestamp":1498766843,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1498769054,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1498770547,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Uploaded patch set 3."},{"timestamp":1498773967,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1498785184,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1498826134,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Uploaded patch set 4."},{"timestamp":1498826163,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1498837529,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 4:\n\n(1 comment)"},{"timestamp":1498861747,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 4:\n\n(1 comment)"},{"timestamp":1499197153,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Uploaded patch set 5."},{"timestamp":1499197187,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1499201353,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 5: Code-Review+1"},{"timestamp":1499201384,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 5:\n\nShould the version number be bumped in package.json? I don\u0027t know if that\u0027s used anywhere."},{"timestamp":1499204006,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 5: Integration-Approval+1"},{"timestamp":1499204009,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Marsell Kukuljevic"}],"currentPatchSet":{"number":"5","revision":"b4e03f3c033ea8f0336ca2c9419510286b9668a9","parents":["1bc3c1eeb59eae6ca71a0717523de47b48b6767a"],"ref":"refs/changes/36/2136/5","uploader":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"createdOn":1499197153,"author":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1499197187,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1499201353,"by":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1499204006,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}},{"type":"SUBM","value":"1","grantedOn":1499204009,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":1,"deletions":0},{"file":"lib/config.js","type":"MODIFIED","insertions":17,"deletions":-3},{"file":"test/common.js","type":"MODIFIED","insertions":42,"deletions":0},{"file":"test/fabrics.test.js","type":"MODIFIED","insertions":105,"deletions":-1}],"sizeInsertions":165,"sizeDeletions":-4},"patchSets":[{"number":"1","revision":"84e2674e937814b7b230a4aadc7edbb39158fda2","parents":["1bc3c1eeb59eae6ca71a0717523de47b48b6767a"],"ref":"refs/changes/36/2136/1","uploader":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"createdOn":1498133431,"author":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1498154215,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/config.js","line":140,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"nit: I find the term \"empty hash\" to be a bit confusing. Do you mean an empty object?"},{"file":"lib/config.js","line":140,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Yes."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/config.js","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"test/common.js","type":"MODIFIED","insertions":41,"deletions":0}],"sizeInsertions":46,"sizeDeletions":-1},{"number":"2","revision":"fd3c2cc36b8ad148f6318cceb7bf0a93ec5fb7d3","parents":["1bc3c1eeb59eae6ca71a0717523de47b48b6767a"],"ref":"refs/changes/36/2136/2","uploader":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"createdOn":1498732421,"author":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1498732466,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"docs/index.md","line":803,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Maybe keep that \"Resource is unavailable, but is expected to return\" on the same line as the current \"503\" like:\n\n\"Either there\u0027s no capacity in this datacenter, it\u0027s in a maintenance window, or the resource is unavailable but is expected to return\"\n\n?"},{"file":"docs/index.md","line":803,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"I could do that, but the code field in the returned error object are both different (ie. \"RetryLater\" and \"ServiceUnavailable\"). I\u0027m not sure if that matters here though?"},{"file":"docs/index.md","line":803,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Ah right, that\u0027s fine then."},{"file":"lib/config.js","line":116,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Maybe add a comment here describing that we expect the resource to be created eventually by napi-ufds-watcher?"},{"file":"lib/config.js","line":117,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"nit: \"retry in 10s\" seems a bit too specific. Maybe just \"Config currently unavailable\" is enough, and the 503 status code is enough to convey that it should be available eventually?"},{"file":"lib/errors.js","line":206,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Typo in \"unavailabe\"."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":1,"deletions":0},{"file":"lib/config.js","type":"MODIFIED","insertions":13,"deletions":-3},{"file":"lib/errors.js","type":"MODIFIED","insertions":14,"deletions":0},{"file":"test/common.js","type":"MODIFIED","insertions":41,"deletions":0}],"sizeInsertions":69,"sizeDeletions":-3},{"number":"3","revision":"744abea72c9e15a0dcb6133cd5fd0631c896a850","parents":["1bc3c1eeb59eae6ca71a0717523de47b48b6767a"],"ref":"refs/changes/36/2136/3","uploader":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"createdOn":1498770547,"author":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1498785184,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1498773967,"by":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":1,"deletions":0},{"file":"lib/config.js","type":"MODIFIED","insertions":18,"deletions":-3},{"file":"lib/errors.js","type":"MODIFIED","insertions":14,"deletions":0},{"file":"test/common.js","type":"MODIFIED","insertions":41,"deletions":0}],"sizeInsertions":74,"sizeDeletions":-3},{"number":"4","revision":"a495f5019d88a733537fc18bc46c3f612bbf755f","parents":["1bc3c1eeb59eae6ca71a0717523de47b48b6767a"],"ref":"refs/changes/36/2136/4","uploader":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"createdOn":1498826134,"author":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1498826163,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"test/fabrics.test.js","line":234,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Should that be pollConfPresent?"},{"file":"test/fabrics.test.js","line":234,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Yaaaaargh! D:\n\nThanks for catching that."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":1,"deletions":0},{"file":"lib/config.js","type":"MODIFIED","insertions":17,"deletions":-3},{"file":"test/common.js","type":"MODIFIED","insertions":42,"deletions":0},{"file":"test/fabrics.test.js","type":"MODIFIED","insertions":105,"deletions":-1}],"sizeInsertions":165,"sizeDeletions":-4},{"number":"5","revision":"b4e03f3c033ea8f0336ca2c9419510286b9668a9","parents":["1bc3c1eeb59eae6ca71a0717523de47b48b6767a"],"ref":"refs/changes/36/2136/5","uploader":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"createdOn":1499197153,"author":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1499197187,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1499201353,"by":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1499204006,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}},{"type":"SUBM","value":"1","grantedOn":1499204009,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":1,"deletions":0},{"file":"lib/config.js","type":"MODIFIED","insertions":17,"deletions":-3},{"file":"test/common.js","type":"MODIFIED","insertions":42,"deletions":0},{"file":"test/fabrics.test.js","type":"MODIFIED","insertions":105,"deletions":-1}],"sizeInsertions":165,"sizeDeletions":-4}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}]}