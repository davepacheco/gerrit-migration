{"project":"joyent/registrar","branch":"master","topic":"3223","id":"Ic7f03167e1f2789235838e802c2eeb1567dd6196","number":"2826","subject":"MANTA-3223 Registrar should stop relying on node-zkplus","owner":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"url":"https://cr.joyent.us/2826","commitMessage":"MANTA-3223 Registrar should stop relying on node-zkplus\n","createdOn":1508456647,"lastUpdated":1515195992,"open":false,"status":"MERGED","comments":[{"timestamp":1508456647,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Uploaded patch set 1."},{"timestamp":1508456677,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1508456881,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Topic set to 3223"},{"timestamp":1508456961,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Uploaded patch set 2."},{"timestamp":1508456986,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1508548448,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 2:\n\n(4 comments)\n\nThe \"heartbeat()\" function should probably go away entirely. And after that the on(\u0027connect\u0027) handler inside zk.js can probably go away too, as well as patchClient(). The whole init process there probably needs some rethinking after that to simplify it -- all the retry logic is only making outages worse at this point, not solving anything, and there\u0027s too many layers of it."},{"timestamp":1508792585,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Uploaded patch set 3."},{"timestamp":1508792628,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1508794490,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Patch Set 3:\n\n(1 comment)"},{"timestamp":1511308984,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Uploaded patch set 4."},{"timestamp":1511309007,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1511309121,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Patch Set 4:\n\n(1 comment)"},{"timestamp":1512410144,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"Patch Set 4:\n\n(2 comments)"},{"timestamp":1512416677,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Patch Set 4:\n\n(1 comment)"},{"timestamp":1512416688,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Uploaded patch set 5."},{"timestamp":1512416711,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1512417211,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"Patch Set 4:\n\n(1 comment)"},{"timestamp":1512417233,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"Patch Set 5: Code-Review+1"},{"timestamp":1512427186,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 5:\n\n(4 comments)"},{"timestamp":1512434674,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Uploaded patch set 6."},{"timestamp":1512434708,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 6: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1512505153,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Patch Set 6:\n\n(3 comments)"},{"timestamp":1513001733,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"Patch Set 6: Code-Review+1"},{"timestamp":1513020248,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Uploaded patch set 7."},{"timestamp":1513020271,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 7: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1513022134,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 7:\n\n(2 comments)\n\nLooking good. Almost there, I reckon!"},{"timestamp":1513033947,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Patch Set 7:\n\n(2 comments)"},{"timestamp":1513033958,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Uploaded patch set 8."},{"timestamp":1513033981,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 8: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1513034287,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Uploaded patch set 9."},{"timestamp":1513034311,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 9: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1513045078,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Uploaded patch set 10."},{"timestamp":1513045101,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 10: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1513045663,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Uploaded patch set 11."},{"timestamp":1513045687,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 11: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1513113317,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 11:\n\n(1 comment)"},{"timestamp":1513297933,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Patch Set 11:\n\n(1 comment)"},{"timestamp":1513297945,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Uploaded patch set 12."},{"timestamp":1513298004,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 12:\n\n\"make check\" passed ok"},{"timestamp":1513299317,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 12: Code-Review+1"},{"timestamp":1513299452,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"Patch Set 12: Code-Review+1"},{"timestamp":1513635600,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 12:\n\n+1 for IA once joyent/node-zkstream#27 is merged and the dep version here updated"},{"timestamp":1513870442,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Uploaded patch set 13."},{"timestamp":1513870764,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Patch Set 13:\n\nThe latest patchset passes the tests I described in the jira ticket with the fix for joyent/node-zkstream#27."},{"timestamp":1513870770,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Patch Set 13:\n\nThe latest patchset passes the tests I described in the jira ticket with the fix for joyent/node-zkstream#27."},{"timestamp":1513879928,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Uploaded patch set 14."},{"timestamp":1513879952,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 14: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1513881817,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Uploaded patch set 15."},{"timestamp":1513881841,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 15: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1513885786,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 15: Code-Review+1\n\n(1 comment)"},{"timestamp":1513886978,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"Patch Set 15: Code-Review+1"},{"timestamp":1513914724,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Uploaded patch set 16."},{"timestamp":1513914748,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 16: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1513950441,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Uploaded patch set 17."},{"timestamp":1513950465,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 17: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1513952904,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"Patch Set 17: Code-Review+1"},{"timestamp":1513974612,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 17:\n\n(1 comment)"},{"timestamp":1513975320,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Uploaded patch set 18."},{"timestamp":1513975343,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 18: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1513976245,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Uploaded patch set 19."},{"timestamp":1513976269,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 19: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1514397653,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 19: Code-Review+1"},{"timestamp":1514397665,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 19: Integration-Approval+1"},{"timestamp":1514397719,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"Patch Set 19: Code-Review+1"},{"timestamp":1514494926,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Uploaded patch set 20."},{"timestamp":1514494950,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 20: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1514495093,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Patch Set 20:\n\nThe latest patchset contains some minor cleanup and unnecessary code removal. I\u0027ve run the tests I layed out in the ticket."},{"timestamp":1515092314,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 20:\n\n(1 comment)"},{"timestamp":1515108073,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Uploaded patch set 21."},{"timestamp":1515108097,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 21: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1515119251,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 21: Code-Review+1 Integration-Approval+1"},{"timestamp":1515129601,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"Patch Set 21: Code-Review+1"},{"timestamp":1515183067,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Uploaded patch set 22."},{"timestamp":1515183091,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 22: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1515195744,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 22: Code-Review+1 Integration-Approval+1"},{"timestamp":1515195992,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Jan Wyszynski"}],"currentPatchSet":{"number":"22","revision":"c7f03167e1f2789235838e802c2eeb1567dd6196","parents":["2c4b9a7db6b9a215e0fcd2ff6f16bde701673812"],"ref":"refs/changes/26/2826/22","uploader":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"createdOn":1515183067,"author":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1515183091,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1515195744,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1515195744,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"SUBM","value":"1","grantedOn":1515195992,"by":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/index.js","type":"MODIFIED","insertions":136,"deletions":-122},{"file":"lib/register.js","type":"MODIFIED","insertions":123,"deletions":-74},{"file":"lib/zk.js","type":"DELETED","insertions":0,"deletions":-135},{"file":"main.js","type":"MODIFIED","insertions":95,"deletions":-50},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":357,"sizeDeletions":-384},"patchSets":[{"number":"1","revision":"44e178370c6712499bcd9abfe3a0e427061e7ab5","parents":["2c4b9a7db6b9a215e0fcd2ff6f16bde701673812"],"ref":"refs/changes/26/2826/1","uploader":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"createdOn":1508456647,"author":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1508456677,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/register.js","type":"MODIFIED","insertions":35,"deletions":-11},{"file":"lib/zk.js","type":"MODIFIED","insertions":16,"deletions":-4},{"file":"main.js","type":"MODIFIED","insertions":9,"deletions":-4},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":61,"sizeDeletions":-20},{"number":"2","revision":"e001321cd554585d859fc4de4232160b4783c8ad","parents":["2c4b9a7db6b9a215e0fcd2ff6f16bde701673812"],"ref":"refs/changes/26/2826/2","uploader":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"createdOn":1508456961,"author":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1508456986,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/zk.js","line":32,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"This needs to go. The ephemeral nodes are maintained by having a current session -- the session does not need to do any traffic to maintain them, and this call is constantly generating pointless load on the zk servers and pushing transaction IDs up."},{"file":"lib/zk.js","line":90,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"This should not be happening on every \u0027connect\u0027 event. It could *maybe* happen on \u0027session\u0027, but I really don\u0027t like the way it\u0027s adding properties and a function to the zk client object. Maybe rewriting this whole module is out of the question right now, but this is pretty ugly."},{"file":"main.js","line":135,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Re-creating the ephemerals needs to be done on the \u0027session\u0027 event, not on \u0027connect\u0027. Ephemerals survive the disconnect-reconnect cycle as long as the session is still valid (and if the session is invalid, then the client emits \u0027expire\u0027)"},{"file":"main.js","line":146,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"I think we should change this to not restart the whole process just because the zk session ended. The zkstream client will proceed to create a new session after losing an existing one, which will cause \u0027session\u0027 to be emitted again. If we re-register our ephemeral nodes on that event, we should just be able to do nothing here."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/register.js","type":"MODIFIED","insertions":35,"deletions":-11},{"file":"lib/zk.js","type":"MODIFIED","insertions":16,"deletions":-4},{"file":"main.js","type":"MODIFIED","insertions":9,"deletions":-4},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":61,"sizeDeletions":-20},{"number":"3","revision":"d28b028f165d5a77b33c892ded8f90db2ecb7b02","parents":["2c4b9a7db6b9a215e0fcd2ff6f16bde701673812"],"ref":"refs/changes/26/2826/3","uploader":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"createdOn":1508792585,"author":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1508792628,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"package.json","line":21,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Temporary. Will fix when everything else looks good."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/index.js","type":"MODIFIED","insertions":34,"deletions":-34},{"file":"lib/register.js","type":"MODIFIED","insertions":38,"deletions":-12},{"file":"lib/zk.js","type":"MODIFIED","insertions":3,"deletions":-95},{"file":"main.js","type":"MODIFIED","insertions":49,"deletions":-46},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":125,"sizeDeletions":-188},{"number":"4","revision":"7fda122229562eff1ad36069fbd6b2c8f1d37081","parents":["2c4b9a7db6b9a215e0fcd2ff6f16bde701673812"],"ref":"refs/changes/26/2826/4","uploader":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"createdOn":1511308984,"author":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1511309007,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"main.js","line":194,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"In regards to the implication of the name `force_restart()`, what mechanism will actually restart the ZK client?  Looking at https://github.com/joyent/node-zkstream/blob/ff2e4f417d5c6feea3584d28b86eef7ba618ecf1/lib/client.js#L118-L119 it seems like expiration will then close the connection.  I\u0027m trying to follow the FSM, so the mechanism for the reconnect might be in cueball somewhere and I\u0027m just not following."},{"file":"main.js","line":194,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"I think you\u0027re right. It looks like node-zkstream will depend on node-cueball to call the constructor it was passed here: https://github.com/joyent/node-zkstream/blob/master/lib/client.js#L91 to re-attach a connection to the expired session object if it exists as the zc_session member of the client. But it looks like the connection set in cueball maintains `target` connections to it\u0027s backend an rebalances the set of connections in response to timeouts to try to get to it\u0027s target number of working connections: https://github.com/joyent/node-cueball/blob/master/lib/set.js#L440-L449. That should re-create the connection-slot-fsm that will be re-attached to the zc_session in node-zkstream. \n\nThis should only happen in transient connection failures though. If we\u0027ve lost the connection to the zk server then the connection set will enter a \"failed\" state which registrar will see and report in the logs. I don\u0027t think we\u0027ll re-establish the session in that case."},{"file":"main.js","line":194,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"Sounds reasonable.  I couldn\u0027t quite figure out where the re-create was taking place, so that\u0027s helpful."},{"file":"package.json","line":21,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Currently points to a temporary version of node-zkstreams with the necessary createWithEmptyParents api method and the fix for joyent/node-zkstream#26. This dependency will be updated once the necessary changes have been integrated."},{"file":"package.json","line":21,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"This can now be updated to version 0.10.0.  The following tag https://github.com/joyent/node-zkstream/releases/tag/v0.10.0 was pushed to npm."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/index.js","type":"MODIFIED","insertions":34,"deletions":-34},{"file":"lib/register.js","type":"MODIFIED","insertions":45,"deletions":-12},{"file":"lib/zk.js","type":"MODIFIED","insertions":3,"deletions":-95},{"file":"main.js","type":"MODIFIED","insertions":49,"deletions":-46},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":132,"sizeDeletions":-188},{"number":"5","revision":"314db2ebc9ac3be10caaf285c948a089d83b4fde","parents":["2c4b9a7db6b9a215e0fcd2ff6f16bde701673812"],"ref":"refs/changes/26/2826/5","uploader":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"createdOn":1512416688,"author":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1512416711,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1512417233,"by":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"}}],"comments":[{"file":"lib/index.js","line":52,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"It\u0027s normally best to just give the Error object as the first arg to bunyan logger functions so it knows to print the stack out and such. (i.e., just do log.warn(err, \u0027failed to create ephemeral node\u0027);"},{"file":"lib/index.js","line":52,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Done"},{"file":"lib/register.js","line":121,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Why don\u0027t we drop this setupDirectories() step entirely, and just call .createWithEmptyParents() later where we create the ephemeral/service nodes?"},{"file":"lib/register.js","line":121,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Done"},{"file":"lib/register.js","line":304,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"We shouldn\u0027t need to ever delete ephemeral nodes, we should just end our session by calling close() and the ephemerals will disappear with it. I think we should just drop this code."},{"file":"lib/register.js","line":304,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Done"},{"file":"lib/zk.js","line":17,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Maybe we should just drop this file entirely at this point? :P It\u0027s pretty empty."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/index.js","type":"MODIFIED","insertions":34,"deletions":-34},{"file":"lib/register.js","type":"MODIFIED","insertions":45,"deletions":-12},{"file":"lib/zk.js","type":"MODIFIED","insertions":3,"deletions":-95},{"file":"main.js","type":"MODIFIED","insertions":49,"deletions":-46},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":132,"sizeDeletions":-188},{"number":"6","revision":"272ba444c4c7bf267a801ab411a1dde4d80670a1","parents":["2c4b9a7db6b9a215e0fcd2ff6f16bde701673812"],"ref":"refs/changes/26/2826/6","uploader":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"createdOn":1512434674,"author":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1512434708,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1513001733,"by":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/index.js","type":"MODIFIED","insertions":52,"deletions":-37},{"file":"lib/register.js","type":"MODIFIED","insertions":32,"deletions":-57},{"file":"lib/zk.js","type":"DELETED","insertions":0,"deletions":-135},{"file":"main.js","type":"MODIFIED","insertions":51,"deletions":-51},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":136,"sizeDeletions":-281},{"number":"7","revision":"b7e4f92cec5706f86608cc931a347f99648f04c2","parents":["2c4b9a7db6b9a215e0fcd2ff6f16bde701673812"],"ref":"refs/changes/26/2826/7","uploader":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"createdOn":1513020248,"author":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1513020271,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/index.js","line":197,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"This is a tab but the line above it is 4-space indented? The rest of this file seems to be 4-space, so might be best to go that way."},{"file":"lib/index.js","line":197,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Done"},{"file":"lib/register.js","line":265,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"How does zk.close() get called here? Should that be happening underneath/before this .on call?"},{"file":"lib/register.js","line":265,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/index.js","type":"MODIFIED","insertions":52,"deletions":-37},{"file":"lib/register.js","type":"MODIFIED","insertions":32,"deletions":-57},{"file":"lib/zk.js","type":"DELETED","insertions":0,"deletions":-135},{"file":"main.js","type":"MODIFIED","insertions":49,"deletions":-51},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":134,"sizeDeletions":-281},{"number":"8","revision":"13b17ed13e5cdbba6668dd9b0266d0beaf20ebe4","parents":["2c4b9a7db6b9a215e0fcd2ff6f16bde701673812"],"ref":"refs/changes/26/2826/8","uploader":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"createdOn":1513033958,"author":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1513033981,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/index.js","type":"MODIFIED","insertions":52,"deletions":-37},{"file":"lib/register.js","type":"MODIFIED","insertions":34,"deletions":-57},{"file":"lib/zk.js","type":"DELETED","insertions":0,"deletions":-135},{"file":"main.js","type":"MODIFIED","insertions":109,"deletions":-51},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":196,"sizeDeletions":-281},{"number":"9","revision":"6593db479e67abde8ffeb0a3a7d068ce7c928a87","parents":["2c4b9a7db6b9a215e0fcd2ff6f16bde701673812"],"ref":"refs/changes/26/2826/9","uploader":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"createdOn":1513034287,"author":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1513034311,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/index.js","type":"MODIFIED","insertions":52,"deletions":-37},{"file":"lib/register.js","type":"MODIFIED","insertions":34,"deletions":-57},{"file":"lib/zk.js","type":"DELETED","insertions":0,"deletions":-135},{"file":"main.js","type":"MODIFIED","insertions":107,"deletions":-51},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":194,"sizeDeletions":-281},{"number":"10","revision":"90245ae8344b92175c1c9c40880eddd9d8da070d","parents":["2c4b9a7db6b9a215e0fcd2ff6f16bde701673812"],"ref":"refs/changes/26/2826/10","uploader":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"createdOn":1513045078,"author":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1513045101,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/index.js","type":"MODIFIED","insertions":52,"deletions":-38},{"file":"lib/register.js","type":"MODIFIED","insertions":35,"deletions":-59},{"file":"lib/zk.js","type":"DELETED","insertions":0,"deletions":-135},{"file":"main.js","type":"MODIFIED","insertions":86,"deletions":-49},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":174,"sizeDeletions":-282},{"number":"11","revision":"0f75af478c0b63f6de3bcd24e7a4be984ff64d13","parents":["2c4b9a7db6b9a215e0fcd2ff6f16bde701673812"],"ref":"refs/changes/26/2826/11","uploader":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"createdOn":1513045663,"author":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1513045687,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"main.js","line":151,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Do we need a process.exit() here? Have you tested this and it works without it?"},{"file":"main.js","line":151,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/index.js","type":"MODIFIED","insertions":52,"deletions":-38},{"file":"lib/register.js","type":"MODIFIED","insertions":35,"deletions":-59},{"file":"lib/zk.js","type":"DELETED","insertions":0,"deletions":-135},{"file":"main.js","type":"MODIFIED","insertions":86,"deletions":-49},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":174,"sizeDeletions":-282},{"number":"12","revision":"9de2a3878719a74d1005516a9ddfdf1fc21ffe8f","parents":["2c4b9a7db6b9a215e0fcd2ff6f16bde701673812"],"ref":"refs/changes/26/2826/12","uploader":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"createdOn":1513297945,"author":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1513299317,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1513045101,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1513299452,"by":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/index.js","type":"MODIFIED","insertions":52,"deletions":-38},{"file":"lib/register.js","type":"MODIFIED","insertions":35,"deletions":-59},{"file":"lib/zk.js","type":"DELETED","insertions":0,"deletions":-135},{"file":"main.js","type":"MODIFIED","insertions":86,"deletions":-49},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":174,"sizeDeletions":-282},{"number":"13","revision":"61323323f7a9eb53ca2a684af1c0c2afa285b2b9","parents":["2c4b9a7db6b9a215e0fcd2ff6f16bde701673812"],"ref":"refs/changes/26/2826/13","uploader":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"createdOn":1513870442,"author":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/index.js","type":"MODIFIED","insertions":52,"deletions":-38},{"file":"lib/register.js","type":"MODIFIED","insertions":35,"deletions":-59},{"file":"lib/zk.js","type":"DELETED","insertions":0,"deletions":-135},{"file":"main.js","type":"MODIFIED","insertions":93,"deletions":-49},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":181,"sizeDeletions":-282},{"number":"14","revision":"129e99089e83e40e09fcd07ed54b67780276aee8","parents":["2c4b9a7db6b9a215e0fcd2ff6f16bde701673812"],"ref":"refs/changes/26/2826/14","uploader":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"createdOn":1513879928,"author":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1513879952,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/index.js","type":"MODIFIED","insertions":123,"deletions":-121},{"file":"lib/register.js","type":"MODIFIED","insertions":49,"deletions":-63},{"file":"lib/zk.js","type":"DELETED","insertions":0,"deletions":-135},{"file":"main.js","type":"MODIFIED","insertions":91,"deletions":-49},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":264,"sizeDeletions":-369},{"number":"15","revision":"a5d44d70dcdb3e7320e19bc55fc5dc359f310be9","parents":["2c4b9a7db6b9a215e0fcd2ff6f16bde701673812"],"ref":"refs/changes/26/2826/15","uploader":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"createdOn":1513881817,"author":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1513885786,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1513881841,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1513886978,"by":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"}}],"comments":[{"file":"lib/register.js","line":71,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"I think we should maybe log a message if it\u0027s anything other than \"data\" rather than only on null here? It\u0027d be nice to get a log message if two registrars are in a fight over a service and have different configs for what it should contain."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/index.js","type":"MODIFIED","insertions":131,"deletions":-121},{"file":"lib/register.js","type":"MODIFIED","insertions":77,"deletions":-71},{"file":"lib/zk.js","type":"DELETED","insertions":0,"deletions":-135},{"file":"main.js","type":"MODIFIED","insertions":94,"deletions":-49},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":303,"sizeDeletions":-377},{"number":"16","revision":"84d881aaea38316fdda543f319d1f3a0a53af8ab","parents":["2c4b9a7db6b9a215e0fcd2ff6f16bde701673812"],"ref":"refs/changes/26/2826/16","uploader":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"createdOn":1513914724,"author":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1513914748,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/index.js","type":"MODIFIED","insertions":138,"deletions":-121},{"file":"lib/register.js","type":"MODIFIED","insertions":111,"deletions":-73},{"file":"lib/zk.js","type":"DELETED","insertions":0,"deletions":-135},{"file":"main.js","type":"MODIFIED","insertions":94,"deletions":-49},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":344,"sizeDeletions":-379},{"number":"17","revision":"bc857ffab3f8cd301b4408be3ea0e83f2b087003","parents":["2c4b9a7db6b9a215e0fcd2ff6f16bde701673812"],"ref":"refs/changes/26/2826/17","uploader":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"createdOn":1513950441,"author":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1513950465,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1513952904,"by":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"}}],"comments":[{"file":"package.json","line":21,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"This should be 0.10.1?"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/index.js","type":"MODIFIED","insertions":135,"deletions":-121},{"file":"lib/register.js","type":"MODIFIED","insertions":111,"deletions":-73},{"file":"lib/zk.js","type":"DELETED","insertions":0,"deletions":-135},{"file":"main.js","type":"MODIFIED","insertions":94,"deletions":-49},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":341,"sizeDeletions":-379},{"number":"18","revision":"618ebe38747479f21446fc6e135169902d1e1d9d","parents":["2c4b9a7db6b9a215e0fcd2ff6f16bde701673812"],"ref":"refs/changes/26/2826/18","uploader":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"createdOn":1513975320,"author":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1513975343,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/index.js","type":"MODIFIED","insertions":135,"deletions":-121},{"file":"lib/register.js","type":"MODIFIED","insertions":111,"deletions":-73},{"file":"lib/zk.js","type":"DELETED","insertions":0,"deletions":-135},{"file":"main.js","type":"MODIFIED","insertions":94,"deletions":-49},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":341,"sizeDeletions":-379},{"number":"19","revision":"0e5e6875c53d57fae71a1ef80e92d02503cd7f58","parents":["2c4b9a7db6b9a215e0fcd2ff6f16bde701673812"],"ref":"refs/changes/26/2826/19","uploader":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"createdOn":1513976245,"author":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1514397653,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1514397665,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1513976269,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1514397719,"by":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/index.js","type":"MODIFIED","insertions":135,"deletions":-121},{"file":"lib/register.js","type":"MODIFIED","insertions":110,"deletions":-73},{"file":"lib/zk.js","type":"DELETED","insertions":0,"deletions":-135},{"file":"main.js","type":"MODIFIED","insertions":94,"deletions":-49},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":340,"sizeDeletions":-379},{"number":"20","revision":"da6183023a75fa24cc286ab63716a5b5a3272629","parents":["2c4b9a7db6b9a215e0fcd2ff6f16bde701673812"],"ref":"refs/changes/26/2826/20","uploader":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"createdOn":1514494926,"author":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1514494950,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/register.js","line":193,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"s/bfore/before/"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/index.js","type":"MODIFIED","insertions":135,"deletions":-121},{"file":"lib/register.js","type":"MODIFIED","insertions":122,"deletions":-73},{"file":"lib/zk.js","type":"DELETED","insertions":0,"deletions":-135},{"file":"main.js","type":"MODIFIED","insertions":94,"deletions":-49},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":352,"sizeDeletions":-379},{"number":"21","revision":"b6a55b4edbaf5fae324a16376babcbaafd888621","parents":["2c4b9a7db6b9a215e0fcd2ff6f16bde701673812"],"ref":"refs/changes/26/2826/21","uploader":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"createdOn":1515108073,"author":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1515119251,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1515119251,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1515108097,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1515129601,"by":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/index.js","type":"MODIFIED","insertions":135,"deletions":-121},{"file":"lib/register.js","type":"MODIFIED","insertions":122,"deletions":-73},{"file":"lib/zk.js","type":"DELETED","insertions":0,"deletions":-135},{"file":"main.js","type":"MODIFIED","insertions":94,"deletions":-49},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":352,"sizeDeletions":-379},{"number":"22","revision":"c7f03167e1f2789235838e802c2eeb1567dd6196","parents":["2c4b9a7db6b9a215e0fcd2ff6f16bde701673812"],"ref":"refs/changes/26/2826/22","uploader":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"createdOn":1515183067,"author":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1515195744,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1515195744,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1515183091,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"SUBM","value":"1","grantedOn":1515195992,"by":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/index.js","type":"MODIFIED","insertions":136,"deletions":-122},{"file":"lib/register.js","type":"MODIFIED","insertions":123,"deletions":-74},{"file":"lib/zk.js","type":"DELETED","insertions":0,"deletions":-135},{"file":"main.js","type":"MODIFIED","insertions":95,"deletions":-50},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":357,"sizeDeletions":-384}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"}]}