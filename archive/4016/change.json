{"project":"joyent/sdcadm","branch":"master","id":"Iee4bfb9c3acb3dfd730549dfff71fff8d1ab3452","number":"4016","subject":"TOOLS-1699 sdcadm health -j should always provide JSON even on exceptions Reviewed by: Marsell Kukuljevic \u003cmarsell@joyent.com\u003e Approved by: Marsell Kukuljevic \u003cmarsell@joyent.com\u003e","owner":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"url":"https://cr.joyent.us/4016","commitMessage":"TOOLS-1699 sdcadm health -j should always provide JSON even on exceptions\nReviewed by: Marsell Kukuljevic \u003cmarsell@joyent.com\u003e\nApproved by: Marsell Kukuljevic \u003cmarsell@joyent.com\u003e\n","createdOn":1527594918,"lastUpdated":1528478207,"open":false,"status":"MERGED","comments":[{"timestamp":1527594918,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 1."},{"timestamp":1527594924,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit 08d45bdf40c684c7025083dde1ebf0314d5ec601\n    \n    TOOLS-1699 sdcadm health -j should always provide JSON even on exceptions"},{"timestamp":1527594955,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 1:\n\nAnother not too big one for a quick CR if you have the time Marsell"},{"timestamp":1527594962,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1527784742,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1527792486,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 2: Patch Set 1 was rebased."},{"timestamp":1527792492,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit f3c5c321c50760e5ff9239e9bb88503923bc9907\n    \n    TOOLS-1699 sdcadm health -j should always provide JSON even on exceptions"},{"timestamp":1527792526,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2:\n\n\"make check\" passed ok"},{"timestamp":1527864897,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 3: Patch Set 2 was rebased."},{"timestamp":1527864902,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 3:\n\nNew commits:\n    \n    commit 34ff41f31f3db6acf562c42efe59c0ffc41253e2\n    \n    TOOLS-1699 sdcadm health -j should always provide JSON even on exceptions"},{"timestamp":1527864934,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3:\n\n\"make check\" passed ok"},{"timestamp":1528222308,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 4: Patch Set 3 was rebased."},{"timestamp":1528222313,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 4:\n\nNew commits:\n    \n    commit 57cad17cc7a082d7d39a971cd293ff20324236d8\n    \n    TOOLS-1699 sdcadm health -j should always provide JSON even on exceptions"},{"timestamp":1528222349,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4:\n\n\"make check\" passed ok"},{"timestamp":1528381300,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 5: Patch Set 4 was rebased."},{"timestamp":1528381306,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 5:\n\nNew commits:\n    \n    commit 2955490fc5ffced1976da5ae0cee07fc2ac93efd\n    \n    TOOLS-1699 sdcadm health -j should always provide JSON even on exceptions"},{"timestamp":1528381334,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5:\n\n\"make check\" passed ok"},{"timestamp":1528381664,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 5:\n\nJust curious if you missed my last comment, or if you don\u0027t plan to act on it?\n\nI\u0027m sitting here wondering if I should CR/IA or not. :p"},{"timestamp":1528473820,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 5:\n\n\u003e Just curious if you missed my last comment, or if you don\u0027t plan to\n \u003e act on it?\n \u003e \n \u003e I\u0027m sitting here wondering if I should CR/IA or not. :p\n\nI indeed missed it, apparently by putting a bunch of rebase garbage on top of it. Checking now."},{"timestamp":1528474173,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 6."},{"timestamp":1528474178,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 6:\n\nNew commits:\n    \n    commit 3ef8976f56b8b54ef547c4c954d103f9352985d5\n    \n    TOOLS-1699 sdcadm health -j should always provide JSON even on exceptions"},{"timestamp":1528474206,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 1:\n\n(1 comment)\n\nDefinitely a good idea. Sorry for ignoring the comment for so long!"},{"timestamp":1528477750,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 6: Code-Review+1 Integration-Approval+1"},{"timestamp":1528478185,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 7: Commit message was updated."},{"timestamp":1528478207,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Pedro Palazón Candel"}],"currentPatchSet":{"number":"7","revision":"ee4bfb9c3acb3dfd730549dfff71fff8d1ab3452","parents":["4c231682c377078dbaaf3131822ff1eef4401441"],"ref":"refs/changes/16/4016/7","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1528478185,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1528477750,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1528477750,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}},{"type":"SUBM","value":"1","grantedOn":1528478207,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/cli/do_check_health.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/sdcadm.js","type":"MODIFIED","insertions":16,"deletions":-2}],"sizeInsertions":17,"sizeDeletions":-3},"patchSets":[{"number":"1","revision":"7362a7b23e968a1e3f2017fd0c0a64d8be7a8491","parents":["880176503514196257d82013e1a7aacc4274ebb8"],"ref":"refs/changes/16/4016/1","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1527594918,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1527594962,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/sdcadm.js","line":4101,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"To ensure both these error messages remain consistent, I\u0027d shot the err creation into a helper function, then cb(null, severeHealthError(err)) or similar."},{"file":"lib/sdcadm.js","line":4101,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Good call. Done!"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/cli/do_check_health.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/sdcadm.js","type":"MODIFIED","insertions":24,"deletions":-2}],"sizeInsertions":25,"sizeDeletions":-3},{"number":"2","revision":"f67c2e8053fe20668fbfeeb45a2e1e9694641066","parents":["39aad99285cd9bd845f2f91601d8e8c3216c0d0f"],"ref":"refs/changes/16/4016/2","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1527792486,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1527594962,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/cli/do_check_health.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/sdcadm.js","type":"MODIFIED","insertions":24,"deletions":-2}],"sizeInsertions":25,"sizeDeletions":-3},{"number":"3","revision":"0361e194d2df653da820edcdd4f478fc0b4cbd62","parents":["e60b92876b73ec7368ea4189e26c8d88dbf17aa5"],"ref":"refs/changes/16/4016/3","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1527864897,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1527594962,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/cli/do_check_health.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/sdcadm.js","type":"MODIFIED","insertions":24,"deletions":-2}],"sizeInsertions":25,"sizeDeletions":-3},{"number":"4","revision":"24d53cd6b6032a4612eb770510468ce36f35904b","parents":["4031c5768ae15515a7d4dd28289034343a1eff62"],"ref":"refs/changes/16/4016/4","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1528222308,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1527594962,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/cli/do_check_health.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/sdcadm.js","type":"MODIFIED","insertions":24,"deletions":-2}],"sizeInsertions":25,"sizeDeletions":-3},{"number":"5","revision":"aa14bd2638046e4af82d63655f6d0594cc4bb589","parents":["4c231682c377078dbaaf3131822ff1eef4401441"],"ref":"refs/changes/16/4016/5","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1528381300,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1527594962,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/cli/do_check_health.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/sdcadm.js","type":"MODIFIED","insertions":24,"deletions":-2}],"sizeInsertions":25,"sizeDeletions":-3},{"number":"6","revision":"7e14e9ea176c93a58fe26272c4f6b8b93096b284","parents":["4c231682c377078dbaaf3131822ff1eef4401441"],"ref":"refs/changes/16/4016/6","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1528474173,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1528477750,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1528477750,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/cli/do_check_health.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/sdcadm.js","type":"MODIFIED","insertions":16,"deletions":-2}],"sizeInsertions":17,"sizeDeletions":-3},{"number":"7","revision":"ee4bfb9c3acb3dfd730549dfff71fff8d1ab3452","parents":["4c231682c377078dbaaf3131822ff1eef4401441"],"ref":"refs/changes/16/4016/7","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1528478185,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"SUBM","value":"1","grantedOn":1528478207,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1528477750,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1528477750,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/cli/do_check_health.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/sdcadm.js","type":"MODIFIED","insertions":16,"deletions":-2}],"sizeInsertions":17,"sizeDeletions":-3}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}]}