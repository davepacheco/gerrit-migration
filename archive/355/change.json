{"project":"joyent/illumos-joyent","branch":"master","topic":"OS-5564","id":"Ie216545f279daed6dd185869838ceac967c726cd","number":"355","subject":"OS-5564 new driver for Smart Array storage controllers Reviewed by: Robert Mustacchi \u003crm@joyent.com\u003e Reviewed by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e Approved by: Dave Pacheco \u003cdap@joyent.com\u003e","owner":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"url":"https://cr.joyent.us/355","commitMessage":"OS-5564 new driver for Smart Array storage controllers\nReviewed by: Robert Mustacchi \u003crm@joyent.com\u003e\nReviewed by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e\nApproved by: Dave Pacheco \u003cdap@joyent.com\u003e\n","createdOn":1472192567,"lastUpdated":1473931213,"open":false,"status":"MERGED","comments":[{"timestamp":1472192567,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Uploaded patch set 1."},{"timestamp":1472192574,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Topic set to OS-5564"},{"timestamp":1472193150,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Patch Set 1:\n\nThis OpenCISS specification, as well as some older Compaq firmware documentation, is available in Manta:\n\n    /Joyent_Dev/stor/thirdparty/docs/hp/ciss/"},{"timestamp":1472509402,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 1: Code-Review-1\n\n(55 comments)"},{"timestamp":1472603152,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Patch Set 1:\n\n(53 comments)"},{"timestamp":1472603167,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Uploaded patch set 2."},{"timestamp":1472604823,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 2: Code-Review+1\n\n(13 comments)\n\nOh c99 arbitrary variable declaration."},{"timestamp":1473289488,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Uploaded patch set 3."},{"timestamp":1473291851,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 3: Code-Review+1\n\n(2 comments)"},{"timestamp":1473293004,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Uploaded patch set 4."},{"timestamp":1473293033,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Patch Set 3:\n\n(2 comments)"},{"timestamp":1473293106,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 4: Code-Review+1"},{"timestamp":1473649161,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 4: Code-Review+1\n\n(7 comments)"},{"timestamp":1473804711,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Patch Set 4:\n\n(7 comments)\n\nThanks for taking a look Patrick.  I\u0027m retesting with the changes now."},{"timestamp":1473808145,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Uploaded patch set 5."},{"timestamp":1473808511,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 5: Code-Review+1"},{"timestamp":1473811794,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Uploaded patch set 6."},{"timestamp":1473811878,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Patch Set 6:\n\nApologies, folks: I ran \"lint\" and found a number of issues which I have now corrected."},{"timestamp":1473811987,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 6: Code-Review+1"},{"timestamp":1473864123,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 6: Code-Review+1\n\n(1 comment)"},{"timestamp":1473887813,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Patch Set 4:\n\n(1 comment)"},{"timestamp":1473896435,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 6: Integration-Approval+1"},{"timestamp":1473930839,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Patch Set 7: Commit message was updated."},{"timestamp":1473930850,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Patch Set 8: Patch Set 7 was rebased"},{"timestamp":1473931213,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Joshua M. Clulow"}],"currentPatchSet":{"number":"8","revision":"c86756ae454a92690a1c9645202ee6fbc9a2f21b","parents":["20b2a635001f40d98b5639d28d10ba90238d190a"],"ref":"refs/changes/55/355/8","uploader":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"createdOn":1473930850,"author":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1473811987,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1473864123,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1473896435,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"SUBM","value":"1","grantedOn":1473931213,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/uts/common/Makefile.files","type":"MODIFIED","insertions":12,"deletions":0},{"file":"usr/src/uts/common/Makefile.rules","type":"MODIFIED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/io/cpqary3/cpqary3.c","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt.c","type":"ADDED","insertions":441,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt.conf","type":"ADDED","insertions":16,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_ciss.c","type":"ADDED","insertions":1119,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_ciss_simple.c","type":"ADDED","insertions":212,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_commands.c","type":"ADDED","insertions":325,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_device.c","type":"ADDED","insertions":215,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_hba.c","type":"ADDED","insertions":1073,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_interrupts.c","type":"ADDED","insertions":233,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_logvol.c","type":"ADDED","insertions":312,"deletions":0},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt.h","type":"ADDED","insertions":586,"deletions":0},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt_ciss.h","type":"ADDED","insertions":339,"deletions":0},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt_scsi.h","type":"ADDED","insertions":105,"deletions":0}],"sizeInsertions":4998,"sizeDeletions":-1},"patchSets":[{"number":"1","revision":"8bdc3507e046f63ba2c4ab1e79a316d9c07079af","parents":["c89aa2cda9c4c5a89db5c7b85f420548cd437c12"],"ref":"refs/changes/55/355/1","uploader":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"createdOn":1472192567,"author":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"-1","grantedOn":1472509402,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}}],"comments":[{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt.c","line":116,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"cpqary3 has the line \u0027HP Smart Array Driver\u0027. Maybe we should label this one slightly differently just to make it clearer. Maybe something like \u0027HP Smart Array SAS\u0027?"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt.c","line":116,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"I opted to rename the old driver (cpqary3) to \"HP Smart Array (Legacy)\"."},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt.c","line":116,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt.c","line":183,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"This should check against DDI_SUCCESS."},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt.c","line":183,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Done"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt.c","line":212,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I know you\u0027re never going to be above lock level, but strictly speaking you should initialize this mutex with the interrupt priority after you have your interrupts."},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt.c","line":212,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Done"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt.c","line":276,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Maybe this should be a constant / macro?"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt.c","line":276,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Done"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt.c","line":282,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Maybe this should be a constant / macro?"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt.c","line":282,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Done"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt.c","line":303,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"We probably shouldn\u0027t assume that these are non-NULL. Though I admit it\u0027d be very odd for them not to be. I might check and then complain loudly."},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt.c","line":303,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"If they are NULL, it\u0027s going to panic pretty quickly here.  I could do an explicit VERIFY(), but I\u0027m not sure that will really help."},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt.c","line":356,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Can we file a follow up RFE here to make sure that scsi_hba_ioctl gets documented in some form and probably to fold in the secpolicy to it?"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt.c","line":356,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"https://www.illumos.org/issues/7343"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt.conf","line":16,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Is it possible to add a comment or explain why this needs to be set here?"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_ciss.c","line":53,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"This is a uint16_t, don\u0027t we need to worry about the endianness of the data in it?"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_ciss.c","line":53,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Done"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_ciss.c","line":83,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Do we need to worry about the endianess for the tag across the bcopy?"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_ciss.c","line":83,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"I have opted, instead, to assert that _LITTLE_ENDIAN is defined in \"smrt.h\"."},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_ciss.c","line":83,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_ciss.c","line":129,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"In smrt.c you have it set to 5 seconds. Here the comment is 15 seconds. One of these should change."},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_ciss.c","line":129,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Done"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_ciss.c","line":151,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"This makes me wish we had a way to defer this decision to FMA. As it\u0027s not always the case that this is what we want. It seems likely here so the system can make forward progress, but still."},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_ciss.c","line":151,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_ciss.c","line":235,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Should you be asserting that the lock is held here?"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_ciss.c","line":235,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Done"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_ciss.c","line":263,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"In the future we may want to replace this with an id_space_t. But let\u0027s not worry about it now."},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_ciss.c","line":263,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"OK."},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_ciss.c","line":294,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I\u0027d actually not specify the size here and let it sync the entire region."},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_ciss.c","line":294,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Done"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_ciss.c","line":414,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I wouldn\u0027t specify the size here, but use zero and let it sync the entire handle."},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_ciss.c","line":414,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Done"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_ciss.c","line":546,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"It\u0027s worth a comment that explains why we\u0027re here waiting."},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_ciss.c","line":546,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Done"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_ciss_simple.c","line":85,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"So should we really just keep doing this for an unlimited number of entries? Is there any point at which we should give up?"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_ciss_simple.c","line":85,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"We could limit the number of completions per call, but if the queue is not read until empty the interrupt will be asserted again immediately.\n\nWe also hold the mutex the entire time that we do this, so no commands can be submitted while we\u0027re in this loop."},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_ciss_simple.c","line":85,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I understand. We just saw pathological hardware where it was filling entries and generating them faster than we could process them recently, but I guess you have a finite set of input here, so it\u0027s probably not too big a deal."},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_ciss_simple.c","line":145,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Probably worth adding a note that this may be less than the controller supports and that\u0027s by design."},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_ciss_simple.c","line":145,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Done"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_ciss_simple.c","line":153,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Can we make this a constant near CISS_MAXSGENTRIES?"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_ciss_simple.c","line":153,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Done"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_commands.c","line":90,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I\u0027m not sure that you want the smrt_dev_attributes here as these are defined to be a LE structure. However, I\u0027ve seen you already converting things left and right. It may be that these aren\u0027t properly used here, but whenever I deal with DMA memory ranges, I define a separate attributes that have the structure access set to never swap."},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_commands.c","line":90,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Done"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_commands.c","line":194,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"You should explicitly call list_link_init(9F) on the smcm_link_abort member as you end up calling list_link_active(9F) on them."},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_commands.c","line":194,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"As mentioned in the manual page:\n\n       The list_link_init() function initializes the list_node_t. It is\n       functionally equivalent to bzero(node, sizeof(*node));"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_commands.c","line":194,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_commands.c","line":254,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"It may be worth reinitializing the smcm_link_abort again due to the use of list_link_active()."},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_commands.c","line":254,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Instead, I\u0027ll make sure they are not in either the finish or abort queues.  I\u0027ll also do the same in \"smrt_command_free()\"."},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_commands.c","line":254,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_commands.c","line":288,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Generally we do this stylistically after the variable declarations (and that\u0027s what you seem to do elsewhere)."},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_commands.c","line":288,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Done"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_commands.c","line":290,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Should we be zeroing this at all? That way if the inflight avl ever changes we don\u0027t have random stack garbage?"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_commands.c","line":290,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Done"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_device.c","line":198,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Stylistically I prefer to do the verifies that check for the validity before I use it. Feel free to ignore this."},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_device.c","line":198,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Done"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_device.c","line":210,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Stylistically I prefer to do the verifies that check for the validity before I use it. Feel free to ignore this."},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_device.c","line":210,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Done"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_device.c","line":216,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Why is there a return statement when this returns void? I\u0027m surprised the compiler didn\u0027t complain."},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_device.c","line":216,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Good point!  I\u0027m not sure why gcc didn\u0027t complain."},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_hba.c","line":123,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Should we be NULLing out the tran_tgt_private member of the hba_tran pointer that we set above?"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_hba.c","line":123,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Done"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_hba.c","line":307,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Shouldn\u0027t there be endian adjustments here?"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_hba.c","line":307,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Done"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_hba.c","line":331,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"This is a uint16_t, aren\u0027t there some endian issues here?"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_hba.c","line":331,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Done"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_hba.c","line":914,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Is truncation the right thing here? In theory if this value is greater than INT_MAX, shouldn\u0027t we instead be returning INT_MAX rather than truncating?"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_hba.c","line":914,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Done"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_hba.c","line":917,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Should we be doing something if this is the case that we have a value between INT_MAX and UINT32_MAX?"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_hba.c","line":917,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Done"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_hba.c","line":1024,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Can you confirm that we don\u0027t need the following members:\n\n* tran_bus_reset\n* tran_quiesce\n* tran_unquiesce\n* tran_interconnect_type"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_hba.c","line":1024,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"The interconnect type is assumed to be SPI, which is (in some senses) appropriate until we stop pretending to be a parallel SCSI bus.  Once we get to the self-identifying SCSI stage I think we can revisit that.\n\nThe other entry points are all optional, as far as I can tell."},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_hba.c","line":1024,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_hba.c","line":1026,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Can you make sure a bug is filed such that these are documented? scsi_hba_attach_setup(9F) says to see tran_setup_pkt(9F), but it says nothing about them."},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_hba.c","line":1026,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"I filed that one a while ago: https://www.illumos.org/issues/6719"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_hba.c","line":1026,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_interrupts.c","line":21,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Should we still add MSI-X here so that it\u0027s there in case we get a part where it\u0027s supported?"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_interrupts.c","line":21,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Done"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_interrupts.c","line":136,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Can you add a comment on why we don\u0027t try MSI-X?"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_interrupts.c","line":136,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Done"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_logvol.c","line":38,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Maybe add a brief comment so that those not versed in SCSI have a sense of why this is here. Is this because we\u0027re trying to get the device itself?"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_logvol.c","line":38,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Done"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_logvol.c","line":49,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Is it clearer here to use BE_32? Maybe we should import the endian.h bits for the kernel."},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_logvol.c","line":49,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Done"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_logvol.c","line":93,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Is it clearer here to use BE_32?"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_logvol.c","line":93,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Done"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_logvol.c","line":153,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Seeing this I wonder why we want to do any logical discovery during panic. Do we need to do this so we can still dump? Perhaps it\u0027s worth a comment here to make this clearer."},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_logvol.c","line":153,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"We probably don\u0027t need it, but sd(7D) is pretty complicated and I was never particularly satisfied that it wouldn\u0027t do something crazy like re-initialise a device in the panic path.  If for some reason it happens, the code as written will work as expected."},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_logvol.c","line":153,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_logvol.c","line":198,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Is this considered a group 5 SCSI command? I wasn\u0027t sure if CDB_GROUP5 from \u003csys/scsi/generic/commands.h\u003e would be appropriate here."},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_logvol.c","line":198,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"No, technically it\u0027s in Group 6 or 7: the vendor-specific space (0xC0 - 0xFF):\n\n    #define CISS_SCMD_REPORT_LOGICAL_LUNS           0xC2\n    #define CISS_SCMD_REPORT_PHYSICAL_LUNS          0xC3"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_logvol.c","line":198,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_logvol.c","line":265,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Can this flag be changed by the firmware? In other words, even if you request it, it might put something else back?"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_logvol.c","line":265,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"I recall that if the firmware was too old, or possibly just a different or broken version, that it might ignore the extended request bit.  But that was a while ago, so I don\u0027t remember exactly what lead me to that conclusion."},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_logvol.c","line":265,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_logvol.c","line":301,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Missing a list_destroy() of smlv_targets."},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_logvol.c","line":301,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Done"},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt.h","line":48,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Should these be prefixed with SMRT_?"},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt.h","line":48,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Done"},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt.h","line":136,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Should these be exported as kstats?"},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt.h","line":136,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Conceivably.  I think we can get that done in the next round of changes along with FMA, etc."},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt.h","line":136,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt_ciss.h","line":27,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Where exactly did this number come from? Reviewing the spec it seems like the default is a bit larger. Is this just us being conservative?"},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt_ciss.h","line":27,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"I pulled it from a rather fashionable hat."},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt_ciss.h","line":30,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Worth referencing that this comes from section 3.1 of the spec?"},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt_ciss.h","line":30,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Done"},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt_ciss.h","line":35,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Worth mentioning that this is section 3.3 / Table 2?"},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt_ciss.h","line":35,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Done"},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt_ciss.h","line":50,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Should we be adding definitions for 0x0d, 0x0e, and 0xf000?"},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt_ciss.h","line":50,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"0xf000?  Where is that listed?"},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt_ciss.h","line":50,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt_ciss.h","line":171,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Can you mention that these are bitfields for offset 0x8 supported transport methods?"},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt_ciss.h","line":171,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"That\u0027s what \"TransportSupport\" in the structure is."},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt_ciss.h","line":176,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I presume we don\u0027t care about any other bits here?"},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt_ciss.h","line":176,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"That is correct.  At least for now."},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt_ciss.h","line":278,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I\u0027m having trouble figuring out where this comes from in the specs. Can you point that out?"},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt_ciss.h","line":278,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"It\u0027s the \"Additional Error Info\" part of the specification, but I agree that it doesn\u0027t really end up giving enough information to get to this struct definition.  This came from the old driver -- would you prefer that I remove it?"},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt_scsi.h","line":53,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"The spec lists this as a Task Management message. Is it worth changing this or at least mentioning that it\u0027s different?"},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt_scsi.h","line":53,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"I don\u0027t see the words \"Task Management\" in my copy of the OpenCISS specification PDF.  Where are you looking?"},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt_scsi.h","line":62,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Should there be a CISS_MSG_SCAN defined as 0x2?"},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt_scsi.h","line":62,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"I left it out because we don\u0027t use it anywhere"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/uts/common/Makefile.files","type":"MODIFIED","insertions":12,"deletions":0},{"file":"usr/src/uts/common/Makefile.rules","type":"MODIFIED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt.c","type":"ADDED","insertions":424,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt.conf","type":"ADDED","insertions":16,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_ciss.c","type":"ADDED","insertions":1100,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_ciss_simple.c","type":"ADDED","insertions":204,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_commands.c","type":"ADDED","insertions":295,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_device.c","type":"ADDED","insertions":217,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_hba.c","type":"ADDED","insertions":1044,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_interrupts.c","type":"ADDED","insertions":227,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_logvol.c","type":"ADDED","insertions":304,"deletions":0},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt.h","type":"ADDED","insertions":555,"deletions":0},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt_ciss.h","type":"ADDED","insertions":330,"deletions":0},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt_scsi.h","type":"ADDED","insertions":105,"deletions":0}],"sizeInsertions":4842,"sizeDeletions":0},{"number":"2","revision":"50fffb650df893678164065743c902ddc6e665b6","parents":["c89aa2cda9c4c5a89db5c7b85f420548cd437c12"],"ref":"refs/changes/55/355/2","uploader":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"createdOn":1472603167,"author":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1472604823,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/uts/common/Makefile.files","type":"MODIFIED","insertions":12,"deletions":0},{"file":"usr/src/uts/common/Makefile.rules","type":"MODIFIED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/io/cpqary3/cpqary3.c","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt.c","type":"ADDED","insertions":442,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt.conf","type":"ADDED","insertions":16,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_ciss.c","type":"ADDED","insertions":1103,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_ciss_simple.c","type":"ADDED","insertions":209,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_commands.c","type":"ADDED","insertions":323,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_device.c","type":"ADDED","insertions":214,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_hba.c","type":"ADDED","insertions":1056,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_interrupts.c","type":"ADDED","insertions":233,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_logvol.c","type":"ADDED","insertions":312,"deletions":0},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt.h","type":"ADDED","insertions":579,"deletions":0},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt_ciss.h","type":"ADDED","insertions":339,"deletions":0},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt_scsi.h","type":"ADDED","insertions":105,"deletions":0}],"sizeInsertions":4953,"sizeDeletions":-1},{"number":"3","revision":"7b2a4a26ceeb81cffa48059fcdafdf5d55d32ee1","parents":["c89aa2cda9c4c5a89db5c7b85f420548cd437c12"],"ref":"refs/changes/55/355/3","uploader":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"createdOn":1473289488,"author":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1473291851,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}}],"comments":[{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_hba.c","line":438,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Can this 60 be a constant somewhere?"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_hba.c","line":438,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Done"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_hba.c","line":461,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I assume this is related to the same 60 above. It\u0027d be great if it were a single contant."},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_hba.c","line":461,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/uts/common/Makefile.files","type":"MODIFIED","insertions":12,"deletions":0},{"file":"usr/src/uts/common/Makefile.rules","type":"MODIFIED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/io/cpqary3/cpqary3.c","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt.c","type":"ADDED","insertions":442,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt.conf","type":"ADDED","insertions":16,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_ciss.c","type":"ADDED","insertions":1124,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_ciss_simple.c","type":"ADDED","insertions":209,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_commands.c","type":"ADDED","insertions":323,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_device.c","type":"ADDED","insertions":214,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_hba.c","type":"ADDED","insertions":1060,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_interrupts.c","type":"ADDED","insertions":233,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_logvol.c","type":"ADDED","insertions":312,"deletions":0},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt.h","type":"ADDED","insertions":579,"deletions":0},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt_ciss.h","type":"ADDED","insertions":339,"deletions":0},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt_scsi.h","type":"ADDED","insertions":105,"deletions":0}],"sizeInsertions":4978,"sizeDeletions":-1},{"number":"4","revision":"fad193a4daf900c6d0818d9b3a0211027bf7be8a","parents":["c89aa2cda9c4c5a89db5c7b85f420548cd437c12"],"ref":"refs/changes/55/355/4","uploader":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"createdOn":1473293004,"author":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1473293106,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1473649161,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"comments":[{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt.c","line":228,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"s/be come/become/"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt.c","line":228,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Done"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_ciss.c","line":21,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Should this be unsigned instead?"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_ciss.c","line":21,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Done"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_ciss.c","line":161,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Is there a missing removal or is this comment out of date?"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_ciss.c","line":161,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"You\u0027re right!  I believe I was initially taking things out of the inflight list here -- but that\u0027s not safe to do until we either get a completion from the controller or the entire controller is reset.\n\nI\u0027ve reworked the loop a little."},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_commands.c","line":191,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Is there any concern for overflow here?"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_commands.c","line":191,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"I don\u0027t believe so.  We allocate this memory with \"dma_attr_addr_hi\" set to 0xFFFFFFFF (MAX_UINT32) in \"smrt_contig_alloc()\".  I believe this constrains the entire allocation to be useable with a 32-bit address."},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_device.c","line":34,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Unneeded variable here?"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_device.c","line":34,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Yup.  I really wish we included \"-Wunused\" in the release build.  I just did a quick DEBUG build of the module, and caught at least one other unused variable."},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_device.c","line":79,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Should this be compared against \u0027want_type\u0027 instead?"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_device.c","line":79,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"In theory it should, but in practice it doesn\u0027t actually work that way.  For whatever reason we seem to always map memory BARs as 64-bit, at least on some systems.  The controller \"wants\" a 32-bit memory BAR, though."},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_device.c","line":79,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Then I would consider removing the want_type definition.  I think it\u0027s a little misleading to assign it only for the dtrace probe (which is communicating the type state anyways via cfg_offset)"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_device.c","line":79,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"I think I\u0027m going to leave it in for now, as it\u0027s more on the cosmetic side and I\u0027d rather not do another full testing lap just for this."},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt.h","line":125,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"commas after \u0027At times\u0027 and \u0027To do that\u0027"},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt.h","line":125,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/uts/common/Makefile.files","type":"MODIFIED","insertions":12,"deletions":0},{"file":"usr/src/uts/common/Makefile.rules","type":"MODIFIED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/io/cpqary3/cpqary3.c","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt.c","type":"ADDED","insertions":442,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt.conf","type":"ADDED","insertions":16,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_ciss.c","type":"ADDED","insertions":1124,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_ciss_simple.c","type":"ADDED","insertions":209,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_commands.c","type":"ADDED","insertions":323,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_device.c","type":"ADDED","insertions":214,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_hba.c","type":"ADDED","insertions":1060,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_interrupts.c","type":"ADDED","insertions":233,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_logvol.c","type":"ADDED","insertions":312,"deletions":0},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt.h","type":"ADDED","insertions":586,"deletions":0},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt_ciss.h","type":"ADDED","insertions":339,"deletions":0},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt_scsi.h","type":"ADDED","insertions":105,"deletions":0}],"sizeInsertions":4985,"sizeDeletions":-1},{"number":"5","revision":"e8e9faf957001f19ff2cd15c74412c375d9f1642","parents":["c89aa2cda9c4c5a89db5c7b85f420548cd437c12"],"ref":"refs/changes/55/355/5","uploader":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"createdOn":1473808145,"author":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1473808511,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/uts/common/Makefile.files","type":"MODIFIED","insertions":12,"deletions":0},{"file":"usr/src/uts/common/Makefile.rules","type":"MODIFIED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/io/cpqary3/cpqary3.c","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt.c","type":"ADDED","insertions":442,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt.conf","type":"ADDED","insertions":16,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_ciss.c","type":"ADDED","insertions":1117,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_ciss_simple.c","type":"ADDED","insertions":209,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_commands.c","type":"ADDED","insertions":323,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_device.c","type":"ADDED","insertions":213,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_hba.c","type":"ADDED","insertions":1059,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_interrupts.c","type":"ADDED","insertions":233,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_logvol.c","type":"ADDED","insertions":312,"deletions":0},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt.h","type":"ADDED","insertions":586,"deletions":0},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt_ciss.h","type":"ADDED","insertions":339,"deletions":0},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt_scsi.h","type":"ADDED","insertions":105,"deletions":0}],"sizeInsertions":4976,"sizeDeletions":-1},{"number":"6","revision":"e216545f279daed6dd185869838ceac967c726cd","parents":["c89aa2cda9c4c5a89db5c7b85f420548cd437c12"],"ref":"refs/changes/55/355/6","uploader":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"createdOn":1473811794,"author":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1473896435,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1473811987,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1473864123,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/uts/common/Makefile.files","type":"MODIFIED","insertions":12,"deletions":0},{"file":"usr/src/uts/common/Makefile.rules","type":"MODIFIED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/io/cpqary3/cpqary3.c","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt.c","type":"ADDED","insertions":441,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt.conf","type":"ADDED","insertions":16,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_ciss.c","type":"ADDED","insertions":1119,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_ciss_simple.c","type":"ADDED","insertions":212,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_commands.c","type":"ADDED","insertions":325,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_device.c","type":"ADDED","insertions":215,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_hba.c","type":"ADDED","insertions":1073,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_interrupts.c","type":"ADDED","insertions":233,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_logvol.c","type":"ADDED","insertions":312,"deletions":0},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt.h","type":"ADDED","insertions":586,"deletions":0},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt_ciss.h","type":"ADDED","insertions":339,"deletions":0},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt_scsi.h","type":"ADDED","insertions":105,"deletions":0}],"sizeInsertions":4998,"sizeDeletions":-1},{"number":"7","revision":"435ce9199965c02f4f97fc9e92d4b628376a0923","parents":["c89aa2cda9c4c5a89db5c7b85f420548cd437c12"],"ref":"refs/changes/55/355/7","uploader":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"createdOn":1473930839,"author":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1473896435,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1473811987,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1473864123,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/uts/common/Makefile.files","type":"MODIFIED","insertions":12,"deletions":0},{"file":"usr/src/uts/common/Makefile.rules","type":"MODIFIED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/io/cpqary3/cpqary3.c","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt.c","type":"ADDED","insertions":441,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt.conf","type":"ADDED","insertions":16,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_ciss.c","type":"ADDED","insertions":1119,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_ciss_simple.c","type":"ADDED","insertions":212,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_commands.c","type":"ADDED","insertions":325,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_device.c","type":"ADDED","insertions":215,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_hba.c","type":"ADDED","insertions":1073,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_interrupts.c","type":"ADDED","insertions":233,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_logvol.c","type":"ADDED","insertions":312,"deletions":0},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt.h","type":"ADDED","insertions":586,"deletions":0},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt_ciss.h","type":"ADDED","insertions":339,"deletions":0},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt_scsi.h","type":"ADDED","insertions":105,"deletions":0}],"sizeInsertions":4998,"sizeDeletions":-1},{"number":"8","revision":"c86756ae454a92690a1c9645202ee6fbc9a2f21b","parents":["20b2a635001f40d98b5639d28d10ba90238d190a"],"ref":"refs/changes/55/355/8","uploader":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"createdOn":1473930850,"author":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1473896435,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1473811987,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"SUBM","value":"1","grantedOn":1473931213,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1473864123,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/uts/common/Makefile.files","type":"MODIFIED","insertions":12,"deletions":0},{"file":"usr/src/uts/common/Makefile.rules","type":"MODIFIED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/io/cpqary3/cpqary3.c","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt.c","type":"ADDED","insertions":441,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt.conf","type":"ADDED","insertions":16,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_ciss.c","type":"ADDED","insertions":1119,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_ciss_simple.c","type":"ADDED","insertions":212,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_commands.c","type":"ADDED","insertions":325,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_device.c","type":"ADDED","insertions":215,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_hba.c","type":"ADDED","insertions":1073,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_interrupts.c","type":"ADDED","insertions":233,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_logvol.c","type":"ADDED","insertions":312,"deletions":0},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt.h","type":"ADDED","insertions":586,"deletions":0},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt_ciss.h","type":"ADDED","insertions":339,"deletions":0},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt_scsi.h","type":"ADDED","insertions":105,"deletions":0}],"sizeInsertions":4998,"sizeDeletions":-1}],"allReviewers":[{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}]}