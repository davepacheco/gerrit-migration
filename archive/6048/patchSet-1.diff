From d2befe6be8cea581993beb5fa743f775d2f64096 Mon Sep 17 00:00:00 2001
From: Trent Mick <trentm@gmail.com>
Date: Thu, 4 Apr 2019 14:48:54 -0700
Subject: [PATCH] TRITON-1370 drop FEATURE_ENABLE_VIRTUAL_SERVERS_FILTER guard
 on triton.placement.exclude_virtual_servers

---
 docs/index.md                 | 1 -
 docs/static.md                | 1 -
 package.json                  | 2 +-
 sapi_manifests/cnapi/template | 2 --
 4 files changed, 1 insertion(+), 5 deletions(-)

diff --git a/docs/index.md b/docs/index.md
index 19d6b41..455006d 100644
--- a/docs/index.md
+++ b/docs/index.md
@@ -124,7 +124,6 @@ specialized circumstances in production.
 | **ALLOC_WEIGHT_UNRESERVED_DISK**   | Float | 1.0   | Bias selection towards CNs with more unreserved disk.                        |
 | **ALLOC_WEIGHT_UNRESERVED_RAM**    | Float | 2.0   | Bias selection towards CNs with more unreserved memory.                      |
 | **FEATURE_USE_CNAGENT_COMMAND_EXECUTE** | Boolean | false | Experimental: Use cn-agent's command_execute function instead of Ur when available. |
-| **FEATURE_ENABLE_VIRTUAL_SERVERS_FILTER** | Boolean | false | Whether to enable the virtual server filtering. When enabled, during DAPI allocation, all virtual servers (e.g. mockcloud servers) will be filtered out if the vm is a docker vm, or the vm has the `triton.placement.exclude_virtual_servers` tag set to true. This virtual server filtering is needed for Triton testing, but should not be enabled for production environments. |
 
 If any of the keys above aren't in the `sdc` `metadata` section, it's treated as
 if the default value was specified. Be careful when changing from the default
diff --git a/docs/static.md b/docs/static.md
index fddec7c..91d2e56 100644
--- a/docs/static.md
+++ b/docs/static.md
@@ -93,7 +93,6 @@ specialized circumstances in production.
 | **ALLOC_WEIGHT_UNRESERVED_DISK**   | Float | 1.0   | Bias selection towards CNs with more unreserved disk.                        |
 | **ALLOC_WEIGHT_UNRESERVED_RAM**    | Float | 2.0   | Bias selection towards CNs with more unreserved memory.                      |
 | **FEATURE_USE_CNAGENT_COMMAND_EXECUTE** | Boolean | false | Experimental: Use cn-agent's command_execute function instead of Ur when available. |
-| **FEATURE_ENABLE_VIRTUAL_SERVERS_FILTER** | Boolean | false | Whether to enable the virtual server filtering. When enabled, during DAPI allocation, all virtual servers (e.g. mockcloud servers) will be filtered out if the vm is a docker vm, or the vm has the `triton.placement.exclude_virtual_servers` tag set to true. This virtual server filtering is needed for Triton testing, but should not be enabled for production environments. |
 
 If any of the keys above aren't in the `sdc` `metadata` section, it's treated as
 if the default value was specified. Be careful when changing from the default
diff --git a/package.json b/package.json
index 30ce103..a6bdc56 100644
--- a/package.json
+++ b/package.json
@@ -1,7 +1,7 @@
 {
   "name": "cnapi",
   "description": "SmartDataCenter Compute Node API",
-  "version": "1.22.1",
+  "version": "1.22.2",
   "author": "Joyent (joyent.com)",
   "private": true,
   "dependencies": {
diff --git a/sapi_manifests/cnapi/template b/sapi_manifests/cnapi/template
index 2dc3f6b..f683e57 100644
--- a/sapi_manifests/cnapi/template
+++ b/sapi_manifests/cnapi/template
@@ -79,9 +79,7 @@
 			        "hard-filter-running",
 			        "hard-filter-invalid-servers",
 			        "hard-filter-force-failure",
-{{#FEATURE_ENABLE_VIRTUAL_SERVERS_FILTER}}
 			        "hard-filter-virtual-servers",
-{{/FEATURE_ENABLE_VIRTUAL_SERVERS_FILTER}}
 			        "hard-filter-volumes-from",
 			        "hard-filter-reserved",
 			        "hard-filter-min-free-disk",
-- 
2.21.0

