From f565c3c61989ba7dd94c1e8a7a7ff7e1424badfa Mon Sep 17 00:00:00 2001
From: Trent Mick <trentm@gmail.com>
Date: Thu, 9 Mar 2017 16:25:12 -0800
Subject: [PATCH] IMGAPI-621 handling of query params with '.' broken since
 IMGAPI-587

---
 lib/app.js   | 6 +++++-
 package.json | 6 +++---
 2 files changed, 8 insertions(+), 4 deletions(-)

diff --git a/lib/app.js b/lib/app.js
index b08015a..4af886f 100644
--- a/lib/app.js
+++ b/lib/app.js
@@ -375,7 +375,11 @@ function App(config, log) {
         }
     });
 
-    server.use(restify.queryParser({mapParams: false}));
+    server.use(restify.queryParser({
+        mapParams: false,
+        allowDots: false,
+        plainObjects: false
+    }));
     server.on('after', function (req, res, route, err) {
         // Skip logging some high frequency or unimportant endpoints to key
         // log noise down.
diff --git a/package.json b/package.json
index 7596fb1..a00ca10 100644
--- a/package.json
+++ b/package.json
@@ -1,13 +1,13 @@
 {
   "name": "imgapi",
   "description": "Image API to manage images for SDC 7",
-  "version": "3.2.1",
+  "version": "3.2.2",
   "author": "Joyent (joyent.com)",
   "private": true,
   "dependencies": {
     "assert-plus": "1.0.0",
     "async": "0.7.0",
-    "bunyan": "1.8.1",
+    "bunyan": "1.8.8",
     "cmdln": "3.2.1",
     "dashdash": "1.10.0",
     "docker-registry-client": "3.2.6",
@@ -32,7 +32,7 @@
     "passwd": "0.0.11",
     "posix-getopt": "1.0.0",
     "progbar": "git+https://github.com/trentm/node-progbar.git#a4c56e6",
-    "restify": "4.1.1",
+    "restify": "4.3.0",
     "rimraf": "2.2.6",
     "sdc-clients": "10.0.4",
     "semver": "3.0.1",
-- 
2.21.0

