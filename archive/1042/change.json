{"project":"joyent/sdc-fwapi","branch":"master","topic":"FWAPI-260","id":"I6de21e3edab10df0aaed0fa02bdaad79b09c70ec","number":"1042","subject":"FWAPI-260 Tag names and values in rules need to be unescaped for comparisons FWAPI-259 Moray queries need to be escaped FWAPI-270 Use Moray client v2 Reviewed by: Chris Burroughs \u003cchris.burroughs@joyent.com\u003e Reviewed by: Orlando Vazquez \u003covazquez@gmail.co","owner":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"url":"https://cr.joyent.us/1042","commitMessage":"FWAPI-260 Tag names and values in rules need to be unescaped for comparisons\nFWAPI-259 Moray queries need to be escaped\nFWAPI-270 Use Moray client v2\nReviewed by: Chris Burroughs \u003cchris.burroughs@joyent.com\u003e\nReviewed by: Orlando Vazquez \u003covazquez@gmail.com\u003e\nApproved by: Orlando Vazquez \u003covazquez@gmail.com\u003e\n","createdOn":1480634331,"lastUpdated":1484349746,"open":false,"status":"MERGED","comments":[{"timestamp":1480634331,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 1."},{"timestamp":1480634384,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 2."},{"timestamp":1480634411,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 3."},{"timestamp":1480634435,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 4."},{"timestamp":1480634460,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 5."},{"timestamp":1480634482,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 6."},{"timestamp":1480634777,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 6:\n\nI have pushed multiple patchsets here to try and make this easier to review, since some of the changes are purely mechanical.\n\nAdd eslint for additional checks: https://cr.joyent.us/#/c/1042/1\nStop using .hasOwnProperty() method: https://cr.joyent.us/#/c/1042/1..2\nFWAPI-259 changes: https://cr.joyent.us/#/c/1042/2..3\nMoray client v2/migrate objects for FWAPI-260: https://cr.joyent.us/#/c/1042/3..4\nFWAPI-260 changes: https://cr.joyent.us/#/c/1042/4..5\nTruncate test descriptions: https://cr.joyent.us/#/c/1042/5..6\n\nPatchsets 3, 4 and 5 are the functional changes. If navigating the patchsets is unwieldy, you can look at the individual commits that they represent here:\n\nhttps://github.com/joyent/sdc-fwapi/commits/FWAPI-259"},{"timestamp":1480634800,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Topic set to FWAPI-260"},{"timestamp":1480635396,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1480635570,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1480635624,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 6: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1480711552,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Patch Set 6:\n\n(5 comments)\n\nTo make sure I have the context right: fwapi used to use ufds; a while ago it was switched to use moray directly; but it we still talk to both for legacy/migration reasons?\n\nShould we be doing `use strict` everywhere?\n\nI\u0027m confused about the `hasOwnProperty` --\u003e `jsprims.hasKey` change.  I thought `hasOwnProperty` was considered \"bad\" because it has subtle interactions with the prototype chain.  But it looks like `jpprims.hasKey` is just calling `Object.prototype.hasOwnProperty`.\n\nI\u0027m not sure I understand the full intent of the \"3..4\" patchset.  It looks like a lot more is going on there than just upgrading to moray v2."},{"timestamp":1480715179,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 6:\n\n(5 comments)\n\nFWAPI used to use UFDS (and still does in places that haven\u0027t migrated over yet.) I set it up to work with Moray for new installations, and to allow migrating to Moray from UFDS using a toggle in SAPI.\n\nYes, I want to use strict mode everywhere. I moved NAPI over to using strict mode everywhere in NAPI-362. It ensures that modifying objects sealed with Object.seal() will throw.\n\nThe issue is when you call hasOwnProperty() as a method on the object you want to check. Because it then walks up the prototype chain, if you call it on the result of JSON.parse(), or an object you\u0027re using as a key-value map with user-provided keys, you\u0027ll end up calling something that isn\u0027t a function. By using Object.prototype.hasOwnProperty, you always use the right function, and skip walking the target\u0027s prototype chain to find it.\n\nI initially was going to just change the usage in the areas where this was a problem, but I figured saying \"never use the method\" was an easier story to always get right.\n\nThe \"3..4\" patchset is a combination of Moray-related things:\n\n- Move to Moray client v2.\n- Refactor the bucket initialization code to take care of reindexing after schema changes.\n- Add unit tests for Moray logic using joyent/node-moray-sandbox.\n\nAdding the unit tests required reworking some of the setup/teardown code."},{"timestamp":1480715223,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 6:\n\nForgot to link to when FWAPI started using Moray: FWAPI-212"},{"timestamp":1480976466,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Patch Set 6: Code-Review+1\n\n(4 comments)\n\nI think moray v2 + reindexing are significant changes in their own right that would be worth calling out in their own ticket.  On that note I know Alex noticed a few more possible gotchas with moray v2 that might be relevant (MORAY-380, MORAY-381).\n\nI\u0027ve looked over the diffs to the best of my ability and I have not found anything significant.  I did add  a few more clarifying questions on my part.  I like the general trend from copy-paste format strings to dedicated functions and suspect that will reduce bugs in the long run.  ESLint also looks promising.  I think it would be best if someone whose first time looking at the fwapi code wasn\u0027t this review did the IA."},{"timestamp":1481068271,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 7: Commit message was updated."},{"timestamp":1481068314,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 8: Commit message was updated."},{"timestamp":1481068472,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 8:\n\n(4 comments)"},{"timestamp":1481076762,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 9."},{"timestamp":1481076868,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 9:\n\n(1 comment)"},{"timestamp":1481076911,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 10: Patch Set 9 was rebased."},{"timestamp":1481077316,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 9: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1481077500,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 10: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1481128208,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Patch Set 10: Code-Review+1"},{"timestamp":1484100848,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 11."},{"timestamp":1484101119,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 11: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1484161516,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Patch Set 11: Code-Review+1"},{"timestamp":1484253953,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Patch Set 11:\n\n(60 comments)\n\nSorry for the Copyright 2017 spam, I asked whether it was necessary but turns out it was... :(\n\nOne general comment, I\u0027d be cautious of search/replacing !\u003d with !\u003d\u003d and \u003d\u003d with \u003d\u003d\u003d (not that I\u0027m saying that\u0027s what you did here, ofcourse), my concern being NAPI implicitly depending on the weird casting rules JS applies when doing those comparisons and might subtly change in behaviour as a result of the change."},{"timestamp":1484254175,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Patch Set 11: Code-Review-1\n\nFor the dates maybe you could do something like this (I haven\u0027t tested this):\n\ngit diff master.. --name-only | xargs -n1 sed -i \".bak\" \u0027s/Copyright (c) 201[0-9],/Copyright (c) 2017,/\u0027"},{"timestamp":1484254182,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Patch Set 11: Code-Review+1"},{"timestamp":1484274355,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 12."},{"timestamp":1484274386,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 13: Commit message was updated."},{"timestamp":1484274480,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 13:\n\n(1 comment)"},{"timestamp":1484274652,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 12: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1484332436,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 14."},{"timestamp":1484332699,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 13: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1484333095,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 14: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1484333673,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 14:\n\n(2 comments)"},{"timestamp":1484334395,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Patch Set 14: Code-Review+1"},{"timestamp":1484349421,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Patch Set 14: Code-Review+1"},{"timestamp":1484349690,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Patch Set 14: Integration-Approval+1"},{"timestamp":1484349730,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 15: Commit message was updated."},{"timestamp":1484349746,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Cody Peter Mello"}],"currentPatchSet":{"number":"15","revision":"d31ccc0b3680315411b86af11fb9dd7a46dbbb94","parents":["af362d0b912f6c457afbe3a34cbd6ec1d723ab2f"],"ref":"refs/changes/42/1042/15","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1484349730,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1484333095,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1484334395,"by":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1484349421,"by":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1484349690,"by":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"}},{"type":"SUBM","value":"1","grantedOn":1484349746,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":12,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":26,"deletions":-7},{"file":"deps/jsstyle","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/app.js","type":"MODIFIED","insertions":58,"deletions":-31},{"file":"lib/cli.js","type":"MODIFIED","insertions":13,"deletions":-6},{"file":"lib/endpoints/common.js","type":"MODIFIED","insertions":7,"deletions":-5},{"file":"lib/endpoints/firewalls/vms.js","type":"MODIFIED","insertions":14,"deletions":-9},{"file":"lib/endpoints/index.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"lib/endpoints/ping.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"lib/endpoints/resolve.js","type":"MODIFIED","insertions":21,"deletions":-14},{"file":"lib/endpoints/rules/index.js","type":"MODIFIED","insertions":25,"deletions":-18},{"file":"lib/endpoints/rules/vms.js","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"lib/endpoints/updates.js","type":"MODIFIED","insertions":10,"deletions":-5},{"file":"lib/errors.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"lib/fwapi-cli.js","type":"MODIFIED","insertions":15,"deletions":-7},{"file":"lib/moray-migration.js","type":"MODIFIED","insertions":23,"deletions":-17},{"file":"lib/moray.js","type":"MODIFIED","insertions":488,"deletions":-45},{"file":"lib/persist.js","type":"MODIFIED","insertions":72,"deletions":-58},{"file":"lib/rule.js","type":"MODIFIED","insertions":105,"deletions":-67},{"file":"lib/ufds/filter.js","type":"MODIFIED","insertions":120,"deletions":-126},{"file":"lib/ufds/model.js","type":"MODIFIED","insertions":19,"deletions":-183},{"file":"lib/update.js","type":"MODIFIED","insertions":94,"deletions":-49},{"file":"lib/util/array.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"lib/util/constants.js","type":"MODIFIED","insertions":7,"deletions":-3},{"file":"lib/util/ip.js","type":"MODIFIED","insertions":3,"deletions":-37},{"file":"lib/util/obj.js","type":"DELETED","insertions":0,"deletions":-40},{"file":"lib/util/validate.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"package.json","type":"MODIFIED","insertions":13,"deletions":-7},{"file":"server.js","type":"MODIFIED","insertions":8,"deletions":-2},{"file":"test/integration/get.test.js","type":"MODIFIED","insertions":6,"deletions":-4},{"file":"test/integration/global.test.js","type":"MODIFIED","insertions":9,"deletions":-10},{"file":"test/integration/helpers.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"test/integration/list.test.js","type":"MODIFIED","insertions":8,"deletions":-9},{"file":"test/integration/provision.multi-test.js","type":"MODIFIED","insertions":9,"deletions":-10},{"file":"test/integration/resolve.test.js","type":"MODIFIED","insertions":385,"deletions":-39},{"file":"test/integration/update.test.js","type":"MODIFIED","insertions":20,"deletions":-10},{"file":"test/integration/vm-update.multi-test.js","type":"MODIFIED","insertions":4,"deletions":-2},{"file":"test/lib/client.js","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"test/lib/cn.js","type":"MODIFIED","insertions":14,"deletions":-13},{"file":"test/lib/common.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"test/lib/config.js","type":"MODIFIED","insertions":18,"deletions":-17},{"file":"test/lib/log.js","type":"MODIFIED","insertions":97,"deletions":-16},{"file":"test/lib/mock-moray.js","type":"DELETED","insertions":0,"deletions":-431},{"file":"test/lib/rule.js","type":"MODIFIED","insertions":53,"deletions":-20},{"file":"test/lib/trunc.js","type":"ADDED","insertions":137,"deletions":0},{"file":"test/lib/vm.js","type":"MODIFIED","insertions":13,"deletions":-6},{"file":"test/unit/data/migration.js","type":"ADDED","insertions":781,"deletions":0},{"file":"test/unit/helpers.js","type":"MODIFIED","insertions":160,"deletions":-60},{"file":"test/unit/mocks.js","type":"MODIFIED","insertions":37,"deletions":-28},{"file":"test/unit/moray.test.js","type":"ADDED","insertions":281,"deletions":0},{"file":"test/unit/rule.test.js","type":"MODIFIED","insertions":16,"deletions":-14},{"file":"test/unit/run.js","type":"ADDED","insertions":42,"deletions":0},{"file":"test/unit/ufds-smoke-test.test.js","type":"ADDED","insertions":396,"deletions":0},{"file":"test/unit/ufds-to-moray.test.js","type":"ADDED","insertions":281,"deletions":0},{"file":"test/unit/update.test.js","type":"MODIFIED","insertions":79,"deletions":-63},{"file":"test/unit/v1-to-latest.test.js","type":"ADDED","insertions":287,"deletions":0},{"file":"test/unit/wrap-integration.test.js","type":"ADDED","insertions":50,"deletions":0},{"file":"tools/eslint.node.conf","type":"ADDED","insertions":21,"deletions":0},{"file":"tools/jsl.node.conf","type":"MODIFIED","insertions":4,"deletions":-3}],"sizeInsertions":4381,"sizeDeletions":-1502},"patchSets":[{"number":"1","revision":"39f72ad314b8fb7714b57ffafe45e8489a93d2ff","parents":["25c312f2d00fad4bbef025ae1d05663e27fc959a"],"ref":"refs/changes/42/1042/1","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1480634331,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":15,"deletions":-4},{"file":"deps/jsstyle","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/app.js","type":"MODIFIED","insertions":18,"deletions":-10},{"file":"lib/cli.js","type":"MODIFIED","insertions":12,"deletions":-5},{"file":"lib/endpoints/common.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/endpoints/firewalls/vms.js","type":"MODIFIED","insertions":5,"deletions":-3},{"file":"lib/endpoints/index.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/endpoints/ping.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/endpoints/resolve.js","type":"MODIFIED","insertions":10,"deletions":-6},{"file":"lib/endpoints/rules/index.js","type":"MODIFIED","insertions":12,"deletions":-7},{"file":"lib/endpoints/rules/vms.js","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"lib/endpoints/updates.js","type":"MODIFIED","insertions":8,"deletions":-4},{"file":"lib/errors.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/fwapi-cli.js","type":"MODIFIED","insertions":14,"deletions":-6},{"file":"lib/moray-migration.js","type":"MODIFIED","insertions":10,"deletions":-4},{"file":"lib/persist.js","type":"MODIFIED","insertions":24,"deletions":-17},{"file":"lib/rule.js","type":"MODIFIED","insertions":7,"deletions":-24},{"file":"lib/ufds/filter.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/ufds/model.js","type":"MODIFIED","insertions":13,"deletions":-177},{"file":"lib/util/array.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/util/constants.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/util/ip.js","type":"MODIFIED","insertions":2,"deletions":-36},{"file":"lib/util/obj.js","type":"MODIFIED","insertions":3,"deletions":-5},{"file":"lib/util/validate.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":4,"deletions":-2},{"file":"server.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/integration/get.test.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/integration/global.test.js","type":"MODIFIED","insertions":8,"deletions":-9},{"file":"test/integration/helpers.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/integration/list.test.js","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"test/integration/provision.multi-test.js","type":"MODIFIED","insertions":4,"deletions":-5},{"file":"test/integration/resolve.test.js","type":"MODIFIED","insertions":8,"deletions":-5},{"file":"test/integration/update.test.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"test/integration/vm-update.multi-test.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/lib/client.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/lib/cn.js","type":"MODIFIED","insertions":10,"deletions":-9},{"file":"test/lib/common.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/lib/config.js","type":"MODIFIED","insertions":17,"deletions":-16},{"file":"test/lib/log.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/lib/rule.js","type":"MODIFIED","insertions":14,"deletions":-4},{"file":"test/lib/vm.js","type":"MODIFIED","insertions":12,"deletions":-5},{"file":"test/unit/helpers.js","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"test/unit/mocks.js","type":"MODIFIED","insertions":10,"deletions":-21},{"file":"test/unit/rule.test.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"test/unit/update.test.js","type":"MODIFIED","insertions":12,"deletions":-14},{"file":"tools/eslint.node.conf","type":"ADDED","insertions":21,"deletions":0},{"file":"tools/jsl.node.conf","type":"MODIFIED","insertions":4,"deletions":-3}],"sizeInsertions":324,"sizeDeletions":-411},{"number":"2","revision":"fad5b90b894286d49e5c2ea764918ab415730e1d","parents":["25c312f2d00fad4bbef025ae1d05663e27fc959a"],"ref":"refs/changes/42/1042/2","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1480634384,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":15,"deletions":-4},{"file":"deps/jsstyle","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/app.js","type":"MODIFIED","insertions":18,"deletions":-10},{"file":"lib/cli.js","type":"MODIFIED","insertions":12,"deletions":-5},{"file":"lib/endpoints/common.js","type":"MODIFIED","insertions":6,"deletions":-4},{"file":"lib/endpoints/firewalls/vms.js","type":"MODIFIED","insertions":13,"deletions":-8},{"file":"lib/endpoints/index.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/endpoints/ping.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/endpoints/resolve.js","type":"MODIFIED","insertions":19,"deletions":-13},{"file":"lib/endpoints/rules/index.js","type":"MODIFIED","insertions":24,"deletions":-17},{"file":"lib/endpoints/rules/vms.js","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"lib/endpoints/updates.js","type":"MODIFIED","insertions":10,"deletions":-5},{"file":"lib/errors.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/fwapi-cli.js","type":"MODIFIED","insertions":14,"deletions":-6},{"file":"lib/moray-migration.js","type":"MODIFIED","insertions":10,"deletions":-4},{"file":"lib/persist.js","type":"MODIFIED","insertions":33,"deletions":-23},{"file":"lib/rule.js","type":"MODIFIED","insertions":33,"deletions":-49},{"file":"lib/ufds/filter.js","type":"MODIFIED","insertions":17,"deletions":-13},{"file":"lib/ufds/model.js","type":"MODIFIED","insertions":13,"deletions":-177},{"file":"lib/update.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"lib/util/array.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/util/constants.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/util/ip.js","type":"MODIFIED","insertions":2,"deletions":-36},{"file":"lib/util/obj.js","type":"DELETED","insertions":0,"deletions":-40},{"file":"lib/util/validate.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"server.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/integration/get.test.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/integration/global.test.js","type":"MODIFIED","insertions":8,"deletions":-9},{"file":"test/integration/helpers.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/integration/list.test.js","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"test/integration/provision.multi-test.js","type":"MODIFIED","insertions":4,"deletions":-5},{"file":"test/integration/resolve.test.js","type":"MODIFIED","insertions":8,"deletions":-5},{"file":"test/integration/update.test.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"test/integration/vm-update.multi-test.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/lib/client.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/lib/cn.js","type":"MODIFIED","insertions":13,"deletions":-12},{"file":"test/lib/common.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/lib/config.js","type":"MODIFIED","insertions":17,"deletions":-16},{"file":"test/lib/log.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/lib/rule.js","type":"MODIFIED","insertions":14,"deletions":-4},{"file":"test/lib/vm.js","type":"MODIFIED","insertions":12,"deletions":-5},{"file":"test/unit/helpers.js","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"test/unit/mocks.js","type":"MODIFIED","insertions":10,"deletions":-21},{"file":"test/unit/rule.test.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"test/unit/update.test.js","type":"MODIFIED","insertions":12,"deletions":-14},{"file":"tools/eslint.node.conf","type":"ADDED","insertions":21,"deletions":0},{"file":"tools/jsl.node.conf","type":"MODIFIED","insertions":4,"deletions":-3}],"sizeInsertions":413,"sizeDeletions":-519},{"number":"3","revision":"79060e104c4c55142a622f7ab4093e8bab63643a","parents":["25c312f2d00fad4bbef025ae1d05663e27fc959a"],"ref":"refs/changes/42/1042/3","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1480634411,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":15,"deletions":-4},{"file":"deps/jsstyle","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/app.js","type":"MODIFIED","insertions":18,"deletions":-10},{"file":"lib/cli.js","type":"MODIFIED","insertions":12,"deletions":-5},{"file":"lib/endpoints/common.js","type":"MODIFIED","insertions":6,"deletions":-4},{"file":"lib/endpoints/firewalls/vms.js","type":"MODIFIED","insertions":13,"deletions":-8},{"file":"lib/endpoints/index.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/endpoints/ping.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/endpoints/resolve.js","type":"MODIFIED","insertions":19,"deletions":-13},{"file":"lib/endpoints/rules/index.js","type":"MODIFIED","insertions":24,"deletions":-17},{"file":"lib/endpoints/rules/vms.js","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"lib/endpoints/updates.js","type":"MODIFIED","insertions":10,"deletions":-5},{"file":"lib/errors.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/fwapi-cli.js","type":"MODIFIED","insertions":14,"deletions":-6},{"file":"lib/moray-migration.js","type":"MODIFIED","insertions":10,"deletions":-4},{"file":"lib/persist.js","type":"MODIFIED","insertions":33,"deletions":-23},{"file":"lib/rule.js","type":"MODIFIED","insertions":33,"deletions":-49},{"file":"lib/ufds/filter.js","type":"MODIFIED","insertions":119,"deletions":-125},{"file":"lib/ufds/model.js","type":"MODIFIED","insertions":13,"deletions":-177},{"file":"lib/update.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"lib/util/array.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/util/constants.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/util/ip.js","type":"MODIFIED","insertions":2,"deletions":-36},{"file":"lib/util/obj.js","type":"DELETED","insertions":0,"deletions":-40},{"file":"lib/util/validate.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"server.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/integration/get.test.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/integration/global.test.js","type":"MODIFIED","insertions":8,"deletions":-9},{"file":"test/integration/helpers.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/integration/list.test.js","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"test/integration/provision.multi-test.js","type":"MODIFIED","insertions":4,"deletions":-5},{"file":"test/integration/resolve.test.js","type":"MODIFIED","insertions":326,"deletions":-22},{"file":"test/integration/update.test.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"test/integration/vm-update.multi-test.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/lib/client.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/lib/cn.js","type":"MODIFIED","insertions":13,"deletions":-12},{"file":"test/lib/common.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/lib/config.js","type":"MODIFIED","insertions":17,"deletions":-16},{"file":"test/lib/log.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/lib/rule.js","type":"MODIFIED","insertions":14,"deletions":-4},{"file":"test/lib/vm.js","type":"MODIFIED","insertions":12,"deletions":-5},{"file":"test/unit/helpers.js","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"test/unit/mocks.js","type":"MODIFIED","insertions":10,"deletions":-21},{"file":"test/unit/rule.test.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"test/unit/update.test.js","type":"MODIFIED","insertions":12,"deletions":-14},{"file":"tools/eslint.node.conf","type":"ADDED","insertions":21,"deletions":0},{"file":"tools/jsl.node.conf","type":"MODIFIED","insertions":4,"deletions":-3}],"sizeInsertions":834,"sizeDeletions":-648},{"number":"4","revision":"b6e8134ae7ff310fe3188ec58cb604b8f3547887","parents":["25c312f2d00fad4bbef025ae1d05663e27fc959a"],"ref":"refs/changes/42/1042/4","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1480634435,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1480635396,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/moray.js","line":29,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Is this implying that the old records are not deleted?  If so, wouldn\u0027t FWAPI eventually take a very long time to start?"},{"file":"lib/moray.js","line":29,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"The old records are replaced with newer ones that have the new \"v\" field, so once a schema upgrade fully finishes, FWAPI won\u0027t find anything to upgrade the next time it starts up. This comment is just explaining that it has to check for old records each time it starts, because it may have crashed partway through a schema upgrade."},{"file":"lib/moray.js","line":268,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"These are still effectively \"infinite\" retries, because fwapi will just be restarted if it dies, correct?"},{"file":"lib/moray.js","line":268,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"That was my intent, but it looks like I need to modify server.js to make that happen. I\u0027ll do that an push a new patchset.\n\nBecause of the delays, it shouldn\u0027t enter maintenance, either."},{"file":"lib/moray.js","line":268,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Done. I tested bringing Moray offline while fwapi was starting up, and it threw the error after retrying multiple times (and produced a core file)."},{"file":"test/unit/run.js","line":8,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"nit: Is this the right copyright form?"},{"file":"test/unit/run.js","line":8,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"I took this from a file copyrighted to pmooney, but since I added things to it, I\u0027ll also leave a Joyent copyright."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":25,"deletions":-6},{"file":"deps/jsstyle","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/app.js","type":"MODIFIED","insertions":56,"deletions":-29},{"file":"lib/cli.js","type":"MODIFIED","insertions":12,"deletions":-5},{"file":"lib/endpoints/common.js","type":"MODIFIED","insertions":6,"deletions":-4},{"file":"lib/endpoints/firewalls/vms.js","type":"MODIFIED","insertions":13,"deletions":-8},{"file":"lib/endpoints/index.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/endpoints/ping.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/endpoints/resolve.js","type":"MODIFIED","insertions":19,"deletions":-13},{"file":"lib/endpoints/rules/index.js","type":"MODIFIED","insertions":24,"deletions":-17},{"file":"lib/endpoints/rules/vms.js","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"lib/endpoints/updates.js","type":"MODIFIED","insertions":10,"deletions":-5},{"file":"lib/errors.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/fwapi-cli.js","type":"MODIFIED","insertions":14,"deletions":-6},{"file":"lib/moray-migration.js","type":"MODIFIED","insertions":22,"deletions":-16},{"file":"lib/moray.js","type":"MODIFIED","insertions":488,"deletions":-45},{"file":"lib/persist.js","type":"MODIFIED","insertions":71,"deletions":-57},{"file":"lib/rule.js","type":"MODIFIED","insertions":74,"deletions":-58},{"file":"lib/ufds/filter.js","type":"MODIFIED","insertions":119,"deletions":-125},{"file":"lib/ufds/model.js","type":"MODIFIED","insertions":18,"deletions":-182},{"file":"lib/update.js","type":"MODIFIED","insertions":93,"deletions":-48},{"file":"lib/util/array.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/util/constants.js","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"lib/util/ip.js","type":"MODIFIED","insertions":2,"deletions":-36},{"file":"lib/util/obj.js","type":"DELETED","insertions":0,"deletions":-40},{"file":"lib/util/validate.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":12,"deletions":-6},{"file":"server.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/integration/get.test.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/integration/global.test.js","type":"MODIFIED","insertions":8,"deletions":-9},{"file":"test/integration/helpers.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/integration/list.test.js","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"test/integration/provision.multi-test.js","type":"MODIFIED","insertions":4,"deletions":-5},{"file":"test/integration/resolve.test.js","type":"MODIFIED","insertions":326,"deletions":-22},{"file":"test/integration/update.test.js","type":"MODIFIED","insertions":11,"deletions":-1},{"file":"test/integration/vm-update.multi-test.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/lib/client.js","type":"MODIFIED","insertions":3,"deletions":0},{"file":"test/lib/cn.js","type":"MODIFIED","insertions":14,"deletions":-13},{"file":"test/lib/common.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/lib/config.js","type":"MODIFIED","insertions":17,"deletions":-16},{"file":"test/lib/log.js","type":"MODIFIED","insertions":96,"deletions":-15},{"file":"test/lib/mock-moray.js","type":"DELETED","insertions":0,"deletions":-431},{"file":"test/lib/rule.js","type":"MODIFIED","insertions":25,"deletions":-13},{"file":"test/lib/vm.js","type":"MODIFIED","insertions":13,"deletions":-6},{"file":"test/unit/data/migration.js","type":"ADDED","insertions":781,"deletions":0},{"file":"test/unit/helpers.js","type":"MODIFIED","insertions":159,"deletions":-59},{"file":"test/unit/mocks.js","type":"MODIFIED","insertions":36,"deletions":-27},{"file":"test/unit/moray.test.js","type":"ADDED","insertions":281,"deletions":0},{"file":"test/unit/rule.test.js","type":"MODIFIED","insertions":12,"deletions":-10},{"file":"test/unit/run.js","type":"ADDED","insertions":41,"deletions":0},{"file":"test/unit/ufds-smoke-test.test.js","type":"ADDED","insertions":396,"deletions":0},{"file":"test/unit/ufds-to-moray.test.js","type":"ADDED","insertions":281,"deletions":0},{"file":"test/unit/update.test.js","type":"MODIFIED","insertions":78,"deletions":-62},{"file":"test/unit/v1-to-latest.test.js","type":"ADDED","insertions":287,"deletions":0},{"file":"test/unit/wrap-integration.test.js","type":"ADDED","insertions":50,"deletions":0},{"file":"tools/eslint.node.conf","type":"ADDED","insertions":21,"deletions":0},{"file":"tools/jsl.node.conf","type":"MODIFIED","insertions":4,"deletions":-3}],"sizeInsertions":4056,"sizeDeletions":-1405},{"number":"5","revision":"71f2687c2f59e253098d2f5a1830614ac7a931c4","parents":["25c312f2d00fad4bbef025ae1d05663e27fc959a"],"ref":"refs/changes/42/1042/5","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1480634460,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1480635570,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/rule.js","line":37,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Only the index on description is new, right?"},{"file":"lib/rule.js","line":37,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"The only new index is \"description\", and the format of \"fromtags\" and \"totags\" has changed."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":25,"deletions":-6},{"file":"deps/jsstyle","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/app.js","type":"MODIFIED","insertions":56,"deletions":-29},{"file":"lib/cli.js","type":"MODIFIED","insertions":12,"deletions":-5},{"file":"lib/endpoints/common.js","type":"MODIFIED","insertions":6,"deletions":-4},{"file":"lib/endpoints/firewalls/vms.js","type":"MODIFIED","insertions":13,"deletions":-8},{"file":"lib/endpoints/index.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/endpoints/ping.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/endpoints/resolve.js","type":"MODIFIED","insertions":19,"deletions":-13},{"file":"lib/endpoints/rules/index.js","type":"MODIFIED","insertions":24,"deletions":-17},{"file":"lib/endpoints/rules/vms.js","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"lib/endpoints/updates.js","type":"MODIFIED","insertions":10,"deletions":-5},{"file":"lib/errors.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/fwapi-cli.js","type":"MODIFIED","insertions":14,"deletions":-6},{"file":"lib/moray-migration.js","type":"MODIFIED","insertions":22,"deletions":-16},{"file":"lib/moray.js","type":"MODIFIED","insertions":488,"deletions":-45},{"file":"lib/persist.js","type":"MODIFIED","insertions":71,"deletions":-57},{"file":"lib/rule.js","type":"MODIFIED","insertions":104,"deletions":-66},{"file":"lib/ufds/filter.js","type":"MODIFIED","insertions":119,"deletions":-125},{"file":"lib/ufds/model.js","type":"MODIFIED","insertions":18,"deletions":-182},{"file":"lib/update.js","type":"MODIFIED","insertions":93,"deletions":-48},{"file":"lib/util/array.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/util/constants.js","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"lib/util/ip.js","type":"MODIFIED","insertions":2,"deletions":-36},{"file":"lib/util/obj.js","type":"DELETED","insertions":0,"deletions":-40},{"file":"lib/util/validate.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":13,"deletions":-7},{"file":"server.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/integration/get.test.js","type":"MODIFIED","insertions":5,"deletions":-3},{"file":"test/integration/global.test.js","type":"MODIFIED","insertions":8,"deletions":-9},{"file":"test/integration/helpers.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/integration/list.test.js","type":"MODIFIED","insertions":7,"deletions":-8},{"file":"test/integration/provision.multi-test.js","type":"MODIFIED","insertions":8,"deletions":-9},{"file":"test/integration/resolve.test.js","type":"MODIFIED","insertions":384,"deletions":-38},{"file":"test/integration/update.test.js","type":"MODIFIED","insertions":19,"deletions":-9},{"file":"test/integration/vm-update.multi-test.js","type":"MODIFIED","insertions":4,"deletions":-2},{"file":"test/lib/client.js","type":"MODIFIED","insertions":3,"deletions":0},{"file":"test/lib/cn.js","type":"MODIFIED","insertions":14,"deletions":-13},{"file":"test/lib/common.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/lib/config.js","type":"MODIFIED","insertions":17,"deletions":-16},{"file":"test/lib/log.js","type":"MODIFIED","insertions":96,"deletions":-15},{"file":"test/lib/mock-moray.js","type":"DELETED","insertions":0,"deletions":-431},{"file":"test/lib/rule.js","type":"MODIFIED","insertions":25,"deletions":-13},{"file":"test/lib/vm.js","type":"MODIFIED","insertions":13,"deletions":-6},{"file":"test/unit/data/migration.js","type":"ADDED","insertions":781,"deletions":0},{"file":"test/unit/helpers.js","type":"MODIFIED","insertions":159,"deletions":-59},{"file":"test/unit/mocks.js","type":"MODIFIED","insertions":36,"deletions":-27},{"file":"test/unit/moray.test.js","type":"ADDED","insertions":281,"deletions":0},{"file":"test/unit/rule.test.js","type":"MODIFIED","insertions":15,"deletions":-13},{"file":"test/unit/run.js","type":"ADDED","insertions":41,"deletions":0},{"file":"test/unit/ufds-smoke-test.test.js","type":"ADDED","insertions":396,"deletions":0},{"file":"test/unit/ufds-to-moray.test.js","type":"ADDED","insertions":281,"deletions":0},{"file":"test/unit/update.test.js","type":"MODIFIED","insertions":78,"deletions":-62},{"file":"test/unit/v1-to-latest.test.js","type":"ADDED","insertions":287,"deletions":0},{"file":"test/unit/wrap-integration.test.js","type":"ADDED","insertions":50,"deletions":0},{"file":"tools/eslint.node.conf","type":"ADDED","insertions":21,"deletions":0},{"file":"tools/jsl.node.conf","type":"MODIFIED","insertions":4,"deletions":-3}],"sizeInsertions":4170,"sizeDeletions":-1455},{"number":"6","revision":"60678e7ba07d5ea63d885c8673390ae8a8d1a337","parents":["25c312f2d00fad4bbef025ae1d05663e27fc959a"],"ref":"refs/changes/42/1042/6","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1480634482,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1480635624,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1480976466,"by":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"}}],"comments":[{"file":"lib/app.js","line":395,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Was this callback removed because it was never actually being called?"},{"file":"lib/app.js","line":395,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Yeah. The callback was never called, and nothing passes a callback to this function."},{"file":"lib/fwapi-cli.js","line":15,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Is this working around a bug in eslint?  Which variable is intentional not used?"},{"file":"lib/fwapi-cli.js","line":15,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"I disabled it because I wasn\u0027t sure how much I wanted to go through and clean up this code. As far as I know, no one actually uses this program inside the fwapi zone. Myself and I believe everyone else just uses sdc-fwapi from the HN GZ. Perhaps it would be better to just deprecate this..."},{"file":"lib/fwapi-cli.js","line":249,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"This works enableDisable is never actually called directly, only as part of do_{enable,disable}?"},{"file":"lib/fwapi-cli.js","line":249,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Yeah. I set up eslint to check that you this is only referenced when it\u0027s a function assigned to a prototype object, but this function gets bound below."},{"file":"lib/ufds/model.js","line":236,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"This is all dead code I take it?"},{"file":"lib/ufds/model.js","line":236,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Yep, this is all just dead code, leftover from the UFDS -\u003e Moray transition. lib/persist.js now takes care of a lot of this same stuff."},{"file":"lib/util/ip.js","line":56,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Just dead code, or something I should be paying more attention to?"},{"file":"lib/util/ip.js","line":56,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"This is all just dead code. I believe that this file was copied from sdc-napi.git at one point."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":25,"deletions":-6},{"file":"deps/jsstyle","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/app.js","type":"MODIFIED","insertions":56,"deletions":-29},{"file":"lib/cli.js","type":"MODIFIED","insertions":12,"deletions":-5},{"file":"lib/endpoints/common.js","type":"MODIFIED","insertions":6,"deletions":-4},{"file":"lib/endpoints/firewalls/vms.js","type":"MODIFIED","insertions":13,"deletions":-8},{"file":"lib/endpoints/index.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/endpoints/ping.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/endpoints/resolve.js","type":"MODIFIED","insertions":19,"deletions":-13},{"file":"lib/endpoints/rules/index.js","type":"MODIFIED","insertions":24,"deletions":-17},{"file":"lib/endpoints/rules/vms.js","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"lib/endpoints/updates.js","type":"MODIFIED","insertions":10,"deletions":-5},{"file":"lib/errors.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/fwapi-cli.js","type":"MODIFIED","insertions":14,"deletions":-6},{"file":"lib/moray-migration.js","type":"MODIFIED","insertions":22,"deletions":-16},{"file":"lib/moray.js","type":"MODIFIED","insertions":488,"deletions":-45},{"file":"lib/persist.js","type":"MODIFIED","insertions":71,"deletions":-57},{"file":"lib/rule.js","type":"MODIFIED","insertions":104,"deletions":-66},{"file":"lib/ufds/filter.js","type":"MODIFIED","insertions":119,"deletions":-125},{"file":"lib/ufds/model.js","type":"MODIFIED","insertions":18,"deletions":-182},{"file":"lib/update.js","type":"MODIFIED","insertions":93,"deletions":-48},{"file":"lib/util/array.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/util/constants.js","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"lib/util/ip.js","type":"MODIFIED","insertions":2,"deletions":-36},{"file":"lib/util/obj.js","type":"DELETED","insertions":0,"deletions":-40},{"file":"lib/util/validate.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":13,"deletions":-7},{"file":"server.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/integration/get.test.js","type":"MODIFIED","insertions":5,"deletions":-3},{"file":"test/integration/global.test.js","type":"MODIFIED","insertions":8,"deletions":-9},{"file":"test/integration/helpers.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/integration/list.test.js","type":"MODIFIED","insertions":7,"deletions":-8},{"file":"test/integration/provision.multi-test.js","type":"MODIFIED","insertions":8,"deletions":-9},{"file":"test/integration/resolve.test.js","type":"MODIFIED","insertions":384,"deletions":-38},{"file":"test/integration/update.test.js","type":"MODIFIED","insertions":19,"deletions":-9},{"file":"test/integration/vm-update.multi-test.js","type":"MODIFIED","insertions":4,"deletions":-2},{"file":"test/lib/client.js","type":"MODIFIED","insertions":3,"deletions":0},{"file":"test/lib/cn.js","type":"MODIFIED","insertions":14,"deletions":-13},{"file":"test/lib/common.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/lib/config.js","type":"MODIFIED","insertions":17,"deletions":-16},{"file":"test/lib/log.js","type":"MODIFIED","insertions":96,"deletions":-15},{"file":"test/lib/mock-moray.js","type":"DELETED","insertions":0,"deletions":-431},{"file":"test/lib/rule.js","type":"MODIFIED","insertions":52,"deletions":-19},{"file":"test/lib/trunc.js","type":"ADDED","insertions":137,"deletions":0},{"file":"test/lib/vm.js","type":"MODIFIED","insertions":13,"deletions":-6},{"file":"test/unit/data/migration.js","type":"ADDED","insertions":781,"deletions":0},{"file":"test/unit/helpers.js","type":"MODIFIED","insertions":159,"deletions":-59},{"file":"test/unit/mocks.js","type":"MODIFIED","insertions":36,"deletions":-27},{"file":"test/unit/moray.test.js","type":"ADDED","insertions":281,"deletions":0},{"file":"test/unit/rule.test.js","type":"MODIFIED","insertions":15,"deletions":-13},{"file":"test/unit/run.js","type":"ADDED","insertions":41,"deletions":0},{"file":"test/unit/ufds-smoke-test.test.js","type":"ADDED","insertions":396,"deletions":0},{"file":"test/unit/ufds-to-moray.test.js","type":"ADDED","insertions":281,"deletions":0},{"file":"test/unit/update.test.js","type":"MODIFIED","insertions":78,"deletions":-62},{"file":"test/unit/v1-to-latest.test.js","type":"ADDED","insertions":287,"deletions":0},{"file":"test/unit/wrap-integration.test.js","type":"ADDED","insertions":50,"deletions":0},{"file":"tools/eslint.node.conf","type":"ADDED","insertions":21,"deletions":0},{"file":"tools/jsl.node.conf","type":"MODIFIED","insertions":4,"deletions":-3}],"sizeInsertions":4334,"sizeDeletions":-1461},{"number":"7","revision":"baa58e827f078bda73d1e92d177ddb8e6f43eb0a","parents":["25c312f2d00fad4bbef025ae1d05663e27fc959a"],"ref":"refs/changes/42/1042/7","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1481068271,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1480635624,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1480976466,"by":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":25,"deletions":-6},{"file":"deps/jsstyle","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/app.js","type":"MODIFIED","insertions":56,"deletions":-29},{"file":"lib/cli.js","type":"MODIFIED","insertions":12,"deletions":-5},{"file":"lib/endpoints/common.js","type":"MODIFIED","insertions":6,"deletions":-4},{"file":"lib/endpoints/firewalls/vms.js","type":"MODIFIED","insertions":13,"deletions":-8},{"file":"lib/endpoints/index.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/endpoints/ping.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/endpoints/resolve.js","type":"MODIFIED","insertions":19,"deletions":-13},{"file":"lib/endpoints/rules/index.js","type":"MODIFIED","insertions":24,"deletions":-17},{"file":"lib/endpoints/rules/vms.js","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"lib/endpoints/updates.js","type":"MODIFIED","insertions":10,"deletions":-5},{"file":"lib/errors.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/fwapi-cli.js","type":"MODIFIED","insertions":14,"deletions":-6},{"file":"lib/moray-migration.js","type":"MODIFIED","insertions":22,"deletions":-16},{"file":"lib/moray.js","type":"MODIFIED","insertions":488,"deletions":-45},{"file":"lib/persist.js","type":"MODIFIED","insertions":71,"deletions":-57},{"file":"lib/rule.js","type":"MODIFIED","insertions":104,"deletions":-66},{"file":"lib/ufds/filter.js","type":"MODIFIED","insertions":119,"deletions":-125},{"file":"lib/ufds/model.js","type":"MODIFIED","insertions":18,"deletions":-182},{"file":"lib/update.js","type":"MODIFIED","insertions":93,"deletions":-48},{"file":"lib/util/array.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/util/constants.js","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"lib/util/ip.js","type":"MODIFIED","insertions":2,"deletions":-36},{"file":"lib/util/obj.js","type":"DELETED","insertions":0,"deletions":-40},{"file":"lib/util/validate.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":13,"deletions":-7},{"file":"server.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/integration/get.test.js","type":"MODIFIED","insertions":5,"deletions":-3},{"file":"test/integration/global.test.js","type":"MODIFIED","insertions":8,"deletions":-9},{"file":"test/integration/helpers.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/integration/list.test.js","type":"MODIFIED","insertions":7,"deletions":-8},{"file":"test/integration/provision.multi-test.js","type":"MODIFIED","insertions":8,"deletions":-9},{"file":"test/integration/resolve.test.js","type":"MODIFIED","insertions":384,"deletions":-38},{"file":"test/integration/update.test.js","type":"MODIFIED","insertions":19,"deletions":-9},{"file":"test/integration/vm-update.multi-test.js","type":"MODIFIED","insertions":4,"deletions":-2},{"file":"test/lib/client.js","type":"MODIFIED","insertions":3,"deletions":0},{"file":"test/lib/cn.js","type":"MODIFIED","insertions":14,"deletions":-13},{"file":"test/lib/common.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/lib/config.js","type":"MODIFIED","insertions":17,"deletions":-16},{"file":"test/lib/log.js","type":"MODIFIED","insertions":96,"deletions":-15},{"file":"test/lib/mock-moray.js","type":"DELETED","insertions":0,"deletions":-431},{"file":"test/lib/rule.js","type":"MODIFIED","insertions":52,"deletions":-19},{"file":"test/lib/trunc.js","type":"ADDED","insertions":137,"deletions":0},{"file":"test/lib/vm.js","type":"MODIFIED","insertions":13,"deletions":-6},{"file":"test/unit/data/migration.js","type":"ADDED","insertions":781,"deletions":0},{"file":"test/unit/helpers.js","type":"MODIFIED","insertions":159,"deletions":-59},{"file":"test/unit/mocks.js","type":"MODIFIED","insertions":36,"deletions":-27},{"file":"test/unit/moray.test.js","type":"ADDED","insertions":281,"deletions":0},{"file":"test/unit/rule.test.js","type":"MODIFIED","insertions":15,"deletions":-13},{"file":"test/unit/run.js","type":"ADDED","insertions":41,"deletions":0},{"file":"test/unit/ufds-smoke-test.test.js","type":"ADDED","insertions":396,"deletions":0},{"file":"test/unit/ufds-to-moray.test.js","type":"ADDED","insertions":281,"deletions":0},{"file":"test/unit/update.test.js","type":"MODIFIED","insertions":78,"deletions":-62},{"file":"test/unit/v1-to-latest.test.js","type":"ADDED","insertions":287,"deletions":0},{"file":"test/unit/wrap-integration.test.js","type":"ADDED","insertions":50,"deletions":0},{"file":"tools/eslint.node.conf","type":"ADDED","insertions":21,"deletions":0},{"file":"tools/jsl.node.conf","type":"MODIFIED","insertions":4,"deletions":-3}],"sizeInsertions":4334,"sizeDeletions":-1461},{"number":"8","revision":"78c50f244e799b67dca1ef92a85fc55f8447cb91","parents":["25c312f2d00fad4bbef025ae1d05663e27fc959a"],"ref":"refs/changes/42/1042/8","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1481068314,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1480635624,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1480976466,"by":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":25,"deletions":-6},{"file":"deps/jsstyle","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/app.js","type":"MODIFIED","insertions":56,"deletions":-29},{"file":"lib/cli.js","type":"MODIFIED","insertions":12,"deletions":-5},{"file":"lib/endpoints/common.js","type":"MODIFIED","insertions":6,"deletions":-4},{"file":"lib/endpoints/firewalls/vms.js","type":"MODIFIED","insertions":13,"deletions":-8},{"file":"lib/endpoints/index.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/endpoints/ping.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/endpoints/resolve.js","type":"MODIFIED","insertions":19,"deletions":-13},{"file":"lib/endpoints/rules/index.js","type":"MODIFIED","insertions":24,"deletions":-17},{"file":"lib/endpoints/rules/vms.js","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"lib/endpoints/updates.js","type":"MODIFIED","insertions":10,"deletions":-5},{"file":"lib/errors.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/fwapi-cli.js","type":"MODIFIED","insertions":14,"deletions":-6},{"file":"lib/moray-migration.js","type":"MODIFIED","insertions":22,"deletions":-16},{"file":"lib/moray.js","type":"MODIFIED","insertions":488,"deletions":-45},{"file":"lib/persist.js","type":"MODIFIED","insertions":71,"deletions":-57},{"file":"lib/rule.js","type":"MODIFIED","insertions":104,"deletions":-66},{"file":"lib/ufds/filter.js","type":"MODIFIED","insertions":119,"deletions":-125},{"file":"lib/ufds/model.js","type":"MODIFIED","insertions":18,"deletions":-182},{"file":"lib/update.js","type":"MODIFIED","insertions":93,"deletions":-48},{"file":"lib/util/array.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/util/constants.js","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"lib/util/ip.js","type":"MODIFIED","insertions":2,"deletions":-36},{"file":"lib/util/obj.js","type":"DELETED","insertions":0,"deletions":-40},{"file":"lib/util/validate.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":13,"deletions":-7},{"file":"server.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/integration/get.test.js","type":"MODIFIED","insertions":5,"deletions":-3},{"file":"test/integration/global.test.js","type":"MODIFIED","insertions":8,"deletions":-9},{"file":"test/integration/helpers.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/integration/list.test.js","type":"MODIFIED","insertions":7,"deletions":-8},{"file":"test/integration/provision.multi-test.js","type":"MODIFIED","insertions":8,"deletions":-9},{"file":"test/integration/resolve.test.js","type":"MODIFIED","insertions":384,"deletions":-38},{"file":"test/integration/update.test.js","type":"MODIFIED","insertions":19,"deletions":-9},{"file":"test/integration/vm-update.multi-test.js","type":"MODIFIED","insertions":4,"deletions":-2},{"file":"test/lib/client.js","type":"MODIFIED","insertions":3,"deletions":0},{"file":"test/lib/cn.js","type":"MODIFIED","insertions":14,"deletions":-13},{"file":"test/lib/common.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/lib/config.js","type":"MODIFIED","insertions":17,"deletions":-16},{"file":"test/lib/log.js","type":"MODIFIED","insertions":96,"deletions":-15},{"file":"test/lib/mock-moray.js","type":"DELETED","insertions":0,"deletions":-431},{"file":"test/lib/rule.js","type":"MODIFIED","insertions":52,"deletions":-19},{"file":"test/lib/trunc.js","type":"ADDED","insertions":137,"deletions":0},{"file":"test/lib/vm.js","type":"MODIFIED","insertions":13,"deletions":-6},{"file":"test/unit/data/migration.js","type":"ADDED","insertions":781,"deletions":0},{"file":"test/unit/helpers.js","type":"MODIFIED","insertions":159,"deletions":-59},{"file":"test/unit/mocks.js","type":"MODIFIED","insertions":36,"deletions":-27},{"file":"test/unit/moray.test.js","type":"ADDED","insertions":281,"deletions":0},{"file":"test/unit/rule.test.js","type":"MODIFIED","insertions":15,"deletions":-13},{"file":"test/unit/run.js","type":"ADDED","insertions":41,"deletions":0},{"file":"test/unit/ufds-smoke-test.test.js","type":"ADDED","insertions":396,"deletions":0},{"file":"test/unit/ufds-to-moray.test.js","type":"ADDED","insertions":281,"deletions":0},{"file":"test/unit/update.test.js","type":"MODIFIED","insertions":78,"deletions":-62},{"file":"test/unit/v1-to-latest.test.js","type":"ADDED","insertions":287,"deletions":0},{"file":"test/unit/wrap-integration.test.js","type":"ADDED","insertions":50,"deletions":0},{"file":"tools/eslint.node.conf","type":"ADDED","insertions":21,"deletions":0},{"file":"tools/jsl.node.conf","type":"MODIFIED","insertions":4,"deletions":-3}],"sizeInsertions":4334,"sizeDeletions":-1461},{"number":"9","revision":"b0f853325c617f7bb6d81e64575f9e4baccb0b1b","parents":["25c312f2d00fad4bbef025ae1d05663e27fc959a"],"ref":"refs/changes/42/1042/9","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1481076762,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1481077316,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":26,"deletions":-7},{"file":"deps/jsstyle","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/app.js","type":"MODIFIED","insertions":56,"deletions":-29},{"file":"lib/cli.js","type":"MODIFIED","insertions":12,"deletions":-5},{"file":"lib/endpoints/common.js","type":"MODIFIED","insertions":6,"deletions":-4},{"file":"lib/endpoints/firewalls/vms.js","type":"MODIFIED","insertions":13,"deletions":-8},{"file":"lib/endpoints/index.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/endpoints/ping.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/endpoints/resolve.js","type":"MODIFIED","insertions":19,"deletions":-13},{"file":"lib/endpoints/rules/index.js","type":"MODIFIED","insertions":24,"deletions":-17},{"file":"lib/endpoints/rules/vms.js","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"lib/endpoints/updates.js","type":"MODIFIED","insertions":10,"deletions":-5},{"file":"lib/errors.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/fwapi-cli.js","type":"MODIFIED","insertions":14,"deletions":-6},{"file":"lib/moray-migration.js","type":"MODIFIED","insertions":22,"deletions":-16},{"file":"lib/moray.js","type":"MODIFIED","insertions":488,"deletions":-45},{"file":"lib/persist.js","type":"MODIFIED","insertions":71,"deletions":-57},{"file":"lib/rule.js","type":"MODIFIED","insertions":104,"deletions":-66},{"file":"lib/ufds/filter.js","type":"MODIFIED","insertions":119,"deletions":-125},{"file":"lib/ufds/model.js","type":"MODIFIED","insertions":18,"deletions":-182},{"file":"lib/update.js","type":"MODIFIED","insertions":93,"deletions":-48},{"file":"lib/util/array.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/util/constants.js","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"lib/util/ip.js","type":"MODIFIED","insertions":2,"deletions":-36},{"file":"lib/util/obj.js","type":"DELETED","insertions":0,"deletions":-40},{"file":"lib/util/validate.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":13,"deletions":-7},{"file":"server.js","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"test/integration/get.test.js","type":"MODIFIED","insertions":5,"deletions":-3},{"file":"test/integration/global.test.js","type":"MODIFIED","insertions":8,"deletions":-9},{"file":"test/integration/helpers.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/integration/list.test.js","type":"MODIFIED","insertions":7,"deletions":-8},{"file":"test/integration/provision.multi-test.js","type":"MODIFIED","insertions":8,"deletions":-9},{"file":"test/integration/resolve.test.js","type":"MODIFIED","insertions":384,"deletions":-38},{"file":"test/integration/update.test.js","type":"MODIFIED","insertions":19,"deletions":-9},{"file":"test/integration/vm-update.multi-test.js","type":"MODIFIED","insertions":4,"deletions":-2},{"file":"test/lib/client.js","type":"MODIFIED","insertions":3,"deletions":0},{"file":"test/lib/cn.js","type":"MODIFIED","insertions":14,"deletions":-13},{"file":"test/lib/common.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/lib/config.js","type":"MODIFIED","insertions":17,"deletions":-16},{"file":"test/lib/log.js","type":"MODIFIED","insertions":96,"deletions":-15},{"file":"test/lib/mock-moray.js","type":"DELETED","insertions":0,"deletions":-431},{"file":"test/lib/rule.js","type":"MODIFIED","insertions":52,"deletions":-19},{"file":"test/lib/trunc.js","type":"ADDED","insertions":137,"deletions":0},{"file":"test/lib/vm.js","type":"MODIFIED","insertions":13,"deletions":-6},{"file":"test/unit/data/migration.js","type":"ADDED","insertions":781,"deletions":0},{"file":"test/unit/helpers.js","type":"MODIFIED","insertions":160,"deletions":-60},{"file":"test/unit/mocks.js","type":"MODIFIED","insertions":36,"deletions":-27},{"file":"test/unit/moray.test.js","type":"ADDED","insertions":281,"deletions":0},{"file":"test/unit/rule.test.js","type":"MODIFIED","insertions":15,"deletions":-13},{"file":"test/unit/run.js","type":"ADDED","insertions":42,"deletions":0},{"file":"test/unit/ufds-smoke-test.test.js","type":"ADDED","insertions":396,"deletions":0},{"file":"test/unit/ufds-to-moray.test.js","type":"ADDED","insertions":281,"deletions":0},{"file":"test/unit/update.test.js","type":"MODIFIED","insertions":78,"deletions":-62},{"file":"test/unit/v1-to-latest.test.js","type":"ADDED","insertions":287,"deletions":0},{"file":"test/unit/wrap-integration.test.js","type":"ADDED","insertions":50,"deletions":0},{"file":"tools/eslint.node.conf","type":"ADDED","insertions":21,"deletions":0},{"file":"tools/jsl.node.conf","type":"MODIFIED","insertions":4,"deletions":-3}],"sizeInsertions":4342,"sizeDeletions":-1464},{"number":"10","revision":"d61c09f427151be96cc321b5678386003248adb7","parents":["af362d0b912f6c457afbe3a34cbd6ec1d723ab2f"],"ref":"refs/changes/42/1042/10","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1481076911,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1481077500,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1481128208,"by":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":26,"deletions":-7},{"file":"deps/jsstyle","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/app.js","type":"MODIFIED","insertions":56,"deletions":-29},{"file":"lib/cli.js","type":"MODIFIED","insertions":12,"deletions":-5},{"file":"lib/endpoints/common.js","type":"MODIFIED","insertions":6,"deletions":-4},{"file":"lib/endpoints/firewalls/vms.js","type":"MODIFIED","insertions":13,"deletions":-8},{"file":"lib/endpoints/index.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/endpoints/ping.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/endpoints/resolve.js","type":"MODIFIED","insertions":19,"deletions":-13},{"file":"lib/endpoints/rules/index.js","type":"MODIFIED","insertions":24,"deletions":-17},{"file":"lib/endpoints/rules/vms.js","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"lib/endpoints/updates.js","type":"MODIFIED","insertions":10,"deletions":-5},{"file":"lib/errors.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/fwapi-cli.js","type":"MODIFIED","insertions":14,"deletions":-6},{"file":"lib/moray-migration.js","type":"MODIFIED","insertions":22,"deletions":-16},{"file":"lib/moray.js","type":"MODIFIED","insertions":488,"deletions":-45},{"file":"lib/persist.js","type":"MODIFIED","insertions":71,"deletions":-57},{"file":"lib/rule.js","type":"MODIFIED","insertions":104,"deletions":-66},{"file":"lib/ufds/filter.js","type":"MODIFIED","insertions":119,"deletions":-125},{"file":"lib/ufds/model.js","type":"MODIFIED","insertions":18,"deletions":-182},{"file":"lib/update.js","type":"MODIFIED","insertions":93,"deletions":-48},{"file":"lib/util/array.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/util/constants.js","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"lib/util/ip.js","type":"MODIFIED","insertions":2,"deletions":-36},{"file":"lib/util/obj.js","type":"DELETED","insertions":0,"deletions":-40},{"file":"lib/util/validate.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":13,"deletions":-7},{"file":"server.js","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"test/integration/get.test.js","type":"MODIFIED","insertions":5,"deletions":-3},{"file":"test/integration/global.test.js","type":"MODIFIED","insertions":8,"deletions":-9},{"file":"test/integration/helpers.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/integration/list.test.js","type":"MODIFIED","insertions":7,"deletions":-8},{"file":"test/integration/provision.multi-test.js","type":"MODIFIED","insertions":8,"deletions":-9},{"file":"test/integration/resolve.test.js","type":"MODIFIED","insertions":384,"deletions":-38},{"file":"test/integration/update.test.js","type":"MODIFIED","insertions":19,"deletions":-9},{"file":"test/integration/vm-update.multi-test.js","type":"MODIFIED","insertions":4,"deletions":-2},{"file":"test/lib/client.js","type":"MODIFIED","insertions":3,"deletions":0},{"file":"test/lib/cn.js","type":"MODIFIED","insertions":14,"deletions":-13},{"file":"test/lib/common.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/lib/config.js","type":"MODIFIED","insertions":17,"deletions":-16},{"file":"test/lib/log.js","type":"MODIFIED","insertions":96,"deletions":-15},{"file":"test/lib/mock-moray.js","type":"DELETED","insertions":0,"deletions":-431},{"file":"test/lib/rule.js","type":"MODIFIED","insertions":52,"deletions":-19},{"file":"test/lib/trunc.js","type":"ADDED","insertions":137,"deletions":0},{"file":"test/lib/vm.js","type":"MODIFIED","insertions":13,"deletions":-6},{"file":"test/unit/data/migration.js","type":"ADDED","insertions":781,"deletions":0},{"file":"test/unit/helpers.js","type":"MODIFIED","insertions":160,"deletions":-60},{"file":"test/unit/mocks.js","type":"MODIFIED","insertions":36,"deletions":-27},{"file":"test/unit/moray.test.js","type":"ADDED","insertions":281,"deletions":0},{"file":"test/unit/rule.test.js","type":"MODIFIED","insertions":15,"deletions":-13},{"file":"test/unit/run.js","type":"ADDED","insertions":42,"deletions":0},{"file":"test/unit/ufds-smoke-test.test.js","type":"ADDED","insertions":396,"deletions":0},{"file":"test/unit/ufds-to-moray.test.js","type":"ADDED","insertions":281,"deletions":0},{"file":"test/unit/update.test.js","type":"MODIFIED","insertions":78,"deletions":-62},{"file":"test/unit/v1-to-latest.test.js","type":"ADDED","insertions":287,"deletions":0},{"file":"test/unit/wrap-integration.test.js","type":"ADDED","insertions":50,"deletions":0},{"file":"tools/eslint.node.conf","type":"ADDED","insertions":21,"deletions":0},{"file":"tools/jsl.node.conf","type":"MODIFIED","insertions":4,"deletions":-3}],"sizeInsertions":4342,"sizeDeletions":-1464},{"number":"11","revision":"0ce0d335bba81b5bbb782777007c8bf134a731e8","parents":["af362d0b912f6c457afbe3a34cbd6ec1d723ab2f"],"ref":"refs/changes/42/1042/11","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1484100848,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1484101119,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1484254182,"by":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1484161516,"by":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"}}],"comments":[{"file":"Makefile","line":8,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"2017"},{"file":"lib/app.js","line":8,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"2017"},{"file":"lib/app.js","line":252,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"is it possible that if this code path is reached and the setTimeout is run, calling `self.initializeClients()` we won\u0027t be passing a callback causing an error down the line if/when it succeeds? Previously `self.initializeClients()` didn\u0027t take a callback."},{"file":"lib/cli.js","line":23,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"2017"},{"file":"lib/endpoints/common.js","line":8,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"2017"},{"file":"lib/endpoints/firewalls/vms.js","line":8,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"2017"},{"file":"lib/endpoints/index.js","line":8,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"2017"},{"file":"lib/endpoints/ping.js","line":8,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"2017"},{"file":"lib/endpoints/resolve.js","line":8,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"2017"},{"file":"lib/endpoints/resolve.js","line":132,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"though not strictly necessary, might be good and safe to add a return after this line (even though i know there\u0027s nothing following the `if` block)"},{"file":"lib/endpoints/rules/index.js","line":8,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"2017"},{"file":"lib/endpoints/rules/vms.js","line":8,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"2017"},{"file":"lib/endpoints/updates.js","line":8,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"2017"},{"file":"lib/errors.js","line":8,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"2017"},{"file":"lib/fwapi-cli.js","line":8,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"2017"},{"file":"lib/moray-migration.js","line":8,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"2017"},{"file":"lib/moray-migration.js","line":48,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Tiny nit: is the return value significant here? I noticed elsewhere you are breaking the final callback/function/method calls and return statements onto separate lines, is this a candidate for doing the same? I\u0027m not sure what batch returns but it seems like the type of object createRules returns might differ from the original pre-change code."},{"file":"lib/moray-migration.js","line":48,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":".batch() returns the object that was returned in the old code, so it maps the \"rules\" array into an array of batch objects."},{"file":"lib/moray.js","line":8,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"2017"},{"file":"lib/persist.js","line":8,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"2017"},{"file":"lib/rule.js","line":8,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"2017"},{"file":"lib/ufds/filter.js","line":8,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"2017"},{"file":"lib/ufds/model.js","line":8,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"2017"},{"file":"lib/ufds/model.js","line":132,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"may want to use VError.hasCauseWithName here?"},{"file":"lib/ufds/model.js","line":132,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Since this depends on also checking the message for the \u0027already exists\u0027, I think I\u0027m going to leave it this way for now."},{"file":"lib/update.js","line":8,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"2017"},{"file":"lib/util/array.js","line":8,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"2017"},{"file":"lib/util/constants.js","line":8,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"2017"},{"file":"lib/util/ip.js","line":8,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"2017"},{"file":"lib/util/validate.js","line":8,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"2017"},{"file":"package.json","line":10,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"fix to specific version - IMO using ^ opens you up to unintentionally picking up untested changes (WRT to NAPI) down the line you may not want and could bite you later"},{"file":"package.json","line":26,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"fix to specific version"},{"file":"package.json","line":35,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"fix to specific version"},{"file":"server.js","line":8,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"2017"},{"file":"test/integration/get.test.js","line":8,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"2017"},{"file":"test/integration/global.test.js","line":8,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"2017"},{"file":"test/integration/global.test.js","line":29,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"not sure if this would be better with a more explicit `owner_uuid`"},{"file":"test/integration/global.test.js","line":29,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"I think that the InvalidParameter error takes care of calling out the \u0027owner_uuid\u0027 field."},{"file":"test/integration/helpers.js","line":8,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"2017"},{"file":"test/integration/list.test.js","line":8,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"2017"},{"file":"test/integration/provision.multi-test.js","line":8,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"2017"},{"file":"test/integration/resolve.test.js","line":8,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"2017"},{"file":"test/integration/update.test.js","line":8,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"2017"},{"file":"test/integration/vm-update.multi-test.js","line":8,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"2017"},{"file":"test/lib/client.js","line":8,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"2017"},{"file":"test/lib/cn.js","line":8,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"2017"},{"file":"test/lib/common.js","line":8,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"2017"},{"file":"test/lib/config.js","line":8,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"2017"},{"file":"test/lib/log.js","line":8,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"2017"},{"file":"test/lib/rule.js","line":8,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"2017"},{"file":"test/lib/trunc.js","line":8,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"2017"},{"file":"test/lib/vm.js","line":8,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"2017"},{"file":"test/unit/data/migration.js","line":8,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"2017"},{"file":"test/unit/helpers.js","line":8,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"2017"},{"file":"test/unit/mocks.js","line":8,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"2017"},{"file":"test/unit/moray.test.js","line":8,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"2017"},{"file":"test/unit/rule.test.js","line":8,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"2017"},{"file":"test/unit/run.js","line":8,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"2017"},{"file":"test/unit/ufds-smoke-test.test.js","line":8,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"2017"},{"file":"test/unit/ufds-to-moray.test.js","line":8,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"2017"},{"file":"test/unit/update.test.js","line":8,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"2017"},{"file":"test/unit/v1-to-latest.test.js","line":8,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"2017"},{"file":"test/unit/wrap-integration.test.js","line":8,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"2017"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":26,"deletions":-7},{"file":"deps/jsstyle","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/app.js","type":"MODIFIED","insertions":56,"deletions":-29},{"file":"lib/cli.js","type":"MODIFIED","insertions":12,"deletions":-5},{"file":"lib/endpoints/common.js","type":"MODIFIED","insertions":6,"deletions":-4},{"file":"lib/endpoints/firewalls/vms.js","type":"MODIFIED","insertions":13,"deletions":-8},{"file":"lib/endpoints/index.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/endpoints/ping.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/endpoints/resolve.js","type":"MODIFIED","insertions":19,"deletions":-13},{"file":"lib/endpoints/rules/index.js","type":"MODIFIED","insertions":24,"deletions":-17},{"file":"lib/endpoints/rules/vms.js","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"lib/endpoints/updates.js","type":"MODIFIED","insertions":10,"deletions":-5},{"file":"lib/errors.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/fwapi-cli.js","type":"MODIFIED","insertions":14,"deletions":-6},{"file":"lib/moray-migration.js","type":"MODIFIED","insertions":22,"deletions":-16},{"file":"lib/moray.js","type":"MODIFIED","insertions":488,"deletions":-45},{"file":"lib/persist.js","type":"MODIFIED","insertions":71,"deletions":-57},{"file":"lib/rule.js","type":"MODIFIED","insertions":104,"deletions":-66},{"file":"lib/ufds/filter.js","type":"MODIFIED","insertions":119,"deletions":-125},{"file":"lib/ufds/model.js","type":"MODIFIED","insertions":18,"deletions":-182},{"file":"lib/update.js","type":"MODIFIED","insertions":93,"deletions":-48},{"file":"lib/util/array.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/util/constants.js","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"lib/util/ip.js","type":"MODIFIED","insertions":2,"deletions":-36},{"file":"lib/util/obj.js","type":"DELETED","insertions":0,"deletions":-40},{"file":"lib/util/validate.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":13,"deletions":-7},{"file":"server.js","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"test/integration/get.test.js","type":"MODIFIED","insertions":5,"deletions":-3},{"file":"test/integration/global.test.js","type":"MODIFIED","insertions":8,"deletions":-9},{"file":"test/integration/helpers.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/integration/list.test.js","type":"MODIFIED","insertions":7,"deletions":-8},{"file":"test/integration/provision.multi-test.js","type":"MODIFIED","insertions":8,"deletions":-9},{"file":"test/integration/resolve.test.js","type":"MODIFIED","insertions":384,"deletions":-38},{"file":"test/integration/update.test.js","type":"MODIFIED","insertions":19,"deletions":-9},{"file":"test/integration/vm-update.multi-test.js","type":"MODIFIED","insertions":4,"deletions":-2},{"file":"test/lib/client.js","type":"MODIFIED","insertions":3,"deletions":0},{"file":"test/lib/cn.js","type":"MODIFIED","insertions":14,"deletions":-13},{"file":"test/lib/common.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/lib/config.js","type":"MODIFIED","insertions":17,"deletions":-16},{"file":"test/lib/log.js","type":"MODIFIED","insertions":96,"deletions":-15},{"file":"test/lib/mock-moray.js","type":"DELETED","insertions":0,"deletions":-431},{"file":"test/lib/rule.js","type":"MODIFIED","insertions":52,"deletions":-19},{"file":"test/lib/trunc.js","type":"ADDED","insertions":137,"deletions":0},{"file":"test/lib/vm.js","type":"MODIFIED","insertions":13,"deletions":-6},{"file":"test/unit/data/migration.js","type":"ADDED","insertions":781,"deletions":0},{"file":"test/unit/helpers.js","type":"MODIFIED","insertions":160,"deletions":-60},{"file":"test/unit/mocks.js","type":"MODIFIED","insertions":36,"deletions":-27},{"file":"test/unit/moray.test.js","type":"ADDED","insertions":281,"deletions":0},{"file":"test/unit/rule.test.js","type":"MODIFIED","insertions":15,"deletions":-13},{"file":"test/unit/run.js","type":"ADDED","insertions":42,"deletions":0},{"file":"test/unit/ufds-smoke-test.test.js","type":"ADDED","insertions":396,"deletions":0},{"file":"test/unit/ufds-to-moray.test.js","type":"ADDED","insertions":281,"deletions":0},{"file":"test/unit/update.test.js","type":"MODIFIED","insertions":78,"deletions":-62},{"file":"test/unit/v1-to-latest.test.js","type":"ADDED","insertions":287,"deletions":0},{"file":"test/unit/wrap-integration.test.js","type":"ADDED","insertions":50,"deletions":0},{"file":"tools/eslint.node.conf","type":"ADDED","insertions":21,"deletions":0},{"file":"tools/jsl.node.conf","type":"MODIFIED","insertions":4,"deletions":-3}],"sizeInsertions":4342,"sizeDeletions":-1464},{"number":"12","revision":"36f8aee77aa2fb6192ac57a12a8e7832f0afb0ac","parents":["af362d0b912f6c457afbe3a34cbd6ec1d723ab2f"],"ref":"refs/changes/42/1042/12","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1484274355,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1484274652,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":26,"deletions":-7},{"file":"deps/jsstyle","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/app.js","type":"MODIFIED","insertions":58,"deletions":-31},{"file":"lib/cli.js","type":"MODIFIED","insertions":13,"deletions":-6},{"file":"lib/endpoints/common.js","type":"MODIFIED","insertions":7,"deletions":-5},{"file":"lib/endpoints/firewalls/vms.js","type":"MODIFIED","insertions":14,"deletions":-9},{"file":"lib/endpoints/index.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"lib/endpoints/ping.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"lib/endpoints/resolve.js","type":"MODIFIED","insertions":20,"deletions":-14},{"file":"lib/endpoints/rules/index.js","type":"MODIFIED","insertions":25,"deletions":-18},{"file":"lib/endpoints/rules/vms.js","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"lib/endpoints/updates.js","type":"MODIFIED","insertions":10,"deletions":-5},{"file":"lib/errors.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"lib/fwapi-cli.js","type":"MODIFIED","insertions":15,"deletions":-7},{"file":"lib/moray-migration.js","type":"MODIFIED","insertions":23,"deletions":-17},{"file":"lib/moray.js","type":"MODIFIED","insertions":488,"deletions":-45},{"file":"lib/persist.js","type":"MODIFIED","insertions":72,"deletions":-58},{"file":"lib/rule.js","type":"MODIFIED","insertions":105,"deletions":-67},{"file":"lib/ufds/filter.js","type":"MODIFIED","insertions":120,"deletions":-126},{"file":"lib/ufds/model.js","type":"MODIFIED","insertions":19,"deletions":-183},{"file":"lib/update.js","type":"MODIFIED","insertions":94,"deletions":-49},{"file":"lib/util/array.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"lib/util/constants.js","type":"MODIFIED","insertions":7,"deletions":-3},{"file":"lib/util/ip.js","type":"MODIFIED","insertions":3,"deletions":-37},{"file":"lib/util/obj.js","type":"DELETED","insertions":0,"deletions":-40},{"file":"lib/util/validate.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"package.json","type":"MODIFIED","insertions":13,"deletions":-7},{"file":"server.js","type":"MODIFIED","insertions":8,"deletions":-2},{"file":"test/integration/get.test.js","type":"MODIFIED","insertions":6,"deletions":-4},{"file":"test/integration/global.test.js","type":"MODIFIED","insertions":9,"deletions":-10},{"file":"test/integration/helpers.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"test/integration/list.test.js","type":"MODIFIED","insertions":8,"deletions":-9},{"file":"test/integration/provision.multi-test.js","type":"MODIFIED","insertions":9,"deletions":-10},{"file":"test/integration/resolve.test.js","type":"MODIFIED","insertions":385,"deletions":-39},{"file":"test/integration/update.test.js","type":"MODIFIED","insertions":20,"deletions":-10},{"file":"test/integration/vm-update.multi-test.js","type":"MODIFIED","insertions":4,"deletions":-2},{"file":"test/lib/client.js","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"test/lib/cn.js","type":"MODIFIED","insertions":14,"deletions":-13},{"file":"test/lib/common.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"test/lib/config.js","type":"MODIFIED","insertions":18,"deletions":-17},{"file":"test/lib/log.js","type":"MODIFIED","insertions":97,"deletions":-16},{"file":"test/lib/mock-moray.js","type":"DELETED","insertions":0,"deletions":-431},{"file":"test/lib/rule.js","type":"MODIFIED","insertions":53,"deletions":-20},{"file":"test/lib/trunc.js","type":"ADDED","insertions":137,"deletions":0},{"file":"test/lib/vm.js","type":"MODIFIED","insertions":13,"deletions":-6},{"file":"test/unit/data/migration.js","type":"ADDED","insertions":781,"deletions":0},{"file":"test/unit/helpers.js","type":"MODIFIED","insertions":160,"deletions":-60},{"file":"test/unit/mocks.js","type":"MODIFIED","insertions":37,"deletions":-28},{"file":"test/unit/moray.test.js","type":"ADDED","insertions":281,"deletions":0},{"file":"test/unit/rule.test.js","type":"MODIFIED","insertions":16,"deletions":-14},{"file":"test/unit/run.js","type":"ADDED","insertions":42,"deletions":0},{"file":"test/unit/ufds-smoke-test.test.js","type":"ADDED","insertions":396,"deletions":0},{"file":"test/unit/ufds-to-moray.test.js","type":"ADDED","insertions":281,"deletions":0},{"file":"test/unit/update.test.js","type":"MODIFIED","insertions":79,"deletions":-63},{"file":"test/unit/v1-to-latest.test.js","type":"ADDED","insertions":287,"deletions":0},{"file":"test/unit/wrap-integration.test.js","type":"ADDED","insertions":50,"deletions":0},{"file":"tools/eslint.node.conf","type":"ADDED","insertions":21,"deletions":0},{"file":"tools/jsl.node.conf","type":"MODIFIED","insertions":4,"deletions":-3}],"sizeInsertions":4380,"sizeDeletions":-1502},{"number":"13","revision":"0ef45d7509d61c215aa7b3061fada9efee384b02","parents":["af362d0b912f6c457afbe3a34cbd6ec1d723ab2f"],"ref":"refs/changes/42/1042/13","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1484274386,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1484332699,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":26,"deletions":-7},{"file":"deps/jsstyle","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/app.js","type":"MODIFIED","insertions":58,"deletions":-31},{"file":"lib/cli.js","type":"MODIFIED","insertions":13,"deletions":-6},{"file":"lib/endpoints/common.js","type":"MODIFIED","insertions":7,"deletions":-5},{"file":"lib/endpoints/firewalls/vms.js","type":"MODIFIED","insertions":14,"deletions":-9},{"file":"lib/endpoints/index.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"lib/endpoints/ping.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"lib/endpoints/resolve.js","type":"MODIFIED","insertions":20,"deletions":-14},{"file":"lib/endpoints/rules/index.js","type":"MODIFIED","insertions":25,"deletions":-18},{"file":"lib/endpoints/rules/vms.js","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"lib/endpoints/updates.js","type":"MODIFIED","insertions":10,"deletions":-5},{"file":"lib/errors.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"lib/fwapi-cli.js","type":"MODIFIED","insertions":15,"deletions":-7},{"file":"lib/moray-migration.js","type":"MODIFIED","insertions":23,"deletions":-17},{"file":"lib/moray.js","type":"MODIFIED","insertions":488,"deletions":-45},{"file":"lib/persist.js","type":"MODIFIED","insertions":72,"deletions":-58},{"file":"lib/rule.js","type":"MODIFIED","insertions":105,"deletions":-67},{"file":"lib/ufds/filter.js","type":"MODIFIED","insertions":120,"deletions":-126},{"file":"lib/ufds/model.js","type":"MODIFIED","insertions":19,"deletions":-183},{"file":"lib/update.js","type":"MODIFIED","insertions":94,"deletions":-49},{"file":"lib/util/array.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"lib/util/constants.js","type":"MODIFIED","insertions":7,"deletions":-3},{"file":"lib/util/ip.js","type":"MODIFIED","insertions":3,"deletions":-37},{"file":"lib/util/obj.js","type":"DELETED","insertions":0,"deletions":-40},{"file":"lib/util/validate.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"package.json","type":"MODIFIED","insertions":13,"deletions":-7},{"file":"server.js","type":"MODIFIED","insertions":8,"deletions":-2},{"file":"test/integration/get.test.js","type":"MODIFIED","insertions":6,"deletions":-4},{"file":"test/integration/global.test.js","type":"MODIFIED","insertions":9,"deletions":-10},{"file":"test/integration/helpers.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"test/integration/list.test.js","type":"MODIFIED","insertions":8,"deletions":-9},{"file":"test/integration/provision.multi-test.js","type":"MODIFIED","insertions":9,"deletions":-10},{"file":"test/integration/resolve.test.js","type":"MODIFIED","insertions":385,"deletions":-39},{"file":"test/integration/update.test.js","type":"MODIFIED","insertions":20,"deletions":-10},{"file":"test/integration/vm-update.multi-test.js","type":"MODIFIED","insertions":4,"deletions":-2},{"file":"test/lib/client.js","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"test/lib/cn.js","type":"MODIFIED","insertions":14,"deletions":-13},{"file":"test/lib/common.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"test/lib/config.js","type":"MODIFIED","insertions":18,"deletions":-17},{"file":"test/lib/log.js","type":"MODIFIED","insertions":97,"deletions":-16},{"file":"test/lib/mock-moray.js","type":"DELETED","insertions":0,"deletions":-431},{"file":"test/lib/rule.js","type":"MODIFIED","insertions":53,"deletions":-20},{"file":"test/lib/trunc.js","type":"ADDED","insertions":137,"deletions":0},{"file":"test/lib/vm.js","type":"MODIFIED","insertions":13,"deletions":-6},{"file":"test/unit/data/migration.js","type":"ADDED","insertions":781,"deletions":0},{"file":"test/unit/helpers.js","type":"MODIFIED","insertions":160,"deletions":-60},{"file":"test/unit/mocks.js","type":"MODIFIED","insertions":37,"deletions":-28},{"file":"test/unit/moray.test.js","type":"ADDED","insertions":281,"deletions":0},{"file":"test/unit/rule.test.js","type":"MODIFIED","insertions":16,"deletions":-14},{"file":"test/unit/run.js","type":"ADDED","insertions":42,"deletions":0},{"file":"test/unit/ufds-smoke-test.test.js","type":"ADDED","insertions":396,"deletions":0},{"file":"test/unit/ufds-to-moray.test.js","type":"ADDED","insertions":281,"deletions":0},{"file":"test/unit/update.test.js","type":"MODIFIED","insertions":79,"deletions":-63},{"file":"test/unit/v1-to-latest.test.js","type":"ADDED","insertions":287,"deletions":0},{"file":"test/unit/wrap-integration.test.js","type":"ADDED","insertions":50,"deletions":0},{"file":"tools/eslint.node.conf","type":"ADDED","insertions":21,"deletions":0},{"file":"tools/jsl.node.conf","type":"MODIFIED","insertions":4,"deletions":-3}],"sizeInsertions":4380,"sizeDeletions":-1502},{"number":"14","revision":"6de21e3edab10df0aaed0fa02bdaad79b09c70ec","parents":["af362d0b912f6c457afbe3a34cbd6ec1d723ab2f"],"ref":"refs/changes/42/1042/14","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1484332436,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1484333095,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1484349421,"by":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1484349690,"by":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1484334395,"by":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":26,"deletions":-7},{"file":"deps/jsstyle","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/app.js","type":"MODIFIED","insertions":58,"deletions":-31},{"file":"lib/cli.js","type":"MODIFIED","insertions":13,"deletions":-6},{"file":"lib/endpoints/common.js","type":"MODIFIED","insertions":7,"deletions":-5},{"file":"lib/endpoints/firewalls/vms.js","type":"MODIFIED","insertions":14,"deletions":-9},{"file":"lib/endpoints/index.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"lib/endpoints/ping.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"lib/endpoints/resolve.js","type":"MODIFIED","insertions":21,"deletions":-14},{"file":"lib/endpoints/rules/index.js","type":"MODIFIED","insertions":25,"deletions":-18},{"file":"lib/endpoints/rules/vms.js","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"lib/endpoints/updates.js","type":"MODIFIED","insertions":10,"deletions":-5},{"file":"lib/errors.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"lib/fwapi-cli.js","type":"MODIFIED","insertions":15,"deletions":-7},{"file":"lib/moray-migration.js","type":"MODIFIED","insertions":23,"deletions":-17},{"file":"lib/moray.js","type":"MODIFIED","insertions":488,"deletions":-45},{"file":"lib/persist.js","type":"MODIFIED","insertions":72,"deletions":-58},{"file":"lib/rule.js","type":"MODIFIED","insertions":105,"deletions":-67},{"file":"lib/ufds/filter.js","type":"MODIFIED","insertions":120,"deletions":-126},{"file":"lib/ufds/model.js","type":"MODIFIED","insertions":19,"deletions":-183},{"file":"lib/update.js","type":"MODIFIED","insertions":94,"deletions":-49},{"file":"lib/util/array.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"lib/util/constants.js","type":"MODIFIED","insertions":7,"deletions":-3},{"file":"lib/util/ip.js","type":"MODIFIED","insertions":3,"deletions":-37},{"file":"lib/util/obj.js","type":"DELETED","insertions":0,"deletions":-40},{"file":"lib/util/validate.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"package.json","type":"MODIFIED","insertions":13,"deletions":-7},{"file":"server.js","type":"MODIFIED","insertions":8,"deletions":-2},{"file":"test/integration/get.test.js","type":"MODIFIED","insertions":6,"deletions":-4},{"file":"test/integration/global.test.js","type":"MODIFIED","insertions":9,"deletions":-10},{"file":"test/integration/helpers.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"test/integration/list.test.js","type":"MODIFIED","insertions":8,"deletions":-9},{"file":"test/integration/provision.multi-test.js","type":"MODIFIED","insertions":9,"deletions":-10},{"file":"test/integration/resolve.test.js","type":"MODIFIED","insertions":385,"deletions":-39},{"file":"test/integration/update.test.js","type":"MODIFIED","insertions":20,"deletions":-10},{"file":"test/integration/vm-update.multi-test.js","type":"MODIFIED","insertions":4,"deletions":-2},{"file":"test/lib/client.js","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"test/lib/cn.js","type":"MODIFIED","insertions":14,"deletions":-13},{"file":"test/lib/common.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"test/lib/config.js","type":"MODIFIED","insertions":18,"deletions":-17},{"file":"test/lib/log.js","type":"MODIFIED","insertions":97,"deletions":-16},{"file":"test/lib/mock-moray.js","type":"DELETED","insertions":0,"deletions":-431},{"file":"test/lib/rule.js","type":"MODIFIED","insertions":53,"deletions":-20},{"file":"test/lib/trunc.js","type":"ADDED","insertions":137,"deletions":0},{"file":"test/lib/vm.js","type":"MODIFIED","insertions":13,"deletions":-6},{"file":"test/unit/data/migration.js","type":"ADDED","insertions":781,"deletions":0},{"file":"test/unit/helpers.js","type":"MODIFIED","insertions":160,"deletions":-60},{"file":"test/unit/mocks.js","type":"MODIFIED","insertions":37,"deletions":-28},{"file":"test/unit/moray.test.js","type":"ADDED","insertions":281,"deletions":0},{"file":"test/unit/rule.test.js","type":"MODIFIED","insertions":16,"deletions":-14},{"file":"test/unit/run.js","type":"ADDED","insertions":42,"deletions":0},{"file":"test/unit/ufds-smoke-test.test.js","type":"ADDED","insertions":396,"deletions":0},{"file":"test/unit/ufds-to-moray.test.js","type":"ADDED","insertions":281,"deletions":0},{"file":"test/unit/update.test.js","type":"MODIFIED","insertions":79,"deletions":-63},{"file":"test/unit/v1-to-latest.test.js","type":"ADDED","insertions":287,"deletions":0},{"file":"test/unit/wrap-integration.test.js","type":"ADDED","insertions":50,"deletions":0},{"file":"tools/eslint.node.conf","type":"ADDED","insertions":21,"deletions":0},{"file":"tools/jsl.node.conf","type":"MODIFIED","insertions":4,"deletions":-3}],"sizeInsertions":4381,"sizeDeletions":-1502},{"number":"15","revision":"d31ccc0b3680315411b86af11fb9dd7a46dbbb94","parents":["af362d0b912f6c457afbe3a34cbd6ec1d723ab2f"],"ref":"refs/changes/42/1042/15","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1484349730,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"SUBM","value":"1","grantedOn":1484349746,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1484333095,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1484349421,"by":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1484349690,"by":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1484334395,"by":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":12,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":26,"deletions":-7},{"file":"deps/jsstyle","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/app.js","type":"MODIFIED","insertions":58,"deletions":-31},{"file":"lib/cli.js","type":"MODIFIED","insertions":13,"deletions":-6},{"file":"lib/endpoints/common.js","type":"MODIFIED","insertions":7,"deletions":-5},{"file":"lib/endpoints/firewalls/vms.js","type":"MODIFIED","insertions":14,"deletions":-9},{"file":"lib/endpoints/index.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"lib/endpoints/ping.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"lib/endpoints/resolve.js","type":"MODIFIED","insertions":21,"deletions":-14},{"file":"lib/endpoints/rules/index.js","type":"MODIFIED","insertions":25,"deletions":-18},{"file":"lib/endpoints/rules/vms.js","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"lib/endpoints/updates.js","type":"MODIFIED","insertions":10,"deletions":-5},{"file":"lib/errors.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"lib/fwapi-cli.js","type":"MODIFIED","insertions":15,"deletions":-7},{"file":"lib/moray-migration.js","type":"MODIFIED","insertions":23,"deletions":-17},{"file":"lib/moray.js","type":"MODIFIED","insertions":488,"deletions":-45},{"file":"lib/persist.js","type":"MODIFIED","insertions":72,"deletions":-58},{"file":"lib/rule.js","type":"MODIFIED","insertions":105,"deletions":-67},{"file":"lib/ufds/filter.js","type":"MODIFIED","insertions":120,"deletions":-126},{"file":"lib/ufds/model.js","type":"MODIFIED","insertions":19,"deletions":-183},{"file":"lib/update.js","type":"MODIFIED","insertions":94,"deletions":-49},{"file":"lib/util/array.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"lib/util/constants.js","type":"MODIFIED","insertions":7,"deletions":-3},{"file":"lib/util/ip.js","type":"MODIFIED","insertions":3,"deletions":-37},{"file":"lib/util/obj.js","type":"DELETED","insertions":0,"deletions":-40},{"file":"lib/util/validate.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"package.json","type":"MODIFIED","insertions":13,"deletions":-7},{"file":"server.js","type":"MODIFIED","insertions":8,"deletions":-2},{"file":"test/integration/get.test.js","type":"MODIFIED","insertions":6,"deletions":-4},{"file":"test/integration/global.test.js","type":"MODIFIED","insertions":9,"deletions":-10},{"file":"test/integration/helpers.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"test/integration/list.test.js","type":"MODIFIED","insertions":8,"deletions":-9},{"file":"test/integration/provision.multi-test.js","type":"MODIFIED","insertions":9,"deletions":-10},{"file":"test/integration/resolve.test.js","type":"MODIFIED","insertions":385,"deletions":-39},{"file":"test/integration/update.test.js","type":"MODIFIED","insertions":20,"deletions":-10},{"file":"test/integration/vm-update.multi-test.js","type":"MODIFIED","insertions":4,"deletions":-2},{"file":"test/lib/client.js","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"test/lib/cn.js","type":"MODIFIED","insertions":14,"deletions":-13},{"file":"test/lib/common.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"test/lib/config.js","type":"MODIFIED","insertions":18,"deletions":-17},{"file":"test/lib/log.js","type":"MODIFIED","insertions":97,"deletions":-16},{"file":"test/lib/mock-moray.js","type":"DELETED","insertions":0,"deletions":-431},{"file":"test/lib/rule.js","type":"MODIFIED","insertions":53,"deletions":-20},{"file":"test/lib/trunc.js","type":"ADDED","insertions":137,"deletions":0},{"file":"test/lib/vm.js","type":"MODIFIED","insertions":13,"deletions":-6},{"file":"test/unit/data/migration.js","type":"ADDED","insertions":781,"deletions":0},{"file":"test/unit/helpers.js","type":"MODIFIED","insertions":160,"deletions":-60},{"file":"test/unit/mocks.js","type":"MODIFIED","insertions":37,"deletions":-28},{"file":"test/unit/moray.test.js","type":"ADDED","insertions":281,"deletions":0},{"file":"test/unit/rule.test.js","type":"MODIFIED","insertions":16,"deletions":-14},{"file":"test/unit/run.js","type":"ADDED","insertions":42,"deletions":0},{"file":"test/unit/ufds-smoke-test.test.js","type":"ADDED","insertions":396,"deletions":0},{"file":"test/unit/ufds-to-moray.test.js","type":"ADDED","insertions":281,"deletions":0},{"file":"test/unit/update.test.js","type":"MODIFIED","insertions":79,"deletions":-63},{"file":"test/unit/v1-to-latest.test.js","type":"ADDED","insertions":287,"deletions":0},{"file":"test/unit/wrap-integration.test.js","type":"ADDED","insertions":50,"deletions":0},{"file":"tools/eslint.node.conf","type":"ADDED","insertions":21,"deletions":0},{"file":"tools/jsl.node.conf","type":"MODIFIED","insertions":4,"deletions":-3}],"sizeInsertions":4381,"sizeDeletions":-1502}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}]}