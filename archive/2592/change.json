{"project":"joyent/node-manta","branch":"master","id":"Ibac6168d3c96c5e701ddb3033c3878d3c131afc4","number":"2592","subject":"joyent/node-manta#326 client could support accepting fully qualified upload directory as input to MPU operations Reviewed by: David Pacheco \u003cdap@joyent.com\u003e Reviewed by: Joshua M. Clulow \u003cjmc@joyent.com\u003e Approved by: Joshua M. Clulow \u003cjmc@joyent.com\u003e","owner":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"url":"https://cr.joyent.us/2592","commitMessage":"joyent/node-manta#326 client could support accepting fully qualified upload directory as input to MPU operations\nReviewed by: David Pacheco \u003cdap@joyent.com\u003e\nReviewed by: Joshua M. Clulow \u003cjmc@joyent.com\u003e\nApproved by: Joshua M. Clulow \u003cjmc@joyent.com\u003e\n","createdOn":1505527931,"lastUpdated":1505588330,"open":false,"status":"MERGED","comments":[{"timestamp":1505527931,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Uploaded patch set 1."},{"timestamp":1505527969,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1505528085,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Uploaded patch set 2."},{"timestamp":1505528094,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing-1\n\n\"make check\" exited with status 2\n\n fatal: ref HEAD is not a symbolic ref\n version is: 5.0.0\n [[ `cat package.json | json version` \u003d\u003d `grep \u0027^## \u0027 CHANGES.md | head -2 | tail -1 | awk \u0027{print $2}\u0027` ]]\n Makefile:147: recipe for target \u0027versioncheck\u0027 failed\n gmake: *** [versioncheck] Error 1"},{"timestamp":1505528185,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Uploaded patch set 3."},{"timestamp":1505528217,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1505528280,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Uploaded patch set 4."},{"timestamp":1505528307,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1505530141,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Patch Set 4:\n\n(4 comments)"},{"timestamp":1505562782,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Patch Set 4:\n\n(4 comments)"},{"timestamp":1505562860,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Uploaded patch set 5."},{"timestamp":1505562886,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing-1\n\n(1 comment)\n\n\"make check\" exited with status 2"},{"timestamp":1505562937,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Uploaded patch set 6."},{"timestamp":1505562969,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 6: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1505567256,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 6: Code-Review+1"},{"timestamp":1505586416,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Patch Set 6: Code-Review+1"},{"timestamp":1505588262,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Uploaded patch set 7: Commit message was updated."},{"timestamp":1505588283,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Patch Set 7: Integration-Approval+1"},{"timestamp":1505588330,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Jordan Hendricks"}],"currentPatchSet":{"number":"7","revision":"bac6168d3c96c5e701ddb3033c3878d3c131afc4","parents":["524d877618fcb64151a3b6086f266b3964c7db38"],"ref":"refs/changes/92/2592/7","uploader":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"createdOn":1505588262,"author":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1505562969,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1505567256,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1505586416,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1505588283,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}},{"type":"SUBM","value":"1","grantedOn":1505588330,"by":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":10,"deletions":0},{"file":"bin/mmpu","type":"MODIFIED","insertions":21,"deletions":-11},{"file":"lib/client.js","type":"MODIFIED","insertions":50,"deletions":-24},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/mmpu.test.js","type":"MODIFIED","insertions":18,"deletions":-15}],"sizeInsertions":100,"sizeDeletions":-51},"patchSets":[{"number":"1","revision":"23173a4f7cc29272984e9c4f9116ebe6c6d07cdb","parents":["524d877618fcb64151a3b6086f266b3964c7db38"],"ref":"refs/changes/92/2592/1","uploader":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"createdOn":1505527931,"author":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1505527969,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"bin/mmpu","type":"MODIFIED","insertions":21,"deletions":-11},{"file":"lib/client.js","type":"MODIFIED","insertions":47,"deletions":-7},{"file":"test/mmpu.test.js","type":"MODIFIED","insertions":20,"deletions":-15}],"sizeInsertions":88,"sizeDeletions":-33},{"number":"2","revision":"581b1347ce840ec482fcfa8b510c02b5d1220f2e","parents":["524d877618fcb64151a3b6086f266b3964c7db38"],"ref":"refs/changes/92/2592/2","uploader":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"createdOn":1505528085,"author":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1505528094,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":10,"deletions":0},{"file":"bin/mmpu","type":"MODIFIED","insertions":21,"deletions":-11},{"file":"lib/client.js","type":"MODIFIED","insertions":47,"deletions":-7},{"file":"test/mmpu.test.js","type":"MODIFIED","insertions":20,"deletions":-15}],"sizeInsertions":98,"sizeDeletions":-33},{"number":"3","revision":"9a70d13bed8e534bc52a0e58698251c2dc4ef17d","parents":["524d877618fcb64151a3b6086f266b3964c7db38"],"ref":"refs/changes/92/2592/3","uploader":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"createdOn":1505528185,"author":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1505528217,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":10,"deletions":0},{"file":"bin/mmpu","type":"MODIFIED","insertions":21,"deletions":-11},{"file":"lib/client.js","type":"MODIFIED","insertions":47,"deletions":-7},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/mmpu.test.js","type":"MODIFIED","insertions":20,"deletions":-15}],"sizeInsertions":99,"sizeDeletions":-34},{"number":"4","revision":"4c60a204469c39e9254c3f23a5a3e668eb1af69f","parents":["524d877618fcb64151a3b6086f266b3964c7db38"],"ref":"refs/changes/92/2592/4","uploader":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"createdOn":1505528280,"author":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1505528307,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"CHANGES.md","line":7,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"addition"},{"file":"CHANGES.md","line":7,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"lib/client.js","line":3301,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"This will call \"done\" and pass the result to \"setImmediate\", and is thus not quite right.  Instead, you want to _pass_ \"done\" (and the arguments) thus:\n\n    setImmediate(done, null, finalURL);"},{"file":"lib/client.js","line":3301,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Thanks for catching that."},{"file":"lib/client.js","line":3303,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"I would wrap this in a function so that we can avoid duplicating the code down below (3367-3382).  e.g.,\n\n    var callDone \u003d function (location) {\n        assert.string(location, \u0027location\u0027);\n\n        var finalURL;\n\n        switch (uu.uu_op) {\n        case UPLOAD_OPS.COMMIT:\n            finalURL \u003d location + \u0027/commit\u0027;\n            break;\n            ...\n        }\n\n        setImmediate(done, null, finalURL);\n    };\n\nAnd then call it here:\n\n    callDone(uu.uu_partsDirectory);\n    return;\n\nAnd again in place of the case block and call to \"done\" down on 3385; e.g.,\n\n    callDone(request[\u0027location\u0027]);"},{"file":"lib/client.js","line":3303,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"lib/client.js","line":3334,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"How is this different from the existing code?  My understanding of the VError constructor is that the first argument, if an instance of \"Error\", becomes the cause."},{"file":"lib/client.js","line":3334,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"I think you\u0027re right that\u0027s it\u0027s not different. The behavior I saw before (namely, that ResourceNotFoundError was not in the call chain) must\u0027ve been a symptom of a different bug. Removed this part of the diff."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":10,"deletions":0},{"file":"bin/mmpu","type":"MODIFIED","insertions":21,"deletions":-11},{"file":"lib/client.js","type":"MODIFIED","insertions":47,"deletions":-7},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/mmpu.test.js","type":"MODIFIED","insertions":18,"deletions":-15}],"sizeInsertions":97,"sizeDeletions":-34},{"number":"5","revision":"9767c9d2b792e7f28848fa03ccbdc173439c1f09","parents":["524d877618fcb64151a3b6086f266b3964c7db38"],"ref":"refs/changes/92/2592/5","uploader":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"createdOn":1505562860,"author":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1505562886,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/client.js","line":3276,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"extra space between function name and left paren"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":10,"deletions":0},{"file":"bin/mmpu","type":"MODIFIED","insertions":21,"deletions":-11},{"file":"lib/client.js","type":"MODIFIED","insertions":50,"deletions":-24},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/mmpu.test.js","type":"MODIFIED","insertions":18,"deletions":-15}],"sizeInsertions":100,"sizeDeletions":-51},{"number":"6","revision":"f21bb58bc8e0ba213056f21453450d2391343903","parents":["524d877618fcb64151a3b6086f266b3964c7db38"],"ref":"refs/changes/92/2592/6","uploader":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"createdOn":1505562937,"author":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1505567256,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1505586416,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1505562969,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":10,"deletions":0},{"file":"bin/mmpu","type":"MODIFIED","insertions":21,"deletions":-11},{"file":"lib/client.js","type":"MODIFIED","insertions":50,"deletions":-24},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/mmpu.test.js","type":"MODIFIED","insertions":18,"deletions":-15}],"sizeInsertions":100,"sizeDeletions":-51},{"number":"7","revision":"bac6168d3c96c5e701ddb3033c3878d3c131afc4","parents":["524d877618fcb64151a3b6086f266b3964c7db38"],"ref":"refs/changes/92/2592/7","uploader":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"createdOn":1505588262,"author":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1505567256,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1505586416,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1505588283,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1505562969,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"SUBM","value":"1","grantedOn":1505588330,"by":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":10,"deletions":0},{"file":"bin/mmpu","type":"MODIFIED","insertions":21,"deletions":-11},{"file":"lib/client.js","type":"MODIFIED","insertions":50,"deletions":-24},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/mmpu.test.js","type":"MODIFIED","insertions":18,"deletions":-15}],"sizeInsertions":100,"sizeDeletions":-51}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"}]}