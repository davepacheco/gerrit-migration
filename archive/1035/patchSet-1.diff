commit 3ddd45c4bffd1787061763d0642e114d5650d778 (refs/changes/35/1035/1)
Author: Yang Yong <yy1111.yang@samsung.com>
Date:   2016-12-01T13:08:44+09:00 (2 years, 10 months ago)
    
    joyent/node-triton#148 triton profile edit failes if EDITOR contains a space

diff --git a/lib/common.js b/lib/common.js
index 8f0d84a..976d1ce 100644
--- a/lib/common.js
+++ b/lib/common.js
@@ -15,6 +15,7 @@ var fs = require('fs');
 var os = require('os');
 var path = require('path');
 var read = require('read');
+var spawnargs = require('spawn-args');
 var strsplit = require('strsplit');
 var tty = require('tty');
 var util = require('util'),
@@ -696,7 +697,20 @@ function editInEditor(opts, cb) {
 
     // TODO: want '-f' opt for vi? What about others?
     var editor = process.env.EDITOR || '/usr/bin/vi';
-    var kid = child_process.spawn(editor, [tmpPath], {stdio: 'inherit'});
+    editor = editor.trim();
+
+    var editorArgs;
+    var optIdx = editor.indexOf(' ');
+    if (optIdx === -1) {
+        editorArgs = [tmpPath];
+    } else {
+        var editorOpt = editor.substr(optIdx, editor.length);
+        editorArgs = spawnargs(editorOpt + ' ' + tmpPath);
+
+        editor = editor.substr(0, optIdx);
+    }
+
+    var kid = child_process.spawn(editor, editorArgs, {stdio: 'inherit'});
     kid.on('exit', function (code) {
         if (code) {
             return (cb(code));
diff --git a/package.json b/package.json
index 079b53a..54b5f65 100644
--- a/package.json
+++ b/package.json
@@ -20,6 +20,7 @@
     "rimraf": "2.4.4",
     "semver": "5.1.0",
     "smartdc-auth": "git+https://github.com/joyent/node-smartdc-auth.git#05d9077",
+    "spawn-args": "0.2.0",
     "sshpk": "1.7.x",
     "strsplit": "1.0.0",
     "tabula": "1.7.0",
