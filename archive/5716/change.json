{"project":"joyent/sdc-ufds","branch":"master","id":"If18247369a07736ea925a8bd8ec40d85019ff0b5","number":"5716","subject":"TRITON-1279 ufds-tests failing waiting for napi-ufds-watcher to create dclocalconfig entry Reviewed by: Trent Mick \u003ctrentm@gmail.com\u003e Approved by: Trent Mick \u003ctrentm@gmail.com\u003e","owner":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"url":"https://cr.joyent.us/5716","commitMessage":"TRITON-1279 ufds-tests failing waiting for napi-ufds-watcher to create dclocalconfig entry\nReviewed by: Trent Mick \u003ctrentm@gmail.com\u003e\nApproved by: Trent Mick \u003ctrentm@gmail.com\u003e\n","createdOn":1551810946,"lastUpdated":1551892177,"open":false,"status":"MERGED","comments":[{"timestamp":1551810946,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 1."},{"timestamp":1551810951,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit 0dee0dbeec583b6145f6473a183bfb07485d8d83\n    \n    TRITON-1279 ufds-tests failing waiting for napi-ufds-watcher to create dclocalconfig entry"},{"timestamp":1551812054,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 1:\n\n(3 comments)"},{"timestamp":1551812742,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 2."},{"timestamp":1551812747,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit 071289ff2cbbf67ec99ed854c2e18402774e38bf\n    \n    TRITON-1279 ufds-tests failing waiting for napi-ufds-watcher to create dclocalconfig entry"},{"timestamp":1551813468,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 2:\n\n(2 comments)\n\nDone with the suggested changes. All tests passing with new node-tape on a new image built locally:\n\n        # test output:\n        /var/tmp/ufdstest/ufds.tap\n\n        # test results:\n        # Completed in 8 seconds.\n        # PASS: 791 / 791"},{"timestamp":1551814893,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1551885438,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 3."},{"timestamp":1551885443,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 3:\n\nNew commits:\n    \n    commit 6f5653dd12d75ea94ab0657a42d42e0ba93a01e7\n    \n    TRITON-1279 ufds-tests failing waiting for napi-ufds-watcher to create dclocalconfig entry"},{"timestamp":1551885563,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 2:\n\n(1 comment)\n\nModified to what you suggested. Don\u0027t think there\u0027s a big difference between one or the other approach so ... get this done!"},{"timestamp":1551889914,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 4."},{"timestamp":1551889919,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 4:\n\nNew commits:\n    \n    commit 6ab5b149a2d44017e3d746cd909a05a57b7c8ff1\n    \n    TRITON-1279 ufds-tests failing waiting for napi-ufds-watcher to create dclocalconfig entry"},{"timestamp":1551890195,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 4:\n\n(1 comment)"},{"timestamp":1551890227,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 4: Code-Review+1 Integration-Approval+1"},{"timestamp":1551890495,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 5."},{"timestamp":1551890500,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 5:\n\nNew commits:\n    \n    commit 888315474f95178ae6312ad2af79053b808e24cc\n    \n    TRITON-1279 ufds-tests failing waiting for napi-ufds-watcher to create dclocalconfig entry"},{"timestamp":1551890604,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 5: Code-Review+1 Integration-Approval+1"},{"timestamp":1551892177,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Pedro Palazón Candel"}],"currentPatchSet":{"number":"5","revision":"f18247369a07736ea925a8bd8ec40d85019ff0b5","parents":["df69f57f0bdfb327346d60a6696b5cff70525f2b"],"ref":"refs/changes/16/5716/5","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1551890495,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1551890604,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1551890604,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1551892177,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/capi/customers.test.js","type":"MODIFIED","insertions":29,"deletions":-14}],"sizeInsertions":30,"sizeDeletions":-15},"patchSets":[{"number":"1","revision":"9d1e148d345f5941a21747bbaa3c8b7ae5429b91","parents":["df69f57f0bdfb327346d60a6696b5cff70525f2b"],"ref":"refs/changes/16/5716/1","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1551810946,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","comments":[{"file":"test/capi/customers.test.js","line":796,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Naming nit: if this is literally \"Dclocalconfig\" it can theoretically help with grepping."},{"file":"test/capi/customers.test.js","line":796,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Good call. Done."},{"file":"test/capi/customers.test.js","line":815,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Is a `t.comment` possible here? ... or is this nodeunit so\nwe cannot?"},{"file":"test/capi/customers.test.js","line":815,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"We have an old tape version, if I can update, we\u0027re good to go."},{"file":"test/capi/customers.test.js","line":837,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Doesn\u0027t this leave the customer node lying around?\n\nI think it would be cleaner to always attempt to delete the dclocalconfig (in the typical case we expect that node to have been created). That attempted delete could return quickly if it just doesn\u0027t exist (i.e. handle the NoSuchObject error in `tryDeleteDcLocalCfg`).\n\nThen do the CAPI.del and fail if that fails."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"test/capi/customers.test.js","type":"MODIFIED","insertions":20,"deletions":-10}],"sizeInsertions":20,"sizeDeletions":-10},{"number":"2","revision":"192cb1c626bc5c8eadc6c7ba9a0e6885f5b6abc5","parents":["df69f57f0bdfb327346d60a6696b5cff70525f2b"],"ref":"refs/changes/16/5716/2","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1551812742,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","comments":[{"file":"test/capi/customers.test.js","line":816,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"How about just add this skip comment and don\u0027t `t.ifError(err)`? Then we don\u0027t need the other changes.\n\nThe common case should be that the dclocalconfig entry *is* created, so it seems correct to always attempt to delete it first and not just after `CAPI DEL /customers/UUID` fails."},{"file":"test/capi/customers.test.js","line":816,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Sounds good to me"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/capi/customers.test.js","type":"MODIFIED","insertions":23,"deletions":-10}],"sizeInsertions":24,"sizeDeletions":-11},{"number":"3","revision":"cad56a5d39e5ed5337132a3238f7637a25cfc83d","parents":["df69f57f0bdfb327346d60a6696b5cff70525f2b"],"ref":"refs/changes/16/5716/3","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1551885438,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/capi/customers.test.js","type":"MODIFIED","insertions":5,"deletions":-2}],"sizeInsertions":6,"sizeDeletions":-3},{"number":"4","revision":"a71e758eb9a86c072f61e9c5542251e7d85ddf0f","parents":["df69f57f0bdfb327346d60a6696b5cff70525f2b"],"ref":"refs/changes/16/5716/4","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1551889914,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1551890227,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1551890227,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"comments":[{"file":"test/capi/customers.test.js","line":795,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"This comment is now out of date."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/capi/customers.test.js","type":"MODIFIED","insertions":23,"deletions":-10}],"sizeInsertions":24,"sizeDeletions":-11},{"number":"5","revision":"f18247369a07736ea925a8bd8ec40d85019ff0b5","parents":["df69f57f0bdfb327346d60a6696b5cff70525f2b"],"ref":"refs/changes/16/5716/5","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1551890495,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1551890604,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1551890604,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1551892177,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/capi/customers.test.js","type":"MODIFIED","insertions":29,"deletions":-14}],"sizeInsertions":30,"sizeDeletions":-15}],"allReviewers":[{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}]}