{"project":"joyent/sdc-docker","branch":"master","id":"I73a6537e1a8bb851b68494341705767f359274b4","number":"2893","subject":"PUBAPI-1476 Create a compatibility layer so that all cloudapi plugins can be used in sdc-docker, and vice versa DOCKER-1054 Provide provisioning limits plugin for sdc-docker similar to cloudapi functionality","owner":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"url":"https://cr.joyent.us/2893","commitMessage":"PUBAPI-1476 Create a compatibility layer so that all cloudapi plugins can be used in sdc-docker, and vice versa\nDOCKER-1054 Provide provisioning limits plugin for sdc-docker similar to cloudapi functionality\n","createdOn":1509535468,"lastUpdated":1521033806,"open":false,"status":"MERGED","comments":[{"timestamp":1509535468,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Uploaded patch set 1."},{"timestamp":1509535499,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1509621151,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Uploaded patch set 2."},{"timestamp":1509621183,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1510008126,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 2:\n\n(9 comments)\n\nMarsell,\n\nHere are incomplete review comments on this from before we started discussing the substantive impl changes. Please take them if they are still useful, else ignore if they are now obsolete."},{"timestamp":1510308413,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Uploaded patch set 3."},{"timestamp":1510308445,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1510308497,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1513063236,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 3: Code-Review+1 Integration-Approval+1\n\n(3 comments)\n\nOther than some minor comments this looks fine to me. I\u0027m curious, is our goal to have exactly the same codebase for both, sdc-docker and sdc-cloudapi?"},{"timestamp":1516017313,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Uploaded patch set 4."},{"timestamp":1516017348,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1516017760,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Uploaded patch set 5."},{"timestamp":1516017795,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1516017996,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 6: Patch Set 5 was rebased"},{"timestamp":1516018031,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 6:\n\n\"make check\" passed ok"},{"timestamp":1516049810,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Uploaded patch set 7: Commit message was updated."},{"timestamp":1516053383,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 7:\n\n(4 comments)\n\nMarsell, \nIn https://jira.joyent.us/browse/PUBAPI-1476?focusedCommentId\u003d176983\u0026page\u003dcom.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-176983 you say the \"main focus is the first\". Do you mean the main focus is the sdc-cloudapi.git change first? I.e. should we wait for that CR before going too deep on this one?\n\nI haven\u0027t combed through provision_limits.js yet, but so far the rest of the code here seems good to me."},{"timestamp":1516055306,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 7:\n\n(4 comments)\n\n\u003e you say the \"main focus is the first\". Do you mean the main focus\n \u003e is the sdc-cloudapi.git change first? I.e. should we wait for that\n \u003e CR before going too deep on this one?\n\nI tried to make the code between the two repos as similar as possible. The plugins are all the same; the only real difference is the implementation of getNapiNetworksForAccount() in lib/plugin-manager.js. Ergo it doesn\u0027t actually matter if you critique the code here or in the other repo, although the other repo has additional plugins.\n\nSo, whatever suits you!"},{"timestamp":1516094382,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Uploaded patch set 8."},{"timestamp":1516094418,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 8: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1516179558,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 9: Patch Set 8 was rebased"},{"timestamp":1516179652,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 9:\n\n\"make check\" passed ok"},{"timestamp":1516200738,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 7:\n\n(3 comments)\n\nCouple unused variables and my 2 cents into the Error class thing"},{"timestamp":1517215698,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Uploaded patch set 10."},{"timestamp":1517215740,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 10: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1517590803,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 10: Code-Review+1\n\nThanks for applying the suggested changes Marsell"},{"timestamp":1519270532,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 11: Patch Set 10 was rebased"},{"timestamp":1519270574,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 11:\n\n\"make check\" passed ok"},{"timestamp":1520247774,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 12: Patch Set 11 was rebased"},{"timestamp":1520475075,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 12:\n\n\"make check\" passed ok"},{"timestamp":1520506484,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 13: Patch Set 12 was rebased"},{"timestamp":1520506520,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 13:\n\n\"make check\" passed ok"},{"timestamp":1520613662,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 13: Integration-Approval+1"},{"timestamp":1520624152,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 13:\n\nMarsell, you don\u0027t need to wait for me to review this."},{"timestamp":1521033806,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Marsell Kukuljevic"}],"currentPatchSet":{"number":"13","revision":"b13a5ce5cd475a459b89b9e1c997bcac6d21e82e","parents":["ec55d9450a211822c32a00d8ff12bcc8534d9efe"],"ref":"refs/changes/93/2893/13","uploader":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"createdOn":1520506484,"author":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1517215740,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1517590803,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1520613662,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"SUBM","value":"1","grantedOn":1521033806,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/backends/sdc/containers.js","type":"MODIFIED","insertions":44,"deletions":-21},{"file":"lib/plugin-manager.js","type":"MODIFIED","insertions":152,"deletions":-12},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":0},{"file":"plugins/filter_owner_networks.js","type":"MODIFIED","insertions":20,"deletions":-19},{"file":"plugins/provision_limits.js","type":"ADDED","insertions":881,"deletions":0},{"file":"test/unit/plugin-filter-owner-networks.test.js","type":"MODIFIED","insertions":15,"deletions":-13},{"file":"test/unit/plugin-provision-limits.test.js","type":"ADDED","insertions":1167,"deletions":0}],"sizeInsertions":2281,"sizeDeletions":-66},"patchSets":[{"number":"1","revision":"84cdf9c42efbad766a4629a67c132694038174c9","parents":["beaa5becb47870da558fe24f6a5ca8c12c1fb4f2"],"ref":"refs/changes/93/2893/1","uploader":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"createdOn":1509535468,"author":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1509535499,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/backends/sdc/containers.js","type":"MODIFIED","insertions":33,"deletions":-20},{"file":"lib/plugin-manager.js","type":"MODIFIED","insertions":59,"deletions":-1},{"file":"plugins/filter_owner_networks.js","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"plugins/provision_limits.js","type":"ADDED","insertions":777,"deletions":0}],"sizeInsertions":874,"sizeDeletions":-26},{"number":"2","revision":"cf038f3b89720732a9c7ff1d981ee4a1bf48bca8","parents":["beaa5becb47870da558fe24f6a5ca8c12c1fb4f2"],"ref":"refs/changes/93/2893/2","uploader":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"createdOn":1509621151,"author":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1509621183,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/plugin-manager.js","line":131,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Change to:\n\n\"Allow a plugin to export names that are not a known plugin function by prefixing with an underscore. This is used for testing.\""},{"file":"plugins/provision_limits.js","line":12,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"provision"},{"file":"plugins/provision_limits.js","line":14,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"VMs\u0027"},{"file":"plugins/provision_limits.js","line":34,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"have"},{"file":"plugins/provision_limits.js","line":45,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"It\u0027s"},{"file":"plugins/provision_limits.js","line":83,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"drop this"},{"file":"plugins/provision_limits.js","line":88,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Thought there is a problem here for *Docker* containers running Linux, right?\n\nNot sure yet (I haven\u0027t read the impl.) but I wonder about interpreting Docker images as always being \"linux\"? The actual OS of a docker container is in the *sdc-docker* data, e.g.:\n\n```\n[root@6b80e7b4-945c-41ed-a34e-976b79f6b56e (nightly-1:moray0) ~]# findobjects docker_images_v2 image_uuid\u003d* | json -ga value.image.os\nlinux\nlinux\nlinux\nlinux\nlinux\nlinux\nlinux\nlinux\n...\n```"},{"file":"plugins/provision_limits.js","line":88,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"I considered using linux, since ImageV2 objects have that tucked away, but that\u0027s incompatible with cloudapi\u0027s plugin."},{"file":"plugins/provision_limits.js","line":581,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"double \"needed\""},{"file":"plugins/provision_limits.js","line":771,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Perhaps just use the name allowProvision above?"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/backends/sdc/containers.js","type":"MODIFIED","insertions":33,"deletions":-20},{"file":"lib/plugin-manager.js","type":"MODIFIED","insertions":59,"deletions":-1},{"file":"plugins/filter_owner_networks.js","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"plugins/provision_limits.js","type":"ADDED","insertions":780,"deletions":0},{"file":"test/unit/plugin-provision-limits.test.js","type":"ADDED","insertions":937,"deletions":0}],"sizeInsertions":1814,"sizeDeletions":-26},{"number":"3","revision":"5a3fb8e8b7e1e08835c01e15852661491ec4166c","parents":["572b6191b5705f6e98e84dd7ff1fff91efca024b"],"ref":"refs/changes/93/2893/3","uploader":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"createdOn":1510308413,"author":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1510308445,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1513063236,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1513063236,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"comments":[{"file":"plugins/filter_owner_networks.js","line":137,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"I don\u0027t understand this change. Shouldn\u0027t be better to have the `||` before the line break?"},{"file":"plugins/filter_owner_networks.js","line":142,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"I\u0027d personally prefer the cb call before and the return statement on the next line, but it\u0027s definitely not a big deal"},{"file":"plugins/provision_limits.js","line":279,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"sapi?"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/backends/sdc/containers.js","type":"MODIFIED","insertions":33,"deletions":-20},{"file":"lib/plugin-manager.js","type":"MODIFIED","insertions":64,"deletions":-1},{"file":"plugins/filter_owner_networks.js","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"plugins/provision_limits.js","type":"ADDED","insertions":872,"deletions":0},{"file":"test/unit/plugin-provision-limits.test.js","type":"ADDED","insertions":1115,"deletions":0}],"sizeInsertions":2089,"sizeDeletions":-26},{"number":"4","revision":"42e0851fddd209abc0868a16ea3e21842d27c1cb","parents":["45aaeb7b5dbca306ea8aa1e05bd07b754d68c729"],"ref":"refs/changes/93/2893/4","uploader":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"createdOn":1516017313,"author":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1516017348,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/backends/sdc/containers.js","type":"MODIFIED","insertions":44,"deletions":-21},{"file":"lib/plugin-manager.js","type":"MODIFIED","insertions":149,"deletions":-10},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":0},{"file":"plugins/filter_owner_networks.js","type":"MODIFIED","insertions":20,"deletions":-19},{"file":"plugins/provision_limits.js","type":"ADDED","insertions":878,"deletions":0},{"file":"test/unit/plugin-filter-owner-networks.test.js","type":"MODIFIED","insertions":13,"deletions":-11},{"file":"test/unit/plugin-provision-limits.test.js","type":"ADDED","insertions":1164,"deletions":0}],"sizeInsertions":2270,"sizeDeletions":-62},{"number":"5","revision":"540552700ab638cf55e61ccc3bb04defbf275b8e","parents":["45aaeb7b5dbca306ea8aa1e05bd07b754d68c729"],"ref":"refs/changes/93/2893/5","uploader":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"createdOn":1516017760,"author":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1516017795,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/backends/sdc/containers.js","type":"MODIFIED","insertions":44,"deletions":-21},{"file":"lib/plugin-manager.js","type":"MODIFIED","insertions":149,"deletions":-10},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":0},{"file":"plugins/filter_owner_networks.js","type":"MODIFIED","insertions":20,"deletions":-19},{"file":"plugins/provision_limits.js","type":"ADDED","insertions":878,"deletions":0},{"file":"test/unit/plugin-filter-owner-networks.test.js","type":"MODIFIED","insertions":15,"deletions":-13},{"file":"test/unit/plugin-provision-limits.test.js","type":"ADDED","insertions":1164,"deletions":0}],"sizeInsertions":2272,"sizeDeletions":-64},{"number":"6","revision":"3f6f5a148c14228243ab31b84a19166fa5c680e3","parents":["26629c6f6e85ce4660112ade5fcc7b8f59e4d6af"],"ref":"refs/changes/93/2893/6","uploader":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"createdOn":1516017996,"author":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1516017795,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/backends/sdc/containers.js","type":"MODIFIED","insertions":44,"deletions":-21},{"file":"lib/plugin-manager.js","type":"MODIFIED","insertions":149,"deletions":-10},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":0},{"file":"plugins/filter_owner_networks.js","type":"MODIFIED","insertions":20,"deletions":-19},{"file":"plugins/provision_limits.js","type":"ADDED","insertions":878,"deletions":0},{"file":"test/unit/plugin-filter-owner-networks.test.js","type":"MODIFIED","insertions":15,"deletions":-13},{"file":"test/unit/plugin-provision-limits.test.js","type":"ADDED","insertions":1164,"deletions":0}],"sizeInsertions":2272,"sizeDeletions":-64},{"number":"7","revision":"ca7d5305b21d31e4c32ee3f1f6af03f605f4f9b3","parents":["26629c6f6e85ce4660112ade5fcc7b8f59e4d6af"],"ref":"refs/changes/93/2893/7","uploader":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"createdOn":1516049810,"author":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1516017795,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/plugin-manager.js","line":48,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Defined but never used"},{"file":"lib/plugin-manager.js","line":55,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Defined but never used"},{"file":"lib/plugin-manager.js","line":91,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Incomplete code?"},{"file":"lib/plugin-manager.js","line":91,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"I was thinking of making a custom error class that inherits from restify.RestError, but I\u0027m not sure it\u0027s worth the extra code.\n\nThoughts?"},{"file":"lib/plugin-manager.js","line":91,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Not sure if relevant, but everything else in sdc-docker is using custom \u0027UnauthorizedError\u0027. If we\u0027re ok with replying with a 401 instead of a 403 status code, I\u0027d go use it. Otherwise, I\u0027d likely take the same approach than for \u0027UnauthorizedError\u0027, due to exactly the same reasons explained for it into the errors file."},{"file":"lib/plugin-manager.js","line":136,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Should x-request-id be passed here as well?"},{"file":"lib/plugin-manager.js","line":136,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Yeah, the signature of getImageShim is inconsistent with the others too.\n\nOkay, I\u0027ll convert it to opt and pass in req_id so I can use it with imgapi.getImage()"},{"file":"lib/plugin-manager.js","line":248,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"\"container\"?"},{"file":"lib/plugin-manager.js","line":248,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Whoops!"},{"file":"package.json","line":20,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"This is to support a future \u0027machine_email.js\u0027 plugin for sdc-docker a la cloudapi\u0027s plugin of that name?  Do you know if we care to support that plugin for sdc-docker?"},{"file":"package.json","line":20,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"That\u0027s indeed the reason. I suspect that we probably won\u0027t use machine_email, but I added that in to preserve the fact that all plugins work without change between the two repos.\n\nI don\u0027t feel especially strongly about it though."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/backends/sdc/containers.js","type":"MODIFIED","insertions":44,"deletions":-21},{"file":"lib/plugin-manager.js","type":"MODIFIED","insertions":149,"deletions":-10},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":0},{"file":"plugins/filter_owner_networks.js","type":"MODIFIED","insertions":20,"deletions":-19},{"file":"plugins/provision_limits.js","type":"ADDED","insertions":878,"deletions":0},{"file":"test/unit/plugin-filter-owner-networks.test.js","type":"MODIFIED","insertions":15,"deletions":-13},{"file":"test/unit/plugin-provision-limits.test.js","type":"ADDED","insertions":1164,"deletions":0}],"sizeInsertions":2272,"sizeDeletions":-64},{"number":"8","revision":"3f29c2c41566be928eb4d8d329a04cd5035f1a3d","parents":["26629c6f6e85ce4660112ade5fcc7b8f59e4d6af"],"ref":"refs/changes/93/2893/8","uploader":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"createdOn":1516094382,"author":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1516094418,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/backends/sdc/containers.js","type":"MODIFIED","insertions":44,"deletions":-21},{"file":"lib/plugin-manager.js","type":"MODIFIED","insertions":154,"deletions":-10},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":0},{"file":"plugins/filter_owner_networks.js","type":"MODIFIED","insertions":20,"deletions":-19},{"file":"plugins/provision_limits.js","type":"ADDED","insertions":881,"deletions":0},{"file":"test/unit/plugin-filter-owner-networks.test.js","type":"MODIFIED","insertions":15,"deletions":-13},{"file":"test/unit/plugin-provision-limits.test.js","type":"ADDED","insertions":1167,"deletions":0}],"sizeInsertions":2283,"sizeDeletions":-64},{"number":"9","revision":"f80402bba0d36fce0fc37340c5233a7f2aaa6ae8","parents":["fa211d210bb4ac263f8ea7faabdc870d7cf16702"],"ref":"refs/changes/93/2893/9","uploader":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"createdOn":1516179558,"author":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1516094418,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/backends/sdc/containers.js","type":"MODIFIED","insertions":44,"deletions":-21},{"file":"lib/plugin-manager.js","type":"MODIFIED","insertions":154,"deletions":-10},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":0},{"file":"plugins/filter_owner_networks.js","type":"MODIFIED","insertions":20,"deletions":-19},{"file":"plugins/provision_limits.js","type":"ADDED","insertions":881,"deletions":0},{"file":"test/unit/plugin-filter-owner-networks.test.js","type":"MODIFIED","insertions":15,"deletions":-13},{"file":"test/unit/plugin-provision-limits.test.js","type":"ADDED","insertions":1167,"deletions":0}],"sizeInsertions":2283,"sizeDeletions":-64},{"number":"10","revision":"73a6537e1a8bb851b68494341705767f359274b4","parents":["a9a2db9d1d978150709f00204552e73a8f1d9f8c"],"ref":"refs/changes/93/2893/10","uploader":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"createdOn":1517215698,"author":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1517215740,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1517590803,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/backends/sdc/containers.js","type":"MODIFIED","insertions":44,"deletions":-21},{"file":"lib/plugin-manager.js","type":"MODIFIED","insertions":152,"deletions":-12},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":0},{"file":"plugins/filter_owner_networks.js","type":"MODIFIED","insertions":20,"deletions":-19},{"file":"plugins/provision_limits.js","type":"ADDED","insertions":881,"deletions":0},{"file":"test/unit/plugin-filter-owner-networks.test.js","type":"MODIFIED","insertions":15,"deletions":-13},{"file":"test/unit/plugin-provision-limits.test.js","type":"ADDED","insertions":1167,"deletions":0}],"sizeInsertions":2281,"sizeDeletions":-66},{"number":"11","revision":"2c6c7dea6d69710b412d80ff0b0f5c28a42956b7","parents":["781ed7f2330ac41419a8a9da8eedef7825391372"],"ref":"refs/changes/93/2893/11","uploader":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"createdOn":1519270532,"author":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1517215740,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1517590803,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/backends/sdc/containers.js","type":"MODIFIED","insertions":44,"deletions":-21},{"file":"lib/plugin-manager.js","type":"MODIFIED","insertions":152,"deletions":-12},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":0},{"file":"plugins/filter_owner_networks.js","type":"MODIFIED","insertions":20,"deletions":-19},{"file":"plugins/provision_limits.js","type":"ADDED","insertions":881,"deletions":0},{"file":"test/unit/plugin-filter-owner-networks.test.js","type":"MODIFIED","insertions":15,"deletions":-13},{"file":"test/unit/plugin-provision-limits.test.js","type":"ADDED","insertions":1167,"deletions":0}],"sizeInsertions":2281,"sizeDeletions":-66},{"number":"12","revision":"b8a9f1a4182fb62e621cb4528152756810a8c494","parents":["fc12c98e8cb2ac923fb1c7cffd19403f5706833d"],"ref":"refs/changes/93/2893/12","uploader":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"createdOn":1520247774,"author":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1517215740,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1517590803,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/backends/sdc/containers.js","type":"MODIFIED","insertions":44,"deletions":-21},{"file":"lib/plugin-manager.js","type":"MODIFIED","insertions":152,"deletions":-12},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":0},{"file":"plugins/filter_owner_networks.js","type":"MODIFIED","insertions":20,"deletions":-19},{"file":"plugins/provision_limits.js","type":"ADDED","insertions":881,"deletions":0},{"file":"test/unit/plugin-filter-owner-networks.test.js","type":"MODIFIED","insertions":15,"deletions":-13},{"file":"test/unit/plugin-provision-limits.test.js","type":"ADDED","insertions":1167,"deletions":0}],"sizeInsertions":2281,"sizeDeletions":-66},{"number":"13","revision":"b13a5ce5cd475a459b89b9e1c997bcac6d21e82e","parents":["ec55d9450a211822c32a00d8ff12bcc8534d9efe"],"ref":"refs/changes/93/2893/13","uploader":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"createdOn":1520506484,"author":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1517215740,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1517590803,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1520613662,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"SUBM","value":"1","grantedOn":1521033806,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/backends/sdc/containers.js","type":"MODIFIED","insertions":44,"deletions":-21},{"file":"lib/plugin-manager.js","type":"MODIFIED","insertions":152,"deletions":-12},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":0},{"file":"plugins/filter_owner_networks.js","type":"MODIFIED","insertions":20,"deletions":-19},{"file":"plugins/provision_limits.js","type":"ADDED","insertions":881,"deletions":0},{"file":"test/unit/plugin-filter-owner-networks.test.js","type":"MODIFIED","insertions":15,"deletions":-13},{"file":"test/unit/plugin-provision-limits.test.js","type":"ADDED","insertions":1167,"deletions":0}],"sizeInsertions":2281,"sizeDeletions":-66}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}]}