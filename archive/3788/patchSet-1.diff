From a83aaeeddffd50a310fb6916db15dd35b8944475 Mon Sep 17 00:00:00 2001
From: Robert Bogart <robert.bogart@joyent.com>
Date: Mon, 9 Apr 2018 19:05:04 +0000
Subject: [PATCH] MANTA-3598 electric-moray artedi metrics could provide
 similar fields to moray's

---
 lib/server.js                          | 11 ++++++++++-
 sapi_manifests/electric-moray/template |  4 +++-
 2 files changed, 13 insertions(+), 2 deletions(-)

diff --git a/lib/server.js b/lib/server.js
index fbd7f40..7f6d12c 100644
--- a/lib/server.js
+++ b/lib/server.js
@@ -155,7 +155,16 @@ function createServer(options, callback) {
             opts.clients = clients;
             opts.indexShards = options.ringCfg.indexShards;
 
-            var collector = artedi.createCollector();
+            var labels = {
+                datacenter: options.datacenter,
+                server: options.server_uuid,
+                zonename: os.hostname(),
+                pid: process.pid
+            };
+
+            var collector = artedi.createCollector({
+                labels: labels
+            });
 
             var socket = net.createServer({ 'allowHalfOpen': true });
             var server = new fast.FastServer({
diff --git a/sapi_manifests/electric-moray/template b/sapi_manifests/electric-moray/template
index a3d0d9b..b8cac1d 100644
--- a/sapi_manifests/electric-moray/template
+++ b/sapi_manifests/electric-moray/template
@@ -40,5 +40,7 @@
                 "readOnly": {{readOnly}}{{/readOnly}}
             }{{^last}},{{/last}}{{/INDEX_MORAY_SHARDS}}
         ]
-    }
+    },
+    "server_uuid": "{{auto.SERVER_UUID}}",
+    "datacenter": "{{DATACENTER}}"
 }
-- 
2.21.0

