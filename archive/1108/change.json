{"project":"joyent/illumos-joyent","branch":"master","id":"I66e8b8008d43c8c29bd5b803b4d37ff44e4f53d8","number":"1108","subject":"OS-5843 xhci BIOS takeover can trigger interrupts OS-5842 xhci intr data for one-shots not always allocated Reviewed by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e Reviewed by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e Approved by: Jerry Jelinek \u003cjerry.jel","owner":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"url":"https://cr.joyent.us/1108","commitMessage":"OS-5843 xhci BIOS takeover can trigger interrupts\nOS-5842 xhci intr data for one-shots not always allocated\nReviewed by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e\nReviewed by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e\nApproved by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e\n","createdOn":1481424652,"lastUpdated":1481579949,"open":false,"status":"MERGED","comments":[{"timestamp":1481424652,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Uploaded patch set 1."},{"timestamp":1481549890,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1481559033,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 1:\n\n(2 comments)"},{"timestamp":1481569202,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Uploaded patch set 2."},{"timestamp":1481569212,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 1:\n\n(3 comments)"},{"timestamp":1481569734,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 2: Code-Review+1"},{"timestamp":1481571155,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 2: Code-Review+1"},{"timestamp":1481579573,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 2:\n\nThis was tested on the impacted systems and we verified that they now work correctly. I also did some basic smoke testing."},{"timestamp":1481579614,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 2: Integration-Approval+1"},{"timestamp":1481579803,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Uploaded patch set 3: Patch Set 2 was rebased."},{"timestamp":1481579908,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Uploaded patch set 4: Commit message was updated."},{"timestamp":1481579949,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Robert Mustacchi"}],"currentPatchSet":{"number":"4","revision":"66e8b8008d43c8c29bd5b803b4d37ff44e4f53d8","parents":["e325ac12b87f28346e5c04b09fa513665f2ea048"],"ref":"refs/changes/08/1108/4","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1481579908,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1481569734,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1481571155,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1481579614,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"SUBM","value":"1","grantedOn":1481579949,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"usr/src/uts/common/io/usb/hcd/xhci/xhci.c","type":"MODIFIED","insertions":9,"deletions":-4},{"file":"usr/src/uts/common/io/usb/hcd/xhci/xhci_event.c","type":"MODIFIED","insertions":12,"deletions":-2},{"file":"usr/src/uts/common/io/usb/hcd/xhci/xhci_usba.c","type":"MODIFIED","insertions":26,"deletions":0}],"sizeInsertions":47,"sizeDeletions":-6},"patchSets":[{"number":"1","revision":"119ace94c152853dc724e9ea67716922a37af2b6","parents":["176e482195a7e54ca478f2dd86c77d34f0ca3934"],"ref":"refs/changes/08/1108/1","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1481424652,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/uts/common/io/usb/hcd/xhci/xhci.c","line":2035,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"This comment seems ambiguous to me. What happens if we don\u0027t take over the controller from the BIOS? If we don\u0027t take over here, is it done somewhere else?"},{"file":"usr/src/uts/common/io/usb/hcd/xhci/xhci.c","line":2035,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I originally meant \u0027potentially\u0027 because the controller may not have hooks in the BIOS. I\u0027ve just removed it to make it clearer."},{"file":"usr/src/uts/common/io/usb/hcd/xhci/xhci_usba.c","line":1160,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"*allocated"},{"file":"usr/src/uts/common/io/usb/hcd/xhci/xhci_usba.c","line":1160,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"},{"file":"usr/src/uts/common/io/usb/hcd/xhci/xhci_usba.c","line":1186,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Is this necessary?  The \u0027datain \u003d\u003d B_TRUE\u0027 conditional which results in the allocation of \u0027mp\u0027 should exclude us from this statement."},{"file":"usr/src/uts/common/io/usb/hcd/xhci/xhci_usba.c","line":1186,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"No it wasn\u0027t. Thanks for catching that."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"usr/src/uts/common/io/usb/hcd/xhci/xhci.c","type":"MODIFIED","insertions":9,"deletions":-4},{"file":"usr/src/uts/common/io/usb/hcd/xhci/xhci_event.c","type":"MODIFIED","insertions":12,"deletions":-2},{"file":"usr/src/uts/common/io/usb/hcd/xhci/xhci_usba.c","type":"MODIFIED","insertions":30,"deletions":0}],"sizeInsertions":51,"sizeDeletions":-6},{"number":"2","revision":"39868ab338d5e23cf27c306ec46bac8a168d0e6f","parents":["176e482195a7e54ca478f2dd86c77d34f0ca3934"],"ref":"refs/changes/08/1108/2","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1481569202,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1481569734,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1481579614,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1481571155,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"usr/src/uts/common/io/usb/hcd/xhci/xhci.c","type":"MODIFIED","insertions":9,"deletions":-4},{"file":"usr/src/uts/common/io/usb/hcd/xhci/xhci_event.c","type":"MODIFIED","insertions":12,"deletions":-2},{"file":"usr/src/uts/common/io/usb/hcd/xhci/xhci_usba.c","type":"MODIFIED","insertions":26,"deletions":0}],"sizeInsertions":47,"sizeDeletions":-6},{"number":"3","revision":"4e8ea4dd1e0862ad1286223f5cab15bc96c91ce1","parents":["e325ac12b87f28346e5c04b09fa513665f2ea048"],"ref":"refs/changes/08/1108/3","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1481579803,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1481569734,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1481579614,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1481571155,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"usr/src/uts/common/io/usb/hcd/xhci/xhci.c","type":"MODIFIED","insertions":9,"deletions":-4},{"file":"usr/src/uts/common/io/usb/hcd/xhci/xhci_event.c","type":"MODIFIED","insertions":12,"deletions":-2},{"file":"usr/src/uts/common/io/usb/hcd/xhci/xhci_usba.c","type":"MODIFIED","insertions":26,"deletions":0}],"sizeInsertions":47,"sizeDeletions":-6},{"number":"4","revision":"66e8b8008d43c8c29bd5b803b4d37ff44e4f53d8","parents":["e325ac12b87f28346e5c04b09fa513665f2ea048"],"ref":"refs/changes/08/1108/4","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1481579908,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"SUBM","value":"1","grantedOn":1481579949,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1481569734,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1481579614,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1481571155,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"usr/src/uts/common/io/usb/hcd/xhci/xhci.c","type":"MODIFIED","insertions":9,"deletions":-4},{"file":"usr/src/uts/common/io/usb/hcd/xhci/xhci_event.c","type":"MODIFIED","insertions":12,"deletions":-2},{"file":"usr/src/uts/common/io/usb/hcd/xhci/xhci_usba.c","type":"MODIFIED","insertions":26,"deletions":0}],"sizeInsertions":47,"sizeDeletions":-6}],"allReviewers":[{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}]}