{"project":"joyent/sdc-net-agent","branch":"master","id":"Ie0aec54ad6cefc67c9e4e948a1c4128c199e8dac","number":"5512","subject":"TRITON-1193 net-agent gets stuck repeatedly attempting to set \"model\" to undefined on HVM NICs TRITON-1089 net-agent does not update routes on CNs running vminfod TRITON-730 net-agent causes provision job failure by modifying VM while it\u0027s provisioning TR","owner":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"url":"https://cr.joyent.us/5512","commitMessage":"TRITON-1193 net-agent gets stuck repeatedly attempting to set \"model\" to undefined on HVM NICs\nTRITON-1089 net-agent does not update routes on CNs running vminfod\nTRITON-730 net-agent causes provision job failure by modifying VM while it\u0027s provisioning\nTRITON-698 net-agent \u0027make check\u0027 should work on systems w/o prebuilt binaries\nReviewed by: Mike Zeller \u003cmike.zeller@joyent.com\u003e\nReviewed by: Dave Eddy \u003cdave.eddy@joyent.com\u003e\nApproved by: Dave Eddy \u003cdave.eddy@joyent.com\u003e\n","createdOn":1549572802,"lastUpdated":1550090744,"open":false,"status":"MERGED","comments":[{"timestamp":1549572802,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 1."},{"timestamp":1549572853,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1549665861,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 2."},{"timestamp":1549911277,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Patch Set 2:\n\n(2 comments)"},{"timestamp":1549911808,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 3."},{"timestamp":1549911865,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 3:\n\n(2 comments)"},{"timestamp":1549911873,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1549913928,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 3:\n\n(2 comments)\n\nSmall comments left: 1 nit \u0026 1 concern.\n\nI\u0027ve looked through the 4 tickets and see various testing notes for each issue, and the testing notes themselves look good.\n\nIs there any sort of all-encompassing test suite that can exercise these changes effectively? AFAICT net-agent does *not* have a test suite itself, but is there any other test suite that can substitute in its place here?  I ask because I know changes here, though small in themselves, can have cascading effects across the entire stack.\n\nPerhaps jenkins/nightly will be enough of a guard here.\n\nEither way, once the comments are addressed, the change itself looks good to me, and if all of the testing notes reflect the latest patchsets on this CR then I can give it IA :)."},{"timestamp":1549915225,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 3:\n\n(2 comments)"},{"timestamp":1549915286,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 4."},{"timestamp":1549916601,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 4: Code-Review+1 Integration-Approval+1\n\nAll looks good to me!"},{"timestamp":1549918099,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Patch Set 4: Code-Review+1"},{"timestamp":1549922831,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 5: Commit message was updated."},{"timestamp":1549922843,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Cody Peter Mello"},{"timestamp":1550088148,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2:\n\n\"make check\" passed ok"},{"timestamp":1550089454,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2:\n\n\"make check\" passed ok"},{"timestamp":1550090628,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3:\n\n\"make check\" passed ok"},{"timestamp":1550090744,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4:\n\n\"make check\" passed ok"}],"currentPatchSet":{"number":"5","revision":"e0aec54ad6cefc67c9e4e948a1c4128c199e8dac","parents":["41378a54b24727e30e3d50c4b5642b3882e1c5cf"],"ref":"refs/changes/12/5512/5","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1549922831,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1549916601,"by":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1549916601,"by":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1549918099,"by":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"}},{"type":"SUBM","value":"1","grantedOn":1549922843,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":13,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":8,"deletions":-6},{"file":"lib/inst-fsm.js","type":"MODIFIED","insertions":45,"deletions":-5},{"file":"lib/net-agent.js","type":"MODIFIED","insertions":1,"deletions":-2},{"file":"lib/nic-fsm.js","type":"MODIFIED","insertions":11,"deletions":-5},{"file":"lib/server-fsm.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/utils.js","type":"ADDED","insertions":30,"deletions":0},{"file":"lib/vmadm-watcher-fsm.js","type":"MODIFIED","insertions":83,"deletions":-10},{"file":"lib/watcher-fsm.js","type":"MODIFIED","insertions":2,"deletions":-12},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":184,"sizeDeletions":-44},"patchSets":[{"number":"1","revision":"86b89557d8825694e757a03020b3a0b5f6d9d0d9","parents":["41378a54b24727e30e3d50c4b5642b3882e1c5cf"],"ref":"refs/changes/12/5512/1","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1549572802,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1549572853,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":8,"deletions":-6},{"file":"lib/inst-fsm.js","type":"MODIFIED","insertions":44,"deletions":-4},{"file":"lib/net-agent.js","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"lib/nic-fsm.js","type":"MODIFIED","insertions":10,"deletions":-4},{"file":"lib/server-fsm.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/utils.js","type":"ADDED","insertions":30,"deletions":0},{"file":"lib/vmadm-watcher-fsm.js","type":"MODIFIED","insertions":82,"deletions":-9},{"file":"lib/watcher-fsm.js","type":"MODIFIED","insertions":1,"deletions":-11},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":178,"sizeDeletions":-38},{"number":"2","revision":"05582ec798ead424ee527ecefd090cc845344ea0","parents":["41378a54b24727e30e3d50c4b5642b3882e1c5cf"],"ref":"refs/changes/12/5512/2","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1549665861,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","comments":[{"file":"lib/server-fsm.js","line":8,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"2019"},{"file":"lib/server-fsm.js","line":8,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Done"},{"file":"lib/watcher-fsm.js","line":8,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"2019"},{"file":"lib/watcher-fsm.js","line":8,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":8,"deletions":-6},{"file":"lib/inst-fsm.js","type":"MODIFIED","insertions":45,"deletions":-5},{"file":"lib/net-agent.js","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"lib/nic-fsm.js","type":"MODIFIED","insertions":11,"deletions":-5},{"file":"lib/server-fsm.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/utils.js","type":"ADDED","insertions":30,"deletions":0},{"file":"lib/vmadm-watcher-fsm.js","type":"MODIFIED","insertions":83,"deletions":-10},{"file":"lib/watcher-fsm.js","type":"MODIFIED","insertions":1,"deletions":-11},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":181,"sizeDeletions":-41},{"number":"3","revision":"e7639bea1bca873e077d40e13c91f7d1c308cee0","parents":["41378a54b24727e30e3d50c4b5642b3882e1c5cf"],"ref":"refs/changes/12/5512/3","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1549911808,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1549911873,"by":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"}}],"comments":[{"file":"lib/net-agent.js","line":8,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"2019, though i wonder if this file needs to be touched at all"},{"file":"lib/net-agent.js","line":8,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"I had to touch it to satisfy the eslint-plugin-joyent bump. I\u0027ll update the copyright."},{"file":"lib/server-fsm.js","line":238,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"This is not always a number? should `jsprim.parseInteger` be used here?  I guess what I\u0027m asking is, is how \"safe\" we should be here."},{"file":"lib/server-fsm.js","line":238,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"This should always be a string containing a number when the field is present. When a VLAN ID hasn\u0027t been configured, the value is \"0\". It gets generated here:\n\nhttps://github.com/joyent/smartos-live/blob/release-20190131/src/sysinfo#L512-L530"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":8,"deletions":-6},{"file":"lib/inst-fsm.js","type":"MODIFIED","insertions":45,"deletions":-5},{"file":"lib/net-agent.js","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"lib/nic-fsm.js","type":"MODIFIED","insertions":11,"deletions":-5},{"file":"lib/server-fsm.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/utils.js","type":"ADDED","insertions":30,"deletions":0},{"file":"lib/vmadm-watcher-fsm.js","type":"MODIFIED","insertions":83,"deletions":-10},{"file":"lib/watcher-fsm.js","type":"MODIFIED","insertions":2,"deletions":-12},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":183,"sizeDeletions":-43},{"number":"4","revision":"3344c06a1d63af58a8528af8346cb99416e01f12","parents":["41378a54b24727e30e3d50c4b5642b3882e1c5cf"],"ref":"refs/changes/12/5512/4","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1549915286,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1549916601,"by":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1549916601,"by":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1549918099,"by":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":8,"deletions":-6},{"file":"lib/inst-fsm.js","type":"MODIFIED","insertions":45,"deletions":-5},{"file":"lib/net-agent.js","type":"MODIFIED","insertions":1,"deletions":-2},{"file":"lib/nic-fsm.js","type":"MODIFIED","insertions":11,"deletions":-5},{"file":"lib/server-fsm.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/utils.js","type":"ADDED","insertions":30,"deletions":0},{"file":"lib/vmadm-watcher-fsm.js","type":"MODIFIED","insertions":83,"deletions":-10},{"file":"lib/watcher-fsm.js","type":"MODIFIED","insertions":2,"deletions":-12},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":184,"sizeDeletions":-44},{"number":"5","revision":"e0aec54ad6cefc67c9e4e948a1c4128c199e8dac","parents":["41378a54b24727e30e3d50c4b5642b3882e1c5cf"],"ref":"refs/changes/12/5512/5","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1549922831,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"SUBM","value":"1","grantedOn":1549922843,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1549916601,"by":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1549916601,"by":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1549918099,"by":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":13,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":8,"deletions":-6},{"file":"lib/inst-fsm.js","type":"MODIFIED","insertions":45,"deletions":-5},{"file":"lib/net-agent.js","type":"MODIFIED","insertions":1,"deletions":-2},{"file":"lib/nic-fsm.js","type":"MODIFIED","insertions":11,"deletions":-5},{"file":"lib/server-fsm.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/utils.js","type":"ADDED","insertions":30,"deletions":0},{"file":"lib/vmadm-watcher-fsm.js","type":"MODIFIED","insertions":83,"deletions":-10},{"file":"lib/watcher-fsm.js","type":"MODIFIED","insertions":2,"deletions":-12},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":184,"sizeDeletions":-44}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}]}