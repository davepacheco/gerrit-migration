{"project":"joyent/node-libmanta","branch":"master","topic":"MANTA-2169","id":"I4c001a1f66ee7f93f65319018cd13aa8240415a2","number":"1376","subject":"MANTA-2169 Support multipart upload of a single file to Manta","owner":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"url":"https://cr.joyent.us/1376","commitMessage":"MANTA-2169 Support multipart upload of a single file to Manta\n","createdOn":1485827552,"lastUpdated":1491423118,"open":false,"status":"MERGED","comments":[{"timestamp":1485827552,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Uploaded patch set 1."},{"timestamp":1485827580,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Topic set to MANTA-2169"},{"timestamp":1485827602,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1485917342,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Uploaded patch set 2."},{"timestamp":1485917365,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1485989758,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 2: Code-Review+1\n\n(1 comment)"},{"timestamp":1490935591,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Uploaded patch set 3."},{"timestamp":1490935620,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1490935693,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Patch Set 3:\n\nTesting notes:\n- Successfully ran the muskie test suite, including MPU tests, using the updated libmanta changes.\n- Successfully ran the node-manta test suite with the updated libmanta, including MPU tests."},{"timestamp":1491342920,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 3:\n\n(7 comments)"},{"timestamp":1491368922,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Uploaded patch set 4."},{"timestamp":1491368945,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1491368964,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Patch Set 4:\n\n(6 comments)\n\nI reran the muskie test suite and node-manta test suite as before with patchset 4."},{"timestamp":1491369070,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Uploaded patch set 5."},{"timestamp":1491369093,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1491409414,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 5: Code-Review+1\n\n(2 comments)"},{"timestamp":1491417123,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Uploaded patch set 6."},{"timestamp":1491417151,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 6: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1491417208,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Patch Set 6:\n\n(2 comments)\n\nReran the muskie test suite and node-manta test suite with patchset 6."},{"timestamp":1491422932,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 6: Code-Review+1 Integration-Approval+1"},{"timestamp":1491423118,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Jordan Hendricks"}],"currentPatchSet":{"number":"6","revision":"4c001a1f66ee7f93f65319018cd13aa8240415a2","parents":["e6e5be210c3e66ae6990c1e1395e25422a2390de"],"ref":"refs/changes/76/1376/6","uploader":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"createdOn":1491417123,"author":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1491417151,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1491422932,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1491422932,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"SUBM","value":"1","grantedOn":1491423118,"by":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/moray.js","type":"MODIFIED","insertions":260,"deletions":-45}],"sizeInsertions":260,"sizeDeletions":-45},"patchSets":[{"number":"1","revision":"490f579943cbcc14d9ef46054e28fddbdd48f407","parents":["c8ce77d48c18b51de5573fdec3e5d0ad13d6967a"],"ref":"refs/changes/76/1376/1","uploader":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"createdOn":1485827552,"author":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1485827602,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/moray.js","type":"MODIFIED","insertions":17,"deletions":-1}],"sizeInsertions":17,"sizeDeletions":-1},{"number":"2","revision":"0d7bb50a6555f2afd30b93409f25cd9dd22e6fd3","parents":["c8ce77d48c18b51de5573fdec3e5d0ad13d6967a"],"ref":"refs/changes/76/1376/2","uploader":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"createdOn":1485917342,"author":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1485989758,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1485917365,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/moray.js","line":664,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"It seems like we might want to commonize this with lines 600 - 624."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/moray.js","type":"MODIFIED","insertions":148,"deletions":-9}],"sizeInsertions":148,"sizeDeletions":-9},{"number":"3","revision":"d14cd5815c506f90f13ab371a1fd2da0268a2c50","parents":["e6e5be210c3e66ae6990c1e1395e25422a2390de"],"ref":"refs/changes/76/1376/3","uploader":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"createdOn":1490935591,"author":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1490935620,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/moray.js","line":432,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I think this needs to be part of \"options\".  It looks to me like we would retry indefinitely because we always set \"attempts \u003d 0\" here.  We increment it at line 444, but that\u0027s not visible anywhere else.\n\nIt would be nice to log it at line 424 as well."},{"file":"lib/moray.js","line":432,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Shoot, good catch. That would\u0027ve been a nasty bug :/"},{"file":"lib/moray.js","line":438,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"The indenting seems off here."},{"file":"lib/moray.js","line":438,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"lib/moray.js","line":621,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Is it worth asserting that there\u0027s no previousMetadata in an \"else\" block?"},{"file":"lib/moray.js","line":661,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"When do we use this function?  I would have thought we\u0027d only do it in the batch operation below."},{"file":"lib/moray.js","line":661,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"We use it for aborts. I would like it *not* to be named \"abortMPU\", as I think that hides the internals of what\u0027s actually happening from muskie too much. I realize that the analog for commits is \"commitMPU\". I think ideally \"commitMPU\" would have a more descriptive name of what\u0027s actually happening in Moray, but anything I came up with was either too vague or too long. Open to suggestions on naming."},{"file":"lib/moray.js","line":661,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Maybe just add a comment explaining when it\u0027s used vs. commitMPU?"},{"file":"lib/moray.js","line":661,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"lib/moray.js","line":662,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Any reason not to put the key into \"options\" like we do for putMetadata?"},{"file":"lib/moray.js","line":662,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Sure. I had it separated out because \"options\" was really just the metadata blob. I separated that out to be a separate sub-object in options call \u0027md\u0027, which is more idiomatic with putMetadata."},{"file":"lib/moray.js","line":907,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Do you think it\u0027s worth asserting more about the requests (so that this doesn\u0027t start getting used for other batch operations), or should we just rely on electric-moray doing that?"},{"file":"lib/moray.js","line":907,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"What else do you think might be worth asserting? I\u0027m not sure what libmanta should be responsible for versus electric-moray."},{"file":"lib/moray.js","line":907,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Maybe the type of each request and the buckets involved, if you think it\u0027s worthwhile."},{"file":"lib/moray.js","line":907,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"lib/moray.js","line":932,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"This should probably say commitMPU, and we may want a similar entry when the RPC call returns."},{"file":"lib/moray.js","line":932,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Good catch. Fixed!"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/moray.js","type":"MODIFIED","insertions":239,"deletions":-44}],"sizeInsertions":239,"sizeDeletions":-44},{"number":"4","revision":"4c6feb372da55bee937754300b689a490eba5cea","parents":["e6e5be210c3e66ae6990c1e1395e25422a2390de"],"ref":"refs/changes/76/1376/4","uploader":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"createdOn":1491368922,"author":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1491368945,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/moray.js","type":"MODIFIED","insertions":251,"deletions":-45}],"sizeInsertions":251,"sizeDeletions":-45},{"number":"5","revision":"464740d92a4ee2019aa1f581ca853ad8aee65815","parents":["e6e5be210c3e66ae6990c1e1395e25422a2390de"],"ref":"refs/changes/76/1376/5","uploader":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"createdOn":1491369070,"author":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1491409414,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1491369093,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/moray.js","type":"MODIFIED","insertions":251,"deletions":-45}],"sizeInsertions":251,"sizeDeletions":-45},{"number":"6","revision":"4c001a1f66ee7f93f65319018cd13aa8240415a2","parents":["e6e5be210c3e66ae6990c1e1395e25422a2390de"],"ref":"refs/changes/76/1376/6","uploader":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"createdOn":1491417123,"author":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1491422932,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1491422932,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1491417151,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"SUBM","value":"1","grantedOn":1491423118,"by":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/moray.js","type":"MODIFIED","insertions":260,"deletions":-45}],"sizeInsertions":260,"sizeDeletions":-45}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"}]}