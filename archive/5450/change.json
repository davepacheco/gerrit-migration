{"project":"joyent/sdc-cnapi","branch":"master","id":"If0f1321fc6fd9e61649bd30ea19f63edf10ee927","number":"5450","subject":"TRITON-1173 add CNAPI/cn-agent support for uninstalling agents Reviewed by: Josh Wilsdon \u003cjosh@wilsdon.ca\u003e Approved by: Josh Wilsdon \u003cjosh@wilsdon.ca\u003e","owner":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"url":"https://cr.joyent.us/5450","commitMessage":"TRITON-1173 add CNAPI/cn-agent support for uninstalling agents\nReviewed by: Josh Wilsdon \u003cjosh@wilsdon.ca\u003e\nApproved by: Josh Wilsdon \u003cjosh@wilsdon.ca\u003e\n","createdOn":1548812457,"lastUpdated":1548958580,"open":false,"status":"MERGED","comments":[{"timestamp":1548812457,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Uploaded patch set 1."},{"timestamp":1548812459,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit aa925c754f49c42eada84ebefcc172cc4e4adc89\n    \n    first crack"},{"timestamp":1548812486,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing-1\n\n(2 comments)\n\n\"make check\" exited with status 2"},{"timestamp":1548812644,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Uploaded patch set 2."},{"timestamp":1548812645,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit 273ff3c397d985aa0b27238d2b6f40adebba3d24\n    \n    fix \u0027make check\u0027"},{"timestamp":1548812675,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1548833317,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 2:\n\n(2 comments)"},{"timestamp":1548894045,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Uploaded patch set 3."},{"timestamp":1548894046,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 3:\n\nNew commits:\n    \n    commit 1a6e2a7adc330a8886941a7af86c9b4d4a2fe39f\n    \n    update from joshw suggestion"},{"timestamp":1548894077,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1548894090,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 2:\n\n(2 comments)"},{"timestamp":1548905548,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Uploaded patch set 4."},{"timestamp":1548905550,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 4:\n\nNew commits:\n    \n    commit 732bba4799001b191a1db26781fb04aee4fb4d29\n    \n    update from joshw suggestion\n    \n    commit 51df60e0969e385288ae468f397cab5755bf7ef8\n    \n    fix \u0027make check\u0027\n    \n    commit cacbcd4ee2c32ac73cc7e5702f1436e158325371\n    \n    first crack"},{"timestamp":1548905582,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1548912504,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 4: Code-Review+1 Integration-Approval+1\n\n(1 comment)"},{"timestamp":1548958364,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Uploaded patch set 5."},{"timestamp":1548958365,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 5:\n\nNew commits:\n    \n    commit 86778d611e987c246ddba2e2dc02ab19cbd85a94\n    \n    update from joshw suggestion\n    \n    commit 66759cb6af06c09c7f6b924d0e3cdea1cb2b96ef\n    \n    fix \u0027make check\u0027\n    \n    commit f00f98cc6fd8239116fa70638b862a4881206abc\n    \n    first crack"},{"timestamp":1548958397,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1548958486,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 5: Code-Review+1 Integration-Approval+1"},{"timestamp":1548958580,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Trent Mick"}],"currentPatchSet":{"number":"5","revision":"f0f1321fc6fd9e61649bd30ea19f63edf10ee927","parents":["40261875586ae16d4e5ed209d6ee402dabeb9ae2"],"ref":"refs/changes/50/5450/5","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1548958364,"author":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1548958397,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1548958486,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1548958486,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"SUBM","value":"1","grantedOn":1548958580,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":21,"deletions":0},{"file":"lib/endpoints/servers.js","type":"MODIFIED","insertions":115,"deletions":-1},{"file":"lib/errors.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"tools/rsync-to","type":"MODIFIED","insertions":2,"deletions":-4}],"sizeInsertions":141,"sizeDeletions":-7},"patchSets":[{"number":"1","revision":"2ab5cf22d55f308001e10287b6c9753d4629006e","parents":["992684d3a91780dd6a38f10dfc157c8187c10cbb"],"ref":"refs/changes/50/5450/1","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1548812457,"author":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1548812486,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/endpoints/servers.js","line":1372,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"warning: missing semicolon"},{"file":"lib/endpoints/servers.js","line":1376,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"warning: missing semicolon"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":23,"deletions":-2},{"file":"lib/endpoints/servers.js","type":"MODIFIED","insertions":115,"deletions":-2},{"file":"lib/errors.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"tools/rsync-to","type":"MODIFIED","insertions":2,"deletions":-4}],"sizeInsertions":143,"sizeDeletions":-10},{"number":"2","revision":"b77f42261c990b3f0cd7c17a0c0967c8a02a080f","parents":["992684d3a91780dd6a38f10dfc157c8187c10cbb"],"ref":"refs/changes/50/5450/2","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1548812644,"author":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1548812675,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"docs/index.md","line":1468,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"is it just gerrit making the large spaces here in the middle of sentences?"},{"file":"docs/index.md","line":1468,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"No, this is a limitation of the jsdoc stuff that CNAPI has for pulling docs from a code block comment for this field that is wrapped over multiple lines with leading indentation. See https://cr.joyent.us/#/c/5450/2/lib/endpoints/servers.js@1307\n\nThis index.md is updated via `make regen_docs`."},{"file":"docs/index.md","line":1468,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Ewww."},{"file":"tools/rsync-to","line":24,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Was the goal here to no longer check if the instance is running? If that was unintentional, perhaps:\n\n    vmadm lookup -1  tags.smartdc_role\u003d$ROLE state\u003drunning\n\nwould be closer to what we want here? If it was intentional, state\u003drunning could be removed. Unless it was also intentional to change to look only at the alias and not the smartdc_role tag, in which case... carry on."},{"file":"tools/rsync-to","line":24,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Yours is better. It was not intentional. The intention was only to be able to run this rsync-to script without having to wait for my newly booted COAL to have VMAPI running.  Updated."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":23,"deletions":-2},{"file":"lib/endpoints/servers.js","type":"MODIFIED","insertions":116,"deletions":-2},{"file":"lib/errors.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"tools/rsync-to","type":"MODIFIED","insertions":2,"deletions":-4}],"sizeInsertions":144,"sizeDeletions":-10},{"number":"3","revision":"e3e055775ec957b0f5262d1bcfb718f51d7499a6","parents":["992684d3a91780dd6a38f10dfc157c8187c10cbb"],"ref":"refs/changes/50/5450/3","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1548894045,"author":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1548894077,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":23,"deletions":-2},{"file":"lib/endpoints/servers.js","type":"MODIFIED","insertions":116,"deletions":-2},{"file":"lib/errors.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"tools/rsync-to","type":"MODIFIED","insertions":2,"deletions":-4}],"sizeInsertions":144,"sizeDeletions":-10},{"number":"4","revision":"0fa51197d2b46977880957388d1206365ac55d26","parents":["c1c4ed18939ddab565877aa73ac59acad787676a"],"ref":"refs/changes/50/5450/4","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1548905548,"author":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1548905582,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1548912504,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1548912504,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":22,"deletions":-1},{"file":"lib/endpoints/servers.js","type":"MODIFIED","insertions":116,"deletions":-2},{"file":"lib/errors.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"tools/rsync-to","type":"MODIFIED","insertions":2,"deletions":-4}],"sizeInsertions":143,"sizeDeletions":-9},{"number":"5","revision":"f0f1321fc6fd9e61649bd30ea19f63edf10ee927","parents":["40261875586ae16d4e5ed209d6ee402dabeb9ae2"],"ref":"refs/changes/50/5450/5","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1548958364,"author":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1548958397,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"SUBM","value":"1","grantedOn":1548958580,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1548958486,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1548958486,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":21,"deletions":0},{"file":"lib/endpoints/servers.js","type":"MODIFIED","insertions":115,"deletions":-1},{"file":"lib/errors.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"tools/rsync-to","type":"MODIFIED","insertions":2,"deletions":-4}],"sizeInsertions":141,"sizeDeletions":-7}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}]}