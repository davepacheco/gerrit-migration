{"project":"joyent/illumos-joyent","branch":"master","id":"I914d7a738527f83b1e811b066563842839f125a7","number":"2623","subject":"OS-4595 lxbrand needs /proc/sys/net/ipv4/tcp_retries2 OS-5337 Add support for sysctl net.ipv4.icmp_echo_ignore_broadcasts OS-5338 Add support for sysctl net.ipv4.ip_forward Reviewed by: Dan McDonald \u003cdanmcd@joyent.com\u003e Approved by: Dan McDonald \u003cdanmcd@jo","owner":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"url":"https://cr.joyent.us/2623","commitMessage":"OS-4595 lxbrand needs /proc/sys/net/ipv4/tcp_retries2\nOS-5337 Add support for sysctl net.ipv4.icmp_echo_ignore_broadcasts\nOS-5338 Add support for sysctl net.ipv4.ip_forward\nReviewed by: Dan McDonald \u003cdanmcd@joyent.com\u003e\nApproved by: Dan McDonald \u003cdanmcd@joyent.com\u003e\n","createdOn":1505918213,"lastUpdated":1506951689,"open":false,"status":"MERGED","comments":[{"timestamp":1505918213,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 1."},{"timestamp":1506557279,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 1:\n\n(1 comment)\n\nHave you tested the tcp_retries2?  Since only 0-15 are available, you should be able to produce a table with #retries and f(retries)."},{"timestamp":1506600063,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 1:\n\n(1 comment)\n\nI don\u0027t understand your general comment about a table. Are you asking me to rewrite this to use a table lookup instead?"},{"timestamp":1506607032,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 1:\n\nSorry for not being clear.  I was thinking about a table solely from the perspective of testing (since you only allow 0-15).  The important part was the testing of tcp_retries2."},{"timestamp":1506698257,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 1:\n\n(1 comment)\n\nJust a comment change."},{"timestamp":1506712532,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1506712547,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 2."},{"timestamp":1506712603,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1506712648,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 2: Code-Review+1\n\n(2 comments)\n\nThank you!"},{"timestamp":1506713868,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 2:\n\nI have tested by visually inspecting each /proc file. I have also done the same using sysctl and used sysctl to update the values. For example:\nub14# sysctl net.ipv4.tcp_retries2\nnet.ipv4.tcp_retries2 \u003d 8\nub14# sysctl net.ipv4.tcp_retries2\u003d3\nnet.ipv4.tcp_retries2 \u003d 3\nub14# sysctl net.ipv4.tcp_retries2\nnet.ipv4.tcp_retries2 \u003d 3\nub14# sysctl net.ipv4.icmp_echo_ignore_broadcasts\nnet.ipv4.icmp_echo_ignore_broadcasts \u003d 0\nub14# sysctl net.ipv4.icmp_echo_ignore_broadcasts\u003d1\nnet.ipv4.icmp_echo_ignore_broadcasts \u003d 1\nub14# sysctl net.ipv4.icmp_echo_ignore_broadcasts\nnet.ipv4.icmp_echo_ignore_broadcasts \u003d 1"},{"timestamp":1506950877,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 2: Integration-Approval+1"},{"timestamp":1506951606,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 3: Patch Set 2 was rebased."},{"timestamp":1506951674,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 4: Commit message was updated."},{"timestamp":1506951689,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Jerry Jelinek"}],"currentPatchSet":{"number":"4","revision":"914d7a738527f83b1e811b066563842839f125a7","parents":["cb12f3ba82f2ce84ae8139e27589e39f842a9fb2"],"ref":"refs/changes/23/2623/4","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1506951674,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1506712648,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1506950877,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"SUBM","value":"1","grantedOn":1506951688,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"usr/src/uts/common/brand/lx/procfs/lx_proc.h","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/uts/common/brand/lx/procfs/lx_prvnops.c","type":"MODIFIED","insertions":227,"deletions":0}],"sizeInsertions":230,"sizeDeletions":0},"patchSets":[{"number":"1","revision":"10d7f0aca048961c3527ead402b7506343dfdc19","parents":["766f80363ee325875bdcd79484e9c04427d17aec"],"ref":"refs/changes/23/2623/1","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1505918213,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/uts/common/brand/lx/procfs/lx_prvnops.c","line":4942,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"If a grinning weirdo uses /native/.../ndd to enable global forwarding or /native/.../ifconfig to enable per-ill/interface forwarding, then what?  IIRC, my own LX experiments indicated that /native tools will manipulate the netstack just like tools in a native (OS,ipkg,lipkg,etc.) zone.\n\nIf using /native/.../* works, even if it\u0027s unsupported, at least be more precise and say something like \"We do not support Linux-ABI methods for enabling/disabling forwarding at this time.\""},{"file":"usr/src/uts/common/brand/lx/procfs/lx_prvnops.c","line":4942,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Yes, using native tools works and sometimes those are used. For forwarding, I think there is a bunch more work necessary to enable that for an lx zone. I have updated the comment as you suggested."},{"file":"usr/src/uts/common/brand/lx/procfs/lx_prvnops.c","line":7371,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Are we heading toward a day where we\u0027ll need lxpr_write_ip_property?!?"},{"file":"usr/src/uts/common/brand/lx/procfs/lx_prvnops.c","line":7371,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Yes, it is possible that we\u0027ll need that function in the future. If we had more proc files which would make use of that, then we should refactor this code to create a function like that, similar to what we have for tcp."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/uts/common/brand/lx/procfs/lx_proc.h","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/uts/common/brand/lx/procfs/lx_prvnops.c","type":"MODIFIED","insertions":226,"deletions":0}],"sizeInsertions":229,"sizeDeletions":0},{"number":"2","revision":"e73eb752eefa1c6f7becf41ded0b3db3771155f8","parents":["ffeae41cb1d13f7eed5a29287a0b7bbac7edc7b5"],"ref":"refs/changes/23/2623/2","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1506712547,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1506712648,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1506950877,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}}],"comments":[{"file":"usr/src/uts/common/brand/lx/procfs/lx_prvnops.c","line":1786,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"this was from an earlier rebase onto the latest"},{"file":"usr/src/uts/common/brand/lx/procfs/lx_prvnops.c","line":1786,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Done"},{"file":"usr/src/uts/common/brand/lx/procfs/lx_prvnops.c","line":4947,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Thank you."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/uts/common/brand/lx/procfs/lx_proc.h","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/uts/common/brand/lx/procfs/lx_prvnops.c","type":"MODIFIED","insertions":227,"deletions":0}],"sizeInsertions":230,"sizeDeletions":0},{"number":"3","revision":"58be9ff6776a1fd757cd7044625ae9ec291071ad","parents":["cb12f3ba82f2ce84ae8139e27589e39f842a9fb2"],"ref":"refs/changes/23/2623/3","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1506951606,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1506712648,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1506950877,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/uts/common/brand/lx/procfs/lx_proc.h","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/uts/common/brand/lx/procfs/lx_prvnops.c","type":"MODIFIED","insertions":227,"deletions":0}],"sizeInsertions":230,"sizeDeletions":0},{"number":"4","revision":"914d7a738527f83b1e811b066563842839f125a7","parents":["cb12f3ba82f2ce84ae8139e27589e39f842a9fb2"],"ref":"refs/changes/23/2623/4","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1506951674,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"SUBM","value":"1","grantedOn":1506951688,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1506712648,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1506950877,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"usr/src/uts/common/brand/lx/procfs/lx_proc.h","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/uts/common/brand/lx/procfs/lx_prvnops.c","type":"MODIFIED","insertions":227,"deletions":0}],"sizeInsertions":230,"sizeDeletions":0}],"allReviewers":[{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}]}