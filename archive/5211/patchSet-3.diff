From d70165c997a2d61a1ea7893b488074f450054881 Mon Sep 17 00:00:00 2001
From: Alex Wilson <alex.wilson@joyent.com>
Date: Fri, 7 Dec 2018 13:13:52 -0800
Subject: [PATCH] MANTA-4042 confusing message when accessing unauthorized
 paths Reviewed by: Robert Mustacchi <rm@joyent.com> Approved by: Robert
 Mustacchi <rm@joyent.com>

---
 lib/client.js | 13 ++++++++-----
 package.json  |  2 +-
 2 files changed, 9 insertions(+), 6 deletions(-)

diff --git a/lib/client.js b/lib/client.js
index 552fb8c..94aebe4 100644
--- a/lib/client.js
+++ b/lib/client.js
@@ -464,14 +464,17 @@ MahiClient.prototype.authorize = function authorize(opts) {
     }
 
     /*
-     * Deny if the caller or owner is not approved for provisioning.
-     * Operators will have been allowed access above regardless of approved
-     * for provisioning status on their account or the owner of the resource.
+     * Deny if the caller or owner is not approved for provisioning (unless
+     * either caller is an operator or the owner is an operator and it's only
+     * the owner that isn't approved).
      */
-    if (!principal.account.approved_for_provisioning) {
+    if (!principal.account.approved_for_provisioning &&
+        !principal.account.isOperator) {
         throw new errors.AccountBlockedError(principal.account.login);
     }
-    if (!resource.owner.account.approved_for_provisioning) {
+    if (!resource.owner.account.approved_for_provisioning &&
+        !resource.owner.account.isOperator &&
+        !principal.account.isOperator) {
         throw new errors.AccountBlockedError(resource.owner.account.login);
     }
 
diff --git a/package.json b/package.json
index 787fb2f..be11d74 100644
--- a/package.json
+++ b/package.json
@@ -1,7 +1,7 @@
 {
     "name": "mahi",
     "description": "Mahi client",
-    "version": "2.2.3",
+    "version": "2.2.4",
     "author": "Joyent (joyent.com)",
     "main": "index.js",
     "dependencies": {
-- 
2.21.0

