{"project":"joyent/sdcadm","branch":"master","id":"Ie65d00ec66519e97bc2d1bca792c660eb2e4eb0b","number":"1442","subject":"TOOLS-1675 `sdcadm post-setup docker` should only setup, not update Reviewed by: Trent Mick \u003ctrent.mick@joyent.com\u003e","owner":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"url":"https://cr.joyent.us/1442","commitMessage":"TOOLS-1675 `sdcadm post-setup docker` should only setup, not update\nReviewed by: Trent Mick \u003ctrent.mick@joyent.com\u003e\n","createdOn":1486407485,"lastUpdated":1487608717,"open":false,"status":"MERGED","comments":[{"timestamp":1486407485,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 1."},{"timestamp":1486407518,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1486408806,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 2: Patch Set 1 was rebased."},{"timestamp":1486408843,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2:\n\n\"make check\" passed ok"},{"timestamp":1486599267,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 2:\n\n(2 comments)"},{"timestamp":1487090186,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 3."},{"timestamp":1487090219,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1487191064,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 3: Code-Review+1 Integration-Approval+1\n\n```\n[root@headnode (coal) ~]# sdcadm post-setup docker\n\"docker\" VM already has a delegate dataset\nUpdated SDC Docker (3s)\n```\n\n^^^ when doing nothing. It would be good to at least drop the \"already has a delegate dataset\" line (i.e. getting towards the Unix tool ideal of \"say nothing when doing nothing\"). That is this line: https://github.com/joyent/sdcadm/blob/master/lib/procedures/shared.js#L1050\n\nOr fine to do that separately. :)"},{"timestamp":1487608717,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Pedro Palazón Candel"}],"currentPatchSet":{"number":"3","revision":"e65d00ec66519e97bc2d1bca792c660eb2e4eb0b","parents":["541923162247dbb232cfc842a33842f6da6dcf2c"],"ref":"refs/changes/42/1442/3","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1487090186,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1487090219,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1487191064,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1487191064,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1487608717,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"lib/post-setup/docker.js","type":"MODIFIED","insertions":160,"deletions":-65},{"file":"man/man1/sdcadm.1.ronn","type":"MODIFIED","insertions":14,"deletions":-3}],"sizeInsertions":174,"sizeDeletions":-68},"patchSets":[{"number":"1","revision":"8385c43c4e24a6bceedb20ed8fcc17ab3458676a","parents":["67a2f42b011d95e856210cbe662252234bd9d5a4"],"ref":"refs/changes/42/1442/1","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1486407485,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1486407518,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/post-setup/docker.js","type":"MODIFIED","insertions":139,"deletions":-52},{"file":"man/man1/sdcadm.1.ronn","type":"MODIFIED","insertions":9,"deletions":-3}],"sizeInsertions":148,"sizeDeletions":-55},{"number":"2","revision":"af1ea3eb2bf59db8cd2b38bd29bcebc63c4d9bd7","parents":["15bc1c85511709f20ac8a73f55b7a07436f8e16c"],"ref":"refs/changes/42/1442/2","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1486408806,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1486407518,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/post-setup/docker.js","line":229,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"This change should be done for haveDockerImageAlready as well right?"},{"file":"lib/post-setup/docker.js","line":825,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"\u0027sdcadm post-setup\u0027 uses this whole first sentence for the command output:\n\n```\n[root@headnode (coal) ~]# sdcadm post-setup | col80\nCommon post-setup procedures.\n...\nCommands:\n...\n    underlay-nics         Provisions underlay NICs on the provided underlay network for the\n    ha-binder             HA setup for binder/zookeeper services using binder instances.\n    ha-manatee            Create 2nd and 3rd manatee instances as the 1st required step for HA.\n    docker                Create the docker service, the docker instance on the headnode and install dockerlogger.\n...\n    dev-headnode-prov     Make the headnode provisionable, for development and testing.\n    dev-sample-data       Add sample data suitable for *development and testing*.\n```\n\nThis intro sentence is too long. (Actually all of the quoted ones above are too long for 80-cols, but that\u0027s for another ticket.)\n\nPerhaps something like:\n\n```\ndo_docker.help \u003d [\n    \u0027Setup the Docker service.\u0027,\n    \u0027\u0027,\n    \u0027This command will create the \"docker\" and \"dockerlogger\" services, create\u0027,\n    \u0027the initial docker zone on the headnode, and install the dockerlogger\u0027,\n    \u0027agent on all setup servers (or a subset of servers if \"-s\" is used).\u0027,\n    \u0027\u0027,\n    \u0027Usage:\u0027,\n    \u0027     {{name}} docker [OPTIONS]\u0027,\n    \u0027\u0027,\n    \u0027{{options}}\u0027\n].join(\u0027\\n\u0027);\n```"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/post-setup/docker.js","type":"MODIFIED","insertions":139,"deletions":-52},{"file":"man/man1/sdcadm.1.ronn","type":"MODIFIED","insertions":9,"deletions":-3}],"sizeInsertions":148,"sizeDeletions":-55},{"number":"3","revision":"e65d00ec66519e97bc2d1bca792c660eb2e4eb0b","parents":["541923162247dbb232cfc842a33842f6da6dcf2c"],"ref":"refs/changes/42/1442/3","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1487090186,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1487090219,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1487191064,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1487191064,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1487608717,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"lib/post-setup/docker.js","type":"MODIFIED","insertions":160,"deletions":-65},{"file":"man/man1/sdcadm.1.ronn","type":"MODIFIED","insertions":14,"deletions":-3}],"sizeInsertions":174,"sizeDeletions":-68}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}]}