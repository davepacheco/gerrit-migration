{"project":"joyent/sdc-net-agent","branch":"master","topic":"RFD 28","id":"Ia3a456da34dc3b9e7a63b08e74f25eaa24067a46","number":"6220","subject":"TRITON-843 Add test suite to net-agent Reviewed by: Michael Zeller \u003cmike.zeller@joyent.com\u003e Approved by: Michael Zeller \u003cmike.zeller@joyent.com\u003e","owner":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"url":"https://cr.joyent.us/6220","commitMessage":"TRITON-843 Add test suite to net-agent\nReviewed by: Michael Zeller \u003cmike.zeller@joyent.com\u003e\nApproved by: Michael Zeller \u003cmike.zeller@joyent.com\u003e\n","createdOn":1557361732,"lastUpdated":1562616503,"open":false,"status":"MERGED","comments":[{"timestamp":1557361732,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 1."},{"timestamp":1557361830,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1559152421,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 2."},{"timestamp":1559152464,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1559153466,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Topic set to RFD 28"},{"timestamp":1560374780,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 3."},{"timestamp":1560374825,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1562361985,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Patch Set 3:\n\n(7 comments)\n\nOverall this looks pretty great! Just a few small things."},{"timestamp":1562608854,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 4."},{"timestamp":1562608901,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 4:\n\n(3 comments)\n\nI\u0027ve left the copyrights in test/lib/*.js as is, since they came from NAPI."},{"timestamp":1562608905,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1562608929,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 4:\n\nI reran the test suite with the latest patchset, and everything still passes."},{"timestamp":1562610895,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Patch Set 4: Code-Review+1"},{"timestamp":1562611330,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Patch Set 4: Integration-Approval+1"},{"timestamp":1562616492,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 5: Commit message was updated."},{"timestamp":1562616503,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Cody Peter Mello"}],"currentPatchSet":{"number":"5","revision":"a3a456da34dc3b9e7a63b08e74f25eaa24067a46","parents":["5d848e0473d265caa4f0d30d1adce89234c47c9a"],"ref":"refs/changes/20/6220/5","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1562616492,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1562608905,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1562610895,"by":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1562611330,"by":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"}},{"type":"SUBM","value":"1","grantedOn":1562616503,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":1,"deletions":0},{"file":"lib/common.js","type":"MODIFIED","insertions":36,"deletions":-1},{"file":"lib/net-agent.js","type":"MODIFIED","insertions":1,"deletions":-9},{"file":"lib/server-fsm.js","type":"MODIFIED","insertions":1,"deletions":-29},{"file":"test/integration/create-nics.test.js","type":"ADDED","insertions":159,"deletions":0},{"file":"test/integration/napi-changes.test.js","type":"ADDED","insertions":753,"deletions":0},{"file":"test/lib/client.js","type":"ADDED","insertions":49,"deletions":0},{"file":"test/lib/common.js","type":"ADDED","insertions":685,"deletions":0},{"file":"test/lib/config.js","type":"ADDED","insertions":29,"deletions":0},{"file":"test/lib/log.js","type":"ADDED","insertions":28,"deletions":0},{"file":"test/lib/net.js","type":"ADDED","insertions":323,"deletions":0},{"file":"test/lib/nic.js","type":"ADDED","insertions":309,"deletions":0},{"file":"test/lib/vm.js","type":"ADDED","insertions":168,"deletions":0},{"file":"test/runtest","type":"ADDED","insertions":45,"deletions":0},{"file":"test/runtests","type":"ADDED","insertions":166,"deletions":0},{"file":"test/unit/util.test.js","type":"MODIFIED","insertions":7,"deletions":0}],"sizeInsertions":2760,"sizeDeletions":-39},"patchSets":[{"number":"1","revision":"85e6c30a3005e43b8c89e58406e33b51e77e09e3","parents":["5a3eda78668bae1ac2520d51d6f7225dcf1fc114"],"ref":"refs/changes/20/6220/1","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1557361732,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1557361830,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":1,"deletions":0},{"file":"lib/common.js","type":"MODIFIED","insertions":38,"deletions":-1},{"file":"lib/net-agent.js","type":"MODIFIED","insertions":1,"deletions":-9},{"file":"lib/server-fsm.js","type":"MODIFIED","insertions":1,"deletions":-29},{"file":"test/integration/create-nics.test.js","type":"ADDED","insertions":159,"deletions":0},{"file":"test/integration/napi-changes.test.js","type":"ADDED","insertions":750,"deletions":0},{"file":"test/lib/client.js","type":"ADDED","insertions":49,"deletions":0},{"file":"test/lib/common.js","type":"ADDED","insertions":685,"deletions":0},{"file":"test/lib/config.js","type":"ADDED","insertions":29,"deletions":0},{"file":"test/lib/log.js","type":"ADDED","insertions":28,"deletions":0},{"file":"test/lib/net.js","type":"ADDED","insertions":323,"deletions":0},{"file":"test/lib/nic.js","type":"ADDED","insertions":309,"deletions":0},{"file":"test/lib/vm.js","type":"ADDED","insertions":168,"deletions":0},{"file":"test/unit/util.test.js","type":"MODIFIED","insertions":7,"deletions":0}],"sizeInsertions":2548,"sizeDeletions":-39},{"number":"2","revision":"22db62589e0cf42b860952e463d38fd5c2a7d262","parents":["a7ec38be08277088970309011b214b519cf6a555"],"ref":"refs/changes/20/6220/2","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1559152421,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1559152464,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":1,"deletions":0},{"file":"lib/common.js","type":"MODIFIED","insertions":34,"deletions":-1},{"file":"lib/net-agent.js","type":"MODIFIED","insertions":1,"deletions":-9},{"file":"lib/server-fsm.js","type":"MODIFIED","insertions":1,"deletions":-29},{"file":"test/integration/create-nics.test.js","type":"ADDED","insertions":159,"deletions":0},{"file":"test/integration/napi-changes.test.js","type":"ADDED","insertions":750,"deletions":0},{"file":"test/lib/client.js","type":"ADDED","insertions":49,"deletions":0},{"file":"test/lib/common.js","type":"ADDED","insertions":685,"deletions":0},{"file":"test/lib/config.js","type":"ADDED","insertions":29,"deletions":0},{"file":"test/lib/log.js","type":"ADDED","insertions":28,"deletions":0},{"file":"test/lib/net.js","type":"ADDED","insertions":323,"deletions":0},{"file":"test/lib/nic.js","type":"ADDED","insertions":309,"deletions":0},{"file":"test/lib/vm.js","type":"ADDED","insertions":168,"deletions":0},{"file":"test/unit/util.test.js","type":"MODIFIED","insertions":7,"deletions":0}],"sizeInsertions":2544,"sizeDeletions":-39},{"number":"3","revision":"8d3dc5e0940986e276d780bc430d4e42524405c2","parents":["5d848e0473d265caa4f0d30d1adce89234c47c9a"],"ref":"refs/changes/20/6220/3","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1560374780,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1560374825,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/common.js","line":82,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"nit: assert this is a function?"},{"file":"lib/common.js","line":82,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Done"},{"file":"test/integration/napi-changes.test.js","line":97,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"I assume this sets no timeout.  Will jenkins kill a long running task in this case or will this block possibly until someone notices a long running job?"},{"file":"test/integration/napi-changes.test.js","line":97,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Jenkins will, afaik, not automatically kill any tasks. Someone has to notice that job has been running for a while and either step in to fix it, or cancel the task.\n\nWe currently import images using imgadm for other tests (like vmadm and fwadm\u0027s tests), so I don\u0027t think that imgadm imports have been a problem for Jenkins."},{"file":"test/integration/napi-changes.test.js","line":141,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Should these be constants like the rest of the network params?"},{"file":"test/integration/napi-changes.test.js","line":141,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Done"},{"file":"test/lib/common.js","line":8,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"2019"},{"file":"test/lib/config.js","line":8,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"2019?"},{"file":"test/lib/nic.js","line":8,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"2019?"},{"file":"test/runtests","line":83,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"nit: a bunch of variables starting from here until EOF could use quotes to avoid any word splitting issues."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":1,"deletions":0},{"file":"lib/common.js","type":"MODIFIED","insertions":34,"deletions":-1},{"file":"lib/net-agent.js","type":"MODIFIED","insertions":1,"deletions":-9},{"file":"lib/server-fsm.js","type":"MODIFIED","insertions":1,"deletions":-29},{"file":"test/integration/create-nics.test.js","type":"ADDED","insertions":159,"deletions":0},{"file":"test/integration/napi-changes.test.js","type":"ADDED","insertions":750,"deletions":0},{"file":"test/lib/client.js","type":"ADDED","insertions":49,"deletions":0},{"file":"test/lib/common.js","type":"ADDED","insertions":685,"deletions":0},{"file":"test/lib/config.js","type":"ADDED","insertions":29,"deletions":0},{"file":"test/lib/log.js","type":"ADDED","insertions":28,"deletions":0},{"file":"test/lib/net.js","type":"ADDED","insertions":323,"deletions":0},{"file":"test/lib/nic.js","type":"ADDED","insertions":309,"deletions":0},{"file":"test/lib/vm.js","type":"ADDED","insertions":168,"deletions":0},{"file":"test/runtest","type":"ADDED","insertions":45,"deletions":0},{"file":"test/runtests","type":"ADDED","insertions":166,"deletions":0},{"file":"test/unit/util.test.js","type":"MODIFIED","insertions":7,"deletions":0}],"sizeInsertions":2755,"sizeDeletions":-39},{"number":"4","revision":"9c90a173d66d46d5e67531f4bd6abc7d6df80bf6","parents":["5d848e0473d265caa4f0d30d1adce89234c47c9a"],"ref":"refs/changes/20/6220/4","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1562608854,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1562608905,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1562610895,"by":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1562611330,"by":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":1,"deletions":0},{"file":"lib/common.js","type":"MODIFIED","insertions":36,"deletions":-1},{"file":"lib/net-agent.js","type":"MODIFIED","insertions":1,"deletions":-9},{"file":"lib/server-fsm.js","type":"MODIFIED","insertions":1,"deletions":-29},{"file":"test/integration/create-nics.test.js","type":"ADDED","insertions":159,"deletions":0},{"file":"test/integration/napi-changes.test.js","type":"ADDED","insertions":753,"deletions":0},{"file":"test/lib/client.js","type":"ADDED","insertions":49,"deletions":0},{"file":"test/lib/common.js","type":"ADDED","insertions":685,"deletions":0},{"file":"test/lib/config.js","type":"ADDED","insertions":29,"deletions":0},{"file":"test/lib/log.js","type":"ADDED","insertions":28,"deletions":0},{"file":"test/lib/net.js","type":"ADDED","insertions":323,"deletions":0},{"file":"test/lib/nic.js","type":"ADDED","insertions":309,"deletions":0},{"file":"test/lib/vm.js","type":"ADDED","insertions":168,"deletions":0},{"file":"test/runtest","type":"ADDED","insertions":45,"deletions":0},{"file":"test/runtests","type":"ADDED","insertions":166,"deletions":0},{"file":"test/unit/util.test.js","type":"MODIFIED","insertions":7,"deletions":0}],"sizeInsertions":2760,"sizeDeletions":-39},{"number":"5","revision":"a3a456da34dc3b9e7a63b08e74f25eaa24067a46","parents":["5d848e0473d265caa4f0d30d1adce89234c47c9a"],"ref":"refs/changes/20/6220/5","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1562616492,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"SUBM","value":"1","grantedOn":1562616503,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1562608905,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1562610895,"by":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1562611330,"by":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":1,"deletions":0},{"file":"lib/common.js","type":"MODIFIED","insertions":36,"deletions":-1},{"file":"lib/net-agent.js","type":"MODIFIED","insertions":1,"deletions":-9},{"file":"lib/server-fsm.js","type":"MODIFIED","insertions":1,"deletions":-29},{"file":"test/integration/create-nics.test.js","type":"ADDED","insertions":159,"deletions":0},{"file":"test/integration/napi-changes.test.js","type":"ADDED","insertions":753,"deletions":0},{"file":"test/lib/client.js","type":"ADDED","insertions":49,"deletions":0},{"file":"test/lib/common.js","type":"ADDED","insertions":685,"deletions":0},{"file":"test/lib/config.js","type":"ADDED","insertions":29,"deletions":0},{"file":"test/lib/log.js","type":"ADDED","insertions":28,"deletions":0},{"file":"test/lib/net.js","type":"ADDED","insertions":323,"deletions":0},{"file":"test/lib/nic.js","type":"ADDED","insertions":309,"deletions":0},{"file":"test/lib/vm.js","type":"ADDED","insertions":168,"deletions":0},{"file":"test/runtest","type":"ADDED","insertions":45,"deletions":0},{"file":"test/runtests","type":"ADDED","insertions":166,"deletions":0},{"file":"test/unit/util.test.js","type":"MODIFIED","insertions":7,"deletions":0}],"sizeInsertions":2760,"sizeDeletions":-39}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}]}