From bb13a446d822b832b494ee72a438aa859f1da8d5 Mon Sep 17 00:00:00 2001
From: Josh Wilsdon <josh@wilsdon.ca>
Date: Wed, 21 Nov 2018 08:58:45 -0800
Subject: [PATCH] TRITON-976 agents-installer should have option to just unpack
 shar without executing install.sh

---
 mk-agents-shar | 13 +++++++++++--
 package.json   |  2 +-
 2 files changed, 12 insertions(+), 3 deletions(-)

diff --git a/mk-agents-shar b/mk-agents-shar
index 7158859..9f3bbf0 100755
--- a/mk-agents-shar
+++ b/mk-agents-shar
@@ -219,8 +219,13 @@ function mk_agents_shar() {
 
     (cat <<__EOF__
 #!/bin/sh
-if [ \`pwd\` != '$tmp' ]; then
-  cd $tmp
+if [[ \`pwd\` != '$tmp' ]]; then
+    cd $tmp
+fi
+
+if [[ -n \$AGENTSSHAR_UNPACK_SUBDIR ]]; then
+    mkdir -p \$AGENTSSHAR_UNPACK_SUBDIR
+    cd \$AGENTSSHAR_UNPACK_SUBDIR
 fi
 
 # Clean up possible previous runs
@@ -233,6 +238,10 @@ __EOF__
 set -o errexit
 set -o pipefail
 
+if [[ \$AGENTSSHAR_UNPACK_ONLY == "true" ]]; then
+    exit 0
+fi
+
 if [[ -f agents/install.sh ]]; then
     (cd agents && /bin/bash ./install.sh)
 fi
diff --git a/package.json b/package.json
index 7000262..9c289b3 100644
--- a/package.json
+++ b/package.json
@@ -1,7 +1,7 @@
 {
   "name": "agents-installer",
   "description": "Build agentsshar package for SDC",
-  "version": "2.1.0",
+  "version": "2.2.0",
   "author": "Joyent (joyent.com)",
   "private": true,
   "dependencies": {
-- 
2.21.0

