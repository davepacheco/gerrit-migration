{"project":"joyent/muppet","branch":"master","id":"Icabef4d095dec75e85eb4ae7e5f124179ff8fd44","number":"4186","subject":"MANTA-3753 muppet should leverage autometadata instead of checking nictags Reviewed by: Jared Morrow \u003cjared.morrow@joyent.com\u003e Approved by: Cody Mello \u003ccody.mello@joyent.com\u003e","owner":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"url":"https://cr.joyent.us/4186","commitMessage":"MANTA-3753 muppet should leverage autometadata instead of checking nictags\nReviewed by: Jared Morrow \u003cjared.morrow@joyent.com\u003e\nApproved by: Cody Mello \u003ccody.mello@joyent.com\u003e\n","createdOn":1528829388,"lastUpdated":1530622455,"open":false,"status":"MERGED","comments":[{"timestamp":1528829388,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 1."},{"timestamp":1528829414,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1528908612,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"Patch Set 1: Code-Review+1"},{"timestamp":1528910463,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 1: Code-Review+1\n\n(1 comment)"},{"timestamp":1528910520,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1528914453,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1529008592,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 2."},{"timestamp":1529008630,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1529076406,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 3."},{"timestamp":1529076432,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1529416197,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"Patch Set 3:\n\n(2 comments)"},{"timestamp":1530021906,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Patch Set 3:\n\n(1 comment)"},{"timestamp":1530108675,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"Patch Set 3:\n\n(1 comment)"},{"timestamp":1530114816,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"Patch Set 3: Code-Review+1\n\n(1 comment)"},{"timestamp":1530128633,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 3: Code-Review+1 Integration-Approval+1"},{"timestamp":1530131778,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 4."},{"timestamp":1530131805,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1530132723,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"Patch Set 4: Code-Review+1"},{"timestamp":1530201364,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 4: Code-Review+1 Integration-Approval+1"},{"timestamp":1530622455,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Rui"}],"currentPatchSet":{"number":"4","revision":"cabef4d095dec75e85eb4ae7e5f124179ff8fd44","parents":["94f465008b300752eb1b72585edb267139ea723f"],"ref":"refs/changes/86/4186/4","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1530131778,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1530131805,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1530132723,"by":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1530201364,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1530201364,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"SUBM","value":"1","grantedOn":1530622455,"by":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"muppet.js","type":"MODIFIED","insertions":23,"deletions":-11},{"file":"sapi_manifests/muppet/template","type":"MODIFIED","insertions":2,"deletions":0}],"sizeInsertions":25,"sizeDeletions":-11},"patchSets":[{"number":"1","revision":"8a50137af0ceaaffee1f85ba61f51e499fac1c66","parents":["a7f8c4a86109e94cd361b012aaef614d4a14b931"],"ref":"refs/changes/86/4186/1","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1528829388,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1528910463,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1528829414,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1528908612,"by":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"}}],"comments":[{"file":"muppet.js","line":63,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Nitty, but what would you think about writing this as:\n\n    if (ip \u003d\u003d\u003d cfg.adminIP \u0026\u0026 ip \u003d\u003d\u003d cfg.trustedIP) {\n        return;\n    }\n\n    if (net.isIPv4(ip) || net.isIPv6(ip)) {\n        cfg.untrustedIPs.push(ip);\n    }"},{"file":"muppet.js","line":63,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"(Sorry, that should \"|| ip \u003d\u003d\u003d cfg.trustedIP\")"},{"file":"muppet.js","line":63,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"That\u0027s fair.\n\nI\u0027ve actually been thinking about this a bit more.  I wonder if we want to skip the entire nic if any of it\u0027s IPs match the admin or trusted IP.\n\n if (nic.ips.indexOf(cfg.adminIP) !\u003d\u003d -1 || nic.ips.indexOf(cfg.trustedIP) !\u003d\u003d -1){\n     continue;\n }"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"muppet.js","type":"MODIFIED","insertions":12,"deletions":-13},{"file":"sapi_manifests/muppet/template","type":"MODIFIED","insertions":1,"deletions":0}],"sizeInsertions":13,"sizeDeletions":-13},{"number":"2","revision":"60de181a6ce0c84cb423eb98882cd652babede17","parents":["a7f8c4a86109e94cd361b012aaef614d4a14b931"],"ref":"refs/changes/86/4186/2","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1529008592,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1529008630,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"muppet.js","type":"MODIFIED","insertions":12,"deletions":-13},{"file":"sapi_manifests/muppet/template","type":"MODIFIED","insertions":2,"deletions":0}],"sizeInsertions":14,"sizeDeletions":-13},{"number":"3","revision":"1dc3100d97cc015f8bff165af9037aa96ac7d25b","parents":["a7f8c4a86109e94cd361b012aaef614d4a14b931"],"ref":"refs/changes/86/4186/3","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1529076406,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1530128633,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1530128633,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1529076432,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1530114816,"by":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"}}],"comments":[{"file":"muppet.js","line":63,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"We should assert that cfg.adminIPS is a string above this.  `indexOf()` will throw on a non-string"},{"file":"muppet.js","line":63,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"It should be an array.  See line 144."},{"file":"muppet.js","line":63,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"Sorry, yes.  We need to assert that fact before calling indexOf on it."},{"file":"muppet.js","line":63,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"We talked about this in chat, forcing an assert with more nesting would make for needlessly ugly code that would still crash if adminIPS is not an array."},{"file":"muppet.js","line":64,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"Same as above, will need to assert on `cfg.mantaIPS` above this"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"muppet.js","type":"MODIFIED","insertions":23,"deletions":-11},{"file":"sapi_manifests/muppet/template","type":"MODIFIED","insertions":2,"deletions":0}],"sizeInsertions":25,"sizeDeletions":-11},{"number":"4","revision":"cabef4d095dec75e85eb4ae7e5f124179ff8fd44","parents":["94f465008b300752eb1b72585edb267139ea723f"],"ref":"refs/changes/86/4186/4","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1530131778,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1530201364,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1530201364,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1530131805,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1530132723,"by":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"}},{"type":"SUBM","value":"1","grantedOn":1530622455,"by":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"muppet.js","type":"MODIFIED","insertions":23,"deletions":-11},{"file":"sapi_manifests/muppet/template","type":"MODIFIED","insertions":2,"deletions":0}],"sizeInsertions":25,"sizeDeletions":-11}],"allReviewers":[{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"}]}