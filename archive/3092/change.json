{"project":"joyent/moray","branch":"master","id":"Ie25b62617653eb8d85ebed932cf22854b44ff9ea","number":"3092","subject":"MANTA-3233 Undeploy without disruption - moray","owner":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"url":"https://cr.joyent.us/3092","commitMessage":"MANTA-3233 Undeploy without disruption - moray\n","createdOn":1513037843,"lastUpdated":1513368094,"open":true,"status":"NEW","comments":[{"timestamp":1513037843,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Uploaded patch set 1."},{"timestamp":1513037868,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1513041082,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 1:\n\n(4 comments)"},{"timestamp":1513101304,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Uploaded patch set 2."},{"timestamp":1513101331,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1513101608,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Uploaded patch set 3."},{"timestamp":1513101627,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Patch Set 3:\n\n(3 comments)"},{"timestamp":1513101633,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing-1\n\n(2 comments)\n\n\"make check\" exited with status 2"},{"timestamp":1513365768,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Uploaded patch set 4."},{"timestamp":1513365795,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1513368094,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 4:\n\n(1 comment)"}],"currentPatchSet":{"number":"4","revision":"e25b62617653eb8d85ebed932cf22854b44ff9ea","parents":["f761c3764f3c9079bc4259a7ec4e904ca94adc75"],"ref":"refs/changes/92/3092/4","uploader":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"createdOn":1513365768,"author":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1513365795,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/server.js","line":217,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Thinking about this some more, I think that it would be good to do this in main.js instead, when the \"listening\" event fires. When that happens, we can then call a server.quiesce() method which will kick everything off. This will be friendlier to consumers who use Moray as an embedded library, so that we\u0027re not registering a SIGTERM handler in their process, and they can choose when to call .quiesce() themselves."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/server.js","type":"MODIFIED","insertions":66,"deletions":0},{"file":"smf/manifests/moray.xml.in","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":68,"sizeDeletions":-2},"patchSets":[{"number":"1","revision":"31177ee37fadf410b1acf6fb30b67720809a4365","parents":["f761c3764f3c9079bc4259a7ec4e904ca94adc75"],"ref":"refs/changes/92/3092/1","uploader":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"createdOn":1513037843,"author":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1513037868,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/server.js","line":336,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Just \"Moray\" here and below."},{"file":"lib/server.js","line":336,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"yep. I copied this verbatim from electric-moray.\n\nfixed."},{"file":"lib/server.js","line":353,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"I think this would be better off as a method on the MorayServer object."},{"file":"lib/server.js","line":365,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Should we wait to close the monitoring server? If a server\u0027s stuck quiescing, this\u0027ll allow us to poke at it."},{"file":"lib/server.js","line":365,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"good point.\n\nmoved.\n\nalso ported your comment to the electric moray CR: https://cr.joyent.us/#/c/2932/"},{"file":"lib/server.js","line":383,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"It seems like we should be able to just call MorayServer.close() once we get here."},{"file":"lib/server.js","line":383,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"yep. that is certainly cleaner than this. fixed."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/server.js","type":"MODIFIED","insertions":82,"deletions":0},{"file":"smf/manifests/moray.xml.in","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":84,"sizeDeletions":-2},{"number":"2","revision":"ea6e6eea553f78db75ad13e2e6f466c3bbe25c87","parents":["f761c3764f3c9079bc4259a7ec4e904ca94adc75"],"ref":"refs/changes/92/3092/2","uploader":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"createdOn":1513101304,"author":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1513101331,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/server.js","type":"MODIFIED","insertions":82,"deletions":0},{"file":"smf/manifests/moray.xml.in","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":84,"sizeDeletions":-2},{"number":"3","revision":"bd9ed484f132b27e2180b47df34f4c8457997a21","parents":["f761c3764f3c9079bc4259a7ec4e904ca94adc75"],"ref":"refs/changes/92/3092/3","uploader":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"createdOn":1513101608,"author":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1513101633,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/server.js","line":366,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"warning: undeclared identifier: server"},{"file":"lib/server.js","line":367,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"warning: undeclared identifier: server"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/server.js","type":"MODIFIED","insertions":66,"deletions":0},{"file":"smf/manifests/moray.xml.in","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":68,"sizeDeletions":-2},{"number":"4","revision":"e25b62617653eb8d85ebed932cf22854b44ff9ea","parents":["f761c3764f3c9079bc4259a7ec4e904ca94adc75"],"ref":"refs/changes/92/3092/4","uploader":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"createdOn":1513365768,"author":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1513365795,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/server.js","line":217,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Thinking about this some more, I think that it would be good to do this in main.js instead, when the \"listening\" event fires. When that happens, we can then call a server.quiesce() method which will kick everything off. This will be friendlier to consumers who use Moray as an embedded library, so that we\u0027re not registering a SIGTERM handler in their process, and they can choose when to call .quiesce() themselves."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/server.js","type":"MODIFIED","insertions":66,"deletions":0},{"file":"smf/manifests/moray.xml.in","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":68,"sizeDeletions":-2}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"}]}