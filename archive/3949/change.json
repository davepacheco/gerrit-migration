{"project":"joyent/smartos-live","branch":"master","id":"Idf855fab93f2838166e35838f9224a6bc5a6b9e8","number":"3949","subject":"OS-6921 vmadm reboot can leave bhyve VMs in stopped state Reviewed by: Josh Wilsdon \u003cjosh@wilsdon.ca\u003e Reviewed by: Dave Eddy \u003cdave.eddy@joyent.com\u003e Approved by: Dave Eddy \u003cdave.eddy@joyent.com\u003e","owner":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"url":"https://cr.joyent.us/3949","commitMessage":"OS-6921 vmadm reboot can leave bhyve VMs in stopped state\nReviewed by: Josh Wilsdon \u003cjosh@wilsdon.ca\u003e\nReviewed by: Dave Eddy \u003cdave.eddy@joyent.com\u003e\nApproved by: Dave Eddy \u003cdave.eddy@joyent.com\u003e\n","createdOn":1526308777,"lastUpdated":1526656414,"open":false,"status":"MERGED","comments":[{"timestamp":1526308777,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Uploaded patch set 1."},{"timestamp":1526308780,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit d4bd9e6601511810c6a0fa6c63aa34cc15f31863\n    \n    m\n    \n    commit abbb32c9e0b0b717fca38b027b7a186504ddaaa2\n    \n    m\n    \n    commit d96936b19f00133c21b293e620e0ffb633aecf3e\n    \n    m"},{"timestamp":1526308824,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1526308867,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 1: Code-Review-1"},{"timestamp":1526473283,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Uploaded patch set 2."},{"timestamp":1526473287,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit 18b3c2e3c7192c90e6042b0c05fe9a6fb2669fec\n    \n    m\n    \n    commit b6d46c0613c79364ca0c9b9ca73ad8775b75936e\n    \n    m\n    \n    commit 11c207c5a43ff32c56b9940e2773ce0922663f0a\n    \n    m\n    \n    commit ba0ed4389efcfbbbe67cc86eba22d0024bc68e5e\n    \n    m\n    \n    commit 5cac7c028b5ac1eabd01493ae3875ff111da7368\n    \n    m\n    \n    commit f8cddc31f3db7d76419ed8a3a12ced186ebe114e\n    \n    m"},{"timestamp":1526473331,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1526473427,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Uploaded patch set 3."},{"timestamp":1526473430,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 3:\n\nNew commits:\n    \n    commit e0b36dbf2e97e8dde3f0267cf61b56be9aa79cff\n    \n    m"},{"timestamp":1526473474,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1526474874,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 3: -Code-Review"},{"timestamp":1526474885,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Uploaded patch set 4."},{"timestamp":1526474889,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 4:\n\nNew commits:\n    \n    commit fe54dca0b16f9c78c774f5c8e45d838316b66758\n    \n    m"},{"timestamp":1526474933,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1526501371,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 4: Code-Review+1\n\n(2 comments)\n\nThe code itself looks good to me - just a few nits.  Also, have you done any testing with this change in place? Can you add any notes re: testing to the ticket?"},{"timestamp":1526507027,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Uploaded patch set 5."},{"timestamp":1526507030,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 5:\n\nNew commits:\n    \n    commit 20c339a466013eeff6bb7f4ba6f8f3fc01102d14\n    \n    m"},{"timestamp":1526507075,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1526507253,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 5:\n\n(2 comments)\n\nUpdated ticket with testing notes"},{"timestamp":1526578656,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 5: Code-Review+1\n\n(2 comments)"},{"timestamp":1526579092,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Uploaded patch set 6."},{"timestamp":1526579096,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 6:\n\nNew commits:\n    \n    commit a9f80e5d2fb78fd5999b4f1640ad31c0d87e26f6\n    \n    m"},{"timestamp":1526579140,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 6: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1526579919,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 6: Code-Review+1\n\nlgtm."},{"timestamp":1526656089,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 6: Code-Review+1 Integration-Approval+1\n\nthanks!"},{"timestamp":1526656280,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Uploaded patch set 7: Commit message was updated."},{"timestamp":1526656345,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 8: Patch Set 7 was rebased"},{"timestamp":1526656392,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 8:\n\n\"make check\" passed ok"},{"timestamp":1526656414,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by John Levon"}],"currentPatchSet":{"number":"8","revision":"b71f2bdd4e3145c4ccc3c22eb4a9191ef6a669d2","parents":["bf116697c55c7c6a199782252f179f90b34a7072"],"ref":"refs/changes/49/3949/8","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1526656345,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1526579140,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1526579919,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1526656089,"by":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1526656089,"by":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"}},{"type":"SUBM","value":"1","grantedOn":1526656414,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"src/vm/node_modules/VM.js","type":"MODIFIED","insertions":37,"deletions":-50}],"sizeInsertions":37,"sizeDeletions":-50},"patchSets":[{"number":"1","revision":"92b2908871174eeca96843f9941857f83b247259","parents":["be4b170210560c939e3e09aafa61b0a771d39e7f"],"ref":"refs/changes/49/3949/1","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1526308777,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1526308824,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"-1","grantedOn":1526308867,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/vm/node_modules/VM.js","type":"MODIFIED","insertions":47,"deletions":-53},{"file":"src/vm/node_modules/vasync/lib/vasync.js","type":"MODIFIED","insertions":75,"deletions":-1},{"file":"src/vm/node_modules/vasync/package.json","type":"MODIFIED","insertions":22,"deletions":-33}],"sizeInsertions":144,"sizeDeletions":-87},{"number":"2","revision":"bc418d40813727e3058b01b4c93007b3311b7949","parents":["59b5c9a875b82bd49890a7e33fc81f0c93449e8e"],"ref":"refs/changes/49/3949/2","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1526473283,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1526473331,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"-1","grantedOn":1526308867,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/vm/node_modules/VM.js","type":"MODIFIED","insertions":33,"deletions":-49},{"file":"src/vm/node_modules/forkexec/.npmignore","type":"ADDED","insertions":4,"deletions":0},{"file":"src/vm/node_modules/forkexec/CHANGES.md","type":"ADDED","insertions":20,"deletions":0},{"file":"src/vm/node_modules/forkexec/LICENSE","type":"ADDED","insertions":19,"deletions":0},{"file":"src/vm/node_modules/forkexec/README.md","type":"ADDED","insertions":294,"deletions":0},{"file":"src/vm/node_modules/forkexec/lib/forkexec.js","type":"ADDED","insertions":165,"deletions":0},{"file":"src/vm/node_modules/forkexec/package.json","type":"ADDED","insertions":91,"deletions":0},{"file":"src/vm/node_modules/vasync/lib/vasync.js","type":"MODIFIED","insertions":75,"deletions":-1},{"file":"src/vm/node_modules/vasync/package.json","type":"MODIFIED","insertions":22,"deletions":-33}],"sizeInsertions":723,"sizeDeletions":-83},{"number":"3","revision":"a23085b78ea4f856cd834fa018126398b49bbb45","parents":["59b5c9a875b82bd49890a7e33fc81f0c93449e8e"],"ref":"refs/changes/49/3949/3","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1526473427,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1526473474,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/vm/node_modules/VM.js","type":"MODIFIED","insertions":33,"deletions":-49}],"sizeInsertions":33,"sizeDeletions":-49},{"number":"4","revision":"d6178fc1af5eff0bc005fad65896d50c8f769ada","parents":["59b5c9a875b82bd49890a7e33fc81f0c93449e8e"],"ref":"refs/changes/49/3949/4","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1526474885,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1526474933,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1526501371,"by":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"}}],"comments":[{"file":"src/vm/node_modules/VM.js","line":14115,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"below this line assert the type of cb\n\n\n assert.optionalFunc(cb, \u0027cb\u0027);"},{"file":"src/vm/node_modules/VM.js","line":14115,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"OK"},{"file":"src/vm/node_modules/VM.js","line":14122,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"nit: in the style of the project, if (cb) should always have curly brackets. e.g.:\n\n    if (cb) {\n        cb();\n    }"},{"file":"src/vm/node_modules/VM.js","line":14131,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"same nit as above."},{"file":"src/vm/node_modules/VM.js","line":14134,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"nit: This logic is a bit confusing at first glance.  I realize now it shouldn\u0027t be possible to ever arrive below this if statement block, but could you possibly throw an assert down here just to ensure we never reach this?  Something like...\n\n\n assert(false, \u0027should not be reached\u0027);"},{"file":"src/vm/node_modules/VM.js","line":14134,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"wasn\u0027t my code, but I just removed the returns altogether."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/vm/node_modules/VM.js","type":"MODIFIED","insertions":33,"deletions":-48}],"sizeInsertions":33,"sizeDeletions":-48},{"number":"5","revision":"5e142793466dbd246d68337456bf009c4ab1ce5b","parents":["59b5c9a875b82bd49890a7e33fc81f0c93449e8e"],"ref":"refs/changes/49/3949/5","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1526507027,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1526507075,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1526578656,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"src/vm/node_modules/VM.js","type":"MODIFIED","insertions":35,"deletions":-50}],"sizeInsertions":35,"sizeDeletions":-50},{"number":"6","revision":"929d2829e1590056642cb535314f81e9ae8da011","parents":["59b5c9a875b82bd49890a7e33fc81f0c93449e8e"],"ref":"refs/changes/49/3949/6","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1526579092,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1526579140,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1526579919,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1526656089,"by":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1526656089,"by":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"src/vm/node_modules/VM.js","type":"MODIFIED","insertions":37,"deletions":-50}],"sizeInsertions":37,"sizeDeletions":-50},{"number":"7","revision":"df855fab93f2838166e35838f9224a6bc5a6b9e8","parents":["59b5c9a875b82bd49890a7e33fc81f0c93449e8e"],"ref":"refs/changes/49/3949/7","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1526656280,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1526579140,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1526579919,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1526656089,"by":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1526656089,"by":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"src/vm/node_modules/VM.js","type":"MODIFIED","insertions":37,"deletions":-50}],"sizeInsertions":37,"sizeDeletions":-50},{"number":"8","revision":"b71f2bdd4e3145c4ccc3c22eb4a9191ef6a669d2","parents":["bf116697c55c7c6a199782252f179f90b34a7072"],"ref":"refs/changes/49/3949/8","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1526656345,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1526579140,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1526579919,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1526656089,"by":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1526656089,"by":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"}},{"type":"SUBM","value":"1","grantedOn":1526656414,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"src/vm/node_modules/VM.js","type":"MODIFIED","insertions":37,"deletions":-50}],"sizeInsertions":37,"sizeDeletions":-50}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}]}