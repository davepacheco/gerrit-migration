{"project":"joyent/illumos-joyent","branch":"master","id":"Ia5fdd1b56caa1353ecd2d0ada557c6f8085698c5","number":"5045","subject":"OS-7066 Want support ahci LED entries in topo Reviewed by: Rob Johnston \u003crob.johnston@joyent.com\u003e Reviewed by: Robert Mustacchi \u003crm@joyent.com\u003e Approved by: Robert Mustacchi \u003crm@joyent.com\u003e","owner":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"url":"https://cr.joyent.us/5045","commitMessage":"OS-7066 Want support ahci LED entries in topo\nReviewed by: Rob Johnston \u003crob.johnston@joyent.com\u003e\nReviewed by: Robert Mustacchi \u003crm@joyent.com\u003e\nApproved by: Robert Mustacchi \u003crm@joyent.com\u003e\n","createdOn":1541793640,"lastUpdated":1543862341,"open":false,"status":"MERGED","comments":[{"timestamp":1541793640,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Uploaded patch set 1."},{"timestamp":1541799741,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Uploaded patch set 2."},{"timestamp":1541806355,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Uploaded patch set 3."},{"timestamp":1541807896,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Uploaded patch set 4."},{"timestamp":1541808850,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 3:\n\n(22 comments)"},{"timestamp":1542250297,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Uploaded patch set 5."},{"timestamp":1542250432,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Patch Set 5:\n\n(21 comments)\n\nIn PS 5, I\u0027ve addressed the feedback so far. I also included the necessary changes for SMCI,SSG-2029P-ACR24L/SSG-2029P-ACR24L-disk-hc-topology.xmlgenksh and a fix for the AHCI_EM_IOC_SET_OP_{ADD,REM} commands in the ioctl API."},{"timestamp":1542320185,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 5:\n\n(4 comments)\n\nIn general, the clean up all looks good. I just have a few minor notes here."},{"timestamp":1542326073,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Uploaded patch set 6."},{"timestamp":1542326161,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Patch Set 6:\n\n(4 comments)"},{"timestamp":1542467953,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 6: Code-Review+1\n\n(1 comment)"},{"timestamp":1543449385,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Patch Set 6:\n\n(2 comments)\n\nOverall this looks really good. Just one nit and one minor issue."},{"timestamp":1543536143,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Uploaded patch set 7."},{"timestamp":1543536163,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Patch Set 6:\n\n(2 comments)\n\nThanks for the review, Rob!"},{"timestamp":1543536691,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Patch Set 7: Code-Review+1"},{"timestamp":1543536822,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 7: Code-Review+1"},{"timestamp":1543620648,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 7: Integration-Approval+1"},{"timestamp":1543861857,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Uploaded patch set 8: Patch Set 7 was rebased."},{"timestamp":1543862065,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Uploaded patch set 9: Commit message was updated."},{"timestamp":1543862341,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Jordan Hendricks"}],"currentPatchSet":{"number":"9","revision":"a5fdd1b56caa1353ecd2d0ada557c6f8085698c5","parents":["24342c22e832a4033a4bf0fe798a9219ea591bc9"],"ref":"refs/changes/45/5045/9","uploader":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"createdOn":1543862065,"author":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1543536691,"by":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1543536822,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1543620648,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"SUBM","value":"1","grantedOn":1543862341,"by":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_hc.h","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/lib/fm/topo/maps/SMCI,SSG-2029P-ACR24L/SSG-2029P-ACR24L-disk-hc-topology.xmlgenksh","type":"MODIFIED","insertions":23,"deletions":0},{"file":"usr/src/lib/fm/topo/modules/common/Makefile","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/lib/fm/topo/modules/common/fac_prov_ahci/Makefile","type":"ADDED","insertions":23,"deletions":0},{"file":"usr/src/lib/fm/topo/modules/common/fac_prov_ahci/fac_prov_ahci.c","type":"ADDED","insertions":287,"deletions":0},{"file":"usr/src/uts/common/io/sata/adapters/ahci/ahci.c","type":"MODIFIED","insertions":1,"deletions":-2}],"sizeInsertions":337,"sizeDeletions":-2},"patchSets":[{"number":"1","revision":"2cf9356acbafe4483882e7be38d70fa7f74b3297","parents":["2bf1a940afbd1382faff159e7c93c72779ca10f4"],"ref":"refs/changes/45/5045/1","uploader":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"createdOn":1541793640,"author":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_hc.h","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/lib/fm/topo/maps/SMCI,SSG-2029P-ACR24L/SSG-2029P-ACR24L-disk-hc-topology.xmlgenksh","type":"MODIFIED","insertions":19,"deletions":0},{"file":"usr/src/lib/fm/topo/modules/common/Makefile","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/lib/fm/topo/modules/common/fac_prov_ahci/Makefile","type":"ADDED","insertions":23,"deletions":0},{"file":"usr/src/lib/fm/topo/modules/common/fac_prov_ahci/fac_prov_ahci.c","type":"ADDED","insertions":270,"deletions":0}],"sizeInsertions":315,"sizeDeletions":0},{"number":"2","revision":"963183ebf0973e782c543f423889bd9397b6f86a","parents":["2bf1a940afbd1382faff159e7c93c72779ca10f4"],"ref":"refs/changes/45/5045/2","uploader":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"createdOn":1541799741,"author":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_hc.h","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/lib/fm/topo/maps/SMCI,SSG-2029P-ACR24L/SSG-2029P-ACR24L-disk-hc-topology.xmlgenksh","type":"MODIFIED","insertions":19,"deletions":0},{"file":"usr/src/lib/fm/topo/modules/common/Makefile","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/lib/fm/topo/modules/common/fac_prov_ahci/Makefile","type":"ADDED","insertions":23,"deletions":0},{"file":"usr/src/lib/fm/topo/modules/common/fac_prov_ahci/fac_prov_ahci.c","type":"ADDED","insertions":274,"deletions":0}],"sizeInsertions":321,"sizeDeletions":-2},{"number":"3","revision":"e462bb7ecf278c6287ab83b8419d7d47cb07a718","parents":["2bf1a940afbd1382faff159e7c93c72779ca10f4"],"ref":"refs/changes/45/5045/3","uploader":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"createdOn":1541806355,"author":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/lib/fm/topo/maps/SMCI,SSG-2029P-ACR24L/SSG-2029P-ACR24L-disk-hc-topology.xmlgenksh","line":100,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Probably want to indent it to match propgroup, as the facility is a child of node."},{"file":"usr/src/lib/fm/topo/maps/SMCI,SSG-2029P-ACR24L/SSG-2029P-ACR24L-disk-hc-topology.xmlgenksh","line":100,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"usr/src/lib/fm/topo/modules/common/fac_prov_ahci/Makefile","line":13,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Should be \u0027Joyent, Inc.\u0027"},{"file":"usr/src/lib/fm/topo/modules/common/fac_prov_ahci/Makefile","line":13,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"usr/src/lib/fm/topo/modules/common/fac_prov_ahci/fac_prov_ahci.c","line":38,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"This is a very \u0027me\u0027 thing and not something you need to change, since both ways are totally fine. I personally like building things up such that I can avoid statics which means that all the definitions like the modops and the modinfo are at the end and basically things are in dependency order. On the other hand, I know someone like Clulow prefers the exact oposite order. There\u0027s no real better way, just whatever better mirrors how you think. I don\u0027t think you should change anything but wanted to mention it just in case."},{"file":"usr/src/lib/fm/topo/modules/common/fac_prov_ahci/fac_prov_ahci.c","line":47,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Any reason this isn\u0027t static?"},{"file":"usr/src/lib/fm/topo/modules/common/fac_prov_ahci/fac_prov_ahci.c","line":47,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"usr/src/lib/fm/topo/modules/common/fac_prov_ahci/fac_prov_ahci.c","line":49,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Any reason this isn\u0027t static?"},{"file":"usr/src/lib/fm/topo/modules/common/fac_prov_ahci/fac_prov_ahci.c","line":49,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"usr/src/lib/fm/topo/modules/common/fac_prov_ahci/fac_prov_ahci.c","line":87,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Is there a reason that you\u0027re trying to preserve errno across the topo_mod_dprintf call as the caller doesn\u0027t do anything with the value of errno here."},{"file":"usr/src/lib/fm/topo/modules/common/fac_prov_ahci/fac_prov_ahci.c","line":87,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"usr/src/lib/fm/topo/modules/common/fac_prov_ahci/fac_prov_ahci.c","line":102,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"This should be an explicit comparison. Also, I think you want to compare it to -1. Technically, an ioctl can return any non-negative value it wants on success."},{"file":"usr/src/lib/fm/topo/modules/common/fac_prov_ahci/fac_prov_ahci.c","line":102,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"usr/src/lib/fm/topo/modules/common/fac_prov_ahci/fac_prov_ahci.c","line":103,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"See previous question about errno."},{"file":"usr/src/lib/fm/topo/modules/common/fac_prov_ahci/fac_prov_ahci.c","line":103,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"usr/src/lib/fm/topo/modules/common/fac_prov_ahci/fac_prov_ahci.c","line":126,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"This returns without having called close on fd."},{"file":"usr/src/lib/fm/topo/modules/common/fac_prov_ahci/fac_prov_ahci.c","line":126,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"usr/src/lib/fm/topo/modules/common/fac_prov_ahci/fac_prov_ahci.c","line":140,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"The ioctl API offers two additional commands: AHCI_EM_IOC_SET_OP_ADD and AHCI_EM_IOC_SET_OP_REM. I added them to make this code easier as they allow you to logically add or remove a single LED state without having to worry about the existing state at all. I\u0027d recommend using them so that you don\u0027t have to worry at all about getting the original state, which might simplify this function a bit."},{"file":"usr/src/lib/fm/topo/modules/common/fac_prov_ahci/fac_prov_ahci.c","line":140,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"usr/src/lib/fm/topo/modules/common/fac_prov_ahci/fac_prov_ahci.c","line":142,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Unchecked return value."},{"file":"usr/src/lib/fm/topo/modules/common/fac_prov_ahci/fac_prov_ahci.c","line":142,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"usr/src/lib/fm/topo/modules/common/fac_prov_ahci/fac_prov_ahci.c","line":159,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Returns without having called close on fd."},{"file":"usr/src/lib/fm/topo/modules/common/fac_prov_ahci/fac_prov_ahci.c","line":159,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"usr/src/lib/fm/topo/modules/common/fac_prov_ahci/fac_prov_ahci.c","line":162,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Make sure you have an explicit comparison, e.g. !\u003d 0."},{"file":"usr/src/lib/fm/topo/modules/common/fac_prov_ahci/fac_prov_ahci.c","line":162,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"usr/src/lib/fm/topo/modules/common/fac_prov_ahci/fac_prov_ahci.c","line":164,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"If you reach this point, you\u0027ll return without having called close on the fd you opened. You may want to actually have a label that everything goes to and initial fd to -1 and always close fd if it\u0027s \u003e\u003d 0."},{"file":"usr/src/lib/fm/topo/modules/common/fac_prov_ahci/fac_prov_ahci.c","line":164,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"usr/src/lib/fm/topo/modules/common/fac_prov_ahci/fac_prov_ahci.c","line":165,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Is there a reason you\u0027re explicitly clearing errno here?"},{"file":"usr/src/lib/fm/topo/modules/common/fac_prov_ahci/fac_prov_ahci.c","line":165,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"usr/src/lib/fm/topo/modules/common/fac_prov_ahci/fac_prov_ahci.c","line":192,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Are you sure that\u0027s true? We are told by the controller whether or not the activity LED is controlled in the ahci specification. Specifically there\u0027s the flag in bit 26 of the EM_CTL register - ATTR.ALHD that describes whether or not we can control it. So we actually know this programatically."},{"file":"usr/src/lib/fm/topo/modules/common/fac_prov_ahci/fac_prov_ahci.c","line":192,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"I deleted that sentence. Let me know if you want me to add back in anything else."},{"file":"usr/src/lib/fm/topo/modules/common/fac_prov_ahci/fac_prov_ahci.c","line":196,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Any particular reason you don\u0027t just pass the type that we have in versus convert it? Either way is fine."},{"file":"usr/src/lib/fm/topo/modules/common/fac_prov_ahci/fac_prov_ahci.c","line":196,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"I added a comment to the typedef. Feel free to let me know if you want anything reworded/clarified."},{"file":"usr/src/lib/fm/topo/modules/common/fac_prov_ahci/fac_prov_ahci.c","line":212,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Where possible, we try to have the trailing \u0027 \u0027 character at the end of the line to act as the continuation."},{"file":"usr/src/lib/fm/topo/modules/common/fac_prov_ahci/fac_prov_ahci.c","line":212,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"usr/src/lib/fm/topo/modules/common/fac_prov_ahci/fac_prov_ahci.c","line":225,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Double check your parens. Technically you need to make sure that you have a paren around the assignment as the !\u003d has higher precedence than the \u003d. We should do a full build with the gcc7 shadow which may or may not catch this."},{"file":"usr/src/lib/fm/topo/modules/common/fac_prov_ahci/fac_prov_ahci.c","line":225,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"usr/src/lib/fm/topo/modules/common/fac_prov_ahci/fac_prov_ahci.c","line":243,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"do_led_control will return -1 which topo will use to know that an error occurred. However, the topo errno will not be set. As it\u0027s a distinct thing from errno. I suspect you want to either call topo_mod_seterrno at all the different places in do_led_control or use a generic failure topo error here."},{"file":"usr/src/lib/fm/topo/modules/common/fac_prov_ahci/fac_prov_ahci.c","line":243,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"usr/src/lib/fm/topo/modules/common/fac_prov_ahci/fac_prov_ahci.c","line":245,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"If do_led_control fails, do we actually want to construct this output nvlist?"},{"file":"usr/src/lib/fm/topo/modules/common/fac_prov_ahci/fac_prov_ahci.c","line":245,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"usr/src/lib/fm/topo/modules/common/fac_prov_ahci/fac_prov_ahci.c","line":275,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"This is minor, but when I have an explicit hex value I sometimes try to go back and add the 0x to it so that way when I see something like 11 I know it\u0027s 0x11 and not 0t11."},{"file":"usr/src/lib/fm/topo/modules/common/fac_prov_ahci/fac_prov_ahci.c","line":275,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_hc.h","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/lib/fm/topo/maps/SMCI,SSG-2029P-ACR24L/SSG-2029P-ACR24L-disk-hc-topology.xmlgenksh","type":"MODIFIED","insertions":19,"deletions":0},{"file":"usr/src/lib/fm/topo/modules/common/Makefile","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/lib/fm/topo/modules/common/fac_prov_ahci/Makefile","type":"ADDED","insertions":23,"deletions":0},{"file":"usr/src/lib/fm/topo/modules/common/fac_prov_ahci/fac_prov_ahci.c","type":"ADDED","insertions":278,"deletions":0}],"sizeInsertions":325,"sizeDeletions":-2},{"number":"4","revision":"4cd2c35df6e2a81c7698a03041bae2223db97321","parents":["2bf1a940afbd1382faff159e7c93c72779ca10f4"],"ref":"refs/changes/45/5045/4","uploader":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"createdOn":1541807896,"author":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_hc.h","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/lib/fm/topo/maps/SMCI,SSG-2029P-ACR24L/SSG-2029P-ACR24L-disk-hc-topology.xmlgenksh","type":"MODIFIED","insertions":19,"deletions":0},{"file":"usr/src/lib/fm/topo/modules/common/Makefile","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/lib/fm/topo/modules/common/fac_prov_ahci/Makefile","type":"ADDED","insertions":23,"deletions":0},{"file":"usr/src/lib/fm/topo/modules/common/fac_prov_ahci/fac_prov_ahci.c","type":"ADDED","insertions":278,"deletions":0}],"sizeInsertions":325,"sizeDeletions":-2},{"number":"5","revision":"41d00a5c333459d4d2e8541432a3a9019fe0390f","parents":["2bf1a940afbd1382faff159e7c93c72779ca10f4"],"ref":"refs/changes/45/5045/5","uploader":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"createdOn":1542250297,"author":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/lib/fm/topo/modules/common/fac_prov_ahci/fac_prov_ahci.c","line":84,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I\u0027d recommend making this const here if you can. I know that the caller can\u0027t have it be const, but since there\u0027s no reason for this function to modify the devctl path, we should be ok making it const."},{"file":"usr/src/lib/fm/topo/modules/common/fac_prov_ahci/fac_prov_ahci.c","line":84,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"usr/src/lib/fm/topo/modules/common/fac_prov_ahci/fac_prov_ahci.c","line":168,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"This should either be cast to (void) to indicate you are ignoring the return value or you should handle it."},{"file":"usr/src/lib/fm/topo/modules/common/fac_prov_ahci/fac_prov_ahci.c","line":168,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"usr/src/lib/fm/topo/modules/common/fac_prov_ahci/fac_prov_ahci.c","line":211,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Just a note here. It\u0027s totally fine to use the consistent goto out here; however, if there is nothing to clean up, it\u0027s equally fine to just go ahead and return. Nothing to change here."},{"file":"usr/src/lib/fm/topo/modules/common/fac_prov_ahci/fac_prov_ahci.c","line":211,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Okay, I changed it back to the way it was."},{"file":"usr/src/lib/fm/topo/modules/common/fac_prov_ahci/fac_prov_ahci.c","line":211,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Sorry, this wasn\u0027t as clear a comment as it should have been. I was referring to the entire function and use of returns. In my opinion it\u0027s better to be consistent."},{"file":"usr/src/lib/fm/topo/modules/common/fac_prov_ahci/fac_prov_ahci.c","line":219,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Looks like an extra space got added."},{"file":"usr/src/lib/fm/topo/modules/common/fac_prov_ahci/fac_prov_ahci.c","line":219,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_hc.h","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/lib/fm/topo/maps/SMCI,SSG-2029P-ACR24L/SSG-2029P-ACR24L-disk-hc-topology.xmlgenksh","type":"MODIFIED","insertions":23,"deletions":0},{"file":"usr/src/lib/fm/topo/modules/common/Makefile","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/lib/fm/topo/modules/common/fac_prov_ahci/Makefile","type":"ADDED","insertions":23,"deletions":0},{"file":"usr/src/lib/fm/topo/modules/common/fac_prov_ahci/fac_prov_ahci.c","type":"ADDED","insertions":291,"deletions":0},{"file":"usr/src/uts/common/io/sata/adapters/ahci/ahci.c","type":"MODIFIED","insertions":1,"deletions":-2}],"sizeInsertions":343,"sizeDeletions":-4},{"number":"6","revision":"39656ccedc8fe5468633d2e263ffc3d7d8dc8596","parents":["6f6fae1b433b461a7b014f48ad94fc7f4927c6ed"],"ref":"refs/changes/45/5045/6","uploader":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"createdOn":1542326073,"author":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1542467953,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}}],"comments":[{"file":"usr/src/lib/fm/topo/modules/common/fac_prov_ahci/fac_prov_ahci.c","line":88,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Just a minor thing, but you could initialize \u0027ret\u0027 to -1, so that you don\u0027t have to set it in all the error paths.\n\nOn the other hand, there\u0027s no reason to initialize \u0027fd\u0027 here."},{"file":"usr/src/lib/fm/topo/modules/common/fac_prov_ahci/fac_prov_ahci.c","line":88,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"I initialized `fd` to -1 so that I could simplify cleaning up a bit in the error path.\n\nI like your suggestion for initializing `ret` to -1, so I changed that."},{"file":"usr/src/lib/fm/topo/modules/common/fac_prov_ahci/fac_prov_ahci.c","line":271,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"topo_prop_get_string() allocates memory for the property value that the caller is responsible for free\u0027ing.\n\nSince you\u0027re initializing devctl to NULL, you can just add a call to topo_mod_strfree() here and it will ensure that devctl gets freed before the function returns, since this is the only only return path in this function after the topo_prop_get_string() call.\n\nYou can safely do that here because it\u0027s ok to pass a NULL pointer to topo_mod_strfree() - it just behaves a like a NOP in that case."},{"file":"usr/src/lib/fm/topo/modules/common/fac_prov_ahci/fac_prov_ahci.c","line":271,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_hc.h","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/lib/fm/topo/maps/SMCI,SSG-2029P-ACR24L/SSG-2029P-ACR24L-disk-hc-topology.xmlgenksh","type":"MODIFIED","insertions":23,"deletions":0},{"file":"usr/src/lib/fm/topo/modules/common/Makefile","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/lib/fm/topo/modules/common/fac_prov_ahci/Makefile","type":"ADDED","insertions":23,"deletions":0},{"file":"usr/src/lib/fm/topo/modules/common/fac_prov_ahci/fac_prov_ahci.c","type":"ADDED","insertions":291,"deletions":0},{"file":"usr/src/uts/common/io/sata/adapters/ahci/ahci.c","type":"MODIFIED","insertions":1,"deletions":-2}],"sizeInsertions":341,"sizeDeletions":-2},{"number":"7","revision":"e63d532a08bb7d192d3b5c0eaccc7e3226ee1952","parents":["6f6fae1b433b461a7b014f48ad94fc7f4927c6ed"],"ref":"refs/changes/45/5045/7","uploader":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"createdOn":1543536143,"author":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1543536822,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1543620648,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1543536691,"by":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_hc.h","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/lib/fm/topo/maps/SMCI,SSG-2029P-ACR24L/SSG-2029P-ACR24L-disk-hc-topology.xmlgenksh","type":"MODIFIED","insertions":23,"deletions":0},{"file":"usr/src/lib/fm/topo/modules/common/Makefile","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/lib/fm/topo/modules/common/fac_prov_ahci/Makefile","type":"ADDED","insertions":23,"deletions":0},{"file":"usr/src/lib/fm/topo/modules/common/fac_prov_ahci/fac_prov_ahci.c","type":"ADDED","insertions":287,"deletions":0},{"file":"usr/src/uts/common/io/sata/adapters/ahci/ahci.c","type":"MODIFIED","insertions":1,"deletions":-2}],"sizeInsertions":337,"sizeDeletions":-2},{"number":"8","revision":"a20e9d16555c8ad09d4c1a83b35b0b8d18503502","parents":["24342c22e832a4033a4bf0fe798a9219ea591bc9"],"ref":"refs/changes/45/5045/8","uploader":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"createdOn":1543861857,"author":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1543536822,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1543620648,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1543536691,"by":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_hc.h","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/lib/fm/topo/maps/SMCI,SSG-2029P-ACR24L/SSG-2029P-ACR24L-disk-hc-topology.xmlgenksh","type":"MODIFIED","insertions":23,"deletions":0},{"file":"usr/src/lib/fm/topo/modules/common/Makefile","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/lib/fm/topo/modules/common/fac_prov_ahci/Makefile","type":"ADDED","insertions":23,"deletions":0},{"file":"usr/src/lib/fm/topo/modules/common/fac_prov_ahci/fac_prov_ahci.c","type":"ADDED","insertions":287,"deletions":0},{"file":"usr/src/uts/common/io/sata/adapters/ahci/ahci.c","type":"MODIFIED","insertions":1,"deletions":-2}],"sizeInsertions":337,"sizeDeletions":-2},{"number":"9","revision":"a5fdd1b56caa1353ecd2d0ada557c6f8085698c5","parents":["24342c22e832a4033a4bf0fe798a9219ea591bc9"],"ref":"refs/changes/45/5045/9","uploader":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"createdOn":1543862065,"author":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1543536822,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1543620648,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"SUBM","value":"1","grantedOn":1543862341,"by":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1543536691,"by":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_hc.h","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/lib/fm/topo/maps/SMCI,SSG-2029P-ACR24L/SSG-2029P-ACR24L-disk-hc-topology.xmlgenksh","type":"MODIFIED","insertions":23,"deletions":0},{"file":"usr/src/lib/fm/topo/modules/common/Makefile","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/lib/fm/topo/modules/common/fac_prov_ahci/Makefile","type":"ADDED","insertions":23,"deletions":0},{"file":"usr/src/lib/fm/topo/modules/common/fac_prov_ahci/fac_prov_ahci.c","type":"ADDED","insertions":287,"deletions":0},{"file":"usr/src/uts/common/io/sata/adapters/ahci/ahci.c","type":"MODIFIED","insertions":1,"deletions":-2}],"sizeInsertions":337,"sizeDeletions":-2}],"allReviewers":[{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"}]}