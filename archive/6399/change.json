{"project":"joyent/illumos-extra","branch":"master","id":"Ie0b55e75e8d6ba3e85effe5f0dc37262245e47dc","number":"6399","subject":"OS-7823 gcc7 strap build broken by OS-7775 Reviewed by: Robert Mustacchi \u003crm@joyent.com\u003e Reviewed by: John Levon \u003cjohn.levon@joyent.com\u003e Approved by: John Levon \u003cjohn.levon@joyent.com\u003e","owner":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"url":"https://cr.joyent.us/6399","commitMessage":"OS-7823 gcc7 strap build broken by OS-7775\nReviewed by: Robert Mustacchi \u003crm@joyent.com\u003e\nReviewed by: John Levon \u003cjohn.levon@joyent.com\u003e\nApproved by: John Levon \u003cjohn.levon@joyent.com\u003e\n","createdOn":1559840890,"lastUpdated":1559854060,"open":false,"status":"MERGED","comments":[{"timestamp":1559840890,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Uploaded patch set 1."},{"timestamp":1559842774,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 1: Code-Review+1"},{"timestamp":1559846856,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Patch Set 1:\n\nTo test these changes, we did a build of the platform-debug-gcc7 Jenkins job:\n\nhttps://jenkins.joyent.us/job/platform-debug-gcc7/382/parameters/\n\nwhich succeeded.\n\nWe then did a \u0027make 0-strap-stamp\u0027 build on a multiarch\nbuild zone and a x86_64 build zone.\n\nIn each case, the strap compilers built successfully. We used\ndifferent primary vs. shadow compiler versions for each:\n\ntimf@smartos-build (master) more build.env\nFORCE_STRAP_REBUILD\u003dyes\nILLUMOS_CLOBBER\u003dyes\nILLUMOS_ENABLE_DEBUG\u003dno\nPRIMARY_COMPILER\u003dgcc4\nPRIMARY_COMPILER_VER\u003d4\nSHADOW_COMPILERS\u003dgcc7\nHOST_GCC4_PREFIX\u003d/opt/local/gcc49/bin\ntimf@smartos-build (master) tail -1 /opt/local/etc/pkgin/repositories.conf\nhttps://pkgsrc.joyent.com/packages/SmartOS/2016Q4/multiarch/All\ntimf@smartos-build (master)\n\nand\n\ntimf@smartos-build-64 (master) more build.env\nFORCE_STRAP_REBUILD\u003dyes\nILLUMOS_CLOBBER\u003dno\nILLUMOS_ENABLE_DEBUG\u003dno\nPRIMARY_COMPILER\u003dgcc7\nPRIMARY_COMPILER_VER\u003d7\nSHADOW_COMPILERS\u003dgcc4\nHOST_GCC4_PREFIX\u003d/opt/local/gcc49/bin\ntimf@smartos-build-64 (master) tail -1 /opt/local/etc/pkgin/repositories.conf\nhttps://pkgsrc.joyent.com/packages/SmartOS/2018Q4/x86_64/All\ntimf@smartos-build-64 (master)"},{"timestamp":1559847206,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 1:\n\n(2 comments)"},{"timestamp":1559847499,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 1: Code-Review+1\n\n(1 comment)"},{"timestamp":1559847997,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Patch Set 1:\n\n(1 comment)\n\nRobert suggested this was a bit hefty for a follow-up fix, so I\u0027ve filed OS-7823 to better describe this change and will update the commit message with the next patch."},{"timestamp":1559848163,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Uploaded patch set 2."},{"timestamp":1559850340,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 2: Code-Review+1"},{"timestamp":1559850407,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 2: Code-Review+1\n\n(1 comment)"},{"timestamp":1559853729,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 2: Integration-Approval+1"},{"timestamp":1559854010,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Uploaded patch set 3: Commit message was updated."},{"timestamp":1559854060,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Tim Foster"}],"currentPatchSet":{"number":"3","revision":"e0b55e75e8d6ba3e85effe5f0dc37262245e47dc","parents":["121ebcb53842496487948ee4ec34382ff0f80641"],"ref":"refs/changes/99/6399/3","uploader":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"createdOn":1559854010,"author":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1559850340,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1559850407,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1559853729,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}},{"type":"SUBM","value":"1","grantedOn":1559854060,"by":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"Makefile.gcc","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"gcc4/Makefile","type":"MODIFIED","insertions":1,"deletions":-7},{"file":"gcc7/Makefile","type":"MODIFIED","insertions":0,"deletions":-1}],"sizeInsertions":5,"sizeDeletions":-12},"patchSets":[{"number":"1","revision":"d4081c0a3013c870c7c30a12bbd7fac3c5593723","parents":["121ebcb53842496487948ee4ec34382ff0f80641"],"ref":"refs/changes/99/6399/1","uploader":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"createdOn":1559840890,"author":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1559847499,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1559842774,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"comments":[{"file":"Makefile.gcc","line":212,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Was the intent to leave this here for future debugging?"},{"file":"Makefile.gcc","line":212,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Sorry, no it wasn\u0027t intentional, though useful during debugging. If anything, that target would be more generally useful in the top level Makefile.targ, but that\u0027s not this bug. I\u0027ll remove this for now."},{"file":"Makefile.gcc","line":212,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Yeah, sounds like a great idea as something to add to the top level Makefiles."},{"file":"gcc4/Makefile","line":38,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"If we set these and then include Makefile.gcc, won\u0027t the Makefile.gcc setting override our prior setting of them here?"},{"file":"gcc4/Makefile","line":38,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"John pointed out that I misread this entirely."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile.gcc","type":"MODIFIED","insertions":7,"deletions":-4},{"file":"gcc4/Makefile","type":"MODIFIED","insertions":1,"deletions":-7},{"file":"gcc7/Makefile","type":"MODIFIED","insertions":0,"deletions":-1}],"sizeInsertions":8,"sizeDeletions":-12},{"number":"2","revision":"0a2eaf75e01ea206af658af1115f3f995fbec0f6","parents":["121ebcb53842496487948ee4ec34382ff0f80641"],"ref":"refs/changes/99/6399/2","uploader":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"createdOn":1559848163,"author":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1559850407,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1559850340,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1559853729,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile.gcc","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"gcc4/Makefile","type":"MODIFIED","insertions":1,"deletions":-7},{"file":"gcc7/Makefile","type":"MODIFIED","insertions":0,"deletions":-1}],"sizeInsertions":5,"sizeDeletions":-12},{"number":"3","revision":"e0b55e75e8d6ba3e85effe5f0dc37262245e47dc","parents":["121ebcb53842496487948ee4ec34382ff0f80641"],"ref":"refs/changes/99/6399/3","uploader":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"createdOn":1559854010,"author":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1559850407,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1559850340,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1559853729,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}},{"type":"SUBM","value":"1","grantedOn":1559854060,"by":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"Makefile.gcc","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"gcc4/Makefile","type":"MODIFIED","insertions":1,"deletions":-7},{"file":"gcc7/Makefile","type":"MODIFIED","insertions":0,"deletions":-1}],"sizeInsertions":5,"sizeDeletions":-12}],"allReviewers":[{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"}]}