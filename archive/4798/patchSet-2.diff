commit ab2de61e16a0681408838d49fb6037b19f71973b (refs/changes/98/4798/2)
Author: dyep <dyep49@gmail.com>
Date:   2018-09-06T12:51:07-07:00 (1 year, 1 month ago)
    
    OS-7220 Snapshots are not unmounted on VM pre-halt
    Reviewed by: Rob Johnston <rob.johnston@joyent.com>

diff --git a/overlay/generic/usr/lib/brand/jcommon/statechange b/overlay/generic/usr/lib/brand/jcommon/statechange
index da3bd811..58eae5ab 100644
--- a/overlay/generic/usr/lib/brand/jcommon/statechange
+++ b/overlay/generic/usr/lib/brand/jcommon/statechange
@@ -876,7 +876,7 @@ pre)
 		setup_fs
 		;;
 	4)	# pre-halt
-		[[ -n "$jst_snowsnap" ]] && cleanup_snapshots
+		[[ -n "$jst_showsnap" ]] && cleanup_snapshots
 		cleanup_net
 		;;
 	esac
