From d7d6d7145b1b7eb0a4c8b0cb82553d036774a7d7 Mon Sep 17 00:00:00 2001
From: Trent Mick <trentm@gmail.com>
Date: Tue, 14 Aug 2018 15:46:34 -0700
Subject: [PATCH] TRITON-692 updates-imgadm doesn't work with npm v5 de-duped
 node_modules layout

---
 CHANGES.md   | 5 +++++
 lib/cli.js   | 3 +--
 package.json | 3 ++-
 3 files changed, 8 insertions(+), 3 deletions(-)

diff --git a/CHANGES.md b/CHANGES.md
index 4f58fc9..9c340c2 100644
--- a/CHANGES.md
+++ b/CHANGES.md
@@ -2,6 +2,11 @@
 
 ## not yet released
 
+## 2.3.1
+
+- TRITON-692 updates-imgadm doesn't work with npm v5 de-duped `node_modules`
+  layout
+
 ## 2.3.0
 
 - TRITON-493: Add `--tree` option to sdc-imgadm et al to show origin
diff --git a/lib/cli.js b/lib/cli.js
index 2838ad2..2bdda5c 100644
--- a/lib/cli.js
+++ b/lib/cli.js
@@ -20,8 +20,7 @@ var imgapi = require('sdc-clients/lib/imgapi');
 var nopt = require('nopt');
 var path = require('path');
 var ProgressBar = require('progbar').ProgressBar;
-// Cheat to get to restify-clients, b/c we only want its Bunyan serializers.
-var restifyClients = require('sdc-clients/node_modules/restify-clients');
+var restifyClients = require('restify-clients');
 var sprintf = require('extsprintf').sprintf;
 var strsplit = require('strsplit');
 var tabula = require('tabula');
diff --git a/package.json b/package.json
index 94c31e3..7306993 100644
--- a/package.json
+++ b/package.json
@@ -1,7 +1,7 @@
 {
   "name": "imgapi-cli",
   "description": "a CLI for an Triton's IMGAPI (https://images.joyent.com/docs/)",
-  "version": "2.3.0",
+  "version": "2.3.1",
   "author": "Joyent (joyent.com)",
   "private": true,
   "dependencies": {
@@ -12,6 +12,7 @@
     "nopt": "2.0.0",
     "progbar": "1.1.1",
     "sdc-clients": "10.0.4",
+    "restify-clients": "1.6.0",
     "strsplit": "1.0.0",
     "tabula": "1.8.0",
     "vasync": "1.6.4",
-- 
2.21.0

