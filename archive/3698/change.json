{"project":"joyent/manta-mola","branch":"master","topic":"MANTA-3410","id":"I76ffd1a35b05ef47071162a7ffe932dcf8ea95fd","number":"3698","subject":"MANTA-3410 Audit job reports missing MPU parts MANTA-3608 update mola node-verror dependency MANTA-3613 update mola nodeunit dependency Reviewed by: Tim Kordas \u003ctim.kordas@joyent.com\u003e Approved by: Kelly McLaughlin \u003ckelly.mclaughlin@joyent.com\u003e","owner":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"url":"https://cr.joyent.us/3698","commitMessage":"MANTA-3410 Audit job reports missing MPU parts\nMANTA-3608 update mola node-verror dependency\nMANTA-3613 update mola nodeunit dependency\nReviewed by: Tim Kordas \u003ctim.kordas@joyent.com\u003e\nApproved by: Kelly McLaughlin \u003ckelly.mclaughlin@joyent.com\u003e\n","createdOn":1521564824,"lastUpdated":1523306600,"open":false,"status":"MERGED","comments":[{"timestamp":1521564824,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Uploaded patch set 1."},{"timestamp":1521564852,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing-1\n\n(3 comments)\n\n\"make check\" exited with status 2"},{"timestamp":1521582732,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Uploaded patch set 2."},{"timestamp":1521582760,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1522273770,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Topic set to MANTA-3410"},{"timestamp":1522273878,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Uploaded patch set 3."},{"timestamp":1522273907,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1522274046,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Patch Set 3:\n\n(1 comment)"},{"timestamp":1522274504,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Patch Set 3:\n\n(1 comment)"},{"timestamp":1522274812,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Patch Set 3:\n\n(2 comments)"},{"timestamp":1522357099,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Patch Set 3:\n\n(2 comments)"},{"timestamp":1522357600,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Uploaded patch set 4."},{"timestamp":1522357629,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing-1\n\n(1 comment)\n\n\"make check\" exited with status 2"},{"timestamp":1522357662,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Uploaded patch set 5."},{"timestamp":1522357690,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1522357721,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Patch Set 5:\n\nPS 5 addresses Tim\u0027s feedback. It is `make prepush` clean. I also re-ran the audit job using the PS 5 code to confirm it still found my missing object and also ignored MPU parts."},{"timestamp":1522358629,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Patch Set 5: Code-Review+1"},{"timestamp":1522882931,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Uploaded patch set 6."},{"timestamp":1522882959,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 6: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1522883089,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Patch Set 6:\n\nPS 6 adds some unit tests that check:\n- that MPU parts are not emitted by the auditor as problems\n- that other objects under /:uuid/uploads is not emitted by the auditor as problems\n- that paths similar to the regex the auditor whitelists *are* emitted as problems\n\nFeel free to let me know if you want additional tests added for other cases.\n\nThis PS is `make prepush` clean."},{"timestamp":1523305183,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Patch Set 6: Integration-Approval+1"},{"timestamp":1523306431,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Patch Set 6: Code-Review+1"},{"timestamp":1523306552,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Uploaded patch set 7: Commit message was updated."},{"timestamp":1523306600,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Jordan Hendricks"}],"currentPatchSet":{"number":"7","revision":"76ffd1a35b05ef47071162a7ffe932dcf8ea95fd","parents":["5b1eecc71bc92b05dd0bd43c967cfa0275cc586f"],"ref":"refs/changes/98/3698/7","uploader":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"createdOn":1523306552,"author":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1522882959,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1523305183,"by":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1523306431,"by":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"}},{"type":"SUBM","value":"1","grantedOn":1523306600,"by":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"lib/auditor.js","type":"MODIFIED","insertions":34,"deletions":-4},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/auditor.test.js","type":"MODIFIED","insertions":133,"deletions":-1}],"sizeInsertions":169,"sizeDeletions":-7},"patchSets":[{"number":"1","revision":"77159d0412b3f854e193baef284c42a414608294","parents":["5b1eecc71bc92b05dd0bd43c967cfa0275cc586f"],"ref":"refs/changes/98/3698/1","uploader":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"createdOn":1521564824,"author":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1521564852,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/auditor.js","line":19,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"line \u003e 80 characters"},{"file":"lib/auditor.js","line":25,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"indent of 4 space(s) instead of 8"},{"file":"lib/auditor.js","line":27,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"indent of 4 space(s) instead of 8"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"lib/auditor.js","type":"MODIFIED","insertions":25,"deletions":-4},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-1}],"sizeInsertions":27,"sizeDeletions":-5},{"number":"2","revision":"5db0a675b47ad5b2d6120383a93ef4ae3c0e4d00","parents":["5b1eecc71bc92b05dd0bd43c967cfa0275cc586f"],"ref":"refs/changes/98/3698/2","uploader":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"createdOn":1521582732,"author":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1521582760,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/auditor.js","line":27,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"I\u0027m surprised that we don\u0027t have this pulled out in util somewhere. Might be worth doing ?"},{"file":"lib/auditor.js","line":27,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"That\u0027s a fair point.  The reason I didn\u0027t pull it out into a constant is that I didn\u0027t want it to be consumed without understanding that it matches all children of the \u0027/:uuid/uploads/\", which is pretty liberal for a regex imo. I will probably have some merge conflicts with MANTA-3226 changes as well (waiting on IA there)."},{"file":"lib/auditor.js","line":27,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"I actually just meant the uuid portion. It seems like something useful."},{"file":"lib/auditor.js","line":27,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"I see. I can pull it out if you think I should, but I\u0027m not sure if there should be other consumers of it right now."},{"file":"lib/auditor.js","line":81,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"what happens here if parts[] doesn\u0027t have the right number of elements ? is that worth worrying about ?"},{"file":"lib/auditor.js","line":81,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"It will crash...\n\nIn general, mola isn\u0027t very good about this type of thing as it transforms Moray records into tab-separated line representations. But I can at least make it so this code doesn\u0027t crash if that happens."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"lib/auditor.js","type":"MODIFIED","insertions":32,"deletions":-4},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":33,"sizeDeletions":-5},{"number":"3","revision":"fee70e0a6baf30ee43fa3dd0fa95a3be0bad817e","parents":["5b1eecc71bc92b05dd0bd43c967cfa0275cc586f"],"ref":"refs/changes/98/3698/3","uploader":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"createdOn":1522273878,"author":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1522273907,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/auditor.js","type":"MODIFIED","insertions":32,"deletions":-4},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":34,"sizeDeletions":-6},{"number":"4","revision":"dcaee6fd0d7a9e249decea610ab40fe712f07ef5","parents":["5b1eecc71bc92b05dd0bd43c967cfa0275cc586f"],"ref":"refs/changes/98/3698/4","uploader":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"createdOn":1522357600,"author":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1522357629,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/auditor.js","line":2,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"improper block comment"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/auditor.js","type":"MODIFIED","insertions":35,"deletions":-5},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":37,"sizeDeletions":-7},{"number":"5","revision":"025203f811402af1d87e740d714511a1b9a0d099","parents":["5b1eecc71bc92b05dd0bd43c967cfa0275cc586f"],"ref":"refs/changes/98/3698/5","uploader":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"createdOn":1522357662,"author":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1522357690,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1522358629,"by":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/auditor.js","type":"MODIFIED","insertions":34,"deletions":-4},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":36,"sizeDeletions":-6},{"number":"6","revision":"3da4fe60a7a5b3133ead67461cc5f9a4c7749ca9","parents":["5b1eecc71bc92b05dd0bd43c967cfa0275cc586f"],"ref":"refs/changes/98/3698/6","uploader":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"createdOn":1522882931,"author":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1522882959,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1523305183,"by":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1523306431,"by":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/auditor.js","type":"MODIFIED","insertions":34,"deletions":-4},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/auditor.test.js","type":"MODIFIED","insertions":133,"deletions":-1}],"sizeInsertions":169,"sizeDeletions":-7},{"number":"7","revision":"76ffd1a35b05ef47071162a7ffe932dcf8ea95fd","parents":["5b1eecc71bc92b05dd0bd43c967cfa0275cc586f"],"ref":"refs/changes/98/3698/7","uploader":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"createdOn":1523306552,"author":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1522882959,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"SUBM","value":"1","grantedOn":1523306600,"by":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1523305183,"by":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1523306431,"by":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"lib/auditor.js","type":"MODIFIED","insertions":34,"deletions":-4},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/auditor.test.js","type":"MODIFIED","insertions":133,"deletions":-1}],"sizeInsertions":169,"sizeDeletions":-7}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"}]}