{"project":"joyent/illumos-joyent","branch":"master","topic":"IKEV2","id":"Idf17305b8cba08589f526f4453ba0cd2f0cfb93c","number":"3174","subject":"Review round 2","owner":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"url":"https://cr.joyent.us/3174","commitMessage":"Review round 2\n","createdOn":1515459878,"lastUpdated":1573153916,"open":false,"status":"ABANDONED","comments":[{"timestamp":1515459878,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Uploaded patch set 1."},{"timestamp":1515459892,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Topic set to IKEV2"},{"timestamp":1515461133,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Uploaded patch set 2."},{"timestamp":1515794035,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 2:\n\n(12 comments)\n\nCheckpoint at ikev2_child_sa.c."},{"timestamp":1516137137,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 2:\n\n(21 comments)\n\nCheckpoint just before ikev2_pkt.c"},{"timestamp":1516242302,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 2:\n\n(18 comments)\n\nCheckpoint: ikev2_sa.c (re-read)."},{"timestamp":1516316724,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 2:\n\n(9 comments)\n\nCheckpoint pfkey.c"},{"timestamp":1516390092,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 2:\n\n(10 comments)\n\nI\u0027d like to look over ts.c some more, but I *think* this is it for now."},{"timestamp":1516635859,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 2:\n\n(61 comments)"},{"timestamp":1516636340,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Uploaded patch set 3."},{"timestamp":1516638623,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 3:\n\n(3 comments)\n\nThanks for the changes, I suspect there are more coming?"},{"timestamp":1573153916,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Abandoned"}],"currentPatchSet":{"number":"3","revision":"df17305b8cba08589f526f4453ba0cd2f0cfb93c","parents":["4ff06ef3de4da3187a6599932808d6e674052fad"],"ref":"refs/changes/74/3174/3","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1516636340,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/Makefile","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/Makefile","type":"ADDED","insertions":58,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/Makefile.com","type":"ADDED","insertions":116,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/THIRDPARTYLICENSE","type":"ADDED","insertions":26,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/THIRDPARTYLICENSE.descrip","type":"ADDED","insertions":1,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/amd64/Makefile","type":"ADDED","insertions":30,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/config.c","type":"ADDED","insertions":418,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/config.h","type":"ADDED","insertions":178,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/config_parse.c","type":"ADDED","insertions":1851,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/defs.h","type":"ADDED","insertions":243,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/dh.c","type":"ADDED","insertions":425,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/dh.h","type":"ADDED","insertions":37,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/fromto.c","type":"ADDED","insertions":300,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/fromto.h","type":"ADDED","insertions":38,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ike.h","type":"ADDED","insertions":119,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev1.h","type":"ADDED","insertions":174,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev1_pkt.c","type":"ADDED","insertions":78,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2.h","type":"ADDED","insertions":557,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_child_sa.c","type":"ADDED","insertions":1979,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_common.c","type":"ADDED","insertions":931,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_common.h","type":"ADDED","insertions":173,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_cookie.c","type":"ADDED","insertions":313,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_cookie.h","type":"ADDED","insertions":48,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_enum.c","type":"ADDED","insertions":476,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_enum.h","type":"ADDED","insertions":44,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_ike_auth.c","type":"ADDED","insertions":901,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_pkt.c","type":"ADDED","insertions":1446,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_pkt.h","type":"ADDED","insertions":163,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_pkt_check.c","type":"ADDED","insertions":725,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_pkt_check.h","type":"ADDED","insertions":35,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_proto.c","type":"ADDED","insertions":1236,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_proto.h","type":"ADDED","insertions":79,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_sa.c","type":"ADDED","insertions":1380,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_sa.h","type":"ADDED","insertions":308,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_sa_init.c","type":"ADDED","insertions":1035,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/inbound.c","type":"ADDED","insertions":248,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/inbound.h","type":"ADDED","insertions":35,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/main.c","type":"ADDED","insertions":490,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/pfkey.c","type":"ADDED","insertions":1854,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/pfkey.h","type":"ADDED","insertions":57,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/pkcs11.c","type":"ADDED","insertions":557,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/pkcs11.h","type":"ADDED","insertions":111,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/pkt.c","type":"ADDED","insertions":1067,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/pkt.h","type":"ADDED","insertions":173,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/pkt_impl.h","type":"ADDED","insertions":63,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/preshared.c","type":"ADDED","insertions":2037,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/preshared.h","type":"ADDED","insertions":213,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/prf.c","type":"ADDED","insertions":432,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/prf.h","type":"ADDED","insertions":56,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ts.c","type":"ADDED","insertions":728,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ts.h","type":"ADDED","insertions":71,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/util.c","type":"ADDED","insertions":445,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/worker.c","type":"ADDED","insertions":505,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/worker.h","type":"ADDED","insertions":75,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/i386/Makefile","type":"ADDED","insertions":29,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/sparcv9/Makefile","type":"ADDED","insertions":30,"deletions":0},{"file":"usr/src/lib/libipsecutil/common/ikedoor.h","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/lib/libipsecutil/common/ipsec_util.h","type":"MODIFIED","insertions":6,"deletions":0}],"sizeInsertions":25205,"sizeDeletions":-1},"patchSets":[{"number":"1","revision":"7af6de4954626b96842aff57ee36f06c5a3ce8e3","parents":["4ff06ef3de4da3187a6599932808d6e674052fad"],"ref":"refs/changes/74/3174/1","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1515459878,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/Makefile","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/Makefile","type":"ADDED","insertions":58,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/Makefile.com","type":"ADDED","insertions":116,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/THIRDPARTYLICENSE","type":"ADDED","insertions":26,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/THIRDPARTYLICENSE.descrip","type":"ADDED","insertions":1,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/amd64/Makefile","type":"ADDED","insertions":30,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/config.c","type":"ADDED","insertions":418,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/config.h","type":"ADDED","insertions":178,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/config_parse.c","type":"ADDED","insertions":1852,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/defs.h","type":"ADDED","insertions":243,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/dh.c","type":"ADDED","insertions":425,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/dh.h","type":"ADDED","insertions":37,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/fromto.c","type":"ADDED","insertions":300,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/fromto.h","type":"ADDED","insertions":38,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ike.h","type":"ADDED","insertions":119,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev1.h","type":"ADDED","insertions":174,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev1_pkt.c","type":"ADDED","insertions":78,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2.h","type":"ADDED","insertions":557,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_child_sa.c","type":"ADDED","insertions":1975,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_common.c","type":"ADDED","insertions":931,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_common.h","type":"ADDED","insertions":173,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_cookie.c","type":"ADDED","insertions":310,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_cookie.h","type":"ADDED","insertions":48,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_enum.c","type":"ADDED","insertions":476,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_enum.h","type":"ADDED","insertions":44,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_ike_auth.c","type":"ADDED","insertions":895,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_pkt.c","type":"ADDED","insertions":1441,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_pkt.h","type":"ADDED","insertions":163,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_pkt_check.c","type":"ADDED","insertions":720,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_pkt_check.h","type":"ADDED","insertions":35,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_proto.c","type":"ADDED","insertions":1227,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_proto.h","type":"ADDED","insertions":79,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_sa.c","type":"ADDED","insertions":1381,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_sa.h","type":"ADDED","insertions":307,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_sa_init.c","type":"ADDED","insertions":1038,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/inbound.c","type":"ADDED","insertions":248,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/inbound.h","type":"ADDED","insertions":35,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/main.c","type":"ADDED","insertions":490,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/pfkey.c","type":"ADDED","insertions":1854,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/pfkey.h","type":"ADDED","insertions":57,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/pkcs11.c","type":"ADDED","insertions":557,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/pkcs11.h","type":"ADDED","insertions":111,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/pkt.c","type":"ADDED","insertions":1059,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/pkt.h","type":"ADDED","insertions":173,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/pkt_impl.h","type":"ADDED","insertions":63,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/preshared.c","type":"ADDED","insertions":2041,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/preshared.h","type":"ADDED","insertions":213,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/prf.c","type":"ADDED","insertions":431,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/prf.h","type":"ADDED","insertions":56,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ts.c","type":"ADDED","insertions":731,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ts.h","type":"ADDED","insertions":71,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/util.c","type":"ADDED","insertions":445,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/worker.c","type":"ADDED","insertions":505,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/worker.h","type":"ADDED","insertions":75,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/i386/Makefile","type":"ADDED","insertions":29,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/sparcv9/Makefile","type":"ADDED","insertions":30,"deletions":0},{"file":"usr/src/lib/libipsecutil/common/ikedoor.h","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/lib/libipsecutil/common/ipsec_util.h","type":"MODIFIED","insertions":6,"deletions":0},{"file":"usr/src/lib/libumem/common/mapfile-vers","type":"MODIFIED","insertions":8,"deletions":-1},{"file":"usr/src/lib/libumem/common/stub_stand.c","type":"MODIFIED","insertions":13,"deletions":0},{"file":"usr/src/lib/libumem/common/umem.c","type":"MODIFIED","insertions":81,"deletions":-1},{"file":"usr/src/lib/libumem/common/umem.h","type":"MODIFIED","insertions":6,"deletions":-2}],"sizeInsertions":25283,"sizeDeletions":-5},{"number":"2","revision":"2df8a755e8ecd0f565b6893bfdde703d022fe755","parents":["4ff06ef3de4da3187a6599932808d6e674052fad"],"ref":"refs/changes/74/3174/2","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1515461133,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/config.c","line":38,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"If you\u0027re doing CONFIG_REFHOLD() as an atomic-add, why bother with a lock (the cfg_lock)?"},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/config.c","line":38,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Being cautious (at least for now) -- the thought being if we want to (effectively) be able to atomically replace the config, we don\u0027t want it changing out from underneath us until after we\u0027ve taken a reference.  This might turn out to be overkill, depending on what/how we want to be able to update the configuration while running."},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/config.c","line":255,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"The nature of INVALID() works equally well for variable names vs. string constants, right?"},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/config.c","line":255,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Yes -- it\u0027s really just a (hopefully) somewhat more informative equivalent of abort() or VERIFY(0)"},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/config.c","line":326,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"I want to say enums are unsigned? Or does the return type of int make this happen anyway?"},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/config.c","line":326,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"My understanding was that they were equivalent to \u0027int\u0027, but I\u0027ll do the individual comparisons to avoid any confusion."},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/config.c","line":351,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Do you need this if you\u0027re just calling ustrfree() on this line\u0027s rvalue?"},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/config.c","line":351,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"No -- leftover from an earlier version.  I\u0027ll remove it."},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/config_parse.c","line":331,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Will be a part of decent ikeadm(1M) support."},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/config_parse.c","line":657,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"\"for (; ;) {\"  is the no-lint-crud-needed alternative."},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/config_parse.c","line":657,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Done"},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/config_parse.c","line":1104,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"I thought we had this in libipsecutil, but it turns out we don\u0027t.  There\u0027s a version in ipsecconf(1M).  Not sure if refactoring this into libipsecutil is practical, but I wanted to mention it for the record."},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/config_parse.c","line":1104,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"I was contemplating looking at if we could use a common set of functions (presumably in libipsecutil, though I think where the code resides is largely an implementation detail) for parsing the various ipsec related files (or at least to handle a decent chunk of the work) -- so ipsecinit.conf, ike.preshared (as I mention in the comments in preshared.c that code is largely untouched from the last open source drop before Oracle closed the gate), as well as ike.conf.\n\nIt seems like more of a \u0027nice to have\u0027 rather than an \u0027essential\u0027 feature (though obviously don\u0027t take my opinion as definitive), so I was planning to look at it more after more of the core functionality was complete.  If you think it\u0027d be better to do that sooner, I\u0027m happy to oblige."},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/config_parse.c","line":1104,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Yeah, it\u0027s not a showstopper."},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/dh.c","line":1,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Any plans for ECDH groups?"},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/dh.c","line":1,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Yes -- I figured it was something that could be done after the basic functionality was working."},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/dh.c","line":326,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Big generator ones too?  (Or does that, like ECDH, suffer from post-Snowden paranoia?)"},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/dh.c","line":326,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"I suspect we\u0027ll probably want to support as many things as we can for interoperability purposes, though perhaps require an explicit flag to enable use of \u0027questionable\u0027 groups."},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev1_pkt.c","line":1,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Should any of this be in the ikev2 codebase?  Just checking."},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev1_pkt.c","line":1,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"The original plan was to (eventually) include ikev1 support as well.  Since the payloads are so similar I wanted to have some stub code to make sure I wasn\u0027t going to code myself into a corner, we could go ahead and remove it though as I think we\u0027ll be ok."},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_child_sa.c","line":33,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Reading this first I had no context.  Please do at least one of:\n\n1.) Make \"args\" something like \"child_sa_args\" just on these lines.\n\n2.) Block-comment above this to explain what these macros are used for, so I don\u0027t have to immediately scroll down to see context?"},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_child_sa.c","line":33,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Done"},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_child_sa.c","line":254,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"The answer is \"no\".  EXPIREs are there for information only."},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_child_sa.c","line":254,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Ok.  I\u0027ll remove the comment and the pfkey_send_error() call since it\u0027s not needed."},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_child_sa.c","line":291,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"File an RFE for this. We should be able to receive it at least."},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_child_sa.c","line":291,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"OS-6568 and OS-6569 have been filed."},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_child_sa.c","line":399,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Why the void here?"},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_child_sa.c","line":399,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"I\u0027m not sure what action we can take if sending a response fails here -- currently during IKE_SA_INIT/IKE_AUTH exchanges, a failure will cause the deletion of the larval IKEv2 SA (and are the only places that check the return value).\n\nThinking about it more, it might be better to just have ikev2_send_resp() return void -- those places that currently check the return value can instead just let the P1 timer take care of deleting the larval IKEv2 SA (which might be better if there\u0027s a transitory problem anyway -- that way a retransmit will trigger a resend attempt)"},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_child_sa.c","line":660,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Is it because the peer chose a subset of OUR policy?  Or could it also be that we chose a subset of the peer\u0027s policy?  I thought this notification (ADDITIONAL_TS_POSSIBLE) covered the latter case."},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_child_sa.c","line":660,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Yes -- this is the reply from the responder, so if they include it, it should mean they chose a subset.  AFAIK, the initiator can never select a subset of the responder\u0027s policy -- it\u0027s always initiator sends it\u0027s policy, responder compares, and possibly narrows it.  This notification just means that there might be further subsets of the initiator\u0027s policy (beyond what the responder chose) that would also be acceptable to the responder.\n\nIt might make sense to move this check to after line 675 (the ts_negotiate() call), and alter it to if (notification_present || narrowed) { log_warning(); }"},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_common.c","line":281,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Why the big if statement, when you can just use the !\u003d0 case for both 0 and non-zero?"},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_common.c","line":281,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Mostly because of a bug here -- elsewhere I used 0x%016llx to make the SPI value fixed sized (I found it easier when comparing logs), though 0x0000000000000000 seemed silly.\n\nWith some of the upcoming Bunyan logging enhancements (i.e. being able to specify objects), this may end up unnecessary since the resulting output would be easier to read, though I\u0027ll fix this in the meantime."},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_common.c","line":304,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"spelling"},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_common.c","line":304,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Done"},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_common.c","line":613,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"ARGSUSED?  Also, the name seems off (ish) compared with what it does.  Are you using this via function pointer as well?"},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_common.c","line":613,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"I was thinking about it originally, but didn\u0027t need it.  I was trying to match the pattern for the rest of the matching code where there is ikev2_sa_match_encr_attr() for checking if any encryption attributes match (just in this case for any types other than encryption algs, the presence of any attributes is a match failure)."},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_common.c","line":891,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Why bother with the second check?  Just put if (in \u003d\u003d NULL || out \u003d\u003d NULL) into the create_children branch."},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_common.c","line":891,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Just avoiding a lot of nesting in an earlier iteration of this, though in the current form it shouldn\u0027t be excessive, I\u0027ll move it in."},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_common.h","line":97,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Are there are arrays here because {AUTH,ENCR}_MAX is small, and because it\u0027s transitory state about what POSSIBLE algorithms could be proposed by us or the peer?!"},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_common.h","line":97,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"It was more of \u0027here\u0027s everything you need to create a child SA in one place\u0027 -- most of that is contained in struct ikev2_child_sa_s, however we still need the values of the keys to create the IPsec SAs in the kernel (but don\u0027t really want to retain them within in.ikev2d longer than necessary), so I didn\u0027t want to include them in struct ikev2_child_sa_s.  If we did include space for the keys in struct ikev2_child_sa_s and just explicit_bzero()\u0027d them after adding, I thought it might be confusing."},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_cookie.c","line":105,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Does this lock just protect enabled/disabled?  Or more?"},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_cookie.c","line":105,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"It also protects the value of the secret and the version as well.  I\u0027ll add a comment as well as move the declarations around to make it a bit more obvious.\n\nAlso since it protects i2c_version, I noticed it doesn\u0027t need to be volatile anymore (originally I was thinking about using atomic_inc to bump the version so it could be read without taking lock, but it really doesn\u0027t buy us much to do that."},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_ike_auth.c","line":79,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Please comment here a bit to explain why initial-contact."},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_ike_auth.c","line":79,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Done"},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_ike_auth.c","line":164,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Do these pkcs11_destroy_obj() calls zero things out?  (They might... I haven\u0027t gotten that far in the source yet.)"},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_ike_auth.c","line":164,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"They are just a wrapper around C_DestroyObject to provide some better logging (and they reset the value of the handle in the 2nd arg to CK_INVALID_HANDLE).  Any zeroing of the actual bits of the keys would have to be done within the PKCS#11 implementation (I can\u0027t remember if I already filed a bug somewhere for this or not, but somewhere on my list is to make pkcs11_softtoken utilize explicit_bzero() when freeing it\u0027s contents)."},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_ike_auth.c","line":199,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"\"there are, delete\""},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_ike_auth.c","line":199,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Done"},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_ike_auth.c","line":200,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Depending on the ID payload sent.  This is important!"},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_ike_auth.c","line":200,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Done"},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_ike_auth.c","line":301,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"\"we check BEFORE doing\"?"},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_ike_auth.c","line":301,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Done"},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_ike_auth.c","line":302,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Also, I believe a malicious active attacker could inject these and gun down an in-progress IKE_AUTH exchange. Prob. not a big deal, BUT should we note that possibility?"},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_ike_auth.c","line":302,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"I\u0027m not sure how -- they\u0027re protected by the key exchange done in the previous IKE_SA_INIT exchange (we discard any packets that don\u0027t pass the integrity check regardless if they decrypt successfully), so this can only originate from whoever responded to our IKE_SA_INIT exchange."},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_ike_auth.c","line":523,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Okay, I was wondering where the cert-specific part of this was.  Perhaps highlighting it a bit more the way you did further up?"},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_ike_auth.c","line":523,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Done"},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_ike_auth.c","line":578,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"That\u0027s what we do in-kernel with ESP SAs (i.e. compute the key schedules). Downside is precomputed is now also in the process image (unless, of course, your pkcs11 is interfacing with a secure token of some sort.)"},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_ike_auth.c","line":578,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"preshared.c already loads all the secrets into memory at startup, so it\u0027d be no worse than what\u0027s there today.\n\nI\u0027d actually like to at some point modify pkcs11_softtoken so that it forks off a worker that stores all the key material and does all the work (and just communicates using doors or UDS or such) so that the key material isn\u0027t present in the same process, though that\u0027s a change for another day."},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_ike_auth.c","line":611,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"No default case after CFG_AUTH_ID_EMAIL, which is why gcc is whining."},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_ike_auth.c","line":611,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Yeah, there\u0027s really no notion of a \u0027default not set\u0027 value for ikev2_id_type_t, so the initial value here is arbitrary which is what I meant.\n\nI like to avoid default cases in switch statements that use enumerated types unless it makes sense to have one.  If additional values are added to the enumerated type, by omitting the default case, it turns into a compile-time error."},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_ike_auth.c","line":877,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"IIRC, indeed it is.  You should double-check the RFC, as I\u0027m pretty sure this is one of the differentiators between IKEv1 and IKEv2 (IKEv1 never cares about the cert\u0027s hash algorithm in the actual packet processing.)"},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_pkt.c","line":50,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Why \"\u003d NULL\" here?"},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_pkt.c","line":50,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Habit -- I like having things initialized to known values for debugging purposes."},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_pkt.c","line":131,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Are you doing any sort of reference-count semantics for IKEv2 SAs?"},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_pkt.c","line":131,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Yes, though with the model we\u0027re using, when we lookup an IKEv2 SA, we take a reference, and we either queue it, or start processing while we hold that reference. As a result, the reference doesn\u0027t need to be \u0027given\u0027 to the pkt_t, just held by any thread that\u0027s touching it (to either process or queue).\n\nWe also keep a reference for the timers (P1 expire, packet retransmit, and eventually IKEv2 lifetime) since the timer callbacks can be run on any thread."},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_pkt.c","line":144,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"in \"buf\"?"},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_pkt.c","line":144,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Done"},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_pkt.c","line":190,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Can/should you lookup the IKEv2 SA here for non-SA_INIT packets, to avoid any other crud later?"},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_pkt.c","line":190,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"It\u0027s probably 6 of one/half a dozen of another.  All the complexity is around looking up/creating new IKEv2 SAs for an IKE_SA_INIT exchange when when the local SPI isn\u0027t present, so I\u0027m not sure it makes much of a difference"},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_pkt.c","line":304,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"I can imagine this check becoming \"ed-\u003eed_keyincr \u003c\u003d N\" someday, but just \u003d\u003d 1 (e.g. blowfish) seems sensible enough."},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_pkt.c","line":431,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Are these full-blown functions for tracing reasons?  Or could you just make add_id_[ir] macro-wrappers to add_id setting initiator as appropriate?"},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_pkt.c","line":431,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Just tracing and observability."},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_pkt.c","line":845,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"I know this, but a casual reader may not.  You\u0027re guaranteed that the IV will be \u003c\u003d blocklen, so you can USE the good-for-only-a-single-block ECB.  This should be called out in a comment somehwere."},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_pkt.c","line":845,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Actually there is a bug here that happened to work -- len should be set to ed-\u003eed_ivlen.  I\u0027ll add a comment about this, and also change \u0027len\u0027 to \u0027ivlen\u0027 to be clearer about what it\u0027s representing."},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_pkt.c","line":1182,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Shouldn\u0027t you be setting \"ok\" to B_FALSE here?"},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_pkt.c","line":1182,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Doh! Yes I should, or I can just return B_FALSE here since there\u0027s no common \u0027final\u0027 bits that need to happen before returning (i.e. can ditch the done label as well)."},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_pkt.h","line":38,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"I\u0027m assuming \"flags\" never contains anything else besides IKEV2_FLAG_INITIATOR?!"},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_pkt.h","line":38,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Yeah, though we should just check the bit.  I\u0027ll fix it."},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_pkt.h","line":95,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"size"},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_pkt.h","line":95,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Done"},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_pkt_check.c","line":255,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Same question here as I asked about something else. Are these real functions because of traceability?  Or should you just make these macros?"},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_pkt_check.c","line":255,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Pretty much"},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_pkt_check.c","line":660,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Because the processing of informational will DTRT?  I think the casual reader needs a bit more here."},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_pkt_check.c","line":660,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Done"},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_pkt_check.c","line":691,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Maybe some sort of panic() here?"},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_pkt_check.c","line":691,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Done"},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_proto.c","line":250,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Just ACQUIRE and EXPIRE, right?  Or more?  Should say up here, for people who are reading top-to-bottom."},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_proto.c","line":250,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Done"},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_proto.c","line":352,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"So if someone changes the rules via ikeadm(1M) or signal, what happens to the i2sa_rule?"},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_proto.c","line":371,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"This a test function, right?  Or did you decide this was going to be a feature?"},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_proto.c","line":371,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"I\u0027m still undecided for now -- most other implementations I\u0027ve dealt with offer such a feature, so it may be worth keeping just for parity reasons (as a past user of other implementations it can be nice to verify your setup is ok without having to go through and hope you correctly triggered an \u0027automatic\u0027 initiation).\n\nHowever if we do keep it, I think it\u0027d require some way to being able to reference a set of corresponding IPsec rules (e.g. in ipsecinit.conf) to find the inner addresses.  I\u0027m not sure how that\u0027d look."},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_proto.c","line":541,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Dumb question, who consumes \"req\" in the success case?  The arm-timer handler? The answer should be here as a comment, or spelled out better above (ikev2_handle_response() is mentioned, but not that it consumes req)."},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_proto.c","line":541,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"it is ikev2_handle_response() -- both ikev2_handle_response() and ikev2_timeout() call ikev2_sa_clear_req() which free\u0027s the packet and cancels the retransmit timer."},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_sa.c","line":274,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"for (; ;)"},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_sa.c","line":274,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Done"},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_sa.c","line":274,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Note the space needed for cstyle:  \"for (; ;)\""},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_sa.h","line":103,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Two, or three?  I see lspi/rspi/addr."},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_sa.h","line":103,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"They\u0027re like the weapons of the Spanish Inquisition :)\nYes there are three.  I\u0027ll fix the comment."},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_sa_init.c","line":242,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"permissible."},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_sa_init.c","line":242,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Done"},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_sa_init.c","line":263,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Depending, maybe you wish to move this before the DH crunch?"},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_sa_init.c","line":263,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"RFC7296 suggests the IKE_SA_INIT payloads SHOULD appear in this order -- it\u0027s not a MUST so we could change the order if we think it\u0027d help, but this is just indicating to the peer what we support (i.e. we\u0027re not doing any actual lookups at this point -- I believe that would happen during the IKE_AUTH exchange)."},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/inbound.c","line":139,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"exit(EXIT_FAILURE) is to inform SMF about this situation."},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/inbound.c","line":139,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"I was just wondering if there was anything to gain by generating a core dump for diagnosis when this happens.  I think SMF will still try to restart even if we abort."},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/main.c","line":234,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"XXX SMF, don\u0027t forget about that."},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/pfkey.c","line":285,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Was this code stuff you inherited?  IF SO, this means it was lifted from in.iked, which influences how OPS/OPD may or may not be implemented."},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/pfkey.c","line":285,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"For the most part -- the only change I made was to split out this portion of the code from extract_exts, the core logic is unchanged however."},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/pfkey.c","line":317,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"NOTE:  If we change keysock to be a real socket module and not a sockfs-talks-to-streams one, we\u0027ll need to make this a recv(MSG_PEEK) sort of deal."},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/pfkey.c","line":357,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"KEBE KNOWS this, so you should lose the XXX KEBE SAYS and keep the rest."},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/pfkey.c","line":357,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Done"},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/pfkey.c","line":477,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"If DEBUG is monitoring PF_KEY, you should do the equivalent of \"ipseckey get/dump\" printing (should be in libipsecutil)."},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/pfkey.c","line":1023,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Not true anymore.  :)"},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/pfkey.c","line":1023,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"I should reword that -- the IPsec SPI id space is still 32 bits -- What I was trying to convey is that in theory, it is possible we exhaust the SPIs between two addresses and loop forever since AFAIK, SADB_GETSPI doesn\u0027t indicate \u0027out of SPIs\u0027 in any sort of error value.\n\nHowever, such a situation would require 2^32 SPIs (or I suppose 2^32-1 since I don\u0027t think 0 is a valid SPI) to exist between two addresses, and it is virtually guaranteed we are going to hit some other resource constraint prior to exhausting the SPI space."},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/pkt.c","line":326,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Block comment here?"},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/pkt.c","line":793,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"This seems... hacky.  The second check for \"start\" seems like it was added on after finding a bug.  Perhaps:\n\nsize_t idx;\n\nif (start !\u003d NULL) {\n    /*\n     * If we\u0027re searching...\n     */\n    idx \u003d pay_to_idx(pkt, start) + 1;\n} else {\n    /* Otherwise start at the beginning. */\n    idx \u003d 0;\n}"},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/pkt.c","line":793,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Done"},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/pkt.c","line":853,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Ahhh, did the prior one get copy/pasted from here?"},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/pkt.c","line":853,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Probably.  They\u0027re similar enough I probably did a bit of copy/paste (though it was long enough ago I can\u0027t say for sure).  Either way I\u0027ll fix both so it\u0027s:\n\nsize_t idx \u003d 0;\n\n/* If we\u0027re looking ... /*\nif (start !\u003d NULL)\n    idx \u003d XXXXX_to_idx(pkt, start) + 1;\n\n...\n\nWhich should hopefully be clearer."},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/preshared.c","line":500,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"I likely mentioned this before, but ipseckey(1M)\u0027s version of this goes straight to sadb_key_t.  I wonder if that code and this can have their common-code factored out for libipsecutil?"},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/preshared.c","line":500,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"I can take a look -- this file is almost entirely verbatim from the last open source drop prior to the red gates of doom closing :)"},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/preshared.c","line":593,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"I didn\u0027t think ipseckey(1M) did ASCII keys."},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/preshared.c","line":593,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"No idea"},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/preshared.c","line":593,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"It doesn\u0027t."},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/preshared.c","line":701,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Shouldn\u0027t this just be\n return (strchr(abuf, \u0027:\u0027) !\u003d NULL)\n?"},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/preshared.c","line":701,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Yeah that\u0027d be shorter.  I\u0027ll change it."},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/preshared.c","line":1009,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Can\u0027t remember if this and its IPv6 counterpart are distinct enough where it could not be factored out and placed in libinetutil."},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/preshared.c","line":1009,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"I don\u0027t know either (as I mentioned, this file was largely as-is from the last source drop before things went closed source again).  I can take a look though and see."},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/prf.c","line":39,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Typo: 7296"},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/prf.c","line":39,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Done"},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ts.c","line":577,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"return (range_contains_addr() \u0026\u0026 range_contains_port()); ?!?"},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ts.c","line":577,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Yeah that\u0027s probably clearer, I\u0027ll change it."},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ts.h","line":41,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"i.e. TCP, UDP, SCTP... right?"},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ts.h","line":41,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Yes -- basically the protocol value from the IKEv2 traffic selector."},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/i386/Makefile","line":2,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"This file and directory may disappear if the 32-bit kernel goes away."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/Makefile","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/Makefile","type":"ADDED","insertions":58,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/Makefile.com","type":"ADDED","insertions":116,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/THIRDPARTYLICENSE","type":"ADDED","insertions":26,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/THIRDPARTYLICENSE.descrip","type":"ADDED","insertions":1,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/amd64/Makefile","type":"ADDED","insertions":30,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/config.c","type":"ADDED","insertions":418,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/config.h","type":"ADDED","insertions":178,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/config_parse.c","type":"ADDED","insertions":1852,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/defs.h","type":"ADDED","insertions":243,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/dh.c","type":"ADDED","insertions":425,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/dh.h","type":"ADDED","insertions":37,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/fromto.c","type":"ADDED","insertions":300,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/fromto.h","type":"ADDED","insertions":38,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ike.h","type":"ADDED","insertions":119,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev1.h","type":"ADDED","insertions":174,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev1_pkt.c","type":"ADDED","insertions":78,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2.h","type":"ADDED","insertions":557,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_child_sa.c","type":"ADDED","insertions":1975,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_common.c","type":"ADDED","insertions":931,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_common.h","type":"ADDED","insertions":173,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_cookie.c","type":"ADDED","insertions":310,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_cookie.h","type":"ADDED","insertions":48,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_enum.c","type":"ADDED","insertions":476,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_enum.h","type":"ADDED","insertions":44,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_ike_auth.c","type":"ADDED","insertions":895,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_pkt.c","type":"ADDED","insertions":1441,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_pkt.h","type":"ADDED","insertions":163,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_pkt_check.c","type":"ADDED","insertions":720,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_pkt_check.h","type":"ADDED","insertions":35,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_proto.c","type":"ADDED","insertions":1227,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_proto.h","type":"ADDED","insertions":79,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_sa.c","type":"ADDED","insertions":1381,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_sa.h","type":"ADDED","insertions":307,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_sa_init.c","type":"ADDED","insertions":1038,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/inbound.c","type":"ADDED","insertions":248,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/inbound.h","type":"ADDED","insertions":35,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/main.c","type":"ADDED","insertions":490,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/pfkey.c","type":"ADDED","insertions":1854,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/pfkey.h","type":"ADDED","insertions":57,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/pkcs11.c","type":"ADDED","insertions":557,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/pkcs11.h","type":"ADDED","insertions":111,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/pkt.c","type":"ADDED","insertions":1059,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/pkt.h","type":"ADDED","insertions":173,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/pkt_impl.h","type":"ADDED","insertions":63,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/preshared.c","type":"ADDED","insertions":2041,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/preshared.h","type":"ADDED","insertions":213,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/prf.c","type":"ADDED","insertions":431,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/prf.h","type":"ADDED","insertions":56,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ts.c","type":"ADDED","insertions":731,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ts.h","type":"ADDED","insertions":71,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/util.c","type":"ADDED","insertions":445,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/worker.c","type":"ADDED","insertions":505,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/worker.h","type":"ADDED","insertions":75,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/i386/Makefile","type":"ADDED","insertions":29,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/sparcv9/Makefile","type":"ADDED","insertions":30,"deletions":0},{"file":"usr/src/lib/libipsecutil/common/ikedoor.h","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/lib/libipsecutil/common/ipsec_util.h","type":"MODIFIED","insertions":6,"deletions":0}],"sizeInsertions":25175,"sizeDeletions":-1},{"number":"3","revision":"df17305b8cba08589f526f4453ba0cd2f0cfb93c","parents":["4ff06ef3de4da3187a6599932808d6e674052fad"],"ref":"refs/changes/74/3174/3","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1516636340,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/Makefile","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/Makefile","type":"ADDED","insertions":58,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/Makefile.com","type":"ADDED","insertions":116,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/THIRDPARTYLICENSE","type":"ADDED","insertions":26,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/THIRDPARTYLICENSE.descrip","type":"ADDED","insertions":1,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/amd64/Makefile","type":"ADDED","insertions":30,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/config.c","type":"ADDED","insertions":418,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/config.h","type":"ADDED","insertions":178,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/config_parse.c","type":"ADDED","insertions":1851,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/defs.h","type":"ADDED","insertions":243,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/dh.c","type":"ADDED","insertions":425,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/dh.h","type":"ADDED","insertions":37,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/fromto.c","type":"ADDED","insertions":300,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/fromto.h","type":"ADDED","insertions":38,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ike.h","type":"ADDED","insertions":119,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev1.h","type":"ADDED","insertions":174,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev1_pkt.c","type":"ADDED","insertions":78,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2.h","type":"ADDED","insertions":557,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_child_sa.c","type":"ADDED","insertions":1979,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_common.c","type":"ADDED","insertions":931,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_common.h","type":"ADDED","insertions":173,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_cookie.c","type":"ADDED","insertions":313,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_cookie.h","type":"ADDED","insertions":48,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_enum.c","type":"ADDED","insertions":476,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_enum.h","type":"ADDED","insertions":44,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_ike_auth.c","type":"ADDED","insertions":901,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_pkt.c","type":"ADDED","insertions":1446,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_pkt.h","type":"ADDED","insertions":163,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_pkt_check.c","type":"ADDED","insertions":725,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_pkt_check.h","type":"ADDED","insertions":35,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_proto.c","type":"ADDED","insertions":1236,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_proto.h","type":"ADDED","insertions":79,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_sa.c","type":"ADDED","insertions":1380,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_sa.h","type":"ADDED","insertions":308,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ikev2_sa_init.c","type":"ADDED","insertions":1035,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/inbound.c","type":"ADDED","insertions":248,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/inbound.h","type":"ADDED","insertions":35,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/main.c","type":"ADDED","insertions":490,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/pfkey.c","type":"ADDED","insertions":1854,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/pfkey.h","type":"ADDED","insertions":57,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/pkcs11.c","type":"ADDED","insertions":557,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/pkcs11.h","type":"ADDED","insertions":111,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/pkt.c","type":"ADDED","insertions":1067,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/pkt.h","type":"ADDED","insertions":173,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/pkt_impl.h","type":"ADDED","insertions":63,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/preshared.c","type":"ADDED","insertions":2037,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/preshared.h","type":"ADDED","insertions":213,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/prf.c","type":"ADDED","insertions":432,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/prf.h","type":"ADDED","insertions":56,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ts.c","type":"ADDED","insertions":728,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/ts.h","type":"ADDED","insertions":71,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/util.c","type":"ADDED","insertions":445,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/worker.c","type":"ADDED","insertions":505,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/common/worker.h","type":"ADDED","insertions":75,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/i386/Makefile","type":"ADDED","insertions":29,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.lib/in.ikev2/sparcv9/Makefile","type":"ADDED","insertions":30,"deletions":0},{"file":"usr/src/lib/libipsecutil/common/ikedoor.h","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/lib/libipsecutil/common/ipsec_util.h","type":"MODIFIED","insertions":6,"deletions":0}],"sizeInsertions":25205,"sizeDeletions":-1}],"allReviewers":[{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}]}