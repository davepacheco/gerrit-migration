{"project":"joyent/sdc-manta","branch":"master","topic":"MANTA-3195","id":"I71d0bb28908c9f9adbc41e07e72c529805d54715","number":"1749","subject":"MANTA-3195 manta amon configuration could use work MANTA-3191 nameservice zones get duplicate \"logs not uploaded\" probes MANTA-3194 postgres zones get duplicate \"registrar-logscan\" probes MANTA-3188 common probes not deployed to services with no other pro","owner":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"url":"https://cr.joyent.us/1749","commitMessage":"MANTA-3195 manta amon configuration could use work\nMANTA-3191 nameservice zones get duplicate \"logs not uploaded\" probes\nMANTA-3194 postgres zones get duplicate \"registrar-logscan\" probes\nMANTA-3188 common probes not deployed to services with no other probes\nMANTA-3210 manta-adm should honor LOG_LEVEL\nMANTA-3211 clean up manta-adm help and options\nReviewed by: Trent Mick \u003ctrentm@gmail.com\u003e\nReviewed by: Robert Mustacchi \u003crm@joyent.com\u003e\nApproved by: Jordan Hendricks \u003cjordan.hendricks@joyent.com\u003e\nApproved by: Trent Mick \u003ctrentm@gmail.com\u003e\n","createdOn":1491347927,"lastUpdated":1496351431,"open":false,"status":"MERGED","comments":[{"timestamp":1491347927,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Uploaded patch set 1."},{"timestamp":1491347941,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing-1\n\n\"make check\" exited with status 2\n\n fatal: ref HEAD is not a symbolic ref\n node ./tools/probecfgchk.js alarm_metadata/probe_templates/postgres.yaml alarm_metadata/probe_templates/storage.yaml alarm_metadata/probe_templates/jobsupervisor.yaml alarm_metadata/probe_templates/nameservice.yaml alarm_metadata/probe_templates/ops.yaml alarm_metadata/probe_templates/loadbalancer.yaml alarm_metadata/probe_templates/authcache.yaml alarm_metadata/probe_templates/common.yaml alarm_metadata/probe_templates/storage_gzs.yaml alarm_metadata/probe_templates/electric-moray.yaml alarm_metadata/probe_templates/webapi.yaml alarm_metadata/probe_templates/moray.yaml\n \n module.js:340\n     throw err;\n           ^\n Error: Cannot find module \u0027cmdutil\u0027\n     at Function.Module._resolveFilename (module.js:338:15)\n     at Function.Module._load (module.js:280:25)\n     at Module.require (module.js:364:17)\n     at require (module.js:380:17)\n     at Object.\u003canonymous\u003e (/tmp/repo/tools/probecfgchk.js:17:15)\n     at Module._compile (module.js:456:26)\n     at Object.Module._extensions..js (module.js:474:10)\n     at Module.load (module.js:356:32)\n     at Function.Module._load (module.js:312:12)\n     at Function.Module.runMain (module.js:497:10)\n Makefile:96: recipe for target \u0027check-probe-files\u0027 failed\n gmake: *** [check-probe-files] Error 8"},{"timestamp":1491348155,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Uploaded patch set 2."},{"timestamp":1491349469,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing-1\n\n\"make check\" exited with status 2\n\n npm WARN optional dep failed, continuing\n \u003e leveldown@0.8.0 install /tmp/repo/node_modules/fash/node_modules/leveldown\n \u003e node-gyp rebuild\n \n  dtrace-provider@0.2.8\n gyp WARN install got an error, rolling back install\n gyp ERR! configure error \n gyp ERR! stack Error: 522 status code downloading tarball\n gyp ERR! stack     at Request.\u003canonymous\u003e (/tmp/repo/build/node/lib/node_modules/npm/node_modules/node-gyp/lib/install.js:246:14)\n gyp ERR! stack     at Request.emit (events.js:117:20)\n gyp ERR! stack     at Request.onResponse (/tmp/repo/build/node/lib/node_modules/npm/node_modules/request/request.js:1085:10)\n gyp ERR! stack     at ClientRequest.g (events.js:180:16)\n gyp ERR! stack     at ClientRequest.emit (events.js:95:17)\n gyp ERR! stack     at HTTPParser.parserOnIncomingClient (http.js:1692:21)\n gyp ERR! stack     at HTTPParser.parserOnHeadersComplete [as onHeadersComplete] (http.js:121:23)\n gyp ERR! stack     at Socket.socketOnData (http.js:1587:20)\n gyp ERR! stack     at TCP.onread (net.js:527:27)\n gyp ERR! System SunOS 5.11\n gyp ERR! command \"node\" \"/tmp/repo/build/node/lib/node_modules/npm/node_modules/node-gyp/bin/node-gyp.js\" \"rebuild\"\n gyp ERR! cwd /tmp/repo/node_modules/fash/node_modules/leveldown\n gyp ERR! node -v v0.10.32\n gyp ERR! node-gyp -v v1.0.1\n gyp ERR! not ok \n \n npm ERR! Error: Command failed: Cloning into bare repository \u0027/home/build/.npm/_git-remotes/git-github-com-joyent-node-sdc-clients-git-ba171bad\u0027...\n npm ERR! Host key verification failed.\n npm ERR! fatal: Could not read from remote repository.\n npm ERR! \n npm ERR! Please make sure you have the correct access rights\n npm ERR! and the repository exists.\n npm ERR! \n npm ERR!     at ChildProcess.exithandler (child_process.js:648:15)\n npm ERR!     at ChildProcess.emit (events.js:98:17)\n npm ERR!     at maybeClose (child_process.js:756:16)\n npm ERR!     at Socket.\u003canonymous\u003e (child_process.js:969:11)\n npm ERR!     at Socket.emit (events.js:95:17)\n npm ERR!     at Pipe.close (net.js:465:12)\n npm ERR! If you need help, you may report this *entire* log,\n npm ERR! including the npm and node versions, at:\n npm ERR!     \u003chttp://github.com/npm/npm/issues\u003e\n npm ERR! System SunOS 5.11\n npm ERR! command \"node\" \"/tmp/repo/build/node/bin/npm\" \"install\"\n npm ERR! cwd /tmp/repo\n npm ERR! node -v v0.10.32\n npm ERR! npm -v 1.4.28\n npm ERR! code 128\n npm ERR! not ok code 0\n Makefile:106: recipe for target \u0027deps\u0027 failed\n gmake: *** [deps] Error 1"},{"timestamp":1491350022,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Uploaded patch set 3."},{"timestamp":1491350032,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing-1\n\n\"make check\" exited with status 2\n\n fatal: ref HEAD is not a symbolic ref\n node ./tools/probecfgchk.js alarm_metadata/probe_templates/postgres.yaml alarm_metadata/probe_templates/storage.yaml alarm_metadata/probe_templates/jobsupervisor.yaml alarm_metadata/probe_templates/authcache.yaml alarm_metadata/probe_templates/nameservice.yaml alarm_metadata/probe_templates/ops.yaml alarm_metadata/probe_templates/loadbalancer.yaml alarm_metadata/probe_templates/common.yaml alarm_metadata/probe_templates/storage_gzs.yaml alarm_metadata/probe_templates/electric-moray.yaml alarm_metadata/probe_templates/webapi.yaml alarm_metadata/probe_templates/moray.yaml\n \n module.js:340\n     throw err;\n           ^\n Error: Cannot find module \u0027cmdutil\u0027\n     at Function.Module._resolveFilename (module.js:338:15)\n     at Function.Module._load (module.js:280:25)\n     at Module.require (module.js:364:17)\n     at require (module.js:380:17)\n     at Object.\u003canonymous\u003e (/tmp/repo/tools/probecfgchk.js:17:15)\n     at Module._compile (module.js:456:26)\n     at Object.Module._extensions..js (module.js:474:10)\n     at Module.load (module.js:356:32)\n     at Function.Module._load (module.js:312:12)\n     at Function.Module.runMain (module.js:497:10)\n Makefile:96: recipe for target \u0027check-probe-files\u0027 failed\n gmake: *** [check-probe-files] Error 8"},{"timestamp":1494439677,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Uploaded patch set 4."},{"timestamp":1494439687,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing-1\n\n\"make check\" exited with status 2\n\n fatal: ref HEAD is not a symbolic ref\n fatal: No tags can describe \u002753c9a390917ae14517d8ed93a7b45dfb2a45e43c\u0027.\n Try --always, or create some tags.\n node ./tools/probecfgchk.js alarm_metadata/probe_templates/postgres.yaml alarm_metadata/probe_templates/storage.yaml alarm_metadata/probe_templates/jobsupervisor.yaml alarm_metadata/probe_templates/authcache.yaml alarm_metadata/probe_templates/nameservice.yaml alarm_metadata/probe_templates/ops.yaml alarm_metadata/probe_templates/loadbalancer.yaml alarm_metadata/probe_templates/common.yaml alarm_metadata/probe_templates/storage_gzs.yaml alarm_metadata/probe_templates/electric-moray.yaml alarm_metadata/probe_templates/webapi.yaml alarm_metadata/probe_templates/moray.yaml\n \n module.js:340\n     throw err;\n           ^\n Error: Cannot find module \u0027cmdutil\u0027\n     at Function.Module._resolveFilename (module.js:338:15)\n     at Function.Module._load (module.js:280:25)\n     at Module.require (module.js:364:17)\n     at require (module.js:380:17)\n     at Object.\u003canonymous\u003e (/tmp/repo/tools/probecfgchk.js:17:15)\n     at Module._compile (module.js:456:26)\n     at Object.Module._extensions..js (module.js:474:10)\n     at Module.load (module.js:356:32)\n     at Function.Module._load (module.js:312:12)\n     at Function.Module.runMain (module.js:497:10)\n Makefile:96: recipe for target \u0027check-probe-files\u0027 failed\n gmake: *** [check-probe-files] Error 8"},{"timestamp":1494442305,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Uploaded patch set 5."},{"timestamp":1494442349,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1494461584,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Uploaded patch set 6."},{"timestamp":1494461628,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 6: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1494517826,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Topic set to MANTA-3195"},{"timestamp":1494551939,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 6:\n\n(29 comments)"},{"timestamp":1494618663,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Uploaded patch set 7."},{"timestamp":1494618733,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 7: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1494618878,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 6:\n\n(27 comments)\n\nThanks for the thoughtful review."},{"timestamp":1494870612,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 7:\n\n(7 comments)"},{"timestamp":1494870629,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 7: Code-Review+1"},{"timestamp":1495054902,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 7: Code-Review+1\n\n(4 comments)\n\nThis looks great!\nI haven\u0027t had a chance to play in nightly-1 yet.\nI didn\u0027t go through the guts of lib/adm.js and lib/alarms/*.js."},{"timestamp":1495055984,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 7:\n\n(4 comments)\n\nThank you for taking a look!"},{"timestamp":1495056033,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Uploaded patch set 8."},{"timestamp":1495056088,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 8: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1495058622,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 7:\n\n(2 comments)"},{"timestamp":1495058682,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 8: Code-Review+1"},{"timestamp":1495142794,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 8:\n\nFWIW, I made a build of this (patchset 7):\n\n005fc622-3c06-11e7-80be-a30d9f04783d  manta-deployment  cr-1749-7-20170518T200447Z-g86c075a              I      smartos  2017-05-18T20:09:29Z"},{"timestamp":1495148944,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 8:\n\nDave,\n\nIf you like you could take this patch: https://gist.github.com/trentm/bef988db9b797c56bdeee12867b810d1\n\nWhich would change from:\n\n```\n[root@headnode (nightly-1) ~]# manta-adm alarm\nView and configure information about alarms.\n\nUsage:\n    alarm [OPTIONS] COMMAND [ARGS...]\n    alarm help COMMAND\n...\n```\n\nto:\n\n```\n[root@headnode (nightly-1) ~]# manta-adm alarm\nView and configure information about alarms.\n\nUsage:\n    manta-adm alarm [OPTIONS] COMMAND [ARGS...]\n    manta-adm alarm help COMMAND\n...\n```\n\nand similarly for the other subcommands (to get the full command name in the usage)."},{"timestamp":1495210741,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Uploaded patch set 9."},{"timestamp":1495210786,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 9:\n\n\u003e If you like you could take this patch: https://gist.github.com/trentm/bef988db9b797c56bdeee12867b810d1\n\nDone.  Thanks for the build, and thanks for that fix!"},{"timestamp":1495210793,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 9: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1495211736,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 9: Code-Review+1"},{"timestamp":1495221168,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Patch Set 9:\n\n(27 comments)\n\nNice work! I didn\u0027t get to get through as much of lib/alarms/update.js as I had hoped before I needed to leave. Here is my feedback so far.\n\nThanks for taking this on!"},{"timestamp":1495245889,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 8:\n\n(27 comments)\n\nThanks for the detailed review!"},{"timestamp":1495245959,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Uploaded patch set 10."},{"timestamp":1495246008,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 10: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1495559379,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 10: Code-Review+1"},{"timestamp":1496166033,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Patch Set 10:\n\n(7 comments)"},{"timestamp":1496177122,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 7:\n\n(1 comment)"},{"timestamp":1496186303,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Patch Set 10: Integration-Approval+1"},{"timestamp":1496186336,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Patch Set 10:\n\nThe testing notes look good. Thanks for taking this on!"},{"timestamp":1496192177,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 10: Code-Review+1"},{"timestamp":1496250899,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 10: Integration-Approval+1"},{"timestamp":1496257697,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Uploaded patch set 11: Patch Set 10 was rebased."},{"timestamp":1496257739,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 11:\n\n\"make check\" passed ok"},{"timestamp":1496258748,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Uploaded patch set 12: Commit message was updated."},{"timestamp":1496351431,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by David Pacheco"}],"currentPatchSet":{"number":"12","revision":"71d0bb28908c9f9adbc41e07e72c529805d54715","parents":["b4abfc8d0002640430e9beabb19f9de6a9b13607"],"ref":"refs/changes/49/1749/12","uploader":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"createdOn":1496258748,"author":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1495246008,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1495559379,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1496186303,"by":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1496192177,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1496250899,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1496351431,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":16,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":14,"deletions":-1},{"file":"alarm_metadata/probe_templates/authcache.yaml","type":"ADDED","insertions":181,"deletions":0},{"file":"alarm_metadata/probe_templates/common.yaml","type":"ADDED","insertions":182,"deletions":0},{"file":"alarm_metadata/probe_templates/electric-moray.yaml","type":"ADDED","insertions":43,"deletions":0},{"file":"alarm_metadata/probe_templates/jobsupervisor.yaml","type":"ADDED","insertions":59,"deletions":0},{"file":"alarm_metadata/probe_templates/loadbalancer.yaml","type":"ADDED","insertions":152,"deletions":0},{"file":"alarm_metadata/probe_templates/moray.yaml","type":"ADDED","insertions":44,"deletions":0},{"file":"alarm_metadata/probe_templates/nameservice.yaml","type":"ADDED","insertions":129,"deletions":0},{"file":"alarm_metadata/probe_templates/ops.yaml","type":"ADDED","insertions":503,"deletions":0},{"file":"alarm_metadata/probe_templates/postgres.yaml","type":"ADDED","insertions":228,"deletions":0},{"file":"alarm_metadata/probe_templates/storage.yaml","type":"ADDED","insertions":137,"deletions":0},{"file":"alarm_metadata/probe_templates/storage_gzs.yaml","type":"ADDED","insertions":131,"deletions":0},{"file":"alarm_metadata/probe_templates/webapi.yaml","type":"ADDED","insertions":42,"deletions":0},{"file":"boot/setup.sh","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"cmd/manta-adm.js","type":"MODIFIED","insertions":930,"deletions":-84},{"file":"docs/man/man1/manta-adm.md","type":"MODIFIED","insertions":187,"deletions":-22},{"file":"lib/adm.js","type":"MODIFIED","insertions":1407,"deletions":-40},{"file":"lib/alarms/alarms.js","type":"ADDED","insertions":397,"deletions":0},{"file":"lib/alarms/amon_objects.js","type":"ADDED","insertions":411,"deletions":0},{"file":"lib/alarms/config.js","type":"ADDED","insertions":544,"deletions":0},{"file":"lib/alarms/index.js","type":"ADDED","insertions":245,"deletions":0},{"file":"lib/alarms/metadata.js","type":"ADDED","insertions":951,"deletions":0},{"file":"lib/alarms/update.js","type":"ADDED","insertions":1338,"deletions":0},{"file":"lib/common.js","type":"MODIFIED","insertions":17,"deletions":-20},{"file":"lib/instance_info.js","type":"ADDED","insertions":64,"deletions":0},{"file":"lib/services.js","type":"MODIFIED","insertions":28,"deletions":-17},{"file":"man/man1/manta-adm.1","type":"MODIFIED","insertions":201,"deletions":-22},{"file":"package.json","type":"MODIFIED","insertions":6,"deletions":-3},{"file":"test/alarms/mock_amon.js","type":"ADDED","insertions":195,"deletions":0},{"file":"test/alarms/tst.alarms.js","type":"ADDED","insertions":539,"deletions":0},{"file":"test/alarms/tst.amon_objects.js","type":"ADDED","insertions":678,"deletions":0},{"file":"test/alarms/tst.config.js","type":"ADDED","insertions":540,"deletions":0},{"file":"test/alarms/tst.metadata_basic.js","type":"ADDED","insertions":706,"deletions":0},{"file":"test/alarms/tst.metadata_files.js","type":"ADDED","insertions":270,"deletions":0},{"file":"test/alarms/tst.update.js","type":"ADDED","insertions":1123,"deletions":0},{"file":"test/tst.services.js","type":"MODIFIED","insertions":11,"deletions":-1},{"file":"tools/probecfgchk.js","type":"ADDED","insertions":63,"deletions":0}],"sizeInsertions":12696,"sizeDeletions":-211},"patchSets":[{"number":"1","revision":"dd0f7e05dcf38521c6b9af723e77a43d8e476628","parents":["48d0d723bb516d9b793a0cd3c52341b2f5868316"],"ref":"refs/changes/49/1749/1","uploader":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"createdOn":1491347927,"author":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1491347941,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":7,"deletions":-2},{"file":"alarm_metadata/probe_templates/authcache.yaml","type":"ADDED","insertions":181,"deletions":0},{"file":"alarm_metadata/probe_templates/common.yaml","type":"ADDED","insertions":182,"deletions":0},{"file":"alarm_metadata/probe_templates/electric-moray.yaml","type":"ADDED","insertions":43,"deletions":0},{"file":"alarm_metadata/probe_templates/jobsupervisor.yaml","type":"ADDED","insertions":59,"deletions":0},{"file":"alarm_metadata/probe_templates/loadbalancer.yaml","type":"ADDED","insertions":148,"deletions":0},{"file":"alarm_metadata/probe_templates/moray.yaml","type":"ADDED","insertions":44,"deletions":0},{"file":"alarm_metadata/probe_templates/nameservice.yaml","type":"ADDED","insertions":129,"deletions":0},{"file":"alarm_metadata/probe_templates/ops.yaml","type":"ADDED","insertions":503,"deletions":0},{"file":"alarm_metadata/probe_templates/postgres.yaml","type":"ADDED","insertions":228,"deletions":0},{"file":"alarm_metadata/probe_templates/storage.yaml","type":"ADDED","insertions":137,"deletions":0},{"file":"alarm_metadata/probe_templates/storage_gzs.yaml","type":"ADDED","insertions":131,"deletions":0},{"file":"alarm_metadata/probe_templates/webapi.yaml","type":"ADDED","insertions":42,"deletions":0},{"file":"cmd/manta-adm.js","type":"MODIFIED","insertions":896,"deletions":-81},{"file":"docs/man/man1/manta-adm.md","type":"MODIFIED","insertions":185,"deletions":-13},{"file":"lib/adm.js","type":"MODIFIED","insertions":1271,"deletions":-38},{"file":"lib/alarms/alarms.js","type":"ADDED","insertions":341,"deletions":0},{"file":"lib/alarms/amon_objects.js","type":"ADDED","insertions":401,"deletions":0},{"file":"lib/alarms/config.js","type":"ADDED","insertions":545,"deletions":0},{"file":"lib/alarms/index.js","type":"ADDED","insertions":240,"deletions":0},{"file":"lib/alarms/metadata.js","type":"ADDED","insertions":930,"deletions":0},{"file":"lib/alarms/update.js","type":"ADDED","insertions":1306,"deletions":0},{"file":"lib/common.js","type":"MODIFIED","insertions":59,"deletions":-19},{"file":"lib/services.js","type":"MODIFIED","insertions":28,"deletions":-17},{"file":"man/man1/manta-adm.1","type":"MODIFIED","insertions":196,"deletions":-13},{"file":"package.json","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"tools/probecfgchk.js","type":"ADDED","insertions":64,"deletions":0}],"sizeInsertions":8302,"sizeDeletions":-185},{"number":"2","revision":"52fda7f999e1315c5c8525328bbe544ba1247fbb","parents":["48d0d723bb516d9b793a0cd3c52341b2f5868316"],"ref":"refs/changes/49/1749/2","uploader":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"createdOn":1491348155,"author":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1491349469,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":7,"deletions":-2},{"file":"alarm_metadata/probe_templates/authcache.yaml","type":"ADDED","insertions":181,"deletions":0},{"file":"alarm_metadata/probe_templates/common.yaml","type":"ADDED","insertions":182,"deletions":0},{"file":"alarm_metadata/probe_templates/electric-moray.yaml","type":"ADDED","insertions":43,"deletions":0},{"file":"alarm_metadata/probe_templates/jobsupervisor.yaml","type":"ADDED","insertions":59,"deletions":0},{"file":"alarm_metadata/probe_templates/loadbalancer.yaml","type":"ADDED","insertions":148,"deletions":0},{"file":"alarm_metadata/probe_templates/moray.yaml","type":"ADDED","insertions":44,"deletions":0},{"file":"alarm_metadata/probe_templates/nameservice.yaml","type":"ADDED","insertions":129,"deletions":0},{"file":"alarm_metadata/probe_templates/ops.yaml","type":"ADDED","insertions":503,"deletions":0},{"file":"alarm_metadata/probe_templates/postgres.yaml","type":"ADDED","insertions":228,"deletions":0},{"file":"alarm_metadata/probe_templates/storage.yaml","type":"ADDED","insertions":137,"deletions":0},{"file":"alarm_metadata/probe_templates/storage_gzs.yaml","type":"ADDED","insertions":131,"deletions":0},{"file":"alarm_metadata/probe_templates/webapi.yaml","type":"ADDED","insertions":42,"deletions":0},{"file":"cmd/manta-adm.js","type":"MODIFIED","insertions":896,"deletions":-81},{"file":"docs/man/man1/manta-adm.md","type":"MODIFIED","insertions":185,"deletions":-13},{"file":"lib/adm.js","type":"MODIFIED","insertions":1271,"deletions":-38},{"file":"lib/alarms/alarms.js","type":"ADDED","insertions":341,"deletions":0},{"file":"lib/alarms/amon_objects.js","type":"ADDED","insertions":401,"deletions":0},{"file":"lib/alarms/config.js","type":"ADDED","insertions":545,"deletions":0},{"file":"lib/alarms/index.js","type":"ADDED","insertions":240,"deletions":0},{"file":"lib/alarms/metadata.js","type":"ADDED","insertions":930,"deletions":0},{"file":"lib/alarms/update.js","type":"ADDED","insertions":1306,"deletions":0},{"file":"lib/common.js","type":"MODIFIED","insertions":59,"deletions":-19},{"file":"lib/services.js","type":"MODIFIED","insertions":28,"deletions":-17},{"file":"man/man1/manta-adm.1","type":"MODIFIED","insertions":196,"deletions":-13},{"file":"package.json","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"tools/probecfgchk.js","type":"ADDED","insertions":64,"deletions":0}],"sizeInsertions":8302,"sizeDeletions":-185},{"number":"3","revision":"847212a04354f4dbcee691b322aa1beb75f9dfca","parents":["48d0d723bb516d9b793a0cd3c52341b2f5868316"],"ref":"refs/changes/49/1749/3","uploader":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"createdOn":1491350022,"author":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1491350032,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":7,"deletions":-2},{"file":"alarm_metadata/probe_templates/authcache.yaml","type":"ADDED","insertions":181,"deletions":0},{"file":"alarm_metadata/probe_templates/common.yaml","type":"ADDED","insertions":182,"deletions":0},{"file":"alarm_metadata/probe_templates/electric-moray.yaml","type":"ADDED","insertions":43,"deletions":0},{"file":"alarm_metadata/probe_templates/jobsupervisor.yaml","type":"ADDED","insertions":59,"deletions":0},{"file":"alarm_metadata/probe_templates/loadbalancer.yaml","type":"ADDED","insertions":148,"deletions":0},{"file":"alarm_metadata/probe_templates/moray.yaml","type":"ADDED","insertions":44,"deletions":0},{"file":"alarm_metadata/probe_templates/nameservice.yaml","type":"ADDED","insertions":129,"deletions":0},{"file":"alarm_metadata/probe_templates/ops.yaml","type":"ADDED","insertions":503,"deletions":0},{"file":"alarm_metadata/probe_templates/postgres.yaml","type":"ADDED","insertions":228,"deletions":0},{"file":"alarm_metadata/probe_templates/storage.yaml","type":"ADDED","insertions":137,"deletions":0},{"file":"alarm_metadata/probe_templates/storage_gzs.yaml","type":"ADDED","insertions":131,"deletions":0},{"file":"alarm_metadata/probe_templates/webapi.yaml","type":"ADDED","insertions":42,"deletions":0},{"file":"cmd/manta-adm.js","type":"MODIFIED","insertions":896,"deletions":-81},{"file":"docs/man/man1/manta-adm.md","type":"MODIFIED","insertions":185,"deletions":-13},{"file":"lib/adm.js","type":"MODIFIED","insertions":1271,"deletions":-38},{"file":"lib/alarms/alarms.js","type":"ADDED","insertions":341,"deletions":0},{"file":"lib/alarms/amon_objects.js","type":"ADDED","insertions":401,"deletions":0},{"file":"lib/alarms/config.js","type":"ADDED","insertions":545,"deletions":0},{"file":"lib/alarms/index.js","type":"ADDED","insertions":240,"deletions":0},{"file":"lib/alarms/metadata.js","type":"ADDED","insertions":930,"deletions":0},{"file":"lib/alarms/update.js","type":"ADDED","insertions":1306,"deletions":0},{"file":"lib/common.js","type":"MODIFIED","insertions":59,"deletions":-19},{"file":"lib/services.js","type":"MODIFIED","insertions":28,"deletions":-17},{"file":"man/man1/manta-adm.1","type":"MODIFIED","insertions":196,"deletions":-13},{"file":"package.json","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"tools/probecfgchk.js","type":"ADDED","insertions":64,"deletions":0}],"sizeInsertions":8302,"sizeDeletions":-185},{"number":"4","revision":"53c9a390917ae14517d8ed93a7b45dfb2a45e43c","parents":["48d0d723bb516d9b793a0cd3c52341b2f5868316"],"ref":"refs/changes/49/1749/4","uploader":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"createdOn":1494439677,"author":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1494439687,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":12,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":7,"deletions":-2},{"file":"alarm_metadata/probe_templates/authcache.yaml","type":"ADDED","insertions":181,"deletions":0},{"file":"alarm_metadata/probe_templates/common.yaml","type":"ADDED","insertions":182,"deletions":0},{"file":"alarm_metadata/probe_templates/electric-moray.yaml","type":"ADDED","insertions":43,"deletions":0},{"file":"alarm_metadata/probe_templates/jobsupervisor.yaml","type":"ADDED","insertions":59,"deletions":0},{"file":"alarm_metadata/probe_templates/loadbalancer.yaml","type":"ADDED","insertions":148,"deletions":0},{"file":"alarm_metadata/probe_templates/moray.yaml","type":"ADDED","insertions":44,"deletions":0},{"file":"alarm_metadata/probe_templates/nameservice.yaml","type":"ADDED","insertions":129,"deletions":0},{"file":"alarm_metadata/probe_templates/ops.yaml","type":"ADDED","insertions":503,"deletions":0},{"file":"alarm_metadata/probe_templates/postgres.yaml","type":"ADDED","insertions":228,"deletions":0},{"file":"alarm_metadata/probe_templates/storage.yaml","type":"ADDED","insertions":137,"deletions":0},{"file":"alarm_metadata/probe_templates/storage_gzs.yaml","type":"ADDED","insertions":131,"deletions":0},{"file":"alarm_metadata/probe_templates/webapi.yaml","type":"ADDED","insertions":42,"deletions":0},{"file":"cmd/manta-adm.js","type":"MODIFIED","insertions":901,"deletions":-81},{"file":"docs/man/man1/manta-adm.md","type":"MODIFIED","insertions":185,"deletions":-13},{"file":"lib/adm.js","type":"MODIFIED","insertions":1347,"deletions":-40},{"file":"lib/alarms/alarms.js","type":"ADDED","insertions":375,"deletions":0},{"file":"lib/alarms/amon_objects.js","type":"ADDED","insertions":406,"deletions":0},{"file":"lib/alarms/config.js","type":"ADDED","insertions":544,"deletions":0},{"file":"lib/alarms/index.js","type":"ADDED","insertions":240,"deletions":0},{"file":"lib/alarms/metadata.js","type":"ADDED","insertions":951,"deletions":0},{"file":"lib/alarms/update.js","type":"ADDED","insertions":1339,"deletions":0},{"file":"lib/common.js","type":"MODIFIED","insertions":20,"deletions":-19},{"file":"lib/instance_info.js","type":"ADDED","insertions":64,"deletions":0},{"file":"lib/services.js","type":"MODIFIED","insertions":28,"deletions":-17},{"file":"man/man1/manta-adm.1","type":"MODIFIED","insertions":196,"deletions":-13},{"file":"package.json","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"test/alarms/mock_amon.js","type":"ADDED","insertions":195,"deletions":0},{"file":"test/alarms/tst.alarms.js","type":"ADDED","insertions":539,"deletions":0},{"file":"test/alarms/tst.amon_objects.js","type":"ADDED","insertions":678,"deletions":0},{"file":"test/alarms/tst.config.js","type":"ADDED","insertions":540,"deletions":0},{"file":"test/alarms/tst.metadata_basic.js","type":"ADDED","insertions":706,"deletions":0},{"file":"test/alarms/tst.metadata_files.js","type":"ADDED","insertions":270,"deletions":0},{"file":"test/alarms/tst.update.js","type":"ADDED","insertions":1123,"deletions":0},{"file":"test/tst.services.js","type":"MODIFIED","insertions":11,"deletions":-1},{"file":"tools/probecfgchk.js","type":"ADDED","insertions":64,"deletions":0}],"sizeInsertions":12562,"sizeDeletions":-188},{"number":"5","revision":"39116bbd6d6b75ea837079e62fc6c859df79984c","parents":["48d0d723bb516d9b793a0cd3c52341b2f5868316"],"ref":"refs/changes/49/1749/5","uploader":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"createdOn":1494442305,"author":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1494442349,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":12,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":14,"deletions":-1},{"file":"alarm_metadata/probe_templates/authcache.yaml","type":"ADDED","insertions":181,"deletions":0},{"file":"alarm_metadata/probe_templates/common.yaml","type":"ADDED","insertions":182,"deletions":0},{"file":"alarm_metadata/probe_templates/electric-moray.yaml","type":"ADDED","insertions":43,"deletions":0},{"file":"alarm_metadata/probe_templates/jobsupervisor.yaml","type":"ADDED","insertions":59,"deletions":0},{"file":"alarm_metadata/probe_templates/loadbalancer.yaml","type":"ADDED","insertions":148,"deletions":0},{"file":"alarm_metadata/probe_templates/moray.yaml","type":"ADDED","insertions":44,"deletions":0},{"file":"alarm_metadata/probe_templates/nameservice.yaml","type":"ADDED","insertions":129,"deletions":0},{"file":"alarm_metadata/probe_templates/ops.yaml","type":"ADDED","insertions":503,"deletions":0},{"file":"alarm_metadata/probe_templates/postgres.yaml","type":"ADDED","insertions":228,"deletions":0},{"file":"alarm_metadata/probe_templates/storage.yaml","type":"ADDED","insertions":137,"deletions":0},{"file":"alarm_metadata/probe_templates/storage_gzs.yaml","type":"ADDED","insertions":131,"deletions":0},{"file":"alarm_metadata/probe_templates/webapi.yaml","type":"ADDED","insertions":42,"deletions":0},{"file":"cmd/manta-adm.js","type":"MODIFIED","insertions":901,"deletions":-81},{"file":"docs/man/man1/manta-adm.md","type":"MODIFIED","insertions":185,"deletions":-13},{"file":"lib/adm.js","type":"MODIFIED","insertions":1347,"deletions":-40},{"file":"lib/alarms/alarms.js","type":"ADDED","insertions":375,"deletions":0},{"file":"lib/alarms/amon_objects.js","type":"ADDED","insertions":406,"deletions":0},{"file":"lib/alarms/config.js","type":"ADDED","insertions":544,"deletions":0},{"file":"lib/alarms/index.js","type":"ADDED","insertions":240,"deletions":0},{"file":"lib/alarms/metadata.js","type":"ADDED","insertions":951,"deletions":0},{"file":"lib/alarms/update.js","type":"ADDED","insertions":1339,"deletions":0},{"file":"lib/common.js","type":"MODIFIED","insertions":20,"deletions":-19},{"file":"lib/instance_info.js","type":"ADDED","insertions":64,"deletions":0},{"file":"lib/services.js","type":"MODIFIED","insertions":28,"deletions":-17},{"file":"man/man1/manta-adm.1","type":"MODIFIED","insertions":196,"deletions":-13},{"file":"package.json","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"test/alarms/mock_amon.js","type":"ADDED","insertions":195,"deletions":0},{"file":"test/alarms/tst.alarms.js","type":"ADDED","insertions":539,"deletions":0},{"file":"test/alarms/tst.amon_objects.js","type":"ADDED","insertions":678,"deletions":0},{"file":"test/alarms/tst.config.js","type":"ADDED","insertions":540,"deletions":0},{"file":"test/alarms/tst.metadata_basic.js","type":"ADDED","insertions":706,"deletions":0},{"file":"test/alarms/tst.metadata_files.js","type":"ADDED","insertions":270,"deletions":0},{"file":"test/alarms/tst.update.js","type":"ADDED","insertions":1123,"deletions":0},{"file":"test/tst.services.js","type":"MODIFIED","insertions":11,"deletions":-1},{"file":"tools/probecfgchk.js","type":"ADDED","insertions":64,"deletions":0}],"sizeInsertions":12569,"sizeDeletions":-187},{"number":"6","revision":"c0b320161e2ca763eda830ca1a4c9845e6a637cf","parents":["48d0d723bb516d9b793a0cd3c52341b2f5868316"],"ref":"refs/changes/49/1749/6","uploader":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"createdOn":1494461584,"author":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1494461628,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"alarm_metadata/probe_templates/authcache.yaml","line":52,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Is it worth including the SMF service to look at here or other information like you do in the mahi v1 behind below?"},{"file":"alarm_metadata/probe_templates/authcache.yaml","line":52,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"For the log probes, the user will generally see the log message that generated the fault when they see this knowledge article.  I\u0027ve added some example output to the ticket that shows this.\n\nBy contrast, with the mahi v1 replicator probe, we\u0027re reporting a particular command failure that indicates a problem, so you wouldn\u0027t necessarily know which log file to look at for more information."},{"file":"alarm_metadata/probe_templates/authcache.yaml","line":52,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"OK. Thanks for clarifying this. I guess it makes sense in the broader alarm details. Though maybe in some future world we can figure out how to integrate some of that context here or know how to point to a rotated log, etc."},{"file":"alarm_metadata/probe_templates/authcache.yaml","line":79,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Is it worth including the SMF service to look at here or other information like you do in the mahi v1 behind below?"},{"file":"alarm_metadata/probe_templates/authcache.yaml","line":79,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"See above."},{"file":"alarm_metadata/probe_templates/authcache.yaml","line":89,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Do the trailing spaces here matter at all?"},{"file":"alarm_metadata/probe_templates/authcache.yaml","line":89,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"No, but I\u0027ve removed them from all of these files."},{"file":"alarm_metadata/probe_templates/common.yaml","line":33,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"When are the \" characters required in the legacyName field. Take this one and the one at +58 as an example."},{"file":"alarm_metadata/probe_templates/common.yaml","line":33,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"YAML requires quotes for strings containing various characters (including \"%\" and \":\").  I\u0027ve generally omitted them for this field except when necessary, though that\u0027s more an artifact of the tool I built to automatically generate the initial versions of these files from the original \"mantamon\" data than any principled decision."},{"file":"alarm_metadata/probe_templates/common.yaml","line":107,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Should we point folks on how to find the log message?"},{"file":"alarm_metadata/probe_templates/common.yaml","line":107,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Let me know if the sample output that I mentioned makes this clear enough.  Users should have the log message in front of them in the contexts where they\u0027re seeing this."},{"file":"alarm_metadata/probe_templates/common.yaml","line":180,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Where do those come from? Are those from the output of svcs -xv or in the Manta operator\u0027s guide?"},{"file":"alarm_metadata/probe_templates/common.yaml","line":180,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I\u0027m talking about the \"svcs -xv\" output.  That is to be read: \"use \u0027svcs -xv\u0027 to identify the services in maintenance and [to] see basic instructions for tracking down the problem.\"  I\u0027ve added this clarification."},{"file":"alarm_metadata/probe_templates/common.yaml","line":180,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I think that helps a lot, thanks."},{"file":"alarm_metadata/probe_templates/electric-moray.yaml","line":42,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Should we point people on how to do this like we have in other cases?"},{"file":"alarm_metadata/probe_templates/electric-moray.yaml","line":42,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Same as elsewhere."},{"file":"alarm_metadata/probe_templates/loadbalancer.yaml","line":45,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I feel like this action, more than others so far leaves me with no real hope of knowing what to go do. While, I personally may know what some next steps are, I\u0027m not sure that this is actionable for someone else right now."},{"file":"alarm_metadata/probe_templates/loadbalancer.yaml","line":45,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Yeah, this one kind of sucks.  I\u0027m updating it in the next patchset.\n\nThis reflects a deeper problem.  Knowledge articles were historically used for end users who had no knowledge of the system\u0027s internals.  And this content certainly will be seen by on-prem operators who aren\u0027t very familiar with Manta internals, and this message is likely hopeless for them.  (I certainly hope that the rest of the KA content, aside from the suggested action, *is* very clear to this group of operators.  It should not require knowledge of internals to understand the severity, impact, and automated response.)\n\nThis is a problem for most of the knowledge articles here, and it\u0027s really a problem with the probes themselves.  For the most part, the probes don\u0027t detect conditions that are really correctable by those operators.  I\u0027d like to address that, but it\u0027s a much longer-term project.\n\nI think there\u0027s still a lot of value in KAs intended for an audience of people who are familiar with the system\u0027s internals (i.e., our ops and engineering teams), but who can\u0027t quickly tell from the bash script what problem a probe is intended to identify.  To balance the goals of talking to these two audiences, I\u0027ve generally tried to provide text that gives experienced readers a nudge in the right direction without sounding like nonsense to an operator completely unfamiliar with the internals.  (Like I said, this one sucks as-is, and I\u0027m fixing that in the next patchset.  I actually spent a while during development considering whether to remove it altogether, but I decided that it represents an important operational failure mode so I tried to represent what I thought the original author wanted for this check.)\n\nThe fact that the other fields *are* intended for all operators probably makes this feel even more confusing.  If you\u0027ve got ideas for better ways to balance these goals, let me know."},{"file":"alarm_metadata/probe_templates/loadbalancer.yaml","line":146,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Same with this."},{"file":"alarm_metadata/probe_templates/loadbalancer.yaml","line":146,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Can this link to something in the operator\u0027s guide describing how to do so?"},{"file":"alarm_metadata/probe_templates/loadbalancer.yaml","line":146,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"This is a perfect example of the challenge I mentioned above.  I agree that it\u0027s hopeless for, say, on-prem operators.  But I think it\u0027s very helpful for our own ops and engineering teams, especially for new team members.  I\u0027m not sure how to balance those.  The right place to link to is probably https://github.com/joyent/registrar#debugging-notes.  I don\u0027t really want to point on-prem operators to such arcane internals, but I hoped this was enough of a nudge for internal people.  I\u0027m not sure what better to put here."},{"file":"alarm_metadata/probe_templates/loadbalancer.yaml","line":148,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"ditto"},{"file":"cmd/manta-adm.js","line":154,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Do you mind explaining this change a bit more? I assume that the rationale is that the restifyClientts are providing more serializers than the standard Bunyan ones and we need those as part of the new alarm logic which is leveraging the restify-clients to talk to AMON?"},{"file":"cmd/manta-adm.js","line":154,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Right.  Specifically, we\u0027re picking up the restify \"client_req\" serializer.  It\u0027s probably surprising that we\u0027d be logging any additional types of objects with this change, since we already make heavy use of HTTP clients.  And that\u0027s right: this was arguably broken already, but it was not observable because manta-adm did not support configuring the log level, and the messages affected by this are only logged at lower levels.\n\n(Without the custom serializer provided by restify, bunyan encodes the client request objects as JSON, resulting in enormous, mostly useless output, including a bunch of \"[circular]\" fields.  The \"client_req\" serializer explicitly pulls out just a few fields from the client request that are useful.)"},{"file":"cmd/manta-adm.js","line":973,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"So, how does nerrors end up getting updated here? Is cmdutil.warn or self.maa_parent.madm_adm.alarmPrint somehow bumping nerrors?"},{"file":"cmd/manta-adm.js","line":973,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Nice catch -- it wasn\u0027t.  That was a bug.\n\nIn the new patchset, I\u0027ve verified the exit status in cases where there was a warning and where there wasn\u0027t."},{"file":"cmd/manta-adm.js","line":1067,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Should these aliases be documented?"},{"file":"cmd/manta-adm.js","line":1067,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I explicitly did not want to.  I prefer to have one canonical option that\u0027s documented, printed in the usage output, intended for programmatic use, etc, without it also being an unnecessary punch in the face if you used another obvious boolean value.  Maybe that\u0027s a dubious goal, though?  I could remove the other options."},{"file":"cmd/manta-adm.js","line":1067,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I think it\u0027s alright to try to keep the contract rigid and end up here. I think there\u0027s a spectrum here. Ultimately as the person writing it, when it\u0027s explicitly clear, that\u0027s good. Though I know that it may step too far, see for example, the classic feelings on \u0027isntall\u0027."},{"file":"cmd/manta-adm.js","line":1067,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Future tab completion could potentially help with the punch in the face. That\u0027s a light argument for having a strict smaller set of supported values."},{"file":"cmd/manta-adm.js","line":1067,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"True.  I don\u0027t have a strong preference about it."},{"file":"cmd/manta-adm.js","line":1451,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"How does nerrors ever get updated in this case?"},{"file":"cmd/manta-adm.js","line":1451,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Same bug, same fix, same test.  Thanks for catching it."},{"file":"docs/man/man1/manta-adm.md","line":133,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Can we list which ones these are?"},{"file":"docs/man/man1/manta-adm.md","line":133,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Maybe this isn\u0027t clear enough from the text, but this paragraph (along with the ones before it about the other common options) is intended to explain common options in general terms (without reference to the specific commands that use them).  This isn\u0027t a substitute for documenting these options later, in the section for each command that supports them -- it\u0027s just a common place to explain what they mean in whatever context they appear.  So the \"-n\" and \"-y\" options are mentioned again later with each command that supports them (namely \"manta-adm alarm config update\", \"manta-adm zk fixup\", and \"manta-adm update\").  Given all that, I think it\u0027s cleaner to leave out the list of commands here.\n\nI realized while checking on this that I did not update the \"manta-adm update\" section the way I did for the other two commands, so I\u0027ve done that in the latest patchset."},{"file":"docs/man/man1/manta-adm.md","line":133,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"OK, that makes sense."},{"file":"lib/alarms/alarms.js","line":246,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Is here a reason we don\u0027t need to use encodeURIComponent on action?"},{"file":"lib/alarms/alarms.js","line":246,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Just that we set it at line 244 to a string that we know has no characters that need to be encoded (similar to the \"/pub/\", \"alarms\", and \"action\" (the literal string, not the variable) in the URL)."},{"file":"lib/alarms/amon_objects.js","line":106,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"What\u0027s the scope of this subsystem? The lib/alarms/* code?"},{"file":"lib/alarms/amon_objects.js","line":106,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Yes, \"this subsystem\" refers to the \"lib/alarms\" code."},{"file":"lib/alarms/amon_objects.js","line":126,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Would you mind describing why you use hasOwnProperty in some cases to determine whether or not a value should be used and not in others?"},{"file":"lib/alarms/amon_objects.js","line":126,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"This is a good question.  Generally, I\u0027d say our code (and JavaScript code in general) is not that consistent about this, but I do try to be somewhat precise about it.  There are a few common ways of deciding whether a parameter is present:\n\n(1) You can check if the property is specified at all using something like hasOwnProperty().  (jsprim.hasKey() is better, but this code base already uses hasOwnProperty() extensively, and I opted for consistency.)  I consider this pretty precise: it allows the caller to specify any value (including \"undefined\") and get exactly what they specified, while still supporting a default value if they didn\u0027t specify anything.\n(2) You can check against \"undefined\".  This is pretty similar to (1), except that it ignores the distinction between \"undefined\" and \"not specified\".  It feels a little sloppier.  On the other hand, we already have the distinction between \"null\" and \"undefined\", so we don\u0027t necessarily need another one.  Plus, the result of accessing missing properties is the \"undefined\" value anyway, and it could be surprising to callers that specifying \"undefined\" would be different than not specifying the property.\n(3) You can check falseyness.  I generally hate this because it\u0027s very imprecise and it\u0027s wrong for numeric values that can accept 0 and string values that can accept the empty string.  On the other hand, it\u0027s much more concise, and it\u0027s correct for values that don\u0027t accept these cases (or where you\u0027ve asserted that they\u0027re not those edge cases already).\n(4) You can check that \"typeof\" reports the value you expect for a property that\u0027s present.  This is often used when an interface allows either \"null\" or \"undefined\" to indicate that the property is missing.  Combined with an assert-plus optionalX assertion (e.g., optionalString), this is a good way to tell that the property was present, though it\u0027s less obvious what\u0027s going on and why it\u0027s both precise and correct.\n\nI\u0027m sure there are others.\n\nI usually like option (1) for its precision.  I\u0027ve used (1) at line 126 and line 127 because those values could legitimately be the empty string, and I want to preserve that rather than providing \"null\".  In other cases below I went with option (3) because falsey values of these types are equivalent to the default values.  For example, we\u0027ve already asserted at line 122 that \"contacts\" is an array or it\u0027s not specified (where \"null\" and \"undefined\" can both mean \"not specified\").  Every array is a true value.  So if we have a falsey value, it was not specified, and we can provide our default.\n\nIt would be a good idea to write this down in a style guide, though it would also be ripe for bikeshedding, and I think regardless of what we pick, a lot of our code would be inconsistent with it.  But it would likely be a step in the right direction."},{"file":"lib/alarms/amon_objects.js","line":213,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Should we be enforcing an exact length rather than just a maxLength? I\u0027m not sure if we can or can\u0027t."},{"file":"lib/alarms/amon_objects.js","line":213,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I initially had a minLength of 36, but it made automated testing a lot more tedious (because it\u0027s much more convenient in the tests to use semantically meaningful strings as uuids), and I didn\u0027t think it was really adding any value."},{"file":"lib/alarms/amon_objects.js","line":226,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Missing space."},{"file":"lib/alarms/amon_objects.js","line":226,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Done"},{"file":"lib/alarms/amon_objects.js","line":312,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Is there a reason this isn\u0027t schemaTypeUuidOptional? The comment in the AmonProbe class made it clear why it\u0027s not required, but I wasn\u0027t sure what part makes it not want to be a uuid when present, unlink the case in the probe group definition below."},{"file":"lib/alarms/amon_objects.js","line":312,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I went to change this to schemaTypeUuidOptional and found that the test suite implicitly depended on longer uuids than are typically allowed.  I went to fix that and realized that actually, the implementation could in some cases depend on that as well.  I\u0027ve updated the comment to explain why I\u0027ve left it as-is.  It\u0027s a little warty, but I don\u0027t think it\u0027s worth the non-trivial changes required to remove that dependency.  (If we wanted to clean this up, I\u0027d rather just not validate the length of uuids, since that\u0027s not actually important.  We\u0027ve already JSON-parsed this, so if it was enormous for some reason, we\u0027re already hosed.  And there\u0027s plenty of other semantics we don\u0027t bother validating, like the format of any of the uuids.)"},{"file":"lib/alarms/amon_objects.js","line":312,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Thanks for adding the comment, that helps when trying to understand these kinds of decisions."},{"file":"lib/alarms/config.js","line":357,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Just to confirm, I assume you did want an explicitly locale-aware comparison."},{"file":"lib/alarms/config.js","line":357,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I don\u0027t think I actually care, but this is a convenient way to obtain an integer similar to strcmp().  Given that these are all ASCII strings, and as far as I know it\u0027s not supported to change the locale inside our zones, I\u0027m not sure if there\u0027s a case where this could do something different (and if it did, all it could do is sort the service names differently -- probably correctly -- for human output)."},{"file":"lib/alarms/index.js","line":60,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I think it might be useful to list all the classes that you\u0027re supporting here and what they mean. I think from our conversations it\u0027s mostly just \u0027upset\u0027, but I\u0027m not certain."},{"file":"lib/alarms/index.js","line":60,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I\u0027m assuming you\u0027re referring to just the top-level classes?  The code currently assumes a prefix of \"upset.manta.\", but that\u0027s just for hygiene.  Nothing in this subsystem should assume that.  The actual set of events is determined by the metadata.\n\nI\u0027ve expanded the comment to explain this, though I\u0027m torn about keeping it here vs. moving it to the schema documentation in lib/alarms/metadata.js.  I worry that this section is already very dense with new concepts for most readers, and this isn\u0027t relevant for most of them.  It\u0027s not part of the subsystem\u0027s design so much as a choice about the current validation.  On the other hand, we\u0027re already talking about the namespace here, so I\u0027ve just left it here."},{"file":"lib/alarms/index.js","line":60,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I think it\u0027s fine to have it there for now, though I admit that I\u0027m someone who knows more about this than others."},{"file":"lib/alarms/metadata.js","line":8,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Small nit, different new files have different copyright formats."},{"file":"lib/alarms/metadata.js","line":8,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Thank you!  I\u0027ve fixed this and checked all the JS files with:\n\n    $ grep -h Copyright $( git diff --name-only master | grep \u0027.js$\u0027 ) | sort | uniq -c\n         20  * Copyright (c) 2017, Joyent, Inc."},{"file":"lib/alarms/metadata.js","line":300,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"dta-\u003edata"},{"file":"lib/alarms/metadata.js","line":300,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Done"},{"file":"lib/alarms/metadata.js","line":811,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I assume that it doesn\u0027t make sense to change the schema\u0027s length for this to be \u0027upset.manta.\u0027 even though we\u0027re enforcing that things be titled \u0027upset.manta.\u0027."},{"file":"lib/alarms/metadata.js","line":811,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I\u0027ve updated the schema."},{"file":"lib/alarms/update.js","line":970,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Should we be including a \u0027-\u0027 character to indicate cases where counts are being removed? This also extends to a few other places which do the delta logic here."},{"file":"lib/alarms/update.js","line":970,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"If they\u0027re being removed, \"delta\" is negative, so it gets printed out with the \"-\" prefix.  It may be lost in all the output, but there is some sample output in the ticket (search for \"DELTA\")."},{"file":"lib/alarms/update.js","line":970,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Oh, of course. Because the number is negative, the act of turning it into the string has it. Sigh."},{"file":"package.json","line":20,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"While maybe this shouldn\u0027t be done now, there were a few follow up patch releases that we may want to consider."},{"file":"package.json","line":20,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Okay.  I looked at the change log, and they didn\u0027t look especially compelling."},{"file":"package.json","line":27,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Mixed tabs and spaces."},{"file":"package.json","line":27,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Thanks! Fixing."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":12,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":14,"deletions":-1},{"file":"alarm_metadata/probe_templates/authcache.yaml","type":"ADDED","insertions":181,"deletions":0},{"file":"alarm_metadata/probe_templates/common.yaml","type":"ADDED","insertions":182,"deletions":0},{"file":"alarm_metadata/probe_templates/electric-moray.yaml","type":"ADDED","insertions":43,"deletions":0},{"file":"alarm_metadata/probe_templates/jobsupervisor.yaml","type":"ADDED","insertions":59,"deletions":0},{"file":"alarm_metadata/probe_templates/loadbalancer.yaml","type":"ADDED","insertions":148,"deletions":0},{"file":"alarm_metadata/probe_templates/moray.yaml","type":"ADDED","insertions":44,"deletions":0},{"file":"alarm_metadata/probe_templates/nameservice.yaml","type":"ADDED","insertions":129,"deletions":0},{"file":"alarm_metadata/probe_templates/ops.yaml","type":"ADDED","insertions":503,"deletions":0},{"file":"alarm_metadata/probe_templates/postgres.yaml","type":"ADDED","insertions":228,"deletions":0},{"file":"alarm_metadata/probe_templates/storage.yaml","type":"ADDED","insertions":137,"deletions":0},{"file":"alarm_metadata/probe_templates/storage_gzs.yaml","type":"ADDED","insertions":131,"deletions":0},{"file":"alarm_metadata/probe_templates/webapi.yaml","type":"ADDED","insertions":42,"deletions":0},{"file":"boot/setup.sh","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"cmd/manta-adm.js","type":"MODIFIED","insertions":924,"deletions":-81},{"file":"docs/man/man1/manta-adm.md","type":"MODIFIED","insertions":185,"deletions":-13},{"file":"lib/adm.js","type":"MODIFIED","insertions":1407,"deletions":-40},{"file":"lib/alarms/alarms.js","type":"ADDED","insertions":385,"deletions":0},{"file":"lib/alarms/amon_objects.js","type":"ADDED","insertions":407,"deletions":0},{"file":"lib/alarms/config.js","type":"ADDED","insertions":544,"deletions":0},{"file":"lib/alarms/index.js","type":"ADDED","insertions":240,"deletions":0},{"file":"lib/alarms/metadata.js","type":"ADDED","insertions":951,"deletions":0},{"file":"lib/alarms/update.js","type":"ADDED","insertions":1338,"deletions":0},{"file":"lib/common.js","type":"MODIFIED","insertions":17,"deletions":-18},{"file":"lib/instance_info.js","type":"ADDED","insertions":64,"deletions":0},{"file":"lib/services.js","type":"MODIFIED","insertions":28,"deletions":-17},{"file":"man/man1/manta-adm.1","type":"MODIFIED","insertions":199,"deletions":-13},{"file":"package.json","type":"MODIFIED","insertions":6,"deletions":-3},{"file":"test/alarms/mock_amon.js","type":"ADDED","insertions":195,"deletions":0},{"file":"test/alarms/tst.alarms.js","type":"ADDED","insertions":539,"deletions":0},{"file":"test/alarms/tst.amon_objects.js","type":"ADDED","insertions":678,"deletions":0},{"file":"test/alarms/tst.config.js","type":"ADDED","insertions":540,"deletions":0},{"file":"test/alarms/tst.metadata_basic.js","type":"ADDED","insertions":706,"deletions":0},{"file":"test/alarms/tst.metadata_files.js","type":"ADDED","insertions":270,"deletions":0},{"file":"test/alarms/tst.update.js","type":"ADDED","insertions":1123,"deletions":0},{"file":"test/tst.services.js","type":"MODIFIED","insertions":11,"deletions":-1},{"file":"tools/probecfgchk.js","type":"ADDED","insertions":63,"deletions":0}],"sizeInsertions":12661,"sizeDeletions":-188},{"number":"7","revision":"86c075ae5252830db215f2e9acfe7b200f019a00","parents":["48d0d723bb516d9b793a0cd3c52341b2f5868316"],"ref":"refs/changes/49/1749/7","uploader":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"createdOn":1494618663,"author":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1494870629,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1494618733,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1495054902,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"comments":[{"file":"Makefile","line":104,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"I think this redefines the eng.git Makefile\u0027s `prepush` away from `prepush: check test`. Should it perhaps be `prepush: check check-probe-files test`?"},{"file":"Makefile","line":104,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"It actually just adds `check-probe-files` as a dependency, without modifying the existing dependencies:\n\n    $ make -n prepush \n    deps/javascriptlint/build/install/jsl --nologo --nosummary --conf\u003dtools/jsl.node.conf cmd/manta-init.js cmd/manta-oneach.js cmd/manta-adm.js cmd/manta-deploy.js cmd/manta-marlin.js cmd/manta-undeploy.js cmd/manta-shardadm.js cmd/manta-merge-config.js cmd/manta-replace-cert.js cmd/manta-factoryreset.js lib/sdc.js lib/services.js lib/instance_info.js lib/ssl.js lib/adm.js lib/deploy.js lib/ssh.js lib/common.js lib/layout.js lib/oneach/cli.js lib/oneach/oneach.js lib/alarms/amon_objects.js lib/alarms/alarms.js lib/alarms/update.js lib/alarms/metadata.js lib/alarms/index.js lib/alarms/config.js test/tst.oneach_cli.js test/tst.oneach_formatters.js test/tst.zk.js test/tst.services.js test/tst.stripe.js test/alarms/tst.alarms.js test/alarms/mock_amon.js test/alarms/tst.metadata_basic.js test/alarms/tst.amon_objects.js test/alarms/tst.update.js test/alarms/tst.metadata_files.js test/alarms/tst.config.js test/tst.oneach_cmd.js test/tst.oneach_exec.js test/tst.adm.js test/common.js test/tst.adm_show.js test/tst.layout.js test/CollectorStream.js networking/validate.js\n    json --validate -f package.json\n    json --validate -f config/services/marlin-dashboard/service.json\n    json --validate -f config/services/marlin-dashboard/service.json.production\n    json --validate -f config/services/jobsupervisor/service.json.production\n    json --validate -f config/services/jobsupervisor/service.json\n    json --validate -f config/services/moray/service.json\n    json --validate -f config/services/moray/service.json.lab\n    json --validate -f config/services/moray/service.json.production\n    json --validate -f config/services/marlin/service.json\n    json --validate -f config/services/marlin/service.json.production\n    json --validate -f config/services/authcache/service.json.production\n    json --validate -f config/services/authcache/service.json\n    json --validate -f config/services/medusa/service.json\n    json --validate -f config/services/medusa/service.json.production\n    json --validate -f config/services/nameservice/service.json.production\n    json --validate -f config/services/nameservice/service.json\n    json --validate -f config/services/propeller/service.json.production\n    json --validate -f config/services/propeller/service.json\n    json --validate -f config/services/storage/service.json.lab\n    json --validate -f config/services/storage/service.json\n    json --validate -f config/services/storage/service.json.production\n    json --validate -f config/services/ops/service.json\n    json --validate -f config/services/ops/service.json.production\n    json --validate -f config/services/ops/service.json.coal\n    json --validate -f config/services/jobpuller/service.json\n    json --validate -f config/services/jobpuller/service.json.production\n    json --validate -f config/services/postgres/service.json.production\n    json --validate -f config/services/postgres/service.json.lab\n    json --validate -f config/services/postgres/service.json\n    json --validate -f config/services/loadbalancer/service.json\n    json --validate -f config/services/loadbalancer/service.json.production\n    json --validate -f config/services/webapi/service.json.production\n    json --validate -f config/services/webapi/service.json.coal\n    json --validate -f config/services/webapi/service.json\n    json --validate -f config/services/webapi/service.json.lab\n    json --validate -f config/services/madtom/service.json.coal\n    json --validate -f config/services/madtom/service.json\n    json --validate -f config/services/madtom/service.json.production\n    json --validate -f config/services/electric-moray/service.json.production\n    json --validate -f config/services/electric-moray/service.json.lab\n    json --validate -f config/services/electric-moray/service.json\n    json --validate -f config/application.json\n    json --validate -f manifests/applications/manta/common/manifest.json\n    json --validate -f manifests/applications/manta/dns_client/manifest.json\n    json --validate -f manifests/applications/manta/ssh_private_key/manifest.json\n    json --validate -f manifests/applications/manta/registrar/manifest.json\n    json --validate -f manifests/applications/manta/ssh_public_key/manifest.json\n    json --validate -f sapi_manifests/manta/manifest.json\n    deps/jsstyle/jsstyle -o doxygen cmd/manta-init.js cmd/manta-oneach.js cmd/manta-adm.js cmd/manta-deploy.js cmd/manta-marlin.js cmd/manta-undeploy.js cmd/manta-shardadm.js cmd/manta-merge-config.js cmd/manta-replace-cert.js cmd/manta-factoryreset.js lib/sdc.js lib/services.js lib/instance_info.js lib/ssl.js lib/adm.js lib/deploy.js lib/ssh.js lib/common.js lib/layout.js lib/oneach/cli.js lib/oneach/oneach.js lib/alarms/amon_objects.js lib/alarms/alarms.js lib/alarms/update.js lib/alarms/metadata.js lib/alarms/index.js lib/alarms/config.js test/tst.oneach_cli.js test/tst.oneach_formatters.js test/tst.zk.js test/tst.services.js test/tst.stripe.js test/alarms/tst.alarms.js test/alarms/mock_amon.js test/alarms/tst.metadata_basic.js test/alarms/tst.amon_objects.js test/alarms/tst.update.js test/alarms/tst.metadata_files.js test/alarms/tst.config.js test/tst.oneach_cmd.js test/tst.oneach_exec.js test/tst.adm.js test/common.js test/tst.adm_show.js test/tst.layout.js test/CollectorStream.js networking/validate.js\n    bash -n scripts/user-script.sh\n    bash -n tools/add-dev-user\n    bash -n bin/manta-deploy-lab\n    bash -n networking/manta-net.sh\n    /home/dap/sdc-manta-amon/build/node/bin/node tools/bashstyle scripts/user-script.sh\n    /home/dap/sdc-manta-amon/build/node/bin/node tools/bashstyle tools/add-dev-user\n    /home/dap/sdc-manta-amon/build/node/bin/node tools/bashstyle bin/manta-deploy-lab\n    /home/dap/sdc-manta-amon/build/node/bin/node tools/bashstyle networking/manta-net.sh\n    echo check ok\n    PATH\u003d\"/home/dap/sdc-manta-amon/build/node/bin:$PATH\" deps/catest/catest -a\n    node ./tools/probecfgchk.js alarm_metadata/probe_templates/postgres.yaml alarm_metadata/probe_templates/storage.yaml alarm_metadata/probe_templates/jobsupervisor.yaml alarm_metadata/probe_templates/authcache.yaml alarm_metadata/probe_templates/nameservice.yaml alarm_metadata/probe_templates/ops.yaml alarm_metadata/probe_templates/loadbalancer.yaml alarm_metadata/probe_templates/common.yaml alarm_metadata/probe_templates/storage_gzs.yaml alarm_metadata/probe_templates/electric-moray.yaml alarm_metadata/probe_templates/webapi.yaml alarm_metadata/probe_templates/moray.yaml"},{"file":"Makefile","line":104,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Okay, thanks. I obviously don\u0027t know Makefile syntax super well."},{"file":"cmd/manta-adm.js","line":86,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"We\u0027re a little inconsistent in whether help messages end in periods or not. For instance, the \"help\" subcommand for `manta-adm alarm` does, as does the dryrun option, but not others. I don\u0027t have a preference either way, but it would be nice if they were consistent."},{"file":"cmd/manta-adm.js","line":86,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"For what it\u0027s worth, it looks like node-dashdash appends a period, which is probably one reason that this went unnoticed:\n\n    https://github.com/trentm/node-dashdash/blob/d893868f6961db51d4d2c9cda761fb0e1b4d3cb4/lib/dashdash.js#L707\n\nI\u0027ve fixed the obvious ones here and verified the output, but in most cases the output did not change.  I also added periods to the subcommands whose first line of help output did not include a period."},{"file":"cmd/manta-adm.js","line":97,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Does this mean no args to the flag just goes to stdout?"},{"file":"cmd/manta-adm.js","line":97,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"No, it means that you can use the special string \"stdout\" to send output to stdout.  That\u0027s rather regrettable, but both the behavior and the help text predate this change.  It\u0027s documented in the manual page, at least."},{"file":"cmd/manta-adm.js","line":238,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Neat. This looks much cleaner with the commonized options."},{"file":"cmd/manta-adm.js","line":238,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Thanks!"},{"file":"cmd/manta-adm.js","line":324,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Is this an example of genconfig for a larger deployment?"},{"file":"cmd/manta-adm.js","line":324,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Yes."},{"file":"cmd/manta-adm.js","line":428,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Nit: Maybe we could put the options in alphabetical order? Or list all of the commonized ones first to improve readability? This applies to the other subcommands as well."},{"file":"cmd/manta-adm.js","line":428,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"That\u0027s a fair question.  I\u0027m not sure if it would be best to be alphabetical here or to put them into logical groups.  I\u0027m tempted to leave this unchanged for now.  (This change doesn\u0027t modify any of the semantics here -- it\u0027s just a refactoring of the definitions into one place.)"},{"file":"cmd/manta-adm.js","line":992,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Indent the cases?"},{"file":"cmd/manta-adm.js","line":992,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I\u0027m following cstyle here, which was the genesis of jsstyle.  (See also the switch statements in lib/common.js and lib/oneach/cli.js.)"},{"file":"cmd/manta-adm.js","line":1460,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"I think this help message should also clarify that the default is to print all knowledge articles."},{"file":"cmd/manta-adm.js","line":1460,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I\u0027ve added a synopsis line for the case where EVENT_NAME is not specified and updated the one-line summary to avoid referring to just one event.  (The manual page explains the details.)\n\nI think our pattern here has generally been to leave details to the manual page and avoid duplication here.  If you think it\u0027s worth it, I can add a more detailed block below the synopses."},{"file":"cmd/manta-adm.js","line":1460,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Okay."},{"file":"lib/adm.js","line":80,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Was the whitespace change intentional here?"},{"file":"lib/adm.js","line":80,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Yes.  This was previously 4 spaces and a tab."},{"file":"lib/adm.js","line":93,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Same here."},{"file":"lib/adm.js","line":93,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Same."},{"file":"lib/adm.js","line":629,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"If you trust the SAPI instance objects fetched in the preceding step via SAPI.getApplicationObjects, then you could use all those UUIDs and do VMAPI ListVms with the \"?uuids\u003d...\" param (https://mo.joyent.com/docs/vmapi/master/#ListVms).\n\nHowever, I don\u0027t know how well that does with 100s of UUIDs. I haven\u0027t used \"?uuids\u003d...\" much at all."},{"file":"lib/adm.js","line":629,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Thanks.  That might be much more expensive inside VMAPI, though?\n\n(All I changed here was XXX to TODO, and not for an especially good reason.)"},{"file":"lib/adm.js","line":629,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Yup fair to ignore this for this change. It is certainly already big enough. :)\n\nAbout that being more expensive in VMAPI: I\u0027m not sure. Very likely, yes."},{"file":"lib/adm.js","line":814,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Can we specify which arguments are optional in the header comment for the function, or is that documented elsewhere?"},{"file":"lib/adm.js","line":814,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Done"},{"file":"lib/alarms/alarms.js","line":54,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Do we need to assert this is a valid state here?"},{"file":"lib/alarms/alarms.js","line":54,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I prefer to let Amon validate that so that if Amon is enhanced, we\u0027ll pick that up automatically.  I could change the documentation above to remove the specific list of states and say that it has to be one of the states supported by Amon for listing alarms, if it seems inconsistent to document that but not validate it."},{"file":"lib/alarms/alarms.js","line":175,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"It seems like this parameter could be an optional value with a sane default."},{"file":"lib/alarms/alarms.js","line":175,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"This is certainly debatable, but I have generally preferred the pattern of providing defaults like this one at the top-level and then requiring these parameters to be specified everywhere else.  For one, I\u0027ve found it extremely difficult in our own code to figure out what value is being used when multiple different levels of abstraction each filled in default values.  Plus, at a low level like this, we can\u0027t know how many times this function itself may be invoked concurrently, so it\u0027s hard to say for sure what an appropriate level of concurrency is."},{"file":"lib/alarms/alarms.js","line":175,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Sounds good."},{"file":"lib/alarms/alarms.js","line":237,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Is there a ticket for this? I looked but wasn\u0027t able to find anything obvious."},{"file":"lib/alarms/alarms.js","line":237,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I\u0027ve filed MON-358."},{"file":"lib/alarms/alarms.js","line":237,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Thanks!"},{"file":"lib/alarms/alarms.js","line":324,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Is there any way the MantaAlarmSet could be finalized between its creation and here? If so, we should assert it is not."},{"file":"lib/alarms/alarms.js","line":324,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Not unless something else has gone horribly wrong.  The reference to \"rv\" does not leave this function until the final callback at line 331, and that\u0027s where we finalize it.  For this to be finalized early, we\u0027d have to have gotten here after invoking that callback.\n\nI kind of half-formalized this before, so I bit the bullet and added methods to MantaAlarmSet so that the rest of this file can stop digging into the internals."},{"file":"lib/alarms/alarms.js","line":364,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"If you place a single assertplus.arrayOfNumber for mas_alarms prior to the sort, we avoid running assertions for some numbers twice. Also, if the array was a single element, we would never assert it was a number here."},{"file":"lib/alarms/alarms.js","line":364,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"This was intended as a sanity check on the semantics that the comparator is depending on (a last defense against accidentally propagating `NaN`), not a careful validation of the internal structure of the alarms.  We don\u0027t have an array of numbers here already, so we can\u0027t use arrayOfNumber unless we create one first.  But I think that\u0027s unnecessary code and potentially just as slow for the sizes of arrays we\u0027re likely to deal with here."},{"file":"lib/alarms/index.js","line":58,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"I say this as someone who hasn\u0027t worked with neither mantamon nor FMA very much: The requirement of using \"upset\" as the top-level namespace for all Manta event names seems kind of user-unfriendly, both in that it is not obvious why the top-level namespace is called this, and why it is the required namespace for new event classes.\n\nIt seems like now would be the time to remove this requirement if it makes sense to, so I want to understand the context here. Is the sole purpose of using \"upset\" of the top-level namespace to feel familiar to users of FMA, or is there more to it than that?"},{"file":"lib/alarms/index.js","line":58,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"\u003e The requirement of using \"upset\" as the top-level namespace for all Manta event names seems kind of user-unfriendly, both in that it is not obvious why the top-level namespace is called this, and why it is the required namespace for new event classes.\n\nHere\u0027s what I\u0027m trying to communicate with the parenthetical:\n\n- The event names fit into a namespace that is defined elsewhere (specifically, in FMA).\n- The \"upset\" prefix was chosen intentionally as the best fit.  (But as I\u0027ll explain below, the reasons are kind of wishy-washy, which is why I didn\u0027t really explain them.)\n- If you want to add new events, \"upset.manta\" is very likely the right prefix for them.\n- If you want to diverge from that prefix, that\u0027s possible.  The tool should work without any changes aside from the validation.  But this isn\u0027t expected, and you need to do your own FMA research to figure out what top-level class is appropriate with respect to the namespace.\n\nI left this in parentheses because I didn\u0027t want to derail the explanation of FMA events, particularly since the conclusion of this digression is basically \"just use \u0027upset.manta\u0027\", which is probably what one would have done anyway after looking at what the other events are called.\n\nI feel like the comment is missing some important context, but I\u0027m not sure how best to fix it, so I\u0027ll just lay out all the context and then we can figure out how to fix it.\n\nFMA defines the event namespace, including the available top-level event classes and what they mean.   For example:\n\n- A \"fault\" represents a device failure.   The associated device has usually been taken out of service.\n- A \"defect\" represents an instance of a software bug.  The associated SMF service is usually in maintenance.\n- An \"ereport\" represents a discrete error from a device (e.g., a read error from a disk or DIMM).  The device may or may not be broken.  Receiving ereports can trigger diagnosis of faults, but it doesn\u0027t have to.\n- I believe \"ireports\" are used to provide an informational data point (like an ereport, but not necessarily an error).\n- \"upset\" does not seem to be widely used, but a few documents refer to it as intended for \"soft errors\".\n\nNotably: faults, defects, ereports, and ireports all represent specific, well-understood conditions.  We might receive an ereport for an ECC error on a DIMM, and then we might generate a fault and remove the DIMM from service.  The whole time, we understand exactly what happened.\n\nThat\u0027s different from the events in this repository.  These events are indications that something is wrong, often with specific information about the problem, but not specific enough to represent a known failure mode for which we can create a diagnosis.  Robert and I did some digging, and from what we could tell, \"upset\" seemed intended to cover this sort of case because \"upset\" events represent a problem, but they\u0027re somewhat vague about what it is.  At least, we felt it was better to use \"upset\" than to create another top-level class or to abandon the FMA namespace altogether.\n\nIdeally, the comment here would refer people to the FMA documentation for details about the namespace and the intended semantics of top-level classes like \"upset\".  But as far as I know, that documentation doesn\u0027t exist.  (I\u0027ve filed OS-6139 to cover that.)  I learned all the above through a combination of oral tradition, comments in various bits of documentation, and inference, and I suspect that Robert learned it the same way.  I don\u0027t really feel comfortable explaining all of it in the code without a canonical reference myself, and I don\u0027t think these definitions belong here anyway since most of them aren\u0027t relevant (even though the reason for \"upset\" is at least in part because none of the others fit very well.)\n\nBack to the comment: basically, I picked a base class (\"upset.manta\") that I think is likely appropriate for all events in the foreseeable future. I wanted to convey that you can probably ignore the namespace question altogether by just putting new events under \"upset.manta\", but if you want to, you can use another base class.  But that\u0027s not expected to be needed, and you\u0027d need to do your homework about the FMA namespace.\n\nSorry for the long explanation, but I hope it\u0027s helpful.  I\u0027ve updated the comment in a way that I hope helps, but I\u0027m not sure it\u0027s enough.  Let me know what you think.\n\n\n\nI also want to emphasize that these event names are mostly just for internal use.  Ideally, operators won\u0027t see them unless they muck around with the \"manta-adm alarm metadata\" command, and that\u0027s not really supposed to be needed for operator use cases.\n\n\u003e It seems like now would be the time to remove this requirement if it makes sense to, so I want to understand the context here.\n\nHopefully it\u0027s clearer now that part of the point is that we can always relax this requirement later.  Nothing should depend on this prefix aside from validation, and that\u0027s only there to keep people from inventing new class names without realizing that they have meanings."},{"file":"lib/alarms/index.js","line":58,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Thanks for the explanation! The clarification you added looks good. The idea that the event classes are more of an implementation detail helps -- I\u0027m used to seeing the event classes exposed in alarms sent to manta@, but if that\u0027s no longer the case, then I think this makes sense."},{"file":"lib/alarms/index.js","line":58,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"That is likely still the case, actually.  Ideally, the notifiers would make use of this metadata as well, but they\u0027re built into Amon and Amon doesn\u0027t know about any of this.  We should probably enhance Amon to include it.  I\u0027d kind of punted on that for this change, but it will likely become the biggest usability issue with this, so it would be good to come up with something."},{"file":"lib/alarms/metadata.js","line":24,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"nit: s/that/which?"},{"file":"lib/alarms/metadata.js","line":24,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"\"which\" feels awkward to me, so I clarified it differently.  Let me know how it sounds."},{"file":"lib/alarms/metadata.js","line":24,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Sure, sounds fine."},{"file":"lib/alarms/update.js","line":14,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Should this be just \"config.js\"?"},{"file":"lib/alarms/update.js","line":14,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Yes.  Nice catch."},{"file":"lib/common.js","line":87,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Why was this removed? Also, I believe removing it means the \"Logger\" import is unused, so we could remove that."},{"file":"lib/common.js","line":87,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I found that it wasn\u0027t used anywhere.  (I think it came up when I was trying to work out whether the serializers were correct in various calls to the bunyan constructor.)\n\nI removed the now-unused import.  Nice catch."},{"file":"lib/common.js","line":94,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Ouch! That\u0027s frustrating."},{"file":"lib/common.js","line":94,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Agreed!"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":12,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":14,"deletions":-1},{"file":"alarm_metadata/probe_templates/authcache.yaml","type":"ADDED","insertions":181,"deletions":0},{"file":"alarm_metadata/probe_templates/common.yaml","type":"ADDED","insertions":182,"deletions":0},{"file":"alarm_metadata/probe_templates/electric-moray.yaml","type":"ADDED","insertions":43,"deletions":0},{"file":"alarm_metadata/probe_templates/jobsupervisor.yaml","type":"ADDED","insertions":59,"deletions":0},{"file":"alarm_metadata/probe_templates/loadbalancer.yaml","type":"ADDED","insertions":152,"deletions":0},{"file":"alarm_metadata/probe_templates/moray.yaml","type":"ADDED","insertions":44,"deletions":0},{"file":"alarm_metadata/probe_templates/nameservice.yaml","type":"ADDED","insertions":129,"deletions":0},{"file":"alarm_metadata/probe_templates/ops.yaml","type":"ADDED","insertions":503,"deletions":0},{"file":"alarm_metadata/probe_templates/postgres.yaml","type":"ADDED","insertions":228,"deletions":0},{"file":"alarm_metadata/probe_templates/storage.yaml","type":"ADDED","insertions":137,"deletions":0},{"file":"alarm_metadata/probe_templates/storage_gzs.yaml","type":"ADDED","insertions":131,"deletions":0},{"file":"alarm_metadata/probe_templates/webapi.yaml","type":"ADDED","insertions":42,"deletions":0},{"file":"boot/setup.sh","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"cmd/manta-adm.js","type":"MODIFIED","insertions":926,"deletions":-81},{"file":"docs/man/man1/manta-adm.md","type":"MODIFIED","insertions":187,"deletions":-22},{"file":"lib/adm.js","type":"MODIFIED","insertions":1407,"deletions":-40},{"file":"lib/alarms/alarms.js","type":"ADDED","insertions":385,"deletions":0},{"file":"lib/alarms/amon_objects.js","type":"ADDED","insertions":411,"deletions":0},{"file":"lib/alarms/config.js","type":"ADDED","insertions":544,"deletions":0},{"file":"lib/alarms/index.js","type":"ADDED","insertions":243,"deletions":0},{"file":"lib/alarms/metadata.js","type":"ADDED","insertions":951,"deletions":0},{"file":"lib/alarms/update.js","type":"ADDED","insertions":1338,"deletions":0},{"file":"lib/common.js","type":"MODIFIED","insertions":17,"deletions":-18},{"file":"lib/instance_info.js","type":"ADDED","insertions":64,"deletions":0},{"file":"lib/services.js","type":"MODIFIED","insertions":28,"deletions":-17},{"file":"man/man1/manta-adm.1","type":"MODIFIED","insertions":201,"deletions":-22},{"file":"package.json","type":"MODIFIED","insertions":6,"deletions":-3},{"file":"test/alarms/mock_amon.js","type":"ADDED","insertions":195,"deletions":0},{"file":"test/alarms/tst.alarms.js","type":"ADDED","insertions":539,"deletions":0},{"file":"test/alarms/tst.amon_objects.js","type":"ADDED","insertions":678,"deletions":0},{"file":"test/alarms/tst.config.js","type":"ADDED","insertions":540,"deletions":0},{"file":"test/alarms/tst.metadata_basic.js","type":"ADDED","insertions":706,"deletions":0},{"file":"test/alarms/tst.metadata_files.js","type":"ADDED","insertions":270,"deletions":0},{"file":"test/alarms/tst.update.js","type":"ADDED","insertions":1123,"deletions":0},{"file":"test/tst.services.js","type":"MODIFIED","insertions":11,"deletions":-1},{"file":"tools/probecfgchk.js","type":"ADDED","insertions":63,"deletions":0}],"sizeInsertions":12678,"sizeDeletions":-206},{"number":"8","revision":"80135658a31b7fd78dd0cc206fd59ca764752e65","parents":["48d0d723bb516d9b793a0cd3c52341b2f5868316"],"ref":"refs/changes/49/1749/8","uploader":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"createdOn":1495056033,"author":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1495056088,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1495058682,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"comments":[{"file":"alarm_metadata/probe_templates/ops.yaml","line":73,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"nit: I think there are 3 spaces after that sentence."},{"file":"alarm_metadata/probe_templates/ops.yaml","line":73,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Done"},{"file":"alarm_metadata/probe_templates/ops.yaml","line":293,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"I\u0027m not sure how much content you\u0027re adding here, but it might be nice to have a more concrete description of just how many objects are required for this alarm (and other similar ones) to fire, without having to try to parse the bash command."},{"file":"alarm_metadata/probe_templates/ops.yaml","line":293,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I think this would make a useful RFE, but I\u0027d prefer to defer that to future work.  (It\u0027s not ideal as-is, but it\u0027s better than what\u0027s there today.  When you see this message, you\u0027ll also have the command output, which has the count of objects found.)"},{"file":"alarm_metadata/probe_templates/ops.yaml","line":293,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Sounds good."},{"file":"alarm_metadata/probe_templates/ops.yaml","line":469,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Similarly, it would be good if we could see which metering report wasn\u0027t found in the description. I don\u0027t think you need to fix all of this, but it seems like having more precise descriptions (perhaps by parameterizing them) would go a long way toward making these even more actionable."},{"file":"alarm_metadata/probe_templates/ops.yaml","line":469,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Agreed, but I\u0027d like to defer that as well.  Making these parametrizable adds a fair bit of complexity, and I think what we\u0027ve got is a pretty big improvement over what\u0027s there now.\n\nA much simpler change that would help identify which report it was would be to have the script emit to stderr the value of $DATE.  (An operator can work this out from the time of the fault, though that may not be obvious.)   I\u0027m trying to minimize the changes to the alarms themselves in this change so that we can separate the tooling change from the alarm content changes."},{"file":"alarm_metadata/probe_templates/ops.yaml","line":469,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Sure, sounds good. Just wanted to throw my thoughts out there while I had the chance! :)"},{"file":"alarm_metadata/probe_templates/storage.yaml","line":21,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Extra whitespace in this file."},{"file":"alarm_metadata/probe_templates/storage.yaml","line":21,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Done"},{"file":"alarm_metadata/probe_templates/webapi.yaml","line":21,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Extra whitespace here (and below)"},{"file":"alarm_metadata/probe_templates/webapi.yaml","line":21,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Done"},{"file":"boot/setup.sh","line":37,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"What was this for?"},{"file":"boot/setup.sh","line":37,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"This was previously used to ensure that \"man mantamon\" would work.  Since I\u0027m deprecating mantamon (and no longer including it as a dependency), I\u0027m removing this change to the MANPATH."},{"file":"tools/probecfgchk.js","line":0,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"How much overlap is there between the new probe template format and existing templates? I\u0027m trying to understand how the new probe templates in this repo and this check script fit into the previous world."},{"file":"tools/probecfgchk.js","line":0,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I\u0027m not sure exactly what you mean, but logically, these files serve the same purpose as the old ones did.  Both the old and the new files define:\n\n- checks that can be turned into Amon probes,\n- which set of zones each of these checks applies to, and\n- how the resulting Amon probes are grouped.\n\nIn the old files, a lot of this was implicit.  Each object in each JSON file was a check that could be turned into an Amon probe.  The set of zones for which to create that probe was defined by the filename: the checks in \"webapi.json\" created probes for \"webapi\" zones, except for the special case of \"common\".  The probes were always grouped by service.\n\nThe new format is explicit about all of those things, so its structure is somewhat different.  Each object is supposed to represent a distinct failure mode.  It has top-level properties for the list of checks, the scope (which zones it applies to), and properties that control the grouping of probes.  It doesn\u0027t matter which objects are in which files files, nor what files are called (except that they have to end in yaml).\n\nAs far as I know, the old format was neither documented nor well validated.  The JSON may have been checked for valid syntax at build time, but I don\u0027t think any of the semantics were checked.  This script validates the contents of the new files to catch syntax errors as well as basic semantic errors (e.g., duplicate event names, missing required properties, invalid combinations of options, etc.).  It can\u0027t be applied to the old files."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":12,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":14,"deletions":-1},{"file":"alarm_metadata/probe_templates/authcache.yaml","type":"ADDED","insertions":181,"deletions":0},{"file":"alarm_metadata/probe_templates/common.yaml","type":"ADDED","insertions":182,"deletions":0},{"file":"alarm_metadata/probe_templates/electric-moray.yaml","type":"ADDED","insertions":43,"deletions":0},{"file":"alarm_metadata/probe_templates/jobsupervisor.yaml","type":"ADDED","insertions":59,"deletions":0},{"file":"alarm_metadata/probe_templates/loadbalancer.yaml","type":"ADDED","insertions":152,"deletions":0},{"file":"alarm_metadata/probe_templates/moray.yaml","type":"ADDED","insertions":44,"deletions":0},{"file":"alarm_metadata/probe_templates/nameservice.yaml","type":"ADDED","insertions":129,"deletions":0},{"file":"alarm_metadata/probe_templates/ops.yaml","type":"ADDED","insertions":503,"deletions":0},{"file":"alarm_metadata/probe_templates/postgres.yaml","type":"ADDED","insertions":228,"deletions":0},{"file":"alarm_metadata/probe_templates/storage.yaml","type":"ADDED","insertions":137,"deletions":0},{"file":"alarm_metadata/probe_templates/storage_gzs.yaml","type":"ADDED","insertions":131,"deletions":0},{"file":"alarm_metadata/probe_templates/webapi.yaml","type":"ADDED","insertions":42,"deletions":0},{"file":"boot/setup.sh","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"cmd/manta-adm.js","type":"MODIFIED","insertions":926,"deletions":-81},{"file":"docs/man/man1/manta-adm.md","type":"MODIFIED","insertions":187,"deletions":-22},{"file":"lib/adm.js","type":"MODIFIED","insertions":1407,"deletions":-40},{"file":"lib/alarms/alarms.js","type":"ADDED","insertions":385,"deletions":0},{"file":"lib/alarms/amon_objects.js","type":"ADDED","insertions":411,"deletions":0},{"file":"lib/alarms/config.js","type":"ADDED","insertions":544,"deletions":0},{"file":"lib/alarms/index.js","type":"ADDED","insertions":243,"deletions":0},{"file":"lib/alarms/metadata.js","type":"ADDED","insertions":951,"deletions":0},{"file":"lib/alarms/update.js","type":"ADDED","insertions":1338,"deletions":0},{"file":"lib/common.js","type":"MODIFIED","insertions":17,"deletions":-18},{"file":"lib/instance_info.js","type":"ADDED","insertions":64,"deletions":0},{"file":"lib/services.js","type":"MODIFIED","insertions":28,"deletions":-17},{"file":"man/man1/manta-adm.1","type":"MODIFIED","insertions":201,"deletions":-22},{"file":"package.json","type":"MODIFIED","insertions":6,"deletions":-3},{"file":"test/alarms/mock_amon.js","type":"ADDED","insertions":195,"deletions":0},{"file":"test/alarms/tst.alarms.js","type":"ADDED","insertions":539,"deletions":0},{"file":"test/alarms/tst.amon_objects.js","type":"ADDED","insertions":678,"deletions":0},{"file":"test/alarms/tst.config.js","type":"ADDED","insertions":540,"deletions":0},{"file":"test/alarms/tst.metadata_basic.js","type":"ADDED","insertions":706,"deletions":0},{"file":"test/alarms/tst.metadata_files.js","type":"ADDED","insertions":270,"deletions":0},{"file":"test/alarms/tst.update.js","type":"ADDED","insertions":1123,"deletions":0},{"file":"test/tst.services.js","type":"MODIFIED","insertions":11,"deletions":-1},{"file":"tools/probecfgchk.js","type":"ADDED","insertions":63,"deletions":0}],"sizeInsertions":12678,"sizeDeletions":-206},{"number":"9","revision":"10f97c9281a6a9d667c625603c864cab0157f5d8","parents":["48d0d723bb516d9b793a0cd3c52341b2f5868316"],"ref":"refs/changes/49/1749/9","uploader":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"createdOn":1495210741,"author":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1495210793,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1495211736,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":12,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":14,"deletions":-1},{"file":"alarm_metadata/probe_templates/authcache.yaml","type":"ADDED","insertions":181,"deletions":0},{"file":"alarm_metadata/probe_templates/common.yaml","type":"ADDED","insertions":182,"deletions":0},{"file":"alarm_metadata/probe_templates/electric-moray.yaml","type":"ADDED","insertions":43,"deletions":0},{"file":"alarm_metadata/probe_templates/jobsupervisor.yaml","type":"ADDED","insertions":59,"deletions":0},{"file":"alarm_metadata/probe_templates/loadbalancer.yaml","type":"ADDED","insertions":152,"deletions":0},{"file":"alarm_metadata/probe_templates/moray.yaml","type":"ADDED","insertions":44,"deletions":0},{"file":"alarm_metadata/probe_templates/nameservice.yaml","type":"ADDED","insertions":129,"deletions":0},{"file":"alarm_metadata/probe_templates/ops.yaml","type":"ADDED","insertions":503,"deletions":0},{"file":"alarm_metadata/probe_templates/postgres.yaml","type":"ADDED","insertions":228,"deletions":0},{"file":"alarm_metadata/probe_templates/storage.yaml","type":"ADDED","insertions":137,"deletions":0},{"file":"alarm_metadata/probe_templates/storage_gzs.yaml","type":"ADDED","insertions":131,"deletions":0},{"file":"alarm_metadata/probe_templates/webapi.yaml","type":"ADDED","insertions":42,"deletions":0},{"file":"boot/setup.sh","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"cmd/manta-adm.js","type":"MODIFIED","insertions":927,"deletions":-82},{"file":"docs/man/man1/manta-adm.md","type":"MODIFIED","insertions":187,"deletions":-22},{"file":"lib/adm.js","type":"MODIFIED","insertions":1407,"deletions":-40},{"file":"lib/alarms/alarms.js","type":"ADDED","insertions":385,"deletions":0},{"file":"lib/alarms/amon_objects.js","type":"ADDED","insertions":411,"deletions":0},{"file":"lib/alarms/config.js","type":"ADDED","insertions":544,"deletions":0},{"file":"lib/alarms/index.js","type":"ADDED","insertions":243,"deletions":0},{"file":"lib/alarms/metadata.js","type":"ADDED","insertions":951,"deletions":0},{"file":"lib/alarms/update.js","type":"ADDED","insertions":1338,"deletions":0},{"file":"lib/common.js","type":"MODIFIED","insertions":17,"deletions":-18},{"file":"lib/instance_info.js","type":"ADDED","insertions":64,"deletions":0},{"file":"lib/services.js","type":"MODIFIED","insertions":28,"deletions":-17},{"file":"man/man1/manta-adm.1","type":"MODIFIED","insertions":201,"deletions":-22},{"file":"package.json","type":"MODIFIED","insertions":6,"deletions":-3},{"file":"test/alarms/mock_amon.js","type":"ADDED","insertions":195,"deletions":0},{"file":"test/alarms/tst.alarms.js","type":"ADDED","insertions":539,"deletions":0},{"file":"test/alarms/tst.amon_objects.js","type":"ADDED","insertions":678,"deletions":0},{"file":"test/alarms/tst.config.js","type":"ADDED","insertions":540,"deletions":0},{"file":"test/alarms/tst.metadata_basic.js","type":"ADDED","insertions":706,"deletions":0},{"file":"test/alarms/tst.metadata_files.js","type":"ADDED","insertions":270,"deletions":0},{"file":"test/alarms/tst.update.js","type":"ADDED","insertions":1123,"deletions":0},{"file":"test/tst.services.js","type":"MODIFIED","insertions":11,"deletions":-1},{"file":"tools/probecfgchk.js","type":"ADDED","insertions":63,"deletions":0}],"sizeInsertions":12679,"sizeDeletions":-207},{"number":"10","revision":"a0f62716b61e885b10425a50366a985313533cc9","parents":["48d0d723bb516d9b793a0cd3c52341b2f5868316"],"ref":"refs/changes/49/1749/10","uploader":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"createdOn":1495245959,"author":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1496192177,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1495246008,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1495559379,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1496250899,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1496186303,"by":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":12,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":14,"deletions":-1},{"file":"alarm_metadata/probe_templates/authcache.yaml","type":"ADDED","insertions":181,"deletions":0},{"file":"alarm_metadata/probe_templates/common.yaml","type":"ADDED","insertions":182,"deletions":0},{"file":"alarm_metadata/probe_templates/electric-moray.yaml","type":"ADDED","insertions":43,"deletions":0},{"file":"alarm_metadata/probe_templates/jobsupervisor.yaml","type":"ADDED","insertions":59,"deletions":0},{"file":"alarm_metadata/probe_templates/loadbalancer.yaml","type":"ADDED","insertions":152,"deletions":0},{"file":"alarm_metadata/probe_templates/moray.yaml","type":"ADDED","insertions":44,"deletions":0},{"file":"alarm_metadata/probe_templates/nameservice.yaml","type":"ADDED","insertions":129,"deletions":0},{"file":"alarm_metadata/probe_templates/ops.yaml","type":"ADDED","insertions":503,"deletions":0},{"file":"alarm_metadata/probe_templates/postgres.yaml","type":"ADDED","insertions":228,"deletions":0},{"file":"alarm_metadata/probe_templates/storage.yaml","type":"ADDED","insertions":137,"deletions":0},{"file":"alarm_metadata/probe_templates/storage_gzs.yaml","type":"ADDED","insertions":131,"deletions":0},{"file":"alarm_metadata/probe_templates/webapi.yaml","type":"ADDED","insertions":42,"deletions":0},{"file":"boot/setup.sh","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"cmd/manta-adm.js","type":"MODIFIED","insertions":930,"deletions":-84},{"file":"docs/man/man1/manta-adm.md","type":"MODIFIED","insertions":187,"deletions":-22},{"file":"lib/adm.js","type":"MODIFIED","insertions":1407,"deletions":-40},{"file":"lib/alarms/alarms.js","type":"ADDED","insertions":397,"deletions":0},{"file":"lib/alarms/amon_objects.js","type":"ADDED","insertions":411,"deletions":0},{"file":"lib/alarms/config.js","type":"ADDED","insertions":544,"deletions":0},{"file":"lib/alarms/index.js","type":"ADDED","insertions":245,"deletions":0},{"file":"lib/alarms/metadata.js","type":"ADDED","insertions":951,"deletions":0},{"file":"lib/alarms/update.js","type":"ADDED","insertions":1338,"deletions":0},{"file":"lib/common.js","type":"MODIFIED","insertions":17,"deletions":-20},{"file":"lib/instance_info.js","type":"ADDED","insertions":64,"deletions":0},{"file":"lib/services.js","type":"MODIFIED","insertions":28,"deletions":-17},{"file":"man/man1/manta-adm.1","type":"MODIFIED","insertions":201,"deletions":-22},{"file":"package.json","type":"MODIFIED","insertions":6,"deletions":-3},{"file":"test/alarms/mock_amon.js","type":"ADDED","insertions":195,"deletions":0},{"file":"test/alarms/tst.alarms.js","type":"ADDED","insertions":539,"deletions":0},{"file":"test/alarms/tst.amon_objects.js","type":"ADDED","insertions":678,"deletions":0},{"file":"test/alarms/tst.config.js","type":"ADDED","insertions":540,"deletions":0},{"file":"test/alarms/tst.metadata_basic.js","type":"ADDED","insertions":706,"deletions":0},{"file":"test/alarms/tst.metadata_files.js","type":"ADDED","insertions":270,"deletions":0},{"file":"test/alarms/tst.update.js","type":"ADDED","insertions":1123,"deletions":0},{"file":"test/tst.services.js","type":"MODIFIED","insertions":11,"deletions":-1},{"file":"tools/probecfgchk.js","type":"ADDED","insertions":63,"deletions":0}],"sizeInsertions":12696,"sizeDeletions":-211},{"number":"11","revision":"3c01928e6bdf5cd86c9b8a921d988fb6d2fe0311","parents":["b4abfc8d0002640430e9beabb19f9de6a9b13607"],"ref":"refs/changes/49/1749/11","uploader":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"createdOn":1496257697,"author":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1496192177,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1495246008,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1495559379,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1496250899,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1496186303,"by":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":12,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":14,"deletions":-1},{"file":"alarm_metadata/probe_templates/authcache.yaml","type":"ADDED","insertions":181,"deletions":0},{"file":"alarm_metadata/probe_templates/common.yaml","type":"ADDED","insertions":182,"deletions":0},{"file":"alarm_metadata/probe_templates/electric-moray.yaml","type":"ADDED","insertions":43,"deletions":0},{"file":"alarm_metadata/probe_templates/jobsupervisor.yaml","type":"ADDED","insertions":59,"deletions":0},{"file":"alarm_metadata/probe_templates/loadbalancer.yaml","type":"ADDED","insertions":152,"deletions":0},{"file":"alarm_metadata/probe_templates/moray.yaml","type":"ADDED","insertions":44,"deletions":0},{"file":"alarm_metadata/probe_templates/nameservice.yaml","type":"ADDED","insertions":129,"deletions":0},{"file":"alarm_metadata/probe_templates/ops.yaml","type":"ADDED","insertions":503,"deletions":0},{"file":"alarm_metadata/probe_templates/postgres.yaml","type":"ADDED","insertions":228,"deletions":0},{"file":"alarm_metadata/probe_templates/storage.yaml","type":"ADDED","insertions":137,"deletions":0},{"file":"alarm_metadata/probe_templates/storage_gzs.yaml","type":"ADDED","insertions":131,"deletions":0},{"file":"alarm_metadata/probe_templates/webapi.yaml","type":"ADDED","insertions":42,"deletions":0},{"file":"boot/setup.sh","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"cmd/manta-adm.js","type":"MODIFIED","insertions":930,"deletions":-84},{"file":"docs/man/man1/manta-adm.md","type":"MODIFIED","insertions":187,"deletions":-22},{"file":"lib/adm.js","type":"MODIFIED","insertions":1407,"deletions":-40},{"file":"lib/alarms/alarms.js","type":"ADDED","insertions":397,"deletions":0},{"file":"lib/alarms/amon_objects.js","type":"ADDED","insertions":411,"deletions":0},{"file":"lib/alarms/config.js","type":"ADDED","insertions":544,"deletions":0},{"file":"lib/alarms/index.js","type":"ADDED","insertions":245,"deletions":0},{"file":"lib/alarms/metadata.js","type":"ADDED","insertions":951,"deletions":0},{"file":"lib/alarms/update.js","type":"ADDED","insertions":1338,"deletions":0},{"file":"lib/common.js","type":"MODIFIED","insertions":17,"deletions":-20},{"file":"lib/instance_info.js","type":"ADDED","insertions":64,"deletions":0},{"file":"lib/services.js","type":"MODIFIED","insertions":28,"deletions":-17},{"file":"man/man1/manta-adm.1","type":"MODIFIED","insertions":201,"deletions":-22},{"file":"package.json","type":"MODIFIED","insertions":6,"deletions":-3},{"file":"test/alarms/mock_amon.js","type":"ADDED","insertions":195,"deletions":0},{"file":"test/alarms/tst.alarms.js","type":"ADDED","insertions":539,"deletions":0},{"file":"test/alarms/tst.amon_objects.js","type":"ADDED","insertions":678,"deletions":0},{"file":"test/alarms/tst.config.js","type":"ADDED","insertions":540,"deletions":0},{"file":"test/alarms/tst.metadata_basic.js","type":"ADDED","insertions":706,"deletions":0},{"file":"test/alarms/tst.metadata_files.js","type":"ADDED","insertions":270,"deletions":0},{"file":"test/alarms/tst.update.js","type":"ADDED","insertions":1123,"deletions":0},{"file":"test/tst.services.js","type":"MODIFIED","insertions":11,"deletions":-1},{"file":"tools/probecfgchk.js","type":"ADDED","insertions":63,"deletions":0}],"sizeInsertions":12696,"sizeDeletions":-211},{"number":"12","revision":"71d0bb28908c9f9adbc41e07e72c529805d54715","parents":["b4abfc8d0002640430e9beabb19f9de6a9b13607"],"ref":"refs/changes/49/1749/12","uploader":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"createdOn":1496258748,"author":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"SUBM","value":"1","grantedOn":1496351431,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1496192177,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1495246008,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1495559379,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1496250899,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1496186303,"by":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":16,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":14,"deletions":-1},{"file":"alarm_metadata/probe_templates/authcache.yaml","type":"ADDED","insertions":181,"deletions":0},{"file":"alarm_metadata/probe_templates/common.yaml","type":"ADDED","insertions":182,"deletions":0},{"file":"alarm_metadata/probe_templates/electric-moray.yaml","type":"ADDED","insertions":43,"deletions":0},{"file":"alarm_metadata/probe_templates/jobsupervisor.yaml","type":"ADDED","insertions":59,"deletions":0},{"file":"alarm_metadata/probe_templates/loadbalancer.yaml","type":"ADDED","insertions":152,"deletions":0},{"file":"alarm_metadata/probe_templates/moray.yaml","type":"ADDED","insertions":44,"deletions":0},{"file":"alarm_metadata/probe_templates/nameservice.yaml","type":"ADDED","insertions":129,"deletions":0},{"file":"alarm_metadata/probe_templates/ops.yaml","type":"ADDED","insertions":503,"deletions":0},{"file":"alarm_metadata/probe_templates/postgres.yaml","type":"ADDED","insertions":228,"deletions":0},{"file":"alarm_metadata/probe_templates/storage.yaml","type":"ADDED","insertions":137,"deletions":0},{"file":"alarm_metadata/probe_templates/storage_gzs.yaml","type":"ADDED","insertions":131,"deletions":0},{"file":"alarm_metadata/probe_templates/webapi.yaml","type":"ADDED","insertions":42,"deletions":0},{"file":"boot/setup.sh","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"cmd/manta-adm.js","type":"MODIFIED","insertions":930,"deletions":-84},{"file":"docs/man/man1/manta-adm.md","type":"MODIFIED","insertions":187,"deletions":-22},{"file":"lib/adm.js","type":"MODIFIED","insertions":1407,"deletions":-40},{"file":"lib/alarms/alarms.js","type":"ADDED","insertions":397,"deletions":0},{"file":"lib/alarms/amon_objects.js","type":"ADDED","insertions":411,"deletions":0},{"file":"lib/alarms/config.js","type":"ADDED","insertions":544,"deletions":0},{"file":"lib/alarms/index.js","type":"ADDED","insertions":245,"deletions":0},{"file":"lib/alarms/metadata.js","type":"ADDED","insertions":951,"deletions":0},{"file":"lib/alarms/update.js","type":"ADDED","insertions":1338,"deletions":0},{"file":"lib/common.js","type":"MODIFIED","insertions":17,"deletions":-20},{"file":"lib/instance_info.js","type":"ADDED","insertions":64,"deletions":0},{"file":"lib/services.js","type":"MODIFIED","insertions":28,"deletions":-17},{"file":"man/man1/manta-adm.1","type":"MODIFIED","insertions":201,"deletions":-22},{"file":"package.json","type":"MODIFIED","insertions":6,"deletions":-3},{"file":"test/alarms/mock_amon.js","type":"ADDED","insertions":195,"deletions":0},{"file":"test/alarms/tst.alarms.js","type":"ADDED","insertions":539,"deletions":0},{"file":"test/alarms/tst.amon_objects.js","type":"ADDED","insertions":678,"deletions":0},{"file":"test/alarms/tst.config.js","type":"ADDED","insertions":540,"deletions":0},{"file":"test/alarms/tst.metadata_basic.js","type":"ADDED","insertions":706,"deletions":0},{"file":"test/alarms/tst.metadata_files.js","type":"ADDED","insertions":270,"deletions":0},{"file":"test/alarms/tst.update.js","type":"ADDED","insertions":1123,"deletions":0},{"file":"test/tst.services.js","type":"MODIFIED","insertions":11,"deletions":-1},{"file":"tools/probecfgchk.js","type":"ADDED","insertions":63,"deletions":0}],"sizeInsertions":12696,"sizeDeletions":-211}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}]}