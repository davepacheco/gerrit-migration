{"project":"joyent/illumos-joyent","branch":"master","topic":"OS-4683","id":"I12a82dd4a058eb86f2b6b075bde38b01424f8f30","number":"3046","subject":"OS-4683 Using the allowed-ips property prevents using dynamic addresses Reviewed by: Robert Mustacchi \u003crm@joyent.com\u003e Reviewed by: Dan McDonald \u003cdanmcd@joyent.com\u003e Approved by: Dan McDonald \u003cdanmcd@joyent.com\u003e","owner":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"url":"https://cr.joyent.us/3046","commitMessage":"OS-4683 Using the allowed-ips property prevents using dynamic addresses\nReviewed by: Robert Mustacchi \u003crm@joyent.com\u003e\nReviewed by: Dan McDonald \u003cdanmcd@joyent.com\u003e\nApproved by: Dan McDonald \u003cdanmcd@joyent.com\u003e\n","createdOn":1512523820,"lastUpdated":1528483639,"open":false,"status":"MERGED","comments":[{"timestamp":1512523820,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 1."},{"timestamp":1512523877,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Topic set to OS-4683"},{"timestamp":1512527148,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 2."},{"timestamp":1512598493,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 2:\n\n(10 comments)\n\nIn general, things here look OK. But the thing that I\u0027m not sure about is how the movement of the IP interface bring up works in this context."},{"timestamp":1512673230,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 3."},{"timestamp":1512689607,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 4."},{"timestamp":1512689855,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 4:\n\n(8 comments)\n\n\u003e In general, things here look OK. But the thing that I\u0027m not sure about is how the movement of the IP interface bring up works in this context.\n\nIt\u0027s not that the movement of the IP interface comes into play, so much as I\u0027ve removed the duplicated logic in ip.c since it now all happens in ip_if.c."},{"timestamp":1512694439,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 5."},{"timestamp":1512694459,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 4:\n\n(1 comment)"},{"timestamp":1512697085,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 5: Code-Review+1\n\nStill okay by me."},{"timestamp":1512772869,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 6."},{"timestamp":1512773061,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 6: Code-Review+1\n\nSorry I missed the header mismatch."},{"timestamp":1513030808,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 6: Code-Review+1"},{"timestamp":1528418285,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 7: Patch Set 6 was rebased."},{"timestamp":1528418563,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 8."},{"timestamp":1528419426,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 8: Code-Review+1\n\nIncremental on 7..8 is good."},{"timestamp":1528466212,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 8: -Code-Review\n\n(6 comments)\n\nTwo non-blockers, two blockers.\n\nAlso, I think for a change like this you may wish to do further interface up/down testing.  It looks like you\u0027ve cleaned up some exception processing while adding this new DL capability, but I\u0027d like to make sure you\u0027ve put this on something with more than a few NICs."},{"timestamp":1528479974,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 9: Patch Set 8 was rebased"},{"timestamp":1528480397,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 10: Commit message was updated."},{"timestamp":1528482097,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 11."},{"timestamp":1528482173,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 11:\n\n(2 comments)"},{"timestamp":1528482366,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 11: Code-Review+1 Integration-Approval+1\n\nThank you."},{"timestamp":1528483522,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 12: Patch Set 11 was rebased."},{"timestamp":1528483639,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Cody Peter Mello"}],"currentPatchSet":{"number":"12","revision":"12a82dd4a058eb86f2b6b075bde38b01424f8f30","parents":["c6b0ac12851403af18c06800770e65c0314956fb"],"ref":"refs/changes/46/3046/12","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1528483522,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"NO_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1528482366,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1528482366,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"SUBM","value":"1","grantedOn":1528483639,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/lib/libdladm/common/libdladm.c","type":"MODIFIED","insertions":37,"deletions":-3},{"file":"usr/src/lib/libdladm/common/libdladm.h","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/lib/libdladm/common/libdladm_impl.h","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/lib/libdladm/common/linkprop.c","type":"MODIFIED","insertions":58,"deletions":-1},{"file":"usr/src/man/man1m/dladm.1m","type":"MODIFIED","insertions":18,"deletions":0},{"file":"usr/src/test/util-tests/tests/dladm/dynamic-methods.ksh","type":"ADDED","insertions":45,"deletions":0},{"file":"usr/src/uts/common/inet/ip.h","type":"MODIFIED","insertions":18,"deletions":-1},{"file":"usr/src/uts/common/inet/ip/ip.c","type":"MODIFIED","insertions":14,"deletions":-70},{"file":"usr/src/uts/common/inet/ip/ip_if.c","type":"MODIFIED","insertions":110,"deletions":-49},{"file":"usr/src/uts/common/io/dld/dld_proto.c","type":"MODIFIED","insertions":34,"deletions":-2},{"file":"usr/src/uts/common/io/mac/mac_protect.c","type":"MODIFIED","insertions":72,"deletions":-21},{"file":"usr/src/uts/common/sys/dld.h","type":"MODIFIED","insertions":6,"deletions":0},{"file":"usr/src/uts/common/sys/mac_client_priv.h","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/uts/common/sys/mac_flow.h","type":"MODIFIED","insertions":7,"deletions":0}],"sizeInsertions":425,"sizeDeletions":-149},"patchSets":[{"number":"1","revision":"acf28fa8ebef867f210799f3ae574ce77c525e7c","parents":["4de7131c51fa696062c5de1e4138c75e3083af92"],"ref":"refs/changes/46/3046/1","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1512523820,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"usr/src/lib/libdladm/common/libdladm.c","type":"MODIFIED","insertions":37,"deletions":-3},{"file":"usr/src/lib/libdladm/common/libdladm.h","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/lib/libdladm/common/libdladm_impl.h","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/lib/libdladm/common/linkprop.c","type":"MODIFIED","insertions":57,"deletions":-1},{"file":"usr/src/man/man1m/dladm.1m","type":"MODIFIED","insertions":17,"deletions":0},{"file":"usr/src/test/util-tests/tests/dladm/dynamic-methods.ksh","type":"ADDED","insertions":45,"deletions":0},{"file":"usr/src/uts/common/inet/ip.h","type":"MODIFIED","insertions":17,"deletions":-1},{"file":"usr/src/uts/common/inet/ip/ip.c","type":"MODIFIED","insertions":14,"deletions":-70},{"file":"usr/src/uts/common/inet/ip/ip_if.c","type":"MODIFIED","insertions":108,"deletions":-49},{"file":"usr/src/uts/common/io/dld/dld_proto.c","type":"MODIFIED","insertions":34,"deletions":-2},{"file":"usr/src/uts/common/io/mac/mac_protect.c","type":"MODIFIED","insertions":61,"deletions":-21},{"file":"usr/src/uts/common/sys/dld.h","type":"MODIFIED","insertions":6,"deletions":0},{"file":"usr/src/uts/common/sys/mac_client_priv.h","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/uts/common/sys/mac_flow.h","type":"MODIFIED","insertions":10,"deletions":0}],"sizeInsertions":412,"sizeDeletions":-149},{"number":"2","revision":"d3ecfe00d3536ed1d9503bc5a610af00c40af01d","parents":["4de7131c51fa696062c5de1e4138c75e3083af92"],"ref":"refs/changes/46/3046/2","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1512527148,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/lib/libdladm/common/libdladm.c","line":970,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Is the return here for convenience for consumers?"},{"file":"usr/src/lib/libdladm/common/libdladm.c","line":970,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"I did it to mimic the style of all the other string conversion functions in this file."},{"file":"usr/src/lib/libdladm/common/libdladm.c","line":971,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Do not assume string size for buffer, please pass it in."},{"file":"usr/src/lib/libdladm/common/libdladm.c","line":971,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Done. Unfortunately, the size doesn\u0027t get passed all the way down, and you\u0027re supposed to assume that you have an array of arrays of DLADM_STRSIZE, but I can pass that in where this function is called."},{"file":"usr/src/man/man1m/dladm.1m","line":12,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"The date needs to be updated."},{"file":"usr/src/man/man1m/dladm.1m","line":4957,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Do we use SLAAC elsewhere in this page? Should it be defined?"},{"file":"usr/src/man/man1m/dladm.1m","line":4957,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"No. I\u0027ll add a definition of the acronym above."},{"file":"usr/src/uts/common/inet/ip/ip.c","line":8444,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Can you explain why all this logic is being removed?"},{"file":"usr/src/uts/common/inet/ip/ip.c","line":8444,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"This logic was necessary to duplicate what happened after here:\n\nhttps://cr.joyent.us/#/c/3046/2/usr/src/uts/common/inet/ip/ip_if.c@14547\n\nill_dl_up() used to return EINPROGRESS there, and this code would then run in place of the ipif_up() code. With my changes, this created an issue where if you tried to set the interface to an invalid address then in some conditions you wouldn\u0027t get EPERM and would successfully set the IP.\n\nI changed the behaviour of ill_dl_up() to wait on a condition variable until binding was finished and all capabilities negotiated, before returning. ipif_up() then takes care of finishing the logic that used to be duplicated here."},{"file":"usr/src/uts/common/inet/ip/ip.c","line":8500,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Can you explain why all this logic is being removed?"},{"file":"usr/src/uts/common/inet/ip/ip.c","line":8500,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Same as above. This is duplicating what this code does and will handle after this change:\n\nhttps://cr.joyent.us/#/c/3046/2/usr/src/uts/common/inet/ip/ip_if.c@14609"},{"file":"usr/src/uts/common/inet/ip/ip.c","line":8323,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Can you explain a bit more about how your change has ended up generating this case?"},{"file":"usr/src/uts/common/inet/ip/ip_if.c","line":12763,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Can you comment on why this was moved?"},{"file":"usr/src/uts/common/inet/ip/ip_if.c","line":12763,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"I moved this to preserve the ordering of the event in relation to the actual unbind. Now that we call ill_capability_wait() below, we allow the unbind request to be processed. While there seem to be no consumers, I figured it\u0027d be good to keep the semantics that when the event is dispatched, the unbind hasn\u0027t been processed yet."},{"file":"usr/src/uts/common/io/mac/mac_protect.c","line":2592,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Should this really be conditional on !\u003d 0? Don\u0027t we always want to update the users values based on what they provided? Or have we already reset the value somewhere else that I\u0027m missing?"},{"file":"usr/src/uts/common/io/mac/mac_protect.c","line":2592,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"The problem here is that when you do dladm set-linkprop, it passes in a zero\u0027d out structure, with the fields that need to change set to something else. So when mp_dynamic is 0, then that means that we shouldn\u0027t change the in-kernel value."},{"file":"usr/src/uts/common/sys/mac_flow.h","line":165,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Maybe we should make this a function rather than a macro?"},{"file":"usr/src/uts/common/sys/mac_flow.h","line":165,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"I\u0027ll go ahead and make that change in the next patchset. I also just realized, looking over this again, that checking mp_ipaddrcnt \u003d\u003d 0 isn\u0027t quite the same behaviour that there is currently. I\u0027ll go ahead and fix that up."},{"file":"usr/src/uts/common/sys/mac_flow.h","line":165,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"I\u0027ve turned this into a function.\n\nChecking mp_ipaddrcnt \u003d\u003d 0 is actually the correct behaviour to match what we currently do for determining whether to use those learned IPs. It\u0027s just not what we use for determining whether to intercept DHCP packets at the moment. I\u0027ll stick with having everything use mp_ipaddrcnt \u003d\u003d 0, in that case."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"usr/src/lib/libdladm/common/libdladm.c","type":"MODIFIED","insertions":37,"deletions":-3},{"file":"usr/src/lib/libdladm/common/libdladm.h","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/lib/libdladm/common/libdladm_impl.h","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/lib/libdladm/common/linkprop.c","type":"MODIFIED","insertions":57,"deletions":-1},{"file":"usr/src/man/man1m/dladm.1m","type":"MODIFIED","insertions":17,"deletions":0},{"file":"usr/src/test/util-tests/tests/dladm/dynamic-methods.ksh","type":"ADDED","insertions":45,"deletions":0},{"file":"usr/src/uts/common/inet/ip.h","type":"MODIFIED","insertions":17,"deletions":-1},{"file":"usr/src/uts/common/inet/ip/ip.c","type":"MODIFIED","insertions":14,"deletions":-70},{"file":"usr/src/uts/common/inet/ip/ip_if.c","type":"MODIFIED","insertions":108,"deletions":-49},{"file":"usr/src/uts/common/io/dld/dld_proto.c","type":"MODIFIED","insertions":34,"deletions":-2},{"file":"usr/src/uts/common/io/mac/mac_protect.c","type":"MODIFIED","insertions":61,"deletions":-21},{"file":"usr/src/uts/common/sys/dld.h","type":"MODIFIED","insertions":6,"deletions":0},{"file":"usr/src/uts/common/sys/mac_client_priv.h","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/uts/common/sys/mac_flow.h","type":"MODIFIED","insertions":10,"deletions":0}],"sizeInsertions":412,"sizeDeletions":-149},{"number":"3","revision":"71cafb1f2fcf9ca8ccdb4a2fc29eae34beba681f","parents":["2174ce02cf662e5d327c7636de22e541462478ec"],"ref":"refs/changes/46/3046/3","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1512673230,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"usr/src/lib/libdladm/common/libdladm.c","type":"MODIFIED","insertions":37,"deletions":-3},{"file":"usr/src/lib/libdladm/common/libdladm.h","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/lib/libdladm/common/libdladm_impl.h","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/lib/libdladm/common/linkprop.c","type":"MODIFIED","insertions":57,"deletions":-1},{"file":"usr/src/man/man1m/dladm.1m","type":"MODIFIED","insertions":17,"deletions":0},{"file":"usr/src/test/util-tests/tests/dladm/dynamic-methods.ksh","type":"ADDED","insertions":45,"deletions":0},{"file":"usr/src/uts/common/inet/ip.h","type":"MODIFIED","insertions":17,"deletions":-1},{"file":"usr/src/uts/common/inet/ip/ip.c","type":"MODIFIED","insertions":14,"deletions":-70},{"file":"usr/src/uts/common/inet/ip/ip_if.c","type":"MODIFIED","insertions":108,"deletions":-49},{"file":"usr/src/uts/common/io/dld/dld_proto.c","type":"MODIFIED","insertions":34,"deletions":-2},{"file":"usr/src/uts/common/io/mac/mac_protect.c","type":"MODIFIED","insertions":61,"deletions":-21},{"file":"usr/src/uts/common/sys/dld.h","type":"MODIFIED","insertions":6,"deletions":0},{"file":"usr/src/uts/common/sys/mac_client_priv.h","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/uts/common/sys/mac_flow.h","type":"MODIFIED","insertions":10,"deletions":0}],"sizeInsertions":412,"sizeDeletions":-149},{"number":"4","revision":"8f2bd78f7b02edbf1ea1092cf05eaedae6dfd41d","parents":["2174ce02cf662e5d327c7636de22e541462478ec"],"ref":"refs/changes/46/3046/4","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1512689607,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"usr/src/lib/libdladm/common/libdladm.c","type":"MODIFIED","insertions":37,"deletions":-3},{"file":"usr/src/lib/libdladm/common/libdladm.h","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/lib/libdladm/common/libdladm_impl.h","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/lib/libdladm/common/linkprop.c","type":"MODIFIED","insertions":58,"deletions":-1},{"file":"usr/src/man/man1m/dladm.1m","type":"MODIFIED","insertions":18,"deletions":0},{"file":"usr/src/test/util-tests/tests/dladm/dynamic-methods.ksh","type":"ADDED","insertions":45,"deletions":0},{"file":"usr/src/uts/common/inet/ip.h","type":"MODIFIED","insertions":17,"deletions":-1},{"file":"usr/src/uts/common/inet/ip/ip.c","type":"MODIFIED","insertions":14,"deletions":-70},{"file":"usr/src/uts/common/inet/ip/ip_if.c","type":"MODIFIED","insertions":108,"deletions":-49},{"file":"usr/src/uts/common/io/dld/dld_proto.c","type":"MODIFIED","insertions":34,"deletions":-2},{"file":"usr/src/uts/common/io/mac/mac_protect.c","type":"MODIFIED","insertions":61,"deletions":-21},{"file":"usr/src/uts/common/sys/dld.h","type":"MODIFIED","insertions":6,"deletions":0},{"file":"usr/src/uts/common/sys/mac_client_priv.h","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/uts/common/sys/mac_flow.h","type":"MODIFIED","insertions":10,"deletions":0}],"sizeInsertions":414,"sizeDeletions":-149},{"number":"5","revision":"1c801c51b80f185d461f9cfa11bf77388a44772c","parents":["2174ce02cf662e5d327c7636de22e541462478ec"],"ref":"refs/changes/46/3046/5","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1512694439,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1512697085,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"usr/src/lib/libdladm/common/libdladm.c","type":"MODIFIED","insertions":37,"deletions":-3},{"file":"usr/src/lib/libdladm/common/libdladm.h","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/lib/libdladm/common/libdladm_impl.h","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/lib/libdladm/common/linkprop.c","type":"MODIFIED","insertions":58,"deletions":-1},{"file":"usr/src/man/man1m/dladm.1m","type":"MODIFIED","insertions":18,"deletions":0},{"file":"usr/src/test/util-tests/tests/dladm/dynamic-methods.ksh","type":"ADDED","insertions":45,"deletions":0},{"file":"usr/src/uts/common/inet/ip.h","type":"MODIFIED","insertions":17,"deletions":-1},{"file":"usr/src/uts/common/inet/ip/ip.c","type":"MODIFIED","insertions":14,"deletions":-70},{"file":"usr/src/uts/common/inet/ip/ip_if.c","type":"MODIFIED","insertions":108,"deletions":-49},{"file":"usr/src/uts/common/io/dld/dld_proto.c","type":"MODIFIED","insertions":34,"deletions":-2},{"file":"usr/src/uts/common/io/mac/mac_protect.c","type":"MODIFIED","insertions":67,"deletions":-20},{"file":"usr/src/uts/common/sys/dld.h","type":"MODIFIED","insertions":6,"deletions":0},{"file":"usr/src/uts/common/sys/mac_client_priv.h","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/uts/common/sys/mac_flow.h","type":"MODIFIED","insertions":7,"deletions":0}],"sizeInsertions":417,"sizeDeletions":-148},{"number":"6","revision":"75692b0a1d194c7d3140930a6662b67a0d61bbff","parents":["2174ce02cf662e5d327c7636de22e541462478ec"],"ref":"refs/changes/46/3046/6","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1512772869,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1513030808,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1512773061,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"usr/src/lib/libdladm/common/libdladm.c","type":"MODIFIED","insertions":37,"deletions":-3},{"file":"usr/src/lib/libdladm/common/libdladm.h","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/lib/libdladm/common/libdladm_impl.h","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/lib/libdladm/common/linkprop.c","type":"MODIFIED","insertions":58,"deletions":-1},{"file":"usr/src/man/man1m/dladm.1m","type":"MODIFIED","insertions":18,"deletions":0},{"file":"usr/src/test/util-tests/tests/dladm/dynamic-methods.ksh","type":"ADDED","insertions":45,"deletions":0},{"file":"usr/src/uts/common/inet/ip.h","type":"MODIFIED","insertions":17,"deletions":-1},{"file":"usr/src/uts/common/inet/ip/ip.c","type":"MODIFIED","insertions":14,"deletions":-70},{"file":"usr/src/uts/common/inet/ip/ip_if.c","type":"MODIFIED","insertions":108,"deletions":-49},{"file":"usr/src/uts/common/io/dld/dld_proto.c","type":"MODIFIED","insertions":34,"deletions":-2},{"file":"usr/src/uts/common/io/mac/mac_protect.c","type":"MODIFIED","insertions":67,"deletions":-20},{"file":"usr/src/uts/common/sys/dld.h","type":"MODIFIED","insertions":6,"deletions":0},{"file":"usr/src/uts/common/sys/mac_client_priv.h","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/uts/common/sys/mac_flow.h","type":"MODIFIED","insertions":7,"deletions":0}],"sizeInsertions":417,"sizeDeletions":-148},{"number":"7","revision":"c788acd6ab03290496c69ad6a3c6ed92d4099f8e","parents":["31aa541845007e9bf93c236b2be9192f16371dfc"],"ref":"refs/changes/46/3046/7","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1528418285,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1513030808,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1512773061,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"usr/src/lib/libdladm/common/libdladm.c","type":"MODIFIED","insertions":37,"deletions":-3},{"file":"usr/src/lib/libdladm/common/libdladm.h","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/lib/libdladm/common/libdladm_impl.h","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/lib/libdladm/common/linkprop.c","type":"MODIFIED","insertions":58,"deletions":-1},{"file":"usr/src/man/man1m/dladm.1m","type":"MODIFIED","insertions":18,"deletions":0},{"file":"usr/src/test/util-tests/tests/dladm/dynamic-methods.ksh","type":"ADDED","insertions":45,"deletions":0},{"file":"usr/src/uts/common/inet/ip.h","type":"MODIFIED","insertions":17,"deletions":-1},{"file":"usr/src/uts/common/inet/ip/ip.c","type":"MODIFIED","insertions":14,"deletions":-70},{"file":"usr/src/uts/common/inet/ip/ip_if.c","type":"MODIFIED","insertions":108,"deletions":-49},{"file":"usr/src/uts/common/io/dld/dld_proto.c","type":"MODIFIED","insertions":34,"deletions":-2},{"file":"usr/src/uts/common/io/mac/mac_protect.c","type":"MODIFIED","insertions":67,"deletions":-20},{"file":"usr/src/uts/common/sys/dld.h","type":"MODIFIED","insertions":6,"deletions":0},{"file":"usr/src/uts/common/sys/mac_client_priv.h","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/uts/common/sys/mac_flow.h","type":"MODIFIED","insertions":7,"deletions":0}],"sizeInsertions":417,"sizeDeletions":-148},{"number":"8","revision":"78bf0429da7dc9417a87282e612ff6b36b29ed40","parents":["31aa541845007e9bf93c236b2be9192f16371dfc"],"ref":"refs/changes/46/3046/8","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1528418563,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/lib/libdladm/common/linkprop.c","line":458,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Did we have this conversation?  Yes we did.  I may have a comment in the man page changes..."},{"file":"usr/src/man/man1m/dladm.1m","line":5006,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Okay, good, you\u0027re clear on this.  And like ipadm, addrconf covers both (even though in ipadm, there\u0027s the stateless/stateful distinction).\n\nI brought this up because there MAY be some people who assume \"addrconf \u003d\u003d slaac\" (like me).  I could be wrong, though, so I\u0027m not blocking over this."},{"file":"usr/src/test/util-tests/tests/dladm/dynamic-methods.ksh","line":41,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Again, not a blocker, but I wonder if someone might want to say \"dhcp\" as an alias for both \"dhcpv4,dhcpv6\"?"},{"file":"usr/src/uts/common/inet/ip.h","line":1856,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Update this table with your additions to ill_t above, please."},{"file":"usr/src/uts/common/inet/ip.h","line":1856,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Done"},{"file":"usr/src/uts/common/inet/ip/ip_if.c","line":2127,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"You return B_TRUE (i.e. check passed) if you don\u0027t have the capability."},{"file":"usr/src/uts/common/inet/ip/ip_if.c","line":2127,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"I\u0027ve refactored this to help clarify the meaning. A better way of writing this initially would probably have been to stylize the phrase as \"fail-open\"."},{"file":"usr/src/uts/common/inet/ip/ip_if.c","line":2136,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Is this wrong, or the comment above wrong?  (I suspect the comment is wrong.)"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"usr/src/lib/libdladm/common/libdladm.c","type":"MODIFIED","insertions":37,"deletions":-3},{"file":"usr/src/lib/libdladm/common/libdladm.h","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/lib/libdladm/common/libdladm_impl.h","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/lib/libdladm/common/linkprop.c","type":"MODIFIED","insertions":58,"deletions":-1},{"file":"usr/src/man/man1m/dladm.1m","type":"MODIFIED","insertions":18,"deletions":0},{"file":"usr/src/test/util-tests/tests/dladm/dynamic-methods.ksh","type":"ADDED","insertions":45,"deletions":0},{"file":"usr/src/uts/common/inet/ip.h","type":"MODIFIED","insertions":17,"deletions":-1},{"file":"usr/src/uts/common/inet/ip/ip.c","type":"MODIFIED","insertions":14,"deletions":-70},{"file":"usr/src/uts/common/inet/ip/ip_if.c","type":"MODIFIED","insertions":108,"deletions":-49},{"file":"usr/src/uts/common/io/dld/dld_proto.c","type":"MODIFIED","insertions":34,"deletions":-2},{"file":"usr/src/uts/common/io/mac/mac_protect.c","type":"MODIFIED","insertions":72,"deletions":-21},{"file":"usr/src/uts/common/sys/dld.h","type":"MODIFIED","insertions":6,"deletions":0},{"file":"usr/src/uts/common/sys/mac_client_priv.h","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/uts/common/sys/mac_flow.h","type":"MODIFIED","insertions":7,"deletions":0}],"sizeInsertions":422,"sizeDeletions":-149},{"number":"9","revision":"ab04d61cb99fa181b1f4652e463b9c1b842ca486","parents":["78ec08d5489b18ec0a341bd70e52f1546a6534f1"],"ref":"refs/changes/46/3046/9","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1528479974,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"NO_CHANGE","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"usr/src/lib/libdladm/common/libdladm.c","type":"MODIFIED","insertions":37,"deletions":-3},{"file":"usr/src/lib/libdladm/common/libdladm.h","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/lib/libdladm/common/libdladm_impl.h","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/lib/libdladm/common/linkprop.c","type":"MODIFIED","insertions":58,"deletions":-1},{"file":"usr/src/man/man1m/dladm.1m","type":"MODIFIED","insertions":18,"deletions":0},{"file":"usr/src/test/util-tests/tests/dladm/dynamic-methods.ksh","type":"ADDED","insertions":45,"deletions":0},{"file":"usr/src/uts/common/inet/ip.h","type":"MODIFIED","insertions":17,"deletions":-1},{"file":"usr/src/uts/common/inet/ip/ip.c","type":"MODIFIED","insertions":14,"deletions":-70},{"file":"usr/src/uts/common/inet/ip/ip_if.c","type":"MODIFIED","insertions":108,"deletions":-49},{"file":"usr/src/uts/common/io/dld/dld_proto.c","type":"MODIFIED","insertions":34,"deletions":-2},{"file":"usr/src/uts/common/io/mac/mac_protect.c","type":"MODIFIED","insertions":72,"deletions":-21},{"file":"usr/src/uts/common/sys/dld.h","type":"MODIFIED","insertions":6,"deletions":0},{"file":"usr/src/uts/common/sys/mac_client_priv.h","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/uts/common/sys/mac_flow.h","type":"MODIFIED","insertions":7,"deletions":0}],"sizeInsertions":422,"sizeDeletions":-149},{"number":"10","revision":"76dfbb727bba9f4867a8f5dda3d928eb901c5a1b","parents":["78ec08d5489b18ec0a341bd70e52f1546a6534f1"],"ref":"refs/changes/46/3046/10","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1528480397,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"NO_CODE_CHANGE","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/lib/libdladm/common/libdladm.c","type":"MODIFIED","insertions":37,"deletions":-3},{"file":"usr/src/lib/libdladm/common/libdladm.h","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/lib/libdladm/common/libdladm_impl.h","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/lib/libdladm/common/linkprop.c","type":"MODIFIED","insertions":58,"deletions":-1},{"file":"usr/src/man/man1m/dladm.1m","type":"MODIFIED","insertions":18,"deletions":0},{"file":"usr/src/test/util-tests/tests/dladm/dynamic-methods.ksh","type":"ADDED","insertions":45,"deletions":0},{"file":"usr/src/uts/common/inet/ip.h","type":"MODIFIED","insertions":17,"deletions":-1},{"file":"usr/src/uts/common/inet/ip/ip.c","type":"MODIFIED","insertions":14,"deletions":-70},{"file":"usr/src/uts/common/inet/ip/ip_if.c","type":"MODIFIED","insertions":108,"deletions":-49},{"file":"usr/src/uts/common/io/dld/dld_proto.c","type":"MODIFIED","insertions":34,"deletions":-2},{"file":"usr/src/uts/common/io/mac/mac_protect.c","type":"MODIFIED","insertions":72,"deletions":-21},{"file":"usr/src/uts/common/sys/dld.h","type":"MODIFIED","insertions":6,"deletions":0},{"file":"usr/src/uts/common/sys/mac_client_priv.h","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/uts/common/sys/mac_flow.h","type":"MODIFIED","insertions":7,"deletions":0}],"sizeInsertions":422,"sizeDeletions":-149},{"number":"11","revision":"fecc0fbf8b297832e17a21ea49f316c41a216425","parents":["78ec08d5489b18ec0a341bd70e52f1546a6534f1"],"ref":"refs/changes/46/3046/11","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1528482097,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1528482366,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1528482366,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/lib/libdladm/common/libdladm.c","type":"MODIFIED","insertions":37,"deletions":-3},{"file":"usr/src/lib/libdladm/common/libdladm.h","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/lib/libdladm/common/libdladm_impl.h","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/lib/libdladm/common/linkprop.c","type":"MODIFIED","insertions":58,"deletions":-1},{"file":"usr/src/man/man1m/dladm.1m","type":"MODIFIED","insertions":18,"deletions":0},{"file":"usr/src/test/util-tests/tests/dladm/dynamic-methods.ksh","type":"ADDED","insertions":45,"deletions":0},{"file":"usr/src/uts/common/inet/ip.h","type":"MODIFIED","insertions":18,"deletions":-1},{"file":"usr/src/uts/common/inet/ip/ip.c","type":"MODIFIED","insertions":14,"deletions":-70},{"file":"usr/src/uts/common/inet/ip/ip_if.c","type":"MODIFIED","insertions":110,"deletions":-49},{"file":"usr/src/uts/common/io/dld/dld_proto.c","type":"MODIFIED","insertions":34,"deletions":-2},{"file":"usr/src/uts/common/io/mac/mac_protect.c","type":"MODIFIED","insertions":72,"deletions":-21},{"file":"usr/src/uts/common/sys/dld.h","type":"MODIFIED","insertions":6,"deletions":0},{"file":"usr/src/uts/common/sys/mac_client_priv.h","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/uts/common/sys/mac_flow.h","type":"MODIFIED","insertions":7,"deletions":0}],"sizeInsertions":425,"sizeDeletions":-149},{"number":"12","revision":"12a82dd4a058eb86f2b6b075bde38b01424f8f30","parents":["c6b0ac12851403af18c06800770e65c0314956fb"],"ref":"refs/changes/46/3046/12","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1528483522,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"NO_CHANGE","approvals":[{"type":"SUBM","value":"1","grantedOn":1528483639,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1528482366,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1528482366,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/lib/libdladm/common/libdladm.c","type":"MODIFIED","insertions":37,"deletions":-3},{"file":"usr/src/lib/libdladm/common/libdladm.h","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/lib/libdladm/common/libdladm_impl.h","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/lib/libdladm/common/linkprop.c","type":"MODIFIED","insertions":58,"deletions":-1},{"file":"usr/src/man/man1m/dladm.1m","type":"MODIFIED","insertions":18,"deletions":0},{"file":"usr/src/test/util-tests/tests/dladm/dynamic-methods.ksh","type":"ADDED","insertions":45,"deletions":0},{"file":"usr/src/uts/common/inet/ip.h","type":"MODIFIED","insertions":18,"deletions":-1},{"file":"usr/src/uts/common/inet/ip/ip.c","type":"MODIFIED","insertions":14,"deletions":-70},{"file":"usr/src/uts/common/inet/ip/ip_if.c","type":"MODIFIED","insertions":110,"deletions":-49},{"file":"usr/src/uts/common/io/dld/dld_proto.c","type":"MODIFIED","insertions":34,"deletions":-2},{"file":"usr/src/uts/common/io/mac/mac_protect.c","type":"MODIFIED","insertions":72,"deletions":-21},{"file":"usr/src/uts/common/sys/dld.h","type":"MODIFIED","insertions":6,"deletions":0},{"file":"usr/src/uts/common/sys/mac_client_priv.h","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/uts/common/sys/mac_flow.h","type":"MODIFIED","insertions":7,"deletions":0}],"sizeInsertions":425,"sizeDeletions":-149}],"allReviewers":[{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}]}