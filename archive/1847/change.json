{"project":"joyent/sdc-docker","branch":"master","id":"Ia963f3a5076bc27e738a38d4d5ba5f714fb2b7b7","number":"1847","subject":"DOCKER-1042 failure in triton docker tests assuming nginx:latest exposes port 443 Reviewed by: Todd Whiteman \u003ctodd.whiteman@joyent.com\u003e Approved by: Todd Whiteman \u003ctodd.whiteman@joyent.com\u003e","owner":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"url":"https://cr.joyent.us/1847","commitMessage":"DOCKER-1042 failure in triton docker tests assuming nginx:latest exposes port 443\nReviewed by: Todd Whiteman \u003ctodd.whiteman@joyent.com\u003e\nApproved by: Todd Whiteman \u003ctodd.whiteman@joyent.com\u003e\n","createdOn":1493226201,"lastUpdated":1493236371,"open":false,"status":"MERGED","comments":[{"timestamp":1493226201,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Uploaded patch set 1."},{"timestamp":1493226203,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit 0bae322c5353be604a773aa0c4c48abb423a353d\n    \n    drop port 443 per nginx:latest update"},{"timestamp":1493226242,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1493226258,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Uploaded patch set 2."},{"timestamp":1493226259,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit 8a5f3359d3761e603f777fdd232a66e0710a94f5\n    \n    drop this debugging comment"},{"timestamp":1493226293,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1493226754,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Patch Set 2: Code-Review+1\n\n(2 comments)"},{"timestamp":1493230673,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Uploaded patch set 3."},{"timestamp":1493230675,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 3:\n\nNew commits:\n    \n    commit 7b9b481fb2d0836dff0f36b59e699ab50d52f1d4\n    \n    create a \u0027joyentunsupported/test-run-ports:1.0.0\u0027 image to use for our test"},{"timestamp":1493230708,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1493233117,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Patch Set 3: Code-Review+1\n\n(3 comments)"},{"timestamp":1493235688,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Uploaded patch set 4."},{"timestamp":1493235690,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 4:\n\nNew commits:\n    \n    commit 02988decd5b1cf224e705cf642172a08d9e9597b\n    \n    updates per todd feedback"},{"timestamp":1493235719,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 3:\n\n(3 comments)"},{"timestamp":1493235719,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1493235743,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 3:\n\n(1 comment)"},{"timestamp":1493236184,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Patch Set 4: Code-Review+1 Integration-Approval+1"},{"timestamp":1493236365,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Uploaded patch set 5: Commit message was updated."},{"timestamp":1493236371,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Trent Mick"}],"currentPatchSet":{"number":"5","revision":"a963f3a5076bc27e738a38d4d5ba5f714fb2b7b7","parents":["eadaa0a85cef3ae6a18c685392638f0c2a654fb9"],"ref":"refs/changes/47/1847/5","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1493236365,"author":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1493235719,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1493236184,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1493236184,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}},{"type":"SUBM","value":"1","grantedOn":1493236371,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"test/images/README.md","type":"ADDED","insertions":7,"deletions":0},{"file":"test/images/test-run-ports/Dockerfile","type":"ADDED","insertions":16,"deletions":0},{"file":"test/images/test-run-ports/Makefile","type":"ADDED","insertions":19,"deletions":0},{"file":"test/images/test-run-ports/README.md","type":"ADDED","insertions":2,"deletions":0},{"file":"test/integration/cli-run-ports.test.js","type":"MODIFIED","insertions":15,"deletions":-13}],"sizeInsertions":59,"sizeDeletions":-13},"patchSets":[{"number":"1","revision":"6f86eb03a7f4282b06a31069ea3c48bcf177ee02","parents":["eadaa0a85cef3ae6a18c685392638f0c2a654fb9"],"ref":"refs/changes/47/1847/1","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1493226201,"author":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1493226242,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"test/integration/cli-run-ports.test.js","line":385,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Perhaps add comment here - as it looks like we need to find a new test/image for this, as we no longer test the affects of \u0027-p\u0027 and unpublishedPorts."},{"file":"test/integration/cli-run-ports.test.js","line":525,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Another where it looks like we need a new image that has a variety of UnpublishedPorts."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"test/integration/cli-run-ports.test.js","type":"MODIFIED","insertions":14,"deletions":-24}],"sizeInsertions":14,"sizeDeletions":-24},{"number":"2","revision":"9354f8be039a54a8435658db0664143f2523efcd","parents":["eadaa0a85cef3ae6a18c685392638f0c2a654fb9"],"ref":"refs/changes/47/1847/2","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1493226258,"author":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1493226293,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1493226754,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"test/integration/cli-run-ports.test.js","type":"MODIFIED","insertions":13,"deletions":-24}],"sizeInsertions":13,"sizeDeletions":-24},{"number":"3","revision":"c3e4c46ab6f96c98aa1f0617ba7ab996116f4219","parents":["eadaa0a85cef3ae6a18c685392638f0c2a654fb9"],"ref":"refs/changes/47/1847/3","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1493230673,"author":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1493230708,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1493233117,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}}],"comments":[{"file":"test/images/README.md","line":6,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"built"},{"file":"test/images/README.md","line":6,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Done"},{"file":"test/images/test-run-ports/Dockerfile","line":11,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"I think using nginx:1.13.0-alpine would be a better base - so we can test the ports are opened and usable, because if we are not testing real port connections now, we should be."},{"file":"test/images/test-run-ports/Dockerfile","line":11,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Sure, I\u0027ll change to that.\nHowever, IIUC the nginx image doesn\u0027t actually listen on port 443 so we wouldn\u0027t be able to test that, right?"},{"file":"test/images/test-run-ports/Dockerfile","line":11,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Port 80 tho, we could test."},{"file":"test/images/test-run-ports/Dockerfile","line":14,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"If using nginx alpine, this would be CMD [\"nginx\", \"-g\", \"daemon off;\"]"},{"file":"test/images/test-run-ports/Dockerfile","line":14,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"test/images/README.md","type":"ADDED","insertions":7,"deletions":0},{"file":"test/images/test-run-ports/Dockerfile","type":"ADDED","insertions":14,"deletions":0},{"file":"test/images/test-run-ports/Makefile","type":"ADDED","insertions":19,"deletions":0},{"file":"test/images/test-run-ports/README.md","type":"ADDED","insertions":2,"deletions":0},{"file":"test/integration/cli-run-ports.test.js","type":"MODIFIED","insertions":15,"deletions":-13}],"sizeInsertions":57,"sizeDeletions":-13},{"number":"4","revision":"d41707a2fd1a68b3b29087c3734a58de9ded2ed5","parents":["eadaa0a85cef3ae6a18c685392638f0c2a654fb9"],"ref":"refs/changes/47/1847/4","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1493235688,"author":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1493235719,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1493236184,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1493236184,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"test/images/README.md","type":"ADDED","insertions":7,"deletions":0},{"file":"test/images/test-run-ports/Dockerfile","type":"ADDED","insertions":16,"deletions":0},{"file":"test/images/test-run-ports/Makefile","type":"ADDED","insertions":19,"deletions":0},{"file":"test/images/test-run-ports/README.md","type":"ADDED","insertions":2,"deletions":0},{"file":"test/integration/cli-run-ports.test.js","type":"MODIFIED","insertions":15,"deletions":-13}],"sizeInsertions":59,"sizeDeletions":-13},{"number":"5","revision":"a963f3a5076bc27e738a38d4d5ba5f714fb2b7b7","parents":["eadaa0a85cef3ae6a18c685392638f0c2a654fb9"],"ref":"refs/changes/47/1847/5","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1493236365,"author":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1493235719,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"SUBM","value":"1","grantedOn":1493236371,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1493236184,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1493236184,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"test/images/README.md","type":"ADDED","insertions":7,"deletions":0},{"file":"test/images/test-run-ports/Dockerfile","type":"ADDED","insertions":16,"deletions":0},{"file":"test/images/test-run-ports/Makefile","type":"ADDED","insertions":19,"deletions":0},{"file":"test/images/test-run-ports/README.md","type":"ADDED","insertions":2,"deletions":0},{"file":"test/integration/cli-run-ports.test.js","type":"MODIFIED","insertions":15,"deletions":-13}],"sizeInsertions":59,"sizeDeletions":-13}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}]}