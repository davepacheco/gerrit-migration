From 7a7455aa17e109c0783d2a8ac0d1a5b344ef359b Mon Sep 17 00:00:00 2001
From: Mike Gerdts <mike.gerdts@joyent.com>
Date: Mon, 20 May 2019 19:43:05 -0500
Subject: [PATCH] =?UTF-8?q?TRITON-1685=20linux-prepare-image=20should=20cl?=
 =?UTF-8?q?ear=20/etc/machine-id=20Reviewed=20by:=20Pedro=20Palaz=C3=B3n?=
 =?UTF-8?q?=20Candel=20<pedro@joyent.com>=20Approved=20by:=20Pedro=20Palaz?=
 =?UTF-8?q?=C3=B3n=20Candel=20<pedro@joyent.com>?=
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

---
 tools/prepare-image/linux-prepare-image | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/tools/prepare-image/linux-prepare-image b/tools/prepare-image/linux-prepare-image
index 4c5da8a..597134c 100755
--- a/tools/prepare-image/linux-prepare-image
+++ b/tools/prepare-image/linux-prepare-image
@@ -129,6 +129,12 @@ function cleanup_hostname() {
     touch /etc/hostname
 }
 
+function cleanup_machineid() {
+    if [[ -f /etc/machine-id ]]; then
+        cp /dev/null /etc/machine-id
+    fi
+}
+
 function cleanup_network_devices() {
     if [[ -f /etc/udev/rules.d/70-persistent-net.rules ]] ; then
         rm -f /etc/udev/rules.d/70-persistent-net.rules
@@ -258,6 +264,7 @@ cleanup_ssh
 cleanup_root
 cleanup_metadata
 cleanup_hostname
+cleanup_machineid
 cleanup_network_devices
 cleanup_cloud_init
 
-- 
2.21.0

