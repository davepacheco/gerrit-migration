commit 5f7ff3c767303a3442f206c8fefc7138decdf397 (refs/changes/07/4607/1)
Author: Chris Burroughs <chris.burroughs@joyent.com>
Date:   2018-07-31T14:23:03-04:00 (1 year, 2 months ago)
    
    TRITON-649 cnapi sendTaskRequest fails to read cn-agent port

diff --git a/lib/models/server.js b/lib/models/server.js
index cb77f18..4a85bc2 100644
--- a/lib/models/server.js
+++ b/lib/models/server.js
@@ -17,7 +17,6 @@
 var async = require('async');
 var assert = require('assert-plus');
 var dns = require('dns');
-var jsprim = require('jsprim');
 var qs = require('querystring');
 var restify = require('restify');
 var sprintf = require('sprintf').sprintf;
@@ -2183,8 +2182,9 @@ function (opts) {
             }
 
             if (sysinfo.hasOwnProperty('CN Agent Port')) {
-                if (!jsprim.parseInteger('CN Agent Port') instanceof Error) {
-                    serverAdminPort = sysinfo['CN Agent Port'];
+                const port = Number.parseInt(sysinfo['CN Agent Port']);
+                if (!Number.isNaN(port)) {
+                    serverAdminPort = port;
                 }
             }
 
@@ -2391,8 +2391,9 @@ ModelServer.prototype.sendRequest = function (opts, cb) {
             }
 
             if (sysinfo.hasOwnProperty('CN Agent Port')) {
-                if (!jsprim.parseInteger('CN Agent Port') instanceof Error) {
-                    serverAdminPort = sysinfo['CN Agent Port'];
+                const port = Number.parseInt(sysinfo['CN Agent Port']);
+                if (!Number.isNaN(port)) {
+                    serverAdminPort = port;
                 }
             }
 
