From 5f7ff3c767303a3442f206c8fefc7138decdf397 Mon Sep 17 00:00:00 2001
From: Chris Burroughs <chris.burroughs@joyent.com>
Date: Tue, 31 Jul 2018 14:23:03 -0400
Subject: [PATCH] TRITON-649 cnapi sendTaskRequest fails to read cn-agent port

---
 lib/models/server.js | 11 ++++++-----
 1 file changed, 6 insertions(+), 5 deletions(-)

diff --git a/lib/models/server.js b/lib/models/server.js
index cb77f18..4a85bc2 100644
--- a/lib/models/server.js
+++ b/lib/models/server.js
@@ -17,7 +17,6 @@
 var async = require('async');
 var assert = require('assert-plus');
 var dns = require('dns');
-var jsprim = require('jsprim');
 var qs = require('querystring');
 var restify = require('restify');
 var sprintf = require('sprintf').sprintf;
@@ -2183,8 +2182,9 @@ function (opts) {
             }
 
             if (sysinfo.hasOwnProperty('CN Agent Port')) {
-                if (!jsprim.parseInteger('CN Agent Port') instanceof Error) {
-                    serverAdminPort = sysinfo['CN Agent Port'];
+                const port = Number.parseInt(sysinfo['CN Agent Port']);
+                if (!Number.isNaN(port)) {
+                    serverAdminPort = port;
                 }
             }
 
@@ -2391,8 +2391,9 @@ ModelServer.prototype.sendRequest = function (opts, cb) {
             }
 
             if (sysinfo.hasOwnProperty('CN Agent Port')) {
-                if (!jsprim.parseInteger('CN Agent Port') instanceof Error) {
-                    serverAdminPort = sysinfo['CN Agent Port'];
+                const port = Number.parseInt(sysinfo['CN Agent Port']);
+                if (!Number.isNaN(port)) {
+                    serverAdminPort = port;
                 }
             }
 
-- 
2.21.0

