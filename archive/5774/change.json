{"project":"joyent/sdc-net-agent","branch":"master","id":"I2aa067f5b1ce0f8b82190912be7d75f969b78ca5","number":"5774","subject":"TRITON-1304 net-agent fails to properly handle admin NIC for CNs Reviewed by: Jason King \u003cjason.king@joyent.com\u003e Reviewed by: Michael Zeller \u003cmike.zeller@joyent.com\u003e Approved by: Michael Zeller \u003cmike.zeller@joyent.com\u003e","owner":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"url":"https://cr.joyent.us/5774","commitMessage":"TRITON-1304 net-agent fails to properly handle admin NIC for CNs\nReviewed by: Jason King \u003cjason.king@joyent.com\u003e\nReviewed by: Michael Zeller \u003cmike.zeller@joyent.com\u003e\nApproved by: Michael Zeller \u003cmike.zeller@joyent.com\u003e\n","createdOn":1552417558,"lastUpdated":1552429681,"open":false,"status":"MERGED","comments":[{"timestamp":1552417558,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Uploaded patch set 1."},{"timestamp":1552417559,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit e24775fe16c23e51ba25ac3cfd7f718cc377a952\n    \n    make net-agent able to fix type+owner for NICs created for it by booter"},{"timestamp":1552423228,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Patch Set 1: Code-Review+1"},{"timestamp":1552423525,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1552428318,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Uploaded patch set 2."},{"timestamp":1552428319,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit 4042fc6fcb2850d8f80921859d0daa16a4fe2d75\n    \n    uglify to make \u0027make check\u0027 happy, fix fsm diagram."},{"timestamp":1552428388,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 2: Code-Review+1"},{"timestamp":1552428574,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1552428657,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Uploaded patch set 3: Commit message was updated."},{"timestamp":1552429318,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1552429647,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Patch Set 3: Integration-Approval+1"},{"timestamp":1552429667,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Uploaded patch set 4: Commit message was updated."},{"timestamp":1552429681,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Josh Wilsdon"}],"currentPatchSet":{"number":"4","revision":"2aa067f5b1ce0f8b82190912be7d75f969b78ca5","parents":["3c717f7deb7e24b67941d73c5b466f6e870c4cfb"],"ref":"refs/changes/74/5774/4","uploader":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"createdOn":1552429667,"author":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1552428388,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1552429318,"by":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1552429647,"by":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"}},{"type":"SUBM","value":"1","grantedOn":1552429681,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"lib/nic-fsm.js","type":"MODIFIED","insertions":50,"deletions":-27},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":51,"sizeDeletions":-28},"patchSets":[{"number":"1","revision":"b846a303328bde8adc358d8de4d4e0b66e582e0e","parents":["3c717f7deb7e24b67941d73c5b466f6e870c4cfb"],"ref":"refs/changes/74/5774/1","uploader":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"createdOn":1552417558,"author":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1552423228,"by":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"}}],"comments":[{"file":"lib/nic-fsm.js","line":337,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"I\u0027m not super familiar with this code, so I could easily be wrong here, but it looks like when we hit this, if we move to the \u0027update.local\u0027 state, it\u0027ll update our in-memory info, then proceed to transition to the \u0027update.napi\u0027 state to update NAPI.\n\nBasically I\u0027m wondering if we just instead need to expand the check at line 361 to exclude a new admin NIC and let it fall through (it would also mean the above FSM diagram wouldn\u0027t need updating :P)."},{"file":"lib/nic-fsm.js","line":337,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"I updated the diagram. Just passing through to update.local doesn\u0027t work because getDifferences won\u0027t find any differences. That code does a lot of other things anyway and seems designed for applying changes from NAPI to the local system. All we want here is to update NAPI in this case. So calling update.local in order to update NAPI seems confusing anyway."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/nic-fsm.js","type":"MODIFIED","insertions":24,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":25,"sizeDeletions":-1},{"number":"2","revision":"144843ca4b8b24c4e05d262ea79eb5683a2102ae","parents":["3c717f7deb7e24b67941d73c5b466f6e870c4cfb"],"ref":"refs/changes/74/5774/2","uploader":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"createdOn":1552428318,"author":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1552428388,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"lib/nic-fsm.js","type":"MODIFIED","insertions":50,"deletions":-27},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":51,"sizeDeletions":-28},{"number":"3","revision":"e7d05ac81534b25796b78ccc36f9065d03962294","parents":["3c717f7deb7e24b67941d73c5b466f6e870c4cfb"],"ref":"refs/changes/74/5774/3","uploader":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"createdOn":1552428657,"author":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1552429318,"by":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1552429647,"by":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1552428388,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"lib/nic-fsm.js","type":"MODIFIED","insertions":50,"deletions":-27},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":51,"sizeDeletions":-28},{"number":"4","revision":"2aa067f5b1ce0f8b82190912be7d75f969b78ca5","parents":["3c717f7deb7e24b67941d73c5b466f6e870c4cfb"],"ref":"refs/changes/74/5774/4","uploader":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"createdOn":1552429667,"author":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"SUBM","value":"1","grantedOn":1552429681,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1552429318,"by":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1552429647,"by":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1552428388,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"lib/nic-fsm.js","type":"MODIFIED","insertions":50,"deletions":-27},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":51,"sizeDeletions":-28}],"allReviewers":[{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}]}