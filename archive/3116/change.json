{"project":"joyent/illumos-joyent","branch":"master","topic":"OS-6528","id":"I50ba12892088bc014f9b26fd88cd7c8e97748cbb","number":"3116","subject":"OS-6528 Need support for mpt_sas tri-mode parts OS-6529 Clean up mpt_sas compiler warnings OS-6530 mptsas_handle_topo_change can return without its locks held OS-6531 workaround SAS3408 firmware issue","owner":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"url":"https://cr.joyent.us/3116","commitMessage":"OS-6528 Need support for mpt_sas tri-mode parts\nOS-6529 Clean up mpt_sas compiler warnings\nOS-6530 mptsas_handle_topo_change can return without its locks held\nOS-6531 workaround SAS3408 firmware issue\n","createdOn":1513383520,"lastUpdated":1513879691,"open":false,"status":"MERGED","comments":[{"timestamp":1513383520,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Uploaded patch set 1."},{"timestamp":1513383563,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Topic set to OS-6528"},{"timestamp":1513383686,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 1:\n\nNote to reviewers, the mpi header updates are basically from Broadcom. More or less imported verbatim."},{"timestamp":1513445077,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1513594544,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Patch Set 1: Code-Review+1"},{"timestamp":1513622653,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Uploaded patch set 2."},{"timestamp":1513622666,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1513624113,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 2: Code-Review+1"},{"timestamp":1513752291,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Patch Set 2: Code-Review+1 Integration-Approval+1"},{"timestamp":1513879404,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Uploaded patch set 3: Patch Set 2 was rebased."},{"timestamp":1513879691,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Robert Mustacchi"}],"currentPatchSet":{"number":"3","revision":"50ba12892088bc014f9b26fd88cd7c8e97748cbb","parents":["d5517df2d293591103685e5ac7b50ad1e807d494"],"ref":"refs/changes/16/3116/3","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1513879404,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1513624113,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1513752291,"by":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1513752291,"by":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"}},{"type":"SUBM","value":"1","grantedOn":1513879691,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"exception_lists/copyright","type":"MODIFIED","insertions":1,"deletions":-14},{"file":"exception_lists/cstyle","type":"MODIFIED","insertions":1,"deletions":-11},{"file":"exception_lists/hdrchk","type":"MODIFIED","insertions":1,"deletions":-11},{"file":"usr/src/cmd/mdb/common/modules/mpt_sas/mpt_sas.c","type":"MODIFIED","insertions":41,"deletions":-1},{"file":"usr/src/man/man7d/mpt_sas.7d","type":"MODIFIED","insertions":5,"deletions":-9},{"file":"usr/src/uts/common/io/scsi/adapters/mpt_sas/mptsas.c","type":"MODIFIED","insertions":113,"deletions":-29},{"file":"usr/src/uts/common/io/scsi/adapters/mpt_sas/mptsas_impl.c","type":"MODIFIED","insertions":60,"deletions":-12},{"file":"usr/src/uts/common/io/scsi/adapters/mpt_sas/mptsas_init.c","type":"MODIFIED","insertions":35,"deletions":-5},{"file":"usr/src/uts/common/sys/scsi/adapters/mpt_sas/mpi/mpi2.h","type":"MODIFIED","insertions":128,"deletions":-13},{"file":"usr/src/uts/common/sys/scsi/adapters/mpt_sas/mpi/mpi2_cnfg.h","type":"MODIFIED","insertions":684,"deletions":-24},{"file":"usr/src/uts/common/sys/scsi/adapters/mpt_sas/mpi/mpi2_hbd.h","type":"MODIFIED","insertions":9,"deletions":-3},{"file":"usr/src/uts/common/sys/scsi/adapters/mpt_sas/mpi/mpi2_history.txt","type":"MODIFIED","insertions":203,"deletions":-30},{"file":"usr/src/uts/common/sys/scsi/adapters/mpt_sas/mpi/mpi2_init.h","type":"MODIFIED","insertions":42,"deletions":-17},{"file":"usr/src/uts/common/sys/scsi/adapters/mpt_sas/mpi/mpi2_ioc.h","type":"MODIFIED","insertions":376,"deletions":-11},{"file":"usr/src/uts/common/sys/scsi/adapters/mpt_sas/mpi/mpi2_pci.h","type":"ADDED","insertions":147,"deletions":0},{"file":"usr/src/uts/common/sys/scsi/adapters/mpt_sas/mpi/mpi2_ra.h","type":"MODIFIED","insertions":7,"deletions":-3},{"file":"usr/src/uts/common/sys/scsi/adapters/mpt_sas/mpi/mpi2_raid.h","type":"MODIFIED","insertions":7,"deletions":-3},{"file":"usr/src/uts/common/sys/scsi/adapters/mpt_sas/mpi/mpi2_sas.h","type":"MODIFIED","insertions":12,"deletions":-3},{"file":"usr/src/uts/common/sys/scsi/adapters/mpt_sas/mpi/mpi2_targ.h","type":"MODIFIED","insertions":17,"deletions":-6},{"file":"usr/src/uts/common/sys/scsi/adapters/mpt_sas/mpi/mpi2_tool.h","type":"MODIFIED","insertions":21,"deletions":-3},{"file":"usr/src/uts/common/sys/scsi/adapters/mpt_sas/mpi/mpi2_type.h","type":"MODIFIED","insertions":7,"deletions":-3},{"file":"usr/src/uts/intel/mpt_sas/Makefile","type":"MODIFIED","insertions":0,"deletions":-2}],"sizeInsertions":1917,"sizeDeletions":-213},"patchSets":[{"number":"1","revision":"69af8ecb0e0da27c48f723566702b0718ea49ae3","parents":["fb1b55c17317bfc5bf3eb32276bf250c707246a3"],"ref":"refs/changes/16/3116/1","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1513383520,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1513594544,"by":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"}}],"comments":[{"file":"usr/src/uts/common/io/scsi/adapters/mpt_sas/mptsas_impl.c","line":2221,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Is this assert still useful to have since we handle the case of a mismatch explicitly now in the new code starting at L2231?"},{"file":"usr/src/uts/common/io/scsi/adapters/mpt_sas/mptsas_impl.c","line":2221,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"No, this should have been removed. It was only page0 that had the bug this time."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"exception_lists/copyright","type":"MODIFIED","insertions":1,"deletions":-14},{"file":"exception_lists/cstyle","type":"MODIFIED","insertions":1,"deletions":-11},{"file":"exception_lists/hdrchk","type":"MODIFIED","insertions":1,"deletions":-11},{"file":"usr/src/cmd/mdb/common/modules/mpt_sas/mpt_sas.c","type":"MODIFIED","insertions":41,"deletions":-1},{"file":"usr/src/man/man7d/mpt_sas.7d","type":"MODIFIED","insertions":5,"deletions":-9},{"file":"usr/src/uts/common/io/scsi/adapters/mpt_sas/mptsas.c","type":"MODIFIED","insertions":113,"deletions":-29},{"file":"usr/src/uts/common/io/scsi/adapters/mpt_sas/mptsas_impl.c","type":"MODIFIED","insertions":61,"deletions":-12},{"file":"usr/src/uts/common/io/scsi/adapters/mpt_sas/mptsas_init.c","type":"MODIFIED","insertions":35,"deletions":-5},{"file":"usr/src/uts/common/sys/scsi/adapters/mpt_sas/mpi/mpi2.h","type":"MODIFIED","insertions":128,"deletions":-13},{"file":"usr/src/uts/common/sys/scsi/adapters/mpt_sas/mpi/mpi2_cnfg.h","type":"MODIFIED","insertions":684,"deletions":-24},{"file":"usr/src/uts/common/sys/scsi/adapters/mpt_sas/mpi/mpi2_hbd.h","type":"MODIFIED","insertions":9,"deletions":-3},{"file":"usr/src/uts/common/sys/scsi/adapters/mpt_sas/mpi/mpi2_history.txt","type":"MODIFIED","insertions":203,"deletions":-30},{"file":"usr/src/uts/common/sys/scsi/adapters/mpt_sas/mpi/mpi2_init.h","type":"MODIFIED","insertions":42,"deletions":-17},{"file":"usr/src/uts/common/sys/scsi/adapters/mpt_sas/mpi/mpi2_ioc.h","type":"MODIFIED","insertions":376,"deletions":-11},{"file":"usr/src/uts/common/sys/scsi/adapters/mpt_sas/mpi/mpi2_pci.h","type":"ADDED","insertions":147,"deletions":0},{"file":"usr/src/uts/common/sys/scsi/adapters/mpt_sas/mpi/mpi2_ra.h","type":"MODIFIED","insertions":7,"deletions":-3},{"file":"usr/src/uts/common/sys/scsi/adapters/mpt_sas/mpi/mpi2_raid.h","type":"MODIFIED","insertions":7,"deletions":-3},{"file":"usr/src/uts/common/sys/scsi/adapters/mpt_sas/mpi/mpi2_sas.h","type":"MODIFIED","insertions":12,"deletions":-3},{"file":"usr/src/uts/common/sys/scsi/adapters/mpt_sas/mpi/mpi2_targ.h","type":"MODIFIED","insertions":17,"deletions":-6},{"file":"usr/src/uts/common/sys/scsi/adapters/mpt_sas/mpi/mpi2_tool.h","type":"MODIFIED","insertions":21,"deletions":-3},{"file":"usr/src/uts/common/sys/scsi/adapters/mpt_sas/mpi/mpi2_type.h","type":"MODIFIED","insertions":7,"deletions":-3},{"file":"usr/src/uts/intel/mpt_sas/Makefile","type":"MODIFIED","insertions":0,"deletions":-2}],"sizeInsertions":1918,"sizeDeletions":-213},{"number":"2","revision":"d2d2622ac7af0914f9631cfb1313b3677fd32949","parents":["fb1b55c17317bfc5bf3eb32276bf250c707246a3"],"ref":"refs/changes/16/3116/2","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1513622653,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1513624113,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1513752291,"by":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1513752291,"by":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"exception_lists/copyright","type":"MODIFIED","insertions":1,"deletions":-14},{"file":"exception_lists/cstyle","type":"MODIFIED","insertions":1,"deletions":-11},{"file":"exception_lists/hdrchk","type":"MODIFIED","insertions":1,"deletions":-11},{"file":"usr/src/cmd/mdb/common/modules/mpt_sas/mpt_sas.c","type":"MODIFIED","insertions":41,"deletions":-1},{"file":"usr/src/man/man7d/mpt_sas.7d","type":"MODIFIED","insertions":5,"deletions":-9},{"file":"usr/src/uts/common/io/scsi/adapters/mpt_sas/mptsas.c","type":"MODIFIED","insertions":113,"deletions":-29},{"file":"usr/src/uts/common/io/scsi/adapters/mpt_sas/mptsas_impl.c","type":"MODIFIED","insertions":60,"deletions":-12},{"file":"usr/src/uts/common/io/scsi/adapters/mpt_sas/mptsas_init.c","type":"MODIFIED","insertions":35,"deletions":-5},{"file":"usr/src/uts/common/sys/scsi/adapters/mpt_sas/mpi/mpi2.h","type":"MODIFIED","insertions":128,"deletions":-13},{"file":"usr/src/uts/common/sys/scsi/adapters/mpt_sas/mpi/mpi2_cnfg.h","type":"MODIFIED","insertions":684,"deletions":-24},{"file":"usr/src/uts/common/sys/scsi/adapters/mpt_sas/mpi/mpi2_hbd.h","type":"MODIFIED","insertions":9,"deletions":-3},{"file":"usr/src/uts/common/sys/scsi/adapters/mpt_sas/mpi/mpi2_history.txt","type":"MODIFIED","insertions":203,"deletions":-30},{"file":"usr/src/uts/common/sys/scsi/adapters/mpt_sas/mpi/mpi2_init.h","type":"MODIFIED","insertions":42,"deletions":-17},{"file":"usr/src/uts/common/sys/scsi/adapters/mpt_sas/mpi/mpi2_ioc.h","type":"MODIFIED","insertions":376,"deletions":-11},{"file":"usr/src/uts/common/sys/scsi/adapters/mpt_sas/mpi/mpi2_pci.h","type":"ADDED","insertions":147,"deletions":0},{"file":"usr/src/uts/common/sys/scsi/adapters/mpt_sas/mpi/mpi2_ra.h","type":"MODIFIED","insertions":7,"deletions":-3},{"file":"usr/src/uts/common/sys/scsi/adapters/mpt_sas/mpi/mpi2_raid.h","type":"MODIFIED","insertions":7,"deletions":-3},{"file":"usr/src/uts/common/sys/scsi/adapters/mpt_sas/mpi/mpi2_sas.h","type":"MODIFIED","insertions":12,"deletions":-3},{"file":"usr/src/uts/common/sys/scsi/adapters/mpt_sas/mpi/mpi2_targ.h","type":"MODIFIED","insertions":17,"deletions":-6},{"file":"usr/src/uts/common/sys/scsi/adapters/mpt_sas/mpi/mpi2_tool.h","type":"MODIFIED","insertions":21,"deletions":-3},{"file":"usr/src/uts/common/sys/scsi/adapters/mpt_sas/mpi/mpi2_type.h","type":"MODIFIED","insertions":7,"deletions":-3},{"file":"usr/src/uts/intel/mpt_sas/Makefile","type":"MODIFIED","insertions":0,"deletions":-2}],"sizeInsertions":1917,"sizeDeletions":-213},{"number":"3","revision":"50ba12892088bc014f9b26fd88cd7c8e97748cbb","parents":["d5517df2d293591103685e5ac7b50ad1e807d494"],"ref":"refs/changes/16/3116/3","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1513879404,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"SUBM","value":"1","grantedOn":1513879691,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1513624113,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1513752291,"by":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1513752291,"by":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"exception_lists/copyright","type":"MODIFIED","insertions":1,"deletions":-14},{"file":"exception_lists/cstyle","type":"MODIFIED","insertions":1,"deletions":-11},{"file":"exception_lists/hdrchk","type":"MODIFIED","insertions":1,"deletions":-11},{"file":"usr/src/cmd/mdb/common/modules/mpt_sas/mpt_sas.c","type":"MODIFIED","insertions":41,"deletions":-1},{"file":"usr/src/man/man7d/mpt_sas.7d","type":"MODIFIED","insertions":5,"deletions":-9},{"file":"usr/src/uts/common/io/scsi/adapters/mpt_sas/mptsas.c","type":"MODIFIED","insertions":113,"deletions":-29},{"file":"usr/src/uts/common/io/scsi/adapters/mpt_sas/mptsas_impl.c","type":"MODIFIED","insertions":60,"deletions":-12},{"file":"usr/src/uts/common/io/scsi/adapters/mpt_sas/mptsas_init.c","type":"MODIFIED","insertions":35,"deletions":-5},{"file":"usr/src/uts/common/sys/scsi/adapters/mpt_sas/mpi/mpi2.h","type":"MODIFIED","insertions":128,"deletions":-13},{"file":"usr/src/uts/common/sys/scsi/adapters/mpt_sas/mpi/mpi2_cnfg.h","type":"MODIFIED","insertions":684,"deletions":-24},{"file":"usr/src/uts/common/sys/scsi/adapters/mpt_sas/mpi/mpi2_hbd.h","type":"MODIFIED","insertions":9,"deletions":-3},{"file":"usr/src/uts/common/sys/scsi/adapters/mpt_sas/mpi/mpi2_history.txt","type":"MODIFIED","insertions":203,"deletions":-30},{"file":"usr/src/uts/common/sys/scsi/adapters/mpt_sas/mpi/mpi2_init.h","type":"MODIFIED","insertions":42,"deletions":-17},{"file":"usr/src/uts/common/sys/scsi/adapters/mpt_sas/mpi/mpi2_ioc.h","type":"MODIFIED","insertions":376,"deletions":-11},{"file":"usr/src/uts/common/sys/scsi/adapters/mpt_sas/mpi/mpi2_pci.h","type":"ADDED","insertions":147,"deletions":0},{"file":"usr/src/uts/common/sys/scsi/adapters/mpt_sas/mpi/mpi2_ra.h","type":"MODIFIED","insertions":7,"deletions":-3},{"file":"usr/src/uts/common/sys/scsi/adapters/mpt_sas/mpi/mpi2_raid.h","type":"MODIFIED","insertions":7,"deletions":-3},{"file":"usr/src/uts/common/sys/scsi/adapters/mpt_sas/mpi/mpi2_sas.h","type":"MODIFIED","insertions":12,"deletions":-3},{"file":"usr/src/uts/common/sys/scsi/adapters/mpt_sas/mpi/mpi2_targ.h","type":"MODIFIED","insertions":17,"deletions":-6},{"file":"usr/src/uts/common/sys/scsi/adapters/mpt_sas/mpi/mpi2_tool.h","type":"MODIFIED","insertions":21,"deletions":-3},{"file":"usr/src/uts/common/sys/scsi/adapters/mpt_sas/mpi/mpi2_type.h","type":"MODIFIED","insertions":7,"deletions":-3},{"file":"usr/src/uts/intel/mpt_sas/Makefile","type":"MODIFIED","insertions":0,"deletions":-2}],"sizeInsertions":1917,"sizeDeletions":-213}],"allReviewers":[{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}]}