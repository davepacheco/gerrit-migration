{"project":"joyent/illumos-joyent","branch":"master","id":"I9c78fec9bbf9d3887166ba5cb4678f16a7b5a47d","number":"3630","subject":"OS-6716 bhyve guest VCPUs pause intermittently Reviewed by: John Levon \u003cjohn.levon@joyent.com\u003e Reviewed by: Bryan Cantrill \u003cbryan@joyent.com\u003e Approved by: Bryan Cantrill \u003cbryan@joyent.com\u003e","owner":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"url":"https://cr.joyent.us/3630","commitMessage":"OS-6716 bhyve guest VCPUs pause intermittently\nReviewed by: John Levon \u003cjohn.levon@joyent.com\u003e\nReviewed by: Bryan Cantrill \u003cbryan@joyent.com\u003e\nApproved by: Bryan Cantrill \u003cbryan@joyent.com\u003e\n","createdOn":1521054401,"lastUpdated":1521064250,"open":false,"status":"MERGED","comments":[{"timestamp":1521054401,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 1."},{"timestamp":1521054491,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 1:\n\nThis is effectively FreeBSD\u0027s fix, with follow-up INVARIANTS update too.  It also includes a custom patch which protects the vmcs_read of the INTR_STATUS information to only systems which are using posted interrupts.  (It avoids panics we saw on vmware fusion)"},{"timestamp":1521054619,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1521054654,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 1:\n\nI had joshw test on his laptop which was experiencing the vmcs_read panics with the prior fix.  With the updated protection, it seemed to work fine."},{"timestamp":1521054723,"reviewer":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"message":"Patch Set 1:\n\n(2 comments)\n\nMinor comment nits."},{"timestamp":1521054918,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1521055399,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 1: Code-Review+1"},{"timestamp":1521063631,"reviewer":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"message":"Patch Set 1: Code-Review+1 Integration-Approval+1\n\n(1 comment)"},{"timestamp":1521064222,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 2: Commit message was updated."},{"timestamp":1521064250,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Patrick Mooney"}],"currentPatchSet":{"number":"2","revision":"9c78fec9bbf9d3887166ba5cb4678f16a7b5a47d","parents":["ea521b0a8f47a63c4e2209c44b1fb8cce70e8474"],"ref":"refs/changes/30/3630/2","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1521064222,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1521055399,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1521063631,"by":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1521063631,"by":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"}},{"type":"SUBM","value":"1","grantedOn":1521064250,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/intel/vmx.c","type":"MODIFIED","insertions":28,"deletions":-5},{"file":"usr/src/uts/i86pc/sys/vmm.h","type":"MODIFIED","insertions":1,"deletions":0}],"sizeInsertions":29,"sizeDeletions":-5},"patchSets":[{"number":"1","revision":"c7aeca73f324b3f1eca5f4c5dc2537fc41626f87","parents":["ea521b0a8f47a63c4e2209c44b1fb8cce70e8474"],"ref":"refs/changes/30/3630/1","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1521054401,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1521063631,"by":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1521063631,"by":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1521055399,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"comments":[{"file":"usr/src/uts/i86pc/io/vmm/intel/vmx.c","line":2451,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"This conditional is where we diverge from upstream."},{"file":"usr/src/uts/i86pc/io/vmm/intel/vmx.c","line":3368,"reviewer":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"message":"Should be two words"},{"file":"usr/src/uts/i86pc/io/vmm/intel/vmx.c","line":3368,"reviewer":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"message":"Add a comma?"},{"file":"usr/src/uts/i86pc/io/vmm/intel/vmx.c","line":3368,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"This comment is from upstream.  I\u0027m inclined to let it be."},{"file":"usr/src/uts/i86pc/io/vmm/intel/vmx.c","line":3368,"reviewer":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"message":"Blargh -- and agreed. :|"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/intel/vmx.c","type":"MODIFIED","insertions":28,"deletions":-5},{"file":"usr/src/uts/i86pc/sys/vmm.h","type":"MODIFIED","insertions":1,"deletions":0}],"sizeInsertions":29,"sizeDeletions":-5},{"number":"2","revision":"9c78fec9bbf9d3887166ba5cb4678f16a7b5a47d","parents":["ea521b0a8f47a63c4e2209c44b1fb8cce70e8474"],"ref":"refs/changes/30/3630/2","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1521064222,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1521063631,"by":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1521063631,"by":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"}},{"type":"SUBM","value":"1","grantedOn":1521064250,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1521055399,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/intel/vmx.c","type":"MODIFIED","insertions":28,"deletions":-5},{"file":"usr/src/uts/i86pc/sys/vmm.h","type":"MODIFIED","insertions":1,"deletions":0}],"sizeInsertions":29,"sizeDeletions":-5}],"allReviewers":[{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}]}