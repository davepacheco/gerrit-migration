{"project":"joyent/illumos-joyent","branch":"master","id":"I5fb489bf75c4df330ca23de97c180928523ee107","number":"6758","subject":"OS-7907 PCI ID ambiguity leads to driver induced mayhem Reviewed by: John Levon \u003cjohn.levon@joyent.com\u003e Reviewed by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e Approved by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e","owner":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"url":"https://cr.joyent.us/6758","commitMessage":"OS-7907 PCI ID ambiguity leads to driver induced mayhem\nReviewed by: John Levon \u003cjohn.levon@joyent.com\u003e\nReviewed by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e\nApproved by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e\n","createdOn":1565115414,"lastUpdated":1565793582,"open":false,"status":"MERGED","comments":[{"timestamp":1565115414,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Uploaded patch set 1."},{"timestamp":1565115456,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 1:\n\nFor additional information on the approach, please see IPD 9 (https://github.com/illumos/ipd/blob/master/ipd/0009/README.md)."},{"timestamp":1565364555,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 1:\n\n(5 comments)\n\nThink I might have got the wrong end of the stick here as I couldn\u0027t follow these changes.\n\nOn a related note: did you look at whether the upstream tooling is OK with the new suffixes? Especially pkg manifests?\n\nI take it we\u0027re going to have a new rule of no added pci aliases that lack the suffix. Is it worth adding a pbchk or something for that?"},{"timestamp":1565375663,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 1:\n\n(5 comments)\n\n\u003e (5 comments)\n \u003e \n \u003e Think I might have got the wrong end of the stick here as I\n \u003e couldn\u0027t follow these changes.\n\nNo, I did slapdash work. Sorry. Hopefully this is clearer.\n\n \u003e On a related note: did you look at whether the upstream tooling is\n \u003e OK with the new suffixes? Especially pkg manifests?\n\nI\u0027ve verified that IPS doesn\u0027t care.\n\n \u003e I take it we\u0027re going to have a new rule of no added pci aliases\n \u003e that lack the suffix. Is it worth adding a pbchk or something for\n \u003e that?\n\nI\u0027m not sure how to effectively write that pbchk rule since pbchk today doesn\u0027t look at diffs but looks at the existing files. It\u0027s not wrong for us to have the current ones."},{"timestamp":1565383635,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1565385859,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Uploaded patch set 2."},{"timestamp":1565385864,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1565386163,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 2: Code-Review+1"},{"timestamp":1565387236,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 2:\n\n(1 comment)\n\nSorry, one small nit"},{"timestamp":1565392323,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Uploaded patch set 3."},{"timestamp":1565392335,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1565427078,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1565738544,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 3: Integration-Approval+1"},{"timestamp":1565782243,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1565793464,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Uploaded patch set 4: Patch Set 3 was rebased."},{"timestamp":1565793559,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Uploaded patch set 5: Commit message was updated."},{"timestamp":1565793582,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Robert Mustacchi"}],"currentPatchSet":{"number":"5","revision":"5fb489bf75c4df330ca23de97c180928523ee107","parents":["8d38846690a3922081ad4c8a4fb3c4faf4d8016b"],"ref":"refs/changes/58/6758/5","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1565793559,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1565427078,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1565738544,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1565782243,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"SUBM","value":"1","grantedOn":1565793582,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/uts/intel/io/pci/pci_boot.c","type":"MODIFIED","insertions":44,"deletions":-11},{"file":"usr/src/uts/intel/os/driver_aliases","type":"MODIFIED","insertions":79,"deletions":-79},{"file":"usr/src/uts/sun4/io/pcicfg.c","type":"MODIFIED","insertions":27,"deletions":-19}],"sizeInsertions":150,"sizeDeletions":-109},"patchSets":[{"number":"1","revision":"50716fb46a9add5c54bbe2b62272c3e5113e091b","parents":["31891197ecb87e2742aca4828b47451926228841"],"ref":"refs/changes/58/6758/1","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1565115414,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/uts/intel/io/pci/pci_boot.c","line":2175,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Is this a belt-and-braces thing? Isn\u0027t the purpose of adding the imcstub suffix so we *don\u0027t* need to add this exception?"},{"file":"usr/src/uts/intel/io/pci/pci_boot.c","line":2175,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Yes, it\u0027s a belt and suspenders thing. I\u0027d prefer to leave it if that\u0027s OK?"},{"file":"usr/src/uts/intel/io/pci/pci_boot.c","line":2209,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"I realize this sentence pre-dates your work here, but I can\u0027t really understand it. Perhaps you could clarify this since you\u0027re making changes here anyway? It is up to you though."},{"file":"usr/src/uts/intel/io/pci/pci_boot.c","line":2209,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"},{"file":"usr/src/uts/intel/io/pci/pci_boot.c","line":2211,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"\"property\""},{"file":"usr/src/uts/intel/io/pci/pci_boot.c","line":2211,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"},{"file":"usr/src/uts/intel/io/pci/pci_boot.c","line":2212,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"I think these last two sentences could be made clearer. Perhaps by explicitly describing the ,s and ,p suffixes and what they mean."},{"file":"usr/src/uts/intel/io/pci/pci_boot.c","line":2212,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Is the new form better?"},{"file":"usr/src/uts/intel/io/pci/pci_boot.c","line":2304,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"doesn\u0027t this need a \",p\" ?"},{"file":"usr/src/uts/intel/io/pci/pci_boot.c","line":2304,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"},{"file":"usr/src/uts/intel/os/driver_aliases","line":585,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"shouldn\u0027t these all be \",p\" ?"},{"file":"usr/src/uts/intel/os/driver_aliases","line":585,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Yes!"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/intel/io/pci/pci_boot.c","type":"MODIFIED","insertions":39,"deletions":-8},{"file":"usr/src/uts/intel/os/driver_aliases","type":"MODIFIED","insertions":79,"deletions":-79},{"file":"usr/src/uts/sun4/io/pcicfg.c","type":"MODIFIED","insertions":27,"deletions":-19}],"sizeInsertions":145,"sizeDeletions":-106},{"number":"2","revision":"44892ef9d2b219431a1a2c06ab4c39a84c243a55","parents":["31891197ecb87e2742aca4828b47451926228841"],"ref":"refs/changes/58/6758/2","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1565385859,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1565386163,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"comments":[{"file":"usr/src/uts/intel/io/pci/pci_boot.c","line":2215,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"\"we add a suffix\""},{"file":"usr/src/uts/intel/io/pci/pci_boot.c","line":2215,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/intel/io/pci/pci_boot.c","type":"MODIFIED","insertions":44,"deletions":-11},{"file":"usr/src/uts/intel/os/driver_aliases","type":"MODIFIED","insertions":79,"deletions":-79},{"file":"usr/src/uts/sun4/io/pcicfg.c","type":"MODIFIED","insertions":27,"deletions":-19}],"sizeInsertions":150,"sizeDeletions":-109},{"number":"3","revision":"ec48d47be77ef968142a3fa4872da9f37d141f4e","parents":["31891197ecb87e2742aca4828b47451926228841"],"ref":"refs/changes/58/6758/3","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1565392323,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1565782243,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1565738544,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1565427078,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/intel/io/pci/pci_boot.c","type":"MODIFIED","insertions":44,"deletions":-11},{"file":"usr/src/uts/intel/os/driver_aliases","type":"MODIFIED","insertions":79,"deletions":-79},{"file":"usr/src/uts/sun4/io/pcicfg.c","type":"MODIFIED","insertions":27,"deletions":-19}],"sizeInsertions":150,"sizeDeletions":-109},{"number":"4","revision":"f81ebc7ac3cb8f0265da9d0314294c8510e0b009","parents":["8d38846690a3922081ad4c8a4fb3c4faf4d8016b"],"ref":"refs/changes/58/6758/4","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1565793464,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1565782243,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1565738544,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1565427078,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/intel/io/pci/pci_boot.c","type":"MODIFIED","insertions":44,"deletions":-11},{"file":"usr/src/uts/intel/os/driver_aliases","type":"MODIFIED","insertions":79,"deletions":-79},{"file":"usr/src/uts/sun4/io/pcicfg.c","type":"MODIFIED","insertions":27,"deletions":-19}],"sizeInsertions":150,"sizeDeletions":-109},{"number":"5","revision":"5fb489bf75c4df330ca23de97c180928523ee107","parents":["8d38846690a3922081ad4c8a4fb3c4faf4d8016b"],"ref":"refs/changes/58/6758/5","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1565793559,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"SUBM","value":"1","grantedOn":1565793582,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1565782243,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1565738544,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1565427078,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/uts/intel/io/pci/pci_boot.c","type":"MODIFIED","insertions":44,"deletions":-11},{"file":"usr/src/uts/intel/os/driver_aliases","type":"MODIFIED","insertions":79,"deletions":-79},{"file":"usr/src/uts/sun4/io/pcicfg.c","type":"MODIFIED","insertions":27,"deletions":-19}],"sizeInsertions":150,"sizeDeletions":-109}],"allReviewers":[{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}]}