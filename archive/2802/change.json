{"project":"joyent/manta-mola","branch":"master","id":"Ieda6c13aaa408ba4c375fd97b6de2f771d19d467","number":"2802","subject":"MANTA-3226 Manta garbage collection needs to support multipart uploads Reviewed by: Kody A Kantor \u003ckody.kantor@gmail.com\u003e Approved by: Joshua M. Clulow \u003cjmc@joyent.com\u003e","owner":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"url":"https://cr.joyent.us/2802","commitMessage":"MANTA-3226 Manta garbage collection needs to support multipart uploads\nReviewed by: Kody A Kantor \u003ckody.kantor@gmail.com\u003e\nApproved by: Joshua M. Clulow \u003cjmc@joyent.com\u003e\n","createdOn":1508289102,"lastUpdated":1523384815,"open":false,"status":"MERGED","comments":[{"timestamp":1508289102,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Uploaded patch set 1."},{"timestamp":1508289130,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing-1\n\n(6 comments)\n\n\"make check\" exited with status 2"},{"timestamp":1508289188,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Uploaded patch set 2."},{"timestamp":1508289391,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing-1\n\n(1 comment)\n\n\"make check\" exited with status 2"},{"timestamp":1508292403,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Uploaded patch set 3."},{"timestamp":1508292431,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1508355629,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Uploaded patch set 4."},{"timestamp":1508355677,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1508355892,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Uploaded patch set 5."},{"timestamp":1508355922,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing-1\n\n(2 comments)\n\n\"make check\" exited with status 2"},{"timestamp":1508356417,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Uploaded patch set 6."},{"timestamp":1508356442,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 6: CI-Testing-1\n\n(2 comments)\n\n\"make check\" exited with status 2"},{"timestamp":1508356611,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Uploaded patch set 7."},{"timestamp":1508356642,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 7: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1508357457,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Patch Set 7:\n\nThis is a pretty big change. I would like to create a new document describing how MPU GC works, similar to the GC overview doc shipped in this repo. I will start working on putting that together next, and add it to the CR.\n\nThat said, if folks are interested in starting to review now, that\u0027s also fine. This change is dependent on two other changes that have not yet intergrated: joyent/node-jsprim#24 (for the tests), and MANTA-3350."},{"timestamp":1508391227,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Uploaded patch set 8."},{"timestamp":1508391253,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 8: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1508416294,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Patch Set 8:\n\nNote to reviewers: I am still working on cleaning up the cleanup script that carries out the second phase of the job (right now it\u0027s very hacked together and not cleaned up in terms of code comments and operability much).\n\nStill, given that I\u0027m going to be out until Monday, I would appreciate eyes sooner, if you have time. Here are my recommendations about how to read through this:\n\nFor a high-level overview, I would start with docs/mpu-gc-overview.md. Then I would take a look at the structures in lib/mpu/common.js, as well as the function `recordToObject`, to understand how MPUs are represented internally throughout the GC process.\n\nFrom there, I would look at the Marlin phase of the job, which uses, roughly in order:\n- bin/kick_off_mpu_gc.js\n- bin/mpu_pg_gc_transform.js\n- lib/mpu_gc_pg_row_transformer.js\n- bin/mpu_gc.js\n- lib/mpu_garbage_collector.js\n\nNext, there\u0027s the cleanup script side of things. The cleanup script itself, bin/kick_off_mpu_cleanup.js, is currently very rough and probably not worth reviewing in detail beyond to get a sense of how ti works. (It is very, very rough in this CR right now.)\n\nThe code the cleanup script calls into is much cleaner. I would visit those files next:\n- lib/mpu/mpuBatchStream.js\n- lib/mpu/mpuVerifyStream.js\n- lib/mpu/mpuUnlinkLiveRecordStream.js\n- lib/mpu/mpuMorayCleanerStream.js\n\nThose streams all have associated test files in test/mpu, as does the mpu_garbage_collector.js file.\n\nFinally, you can look at the image setup portion of the CR, which includes boots/setup.sh and the sapi manifest template.\n\nThanks for reviewing! Please let me know if you need any assistance navigating these files. There are a lot of them."},{"timestamp":1508882942,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 8:\n\n(24 comments)\n\nI haven\u0027t looked at the meaty files yet (most of lib/ or the tests), but here are a few small things. Thanks Jordan!"},{"timestamp":1509154777,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Uploaded patch set 9."},{"timestamp":1509154803,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 9: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1509154890,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Patch Set 9:\n\nPatchset 9 is cleaned up quite a bit, but I haven\u0027t gotten to Kody\u0027s feedback yet. In particular, the bin/kick_off_mpu_cleanup.js script is much less terrible. ;)\n\nI also fixed a couple issues I found when deploying this as an image. I built an image of this version and am leaving it in my lab environment over the weekend. I\u0027ll check in on Monday to fix any bugs I find."},{"timestamp":1509475783,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 9:\n\n(14 comments)\n\nJust a few more comments. I\u0027m going to start looking at the actual cleanup steps now (kick_off_mpu_cleanup.js and the files it consumes in lib/mpu)."},{"timestamp":1509551163,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 9:\n\n(22 comments)\n\nCool! I\u0027ve made it through everything except the tests at this point. Sorry for the delay in reviewing - this took longer than I expected because I had to figure out how a lot of things worked."},{"timestamp":1509657995,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Uploaded patch set 10."},{"timestamp":1509658022,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 10: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1509658091,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Patch Set 10:\n\n(37 comments)\n\nPatchset 10 addresses Kody\u0027s first two rounds of feedback. I\u0027m still working through the third set (thanks for the reviews so far, Kody!).\n\nI also refactored the cleanup script a bit to print a more useful summary message in its logs, so that it doesn\u0027t have to be constructed from other entries."},{"timestamp":1509732341,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Uploaded patch set 11."},{"timestamp":1509732368,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 11: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1509732379,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Patch Set 10:\n\nPatchset 11 fixes issues introduced during refactoring that caused the automated tests to fail."},{"timestamp":1509732426,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Patch Set 11:\n\nPatchset 11 fixes issues introduced during refactoring that caused the automated tests to fail.\n\n(Reposted because I accidentally pasted this on patchset 10 comments.)"},{"timestamp":1510183186,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 11:\n\n(5 comments)\n\nI like the changes you\u0027ve made so far. It look like there are still a few things you haven\u0027t gotten to, so I\u0027ll hold off on writing more comments."},{"timestamp":1512435347,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Uploaded patch set 12."},{"timestamp":1512435375,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 12: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1512435499,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Patch Set 12:\n\n(20 comments)\n\nI believe I\u0027ve gotten to all of Kody\u0027s feedback in this latest patchset (PS 12). Feel free to let me know if I missed something!\n\nI\u0027ve also added a concurrency flag to the cleanup script to prevent us from instantiating as many PipelineStreams as there are shards, as PipelineStreams can consume a lot of memory."},{"timestamp":1512437166,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Patch Set 12:\n\n(1 comment)"},{"timestamp":1512605456,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 12:\n\n(12 comments)"},{"timestamp":1513373997,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Uploaded patch set 13."},{"timestamp":1513374025,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 13: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1513374376,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Patch Set 13:\n\n(7 comments)\n\nPS 13 addresses the rest of Kody\u0027s feedback. It also pulls in some recent changes from mola master.\n\nIn addition, I\u0027ve added flags to the cleanup script that I\u0027ve found useful for and made it such that the script prevents instruction files passed as input using `-r` from being unlinked from Manta. I added an additional test object for the streams test for a bug I found in a previous patchset related to how owner uuids were looked up in the cleanup stream pipeline (and PS 13 includes the fix for that bug)."},{"timestamp":1513700001,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 13: Code-Review+1\n\n(3 comments)\n\nLooks good! Thanks!"},{"timestamp":1513733050,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Uploaded patch set 14."},{"timestamp":1513733087,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Patch Set 14:\n\n(2 comments)"},{"timestamp":1513733112,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 14: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1513789395,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 14: Code-Review+1\n\n(1 comment)"},{"timestamp":1515022199,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Uploaded patch set 15."},{"timestamp":1515022227,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 15: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1515022305,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Patch Set 15:\n\nPS 15 updates the copyrights on the changed files to 2018. I also added a bit more information to an error log message in lib/mpu/mpuUnlinkLiveRecordStream.js that I found would\u0027ve been useful in debugging."},{"timestamp":1515023311,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 15: Code-Review+1"},{"timestamp":1515457696,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Patch Set 15:\n\nFor IA, I\u0027ve added testing notes to the ticket."},{"timestamp":1523316119,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Uploaded patch set 16."},{"timestamp":1523316148,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 16: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1523316195,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Patch Set 16:\n\nPS 16 is a non-trivial rebase -- master and this change had a merge conflict in package.json."},{"timestamp":1523316261,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 16: Code-Review+1"},{"timestamp":1523384699,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Patch Set 16: Integration-Approval+1\n\nThe testing notes in the ticket (and many linked tickets and documents) are extremely impressive and an example to us all.  Thank you for the herculean effort in testing and verification -- I approve!"},{"timestamp":1523384786,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Uploaded patch set 17: Commit message was updated."},{"timestamp":1523384815,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Jordan Hendricks"}],"currentPatchSet":{"number":"17","revision":"eda6c13aaa408ba4c375fd97b6de2f771d19d467","parents":["76ffd1a35b05ef47071162a7ffe932dcf8ea95fd"],"ref":"refs/changes/02/2802/17","uploader":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"createdOn":1523384786,"author":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1523316148,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1523316261,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1523384699,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}},{"type":"SUBM","value":"1","grantedOn":1523384815,"by":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"bin/gc_links.pl","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"bin/kick_off_mpu_cleanup.js","type":"ADDED","insertions":1081,"deletions":0},{"file":"bin/kick_off_mpu_gc.js","type":"ADDED","insertions":371,"deletions":0},{"file":"bin/mdemux.js","type":"MODIFIED","insertions":8,"deletions":-3},{"file":"bin/mpu_gc.js","type":"ADDED","insertions":83,"deletions":0},{"file":"bin/mpu_gc_pg_transform.js","type":"ADDED","insertions":107,"deletions":0},{"file":"boot/setup.sh","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"docs/gc-overview.md","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"docs/mpu-gc-overview.md","type":"ADDED","insertions":210,"deletions":0},{"file":"docs/system-crons.md","type":"MODIFIED","insertions":13,"deletions":-1},{"file":"lib/common.js","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"lib/index.js","type":"MODIFIED","insertions":30,"deletions":-1},{"file":"lib/moray_cleaner.js","type":"MODIFIED","insertions":13,"deletions":-3},{"file":"lib/mpu/common.js","type":"ADDED","insertions":228,"deletions":0},{"file":"lib/mpu/index.js","type":"ADDED","insertions":38,"deletions":0},{"file":"lib/mpu/mpuBatchStream.js","type":"ADDED","insertions":200,"deletions":0},{"file":"lib/mpu/mpuMorayCleanerStream.js","type":"ADDED","insertions":181,"deletions":0},{"file":"lib/mpu/mpuUnlinkLiveRecordStream.js","type":"ADDED","insertions":230,"deletions":0},{"file":"lib/mpu/mpuVerifyStream.js","type":"ADDED","insertions":235,"deletions":0},{"file":"lib/mpu_garbage_collector.js","type":"ADDED","insertions":171,"deletions":0},{"file":"lib/mpu_gc_pg_row_transformer.js","type":"ADDED","insertions":153,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"sapi_manifests/mola/template","type":"MODIFIED","insertions":7,"deletions":0},{"file":"test/mpu/mpuBatchStream.test.js","type":"ADDED","insertions":227,"deletions":0},{"file":"test/mpu/mpuMorayCleanerStream.test.js","type":"ADDED","insertions":259,"deletions":0},{"file":"test/mpu/mpuUnlinkLiveRecordStream.test.js","type":"ADDED","insertions":1167,"deletions":0},{"file":"test/mpu/mpuVerifyStream.test.js","type":"ADDED","insertions":829,"deletions":0},{"file":"test/mpu/testInputs.js","type":"ADDED","insertions":320,"deletions":0},{"file":"test/mpu_garbage_collector.test.js","type":"ADDED","insertions":1238,"deletions":0}],"sizeInsertions":7419,"sizeDeletions":-20},"patchSets":[{"number":"1","revision":"6bea44ed942f39ba683c2fb193476b2467faf673","parents":["4b8b2975f0b7b70fc2dfc402910ee2c5f3ce0c6f"],"ref":"refs/changes/02/2802/1","uploader":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"createdOn":1508289102,"author":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1508289130,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"bin/mpu_moray_gc.js","line":52,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"line \u003e 80 characters"},{"file":"bin/mpu_moray_gc.js","line":53,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"line \u003e 80 characters"},{"file":"lib/mpu/mpuUnlinkLiveRecordStream.js","line":64,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"line \u003e 80 characters"},{"file":"lib/mpu/mpuUnlinkLiveRecordStream.js","line":128,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"line \u003e 80 characters"},{"file":"lib/mpu/mpuUnlinkLiveRecordStream.js","line":138,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"line \u003e 80 characters"},{"file":"lib/mpu/mpuUnlinkLiveRecordStream.js","line":156,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"line \u003e 80 characters"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"bin/gc_create_links.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"bin/gc_links.pl","type":"MODIFIED","insertions":1,"deletions":-2},{"file":"bin/kick_off_mpu_gc.js","type":"ADDED","insertions":357,"deletions":0},{"file":"bin/mdemux.js","type":"MODIFIED","insertions":7,"deletions":-2},{"file":"bin/moray_gc.js","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"bin/mpu_gc.js","type":"ADDED","insertions":74,"deletions":0},{"file":"bin/mpu_gc_links.pl","type":"ADDED","insertions":50,"deletions":0},{"file":"bin/mpu_gc_pg_transform.js","type":"ADDED","insertions":100,"deletions":0},{"file":"bin/mpu_gc_transform.js","type":"ADDED","insertions":100,"deletions":0},{"file":"bin/mpu_moray_gc.js","type":"ADDED","insertions":88,"deletions":0},{"file":"config.json","type":"ADDED","insertions":20,"deletions":0},{"file":"docs/gc-overview.md","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/index.js","type":"MODIFIED","insertions":29,"deletions":0},{"file":"lib/moray_cleaner.js","type":"MODIFIED","insertions":12,"deletions":-2},{"file":"lib/mpu/common.js","type":"ADDED","insertions":246,"deletions":0},{"file":"lib/mpu/mpuBatchStream.js","type":"ADDED","insertions":170,"deletions":0},{"file":"lib/mpu/mpuMorayCleanerStream.js","type":"ADDED","insertions":99,"deletions":0},{"file":"lib/mpu/mpuUnlinkLiveRecordStream.js","type":"ADDED","insertions":177,"deletions":0},{"file":"lib/mpu/mpuVerifyStream.js","type":"ADDED","insertions":157,"deletions":0},{"file":"lib/mpu_garbage_collector.js","type":"ADDED","insertions":110,"deletions":0},{"file":"lib/mpu_gc_pg_row_transformer.js","type":"ADDED","insertions":157,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":0},{"file":"sapi_manifests/mola/template","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"script.sh","type":"ADDED","insertions":7,"deletions":0}],"sizeInsertions":1976,"sizeDeletions":-10},{"number":"2","revision":"775532e0f44c0cabd241f9df75724d9f2d4eb99b","parents":["4b8b2975f0b7b70fc2dfc402910ee2c5f3ce0c6f"],"ref":"refs/changes/02/2802/2","uploader":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"createdOn":1508289188,"author":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1508289391,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/mpu/common.js","line":84,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"line \u003e 80 characters"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"bin/gc_create_links.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"bin/gc_links.pl","type":"MODIFIED","insertions":1,"deletions":-2},{"file":"bin/kick_off_mpu_gc.js","type":"ADDED","insertions":356,"deletions":0},{"file":"bin/mdemux.js","type":"MODIFIED","insertions":7,"deletions":-2},{"file":"bin/moray_gc.js","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"bin/mpu_gc.js","type":"ADDED","insertions":70,"deletions":0},{"file":"bin/mpu_gc_pg_transform.js","type":"ADDED","insertions":103,"deletions":0},{"file":"bin/mpu_gc_transform.js","type":"ADDED","insertions":104,"deletions":0},{"file":"boot/setup.sh","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"config.json","type":"ADDED","insertions":20,"deletions":0},{"file":"docs/gc-overview.md","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/index.js","type":"MODIFIED","insertions":29,"deletions":0},{"file":"lib/moray_cleaner.js","type":"MODIFIED","insertions":12,"deletions":-2},{"file":"lib/mpu/common.js","type":"ADDED","insertions":281,"deletions":0},{"file":"lib/mpu/index.js","type":"ADDED","insertions":38,"deletions":0},{"file":"lib/mpu/mpuBatchStream.js","type":"ADDED","insertions":174,"deletions":0},{"file":"lib/mpu/mpuMorayCleanerStream.js","type":"ADDED","insertions":137,"deletions":0},{"file":"lib/mpu/mpuUnlinkLiveRecordStream.js","type":"ADDED","insertions":186,"deletions":0},{"file":"lib/mpu/mpuVerifyStream.js","type":"ADDED","insertions":165,"deletions":0},{"file":"lib/mpu_garbage_collector.js","type":"ADDED","insertions":129,"deletions":0},{"file":"lib/mpu_gc_pg_row_transformer.js","type":"ADDED","insertions":170,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":0},{"file":"sapi_manifests/mola/template","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"script.sh","type":"ADDED","insertions":7,"deletions":0},{"file":"test/mpu/.mpuBatchStream.test.js.swp","type":"ADDED","insertions":0,"deletions":0},{"file":"test/mpu/.mpuUnlinkLiveRecordStream.test.js.swp","type":"ADDED","insertions":0,"deletions":0},{"file":"test/mpu/mpuBatchStream.test.js","type":"ADDED","insertions":227,"deletions":0},{"file":"test/mpu/mpuMorayCleanerStream.test.js","type":"ADDED","insertions":241,"deletions":0},{"file":"test/mpu/mpuUnlinkLiveRecordStream.test.js","type":"ADDED","insertions":1151,"deletions":0},{"file":"test/mpu/mpuVerifyStream.test.js","type":"ADDED","insertions":829,"deletions":0},{"file":"test/mpu/test-files/one-record-batch","type":"ADDED","insertions":1,"deletions":0},{"file":"test/mpu/testInputs.js","type":"ADDED","insertions":253,"deletions":0},{"file":"test/mpu_garbage_collector.test.js","type":"ADDED","insertions":1207,"deletions":0}],"sizeInsertions":5919,"sizeDeletions":-12},{"number":"3","revision":"809e55b90a0e30994dc320d496cdc8a9bcaf48ea","parents":["4b8b2975f0b7b70fc2dfc402910ee2c5f3ce0c6f"],"ref":"refs/changes/02/2802/3","uploader":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"createdOn":1508292403,"author":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1508292431,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"bin/gc_links.pl","type":"MODIFIED","insertions":1,"deletions":-2},{"file":"bin/kick_off_mpu_gc.js","type":"ADDED","insertions":356,"deletions":0},{"file":"bin/mdemux.js","type":"MODIFIED","insertions":7,"deletions":-2},{"file":"bin/mpu_gc.js","type":"ADDED","insertions":70,"deletions":0},{"file":"bin/mpu_gc_pg_transform.js","type":"ADDED","insertions":103,"deletions":0},{"file":"bin/mpu_gc_transform.js","type":"ADDED","insertions":104,"deletions":0},{"file":"boot/setup.sh","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"config.json","type":"ADDED","insertions":20,"deletions":0},{"file":"docs/gc-overview.md","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/index.js","type":"MODIFIED","insertions":29,"deletions":0},{"file":"lib/moray_cleaner.js","type":"MODIFIED","insertions":12,"deletions":-2},{"file":"lib/mpu/common.js","type":"ADDED","insertions":281,"deletions":0},{"file":"lib/mpu/index.js","type":"ADDED","insertions":38,"deletions":0},{"file":"lib/mpu/mpuBatchStream.js","type":"ADDED","insertions":174,"deletions":0},{"file":"lib/mpu/mpuMorayCleanerStream.js","type":"ADDED","insertions":137,"deletions":0},{"file":"lib/mpu/mpuUnlinkLiveRecordStream.js","type":"ADDED","insertions":186,"deletions":0},{"file":"lib/mpu/mpuVerifyStream.js","type":"ADDED","insertions":165,"deletions":0},{"file":"lib/mpu_garbage_collector.js","type":"ADDED","insertions":129,"deletions":0},{"file":"lib/mpu_gc_pg_row_transformer.js","type":"ADDED","insertions":170,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":0},{"file":"sapi_manifests/mola/template","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"test/mpu/mpuBatchStream.test.js","type":"ADDED","insertions":227,"deletions":0},{"file":"test/mpu/mpuMorayCleanerStream.test.js","type":"ADDED","insertions":241,"deletions":0},{"file":"test/mpu/mpuUnlinkLiveRecordStream.test.js","type":"ADDED","insertions":1151,"deletions":0},{"file":"test/mpu/mpuVerifyStream.test.js","type":"ADDED","insertions":829,"deletions":0},{"file":"test/mpu/testInputs.js","type":"ADDED","insertions":253,"deletions":0},{"file":"test/mpu_garbage_collector.test.js","type":"ADDED","insertions":1207,"deletions":0}],"sizeInsertions":5909,"sizeDeletions":-10},{"number":"4","revision":"2c38295fbac44fcd81d18ee9eb1dbf8a2c6447d2","parents":["4b8b2975f0b7b70fc2dfc402910ee2c5f3ce0c6f"],"ref":"refs/changes/02/2802/4","uploader":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"createdOn":1508355629,"author":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1508355677,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"bin/gc_links.pl","type":"MODIFIED","insertions":1,"deletions":-2},{"file":"bin/kick_off_mpu_gc.js","type":"ADDED","insertions":359,"deletions":0},{"file":"bin/mdemux.js","type":"MODIFIED","insertions":7,"deletions":-2},{"file":"bin/mpu_gc.js","type":"ADDED","insertions":70,"deletions":0},{"file":"bin/mpu_gc_pg_transform.js","type":"ADDED","insertions":107,"deletions":0},{"file":"boot/setup.sh","type":"MODIFIED","insertions":8,"deletions":-1},{"file":"deps/manta-scripts","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"docs/gc-overview.md","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/index.js","type":"MODIFIED","insertions":29,"deletions":0},{"file":"lib/moray_cleaner.js","type":"MODIFIED","insertions":12,"deletions":-2},{"file":"lib/mpu/common.js","type":"ADDED","insertions":242,"deletions":0},{"file":"lib/mpu/index.js","type":"ADDED","insertions":38,"deletions":0},{"file":"lib/mpu/mpuBatchStream.js","type":"ADDED","insertions":174,"deletions":0},{"file":"lib/mpu/mpuMorayCleanerStream.js","type":"ADDED","insertions":137,"deletions":0},{"file":"lib/mpu/mpuUnlinkLiveRecordStream.js","type":"ADDED","insertions":190,"deletions":0},{"file":"lib/mpu/mpuVerifyStream.js","type":"ADDED","insertions":164,"deletions":0},{"file":"lib/mpu_garbage_collector.js","type":"ADDED","insertions":151,"deletions":0},{"file":"lib/mpu_gc_pg_row_transformer.js","type":"ADDED","insertions":153,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"sapi_manifests/mola/template","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"test/mpu/mpuBatchStream.test.js","type":"ADDED","insertions":227,"deletions":0},{"file":"test/mpu/mpuMorayCleanerStream.test.js","type":"ADDED","insertions":241,"deletions":0},{"file":"test/mpu/mpuUnlinkLiveRecordStream.test.js","type":"ADDED","insertions":1153,"deletions":0},{"file":"test/mpu/mpuVerifyStream.test.js","type":"ADDED","insertions":829,"deletions":0},{"file":"test/mpu/testInputs.js","type":"ADDED","insertions":253,"deletions":0},{"file":"test/mpu_garbage_collector.test.js","type":"ADDED","insertions":1207,"deletions":0}],"sizeInsertions":5769,"sizeDeletions":-13},{"number":"5","revision":"eb1cc41ebc4ff2b9a7856fad376d39a4bed9b8f9","parents":["4b8b2975f0b7b70fc2dfc402910ee2c5f3ce0c6f"],"ref":"refs/changes/02/2802/5","uploader":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"createdOn":1508355892,"author":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1508355922,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/moray_cleaner.js","line":212,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"warning: undeclared identifier: MANTA_DELETE_BUCKET"},{"file":"lib/moray_cleaner.js","line":213,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"warning: undeclared identifier: MANTA_FINALIZING_BUCKET"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"bin/gc_links.pl","type":"MODIFIED","insertions":1,"deletions":-2},{"file":"bin/kick_off_mpu_gc.js","type":"ADDED","insertions":359,"deletions":0},{"file":"bin/mdemux.js","type":"MODIFIED","insertions":7,"deletions":-2},{"file":"bin/mpu_gc.js","type":"ADDED","insertions":70,"deletions":0},{"file":"bin/mpu_gc_pg_transform.js","type":"ADDED","insertions":107,"deletions":0},{"file":"boot/setup.sh","type":"MODIFIED","insertions":8,"deletions":-1},{"file":"deps/manta-scripts","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"docs/gc-overview.md","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/index.js","type":"MODIFIED","insertions":29,"deletions":0},{"file":"lib/moray_cleaner.js","type":"MODIFIED","insertions":9,"deletions":-2},{"file":"lib/mpu/common.js","type":"ADDED","insertions":242,"deletions":0},{"file":"lib/mpu/index.js","type":"ADDED","insertions":38,"deletions":0},{"file":"lib/mpu/mpuBatchStream.js","type":"ADDED","insertions":174,"deletions":0},{"file":"lib/mpu/mpuMorayCleanerStream.js","type":"ADDED","insertions":137,"deletions":0},{"file":"lib/mpu/mpuUnlinkLiveRecordStream.js","type":"ADDED","insertions":190,"deletions":0},{"file":"lib/mpu/mpuVerifyStream.js","type":"ADDED","insertions":164,"deletions":0},{"file":"lib/mpu_garbage_collector.js","type":"ADDED","insertions":151,"deletions":0},{"file":"lib/mpu_gc_pg_row_transformer.js","type":"ADDED","insertions":153,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"sapi_manifests/mola/template","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"test/mpu/mpuBatchStream.test.js","type":"ADDED","insertions":227,"deletions":0},{"file":"test/mpu/mpuMorayCleanerStream.test.js","type":"ADDED","insertions":241,"deletions":0},{"file":"test/mpu/mpuUnlinkLiveRecordStream.test.js","type":"ADDED","insertions":1153,"deletions":0},{"file":"test/mpu/mpuVerifyStream.test.js","type":"ADDED","insertions":829,"deletions":0},{"file":"test/mpu/testInputs.js","type":"ADDED","insertions":253,"deletions":0},{"file":"test/mpu_garbage_collector.test.js","type":"ADDED","insertions":1207,"deletions":0}],"sizeInsertions":5766,"sizeDeletions":-13},{"number":"6","revision":"3211eabeed5558e8b392d6b2df39b764e1eeef77","parents":["4b8b2975f0b7b70fc2dfc402910ee2c5f3ce0c6f"],"ref":"refs/changes/02/2802/6","uploader":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"createdOn":1508356417,"author":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1508356442,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/moray_cleaner.js","line":212,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"warning: undeclared identifier: MANTA_DELETE_BUCKET"},{"file":"lib/moray_cleaner.js","line":213,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"warning: undeclared identifier: MANTA_FINALIZING_BUCKET"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"bin/gc_links.pl","type":"MODIFIED","insertions":1,"deletions":-2},{"file":"bin/kick_off_mpu_gc.js","type":"ADDED","insertions":359,"deletions":0},{"file":"bin/mdemux.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"bin/mpu_gc.js","type":"ADDED","insertions":70,"deletions":0},{"file":"bin/mpu_gc_pg_transform.js","type":"ADDED","insertions":107,"deletions":0},{"file":"boot/setup.sh","type":"MODIFIED","insertions":8,"deletions":-1},{"file":"deps/manta-scripts","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"docs/gc-overview.md","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/index.js","type":"MODIFIED","insertions":29,"deletions":0},{"file":"lib/moray_cleaner.js","type":"MODIFIED","insertions":9,"deletions":-2},{"file":"lib/mpu/common.js","type":"ADDED","insertions":242,"deletions":0},{"file":"lib/mpu/index.js","type":"ADDED","insertions":38,"deletions":0},{"file":"lib/mpu/mpuBatchStream.js","type":"ADDED","insertions":174,"deletions":0},{"file":"lib/mpu/mpuMorayCleanerStream.js","type":"ADDED","insertions":137,"deletions":0},{"file":"lib/mpu/mpuUnlinkLiveRecordStream.js","type":"ADDED","insertions":190,"deletions":0},{"file":"lib/mpu/mpuVerifyStream.js","type":"ADDED","insertions":164,"deletions":0},{"file":"lib/mpu_garbage_collector.js","type":"ADDED","insertions":151,"deletions":0},{"file":"lib/mpu_gc_pg_row_transformer.js","type":"ADDED","insertions":153,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"sapi_manifests/mola/template","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"test/mpu/mpuBatchStream.test.js","type":"ADDED","insertions":227,"deletions":0},{"file":"test/mpu/mpuMorayCleanerStream.test.js","type":"ADDED","insertions":241,"deletions":0},{"file":"test/mpu/mpuUnlinkLiveRecordStream.test.js","type":"ADDED","insertions":1153,"deletions":0},{"file":"test/mpu/mpuVerifyStream.test.js","type":"ADDED","insertions":829,"deletions":0},{"file":"test/mpu/testInputs.js","type":"ADDED","insertions":253,"deletions":0},{"file":"test/mpu_garbage_collector.test.js","type":"ADDED","insertions":1207,"deletions":0}],"sizeInsertions":5761,"sizeDeletions":-13},{"number":"7","revision":"6f319c17e17413f5f19c3a7fd26c18dc8984f915","parents":["4b8b2975f0b7b70fc2dfc402910ee2c5f3ce0c6f"],"ref":"refs/changes/02/2802/7","uploader":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"createdOn":1508356611,"author":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1508356642,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"bin/gc_links.pl","type":"MODIFIED","insertions":1,"deletions":-2},{"file":"bin/kick_off_mpu_gc.js","type":"ADDED","insertions":359,"deletions":0},{"file":"bin/mdemux.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"bin/mpu_gc.js","type":"ADDED","insertions":70,"deletions":0},{"file":"bin/mpu_gc_pg_transform.js","type":"ADDED","insertions":107,"deletions":0},{"file":"boot/setup.sh","type":"MODIFIED","insertions":8,"deletions":-1},{"file":"deps/manta-scripts","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"docs/gc-overview.md","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/index.js","type":"MODIFIED","insertions":29,"deletions":0},{"file":"lib/mpu/common.js","type":"ADDED","insertions":242,"deletions":0},{"file":"lib/mpu/index.js","type":"ADDED","insertions":38,"deletions":0},{"file":"lib/mpu/mpuBatchStream.js","type":"ADDED","insertions":174,"deletions":0},{"file":"lib/mpu/mpuMorayCleanerStream.js","type":"ADDED","insertions":137,"deletions":0},{"file":"lib/mpu/mpuUnlinkLiveRecordStream.js","type":"ADDED","insertions":190,"deletions":0},{"file":"lib/mpu/mpuVerifyStream.js","type":"ADDED","insertions":164,"deletions":0},{"file":"lib/mpu_garbage_collector.js","type":"ADDED","insertions":151,"deletions":0},{"file":"lib/mpu_gc_pg_row_transformer.js","type":"ADDED","insertions":153,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"sapi_manifests/mola/template","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"test/mpu/mpuBatchStream.test.js","type":"ADDED","insertions":227,"deletions":0},{"file":"test/mpu/mpuMorayCleanerStream.test.js","type":"ADDED","insertions":241,"deletions":0},{"file":"test/mpu/mpuUnlinkLiveRecordStream.test.js","type":"ADDED","insertions":1153,"deletions":0},{"file":"test/mpu/mpuVerifyStream.test.js","type":"ADDED","insertions":829,"deletions":0},{"file":"test/mpu/testInputs.js","type":"ADDED","insertions":253,"deletions":0},{"file":"test/mpu_garbage_collector.test.js","type":"ADDED","insertions":1207,"deletions":0}],"sizeInsertions":5752,"sizeDeletions":-11},{"number":"8","revision":"3faced1ca91c6fdad61f93e3ff77e16773d4a6a1","parents":["4b8b2975f0b7b70fc2dfc402910ee2c5f3ce0c6f"],"ref":"refs/changes/02/2802/8","uploader":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"createdOn":1508391227,"author":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1508391253,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"Makefile","line":8,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Update copyright?"},{"file":"Makefile","line":8,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"bin/gc_links.pl","line":9,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Update copyright?"},{"file":"bin/gc_links.pl","line":9,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"bin/kick_off_mpu_gc.js","line":40,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"It would be nice if we had a common JS file that held repeated code and offered functions to generate things like the job name. I\u0027m not sure that we want to deal with a refactor like that right now, but it\u0027s something to think about."},{"file":"bin/kick_off_mpu_gc.js","line":40,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"When I spoke with jclulow when I first embarked on MPU GC, he said that since we are rewriting GC literally immediately after this, not to worry about refactoring or cleaning up this code base (as it has a lot of issues), and just to copy from the existing scripts for now. I do agree in principle. I\u0027m also starting online GC this week."},{"file":"bin/kick_off_mpu_gc.js","line":284,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"This block comment seems to be in a different style than the rest. I\u0027m not sure if this was intentional."},{"file":"bin/kick_off_mpu_gc.js","line":284,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"The perils of copy-pasting from the GC scripts! Fixed."},{"file":"bin/mpu_gc.js","line":25,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Do we need to wrap this line?"},{"file":"bin/mpu_gc.js","line":25,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"bin/mpu_gc.js","line":55,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"s/convience/convenience."},{"file":"bin/mpu_gc.js","line":55,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"bin/mpu_gc.js","line":61,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Will createMpuGarbageCollector() add a listener for you if you pass this function into the constructor? I think there might be some duplicate functionality in the event path here."},{"file":"bin/mpu_gc.js","line":61,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Sure. I\u0027ll just remove the listener arg."},{"file":"boot/setup.sh","line":55,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"I don\u0027t really know what to think about these timings. On one hand I don\u0027t know why we wouldn\u0027t start them at the same time as their OG-counterparts. On the other hand I know it probably doesn\u0027t matter because there isn\u0027t a good way to estimate when each of these things should start or when they\u0027ll end."},{"file":"boot/setup.sh","line":55,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"I notice this is missing from PS9. Is this kicked off from somewhere else now?"},{"file":"boot/setup.sh","line":55,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"This isn\u0027t a script that exists, and it was left in by mistake. The kick_off_mpu_pg_transform.js script unpacks the postgres dumps, which both GC and MPU GC use -- MPU GC doesn\u0027t need anything special."},{"file":"boot/setup.sh","line":55,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Yeah, I feel the same way. Perhaps jclulow may have thoughts on this?"},{"file":"deps/manta-scripts","line":1,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"There are a couple commits on top of this one now it looks like. Right now I believe the latest is 253ae31df06a8b5a3d520e3874d0eb060dda4fa3"},{"file":"docs/mpu-gc-overview.md","line":24,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Should the word \u0027upload\u0027 include quotes or is it fine?"},{"file":"docs/mpu-gc-overview.md","line":24,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"docs/mpu-gc-overview.md","line":26,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Probably remove this word."},{"file":"docs/mpu-gc-overview.md","line":26,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"docs/mpu-gc-overview.md","line":27,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Immediately after?"},{"file":"docs/mpu-gc-overview.md","line":27,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"What I intended to communicate was that the record isn\u0027t expected to be there forever. I see now, as you are alluding to I think, that it might instead be delayed from when the client completes the MPU. I\u0027ve updated the language a bit -- let me know if you think it could be clearer."},{"file":"docs/mpu-gc-overview.md","line":27,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Ah, okay. This makes sense now. Thanks!"},{"file":"docs/mpu-gc-overview.md","line":31,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"The data (parts?) is only left on the makos in the case of either an abandoned, or never-finalized MPU, right? I\u0027m just checking for my own understanding here."},{"file":"docs/mpu-gc-overview.md","line":31,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Right, along with uploaded parts that aren\u0027t committed (e.g., I only commit parts 0-4, but I uploaded parts 0-5). I wasn\u0027t sure whether it was worth explaining that here."},{"file":"docs/mpu-gc-overview.md","line":31,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Okay, sounds good. I think it\u0027s probably fine to leave that out as long as it\u0027s explained somewhere else."},{"file":"docs/mpu-gc-overview.md","line":36,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"It feels like we\u0027re missing a word here, like \u0027that\u0027 or \u0027if\u0027"},{"file":"docs/mpu-gc-overview.md","line":36,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"docs/mpu-gc-overview.md","line":43,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"I don\u0027t quite understand this. So we\u0027re going to have to occasionally kick off a cruft-like job to remove parts and upload directories on the sharks?"},{"file":"docs/mpu-gc-overview.md","line":43,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"I think what I intended to communicate was that you can\u0027t delete parts/upload directories from the front door normally without an operator override. Looking at it now, I\u0027m not really sure that this information is relevant, so I\u0027ve removed that clause."},{"file":"docs/mpu-gc-overview.md","line":43,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Okay, looks good."},{"file":"docs/mpu-gc-overview.md","line":56,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"\u0027of MPU GC\u0027?"},{"file":"docs/mpu-gc-overview.md","line":56,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"docs/mpu-gc-overview.md","line":58,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"\u0027by the corresponding zones\u0027"},{"file":"docs/mpu-gc-overview.md","line":58,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"While the mako instructions are executed by mako zones, the moray instructions are actually all run from the ops zone. I\u0027ve tried to make it a bit clearer."},{"file":"docs/mpu-gc-overview.md","line":58,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Yep, this looks good."},{"file":"docs/mpu-gc-overview.md","line":60,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"This feels like a bit of a run-on sentence. Maybe we can split it up like \u0027... not tenable for MPU GC. Records for a...\u0027? Or maybe it\u0027s fine. I don\u0027t really know."},{"file":"docs/mpu-gc-overview.md","line":60,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"It definitely is a run-on. Revised."},{"file":"docs/mpu-gc-overview.md","line":110,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"s/begun/began ?"},{"file":"docs/mpu-gc-overview.md","line":110,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"docs/mpu-gc-overview.md","line":112,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"I think this wording may need to be fixed.\n\nIs the output one file per reducer? I\u0027m guessing this is similar to how OG GC works, but I\u0027m not familiar with this implementation detail."},{"file":"docs/mpu-gc-overview.md","line":112,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Cleaned up some. Let me know if it\u0027s still confusing.\n\nThere is one output file per reducer."},{"file":"docs/mpu-gc-overview.md","line":146,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Is it that no further portions of that one MPU are garbage collected, or that the entire MPU GC process stops? It\u0027s a little unclear to me."},{"file":"docs/mpu-gc-overview.md","line":146,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Just the MPU itself -- the script will continue working on other MPUs. This is an important design point about the script, so I\u0027ve reworked this section a bit. Let me know what you think."},{"file":"docs/mpu-gc-overview.md","line":166,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"I know the other GC docs say this too, but it would be great if we could be more specific somehow. The challenge would be keeping the docs and code in sync if we ever decide to change the threshold for oldness. The same goes for the \u0027system-wide grace period.\u0027 Thoughts?"},{"file":"docs/mpu-gc-overview.md","line":166,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"For the dumps, it\u0027s within the past 24 hours (looking at lib/common.js). As a part of this change (for my own testing purposes, mostly), I made the option for how far back the job would look for dumps actually used by the common code. I\u0027ve edited the docs here to make the timeline clearer.\n\nFor the grace period, it\u0027s usually 2 days, but like the dump date, it\u0027s configurable. I\u0027m not sure where would be best to document that, if needed."},{"file":"docs/mpu-gc-overview.md","line":178,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Should this go under Phase 1, step 3? I think that might clear up the question that I posed there about how many files are created."},{"file":"docs/mpu-gc-overview.md","line":178,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"I updated the text under Phase 1, Step 3 -- but feel free to let me know if anything else could be clearer."},{"file":"docs/mpu-gc-overview.md","line":196,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"We can wrap this line without messing up the formatting, right?"},{"file":"docs/mpu-gc-overview.md","line":196,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"lib/mpu_garbage_collector.js","line":34,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Maybe we don\u0027t need this if the consumers are attaching listener functions by themselves?"},{"file":"lib/mpu_garbage_collector.js","line":34,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"bin/gc_links.pl","type":"MODIFIED","insertions":1,"deletions":-2},{"file":"bin/kick_off_mpu_gc.js","type":"ADDED","insertions":358,"deletions":0},{"file":"bin/mdemux.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"bin/mpu_gc.js","type":"ADDED","insertions":70,"deletions":0},{"file":"bin/mpu_gc_pg_transform.js","type":"ADDED","insertions":107,"deletions":0},{"file":"boot/setup.sh","type":"MODIFIED","insertions":8,"deletions":-1},{"file":"deps/manta-scripts","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"docs/gc-overview.md","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"docs/mpu-gc-overview.md","type":"ADDED","insertions":196,"deletions":0},{"file":"lib/index.js","type":"MODIFIED","insertions":29,"deletions":0},{"file":"lib/mpu/common.js","type":"ADDED","insertions":242,"deletions":0},{"file":"lib/mpu/index.js","type":"ADDED","insertions":38,"deletions":0},{"file":"lib/mpu/mpuBatchStream.js","type":"ADDED","insertions":174,"deletions":0},{"file":"lib/mpu/mpuMorayCleanerStream.js","type":"ADDED","insertions":137,"deletions":0},{"file":"lib/mpu/mpuUnlinkLiveRecordStream.js","type":"ADDED","insertions":190,"deletions":0},{"file":"lib/mpu/mpuVerifyStream.js","type":"ADDED","insertions":164,"deletions":0},{"file":"lib/mpu_garbage_collector.js","type":"ADDED","insertions":151,"deletions":0},{"file":"lib/mpu_gc_pg_row_transformer.js","type":"ADDED","insertions":153,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"sapi_manifests/mola/template","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"test/mpu/mpuBatchStream.test.js","type":"ADDED","insertions":227,"deletions":0},{"file":"test/mpu/mpuMorayCleanerStream.test.js","type":"ADDED","insertions":241,"deletions":0},{"file":"test/mpu/mpuUnlinkLiveRecordStream.test.js","type":"ADDED","insertions":1153,"deletions":0},{"file":"test/mpu/mpuVerifyStream.test.js","type":"ADDED","insertions":829,"deletions":0},{"file":"test/mpu/testInputs.js","type":"ADDED","insertions":253,"deletions":0},{"file":"test/mpu_garbage_collector.test.js","type":"ADDED","insertions":1207,"deletions":0}],"sizeInsertions":5947,"sizeDeletions":-11},{"number":"9","revision":"108df25636ff309834acf4897a6e55b5d639b551","parents":["4b8b2975f0b7b70fc2dfc402910ee2c5f3ce0c6f"],"ref":"refs/changes/02/2802/9","uploader":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"createdOn":1509154777,"author":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1509154803,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"Makefile","line":89,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"I think we\u0027ll want to keep this as a wildcard if this was an unintentional change."},{"file":"Makefile","line":89,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Yeah, that was unintentional. Done."},{"file":"bin/kick_off_mpu_cleanup.js","line":85,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"pipeline*"},{"file":"bin/kick_off_mpu_cleanup.js","line":85,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"bin/kick_off_mpu_cleanup.js","line":92,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"multipart*"},{"file":"bin/kick_off_mpu_cleanup.js","line":92,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"bin/kick_off_mpu_cleanup.js","line":94,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"In what cases do part records remain on the sharks after an MPU is finalized? Should this only happen when a user only finalizes a subset of MPU parts into the final object?"},{"file":"bin/kick_off_mpu_cleanup.js","line":97,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"For 4. and 5. I think it would be helpful to mention that this deletes things from the sharks. Does this step also remove the record from Moray? Or maybe I\u0027m not understanding this."},{"file":"bin/kick_off_mpu_cleanup.js","line":193,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"I don\u0027t see -d or -t flags in the options list above."},{"file":"bin/kick_off_mpu_cleanup.js","line":193,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Removed, and added the new flag from this change (-c)."},{"file":"bin/kick_off_mpu_cleanup.js","line":322,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Dang. I just checked and it looks like PipelineStream doesn\u0027t report emit a \u0027finish\u0027 event. It would have been nice not to explicitly attach the listener to the last stream in the list."},{"file":"bin/kick_off_mpu_cleanup.js","line":322,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Agreed! That threw me off at first."},{"file":"bin/kick_off_mpu_gc.js","line":138,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"I don\u0027t see this being used in this file, but I see it referenced in kick_off_mpu_cleanup.js . It also doesn\u0027t look like this is a valid flag in mpu_gc.js . Am I missing something?"},{"file":"bin/kick_off_mpu_gc.js","line":138,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"It was from an earlier iteration of the implementation. Thanks for catching it! Removed."},{"file":"bin/kick_off_mpu_gc.js","line":171,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Will these two new flags make it into the final version of the change?"},{"file":"bin/kick_off_mpu_gc.js","line":171,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"What\u0027s the other new flag? I have found this one useful for debugging purposes. Given the operational problems we\u0027ve had with GC, I\u0027d be inclined to leave it in as an option. I don\u0027t see how it could hurt anything, but let me know if you disagree."},{"file":"bin/kick_off_mpu_gc.js","line":171,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"That\u0027s fine. The other flag introduced in this patch set was \u0027-s\u0027 for maxHoursInPast."},{"file":"lib/mpu/common.js","line":11,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"I don\u0027t see this being referenced."},{"file":"lib/mpu/common.js","line":11,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"lib/mpu/common.js","line":60,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"expects .. expected. We can probably get rid of one of the expect* words"},{"file":"lib/mpu/common.js","line":60,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"lib/mpu/common.js","line":131,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"I don\u0027t totally understand why this is necessary if we\u0027re setting \u0027mulrsType\u0027 to either one constant string or another constant string. You may also be able to use the ternary operator to clean up the \u0027if\u0027 statement."},{"file":"lib/mpu/common.js","line":131,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"A ternary operator expression might be a bit long, but I\u0027ve removed the assert. I had it in there during a code refactor to make sure everything worked as expected. You\u0027re right that it isn\u0027t needed now."},{"file":"lib/mpu/common.js","line":153,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"The \u0027type\u0027 property should also be documented."},{"file":"lib/mpu/common.js","line":153,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"lib/mpu/common.js","line":161,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"I notice that we assert the possible values of LiveRecord types, but not FinalizingRecord types. I see that we do that immediately before creating the object in recordToObject() above. Is that something we should do only in recordToObject(), in just the constructors for the *Record() objects, or some combination of both?"},{"file":"lib/mpu/common.js","line":161,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"The LiveRecord types are critical to the operation of the stream, as the type it is affects the behavior of the MpuUnlinkLiveRecordStream. The finalizing type isn\u0027t important to the behavior of MPU GC, and I didn\u0027t want to assert specific values in case that changes down the line. That said, it\u0027s a pretty minor thing to refactor, and it\u0027s unlikely that the finalizing record types will change anytime soon, so I can add that assert if you think it\u0027s a good idea."},{"file":"lib/mpu/common.js","line":240,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"I don\u0027t see these referenced anywhere else. Do we need to export them?"},{"file":"lib/mpu/common.js","line":240,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Actually, it doesn\u0027t look like they\u0027re used *anywhere* now. Removed them (and the variables that declared them)."},{"file":"lib/mpu/mpuBatchStream.js","line":141,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"While we\u0027re at it, should we assert cb is a function?"},{"file":"lib/mpu/mpuBatchStream.js","line":141,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"lib/mpu/mpuMorayCleanerStream.js","line":56,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Would it make sense to merge the two \u0027finish\u0027 event listeners?"},{"file":"lib/mpu/mpuMorayCleanerStream.js","line":56,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"lib/mpu/mpuMorayCleanerStream.js","line":87,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"What happens to the connection if there is already a connection registered for this shard?\n\nI don\u0027t know if this would happen, but is there a possible race condition if we have multiple clients attempting to connect to the same moray simultaneously? I think if that\u0027s possible each would pass the check at line 73 and then we would leak a connection in this section. I\u0027m not really sure if that\u0027s possible though, since I\u0027m not an expert on nodejs streams."},{"file":"lib/mpu/mpuMorayCleanerStream.js","line":87,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"I think what you\u0027ve described is possible. I modeled this code off of other code in mola, and I\u0027ve filed a bug to address it: MANTA-3490. I\u0027ve restructured this code in patchset 12; let me know if you have any questions."},{"file":"lib/mpu/mpuMorayCleanerStream.js","line":122,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Will this make it into the final revision?"},{"file":"lib/mpu/mpuMorayCleanerStream.js","line":122,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Logging the action to sdterr is the documented behavior of the verbose option, so unless we want to change that, it would."},{"file":"lib/mpu/mpuMorayCleanerStream.js","line":127,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"I thought that line continuations were indented twice in this repo, but I don\u0027t know if that\u0027s also true when the continuation is a function like this."},{"file":"lib/mpu/mpuMorayCleanerStream.js","line":127,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Since it\u0027s a continuation, I think it should actually be indented four lines per jsstyle\u0027s docs). Done."},{"file":"lib/mpu/mpuUnlinkLiveRecordStream.js","line":40,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"I\u0027m guessing explanations will come later. That\u0027s fine."},{"file":"lib/mpu/mpuUnlinkLiveRecordStream.js","line":40,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"lib/mpu/mpuUnlinkLiveRecordStream.js","line":81,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"I think the spacing is a little off here"},{"file":"lib/mpu/mpuUnlinkLiveRecordStream.js","line":81,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"lib/mpu/mpuUnlinkLiveRecordStream.js","line":95,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Could you provide an example of what this key looks like? I couldn\u0027t find one in my manta setup."},{"file":"lib/mpu/mpuUnlinkLiveRecordStream.js","line":95,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Do you mean in a comment in this code or just here in the review?\n\nFor reference, an example key:\nee4985dd-e061-4ec5-a98d-51ddabd79d83:/fdfe27dc-64bc-11e6-90f8-47c1ceb05dd8/stor/7a8616d5-09b9-4988-ab82-17edc869d7e0/df022130-dd07-4b80-ac04-0ee484f031a1"},{"file":"lib/mpu/mpuUnlinkLiveRecordStream.js","line":95,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Thanks! I meant just in the review. Sorry for the confusion."},{"file":"lib/mpu/mpuUnlinkLiveRecordStream.js","line":152,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Should this be wrapped in setImmediate()? I\u0027m really not sure, but it\u0027s wrapped on line 169."},{"file":"lib/mpu/mpuUnlinkLiveRecordStream.js","line":152,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"I wrapped it up there to ensure any call to mulrsWrite was async (as all the other cases are). I\u0027m not sure it\u0027s needed here. Let me know if you disagree."},{"file":"lib/mpu/mpuUnlinkLiveRecordStream.js","line":156,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"What do you think about moving this to line 143? I think it would make its use on line 147 more clear."},{"file":"lib/mpu/mpuUnlinkLiveRecordStream.js","line":156,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"I think it would. But this line is now gone in my latest change to some restructuring of this code."},{"file":"lib/mpu/mpuUnlinkLiveRecordStream.js","line":157,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Are we expecting a possibly large number of inputs for this? Should we use a vasync queue to limit the number of concurrent requests? I think worst case we have 10,000 (max number of parts) requests at once?"},{"file":"lib/mpu/mpuUnlinkLiveRecordStream.js","line":157,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Yeah, that\u0027s a valid concern. I admittedly have not tested this code on any MPUs that big. I\u0027ve changed it to a vasync queue, and restructured the error handling some."},{"file":"lib/mpu/mpuUnlinkLiveRecordStream.js","line":163,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Do we want to log to stdout, or use the logger for this one?"},{"file":"lib/mpu/mpuUnlinkLiveRecordStream.js","line":163,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"The verbose flag goes to stderr as a list of actions the stream takes (which I\u0027ve updated the header comment for the stream to document).\n\nExample output using the verbose flag for reference:\n\n$ /opt/smartdc/mola/bin/kick_off_mpu_cleanup.js -n -v 2\u003e out\n... # bunyan output to stdout\n\n# actions written to stderr\n$ cat out\nunlink /jordantestuser/uploads/ee4/ee4985dd-e061-4ec5-a98d-51ddabd79d83\ndelObject ee4985dd-e061-4ec5-a98d-51ddabd79d83:/fdfe27dc-64bc-11e6-90f8-47c1ceb05dd8/stor/7a8616d5-09b9-4988-ab82-17edc869d7e0/df022130-dd07-4b80-ac04-0ee484f031a1\nunlink /jordantestuser/uploads/fdd/fddd2135-e9c6-4647-9d01-aca4563a3e73\ndelObject fddd2135-e9c6-4647-9d01-aca4563a3e73:/fdfe27dc-64bc-11e6-90f8-47c1ceb05dd8/stor/a29cfa46-5f41-4e6b-a00b-5ae26b8108b1/b56cf04a-b35f-4fa4-9bec-df6c7084aaff\nlink /poseidon/stor/manta_mpu_gc/cleanup/2017-11-05-09-05-38-4fa153c8-934e-451a-88b0-d28483bb5429-X-827c7fb4-c208-11e7-a660-b7d83a89daba to /poseidon/stor/manta_mpu_gc/completed/2017-11-05-09-05-38-4fa153c8-934e-451a-88b0-d28483bb5429-X-827c7fb4-c208-11e7-a660-b7d83a89daba"},{"file":"lib/mpu/mpuUnlinkLiveRecordStream.js","line":178,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Maybe we should create a MultiError here? I think worst case we are logging 10,000 lines."},{"file":"lib/mpu/mpuUnlinkLiveRecordStream.js","line":178,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Would a MultiError be better than logging individual errors? I would think it might be worse given that it would be a much larger object (as opposed to 10K smaller objects).\n\nI restructured this code to use a vasync queue and log errors as they come in instead of iterating over an errors array."},{"file":"lib/mpu/mpuUnlinkLiveRecordStream.js","line":178,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"It\u0027s not a huge deal. I would think using a multierror would make it easier to determine how many records were dropped in each batch."},{"file":"lib/mpu/mpuVerifyStream.js","line":59,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"It looks like this is an array of objects."},{"file":"lib/mpu/mpuVerifyStream.js","line":59,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Ah, yeah that was from a previous version. To prevent this happening again, given that I think it\u0027s pretty clear what these args are given the assertions already, I\u0027m going to remove the param comments."},{"file":"lib/mpu/mpuVerifyStream.js","line":74,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"I just noticed that we add a message to only some \u0027assert.ok()\u0027 calls. I think it would be nice if we had a message for all of them, but it\u0027s not a huge deal I guess."},{"file":"lib/mpu/mpuVerifyStream.js","line":74,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"lib/mpu/mpuVerifyStream.js","line":157,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"What cases lead to having a finalize record, but not an upload record? I\u0027m just curious."},{"file":"lib/mpu/mpuVerifyStream.js","line":157,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"If the upload record was garbage collected, but the finalizing record was not garbage collected for whatever reason (perhaps because GC crashed, or that moray wasn\u0027t available when GC tried to). It\u0027s unlikely that this would happen, but we still want to clean up the finalizing record in this case."},{"file":"lib/mpu_garbage_collector.js","line":150,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"I think the naming of this function is confusing me... If it\u0027s within the grace period, we _don\u0027t_ want to clean it up, right? I think that\u0027s what the logic is doing here."},{"file":"lib/mpu_garbage_collector.js","line":150,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Yeah, it\u0027s backwards. Changed the name."},{"file":"lib/mpu_garbage_collector.js","line":157,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"What happens to MPUs that have been started, but not explicitly abandoned or committed? It\u0027s probably out of the scope of MPU GC, but it\u0027s a case where I think we let MPU parts pile up, unless we have some sort of TTL for MPUs."},{"file":"lib/mpu_garbage_collector.js","line":157,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"They\u0027ll be left around forever, and you\u0027ll continue to pay for the parts, since they\u0027re objects. We decided in the initial design that if you wanted them to be cleaned up, you should commit/abort them. This is one area where we diverged from S3, as it allows you to set a \"lifecycle policy\" on MPUs to be aborted after a time period, regardless of whether they are completed by the client."},{"file":"lib/mpu_garbage_collector.js","line":168,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Would it make sense to squash this into something like this?\n\nif (curr \u0026\u0026 curr instanceof mpuCommon.FinalizingRecord) {\n  currFR \u003d curr;\n} else if (curr \u0026\u0026 currFR) {\n  // grace period logic\n}"},{"file":"lib/mpu_garbage_collector.js","line":168,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Sure. Done."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"bin/gc_links.pl","type":"MODIFIED","insertions":1,"deletions":-2},{"file":"bin/kick_off_mpu_cleanup.js","type":"ADDED","insertions":952,"deletions":0},{"file":"bin/kick_off_mpu_gc.js","type":"ADDED","insertions":374,"deletions":0},{"file":"bin/mdemux.js","type":"MODIFIED","insertions":7,"deletions":-2},{"file":"bin/mpu_gc.js","type":"ADDED","insertions":84,"deletions":0},{"file":"bin/mpu_gc_pg_transform.js","type":"ADDED","insertions":107,"deletions":0},{"file":"boot/setup.sh","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"deps/manta-scripts","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"docs/gc-overview.md","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"docs/mpu-gc-overview.md","type":"ADDED","insertions":196,"deletions":0},{"file":"lib/common.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/index.js","type":"MODIFIED","insertions":29,"deletions":0},{"file":"lib/moray_cleaner.js","type":"MODIFIED","insertions":12,"deletions":-2},{"file":"lib/mpu/common.js","type":"ADDED","insertions":242,"deletions":0},{"file":"lib/mpu/index.js","type":"ADDED","insertions":38,"deletions":0},{"file":"lib/mpu/mpuBatchStream.js","type":"ADDED","insertions":190,"deletions":0},{"file":"lib/mpu/mpuMorayCleanerStream.js","type":"ADDED","insertions":156,"deletions":0},{"file":"lib/mpu/mpuUnlinkLiveRecordStream.js","type":"ADDED","insertions":214,"deletions":0},{"file":"lib/mpu/mpuVerifyStream.js","type":"ADDED","insertions":210,"deletions":0},{"file":"lib/mpu_garbage_collector.js","type":"ADDED","insertions":180,"deletions":0},{"file":"lib/mpu_gc_pg_row_transformer.js","type":"ADDED","insertions":153,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":6,"deletions":-3},{"file":"sapi_manifests/mola/template","type":"MODIFIED","insertions":7,"deletions":0},{"file":"test/mpu/mpuBatchStream.test.js","type":"ADDED","insertions":227,"deletions":0},{"file":"test/mpu/mpuMorayCleanerStream.test.js","type":"ADDED","insertions":241,"deletions":0},{"file":"test/mpu/mpuUnlinkLiveRecordStream.test.js","type":"ADDED","insertions":1153,"deletions":0},{"file":"test/mpu/mpuVerifyStream.test.js","type":"ADDED","insertions":829,"deletions":0},{"file":"test/mpu/testInputs.js","type":"ADDED","insertions":253,"deletions":0},{"file":"test/mpu_garbage_collector.test.js","type":"ADDED","insertions":1238,"deletions":0}],"sizeInsertions":7112,"sizeDeletions":-15},{"number":"10","revision":"99f14fa47c1c823c0230c6d9199fdfb7bd072414","parents":["4b8b2975f0b7b70fc2dfc402910ee2c5f3ce0c6f"],"ref":"refs/changes/02/2802/10","uploader":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"createdOn":1509657995,"author":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1509658022,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"bin/gc_links.pl","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"bin/kick_off_mpu_cleanup.js","type":"ADDED","insertions":1061,"deletions":0},{"file":"bin/kick_off_mpu_gc.js","type":"ADDED","insertions":374,"deletions":0},{"file":"bin/mdemux.js","type":"MODIFIED","insertions":7,"deletions":-2},{"file":"bin/mpu_gc.js","type":"ADDED","insertions":83,"deletions":0},{"file":"bin/mpu_gc_pg_transform.js","type":"ADDED","insertions":107,"deletions":0},{"file":"boot/setup.sh","type":"MODIFIED","insertions":7,"deletions":-2},{"file":"deps/manta-scripts","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"docs/gc-overview.md","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"docs/mpu-gc-overview.md","type":"ADDED","insertions":210,"deletions":0},{"file":"docs/system-crons.md","type":"MODIFIED","insertions":12,"deletions":0},{"file":"lib/common.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/index.js","type":"MODIFIED","insertions":29,"deletions":0},{"file":"lib/moray_cleaner.js","type":"MODIFIED","insertions":12,"deletions":-2},{"file":"lib/mpu/common.js","type":"ADDED","insertions":226,"deletions":0},{"file":"lib/mpu/index.js","type":"ADDED","insertions":38,"deletions":0},{"file":"lib/mpu/mpuBatchStream.js","type":"ADDED","insertions":199,"deletions":0},{"file":"lib/mpu/mpuMorayCleanerStream.js","type":"ADDED","insertions":166,"deletions":0},{"file":"lib/mpu/mpuUnlinkLiveRecordStream.js","type":"ADDED","insertions":233,"deletions":0},{"file":"lib/mpu/mpuVerifyStream.js","type":"ADDED","insertions":234,"deletions":0},{"file":"lib/mpu_garbage_collector.js","type":"ADDED","insertions":171,"deletions":0},{"file":"lib/mpu_gc_pg_row_transformer.js","type":"ADDED","insertions":153,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":6,"deletions":-3},{"file":"sapi_manifests/mola/template","type":"MODIFIED","insertions":7,"deletions":0},{"file":"test/mpu/mpuBatchStream.test.js","type":"ADDED","insertions":227,"deletions":0},{"file":"test/mpu/mpuMorayCleanerStream.test.js","type":"ADDED","insertions":241,"deletions":0},{"file":"test/mpu/mpuUnlinkLiveRecordStream.test.js","type":"ADDED","insertions":1153,"deletions":0},{"file":"test/mpu/mpuVerifyStream.test.js","type":"ADDED","insertions":829,"deletions":0},{"file":"test/mpu/testInputs.js","type":"ADDED","insertions":253,"deletions":0},{"file":"test/mpu_garbage_collector.test.js","type":"ADDED","insertions":1238,"deletions":0}],"sizeInsertions":7284,"sizeDeletions":-17},{"number":"11","revision":"53727cf112af146cbc2f82fd46e0da54c337b684","parents":["4b8b2975f0b7b70fc2dfc402910ee2c5f3ce0c6f"],"ref":"refs/changes/02/2802/11","uploader":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"createdOn":1509732341,"author":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1509732368,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"boot/setup.sh","line":1,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Probably an unintentional addition"},{"file":"boot/setup.sh","line":1,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"bin/gc_links.pl","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"bin/kick_off_mpu_cleanup.js","type":"ADDED","insertions":1061,"deletions":0},{"file":"bin/kick_off_mpu_gc.js","type":"ADDED","insertions":374,"deletions":0},{"file":"bin/mdemux.js","type":"MODIFIED","insertions":7,"deletions":-2},{"file":"bin/mpu_gc.js","type":"ADDED","insertions":83,"deletions":0},{"file":"bin/mpu_gc_pg_transform.js","type":"ADDED","insertions":107,"deletions":0},{"file":"boot/setup.sh","type":"MODIFIED","insertions":7,"deletions":-2},{"file":"docs/gc-overview.md","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"docs/mpu-gc-overview.md","type":"ADDED","insertions":210,"deletions":0},{"file":"docs/system-crons.md","type":"MODIFIED","insertions":12,"deletions":0},{"file":"lib/common.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/index.js","type":"MODIFIED","insertions":29,"deletions":0},{"file":"lib/moray_cleaner.js","type":"MODIFIED","insertions":12,"deletions":-2},{"file":"lib/mpu/common.js","type":"ADDED","insertions":228,"deletions":0},{"file":"lib/mpu/index.js","type":"ADDED","insertions":38,"deletions":0},{"file":"lib/mpu/mpuBatchStream.js","type":"ADDED","insertions":199,"deletions":0},{"file":"lib/mpu/mpuMorayCleanerStream.js","type":"ADDED","insertions":166,"deletions":0},{"file":"lib/mpu/mpuUnlinkLiveRecordStream.js","type":"ADDED","insertions":233,"deletions":0},{"file":"lib/mpu/mpuVerifyStream.js","type":"ADDED","insertions":234,"deletions":0},{"file":"lib/mpu_garbage_collector.js","type":"ADDED","insertions":171,"deletions":0},{"file":"lib/mpu_gc_pg_row_transformer.js","type":"ADDED","insertions":153,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":6,"deletions":-3},{"file":"sapi_manifests/mola/template","type":"MODIFIED","insertions":7,"deletions":0},{"file":"test/mpu/mpuBatchStream.test.js","type":"ADDED","insertions":227,"deletions":0},{"file":"test/mpu/mpuMorayCleanerStream.test.js","type":"ADDED","insertions":241,"deletions":0},{"file":"test/mpu/mpuUnlinkLiveRecordStream.test.js","type":"ADDED","insertions":1148,"deletions":0},{"file":"test/mpu/mpuVerifyStream.test.js","type":"ADDED","insertions":829,"deletions":0},{"file":"test/mpu/testInputs.js","type":"ADDED","insertions":253,"deletions":0},{"file":"test/mpu_garbage_collector.test.js","type":"ADDED","insertions":1238,"deletions":0}],"sizeInsertions":7280,"sizeDeletions":-16},{"number":"12","revision":"882fab83aea2d547cc72d83aade16beabcbb4a7f","parents":["4b8b2975f0b7b70fc2dfc402910ee2c5f3ce0c6f"],"ref":"refs/changes/02/2802/12","uploader":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"createdOn":1512435347,"author":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1512435375,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"bin/kick_off_mpu_cleanup.js","line":417,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"What do you think about removing spaces from these? I thinking that the spaces might make it a little more difficult to use \u0027json\u0027 and \u0027bunyan\u0027 to manipulate the output if it includes spaces."},{"file":"bin/kick_off_mpu_cleanup.js","line":417,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"bin/kick_off_mpu_cleanup.js","line":766,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"It looks like this changed in the latest patch set."},{"file":"bin/kick_off_mpu_cleanup.js","line":766,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"bin/kick_off_mpu_cleanup.js","line":805,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"No biggie here either, but we could do the queue.push(array) thing as a shortcut."},{"file":"bin/kick_off_mpu_cleanup.js","line":805,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"That change made it into PS 13!"},{"file":"bin/kick_off_mpu_cleanup.js","line":805,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Oh! Sorry about that. I must have been looking at the wrong version. Looks good!"},{"file":"bin/kick_off_mpu_gc.js","line":185,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Can we remove -n and -o ?"},{"file":"deps/manta-scripts","line":1,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"I think this was inadvertently sent back in time rather than forward in time."},{"file":"lib/mpu/mpuMorayCleanerStream.js","line":81,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"pass it to the *caller?"},{"file":"lib/mpu/mpuMorayCleanerStream.js","line":81,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"lib/mpu/mpuMorayCleanerStream.js","line":104,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Do we ever close these connections anywhere?"},{"file":"lib/mpu/mpuMorayCleanerStream.js","line":104,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"They\u0027re closed in the \u0027finish\u0027 handler attached to the MpuMorayCleanerStream in its constructor."},{"file":"lib/mpu/mpuMorayCleanerStream.js","line":104,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Nice. Thanks. I missed that."},{"file":"lib/mpu/mpuUnlinkLiveRecordStream.js","line":186,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"I think vasync supports directly passing in an array of inputs for queues. The same goes for the kick_off_mpu_cleanup script."},{"file":"lib/mpu/mpuUnlinkLiveRecordStream.js","line":186,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Neat! I didn\u0027t know that. Thanks for the tip."},{"file":"lib/mpu/mpuUnlinkLiveRecordStream.js","line":195,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Would it make sense to add a counter to represent the records we couldn\u0027t unlink? If I\u0027m reading this correctly it looks like we don\u0027t drop the entire batch if we can\u0027t unlink an individual record. It could be a little confusing to see the logs say we skipped a whole batch, while noticing part records missing from disk."},{"file":"lib/mpu/mpuUnlinkLiveRecordStream.js","line":195,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"The stream maintains a counter of records successfully unlinked, so to figure how many failed, you can do: mulrs_numRecordsSeen - mulrs_numRecordsUnlinked."},{"file":"lib/mpu/mpuUnlinkLiveRecordStream.js","line":223,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Are the mahiErrors and mantaErrors variables defined?"},{"file":"lib/mpu/mpuUnlinkLiveRecordStream.js","line":223,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"bin/gc_links.pl","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"bin/kick_off_mpu_cleanup.js","type":"ADDED","insertions":1042,"deletions":0},{"file":"bin/kick_off_mpu_gc.js","type":"ADDED","insertions":374,"deletions":0},{"file":"bin/mdemux.js","type":"MODIFIED","insertions":7,"deletions":-2},{"file":"bin/mpu_gc.js","type":"ADDED","insertions":83,"deletions":0},{"file":"bin/mpu_gc_pg_transform.js","type":"ADDED","insertions":107,"deletions":0},{"file":"boot/setup.sh","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"docs/gc-overview.md","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"docs/mpu-gc-overview.md","type":"ADDED","insertions":210,"deletions":0},{"file":"docs/system-crons.md","type":"MODIFIED","insertions":12,"deletions":0},{"file":"lib/common.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/index.js","type":"MODIFIED","insertions":29,"deletions":0},{"file":"lib/moray_cleaner.js","type":"MODIFIED","insertions":12,"deletions":-2},{"file":"lib/mpu/common.js","type":"ADDED","insertions":228,"deletions":0},{"file":"lib/mpu/index.js","type":"ADDED","insertions":38,"deletions":0},{"file":"lib/mpu/mpuBatchStream.js","type":"ADDED","insertions":200,"deletions":0},{"file":"lib/mpu/mpuMorayCleanerStream.js","type":"ADDED","insertions":181,"deletions":0},{"file":"lib/mpu/mpuUnlinkLiveRecordStream.js","type":"ADDED","insertions":233,"deletions":0},{"file":"lib/mpu/mpuVerifyStream.js","type":"ADDED","insertions":235,"deletions":0},{"file":"lib/mpu_garbage_collector.js","type":"ADDED","insertions":171,"deletions":0},{"file":"lib/mpu_gc_pg_row_transformer.js","type":"ADDED","insertions":153,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":6,"deletions":-3},{"file":"sapi_manifests/mola/template","type":"MODIFIED","insertions":7,"deletions":0},{"file":"test/mpu/mpuBatchStream.test.js","type":"ADDED","insertions":227,"deletions":0},{"file":"test/mpu/mpuMorayCleanerStream.test.js","type":"ADDED","insertions":259,"deletions":0},{"file":"test/mpu/mpuUnlinkLiveRecordStream.test.js","type":"ADDED","insertions":1148,"deletions":0},{"file":"test/mpu/mpuVerifyStream.test.js","type":"ADDED","insertions":829,"deletions":0},{"file":"test/mpu/testInputs.js","type":"ADDED","insertions":253,"deletions":0},{"file":"test/mpu_garbage_collector.test.js","type":"ADDED","insertions":1238,"deletions":0}],"sizeInsertions":7295,"sizeDeletions":-15},{"number":"13","revision":"ee72a968534e36a323a8c22a12b2ecf842ed440d","parents":["94b1e89b289a60c376952aac1107ce1b274c8759"],"ref":"refs/changes/02/2802/13","uploader":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"createdOn":1513373997,"author":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1513374025,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1513700001,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}}],"comments":[{"file":"bin/kick_off_mpu_cleanup.js","line":193,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"No biggie, but there\u0027s an extra space here."},{"file":"bin/kick_off_mpu_cleanup.js","line":193,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"bin/gc_links.pl","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"bin/kick_off_mpu_cleanup.js","type":"ADDED","insertions":1081,"deletions":0},{"file":"bin/kick_off_mpu_gc.js","type":"ADDED","insertions":374,"deletions":0},{"file":"bin/mdemux.js","type":"MODIFIED","insertions":7,"deletions":-2},{"file":"bin/mpu_gc.js","type":"ADDED","insertions":83,"deletions":0},{"file":"bin/mpu_gc_pg_transform.js","type":"ADDED","insertions":107,"deletions":0},{"file":"boot/setup.sh","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"docs/gc-overview.md","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"docs/mpu-gc-overview.md","type":"ADDED","insertions":210,"deletions":0},{"file":"docs/system-crons.md","type":"MODIFIED","insertions":12,"deletions":0},{"file":"lib/common.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/index.js","type":"MODIFIED","insertions":29,"deletions":0},{"file":"lib/moray_cleaner.js","type":"MODIFIED","insertions":12,"deletions":-2},{"file":"lib/mpu/common.js","type":"ADDED","insertions":228,"deletions":0},{"file":"lib/mpu/index.js","type":"ADDED","insertions":38,"deletions":0},{"file":"lib/mpu/mpuBatchStream.js","type":"ADDED","insertions":200,"deletions":0},{"file":"lib/mpu/mpuMorayCleanerStream.js","type":"ADDED","insertions":181,"deletions":0},{"file":"lib/mpu/mpuUnlinkLiveRecordStream.js","type":"ADDED","insertions":227,"deletions":0},{"file":"lib/mpu/mpuVerifyStream.js","type":"ADDED","insertions":235,"deletions":0},{"file":"lib/mpu_garbage_collector.js","type":"ADDED","insertions":171,"deletions":0},{"file":"lib/mpu_gc_pg_row_transformer.js","type":"ADDED","insertions":153,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":6,"deletions":-3},{"file":"sapi_manifests/mola/template","type":"MODIFIED","insertions":7,"deletions":0},{"file":"test/mpu/mpuBatchStream.test.js","type":"ADDED","insertions":227,"deletions":0},{"file":"test/mpu/mpuMorayCleanerStream.test.js","type":"ADDED","insertions":259,"deletions":0},{"file":"test/mpu/mpuUnlinkLiveRecordStream.test.js","type":"ADDED","insertions":1167,"deletions":0},{"file":"test/mpu/mpuVerifyStream.test.js","type":"ADDED","insertions":829,"deletions":0},{"file":"test/mpu/testInputs.js","type":"ADDED","insertions":320,"deletions":0},{"file":"test/mpu_garbage_collector.test.js","type":"ADDED","insertions":1238,"deletions":0}],"sizeInsertions":7414,"sizeDeletions":-15},{"number":"14","revision":"553cb68c089b3e52afeb5f94b80d9d679be0e17d","parents":["94b1e89b289a60c376952aac1107ce1b274c8759"],"ref":"refs/changes/02/2802/14","uploader":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"createdOn":1513733050,"author":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1513733112,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1513789395,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"bin/gc_links.pl","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"bin/kick_off_mpu_cleanup.js","type":"ADDED","insertions":1081,"deletions":0},{"file":"bin/kick_off_mpu_gc.js","type":"ADDED","insertions":374,"deletions":0},{"file":"bin/mdemux.js","type":"MODIFIED","insertions":7,"deletions":-2},{"file":"bin/mpu_gc.js","type":"ADDED","insertions":83,"deletions":0},{"file":"bin/mpu_gc_pg_transform.js","type":"ADDED","insertions":107,"deletions":0},{"file":"boot/setup.sh","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"docs/gc-overview.md","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"docs/mpu-gc-overview.md","type":"ADDED","insertions":210,"deletions":0},{"file":"docs/system-crons.md","type":"MODIFIED","insertions":12,"deletions":0},{"file":"lib/common.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/index.js","type":"MODIFIED","insertions":29,"deletions":0},{"file":"lib/moray_cleaner.js","type":"MODIFIED","insertions":12,"deletions":-2},{"file":"lib/mpu/common.js","type":"ADDED","insertions":228,"deletions":0},{"file":"lib/mpu/index.js","type":"ADDED","insertions":38,"deletions":0},{"file":"lib/mpu/mpuBatchStream.js","type":"ADDED","insertions":200,"deletions":0},{"file":"lib/mpu/mpuMorayCleanerStream.js","type":"ADDED","insertions":181,"deletions":0},{"file":"lib/mpu/mpuUnlinkLiveRecordStream.js","type":"ADDED","insertions":227,"deletions":0},{"file":"lib/mpu/mpuVerifyStream.js","type":"ADDED","insertions":235,"deletions":0},{"file":"lib/mpu_garbage_collector.js","type":"ADDED","insertions":171,"deletions":0},{"file":"lib/mpu_gc_pg_row_transformer.js","type":"ADDED","insertions":153,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":6,"deletions":-3},{"file":"sapi_manifests/mola/template","type":"MODIFIED","insertions":7,"deletions":0},{"file":"test/mpu/mpuBatchStream.test.js","type":"ADDED","insertions":227,"deletions":0},{"file":"test/mpu/mpuMorayCleanerStream.test.js","type":"ADDED","insertions":259,"deletions":0},{"file":"test/mpu/mpuUnlinkLiveRecordStream.test.js","type":"ADDED","insertions":1167,"deletions":0},{"file":"test/mpu/mpuVerifyStream.test.js","type":"ADDED","insertions":829,"deletions":0},{"file":"test/mpu/testInputs.js","type":"ADDED","insertions":320,"deletions":0},{"file":"test/mpu_garbage_collector.test.js","type":"ADDED","insertions":1238,"deletions":0}],"sizeInsertions":7414,"sizeDeletions":-15},{"number":"15","revision":"ab52106c891544d1d7dfe32d9acafd8745cde173","parents":["94b1e89b289a60c376952aac1107ce1b274c8759"],"ref":"refs/changes/02/2802/15","uploader":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"createdOn":1515022199,"author":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1515022227,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1515023311,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"bin/gc_links.pl","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"bin/kick_off_mpu_cleanup.js","type":"ADDED","insertions":1081,"deletions":0},{"file":"bin/kick_off_mpu_gc.js","type":"ADDED","insertions":371,"deletions":0},{"file":"bin/mdemux.js","type":"MODIFIED","insertions":8,"deletions":-3},{"file":"bin/mpu_gc.js","type":"ADDED","insertions":83,"deletions":0},{"file":"bin/mpu_gc_pg_transform.js","type":"ADDED","insertions":107,"deletions":0},{"file":"boot/setup.sh","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"docs/gc-overview.md","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"docs/mpu-gc-overview.md","type":"ADDED","insertions":210,"deletions":0},{"file":"docs/system-crons.md","type":"MODIFIED","insertions":13,"deletions":-1},{"file":"lib/common.js","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"lib/index.js","type":"MODIFIED","insertions":30,"deletions":-1},{"file":"lib/moray_cleaner.js","type":"MODIFIED","insertions":13,"deletions":-3},{"file":"lib/mpu/common.js","type":"ADDED","insertions":228,"deletions":0},{"file":"lib/mpu/index.js","type":"ADDED","insertions":38,"deletions":0},{"file":"lib/mpu/mpuBatchStream.js","type":"ADDED","insertions":200,"deletions":0},{"file":"lib/mpu/mpuMorayCleanerStream.js","type":"ADDED","insertions":181,"deletions":0},{"file":"lib/mpu/mpuUnlinkLiveRecordStream.js","type":"ADDED","insertions":230,"deletions":0},{"file":"lib/mpu/mpuVerifyStream.js","type":"ADDED","insertions":235,"deletions":0},{"file":"lib/mpu_garbage_collector.js","type":"ADDED","insertions":171,"deletions":0},{"file":"lib/mpu_gc_pg_row_transformer.js","type":"ADDED","insertions":153,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":6,"deletions":-3},{"file":"sapi_manifests/mola/template","type":"MODIFIED","insertions":7,"deletions":0},{"file":"test/mpu/mpuBatchStream.test.js","type":"ADDED","insertions":227,"deletions":0},{"file":"test/mpu/mpuMorayCleanerStream.test.js","type":"ADDED","insertions":259,"deletions":0},{"file":"test/mpu/mpuUnlinkLiveRecordStream.test.js","type":"ADDED","insertions":1167,"deletions":0},{"file":"test/mpu/mpuVerifyStream.test.js","type":"ADDED","insertions":829,"deletions":0},{"file":"test/mpu/testInputs.js","type":"ADDED","insertions":320,"deletions":0},{"file":"test/mpu_garbage_collector.test.js","type":"ADDED","insertions":1238,"deletions":0}],"sizeInsertions":7420,"sizeDeletions":-21},{"number":"16","revision":"04d931221644d027bd06cc7d2ee0a459cc2ffc9f","parents":["76ffd1a35b05ef47071162a7ffe932dcf8ea95fd"],"ref":"refs/changes/02/2802/16","uploader":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"createdOn":1523316119,"author":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1523384699,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1523316148,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1523316261,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"bin/gc_links.pl","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"bin/kick_off_mpu_cleanup.js","type":"ADDED","insertions":1081,"deletions":0},{"file":"bin/kick_off_mpu_gc.js","type":"ADDED","insertions":371,"deletions":0},{"file":"bin/mdemux.js","type":"MODIFIED","insertions":8,"deletions":-3},{"file":"bin/mpu_gc.js","type":"ADDED","insertions":83,"deletions":0},{"file":"bin/mpu_gc_pg_transform.js","type":"ADDED","insertions":107,"deletions":0},{"file":"boot/setup.sh","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"docs/gc-overview.md","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"docs/mpu-gc-overview.md","type":"ADDED","insertions":210,"deletions":0},{"file":"docs/system-crons.md","type":"MODIFIED","insertions":13,"deletions":-1},{"file":"lib/common.js","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"lib/index.js","type":"MODIFIED","insertions":30,"deletions":-1},{"file":"lib/moray_cleaner.js","type":"MODIFIED","insertions":13,"deletions":-3},{"file":"lib/mpu/common.js","type":"ADDED","insertions":228,"deletions":0},{"file":"lib/mpu/index.js","type":"ADDED","insertions":38,"deletions":0},{"file":"lib/mpu/mpuBatchStream.js","type":"ADDED","insertions":200,"deletions":0},{"file":"lib/mpu/mpuMorayCleanerStream.js","type":"ADDED","insertions":181,"deletions":0},{"file":"lib/mpu/mpuUnlinkLiveRecordStream.js","type":"ADDED","insertions":230,"deletions":0},{"file":"lib/mpu/mpuVerifyStream.js","type":"ADDED","insertions":235,"deletions":0},{"file":"lib/mpu_garbage_collector.js","type":"ADDED","insertions":171,"deletions":0},{"file":"lib/mpu_gc_pg_row_transformer.js","type":"ADDED","insertions":153,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"sapi_manifests/mola/template","type":"MODIFIED","insertions":7,"deletions":0},{"file":"test/mpu/mpuBatchStream.test.js","type":"ADDED","insertions":227,"deletions":0},{"file":"test/mpu/mpuMorayCleanerStream.test.js","type":"ADDED","insertions":259,"deletions":0},{"file":"test/mpu/mpuUnlinkLiveRecordStream.test.js","type":"ADDED","insertions":1167,"deletions":0},{"file":"test/mpu/mpuVerifyStream.test.js","type":"ADDED","insertions":829,"deletions":0},{"file":"test/mpu/testInputs.js","type":"ADDED","insertions":320,"deletions":0},{"file":"test/mpu_garbage_collector.test.js","type":"ADDED","insertions":1238,"deletions":0}],"sizeInsertions":7419,"sizeDeletions":-20},{"number":"17","revision":"eda6c13aaa408ba4c375fd97b6de2f771d19d467","parents":["76ffd1a35b05ef47071162a7ffe932dcf8ea95fd"],"ref":"refs/changes/02/2802/17","uploader":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"createdOn":1523384786,"author":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1523384699,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1523316148,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"SUBM","value":"1","grantedOn":1523384815,"by":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1523316261,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"bin/gc_links.pl","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"bin/kick_off_mpu_cleanup.js","type":"ADDED","insertions":1081,"deletions":0},{"file":"bin/kick_off_mpu_gc.js","type":"ADDED","insertions":371,"deletions":0},{"file":"bin/mdemux.js","type":"MODIFIED","insertions":8,"deletions":-3},{"file":"bin/mpu_gc.js","type":"ADDED","insertions":83,"deletions":0},{"file":"bin/mpu_gc_pg_transform.js","type":"ADDED","insertions":107,"deletions":0},{"file":"boot/setup.sh","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"docs/gc-overview.md","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"docs/mpu-gc-overview.md","type":"ADDED","insertions":210,"deletions":0},{"file":"docs/system-crons.md","type":"MODIFIED","insertions":13,"deletions":-1},{"file":"lib/common.js","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"lib/index.js","type":"MODIFIED","insertions":30,"deletions":-1},{"file":"lib/moray_cleaner.js","type":"MODIFIED","insertions":13,"deletions":-3},{"file":"lib/mpu/common.js","type":"ADDED","insertions":228,"deletions":0},{"file":"lib/mpu/index.js","type":"ADDED","insertions":38,"deletions":0},{"file":"lib/mpu/mpuBatchStream.js","type":"ADDED","insertions":200,"deletions":0},{"file":"lib/mpu/mpuMorayCleanerStream.js","type":"ADDED","insertions":181,"deletions":0},{"file":"lib/mpu/mpuUnlinkLiveRecordStream.js","type":"ADDED","insertions":230,"deletions":0},{"file":"lib/mpu/mpuVerifyStream.js","type":"ADDED","insertions":235,"deletions":0},{"file":"lib/mpu_garbage_collector.js","type":"ADDED","insertions":171,"deletions":0},{"file":"lib/mpu_gc_pg_row_transformer.js","type":"ADDED","insertions":153,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"sapi_manifests/mola/template","type":"MODIFIED","insertions":7,"deletions":0},{"file":"test/mpu/mpuBatchStream.test.js","type":"ADDED","insertions":227,"deletions":0},{"file":"test/mpu/mpuMorayCleanerStream.test.js","type":"ADDED","insertions":259,"deletions":0},{"file":"test/mpu/mpuUnlinkLiveRecordStream.test.js","type":"ADDED","insertions":1167,"deletions":0},{"file":"test/mpu/mpuVerifyStream.test.js","type":"ADDED","insertions":829,"deletions":0},{"file":"test/mpu/testInputs.js","type":"ADDED","insertions":320,"deletions":0},{"file":"test/mpu_garbage_collector.test.js","type":"ADDED","insertions":1238,"deletions":0}],"sizeInsertions":7419,"sizeDeletions":-20}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"}]}