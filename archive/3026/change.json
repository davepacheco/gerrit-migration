{"project":"joyent/illumos-joyent","branch":"master","id":"I0d5719a2f0864296378787c96d12da889970c4e4","number":"3026","subject":"OS-6475 lx - not reporting mount options in /proc/mounts Reviewed by: Dan McDonald \u003cdanmcd@joyent.com\u003e Reviewed by: Jason King \u003cjason.king@joyent.com\u003e Approved by: Dan McDonald \u003cdanmcd@joyent.com\u003e","owner":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"url":"https://cr.joyent.us/3026","commitMessage":"OS-6475 lx - not reporting mount options in /proc/mounts\nReviewed by: Dan McDonald \u003cdanmcd@joyent.com\u003e\nReviewed by: Jason King \u003cjason.king@joyent.com\u003e\nApproved by: Dan McDonald \u003cdanmcd@joyent.com\u003e\n","createdOn":1512151746,"lastUpdated":1512403707,"open":false,"status":"MERGED","comments":[{"timestamp":1512151746,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 1."},{"timestamp":1512153051,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 1:\n\n(1 comment)\n\nSorry for being pedantic, but it feels like the built-in strl*() functions aren\u0027t being used to their full effect."},{"timestamp":1512153535,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 1:\n\nI don\u0027t really think what I have is wrong, or I wouldn\u0027t have done it that way :-) but I will rewrite this"},{"timestamp":1512153576,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 1:\n\n\u003e I don\u0027t really think what I have is wrong, or I wouldn\u0027t have done\n \u003e it that way :-) but I will rewrite this\n\nAhhh, I was offering the rewrite, sorry!"},{"timestamp":1512155045,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 2."},{"timestamp":1512155221,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 2: Code-Review+1\n\nMuch cleaner (and clearly I\u0027d checked my return codes poorly in my example)."},{"timestamp":1512260487,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 2: Integration-Approval+1"},{"timestamp":1512260507,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 2: Code-Review+1 -Integration-Approval"},{"timestamp":1512394275,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 2:\n\nI have some testing output in the bug report."},{"timestamp":1512400941,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 2: Integration-Approval+1\n\n(1 comment)\n\nModulo the missed-it-earlier nit below I\u0027m good!"},{"timestamp":1512403200,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 3."},{"timestamp":1512403274,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 3: Code-Review+1 Integration-Approval+1"},{"timestamp":1512403365,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1512403684,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 4: Commit message was updated."},{"timestamp":1512403707,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Jerry Jelinek"}],"currentPatchSet":{"number":"4","revision":"0d5719a2f0864296378787c96d12da889970c4e4","parents":["3f77d0944006d98d130349a35d3bf65399df67b6"],"ref":"refs/changes/26/3026/4","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1512403684,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1512403274,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1512403274,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1512403365,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"SUBM","value":"1","grantedOn":1512403707,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/uts/common/brand/lx/procfs/lx_prvnops.c","type":"MODIFIED","insertions":84,"deletions":-4}],"sizeInsertions":84,"sizeDeletions":-4},"patchSets":[{"number":"1","revision":"ec1009372063bc769580b7ce76185f04ab6a90d0","parents":["3f77d0944006d98d130349a35d3bf65399df67b6"],"ref":"refs/changes/26/3026/1","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1512151746,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/uts/common/brand/lx/procfs/lx_prvnops.c","line":2086,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"This whole section involving olen and lxpr_mntbuf_len_chk() bothers me. The strl*() family of functions returns -1 if the length argument (tracked by lme-\u003elme_mntopts_len in your code) doesn\u0027t allow the additional characters.  It does the work of olen \u0026 the non-realloc part of lxpr_mntbuf_len_chk().\n\nYou could lose \"olen\" and even \"len\" and have additions be like this:\n\n     while (strlcat(lme-\u003elme_mntopts, \u003cstring\u003e, lme-\u003elme_mntopts_len) \u003d\u003d -1)\n          lxpr_add_more(lme);\n\nwhere lxpr_add_more() does the kmem_alloc of a larger buffer, copies old-to-new, adjusts pointers \u0026 sizes, and frees the older buffer.\n\nThis code would be smaller and simpler.  I may try and prototype this myself, to make sure I\u0027m not misleading you.\n\nThe other alternative is to acknowledge you\u0027re doing strl*() functionality preemptively and not use strl*(), but that freaks people out (and can be the good source for bad copy/paste successors)."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/brand/lx/procfs/lx_prvnops.c","type":"MODIFIED","insertions":102,"deletions":-4}],"sizeInsertions":102,"sizeDeletions":-4},{"number":"2","revision":"c11dba95ee29ea3f844e41825b04646ee16e0929","parents":["3f77d0944006d98d130349a35d3bf65399df67b6"],"ref":"refs/changes/26/3026/2","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1512155045,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1512260507,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1512155221,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1512400941,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}}],"comments":[{"file":"usr/src/uts/common/brand/lx/procfs/lx_prvnops.c","line":2038,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Shoot, missed this last time.  Can you #define this 128 for use here and below?  A before/after disassembly check should yield no code diffs, so assuming that you don\u0027t need to re-test."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/brand/lx/procfs/lx_prvnops.c","type":"MODIFIED","insertions":83,"deletions":-4}],"sizeInsertions":83,"sizeDeletions":-4},{"number":"3","revision":"1db6e9f0fae242edb2675a858a2e8396cf7b1d45","parents":["3f77d0944006d98d130349a35d3bf65399df67b6"],"ref":"refs/changes/26/3026/3","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1512403200,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1512403365,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1512403274,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1512403274,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/brand/lx/procfs/lx_prvnops.c","type":"MODIFIED","insertions":84,"deletions":-4}],"sizeInsertions":84,"sizeDeletions":-4},{"number":"4","revision":"0d5719a2f0864296378787c96d12da889970c4e4","parents":["3f77d0944006d98d130349a35d3bf65399df67b6"],"ref":"refs/changes/26/3026/4","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1512403684,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"SUBM","value":"1","grantedOn":1512403707,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1512403365,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1512403274,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1512403274,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/uts/common/brand/lx/procfs/lx_prvnops.c","type":"MODIFIED","insertions":84,"deletions":-4}],"sizeInsertions":84,"sizeDeletions":-4}],"allReviewers":[{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}]}