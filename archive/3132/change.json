{"project":"joyent/sdc-headnode","branch":"master","id":"Id0633277c6122253c70864397e2a81cb03433c29","number":"3132","subject":"HEAD-2384 sapi0 instance should be created with the proper data Reviewed by: Julien Gilli \u003cjulien.gilli@joyent.com\u003e Approved by: Julien Gilli \u003cjulien.gilli@joyent.com\u003e","owner":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"url":"https://cr.joyent.us/3132","commitMessage":"HEAD-2384 sapi0 instance should be created with the proper data\nReviewed by: Julien Gilli \u003cjulien.gilli@joyent.com\u003e\nApproved by: Julien Gilli \u003cjulien.gilli@joyent.com\u003e\n","createdOn":1513959580,"lastUpdated":1515525616,"open":false,"status":"MERGED","comments":[{"timestamp":1513959580,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 1."},{"timestamp":1513959586,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit b2b6b0c4a3872f4f734da7425b264d467c5c2a0b\n    \n    HEAD-2384 sapi0 instance should be created with the proper data"},{"timestamp":1513959618,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing-1\n\n(1 comment)\n\n\"make check\" exited with status 2"},{"timestamp":1513959638,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 1:\n\nTesting has been pretty straightforward: just look at the sapi0 instance record in SAPI and verify params.alias was set and equal to sapi0"},{"timestamp":1513959746,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 2."},{"timestamp":1513959752,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit cd9cb22b410ed4d3dbe23f79d33ebc58b3c95f00\n    \n    HEAD-2384 sapi0 instance should be created with the proper data"},{"timestamp":1513959824,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1513995047,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 2:\n\n(3 comments)"},{"timestamp":1515518798,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 3."},{"timestamp":1515518804,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 3:\n\nNew commits:\n    \n    commit 752c243561380f2256c3bd2e546b178b72a27c5d\n    \n    HEAD-2384 sapi0 instance should be created with the proper data"},{"timestamp":1515518878,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1515518906,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 3:\n\n(3 comments)\n\nSo far working as expected after our chat conversation:\n\n[root@headnode (coal) ~]# sdc-sapi /instances?service_uuid\u003d$(sdc-sapi /services?name\u003dsapi|json -Ha uuid)|json -H\n[\n  {\n    \"uuid\": \"a39cd68c-39a9-4edf-b26f-897a160a51dc\",\n    \"service_uuid\": \"48d1db49-49de-41e5-adec-d9cf2f820991\",\n    \"params\": {\n      \"alias\": \"sapi0\"\n    },\n    \"type\": \"vm\"\n  }\n]"},{"timestamp":1515521551,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 3: Code-Review+1 Integration-Approval+1"},{"timestamp":1515525591,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 4: Commit message was updated."},{"timestamp":1515525616,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Pedro Palazón Candel"}],"currentPatchSet":{"number":"4","revision":"d0633277c6122253c70864397e2a81cb03433c29","parents":["b7dfe1a68904305702a1ff5bcf7f4bff6ad1b41b"],"ref":"refs/changes/32/3132/4","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1515525591,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1515518878,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1515521551,"by":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1515521551,"by":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}},{"type":"SUBM","value":"1","grantedOn":1515525616,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"scripts/headnode.sh","type":"MODIFIED","insertions":14,"deletions":-4}],"sizeInsertions":14,"sizeDeletions":-4},"patchSets":[{"number":"1","revision":"38343945783c7d47337979a442e877d4d958b4fb","parents":["b7dfe1a68904305702a1ff5bcf7f4bff6ad1b41b"],"ref":"refs/changes/32/3132/1","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1513959580,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1513959618,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"scripts/headnode.sh","line":697,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"declaring and setting a \"local\" var in the same statement ignores a subshell return code \u003chttp://www.tldp.org/LDP/abs/html/localvar.html#EXITVALANOMALY01\u003e: local sapi_alias\u003d..."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"scripts/headnode.sh","type":"MODIFIED","insertions":13,"deletions":-4}],"sizeInsertions":13,"sizeDeletions":-4},{"number":"2","revision":"988237b72e6296708ed971dfad8ef93a4e80f7f0","parents":["b7dfe1a68904305702a1ff5bcf7f4bff6ad1b41b"],"ref":"refs/changes/32/3132/2","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1513959746,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1513959824,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"scripts/headnode.sh","line":698,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"formatting nit: space on each side of the pipe?"},{"file":"scripts/headnode.sh","line":698,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"scripts/headnode.sh","line":725,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"nit: avoid duplication by storing the data string in a temporary variable and reuse the rest of the command?"},{"file":"scripts/headnode.sh","line":725,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"It\u0027s giving a lot of trouble, b/c it re-quotes values:\n\ncurl http://10.99.99.31/instances -sS -X POST -H content-type:application/json -d \u0027{\u0027 \u0027\"service_uuid\"\u0027 : \u0027\"345f5613-e275-4922-b95a-9d28f5e59d98\",\u0027 \u0027\"uuid\"\u0027 : \u0027\"eb8745cc-1e03-4290-af34-e36bd011c0e8\",\u0027 \u0027\"params\":\u0027 \u0027{\u0027 \u0027\"alias\":\u0027 \u0027\"sapi0\"}\u0027 \u0027}\u0027"},{"file":"scripts/headnode.sh","line":728,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"This is the case when the VM alias is empty? Do we want to error in this case instead?"},{"file":"scripts/headnode.sh","line":728,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"No, this is for agent instances which lack of aliases."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"scripts/headnode.sh","type":"MODIFIED","insertions":14,"deletions":-4}],"sizeInsertions":14,"sizeDeletions":-4},{"number":"3","revision":"0de7f35894ca6b2f3a0f60a8c02c64f24b0419d3","parents":["b7dfe1a68904305702a1ff5bcf7f4bff6ad1b41b"],"ref":"refs/changes/32/3132/3","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1515518798,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1515518878,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1515521551,"by":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1515521551,"by":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"scripts/headnode.sh","type":"MODIFIED","insertions":14,"deletions":-4}],"sizeInsertions":14,"sizeDeletions":-4},{"number":"4","revision":"d0633277c6122253c70864397e2a81cb03433c29","parents":["b7dfe1a68904305702a1ff5bcf7f4bff6ad1b41b"],"ref":"refs/changes/32/3132/4","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1515525591,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1515518878,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"SUBM","value":"1","grantedOn":1515525616,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1515521551,"by":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1515521551,"by":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"scripts/headnode.sh","type":"MODIFIED","insertions":14,"deletions":-4}],"sizeInsertions":14,"sizeDeletions":-4}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}]}