From 392a0a6bcbc4fbba95a321103a58143ca86ea116 Mon Sep 17 00:00:00 2001
From: Robert Mustacchi <rm@joyent.com>
Date: Thu, 23 Feb 2017 19:18:26 +0000
Subject: [PATCH] OS-5982 i40e changes for multiple rings merge

---
 usr/src/uts/common/io/i40e/i40e_sw.h    | 9 ++++++++-
 usr/src/uts/common/mapfiles/ddi.mapfile | 1 +
 usr/src/uts/intel/i40e/Makefile         | 2 +-
 3 files changed, 10 insertions(+), 2 deletions(-)

diff --git a/usr/src/uts/common/io/i40e/i40e_sw.h b/usr/src/uts/common/io/i40e/i40e_sw.h
index 26052f413a..0a100edb5f 100644
--- a/usr/src/uts/common/io/i40e/i40e_sw.h
+++ b/usr/src/uts/common/io/i40e/i40e_sw.h
@@ -11,7 +11,7 @@
 
 /*
  * Copyright 2015 OmniTI Computer Consulting, Inc. All rights reserved.
- * Copyright 2016 Joyent, Inc.
+ * Copyright 2017 Joyent, Inc.
  */
 
 /*
@@ -306,6 +306,13 @@ typedef enum i40e_itr_index {
 #define	I40E_PBANUM_LENGTH	12
 #define	I40E_PBANUM_STRLEN	13
 
+/*
+ * Define the maximum size of a number of queues for a traffic class. While this
+ * would ideally be a part of the common code parts, because it's not at this
+ * time, we define it here.
+ */
+#define	I40E_AQ_VSI_TC_QUE_SIZE_MAX	(1 << 0x6)
+
 /*
  * Bit flags for attach_progress
  */
diff --git a/usr/src/uts/common/mapfiles/ddi.mapfile b/usr/src/uts/common/mapfiles/ddi.mapfile
index 25aa8ab045..5a124766e2 100644
--- a/usr/src/uts/common/mapfiles/ddi.mapfile
+++ b/usr/src/uts/common/mapfiles/ddi.mapfile
@@ -63,6 +63,7 @@ SYMBOL_SCOPE {
 	ddi_dma_nextcookie		{ FLAGS = EXTERN };
 	ddi_dma_sync			{ FLAGS = EXTERN };
 	ddi_dma_unbind_handle		{ FLAGS = EXTERN };
+	ddi_fls				{ FLAGS = EXTERN };
 	ddi_fm_acc_err_clear		{ FLAGS = EXTERN };
 	ddi_fm_acc_err_get		{ FLAGS = EXTERN };
 	ddi_fm_dma_err_get		{ FLAGS = EXTERN };
diff --git a/usr/src/uts/intel/i40e/Makefile b/usr/src/uts/intel/i40e/Makefile
index 98b0a77e9c..e930fc6b14 100644
--- a/usr/src/uts/intel/i40e/Makefile
+++ b/usr/src/uts/intel/i40e/Makefile
@@ -38,7 +38,7 @@ LINTTAGS	+= -erroff=E_STATIC_UNUSED
 
 LDFLAGS		+= -dy -N misc/mac
 
-MAPFILES	+= ddi mac
+MAPFILES	+= ddi mac random
 
 .KEEP_STATE:
 
-- 
2.21.0

