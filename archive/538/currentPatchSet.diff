From dcdce866277bb3ad59e2c63c5019591446df9f27 Mon Sep 17 00:00:00 2001
From: Jerry Jelinek <jerry.jelinek@joyent.com>
Date: Thu, 29 Sep 2016 19:53:22 +0000
Subject: [PATCH] OS-5685 LTP vhangup02 fails and passes Reviewed by: Patrick
 Mooney <patrick.mooney@joyent.com> Approved by: Patrick Mooney
 <patrick.mooney@joyent.com>

---
 usr/src/uts/common/brand/lx/syscall/lx_miscsys.c | 9 ++++++++-
 1 file changed, 8 insertions(+), 1 deletion(-)

diff --git a/usr/src/uts/common/brand/lx/syscall/lx_miscsys.c b/usr/src/uts/common/brand/lx/syscall/lx_miscsys.c
index ba986e2742..87bb9bde1b 100644
--- a/usr/src/uts/common/brand/lx/syscall/lx_miscsys.c
+++ b/usr/src/uts/common/brand/lx/syscall/lx_miscsys.c
@@ -278,5 +278,12 @@ lx_vhangup(void)
 {
 	if (crgetuid(CRED()) != 0)
 		return (set_errno(EPERM));
-	return (vhangup());
+
+	/*
+	 * The native vhangup code does nothing except check for the sys_config
+	 * privilege. Eventually we'll first want to check our emulation for the
+	 * Linux CAP_SYS_TTY_CONFIG capability, but currently, since we've
+	 * already checked that our process is root, just succeed.
+	 */
+	return (0);
 }
-- 
2.21.0

