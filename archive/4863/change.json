{"project":"joyent/manta-garbage-collector","branch":"master","id":"I58570f830a3b6a6bd1578c6df4bb88ee34eb1ace","number":"4863","subject":"MANTA-3948 garbage-collector should not assume numeric shard names MANTA-4045 garbage-collector should be able to use old config versions","owner":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"url":"https://cr.joyent.us/4863","commitMessage":"MANTA-3948 garbage-collector should not assume numeric shard names\nMANTA-4045 garbage-collector should be able to use old config versions\n","createdOn":1537573493,"lastUpdated":1547167349,"open":false,"status":"MERGED","comments":[{"timestamp":1537573493,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Uploaded patch set 1."},{"timestamp":1537573519,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1538174771,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Uploaded patch set 2."},{"timestamp":1538174943,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Uploaded patch set 3: Patch Set 2 was rebased."},{"timestamp":1538175648,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1538175931,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1539809899,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 3:\n\n(6 comments)"},{"timestamp":1539975556,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Patch Set 3:\n\n(6 comments)"},{"timestamp":1539975559,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Uploaded patch set 4."},{"timestamp":1539975583,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1539988771,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Uploaded patch set 5."},{"timestamp":1539988794,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1540325033,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Uploaded patch set 6."},{"timestamp":1540325054,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 6: CI-Testing-1\n\n\"make check\" exited with status 2\n\n fatal: ref HEAD is not a symbolic ref\n deps/javascriptlint/build/install/jsl --nologo --nosummary --conf\u003dtools/jsl.node.conf cmd/server.js lib/schema.js lib/actors.js lib/common.js lib/delete_record_transformer.js lib/http_server.js lib/triton_access.js lib/errors.js lib/moray_delete_record_reader.js lib/gc_manager.js lib/mako_instruction_uploader.js lib/gc_worker.js lib/moray_delete_record_cleaner.js tools/records.js\n /tmp/repo/cmd/server.js\n /tmp/repo/lib/schema.js\n /tmp/repo/lib/actors.js\n /tmp/repo/lib/common.js\n /tmp/repo/lib/delete_record_transformer.js\n /tmp/repo/lib/http_server.js\n /tmp/repo/lib/triton_access.js\n /tmp/repo/lib/errors.js\n /tmp/repo/lib/moray_delete_record_reader.js\n /tmp/repo/lib/gc_manager.js\n /tmp/repo/lib/mako_instruction_uploader.js\n /tmp/repo/lib/gc_worker.js\n /tmp/repo/lib/moray_delete_record_cleaner.js\n /tmp/repo/tools/records.js\n json --validate -f package.json\n gmake: *** No rule to make target \u0027etc/config.json.jsonchk\u0027, needed by \u0027check-json\u0027.  Stop."},{"timestamp":1540325335,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Uploaded patch set 7."},{"timestamp":1540325358,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 7: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1540418057,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 7: Code-Review+1\n\n(3 comments)"},{"timestamp":1540491918,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Uploaded patch set 8."},{"timestamp":1540491933,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Patch Set 7:\n\n(3 comments)"},{"timestamp":1540491941,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 8: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1540492368,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Uploaded patch set 9."},{"timestamp":1540492392,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 9: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1540566058,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 9: Code-Review+1"},{"timestamp":1541800021,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Uploaded patch set 10."},{"timestamp":1541804179,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 10: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1542038878,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 10:\n\n(2 comments)"},{"timestamp":1542063994,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Patch Set 10:\n\n(2 comments)"},{"timestamp":1542064024,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Uploaded patch set 11."},{"timestamp":1542064047,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 11: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1542127676,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 11: Code-Review+1\n\n(1 comment)"},{"timestamp":1543954575,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Patch Set 11: Integration-Approval+1"},{"timestamp":1544581566,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Uploaded patch set 12."},{"timestamp":1544581594,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 12: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1544585814,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Uploaded patch set 13."},{"timestamp":1544585843,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 13: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1544727723,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Uploaded patch set 14."},{"timestamp":1544727750,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 14: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1544769139,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Uploaded patch set 15."},{"timestamp":1544769166,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 15: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1544771486,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Uploaded patch set 16."},{"timestamp":1544771517,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 16: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1546877347,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 16: Code-Review+1\n\n(1 comment)\n\nThank you! You could also update the copyrights if you\u0027d like."},{"timestamp":1546887908,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Patch Set 16:\n\n(1 comment)\n\nSince the last time I looked at this it looks like the primary changes have been to add support for the old shard configuration format and that the way the determination of if the config is the old format is made is checking if the values for the minimum and maximum shard range are both zero. It also look like from the ticket that you have tested using both the old style and the new style configs. Is that correct?"},{"timestamp":1546993361,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Patch Set 16:\n\n(1 comment)\n\nKelly: The only reason for the most recent patchset is to introduce the changes needed for MANTA-4045. And yes, I have tested deploying and running collectors on:\n\na) the old config\nb) the new config\nc) on the transitional config that is created during migration with the migration tool added in MANTA-3943."},{"timestamp":1546993605,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Patch Set 16:\n\n(1 comment)"},{"timestamp":1546994802,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Uploaded patch set 17."},{"timestamp":1546994829,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 17: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1547050634,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Patch Set 17: Code-Review+1\n\nLooks good to me now. I\u0027ll give Kody a chance to take a look at the latest patchset and then I\u0027ll give an IA approval."},{"timestamp":1547050798,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 17: Code-Review+1"},{"timestamp":1547051168,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Patch Set 17: Integration-Approval+1"},{"timestamp":1547167349,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Jan Wyszynski"}],"currentPatchSet":{"number":"17","revision":"58570f830a3b6a6bd1578c6df4bb88ee34eb1ace","parents":["528e3366afb798b1a7ba75855561fc002f19f94e"],"ref":"refs/changes/63/4863/17","uploader":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"createdOn":1546994802,"author":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1546994829,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1547050634,"by":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1547050798,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1547051168,"by":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"}},{"type":"SUBM","value":"1","grantedOn":1547167349,"by":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":1,"deletions":-2},{"file":"cmd/server.js","type":"MODIFIED","insertions":52,"deletions":-16},{"file":"etc/config.json","type":"DELETED","insertions":0,"deletions":-72},{"file":"etc/config.json.template","type":"ADDED","insertions":66,"deletions":0},{"file":"etc/testconfig.json","type":"DELETED","insertions":0,"deletions":-66},{"file":"etc/testconfig.json.template","type":"ADDED","insertions":63,"deletions":0},{"file":"lib/common.js","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"lib/delete_record_transformer.js","type":"MODIFIED","insertions":1,"deletions":-2},{"file":"lib/gc_manager.js","type":"MODIFIED","insertions":14,"deletions":-353},{"file":"lib/http_server.js","type":"MODIFIED","insertions":49,"deletions":-8},{"file":"lib/mako_instruction_uploader.js","type":"MODIFIED","insertions":1,"deletions":-2},{"file":"lib/schema.js","type":"MODIFIED","insertions":62,"deletions":-11},{"file":"sapi_manifests/manta-garbage-collector/template","type":"MODIFIED","insertions":13,"deletions":-10},{"file":"test/common.js","type":"MODIFIED","insertions":41,"deletions":-36},{"file":"test/delete_record_transformer.test.js","type":"MODIFIED","insertions":18,"deletions":-17},{"file":"test/gc_manager.test.js","type":"MODIFIED","insertions":23,"deletions":-134},{"file":"test/gc_worker.test.js","type":"MODIFIED","insertions":8,"deletions":-6},{"file":"test/mako_instruction_uploader.test.js","type":"MODIFIED","insertions":10,"deletions":-15},{"file":"test/moray_delete_record_cleaner.control.test.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/moray_delete_record_cleaner.error.test.js","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"test/moray_delete_record_cleaner.test.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/moray_delete_record_reader.control.test.js","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"test/moray_delete_record_reader.error.test.js","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"test/moray_delete_record_reader.filter.test.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/moray_delete_record_reader.test.js","type":"MODIFIED","insertions":3,"deletions":-3}],"sizeInsertions":443,"sizeDeletions":-770},"patchSets":[{"number":"1","revision":"567269e7e1d0edfad7979791985274003fc2a6b8","parents":["3199d3977f7646c86b2f56f232a9bfb3ada06f31"],"ref":"refs/changes/63/4863/1","uploader":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"createdOn":1537573493,"author":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1537573519,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"cmd/server.js","type":"MODIFIED","insertions":12,"deletions":-125},{"file":"etc/config.json","type":"MODIFIED","insertions":61,"deletions":-67},{"file":"etc/testconfig.json","type":"MODIFIED","insertions":61,"deletions":-61},{"file":"lib/common.js","type":"MODIFIED","insertions":0,"deletions":-2},{"file":"lib/delete_record_transformer.js","type":"MODIFIED","insertions":7,"deletions":-13},{"file":"lib/errors.js","type":"MODIFIED","insertions":9,"deletions":-9},{"file":"lib/gc_manager.js","type":"MODIFIED","insertions":32,"deletions":-327},{"file":"lib/http_server.js","type":"MODIFIED","insertions":17,"deletions":-176},{"file":"lib/mako_instruction_uploader.js","type":"MODIFIED","insertions":7,"deletions":-18},{"file":"lib/moray_delete_record_cleaner.js","type":"MODIFIED","insertions":31,"deletions":-25},{"file":"lib/moray_delete_record_reader.js","type":"MODIFIED","insertions":28,"deletions":-31},{"file":"lib/schema.js","type":"MODIFIED","insertions":94,"deletions":-220},{"file":"sapi_manifests/manta-garbage-collector/template","type":"MODIFIED","insertions":28,"deletions":-26},{"file":"test/common.js","type":"MODIFIED","insertions":17,"deletions":-31},{"file":"test/delete_record_transformer.test.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/gc_manager.test.js","type":"MODIFIED","insertions":15,"deletions":-131},{"file":"test/gc_worker.test.js","type":"MODIFIED","insertions":5,"deletions":-3},{"file":"test/mako_instruction_uploader.test.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/moray_delete_record_cleaner.error.test.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/moray_delete_record_reader.control.test.js","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"test/moray_delete_record_reader.error.test.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/moray_delete_record_reader.test.js","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":436,"sizeDeletions":-1275},{"number":"2","revision":"811994215f416cda11d18f5609a8450bc60208ac","parents":["a1ddd1b12f59f8c4befa9ba811f70309a967c6da"],"ref":"refs/changes/63/4863/2","uploader":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"createdOn":1538174771,"author":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1538175648,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"cmd/server.js","type":"MODIFIED","insertions":1,"deletions":-2},{"file":"etc/config.json","type":"MODIFIED","insertions":61,"deletions":-67},{"file":"etc/testconfig.json","type":"MODIFIED","insertions":61,"deletions":-61},{"file":"lib/common.js","type":"MODIFIED","insertions":0,"deletions":-2},{"file":"lib/delete_record_transformer.js","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"lib/gc_manager.js","type":"MODIFIED","insertions":12,"deletions":-351},{"file":"lib/http_server.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/mako_instruction_uploader.js","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"lib/schema.js","type":"MODIFIED","insertions":6,"deletions":-6},{"file":"sapi_manifests/manta-garbage-collector/template","type":"MODIFIED","insertions":6,"deletions":-9},{"file":"test/common.js","type":"MODIFIED","insertions":17,"deletions":-31},{"file":"test/delete_record_transformer.test.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/gc_manager.test.js","type":"MODIFIED","insertions":15,"deletions":-131},{"file":"test/gc_worker.test.js","type":"MODIFIED","insertions":5,"deletions":-3},{"file":"test/mako_instruction_uploader.test.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/moray_delete_record_cleaner.error.test.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/moray_delete_record_reader.control.test.js","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"test/moray_delete_record_reader.error.test.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/moray_delete_record_reader.test.js","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":197,"sizeDeletions":-676},{"number":"3","revision":"866804507c1b828df1ba1339ae000184e106afec","parents":["bba6c3ab3fcb79c02e0001e1940891479bb753bf"],"ref":"refs/changes/63/4863/3","uploader":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"createdOn":1538174943,"author":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1538175931,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"etc/config.json","line":0,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Do we want this file checked in to the repo? Ha, it\u0027s actually helpful to have this for reviewing the other changes.\n\nIf we\u0027re going to ship these (testconfig.json too) with the repo maybe we can name them config.json.template and testconfig.json.template or something."},{"file":"etc/config.json","line":0,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Done"},{"file":"etc/testconfig.json","line":0,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"should this file be checked in?"},{"file":"etc/testconfig.json","line":0,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"I think it\u0027s reasonable to have a separate config.json and testconfig.json. A dev might want to run the tests with a separate user or different index shard for example."},{"file":"lib/common.js","line":67,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"So we shouldn\u0027t check this assert anymore?"},{"file":"lib/common.js","line":67,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"The reason I removed this assertion is that some of the test code uses components that call out to the function, but also uses the `create_mock_context` helper which creates clients as well. test/gc_manager.test.js is an example. I can add an option to `create_mock_context` which allows tests to skip creating the clients."},{"file":"lib/gc_manager.js","line":194,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"It doesn\u0027t look like this destroys workers anymore"},{"file":"lib/gc_manager.js","line":194,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Done"},{"file":"test/delete_record_transformer.test.js","line":139,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"80 cols"},{"file":"test/delete_record_transformer.test.js","line":139,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"I haven\u0027t been running jsstyle on the test code. I\u0027ll fix this one, but Is it okay with you if we move styling the tests to another ticket? (there is a lot to fix)"},{"file":"test/delete_record_transformer.test.js","line":139,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Yeah, definitely. That\u0027s a good idea."},{"file":"test/delete_record_transformer.test.js","line":139,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Done"},{"file":"test/gc_manager.test.js","line":66,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"I know this is testing code, but it might be helpful to include the mismatch in this message. e.g. \u0027expected concurrency mismatch 6 !\u003d\u003d 3\u0027 or something. I like to do this sort of thing to help myself debug tests, but it\u0027s up to you.\n\nAlso, a less likely situation is that the number of workers is \u003e the concurrency, making the \u0027missing some workers\u0027 message slightly inaccurate."},{"file":"test/gc_manager.test.js","line":66,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"cmd/server.js","type":"MODIFIED","insertions":1,"deletions":-2},{"file":"etc/config.json","type":"MODIFIED","insertions":61,"deletions":-67},{"file":"etc/testconfig.json","type":"MODIFIED","insertions":61,"deletions":-61},{"file":"lib/common.js","type":"MODIFIED","insertions":0,"deletions":-2},{"file":"lib/delete_record_transformer.js","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"lib/gc_manager.js","type":"MODIFIED","insertions":12,"deletions":-351},{"file":"lib/http_server.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/mako_instruction_uploader.js","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"lib/schema.js","type":"MODIFIED","insertions":6,"deletions":-6},{"file":"sapi_manifests/manta-garbage-collector/template","type":"MODIFIED","insertions":6,"deletions":-9},{"file":"test/common.js","type":"MODIFIED","insertions":17,"deletions":-31},{"file":"test/delete_record_transformer.test.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/gc_manager.test.js","type":"MODIFIED","insertions":15,"deletions":-131},{"file":"test/gc_worker.test.js","type":"MODIFIED","insertions":5,"deletions":-3},{"file":"test/mako_instruction_uploader.test.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/moray_delete_record_cleaner.error.test.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/moray_delete_record_reader.control.test.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/moray_delete_record_reader.error.test.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/moray_delete_record_reader.test.js","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":194,"sizeDeletions":-674},{"number":"4","revision":"ea64bbf17502ca30c66b21f0caa2086d0f0022bf","parents":["528e3366afb798b1a7ba75855561fc002f19f94e"],"ref":"refs/changes/63/4863/4","uploader":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"createdOn":1539975559,"author":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1539975583,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"cmd/server.js","type":"MODIFIED","insertions":1,"deletions":-2},{"file":"etc/config.json","type":"MODIFIED","insertions":61,"deletions":-67},{"file":"etc/config.json.template","type":"ADDED","insertions":66,"deletions":0},{"file":"etc/testconfig.json","type":"MODIFIED","insertions":61,"deletions":-61},{"file":"etc/testconfig.json.template","type":"ADDED","insertions":66,"deletions":0},{"file":"lib/common.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/delete_record_transformer.js","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"lib/gc_manager.js","type":"MODIFIED","insertions":13,"deletions":-352},{"file":"lib/http_server.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/mako_instruction_uploader.js","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"lib/schema.js","type":"MODIFIED","insertions":6,"deletions":-6},{"file":"sapi_manifests/manta-garbage-collector/template","type":"MODIFIED","insertions":6,"deletions":-9},{"file":"test/common.js","type":"MODIFIED","insertions":40,"deletions":-35},{"file":"test/delete_record_transformer.test.js","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"test/gc_manager.test.js","type":"MODIFIED","insertions":22,"deletions":-133},{"file":"test/gc_worker.test.js","type":"MODIFIED","insertions":7,"deletions":-5},{"file":"test/mako_instruction_uploader.test.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/moray_delete_record_cleaner.control.test.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/moray_delete_record_cleaner.error.test.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/moray_delete_record_cleaner.test.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/moray_delete_record_reader.control.test.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/moray_delete_record_reader.error.test.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/moray_delete_record_reader.filter.test.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/moray_delete_record_reader.test.js","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":371,"sizeDeletions":-691},{"number":"5","revision":"69aa84d8ac29fb888b91ff93710bce5999256b23","parents":["528e3366afb798b1a7ba75855561fc002f19f94e"],"ref":"refs/changes/63/4863/5","uploader":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"createdOn":1539988771,"author":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1539988794,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"cmd/server.js","type":"MODIFIED","insertions":1,"deletions":-2},{"file":"etc/config.json","type":"MODIFIED","insertions":61,"deletions":-67},{"file":"etc/config.json.template","type":"ADDED","insertions":66,"deletions":0},{"file":"etc/testconfig.json","type":"MODIFIED","insertions":61,"deletions":-61},{"file":"etc/testconfig.json.template","type":"ADDED","insertions":66,"deletions":0},{"file":"lib/common.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/delete_record_transformer.js","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"lib/gc_manager.js","type":"MODIFIED","insertions":13,"deletions":-352},{"file":"lib/http_server.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/mako_instruction_uploader.js","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"lib/schema.js","type":"MODIFIED","insertions":6,"deletions":-6},{"file":"sapi_manifests/manta-garbage-collector/template","type":"MODIFIED","insertions":6,"deletions":-9},{"file":"test/common.js","type":"MODIFIED","insertions":40,"deletions":-35},{"file":"test/delete_record_transformer.test.js","type":"MODIFIED","insertions":17,"deletions":-16},{"file":"test/gc_manager.test.js","type":"MODIFIED","insertions":22,"deletions":-133},{"file":"test/gc_worker.test.js","type":"MODIFIED","insertions":7,"deletions":-5},{"file":"test/mako_instruction_uploader.test.js","type":"MODIFIED","insertions":9,"deletions":-14},{"file":"test/moray_delete_record_cleaner.control.test.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/moray_delete_record_cleaner.error.test.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/moray_delete_record_cleaner.test.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/moray_delete_record_reader.control.test.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/moray_delete_record_reader.error.test.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/moray_delete_record_reader.filter.test.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/moray_delete_record_reader.test.js","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":392,"sizeDeletions":-717},{"number":"6","revision":"ead2265b2f70ab5ae70b30e6c32b136f445ef460","parents":["528e3366afb798b1a7ba75855561fc002f19f94e"],"ref":"refs/changes/63/4863/6","uploader":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"createdOn":1540325033,"author":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1540325054,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"cmd/server.js","type":"MODIFIED","insertions":1,"deletions":-2},{"file":"etc/config.json","type":"DELETED","insertions":0,"deletions":-72},{"file":"etc/config.json.template","type":"ADDED","insertions":66,"deletions":0},{"file":"etc/testconfig.json","type":"DELETED","insertions":0,"deletions":-66},{"file":"etc/testconfig.json.template","type":"ADDED","insertions":66,"deletions":0},{"file":"lib/common.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/delete_record_transformer.js","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"lib/gc_manager.js","type":"MODIFIED","insertions":13,"deletions":-352},{"file":"lib/http_server.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/mako_instruction_uploader.js","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"lib/schema.js","type":"MODIFIED","insertions":6,"deletions":-6},{"file":"sapi_manifests/manta-garbage-collector/template","type":"MODIFIED","insertions":6,"deletions":-9},{"file":"test/common.js","type":"MODIFIED","insertions":40,"deletions":-35},{"file":"test/delete_record_transformer.test.js","type":"MODIFIED","insertions":17,"deletions":-16},{"file":"test/gc_manager.test.js","type":"MODIFIED","insertions":22,"deletions":-133},{"file":"test/gc_worker.test.js","type":"MODIFIED","insertions":7,"deletions":-5},{"file":"test/mako_instruction_uploader.test.js","type":"MODIFIED","insertions":9,"deletions":-14},{"file":"test/moray_delete_record_cleaner.control.test.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/moray_delete_record_cleaner.error.test.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/moray_delete_record_cleaner.test.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/moray_delete_record_reader.control.test.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/moray_delete_record_reader.error.test.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/moray_delete_record_reader.filter.test.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/moray_delete_record_reader.test.js","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":270,"sizeDeletions":-727},{"number":"7","revision":"ae18b2abc6bb3b52b6c2881140a68986ba738ef2","parents":["528e3366afb798b1a7ba75855561fc002f19f94e"],"ref":"refs/changes/63/4863/7","uploader":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"createdOn":1540325335,"author":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1540325358,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1540418057,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}}],"comments":[{"file":"Makefile","line":122,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"I\u0027m not sure if this shouldn\u0027t have made it in or not, but we should remove these lines if we\u0027re not going to validate them."},{"file":"Makefile","line":122,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"I thought I might leave it in so that it\u0027s clear that these should also be validated after you replace testconfig.json.template to testconfig.json, but it\u0027s probably not necessary. Will remove."},{"file":"etc/testconfig.json.template","line":0,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Maybe we could add instructions to the README (or wherever it makes most sense) to instruct the user to copy their main config.json and make whatever changes they feel necessary before running the tests. Otherwise this file and the main config.json template file will easily get out of sync.\n\nAlso, tabs and spaces are mixed in this file."},{"file":"etc/testconfig.json.template","line":0,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Yes - I\u0027m actually including this information in a change for MANTA-3977. https://cr.joyent.us/#/c/4996/. I\u0027ll fix the tabs/spaces bit in this commit though."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"cmd/server.js","type":"MODIFIED","insertions":1,"deletions":-2},{"file":"etc/config.json","type":"DELETED","insertions":0,"deletions":-72},{"file":"etc/config.json.template","type":"ADDED","insertions":66,"deletions":0},{"file":"etc/testconfig.json","type":"DELETED","insertions":0,"deletions":-66},{"file":"etc/testconfig.json.template","type":"ADDED","insertions":66,"deletions":0},{"file":"lib/common.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/delete_record_transformer.js","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"lib/gc_manager.js","type":"MODIFIED","insertions":13,"deletions":-352},{"file":"lib/http_server.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/mako_instruction_uploader.js","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"lib/schema.js","type":"MODIFIED","insertions":6,"deletions":-6},{"file":"sapi_manifests/manta-garbage-collector/template","type":"MODIFIED","insertions":6,"deletions":-9},{"file":"test/common.js","type":"MODIFIED","insertions":40,"deletions":-35},{"file":"test/delete_record_transformer.test.js","type":"MODIFIED","insertions":17,"deletions":-16},{"file":"test/gc_manager.test.js","type":"MODIFIED","insertions":22,"deletions":-133},{"file":"test/gc_worker.test.js","type":"MODIFIED","insertions":7,"deletions":-5},{"file":"test/mako_instruction_uploader.test.js","type":"MODIFIED","insertions":9,"deletions":-14},{"file":"test/moray_delete_record_cleaner.control.test.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/moray_delete_record_cleaner.error.test.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/moray_delete_record_cleaner.test.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/moray_delete_record_reader.control.test.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/moray_delete_record_reader.error.test.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/moray_delete_record_reader.filter.test.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/moray_delete_record_reader.test.js","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":269,"sizeDeletions":-726},{"number":"8","revision":"029b37f5f78282c3d64f087d9732996694346927","parents":["528e3366afb798b1a7ba75855561fc002f19f94e"],"ref":"refs/changes/63/4863/8","uploader":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"createdOn":1540491918,"author":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1540491941,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"cmd/server.js","type":"MODIFIED","insertions":1,"deletions":-2},{"file":"etc/config.json","type":"DELETED","insertions":0,"deletions":-72},{"file":"etc/config.json.template","type":"ADDED","insertions":66,"deletions":0},{"file":"etc/testconfig.json","type":"DELETED","insertions":0,"deletions":-66},{"file":"etc/testconfig.json.template","type":"ADDED","insertions":63,"deletions":0},{"file":"lib/common.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/delete_record_transformer.js","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"lib/gc_manager.js","type":"MODIFIED","insertions":13,"deletions":-352},{"file":"lib/http_server.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/mako_instruction_uploader.js","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"lib/schema.js","type":"MODIFIED","insertions":6,"deletions":-6},{"file":"sapi_manifests/manta-garbage-collector/template","type":"MODIFIED","insertions":6,"deletions":-9},{"file":"test/common.js","type":"MODIFIED","insertions":40,"deletions":-35},{"file":"test/delete_record_transformer.test.js","type":"MODIFIED","insertions":17,"deletions":-16},{"file":"test/gc_manager.test.js","type":"MODIFIED","insertions":22,"deletions":-133},{"file":"test/gc_worker.test.js","type":"MODIFIED","insertions":7,"deletions":-5},{"file":"test/mako_instruction_uploader.test.js","type":"MODIFIED","insertions":9,"deletions":-14},{"file":"test/moray_delete_record_cleaner.control.test.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/moray_delete_record_cleaner.error.test.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/moray_delete_record_cleaner.test.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/moray_delete_record_reader.control.test.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/moray_delete_record_reader.error.test.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/moray_delete_record_reader.filter.test.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/moray_delete_record_reader.test.js","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":264,"sizeDeletions":-726},{"number":"9","revision":"ff0e44f9a06d073de3a7dcd46a43df7b366084bf","parents":["528e3366afb798b1a7ba75855561fc002f19f94e"],"ref":"refs/changes/63/4863/9","uploader":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"createdOn":1540492368,"author":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1540492392,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1540566058,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"cmd/server.js","type":"MODIFIED","insertions":1,"deletions":-2},{"file":"etc/config.json","type":"DELETED","insertions":0,"deletions":-72},{"file":"etc/config.json.template","type":"ADDED","insertions":66,"deletions":0},{"file":"etc/testconfig.json","type":"DELETED","insertions":0,"deletions":-66},{"file":"etc/testconfig.json.template","type":"ADDED","insertions":63,"deletions":0},{"file":"lib/common.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/delete_record_transformer.js","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"lib/gc_manager.js","type":"MODIFIED","insertions":13,"deletions":-352},{"file":"lib/http_server.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/mako_instruction_uploader.js","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"lib/schema.js","type":"MODIFIED","insertions":6,"deletions":-6},{"file":"sapi_manifests/manta-garbage-collector/template","type":"MODIFIED","insertions":6,"deletions":-9},{"file":"test/common.js","type":"MODIFIED","insertions":40,"deletions":-35},{"file":"test/delete_record_transformer.test.js","type":"MODIFIED","insertions":17,"deletions":-16},{"file":"test/gc_manager.test.js","type":"MODIFIED","insertions":22,"deletions":-133},{"file":"test/gc_worker.test.js","type":"MODIFIED","insertions":7,"deletions":-5},{"file":"test/mako_instruction_uploader.test.js","type":"MODIFIED","insertions":9,"deletions":-14},{"file":"test/moray_delete_record_cleaner.control.test.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/moray_delete_record_cleaner.error.test.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/moray_delete_record_cleaner.test.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/moray_delete_record_reader.control.test.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/moray_delete_record_reader.error.test.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/moray_delete_record_reader.filter.test.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/moray_delete_record_reader.test.js","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":264,"sizeDeletions":-726},{"number":"10","revision":"884b5f6266be28639cca5a44838572dfd89bbc62","parents":["528e3366afb798b1a7ba75855561fc002f19f94e"],"ref":"refs/changes/63/4863/10","uploader":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"createdOn":1541800021,"author":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1541804179,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/http_server.js","line":103,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Should this have made it in?"},{"file":"lib/http_server.js","line":103,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Done"},{"file":"lib/http_server.js","line":115,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"It seems like this function and the handle_pause_workers function could be combined into one function with a switch to determine when to pause/resume."},{"file":"lib/http_server.js","line":115,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"I think that could avoid duplicate logic, but it would also mean extra branches if we wan\u0027t to define some behavior to happen only on resumes (or pauses). One example of such behavior might be polling UFDS for new users who have had snaplinks disabled. \n\nI also just like the idea of separate routes for pauses and resumes. It makes the distinction clearer in scripts. Plus I was also inspired by similar routes for reshard plan control https://github.com/joyent/manta-reshard/blob/master/lib/http_server.js#L369-L370.\n\nLet me know what you think about this."},{"file":"lib/http_server.js","line":115,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Works for me!"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"cmd/server.js","type":"MODIFIED","insertions":1,"deletions":-2},{"file":"etc/config.json","type":"DELETED","insertions":0,"deletions":-72},{"file":"etc/config.json.template","type":"ADDED","insertions":66,"deletions":0},{"file":"etc/testconfig.json","type":"DELETED","insertions":0,"deletions":-66},{"file":"etc/testconfig.json.template","type":"ADDED","insertions":63,"deletions":0},{"file":"lib/common.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/delete_record_transformer.js","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"lib/gc_manager.js","type":"MODIFIED","insertions":13,"deletions":-352},{"file":"lib/http_server.js","type":"MODIFIED","insertions":50,"deletions":-7},{"file":"lib/mako_instruction_uploader.js","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"lib/schema.js","type":"MODIFIED","insertions":32,"deletions":-8},{"file":"sapi_manifests/manta-garbage-collector/template","type":"MODIFIED","insertions":6,"deletions":-9},{"file":"test/common.js","type":"MODIFIED","insertions":40,"deletions":-35},{"file":"test/delete_record_transformer.test.js","type":"MODIFIED","insertions":17,"deletions":-16},{"file":"test/gc_manager.test.js","type":"MODIFIED","insertions":22,"deletions":-133},{"file":"test/gc_worker.test.js","type":"MODIFIED","insertions":7,"deletions":-5},{"file":"test/mako_instruction_uploader.test.js","type":"MODIFIED","insertions":9,"deletions":-14},{"file":"test/moray_delete_record_cleaner.control.test.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/moray_delete_record_cleaner.error.test.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/moray_delete_record_cleaner.test.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/moray_delete_record_reader.control.test.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/moray_delete_record_reader.error.test.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/moray_delete_record_reader.filter.test.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/moray_delete_record_reader.test.js","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":339,"sizeDeletions":-734},{"number":"11","revision":"f576a87ea109dd082b0942d69925c41241098bb7","parents":["528e3366afb798b1a7ba75855561fc002f19f94e"],"ref":"refs/changes/63/4863/11","uploader":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"createdOn":1542064024,"author":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1542064047,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1542127676,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1543954575,"by":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"cmd/server.js","type":"MODIFIED","insertions":1,"deletions":-2},{"file":"etc/config.json","type":"DELETED","insertions":0,"deletions":-72},{"file":"etc/config.json.template","type":"ADDED","insertions":66,"deletions":0},{"file":"etc/testconfig.json","type":"DELETED","insertions":0,"deletions":-66},{"file":"etc/testconfig.json.template","type":"ADDED","insertions":63,"deletions":0},{"file":"lib/common.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/delete_record_transformer.js","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"lib/gc_manager.js","type":"MODIFIED","insertions":13,"deletions":-352},{"file":"lib/http_server.js","type":"MODIFIED","insertions":48,"deletions":-7},{"file":"lib/mako_instruction_uploader.js","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"lib/schema.js","type":"MODIFIED","insertions":32,"deletions":-8},{"file":"sapi_manifests/manta-garbage-collector/template","type":"MODIFIED","insertions":6,"deletions":-9},{"file":"test/common.js","type":"MODIFIED","insertions":40,"deletions":-35},{"file":"test/delete_record_transformer.test.js","type":"MODIFIED","insertions":17,"deletions":-16},{"file":"test/gc_manager.test.js","type":"MODIFIED","insertions":22,"deletions":-133},{"file":"test/gc_worker.test.js","type":"MODIFIED","insertions":7,"deletions":-5},{"file":"test/mako_instruction_uploader.test.js","type":"MODIFIED","insertions":9,"deletions":-14},{"file":"test/moray_delete_record_cleaner.control.test.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/moray_delete_record_cleaner.error.test.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/moray_delete_record_cleaner.test.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/moray_delete_record_reader.control.test.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/moray_delete_record_reader.error.test.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/moray_delete_record_reader.filter.test.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/moray_delete_record_reader.test.js","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":337,"sizeDeletions":-734},{"number":"12","revision":"f47e018dd4b034ff779196290dfd1d728b2cda7f","parents":["528e3366afb798b1a7ba75855561fc002f19f94e"],"ref":"refs/changes/63/4863/12","uploader":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"createdOn":1544581566,"author":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1544581594,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"cmd/server.js","type":"MODIFIED","insertions":106,"deletions":-25},{"file":"etc/config.json","type":"DELETED","insertions":0,"deletions":-72},{"file":"etc/config.json.template","type":"ADDED","insertions":66,"deletions":0},{"file":"etc/testconfig.json","type":"DELETED","insertions":0,"deletions":-66},{"file":"etc/testconfig.json.template","type":"ADDED","insertions":63,"deletions":0},{"file":"lib/common.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/delete_record_transformer.js","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"lib/gc_manager.js","type":"MODIFIED","insertions":13,"deletions":-352},{"file":"lib/http_server.js","type":"MODIFIED","insertions":48,"deletions":-7},{"file":"lib/mako_instruction_uploader.js","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"lib/schema.js","type":"MODIFIED","insertions":191,"deletions":-9},{"file":"sapi_manifests/manta-garbage-collector/template","type":"MODIFIED","insertions":6,"deletions":-9},{"file":"test/common.js","type":"MODIFIED","insertions":40,"deletions":-35},{"file":"test/delete_record_transformer.test.js","type":"MODIFIED","insertions":17,"deletions":-16},{"file":"test/gc_manager.test.js","type":"MODIFIED","insertions":22,"deletions":-133},{"file":"test/gc_worker.test.js","type":"MODIFIED","insertions":7,"deletions":-5},{"file":"test/mako_instruction_uploader.test.js","type":"MODIFIED","insertions":9,"deletions":-14},{"file":"test/moray_delete_record_cleaner.control.test.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/moray_delete_record_cleaner.error.test.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/moray_delete_record_cleaner.test.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/moray_delete_record_reader.control.test.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/moray_delete_record_reader.error.test.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/moray_delete_record_reader.filter.test.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/moray_delete_record_reader.test.js","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":601,"sizeDeletions":-758},{"number":"13","revision":"10b2a1035267ecfc0586700b54e5ef95f9d26552","parents":["528e3366afb798b1a7ba75855561fc002f19f94e"],"ref":"refs/changes/63/4863/13","uploader":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"createdOn":1544585814,"author":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1544585843,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"cmd/server.js","type":"MODIFIED","insertions":106,"deletions":-25},{"file":"etc/config.json","type":"DELETED","insertions":0,"deletions":-72},{"file":"etc/config.json.template","type":"ADDED","insertions":66,"deletions":0},{"file":"etc/testconfig.json","type":"DELETED","insertions":0,"deletions":-66},{"file":"etc/testconfig.json.template","type":"ADDED","insertions":63,"deletions":0},{"file":"lib/common.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/delete_record_transformer.js","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"lib/gc_manager.js","type":"MODIFIED","insertions":13,"deletions":-352},{"file":"lib/http_server.js","type":"MODIFIED","insertions":48,"deletions":-7},{"file":"lib/mako_instruction_uploader.js","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"lib/schema.js","type":"MODIFIED","insertions":191,"deletions":-9},{"file":"sapi_manifests/manta-garbage-collector/template","type":"MODIFIED","insertions":12,"deletions":-10},{"file":"test/common.js","type":"MODIFIED","insertions":40,"deletions":-35},{"file":"test/delete_record_transformer.test.js","type":"MODIFIED","insertions":17,"deletions":-16},{"file":"test/gc_manager.test.js","type":"MODIFIED","insertions":22,"deletions":-133},{"file":"test/gc_worker.test.js","type":"MODIFIED","insertions":7,"deletions":-5},{"file":"test/mako_instruction_uploader.test.js","type":"MODIFIED","insertions":9,"deletions":-14},{"file":"test/moray_delete_record_cleaner.control.test.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/moray_delete_record_cleaner.error.test.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/moray_delete_record_cleaner.test.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/moray_delete_record_reader.control.test.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/moray_delete_record_reader.error.test.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/moray_delete_record_reader.filter.test.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/moray_delete_record_reader.test.js","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":607,"sizeDeletions":-759},{"number":"14","revision":"a71089efed3d92793d97edf52071271da0c0d6ba","parents":["528e3366afb798b1a7ba75855561fc002f19f94e"],"ref":"refs/changes/63/4863/14","uploader":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"createdOn":1544727723,"author":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1544727750,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"cmd/server.js","type":"MODIFIED","insertions":48,"deletions":-15},{"file":"etc/config.json","type":"DELETED","insertions":0,"deletions":-72},{"file":"etc/config.json.template","type":"ADDED","insertions":66,"deletions":0},{"file":"etc/testconfig.json","type":"DELETED","insertions":0,"deletions":-66},{"file":"etc/testconfig.json.template","type":"ADDED","insertions":63,"deletions":0},{"file":"lib/common.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/delete_record_transformer.js","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"lib/gc_manager.js","type":"MODIFIED","insertions":13,"deletions":-352},{"file":"lib/http_server.js","type":"MODIFIED","insertions":48,"deletions":-7},{"file":"lib/mako_instruction_uploader.js","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"lib/schema.js","type":"MODIFIED","insertions":61,"deletions":-10},{"file":"sapi_manifests/manta-garbage-collector/template","type":"MODIFIED","insertions":13,"deletions":-10},{"file":"test/common.js","type":"MODIFIED","insertions":40,"deletions":-35},{"file":"test/delete_record_transformer.test.js","type":"MODIFIED","insertions":17,"deletions":-16},{"file":"test/gc_manager.test.js","type":"MODIFIED","insertions":22,"deletions":-133},{"file":"test/gc_worker.test.js","type":"MODIFIED","insertions":7,"deletions":-5},{"file":"test/mako_instruction_uploader.test.js","type":"MODIFIED","insertions":9,"deletions":-14},{"file":"test/moray_delete_record_cleaner.control.test.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/moray_delete_record_cleaner.error.test.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/moray_delete_record_cleaner.test.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/moray_delete_record_reader.control.test.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/moray_delete_record_reader.error.test.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/moray_delete_record_reader.filter.test.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/moray_delete_record_reader.test.js","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":420,"sizeDeletions":-750},{"number":"15","revision":"99700304510e93ec378310e22b63d05029d38ee7","parents":["528e3366afb798b1a7ba75855561fc002f19f94e"],"ref":"refs/changes/63/4863/15","uploader":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"createdOn":1544769139,"author":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1544769166,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"cmd/server.js","type":"MODIFIED","insertions":48,"deletions":-15},{"file":"etc/config.json","type":"DELETED","insertions":0,"deletions":-72},{"file":"etc/config.json.template","type":"ADDED","insertions":66,"deletions":0},{"file":"etc/testconfig.json","type":"DELETED","insertions":0,"deletions":-66},{"file":"etc/testconfig.json.template","type":"ADDED","insertions":63,"deletions":0},{"file":"lib/common.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/delete_record_transformer.js","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"lib/gc_manager.js","type":"MODIFIED","insertions":13,"deletions":-352},{"file":"lib/http_server.js","type":"MODIFIED","insertions":48,"deletions":-7},{"file":"lib/mako_instruction_uploader.js","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"lib/schema.js","type":"MODIFIED","insertions":61,"deletions":-10},{"file":"sapi_manifests/manta-garbage-collector/template","type":"MODIFIED","insertions":12,"deletions":-10},{"file":"test/common.js","type":"MODIFIED","insertions":40,"deletions":-35},{"file":"test/delete_record_transformer.test.js","type":"MODIFIED","insertions":17,"deletions":-16},{"file":"test/gc_manager.test.js","type":"MODIFIED","insertions":22,"deletions":-133},{"file":"test/gc_worker.test.js","type":"MODIFIED","insertions":7,"deletions":-5},{"file":"test/mako_instruction_uploader.test.js","type":"MODIFIED","insertions":9,"deletions":-14},{"file":"test/moray_delete_record_cleaner.control.test.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/moray_delete_record_cleaner.error.test.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/moray_delete_record_cleaner.test.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/moray_delete_record_reader.control.test.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/moray_delete_record_reader.error.test.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/moray_delete_record_reader.filter.test.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/moray_delete_record_reader.test.js","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":419,"sizeDeletions":-750},{"number":"16","revision":"83b0e8db1af97422625f8d9eb171d9d3564e54dd","parents":["528e3366afb798b1a7ba75855561fc002f19f94e"],"ref":"refs/changes/63/4863/16","uploader":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"createdOn":1544771486,"author":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1544771517,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1546877347,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}}],"comments":[{"file":"cmd/server.js","line":134,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"FWIW I think it\u0027s supposed valid to have a shard without the word \u0027moray\u0027 in the name. In reality I think \u0027moray\u0027 has to be in the name though (MANTA-3593).\n\nAnyway, since this config migration code is built for a specific purpose in a specific environment I think this is fine."},{"file":"cmd/server.js","line":134,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"I agree. I don\u0027t think we should hardcode the service name. We can default to `moray`, but if this code needs to live forever for the sake of backwards compatibility then we don\u0027t know that the name `moray` will always be used. It probably will, but we don\u0027t know and it doesn\u0027t cost much to make it configurable."},{"file":"cmd/server.js","line":134,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Would adding a SHARD_SERVICE_NAME SAPI tunable to the garbage-collector service metadata be suitable? \n\nThis code could check that that variable first and then use \u0027moray\u0027 if it\u0027s not present."},{"file":"cmd/server.js","line":134,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Yeah, that would be fine I think."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"cmd/server.js","type":"MODIFIED","insertions":50,"deletions":-15},{"file":"etc/config.json","type":"DELETED","insertions":0,"deletions":-72},{"file":"etc/config.json.template","type":"ADDED","insertions":66,"deletions":0},{"file":"etc/testconfig.json","type":"DELETED","insertions":0,"deletions":-66},{"file":"etc/testconfig.json.template","type":"ADDED","insertions":63,"deletions":0},{"file":"lib/common.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/delete_record_transformer.js","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"lib/gc_manager.js","type":"MODIFIED","insertions":13,"deletions":-352},{"file":"lib/http_server.js","type":"MODIFIED","insertions":48,"deletions":-7},{"file":"lib/mako_instruction_uploader.js","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"lib/schema.js","type":"MODIFIED","insertions":61,"deletions":-10},{"file":"sapi_manifests/manta-garbage-collector/template","type":"MODIFIED","insertions":12,"deletions":-10},{"file":"test/common.js","type":"MODIFIED","insertions":40,"deletions":-35},{"file":"test/delete_record_transformer.test.js","type":"MODIFIED","insertions":17,"deletions":-16},{"file":"test/gc_manager.test.js","type":"MODIFIED","insertions":22,"deletions":-133},{"file":"test/gc_worker.test.js","type":"MODIFIED","insertions":7,"deletions":-5},{"file":"test/mako_instruction_uploader.test.js","type":"MODIFIED","insertions":9,"deletions":-14},{"file":"test/moray_delete_record_cleaner.control.test.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/moray_delete_record_cleaner.error.test.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/moray_delete_record_cleaner.test.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/moray_delete_record_reader.control.test.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/moray_delete_record_reader.error.test.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/moray_delete_record_reader.filter.test.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/moray_delete_record_reader.test.js","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":421,"sizeDeletions":-750},{"number":"17","revision":"58570f830a3b6a6bd1578c6df4bb88ee34eb1ace","parents":["528e3366afb798b1a7ba75855561fc002f19f94e"],"ref":"refs/changes/63/4863/17","uploader":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"createdOn":1546994802,"author":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1546994829,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1547050798,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1547050634,"by":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1547051168,"by":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"}},{"type":"SUBM","value":"1","grantedOn":1547167349,"by":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":1,"deletions":-2},{"file":"cmd/server.js","type":"MODIFIED","insertions":52,"deletions":-16},{"file":"etc/config.json","type":"DELETED","insertions":0,"deletions":-72},{"file":"etc/config.json.template","type":"ADDED","insertions":66,"deletions":0},{"file":"etc/testconfig.json","type":"DELETED","insertions":0,"deletions":-66},{"file":"etc/testconfig.json.template","type":"ADDED","insertions":63,"deletions":0},{"file":"lib/common.js","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"lib/delete_record_transformer.js","type":"MODIFIED","insertions":1,"deletions":-2},{"file":"lib/gc_manager.js","type":"MODIFIED","insertions":14,"deletions":-353},{"file":"lib/http_server.js","type":"MODIFIED","insertions":49,"deletions":-8},{"file":"lib/mako_instruction_uploader.js","type":"MODIFIED","insertions":1,"deletions":-2},{"file":"lib/schema.js","type":"MODIFIED","insertions":62,"deletions":-11},{"file":"sapi_manifests/manta-garbage-collector/template","type":"MODIFIED","insertions":13,"deletions":-10},{"file":"test/common.js","type":"MODIFIED","insertions":41,"deletions":-36},{"file":"test/delete_record_transformer.test.js","type":"MODIFIED","insertions":18,"deletions":-17},{"file":"test/gc_manager.test.js","type":"MODIFIED","insertions":23,"deletions":-134},{"file":"test/gc_worker.test.js","type":"MODIFIED","insertions":8,"deletions":-6},{"file":"test/mako_instruction_uploader.test.js","type":"MODIFIED","insertions":10,"deletions":-15},{"file":"test/moray_delete_record_cleaner.control.test.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/moray_delete_record_cleaner.error.test.js","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"test/moray_delete_record_cleaner.test.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/moray_delete_record_reader.control.test.js","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"test/moray_delete_record_reader.error.test.js","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"test/moray_delete_record_reader.filter.test.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/moray_delete_record_reader.test.js","type":"MODIFIED","insertions":3,"deletions":-3}],"sizeInsertions":443,"sizeDeletions":-770}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"}]}