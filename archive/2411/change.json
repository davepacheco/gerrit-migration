{"project":"joyent/manta-muskie","branch":"master","id":"I0aca7a4f972564a594e24622a1299b902c09326e","number":"2411","subject":"MANTA-3376 Muskie Makefile cleanup TOOLS-1810 common Makefile infrastructure for NPM public registry use TOOLS-1814 retire \"node_deps\" Makefile from eng.git Reviewed by: David Pacheco \u003cdap@joyent.com\u003e Approved by: Cody Peter Mello \u003ccody.mello@joyent.com\u003e","owner":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"url":"https://cr.joyent.us/2411","commitMessage":"MANTA-3376 Muskie Makefile cleanup\nTOOLS-1810 common Makefile infrastructure for NPM public registry use\nTOOLS-1814 retire \"node_deps\" Makefile from eng.git\nReviewed by: David Pacheco \u003cdap@joyent.com\u003e\nApproved by: Cody Peter Mello \u003ccody.mello@joyent.com\u003e\n","createdOn":1502840439,"lastUpdated":1502934375,"open":false,"status":"MERGED","comments":[{"timestamp":1502840439,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Uploaded patch set 1."},{"timestamp":1502840471,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1502911281,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 1: Code-Review+1\n\n(3 comments)"},{"timestamp":1502918573,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Patch Set 1:\n\n(3 comments)"},{"timestamp":1502933830,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 1: Integration-Approval+1"},{"timestamp":1502934368,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Uploaded patch set 2: Commit message was updated."},{"timestamp":1502934375,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Joshua M. Clulow"}],"currentPatchSet":{"number":"2","revision":"0aca7a4f972564a594e24622a1299b902c09326e","parents":["af4520cc26aaed16d4e4024f8088c4a2d6eed8b0"],"ref":"refs/changes/11/2411/2","uploader":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"createdOn":1502934368,"author":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1502840471,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1502911281,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1502933830,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"SUBM","value":"1","grantedOn":1502934375,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":-2},{"file":"Makefile","type":"MODIFIED","insertions":42,"deletions":-83},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"tools/mk/Makefile.defs","type":"MODIFIED","insertions":48,"deletions":-2},{"file":"tools/mk/Makefile.deps","type":"MODIFIED","insertions":2,"deletions":0},{"file":"tools/mk/Makefile.node.defs","type":"MODIFIED","insertions":11,"deletions":-5},{"file":"tools/mk/Makefile.node.targ","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"tools/mk/Makefile.node_deps.defs","type":"DELETED","insertions":0,"deletions":-43},{"file":"tools/mk/Makefile.node_deps.targ","type":"DELETED","insertions":0,"deletions":-24},{"file":"tools/mk/Makefile.node_modules.defs","type":"ADDED","insertions":68,"deletions":0},{"file":"tools/mk/Makefile.node_modules.targ","type":"ADDED","insertions":31,"deletions":0},{"file":"tools/mk/Makefile.node_prebuilt.defs","type":"MODIFIED","insertions":11,"deletions":-5},{"file":"tools/mk/Makefile.smf.targ","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"tools/mk/Makefile.targ","type":"MODIFIED","insertions":26,"deletions":-9}],"sizeInsertions":243,"sizeDeletions":-176},"patchSets":[{"number":"1","revision":"d3aae362ec2ca4f634846f56a2ab96eee8538ef7","parents":["af4520cc26aaed16d4e4024f8088c4a2d6eed8b0"],"ref":"refs/changes/11/2411/1","uploader":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"createdOn":1502840439,"author":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1502911281,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1502933830,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1502840471,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"Makefile","line":66,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"What was this doing?"},{"file":"Makefile","line":66,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"I believe it was setting PATH for child processes to include the place where \"node\" is installed as part of the build.  We\u0027re doing this in a more explicit and hopefully robust way by using $(NODE) and $(NPM) everywhere now, which both set PATH appropriately _and_ use fully qualified paths."},{"file":"Makefile","line":78,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I take it this wasn\u0027t needed any more?"},{"file":"Makefile","line":78,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"It does not seem to be needed -- certainly the local and the Jenkins builds complete successfully, and the resultant image boots up and tests pass.  I don\u0027t know if this was ever actually necessary for Muskie in particular."},{"file":"Makefile","line":65,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"It seems more proper to have \"test\" depend on \"all\".  There could be other steps to the standard build besides installing node_modules, and test should depend on all of them.  In this case, I don\u0027t think it matters in practice because the only other thing in \"all\" is SMF_MANIFESTS and manta-scripts, which we don\u0027t end up testing."},{"file":"Makefile","line":65,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"I was trying to avoid depending on \"all\", because it depends on \"manta-scripts\" which is phony and thus the recipe will always run even when not needed.  If you feel strongly about it, I\u0027m happy to change it, but I think that given the specifics you mention it\u0027s probably fine the way it is here."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":-2},{"file":"Makefile","type":"MODIFIED","insertions":42,"deletions":-83},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"tools/mk/Makefile.defs","type":"MODIFIED","insertions":48,"deletions":-2},{"file":"tools/mk/Makefile.deps","type":"MODIFIED","insertions":2,"deletions":0},{"file":"tools/mk/Makefile.node.defs","type":"MODIFIED","insertions":11,"deletions":-5},{"file":"tools/mk/Makefile.node.targ","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"tools/mk/Makefile.node_deps.defs","type":"DELETED","insertions":0,"deletions":-43},{"file":"tools/mk/Makefile.node_deps.targ","type":"DELETED","insertions":0,"deletions":-24},{"file":"tools/mk/Makefile.node_modules.defs","type":"ADDED","insertions":68,"deletions":0},{"file":"tools/mk/Makefile.node_modules.targ","type":"ADDED","insertions":31,"deletions":0},{"file":"tools/mk/Makefile.node_prebuilt.defs","type":"MODIFIED","insertions":11,"deletions":-5},{"file":"tools/mk/Makefile.smf.targ","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"tools/mk/Makefile.targ","type":"MODIFIED","insertions":26,"deletions":-9}],"sizeInsertions":243,"sizeDeletions":-176},{"number":"2","revision":"0aca7a4f972564a594e24622a1299b902c09326e","parents":["af4520cc26aaed16d4e4024f8088c4a2d6eed8b0"],"ref":"refs/changes/11/2411/2","uploader":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"createdOn":1502934368,"author":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1502911281,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1502933830,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"SUBM","value":"1","grantedOn":1502934375,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1502840471,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":-2},{"file":"Makefile","type":"MODIFIED","insertions":42,"deletions":-83},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"tools/mk/Makefile.defs","type":"MODIFIED","insertions":48,"deletions":-2},{"file":"tools/mk/Makefile.deps","type":"MODIFIED","insertions":2,"deletions":0},{"file":"tools/mk/Makefile.node.defs","type":"MODIFIED","insertions":11,"deletions":-5},{"file":"tools/mk/Makefile.node.targ","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"tools/mk/Makefile.node_deps.defs","type":"DELETED","insertions":0,"deletions":-43},{"file":"tools/mk/Makefile.node_deps.targ","type":"DELETED","insertions":0,"deletions":-24},{"file":"tools/mk/Makefile.node_modules.defs","type":"ADDED","insertions":68,"deletions":0},{"file":"tools/mk/Makefile.node_modules.targ","type":"ADDED","insertions":31,"deletions":0},{"file":"tools/mk/Makefile.node_prebuilt.defs","type":"MODIFIED","insertions":11,"deletions":-5},{"file":"tools/mk/Makefile.smf.targ","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"tools/mk/Makefile.targ","type":"MODIFIED","insertions":26,"deletions":-9}],"sizeInsertions":243,"sizeDeletions":-176}],"allReviewers":[{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}]}