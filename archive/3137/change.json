{"project":"joyent/illumos-joyent","branch":"master","id":"I1a34bceaa14b4cf3a9cf90aa9c4dae5eb003d9d7","number":"3137","subject":"OS-5326 SRS ring polling disabled for VLANs OS-6244 Want DLS bypass for VLAN traffic OS-6593 add VLVF bypass to ixgbe core Reviewed by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e Reviewed by: Robert Mustacchi \u003crm@joyent.com\u003e Reviewed by: Dan McDonald \u003cdan","owner":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"url":"https://cr.joyent.us/3137","commitMessage":"OS-5326 SRS ring polling disabled for VLANs\nOS-6244 Want DLS bypass for VLAN traffic\nOS-6593 add VLVF bypass to ixgbe core\nReviewed by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e\nReviewed by: Robert Mustacchi \u003crm@joyent.com\u003e\nReviewed by: Dan McDonald \u003cdanmcd@joyent.com\u003e\nApproved by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e\n","createdOn":1513987821,"lastUpdated":1521235837,"open":false,"status":"MERGED","comments":[{"timestamp":1513987821,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Uploaded patch set 1."},{"timestamp":1513988187,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Patch Set 1:\n\nThis still needs some work around VLAN_ID_NONE/untagged and a bug I found in datapath setup, but I wanted to post this up so people can at least get an idea of what\u0027s coming. Please no comments until Tuesday (12/26) so I can enjoy the holiday."},{"timestamp":1514491569,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 1:\n\n(68 comments)\n\nFirst round of comments, comprised mostly of comment nit-picking.\n\nI\u0027ll probably swing through for another look later, once some of the CR fatigue wears off."},{"timestamp":1514647812,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 1:\n\n(63 comments)\n\nThis looks like a good first pass at this work. Thank you especially for updating the comments and clarifying many of them."},{"timestamp":1516551572,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Patch Set 1:\n\n(126 comments)"},{"timestamp":1516551606,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Uploaded patch set 2."},{"timestamp":1516553110,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Patch Set 2:\n\nAny clients sharing a mac_address_t must live on the default group.\n\nMAC has always had the assumption that a reserved group has HW\nresources available to it; look at the way it does MAC addr filtering.\nThere is no logic in mac_datapath_setup() to move a client from a\nreserved group to default when the HW filter fails to apply and we put\nthe driver in promisc mode. This is important because under promsic\nmode any traffic without an explicit HW L2 filter will hit the default\ngroup. Thus MAC assumes that a reserved group always gets a HW L2\nfilter.\n\nNow, take the case of multiple clients sharing a MAC address. This\nhappens when the clients are VLAN VNICs: multiple clients with the\nsame MAC addr but unique VIDs. The current logic puts these clients on\na shared non-default group if there is one available. When we were\ndoing pure VLAN SW classification this was fine, but it greatly\ncomplicated things when I introduced HW VLAN filtering. It broke the\nassumption that a reserved group always has HW filtering available to\nit. E.g., in the extreme case you could have one group with 63\ndifferent VLAN VNIC clients on it, eating all the available VLVF\nfilters. Then the next VLAN VNIC (on a different MAC addr) would have\na reserved group with a HW MAC addr filter but no VLAN filter\navailable. This caused me all sorts of pain and made it hard to keep\nthe edge cases straight in my head. You can solve this problem with\nadditional logic and VPE but I don\u0027t think it\u0027s worth it. Instead, I\nrestored MAC\u0027s assumption about reserved groups and HW filters by\nmigrating all shared MAC addrs to the default group during\nmac_datapath_setup(). With this change I know that there is always a\nVLVF available for a reserved group. There are 63 available VLAN\nfilters (slot 0 reserved for VID 0). There can be a max of 64 groups.\nBut 1 group will never have a VLAN: the default.\n\nFurthermore, it made little sense to share non-default groups anyways\nbecause the moment a group is shared it requirs SW classification.\nWith my change in place we will no longer consume reserved groups only\nto SW classify their traffic.\n\nThere are other places in the code that might be simplified with this\nnew assumption. I didn\u0027t update them all in case I got pushback for\nthis change. But I can go circle around and update any comments and\nfunctions that might be simplified with this assumption in place."},{"timestamp":1516553202,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Patch Set 2:\n\nUgh, forgot to copy the first line of that last comment. It should start as follows.\n\n\nI made one major change that greatly simplified things for me:\n\nAny clients sharing a mac_address_t must live on the default group.\n\n..."},{"timestamp":1516741916,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 2:\n\n(17 comments)"},{"timestamp":1518666453,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Uploaded patch set 3."},{"timestamp":1518666463,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Patch Set 2:\n\n(17 comments)"},{"timestamp":1518733840,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 3:\n\n(13 comments)\n\nHere\u0027s pass-0/1.  Some overarching questions include:\n\n- Error propagation or other diagnosis/observability for the new aggr failure of \"mixed VLAN-support\"?\n\n- Have you regression-tested drivers that are NOT ixgbe?  (Not the same as adding support for other-drivers like you have for ixgbe. I know that\u0027s a whole different bug/RFE.)\n\n- What all should I drill into even further for pass-1/2?"},{"timestamp":1518740548,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 3:\n\n(9 comments)\n\nThe changes for ixgbe are a lot more straightforward now! Thank for clearing that up. I have a feeling we may need to rathole on the aggr related changes for a little bit. It may be worth doing the aggr / vlan bit in a separate change, as the rest of this looks good.\n\nFinally, don\u0027t forget to run pbchk and make sure that all the copyrights, etc. are in order."},{"timestamp":1519860511,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Uploaded patch set 4."},{"timestamp":1519861072,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Patch Set 3:\n\n(20 comments)\n\nDan, to your questions:\n\n\nError propagation or other diagnosis/observability for the new aggr failure of \"mixed VLAN-support\"?\n\n\nI\u0027ve modified the code to support mixed HW. I think that was your only concern re error propagation?\n\n\nHave you regression-tested drivers that are NOT ixgbe? (Not the same as adding support for other-drivers like you have for ixgbe. I know that\u0027s a whole different bug/RFE.)\n\nI have run on igb as well as tested a mixed igb/ixgbe aggr. Do you think that suffices?\n\nWhat all should I drill into even further for pass-1/2?\n\n\nYou\u0027re comment pertaining to VERIFY and nefarious users got me thinking: perhaps I should look over all the verifies in here and make sure nothing else is susceptible. If you do another pass I\u0027d like your thoughts on that. Basically, I used a lot of VERIFY because I want to make sure we are never running in a busted state; but perhaps I\u0027ve been too heavy handed. I didn\u0027t think about nefarious users. Nor did I think about Robert\u0027s point about not bringing down the entire box because of one bad piece of hardware."},{"timestamp":1520875637,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Uploaded patch set 5."},{"timestamp":1520876329,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Patch Set 5:\n\n\u003e Uploaded patch set 5.\n\nWhile working on OS-6719 I noticed that this patch wasn\u0027t setting the VLAN filters during port addition/removal (i.e., aggr_{rem,add}_pseudo_rx_group)).\n\nWhile here I also downgraded some VERIFY back to ASSERT. I wanted to minimize the changes made to functions that aren\u0027t really vital to the VLAN filtering to make the diff easier to review (and hopefully upstream in the near future).\n\nI also changed some VERIFY to cmn_err(). I did this in places where we are at the mercy of the hardware. As Robert pointed out, we shouldn\u0027t necessarily panic because of rogue hardware."},{"timestamp":1521047808,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 5: Code-Review+1\n\n(1 comment)\n\nThanks for all the iteration on this. All in all, this is looking pretty good."},{"timestamp":1521155106,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Uploaded patch set 6."},{"timestamp":1521155147,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Patch Set 6:\n\n(1 comment)"},{"timestamp":1521156684,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 6: Code-Review+1"},{"timestamp":1521158591,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 6:\n\n(7 comments)"},{"timestamp":1521166864,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Uploaded patch set 7."},{"timestamp":1521167068,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Patch Set 7:\n\n(7 comments)"},{"timestamp":1521174786,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Uploaded patch set 8."},{"timestamp":1521175416,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Uploaded patch set 9."},{"timestamp":1521176312,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 7:\n\n(1 comment)"},{"timestamp":1521177072,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Patch Set 7:\n\n(1 comment)"},{"timestamp":1521178000,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Uploaded patch set 10."},{"timestamp":1521178114,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Patch Set 7:\n\n(1 comment)"},{"timestamp":1521178250,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 10: Code-Review+1"},{"timestamp":1521234348,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 10: Code-Review+1"},{"timestamp":1521234681,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Patch Set 10:\n\nI tested various scenarios with a script I wrote (to make sure my tests were repeatable and less prone to human error). I won\u0027t claim these tests cover everything, but they should cover the majority of what we typically see in a production environment. The aggr tests were run on several scenarios: 1) aggr of two ixgbe ports, 2) aggr of mixed ixgbe/igb, 3) aggr with 9000 MTU.\n\n* Verify I can create a VNIC on ixgbe.\n* Verify I can create a VLAN VNIC on ixgbe.\n* Verify that a VNIC on ixgbe gets HW resources and traffic received on this VNIC uses those HW resources.\n* Verify that a VLAN VNIC on ixgbe gets HW resource and traffic received on this VLAN VNIC uses those HW resources.\n* Verify that two VLAN VNICs sharing the same unicast MAC address are placed on the default group and their Rx traffic is SW classified.\n* Create more VLAN VNICs than there are HW groups so that I know some of the VLAN VNICs are on the default group, delete all the VLAN VNICs on HW groups, delete all but one VLAN VNIC on the default group, verify I can still receive traffic on that remaining VLAN VNIC. This tests the VLAN reference counting and some internal ixgbe logic related to the VFTA/VLVF.\n* Create one VLAN VNIC with rxrings\u003dsw to put in on default group, create another VLAN VNIC with same vid on non-default group, verify Rx traffic flows over VLAN VNIC #1, delete VLAN VNIC #2, reverify traffic flows over VLAN VNIC #1. This tests yet another internal edge case in ixgbe related to VLVF/VFTA.\n* Put two VLAN VNICs with the same vid on the default group (via rxrings\u003dsw), then delete one VLAN VNIC and verify traffic is still received on the other. This is another test of VLAN reference counting.\n* Create enough VLAN VNICs to use all HW groups on the MAC. Verify they all receive traffic over HW.\n* Create enough VLAN VNICs  to use all HW groups. Then create another VLAN VNIC but specify rxrings\u003dhw to explicitly ask for a HW group. This will cause the new VLAN VNIC to steal one of the HW groups. This tests the client group-switching logic.\n* Verify that Rx data travels over HW when using the aggr primary client. (If you modify the aggr MTU then this breaks, but that bug existed before this wad).\n* Verify that Rx data tavels over HW when placing a VLAN (dladm create-vlan) on the aggr primary client.\n* Verify that two VNICs can exist on an aggr and receive traffic over SW.\n* Verify that a single VLAN VNIC on an aggr receives traffic over HW.\n* Verify that two VLAN VNICs can exist on an aggr and receive traffic over SW.\n* Verify that two VLAN VNICs sharing the same unicast MAC address can exist on an aggr and received traffic over SW.\n* Create two VNICs on an aggr, delete one, verify the remaining VNIC still receives traffic, and that it\u0027s over HW.\n* Verify that a VNIC and VLAN VNIC can coexist on an aggr and receive traffic, over SW.\n* Verify that a VLAN VNIC on an etherstub can received traffic."},{"timestamp":1521235005,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Patch Set 10:\n\nIt\u0027s also worth mentioning that I tested this on aggrs both with LACP mode set to active and with it set to off."},{"timestamp":1521235169,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 10: Integration-Approval+1"},{"timestamp":1521235679,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Uploaded patch set 11: Patch Set 10 was rebased."},{"timestamp":1521235807,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Uploaded patch set 12: Commit message was updated."},{"timestamp":1521235837,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Ryan Zezeski"}],"currentPatchSet":{"number":"12","revision":"1a34bceaa14b4cf3a9cf90aa9c4dae5eb003d9d7","parents":["37c3d9c0c52dc69f6c31123761894a1c85149f8c"],"ref":"refs/changes/37/3137/12","uploader":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"createdOn":1521235807,"author":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1521178250,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1521234348,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1521235169,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"SUBM","value":"1","grantedOn":1521235837,"by":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":13,"deletions":0},{"file":"usr/src/uts/common/inet/ip/ip6_input.c","type":"MODIFIED","insertions":4,"deletions":-5},{"file":"usr/src/uts/common/inet/ip/ip_input.c","type":"MODIFIED","insertions":4,"deletions":-5},{"file":"usr/src/uts/common/io/aggr/aggr_grp.c","type":"MODIFIED","insertions":272,"deletions":-37},{"file":"usr/src/uts/common/io/aggr/aggr_port.c","type":"MODIFIED","insertions":41,"deletions":-1},{"file":"usr/src/uts/common/io/dld/dld_proto.c","type":"MODIFIED","insertions":15,"deletions":-17},{"file":"usr/src/uts/common/io/dls/dls.c","type":"MODIFIED","insertions":8,"deletions":-8},{"file":"usr/src/uts/common/io/dls/dls_link.c","type":"MODIFIED","insertions":10,"deletions":-1},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_82598.c","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_82598.h","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_api.c","type":"MODIFIED","insertions":15,"deletions":-10},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_api.h","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_common.c","type":"MODIFIED","insertions":113,"deletions":-135},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_common.h","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_type.h","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_vf.c","type":"MODIFIED","insertions":15,"deletions":-14},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_vf.h","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","type":"MODIFIED","insertions":345,"deletions":-10},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_sw.h","type":"MODIFIED","insertions":19,"deletions":-1},{"file":"usr/src/uts/common/io/mac/mac.c","type":"MODIFIED","insertions":512,"deletions":-262},{"file":"usr/src/uts/common/io/mac/mac_client.c","type":"MODIFIED","insertions":83,"deletions":-40},{"file":"usr/src/uts/common/io/mac/mac_datapath_setup.c","type":"MODIFIED","insertions":157,"deletions":-89},{"file":"usr/src/uts/common/io/mac/mac_provider.c","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/io/mac/mac_sched.c","type":"MODIFIED","insertions":74,"deletions":-68},{"file":"usr/src/uts/common/io/mac/mac_soft_ring.c","type":"MODIFIED","insertions":18,"deletions":-22},{"file":"usr/src/uts/common/io/vnic/vnic_dev.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/common/mapfiles/ddi.mapfile","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/sys/aggr_impl.h","type":"MODIFIED","insertions":15,"deletions":-1},{"file":"usr/src/uts/common/sys/mac_client.h","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/sys/mac_client_impl.h","type":"MODIFIED","insertions":77,"deletions":-4},{"file":"usr/src/uts/common/sys/mac_client_priv.h","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"usr/src/uts/common/sys/mac_impl.h","type":"MODIFIED","insertions":26,"deletions":-11},{"file":"usr/src/uts/common/sys/mac_provider.h","type":"MODIFIED","insertions":30,"deletions":-2}],"sizeInsertions":1884,"sizeDeletions":-759},"patchSets":[{"number":"1","revision":"104def44c4eeabccace997a00b34c2f10f2b5ab3","parents":["97f2cda0aba36f25db5cda594bb8946108b944c7"],"ref":"refs/changes/37/3137/1","uploader":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"createdOn":1513987821,"author":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/uts/common/inet/ip/ip6_input.c","line":146,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"nit: append comma"},{"file":"usr/src/uts/common/inet/ip/ip6_input.c","line":146,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/inet/ip/ip6_input.c","line":147,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"nit: tense conflict"},{"file":"usr/src/uts/common/inet/ip/ip6_input.c","line":147,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/inet/ip/ip_input.c","line":149,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"nit: append comma"},{"file":"usr/src/uts/common/inet/ip/ip_input.c","line":149,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/dld/dld_proto.c","line":1413,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"comma before and after"},{"file":"usr/src/uts/common/io/dld/dld_proto.c","line":1413,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"double \u0027the\u0027"},{"file":"usr/src/uts/common/io/dld/dld_proto.c","line":1413,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/dld/dld_proto.c","line":1413,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/dls/dls_link.c","line":385,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"style nit: wording here is awkward"},{"file":"usr/src/uts/common/io/dls/dls_link.c","line":385,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_common.c","line":2889,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I also have found this to be rather annoying. Maybe debug builds shouldn\u0027t define IXGBE_DEBUG."},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_common.c","line":2889,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"I think that would probably be fine but I do worry that would cover up some messages that are actually useful. I can\u0027t be sure without looking at all of them. This would require the developer knowing that they have to manually enable ixgbe debug logging before building.\n\nIt looks like we could use fc.current_mode to log only when the mode has changed. I think that\u0027s a good compromise. What do you think?"},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_debug.h","line":42,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I\u0027d recommend we remove these three lines, but under a separate bug."},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_debug.h","line":42,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"See my reply to ixgbe_common.c:2889"},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":40,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I guess time to clean these up?"},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":1467,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Extra new line added?"},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":1467,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":2895,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"This is clearing several reserved bits."},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":2895,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":3010,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Same as at 2895. This clears several reserved bits."},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":3010,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":3196,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"style nit: This definition could be moved down into the if (bitset_in_set())... block below."},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":3196,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"This entire function was rewritten."},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":3198,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"style nit: This definition could be moved into the slot iteration below."},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":3198,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":3211,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"There should be a bitset_fini() in a tear-down routine somewhere to avoid leaking this memory."},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":3211,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":3225,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"style nit: a change here to a negated condition leading to a \u0027continue\u0027 would mean the logic below could be tabbed in one stop and make the comment a little more readable."},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":3225,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":3236,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Strictly speaking, I\u0027m not sure this is true. For example, a firmware change could have occurred which is why the hardware was reset. This could have an impact on the return values, etc. That said, I\u0027m not sure if we have a practical option of how to handle this or express that in the GLDv3 today.\n\nI think if we wanted to handle this more intelligently then we\u0027d need to be able to add a reset capability to the GLDv3 where it tries to restore some of these things for us rather than us having to remember it all and could react to those failures in some way.\n\nI guess that\u0027s a long way of saying I\u0027m not sure we have a better option at this moment."},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":3236,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"The point of my comment is that if it previously had room for this filter before the reset then it should have room after. Although, this assumption is violated if num_rx_groups were to change across resets, as I mention at the top of the function. My comment is here to explain why I always expect success, which I think is a reasonable assumption here. I also think it\u0027s reasonable that the firmware shouldn\u0027t change the return value for success across revisions. So I\u0027d like to keep this logic as is as well as the comment."},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":3238,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Please use VERIFY3S"},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":3238,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":6284,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Should we still have the notion of mgi_report? Alternatively if we want to have a full register dumping capability, seems like something we should add separately."},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":6284,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"This is something I definitely want as this information is very useful for debugging. I would like to replace this with something better under a new ticket. I had a couple of ideas that I\u0027d like to discuss outside of the review."},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":6401,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"nit: uint32_t"},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":6401,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":6402,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Please use our standards types, uint32_t and not the Intel types."},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":6402,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":6414,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Please use the VERIFY3* macros here."},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":6414,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":6416,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Is this level of paranoia warranted? (vs. doing the reg read in an ASSERT?)"},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":6416,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"If we\u0027re going to be verifying this register read, then we also need to go through and check with fm before doing too much more with it. We should probably be using ixgbe_check_acc_handle() at some point in this."},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":6416,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"I decided that this check is overkill."},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":6429,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Does this need to be recorded somewhere so that way we can restore this after a reset?"},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":6429,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Yes, this should have been recorded. I\u0027ve completely written this function and all relevant state should be saved in SW state now."},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":6432,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Is this referring to slot 0 in the driver? If so, why do we reserve and special case vid 0? Don\u0027t we usually have the AUPE case rather than the VID of zero? Is this trying to be analogous to the default group?"},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":6432,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Edit: I\u0027ve completely rewritten this function but left my original explanation.\n\nIt\u0027s referring to slot 0 in the hardware\u0027s VLVF/VLVFB tables. This special case comes from the Intel common code (see ixgbe_find_vlvf_slot()). I imagine this special case exists so that you can always have HW accelerated priroity tagging."},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":6435,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"nit: VLAN_ID_NONE"},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":6435,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":6448,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"If we have a value here that\u0027s not IXGBE_SUCCESS and not IXGBE_ERR_PARAM, it seems like we\u0027ll return an ixgbe style error value where as in others places we\u0027ve returned and errno. I thik you probably need to add a case to the if statement at +6444 and probably explicitly transform IXGBE_SUCCESS to zero (even though they are the same value at the moment)."},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":6448,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":6472,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Should this break out of the loop here with the slot selected?"},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":6472,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I don\u0027t think we should. I presume that the way things are structured we may have a free slot; however, there may be another one that\u0027s free later on."},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":6472,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Edit: I\u0027ve completely rewritten this function but left my original explanation as to why this is correct.\n\nWe don\u0027t want to break on the first empty slot because multiple groups might share a VID -- each slot represents a VID, and each slot has a bitmap to represent group membership. So if 3 groups belong to VID 199, then one slot will have vlft_vid \u003d 199 with the 3 groups\u0027s indexes turned on in vlft_groups. This structure mirrors what\u0027s in the ixgbe common code (see ixgbe_find_vlvf_slot())."},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":6499,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"nit: place"},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":6499,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":6501,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"nit: receive"},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":6501,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":6502,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"nit: classification"},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":6502,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":6510,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"A few comments:\n\n* I don\u0027t see VPE being defined for the 82599, only on the X540 and newer.\n\n* I think that like with unicast mac addresses, we should actually ask MAC to come back and deal with this when we return the error. When we have unicast addreses, MAC turns on promisc mode.\n\n* If we are going to do this, don\u0027t we need to record this fact in our software state structure?"},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":6510,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"I\u0027ve completely rewritten this function and no longer rely on VPE."},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":6512,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Are there conditions where vlan promisc mode is undone?  It might be nice to explain why (and where) or why not."},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":6512,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"I no longer rely on VPE"},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":6526,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"nit: uint32_t"},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":6526,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":6545,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"nit: perhaps use IXGBE_SUCCESS to stay consistent w/ rest of func"},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":6545,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Please don\u0027t. See my other coments."},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":6545,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Fixed all return values."},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":6549,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"nit: Between here and ixgbe_addvlan(), the array addressing for VLAN_ID_NONE should be consistent (whether using \u00270\u0027 or the define, up to you)"},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":6549,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I probably wouldn\u0027t use that define for the array indexing. Because this filter array isn\u0027t really based on the VLAN space. It\u0027s just based on being index zero being the same."},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":6549,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"I agree with both of you. I got a bit trigger happy when I discovered VLAN_ID_NONE. This function has been completely rewritten and this code no longer exists."},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":6552,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I think we should probably standardize on using ENOENT to represent a request to remove a vlan from a group that isn\u0027t present."},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":6552,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":6563,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Mixing error numbers and IXGBE return values. Probably should be an explicit return 0?"},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":6563,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":6574,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"See earlier note on standardizing on ENOENT if it doesn\u0027t exist."},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":6574,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":6580,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Mixing ixgbe values and errors."},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":6580,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":6708,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"See other notes on reports."},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":6708,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_sw.h","line":393,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"No, please leave it. I\u0027d rather we use prefixes going forward in ixgbe where we can."},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_sw.h","line":393,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_sw.h","line":395,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"I see no reason to?"},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_sw.h","line":395,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_sw.h","line":403,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Or maybe change it to a boolean_t if you\u0027re keeping it around?"},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_sw.h","line":403,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Turns out I found a better way to represent this state."},{"file":"usr/src/uts/common/io/mac/mac.c","line":1118,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"nit: \u0027which\u0027"},{"file":"usr/src/uts/common/io/mac/mac.c","line":1118,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/mac/mac.c","line":1154,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"For all these changes to VERIFY, maybe use the VERIFY3* family."},{"file":"usr/src/uts/common/io/mac/mac.c","line":1154,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/mac/mac.c","line":4098,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"If we\u0027re removing the extra parens around mgi_addmac, should we do that on mgi_remmac?"},{"file":"usr/src/uts/common/io/mac/mac.c","line":4098,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Whoops. I had messed with this code and then only partially reverted\nit. But I think the parens are overkill so I\u0027ll remove them."},{"file":"usr/src/uts/common/io/mac/mac.c","line":4341,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Should there be any VERIFY-cation of \u0027vlan\u0027 bounds for this and *_remvlan below?"},{"file":"usr/src/uts/common/io/mac/mac.c","line":4341,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Ya know, I figured it was enough for ixgbe (and other drivers) to return errors for invalid arguments. But now that you mention it I think it does make sense to verify the range. Any VID value from the user should be validated well before we reach this function."},{"file":"usr/src/uts/common/io/mac/mac.c","line":4343,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"This and remvlan are implementation functions, right? Hence the VERIFY. Let\u0027s move these to the 3P versions I guess."},{"file":"usr/src/uts/common/io/mac/mac.c","line":4343,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/mac/mac.c","line":4570,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"style nit: newline between variable definition and code body"},{"file":"usr/src/uts/common/io/mac/mac.c","line":4570,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/mac/mac.c","line":4984,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"style nit: I would prefer to see braces on at least the for loop."},{"file":"usr/src/uts/common/io/mac/mac.c","line":4984,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Yes, please do this for multi-line statements."},{"file":"usr/src/uts/common/io/mac/mac.c","line":4984,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/mac/mac.c","line":4984,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/mac/mac.c","line":5002,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Can you confirm that this is only ever called from user context and therefore we won\u0027t possibly have a kernel thread forever in here?"},{"file":"usr/src/uts/common/io/mac/mac.c","line":5002,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"I can check this, but before I spend the time doing so I\u0027d like to\npoint out that this is how mac_add_macaddr() has always worked (which\nis called in the same contextes)."},{"file":"usr/src/uts/common/io/mac/mac.c","line":5037,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"flags appears to only be used for a single bit. As the old use_hw boolean_t. Why not transform it back to a boolean_t and simplify the surrounding callers, etc. Especially as the defined flags are a bit scattered."},{"file":"usr/src/uts/common/io/mac/mac.c","line":5037,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Right, left over churn from a previous iteration. I\u0027ll clean it up."},{"file":"usr/src/uts/common/io/mac/mac.c","line":5043,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"style nit: this could be defined down below in the block where it is used."},{"file":"usr/src/uts/common/io/mac/mac.c","line":5043,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/mac/mac.c","line":5046,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"style nit: maybe initialize these to B_FALSE for paranoia?"},{"file":"usr/src/uts/common/io/mac/mac.c","line":5046,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I might do that."},{"file":"usr/src/uts/common/io/mac/mac.c","line":5046,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/mac/mac.c","line":5046,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/mac/mac.c","line":5109,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Please use the VERIFY3* bits here."},{"file":"usr/src/uts/common/io/mac/mac.c","line":5109,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/mac/mac.c","line":5116,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"style nit: I get antsy about pre/post-increment/decrement results being used directly in tests.  Thoughts about splitting this into an explicit increment followed by a \u0027\u003e 1\u0027 test?"},{"file":"usr/src/uts/common/io/mac/mac.c","line":5116,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/mac/mac.c","line":5128,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"What is this comment trying to tell us?"},{"file":"usr/src/uts/common/io/mac/mac.c","line":5128,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"A personal note I forgot to clean up."},{"file":"usr/src/uts/common/io/mac/mac.c","line":5131,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Why should ECANCELED be the only reason we bail? Shouldn\u0027t we instead really only go through if we get a return value that indicates that we ran out of filters? I realize that this is a bit of a varied thing in all of the drivers today, but if for example, something returns EIO because it had an fm error, I\u0027m not sure that means we should be going through and doing promisc mode."},{"file":"usr/src/uts/common/io/mac/mac.c","line":5131,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"You\u0027re right. I meant to make this ENOSPC but probably munged things\nup during a refactor. Nice catch."},{"file":"usr/src/uts/common/io/mac/mac.c","line":5141,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"nit: awkward, maybe \u0027available HW filters were successfully programmed\u0027? s/we/were/ at the very least"},{"file":"usr/src/uts/common/io/mac/mac.c","line":5141,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"I simplified the code and this comment no longer exists."},{"file":"usr/src/uts/common/io/mac/mac.c","line":5177,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I find this comment change confusing. The use of factory MAC  makes me feel like this is trying to reference the MAC_CAPAB_MULTIFACTADDR. Which I\u0027m not sure whether or not this is actually trying to apply to."},{"file":"usr/src/uts/common/io/mac/mac.c","line":5177,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"I think I changed it to \"factory\" because the primary comes from the\nNIC by default. But I realize this could be confusing given multi\nfactory addresses as well as the fact that I think you can actually\nchange the address via ixgbe.conf. I\u0027m just going to go back to the\noriginal \"primary address\" wording to avoid confusion."},{"file":"usr/src/uts/common/io/mac/mac.c","line":5240,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"What does this refer to?"},{"file":"usr/src/uts/common/io/mac/mac.c","line":5240,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"I honestly can\u0027t remember my exact train of though here. One of the simplifications I made was to revert back to a two-state ma_type. I achieved this by forcing all shared mac_address_t\u0027s to reside on the default group. This means only the default group is shared and all reserved groups have full HW classification available. This removes the need for the three-state ma_type and a bunch of complicated logic around VLVF slots and group HW vs. SW classification. Basically, every reserved group is guaranteed an available VLVF slot, just like we\u0027ve always guaranteed an MPSAR slot. And if the driver doesn\u0027t support VLAN filtering then we still give the client a reserved group but put it into SW classify; just like we\u0027ve always done.\n\nThough, now that I think about it, on drivers without HW VLAN filtering we could put all VLAN clients on default group and thus save the reserved groups for non-VLAN clients which can actually make full use of HW classify."},{"file":"usr/src/uts/common/io/mac/mac.c","line":5270,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"It feels like in the future here we should instead try to reset the device or offline it rather than panic the system, allowing something like another part of an aggregate to potentially take over."},{"file":"usr/src/uts/common/io/mac/mac.c","line":5270,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Yea, I\u0027m not particularly happy with this code."},{"file":"usr/src/uts/common/io/mac/mac.c","line":5289,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"cstyle: missing space between if and ("},{"file":"usr/src/uts/common/io/mac/mac.c","line":5289,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/mac/mac.c","line":5303,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Can you further expand on why you\u0027re performing this check? It doesn\u0027t feel symmetric with the add case. If we\u0027re enabling this every time we have a non-hw filter address, but we\u0027re not removing it based on some of the other conditions that doesn\u0027t quite make sense. Is there some other place where the other addresses are being appended to this list and we\u0027re not calling i_mac_promisc_set()? Note, i_mac_promisc_set() is doing its own reference counting."},{"file":"usr/src/uts/common/io/mac/mac.c","line":5303,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Ugh, sorry. This was a goof up on my part."},{"file":"usr/src/uts/common/io/mac/mac.c","line":5307,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"An explicit panic may be clearer. Though really this shouldn\u0027t be necessary if we\u0027re building with -Wswitch."},{"file":"usr/src/uts/common/io/mac/mac.c","line":5307,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"I looked at reenabling -Wswitch on MAC and there were a bunch of errors. I\u0027d like to fix these under a different CR/commit to keep it from complicating this one. For now I used an explicit panic."},{"file":"usr/src/uts/common/io/mac/mac.c","line":6899,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"What is a VLAN VNIC? Is that a vnic that used the -v option?"},{"file":"usr/src/uts/common/io/mac/mac.c","line":6899,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Yes. And this term existed before my work (see mac_client.c and vnic_dev.c).\n\nEDIT: Actually, both types of VLANs are VNICs and are referred to as VLAN VNICs in the code. Perhaps having two separate bullet points is overkill."},{"file":"usr/src/uts/common/io/mac/mac.c","line":7007,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"\u0027\u0026\u003d\u0027 makes no sense with flags initialized to 0 in its definition"},{"file":"usr/src/uts/common/io/mac/mac.c","line":7007,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Wow, that was an oversight. But this change was reverted so it\u0027s no longer a problem."},{"file":"usr/src/uts/common/io/mac/mac.c","line":7012,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"nit: append comma"},{"file":"usr/src/uts/common/io/mac/mac.c","line":7012,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"nit: the"},{"file":"usr/src/uts/common/io/mac/mac.c","line":7012,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/mac/mac.c","line":7012,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/mac/mac.c","line":7047,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"If this has been freed by mac_remove_macaddr_vlan(), then why would we have dangling pointers in the list? What removes these entries and allocated memory in the list?"},{"file":"usr/src/uts/common/io/mac/mac.c","line":7047,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"The mui_map reference isn\u0027t touched in mac_remove_macaddr_vlan(), it\u0027s dealt with by i_mac_unicast_add()/mac_unicast_remove()\n\nThis is a bug that\u0027s existed in MAC for a while. I think because previously we only had the \"create-vlan\" method of creating VLANs. With that method we know the mac_address_t is the primary\u0027s and it won\u0027t be freed.\n\nBut then we added the \"create-vnic -v\" method and this function was never updated. It hasn\u0027t bitten us before because a) I\u0027m guessing few people use the same addr across VLANs and b) since we are creating a new mac_address_t right after freeing it kmem gives us back the same object. I proved the dangling pointer with dtrace and updated this code to make sure it never bites us.\n\n\nThat said, the whole mac_unicast_impl_t list feels redundant. It is yet another sun4v vsw-ism (vsw is the only MAC client which multiplexes multiple VLANs on one client instead of creating a new client for each VLAN). I\u0027d love to see it yanked.\n\nI suppose I could also modify mac_remove_macaddr_vlan() to walk the group\u0027s client list and NULL this reference."},{"file":"usr/src/uts/common/io/mac/mac.c","line":7060,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"So, in other cases you\u0027ve opted to panic the system when this happens where as here we end up just erroring and driving on. Should we be consistent about behaviors, call into a single place where we can alert, etc.?"},{"file":"usr/src/uts/common/io/mac/mac.c","line":7060,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"You\u0027re right. I\u0027ve opted to panic like the other cases."},{"file":"usr/src/uts/common/io/mac/mac.c","line":7111,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"nit: append comma"},{"file":"usr/src/uts/common/io/mac/mac.c","line":7111,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/mac/mac.c","line":7119,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"nit: append comma"},{"file":"usr/src/uts/common/io/mac/mac.c","line":7119,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/mac/mac.c","line":7122,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"nit: append comma"},{"file":"usr/src/uts/common/io/mac/mac.c","line":7122,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/mac/mac.c","line":7125,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"nit: append comma"},{"file":"usr/src/uts/common/io/mac/mac.c","line":7125,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/mac/mac.c","line":7186,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"nit: append comma"},{"file":"usr/src/uts/common/io/mac/mac.c","line":7186,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/mac/mac.c","line":7310,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Previously we tried to make sure we got the primary client (or the only one), now we\u0027re just getting the head of the list. Is it true that all clients will have the same settings with respect to shares and the resource properties?"},{"file":"usr/src/uts/common/io/mac/mac.c","line":7310,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"So, a few things.\n\nFirst, this is a bit of a weird area in MAC. This type of code assumes that if a non-default group is SHARED then it must be the group with the primary MAC client on it and the other clients must be VLAN VNICs (aka VLANs created with create-vlan). This probably made sense in the days before create-vnic -v, but it doesn\u0027t hold water today. Currently you could create two or more VLAN VNICs (via create-vnic -v) sharing the same MAC addr and that would create a non-default SHARED group that doesn\u0027t include the primary. In general, the MAC code around rings doesn\u0027t account for that fact.\n\nSecond, this code is only ever called when the group is RESERVED. That means there should only ever be one client, otherwise we have a bug. I think there was a time when a RESERVED group could have multiple clients, as I\u0027ve seen other comments/code allude to this fact, but those days are long gone.\n\nThird, I\u0027m not sure I even meant to modify this function. I\u0027m pretty sure I only needed to change to Rx reserve group to make sure I could steal a non-default, non-primary, shared group. Perhaps I wasn\u0027t paying attention and just replaced all occurrences of this logic in mac.c."},{"file":"usr/src/uts/common/io/mac/mac.c","line":7352,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Same question as at +7310."},{"file":"usr/src/uts/common/io/mac/mac.c","line":7352,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Answered above."},{"file":"usr/src/uts/common/io/mac/mac.c","line":7918,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Same question as at +7310."},{"file":"usr/src/uts/common/io/mac/mac.c","line":7918,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"So this is slightly different from the Tx reserve group logic above since we could be checking a reserved or shared group. If it\u0027s a primary client group with VLANs when we know all clients have the same properties as they are explicitly copied whenever the primary client is updated. However, no such logic exists for a group shared among multiple VLAN VNICs using the non-primary MAC. In that case you could set one clients rxrings prop and it is not propagated to the other\u0027s (and whether or not that is a bug could be argued both ways). So what I should really do here to be safe is iterate all clients on the group and make sure none of them require HW resources. At that point, if no client requires HW, then I can just use the first client to move them all as the group switching code has logic to move all clients sharing a mac_address_t.\n\nThat said, I\u0027ve introduced new logic that guarantees the only shared group is the default group. Which would make this logic unnecessary as we could just check for a reserved group with a client that didn\u0027t ask for HW resources. But, for now, I\u0027m going to assume that we could see non-default, shared groups."},{"file":"usr/src/uts/common/io/mac/mac.c","line":7937,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Same question as at +7310."},{"file":"usr/src/uts/common/io/mac/mac.c","line":7937,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Same as above."},{"file":"usr/src/uts/common/io/mac/mac_client.c","line":868,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"nit: append comma"},{"file":"usr/src/uts/common/io/mac/mac_client.c","line":868,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/mac/mac_client.c","line":872,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"nit: comma instead of full stop"},{"file":"usr/src/uts/common/io/mac/mac_client.c","line":872,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/mac/mac_client.c","line":2346,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"What guarantees this aspect of the vid?"},{"file":"usr/src/uts/common/io/mac/mac_client.c","line":2346,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"The comment below explains why this must be a VLAN creation. I moved the VERIFY below the comment. I hope that\u0027s more clear."},{"file":"usr/src/uts/common/io/mac/mac_client.c","line":2348,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"nit: s/,/ so/ ?"},{"file":"usr/src/uts/common/io/mac/mac_client.c","line":2348,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/mac/mac_datapath_setup.c","line":27,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"This appears to be leftover."},{"file":"usr/src/uts/common/io/mac/mac_datapath_setup.c","line":27,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/mac/mac_datapath_setup.c","line":2389,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"nit: append comma"},{"file":"usr/src/uts/common/io/mac/mac_datapath_setup.c","line":2389,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/mac/mac_datapath_setup.c","line":2390,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"nit: append comma"},{"file":"usr/src/uts/common/io/mac/mac_datapath_setup.c","line":2390,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/mac/mac_datapath_setup.c","line":2391,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"nit: append comma"},{"file":"usr/src/uts/common/io/mac/mac_datapath_setup.c","line":2391,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/mac/mac_datapath_setup.c","line":2407,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"style nit; Make this a \u0027!\u003d 0\u0027 comparison for more strict boolean_t-ness?"},{"file":"usr/src/uts/common/io/mac/mac_datapath_setup.c","line":2407,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Yes, please do this so the value is actually one of B_TRUE and B_FALSE, the valid enum values."},{"file":"usr/src/uts/common/io/mac/mac_datapath_setup.c","line":2407,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/mac/mac_datapath_setup.c","line":2407,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/mac/mac_datapath_setup.c","line":2481,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"nit: append comma"},{"file":"usr/src/uts/common/io/mac/mac_datapath_setup.c","line":2481,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/mac/mac_datapath_setup.c","line":2539,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"nit: append comma"},{"file":"usr/src/uts/common/io/mac/mac_datapath_setup.c","line":2539,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/mac/mac_datapath_setup.c","line":2561,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"nit: classification"},{"file":"usr/src/uts/common/io/mac/mac_datapath_setup.c","line":2561,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"nit: s/1/one/"},{"file":"usr/src/uts/common/io/mac/mac_datapath_setup.c","line":2561,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/mac/mac_datapath_setup.c","line":2561,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/mac/mac_datapath_setup.c","line":2873,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I assume we\u0027ll clean this bit up?"},{"file":"usr/src/uts/common/io/mac/mac_datapath_setup.c","line":2873,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Yes, this version was always a throwaway. I would like to have a permanent way to print ixgbe HW state but I\u0027m not sure on the impl details. That\u0027s something I want to discuss with you and do under a different commit."},{"file":"usr/src/uts/common/io/mac/mac_datapath_setup.c","line":3026,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"nit: grouping"},{"file":"usr/src/uts/common/io/mac/mac_datapath_setup.c","line":3026,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"nit: append comma"},{"file":"usr/src/uts/common/io/mac/mac_datapath_setup.c","line":3026,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/mac/mac_datapath_setup.c","line":3026,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"I reworded this entire block comment to be more concise."},{"file":"usr/src/uts/common/io/mac/mac_datapath_setup.c","line":3028,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"nit: append comma"},{"file":"usr/src/uts/common/io/mac/mac_datapath_setup.c","line":3028,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/mac/mac_datapath_setup.c","line":3033,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"nit: append comma"},{"file":"usr/src/uts/common/io/mac/mac_datapath_setup.c","line":3033,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/mac/mac_datapath_setup.c","line":3034,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"nit: append comma"},{"file":"usr/src/uts/common/io/mac/mac_datapath_setup.c","line":3034,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/mac/mac_datapath_setup.c","line":3038,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"nit: append comma"},{"file":"usr/src/uts/common/io/mac/mac_datapath_setup.c","line":3038,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/mac/mac_datapath_setup.c","line":3147,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Doing \u0026\u003d of a single flag is equivalent to just setting it equal to the result of the ternary expression. Why not just use \u003d?"},{"file":"usr/src/uts/common/io/mac/mac_datapath_setup.c","line":3147,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Reverted to use_hw as mentioned in previous comment."},{"file":"usr/src/uts/common/io/mac/mac_datapath_setup.c","line":3158,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Missing word?"},{"file":"usr/src/uts/common/io/mac/mac_datapath_setup.c","line":3158,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/mac/mac_datapath_setup.c","line":3232,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"This sounds like something that we need to fix before putting back."},{"file":"usr/src/uts/common/io/mac/mac_datapath_setup.c","line":3232,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Yep, I changed MAC to place all clients sharing a mac_address_t on the default group."},{"file":"usr/src/uts/common/io/mac/mac_flow.c","line":57,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"nit: Needs another newline or to be returned to a single line"},{"file":"usr/src/uts/common/io/mac/mac_flow.c","line":57,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/mac/mac_flow.c","line":58,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"This change looks odd. If we\u0027re going to make it a multi-line comment, it should be done in the cstyle way so:\n\n/*\n * text...\n * text...\n */"},{"file":"usr/src/uts/common/io/mac/mac_flow.c","line":58,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Yea, I\u0027m guessing I hit enter by accident here.\n\nI decided to revert all my changes here because they have nothing to do with my work on this commit. If we really want VLAN_ID_NONE everywhere that can be done under a different ticket/commit."},{"file":"usr/src/uts/common/io/mac/mac_sched.c","line":1525,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"nit: should that be hyphenated?"},{"file":"usr/src/uts/common/io/mac/mac_sched.c","line":1525,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/mac/mac_sched.c","line":1540,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"nit: \u0027soft rings\u0027"},{"file":"usr/src/uts/common/io/mac/mac_sched.c","line":1540,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/mac/mac_sched.c","line":1541,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"nit: soft rings"},{"file":"usr/src/uts/common/io/mac/mac_sched.c","line":1541,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/mac/mac_sched.c","line":1542,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"soft ring"},{"file":"usr/src/uts/common/io/mac/mac_sched.c","line":1542,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/mac/mac_sched.c","line":1657,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"nit: append comma"},{"file":"usr/src/uts/common/io/mac/mac_sched.c","line":1657,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/mac/mac_soft_ring.c","line":342,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"nit: \u0027soft ring\u0027"},{"file":"usr/src/uts/common/io/mac/mac_soft_ring.c","line":342,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/mac/mac_soft_ring.c","line":345,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"style nit: These might be a little clearer as a short bulleted list rather than prose?"},{"file":"usr/src/uts/common/io/mac/mac_soft_ring.c","line":345,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"I like that idea."},{"file":"usr/src/uts/common/io/mac/mac_soft_ring.c","line":391,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"nit: append comma"},{"file":"usr/src/uts/common/io/mac/mac_soft_ring.c","line":391,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/mac/mac_soft_ring.c","line":393,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"style nit: s/count/measure/ maybe?"},{"file":"usr/src/uts/common/io/mac/mac_soft_ring.c","line":393,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/mac/mac_soft_ring.c","line":600,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Can you comment on this change?"},{"file":"usr/src/uts/common/io/mac/mac_soft_ring.c","line":600,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"I\u0027m confused. Shall I add a comment to the code or do you want to know why I changed this to verify? To answer the later, I figured better verify here then crash on a NULL pointer dereference later."},{"file":"usr/src/uts/common/sys/mac_client_impl.h","line":143,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"nit: perhaps rephrase without first person"},{"file":"usr/src/uts/common/sys/mac_client_impl.h","line":143,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/sys/mac_client_impl.h","line":361,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Yes, that seems to be correct."},{"file":"usr/src/uts/common/sys/mac_client_impl.h","line":361,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/sys/mac_impl.h","line":273,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Needs a comment describing what it\u0027s for and where it\u0027s used."},{"file":"usr/src/uts/common/sys/mac_impl.h","line":273,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Removed this macro."},{"file":"usr/src/uts/common/sys/mac_provider.h","line":287,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I would find it really useful to have a discussion somewhere of at what point we\u0027re doing this translation. Is it only when we go out to device drivers or is it at some other point?"},{"file":"usr/src/uts/common/sys/mac_provider.h","line":287,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"I did two things.\n\n1. I\u0027m no longer storing the sentinel value in MAC. It felt weird to use a mac_vlan_t with a special vid value to represent untagged traffic. I replaced it with a flag on the mac_address_t (ma_untagged).\n\n2. I pushed the conversion from VLAN_ID_NONE to the sentinel value to just before calling into the provider (mac_group_{add,rem}vlan()).\n\nI also expanded on the comment."},{"file":"usr/src/uts/common/sys/mac_provider.h","line":290,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Nice solution"},{"file":"usr/src/uts/common/sys/mac_provider.h","line":290,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"It was rm\u0027s idea."},{"file":"usr/src/uts/common/sys/mac_provider.h","line":431,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Can you discuss how much refactoring the code is going to need if we add the perfect match mac/vlan filters?"},{"file":"usr/src/uts/common/sys/mac_provider.h","line":431,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"I believe most of changes to support the tuple API will be in mac_add_macaddr_vlan().\n\nI also think I could probably emulate the tuple API on ixgbe as well. That might simplify the mac_add_macaddr_vlan() logic a bit. But I didn\u0027t pursue that idea here."},{"file":"usr/src/uts/common/sys/mac_provider.h","line":448,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"See other report clean up bits."},{"file":"usr/src/uts/common/sys/mac_provider.h","line":448,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/intel/ixgbe/Makefile","line":71,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Please update the sparc Makefile."},{"file":"usr/src/uts/intel/ixgbe/Makefile","line":71,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"My new code doesn\u0027t need the bitset API."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/inet/ip/ip6_input.c","type":"MODIFIED","insertions":2,"deletions":-5},{"file":"usr/src/uts/common/inet/ip/ip_input.c","type":"MODIFIED","insertions":2,"deletions":-5},{"file":"usr/src/uts/common/io/dld/dld_proto.c","type":"MODIFIED","insertions":14,"deletions":-16},{"file":"usr/src/uts/common/io/dls/dls.c","type":"MODIFIED","insertions":8,"deletions":-8},{"file":"usr/src/uts/common/io/dls/dls_link.c","type":"MODIFIED","insertions":9,"deletions":0},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_common.c","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_type.h","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_debug.c","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_debug.h","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","type":"MODIFIED","insertions":429,"deletions":-3},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_sw.h","type":"MODIFIED","insertions":27,"deletions":0},{"file":"usr/src/uts/common/io/mac/mac.c","type":"MODIFIED","insertions":526,"deletions":-217},{"file":"usr/src/uts/common/io/mac/mac_client.c","type":"MODIFIED","insertions":79,"deletions":-50},{"file":"usr/src/uts/common/io/mac/mac_datapath_setup.c","type":"MODIFIED","insertions":280,"deletions":-102},{"file":"usr/src/uts/common/io/mac/mac_flow.c","type":"MODIFIED","insertions":7,"deletions":-4},{"file":"usr/src/uts/common/io/mac/mac_provider.c","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/io/mac/mac_sched.c","type":"MODIFIED","insertions":75,"deletions":-68},{"file":"usr/src/uts/common/io/mac/mac_soft_ring.c","type":"MODIFIED","insertions":15,"deletions":-22},{"file":"usr/src/uts/common/io/vnic/vnic_dev.c","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/common/mapfiles/kernel.mapfile","type":"MODIFIED","insertions":11,"deletions":-1},{"file":"usr/src/uts/common/sys/mac_client_impl.h","type":"MODIFIED","insertions":77,"deletions":-4},{"file":"usr/src/uts/common/sys/mac_impl.h","type":"MODIFIED","insertions":24,"deletions":-11},{"file":"usr/src/uts/common/sys/mac_provider.h","type":"MODIFIED","insertions":69,"deletions":-1},{"file":"usr/src/uts/intel/ixgbe/Makefile","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":1672,"sizeDeletions":-525},{"number":"2","revision":"6bc942718a68b87a74bb03d9159e4ebcd08ac93a","parents":["97f2cda0aba36f25db5cda594bb8946108b944c7"],"ref":"refs/changes/37/3137/2","uploader":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"createdOn":1516551606,"author":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/uts/common/io/dls/dls_link.c","line":386,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"This sentence and its commas seems weird."},{"file":"usr/src/uts/common/io/dls/dls_link.c","line":386,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_common.c","line":3849,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Is this (and for that matter, the other changes in the file) from an upstream update to the common code, or is it something bespoke for the VLAN/MAC changes?"},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_common.c","line":3849,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"This is copied from an Intel drop made to FreeBSD.\n\nhttps://reviews.freebsd.org/D11232"},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":3199,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Seems odd to keep this right after a simple if-statement check against it.  (Unless we fear some racing thread)"},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":3199,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":6261,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Are there notable exclusions in the list of parts which support VLAN filtering?  (Is there any reason to make this a blacklist rather than a whitelist?)"},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":6261,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"I just followed the method we use in ixgbe_setup_vmdq_rss(). I wanted to use vlft_enabled but the fill group code happens at MAC registration and the vmdq/rss setup code happens afterwards during MAC start."},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":6431,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"nit: guaranteed"},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":6431,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":6439,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"nit: Make this a call to panic() with a more detailed explanation as its message?"},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":6439,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":6499,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"bailing without dropping ixgbe-\u003egen_lock?"},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":6499,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Sigh, good catch."},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":6517,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"nit: Since IXGBE_ERR_PARAM is the only expected error here, perhaps turn the check into a VERIFY3* and return EINVAL directly?"},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":6517,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/mac/mac.c","line":6492,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"nit: s/grp/a group/"},{"file":"usr/src/uts/common/io/mac/mac.c","line":6492,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/mac/mac.c","line":6919,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"If this condition is necessary, why then is it not an ANDed part of the if-statement above?"},{"file":"usr/src/uts/common/io/mac/mac.c","line":6919,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Because there are two cases here.\n\n1. We are moving clients off a non-default group. In that case all cilents must share the same unicast address.\n\n2. We are moving clients off the default group. Clients with different unicast addresses may coexist on the default group. In that case we only want to move clients with the same addr as maddr.\n\nIn either case, let\u0027s verify that we are indeed only ever moving clients that share the specified maddr. Yes, this is redundant to the if expression; but I thought it made sense to add just in case I got the if expression wrong or someone touches it in the future. I wanted to be extra sure we only move the clients that should be moved.\n\nThat said, this function isn\u0027t needed anymore. mac_datapath_setup() ensures that clients sharing an addr end up on the default group. I modified mac_rx_move_macaddr() to return EINVAL for any addr that is shared and I updated all other calls sites of mac_rx_switch_group() to avoid moving address-sharing clients to non-default groups."},{"file":"usr/src/uts/common/io/mac/mac.c","line":6977,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"nit: Why initialize this when it\u0027s unconditionally assigned several lines later?"},{"file":"usr/src/uts/common/io/mac/mac.c","line":6977,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/mac/mac_client.c","line":1615,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"nit: If you\u0027re doing s/rx/Rx/ in the other code \u0026 comments you\u0027re updating, maybe hit this one too?"},{"file":"usr/src/uts/common/io/mac/mac_client.c","line":1615,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/mac/mac_datapath_setup.c","line":2387,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"nit: s/RX/Rx/ for consistency?"},{"file":"usr/src/uts/common/io/mac/mac_datapath_setup.c","line":2387,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/mac/mac_datapath_setup.c","line":2431,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"style thought: Considering the \u0027group-\u003emrg_info.mgi_addvlan !\u003d NULL\u0027 check is done in several places, what do you think about some sort of macro to act on the \u0027mac_group_t *\u0027 to interrogate support for hardware vlan classification?  It would probably make all those sites clearer without the need to cache into a boolean."},{"file":"usr/src/uts/common/io/mac/mac_datapath_setup.c","line":2431,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/mac/mac_datapath_setup.c","line":2534,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"nit: s/SRSs/SRSes/ to match the comment in the preceding function"},{"file":"usr/src/uts/common/io/mac/mac_datapath_setup.c","line":2534,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/mac/mac_datapath_setup.c","line":2556,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"nit: SRSes"},{"file":"usr/src/uts/common/io/mac/mac_datapath_setup.c","line":2556,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/mac/mac_datapath_setup.c","line":2559,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Style nit: Since you\u0027re sticking to verifies here, maybe just make it an if-statement against hwonly and use VERIFY3* against the srs_cnt?  Your call"},{"file":"usr/src/uts/common/io/mac/mac_datapath_setup.c","line":2559,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/inet/ip/ip6_input.c","type":"MODIFIED","insertions":4,"deletions":-5},{"file":"usr/src/uts/common/inet/ip/ip_input.c","type":"MODIFIED","insertions":4,"deletions":-5},{"file":"usr/src/uts/common/io/dld/dld_proto.c","type":"MODIFIED","insertions":15,"deletions":-16},{"file":"usr/src/uts/common/io/dls/dls.c","type":"MODIFIED","insertions":8,"deletions":-8},{"file":"usr/src/uts/common/io/dls/dls_link.c","type":"MODIFIED","insertions":10,"deletions":-1},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_82598.c","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_82598.h","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_api.c","type":"MODIFIED","insertions":15,"deletions":-10},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_api.h","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_common.c","type":"MODIFIED","insertions":113,"deletions":-135},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_common.h","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_type.h","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_vf.c","type":"MODIFIED","insertions":15,"deletions":-14},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_vf.h","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","type":"MODIFIED","insertions":255,"deletions":-4},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_sw.h","type":"MODIFIED","insertions":15,"deletions":-1},{"file":"usr/src/uts/common/io/mac/mac.c","type":"MODIFIED","insertions":518,"deletions":-237},{"file":"usr/src/uts/common/io/mac/mac_client.c","type":"MODIFIED","insertions":80,"deletions":-51},{"file":"usr/src/uts/common/io/mac/mac_datapath_setup.c","type":"MODIFIED","insertions":159,"deletions":-92},{"file":"usr/src/uts/common/io/mac/mac_provider.c","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/io/mac/mac_sched.c","type":"MODIFIED","insertions":73,"deletions":-67},{"file":"usr/src/uts/common/io/mac/mac_soft_ring.c","type":"MODIFIED","insertions":18,"deletions":-22},{"file":"usr/src/uts/common/io/vnic/vnic_dev.c","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/common/sys/mac_client.h","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/common/sys/mac_client_impl.h","type":"MODIFIED","insertions":77,"deletions":-4},{"file":"usr/src/uts/common/sys/mac_impl.h","type":"MODIFIED","insertions":22,"deletions":-12},{"file":"usr/src/uts/common/sys/mac_provider.h","type":"MODIFIED","insertions":30,"deletions":-2}],"sizeInsertions":1453,"sizeDeletions":-698},{"number":"3","revision":"767950e09a7f21e83e526db053741f86ba04b9ca","parents":["97f2cda0aba36f25db5cda594bb8946108b944c7"],"ref":"refs/changes/37/3137/3","uploader":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"createdOn":1518666453,"author":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/uts/common/io/aggr/aggr_grp.c","line":1088,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Does this EINVAL return percolate its way up the stack enough to tell something like dladm(1M) that you can\u0027t mix ports with-and-without VLAN filtering?  If not, that needs fixing.\n\nAlternatively (and you know how much more of a pain this is vs. error propagation), if you get a mix, can you dumb-down the aggr to be no-HW-VLAN but still allow its creation?"},{"file":"usr/src/uts/common/io/aggr/aggr_grp.c","line":1088,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"I\u0027m removing this HW/non-HW restriction. You can now freely mix ports."},{"file":"usr/src/uts/common/io/aggr/aggr_grp.c","line":1365,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"So up in add_ports, maybe the alternative sucks, but here it may be useful.  (And none of this adjust-when-you-remove-the-lone-non-HW-VLAN... once you lose the feature YOU LOSE THE FEATURE.)\n\nOf course proper error propagation up to the library or utilities would eliminate the need for any alternative.\n\nSo please make sure EINVAL in this case reports properly that mixing HW-VLAN support on an aggr will fail."},{"file":"usr/src/uts/common/io/aggr/aggr_grp.c","line":1365,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I\u0027d say that a lot of this is kind of unfortunate. I realize that we don\u0027t really have a good option here at the moment. But there are almost certainly folks using link aggregations with say a 1/10 GbE device (with the 1 GbE being thought of as a fallback). Do we really have no other choice but to forbid all such things? Especially given that ixgbe is common and folks even used to do an aggr with ixgbe and a second, different card."},{"file":"usr/src/uts/common/io/aggr/aggr_grp.c","line":1365,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"It turns out that supporting mixed HW/non-HW VLAN ports isn\u0027t too bad; so I modified the code to do so.\n\nHowever, are you sure about people mixing 1/10 GbE? According to 802.3ad the LAG assumes same data rate. dladm allows me to create a mixed-rate LAG, but I\u0027m not so sure it should."},{"file":"usr/src/uts/common/io/aggr/aggr_grp.c","line":1365,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"This code no longer exists."},{"file":"usr/src/uts/common/io/aggr/aggr_grp.c","line":2498,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Either mention in the intro block comment, or drop this ASSERT() in:\n\n/* Perimeter must be held when entering this function. */\nASSERT(MAC_PERIM_HELD(rx_group-\u003earg_grp-\u003elg_mh));"},{"file":"usr/src/uts/common/io/aggr/aggr_grp.c","line":2498,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/aggr/aggr_grp.c","line":2563,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I get why we have this philosophy and I\u0027m not sure I have a better answer in the moment or can say we shouldn\u0027t change something; however, the kernel should always try to stay up in the face of byzantine hardware.\n\nFor example, say an FM error occurred while writing to a device, so we have to reset it."},{"file":"usr/src/uts/common/io/aggr/aggr_grp.c","line":2563,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"What modification would you like me to make?"},{"file":"usr/src/uts/common/io/aggr/aggr_grp.c","line":2618,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"What if av_refs was somehow zero?"},{"file":"usr/src/uts/common/io/aggr/aggr_grp.c","line":2618,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Then that would be a bug. And as it turns out, I overlooked the case where we remove the last reference but the call to aggr_port_remvlan() fails. In that case the port would still have the filter but the aggr grp would free the aggr_vlan_t. I\u0027ve updated the err !\u003d 0 logic to increment the ref count; and I updated the remove/free logic to only execute when err \u003d\u003d 0.\n\nThis code feels a bit too subtle. I feel like two functions, one for untagged and one for tagged, would make the logic easier to follow at the cost of repeating a bit of code. What do you think?"},{"file":"usr/src/uts/common/io/aggr/aggr_port.c","line":703,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"I take it the aggr situation is such that the group mac perimeter will always be held prior to entering the port one?  (Not a comment on you, more a comment on MAC...)"},{"file":"usr/src/uts/common/io/aggr/aggr_port.c","line":703,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Yes, I\u0027m just following what was already there for the addmac path."},{"file":"usr/src/uts/common/io/dls/dls_link.c","line":384,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Barf."},{"file":"usr/src/uts/common/io/dls/dls_link.c","line":419,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Non-blocking question:  Do we need to remove all of sun4v to lose this?  Or just nxgbe?"},{"file":"usr/src/uts/common/io/dls/dls_link.c","line":419,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"I can\u0027t remember off the top of my head. This stuff is just related to vsw (which IIRC is related to LDoms), I think. The nxge stuff is more related to dynamic groups, and maybe some other stuff I\u0027m forgetting."},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_common.h","line":143,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"This and most of its friends are pulled directly from Intel/FreeBSD/upstream, right?"},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_common.h","line":143,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Everything in ixgbe/core is pulled verbatim from Intel\u0027s drop on FreeBSD."},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":2289,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Are you sure this is safe? If you kmem_free vlp isn\u0027t that going to potentially scribble over the pointers that you\u0027re using for figuring out the next one?\n\nShouldn\u0027t this instead be phrased as:\n\nwhile ((vlp \u003d list_remove_head(\u0026rx_group-\u003evlans)) !\u003d NULL) {\n...\n}"},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":2289,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Wow, brain fart on my part. Thanks for catching that."},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":6484,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Should we panic here versus return EIO so that way the system can continue to operate by falling back to using the default group?"},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":6484,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Seems reasonable."},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":6544,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Should we assert or verify that the value of refs here isn\u0027t zero? Otherwise we\u0027ll wrap around."},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":6544,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"The value should never be less than one here. I added a verify."},{"file":"usr/src/uts/common/io/mac/mac.c","line":4101,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"A probe like this..."},{"file":"usr/src/uts/common/io/mac/mac.c","line":4117,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Other possible EINVAL returns mean you need more here for diagnosibility. Please put in a dtrace probe similar to the one on line 4101 above."},{"file":"usr/src/uts/common/io/mac/mac.c","line":4117,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/mac/mac.c","line":4362,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Rather than VERIFY this should we check this and return an error if it\u0027s not true? So as to be extra layer of protection between drivers that call this and just panicking?"},{"file":"usr/src/uts/common/io/mac/mac.c","line":4362,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Yea, originally I added this because the vid should be verified up stack. But I only looked at the dladm path; and perhaps there may be consumers in the future that don\u0027t sanitize the input first. So I\u0027ll change this to just return EINVAL."},{"file":"usr/src/uts/common/io/mac/mac.c","line":4376,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Same as +4362."},{"file":"usr/src/uts/common/io/mac/mac.c","line":4376,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/mac/mac.c","line":7027,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"\u003csigh\u003e The \u0027t\u0027 in \"tgrp\" means \"to\", right?  I swear, for readability maybe s/tgrp/to_group/ and s/fgrp/from_group/ ?!?\n(Not a blocker, but a rant/suggestion.)"},{"file":"usr/src/uts/common/io/mac/mac.c","line":7027,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"I immediately recognized it as meaning \"to group\" (given the other was named fgrp), but I can understand not everyone will follow. I\u0027d rather not make that change as this diff has already grown large enough for my tastes and I just want to land this thing."},{"file":"usr/src/uts/common/io/mac/mac.c","line":7252,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"You\u0027ve been strong about VERIFY()s, why only ASSERT() here?"},{"file":"usr/src/uts/common/io/mac/mac.c","line":7252,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"I honestly have no idea, changed to VERIFY."},{"file":"usr/src/uts/common/io/mac/mac_client.c","line":2382,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I\u0027ve been trying to convince myself about this VERIFY and why it holds as true that there is a valid vid. It\u0027s not clear to me from the above comment."},{"file":"usr/src/uts/common/io/mac/mac_client.c","line":2382,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Honestly I can\u0027t remember why I convinced myself of this. I suppose I figured that the first flow would always be untagged, but that\u0027s probably not correct. Since this code path is only ever executed by sun4v vsw I\u0027m going to just remove this VERIFY to avoid confusion."},{"file":"usr/src/uts/common/io/mac/mac_client.c","line":2516,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"I take it callers check this?  I can imagine some grinning weirdo trying to tickle this path via ioctls as root@zone to make the machine panic."},{"file":"usr/src/uts/common/io/mac/mac_client.c","line":2516,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"That\u0027s a great point. I didn\u0027t think of the possibility of someone using bad input to trip these verifies. I\u0027m changing this back to an assert."},{"file":"usr/src/uts/common/sys/mac_client_impl.h","line":402,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"That name change makes things a LOT clearer."},{"file":"usr/src/uts/common/sys/mac_client_impl.h","line":402,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Yep, it annoyed me enough to merit a change."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/uts/common/inet/ip/ip6_input.c","type":"MODIFIED","insertions":4,"deletions":-5},{"file":"usr/src/uts/common/inet/ip/ip_input.c","type":"MODIFIED","insertions":4,"deletions":-5},{"file":"usr/src/uts/common/io/aggr/aggr_grp.c","type":"MODIFIED","insertions":202,"deletions":-2},{"file":"usr/src/uts/common/io/aggr/aggr_port.c","type":"MODIFIED","insertions":39,"deletions":-1},{"file":"usr/src/uts/common/io/dld/dld_proto.c","type":"MODIFIED","insertions":15,"deletions":-16},{"file":"usr/src/uts/common/io/dls/dls.c","type":"MODIFIED","insertions":8,"deletions":-8},{"file":"usr/src/uts/common/io/dls/dls_link.c","type":"MODIFIED","insertions":10,"deletions":-1},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_82598.c","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_82598.h","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_api.c","type":"MODIFIED","insertions":15,"deletions":-10},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_api.h","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_common.c","type":"MODIFIED","insertions":113,"deletions":-135},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_common.h","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_type.h","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_vf.c","type":"MODIFIED","insertions":15,"deletions":-14},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_vf.h","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","type":"MODIFIED","insertions":328,"deletions":-4},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_sw.h","type":"MODIFIED","insertions":19,"deletions":-1},{"file":"usr/src/uts/common/io/mac/mac.c","type":"MODIFIED","insertions":485,"deletions":-278},{"file":"usr/src/uts/common/io/mac/mac_client.c","type":"MODIFIED","insertions":99,"deletions":-52},{"file":"usr/src/uts/common/io/mac/mac_datapath_setup.c","type":"MODIFIED","insertions":159,"deletions":-92},{"file":"usr/src/uts/common/io/mac/mac_provider.c","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/io/mac/mac_sched.c","type":"MODIFIED","insertions":73,"deletions":-67},{"file":"usr/src/uts/common/io/mac/mac_soft_ring.c","type":"MODIFIED","insertions":18,"deletions":-22},{"file":"usr/src/uts/common/io/vnic/vnic_dev.c","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/common/sys/aggr_impl.h","type":"MODIFIED","insertions":15,"deletions":-1},{"file":"usr/src/uts/common/sys/mac_client.h","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/common/sys/mac_client_impl.h","type":"MODIFIED","insertions":77,"deletions":-4},{"file":"usr/src/uts/common/sys/mac_client_priv.h","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"usr/src/uts/common/sys/mac_impl.h","type":"MODIFIED","insertions":27,"deletions":-12},{"file":"usr/src/uts/common/sys/mac_provider.h","type":"MODIFIED","insertions":30,"deletions":-2}],"sizeInsertions":1782,"sizeDeletions":-745},{"number":"4","revision":"19d53481b2f0b2a6690ca4c3a6ffd0a9014a25ee","parents":["97f2cda0aba36f25db5cda594bb8946108b944c7"],"ref":"refs/changes/37/3137/4","uploader":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"createdOn":1519860511,"author":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/uts/common/inet/ip/ip6_input.c","type":"MODIFIED","insertions":4,"deletions":-5},{"file":"usr/src/uts/common/inet/ip/ip_input.c","type":"MODIFIED","insertions":4,"deletions":-5},{"file":"usr/src/uts/common/io/aggr/aggr_grp.c","type":"MODIFIED","insertions":182,"deletions":-2},{"file":"usr/src/uts/common/io/aggr/aggr_port.c","type":"MODIFIED","insertions":41,"deletions":-1},{"file":"usr/src/uts/common/io/dld/dld_proto.c","type":"MODIFIED","insertions":15,"deletions":-16},{"file":"usr/src/uts/common/io/dls/dls.c","type":"MODIFIED","insertions":8,"deletions":-8},{"file":"usr/src/uts/common/io/dls/dls_link.c","type":"MODIFIED","insertions":10,"deletions":-1},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_82598.c","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_82598.h","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_api.c","type":"MODIFIED","insertions":15,"deletions":-10},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_api.h","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_common.c","type":"MODIFIED","insertions":113,"deletions":-135},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_common.h","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_type.h","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_vf.c","type":"MODIFIED","insertions":15,"deletions":-14},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_vf.h","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","type":"MODIFIED","insertions":326,"deletions":-4},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_sw.h","type":"MODIFIED","insertions":19,"deletions":-1},{"file":"usr/src/uts/common/io/mac/mac.c","type":"MODIFIED","insertions":502,"deletions":-278},{"file":"usr/src/uts/common/io/mac/mac_client.c","type":"MODIFIED","insertions":97,"deletions":-53},{"file":"usr/src/uts/common/io/mac/mac_datapath_setup.c","type":"MODIFIED","insertions":159,"deletions":-92},{"file":"usr/src/uts/common/io/mac/mac_provider.c","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/io/mac/mac_sched.c","type":"MODIFIED","insertions":74,"deletions":-68},{"file":"usr/src/uts/common/io/mac/mac_soft_ring.c","type":"MODIFIED","insertions":18,"deletions":-22},{"file":"usr/src/uts/common/io/vnic/vnic_dev.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/common/mapfiles/ddi.mapfile","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/sys/aggr_impl.h","type":"MODIFIED","insertions":15,"deletions":-1},{"file":"usr/src/uts/common/sys/mac_client.h","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/sys/mac_client_impl.h","type":"MODIFIED","insertions":77,"deletions":-4},{"file":"usr/src/uts/common/sys/mac_client_priv.h","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"usr/src/uts/common/sys/mac_impl.h","type":"MODIFIED","insertions":27,"deletions":-12},{"file":"usr/src/uts/common/sys/mac_provider.h","type":"MODIFIED","insertions":30,"deletions":-2}],"sizeInsertions":1782,"sizeDeletions":-750},{"number":"5","revision":"e0c0762f9ac3728c32068295d7e6687eebce9e32","parents":["97f2cda0aba36f25db5cda594bb8946108b944c7"],"ref":"refs/changes/37/3137/5","uploader":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"createdOn":1520875637,"author":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1521047808,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}}],"comments":[{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":6595,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Minor nit, but this should probably be IXGBE_SUCCESS."},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","line":6595,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/uts/common/inet/ip/ip6_input.c","type":"MODIFIED","insertions":4,"deletions":-5},{"file":"usr/src/uts/common/inet/ip/ip_input.c","type":"MODIFIED","insertions":4,"deletions":-5},{"file":"usr/src/uts/common/io/aggr/aggr_grp.c","type":"MODIFIED","insertions":266,"deletions":-36},{"file":"usr/src/uts/common/io/aggr/aggr_port.c","type":"MODIFIED","insertions":41,"deletions":-1},{"file":"usr/src/uts/common/io/dld/dld_proto.c","type":"MODIFIED","insertions":15,"deletions":-16},{"file":"usr/src/uts/common/io/dls/dls.c","type":"MODIFIED","insertions":8,"deletions":-8},{"file":"usr/src/uts/common/io/dls/dls_link.c","type":"MODIFIED","insertions":10,"deletions":-1},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_82598.c","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_82598.h","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_api.c","type":"MODIFIED","insertions":15,"deletions":-10},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_api.h","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_common.c","type":"MODIFIED","insertions":113,"deletions":-135},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_common.h","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_type.h","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_vf.c","type":"MODIFIED","insertions":15,"deletions":-14},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_vf.h","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","type":"MODIFIED","insertions":345,"deletions":-10},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_sw.h","type":"MODIFIED","insertions":19,"deletions":-1},{"file":"usr/src/uts/common/io/mac/mac.c","type":"MODIFIED","insertions":505,"deletions":-262},{"file":"usr/src/uts/common/io/mac/mac_client.c","type":"MODIFIED","insertions":83,"deletions":-40},{"file":"usr/src/uts/common/io/mac/mac_datapath_setup.c","type":"MODIFIED","insertions":157,"deletions":-90},{"file":"usr/src/uts/common/io/mac/mac_provider.c","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/io/mac/mac_sched.c","type":"MODIFIED","insertions":74,"deletions":-68},{"file":"usr/src/uts/common/io/mac/mac_soft_ring.c","type":"MODIFIED","insertions":18,"deletions":-22},{"file":"usr/src/uts/common/io/vnic/vnic_dev.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/common/mapfiles/ddi.mapfile","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/sys/aggr_impl.h","type":"MODIFIED","insertions":15,"deletions":-1},{"file":"usr/src/uts/common/sys/mac_client.h","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/sys/mac_client_impl.h","type":"MODIFIED","insertions":77,"deletions":-4},{"file":"usr/src/uts/common/sys/mac_client_priv.h","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"usr/src/uts/common/sys/mac_impl.h","type":"MODIFIED","insertions":26,"deletions":-11},{"file":"usr/src/uts/common/sys/mac_provider.h","type":"MODIFIED","insertions":30,"deletions":-2}],"sizeInsertions":1871,"sizeDeletions":-758},{"number":"6","revision":"a04d780fa488197afdc8e319ffa595ed5b1af44b","parents":["97f2cda0aba36f25db5cda594bb8946108b944c7"],"ref":"refs/changes/37/3137/6","uploader":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"createdOn":1521155106,"author":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1521156684,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}}],"comments":[{"file":"usr/src/uts/common/io/aggr/aggr_grp.c","line":766,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Is \u0027avp\u0027 guaranteed to be non-NULL from the loop at L736.  That is: Is there guaranteed to be a list_head?  This might warrant some extra paranoia and/or protection.  list_prev() will bomb out with a NULL object."},{"file":"usr/src/uts/common/io/aggr/aggr_grp.c","line":766,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Nice catch, fixed."},{"file":"usr/src/uts/common/io/aggr/aggr_grp.c","line":1358,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Should probably have a corresponding list_destroy in aggr_grp_delete or aggr_grp_free, if only to get the ASSERTs that its empty?"},{"file":"usr/src/uts/common/io/aggr/aggr_grp.c","line":1358,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Doh. Yea I fixed this in my aggr branch but forgot to patch it here."},{"file":"usr/src/uts/common/io/aggr/aggr_grp.c","line":2302,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"nit: \"function\" while we\u0027re here?"},{"file":"usr/src/uts/common/io/aggr/aggr_grp.c","line":2302,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/uts/common/io/aggr/aggr_grp.c","line":2563,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"It might be clearer to do this as:\nif (avp !\u003d NULL) {\n    refs++;\n    preim_exit();\n    return ();\n}\n\navp \u003d kmem_alloc();\n...\n\n\nIt makes the kmem_free() later seem less scary to me since the refcnt path is more of a clear bail-out than an if-else.\n\nUp to you on if you like that style better or not."},{"file":"usr/src/uts/common/io/aggr/aggr_grp.c","line":2563,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"That is more clear. Thanks."},{"file":"usr/src/uts/common/io/aggr/aggr_grp.c","line":2636,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Returning with the perim held?"},{"file":"usr/src/uts/common/io/aggr/aggr_grp.c","line":2636,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Doh! Fixed."},{"file":"usr/src/uts/common/io/mac/mac.c","line":5060,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"If we\u0027re going to check that there are no duplicates during mac_add_vlan, shouldn\u0027t we go as far as checking that our entry does exist here?  It looks like we could fall through in such (an admittedly weird) cases."},{"file":"usr/src/uts/common/io/mac/mac.c","line":5060,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Yea, mav_rem_vlan should never be called with a mvp that isn\u0027t in the list. I added a verify."},{"file":"usr/src/uts/common/io/mac/mac_datapath_setup.c","line":3153,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"style nit: this could be hoisted into the block at L3175"},{"file":"usr/src/uts/common/io/mac/mac_datapath_setup.c","line":3153,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/uts/common/inet/ip/ip6_input.c","type":"MODIFIED","insertions":4,"deletions":-5},{"file":"usr/src/uts/common/inet/ip/ip_input.c","type":"MODIFIED","insertions":4,"deletions":-5},{"file":"usr/src/uts/common/io/aggr/aggr_grp.c","type":"MODIFIED","insertions":266,"deletions":-36},{"file":"usr/src/uts/common/io/aggr/aggr_port.c","type":"MODIFIED","insertions":41,"deletions":-1},{"file":"usr/src/uts/common/io/dld/dld_proto.c","type":"MODIFIED","insertions":15,"deletions":-16},{"file":"usr/src/uts/common/io/dls/dls.c","type":"MODIFIED","insertions":8,"deletions":-8},{"file":"usr/src/uts/common/io/dls/dls_link.c","type":"MODIFIED","insertions":10,"deletions":-1},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_82598.c","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_82598.h","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_api.c","type":"MODIFIED","insertions":15,"deletions":-10},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_api.h","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_common.c","type":"MODIFIED","insertions":113,"deletions":-135},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_common.h","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_type.h","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_vf.c","type":"MODIFIED","insertions":15,"deletions":-14},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_vf.h","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","type":"MODIFIED","insertions":345,"deletions":-10},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_sw.h","type":"MODIFIED","insertions":19,"deletions":-1},{"file":"usr/src/uts/common/io/mac/mac.c","type":"MODIFIED","insertions":505,"deletions":-262},{"file":"usr/src/uts/common/io/mac/mac_client.c","type":"MODIFIED","insertions":83,"deletions":-40},{"file":"usr/src/uts/common/io/mac/mac_datapath_setup.c","type":"MODIFIED","insertions":157,"deletions":-90},{"file":"usr/src/uts/common/io/mac/mac_provider.c","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/io/mac/mac_sched.c","type":"MODIFIED","insertions":74,"deletions":-68},{"file":"usr/src/uts/common/io/mac/mac_soft_ring.c","type":"MODIFIED","insertions":18,"deletions":-22},{"file":"usr/src/uts/common/io/vnic/vnic_dev.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/common/mapfiles/ddi.mapfile","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/sys/aggr_impl.h","type":"MODIFIED","insertions":15,"deletions":-1},{"file":"usr/src/uts/common/sys/mac_client.h","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/sys/mac_client_impl.h","type":"MODIFIED","insertions":77,"deletions":-4},{"file":"usr/src/uts/common/sys/mac_client_priv.h","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"usr/src/uts/common/sys/mac_impl.h","type":"MODIFIED","insertions":26,"deletions":-11},{"file":"usr/src/uts/common/sys/mac_provider.h","type":"MODIFIED","insertions":30,"deletions":-2}],"sizeInsertions":1871,"sizeDeletions":-758},{"number":"7","revision":"b68017e1c2e9912d4a2026608643420cf1394822","parents":["97f2cda0aba36f25db5cda594bb8946108b944c7"],"ref":"refs/changes/37/3137/7","uploader":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"createdOn":1521166864,"author":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/uts/common/io/aggr/aggr_grp.c","line":766,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"style nit: this is now one hell of a loop initializer, considering the self-referential ternary.\n\nPerhaps do it as an if-statement, just before?"},{"file":"usr/src/uts/common/io/aggr/aggr_grp.c","line":766,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"I\u0027m not wild about it either but I liked this idea more than bumping everything over another indent level with that cmn_err() in there."},{"file":"usr/src/uts/common/io/aggr/aggr_grp.c","line":766,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"I misunderstood your comment. Moving the initializer outside the for loop looks much better."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/uts/common/inet/ip/ip6_input.c","type":"MODIFIED","insertions":4,"deletions":-5},{"file":"usr/src/uts/common/inet/ip/ip_input.c","type":"MODIFIED","insertions":4,"deletions":-5},{"file":"usr/src/uts/common/io/aggr/aggr_grp.c","type":"MODIFIED","insertions":271,"deletions":-37},{"file":"usr/src/uts/common/io/aggr/aggr_port.c","type":"MODIFIED","insertions":41,"deletions":-1},{"file":"usr/src/uts/common/io/dld/dld_proto.c","type":"MODIFIED","insertions":15,"deletions":-16},{"file":"usr/src/uts/common/io/dls/dls.c","type":"MODIFIED","insertions":8,"deletions":-8},{"file":"usr/src/uts/common/io/dls/dls_link.c","type":"MODIFIED","insertions":10,"deletions":-1},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_82598.c","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_82598.h","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_api.c","type":"MODIFIED","insertions":15,"deletions":-10},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_api.h","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_common.c","type":"MODIFIED","insertions":113,"deletions":-135},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_common.h","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_type.h","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_vf.c","type":"MODIFIED","insertions":15,"deletions":-14},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_vf.h","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","type":"MODIFIED","insertions":345,"deletions":-10},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_sw.h","type":"MODIFIED","insertions":19,"deletions":-1},{"file":"usr/src/uts/common/io/mac/mac.c","type":"MODIFIED","insertions":512,"deletions":-262},{"file":"usr/src/uts/common/io/mac/mac_client.c","type":"MODIFIED","insertions":83,"deletions":-40},{"file":"usr/src/uts/common/io/mac/mac_datapath_setup.c","type":"MODIFIED","insertions":157,"deletions":-89},{"file":"usr/src/uts/common/io/mac/mac_provider.c","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/io/mac/mac_sched.c","type":"MODIFIED","insertions":74,"deletions":-68},{"file":"usr/src/uts/common/io/mac/mac_soft_ring.c","type":"MODIFIED","insertions":18,"deletions":-22},{"file":"usr/src/uts/common/io/vnic/vnic_dev.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/common/mapfiles/ddi.mapfile","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/sys/aggr_impl.h","type":"MODIFIED","insertions":15,"deletions":-1},{"file":"usr/src/uts/common/sys/mac_client.h","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/sys/mac_client_impl.h","type":"MODIFIED","insertions":77,"deletions":-4},{"file":"usr/src/uts/common/sys/mac_client_priv.h","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"usr/src/uts/common/sys/mac_impl.h","type":"MODIFIED","insertions":26,"deletions":-11},{"file":"usr/src/uts/common/sys/mac_provider.h","type":"MODIFIED","insertions":30,"deletions":-2}],"sizeInsertions":1883,"sizeDeletions":-758},{"number":"8","revision":"cdfaf5ba25e308418bc8105680419b6e837a54bb","parents":["d40d50dab4b6a89f1e840364a47eeaf2ff7c6195"],"ref":"refs/changes/37/3137/8","uploader":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"createdOn":1521174786,"author":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/uts/common/inet/ip/ip6_input.c","type":"MODIFIED","insertions":4,"deletions":-5},{"file":"usr/src/uts/common/inet/ip/ip_input.c","type":"MODIFIED","insertions":4,"deletions":-5},{"file":"usr/src/uts/common/io/aggr/aggr_grp.c","type":"MODIFIED","insertions":271,"deletions":-37},{"file":"usr/src/uts/common/io/aggr/aggr_port.c","type":"MODIFIED","insertions":41,"deletions":-1},{"file":"usr/src/uts/common/io/dld/dld_proto.c","type":"MODIFIED","insertions":15,"deletions":-17},{"file":"usr/src/uts/common/io/dls/dls.c","type":"MODIFIED","insertions":8,"deletions":-8},{"file":"usr/src/uts/common/io/dls/dls_link.c","type":"MODIFIED","insertions":10,"deletions":-1},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_82598.c","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_82598.h","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_api.c","type":"MODIFIED","insertions":15,"deletions":-10},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_api.h","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_common.c","type":"MODIFIED","insertions":113,"deletions":-135},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_common.h","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_type.h","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_vf.c","type":"MODIFIED","insertions":15,"deletions":-14},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_vf.h","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","type":"MODIFIED","insertions":345,"deletions":-10},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_sw.h","type":"MODIFIED","insertions":19,"deletions":-1},{"file":"usr/src/uts/common/io/mac/mac.c","type":"MODIFIED","insertions":512,"deletions":-262},{"file":"usr/src/uts/common/io/mac/mac_client.c","type":"MODIFIED","insertions":83,"deletions":-40},{"file":"usr/src/uts/common/io/mac/mac_datapath_setup.c","type":"MODIFIED","insertions":157,"deletions":-89},{"file":"usr/src/uts/common/io/mac/mac_provider.c","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/io/mac/mac_sched.c","type":"MODIFIED","insertions":74,"deletions":-68},{"file":"usr/src/uts/common/io/mac/mac_soft_ring.c","type":"MODIFIED","insertions":18,"deletions":-22},{"file":"usr/src/uts/common/io/vnic/vnic_dev.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/common/mapfiles/ddi.mapfile","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/sys/aggr_impl.h","type":"MODIFIED","insertions":15,"deletions":-1},{"file":"usr/src/uts/common/sys/mac_client.h","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/sys/mac_client_impl.h","type":"MODIFIED","insertions":77,"deletions":-4},{"file":"usr/src/uts/common/sys/mac_client_priv.h","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"usr/src/uts/common/sys/mac_impl.h","type":"MODIFIED","insertions":26,"deletions":-11},{"file":"usr/src/uts/common/sys/mac_provider.h","type":"MODIFIED","insertions":30,"deletions":-2}],"sizeInsertions":1883,"sizeDeletions":-759},{"number":"9","revision":"5e526ee6a96fafa1b518903ea93f0e583ceeb5ba","parents":["d40d50dab4b6a89f1e840364a47eeaf2ff7c6195"],"ref":"refs/changes/37/3137/9","uploader":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"createdOn":1521175416,"author":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/uts/common/inet/ip/ip6_input.c","type":"MODIFIED","insertions":4,"deletions":-5},{"file":"usr/src/uts/common/inet/ip/ip_input.c","type":"MODIFIED","insertions":4,"deletions":-5},{"file":"usr/src/uts/common/io/aggr/aggr_grp.c","type":"MODIFIED","insertions":271,"deletions":-37},{"file":"usr/src/uts/common/io/aggr/aggr_port.c","type":"MODIFIED","insertions":41,"deletions":-1},{"file":"usr/src/uts/common/io/dld/dld_proto.c","type":"MODIFIED","insertions":15,"deletions":-17},{"file":"usr/src/uts/common/io/dls/dls.c","type":"MODIFIED","insertions":8,"deletions":-8},{"file":"usr/src/uts/common/io/dls/dls_link.c","type":"MODIFIED","insertions":10,"deletions":-1},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_82598.c","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_82598.h","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_api.c","type":"MODIFIED","insertions":15,"deletions":-10},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_api.h","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_common.c","type":"MODIFIED","insertions":113,"deletions":-135},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_common.h","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_type.h","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_vf.c","type":"MODIFIED","insertions":15,"deletions":-14},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_vf.h","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","type":"MODIFIED","insertions":345,"deletions":-10},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_sw.h","type":"MODIFIED","insertions":19,"deletions":-1},{"file":"usr/src/uts/common/io/mac/mac.c","type":"MODIFIED","insertions":512,"deletions":-262},{"file":"usr/src/uts/common/io/mac/mac_client.c","type":"MODIFIED","insertions":83,"deletions":-40},{"file":"usr/src/uts/common/io/mac/mac_datapath_setup.c","type":"MODIFIED","insertions":157,"deletions":-89},{"file":"usr/src/uts/common/io/mac/mac_provider.c","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/io/mac/mac_sched.c","type":"MODIFIED","insertions":74,"deletions":-68},{"file":"usr/src/uts/common/io/mac/mac_soft_ring.c","type":"MODIFIED","insertions":18,"deletions":-22},{"file":"usr/src/uts/common/io/vnic/vnic_dev.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/common/mapfiles/ddi.mapfile","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/sys/aggr_impl.h","type":"MODIFIED","insertions":15,"deletions":-1},{"file":"usr/src/uts/common/sys/mac_client.h","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/sys/mac_client_impl.h","type":"MODIFIED","insertions":77,"deletions":-4},{"file":"usr/src/uts/common/sys/mac_client_priv.h","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"usr/src/uts/common/sys/mac_impl.h","type":"MODIFIED","insertions":26,"deletions":-11},{"file":"usr/src/uts/common/sys/mac_provider.h","type":"MODIFIED","insertions":30,"deletions":-2}],"sizeInsertions":1883,"sizeDeletions":-759},{"number":"10","revision":"204fd4887ee9a9408bc3b61ec75f45a2e8c18ec6","parents":["d40d50dab4b6a89f1e840364a47eeaf2ff7c6195"],"ref":"refs/changes/37/3137/10","uploader":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"createdOn":1521178000,"author":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1521234348,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1521178250,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1521235169,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/uts/common/inet/ip/ip6_input.c","type":"MODIFIED","insertions":4,"deletions":-5},{"file":"usr/src/uts/common/inet/ip/ip_input.c","type":"MODIFIED","insertions":4,"deletions":-5},{"file":"usr/src/uts/common/io/aggr/aggr_grp.c","type":"MODIFIED","insertions":272,"deletions":-37},{"file":"usr/src/uts/common/io/aggr/aggr_port.c","type":"MODIFIED","insertions":41,"deletions":-1},{"file":"usr/src/uts/common/io/dld/dld_proto.c","type":"MODIFIED","insertions":15,"deletions":-17},{"file":"usr/src/uts/common/io/dls/dls.c","type":"MODIFIED","insertions":8,"deletions":-8},{"file":"usr/src/uts/common/io/dls/dls_link.c","type":"MODIFIED","insertions":10,"deletions":-1},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_82598.c","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_82598.h","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_api.c","type":"MODIFIED","insertions":15,"deletions":-10},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_api.h","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_common.c","type":"MODIFIED","insertions":113,"deletions":-135},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_common.h","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_type.h","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_vf.c","type":"MODIFIED","insertions":15,"deletions":-14},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_vf.h","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","type":"MODIFIED","insertions":345,"deletions":-10},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_sw.h","type":"MODIFIED","insertions":19,"deletions":-1},{"file":"usr/src/uts/common/io/mac/mac.c","type":"MODIFIED","insertions":512,"deletions":-262},{"file":"usr/src/uts/common/io/mac/mac_client.c","type":"MODIFIED","insertions":83,"deletions":-40},{"file":"usr/src/uts/common/io/mac/mac_datapath_setup.c","type":"MODIFIED","insertions":157,"deletions":-89},{"file":"usr/src/uts/common/io/mac/mac_provider.c","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/io/mac/mac_sched.c","type":"MODIFIED","insertions":74,"deletions":-68},{"file":"usr/src/uts/common/io/mac/mac_soft_ring.c","type":"MODIFIED","insertions":18,"deletions":-22},{"file":"usr/src/uts/common/io/vnic/vnic_dev.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/common/mapfiles/ddi.mapfile","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/sys/aggr_impl.h","type":"MODIFIED","insertions":15,"deletions":-1},{"file":"usr/src/uts/common/sys/mac_client.h","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/sys/mac_client_impl.h","type":"MODIFIED","insertions":77,"deletions":-4},{"file":"usr/src/uts/common/sys/mac_client_priv.h","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"usr/src/uts/common/sys/mac_impl.h","type":"MODIFIED","insertions":26,"deletions":-11},{"file":"usr/src/uts/common/sys/mac_provider.h","type":"MODIFIED","insertions":30,"deletions":-2}],"sizeInsertions":1884,"sizeDeletions":-759},{"number":"11","revision":"38be344262b2d25566488f5db49eac3cad21a72d","parents":["37c3d9c0c52dc69f6c31123761894a1c85149f8c"],"ref":"refs/changes/37/3137/11","uploader":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"createdOn":1521235679,"author":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1521234348,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1521178250,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1521235169,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/uts/common/inet/ip/ip6_input.c","type":"MODIFIED","insertions":4,"deletions":-5},{"file":"usr/src/uts/common/inet/ip/ip_input.c","type":"MODIFIED","insertions":4,"deletions":-5},{"file":"usr/src/uts/common/io/aggr/aggr_grp.c","type":"MODIFIED","insertions":272,"deletions":-37},{"file":"usr/src/uts/common/io/aggr/aggr_port.c","type":"MODIFIED","insertions":41,"deletions":-1},{"file":"usr/src/uts/common/io/dld/dld_proto.c","type":"MODIFIED","insertions":15,"deletions":-17},{"file":"usr/src/uts/common/io/dls/dls.c","type":"MODIFIED","insertions":8,"deletions":-8},{"file":"usr/src/uts/common/io/dls/dls_link.c","type":"MODIFIED","insertions":10,"deletions":-1},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_82598.c","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_82598.h","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_api.c","type":"MODIFIED","insertions":15,"deletions":-10},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_api.h","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_common.c","type":"MODIFIED","insertions":113,"deletions":-135},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_common.h","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_type.h","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_vf.c","type":"MODIFIED","insertions":15,"deletions":-14},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_vf.h","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","type":"MODIFIED","insertions":345,"deletions":-10},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_sw.h","type":"MODIFIED","insertions":19,"deletions":-1},{"file":"usr/src/uts/common/io/mac/mac.c","type":"MODIFIED","insertions":512,"deletions":-262},{"file":"usr/src/uts/common/io/mac/mac_client.c","type":"MODIFIED","insertions":83,"deletions":-40},{"file":"usr/src/uts/common/io/mac/mac_datapath_setup.c","type":"MODIFIED","insertions":157,"deletions":-89},{"file":"usr/src/uts/common/io/mac/mac_provider.c","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/io/mac/mac_sched.c","type":"MODIFIED","insertions":74,"deletions":-68},{"file":"usr/src/uts/common/io/mac/mac_soft_ring.c","type":"MODIFIED","insertions":18,"deletions":-22},{"file":"usr/src/uts/common/io/vnic/vnic_dev.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/common/mapfiles/ddi.mapfile","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/sys/aggr_impl.h","type":"MODIFIED","insertions":15,"deletions":-1},{"file":"usr/src/uts/common/sys/mac_client.h","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/sys/mac_client_impl.h","type":"MODIFIED","insertions":77,"deletions":-4},{"file":"usr/src/uts/common/sys/mac_client_priv.h","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"usr/src/uts/common/sys/mac_impl.h","type":"MODIFIED","insertions":26,"deletions":-11},{"file":"usr/src/uts/common/sys/mac_provider.h","type":"MODIFIED","insertions":30,"deletions":-2}],"sizeInsertions":1884,"sizeDeletions":-759},{"number":"12","revision":"1a34bceaa14b4cf3a9cf90aa9c4dae5eb003d9d7","parents":["37c3d9c0c52dc69f6c31123761894a1c85149f8c"],"ref":"refs/changes/37/3137/12","uploader":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"createdOn":1521235807,"author":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1521234348,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1521178250,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1521235169,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"SUBM","value":"1","grantedOn":1521235837,"by":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":13,"deletions":0},{"file":"usr/src/uts/common/inet/ip/ip6_input.c","type":"MODIFIED","insertions":4,"deletions":-5},{"file":"usr/src/uts/common/inet/ip/ip_input.c","type":"MODIFIED","insertions":4,"deletions":-5},{"file":"usr/src/uts/common/io/aggr/aggr_grp.c","type":"MODIFIED","insertions":272,"deletions":-37},{"file":"usr/src/uts/common/io/aggr/aggr_port.c","type":"MODIFIED","insertions":41,"deletions":-1},{"file":"usr/src/uts/common/io/dld/dld_proto.c","type":"MODIFIED","insertions":15,"deletions":-17},{"file":"usr/src/uts/common/io/dls/dls.c","type":"MODIFIED","insertions":8,"deletions":-8},{"file":"usr/src/uts/common/io/dls/dls_link.c","type":"MODIFIED","insertions":10,"deletions":-1},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_82598.c","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_82598.h","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_api.c","type":"MODIFIED","insertions":15,"deletions":-10},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_api.h","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_common.c","type":"MODIFIED","insertions":113,"deletions":-135},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_common.h","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_type.h","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_vf.c","type":"MODIFIED","insertions":15,"deletions":-14},{"file":"usr/src/uts/common/io/ixgbe/core/ixgbe_vf.h","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_main.c","type":"MODIFIED","insertions":345,"deletions":-10},{"file":"usr/src/uts/common/io/ixgbe/ixgbe_sw.h","type":"MODIFIED","insertions":19,"deletions":-1},{"file":"usr/src/uts/common/io/mac/mac.c","type":"MODIFIED","insertions":512,"deletions":-262},{"file":"usr/src/uts/common/io/mac/mac_client.c","type":"MODIFIED","insertions":83,"deletions":-40},{"file":"usr/src/uts/common/io/mac/mac_datapath_setup.c","type":"MODIFIED","insertions":157,"deletions":-89},{"file":"usr/src/uts/common/io/mac/mac_provider.c","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/io/mac/mac_sched.c","type":"MODIFIED","insertions":74,"deletions":-68},{"file":"usr/src/uts/common/io/mac/mac_soft_ring.c","type":"MODIFIED","insertions":18,"deletions":-22},{"file":"usr/src/uts/common/io/vnic/vnic_dev.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/common/mapfiles/ddi.mapfile","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/sys/aggr_impl.h","type":"MODIFIED","insertions":15,"deletions":-1},{"file":"usr/src/uts/common/sys/mac_client.h","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/sys/mac_client_impl.h","type":"MODIFIED","insertions":77,"deletions":-4},{"file":"usr/src/uts/common/sys/mac_client_priv.h","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"usr/src/uts/common/sys/mac_impl.h","type":"MODIFIED","insertions":26,"deletions":-11},{"file":"usr/src/uts/common/sys/mac_provider.h","type":"MODIFIED","insertions":30,"deletions":-2}],"sizeInsertions":1884,"sizeDeletions":-759}],"allReviewers":[{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"}]}