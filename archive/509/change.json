{"project":"joyent/node-cueball","branch":"master","id":"Ia044760c8c494cb70c1ad2f8352c56b30f5f7921","number":"509","subject":"joyent/node-cueball#7 add support for multiplexing requests on individual backends Reviewed by: David Pacheco \u003cdap@joyent.com\u003e","owner":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"url":"https://cr.joyent.us/509","commitMessage":"joyent/node-cueball#7 add support for multiplexing requests on individual backends\nReviewed by: David Pacheco \u003cdap@joyent.com\u003e\n","createdOn":1474405443,"lastUpdated":1475111977,"open":false,"status":"MERGED","comments":[{"timestamp":1474405443,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 1."},{"timestamp":1474405865,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1474409473,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 2."},{"timestamp":1474409574,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1474501106,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 2:\n\n(6 comments)"},{"timestamp":1474525690,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 2: Code-Review+1"},{"timestamp":1474657572,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1474928317,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 2: -Code-Review\n\n(1 comment)"},{"timestamp":1475097118,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 3."},{"timestamp":1475097251,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1475098040,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 3:\n\n(6 comments)"},{"timestamp":1475100802,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1475111961,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 4: Commit message was updated."},{"timestamp":1475111975,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 4: Integration-Approval+1"},{"timestamp":1475111977,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Alex Wilson"}],"currentPatchSet":{"number":"4","revision":"e57b459ed64c696b383c9a64051f39cdaf3dc6ed","parents":["9ec333e9b6660c115b644ff81efa0a191e689bf2"],"ref":"refs/changes/09/509/4","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1475111961,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1475097251,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1475100802,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1475111975,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"SUBM","value":"1","grantedOn":1475111977,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":69,"deletions":0},{"file":"lib/connection-fsm.js","type":"ADDED","insertions":624,"deletions":0},{"file":"lib/index.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/pool-monitor.js","type":"MODIFIED","insertions":75,"deletions":-6},{"file":"lib/pool.js","type":"MODIFIED","insertions":108,"deletions":-666},{"file":"lib/resolver.js","type":"MODIFIED","insertions":85,"deletions":-87},{"file":"lib/set.js","type":"ADDED","insertions":477,"deletions":0},{"file":"lib/utils.js","type":"MODIFIED","insertions":32,"deletions":-9},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"test/cset.test.js","type":"ADDED","insertions":174,"deletions":0},{"file":"test/pool.test.js","type":"MODIFIED","insertions":38,"deletions":-27},{"file":"test/resolver_static.test.js","type":"MODIFIED","insertions":38,"deletions":-31}],"sizeInsertions":1725,"sizeDeletions":-829},"patchSets":[{"number":"1","revision":"34819b6389cf799a5de81a885ec6527ba54d8416","parents":["ec15e7f0922b9a57e71c4c2ada82f0455788358c"],"ref":"refs/changes/09/509/1","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1474405443,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1474405865,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":69,"deletions":0},{"file":"lib/connection-fsm.js","type":"ADDED","insertions":624,"deletions":0},{"file":"lib/index.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/pool.js","type":"MODIFIED","insertions":108,"deletions":-666},{"file":"lib/resolver.js","type":"MODIFIED","insertions":85,"deletions":-87},{"file":"lib/set.js","type":"ADDED","insertions":447,"deletions":0},{"file":"lib/utils.js","type":"MODIFIED","insertions":32,"deletions":-9},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/cset.test.js","type":"ADDED","insertions":174,"deletions":0},{"file":"test/pool.test.js","type":"MODIFIED","insertions":38,"deletions":-27},{"file":"test/resolver_static.test.js","type":"MODIFIED","insertions":38,"deletions":-31}],"sizeInsertions":1619,"sizeDeletions":-822},{"number":"2","revision":"da526b69e87e6a15d8368be471274d2413fcbd7f","parents":["ec15e7f0922b9a57e71c4c2ada82f0455788358c"],"ref":"refs/changes/09/509/2","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1474409473,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1474409574,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"README.md","line":648,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"If I\u0027m understanding correctly, \"target\" is a total number of connections to be made available for the entire set (distributed across all backends found by the resolver), and \"maximum\" is a maximum number of connections to have open for the entire set, not just against one backend.  Is that right?  If so, it would be good to clarify that here."},{"file":"lib/set.js","line":42,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Should this be assertRecovery?"},{"file":"lib/set.js","line":42,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"No, the connectionfsm asserts about the contents of this object. We just want to assert that we were given one at all -- the same thing that the Pool constructor does."},{"file":"lib/set.js","line":60,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I think it would help to have comments explaining these data structures."},{"file":"lib/set.js","line":60,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Done"},{"file":"lib/set.js","line":121,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Should this be commented-in?"},{"file":"lib/set.js","line":121,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Yes, but support to pool-monitor.js for looking at connectionsets needs to be added."},{"file":"lib/set.js","line":135,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"This needs to use the \"stateChanged\" event rather than \"failed\".  (I found this while testing the new Moray client using this patchset.)"},{"file":"lib/set.js","line":135,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Done"},{"file":"lib/set.js","line":242,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Should this be commented-in?"},{"file":"lib/set.js","line":242,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Done"},{"file":"lib/set.js","line":363,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I always understood that you had to use Array.prototype.slice.call(arguments) to use \"arguments\" like this.  Is that not necessary?"},{"file":"lib/set.js","line":363,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"ES5 section 15.3.4.3 specifies that Function.prototype.apply() can be used on array-like exotic objects like \"arguments\". It\u0027s a special case."},{"file":"test/cset.test.js","line":0,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"It would be useful to have some tests for cases where:\n- with spares \u003d 2, we create 2 connections, even if the resolver emits, say, 8 of them\n- if we set the target to 5, we create three more connections\n- if we set the target back to 2, we remove 3 connections"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":69,"deletions":0},{"file":"lib/connection-fsm.js","type":"ADDED","insertions":624,"deletions":0},{"file":"lib/index.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/pool.js","type":"MODIFIED","insertions":108,"deletions":-666},{"file":"lib/resolver.js","type":"MODIFIED","insertions":85,"deletions":-87},{"file":"lib/set.js","type":"ADDED","insertions":447,"deletions":0},{"file":"lib/utils.js","type":"MODIFIED","insertions":32,"deletions":-9},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"test/cset.test.js","type":"ADDED","insertions":174,"deletions":0},{"file":"test/pool.test.js","type":"MODIFIED","insertions":38,"deletions":-27},{"file":"test/resolver_static.test.js","type":"MODIFIED","insertions":38,"deletions":-31}],"sizeInsertions":1620,"sizeDeletions":-823},{"number":"3","revision":"a044760c8c494cb70c1ad2f8352c56b30f5f7921","parents":["9ec333e9b6660c115b644ff81efa0a191e689bf2"],"ref":"refs/changes/09/509/3","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1475097118,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1475100802,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1475097251,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":69,"deletions":0},{"file":"lib/connection-fsm.js","type":"ADDED","insertions":624,"deletions":0},{"file":"lib/index.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/pool-monitor.js","type":"MODIFIED","insertions":75,"deletions":-6},{"file":"lib/pool.js","type":"MODIFIED","insertions":108,"deletions":-666},{"file":"lib/resolver.js","type":"MODIFIED","insertions":85,"deletions":-87},{"file":"lib/set.js","type":"ADDED","insertions":477,"deletions":0},{"file":"lib/utils.js","type":"MODIFIED","insertions":32,"deletions":-9},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"test/cset.test.js","type":"ADDED","insertions":174,"deletions":0},{"file":"test/pool.test.js","type":"MODIFIED","insertions":38,"deletions":-27},{"file":"test/resolver_static.test.js","type":"MODIFIED","insertions":38,"deletions":-31}],"sizeInsertions":1725,"sizeDeletions":-829},{"number":"4","revision":"e57b459ed64c696b383c9a64051f39cdaf3dc6ed","parents":["9ec333e9b6660c115b644ff81efa0a191e689bf2"],"ref":"refs/changes/09/509/4","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1475111961,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1475100802,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1475111975,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"SUBM","value":"1","grantedOn":1475111977,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1475097251,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":69,"deletions":0},{"file":"lib/connection-fsm.js","type":"ADDED","insertions":624,"deletions":0},{"file":"lib/index.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/pool-monitor.js","type":"MODIFIED","insertions":75,"deletions":-6},{"file":"lib/pool.js","type":"MODIFIED","insertions":108,"deletions":-666},{"file":"lib/resolver.js","type":"MODIFIED","insertions":85,"deletions":-87},{"file":"lib/set.js","type":"ADDED","insertions":477,"deletions":0},{"file":"lib/utils.js","type":"MODIFIED","insertions":32,"deletions":-9},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"test/cset.test.js","type":"ADDED","insertions":174,"deletions":0},{"file":"test/pool.test.js","type":"MODIFIED","insertions":38,"deletions":-27},{"file":"test/resolver_static.test.js","type":"MODIFIED","insertions":38,"deletions":-31}],"sizeInsertions":1725,"sizeDeletions":-829}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}]}