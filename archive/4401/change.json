{"project":"joyent/waferlock","branch":"master","id":"Ia9cd7561a8711dd04db4479bed4ee2047430cecd","number":"4401","subject":"MANTA-3782 waferlock should support polling SAPI for new morays Reviewed by: Cody Peter Mello \u003ccody.mello@joyent.com\u003e Approved by: Cody Peter Mello \u003ccody.mello@joyent.com\u003e","owner":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"url":"https://cr.joyent.us/4401","commitMessage":"MANTA-3782 waferlock should support polling SAPI for new morays\nReviewed by: Cody Peter Mello \u003ccody.mello@joyent.com\u003e\nApproved by: Cody Peter Mello \u003ccody.mello@joyent.com\u003e\n","createdOn":1529607325,"lastUpdated":1529688490,"open":false,"status":"MERGED","comments":[{"timestamp":1529607325,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 1."},{"timestamp":1529607342,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing-1\n\n\"make check\" exited with status 2\n\n fatal: ref HEAD is not a symbolic ref\n fatal: No tags can describe \u00278463a981235eb5007c20bb0f5772b9bfaa3e58c5\u0027.\n Try --always, or create some tags.\n find: `test\u0027: No such file or directory\n xmllint --noout --path tools/ --dtdvalid tools/service_bundle.dtd.1 smf/manifests/waferlock.xml\n /tmp/repo/build/node/bin/node node_modules/.bin/eslint  lib/zk.js lib/sapi.js lib/ipf.js server.js\n \n /tmp/repo/lib/sapi.js\n    13:5  error  \u0027mod_vasync\u0027 is assigned a value but never used. Allowed unused vars must match /^_/   no-unused-vars\n    17:5  error  \u0027mod_cueball\u0027 is assigned a value but never used. Allowed unused vars must match /^_/  no-unused-vars\n   260:6  error  \u0027self\u0027 is assigned a value but never used. Allowed unused vars must match /^_/         no-unused-vars\n \n /tmp/repo/server.js\n   157:59  error  Expected \u0027\u003d\u003d\u003d\u0027 and instead saw \u0027\u003d\u003d\u0027  eqeqeq\n \n âœ– 4 problems (4 errors, 0 warnings)\n \n tools/mk/Makefile.targ:201: recipe for target \u0027check-eslint\u0027 failed\n gmake: *** [check-eslint] Error 1"},{"timestamp":1529607470,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 2."},{"timestamp":1529607494,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1529607657,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 3."},{"timestamp":1529607676,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1529613191,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 3:\n\n(2 comments)"},{"timestamp":1529625332,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 4."},{"timestamp":1529625356,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1529625697,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 5."},{"timestamp":1529625717,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1529626375,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 6."},{"timestamp":1529626394,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 6: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1529627011,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 7."},{"timestamp":1529627030,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 7: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1529638264,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 7:\n\nbuilt into tarball at https://us-east.manta.joyent.com/Joyent_Dev/public/builds/waferlock/manta-3782-20180622T002504Z/waferlock/waferlock-pkg-manta-3782-20180622T002504Z-ga9cd756.tar.bz2"},{"timestamp":1529688453,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 7: Code-Review+1 Integration-Approval+1"},{"timestamp":1529688488,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 8: Commit message was updated."},{"timestamp":1529688490,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Alex Wilson"}],"currentPatchSet":{"number":"8","revision":"f05954c2945fa3885d572539a7ff185c569692f5","parents":["a96c9b511cedeaa8c04ae7d42289b71f1663735d"],"ref":"refs/changes/01/4401/8","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1529688488,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1529627030,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1529688453,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1529688453,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"SUBM","value":"1","grantedOn":1529688490,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/ipf.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/sapi.js","type":"ADDED","insertions":324,"deletions":0},{"file":"lib/zk.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":0},{"file":"sapi_manifests/waferlock/template","type":"MODIFIED","insertions":27,"deletions":-12},{"file":"server.js","type":"MODIFIED","insertions":76,"deletions":-1}],"sizeInsertions":433,"sizeDeletions":-13},"patchSets":[{"number":"1","revision":"8463a981235eb5007c20bb0f5772b9bfaa3e58c5","parents":["1c73575f3123c1fc91e9fe5704a2aa61c36ee0eb"],"ref":"refs/changes/01/4401/1","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1529607325,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1529607342,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/sapi.js","type":"ADDED","insertions":307,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":0},{"file":"sapi_manifests/waferlock/template","type":"MODIFIED","insertions":26,"deletions":-13},{"file":"server.js","type":"MODIFIED","insertions":67,"deletions":-1}],"sizeInsertions":402,"sizeDeletions":-14},{"number":"2","revision":"9b8ccd83604f13697740710d1299c9ba8c55e8c0","parents":["1c73575f3123c1fc91e9fe5704a2aa61c36ee0eb"],"ref":"refs/changes/01/4401/2","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1529607470,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1529607494,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/sapi.js","type":"ADDED","insertions":304,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":0},{"file":"sapi_manifests/waferlock/template","type":"MODIFIED","insertions":26,"deletions":-13},{"file":"server.js","type":"MODIFIED","insertions":67,"deletions":-1}],"sizeInsertions":399,"sizeDeletions":-14},{"number":"3","revision":"1a862b88b0decff7697849dddf7a7bf88a13b1cb","parents":["a96c9b511cedeaa8c04ae7d42289b71f1663735d"],"ref":"refs/changes/01/4401/3","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1529607657,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1529607676,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/sapi.js","line":60,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Is there a reason to not use sdc-clients here?"},{"file":"server.js","line":179,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Is there a reason to not set up the agent in the constructor instead? It feels like that\u0027d be the more natural place to put it."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/sapi.js","type":"ADDED","insertions":304,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":0},{"file":"sapi_manifests/waferlock/template","type":"MODIFIED","insertions":27,"deletions":-12},{"file":"server.js","type":"MODIFIED","insertions":67,"deletions":-1}],"sizeInsertions":400,"sizeDeletions":-13},{"number":"4","revision":"99255ca4cb04d92d7aac216a997afd651ff1361f","parents":["a96c9b511cedeaa8c04ae7d42289b71f1663735d"],"ref":"refs/changes/01/4401/4","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1529625332,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1529625356,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/ipf.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/sapi.js","type":"ADDED","insertions":313,"deletions":0},{"file":"lib/zk.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":0},{"file":"sapi_manifests/waferlock/template","type":"MODIFIED","insertions":27,"deletions":-12},{"file":"server.js","type":"MODIFIED","insertions":74,"deletions":-1}],"sizeInsertions":420,"sizeDeletions":-13},{"number":"5","revision":"2c31aafe2864697280d986dd4abbd61c14b8855c","parents":["a96c9b511cedeaa8c04ae7d42289b71f1663735d"],"ref":"refs/changes/01/4401/5","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1529625697,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1529625717,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/ipf.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/sapi.js","type":"ADDED","insertions":313,"deletions":0},{"file":"lib/zk.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":0},{"file":"sapi_manifests/waferlock/template","type":"MODIFIED","insertions":27,"deletions":-12},{"file":"server.js","type":"MODIFIED","insertions":74,"deletions":-1}],"sizeInsertions":420,"sizeDeletions":-13},{"number":"6","revision":"2c623c92b24419fc4c5309feb388bcec387a6e0d","parents":["a96c9b511cedeaa8c04ae7d42289b71f1663735d"],"ref":"refs/changes/01/4401/6","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1529626375,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1529626394,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/ipf.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/sapi.js","type":"ADDED","insertions":324,"deletions":0},{"file":"lib/zk.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":0},{"file":"sapi_manifests/waferlock/template","type":"MODIFIED","insertions":27,"deletions":-12},{"file":"server.js","type":"MODIFIED","insertions":75,"deletions":-1}],"sizeInsertions":432,"sizeDeletions":-13},{"number":"7","revision":"a9cd7561a8711dd04db4479bed4ee2047430cecd","parents":["a96c9b511cedeaa8c04ae7d42289b71f1663735d"],"ref":"refs/changes/01/4401/7","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1529627011,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1529688453,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1529688453,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1529627030,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/ipf.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/sapi.js","type":"ADDED","insertions":324,"deletions":0},{"file":"lib/zk.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":0},{"file":"sapi_manifests/waferlock/template","type":"MODIFIED","insertions":27,"deletions":-12},{"file":"server.js","type":"MODIFIED","insertions":76,"deletions":-1}],"sizeInsertions":433,"sizeDeletions":-13},{"number":"8","revision":"f05954c2945fa3885d572539a7ff185c569692f5","parents":["a96c9b511cedeaa8c04ae7d42289b71f1663735d"],"ref":"refs/changes/01/4401/8","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1529688488,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1529688453,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1529688453,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"SUBM","value":"1","grantedOn":1529688490,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1529627030,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/ipf.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/sapi.js","type":"ADDED","insertions":324,"deletions":0},{"file":"lib/zk.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":0},{"file":"sapi_manifests/waferlock/template","type":"MODIFIED","insertions":27,"deletions":-12},{"file":"server.js","type":"MODIFIED","insertions":76,"deletions":-1}],"sizeInsertions":433,"sizeDeletions":-13}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}]}