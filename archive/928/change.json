{"project":"joyent/illumos-joyent","branch":"master","id":"Ia434634703d530e1a12fdabde4691c73a93ca8b5","number":"928","subject":"OS-5802 LTP setpriority02 now failing Reviewed by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e Approved by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e","owner":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"url":"https://cr.joyent.us/928","commitMessage":"OS-5802 LTP setpriority02 now failing\nReviewed by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e\nApproved by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e\n","createdOn":1479769555,"lastUpdated":1480171876,"open":false,"status":"MERGED","comments":[{"timestamp":1479769555,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 1."},{"timestamp":1479770574,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 1:\n\n(6 comments)"},{"timestamp":1479773133,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 1:\n\n(1 comment)\n\nAddressed all but the one item I commented on specifically. Re-testing before I upload a new CR."},{"timestamp":1479824002,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 2."},{"timestamp":1479827927,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 2: Code-Review+1"},{"timestamp":1479827959,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 2: Integration-Approval+1"},{"timestamp":1480171737,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 3: Patch Set 2 was rebased."},{"timestamp":1480171818,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 4: Commit message was updated."},{"timestamp":1480171876,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Jerry Jelinek"}],"currentPatchSet":{"number":"4","revision":"a434634703d530e1a12fdabde4691c73a93ca8b5","parents":["91bad8da9e9cc8662d6c49ddbdc16359f2502be4"],"ref":"refs/changes/28/928/4","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1480171818,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1479827927,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1479827959,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"SUBM","value":"1","grantedOn":1480171876,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/lib/brand/lx/lx_brand/Makefile.com","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"usr/src/lib/brand/lx/lx_brand/common/lx_brand.c","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"usr/src/lib/brand/lx/lx_brand/common/priority.c","type":"DELETED","insertions":0,"deletions":-117},{"file":"usr/src/lib/brand/lx/lx_brand/sys/lx_syscall.h","type":"MODIFIED","insertions":0,"deletions":-3},{"file":"usr/src/uts/common/brand/lx/os/lx_syscall.c","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"usr/src/uts/common/brand/lx/sys/lx_syscalls.h","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/uts/common/brand/lx/syscall/lx_priority.c","type":"ADDED","insertions":192,"deletions":0},{"file":"usr/src/uts/common/disp/priocntl.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/intel/Makefile.files","type":"MODIFIED","insertions":1,"deletions":0}],"sizeInsertions":205,"sizeDeletions":-131},"patchSets":[{"number":"1","revision":"a4cd22d75f411a75c53230b41dbe06a804670026","parents":["5b508be5188fbc34f5e626fc0125a75be65a2057"],"ref":"refs/changes/28/928/1","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1479769555,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/uts/common/brand/lx/syscall/lx_priority.c","line":45,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Shouldn\u0027t this probably be an lx_lpid_to_spair?  (which would handle pid\u003d\u003d1 too)"},{"file":"usr/src/uts/common/brand/lx/syscall/lx_priority.c","line":75,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"I believe the logic related to the LX thunk has been mostly ripped out of the userspace library.  There\u0027s probably no need to carry it forward into the IKE version."},{"file":"usr/src/uts/common/brand/lx/syscall/lx_priority.c","line":81,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Assuming the lpid_to_spair lookup is performed above, it would probably be most appropriate to compare that against curproc-\u003ep_pid to do this check.  It should be the most accurate, particularly in the face of processes like init performing the action."},{"file":"usr/src/uts/common/brand/lx/syscall/lx_priority.c","line":143,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"same lpid concern as above"},{"file":"usr/src/uts/common/brand/lx/syscall/lx_priority.c","line":165,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Does this need to be offset for the internal representation just like getpriority does in reverse?"},{"file":"usr/src/uts/common/brand/lx/syscall/lx_priority.c","line":165,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Not from what my DTrace of the lx syscalls shows."},{"file":"usr/src/uts/common/brand/lx/syscall/lx_priority.c","line":191,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Should probably make a note about the potential to race here. (The target could modify its creds between the donice and this check, right?)"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/brand/lx/lx_brand/Makefile.com","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"usr/src/lib/brand/lx/lx_brand/common/lx_brand.c","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"usr/src/lib/brand/lx/lx_brand/common/priority.c","type":"DELETED","insertions":0,"deletions":-117},{"file":"usr/src/lib/brand/lx/lx_brand/sys/lx_syscall.h","type":"MODIFIED","insertions":0,"deletions":-3},{"file":"usr/src/uts/common/brand/lx/os/lx_syscall.c","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"usr/src/uts/common/brand/lx/sys/lx_syscalls.h","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/uts/common/brand/lx/syscall/lx_priority.c","type":"ADDED","insertions":199,"deletions":0},{"file":"usr/src/uts/common/disp/priocntl.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/intel/Makefile.files","type":"MODIFIED","insertions":1,"deletions":0}],"sizeInsertions":212,"sizeDeletions":-131},{"number":"2","revision":"2a5bb297242f08af61ef408ff4f1c04f4abe146e","parents":["de53b36c571e97a4fbff4241211ffe91ace1c684"],"ref":"refs/changes/28/928/2","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1479824002,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1479827927,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1479827959,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/brand/lx/lx_brand/Makefile.com","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"usr/src/lib/brand/lx/lx_brand/common/lx_brand.c","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"usr/src/lib/brand/lx/lx_brand/common/priority.c","type":"DELETED","insertions":0,"deletions":-117},{"file":"usr/src/lib/brand/lx/lx_brand/sys/lx_syscall.h","type":"MODIFIED","insertions":0,"deletions":-3},{"file":"usr/src/uts/common/brand/lx/os/lx_syscall.c","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"usr/src/uts/common/brand/lx/sys/lx_syscalls.h","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/uts/common/brand/lx/syscall/lx_priority.c","type":"ADDED","insertions":192,"deletions":0},{"file":"usr/src/uts/common/disp/priocntl.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/intel/Makefile.files","type":"MODIFIED","insertions":1,"deletions":0}],"sizeInsertions":205,"sizeDeletions":-131},{"number":"3","revision":"bf7fc82006aca21c64e16102ab386e5b2c52669c","parents":["91bad8da9e9cc8662d6c49ddbdc16359f2502be4"],"ref":"refs/changes/28/928/3","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1480171737,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1479827927,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1479827959,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/brand/lx/lx_brand/Makefile.com","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"usr/src/lib/brand/lx/lx_brand/common/lx_brand.c","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"usr/src/lib/brand/lx/lx_brand/common/priority.c","type":"DELETED","insertions":0,"deletions":-117},{"file":"usr/src/lib/brand/lx/lx_brand/sys/lx_syscall.h","type":"MODIFIED","insertions":0,"deletions":-3},{"file":"usr/src/uts/common/brand/lx/os/lx_syscall.c","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"usr/src/uts/common/brand/lx/sys/lx_syscalls.h","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/uts/common/brand/lx/syscall/lx_priority.c","type":"ADDED","insertions":192,"deletions":0},{"file":"usr/src/uts/common/disp/priocntl.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/intel/Makefile.files","type":"MODIFIED","insertions":1,"deletions":0}],"sizeInsertions":205,"sizeDeletions":-131},{"number":"4","revision":"a434634703d530e1a12fdabde4691c73a93ca8b5","parents":["91bad8da9e9cc8662d6c49ddbdc16359f2502be4"],"ref":"refs/changes/28/928/4","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1480171818,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"SUBM","value":"1","grantedOn":1480171876,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1479827927,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1479827959,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/lib/brand/lx/lx_brand/Makefile.com","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"usr/src/lib/brand/lx/lx_brand/common/lx_brand.c","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"usr/src/lib/brand/lx/lx_brand/common/priority.c","type":"DELETED","insertions":0,"deletions":-117},{"file":"usr/src/lib/brand/lx/lx_brand/sys/lx_syscall.h","type":"MODIFIED","insertions":0,"deletions":-3},{"file":"usr/src/uts/common/brand/lx/os/lx_syscall.c","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"usr/src/uts/common/brand/lx/sys/lx_syscalls.h","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/uts/common/brand/lx/syscall/lx_priority.c","type":"ADDED","insertions":192,"deletions":0},{"file":"usr/src/uts/common/disp/priocntl.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/intel/Makefile.files","type":"MODIFIED","insertions":1,"deletions":0}],"sizeInsertions":205,"sizeDeletions":-131}],"allReviewers":[{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}]}