{"project":"joyent/node-moray","branch":"master","id":"If1986fa3a99722024c0a4fb830cc684b6f4c2d52","number":"2898","subject":"MORAY-452 client should use a priority-queue to assign connection.","owner":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"url":"https://cr.joyent.us/2898","commitMessage":"MORAY-452 client should use a priority-queue to assign connection.\n","createdOn":1509582292,"lastUpdated":1522689183,"open":true,"status":"NEW","comments":[{"timestamp":1509582292,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Uploaded patch set 1."},{"timestamp":1509582315,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1509595900,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Uploaded patch set 2."},{"timestamp":1509595922,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1509596232,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Uploaded patch set 3."},{"timestamp":1509596255,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1509596719,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Uploaded patch set 4."},{"timestamp":1509596741,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1509658051,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 4:\n\n(2 comments)"},{"timestamp":1509659971,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Uploaded patch set 5."},{"timestamp":1509659994,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1509660272,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Patch Set 5:\n\n(1 comment)"},{"timestamp":1509663378,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 5:\n\nDid we end up finding from the production data that requests were being distributed very non-uniformly across the connections within a process, or non-uniformly across processes?  It would be a little surprising, since we typically have on the order of dozens or hundreds of clients, each of which maintains several connections, and Alex spent a bunch of time trying to ensure that those wouldn\u0027t be likely to overlap across clients."},{"timestamp":1509664061,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 5:\n\n\u003e Did we end up finding from the production data that requests were\n \u003e being distributed very non-uniformly across the connections within\n \u003e a process, or non-uniformly across processes?  It would be a little\n \u003e surprising, since we typically have on the order of dozens or\n \u003e hundreds of clients, each of which maintains several connections,\n \u003e and Alex spent a bunch of time trying to ensure that those wouldn\u0027t\n \u003e be likely to overlap across clients.\n\nI forgot to add that because we typically have so many different clients, it seems like the client-side count of requests on each connection would not really be a great measure of the busyness of a server.  It would be interesting to see if the data suggests otherwise!"},{"timestamp":1509729582,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Uploaded patch set 6: Commit message was updated."},{"timestamp":1510955676,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Uploaded patch set 7."},{"timestamp":1510955697,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 7: CI-Testing-1\n\n(1 comment)\n\n\"make check\" exited with status 2"},{"timestamp":1510956077,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Uploaded patch set 8."},{"timestamp":1510956099,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 8: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1522263365,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Patch Set 9: Patch Set 8 was rebased"},{"timestamp":1522263393,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 9:\n\n\"make check\" passed ok"},{"timestamp":1522689159,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Uploaded patch set 10."},{"timestamp":1522689183,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 10: CI-Testing+1\n\n\"make check\" passed ok"}],"currentPatchSet":{"number":"10","revision":"f1986fa3a99722024c0a4fb830cc684b6f4c2d52","parents":["2a55cc89030dc0c7b488a515147cab4aac6041b0"],"ref":"refs/changes/98/2898/10","uploader":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"createdOn":1522689159,"author":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1522689183,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":4,"deletions":0},{"file":"lib/pool.js","type":"MODIFIED","insertions":43,"deletions":-7},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-1}],"sizeInsertions":49,"sizeDeletions":-8},"patchSets":[{"number":"1","revision":"746a0723571dfa8772378bd79b8d3bcc0f3c1b55","parents":["22ab00cf1982302d4cc77546c346ebbbd681e914"],"ref":"refs/changes/98/2898/1","uploader":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"createdOn":1509582292,"author":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1509582315,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/pool.js","type":"MODIFIED","insertions":33,"deletions":-13},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":34,"sizeDeletions":-14},{"number":"2","revision":"7b4d0267957691ad1eeb37a8b376777c9dbf7047","parents":["22ab00cf1982302d4cc77546c346ebbbd681e914"],"ref":"refs/changes/98/2898/2","uploader":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"createdOn":1509595900,"author":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1509595922,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/pool.js","type":"MODIFIED","insertions":40,"deletions":-11},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-1}],"sizeInsertions":42,"sizeDeletions":-12},{"number":"3","revision":"af381ed1c8b7dc6dbd5a28e95ba340bcba38b9f3","parents":["22ab00cf1982302d4cc77546c346ebbbd681e914"],"ref":"refs/changes/98/2898/3","uploader":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"createdOn":1509596232,"author":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1509596255,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/pool.js","type":"MODIFIED","insertions":47,"deletions":-13},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-1}],"sizeInsertions":49,"sizeDeletions":-14},{"number":"4","revision":"6337cf8fa8bbe35cc0547e6adefe43172a96d4e3","parents":["22ab00cf1982302d4cc77546c346ebbbd681e914"],"ref":"refs/changes/98/2898/4","uploader":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"createdOn":1509596719,"author":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1509596741,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"/COMMIT_MSG","line":7,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"joyent/node-moray#4"},{"file":"lib/pool.js","line":133,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"too"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/pool.js","type":"MODIFIED","insertions":47,"deletions":-13},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-1}],"sizeInsertions":49,"sizeDeletions":-14},{"number":"5","revision":"cfb15846ddf746af67596ae86d6ff045005bf3e0","parents":["22ab00cf1982302d4cc77546c346ebbbd681e914"],"ref":"refs/changes/98/2898/5","uploader":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"createdOn":1509659971,"author":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1509659994,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/pool.js","line":174,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"A better way might be to use something like: https://github.com/joyent/UpdatablePriorityQueue.js to update the priority in-place. Currently, we leave the priority where it is when connections are \"released.\" We\u0027ll only assign more work to such a connection when it bubbles back up to the top."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/pool.js","type":"MODIFIED","insertions":47,"deletions":-13},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-1}],"sizeInsertions":49,"sizeDeletions":-14},{"number":"6","revision":"4045c90e0bca06a85e4e91d64f98db95b40ffed3","parents":["22ab00cf1982302d4cc77546c346ebbbd681e914"],"ref":"refs/changes/98/2898/6","uploader":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"createdOn":1509729582,"author":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1509659994,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/pool.js","type":"MODIFIED","insertions":47,"deletions":-13},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-1}],"sizeInsertions":49,"sizeDeletions":-14},{"number":"7","revision":"4eaf8c6ce9e971d6c4487256feef1e63f0d59a73","parents":["4b9e0fbee14b3e771b54304bbddb6b9ce0347099"],"ref":"refs/changes/98/2898/7","uploader":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"createdOn":1510955676,"author":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1510955697,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/pool.js","line":194,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"warning: variable is declared but never referenced: key"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":4,"deletions":0},{"file":"lib/pool.js","type":"MODIFIED","insertions":43,"deletions":-8},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-1}],"sizeInsertions":49,"sizeDeletions":-9},{"number":"8","revision":"2a1540ee238e38fd1a045f93b75a0a3ac42c43d0","parents":["4b9e0fbee14b3e771b54304bbddb6b9ce0347099"],"ref":"refs/changes/98/2898/8","uploader":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"createdOn":1510956077,"author":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1510956099,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":4,"deletions":0},{"file":"lib/pool.js","type":"MODIFIED","insertions":43,"deletions":-7},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-1}],"sizeInsertions":49,"sizeDeletions":-8},{"number":"9","revision":"c151e5c52e8dfc066e7e9341082981b11d7f8d89","parents":["2a55cc89030dc0c7b488a515147cab4aac6041b0"],"ref":"refs/changes/98/2898/9","uploader":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"createdOn":1522263365,"author":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1510956099,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":4,"deletions":0},{"file":"lib/pool.js","type":"MODIFIED","insertions":43,"deletions":-7},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":0}],"sizeInsertions":48,"sizeDeletions":-7},{"number":"10","revision":"f1986fa3a99722024c0a4fb830cc684b6f4c2d52","parents":["2a55cc89030dc0c7b488a515147cab4aac6041b0"],"ref":"refs/changes/98/2898/10","uploader":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"createdOn":1522689159,"author":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1522689183,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":4,"deletions":0},{"file":"lib/pool.js","type":"MODIFIED","insertions":43,"deletions":-7},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-1}],"sizeInsertions":49,"sizeDeletions":-8}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}]}