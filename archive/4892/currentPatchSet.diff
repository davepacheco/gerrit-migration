From 928bf242828caedd84806c2a445603060be0f346 Mon Sep 17 00:00:00 2001
From: Josh Wilsdon <josh@wilsdon.ca>
Date: Thu, 27 Sep 2018 16:02:00 -0700
Subject: [PATCH] TRITON-801 net-agent doesn't update NIC state if VM is
 created but not updated

---
 lib/vmadm-watcher-fsm.js | 2 ++
 package.json             | 2 +-
 2 files changed, 3 insertions(+), 1 deletion(-)

diff --git a/lib/vmadm-watcher-fsm.js b/lib/vmadm-watcher-fsm.js
index d844945..3f9a883 100644
--- a/lib/vmadm-watcher-fsm.js
+++ b/lib/vmadm-watcher-fsm.js
@@ -90,6 +90,8 @@ VmadmEventsFSM.prototype.state_init = function (S) {
             assert(!self.vms.hasOwnProperty(ev.zonename), 'VM already created');
 
             self.vms[ev.zonename] = ev.vm;
+            self.log.debug('VM %s created - setting needsUpdate', ev.zonename);
+            needsUpdate = true;
             break;
         case 'modify':
             assert.object(ev.vm, 'ev.vm');
diff --git a/package.json b/package.json
index e29dd92..67137a3 100644
--- a/package.json
+++ b/package.json
@@ -1,7 +1,7 @@
 {
     "name": "net-agent",
     "description": "Triton Network Agent",
-    "version": "2.1.0",
+    "version": "2.1.1",
     "author": "Joyent (joyent.com)",
     "private": true,
     "dependencies": {
-- 
2.21.0

