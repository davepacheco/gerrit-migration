{"project":"joyent/binder","branch":"master","id":"I2aeedfb039d67e3348eb86f8031933d0a7dd3e8b","number":"335","subject":"MANTA-2966 binder should check names for validity before passing to ZK client Reviewed by: Dave Pacheco \u003cdap@joyent.com\u003e","owner":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"url":"https://cr.joyent.us/335","commitMessage":"MANTA-2966 binder should check names for validity before passing to ZK client\nReviewed by: Dave Pacheco \u003cdap@joyent.com\u003e\n","createdOn":1471989027,"lastUpdated":1471998818,"open":false,"status":"MERGED","comments":[{"timestamp":1471989027,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 1."},{"timestamp":1471989062,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing-1\n\n\"make check\" exited with status 2\n\n fatal: ref HEAD is not a symbolic ref\n git submodule update --init deps/zookeeper-common\n Cloning into \u0027deps/zookeeper-common\u0027...\n Host key verification failed.\r\n fatal: Could not read from remote repository.\n \n Please make sure you have the correct access rights\n and the repository exists.\n fatal: clone of \u0027git@github.com:joyent/zookeeper-common.git\u0027 into submodule path \u0027deps/zookeeper-common\u0027 failed\n tools/mk/Makefile.targ:159: recipe for target \u0027deps/zookeeper-common/.git\u0027 failed\n gmake: *** [deps/zookeeper-common/.git] Error 128"},{"timestamp":1471990090,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 2: Patch Set 1 was rebased"},{"timestamp":1471990137,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1471992878,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 2:\n\n(1 comment)\n\nHad one nit below, but I\u0027m also wondering: do we know if anything is relying on the broken behavior today?"},{"timestamp":1471993101,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 2:\n\n\u003e (1 comment)\n \u003e \n \u003e Had one nit below, but I\u0027m also wondering: do we know if anything\n \u003e is relying on the broken behavior today?\n\nCurrently if you supply most invalid characters here (like \":\" for example), these are also invalid characters for a ZooKeeper path, and will currently cause binder to blow an assert in the zk client and abort.\n\nLeading _ in DNS names are valid only for the case of names for SRV records (where they are part of the RFC-recommended naming scheme for services and protocols). Leading \"-\" is not supposed to be valid at all, but... it\u0027s fine to ZK, and I guess I just wanted to mess with the current behaviour as little as possible. These restrictions are only SHOULDs in the RFC, fwiw, not MUST."},{"timestamp":1471993409,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 2: Code-Review+1\n\nThanks."},{"timestamp":1471998774,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 3: Commit message was updated."},{"timestamp":1471998810,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 3: Integration-Approval+1\n\nTested on CoaL with dig and nslookup. Seems to correctly reject the malformed requests and is serving its regular workload fine."},{"timestamp":1471998818,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Alex Wilson"}],"currentPatchSet":{"number":"3","revision":"23d6d850c0e81644ccaf5a4ecc5370c81c3f79fc","parents":["bdb73e428f774d5754408c0936df428e229d57c6"],"ref":"refs/changes/35/335/3","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1471998774,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1471990137,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1471993409,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1471998810,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"SUBM","value":"1","grantedOn":1471998818,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"lib/server.js","type":"MODIFIED","insertions":10,"deletions":0}],"sizeInsertions":10,"sizeDeletions":0},"patchSets":[{"number":"1","revision":"2aeedfb039d67e3348eb86f8031933d0a7dd3e8b","parents":["02893af1c2c821799639e285168c117f0f6a0191"],"ref":"refs/changes/35/335/1","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1471989027,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1471989062,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/server.js","type":"MODIFIED","insertions":10,"deletions":0}],"sizeInsertions":10,"sizeDeletions":0},{"number":"2","revision":"6daf5983ae5e1ad75f881b1b74f498525ac76a09","parents":["bdb73e428f774d5754408c0936df428e229d57c6"],"ref":"refs/changes/35/335/2","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1471990090,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1471993409,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1471990137,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/server.js","line":134,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I didn\u0027t think DNS names were allowed to start with \"_\" or \"-\".  Is that not true, or is it tough to do a more complete validation?"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/server.js","type":"MODIFIED","insertions":10,"deletions":0}],"sizeInsertions":10,"sizeDeletions":0},{"number":"3","revision":"23d6d850c0e81644ccaf5a4ecc5370c81c3f79fc","parents":["bdb73e428f774d5754408c0936df428e229d57c6"],"ref":"refs/changes/35/335/3","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1471998774,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1471993409,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1471998810,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"SUBM","value":"1","grantedOn":1471998818,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1471990137,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"lib/server.js","type":"MODIFIED","insertions":10,"deletions":0}],"sizeInsertions":10,"sizeDeletions":0}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"}]}