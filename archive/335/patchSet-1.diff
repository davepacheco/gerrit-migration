From 2aeedfb039d67e3348eb86f8031933d0a7dd3e8b Mon Sep 17 00:00:00 2001
From: Alex Wilson <alex.wilson@joyent.com>
Date: Tue, 23 Aug 2016 14:50:02 -0700
Subject: [PATCH] MANTA-2966 binder should check names for validity before
 passing to ZK client

---
 lib/server.js | 10 ++++++++++
 1 file changed, 10 insertions(+)

diff --git a/lib/server.js b/lib/server.js
index d9cc2d7..6821828 100644
--- a/lib/server.js
+++ b/lib/server.js
@@ -130,6 +130,16 @@ function resolve(options, query, cb) {
                 return;
         }
 
+        domain = domain.toLowerCase();
+        if (/[^a-z0-9_.-]/.test(domain)) {
+                req.log.debug('request for an invalid name: this client is ' +
+                    'probably misbehaving');
+                query.setError('eserver');
+                query.respond();
+                cb();
+                return;
+        }
+
         req.domain = domain;
         zk.resolveName(req, function (err, record) {
                 if (err && (typeof (err.getCode) !== 'function' ||
-- 
2.21.0

