From 2ea4ba2424413850892bf7d3301fea682a3d5b8b Mon Sep 17 00:00:00 2001
From: Rui Loura <rui@joyent.com>
Date: Fri, 21 Dec 2018 17:18:51 +0000
Subject: [PATCH] TRITON-1058 cnapi server uuid validation should handle
 "default"

---
 lib/endpoints/index.js | 9 +++++----
 1 file changed, 5 insertions(+), 4 deletions(-)

diff --git a/lib/endpoints/index.js b/lib/endpoints/index.js
index 318b691..072d155 100644
--- a/lib/endpoints/index.js
+++ b/lib/endpoints/index.js
@@ -119,13 +119,15 @@ function prepopulateServer(opts, req, res, next) {
     assert.object(req, 'req');
     assert.object(req.params, 'req.params');
 
-    if (!isUuid(req.params.server_uuid)) {
+    var server_uuid = req.params.server_uuid;
+
+    if (server_uuid !== 'default' && !isUuid(server_uuid)) {
         next(new restify.InvalidArgumentError('Invalid server_uuid'));
         return;
     }
 
     ModelServer.get(
-        req.params.server_uuid,
+        server_uuid,
         function (err, servermodel, server) {
             if (err) {
                 req.log.error(err);
@@ -135,8 +137,7 @@ function prepopulateServer(opts, req, res, next) {
 
             // Check if any servers were returned
             if (!server) {
-                var errorMsg = 'Server ' + req.params.server_uuid
-                    + ' not found';
+                var errorMsg = 'Server ' + server_uuid + ' not found';
                 next(new restify.ResourceNotFoundError(errorMsg));
                 return;
             }
-- 
2.21.0

