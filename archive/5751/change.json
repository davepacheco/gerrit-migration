{"project":"joyent/eng","branch":"master","id":"I83b177a3eae2017e50ebb14bbf4f06574e1fd8b0","number":"5751","subject":"TOOLS-2199 engbld should check for uid \u003d\u003d 0 and set $(PFEXEC) accordingly","owner":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"url":"https://cr.joyent.us/5751","commitMessage":"TOOLS-2199 engbld should check for uid \u003d\u003d 0 and set $(PFEXEC) accordingly\n","createdOn":1552301422,"lastUpdated":1552323670,"open":false,"status":"MERGED","comments":[{"timestamp":1552301422,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Uploaded patch set 1."},{"timestamp":1552301431,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit 8da15f66c41b91752eda5ff0d584e1969a44d3d4\n    \n    TOOLS-2199 engbld should check for uid \u003d\u003d 0 and set $(PFEXEC) accordingly"},{"timestamp":1552301675,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Uploaded patch set 2."},{"timestamp":1552301681,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit 3aa20c31cf5c9864a8ac7a9dda9284e59ce6d30b\n    \n    TOOLS-2199 engbld should check for uid \u003d\u003d 0 and set $(PFEXEC) accordingly"},{"timestamp":1552319295,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1552319420,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 2:\n\nTim:\n\nThere is this pfexec hit as well:\n\n```\nMakefile.node_prebuilt.defs\n127:NODE_PREBUILT_IMAGE ?\u003d $(shell pfexec mdata-get sdc:image_uuid)\n```\n\nRichard,\n\nTim did discuss \"root with insufficient privs\" being unlikely in the ticket a little bit. Not sure if you saw that."},{"timestamp":1552319901,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1552320200,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Uploaded patch set 3."},{"timestamp":1552320207,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Patch Set 3:\n\nNew commits:\n    \n    commit 50543ca27035305d3c8206a3d1c17fcf2c70d51a\n    \n    one more instance of s/pfexec/$(PFEXEC)/"},{"timestamp":1552321647,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 3: Code-Review+1 Integration-Approval+1\n\nLGTM\n\nHere is a log of a sdc-vmapi build with this eng.git change that shows the pfexec warnings are gone (I had them before because I dn\u0027t have pfexecd running).  https://gist.github.com/trentm/11f3eb4af01d81b378374728f0f850ec"},{"timestamp":1552321848,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"Patch Set 3: Code-Review+1\n\nThanks for the description. Sorry for missing the details in the ticket!"},{"timestamp":1552322732,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Patch Set 4: Patch Set 3 was rebased"},{"timestamp":1552323670,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Tim Foster"}],"currentPatchSet":{"number":"4","revision":"3fb93c5f46cc857ddeec97b1e178e4d9b83f39ab","parents":["fb426aa31baeb8315f68be8c48987cb77252af74"],"ref":"refs/changes/51/5751/4","uploader":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"createdOn":1552322732,"author":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1552321647,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1552321647,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1552321848,"by":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"}},{"type":"SUBM","value":"1","grantedOn":1552323670,"by":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"tools/mk/Makefile.defs","type":"MODIFIED","insertions":13,"deletions":0},{"file":"tools/mk/Makefile.node_prebuilt.defs","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"tools/mk/Makefile.targ","type":"MODIFIED","insertions":6,"deletions":-6}],"sizeInsertions":20,"sizeDeletions":-7},"patchSets":[{"number":"1","revision":"61070ffa05d74db507f278fbef11eadb04113710","parents":["cfd827a5029c249624efd6fcdee128db2a9d727e"],"ref":"refs/changes/51/5751/1","uploader":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"createdOn":1552301422,"author":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"tools/mk/Makefile.defs","type":"MODIFIED","insertions":13,"deletions":0},{"file":"tools/mk/Makefile.targ","type":"MODIFIED","insertions":6,"deletions":-6}],"sizeInsertions":19,"sizeDeletions":-6},{"number":"2","revision":"3e02142d7bda2fe73705571aad88dedc212f75f1","parents":["3bdc30e8bf3e10e6b6b283d216806d8e5d333c1a"],"ref":"refs/changes/51/5751/2","uploader":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"createdOn":1552301675,"author":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"isDraft":false,"kind":"REWORK","comments":[{"file":"tools/mk/Makefile.defs","line":215,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"As you mentioned in chat earlier, what are the chances that we\u0027re root (or uid\u003d\u003d0) but also with insufficient privs?\n\nI think this is fine to eliminate the noise in the build process, but I\u0027d appreciate help in understanding the situation better."},{"file":"tools/mk/Makefile.defs","line":215,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"The chances are miniscule. While Solaris/Illumos RBAC does allow for that sort of configuration, and a lot of work was done on the core Solaris daemons and libraries for them to function, it was only really hard-core customers that ever used it. (I also doubt that initial work was kept up to date)\n\nEither way, I think it\u0027s extremely unlikely to see a Solaris system configured that way in the wild, and even more unlikely to see a SmartOS box where uid 0 doesn\u0027t grant all permissions."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"tools/mk/Makefile.defs","type":"MODIFIED","insertions":13,"deletions":0},{"file":"tools/mk/Makefile.targ","type":"MODIFIED","insertions":6,"deletions":-6}],"sizeInsertions":19,"sizeDeletions":-6},{"number":"3","revision":"83b177a3eae2017e50ebb14bbf4f06574e1fd8b0","parents":["3bdc30e8bf3e10e6b6b283d216806d8e5d333c1a"],"ref":"refs/changes/51/5751/3","uploader":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"createdOn":1552320200,"author":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1552321647,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1552321647,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1552321848,"by":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"tools/mk/Makefile.defs","type":"MODIFIED","insertions":13,"deletions":0},{"file":"tools/mk/Makefile.node_prebuilt.defs","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"tools/mk/Makefile.targ","type":"MODIFIED","insertions":6,"deletions":-6}],"sizeInsertions":20,"sizeDeletions":-7},{"number":"4","revision":"3fb93c5f46cc857ddeec97b1e178e4d9b83f39ab","parents":["fb426aa31baeb8315f68be8c48987cb77252af74"],"ref":"refs/changes/51/5751/4","uploader":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"createdOn":1552322732,"author":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1552321647,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1552321647,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1552321848,"by":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"}},{"type":"SUBM","value":"1","grantedOn":1552323670,"by":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"tools/mk/Makefile.defs","type":"MODIFIED","insertions":13,"deletions":0},{"file":"tools/mk/Makefile.node_prebuilt.defs","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"tools/mk/Makefile.targ","type":"MODIFIED","insertions":6,"deletions":-6}],"sizeInsertions":20,"sizeDeletions":-7}],"allReviewers":[{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"}]}