commit 51016f355c8aec7b811b3c878e784e1bf81a4c02 (refs/changes/13/5313/6)
Author: Robert Bogart <Robert.bogart@joyent.com>
Date:   2019-01-07T23:24:08+00:00 (9 months ago)
    
    MANATEE-343 manatee full rebuilds should pull from the primary where possible

diff --git a/lib/manatee-peer.js b/lib/manatee-peer.js
index b6d242f..3b90f4f 100644
--- a/lib/manatee-peer.js
+++ b/lib/manatee-peer.js
@@ -987,20 +987,22 @@ ManateePeer.prototype.pgConfig = function ()
 		config.role = 'primary';
 		config.upstream = null;
 		config.downstream = this.mp_zkstate.sync;
+		config.rebuildPeer = null;
 	} else if (this.mp_role == MP_ROLE_SYNC ||
 	    this.mp_role == MP_ROLE_ASYNC) {
 		config.role = this.mp_role == MP_ROLE_SYNC ?
 		    'sync' : 'async';
 		config.upstream = this.mp_pg_upstream;
 		config.downstream = null;
+		config.rebuildPeer = this.mp_zkstate.primary;
 	} else {
 		mod_assertplus.ok(this.mp_role == MP_ROLE_UNASSIGNED ||
 		    this.mp_role == MP_ROLE_DEPOSED);
 		config.role = 'none';
 		config.upstream = null;
 		config.downstream = null;
+		config.rebuildPeer = null;
 	}
-
 	return (config);
 };
 
