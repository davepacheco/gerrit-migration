From 93660588fd41fdde0addc95fd00d0cc087d80904 Mon Sep 17 00:00:00 2001
From: Dave Eddy <dave@daveeddy.com>
Date: Thu, 29 Mar 2018 13:18:43 -0400
Subject: [PATCH] TRITON-280 vmapi vms.full.test should block on test VMs to be
 destroyed fully

---
 test/vms.full.test.js | 12 +++++++++++-
 1 file changed, 11 insertions(+), 1 deletion(-)

diff --git a/test/vms.full.test.js b/test/vms.full.test.js
index a4534dc..b7e12d9 100644
--- a/test/vms.full.test.js
+++ b/test/vms.full.test.js
@@ -184,6 +184,9 @@ function createTestVms(cb) {
                     return;
                 }
 
+                assert.object(body, 'body');
+                assert.uuid(body.job_uuid, 'body.job_uuid');
+
                 var job = '/jobs/' + body.job_uuid;
 
                 i++;
@@ -241,8 +244,15 @@ function destroyTestVms(cb) {
                         return;
                     }
 
+                    assert.object(delBody, 'delBody');
+                    assert.uuid(delBody.job_uuid, 'delBody.job_uuid');
+
+                    var job = '/jobs/' + delBody.job_uuid;
+
                     ret.destroyedVms++;
-                    next();
+                    waitForValue(job, 'execution', 'succeeded', {
+                        client: client
+                    }, next);
                 });
 
             }, function (delVmsErr) {
-- 
2.21.0

