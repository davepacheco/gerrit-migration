{"project":"joyent/triton-cns","branch":"master","id":"I11068f99bb8d623f9590c406a49722d0b3d2bc63","number":"4724","subject":"TRITON-707 CNS crash on access to query.src because redis claim() took too long, remote closed TCP connection Reviewed by: Robert Mustacchi \u003crm@joyent.com\u003e","owner":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"url":"https://cr.joyent.us/4724","commitMessage":"TRITON-707 CNS crash on access to query.src because redis claim() took too long, remote closed TCP connection\nReviewed by: Robert Mustacchi \u003crm@joyent.com\u003e\n","createdOn":1534800858,"lastUpdated":1536283247,"open":false,"status":"MERGED","comments":[{"timestamp":1534800858,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 1."},{"timestamp":1534800885,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1536169986,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 1: Code-Review+1\n\n(1 comment)\n\nIn general, I think this is fine, even with the outstanding question."},{"timestamp":1536190408,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 1:\n\n(we discussed this further on chat -- over at https://github.com/joyent/node-mname/blob/master/lib/query.js#L32 mname always sets up the .src on Query instances)"},{"timestamp":1536283163,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 1: Integration-Approval+1"},{"timestamp":1536283175,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 2: Commit message was updated."},{"timestamp":1536283220,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 3: Patch Set 2 was rebased"},{"timestamp":1536283222,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Alex Wilson"},{"timestamp":1536283247,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3:\n\n\"make check\" passed ok"}],"currentPatchSet":{"number":"3","revision":"1aad063736f9ccaf7cdc7dab3db5ce5a371579b8","parents":["1cf0030efbf067ca4960a443211a91c586992706"],"ref":"refs/changes/24/4724/3","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1536283220,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1534800885,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1536169986,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1536283163,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"SUBM","value":"1","grantedOn":1536283222,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"lib/dns-server.js","type":"MODIFIED","insertions":6,"deletions":0}],"sizeInsertions":6,"sizeDeletions":0},"patchSets":[{"number":"1","revision":"11068f99bb8d623f9590c406a49722d0b3d2bc63","parents":["83367612cde3204532c23a9b9fd7328e5f7d5ca8"],"ref":"refs/changes/24/4724/1","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1534800858,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1536169986,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1536283163,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1534800885,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/dns-server.js","line":240,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Is there any guarantee made by node-mname that this case will only occur when it\u0027s been closed? While I see the deletion of q.src when node-mname closes the socket, it\u0027s not clear to me that the constructor ever ensures that this isn\u0027t true. Though maybe it\u0027s possible that if you pass opts as one of these to the query parser then we\u0027ll have other problems instead and we won\u0027t get to this point."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/dns-server.js","type":"MODIFIED","insertions":6,"deletions":0}],"sizeInsertions":6,"sizeDeletions":0},{"number":"2","revision":"a038777623d788fb83b45f97a26d87a0f1a8a764","parents":["83367612cde3204532c23a9b9fd7328e5f7d5ca8"],"ref":"refs/changes/24/4724/2","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1536283175,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1536169986,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1536283163,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1534800885,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"lib/dns-server.js","type":"MODIFIED","insertions":6,"deletions":0}],"sizeInsertions":6,"sizeDeletions":0},{"number":"3","revision":"1aad063736f9ccaf7cdc7dab3db5ce5a371579b8","parents":["1cf0030efbf067ca4960a443211a91c586992706"],"ref":"refs/changes/24/4724/3","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1536283220,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1536169986,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1536283163,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"SUBM","value":"1","grantedOn":1536283222,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1534800885,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"lib/dns-server.js","type":"MODIFIED","insertions":6,"deletions":0}],"sizeInsertions":6,"sizeDeletions":0}],"allReviewers":[{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},{"name":"Joyent Automation","username":"joyent-automation"}]}