From 32f6d2ab97059fa70d54eb93c4406fc86a7ac883 Mon Sep 17 00:00:00 2001
From: Jerry Jelinek <jerry.jelinek@joyent.com>
Date: Thu, 3 Nov 2016 17:34:02 +0000
Subject: [PATCH] OS-5764 LTP sendto02 wrong errno

---
 usr/src/uts/common/brand/lx/syscall/lx_socket.c | 10 ++++++++++
 1 file changed, 10 insertions(+)

diff --git a/usr/src/uts/common/brand/lx/syscall/lx_socket.c b/usr/src/uts/common/brand/lx/syscall/lx_socket.c
index 8e774924b5..5d720dd59c 100644
--- a/usr/src/uts/common/brand/lx/syscall/lx_socket.c
+++ b/usr/src/uts/common/brand/lx/syscall/lx_socket.c
@@ -2185,6 +2185,11 @@ lx_send(int sock, void *buffer, size_t len, int flags)
 		return (set_errno(EINVAL));
 	}
 
+	if (len > 0 && buffer == NULL) {
+		/* Explicit check for correct LTP errno */
+		return (set_errno(EFAULT));
+	}
+
 	aiov[0].iov_base = buffer;
 	aiov[0].iov_len = len;
 	auio.uio_loffset = 0;
@@ -2212,6 +2217,11 @@ lx_sendto(int sock, void *buffer, size_t len, int flags,
 		return (set_errno(EINVAL));
 	}
 
+	if (len > 0 && buffer == NULL) {
+		/* Explicit check for correct LTP errno */
+		return (set_errno(EFAULT));
+	}
+
 	aiov[0].iov_base = buffer;
 	aiov[0].iov_len = len;
 	auio.uio_loffset = 0;
-- 
2.21.0

