{"project":"joyent/illumos-joyent","branch":"master","id":"I6209c5b690ff2076dfe5accf04990958f9409d6c","number":"2174","subject":"OS-6211 support Linux accounting Reviewed by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e Approved by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e","owner":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"url":"https://cr.joyent.us/2174","commitMessage":"OS-6211 support Linux accounting\nReviewed by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e\nApproved by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e\n","createdOn":1498770086,"lastUpdated":1499701846,"open":false,"status":"MERGED","comments":[{"timestamp":1498770086,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 1."},{"timestamp":1498771846,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 1:\n\n(4 comments)\n\nI haven\u0027t read up on the details to pass judgement on the IEEE float stuff, yet."},{"timestamp":1498777170,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 1:\n\n(4 comments)"},{"timestamp":1498777183,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 2."},{"timestamp":1498836794,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 2:\n\n(3 comments)\n\nThe float conversion stuff looks good, but it might be nice to verify via something like dtrace that the outputs match what\u0027s expected."},{"timestamp":1498842954,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 2:\n\n(3 comments)"},{"timestamp":1498842980,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 3."},{"timestamp":1499276838,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1499440966,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 3:\n\ntesting notes are in the ticket"},{"timestamp":1499700476,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 3: Integration-Approval+1"},{"timestamp":1499701780,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 4: Patch Set 3 was rebased."},{"timestamp":1499701835,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 5: Commit message was updated."},{"timestamp":1499701846,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Jerry Jelinek"}],"currentPatchSet":{"number":"5","revision":"6209c5b690ff2076dfe5accf04990958f9409d6c","parents":["31c0e5542fa9f26f6f2b4b2599e03e15050d2bac"],"ref":"refs/changes/74/2174/5","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1499701835,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1499276838,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1499700476,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"SUBM","value":"1","grantedOn":1499701846,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/uts/common/brand/lx/os/lx_acct.c","type":"ADDED","insertions":198,"deletions":0},{"file":"usr/src/uts/common/brand/lx/os/lx_brand.c","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/brand/lx/os/lx_syscall.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/common/brand/lx/sys/lx_brand.h","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/common/brand/lx/sys/lx_syscalls.h","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/common/brand/lx/syscall/lx_miscsys.c","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"usr/src/uts/common/brand/sn1/sn1_brand.c","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/brand/solaris10/s10_brand.c","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/os/acct.c","type":"MODIFIED","insertions":18,"deletions":-1},{"file":"usr/src/uts/common/os/exit.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/common/sys/acct.h","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/sys/brand.h","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/uts/intel/Makefile.files","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/intel/lx_brand/Makefile","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":243,"sizeDeletions":-11},"patchSets":[{"number":"1","revision":"8bacbe93c77a1acb9a90cf0e6f67c64ca9387e04","parents":["5ad7f810d0a72624056299b85500cdd7a9e5a916"],"ref":"refs/changes/74/2174/1","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1498770086,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/uts/common/brand/lx/os/lx_acct.c","line":155,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"pid-1 translation is probably desirable here, keeping in mind that the process may not be branded."},{"file":"usr/src/uts/common/brand/lx/os/lx_acct.c","line":155,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Good catch, although I don\u0027t think it matters if the process is branded."},{"file":"usr/src/uts/common/brand/lx/os/lx_acct.c","line":167,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Aren\u0027t these available via p-\u003ep_ru?"},{"file":"usr/src/uts/common/brand/lx/os/lx_acct.c","line":167,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Yes, completely overlooked those. Fixed."},{"file":"usr/src/uts/common/brand/lx/os/lx_acct.c","line":173,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Does Linux enforce the same limit? (on all bit-ness?)"},{"file":"usr/src/uts/common/brand/lx/os/lx_acct.c","line":173,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"It doesn\u0027t seem to do that. Since that was mostly to accomodate our legacy native accounting utilities, I have just removed that limit."},{"file":"usr/src/uts/common/os/acct.c","line":415,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"I would suggest adding a comment here about how the \"legacy\" code masked the rv to only the low bits, but the additional data was desired for branded cases."},{"file":"usr/src/uts/common/os/acct.c","line":415,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/brand/lx/os/lx_acct.c","type":"ADDED","insertions":182,"deletions":0},{"file":"usr/src/uts/common/brand/lx/os/lx_brand.c","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/brand/lx/os/lx_syscall.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/common/brand/lx/sys/lx_brand.h","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/common/brand/lx/sys/lx_syscalls.h","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/common/brand/lx/syscall/lx_miscsys.c","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"usr/src/uts/common/brand/sn1/sn1_brand.c","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/brand/solaris10/s10_brand.c","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/os/acct.c","type":"MODIFIED","insertions":12,"deletions":-1},{"file":"usr/src/uts/common/os/exit.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/common/sys/acct.h","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/sys/brand.h","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/uts/intel/Makefile.files","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/intel/lx_brand/Makefile","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":221,"sizeDeletions":-11},{"number":"2","revision":"bfbfed393ff74839ed0ebf51648c9f3356f59b50","parents":["5ad7f810d0a72624056299b85500cdd7a9e5a916"],"ref":"refs/changes/74/2174/2","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1498777183,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/uts/common/brand/lx/os/lx_acct.c","line":142,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Maybe use #defined values here rather than a magic number."},{"file":"usr/src/uts/common/brand/lx/os/lx_acct.c","line":142,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"done"},{"file":"usr/src/uts/common/brand/lx/os/lx_acct.c","line":192,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"While I know the corresponding native code is using kcred for this, but is this perhaps an area where we should explore using the zone cred?"},{"file":"usr/src/uts/common/brand/lx/os/lx_acct.c","line":192,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"I\u0027m not sure why we would want to diverge from the native zone accounting for this. Are you proposing a separate ticket to change this behavior in general?"},{"file":"usr/src/uts/common/os/acct.c","line":418,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Perhaps a little clearer as \"Zones not using the brand hook will mask the status here.\""},{"file":"usr/src/uts/common/os/acct.c","line":418,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/brand/lx/os/lx_acct.c","type":"ADDED","insertions":198,"deletions":0},{"file":"usr/src/uts/common/brand/lx/os/lx_brand.c","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/brand/lx/os/lx_syscall.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/common/brand/lx/sys/lx_brand.h","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/common/brand/lx/sys/lx_syscalls.h","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/common/brand/lx/syscall/lx_miscsys.c","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"usr/src/uts/common/brand/sn1/sn1_brand.c","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/brand/solaris10/s10_brand.c","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/os/acct.c","type":"MODIFIED","insertions":17,"deletions":-1},{"file":"usr/src/uts/common/os/exit.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/common/sys/acct.h","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/sys/brand.h","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/uts/intel/Makefile.files","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/intel/lx_brand/Makefile","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":242,"sizeDeletions":-11},{"number":"3","revision":"8ef43c8d579fd334260d5de939c38cd7686e0a31","parents":["5ad7f810d0a72624056299b85500cdd7a9e5a916"],"ref":"refs/changes/74/2174/3","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1498842980,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1499276838,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1499700476,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/brand/lx/os/lx_acct.c","type":"ADDED","insertions":198,"deletions":0},{"file":"usr/src/uts/common/brand/lx/os/lx_brand.c","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/brand/lx/os/lx_syscall.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/common/brand/lx/sys/lx_brand.h","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/common/brand/lx/sys/lx_syscalls.h","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/common/brand/lx/syscall/lx_miscsys.c","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"usr/src/uts/common/brand/sn1/sn1_brand.c","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/brand/solaris10/s10_brand.c","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/os/acct.c","type":"MODIFIED","insertions":18,"deletions":-1},{"file":"usr/src/uts/common/os/exit.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/common/sys/acct.h","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/sys/brand.h","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/uts/intel/Makefile.files","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/intel/lx_brand/Makefile","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":243,"sizeDeletions":-11},{"number":"4","revision":"2310d8b53551fada41368de96dd167c5205995e0","parents":["31c0e5542fa9f26f6f2b4b2599e03e15050d2bac"],"ref":"refs/changes/74/2174/4","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1499701780,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1499276838,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1499700476,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/brand/lx/os/lx_acct.c","type":"ADDED","insertions":198,"deletions":0},{"file":"usr/src/uts/common/brand/lx/os/lx_brand.c","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/brand/lx/os/lx_syscall.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/common/brand/lx/sys/lx_brand.h","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/common/brand/lx/sys/lx_syscalls.h","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/common/brand/lx/syscall/lx_miscsys.c","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"usr/src/uts/common/brand/sn1/sn1_brand.c","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/brand/solaris10/s10_brand.c","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/os/acct.c","type":"MODIFIED","insertions":18,"deletions":-1},{"file":"usr/src/uts/common/os/exit.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/common/sys/acct.h","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/sys/brand.h","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/uts/intel/Makefile.files","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/intel/lx_brand/Makefile","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":243,"sizeDeletions":-11},{"number":"5","revision":"6209c5b690ff2076dfe5accf04990958f9409d6c","parents":["31c0e5542fa9f26f6f2b4b2599e03e15050d2bac"],"ref":"refs/changes/74/2174/5","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1499701835,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"SUBM","value":"1","grantedOn":1499701846,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1499276838,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1499700476,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/uts/common/brand/lx/os/lx_acct.c","type":"ADDED","insertions":198,"deletions":0},{"file":"usr/src/uts/common/brand/lx/os/lx_brand.c","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/brand/lx/os/lx_syscall.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/common/brand/lx/sys/lx_brand.h","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/common/brand/lx/sys/lx_syscalls.h","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/common/brand/lx/syscall/lx_miscsys.c","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"usr/src/uts/common/brand/sn1/sn1_brand.c","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/brand/solaris10/s10_brand.c","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/os/acct.c","type":"MODIFIED","insertions":18,"deletions":-1},{"file":"usr/src/uts/common/os/exit.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/common/sys/acct.h","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/sys/brand.h","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/uts/intel/Makefile.files","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/intel/lx_brand/Makefile","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":243,"sizeDeletions":-11}],"allReviewers":[{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}]}