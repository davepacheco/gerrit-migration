From 011248164efa634570d04e4f8d6ac5e12eb6b48e Mon Sep 17 00:00:00 2001
From: Todd Whiteman <todd.whiteman@joyent.com>
Date: Tue, 13 Feb 2018 15:40:57 -0800
Subject: [PATCH] TRITON-134 imgapi docker push allows insecure docker pushes

---
 CHANGES.md    | 4 ++++
 lib/docker.js | 3 +--
 package.json  | 2 +-
 3 files changed, 6 insertions(+), 3 deletions(-)

diff --git a/CHANGES.md b/CHANGES.md
index 27c5044..171c5d9 100644
--- a/CHANGES.md
+++ b/CHANGES.md
@@ -1,5 +1,9 @@
 # IMGAPI changelog
 
+## 4.1.1
+
+- TRITON-134 imgapi docker push allows insecure docker pushes
+
 ## 4.1.0
 
 - DOCKER-524: Implement docker push. This adds a new AdminPushDockerImage
diff --git a/lib/docker.js b/lib/docker.js
index 0154859..5c7f82a 100644
--- a/lib/docker.js
+++ b/lib/docker.js
@@ -1661,8 +1661,7 @@ function adminPushDockerImage(opts, callback) {
         rat: rat,
         regClient: null,
         regClientOpts: utils.commonHttpClientOpts({
-            //insecure: app.config.dockerRegistryInsecure,
-            insecure: true,
+            insecure: app.config.dockerRegistryInsecure,
             log: log,
             repo: rat,
             username: username,
diff --git a/package.json b/package.json
index 6ed81fe..0ef299f 100644
--- a/package.json
+++ b/package.json
@@ -1,7 +1,7 @@
 {
   "name": "imgapi",
   "description": "Image API to manage images for SDC 7",
-  "version": "4.1.0",
+  "version": "4.1.1",
   "author": "Joyent (joyent.com)",
   "private": true,
   "dependencies": {
-- 
2.21.0

