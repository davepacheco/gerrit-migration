{"project":"joyent/sdcadm","branch":"master","id":"If2bf9bb71062b09fcbf05034c1ef768358696cbc","number":"3893","subject":"TRITON-351 \"sdcadm self-update\" dumps core Reviewed by: Trent Mick \u003ctrentm@gmail.com\u003e Approved by: Trent Mick \u003ctrentm@gmail.com\u003e","owner":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"url":"https://cr.joyent.us/3893","commitMessage":"TRITON-351 \"sdcadm self-update\" dumps core\nReviewed by: Trent Mick \u003ctrentm@gmail.com\u003e\nApproved by: Trent Mick \u003ctrentm@gmail.com\u003e\n","createdOn":1525273946,"lastUpdated":1525283282,"open":false,"status":"MERGED","comments":[{"timestamp":1525273946,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 1."},{"timestamp":1525273983,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1525273987,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 1:\n\nBefore/after the little fix:\n\n[root@headnode (coal) ~]# sdcadm self-update\nsdcadm: error: options.image (string) is required\nUncaught Error: Cannot stop a CueBallAgent that has already stopped\n\nFROM\nCueBallHttpAgent.CueBallAgent.stop (/opt/smartdc/sdcadm/node_modules/cueball/lib/agent.js:213:3)\nSdcAdm.fini (/opt/smartdc/sdcadm/lib/sdcadm.js:440:27)\nCLI.fini (/opt/smartdc/sdcadm/lib/cli/index.js:204:21)\nfiniAndCb (/opt/smartdc/sdcadm/node_modules/cmdln/lib/cmdln.js:662:14)\n/opt/smartdc/sdcadm/node_modules/cmdln/lib/cmdln.js:709:25\nnextTickCallbackWith0Args (node.js:489:9)\nprocess._tickCallback (node.js:418:13)\n/opt/smartdc/bin/sdcadm: line 18: 17179 Illegal Instruction     (core dumped) /opt/smartdc/sdcadm/node/bin/node --abort_on_uncaught_exception /opt/smartdc/sdcadm/lib/cli/index.js \"$@\"\n[root@headnode (coal) ~]# sdcadm self-update\nsdcadm: error: options.image (string) is required\nsdcadm self-update: error (Usage): Please provide an image UUID or use `sdcadm self-update --latest`\nin order to update to the latest available image."},{"timestamp":1525279923,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 2."},{"timestamp":1525279959,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1525281766,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 3."},{"timestamp":1525281801,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1525282941,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 3: Code-Review+1 Integration-Approval+1"},{"timestamp":1525283265,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 4: Commit message was updated."},{"timestamp":1525283282,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Pedro Palazón Candel"}],"currentPatchSet":{"number":"4","revision":"f2bf9bb71062b09fcbf05034c1ef768358696cbc","parents":["d6fa013c245ceb9c11155238f76705205097a704"],"ref":"refs/changes/93/3893/4","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1525283265,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1525281801,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1525282941,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1525282941,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1525283282,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/cli/do_self_update.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/default-fabric.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/platform.js","type":"MODIFIED","insertions":2,"deletions":0}],"sizeInsertions":6,"sizeDeletions":-1},"patchSets":[{"number":"1","revision":"73f60c0617725bcc8b32b7cd0545e53c2f51b38e","parents":["d6fa013c245ceb9c11155238f76705205097a704"],"ref":"refs/changes/93/3893/1","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1525273946,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1525273983,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/sdcadm.js","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":1,"sizeDeletions":-1},{"number":"2","revision":"4aa4a2f2a65b48f2b83d740e1be21a3db1d59f46","parents":["d6fa013c245ceb9c11155238f76705205097a704"],"ref":"refs/changes/93/3893/2","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1525279923,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1525279959,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/cli/do_self_update.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/default-fabric.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/platform.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/sdcadm.js","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":7,"sizeDeletions":-2},{"number":"3","revision":"2760d783858c5fd76ed9fe91df067ed232989552","parents":["d6fa013c245ceb9c11155238f76705205097a704"],"ref":"refs/changes/93/3893/3","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1525281766,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1525281801,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1525282941,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1525282941,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/cli/do_self_update.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/default-fabric.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/platform.js","type":"MODIFIED","insertions":2,"deletions":0}],"sizeInsertions":6,"sizeDeletions":-1},{"number":"4","revision":"f2bf9bb71062b09fcbf05034c1ef768358696cbc","parents":["d6fa013c245ceb9c11155238f76705205097a704"],"ref":"refs/changes/93/3893/4","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1525283265,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1525281801,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1525282941,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1525282941,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1525283282,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/cli/do_self_update.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/default-fabric.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/platform.js","type":"MODIFIED","insertions":2,"deletions":0}],"sizeInsertions":6,"sizeDeletions":-1}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}]}