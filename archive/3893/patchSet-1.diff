commit 73f60c0617725bcc8b32b7cd0545e53c2f51b38e (refs/changes/93/3893/1)
Author: Pedro Palazon Candel <pedro@joyent.com>
Date:   2018-05-02T17:12:23+02:00 (1 year, 5 months ago)
    
    TRITON-351 "sdcadm self-update" dumps core

diff --git a/lib/sdcadm.js b/lib/sdcadm.js
index 72729ee..47cee2c 100644
--- a/lib/sdcadm.js
+++ b/lib/sdcadm.js
@@ -436,7 +436,7 @@ SdcAdm.prototype.fini = function fini() {
     if (self.sadm_ur !== null) {
         self.sadm_ur.close();
     }
-    if (self._cueballAgent !== undefined) {
+    if (self._cueballAgent !== undefined && !self._cueballAgent.cba_stopped) {
         self.cueballAgent.stop();
     }
 };
