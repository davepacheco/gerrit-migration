{"project":"joyent/illumos-joyent","branch":"master","id":"Icb12f3ba82f2ce84ae8139e27589e39f842a9fb2","number":"2600","subject":"OS-6259 lxbrand: Want more TCP socket options Reviewed by: Dan McDonald \u003cdanmcd@joyent.com\u003e Approved by: Dan McDonald \u003cdanmcd@joyent.com\u003e","owner":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"url":"https://cr.joyent.us/2600","commitMessage":"OS-6259 lxbrand: Want more TCP socket options\nReviewed by: Dan McDonald \u003cdanmcd@joyent.com\u003e\nApproved by: Dan McDonald \u003cdanmcd@joyent.com\u003e\n","createdOn":1505825710,"lastUpdated":1506951363,"open":false,"status":"MERGED","comments":[{"timestamp":1505825710,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 1."},{"timestamp":1506558606,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 1:\n\n(4 comments)\n\nAt least the MSS-setter may be useful to have in the native zone."},{"timestamp":1506606537,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 1:\n\n(4 comments)\n\nWith respect to your general comment about MSS for the native code, we usually try to separate the lx changes from mainline changes. We can open a separate ticket for that if you think it\u0027s necessary."},{"timestamp":1506607449,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 1:\n\n(2 comments)\n\nFix the one set-but-unused local variable, and I\u0027m good."},{"timestamp":1506608409,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 2."},{"timestamp":1506608508,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1506696058,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 2: Code-Review+1\n\nThanks."},{"timestamp":1506713295,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 2:\n\nI have added a comment to the ticket explaining how I tested this."},{"timestamp":1506950952,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 2: Integration-Approval+1"},{"timestamp":1506951293,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 3: Patch Set 2 was rebased."},{"timestamp":1506951353,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 4: Commit message was updated."},{"timestamp":1506951363,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Jerry Jelinek"}],"currentPatchSet":{"number":"4","revision":"cb12f3ba82f2ce84ae8139e27589e39f842a9fb2","parents":["96c742b7981591b1e07d6d4a1836cf5d9e01c579"],"ref":"refs/changes/00/2600/4","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1506951353,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1506696058,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1506950952,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"SUBM","value":"1","grantedOn":1506951363,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/uts/common/brand/lx/syscall/lx_socket.c","type":"MODIFIED","insertions":136,"deletions":-13}],"sizeInsertions":136,"sizeDeletions":-13},"patchSets":[{"number":"1","revision":"db558adcc4fd0ed989f3cd5e66527e6068f8674d","parents":["766f80363ee325875bdcd79484e9c04427d17aec"],"ref":"refs/changes/00/2600/1","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1505825710,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/uts/common/brand/lx/syscall/lx_socket.c","line":2901,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"I went spelunking for where these might be specified, but they look kinda like Linux-isms."},{"file":"usr/src/uts/common/brand/lx/syscall/lx_socket.c","line":2901,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"There are a few notes in the bug report about some discussion Patrick and I had about these, but to summarize, yes, these are all Linux-isms which various Linux \"tuning guides\" have promoted and which some people thus like to be able to set. Our primary goal is to allow these people to set them, even if they have no effect on our smartos network code."},{"file":"usr/src/uts/common/brand/lx/syscall/lx_socket.c","line":2911,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Looks like it\u0027s there to REDUCE MSS, perhaps as a preventative so PathMTU discovery doesn\u0027t slow things down and cause rexmits.  It\u0027s in FreeBSD as well:\n\nhttp://src.illumos.org/source/xref/freebsd-head/sys/netinet/tcp_usrreq.c#1630"},{"file":"usr/src/uts/common/brand/lx/syscall/lx_socket.c","line":2911,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"I\u0027m not clear if there is something you want me to do here."},{"file":"usr/src/uts/common/brand/lx/syscall/lx_socket.c","line":2911,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Mentioning this more for the record, but per my global comment, the future extension should include proper support for the native-view stack."},{"file":"usr/src/uts/common/brand/lx/syscall/lx_socket.c","line":2911,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Got it. Yes, we would want to fix that in native and just leverage it here."},{"file":"usr/src/uts/common/brand/lx/syscall/lx_socket.c","line":2936,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Why are you bothering with syn_abortconn if you aren\u0027t using it?  Or did you forget to use it below?"},{"file":"usr/src/uts/common/brand/lx/syscall/lx_socket.c","line":2936,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"I copied this from the getter code, but it is unnecessary here. Removed."},{"file":"usr/src/uts/common/brand/lx/syscall/lx_socket.c","line":2949,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Have you figured out the limit like you did for OS-5338?  If it\u0027s small, another table may be helpful."},{"file":"usr/src/uts/common/brand/lx/syscall/lx_socket.c","line":2949,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Since it is a power of two, 32 would be the max for a uint, but it is usually a little less."},{"file":"usr/src/uts/common/brand/lx/syscall/lx_socket.c","line":2949,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Okay.  Same thing about tables applies here:  I see a limited number of inputs, but it\u0027s more about the testing than changing how things are written."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/brand/lx/syscall/lx_socket.c","type":"MODIFIED","insertions":140,"deletions":-13}],"sizeInsertions":140,"sizeDeletions":-13},{"number":"2","revision":"490498238b8e0b29066b9924ed865f9b841ea046","parents":["5ae84a5233b723c890288b775cb5317db2e54d61"],"ref":"refs/changes/00/2600/2","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1506608409,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1506696058,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1506950952,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/brand/lx/syscall/lx_socket.c","type":"MODIFIED","insertions":136,"deletions":-13}],"sizeInsertions":136,"sizeDeletions":-13},{"number":"3","revision":"311a2b9c60d6c70fcc1af5bf7fe6038425831f6c","parents":["96c742b7981591b1e07d6d4a1836cf5d9e01c579"],"ref":"refs/changes/00/2600/3","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1506951293,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1506696058,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1506950952,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/brand/lx/syscall/lx_socket.c","type":"MODIFIED","insertions":136,"deletions":-13}],"sizeInsertions":136,"sizeDeletions":-13},{"number":"4","revision":"cb12f3ba82f2ce84ae8139e27589e39f842a9fb2","parents":["96c742b7981591b1e07d6d4a1836cf5d9e01c579"],"ref":"refs/changes/00/2600/4","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1506951353,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"SUBM","value":"1","grantedOn":1506951363,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1506696058,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1506950952,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/uts/common/brand/lx/syscall/lx_socket.c","type":"MODIFIED","insertions":136,"deletions":-13}],"sizeInsertions":136,"sizeDeletions":-13}],"allReviewers":[{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}]}