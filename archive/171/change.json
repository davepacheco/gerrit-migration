{"project":"joyent/sdc-net-agent","branch":"master","id":"Idfeb9784dcfc3cc1e9507ff5e2960a8fac4fde80","number":"171","subject":"NAPI-327 net-agent should not leak NICs","owner":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"url":"https://cr.joyent.us/171","commitMessage":"NAPI-327 net-agent should not leak NICs\n","createdOn":1469827961,"lastUpdated":1521494302,"open":true,"status":"NEW","comments":[{"timestamp":1469827961,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Uploaded patch set 1."},{"timestamp":1469827989,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1469828677,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Uploaded patch set 2."},{"timestamp":1469828711,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1469829086,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Uploaded patch set 3."},{"timestamp":1469829125,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing-1\n\n(1 comment)\n\n\"make check\" exited with status 2"},{"timestamp":1469829605,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Uploaded patch set 4."},{"timestamp":1469829640,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1469829798,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Uploaded patch set 5."},{"timestamp":1469829828,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1471994351,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Uploaded patch set 6."},{"timestamp":1471994392,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 6: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1472027593,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Patch Set 6:\n\n(56 comments)"},{"timestamp":1473197159,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Patch Set 6:\n\n(56 comments)\n\nTest comment."},{"timestamp":1473209339,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Patch Set 6:\n\n(1 comment)\n\nTest comment 2"},{"timestamp":1473295257,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Uploaded patch set 7."},{"timestamp":1473296300,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 7: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1473465741,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Uploaded patch set 8."},{"timestamp":1473465791,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 8: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1521494037,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 9."},{"timestamp":1521494060,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 9: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1521494277,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 10: Patch Set 9 was rebased."},{"timestamp":1521494302,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 10:\n\n\"make check\" passed ok"}],"currentPatchSet":{"number":"10","revision":"dfeb9784dcfc3cc1e9507ff5e2960a8fac4fde80","parents":["616e56e921fd3bcb9992485314b7edf2cc742c30"],"ref":"refs/changes/71/171/10","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1521494277,"author":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1521494060,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"bin/net-agent.js","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"lib/common.js","type":"ADDED","insertions":42,"deletions":0},{"file":"lib/endpoints/index.js","type":"ADDED","insertions":24,"deletions":0},{"file":"lib/endpoints/status.js","type":"ADDED","insertions":44,"deletions":0},{"file":"lib/napi-client.js","type":"MODIFIED","insertions":17,"deletions":0},{"file":"lib/net-agent.js","type":"MODIFIED","insertions":267,"deletions":-17},{"file":"package.json","type":"MODIFIED","insertions":4,"deletions":0},{"file":"tests/config.json","type":"ADDED","insertions":8,"deletions":0},{"file":"tests/runtest","type":"ADDED","insertions":35,"deletions":0},{"file":"tests/unit/test.js","type":"ADDED","insertions":471,"deletions":0}],"sizeInsertions":921,"sizeDeletions":-18},"patchSets":[{"number":"1","revision":"e6b644d735bbccf27714a377828f0706cdf68501","parents":["35b150468e865d040ba110712fbd952d778063a5"],"ref":"refs/changes/71/171/1","uploader":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"createdOn":1469827961,"author":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1469827989,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/endpoints/index.js","type":"ADDED","insertions":14,"deletions":0},{"file":"lib/endpoints/status.js","type":"ADDED","insertions":46,"deletions":0},{"file":"lib/napi-client.js","type":"MODIFIED","insertions":11,"deletions":-2},{"file":"lib/net-agent.js","type":"MODIFIED","insertions":267,"deletions":-23},{"file":"lib/vm.js","type":"MODIFIED","insertions":18,"deletions":-51},{"file":"package.json","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"tests/runtest","type":"ADDED","insertions":32,"deletions":0},{"file":"tests/unit/test.js","type":"ADDED","insertions":299,"deletions":0},{"file":"tools/rsync-to","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":695,"sizeDeletions":-80},{"number":"2","revision":"f7a8163b3acf67bb8c163c894ace821abf839f3d","parents":["35b150468e865d040ba110712fbd952d778063a5"],"ref":"refs/changes/71/171/2","uploader":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"createdOn":1469828677,"author":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1469828711,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"bin/net-agent.js","type":"MODIFIED","insertions":0,"deletions":-5},{"file":"lib/common.js","type":"ADDED","insertions":32,"deletions":0},{"file":"lib/endpoints/index.js","type":"ADDED","insertions":24,"deletions":0},{"file":"lib/endpoints/status.js","type":"ADDED","insertions":42,"deletions":0},{"file":"lib/index.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/napi-client.js","type":"MODIFIED","insertions":20,"deletions":-2},{"file":"lib/net-agent.js","type":"MODIFIED","insertions":315,"deletions":-29},{"file":"lib/vm.js","type":"MODIFIED","insertions":58,"deletions":-70},{"file":"package.json","type":"MODIFIED","insertions":8,"deletions":-3},{"file":"tests/runtest","type":"ADDED","insertions":32,"deletions":0},{"file":"tests/unit/test.js","type":"ADDED","insertions":320,"deletions":0},{"file":"tools/rsync-to","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":854,"sizeDeletions":-112},{"number":"3","revision":"26380da1e27db27149f204e2adbe9b017bd9210d","parents":["35b150468e865d040ba110712fbd952d778063a5"],"ref":"refs/changes/71/171/3","uploader":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"createdOn":1469829086,"author":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1469829125,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/net-agent.js","line":195,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"line \u003e 80 characters"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"bin/net-agent.js","type":"MODIFIED","insertions":10,"deletions":-7},{"file":"lib/common.js","type":"ADDED","insertions":33,"deletions":0},{"file":"lib/endpoints/index.js","type":"ADDED","insertions":24,"deletions":0},{"file":"lib/endpoints/status.js","type":"ADDED","insertions":45,"deletions":0},{"file":"lib/index.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/napi-client.js","type":"MODIFIED","insertions":30,"deletions":-7},{"file":"lib/net-agent.js","type":"MODIFIED","insertions":364,"deletions":-47},{"file":"lib/vm.js","type":"MODIFIED","insertions":63,"deletions":-74},{"file":"package.json","type":"MODIFIED","insertions":10,"deletions":-3},{"file":"tests/config.json","type":"ADDED","insertions":8,"deletions":0},{"file":"tests/runtest","type":"ADDED","insertions":32,"deletions":0},{"file":"tests/unit/test.js","type":"ADDED","insertions":364,"deletions":0}],"sizeInsertions":984,"sizeDeletions":-139},{"number":"4","revision":"15cf7c8ed6c13a23ad3433e134024857544abed1","parents":["35b150468e865d040ba110712fbd952d778063a5"],"ref":"refs/changes/71/171/4","uploader":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"createdOn":1469829605,"author":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1469829640,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"bin/net-agent.js","type":"MODIFIED","insertions":10,"deletions":-7},{"file":"lib/common.js","type":"ADDED","insertions":33,"deletions":0},{"file":"lib/endpoints/index.js","type":"ADDED","insertions":24,"deletions":0},{"file":"lib/endpoints/status.js","type":"ADDED","insertions":45,"deletions":0},{"file":"lib/index.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/napi-client.js","type":"MODIFIED","insertions":30,"deletions":-7},{"file":"lib/net-agent.js","type":"MODIFIED","insertions":365,"deletions":-47},{"file":"lib/vm.js","type":"MODIFIED","insertions":63,"deletions":-74},{"file":"package.json","type":"MODIFIED","insertions":10,"deletions":-3},{"file":"tests/config.json","type":"ADDED","insertions":8,"deletions":0},{"file":"tests/runtest","type":"ADDED","insertions":32,"deletions":0},{"file":"tests/unit/test.js","type":"ADDED","insertions":364,"deletions":0}],"sizeInsertions":985,"sizeDeletions":-139},{"number":"5","revision":"17ebf80d1b72f23ae0f7072bbe70b1202b24737f","parents":["35b150468e865d040ba110712fbd952d778063a5"],"ref":"refs/changes/71/171/5","uploader":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"createdOn":1469829798,"author":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1469829828,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"bin/net-agent.js","type":"MODIFIED","insertions":10,"deletions":-7},{"file":"lib/common.js","type":"ADDED","insertions":33,"deletions":0},{"file":"lib/endpoints/index.js","type":"ADDED","insertions":24,"deletions":0},{"file":"lib/endpoints/status.js","type":"ADDED","insertions":45,"deletions":0},{"file":"lib/index.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/napi-client.js","type":"MODIFIED","insertions":29,"deletions":-7},{"file":"lib/net-agent.js","type":"MODIFIED","insertions":363,"deletions":-47},{"file":"lib/vm.js","type":"MODIFIED","insertions":63,"deletions":-74},{"file":"package.json","type":"MODIFIED","insertions":10,"deletions":-3},{"file":"tests/config.json","type":"ADDED","insertions":8,"deletions":0},{"file":"tests/runtest","type":"ADDED","insertions":32,"deletions":0},{"file":"tests/unit/test.js","type":"ADDED","insertions":364,"deletions":0}],"sizeInsertions":982,"sizeDeletions":-139},{"number":"6","revision":"2e84aa531156cbc8e13a6d48b3563f81392fdf97","parents":["35b150468e865d040ba110712fbd952d778063a5"],"ref":"refs/changes/71/171/6","uploader":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"createdOn":1471994351,"author":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1471994392,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"bin/net-agent.js","line":0,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Test Comment"},{"file":"bin/net-agent.js","line":8,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"For consistency with elsewhere, let\u0027s ditch the comma."},{"file":"bin/net-agent.js","line":8,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Done"},{"file":"bin/net-agent.js","line":129,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"You should include the error in the log message; e.g.\n\n    logger.fatal(err2, \u0027Failed to initialise server\u0027);"},{"file":"bin/net-agent.js","line":129,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Done"},{"file":"lib/common.js","line":0,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"This file needs a license and Copyright block."},{"file":"lib/common.js","line":0,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Done"},{"file":"lib/endpoints/status.js","line":21,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"This comment has odd indentation, and should probably be anchored to the getStatus function without a blank line.  Also, lose the double asterisk up the top."},{"file":"lib/endpoints/status.js","line":21,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Done"},{"file":"lib/index.js","line":0,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"It looks like the only change in this file is the Copyright update?  If so, you should cull it from the change."},{"file":"lib/index.js","line":0,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Done"},{"file":"lib/napi-client.js","line":106,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"This code doesn\u0027t appear to be called anywhere."},{"file":"lib/napi-client.js","line":106,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Done"},{"file":"lib/napi-client.js","line":112,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"I don\u0027t understand why this method accepts \"napiClient\" as its first parameter.  Surely it should be using \"this.client\"?"},{"file":"lib/napi-client.js","line":112,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Done"},{"file":"lib/net-agent.js","line":88,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"I don\u0027t think we actually _use_ \"util\" in here?"},{"file":"lib/net-agent.js","line":88,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Done"},{"file":"lib/net-agent.js","line":117,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"\"this.init\" appears to be unused."},{"file":"lib/net-agent.js","line":117,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Done"},{"file":"lib/net-agent.js","line":118,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Perhaps \"this.na_server\"?"},{"file":"lib/net-agent.js","line":118,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Done"},{"file":"lib/net-agent.js","line":165,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"superfluous \"return\""},{"file":"lib/net-agent.js","line":165,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Done"},{"file":"lib/net-agent.js","line":168,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"We should at least have spaces between the braces and the keys/values here.  Probably better still to be consistent with L158-162."},{"file":"lib/net-agent.js","line":168,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Done"},{"file":"lib/net-agent.js","line":174,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"It looks like you\u0027re not calling callback if startup is _successful_?"},{"file":"lib/net-agent.js","line":174,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Done"},{"file":"lib/net-agent.js","line":193,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"I would make this callback declaration part of L191; e.g.\n\n    self.retryUpdate(fn, opts, function onRetry(err2) {\n        ...\n    });"},{"file":"lib/net-agent.js","line":193,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Done"},{"file":"lib/net-agent.js","line":196,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"The operator should go on the end of the continued line, not the front of the next line."},{"file":"lib/net-agent.js","line":196,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Done"},{"file":"lib/net-agent.js","line":212,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"remove blank line here"},{"file":"lib/net-agent.js","line":212,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Done"},{"file":"lib/net-agent.js","line":239,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"I\u0027m not sure that this is the right thing to do for this kind of error.  We may conceivably want a core file in this case, or at least a much more detailed error message.\n\nAlso, it seems like you\u0027re silently dropping any unexpected errors on the floor."},{"file":"lib/net-agent.js","line":239,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"We are not dropping any unexpected errors on the floor, since they are handled implicitly via the backoff+retry (see below: retry.retryIf)."},{"file":"lib/net-agent.js","line":244,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"You\u0027ll need to bind \"reapNics()\" before passing it like this, otherwise \"this\" won\u0027t point to what it does now when it gets called.  You should also be storing this timeout somewhere on the NetAgent object and asserting that we don\u0027t accidentally schedule it twice.\n\nPlease make sure that you actually test that this backoff works with an old NAPI."},{"file":"lib/net-agent.js","line":244,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Done"},{"file":"lib/net-agent.js","line":260,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Perhaps:\n\n    var found \u003d nics.filter(function (nic) {\n        return (vmnic.mac \u003d\u003d\u003d nic.mac);\n    });"},{"file":"lib/net-agent.js","line":260,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Done"},{"file":"lib/net-agent.js","line":271,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"superfluous return."},{"file":"lib/net-agent.js","line":271,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Done"},{"file":"lib/net-agent.js","line":273,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"I would define this callback inline with the updateNics() call, rather than above it; i.e.\n\n    self.napiClient.updateNics(vm, nicsToUpdate, function upnics_cb(err2, res) { ....\n\nAlso, you\u0027re not waiting for this to complete before moving on to the next phase (the leaked NICs bit).  Finally, should we not handle errors and retry here?  It seems like we\u0027re basically logging and then ignoring errors."},{"file":"lib/net-agent.js","line":273,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Done"},{"file":"lib/net-agent.js","line":288,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"This is kicking off an asynchronous operation for each leaked NIC, all at once.  You should probably be using something like \"forEachPipeline()\" in \"vasync\" instead, to limit the concurrency."},{"file":"lib/net-agent.js","line":288,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Done"},{"file":"lib/net-agent.js","line":304,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"You should presumably be logging (and/or otherwise handling) this error?"},{"file":"lib/net-agent.js","line":304,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Done"},{"file":"lib/net-agent.js","line":309,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Spaces between braces and contents, please."},{"file":"lib/net-agent.js","line":309,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Done"},{"file":"lib/net-agent.js","line":314,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"What is the maximum backoff time for this strategy?"},{"file":"lib/net-agent.js","line":314,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Done"},{"file":"lib/net-agent.js","line":395,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Weird indentation?"},{"file":"lib/net-agent.js","line":395,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Done"},{"file":"lib/net-agent.js","line":405,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"You should store this timeout on the NetAgent object somewhere, and probably assert that we\u0027re not scheduling it a second time by accident."},{"file":"lib/net-agent.js","line":405,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Done"},{"file":"lib/net-agent.js","line":556,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Why are we unconditionally creating the queue now?  Won\u0027t that overwrite an existing queue for this UUID?"},{"file":"lib/net-agent.js","line":556,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Done"},{"file":"lib/net-agent.js","line":681,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"We should probably try and keep the purely reformatting changes to a minimum.  This one doesn\u0027t materially affect the diff, and should be reverted -- if we\u0027re going to do cosmetic cleanup, let\u0027s do it in a separate change."},{"file":"lib/net-agent.js","line":681,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Done"},{"file":"lib/net-agent.js","line":707,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Spaces between braces and contents, please."},{"file":"lib/net-agent.js","line":707,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Done"},{"file":"lib/net-agent.js","line":736,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"How often are we logging this at INFO level?  How big is the full query result?"},{"file":"lib/net-agent.js","line":736,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"So, we are calling this from sendSample which is retried and backs off exponentially. This function, updateSample, is also called as part of a backoff. So we have 2 nested backoffs. To answer your question, the inner backoff calls updateSample every 200ms to 2s. And the outer backoff calls sendSample every 2s to 64s. sendSample only calls updateSample if nothing is cached. At any rate this is done to detect if any NIC has changed locally and to push these changes into NAPI. We do it this way because zoneevent can\u0027t detect some changes like adding a NIC to the VM object via `vmadm`. I am ambivalent about this functionality. In some situations it serves a useful function, but in others it can be harmful. For example what if we have 2 operators adding 2 NICs with the same IP to 2 VMs on 2 CNs at the same time? We have a race condition. But this doesn\u0027t have to be the result of an explicit operator action. It can be the result of some kind of fault. Or some malicious action. Or some hand-rolled script. Either way, I am not sure if this feature\u0027s potential usefulness outweighs the potential harmfulness (namely the race condition and the confusing flow of control). Someone with operational experience should probably weigh in on this."},{"file":"lib/vm.js","line":208,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"The log message here should probably reflect that it\u0027s \"stderr\" output; e.g.\n\n    log.error(\u0027zone event stderr: \u0027, ..."},{"file":"lib/vm.js","line":208,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Done"},{"file":"lib/vm.js","line":211,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Remove dead code like this."},{"file":"lib/vm.js","line":211,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Done"},{"file":"lib/vm.js","line":219,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"You\u0027re setting \"watcher\" to null, but where does \"this.zoneeventWatcher\" get cleared?  Doesn\u0027t this mean that if the watcher exits, we\u0027ll never start another one?"},{"file":"lib/vm.js","line":219,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Done"},{"file":"lib/vm.js","line":352,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"I think this is a bit questionable.  Where is the exit status that we\u0027re checking actually coming from?  From \"zoneadm\", or \"grep\", or just \"true\"?!\n\nThis should probably use forkexec[1], and should do the output processing in Javascript rather than by piping to grep.  Also, it\u0027d be good to include some context in the error message, rather than just raw stderr output.\n\n[1]: https://github.com/joyent/node-forkexec"},{"file":"lib/vm.js","line":352,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Done"},{"file":"package.json","line":13,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Why is nodeunit a dependency?  I don\u0027t see any nodeunit tests."},{"file":"package.json","line":13,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Done"},{"file":"package.json","line":15,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"The \"sdc-clients\" module is published in the NPM registry.  You should use a version range dependency (e.g. \"^9.5.0\").  If there isn\u0027t a published version of the module with the functionality you need, we should make sure that a new release is published."},{"file":"package.json","line":15,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Done"},{"file":"package.json","line":16,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"This should be a HTTPS URL, rather than an SSH URL.  See some combination of RELENG-612, TOOLS-1024, various github issues, etc, for motivation."},{"file":"package.json","line":16,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Done"},{"file":"package.json","line":18,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"This line appears to be indented inconsistently with the rest of the file.  Also, both \"verror\" and \"jsprim\" should use caret range dependencies; e.g. \"^1.6.1\", \"^1.3.0\", etc.  These modules are under our control and generally strictly adhere to semver."},{"file":"package.json","line":18,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Done"},{"file":"tests/config.json","line":0,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"This file should probably be indented in a manner consistent with the rest of the repository?"},{"file":"tests/config.json","line":0,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Done"},{"file":"tests/runtest","line":0,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"I\u0027m a bit confused about this script.  It should probably check to see if the first argument is actually passed, and then run the test with that name _in the $TOP_ directory.  It also includes a NODEUNIT variable, but I thought you were using tape in this repository, not nodeunit?"},{"file":"tests/runtest","line":0,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Done"},{"file":"tests/runtest","line":9,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"For consistency with elsewhere:\n\n    Copyright 2016 Joyent, Inc."},{"file":"tests/runtest","line":9,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Done"},{"file":"tests/unit/test.js","line":68,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"You can just pass \"dcheck\" as a parameter to \"setTimeout\" here."},{"file":"tests/unit/test.js","line":68,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Done"},{"file":"tests/unit/test.js","line":81,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"You don\u0027t seem to actually _set_ \"gone\" anyway.  Should these just be \"cb(false)\", \"cb(true)\", etc?"},{"file":"tests/unit/test.js","line":81,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Done"},{"file":"tests/unit/test.js","line":166,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"You should probably do the length check _before_ dereferencing the array."},{"file":"tests/unit/test.js","line":166,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Done"},{"file":"tests/unit/test.js","line":184,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"You\u0027re doing this in a few places, but I think it would be better to print \"err.stack\".  If you just pass \"err\" to console.log(), you don\u0027t get much useful output:\n\n    \u003e var a \u003d new Error(\u0027blah\u0027); console.log(a);\n    [Error: blah]\n\nIt probably makes sense to allow \"early_exit()\" to optionally accept (and print information about) an Error object."},{"file":"tests/unit/test.js","line":184,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Done"},{"file":"tests/unit/test.js","line":192,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Should this be \"err2\"?"},{"file":"tests/unit/test.js","line":192,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Done"},{"file":"tests/unit/test.js","line":216,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Perhaps instead:\n\n    t.strictEquals(nic.state, \u0027running\u0027, ..."},{"file":"tests/unit/test.js","line":216,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Done"},{"file":"tests/unit/test.js","line":232,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"delete blank line here"},{"file":"tests/unit/test.js","line":232,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Done"},{"file":"tests/unit/test.js","line":325,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"You should use the full service FMRI here."},{"file":"tests/unit/test.js","line":325,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Done"},{"file":"tests/unit/test.js","line":326,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"You should basically always be using \u003d\u003d\u003d for comparisons like this."},{"file":"tests/unit/test.js","line":326,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Done"},{"file":"tests/unit/test.js","line":363,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Is \"nets\" an array of network objects, or an object mapping UUID to network objects?  If it\u0027s an array, you should not use \"for (var x in array)\" to walk the elements; instead, use a regular indexed for loop."},{"file":"tests/unit/test.js","line":363,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Done"},{"file":"tests/unit/test.js","line":377,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"As per feedback I gave you last time:\n\n            I think this \"VMAPI.listVms()\" call should probably specify\n            that you only want _active_ VMs?  I\u0027m not sure that this\n            call won\u0027t return destroyed VMs, or even VMs from an account\n            other than \"admin\"?\n\nI don\u0027t recall getting a response on this one."},{"file":"tests/unit/test.js","line":377,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Yes, we should specify that we only want active VMs. However, I don\u0027t think that napi0 can have any other owner than admin. Nor can we have any VMs with the same alias (the system prevents their creation)."},{"file":"tests/unit/test.js","line":385,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"You should check that \"vms\" has the length you expect, here.  You may also need to filter more specifically?"},{"file":"tests/unit/test.js","line":385,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Done"},{"file":"tests/unit/test.js","line":404,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Is 20 seconds long enough for all cases?  What if the test machine is slow?"},{"file":"tests/unit/test.js","line":404,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"If the test machine is slow, you\u0027re out of luck. We delay our check (nic_gone), until the VM is clearly gone. But if we don\u0027t insert some delay between the nic_gone check and the above WAIT test, we can end up failing that test because the NIC still existed even though, it was about to get reaped. It is unclear if we should keep retrying. Maybe there is an actual bug and the NIC simply was not reaped. Or maybe the machine is slow. A possible way to deal with this is to make the delay (or the number of max retries) configurable. But there is no way to avoid doing some arbitrary delay, unless we can query net-agent\u0027s state, and see that it is in fact about to reap the NIC in question."},{"file":"tests/unit/test.js","line":468,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"What does deleting these objects do, absent a forced garbage collection?  I think you probably need to call some kind of \"close()\" method to make this effective."},{"file":"tests/unit/test.js","line":468,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"The NAPI and VMAPI objects have no close method. They don\u0027t appear to have anything analogous, either. Will dig a bit more later, to make sure."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"bin/net-agent.js","type":"MODIFIED","insertions":10,"deletions":-7},{"file":"lib/common.js","type":"ADDED","insertions":33,"deletions":0},{"file":"lib/endpoints/index.js","type":"ADDED","insertions":24,"deletions":0},{"file":"lib/endpoints/status.js","type":"ADDED","insertions":45,"deletions":0},{"file":"lib/index.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/napi-client.js","type":"MODIFIED","insertions":29,"deletions":-7},{"file":"lib/net-agent.js","type":"MODIFIED","insertions":305,"deletions":-43},{"file":"lib/vm.js","type":"MODIFIED","insertions":63,"deletions":-74},{"file":"package.json","type":"MODIFIED","insertions":10,"deletions":-3},{"file":"tests/config.json","type":"ADDED","insertions":8,"deletions":0},{"file":"tests/runtest","type":"ADDED","insertions":32,"deletions":0},{"file":"tests/unit/test.js","type":"ADDED","insertions":468,"deletions":0}],"sizeInsertions":1028,"sizeDeletions":-135},{"number":"7","revision":"c66da9a3a15e7029aece98db1634f0a597263471","parents":["35b150468e865d040ba110712fbd952d778063a5"],"ref":"refs/changes/71/171/7","uploader":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"createdOn":1473295257,"author":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1473296300,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"bin/net-agent.js","type":"MODIFIED","insertions":10,"deletions":-7},{"file":"lib/common.js","type":"ADDED","insertions":42,"deletions":0},{"file":"lib/endpoints/index.js","type":"ADDED","insertions":24,"deletions":0},{"file":"lib/endpoints/status.js","type":"ADDED","insertions":44,"deletions":0},{"file":"lib/napi-client.js","type":"MODIFIED","insertions":22,"deletions":-7},{"file":"lib/net-agent.js","type":"MODIFIED","insertions":332,"deletions":-39},{"file":"lib/vm.js","type":"MODIFIED","insertions":88,"deletions":-81},{"file":"package.json","type":"MODIFIED","insertions":13,"deletions":-5},{"file":"tests/config.json","type":"ADDED","insertions":8,"deletions":0},{"file":"tests/runtest","type":"ADDED","insertions":35,"deletions":0},{"file":"tests/unit/test.js","type":"ADDED","insertions":471,"deletions":0}],"sizeInsertions":1089,"sizeDeletions":-139},{"number":"8","revision":"0ea4ab301679e2fbccf3408274bd79941ce90141","parents":["35b150468e865d040ba110712fbd952d778063a5"],"ref":"refs/changes/71/171/8","uploader":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"createdOn":1473465741,"author":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1473465791,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"bin/net-agent.js","type":"MODIFIED","insertions":10,"deletions":-7},{"file":"lib/common.js","type":"ADDED","insertions":42,"deletions":0},{"file":"lib/endpoints/index.js","type":"ADDED","insertions":24,"deletions":0},{"file":"lib/endpoints/status.js","type":"ADDED","insertions":44,"deletions":0},{"file":"lib/napi-client.js","type":"MODIFIED","insertions":22,"deletions":-7},{"file":"lib/net-agent.js","type":"MODIFIED","insertions":332,"deletions":-39},{"file":"lib/vm.js","type":"MODIFIED","insertions":88,"deletions":-81},{"file":"package.json","type":"MODIFIED","insertions":14,"deletions":-4},{"file":"tests/config.json","type":"ADDED","insertions":8,"deletions":0},{"file":"tests/runtest","type":"ADDED","insertions":35,"deletions":0},{"file":"tests/unit/test.js","type":"ADDED","insertions":471,"deletions":0}],"sizeInsertions":1090,"sizeDeletions":-138},{"number":"9","revision":"09f196efab9f83482f6d390a386482b24f23350e","parents":["4c0a310860e78aa83f3240fa7bf2980e81778b09"],"ref":"refs/changes/71/171/9","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1521494037,"author":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1521494060,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"bin/net-agent.js","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"lib/common.js","type":"ADDED","insertions":42,"deletions":0},{"file":"lib/endpoints/index.js","type":"ADDED","insertions":24,"deletions":0},{"file":"lib/endpoints/status.js","type":"ADDED","insertions":44,"deletions":0},{"file":"lib/napi-client.js","type":"MODIFIED","insertions":17,"deletions":0},{"file":"lib/net-agent.js","type":"MODIFIED","insertions":267,"deletions":-17},{"file":"package.json","type":"MODIFIED","insertions":4,"deletions":0},{"file":"tests/config.json","type":"ADDED","insertions":8,"deletions":0},{"file":"tests/runtest","type":"ADDED","insertions":35,"deletions":0},{"file":"tests/unit/test.js","type":"ADDED","insertions":471,"deletions":0}],"sizeInsertions":921,"sizeDeletions":-18},{"number":"10","revision":"dfeb9784dcfc3cc1e9507ff5e2960a8fac4fde80","parents":["616e56e921fd3bcb9992485314b7edf2cc742c30"],"ref":"refs/changes/71/171/10","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1521494277,"author":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1521494060,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"bin/net-agent.js","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"lib/common.js","type":"ADDED","insertions":42,"deletions":0},{"file":"lib/endpoints/index.js","type":"ADDED","insertions":24,"deletions":0},{"file":"lib/endpoints/status.js","type":"ADDED","insertions":44,"deletions":0},{"file":"lib/napi-client.js","type":"MODIFIED","insertions":17,"deletions":0},{"file":"lib/net-agent.js","type":"MODIFIED","insertions":267,"deletions":-17},{"file":"package.json","type":"MODIFIED","insertions":4,"deletions":0},{"file":"tests/config.json","type":"ADDED","insertions":8,"deletions":0},{"file":"tests/runtest","type":"ADDED","insertions":35,"deletions":0},{"file":"tests/unit/test.js","type":"ADDED","insertions":471,"deletions":0}],"sizeInsertions":921,"sizeDeletions":-18}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"}]}