From d178c8117c5caf195fed500a582f379dbfc7991e Mon Sep 17 00:00:00 2001
From: Josh Wilsdon <josh@wilsdon.ca>
Date: Mon, 9 Jul 2018 12:33:26 -0700
Subject: [PATCH] TRITON-578 CNS should not continue as though it succeeded in
 the case of getNapiPools failure

---
 CHANGES.md        | 4 ++++
 lib/api-server.js | 3 ++-
 package.json      | 2 +-
 3 files changed, 7 insertions(+), 2 deletions(-)

diff --git a/CHANGES.md b/CHANGES.md
index 78b1241..fc845c8 100644
--- a/CHANGES.md
+++ b/CHANGES.md
@@ -10,6 +10,10 @@
 
 # triton-cns
 
+## 0.1.2
+
+- TRITON-578 CNS should not continue as though it succeeded in the case of getNapiPools failure
+
 ## 0.1.1
 
 - TRITON-519 fix cns service crash when vm does not have an owner_uuid
diff --git a/lib/api-server.js b/lib/api-server.js
index 1619fb6..bc8f6c0 100644
--- a/lib/api-server.js
+++ b/lib/api-server.js
@@ -3,7 +3,7 @@
  * License, v. 2.0. If a copy of the MPL was not distributed with this
  * file, You can obtain one at http://mozilla.org/MPL/2.0/.
  *
- * Copyright (c) 2015, Joyent, Inc.
+ * Copyright (c) 2018, Joyent, Inc.
  */
 
 module.exports = APIServer;
@@ -612,6 +612,7 @@ function postSuffixesForVM_v1(req, res, next) {
 		if (err) {
 			res.send(500, err);
 			next();
+			return;
 		}
 
 		var vm = {};
diff --git a/package.json b/package.json
index 5137946..9921cb7 100644
--- a/package.json
+++ b/package.json
@@ -1,6 +1,6 @@
 {
   "name": "triton-cns",
-  "version": "0.1.1",
+  "version": "0.1.2",
   "description": "Trition container naming service",
   "main": "index.js",
   "scripts": {
-- 
2.21.0

