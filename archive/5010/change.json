{"project":"joyent/illumos-joyent","branch":"master","topic":"TRITON-885","id":"I7c6c8467e3896e00fd70cb263268a1d5bc5ac661","number":"5010","subject":"OS-7334 Track TCP round-trip time in nanoseconds Portions contributed by: Cody Peter Mello \u003ccody.mello@joyent.com\u003e Portions contributed by: Brandon Baker \u003cbbaker@delphix.com\u003e Reviewed by: Jason King \u003cjason.king@joyent.com\u003e Reviewed by: Robert Mustacchi \u003cr","owner":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"url":"https://cr.joyent.us/5010","commitMessage":"OS-7334 Track TCP round-trip time in nanoseconds\nPortions contributed by: Cody Peter Mello \u003ccody.mello@joyent.com\u003e\nPortions contributed by: Brandon Baker \u003cbbaker@delphix.com\u003e\nReviewed by: Jason King \u003cjason.king@joyent.com\u003e\nReviewed by: Robert Mustacchi \u003crm@joyent.com\u003e\nReviewed by: Dan McDonald \u003cdanmcd@joyent.com\u003e\nApproved by: Dan McDonald \u003cdanmcd@joyent.com\u003e\n","createdOn":1540918280,"lastUpdated":1553893013,"open":false,"status":"MERGED","comments":[{"timestamp":1540918280,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 1."},{"timestamp":1540918309,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Topic set to TRITON-885"},{"timestamp":1544038605,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 2: Patch Set 1 was rebased."},{"timestamp":1544038664,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 3."},{"timestamp":1545150603,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1549929412,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 4: Patch Set 3 was rebased."},{"timestamp":1550008044,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 5: Patch Set 4 was rebased."},{"timestamp":1550082151,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 5:\n\n(8 comments)"},{"timestamp":1550800490,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 6: Patch Set 5 was rebased."},{"timestamp":1553624951,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 7."},{"timestamp":1553625362,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 7:\n\n(7 comments)"},{"timestamp":1553637242,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 7: Code-Review+1\n\nThanks for the follow ups and additional comments, it\u0027s greatly appreciated and I feel a bit clearer."},{"timestamp":1553645177,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 8: Patch Set 7 was rebased."},{"timestamp":1553648663,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 8: Code-Review+1"},{"timestamp":1553701299,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 8: Code-Review+1\n\n(1 comment)\n\nJust one question that\u0027s not a showstopper..."},{"timestamp":1553709590,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 8:\n\n(1 comment)"},{"timestamp":1553711457,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 9: Patch Set 8 was rebased"},{"timestamp":1553711497,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 10: Commit message was updated."},{"timestamp":1553725212,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 10: Integration-Approval+1"},{"timestamp":1553725445,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 11: Commit message was updated."},{"timestamp":1553892951,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 12: Patch Set 11 was rebased."},{"timestamp":1553893013,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Cody Peter Mello"}],"currentPatchSet":{"number":"12","revision":"7c6c8467e3896e00fd70cb263268a1d5bc5ac661","parents":["f8e2fffbe197c9ab755a401bb4d86208b99a2c77"],"ref":"refs/changes/10/5010/12","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1553892951,"author":{"name":"Sebastien Roy","email":"seb@delphix.com","username":""},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1553637242,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1553648663,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1553701299,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1553725212,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"SUBM","value":"1","grantedOn":1553893013,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":13,"deletions":0},{"file":"usr/src/uts/common/inet/tcp.h","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"usr/src/uts/common/inet/tcp/tcp.c","type":"MODIFIED","insertions":8,"deletions":-19},{"file":"usr/src/uts/common/inet/tcp/tcp_input.c","type":"MODIFIED","insertions":67,"deletions":-66},{"file":"usr/src/uts/common/inet/tcp/tcp_opt_data.c","type":"MODIFIED","insertions":6,"deletions":-11},{"file":"usr/src/uts/common/inet/tcp/tcp_output.c","type":"MODIFIED","insertions":23,"deletions":-23},{"file":"usr/src/uts/common/inet/tcp/tcp_timers.c","type":"MODIFIED","insertions":16,"deletions":-26},{"file":"usr/src/uts/common/inet/tcp_impl.h","type":"MODIFIED","insertions":57,"deletions":-13},{"file":"usr/src/uts/common/sys/time.h","type":"MODIFIED","insertions":3,"deletions":-3}],"sizeInsertions":184,"sizeDeletions":-165},"patchSets":[{"number":"1","revision":"1df6ceb55972d2701e9bacc0322dc10d31964a6c","parents":["f162d09b7810d47a66f0f4f796b9cc53ea2a8d3e"],"ref":"refs/changes/10/5010/1","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1540918280,"author":{"name":"Brandon Baker","email":"bbaker@delphix.com","username":""},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/inet/tcp.h","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"usr/src/uts/common/inet/tcp/tcp.c","type":"MODIFIED","insertions":7,"deletions":-19},{"file":"usr/src/uts/common/inet/tcp/tcp_input.c","type":"MODIFIED","insertions":69,"deletions":-55},{"file":"usr/src/uts/common/inet/tcp/tcp_opt_data.c","type":"MODIFIED","insertions":5,"deletions":-11},{"file":"usr/src/uts/common/inet/tcp/tcp_output.c","type":"MODIFIED","insertions":26,"deletions":-12},{"file":"usr/src/uts/common/inet/tcp/tcp_timers.c","type":"MODIFIED","insertions":19,"deletions":-12},{"file":"usr/src/uts/common/inet/tcp_impl.h","type":"MODIFIED","insertions":32,"deletions":-12},{"file":"usr/src/uts/common/sys/time.h","type":"MODIFIED","insertions":3,"deletions":-3}],"sizeInsertions":165,"sizeDeletions":-128},{"number":"2","revision":"c66b69f517edb663b0433f280b39df3ccd83b74a","parents":["0423423ccdcaeed96e2ba087d12f12ffdedd8b42"],"ref":"refs/changes/10/5010/2","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1544038605,"author":{"name":"Brandon Baker","email":"bbaker@delphix.com","username":""},"isDraft":false,"kind":"TRIVIAL_REBASE","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/inet/tcp.h","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"usr/src/uts/common/inet/tcp/tcp.c","type":"MODIFIED","insertions":7,"deletions":-19},{"file":"usr/src/uts/common/inet/tcp/tcp_input.c","type":"MODIFIED","insertions":69,"deletions":-55},{"file":"usr/src/uts/common/inet/tcp/tcp_opt_data.c","type":"MODIFIED","insertions":5,"deletions":-11},{"file":"usr/src/uts/common/inet/tcp/tcp_output.c","type":"MODIFIED","insertions":26,"deletions":-12},{"file":"usr/src/uts/common/inet/tcp/tcp_timers.c","type":"MODIFIED","insertions":19,"deletions":-12},{"file":"usr/src/uts/common/inet/tcp_impl.h","type":"MODIFIED","insertions":32,"deletions":-12},{"file":"usr/src/uts/common/sys/time.h","type":"MODIFIED","insertions":3,"deletions":-3}],"sizeInsertions":165,"sizeDeletions":-128},{"number":"3","revision":"174ff228258dd0b1a48a0fe2e50e124a62025cfb","parents":["0423423ccdcaeed96e2ba087d12f12ffdedd8b42"],"ref":"refs/changes/10/5010/3","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1544038664,"author":{"name":"Brandon Baker","email":"bbaker@delphix.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1545150603,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/inet/tcp.h","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"usr/src/uts/common/inet/tcp/tcp.c","type":"MODIFIED","insertions":7,"deletions":-19},{"file":"usr/src/uts/common/inet/tcp/tcp_input.c","type":"MODIFIED","insertions":54,"deletions":-60},{"file":"usr/src/uts/common/inet/tcp/tcp_opt_data.c","type":"MODIFIED","insertions":5,"deletions":-11},{"file":"usr/src/uts/common/inet/tcp/tcp_output.c","type":"MODIFIED","insertions":14,"deletions":-16},{"file":"usr/src/uts/common/inet/tcp/tcp_timers.c","type":"MODIFIED","insertions":16,"deletions":-26},{"file":"usr/src/uts/common/inet/tcp_impl.h","type":"MODIFIED","insertions":32,"deletions":-12},{"file":"usr/src/uts/common/sys/time.h","type":"MODIFIED","insertions":3,"deletions":-3}],"sizeInsertions":135,"sizeDeletions":-151},{"number":"4","revision":"d48591d358ec2f3a000783648ba3cef966ad6122","parents":["79cd94c9b0c2d04291d5ed17b4048ea0f346a4f0"],"ref":"refs/changes/10/5010/4","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1549929412,"author":{"name":"Sebastien Roy","email":"seb@delphix.com","username":""},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1545150603,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/inet/tcp.h","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"usr/src/uts/common/inet/tcp/tcp.c","type":"MODIFIED","insertions":7,"deletions":-19},{"file":"usr/src/uts/common/inet/tcp/tcp_input.c","type":"MODIFIED","insertions":54,"deletions":-60},{"file":"usr/src/uts/common/inet/tcp/tcp_opt_data.c","type":"MODIFIED","insertions":5,"deletions":-11},{"file":"usr/src/uts/common/inet/tcp/tcp_output.c","type":"MODIFIED","insertions":14,"deletions":-16},{"file":"usr/src/uts/common/inet/tcp/tcp_timers.c","type":"MODIFIED","insertions":16,"deletions":-26},{"file":"usr/src/uts/common/inet/tcp_impl.h","type":"MODIFIED","insertions":32,"deletions":-12},{"file":"usr/src/uts/common/sys/time.h","type":"MODIFIED","insertions":3,"deletions":-3}],"sizeInsertions":135,"sizeDeletions":-151},{"number":"5","revision":"c0180db394a7819742d575a2517bfe2545fa3840","parents":["ab64fbca1733e9ad3c1937c5fab0495186af1a45"],"ref":"refs/changes/10/5010/5","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1550008044,"author":{"name":"Sebastien Roy","email":"seb@delphix.com","username":""},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1545150603,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}}],"comments":[{"file":"usr/src/uts/common/inet/tcp/tcp_input.c","line":5241,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I would consider adding a line that translates the 1/8 or other fractions here into the bit shifts."},{"file":"usr/src/uts/common/inet/tcp/tcp_input.c","line":5241,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Done"},{"file":"usr/src/uts/common/inet/tcp/tcp_output.c","line":1197,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Why does this still use the LBOLT_FASTPATH versus a gethrtime() when all the other metrics use a gethrtime()?"},{"file":"usr/src/uts/common/inet/tcp/tcp_output.c","line":1197,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"This uses LBOLT_FASTPATH because it\u0027s comparing to tcp-\u003etcp_last_recv_time, whose value comes from get_ddi_lbolt()."},{"file":"usr/src/uts/common/inet/tcp/tcp_output.c","line":1259,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"In general, is there a reason that the time we\u0027re using for the calculation of RTT is different from what we\u0027re using to source the timestamp counter?"},{"file":"usr/src/uts/common/inet/tcp/tcp_output.c","line":1259,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"I believe that it was done to contain the scope of the change. We could reuse the gethrtime() values for the timestamp option, but we\u0027d want to convert them to milliseconds first. RFC 1323 has this to say about sourcing timestamp values:\n\n\u003e (b)  The timestamp clock must not be \"too fast\".\n\n\u003e Its recycling time must be greater than MSL seconds.\n\u003e Since the clock (timestamp) is 32 bits and the worst-case\n\u003e MSL is 255 seconds, the maximum acceptable clock frequency\n\u003e is one tick every 59 ns.\n\n\u003e However, it is desirable to establish a much longer\n\u003e recycle period, in order to handle outdated timestamps on\n\u003e idle connections (see Section 4.2.3), and to relax the MSL\n\u003e requirement for preventing sequence number wrap-around.\n\u003e With a 1 ms timestamp clock, the 32-bit timestamp will\n\u003e wrap its sign bit in 24.8 days.  Thus, it will reject old\n\u003e duplicates on the same connection if MSL is 24.8 days or\n\u003e less.  This appears to be a very safe figure; an MSL of\n\u003e 24.8 days or longer can probably be assumed by the gateway\n\u003e system without requiring precise MSL enforcement by the\n\u003e TTL value in the IP layer."},{"file":"usr/src/uts/common/inet/tcp/tcp_output.c","line":2067,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Do you understand why we\u0027re no longer leveraging the time from the hrtime_t for the timestamp and why we\u0027re generating a new lbolt?"},{"file":"usr/src/uts/common/inet/tcp/tcp_output.c","line":2067,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"See above. I believe that it was done to contain the scope of the change now that our \"mlbk_t *local_time\" argument is no longer a clock_t, and to avoid converting it to a coarser unit each time we set the header."},{"file":"usr/src/uts/common/inet/tcp_impl.h","line":584,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"In general, I find it relatively unclear how everything we talk about in this comment maps to the equation below. For example, conn_grace_period isn\u0027t mentioned at all. Similarly, the way we use different shiftings of tcp_rtt_sa below isn\u0027t clear. I also don\u0027t see an equivalent of the 4 * sd, which I would have expected to see as 4 * tcp_rtt_sd. Mind clarifying this all a bit?"},{"file":"usr/src/uts/common/inet/tcp_impl.h","line":584,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"I\u0027ve redone this description to hopefully make it much clearer."},{"file":"usr/src/uts/common/inet/tcp_impl.h","line":586,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"of an extreme?"},{"file":"usr/src/uts/common/inet/tcp_impl.h","line":599,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Is this supposed to be the the 1/4 of the size referenced above? It\u0027s not clear to me where the shifted over value by 5 comes from and why that\u0027s getting added to a value in nanoseconds."},{"file":"usr/src/uts/common/inet/tcp_impl.h","line":599,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Yes, this is 1/4 of the SRTT, so it\u0027s shifted an additional two bits more than usual. I\u0027ve updated the comment above to hopefully clarify how we arrive at this calculation.\n\nThat said, after reviewing this code a lot more, I\u0027m no longer convinced we should be adding this to the RTO, and I believe that it\u0027s contributing to an inflated retransmission timeout compared to other operating systems (along with the TCP_SD_MIN). I\u0027m going to file a separate ticket to investigate removing it."},{"file":"usr/src/uts/common/inet/tcp_impl.h","line":611,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"This pragma is no longer needed as we don\u0027t use Studio."},{"file":"usr/src/uts/common/inet/tcp_impl.h","line":611,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"I\u0027ve removed the pragma."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/inet/tcp.h","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"usr/src/uts/common/inet/tcp/tcp.c","type":"MODIFIED","insertions":7,"deletions":-19},{"file":"usr/src/uts/common/inet/tcp/tcp_input.c","type":"MODIFIED","insertions":54,"deletions":-60},{"file":"usr/src/uts/common/inet/tcp/tcp_opt_data.c","type":"MODIFIED","insertions":5,"deletions":-11},{"file":"usr/src/uts/common/inet/tcp/tcp_output.c","type":"MODIFIED","insertions":14,"deletions":-16},{"file":"usr/src/uts/common/inet/tcp/tcp_timers.c","type":"MODIFIED","insertions":16,"deletions":-26},{"file":"usr/src/uts/common/inet/tcp_impl.h","type":"MODIFIED","insertions":32,"deletions":-12},{"file":"usr/src/uts/common/sys/time.h","type":"MODIFIED","insertions":3,"deletions":-3}],"sizeInsertions":135,"sizeDeletions":-151},{"number":"6","revision":"7e6e64b8d6cb9098e02753b0e74e9d119c8a2074","parents":["996f677df45233a6b7ddb84ee68cd46bcf036fe6"],"ref":"refs/changes/10/5010/6","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1550800490,"author":{"name":"Sebastien Roy","email":"seb@delphix.com","username":""},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1545150603,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/inet/tcp.h","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"usr/src/uts/common/inet/tcp/tcp.c","type":"MODIFIED","insertions":7,"deletions":-19},{"file":"usr/src/uts/common/inet/tcp/tcp_input.c","type":"MODIFIED","insertions":54,"deletions":-60},{"file":"usr/src/uts/common/inet/tcp/tcp_opt_data.c","type":"MODIFIED","insertions":5,"deletions":-11},{"file":"usr/src/uts/common/inet/tcp/tcp_output.c","type":"MODIFIED","insertions":14,"deletions":-16},{"file":"usr/src/uts/common/inet/tcp/tcp_timers.c","type":"MODIFIED","insertions":16,"deletions":-26},{"file":"usr/src/uts/common/inet/tcp_impl.h","type":"MODIFIED","insertions":32,"deletions":-12},{"file":"usr/src/uts/common/sys/time.h","type":"MODIFIED","insertions":3,"deletions":-3}],"sizeInsertions":135,"sizeDeletions":-151},{"number":"7","revision":"489b9659c01af3a02b665b2fe8fd866b2fc28166","parents":["996f677df45233a6b7ddb84ee68cd46bcf036fe6"],"ref":"refs/changes/10/5010/7","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1553624951,"author":{"name":"Sebastien Roy","email":"seb@delphix.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1553637242,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/inet/tcp.h","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"usr/src/uts/common/inet/tcp/tcp.c","type":"MODIFIED","insertions":8,"deletions":-19},{"file":"usr/src/uts/common/inet/tcp/tcp_input.c","type":"MODIFIED","insertions":67,"deletions":-66},{"file":"usr/src/uts/common/inet/tcp/tcp_opt_data.c","type":"MODIFIED","insertions":6,"deletions":-11},{"file":"usr/src/uts/common/inet/tcp/tcp_output.c","type":"MODIFIED","insertions":23,"deletions":-23},{"file":"usr/src/uts/common/inet/tcp/tcp_timers.c","type":"MODIFIED","insertions":16,"deletions":-26},{"file":"usr/src/uts/common/inet/tcp_impl.h","type":"MODIFIED","insertions":57,"deletions":-13},{"file":"usr/src/uts/common/sys/time.h","type":"MODIFIED","insertions":3,"deletions":-3}],"sizeInsertions":184,"sizeDeletions":-165},{"number":"8","revision":"c0a0fa88978e7e2611d235fa31be5b898c7c7d27","parents":["f7d20445a806f04686b89d40664554045c9322ba"],"ref":"refs/changes/10/5010/8","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1553645177,"author":{"name":"Sebastien Roy","email":"seb@delphix.com","username":""},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1553637242,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1553648663,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1553701299,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}}],"comments":[{"file":"usr/src/uts/common/inet/tcp/tcp_output.c","line":1316,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Any reason to drop the LBOLT_FASTPATH resample here?  I have guesses, but I\u0027m curious if you have a definitive answer here or not.  (NOT A SHOWSTOPPER.)"},{"file":"usr/src/uts/common/inet/tcp/tcp_output.c","line":1316,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"So, I can\u0027t be sure that this is the definitive answer, but I believe that it\u0027s because it was previously important to use an lbolt as close as possible to actually sending the packet, so that when we get an ACK we could use the echo reply timestamp to calculate the RTT. Now that that code is gone, we just need a steadily incrementing value, and it doesn\u0027t have to be picked as late as possible."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/inet/tcp.h","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"usr/src/uts/common/inet/tcp/tcp.c","type":"MODIFIED","insertions":8,"deletions":-19},{"file":"usr/src/uts/common/inet/tcp/tcp_input.c","type":"MODIFIED","insertions":67,"deletions":-66},{"file":"usr/src/uts/common/inet/tcp/tcp_opt_data.c","type":"MODIFIED","insertions":6,"deletions":-11},{"file":"usr/src/uts/common/inet/tcp/tcp_output.c","type":"MODIFIED","insertions":23,"deletions":-23},{"file":"usr/src/uts/common/inet/tcp/tcp_timers.c","type":"MODIFIED","insertions":16,"deletions":-26},{"file":"usr/src/uts/common/inet/tcp_impl.h","type":"MODIFIED","insertions":57,"deletions":-13},{"file":"usr/src/uts/common/sys/time.h","type":"MODIFIED","insertions":3,"deletions":-3}],"sizeInsertions":184,"sizeDeletions":-165},{"number":"9","revision":"1d62fee3f6827a0221a854f13ee1e0994206856b","parents":["a91347bc1ab722a6c775831e26be9785738c4ead"],"ref":"refs/changes/10/5010/9","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1553711457,"author":{"name":"Sebastien Roy","email":"seb@delphix.com","username":""},"isDraft":false,"kind":"NO_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1553637242,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1553648663,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1553701299,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/inet/tcp.h","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"usr/src/uts/common/inet/tcp/tcp.c","type":"MODIFIED","insertions":8,"deletions":-19},{"file":"usr/src/uts/common/inet/tcp/tcp_input.c","type":"MODIFIED","insertions":67,"deletions":-66},{"file":"usr/src/uts/common/inet/tcp/tcp_opt_data.c","type":"MODIFIED","insertions":6,"deletions":-11},{"file":"usr/src/uts/common/inet/tcp/tcp_output.c","type":"MODIFIED","insertions":23,"deletions":-23},{"file":"usr/src/uts/common/inet/tcp/tcp_timers.c","type":"MODIFIED","insertions":16,"deletions":-26},{"file":"usr/src/uts/common/inet/tcp_impl.h","type":"MODIFIED","insertions":57,"deletions":-13},{"file":"usr/src/uts/common/sys/time.h","type":"MODIFIED","insertions":3,"deletions":-3}],"sizeInsertions":184,"sizeDeletions":-165},{"number":"10","revision":"38014f7b3ec3219d18e000251dfa794f5572d4d4","parents":["a91347bc1ab722a6c775831e26be9785738c4ead"],"ref":"refs/changes/10/5010/10","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1553711497,"author":{"name":"Sebastien Roy","email":"seb@delphix.com","username":""},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1553637242,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1553648663,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1553701299,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1553725212,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":12,"deletions":0},{"file":"usr/src/uts/common/inet/tcp.h","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"usr/src/uts/common/inet/tcp/tcp.c","type":"MODIFIED","insertions":8,"deletions":-19},{"file":"usr/src/uts/common/inet/tcp/tcp_input.c","type":"MODIFIED","insertions":67,"deletions":-66},{"file":"usr/src/uts/common/inet/tcp/tcp_opt_data.c","type":"MODIFIED","insertions":6,"deletions":-11},{"file":"usr/src/uts/common/inet/tcp/tcp_output.c","type":"MODIFIED","insertions":23,"deletions":-23},{"file":"usr/src/uts/common/inet/tcp/tcp_timers.c","type":"MODIFIED","insertions":16,"deletions":-26},{"file":"usr/src/uts/common/inet/tcp_impl.h","type":"MODIFIED","insertions":57,"deletions":-13},{"file":"usr/src/uts/common/sys/time.h","type":"MODIFIED","insertions":3,"deletions":-3}],"sizeInsertions":184,"sizeDeletions":-165},{"number":"11","revision":"0cff749d845ce8066d65b83783bc7e00481a0f7a","parents":["a91347bc1ab722a6c775831e26be9785738c4ead"],"ref":"refs/changes/10/5010/11","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1553725445,"author":{"name":"Sebastien Roy","email":"seb@delphix.com","username":""},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1553637242,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1553648663,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1553701299,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1553725212,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":13,"deletions":0},{"file":"usr/src/uts/common/inet/tcp.h","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"usr/src/uts/common/inet/tcp/tcp.c","type":"MODIFIED","insertions":8,"deletions":-19},{"file":"usr/src/uts/common/inet/tcp/tcp_input.c","type":"MODIFIED","insertions":67,"deletions":-66},{"file":"usr/src/uts/common/inet/tcp/tcp_opt_data.c","type":"MODIFIED","insertions":6,"deletions":-11},{"file":"usr/src/uts/common/inet/tcp/tcp_output.c","type":"MODIFIED","insertions":23,"deletions":-23},{"file":"usr/src/uts/common/inet/tcp/tcp_timers.c","type":"MODIFIED","insertions":16,"deletions":-26},{"file":"usr/src/uts/common/inet/tcp_impl.h","type":"MODIFIED","insertions":57,"deletions":-13},{"file":"usr/src/uts/common/sys/time.h","type":"MODIFIED","insertions":3,"deletions":-3}],"sizeInsertions":184,"sizeDeletions":-165},{"number":"12","revision":"7c6c8467e3896e00fd70cb263268a1d5bc5ac661","parents":["f8e2fffbe197c9ab755a401bb4d86208b99a2c77"],"ref":"refs/changes/10/5010/12","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1553892951,"author":{"name":"Sebastien Roy","email":"seb@delphix.com","username":""},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1553637242,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"SUBM","value":"1","grantedOn":1553893013,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1553648663,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1553701299,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1553725212,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":13,"deletions":0},{"file":"usr/src/uts/common/inet/tcp.h","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"usr/src/uts/common/inet/tcp/tcp.c","type":"MODIFIED","insertions":8,"deletions":-19},{"file":"usr/src/uts/common/inet/tcp/tcp_input.c","type":"MODIFIED","insertions":67,"deletions":-66},{"file":"usr/src/uts/common/inet/tcp/tcp_opt_data.c","type":"MODIFIED","insertions":6,"deletions":-11},{"file":"usr/src/uts/common/inet/tcp/tcp_output.c","type":"MODIFIED","insertions":23,"deletions":-23},{"file":"usr/src/uts/common/inet/tcp/tcp_timers.c","type":"MODIFIED","insertions":16,"deletions":-26},{"file":"usr/src/uts/common/inet/tcp_impl.h","type":"MODIFIED","insertions":57,"deletions":-13},{"file":"usr/src/uts/common/sys/time.h","type":"MODIFIED","insertions":3,"deletions":-3}],"sizeInsertions":184,"sizeDeletions":-165}],"allReviewers":[{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}]}