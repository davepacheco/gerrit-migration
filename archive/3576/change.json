{"project":"joyent/sdc-cloudapi","branch":"master","id":"I307a3dae2edb5952fd4d5ee48154678a8e2575e5","number":"3576","subject":"TRITON-168 Regex anti-affinity rules fail unexpectedly Reviewed by: Pedro P. Candel \u003cpedro@joyent.com\u003e Approved by: Pedro P. Candel \u003cpedro@joyent.com\u003e","owner":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"url":"https://cr.joyent.us/3576","commitMessage":"TRITON-168 Regex anti-affinity rules fail unexpectedly\nReviewed by: Pedro P. Candel \u003cpedro@joyent.com\u003e\nApproved by: Pedro P. Candel \u003cpedro@joyent.com\u003e\n","createdOn":1520601663,"lastUpdated":1520943673,"open":false,"status":"MERGED","comments":[{"timestamp":1520601663,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Uploaded patch set 1."},{"timestamp":1520601692,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 2: Patch Set 1 was rebased"},{"timestamp":1520601696,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1520601726,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1520614959,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 2: Code-Review+1 Integration-Approval+1\n\nMy understanding is that the problem was that it was taking params.afinity always as an array, even when it was a string. If that\u0027s correct, LGTM; otherwise I\u0027d like to have a better understanding of the issue :-)"},{"timestamp":1520878039,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 2:\n\nAffinity mostly worked fine, except for regular expressions. Regular expressions were failing because server_uuid was needed later in the process.\n\nAllowing a string instead of a single-element array is just an interface perk. Without it an assertion throws, and this seemed the friendliest way to fix that.\n\nSounds reasonable?"},{"timestamp":1520940931,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 2:\n\nSounds definitely reasonable. Go for it! \n\n\u003e Affinity mostly worked fine, except for regular expressions.\n \u003e Regular expressions were failing because server_uuid was needed\n \u003e later in the process.\n \u003e \n \u003e Allowing a string instead of a single-element array is just an\n \u003e interface perk. Without it an assertion throws, and this seemed the\n \u003e friendliest way to fix that.\n \u003e \n \u003e Sounds reasonable?"},{"timestamp":1520943666,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 3: Commit message was updated."},{"timestamp":1520943673,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Marsell Kukuljevic"}],"currentPatchSet":{"number":"3","revision":"e99534d263435e270018451b0def2153e17d7caf","parents":["08f89b020c20fe0b2a5f37fcc2089c2bc7051762"],"ref":"refs/changes/76/3576/3","uploader":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"createdOn":1520943666,"author":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1520601726,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1520614959,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1520614959,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"SUBM","value":"1","grantedOn":1520943673,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/machines.js","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"lib/triton-affinity.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/machines/affinity.js","type":"MODIFIED","insertions":13,"deletions":0}],"sizeInsertions":20,"sizeDeletions":-2},"patchSets":[{"number":"1","revision":"307a3dae2edb5952fd4d5ee48154678a8e2575e5","parents":["be3d217e813682e0be247ee03211e3abb13eb710"],"ref":"refs/changes/76/3576/1","uploader":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"createdOn":1520601663,"author":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1520601696,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/machines.js","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"lib/triton-affinity.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/machines/affinity.js","type":"MODIFIED","insertions":13,"deletions":0}],"sizeInsertions":20,"sizeDeletions":-2},{"number":"2","revision":"d212a630b590e0e77d4860867128e8ca766f3df2","parents":["08f89b020c20fe0b2a5f37fcc2089c2bc7051762"],"ref":"refs/changes/76/3576/2","uploader":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"createdOn":1520601692,"author":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1520601726,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1520614959,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1520614959,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/machines.js","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"lib/triton-affinity.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/machines/affinity.js","type":"MODIFIED","insertions":13,"deletions":0}],"sizeInsertions":20,"sizeDeletions":-2},{"number":"3","revision":"e99534d263435e270018451b0def2153e17d7caf","parents":["08f89b020c20fe0b2a5f37fcc2089c2bc7051762"],"ref":"refs/changes/76/3576/3","uploader":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"createdOn":1520943666,"author":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1520601726,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1520614959,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1520614959,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"SUBM","value":"1","grantedOn":1520943673,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/machines.js","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"lib/triton-affinity.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/machines/affinity.js","type":"MODIFIED","insertions":13,"deletions":0}],"sizeInsertions":20,"sizeDeletions":-2}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}]}