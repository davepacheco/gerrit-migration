{"project":"joyent/node-cueball","branch":"master","id":"I7320f54a7efac8e2936fda744fcd922b6a4f84db","number":"1531","subject":"joyent/node-cueball#95 pool failure logs should be WARN level joyent/node-cueball#79 \"read ECONNRESET\" message on busy socket ought to be a warning joyent/node-cueball#97 log message for \u0027error\u0027 emission while claimed went missing in 2.0 Reviewed by: Davi","owner":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"url":"https://cr.joyent.us/1531","commitMessage":"joyent/node-cueball#95 pool failure logs should be WARN level\njoyent/node-cueball#79 \"read ECONNRESET\" message on busy socket ought to be a warning\njoyent/node-cueball#97 log message for \u0027error\u0027 emission while claimed went missing in 2.0\nReviewed by: David Pacheco \u003cdap@joyent.com\u003e\n","createdOn":1487284883,"lastUpdated":1487885237,"open":false,"status":"MERGED","comments":[{"timestamp":1487284883,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 1."},{"timestamp":1487284947,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1487699010,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 1:\n\n(2 comments)"},{"timestamp":1487728508,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 1:\n\n(2 comments)"},{"timestamp":1487770037,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 1: Code-Review+1\n\nThanks for the explanation."},{"timestamp":1487885233,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 2: Commit message was updated."},{"timestamp":1487885235,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 2: Integration-Approval+1"},{"timestamp":1487885237,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Alex Wilson"}],"currentPatchSet":{"number":"2","revision":"4ee8d9a0be8c52ed46ef32e72d6dfa08350b6da1","parents":["8077b4e4ec4e5d9f3465e8410fcf8c61fa3c8df2"],"ref":"refs/changes/31/1531/2","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1487885233,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1487284947,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1487770037,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1487885235,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"SUBM","value":"1","grantedOn":1487885237,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"lib/connection-fsm.js","type":"MODIFIED","insertions":14,"deletions":-4},{"file":"lib/pool.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/set.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/pool.test.js","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":19,"sizeDeletions":-9},"patchSets":[{"number":"1","revision":"7320f54a7efac8e2936fda744fcd922b6a4f84db","parents":["8077b4e4ec4e5d9f3465e8410fcf8c61fa3c8df2"],"ref":"refs/changes/31/1531/1","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1487284883,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1487770037,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1487284947,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/connection-fsm.js","line":269,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"It would be kind of nice if the sm_lastError, gotoState(\u0027error\u0027), trace log, and counter bump were done in some common function (parametrized by the counter and log message).  It would be easier to convince ourselves we weren\u0027t missing a counter or log message in some cases.  This is not a blocker for me though."},{"file":"lib/connection-fsm.js","line":269,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Fair enough... it is pretty easy to grep for gotoState(\u0027error\u0027) at least to see all the ways we can get into it."},{"file":"lib/connection-fsm.js","line":644,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Why does this go here and not when the connection is established?\n\nDoes ch_connection change over the lifetime of this object?  If so, is it possible that one value for it will have a localPort but a subsequent one won\u0027t?  In that case, would we wind up with a child logger with the old localPort, or is bunyan smart enough to see that \"undefined\" should clear any previous value for this property?"},{"file":"lib/connection-fsm.js","line":644,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"That\u0027s correct, each SocketMgrFSM can have multiple ch_connections over its lifetime. Bunyan does allow the use of \"undefined\" to clear out the property from the child logger (it iterates over Object.keys and copies them across), which I\u0027ve tested to make sure it works here (we log with no localPort when we\u0027re disconnected, and change to the new localPort value when we next connect)"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/connection-fsm.js","type":"MODIFIED","insertions":14,"deletions":-4},{"file":"lib/pool.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/set.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/pool.test.js","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":19,"sizeDeletions":-9},{"number":"2","revision":"4ee8d9a0be8c52ed46ef32e72d6dfa08350b6da1","parents":["8077b4e4ec4e5d9f3465e8410fcf8c61fa3c8df2"],"ref":"refs/changes/31/1531/2","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1487885233,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1487770037,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1487885235,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"SUBM","value":"1","grantedOn":1487885237,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1487284947,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"lib/connection-fsm.js","type":"MODIFIED","insertions":14,"deletions":-4},{"file":"lib/pool.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/set.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/pool.test.js","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":19,"sizeDeletions":-9}],"allReviewers":[{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}]}