{"project":"joyent/illumos-joyent","branch":"master","id":"Ide3321351edce8a235d917a058847faa8bab3eaf","number":"3524","subject":"OS-6714 sdev_plugin_register() attempts to open non-global \"/dev\" Reviewed by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e Approved by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e","owner":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"url":"https://cr.joyent.us/3524","commitMessage":"OS-6714 sdev_plugin_register() attempts to open non-global \"/dev\"\nReviewed by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e\nApproved by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e\n","createdOn":1519942350,"lastUpdated":1520268583,"open":false,"status":"MERGED","comments":[{"timestamp":1519942350,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Uploaded patch set 1."},{"timestamp":1519944093,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 1:\n\n(2 comments)"},{"timestamp":1519944635,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1519944695,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Uploaded patch set 2."},{"timestamp":1519945182,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 2: Code-Review+1\n\nThanks for the clarification on the hold. I don\u0027t know if you think a one-line comment would be helpful here or not, but I am fine either way."},{"timestamp":1519947093,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 3: Patch Set 2 was rebased"},{"timestamp":1520251637,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 4: Patch Set 3 was rebased"},{"timestamp":1520266264,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 4: Code-Review+1 Integration-Approval+1"},{"timestamp":1520268216,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Uploaded patch set 5."},{"timestamp":1520268272,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 6: Patch Set 5 was rebased"},{"timestamp":1520268417,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 6: Code-Review+1 Integration-Approval+1"},{"timestamp":1520268583,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by John Levon"}],"currentPatchSet":{"number":"6","revision":"9ae94401b7adfb12e1a201e981c69fed86f39bdf","parents":["ba46cc6ab9679a2f42c351f5677e46160c3f5976"],"ref":"refs/changes/24/3524/6","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1520268272,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1519945182,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1520268417,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1520268417,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"SUBM","value":"1","grantedOn":1520268583,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/uts/common/fs/dev/sdev_plugin.c","type":"MODIFIED","insertions":18,"deletions":-8}],"sizeInsertions":18,"sizeDeletions":-8},"patchSets":[{"number":"1","revision":"b50a36218f6459c40f4b92dbc03837e6527fba20","parents":["bc6e5c6cabe4cb676770b8f1a31c9917ba55d358"],"ref":"refs/changes/24/3524/1","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1519942350,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/uts/common/fs/dev/sdev_plugin.c","line":610,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"duplicated"},{"file":"usr/src/uts/common/fs/dev/sdev_plugin.c","line":615,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Maybe I\u0027m not following this correctly, but it looks like lookuppnvp only does the VN_RELE(rootvp) if it is not rootdir. Is that correct and if so, are we leaking a hold here?"},{"file":"usr/src/uts/common/fs/dev/sdev_plugin.c","line":615,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"See comment above that func\n\n 209  * Reference counts: vp must be held prior to calling this function.  rootvp\n 210  * should only be held if rootvp !\u003d rootdir.\n\nWe\u0027re passing in rootdir as both rootvp and as vp here. So we need a hold for the latter. Confusing though.\n\nI\u0027ve also confirmed that rootdir-\u003ev_count is at a steady state over load/unload."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/fs/dev/sdev_plugin.c","type":"MODIFIED","insertions":18,"deletions":-8}],"sizeInsertions":18,"sizeDeletions":-8},{"number":"2","revision":"46049d0c64812770b78e1d5fdcb30387da1a4060","parents":["bc6e5c6cabe4cb676770b8f1a31c9917ba55d358"],"ref":"refs/changes/24/3524/2","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1519944695,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1519945182,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/fs/dev/sdev_plugin.c","type":"MODIFIED","insertions":18,"deletions":-8}],"sizeInsertions":18,"sizeDeletions":-8},{"number":"3","revision":"4264e22990de6ccd1f1aafabc7c5dd2186443a49","parents":["17d35cc662a4fc13809703a0ce96563d895743d0"],"ref":"refs/changes/24/3524/3","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1519947093,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1519945182,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/fs/dev/sdev_plugin.c","type":"MODIFIED","insertions":18,"deletions":-8}],"sizeInsertions":18,"sizeDeletions":-8},{"number":"4","revision":"3fd743634b1e759d0240287d301e138984408d04","parents":["b609e2f26f288426b6a10c3d5b99dba4f2c51db3"],"ref":"refs/changes/24/3524/4","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1520251637,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1519945182,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1520266264,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1520266264,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/fs/dev/sdev_plugin.c","type":"MODIFIED","insertions":18,"deletions":-8}],"sizeInsertions":18,"sizeDeletions":-8},{"number":"5","revision":"de3321351edce8a235d917a058847faa8bab3eaf","parents":["bc6e5c6cabe4cb676770b8f1a31c9917ba55d358"],"ref":"refs/changes/24/3524/5","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1520268216,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1519945182,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/uts/common/fs/dev/sdev_plugin.c","type":"MODIFIED","insertions":18,"deletions":-8}],"sizeInsertions":18,"sizeDeletions":-8},{"number":"6","revision":"9ae94401b7adfb12e1a201e981c69fed86f39bdf","parents":["ba46cc6ab9679a2f42c351f5677e46160c3f5976"],"ref":"refs/changes/24/3524/6","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1520268272,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1519945182,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1520268417,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1520268417,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"SUBM","value":"1","grantedOn":1520268583,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/uts/common/fs/dev/sdev_plugin.c","type":"MODIFIED","insertions":18,"deletions":-8}],"sizeInsertions":18,"sizeDeletions":-8}],"allReviewers":[{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}]}