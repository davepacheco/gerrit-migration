{"project":"joyent/illumos-joyent","branch":"master","id":"I99086611bf7b78c5525448f56c91a381693a1b5c","number":"5345","subject":"OS-7443 zpool modify ioctls missing from history log Reviewed by: Kody Kantor \u003ckody.kantor@joyent.com\u003e Approved by: Kody Kantor \u003ckody.kantor@joyent.com\u003e","owner":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"url":"https://cr.joyent.us/5345","commitMessage":"OS-7443 zpool modify ioctls missing from history log\nReviewed by: Kody Kantor \u003ckody.kantor@joyent.com\u003e\nApproved by: Kody Kantor \u003ckody.kantor@joyent.com\u003e\n","createdOn":1547151586,"lastUpdated":1547585656,"open":false,"status":"MERGED","comments":[{"timestamp":1547151586,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 1."},{"timestamp":1547486033,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 1: Code-Review+1\n\n(3 comments)\n\nNice! Looks good!"},{"timestamp":1547486807,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 1:\n\n(3 comments)"},{"timestamp":1547489068,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 2."},{"timestamp":1547566723,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 2: Code-Review+1"},{"timestamp":1547585110,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 2:\n\ntest notes in ticket"},{"timestamp":1547585265,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 2: Integration-Approval+1"},{"timestamp":1547585571,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 3: Patch Set 2 was rebased."},{"timestamp":1547585636,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 4: Commit message was updated."},{"timestamp":1547585656,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Jerry Jelinek"}],"currentPatchSet":{"number":"4","revision":"99086611bf7b78c5525448f56c91a381693a1b5c","parents":["7a34fde236609b18147eb73e6a163e19162d96e2"],"ref":"refs/changes/45/5345/4","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1547585636,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1547566723,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1547585265,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}},{"type":"SUBM","value":"1","grantedOn":1547585656,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/uts/common/fs/zfs/zfs_ioctl.c","type":"MODIFIED","insertions":66,"deletions":-37}],"sizeInsertions":66,"sizeDeletions":-37},"patchSets":[{"number":"1","revision":"20b2ed5bc900c9704c975266021fa80a0855ee82","parents":["79ecd7ba38ef632ce05115bf44172e6157e2f26a"],"ref":"refs/changes/45/5345/1","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1547151586,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1547486033,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}}],"comments":[{"file":"usr/src/uts/common/fs/zfs/zfs_ioctl.c","line":5917,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"It looks like this is the only registration where the zvec_name will be NULL and also zvec_allow_log set to B_TRUE. So does that mean that these operations still won\u0027t be logged?"},{"file":"usr/src/uts/common/fs/zfs/zfs_ioctl.c","line":5917,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Yeah. It looks like I should enhance this function to take a name argument and all of the callers to pass one."},{"file":"usr/src/uts/common/fs/zfs/zfs_ioctl.c","line":6421,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Any particular reason for 128 here? It seems reasonable to me.\n\nZFS_DATASET_MAX_LENGTH is 256, so it\u0027s possible that the message would be truncated if we have really long pool names, right?"},{"file":"usr/src/uts/common/fs/zfs/zfs_ioctl.c","line":6421,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"No on truncation since the code is allocating the buffer in the next line based upon the length of the strings. I just chose 128 to allow more than enough space for the non-string parameter portion of the log string at line 6426."},{"file":"usr/src/uts/common/fs/zfs/zfs_ioctl.c","line":6428,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Will this be present in all of the newly logged legacy cases?"},{"file":"usr/src/uts/common/fs/zfs/zfs_ioctl.c","line":6428,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"zc_guid is just a member of the structure, so the answer is always yes, but the value itself is not meaningful in every case."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/fs/zfs/zfs_ioctl.c","type":"MODIFIED","insertions":52,"deletions":-23}],"sizeInsertions":52,"sizeDeletions":-23},{"number":"2","revision":"20421677ee910d6ff0adc2a2840dca35d256a8b8","parents":["b573326a8abbdb9267b014e71f2ae41fea720655"],"ref":"refs/changes/45/5345/2","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1547489068,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1547566723,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1547585265,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/fs/zfs/zfs_ioctl.c","type":"MODIFIED","insertions":66,"deletions":-37}],"sizeInsertions":66,"sizeDeletions":-37},{"number":"3","revision":"f16e3219cc888d104240a13079a5bbc7b50f978f","parents":["7a34fde236609b18147eb73e6a163e19162d96e2"],"ref":"refs/changes/45/5345/3","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1547585571,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1547566723,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1547585265,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/fs/zfs/zfs_ioctl.c","type":"MODIFIED","insertions":66,"deletions":-37}],"sizeInsertions":66,"sizeDeletions":-37},{"number":"4","revision":"99086611bf7b78c5525448f56c91a381693a1b5c","parents":["7a34fde236609b18147eb73e6a163e19162d96e2"],"ref":"refs/changes/45/5345/4","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1547585636,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"SUBM","value":"1","grantedOn":1547585656,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1547566723,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1547585265,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/uts/common/fs/zfs/zfs_ioctl.c","type":"MODIFIED","insertions":66,"deletions":-37}],"sizeInsertions":66,"sizeDeletions":-37}],"allReviewers":[{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}]}