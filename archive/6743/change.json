{"project":"joyent/sdc-headnode","branch":"master","id":"Ie2391af6214da4549f624fb2c26c939a15d941c1","number":"6743","subject":"TRITON-1876 Sanity check provided dns domain during triton install","owner":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"url":"https://cr.joyent.us/6743","commitMessage":"TRITON-1876 Sanity check provided dns domain during triton install\n","createdOn":1564767481,"lastUpdated":1567705815,"open":true,"status":"NEW","comments":[{"timestamp":1564767481,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 1."},{"timestamp":1564767486,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit a1acbac071827c13bd670a9a21585b5aef5c5544\n    \n    SWSUP-1497 Add some sort of warning for users to sanity check DNS during TRITON install"},{"timestamp":1564767583,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1564803897,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Patch Set 1:\n\n(2 comments)"},{"timestamp":1565615479,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 1:\n\n(8 comments)\n\nShould answers.json.tmpl.external be modified as well?"},{"timestamp":1566397916,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 2: Commit message was updated."},{"timestamp":1566397921,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit 8ca2a89f27f46cd622f090d6d8b3620ceef352ef\n    \n    TRITON-1876 Sanity check provided dns domain during triton install"},{"timestamp":1566403154,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 3."},{"timestamp":1566403160,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 3:\n\nNew commits:\n    \n    commit ac3d992ab6f339b6fd9f23819761fe54ce4a154d\n    \n    TRITON-1876 Sanity check provided dns domain during triton install"},{"timestamp":1566403203,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 3:\n\n(9 comments)\n\n\u003e (8 comments)\n \u003e \n \u003e Should answers.json.tmpl.external be modified as well?\n\nAdded the same change to the file, just in case. All the suggested changes applied."},{"timestamp":1566403243,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 4: Patch Set 3 was rebased."},{"timestamp":1566403247,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 4:\n\nNew commits:\n    \n    commit a6b97c879c50f50caf381ab30b67b31f007c2d08\n    \n    TRITON-1876 Sanity check provided dns domain during triton install"},{"timestamp":1566403254,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1566403345,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1566432606,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Patch Set 4:\n\n(2 comments)"},{"timestamp":1567696571,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 5."},{"timestamp":1567696576,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 5:\n\nNew commits:\n    \n    commit 378c3ee3ad7fdb4c563aa529eb1d18a9c3070b5e\n    \n    TRITON-1876 Sanity check provided dns domain during triton install"},{"timestamp":1567696682,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1567696697,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 4:\n\n(2 comments)\n\n\"more or less\" applied Brian suggestions here :-)"},{"timestamp":1567696734,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 6: Patch Set 5 was rebased."},{"timestamp":1567696739,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 6:\n\nNew commits:\n    \n    commit 9b0f68877a9cae69cc6fcc4418e879831886c2b4\n    \n    TRITON-1876 Sanity check provided dns domain during triton install"},{"timestamp":1567696842,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 6:\n\n\"make check\" passed ok"},{"timestamp":1567705815,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Patch Set 6: Code-Review+1"}],"currentPatchSet":{"number":"6","revision":"e2391af6214da4549f624fb2c26c939a15d941c1","parents":["4751111ab26017aeb0f9f74ef7762087b12331f2"],"ref":"refs/changes/43/6743/6","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1567696734,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1567696682,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1567705815,"by":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"answers.json.tmpl","type":"MODIFIED","insertions":1,"deletions":0},{"file":"answers.json.tmpl.external","type":"MODIFIED","insertions":1,"deletions":0},{"file":"scripts/prompt-config.sh","type":"MODIFIED","insertions":23,"deletions":-3}],"sizeInsertions":25,"sizeDeletions":-3},"patchSets":[{"number":"1","revision":"53b40e18c71a72968abcbc1b7bf1698f0c949069","parents":["82bb5d326e59b02c75a01429776b931246b53a03"],"ref":"refs/changes/43/6743/1","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1564767481,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1564767583,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"/COMMIT_MSG","line":7,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"The ticket should be a TRITON ticket so that it is easier to separate customer/support info from the technical details of the fix.  This makes it easier to make tickets public so the issue is more understandable externally."},{"file":"scripts/prompt-config.sh","line":1171,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"At this point, shouldn\u0027t we explicitly use $dns_domain instead of $val so that it\u0027s more clear?"},{"file":"scripts/prompt-config.sh","line":1171,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"scripts/prompt-config.sh","line":1172,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Is this a debugging statement?  If it is to be kept, maybe:\n\necho \"DNS domain: $domain\""},{"file":"scripts/prompt-config.sh","line":1172,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"{} not needed."},{"file":"scripts/prompt-config.sh","line":1172,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"scripts/prompt-config.sh","line":1172,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"scripts/prompt-config.sh","line":1173,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Maybe dig +short?"},{"file":"scripts/prompt-config.sh","line":1173,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"{} have no effect but double quotes would.  Better as \"@$dns_resolver1\"."},{"file":"scripts/prompt-config.sh","line":1173,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"scripts/prompt-config.sh","line":1173,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"scripts/prompt-config.sh","line":1174,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"4 spaces for continuation lines.  \"$domain\", not ${domain}."},{"file":"scripts/prompt-config.sh","line":1174,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"scripts/prompt-config.sh","line":1175,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"-n instead of ! -z"},{"file":"scripts/prompt-config.sh","line":1175,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"scripts/prompt-config.sh","line":1179,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"-n"},{"file":"scripts/prompt-config.sh","line":1179,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"scripts/prompt-config.sh","line":1180,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Perhaps better as:\n\nfor resolver in \"$dns_resolver1\" \"$dns_resolver2\"; do\n        dig \"@$resolver\" +noall +answer +nocomments +short \\\n            \"$domain\" \u003e/dev/null 2\u003e\u00261 \u0026\u0026 continue\n        warning\u003d\"Provided domain name \u0027$domain\u0027 is resolvable \"\n        warning+\u003d\"by \u0027$resolver\u0027 but should not be resolvable.\"\n        print_warning \"$warning\"\ndone"},{"file":"scripts/prompt-config.sh","line":1180,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"answers.json.tmpl","type":"MODIFIED","insertions":1,"deletions":0},{"file":"scripts/prompt-config.sh","type":"MODIFIED","insertions":21,"deletions":-3}],"sizeInsertions":22,"sizeDeletions":-3},{"number":"2","revision":"a1895165476e67fd5257421065a7193780ca5b12","parents":["82bb5d326e59b02c75a01429776b931246b53a03"],"ref":"refs/changes/43/6743/2","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1566397916,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1564767583,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"answers.json.tmpl","type":"MODIFIED","insertions":1,"deletions":0},{"file":"scripts/prompt-config.sh","type":"MODIFIED","insertions":21,"deletions":-3}],"sizeInsertions":22,"sizeDeletions":-3},{"number":"3","revision":"ff2b2fb455a380dff064ad2cc54aae9d5410b277","parents":["82bb5d326e59b02c75a01429776b931246b53a03"],"ref":"refs/changes/43/6743/3","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1566403154,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1566403254,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"answers.json.tmpl","type":"MODIFIED","insertions":1,"deletions":0},{"file":"answers.json.tmpl.external","type":"MODIFIED","insertions":1,"deletions":0},{"file":"scripts/prompt-config.sh","type":"MODIFIED","insertions":20,"deletions":-3}],"sizeInsertions":22,"sizeDeletions":-3},{"number":"4","revision":"37d57d487d956e74bf332341b3867d173eb90c22","parents":["e94f217eadb2b753901bfd84b0248d967c2a456a"],"ref":"refs/changes/43/6743/4","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1566403243,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1566403345,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"scripts/prompt-config.sh","line":1174,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"+short is going to override all the other options, so +noall +answer +nocomments aren\u0027t going to do anything.\n\nOn the other hand, since we\u0027re throwing away all of the output we don\u0027t really need any of the options here."},{"file":"scripts/prompt-config.sh","line":1174,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done, just kept the +short option."},{"file":"scripts/prompt-config.sh","line":1177,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"I think the message here should be more clear about why this is bad. Something to the effect of \"Triton was configured to use a dns name that already exists in external DNS. This will cause problems.\", and maybe a link to a document explaining the problem and how to fix it."},{"file":"scripts/prompt-config.sh","line":1177,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Modified wording here to make it a little bit more clear. I think that adding a link to a document explaining the problem is a good thing to do ... but we don\u0027t have such a document yet and writing that document right now feels out of the scope of this issue?"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"answers.json.tmpl","type":"MODIFIED","insertions":1,"deletions":0},{"file":"answers.json.tmpl.external","type":"MODIFIED","insertions":1,"deletions":0},{"file":"scripts/prompt-config.sh","type":"MODIFIED","insertions":20,"deletions":-3}],"sizeInsertions":22,"sizeDeletions":-3},{"number":"5","revision":"7c4294f7f4253d93d1afcf1b94218158696a4300","parents":["e94f217eadb2b753901bfd84b0248d967c2a456a"],"ref":"refs/changes/43/6743/5","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1567696571,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1567696682,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"answers.json.tmpl","type":"MODIFIED","insertions":1,"deletions":0},{"file":"answers.json.tmpl.external","type":"MODIFIED","insertions":1,"deletions":0},{"file":"scripts/prompt-config.sh","type":"MODIFIED","insertions":23,"deletions":-3}],"sizeInsertions":25,"sizeDeletions":-3},{"number":"6","revision":"e2391af6214da4549f624fb2c26c939a15d941c1","parents":["4751111ab26017aeb0f9f74ef7762087b12331f2"],"ref":"refs/changes/43/6743/6","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1567696734,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1567696682,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1567705815,"by":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"answers.json.tmpl","type":"MODIFIED","insertions":1,"deletions":0},{"file":"answers.json.tmpl.external","type":"MODIFIED","insertions":1,"deletions":0},{"file":"scripts/prompt-config.sh","type":"MODIFIED","insertions":23,"deletions":-3}],"sizeInsertions":25,"sizeDeletions":-3}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}]}