From c21960992f66b02e223faeee625d8c3d0ef05823 Mon Sep 17 00:00:00 2001
From: Trent Mick <trentm@gmail.com>
Date: Fri, 1 Feb 2019 16:32:44 -0800
Subject: [PATCH] TRITON-1184 add 'make cutarelease' to vm-agent and net-agent
 to facilitate tagging new vers

---
 Makefile | 12 ++++++++++++
 1 file changed, 12 insertions(+)

diff --git a/Makefile b/Makefile
index 00b2941..a591666 100644
--- a/Makefile
+++ b/Makefile
@@ -134,6 +134,18 @@ dumpvar:
 	fi
 	@echo "$(VAR) is '$($(VAR))'"
 
+# Here "cutting a release" is just tagging the current commit with
+# "v(package.json version)". We don't publish this to npm.
+.PHONY: cutarelease
+cutarelease:
+	@echo "# Ensure working copy is clean."
+	[[ -z `git status --short` ]]  # If this fails, the working dir is dirty.
+	@echo "# Ensure have 'json' tool."
+	which json 2>/dev/null 1>/dev/null
+	ver=$(shell cat package.json | json version) && \
+	    git tag "v$$ver" && \
+	    git push origin "v$$ver"
+
 include ./tools/mk/Makefile.deps
 ifeq ($(shell uname -s),SunOS)
 include ./tools/mk/Makefile.node_prebuilt.targ
-- 
2.21.0

