{"project":"joyent/smartos-live","branch":"master","id":"I42b8178e3b9e4d21dd9a94f1a49afec16fa4cb55","number":"6190","subject":"OS-7749 VM.js methods using vminfod event stream should timeout on vminfod events, not on the VM actions","owner":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"url":"https://cr.joyent.us/6190","commitMessage":"OS-7749 VM.js methods using vminfod event stream should timeout on vminfod events, not on the VM actions\n","createdOn":1556839195,"lastUpdated":1556903131,"open":true,"status":"NEW","comments":[{"timestamp":1556839195,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Uploaded patch set 1."},{"timestamp":1556839197,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit 32a47bb59e6e091456d821764555b9d4aeeb8a1d\n    \n    stage 1: VmWatcher working and VM.deleteZone using it; tests pass\n    \n    commit dad8aa961cb82de645fab7183e8117fca4ec883e\n    \n    doc updates; add function names to deleteZone"},{"timestamp":1556839248,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1556839348,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 1: Code-Review-1\n\n-1 because this is still a draft for now"},{"timestamp":1556901486,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 1:\n\n(4 comments)\n\n+1 to this new interface! I really like it, and like the fact that it can be used in a pipeline and not a parallel - it makes it very clear what runs first, and in what order things are spun up."},{"timestamp":1556903076,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Uploaded patch set 2."},{"timestamp":1556903080,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit c387a85523bbe4865f8c10475eb9e98be906c66e\n    \n    stage 1: VmWatcher working and VM.deleteZone using it; tests pass\n    \n    commit 613fc65dcdf6a76fe605d33f7d82cb7084e8ff66\n    \n    doc updates; add function names to deleteZone"},{"timestamp":1556903131,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"}],"currentPatchSet":{"number":"2","revision":"42b8178e3b9e4d21dd9a94f1a49afec16fa4cb55","parents":["e552ee5c77ab0d39de8f60055b5e1f4974982e10"],"ref":"refs/changes/90/6190/2","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1556903076,"author":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"-1","grantedOn":1556839348,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1556903131,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/vm/man/vmadm.1m.md","type":"MODIFIED","insertions":1,"deletions":-2},{"file":"src/vm/node_modules/VM.js","type":"MODIFIED","insertions":98,"deletions":-134},{"file":"src/vm/node_modules/vminfod/client.js","type":"MODIFIED","insertions":643,"deletions":-3},{"file":"src/vm/sbin/vmadm.js","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":744,"sizeDeletions":-141},"patchSets":[{"number":"1","revision":"faa6188c1448528fc39d7365eb65ae623a0ec56a","parents":["663d0922696425b5de2ef055191c76e1b945064b"],"ref":"refs/changes/90/6190/1","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1556839195,"author":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1556839248,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"-1","grantedOn":1556839348,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"comments":[{"file":"src/vm/man/vmadm.1m.md","line":97,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"I\u0027m not actually sure what the [\u003c...\u003e] syntax means vs. the [...] syntax."},{"file":"src/vm/node_modules/VM.js","line":18595,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"assert.uuid(uuid, \u0027uuid\u0027);\n\nabove this line"},{"file":"src/vm/node_modules/vminfod/client.js","line":1156,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"What happens in the event that the events were already seen? i.e.: if they were seen as part of the `zoneadm` call above?  Looking through the code, it appears that `vmwatcher.wait` will push to `self._waiters`.  However, I also see that this array is changed to `null` once the match is complete.\n\nCould this call to wait potentially blow up in the event that the match is already met, as a value will be pushed to a null object?"},{"file":"src/vm/node_modules/vminfod/client.js","line":1400,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"oh, very useful!"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/vm/man/vmadm.1m.md","type":"MODIFIED","insertions":1,"deletions":-2},{"file":"src/vm/node_modules/VM.js","type":"MODIFIED","insertions":98,"deletions":-134},{"file":"src/vm/node_modules/vminfod/client.js","type":"MODIFIED","insertions":644,"deletions":-4},{"file":"src/vm/sbin/vmadm.js","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":745,"sizeDeletions":-142},{"number":"2","revision":"42b8178e3b9e4d21dd9a94f1a49afec16fa4cb55","parents":["e552ee5c77ab0d39de8f60055b5e1f4974982e10"],"ref":"refs/changes/90/6190/2","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1556903076,"author":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1556903131,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"-1","grantedOn":1556839348,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/vm/man/vmadm.1m.md","type":"MODIFIED","insertions":1,"deletions":-2},{"file":"src/vm/node_modules/VM.js","type":"MODIFIED","insertions":98,"deletions":-134},{"file":"src/vm/node_modules/vminfod/client.js","type":"MODIFIED","insertions":643,"deletions":-3},{"file":"src/vm/sbin/vmadm.js","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":744,"sizeDeletions":-141}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"}]}