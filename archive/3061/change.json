{"project":"joyent/node-fast","branch":"master","topic":"3232","id":"I849959e09b54cb70fc27f2ee7dea13744c59eac6","number":"3061","subject":"joyent/node-fast#14 want node-fast FastServer \u0027onConnsDestroyed\u0027 method","owner":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"url":"https://cr.joyent.us/3061","commitMessage":"joyent/node-fast#14 want node-fast FastServer \u0027onConnsDestroyed\u0027 method\n","createdOn":1512689136,"lastUpdated":1516410835,"open":false,"status":"MERGED","comments":[{"timestamp":1512689136,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Uploaded patch set 1."},{"timestamp":1512689193,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Topic set to 3232"},{"timestamp":1512690150,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 1:\n\n(7 comments)\n\nCan we also update:\n\n- the README\n- CHANGES.md\n- package.json, if you want to go ahead and publish this once it\u0027s integrated\n\nIs there any support that might make sense for fastserve?  It\u0027s nice to have the command exercise as much of the API as possible, even if it\u0027s just to provide an interactive way to test it."},{"timestamp":1512690191,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Patch Set 1:\n\n(4 comments)"},{"timestamp":1512690441,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1512690514,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Patch Set 1:\n\n(3 comments)"},{"timestamp":1512690613,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1512763686,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Uploaded patch set 2."},{"timestamp":1512764041,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Uploaded patch set 3."},{"timestamp":1512764283,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Patch Set 3:\n\n(6 comments)\n\nRegarding fastserve, I haven\u0027t looked at it yet, but maybe some sort of log statement that is printed when the connection count goes to zero that uses the code we\u0027ve added here?"},{"timestamp":1512769736,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1512770619,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 3:\n\n(28 comments)\n\nThanks.  I think the fast_server code is much cleaner now!"},{"timestamp":1512779953,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Uploaded patch set 4."},{"timestamp":1512779957,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing-1\n\n(1 comment)\n\n\"make check\" exited with status 2"},{"timestamp":1512780064,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Uploaded patch set 5."},{"timestamp":1512780068,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1512780262,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Patch Set 5:\n\nIn the most recent patchset I\u0027ve added modifications to the fastcall and fastserve programs that help to demonstrate how the new api method works. \u0027fastcall\u0027 now has a \u0027--leave-conn-open\u0027 option that will leave the connection to the fast rpc server open until the user sends it a SIGINT. The \u0027fastserve\u0027 program has a \u0027--quiesce\u0027 option that will invoke \u0027onConnsDestroyed\u0027 when it received a SIGINT to wait for all connections to terminate before shutting down. I\u0027ve added a short manual test description in the github issue that demonstrate this."},{"timestamp":1513031666,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Patch Set 5:\n\n(1 comment)"},{"timestamp":1513039767,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Uploaded patch set 6."},{"timestamp":1513039771,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 6: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1513039905,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Patch Set 6: Code-Review+1"},{"timestamp":1513106300,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 3:\n\nIt looks like a bunch of my comments on PS3 haven\u0027t been addressed, so I\u0027m assuming this isn\u0027t ready for re-review, but let me know if I\u0027m missing something."},{"timestamp":1513274685,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Patch Set 6:\n\n(21 comments)"},{"timestamp":1513274839,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Uploaded patch set 7."},{"timestamp":1513274843,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 7: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1513361846,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 7: Code-Review+1\n\n(4 comments)\n\nNice.  Everything left here are just typos and nitty suggestions."},{"timestamp":1513361929,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 7:\n\nI forgot to add: I really like the fastcall/fastserve test!  It\u0027s pretty great that you can fully exercise this from the command-line tools."},{"timestamp":1513624287,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 7: Code-Review+1\n\n(4 comments)\n\nLooks good to me!"},{"timestamp":1513640654,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Patch Set 7:\n\n(8 comments)"},{"timestamp":1513640694,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Uploaded patch set 8."},{"timestamp":1513640697,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 8: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1513641511,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 7:\n\n(4 comments)"},{"timestamp":1513645060,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Uploaded patch set 9."},{"timestamp":1513645064,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 9: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1515013763,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 9: Code-Review+1\n\n(1 comment)"},{"timestamp":1515016376,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Uploaded patch set 10."},{"timestamp":1515016379,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 10: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1515185906,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 10: Code-Review+1"},{"timestamp":1515198801,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 3:\n\n(8 comments)\n\nSorry for noticing a few things that I should have noticed on previous iterations.  Most of these aren\u0027t critical, but I do think the 1-second timeout is probably too short for a busy test system, and I think we might be missing a clearTimeout call."},{"timestamp":1515525203,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Patch Set 10:\n\n(9 comments)"},{"timestamp":1515525358,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Uploaded patch set 11."},{"timestamp":1515525362,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 11: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1515525448,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Patch Set 10:\n\nRe-ran the test suite to make sure that the changes to tst.server.js didn\u0027t break anything. Testing notes for the onConnsDestroyed method in addition to the changes to fastcall and fastserver are in the github issue: https://github.com/joyent/node-fast/issues/14"},{"timestamp":1515525752,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Uploaded patch set 12."},{"timestamp":1515525756,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 12: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1515545236,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 12: Code-Review+1"},{"timestamp":1516116962,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 12: Code-Review+1"},{"timestamp":1516409548,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 12: Integration-Approval+1"},{"timestamp":1516410835,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Jan Wyszynski"}],"currentPatchSet":{"number":"12","revision":"849959e09b54cb70fc27f2ee7dea13744c59eac6","parents":["f99797509181363e6db7e925953217b151ea060a"],"ref":"refs/changes/61/3061/12","uploader":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"createdOn":1515525752,"author":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1515525756,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1515545236,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1516116962,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1516409548,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"SUBM","value":"1","grantedOn":1516410835,"by":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":4,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":10,"deletions":0},{"file":"bin/fastcall","type":"MODIFIED","insertions":60,"deletions":-14},{"file":"bin/fastserve","type":"MODIFIED","insertions":40,"deletions":-8},{"file":"lib/fast_server.js","type":"MODIFIED","insertions":32,"deletions":-1},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/tst.server.js","type":"MODIFIED","insertions":327,"deletions":-1}],"sizeInsertions":474,"sizeDeletions":-25},"patchSets":[{"number":"1","revision":"0d7dd5fe9345549e5140a84549ca8d9bbc0e30ef","parents":["f759fb91e055f1e6f7512fc89e3efde5f40a9074"],"ref":"refs/changes/61/3061/1","uploader":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"createdOn":1512689136,"author":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"isDraft":false,"kind":"REWORK","comments":[{"file":"/COMMIT_MSG","line":7,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I think this should probably go under a new node-fast ticket."},{"file":"lib/fast_server.js","line":582,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"This is definitely fine, but I wonder if this would make more sense as a callback rather than an event after all.  This all just seems more ad-hoc than I realized it would be (e.g., the caller has to call the function _and_ subscribe to an event anyway), and I wonder if it makes more sense as a callback."},{"file":"lib/fast_server.js","line":582,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"To elaborate: it probably isn\u0027t obvious to a consumer why you would need to call the notify() function _and_ subscribe to the event.  As we discussed, this is necessary to ensure a barrier to avoid a race, but it\u0027s otherwise kind of weird.  Given that the caller is explicitly requesting notification of exactly one thing in the future, it seems like a callback might make more sense than an event because I\u0027m not sure it\u0027s meaningful to subscribe to \"all future events\" instead of just \"the next time this happens\"."},{"file":"lib/fast_server.js","line":582,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Yeah, I agree. Since we\u0027re only expecting a single notification a callback is better suited to the situation."},{"file":"lib/fast_server.js","line":584,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"I wonder if there is a better name for this event \"no Connections\" sounds like an error; but you are really trying to communicate that you have completed all pending work, right ? Does FastServer already issue a \u0027empty\u0027 or ?"},{"file":"lib/fast_server.js","line":584,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"\u0027drain\u0027 is often used in Node to mean \"empty\" or \"out of stuff\".  That\u0027s ambiguous here, since it could refer to connections, requests, or something else.  Maybe \"connDrain\" (if this stays an event) / onConnDrain (if it becomes a callback)?"},{"file":"lib/fast_server.js","line":584,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"I think I\u0027m going to go with the callback here. Though I think \u0027onConnsDrained\u0027 does not communicate the fact that this event indicates that the connections have been torn down. A connection could have its pending requests drained by still be active. What about \u0027onConnsDestroyed\u0027?"},{"file":"lib/fast_server.js","line":585,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Not sure if this will change anyway, but I would set the boolean before invoking `emit()` so that if a caller decides to call notify() again, that won\u0027t get dropped."},{"file":"lib/fast_server.js","line":585,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Probably makes sense, but does that race exist in node? I thought that because of the event loop this entire function would finish executing before the next subscription could happen."},{"file":"lib/fast_server.js","line":585,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"This is moot now, but if you don\u0027t use setImmediate and assign the boolean here (as in PS2), then the callers event handlers are invoked inside the all to emit().  If they call back into this class, that\u0027s still happening in the context of emit(), at the same point in the stack.  All that will happen, and _then_ you\u0027d execute line 585, clearing the boolean, and potentially dropping the request.\n\n`setImmediate` avoids this because the handlers aren\u0027t invoked until the next tick.  For that reason, I don\u0027t think this problem can happen with the new code."},{"file":"lib/fast_server.js","line":596,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"I don\u0027t understand this restriction, why is it important ?"},{"file":"lib/fast_server.js","line":596,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"It was really a hint about how this facility should be used. If there\u0027s code out there that is subscribing to this event twice before receiving it the first time, it may make the assumption that two events will be received when only one would. But this is really just an artifact of not using the callback approach in this situation. Once I change this to be a callback, this comment will go away."},{"file":"lib/fast_server.js","line":599,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"This is explicit, but kind of a mouthful.  Maybe: \u0027onConnsDrained\u0027 ?"},{"file":"lib/fast_server.js","line":599,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"None of the other methods have names here.  I don\u0027t really care either way, but it would be nice to be consistent."},{"file":"lib/fast_server.js","line":599,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"this name could be easier/clear \"enableEmptyNotification\" or somesuch."},{"file":"lib/fast_server.js","line":599,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Referencing the comment regarding the event name above: what about \"onConnsDestroyed\"?"},{"file":"lib/fast_server.js","line":600,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"The indenting seems off here."},{"file":"lib/fast_server.js","line":600,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"indents are messed up here (four spaces instead of one tab ?)"},{"file":"lib/fast_server.js","line":600,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Sorry."},{"file":"lib/fast_server.js","line":604,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I think you probably want to wrap this in a setImmediate.  Otherwise, it would be easy for a caller to do this:\n\n    server.notifyOnceOnEmptyConnectionSet();\n    server.on(\u0027noConnections\u0027, function () { ... });\n\nand miss the event.  (The same is true if you wind up making it a callback.)"},{"file":"test/tst.server.js","line":362,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"indents are messed up here ?"},{"file":"test/tst.server.js","line":446,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"indents ?"},{"file":"test/tst.server.js","line":467,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"indents ?"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/fast_server.js","type":"MODIFIED","insertions":27,"deletions":0},{"file":"test/tst.server.js","type":"MODIFIED","insertions":374,"deletions":0}],"sizeInsertions":401,"sizeDeletions":0},{"number":"2","revision":"ad2c8d35b34b13c80b1bdfb8f9b58b0304127c40","parents":["f759fb91e055f1e6f7512fc89e3efde5f40a9074"],"ref":"refs/changes/61/3061/2","uploader":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"createdOn":1512763686,"author":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":3,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":10,"deletions":0},{"file":"lib/fast_server.js","type":"MODIFIED","insertions":41,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"test/tst.server.js","type":"MODIFIED","insertions":438,"deletions":0}],"sizeInsertions":494,"sizeDeletions":-1},{"number":"3","revision":"eb37dfec55471692c8e29e57c287ca2a53154f23","parents":["f759fb91e055f1e6f7512fc89e3efde5f40a9074"],"ref":"refs/changes/61/3061/3","uploader":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"createdOn":1512764041,"author":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1512769736,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"/COMMIT_MSG","line":7,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"This doesn\u0027t quite match the synopsis of the issue.  (It\u0027s also slightly different in CHANGES.md.)"},{"file":"/COMMIT_MSG","line":7,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Done"},{"file":"README.md","line":382,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"rewrap"},{"file":"README.md","line":382,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Done"},{"file":"lib/fast_server.js","line":228,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I don\u0027t think you need this any more."},{"file":"lib/fast_server.js","line":228,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Done"},{"file":"lib/fast_server.js","line":598,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"It looks like the style in this file is to put the brace on the next line."},{"file":"lib/fast_server.js","line":598,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Done"},{"file":"package.json","line":20,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Can we drop this module?  I find it to result in pretty confusing and error-prone code."},{"file":"package.json","line":20,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"It will make writing the tests significantly more complicated - but it\u0027s doable."},{"file":"test/tst.server.js","line":362,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I think we may as well just use mod_jsprim.hrtimeNanosec() here."},{"file":"test/tst.server.js","line":362,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Done"},{"file":"test/tst.server.js","line":370,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"The indenting here doesn\u0027t match the other test cases.\n\nWhat about putting these test cases after the others?  For a reader, I think it\u0027s helpful to start with the common cases and move on to the lesser used parts of the API."},{"file":"test/tst.server.js","line":370,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Done"},{"file":"test/tst.server.js","line":373,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I think the comments here weren\u0027t updated for the callback change."},{"file":"test/tst.server.js","line":373,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Done"},{"file":"test/tst.server.js","line":386,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I don\u0027t understand this."},{"file":"test/tst.server.js","line":386,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"I\u0027ve removed this comment with the latest patch set. The comment was originally intended to convey that there were paths in which it was possible for \u0027callback\u0027 to be invoked twice in a single test run - but this is no longer possible with the change to using asserts."},{"file":"test/tst.server.js","line":395,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Since we\u0027re assuming implementation details of the server here, how about adding an assertion that the field is actually present (similar to the assertion at L651 in the original file for a similar case where we reach in to look at a private property)?"},{"file":"test/tst.server.js","line":395,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Done"},{"file":"test/tst.server.js","line":418,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"How about advancing once we\u0027ve received the notification?  Otherwise, this test always takes a full second even if it worked right away."},{"file":"test/tst.server.js","line":418,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Done"},{"file":"test/tst.server.js","line":426,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Needs an update."},{"file":"test/tst.server.js","line":426,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Done"},{"file":"test/tst.server.js","line":431,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Same as above."},{"file":"test/tst.server.js","line":431,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Done"},{"file":"test/tst.server.js","line":452,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I\u0027m not sure this test is necessarily different from the previous one.  The errors that cause client teardown as a result of lines 433-436 may be asynchronous, in which case this subscription may have been registered before they were closed.\n\nIf you\u0027re trying to test that this does the right thing when there are currently 0 connections (which makes sense), how about adding a second subscription to the end of the previous test and making sure that gets called?"},{"file":"test/tst.server.js","line":452,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Done"},{"file":"test/tst.server.js","line":454,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Same as above.  Timeouts like this often either create the possibility of a race (if the timeout is too short, and we get spurious failures) or else cause the test suite to take a long time to run for no reason."},{"file":"test/tst.server.js","line":454,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Right - I think we still need a timeout on the entire test case, but we should also advance when we receive the callback to prevent unnecessary waiting."},{"file":"test/tst.server.js","line":468,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"the notification callback is invoked"},{"file":"test/tst.server.js","line":468,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Done"},{"file":"test/tst.server.js","line":469,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"the"},{"file":"test/tst.server.js","line":469,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Done"},{"file":"test/tst.server.js","line":470,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"RPC"},{"file":"test/tst.server.js","line":470,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Done"},{"file":"test/tst.server.js","line":480,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"\"This callback fires\" (to make it a complete sentence)."},{"file":"test/tst.server.js","line":480,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Done"},{"file":"test/tst.server.js","line":481,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"\"RPC\""},{"file":"test/tst.server.js","line":481,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Done"},{"file":"test/tst.server.js","line":483,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"If you just want to invoke this for the first connection, use `server_socket.once()` instead of `server_socket.on()`."},{"file":"test/tst.server.js","line":483,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Done"},{"file":"test/tst.server.js","line":491,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Would it be cleaner to use rpcBufferAndCallback() here?"},{"file":"test/tst.server.js","line":507,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Same as above."},{"file":"test/tst.server.js","line":527,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Is there a particular reason for this test?  (I mean, is there reason to think the implementation might depend on the results of previous RPCs?)\n\nIf so, I think we may want to write a function to abstract the general pattern here, as there\u0027s a lot of repeated code.  Maybe something similar to the way runConnFailureTest() is used in multiple tests?"},{"file":"test/tst.server.js","line":607,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"\"received\""},{"file":"test/tst.server.js","line":612,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I think these can probably be assertions.  (That\u0027s probably true for a lot of cases where you\u0027re constructing a VError.)  I think that\u0027ll simplify the code a lot."},{"file":"test/tst.server.js","line":638,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Same as above."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":3,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":10,"deletions":0},{"file":"lib/fast_server.js","type":"MODIFIED","insertions":25,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"test/tst.server.js","type":"MODIFIED","insertions":437,"deletions":0}],"sizeInsertions":477,"sizeDeletions":-1},{"number":"4","revision":"2b38bb106f7faeef8dd26403874758e833179f08","parents":["f759fb91e055f1e6f7512fc89e3efde5f40a9074"],"ref":"refs/changes/61/3061/4","uploader":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"createdOn":1512779953,"author":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1512779957,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"bin/fastcall","line":28,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"comma preceded by blank"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":3,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":10,"deletions":0},{"file":"bin/fastcall","type":"MODIFIED","insertions":49,"deletions":-14},{"file":"bin/fastserve","type":"MODIFIED","insertions":42,"deletions":-8},{"file":"lib/fast_server.js","type":"MODIFIED","insertions":25,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"test/tst.server.js","type":"MODIFIED","insertions":437,"deletions":0}],"sizeInsertions":568,"sizeDeletions":-23},{"number":"5","revision":"ed07a72c1d3fed084149c7d93820b10fa73ea010","parents":["f759fb91e055f1e6f7512fc89e3efde5f40a9074"],"ref":"refs/changes/61/3061/5","uploader":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"createdOn":1512780064,"author":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1512780068,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"test/tst.server.js","line":370,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"It seems slightly preferable to me to have these new tests added at the bottom of the test-cases -- just so that when reading this file a basic-RPC is the first testcase that someone will see."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":3,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":10,"deletions":0},{"file":"bin/fastcall","type":"MODIFIED","insertions":50,"deletions":-14},{"file":"bin/fastserve","type":"MODIFIED","insertions":42,"deletions":-8},{"file":"lib/fast_server.js","type":"MODIFIED","insertions":25,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"test/tst.server.js","type":"MODIFIED","insertions":437,"deletions":0}],"sizeInsertions":569,"sizeDeletions":-23},{"number":"6","revision":"50491b72e9c47315bcb9f10c39cde2c481f31a6b","parents":["f759fb91e055f1e6f7512fc89e3efde5f40a9074"],"ref":"refs/changes/61/3061/6","uploader":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"createdOn":1513039767,"author":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1513039771,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1513039905,"by":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":3,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":10,"deletions":0},{"file":"bin/fastcall","type":"MODIFIED","insertions":50,"deletions":-14},{"file":"bin/fastserve","type":"MODIFIED","insertions":42,"deletions":-8},{"file":"lib/fast_server.js","type":"MODIFIED","insertions":25,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"test/tst.server.js","type":"MODIFIED","insertions":437,"deletions":0}],"sizeInsertions":569,"sizeDeletions":-23},{"number":"7","revision":"2a5afb2a04d9b9a6f3f4a32231d7f3f8d719b2f5","parents":["f759fb91e055f1e6f7512fc89e3efde5f40a9074"],"ref":"refs/changes/61/3061/7","uploader":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"createdOn":1513274839,"author":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1513361846,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1513274843,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1513624287,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}}],"comments":[{"file":"bin/fastcall","line":36,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Do you think we should have a \u0027help\u0027 section that explains what each of these flags do?"},{"file":"bin/fastcall","line":36,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Done"},{"file":"bin/fastcall","line":57,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Should we add this flag to the \u0027usageMessage\u0027 list above?"},{"file":"bin/fastcall","line":57,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"I think this is just the conventional tag used by the basic parser to indicate an unknown option. It doesn\u0027t actually correspond to something the user would ever have to interact with. See \u0027fastbench\u0027."},{"file":"bin/fastcall","line":57,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"That\u0027s correct.  This is provided by getopt when there\u0027s an error, and it would have already emitted an error message."},{"file":"bin/fastcall","line":83,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Did this need to be split into two lines?"},{"file":"bin/fastcall","line":83,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Done"},{"file":"bin/fastcall","line":132,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"\"SIGINT\"\n\nI think it might be worth mentioning the purpose of this option here."},{"file":"bin/fastcall","line":132,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Done"},{"file":"bin/fastserve","line":67,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Why did this change to warn (instead of failing) when there are extra arguments here?"},{"file":"bin/fastserve","line":67,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"I think I meant to remove this before pushing."},{"file":"bin/fastserve","line":67,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"This version still doesn\u0027t fail when there are extra arguments provided (the way it does in master)."},{"file":"bin/fastserve","line":67,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Done"},{"file":"test/tst.server.js","line":366,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Not a big deal at all, but there might be an extra space here."},{"file":"test/tst.server.js","line":366,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Done"},{"file":"test/tst.server.js","line":1009,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"FWIW, I think you can eliminate some of this boilerplate by using rpcBufferAndCallback.  That seems to be what most of the other tests here do.  Something like:\n\n    client.rpcBufferAndCallback({\n        \u0027maxObjectsToBuffer\u0027: 0,\n        \u0027rpcmethod\u0027: \u0027echo\u0027,\n        \u0027rpcargs\u0027: []\n    }, function (err, data, ndata) {\n        mod_assertplus.ok(!err);\n        cb();\n    })"},{"file":"test/tst.server.js","line":1009,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Done"},{"file":"test/tst.server.js","line":1009,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I think this applied to most of the new test cases.\n\nThis isn\u0027t a blocker, but I feel like it makes it easier to be sure that the tests are doing the right thing (and not, say, missing some event handler or dropping some callback)."},{"file":"test/tst.server.js","line":1169,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"\"to\"?"},{"file":"test/tst.server.js","line":1169,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":3,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":10,"deletions":0},{"file":"bin/fastcall","type":"MODIFIED","insertions":50,"deletions":-14},{"file":"bin/fastserve","type":"MODIFIED","insertions":42,"deletions":-8},{"file":"lib/fast_server.js","type":"MODIFIED","insertions":25,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/tst.server.js","type":"MODIFIED","insertions":332,"deletions":0}],"sizeInsertions":463,"sizeDeletions":-23},{"number":"8","revision":"ea1482f36889340efc39caeeeb7b7489c44c81d1","parents":["f759fb91e055f1e6f7512fc89e3efde5f40a9074"],"ref":"refs/changes/61/3061/8","uploader":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"createdOn":1513640694,"author":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1513640697,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"bin/fastcall","line":26,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Sorry for my ignorance on this, but does this syntax work in Node 0.10?"},{"file":"bin/fastcall","line":26,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"No you\u0027re right. Thanks."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":3,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":10,"deletions":0},{"file":"bin/fastcall","type":"MODIFIED","insertions":59,"deletions":-13},{"file":"bin/fastserve","type":"MODIFIED","insertions":40,"deletions":-8},{"file":"lib/fast_server.js","type":"MODIFIED","insertions":25,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/tst.server.js","type":"MODIFIED","insertions":329,"deletions":0}],"sizeInsertions":467,"sizeDeletions":-22},{"number":"9","revision":"562cae053aa4fdeeba26d418d8ca63421058329b","parents":["f759fb91e055f1e6f7512fc89e3efde5f40a9074"],"ref":"refs/changes/61/3061/9","uploader":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"createdOn":1513645060,"author":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1513645064,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1515013763,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}}],"comments":[{"file":"lib/fast_server.js","line":184,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"we could have a brief comment here, but it\u0027s not a big deal"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":3,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":10,"deletions":0},{"file":"bin/fastcall","type":"MODIFIED","insertions":59,"deletions":-13},{"file":"bin/fastserve","type":"MODIFIED","insertions":39,"deletions":-7},{"file":"lib/fast_server.js","type":"MODIFIED","insertions":25,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/tst.server.js","type":"MODIFIED","insertions":328,"deletions":0}],"sizeInsertions":465,"sizeDeletions":-21},{"number":"10","revision":"8e5e047f5a41eb5332d636afadbb2cba5c5af79d","parents":["f759fb91e055f1e6f7512fc89e3efde5f40a9074"],"ref":"refs/changes/61/3061/10","uploader":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"createdOn":1515016376,"author":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1515016379,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1515185906,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}}],"comments":[{"file":"test/tst.server.js","line":388,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Since this covers a TCP connection to a local process, I think we may want this to be more than one second.  On a busy test machine, it could take longer than that."},{"file":"test/tst.server.js","line":388,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Done"},{"file":"test/tst.server.js","line":421,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Just noticed this -- shouldn\u0027t we clear the timeout here?"},{"file":"test/tst.server.js","line":421,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Done"},{"file":"test/tst.server.js","line":938,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Same note as above."},{"file":"test/tst.server.js","line":964,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"FYI, `setImmediate` takes arguments that are passed to the function, so I think you can just do `setImmediate(verifyCallbackContext, qcb)`.  (Just an FYI -- this is fine as it is.)"},{"file":"test/tst.server.js","line":964,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Done"},{"file":"test/tst.server.js","line":1036,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Same as above.\n\n(Another option might be to apply a timeout to the entire test program.  Or don\u0027t even worry about the timeout and say that if the test hangs, someone will have to debug that.)"},{"file":"test/tst.server.js","line":1036,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"I don\u0027t know, I kind of like the idea of giving whoever is running the tests an idea of what\u0027s going if the callback isn\u0027t received. I think it sort of lightens the cognitive load of debugging the problem. If you\u0027re okay with keeping these timeouts, I\u0027d prefer to go that route."},{"file":"test/tst.server.js","line":1132,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Total nit, but it looks like this fits in the previous line."},{"file":"test/tst.server.js","line":1132,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Done"},{"file":"test/tst.server.js","line":1155,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Same as above."},{"file":"test/tst.server.js","line":1155,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Done"},{"file":"test/tst.server.js","line":1174,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"It looks like this fits on the previous line, too."},{"file":"test/tst.server.js","line":1174,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":3,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":10,"deletions":0},{"file":"bin/fastcall","type":"MODIFIED","insertions":60,"deletions":-14},{"file":"bin/fastserve","type":"MODIFIED","insertions":40,"deletions":-8},{"file":"lib/fast_server.js","type":"MODIFIED","insertions":32,"deletions":-1},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/tst.server.js","type":"MODIFIED","insertions":329,"deletions":-1}],"sizeInsertions":475,"sizeDeletions":-25},{"number":"11","revision":"32daf0d1f56c341ff942c0731f6d7db3137d8174","parents":["f759fb91e055f1e6f7512fc89e3efde5f40a9074"],"ref":"refs/changes/61/3061/11","uploader":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"createdOn":1515525358,"author":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1515525362,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":3,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":10,"deletions":0},{"file":"bin/fastcall","type":"MODIFIED","insertions":60,"deletions":-14},{"file":"bin/fastserve","type":"MODIFIED","insertions":40,"deletions":-8},{"file":"lib/fast_server.js","type":"MODIFIED","insertions":32,"deletions":-1},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/tst.server.js","type":"MODIFIED","insertions":327,"deletions":-1}],"sizeInsertions":473,"sizeDeletions":-25},{"number":"12","revision":"849959e09b54cb70fc27f2ee7dea13744c59eac6","parents":["f99797509181363e6db7e925953217b151ea060a"],"ref":"refs/changes/61/3061/12","uploader":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"createdOn":1515525752,"author":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1515545236,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1516409548,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1515525756,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1516116962,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}},{"type":"SUBM","value":"1","grantedOn":1516410835,"by":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":4,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":10,"deletions":0},{"file":"bin/fastcall","type":"MODIFIED","insertions":60,"deletions":-14},{"file":"bin/fastserve","type":"MODIFIED","insertions":40,"deletions":-8},{"file":"lib/fast_server.js","type":"MODIFIED","insertions":32,"deletions":-1},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/tst.server.js","type":"MODIFIED","insertions":327,"deletions":-1}],"sizeInsertions":474,"sizeDeletions":-25}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"}]}