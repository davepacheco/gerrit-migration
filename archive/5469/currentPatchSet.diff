From 5752763396022f0068136af0cb5b3a377b7789d8 Mon Sep 17 00:00:00 2001
From: Trent Mick <trentm@gmail.com>
Date: Fri, 1 Feb 2019 16:37:54 -0800
Subject: [PATCH] TRITON-1184 add 'make cutarelease' to vm-agent and net-agent
 to facilitate tagging new vers Reviewed by: Josh Wilsdon <josh@wilsdon.ca>
 Approved by: Josh Wilsdon <josh@wilsdon.ca>

---
 Makefile | 14 +++++++++++++-
 1 file changed, 13 insertions(+), 1 deletion(-)

diff --git a/Makefile b/Makefile
index 61c55e4..cd077a4 100644
--- a/Makefile
+++ b/Makefile
@@ -5,7 +5,7 @@
 #
 
 #
-# Copyright (c) 2018, Joyent, Inc.
+# Copyright (c) 2019, Joyent, Inc.
 #
 
 #
@@ -123,6 +123,18 @@ dumpvar:
 	fi
 	@echo "$(VAR) is '$($(VAR))'"
 
+# Here "cutting a release" is just tagging the current commit with
+# "v(package.json version)". We don't publish this to npm.
+.PHONY: cutarelease
+cutarelease:
+	@echo "# Ensure working copy is clean."
+	[[ -z `git status --short` ]]  # If this fails, the working dir is dirty.
+	@echo "# Ensure have 'json' tool."
+	which json 2>/dev/null 1>/dev/null
+	ver=$(shell cat package.json | json version) && \
+	    git tag "v$$ver" && \
+	    git push origin "v$$ver"
+
 include ./tools/mk/Makefile.deps
 ifeq ($(shell uname -s),SunOS)
     include ./tools/mk/Makefile.node_prebuilt.targ
-- 
2.21.0

