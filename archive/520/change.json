{"project":"joyent/manta-marlin","branch":"master","id":"Iabcc3fba2583b1a41f9353f7dd2f2ab09c87fcd4","number":"520","subject":"MANTA-2872 marlin agent dns resolver doesn\u0027t support tcp Reviewed by: Richard Bradley \u003crichard.bradley@joyent.com\u003e Approved by: Richard Bradley \u003crichard.bradley@joyent.com\u003e","owner":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"url":"https://cr.joyent.us/520","commitMessage":"MANTA-2872 marlin agent dns resolver doesn\u0027t support tcp\nReviewed by: Richard Bradley \u003crichard.bradley@joyent.com\u003e\nApproved by: Richard Bradley \u003crichard.bradley@joyent.com\u003e\n","createdOn":1474579342,"lastUpdated":1478885515,"open":false,"status":"MERGED","comments":[{"timestamp":1474579342,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Uploaded patch set 1."},{"timestamp":1478823712,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Uploaded patch set 2."},{"timestamp":1478823781,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1478882711,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"Patch Set 2:\n\n(1 comment)\n\nCode changes look OK, new/updated comments are useful, and I\u0027m happy with your testing summary in the referenced ticket. \n\nOnly 1 minor comment re: tunables."},{"timestamp":1478883456,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1478885062,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Uploaded patch set 3."},{"timestamp":1478885111,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1478885357,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"Patch Set 3: Code-Review+1 Integration-Approval+1\n\nGiven your explanation I think the change in patch set 3 is plenty."},{"timestamp":1478885481,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Uploaded patch set 4: Commit message was updated."},{"timestamp":1478885515,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by David Pacheco"}],"currentPatchSet":{"number":"4","revision":"abcc3fba2583b1a41f9353f7dd2f2ab09c87fcd4","parents":["6c6581a3bdd7f5eb050a150911723f894e6fe130"],"ref":"refs/changes/20/520/4","uploader":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"createdOn":1478885481,"author":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1478885111,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1478885357,"by":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1478885357,"by":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"}},{"type":"SUBM","value":"1","grantedOn":1478885515,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"agent/etc/agentconfig.coal.json","type":"MODIFIED","insertions":7,"deletions":0},{"file":"agent/lib/agent/adnscache.js","type":"DELETED","insertions":0,"deletions":-280},{"file":"agent/lib/agent/agent.js","type":"MODIFIED","insertions":138,"deletions":-78},{"file":"agent/lib/agent/schema.js","type":"MODIFIED","insertions":25,"deletions":-3},{"file":"common/lib/schema.js","type":"MODIFIED","insertions":6,"deletions":0},{"file":"dev/package.json","type":"MODIFIED","insertions":9,"deletions":-9},{"file":"dev/test/util/tst.adnscache.js","type":"DELETED","insertions":0,"deletions":-140}],"sizeInsertions":186,"sizeDeletions":-511},"patchSets":[{"number":"1","revision":"a4680f049c97c7f0d880e31a948d9adfbbe7cd7a","parents":["8c0e30e4e8ca53822bda6b7e24c87ca9a9bdfd4a"],"ref":"refs/changes/20/520/1","uploader":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"createdOn":1474579342,"author":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"isDraft":true,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"agent/etc/agentconfig.coal.json","type":"MODIFIED","insertions":7,"deletions":0},{"file":"agent/lib/agent/adnscache.js","type":"DELETED","insertions":0,"deletions":-280},{"file":"agent/lib/agent/agent.js","type":"MODIFIED","insertions":127,"deletions":-79},{"file":"agent/lib/agent/schema.js","type":"MODIFIED","insertions":25,"deletions":-3},{"file":"common/lib/schema.js","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"dev/package.json","type":"MODIFIED","insertions":9,"deletions":-9},{"file":"dev/test/util/tst.adnscache.js","type":"DELETED","insertions":0,"deletions":-140}],"sizeInsertions":177,"sizeDeletions":-514},{"number":"2","revision":"b18c19b1bd935ca8b13e0168c84e47d55529408a","parents":["6c6581a3bdd7f5eb050a150911723f894e6fe130"],"ref":"refs/changes/20/520/2","uploader":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"createdOn":1478823712,"author":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1478823781,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"agent/lib/agent/agent.js","line":260,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"This is minor, but if my understanding of @451 and how these other values are overridden (e.g. @460) is correct then I don\u0027t think `maUpstreamSrvMaxTimeout` is in fact tunable.\n\nGiven that it doesn\u0027t end in \"Default\" I think this is intentional, but the comment and its position in the block of definitions made me think it was.\n\nWas this left un-tunable intentionally?"},{"file":"agent/lib/agent/agent.js","line":260,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"That\u0027s correct.  I didn\u0027t think that one crossed the level of having it be configurable, but I forgot that the comment suggests otherwise.  I\u0027d be happy to update the comment to say \"Most of these values ... \".  If you feel strongly this should be a tunable, I can do that, too.\n\nIf this timeout is too aggressive, then the Marlin agent will end up using \"A\" records when it could use \"SRV\" records, which shouldn\u0027t be a big deal, especially talking to the front door.  If it\u0027s too generous, though, then we could induce latency into jobs that try to run and use the front door before the agent has given up looking for SRV records.  But the acceptable window is pretty long, since jobs won\u0027t run until zone resets are complete, which is at least a minute or two after startup."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"agent/etc/agentconfig.coal.json","type":"MODIFIED","insertions":7,"deletions":0},{"file":"agent/lib/agent/adnscache.js","type":"DELETED","insertions":0,"deletions":-280},{"file":"agent/lib/agent/agent.js","type":"MODIFIED","insertions":137,"deletions":-78},{"file":"agent/lib/agent/schema.js","type":"MODIFIED","insertions":25,"deletions":-3},{"file":"common/lib/schema.js","type":"MODIFIED","insertions":6,"deletions":0},{"file":"dev/package.json","type":"MODIFIED","insertions":9,"deletions":-9},{"file":"dev/test/util/tst.adnscache.js","type":"DELETED","insertions":0,"deletions":-140}],"sizeInsertions":185,"sizeDeletions":-511},{"number":"3","revision":"5de45f5e1f8f72955600b908cbf50e3b4fba5994","parents":["6c6581a3bdd7f5eb050a150911723f894e6fe130"],"ref":"refs/changes/20/520/3","uploader":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"createdOn":1478885062,"author":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1478885111,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1478885357,"by":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1478885357,"by":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"agent/etc/agentconfig.coal.json","type":"MODIFIED","insertions":7,"deletions":0},{"file":"agent/lib/agent/adnscache.js","type":"DELETED","insertions":0,"deletions":-280},{"file":"agent/lib/agent/agent.js","type":"MODIFIED","insertions":138,"deletions":-78},{"file":"agent/lib/agent/schema.js","type":"MODIFIED","insertions":25,"deletions":-3},{"file":"common/lib/schema.js","type":"MODIFIED","insertions":6,"deletions":0},{"file":"dev/package.json","type":"MODIFIED","insertions":9,"deletions":-9},{"file":"dev/test/util/tst.adnscache.js","type":"DELETED","insertions":0,"deletions":-140}],"sizeInsertions":186,"sizeDeletions":-511},{"number":"4","revision":"abcc3fba2583b1a41f9353f7dd2f2ab09c87fcd4","parents":["6c6581a3bdd7f5eb050a150911723f894e6fe130"],"ref":"refs/changes/20/520/4","uploader":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"createdOn":1478885481,"author":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"SUBM","value":"1","grantedOn":1478885515,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1478885111,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1478885357,"by":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1478885357,"by":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"agent/etc/agentconfig.coal.json","type":"MODIFIED","insertions":7,"deletions":0},{"file":"agent/lib/agent/adnscache.js","type":"DELETED","insertions":0,"deletions":-280},{"file":"agent/lib/agent/agent.js","type":"MODIFIED","insertions":138,"deletions":-78},{"file":"agent/lib/agent/schema.js","type":"MODIFIED","insertions":25,"deletions":-3},{"file":"common/lib/schema.js","type":"MODIFIED","insertions":6,"deletions":0},{"file":"dev/package.json","type":"MODIFIED","insertions":9,"deletions":-9},{"file":"dev/test/util/tst.adnscache.js","type":"DELETED","insertions":0,"deletions":-140}],"sizeInsertions":186,"sizeDeletions":-511}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}]}