{"project":"joyent/node-watershed","branch":"master","id":"I5876d6252d35b894b137db5b6f6963ed98410a76","number":"2957","subject":"joyent/node-watershed#5 Want support for negotiating sub-protocols Reviewed by: Cody Peter Mello \u003ccody.mello@joyent.com\u003e Approved by: Joshua M. Clulow \u003cjmc@joyent.com\u003e","owner":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"url":"https://cr.joyent.us/2957","commitMessage":"joyent/node-watershed#5 Want support for negotiating sub-protocols\nReviewed by: Cody Peter Mello \u003ccody.mello@joyent.com\u003e\nApproved by: Joshua M. Clulow \u003cjmc@joyent.com\u003e\n","createdOn":1510875116,"lastUpdated":1511303822,"open":false,"status":"MERGED","comments":[{"timestamp":1510875116,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 1."},{"timestamp":1510875139,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1510962150,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 1:\n\n(7 comments)"},{"timestamp":1511216511,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 2."},{"timestamp":1511216514,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing-1\n\n\"make check\" exited with status 2\n\n fatal: ref HEAD is not a symbolic ref\n version is: 0.4.0\n [[ `cat package.json | json version` \u003d\u003d `grep \u0027^## \u0027 CHANGES.md | \\\n \thead -2 | tail -1 | awk \u0027{print $2}\u0027` ]]\n Makefile:33: recipe for target \u0027versioncheck\u0027 failed\n gmake: *** [versioncheck] Error 1"},{"timestamp":1511216583,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 3."},{"timestamp":1511216611,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1511224385,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 3:\n\n(3 comments)"},{"timestamp":1511226401,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 4."},{"timestamp":1511226424,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1511226495,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 4: Code-Review+1"},{"timestamp":1511302216,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Patch Set 4:\n\n(1 comment)"},{"timestamp":1511302480,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 5."},{"timestamp":1511302503,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1511302576,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 6."},{"timestamp":1511302599,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 6: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1511303680,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Patch Set 6: Integration-Approval+1"},{"timestamp":1511303780,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 7: Commit message was updated."},{"timestamp":1511303821,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 7: Code-Review+1"},{"timestamp":1511303822,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Alex Wilson"}],"currentPatchSet":{"number":"7","revision":"c2526d4e2a478a41111ee7aad03b5acd143230d3","parents":["214d02f17ac35ab13de12e179e4a223c7251dba8"],"ref":"refs/changes/57/2957/7","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1511303780,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1511302599,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1511303680,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1511303821,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"SUBM","value":"1","grantedOn":1511303821,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":5,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":19,"deletions":-1},{"file":"lib/watershed.js","type":"MODIFIED","insertions":53,"deletions":-7},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/basic.js","type":"MODIFIED","insertions":71,"deletions":-4}],"sizeInsertions":149,"sizeDeletions":-13},"patchSets":[{"number":"1","revision":"d1d8a078f2a320078ceaebdd66f0a6411c4623c0","parents":["214d02f17ac35ab13de12e179e4a223c7251dba8"],"ref":"refs/changes/57/2957/1","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1510875116,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1510875139,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/watershed.js","line":143,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"The README should be updated to mention the new argument."},{"file":"lib/watershed.js","line":175,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"I think this should be /, */g. What\u0027s here right now would recognize \u0027a b c\u0027, and subprotocols are supposed to be comma-separated."},{"file":"lib/watershed.js","line":394,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"The README should be updated to mention this new method."},{"file":"test/basic.js","line":147,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Maybe call this \"teardown connection\" instead?"},{"file":"test/basic.js","line":157,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"To make it clear that we get a new server and client side handle below, we should probably add:\n\n    CLIENT \u003d null;\n    SERVER \u003d null;"},{"file":"test/basic.js","line":203,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"t.fail(\u0027request should not successfully upgrade\u0027)"},{"file":"test/basic.js","line":211,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"\"teardown server\""}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/watershed.js","type":"MODIFIED","insertions":51,"deletions":-7},{"file":"test/basic.js","type":"MODIFIED","insertions":66,"deletions":-4}],"sizeInsertions":117,"sizeDeletions":-11},{"number":"2","revision":"116b2be389d1858d01a0cb82b3af9364d7447023","parents":["214d02f17ac35ab13de12e179e4a223c7251dba8"],"ref":"refs/changes/57/2957/2","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1511216511,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1511216514,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":18,"deletions":-1},{"file":"lib/watershed.js","type":"MODIFIED","insertions":51,"deletions":-7},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/basic.js","type":"MODIFIED","insertions":69,"deletions":-4}],"sizeInsertions":139,"sizeDeletions":-13},{"number":"3","revision":"78475c4c177b72552d89d3c3db8af319370b4f3a","parents":["214d02f17ac35ab13de12e179e4a223c7251dba8"],"ref":"refs/changes/57/2957/3","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1511216583,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1511216611,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"README.md","line":14,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Should this be written as String[] instead? It looks a lot like the optional syntax here. Or maybe StringArray?"},{"file":"README.md","line":52,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"The RFC prefers the nonhyphenated form, so I think it\u0027d be best to use that in the docs."},{"file":"lib/watershed.js","line":168,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Should we commit to a value to return when no subprotocol has been negotiated? We could make getProtocol() return null and document that."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":5,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":18,"deletions":-1},{"file":"lib/watershed.js","type":"MODIFIED","insertions":51,"deletions":-7},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/basic.js","type":"MODIFIED","insertions":69,"deletions":-4}],"sizeInsertions":144,"sizeDeletions":-13},{"number":"4","revision":"92785b066e6cb4b9b97ce9edc563146659235d84","parents":["214d02f17ac35ab13de12e179e4a223c7251dba8"],"ref":"refs/changes/57/2957/4","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1511226401,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1511226495,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1511226424,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"README.md","line":44,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"This is a two-spaces-after-period file; can you fix these graphs?"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":5,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":19,"deletions":-1},{"file":"lib/watershed.js","type":"MODIFIED","insertions":53,"deletions":-7},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/basic.js","type":"MODIFIED","insertions":71,"deletions":-4}],"sizeInsertions":149,"sizeDeletions":-13},{"number":"5","revision":"5be0616738cc3c2741fea5c85b951e6ed77692ba","parents":["214d02f17ac35ab13de12e179e4a223c7251dba8"],"ref":"refs/changes/57/2957/5","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1511302480,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1511302503,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":5,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":19,"deletions":-1},{"file":"lib/watershed.js","type":"MODIFIED","insertions":53,"deletions":-7},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/basic.js","type":"MODIFIED","insertions":71,"deletions":-4}],"sizeInsertions":149,"sizeDeletions":-13},{"number":"6","revision":"5876d6252d35b894b137db5b6f6963ed98410a76","parents":["214d02f17ac35ab13de12e179e4a223c7251dba8"],"ref":"refs/changes/57/2957/6","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1511302576,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1511303680,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1511302599,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":5,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":19,"deletions":-1},{"file":"lib/watershed.js","type":"MODIFIED","insertions":53,"deletions":-7},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/basic.js","type":"MODIFIED","insertions":71,"deletions":-4}],"sizeInsertions":149,"sizeDeletions":-13},{"number":"7","revision":"c2526d4e2a478a41111ee7aad03b5acd143230d3","parents":["214d02f17ac35ab13de12e179e4a223c7251dba8"],"ref":"refs/changes/57/2957/7","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1511303780,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1511303821,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"SUBM","value":"1","grantedOn":1511303821,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1511303680,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1511302599,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":5,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":19,"deletions":-1},{"file":"lib/watershed.js","type":"MODIFIED","insertions":53,"deletions":-7},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/basic.js","type":"MODIFIED","insertions":71,"deletions":-4}],"sizeInsertions":149,"sizeDeletions":-13}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}]}