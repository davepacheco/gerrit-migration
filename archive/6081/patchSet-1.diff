From bea4f5e5c9eafaee2a087c0cfcd988f1d3849513 Mon Sep 17 00:00:00 2001
From: Todd Whiteman <todd.whiteman@joyent.com>
Date: Wed, 10 Apr 2019 10:36:52 -0700
Subject: [PATCH] TRITON-1391 sdc-docker deleteImage crashes when the
 underlying imgapi image is missing

---
 lib/backends/sdc/images.js | 4 +---
 package.json               | 2 +-
 2 files changed, 2 insertions(+), 4 deletions(-)

diff --git a/lib/backends/sdc/images.js b/lib/backends/sdc/images.js
index 55c694f..bf95eaf 100644
--- a/lib/backends/sdc/images.js
+++ b/lib/backends/sdc/images.js
@@ -5,7 +5,7 @@
  */
 
 /*
- * Copyright 2018, Joyent, Inc.
+ * Copyright 2019, Joyent, Inc.
  */
 
 /*
@@ -1745,8 +1745,6 @@ function _deleteImageV1(opts, callback) {
                     changes.push({ Deleted: format(
                         'warning: %s missing some history: %s',
                         opts.name, err) });
-                    ctx.imgsToDelete = history;
-                    cb();
                 }
                 ctx.imgsToDelete = history;
                 cb();
diff --git a/package.json b/package.json
index 2c937f8..15500e9 100644
--- a/package.json
+++ b/package.json
@@ -1,6 +1,6 @@
 {
   "name": "sdc-docker",
-  "version": "0.5.5",
+  "version": "0.5.6",
   "author": "Joyent (joyent.com)",
   "private": true,
   "dependencies": {
-- 
2.21.0

