{"project":"joyent/sdc-headnode","branch":"master","id":"Ib5c0e5a5f6e0ed31c6db2573de9b720d851af603","number":"5051","subject":"OS-7361 SmartOS initial set up password prompt mangles some patterns Reviewed by: Todd Whiteman \u003ctodd.whiteman@joyent.com\u003e Reviewed by: Mike Gerdts \u003cmike.gerdts@joyent.com\u003e Approved by: Todd Whiteman \u003ctodd.whiteman@joyent.com\u003e","owner":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"url":"https://cr.joyent.us/5051","commitMessage":"OS-7361 SmartOS initial set up password prompt mangles some patterns\nReviewed by: Todd Whiteman \u003ctodd.whiteman@joyent.com\u003e\nReviewed by: Mike Gerdts \u003cmike.gerdts@joyent.com\u003e\nApproved by: Todd Whiteman \u003ctodd.whiteman@joyent.com\u003e\n","createdOn":1542066242,"lastUpdated":1543621784,"open":false,"status":"MERGED","comments":[{"timestamp":1542066242,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Uploaded patch set 1."},{"timestamp":1542066242,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit a59f537563e85f07f893b8bd661e99f307378d05\n    \n    1"},{"timestamp":1542066276,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing-1\n\n(1 comment)\n\n\"make check\" exited with status 2"},{"timestamp":1542066431,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Uploaded patch set 2."},{"timestamp":1542066431,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit 0f77820bf4e754fe815cba52d7b247e1ed2fd2d9\n    \n    2"},{"timestamp":1542069440,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Uploaded patch set 3: Patch Set 2 was rebased."},{"timestamp":1542069440,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Patch Set 3:\n\nNew commits:\n    \n    commit 897d660272d1f480322549413d067023dfaecb91\n    \n    2\n    \n    commit 320c63af42a2f5be3255311a706b40065d7583db\n    \n    1"},{"timestamp":1542069539,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1543521895,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Uploaded patch set 4: Patch Set 3 was rebased."},{"timestamp":1543521895,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Patch Set 4:\n\nNew commits:\n    \n    commit 79968338b89a326c9c4af3891a87b431723097a1\n    \n    2\n    \n    commit d8324f8f50c171a1d31f196e32ac86a5508487af\n    \n    1"},{"timestamp":1543524032,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 4: Code-Review+1\n\nCode seems fine.  Holding off on IA as it\u0027s not clear from the test notes whether both this and the smartos-live changes were tested."},{"timestamp":1543524099,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Patch Set 4:\n\n(1 comment)"},{"timestamp":1543531702,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 4: -Code-Review\n\nOops, I agree with Todd."},{"timestamp":1543532512,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Patch Set 4:\n\n(1 comment)"},{"timestamp":1543581850,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 4:\n\n(1 comment)"},{"timestamp":1543592610,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Uploaded patch set 5."},{"timestamp":1543592611,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Patch Set 5:\n\nNew commits:\n    \n    commit de38b5e675f1d75799ae96a77d31081941b65303\n    \n    3"},{"timestamp":1543592706,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1543595255,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Patch Set 5: Code-Review+1"},{"timestamp":1543595536,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 5: Code-Review+1"},{"timestamp":1543600400,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Uploaded patch set 6: Commit message was updated."},{"timestamp":1543601281,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Patch Set 4:\n\n(1 comment)"},{"timestamp":1543613177,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Patch Set 6: Integration-Approval+1"},{"timestamp":1543621252,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Uploaded patch set 7: Commit message was updated."},{"timestamp":1543621784,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Brian Bennett"}],"currentPatchSet":{"number":"7","revision":"b5c0e5a5f6e0ed31c6db2573de9b720d851af603","parents":["752f32fcd57e008f4890a0277c62d70f9b2c33ca"],"ref":"refs/changes/51/5051/7","uploader":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"createdOn":1543621252,"author":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1543592706,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1543595255,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1543595536,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1543613177,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}},{"type":"SUBM","value":"1","grantedOn":1543621784,"by":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"scripts/prompt-config.sh","type":"MODIFIED","insertions":12,"deletions":-10}],"sizeInsertions":12,"sizeDeletions":-10},"patchSets":[{"number":"1","revision":"bfa2d4ad5c0a7bca590ed72c8b6c224f6f8416bd","parents":["26b0feb207919293098a1eba70d41d324642a4f5"],"ref":"refs/changes/51/5051/1","uploader":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"createdOn":1542066242,"author":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1542066276,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"scripts/prompt-config.sh","line":644,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"line exceeds 80 columns"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"scripts/prompt-config.sh","type":"MODIFIED","insertions":13,"deletions":-12}],"sizeInsertions":13,"sizeDeletions":-12},{"number":"2","revision":"d5dc783f419e82e104c4039e1c77484b5c607435","parents":["26b0feb207919293098a1eba70d41d324642a4f5"],"ref":"refs/changes/51/5051/2","uploader":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"createdOn":1542066431,"author":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"scripts/prompt-config.sh","type":"MODIFIED","insertions":12,"deletions":-10}],"sizeInsertions":12,"sizeDeletions":-10},{"number":"3","revision":"298dedffa6dc21fb4c9332b9cdb3d543ccc52f9d","parents":["b9eeb3e77af4cc5dfb2b9993c00dfb6b3d279d45"],"ref":"refs/changes/51/5051/3","uploader":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"createdOn":1542069440,"author":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1542069539,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"scripts/prompt-config.sh","type":"MODIFIED","insertions":12,"deletions":-10}],"sizeInsertions":12,"sizeDeletions":-10},{"number":"4","revision":"92344615fd8679b24adcc95f3d71a36eddb7fbbc","parents":["752f32fcd57e008f4890a0277c62d70f9b2c33ca"],"ref":"refs/changes/51/5051/4","uploader":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"createdOn":1543521895,"author":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1542069539,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"scripts/prompt-config.sh","line":646,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Shouldn\u0027t this be $pw?"},{"file":"scripts/prompt-config.sh","line":646,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"It doesn\u0027t need to be. I suppose it could be changed to avoid ambiguity with the variable inside of promptpw(), but it does the right thing for both passwords that are confirmed correctly and passwords that aren\u0027t."},{"file":"scripts/prompt-config.sh","line":646,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"This is different from what the smartos-live change.  As it is, you are never using the value that `read` puts into `$pw`.\n\n$ echo good | /tmp/t\nval\u003dbad\n\n$ cat /tmp/t\n#! /bin/bash\n\nreadpw()\n{\n        IFS\u003d\u0027\u0027 read -r -s pw\n        printf \u0027%s\u0027 \"$val\"\n}\n\nval\u003dbad\nval\u003d\"$(readpw)\"\necho \"val\u003d$val\""},{"file":"scripts/prompt-config.sh","line":646,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Actually, no, you\u0027re right. Both line 645 and 646 need to match."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"scripts/prompt-config.sh","type":"MODIFIED","insertions":12,"deletions":-10}],"sizeInsertions":12,"sizeDeletions":-10},{"number":"5","revision":"4f9bfae164aac1603c9b75ec41fd9530212b4bd4","parents":["752f32fcd57e008f4890a0277c62d70f9b2c33ca"],"ref":"refs/changes/51/5051/5","uploader":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"createdOn":1543592610,"author":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1543592706,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1543595255,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1543595536,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"scripts/prompt-config.sh","type":"MODIFIED","insertions":12,"deletions":-10}],"sizeInsertions":12,"sizeDeletions":-10},{"number":"6","revision":"f19cdf7aea6616988e3723f5e185d3322b58fd1f","parents":["752f32fcd57e008f4890a0277c62d70f9b2c33ca"],"ref":"refs/changes/51/5051/6","uploader":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"createdOn":1543600400,"author":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1543592706,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1543595255,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1543613177,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1543595536,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"scripts/prompt-config.sh","type":"MODIFIED","insertions":12,"deletions":-10}],"sizeInsertions":12,"sizeDeletions":-10},{"number":"7","revision":"b5c0e5a5f6e0ed31c6db2573de9b720d851af603","parents":["752f32fcd57e008f4890a0277c62d70f9b2c33ca"],"ref":"refs/changes/51/5051/7","uploader":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"createdOn":1543621252,"author":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1543592706,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"SUBM","value":"1","grantedOn":1543621784,"by":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1543595255,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1543613177,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1543595536,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"scripts/prompt-config.sh","type":"MODIFIED","insertions":12,"deletions":-10}],"sizeInsertions":12,"sizeDeletions":-10}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"}]}