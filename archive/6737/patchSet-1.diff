commit 6b7a48c434b33ca6df32517970b63fa17d7105ae
Author: Mike Gerdts <mike.gerdts@joyent.com>
Date:   2019-07-31T18:57:57+00:00 (10 weeks ago)
    
    OS-7916 bash completions for vmadm snapshot commands do not support bhyve

diff --git a/src/vm/etc/vmadm.completion b/src/vm/etc/vmadm.completion
index 0e9fbc78..3134e174 100644
--- a/src/vm/etc/vmadm.completion
+++ b/src/vm/etc/vmadm.completion
@@ -42,8 +42,8 @@ _vmadm()
         || ${prev} == 'rollback-snapshot' ]]; then
 
         # OS only commands
-        vms_uuids=$(zoneadm list -cp | grep -v ':global:' \
-            | grep -v ":[bh]*[ky]v[em]:excl:" | cut -d':' -f5 | sort | uniq)
+        vms_uuids=$(zoneadm list -cp |
+	    nawk -F: '$2 != "global" && $6 != "kvm" { print $5 }' | sort -u)
         COMPREPLY=( $(compgen -W "${vms_uuids}" -- ${cur}) )
 
     elif [[ ${prev} == 'validate' ]]; then
