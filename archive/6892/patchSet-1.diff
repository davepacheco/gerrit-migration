From a2b40989b57b1f522e6a3cb71630c10a2c7568ff Mon Sep 17 00:00:00 2001
From: Dave Eddy <dave@daveeddy.com>
Date: Thu, 12 Sep 2019 11:47:21 -0400
Subject: [PATCH] MANTA-4514 incorrect Next-Marker response from
 ListBucketObjects when page ends on a delimiter group

---
 lib/server.js | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/lib/server.js b/lib/server.js
index 2454f13..5bf9298 100644
--- a/lib/server.js
+++ b/lib/server.js
@@ -882,8 +882,10 @@ function listBuckets(options) {
             assert.string(record.name, 'record.name');
 
             if (record.type === 'group') {
+                assert.optionalString(record.nextMarker, 'record.nextMarker');
                 obj = {
                     name: record.name,
+                    nextMarker: record.nextMarker,
                     type: 'group'
                 };
 
@@ -1356,8 +1358,10 @@ function listObjects(options) {
             assert.string(record.name, 'record.name');
 
             if (record.type === 'group') {
+                assert.optionalString(record.nextMarker, 'record.nextMarker');
                 obj = {
                     name: record.name,
+                    nextMarker: record.nextMarker,
                     type: 'group'
                 };
 
@@ -1533,6 +1537,7 @@ function paginationStream(opts, onRecord, done) {
         // send the group record
         sendRecord({
             name: base + delimiter,
+            nextMarker: nextMarker,
             type: 'group'
         });
 
-- 
2.21.0

