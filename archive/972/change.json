{"project":"joyent/illumos-joyent","branch":"master","id":"Ic180fecb1d3e6f21a8453964dd4f3b5e4acce56c","number":"972","subject":"OS-5818 Want SMBIOS 3.1 support Reviewed by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e Reviewed by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e Approved by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e","owner":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"url":"https://cr.joyent.us/972","commitMessage":"OS-5818 Want SMBIOS 3.1 support\nReviewed by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e\nReviewed by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e\nApproved by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e\n","createdOn":1480459266,"lastUpdated":1480715690,"open":false,"status":"MERGED","comments":[{"timestamp":1480459266,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Uploaded patch set 1."},{"timestamp":1480459709,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Uploaded patch set 2."},{"timestamp":1480612015,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 2:\n\n(8 comments)"},{"timestamp":1480629104,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Uploaded patch set 3."},{"timestamp":1480629338,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 2:\n\n(7 comments)"},{"timestamp":1480629675,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Uploaded patch set 4."},{"timestamp":1480629693,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1480629793,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 4: Code-Review+1"},{"timestamp":1480630465,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 4:\n\n(1 comment)"},{"timestamp":1480637051,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Uploaded patch set 5."},{"timestamp":1480637364,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 4:\n\n(1 comment)"},{"timestamp":1480637623,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 5: Code-Review+1"},{"timestamp":1480640278,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 5: Code-Review+1"},{"timestamp":1480683157,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 5: Integration-Approval+1"},{"timestamp":1480706733,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 5:\n\nTo test this I went through and tested a couple different scenarios:\n\n* Original platform\n* Older smbios consumer with new smbios library\n* New smbios consumer and new smbios library\n\nIn all cases, the smbios information obtained was identical; however, the smbios command did output slightly different information to deal with the correction of MHz to MT/s. But otherwise, everything here seemed to match what we\u0027d expect.\n\nI also verified that using the newer version with the older consumer did not work."},{"timestamp":1480715501,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Uploaded patch set 6: Patch Set 5 was rebased."},{"timestamp":1480715602,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Uploaded patch set 7: Commit message was updated."},{"timestamp":1480715690,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Robert Mustacchi"}],"currentPatchSet":{"number":"7","revision":"c180fecb1d3e6f21a8453964dd4f3b5e4acce56c","parents":["db312d1a324a6063747891aa2872f2903e28ab9a"],"ref":"refs/changes/72/972/7","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1480715602,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1480637623,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1480640278,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1480683157,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"SUBM","value":"1","grantedOn":1480715690,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/cmd/smbios/smbios.c","type":"MODIFIED","insertions":11,"deletions":-8},{"file":"usr/src/common/smbios/smb_info.c","type":"MODIFIED","insertions":73,"deletions":-11},{"file":"usr/src/common/smbios/smb_open.c","type":"MODIFIED","insertions":10,"deletions":-1},{"file":"usr/src/uts/common/sys/smbios.h","type":"MODIFIED","insertions":48,"deletions":-4},{"file":"usr/src/uts/common/sys/smbios_impl.h","type":"MODIFIED","insertions":45,"deletions":-2}],"sizeInsertions":187,"sizeDeletions":-26},"patchSets":[{"number":"1","revision":"1b542d1eb494747cac6e93783afb42d06f19a413","parents":["e37c335e4639fbb0e0f2fc5f4efd7712783da31d"],"ref":"refs/changes/72/972/1","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1480459266,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/smbios/smbios.c","type":"MODIFIED","insertions":11,"deletions":-8},{"file":"usr/src/common/smbios/smb_info.c","type":"MODIFIED","insertions":69,"deletions":-11},{"file":"usr/src/common/smbios/smb_open.c","type":"MODIFIED","insertions":10,"deletions":-1},{"file":"usr/src/uts/common/sys/smbios.h","type":"MODIFIED","insertions":48,"deletions":-4},{"file":"usr/src/uts/common/sys/smbios_impl.h","type":"MODIFIED","insertions":45,"deletions":-2}],"sizeInsertions":183,"sizeDeletions":-26},{"number":"2","revision":"cdf61c598fd81cadf09c77e8872669292e5d2314","parents":["e37c335e4639fbb0e0f2fc5f4efd7712783da31d"],"ref":"refs/changes/72/972/2","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1480459709,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/common/smbios/smb_info.c","line":388,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Doesn\u0027t this belong adjacent to the switch statement below?"},{"file":"usr/src/common/smbios/smb_info.c","line":388,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"},{"file":"usr/src/common/smbios/smb_info.c","line":399,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"This could be made a little more clear that it is \"we, the library\" who are choosing not to consider the extrom size bytes as part of the exposed cflag length.  This was a little confusing to me as I was trying to reconcile what was documented in the spec vs. the code present."},{"file":"usr/src/common/smbios/smb_info.c","line":399,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I\u0027ve cleaned this up. Thanks for pointing it out."},{"file":"usr/src/uts/common/sys/smbios.h","line":495,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"nit: should be LGA3647-1"},{"file":"usr/src/uts/common/sys/smbios.h","line":495,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"},{"file":"usr/src/uts/common/sys/smbios.h","line":604,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"s/APIU/APU/"},{"file":"usr/src/uts/common/sys/smbios.h","line":604,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"},{"file":"usr/src/uts/common/sys/smbios.h","line":722,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"append comma"},{"file":"usr/src/uts/common/sys/smbios.h","line":722,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"},{"file":"usr/src/uts/common/sys/smbios_impl.h","line":59,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"I don\u0027t see this referred to anywhere else in the wad"},{"file":"usr/src/uts/common/sys/smbios_impl.h","line":59,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I think that was left over from an earlier approach. I\u0027ve removed it."},{"file":"usr/src/uts/common/sys/smbios_impl.h","line":187,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Would \u0027U\u0027 be adequate as this is still 32-bit?"},{"file":"usr/src/uts/common/sys/smbios_impl.h","line":187,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I guess it would, because we\u0027re always an ILP32 / LP64 environment, so unsigned \u003d\u003d uint32_t."},{"file":"usr/src/uts/common/sys/smbios_impl.h","line":188,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Have you confirmed that these casts are \"early enough\"?  That is, that the multiplication doesn\u0027t cause overflow before being cast to the larger size."},{"file":"usr/src/uts/common/sys/smbios_impl.h","line":188,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"It seems like it\u0027s likely not soon enough actually. I think the 32-bit versions are OK given the numbers involved.\n\nMy rough reading is that if say (s) is a uint32_t, then we\u0027ll have everything promoted to a uint32_t.\n\nI\u0027ve used ULL just to be safe, because in some environments a uint64_t is an unsigned long long and in others unsigned long, though there, IIRC, unsigned long long \u003d\u003d unsigned long."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/smbios/smbios.c","type":"MODIFIED","insertions":11,"deletions":-8},{"file":"usr/src/common/smbios/smb_info.c","type":"MODIFIED","insertions":69,"deletions":-11},{"file":"usr/src/common/smbios/smb_open.c","type":"MODIFIED","insertions":10,"deletions":-1},{"file":"usr/src/uts/common/sys/smbios.h","type":"MODIFIED","insertions":48,"deletions":-4},{"file":"usr/src/uts/common/sys/smbios_impl.h","type":"MODIFIED","insertions":45,"deletions":-2}],"sizeInsertions":183,"sizeDeletions":-26},{"number":"3","revision":"4c541a80dfae099ab7b7be124b0b682dade07fcb","parents":["e37c335e4639fbb0e0f2fc5f4efd7712783da31d"],"ref":"refs/changes/72/972/3","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1480629104,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/smbios/smbios.c","type":"MODIFIED","insertions":11,"deletions":-8},{"file":"usr/src/common/smbios/smb_info.c","type":"MODIFIED","insertions":73,"deletions":-11},{"file":"usr/src/common/smbios/smb_open.c","type":"MODIFIED","insertions":10,"deletions":-1},{"file":"usr/src/uts/common/sys/smbios.h","type":"MODIFIED","insertions":48,"deletions":-4},{"file":"usr/src/uts/common/sys/smbios_impl.h","type":"MODIFIED","insertions":45,"deletions":-2}],"sizeInsertions":187,"sizeDeletions":-26},{"number":"4","revision":"f25f9e2667eea2a2bcdccec8bb72fef78e4be52f","parents":["e37c335e4639fbb0e0f2fc5f4efd7712783da31d"],"ref":"refs/changes/72/972/4","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1480629675,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1480629793,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"comments":[{"file":"usr/src/common/smbios/smb_info.c","line":603,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"It seems like it would be clearer to combine these two tests with something like:\n\nif (smb_libgteq(shp, SMB_VERSION_31) {\n    if (smb_gteq(shp, SMB_VERSION_31) {\n        ....\n    } else {\n        ...\n    }\n}"},{"file":"usr/src/common/smbios/smb_info.c","line":603,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/smbios/smbios.c","type":"MODIFIED","insertions":11,"deletions":-8},{"file":"usr/src/common/smbios/smb_info.c","type":"MODIFIED","insertions":73,"deletions":-11},{"file":"usr/src/common/smbios/smb_open.c","type":"MODIFIED","insertions":10,"deletions":-1},{"file":"usr/src/uts/common/sys/smbios.h","type":"MODIFIED","insertions":48,"deletions":-4},{"file":"usr/src/uts/common/sys/smbios_impl.h","type":"MODIFIED","insertions":45,"deletions":-2}],"sizeInsertions":187,"sizeDeletions":-26},{"number":"5","revision":"d628bd252d92a9f47f27851d43e3f736a8d06b40","parents":["e37c335e4639fbb0e0f2fc5f4efd7712783da31d"],"ref":"refs/changes/72/972/5","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1480637051,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1480637623,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1480683157,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1480640278,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/smbios/smbios.c","type":"MODIFIED","insertions":11,"deletions":-8},{"file":"usr/src/common/smbios/smb_info.c","type":"MODIFIED","insertions":73,"deletions":-11},{"file":"usr/src/common/smbios/smb_open.c","type":"MODIFIED","insertions":10,"deletions":-1},{"file":"usr/src/uts/common/sys/smbios.h","type":"MODIFIED","insertions":48,"deletions":-4},{"file":"usr/src/uts/common/sys/smbios_impl.h","type":"MODIFIED","insertions":45,"deletions":-2}],"sizeInsertions":187,"sizeDeletions":-26},{"number":"6","revision":"b0b262aa5bf7adbeb2fa87d03d308f11ebd1747e","parents":["db312d1a324a6063747891aa2872f2903e28ab9a"],"ref":"refs/changes/72/972/6","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1480715501,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1480637623,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1480683157,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1480640278,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/smbios/smbios.c","type":"MODIFIED","insertions":11,"deletions":-8},{"file":"usr/src/common/smbios/smb_info.c","type":"MODIFIED","insertions":73,"deletions":-11},{"file":"usr/src/common/smbios/smb_open.c","type":"MODIFIED","insertions":10,"deletions":-1},{"file":"usr/src/uts/common/sys/smbios.h","type":"MODIFIED","insertions":48,"deletions":-4},{"file":"usr/src/uts/common/sys/smbios_impl.h","type":"MODIFIED","insertions":45,"deletions":-2}],"sizeInsertions":187,"sizeDeletions":-26},{"number":"7","revision":"c180fecb1d3e6f21a8453964dd4f3b5e4acce56c","parents":["db312d1a324a6063747891aa2872f2903e28ab9a"],"ref":"refs/changes/72/972/7","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1480715602,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"SUBM","value":"1","grantedOn":1480715690,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1480637623,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1480683157,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1480640278,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/cmd/smbios/smbios.c","type":"MODIFIED","insertions":11,"deletions":-8},{"file":"usr/src/common/smbios/smb_info.c","type":"MODIFIED","insertions":73,"deletions":-11},{"file":"usr/src/common/smbios/smb_open.c","type":"MODIFIED","insertions":10,"deletions":-1},{"file":"usr/src/uts/common/sys/smbios.h","type":"MODIFIED","insertions":48,"deletions":-4},{"file":"usr/src/uts/common/sys/smbios_impl.h","type":"MODIFIED","insertions":45,"deletions":-2}],"sizeInsertions":187,"sizeDeletions":-26}],"allReviewers":[{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}]}