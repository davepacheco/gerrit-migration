{"project":"joyent/sdc-napi","branch":"master","id":"I7c46d4ffd8e1e3ed071b57185ac0afb9cd5e01f3","number":"1912","subject":"NAPI-414 Allow filtering networks based on address family Reviewed by: Robert Mustacchi \u003crm@joyent.com\u003e Approved by: Jason King \u003cjason.king@joyent.com\u003e","owner":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"url":"https://cr.joyent.us/1912","commitMessage":"NAPI-414 Allow filtering networks based on address family\nReviewed by: Robert Mustacchi \u003crm@joyent.com\u003e\nApproved by: Jason King \u003cjason.king@joyent.com\u003e\n","createdOn":1494011884,"lastUpdated":1494871262,"open":false,"status":"MERGED","comments":[{"timestamp":1494011884,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 1."},{"timestamp":1494012088,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1494029234,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 1:\n\nIn general this looks reasonable. Can you discuss a bit how NAPI knows its safe to rely on the schema changes? Is it doing these all at start up or some other pattern and how that changes and backfill, etc."},{"timestamp":1494264185,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 1:\n\nAt NAPI startup, NAPI checks if it needs to update the bucket schemas, and then does a createBucket()/updateBucket() as necessary. Once the schema is updated, it does reindexObjects() repeatedly until everything is reindexed.\n\nIt then, currently, searches for things with old or missing \"v\" version fields, fetches the object, and then reinserts it. (This is necessary to upgrade from old fields to new fields, like \"provision_end_ip\" to \"provision_end_ip_addr\". In the future we could divorce bucket versions from object versions to avoid unnecessarily reinserting objects.)\n\nThe logic for this is in the lib/migrate.js file."},{"timestamp":1494458000,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 2."},{"timestamp":1494458081,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1494461951,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 2: Code-Review+1"},{"timestamp":1494628178,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 2: Integration-Approval+1"},{"timestamp":1494871136,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 3: Commit message was updated."},{"timestamp":1494871150,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 4: Patch Set 3 was rebased"},{"timestamp":1494871238,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4:\n\n\"make check\" passed ok"},{"timestamp":1494871262,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Cody Peter Mello"}],"currentPatchSet":{"number":"4","revision":"d2e3d228cd421b562ed0961d2754bfd1dfde175a","parents":["2c5b6af15305ed9682584650dbeab70c2456a09f"],"ref":"refs/changes/12/1912/4","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1494871150,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1494458081,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1494461951,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1494628178,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"SUBM","value":"1","grantedOn":1494871262,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":9,"deletions":0},{"file":"lib/models/network.js","type":"MODIFIED","insertions":16,"deletions":-3},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/integration/fabrics.test.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"test/integration/helpers.js","type":"MODIFIED","insertions":10,"deletions":-4},{"file":"test/integration/networks.test.js","type":"MODIFIED","insertions":18,"deletions":-8},{"file":"test/lib/fabric-net.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/lib/net.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/unit/networks-list.test.js","type":"ADDED","insertions":223,"deletions":0},{"file":"test/unit/networks.test.js","type":"MODIFIED","insertions":11,"deletions":-5}],"sizeInsertions":291,"sizeDeletions":-23},"patchSets":[{"number":"1","revision":"28805916b4a1de5e483f505a1dc48ff570c7befb","parents":["22a010eb786101e93b0e9dcd646d06c7fb419782"],"ref":"refs/changes/12/1912/1","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1494011884,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1494012088,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/models/network.js","type":"MODIFIED","insertions":16,"deletions":-3},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/integration/fabrics.test.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"test/integration/helpers.js","type":"MODIFIED","insertions":10,"deletions":-4},{"file":"test/integration/networks.test.js","type":"MODIFIED","insertions":18,"deletions":-8},{"file":"test/lib/fabric-net.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/lib/net.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/unit/networks-list.test.js","type":"ADDED","insertions":223,"deletions":0},{"file":"test/unit/networks.test.js","type":"MODIFIED","insertions":11,"deletions":-5}],"sizeInsertions":282,"sizeDeletions":-23},{"number":"2","revision":"7c46d4ffd8e1e3ed071b57185ac0afb9cd5e01f3","parents":["22a010eb786101e93b0e9dcd646d06c7fb419782"],"ref":"refs/changes/12/1912/2","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1494458000,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1494461951,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1494458081,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1494628178,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":9,"deletions":0},{"file":"lib/models/network.js","type":"MODIFIED","insertions":16,"deletions":-3},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/integration/fabrics.test.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"test/integration/helpers.js","type":"MODIFIED","insertions":10,"deletions":-4},{"file":"test/integration/networks.test.js","type":"MODIFIED","insertions":18,"deletions":-8},{"file":"test/lib/fabric-net.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/lib/net.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/unit/networks-list.test.js","type":"ADDED","insertions":223,"deletions":0},{"file":"test/unit/networks.test.js","type":"MODIFIED","insertions":11,"deletions":-5}],"sizeInsertions":291,"sizeDeletions":-23},{"number":"3","revision":"4e9d919d5924238d286e0152f7dcab1abec8860a","parents":["22a010eb786101e93b0e9dcd646d06c7fb419782"],"ref":"refs/changes/12/1912/3","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1494871136,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1494461951,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1494458081,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1494628178,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":9,"deletions":0},{"file":"lib/models/network.js","type":"MODIFIED","insertions":16,"deletions":-3},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/integration/fabrics.test.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"test/integration/helpers.js","type":"MODIFIED","insertions":10,"deletions":-4},{"file":"test/integration/networks.test.js","type":"MODIFIED","insertions":18,"deletions":-8},{"file":"test/lib/fabric-net.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/lib/net.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/unit/networks-list.test.js","type":"ADDED","insertions":223,"deletions":0},{"file":"test/unit/networks.test.js","type":"MODIFIED","insertions":11,"deletions":-5}],"sizeInsertions":291,"sizeDeletions":-23},{"number":"4","revision":"d2e3d228cd421b562ed0961d2754bfd1dfde175a","parents":["2c5b6af15305ed9682584650dbeab70c2456a09f"],"ref":"refs/changes/12/1912/4","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1494871150,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1494461951,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"SUBM","value":"1","grantedOn":1494871262,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1494458081,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1494628178,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":9,"deletions":0},{"file":"lib/models/network.js","type":"MODIFIED","insertions":16,"deletions":-3},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/integration/fabrics.test.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"test/integration/helpers.js","type":"MODIFIED","insertions":10,"deletions":-4},{"file":"test/integration/networks.test.js","type":"MODIFIED","insertions":18,"deletions":-8},{"file":"test/lib/fabric-net.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/lib/net.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/unit/networks-list.test.js","type":"ADDED","insertions":223,"deletions":0},{"file":"test/unit/networks.test.js","type":"MODIFIED","insertions":11,"deletions":-5}],"sizeInsertions":291,"sizeDeletions":-23}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}]}