{"project":"joyent/smartos-live","branch":"master","id":"I56aefb80e76f738a147644de8ad9b1c290325156","number":"3049","subject":"OS-5186 DHCP Client Identifiers should be permitted in VMs using DHCP","owner":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"url":"https://cr.joyent.us/3049","commitMessage":"OS-5186 DHCP Client Identifiers should be permitted in VMs using DHCP\n","createdOn":1512523853,"lastUpdated":1528905030,"open":false,"status":"MERGED","comments":[{"timestamp":1512523853,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 1."},{"timestamp":1512523906,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1528491071,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 2."},{"timestamp":1528491119,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1528759866,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 2: Code-Review+1 Integration-Approval+1\n\n(2 comments)"},{"timestamp":1528843592,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 3."},{"timestamp":1528843640,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 3:\n\n(1 comment)"},{"timestamp":1528843641,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1528843692,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 3:\n\n(1 comment)"},{"timestamp":1528849981,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 3: Code-Review+1 Integration-Approval+1\n\nlgtm"},{"timestamp":1528905030,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Cody Peter Mello"}],"currentPatchSet":{"number":"3","revision":"56aefb80e76f738a147644de8ad9b1c290325156","parents":["171ff8faf6a902e71aa9b153397e4e15540625e9"],"ref":"refs/changes/49/3049/3","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1528843592,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1528843641,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1528849981,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1528849981,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"SUBM","value":"1","grantedOn":1528905030,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"overlay/generic/usr/lib/brand/jcommon/statechange","type":"MODIFIED","insertions":17,"deletions":-2},{"file":"src/vm/man/vmadm.1m.md","type":"MODIFIED","insertions":16,"deletions":-1},{"file":"src/vm/node_modules/VM.js","type":"MODIFIED","insertions":121,"deletions":-45},{"file":"src/vm/node_modules/proptable.js","type":"MODIFIED","insertions":13,"deletions":0},{"file":"src/vm/node_modules/utils.js","type":"MODIFIED","insertions":8,"deletions":0},{"file":"src/vm/tests/test-spoof-opts.js","type":"MODIFIED","insertions":150,"deletions":-2}],"sizeInsertions":325,"sizeDeletions":-50},"patchSets":[{"number":"1","revision":"c77e42e7990f9e4e2306fdee9f500930aa97668b","parents":["f6c3146229b4b3c40402db396d7d5002bba011df"],"ref":"refs/changes/49/3049/1","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1512523853,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1512523906,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"overlay/generic/usr/lib/brand/jcommon/statechange","type":"MODIFIED","insertions":16,"deletions":-1},{"file":"src/vm/man/vmadm.1m.md","type":"MODIFIED","insertions":16,"deletions":-1},{"file":"src/vm/node_modules/VM.js","type":"MODIFIED","insertions":114,"deletions":-45},{"file":"src/vm/node_modules/proptable.js","type":"MODIFIED","insertions":14,"deletions":-1},{"file":"src/vm/node_modules/utils.js","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"src/vm/tests/test-spoof-opts.js","type":"MODIFIED","insertions":125,"deletions":-1}],"sizeInsertions":292,"sizeDeletions":-50},{"number":"2","revision":"7210df18daa40a57a8b58b52781c6c3152558648","parents":["9b029c6204553b1333963ca050c472bf52d48022"],"ref":"refs/changes/49/3049/2","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1528491071,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1528491119,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1528759866,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1528759866,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}}],"comments":[{"file":"src/vm/node_modules/VM.js","line":4969,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"ooc: Is there also a limit on the total length of the zonecfg property value?"},{"file":"src/vm/node_modules/VM.js","line":4969,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"I believe this would be limited to ZONE_PROP_MAXSTRLEN, which is 1024 bytes. A SmartOS user could make a bunch of really long CIDs here to reach that many characters. CIDs can be up to 255 bytes, which would mean that this string should be no longer than 512 characters. I can add a length check to validCID() to verify that.\n\nSince we\u0027d need to insert a comma between multiple CIDs, that\u0027d give us a length of 512 * 2 + 1 \u003d 1025 characters, which won\u0027t fit within ZONE_PROP_MAXSTRLEN. The best thing to do might be to add here:\n\n    if (n.allowed_dhcp_cids.join(\u0027,\u0027).length \u003e\u003d 1024) {\n\ndladm(1M) also has its own length constraint of 2048, which we shouldn\u0027t hit without first hitting zonecfg.\n\nI think I\u0027ll also lower the limit on number of CIDs to 20, to match the limit on allowed_ips."},{"file":"src/vm/tests/test-spoof-opts.js","line":1,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"2018"},{"file":"src/vm/tests/test-spoof-opts.js","line":1,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"overlay/generic/usr/lib/brand/jcommon/statechange","type":"MODIFIED","insertions":17,"deletions":-2},{"file":"src/vm/man/vmadm.1m.md","type":"MODIFIED","insertions":16,"deletions":-1},{"file":"src/vm/node_modules/VM.js","type":"MODIFIED","insertions":114,"deletions":-45},{"file":"src/vm/node_modules/proptable.js","type":"MODIFIED","insertions":13,"deletions":0},{"file":"src/vm/node_modules/utils.js","type":"MODIFIED","insertions":6,"deletions":0},{"file":"src/vm/tests/test-spoof-opts.js","type":"MODIFIED","insertions":125,"deletions":-1}],"sizeInsertions":291,"sizeDeletions":-49},{"number":"3","revision":"56aefb80e76f738a147644de8ad9b1c290325156","parents":["171ff8faf6a902e71aa9b153397e4e15540625e9"],"ref":"refs/changes/49/3049/3","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1528843592,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"SUBM","value":"1","grantedOn":1528905030,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1528843641,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1528849981,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1528849981,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"overlay/generic/usr/lib/brand/jcommon/statechange","type":"MODIFIED","insertions":17,"deletions":-2},{"file":"src/vm/man/vmadm.1m.md","type":"MODIFIED","insertions":16,"deletions":-1},{"file":"src/vm/node_modules/VM.js","type":"MODIFIED","insertions":121,"deletions":-45},{"file":"src/vm/node_modules/proptable.js","type":"MODIFIED","insertions":13,"deletions":0},{"file":"src/vm/node_modules/utils.js","type":"MODIFIED","insertions":8,"deletions":0},{"file":"src/vm/tests/test-spoof-opts.js","type":"MODIFIED","insertions":150,"deletions":-2}],"sizeInsertions":325,"sizeDeletions":-50}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}]}