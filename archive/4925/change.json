{"project":"joyent/smartos-live","branch":"master","id":"I8192f4ec779d668966dc66a8d30e671fbd1a668d","number":"4925","subject":"OS-7283 ./configure should support multiple compilers OS-7285 should be able to use pre-built proto.strap Reviewed by: Robert Mustacchi \u003crm@joyent.com\u003e Reviewed by: Jason King \u003cjason.king@joyent.com\u003e Approved by: Jason King \u003cjason.king@joyent.com\u003e","owner":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"url":"https://cr.joyent.us/4925","commitMessage":"OS-7283 ./configure should support multiple compilers\nOS-7285 should be able to use pre-built proto.strap\nReviewed by: Robert Mustacchi \u003crm@joyent.com\u003e\nReviewed by: Jason King \u003cjason.king@joyent.com\u003e\nApproved by: Jason King \u003cjason.king@joyent.com\u003e\n","createdOn":1538653458,"lastUpdated":1539861541,"open":false,"status":"MERGED","comments":[{"timestamp":1538653458,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Uploaded patch set 1."},{"timestamp":1538653483,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 1: Code-Review-1"},{"timestamp":1538666201,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Uploaded patch set 2: Commit message was updated."},{"timestamp":1538673749,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Uploaded patch set 3."},{"timestamp":1538732689,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Uploaded patch set 4."},{"timestamp":1538732741,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1538748943,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 4: -Code-Review"},{"timestamp":1539038446,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 4:\n\n(1 comment)"},{"timestamp":1539082814,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Uploaded patch set 5."},{"timestamp":1539082868,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1539127235,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 5:\n\n(7 comments)"},{"timestamp":1539128107,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 5:\n\n(4 comments)"},{"timestamp":1539128414,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 5:\n\n(1 comment)"},{"timestamp":1539129152,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 5:\n\n(1 comment)"},{"timestamp":1539170897,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 5:\n\n(7 comments)"},{"timestamp":1539193290,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Uploaded patch set 6."},{"timestamp":1539193343,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 6: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1539268766,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Uploaded patch set 7: Patch Set 6 was rebased."},{"timestamp":1539268820,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 7:\n\n\"make check\" passed ok"},{"timestamp":1539280578,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 7:\n\n(4 comments)"},{"timestamp":1539281834,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 7:\n\n(4 comments)"},{"timestamp":1539281840,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Uploaded patch set 8."},{"timestamp":1539281894,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 8: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1539283828,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 8: Code-Review+1\n\n(1 comment)\n\nThanks for putting all this together."},{"timestamp":1539355586,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 8: Code-Review+1"},{"timestamp":1539815312,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 8: Integration-Approval+1"},{"timestamp":1539816153,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Uploaded patch set 9: Commit message was updated."},{"timestamp":1539816172,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 10: Patch Set 9 was rebased"},{"timestamp":1539816218,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 10:\n\n\"make check\" passed ok"},{"timestamp":1539861541,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by John Levon"}],"currentPatchSet":{"number":"10","revision":"99b729aeee51d9ada581f8bfcb6d3cafd90929ac","parents":["a94d916af7b541a3db7a06c2c7cb4123555e9174"],"ref":"refs/changes/25/4925/10","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1539816172,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1539281894,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1539283828,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1539355586,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1539815312,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"SUBM","value":"1","grantedOn":1539861540,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":30,"deletions":-15},{"file":"README.md","type":"MODIFIED","insertions":16,"deletions":-14},{"file":"configure","type":"MODIFIED","insertions":133,"deletions":-41},{"file":"sample.configure.smartos","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"src/Makefile","type":"MODIFIED","insertions":3,"deletions":-4},{"file":"tools/build_strap","type":"ADDED","insertions":202,"deletions":0},{"file":"tools/clobber_illumos","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"tools/pkgsrc_branch.nawk","type":"ADDED","insertions":53,"deletions":0},{"file":"tools/update_base","type":"MODIFIED","insertions":5,"deletions":-5}],"sizeInsertions":446,"sizeDeletions":-81},"patchSets":[{"number":"1","revision":"1998701890476c7cfc5f543a7608a477229d603b","parents":["968958f073b1d6990a6f2ad65c79f8096c9bcd45"],"ref":"refs/changes/25/4925/1","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1538653458,"author":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"-1","grantedOn":1538653483,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":23,"deletions":-15},{"file":"README.md","type":"MODIFIED","insertions":16,"deletions":-14},{"file":"configure","type":"MODIFIED","insertions":129,"deletions":-41},{"file":"sample.configure.smartos","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"src/Makefile","type":"MODIFIED","insertions":7,"deletions":-5},{"file":"tools/build_live","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"tools/build_strap","type":"ADDED","insertions":202,"deletions":0},{"file":"tools/clobber_illumos","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"tools/pkgsrc_branch.nawk","type":"ADDED","insertions":53,"deletions":0},{"file":"tools/update_base","type":"MODIFIED","insertions":3,"deletions":-3}],"sizeInsertions":437,"sizeDeletions":-81},{"number":"2","revision":"5ca054da9abf95027a9657331db119a9c2469c2e","parents":["968958f073b1d6990a6f2ad65c79f8096c9bcd45"],"ref":"refs/changes/25/4925/2","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1538666201,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"-1","grantedOn":1538653483,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":23,"deletions":-15},{"file":"README.md","type":"MODIFIED","insertions":16,"deletions":-14},{"file":"configure","type":"MODIFIED","insertions":129,"deletions":-41},{"file":"sample.configure.smartos","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"src/Makefile","type":"MODIFIED","insertions":7,"deletions":-5},{"file":"tools/build_live","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"tools/build_strap","type":"ADDED","insertions":202,"deletions":0},{"file":"tools/clobber_illumos","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"tools/pkgsrc_branch.nawk","type":"ADDED","insertions":53,"deletions":0},{"file":"tools/update_base","type":"MODIFIED","insertions":3,"deletions":-3}],"sizeInsertions":437,"sizeDeletions":-81},{"number":"3","revision":"5a16264e8e08778c2c877c88ed59e39ae840a203","parents":["968958f073b1d6990a6f2ad65c79f8096c9bcd45"],"ref":"refs/changes/25/4925/3","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1538673749,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"-1","grantedOn":1538653483,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":23,"deletions":-15},{"file":"README.md","type":"MODIFIED","insertions":16,"deletions":-14},{"file":"configure","type":"MODIFIED","insertions":129,"deletions":-41},{"file":"sample.configure.smartos","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"src/Makefile","type":"MODIFIED","insertions":7,"deletions":-5},{"file":"tools/build_strap","type":"ADDED","insertions":202,"deletions":0},{"file":"tools/clobber_illumos","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"tools/pkgsrc_branch.nawk","type":"ADDED","insertions":53,"deletions":0},{"file":"tools/update_base","type":"MODIFIED","insertions":3,"deletions":-3}],"sizeInsertions":436,"sizeDeletions":-80},{"number":"4","revision":"d0d9288fcdb216d7e4142d9a9cc5e80ed1f21808","parents":["968958f073b1d6990a6f2ad65c79f8096c9bcd45"],"ref":"refs/changes/25/4925/4","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1538732689,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1538732741,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"tools/update_base","line":86,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Should this also be smartos-live now?  I know the first time I saw that, I scratched my head a bit trying to figure out what it meant."},{"file":"tools/update_base","line":86,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":26,"deletions":-15},{"file":"README.md","type":"MODIFIED","insertions":16,"deletions":-14},{"file":"configure","type":"MODIFIED","insertions":133,"deletions":-41},{"file":"sample.configure.smartos","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"src/Makefile","type":"MODIFIED","insertions":7,"deletions":-5},{"file":"tools/build_strap","type":"ADDED","insertions":202,"deletions":0},{"file":"tools/clobber_illumos","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"tools/pkgsrc_branch.nawk","type":"ADDED","insertions":53,"deletions":0},{"file":"tools/update_base","type":"MODIFIED","insertions":3,"deletions":-3}],"sizeInsertions":444,"sizeDeletions":-80},{"number":"5","revision":"81e3930e5a2137e3e5d7f8d91d2a51c13a817580","parents":["968958f073b1d6990a6f2ad65c79f8096c9bcd45"],"ref":"refs/changes/25/4925/5","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1539082814,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1539082868,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"Makefile","line":19,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Is there a way to make sure that for the non make-check style targets that it is here to make debugging a missing copy of this easier?"},{"file":"Makefile","line":19,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"There\u0027s not one I could work out, but I\u0027m just a Makefile dilettante. I\u0027ll have another look tomorrow just in case I can figure out something with ifeq"},{"file":"Makefile","line":19,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Done"},{"file":"README.md","line":0,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Can we please document the new ./configure options somewhere here?"},{"file":"README.md","line":0,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"I\u0027m actually inclined not to, since it will inevitably rot, and configure -h is clear enough. I\u0027ll point to that though."},{"file":"configure","line":403,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I have to admit, this was a weird way to see this at first. I think in other cases we had a usage function that just did a cat of this all to stderr with a heredoc. May be worth a quick comment explaining the purpose of this."},{"file":"configure","line":403,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"agreed, needs a comment, as this was programming-by-google."},{"file":"configure","line":403,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Done"},{"file":"configure","line":435,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Minor style note. You had the ;; on the subsequent line in the earlier case statement."},{"file":"configure","line":435,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Done"},{"file":"src/Makefile","line":559,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"This can only ever work by accident and is the exact kind of thing that we try to prevent with LD_TOXIC_PATH. Why exactly do these need the target libstdc++ in their? Is that because their invoking the build node somehow? A good example of how this is bad is that this will pick up a newer libc from the build area and that can definitely break us if the implementation of a system call has changed (see, for example, how the implementation of pipe changed which is what caused us to add a bunch of work here)."},{"file":"src/Makefile","line":559,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"We are directly invoking the proto node instance to build the module, e.g.\n\nNODE_PATH\u003d/root/src/gcc/src/node-zonename/node_modules/v8plus/node_modules /root/src/gcc/src/../proto.strap/usr/node/0.10/bin/node /root/src/gcc/src/node-zonename/node_modules/v8plus/generrno.js -h -o v8plus_errno.h /root/src/gcc/src/node-zonename/node_modules/v8plus/errno.json\nld.so.1: node: fatal: relocation error: file /root/src/gcc/proto.strap/usr/node/0.10/bin/node: symbol _ZdlPvj: referenced symbol not found\n\n\nI think this should reference proto.strap\u0027s /usr/gcc/$VER/lib instead, I\u0027ll experiment with this tomorrow; thanks."},{"file":"src/Makefile","line":559,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"OK. This suggests that for the STRAP build we should add a RUNPATH to the LDFLAGS for node to make sure it has the compiler\u0027s library path present (something we probably need in general)."},{"file":"src/Makefile","line":559,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"That\u0027s a much nicer fix; I\u0027ll take a pass at that."},{"file":"src/Makefile","line":559,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Done"},{"file":"tools/build_strap","line":85,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Should be illumos-extra"},{"file":"tools/build_strap","line":85,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Done"},{"file":"tools/build_strap","line":150,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Please use [[ for all new tests rather than \u0027[\u0027. Here and below."},{"file":"tools/build_strap","line":150,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":27,"deletions":-16},{"file":"README.md","type":"MODIFIED","insertions":16,"deletions":-14},{"file":"configure","type":"MODIFIED","insertions":133,"deletions":-41},{"file":"sample.configure.smartos","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"src/Makefile","type":"MODIFIED","insertions":7,"deletions":-5},{"file":"tools/build_strap","type":"ADDED","insertions":202,"deletions":0},{"file":"tools/clobber_illumos","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"tools/pkgsrc_branch.nawk","type":"ADDED","insertions":53,"deletions":0},{"file":"tools/update_base","type":"MODIFIED","insertions":5,"deletions":-5}],"sizeInsertions":447,"sizeDeletions":-83},{"number":"6","revision":"4da25279ebd6ace2ec1d480f0d43b6eb6aa2c204","parents":["968958f073b1d6990a6f2ad65c79f8096c9bcd45"],"ref":"refs/changes/25/4925/6","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1539193290,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1539193343,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":31,"deletions":-16},{"file":"README.md","type":"MODIFIED","insertions":16,"deletions":-14},{"file":"configure","type":"MODIFIED","insertions":133,"deletions":-41},{"file":"sample.configure.smartos","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"src/Makefile","type":"MODIFIED","insertions":3,"deletions":-4},{"file":"tools/build_strap","type":"ADDED","insertions":202,"deletions":0},{"file":"tools/clobber_illumos","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"tools/pkgsrc_branch.nawk","type":"ADDED","insertions":53,"deletions":0},{"file":"tools/update_base","type":"MODIFIED","insertions":5,"deletions":-5}],"sizeInsertions":447,"sizeDeletions":-82},{"number":"7","revision":"961b44b7ed124074980e49fd88b8c239ff7cf6a4","parents":["6a1255390f2359e83cc7d46a0ebdbc73021cc0b8"],"ref":"refs/changes/25/4925/7","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1539268766,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1539193343,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"Makefile","line":411,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I missed this initially. So, traditionally after running gmake clobber, there\u0027s been no need to run ./configure again. However, this seems to introduce that. I\u0027m not sure we should do that. If we do, then we need to at least change the README and make sure folks know that, I think this will lead to gmake clobber/clean being less effective. And at least, doesn\u0027t really correspond with the fact that we\u0027re not removing the generated ./illumos.sh."},{"file":"Makefile","line":411,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Done"},{"file":"README.md","line":493,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"So, I guess I understand why it\u0027s now the default now to use the proto.strap by default. I kind of wish that mg would be able to not have to change to do it and that users would to make that easier, but I guess that\u0027s fine and ultimately probably more important to prioritize the every day developers."},{"file":"README.md","line":493,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"I would like us to be able to specify configure options as a build parameter (so we can start doing gcc8 shadow builds in a while, and gcc8 shadow builds anon). I think we if we do that, we could cover the -r option too."},{"file":"README.md","line":493,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"OK, seems reasonable."},{"file":"configure","line":406,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"This clobbers it every time right? Wasn\u0027t immediately clear from that message."},{"file":"configure","line":406,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Done"},{"file":"configure","line":438,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"exit 2?"},{"file":"configure","line":438,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"If the user requested help, we shouldn\u0027t return an error. However there\u0027s other places that should be 2."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":31,"deletions":-16},{"file":"README.md","type":"MODIFIED","insertions":16,"deletions":-14},{"file":"configure","type":"MODIFIED","insertions":133,"deletions":-41},{"file":"sample.configure.smartos","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"src/Makefile","type":"MODIFIED","insertions":3,"deletions":-4},{"file":"tools/build_strap","type":"ADDED","insertions":202,"deletions":0},{"file":"tools/clobber_illumos","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"tools/pkgsrc_branch.nawk","type":"ADDED","insertions":53,"deletions":0},{"file":"tools/update_base","type":"MODIFIED","insertions":5,"deletions":-5}],"sizeInsertions":447,"sizeDeletions":-82},{"number":"8","revision":"0755b63d1daea911f720020aa654a286f768fcdc","parents":["6a1255390f2359e83cc7d46a0ebdbc73021cc0b8"],"ref":"refs/changes/25/4925/8","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1539281840,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1539283828,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1539281894,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1539355586,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1539815312,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":30,"deletions":-15},{"file":"README.md","type":"MODIFIED","insertions":16,"deletions":-14},{"file":"configure","type":"MODIFIED","insertions":133,"deletions":-41},{"file":"sample.configure.smartos","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"src/Makefile","type":"MODIFIED","insertions":3,"deletions":-4},{"file":"tools/build_strap","type":"ADDED","insertions":202,"deletions":0},{"file":"tools/clobber_illumos","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"tools/pkgsrc_branch.nawk","type":"ADDED","insertions":53,"deletions":0},{"file":"tools/update_base","type":"MODIFIED","insertions":5,"deletions":-5}],"sizeInsertions":446,"sizeDeletions":-81},{"number":"9","revision":"8192f4ec779d668966dc66a8d30e671fbd1a668d","parents":["6a1255390f2359e83cc7d46a0ebdbc73021cc0b8"],"ref":"refs/changes/25/4925/9","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1539816153,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1539283828,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1539281894,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1539355586,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1539815312,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":30,"deletions":-15},{"file":"README.md","type":"MODIFIED","insertions":16,"deletions":-14},{"file":"configure","type":"MODIFIED","insertions":133,"deletions":-41},{"file":"sample.configure.smartos","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"src/Makefile","type":"MODIFIED","insertions":3,"deletions":-4},{"file":"tools/build_strap","type":"ADDED","insertions":202,"deletions":0},{"file":"tools/clobber_illumos","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"tools/pkgsrc_branch.nawk","type":"ADDED","insertions":53,"deletions":0},{"file":"tools/update_base","type":"MODIFIED","insertions":5,"deletions":-5}],"sizeInsertions":446,"sizeDeletions":-81},{"number":"10","revision":"99b729aeee51d9ada581f8bfcb6d3cafd90929ac","parents":["a94d916af7b541a3db7a06c2c7cb4123555e9174"],"ref":"refs/changes/25/4925/10","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1539816172,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1539283828,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1539281894,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1539355586,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1539815312,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"SUBM","value":"1","grantedOn":1539861540,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":30,"deletions":-15},{"file":"README.md","type":"MODIFIED","insertions":16,"deletions":-14},{"file":"configure","type":"MODIFIED","insertions":133,"deletions":-41},{"file":"sample.configure.smartos","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"src/Makefile","type":"MODIFIED","insertions":3,"deletions":-4},{"file":"tools/build_strap","type":"ADDED","insertions":202,"deletions":0},{"file":"tools/clobber_illumos","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"tools/pkgsrc_branch.nawk","type":"ADDED","insertions":53,"deletions":0},{"file":"tools/update_base","type":"MODIFIED","insertions":5,"deletions":-5}],"sizeInsertions":446,"sizeDeletions":-81}],"allReviewers":[{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}]}