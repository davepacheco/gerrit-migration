{"project":"joyent/illumos-joyent","branch":"master","id":"Ie9713db2b2ee3cf0abeb6d93eef730e3dd31970c","number":"3076","subject":"OS-6484 page invalidation under low memory takes too long Reviewed by: Dan McDonald \u003cdanmcd@joyent.com\u003e Reviewed by: Jason King \u003cjason.king@joyent.com\u003e Approved by: Dan McDonald \u003cdanmcd@joyent.com\u003e","owner":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"url":"https://cr.joyent.us/3076","commitMessage":"OS-6484 page invalidation under low memory takes too long\nReviewed by: Dan McDonald \u003cdanmcd@joyent.com\u003e\nReviewed by: Jason King \u003cjason.king@joyent.com\u003e\nApproved by: Dan McDonald \u003cdanmcd@joyent.com\u003e\n","createdOn":1512763754,"lastUpdated":1514311118,"open":false,"status":"MERGED","comments":[{"timestamp":1512763754,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 1."},{"timestamp":1513000332,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 1:\n\nFor CR, a big part of the block of changes in schedpaging() is because I changed the indentation, since I\u0027m no longer using pageout_mutex to coordinate between a single schedpaging thread and a single pageout_scanner thread (there are multiple scanners now). pageout_mutex is still used to coordinate some shared data beween all of these threads, but it is more granular."},{"timestamp":1513023302,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 1:\n\n(4 comments)\n\nJust a very, very small nit.  I don\u0027t feel strongly either way about the VERIFYs, wanted to point them out/ask."},{"timestamp":1513027365,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 1:\n\n(6 comments)\n\nAnd I agree with Jason that you should use VERIFY3U."},{"timestamp":1513028434,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1513028603,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 1:\n\n(1 comment)\n\nMy bad on the local-variable mutex."},{"timestamp":1513095458,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 1:\n\n(10 comments)"},{"timestamp":1513095468,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 2."},{"timestamp":1513096205,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 1:\n\n(2 comments)"},{"timestamp":1513096901,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 1:\n\n(2 comments)"},{"timestamp":1513097004,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1513097445,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 2: Code-Review+1\n\nThank you for the clarifications."},{"timestamp":1513097696,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 2:\n\n(2 comments)"},{"timestamp":1513097771,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1513108804,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1513108814,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 3."},{"timestamp":1513108911,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1513111142,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1513116099,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 3:\n\nPardon the churn, but I tried to streamline the code around the region size a little bit to make it easier to understand. Hopefully this is an improvement."},{"timestamp":1513116108,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 4."},{"timestamp":1513116818,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 4: Code-Review+1\n\nYes, adds clarity (\"this used just for mdb\", e.g.)."},{"timestamp":1513213874,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 4: Code-Review+1"},{"timestamp":1513720218,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 4:\n\nWe\u0027re running this code on 3 CNs in SPC under heavy Cassandra stress testing and page scanning is working as expected. We are doing a lot of scanning because the system is under lotsfree, but we are keeping up, not hitting throttlefree, and not doing htable stealing. I monitored the new kstats for several hours under this state."},{"timestamp":1513783409,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 4: Integration-Approval+1"},{"timestamp":1513884336,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 4:\n\nSorry for another lap on this CR. In Cassandra testing in SPC we found that we really needed the ability to adjust the number of page scanner threads on the fly. This new update enables that without changing the underlying concept of having multiple threads. Hopefully some of the new comments and variable names are clearer as well."},{"timestamp":1513884358,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 5."},{"timestamp":1513888502,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 5:\n\n(2 comments)"},{"timestamp":1513891419,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 6."},{"timestamp":1513896286,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 6: Code-Review+1\n\nBeen tested yet?"},{"timestamp":1513896701,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 6:\n\nYes this is running on 9 CNs in 3 DCs in SPC under heavy Cassandra load and I have been monitoring things all day and also adjusting the number of threads up/down to try various combinations with other tuning."},{"timestamp":1513907032,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 6:\n\nThank you.  I\u0027d like Jason to re-review the new dynamic-thread-count model before I say IA."},{"timestamp":1513912161,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 6: Code-Review+1"},{"timestamp":1513951630,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 6: Integration-Approval+1"},{"timestamp":1514309773,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 7: Patch Set 6 was rebased."},{"timestamp":1514309871,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 8: Commit message was updated."},{"timestamp":1514311118,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Jerry Jelinek"}],"currentPatchSet":{"number":"8","revision":"e9713db2b2ee3cf0abeb6d93eef730e3dd31970c","parents":["f7cc70fbac79e9f5031906f90d1a9d0a37529e11"],"ref":"refs/changes/76/3076/8","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1514309871,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1513896286,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1513912161,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1513951630,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"SUBM","value":"1","grantedOn":1514311118,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/uts/common/os/kstat_fr.c","type":"MODIFIED","insertions":6,"deletions":0},{"file":"usr/src/uts/common/os/mem_config.c","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/os/vm_pageout.c","type":"MODIFIED","insertions":329,"deletions":-153},{"file":"usr/src/uts/common/sys/vm.h","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/uts/common/sys/vmsystm.h","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/common/vm/vm_page.c","type":"MODIFIED","insertions":7,"deletions":-4},{"file":"usr/src/uts/i86pc/vm/vm_machdep.c","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":351,"sizeDeletions":-160},"patchSets":[{"number":"1","revision":"e01adc597e117dc9b36ed8f0a16bb9db0ed1afd6","parents":["4ff06ef3de4da3187a6599932808d6e674052fad"],"ref":"refs/changes/76/3076/1","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1512763754,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/uts/common/os/vm_pageout.c","line":157,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Should this be \"LL\" or \"ULL\" also (see next comment, too)?"},{"file":"usr/src/uts/common/os/vm_pageout.c","line":157,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"done"},{"file":"usr/src/uts/common/os/vm_pageout.c","line":158,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Should this be LL or ULL?  The kstats above show unsigned counters, and pgcnt_t appears to be \"ulong_t\".\n\nAlso, should PG_64GB be an /etc/system tunable?  i.e. how-much-memory-per-thread?"},{"file":"usr/src/uts/common/os/vm_pageout.c","line":158,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"both done"},{"file":"usr/src/uts/common/os/vm_pageout.c","line":532,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"spelling"},{"file":"usr/src/uts/common/os/vm_pageout.c","line":532,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"fixed"},{"file":"usr/src/uts/common/os/vm_pageout.c","line":542,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Advance tmp by PG_64GB?  What if we need to reduce i (number of threads) to MAX_PSCAN_REGIONS?"},{"file":"usr/src/uts/common/os/vm_pageout.c","line":542,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"I\u0027m not exactly sure what you are asking here, but I did fix this to increment by the initial region size I computed above."},{"file":"usr/src/uts/common/os/vm_pageout.c","line":542,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"I assumed that the regions were capped at 64GB of memory, and what if you had a \u003e 512GB system (8 * 64GB \u003d\u003d 512GB).  The initial region size fix improves things some, but I was concerned that this fix wouldn\u0027t work on a \u003e 512GB RAM system."},{"file":"usr/src/uts/common/os/vm_pageout.c","line":542,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"The regions aren\u0027t really capped at 64GB, since we can increase the region size if it is less than handspreadpages. However, as a practical matter, we\u0027ll use 64GB since on real HW handspread pages is around 15GB for the 256GB machines we\u0027re testing Cassandra on. The default region size here is really only relevant for smaller systems (e.g. 256GB). Once we get to systems with more than 512GB, the MAX_PSCAN_REGIONS (8) will be the limiting factor in how many scanners we\u0027ll have. Each scanner will scan all of memory, so the region size is really just used to spread the scanners out."},{"file":"usr/src/uts/common/os/vm_pageout.c","line":542,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Sorry, I really meant that the region size is used to calculate how many scanners we should have on the lower memory HW. They scanners are spread out evenly in the pageout scanner code."},{"file":"usr/src/uts/common/os/vm_pageout.c","line":789,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"nit: scan"},{"file":"usr/src/uts/common/os/vm_pageout.c","line":789,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"fixed"},{"file":"usr/src/uts/common/os/vm_pageout.c","line":906,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Maybe VERIFY3U?"},{"file":"usr/src/uts/common/os/vm_pageout.c","line":906,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"done"},{"file":"usr/src/uts/common/os/vm_pageout.c","line":908,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Won\u0027t this multiply-init pscan_mutex?  This function launches for ALL of the threads."},{"file":"usr/src/uts/common/os/vm_pageout.c","line":908,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Just to check my understanding (i.e. corrections welcome/wanted), it\u0027s a local variable, so it won\u0027t be initialized, but each scanner thread will have it\u0027s own local mutex.\n\nBut more importantly, I think this mutex only exists for the CPR callback stuff -- at least I couldn\u0027t find any other use of it."},{"file":"usr/src/uts/common/os/vm_pageout.c","line":908,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Oops, yes, pscan_mutex is local.  Never mind."},{"file":"usr/src/uts/common/os/vm_pageout.c","line":908,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"The mutex isn\u0027t very interesting for the CALLB_CPR_INIT macro, other than that the macro depends on a mutex being held. The primary reason for the local mutex here is for the cv_wait at line 922. I\u0027m not really using this mutex for much any more (vs. the old pageout_mutex) but I want to be able to stop all of the threads on the cv_wait when there is no work (the usual state) and then have them all woken by cv_broadcast when there is work to be done."},{"file":"usr/src/uts/common/os/vm_pageout.c","line":930,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Ahhh, I see.  This calculation isn\u0027t made obvious up above when you\u0027re initializing things.  It should be, somehow."},{"file":"usr/src/uts/common/os/vm_pageout.c","line":930,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"I\u0027m not really sure what you\u0027re getting at here. Can you clarify?"},{"file":"usr/src/uts/common/os/vm_pageout.c","line":930,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Goes back to my does-it-break on \u003e 512GB systems.  Calculating offset as total_pages / n_pscan_regions obviates my concern about static no-more-than-64GB regions."},{"file":"usr/src/uts/common/os/vm_pageout.c","line":930,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"OK, hopefully my other response also helped clarify this."},{"file":"usr/src/uts/common/os/vm_pageout.c","line":1120,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Maybe VERIFY3U?"},{"file":"usr/src/uts/common/os/vm_pageout.c","line":1120,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"done"},{"file":"usr/src/uts/common/os/vm_pageout.c","line":1131,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Maybe VERIFY3U?"},{"file":"usr/src/uts/common/os/vm_pageout.c","line":1131,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/os/kstat_fr.c","type":"MODIFIED","insertions":6,"deletions":0},{"file":"usr/src/uts/common/os/mem_config.c","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/os/vm_pageout.c","type":"MODIFIED","insertions":298,"deletions":-156},{"file":"usr/src/uts/common/sys/vm.h","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/uts/common/sys/vmsystm.h","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/common/vm/vm_page.c","type":"MODIFIED","insertions":7,"deletions":-4},{"file":"usr/src/uts/i86pc/vm/vm_machdep.c","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":320,"sizeDeletions":-163},{"number":"2","revision":"61e90d4f87959a7dbf421a5c1ca239716b7aa56d","parents":["8569e68ef8ea068cce30a0547ea01d858ad4c9d2"],"ref":"refs/changes/76/3076/2","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1513095468,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1513097445,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}}],"comments":[{"file":"usr/src/uts/common/os/vm_pageout.c","line":156,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Since this isn\u0027t declared static, will it still be implicitly initialized to 0?"},{"file":"usr/src/uts/common/os/vm_pageout.c","line":156,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"C standard says globals are auto-zeroed w/o an explicit initializer (regardless of static or not)."},{"file":"usr/src/uts/common/os/vm_pageout.c","line":511,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"With the moving of code around, maybe a comment here indicating the default is set to 64GB (in pages)?"},{"file":"usr/src/uts/common/os/vm_pageout.c","line":511,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"I added a comment here and I also added another comment below with some of the additional details we\u0027ve discussed in CR."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/os/kstat_fr.c","type":"MODIFIED","insertions":6,"deletions":0},{"file":"usr/src/uts/common/os/mem_config.c","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/os/vm_pageout.c","type":"MODIFIED","insertions":299,"deletions":-156},{"file":"usr/src/uts/common/sys/vm.h","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/uts/common/sys/vmsystm.h","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/common/vm/vm_page.c","type":"MODIFIED","insertions":7,"deletions":-4},{"file":"usr/src/uts/i86pc/vm/vm_machdep.c","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":321,"sizeDeletions":-163},{"number":"3","revision":"8dc043b80ca2f69ee2cb35cbcb367b2629d92dbd","parents":["8569e68ef8ea068cce30a0547ea01d858ad4c9d2"],"ref":"refs/changes/76/3076/3","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1513108814,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1513108911,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1513111142,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/os/kstat_fr.c","type":"MODIFIED","insertions":6,"deletions":0},{"file":"usr/src/uts/common/os/mem_config.c","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/os/vm_pageout.c","type":"MODIFIED","insertions":315,"deletions":-156},{"file":"usr/src/uts/common/sys/vm.h","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/uts/common/sys/vmsystm.h","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/common/vm/vm_page.c","type":"MODIFIED","insertions":7,"deletions":-4},{"file":"usr/src/uts/i86pc/vm/vm_machdep.c","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":337,"sizeDeletions":-163},{"number":"4","revision":"b0830cbe5c4a8001b0ec364c7bb22e4eb6ba1bd3","parents":["8569e68ef8ea068cce30a0547ea01d858ad4c9d2"],"ref":"refs/changes/76/3076/4","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1513116108,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1513213874,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1513116818,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1513783409,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/os/kstat_fr.c","type":"MODIFIED","insertions":6,"deletions":0},{"file":"usr/src/uts/common/os/mem_config.c","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/os/vm_pageout.c","type":"MODIFIED","insertions":314,"deletions":-156},{"file":"usr/src/uts/common/sys/vm.h","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/uts/common/sys/vmsystm.h","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/common/vm/vm_page.c","type":"MODIFIED","insertions":7,"deletions":-4},{"file":"usr/src/uts/i86pc/vm/vm_machdep.c","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":336,"sizeDeletions":-163},{"number":"5","revision":"b2fe8009f267a425ec97f0169de7aba1d719c311","parents":["43b3bab58788e30af95d6dd211800182624ede96"],"ref":"refs/changes/76/3076/5","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1513884358,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/uts/common/os/vm_pageout.c","line":156,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"per our MM conversation.  \"des\" \u003d\u003d desired is a bit opaque to the first-time reader. More comments cure this opacity."},{"file":"usr/src/uts/common/os/vm_pageout.c","line":971,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"I didn\u0027t know you needed to hold p_lock before lwp_exit().  (Learn something new every day.)"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/os/kstat_fr.c","type":"MODIFIED","insertions":6,"deletions":0},{"file":"usr/src/uts/common/os/mem_config.c","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/os/vm_pageout.c","type":"MODIFIED","insertions":325,"deletions":-153},{"file":"usr/src/uts/common/sys/vm.h","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/uts/common/sys/vmsystm.h","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/common/vm/vm_page.c","type":"MODIFIED","insertions":7,"deletions":-4},{"file":"usr/src/uts/i86pc/vm/vm_machdep.c","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":347,"sizeDeletions":-160},{"number":"6","revision":"a3d57a20935874a8ce2db9cc2a671c0fb23e8809","parents":["43b3bab58788e30af95d6dd211800182624ede96"],"ref":"refs/changes/76/3076/6","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1513891419,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1513912161,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1513896286,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1513951630,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/os/kstat_fr.c","type":"MODIFIED","insertions":6,"deletions":0},{"file":"usr/src/uts/common/os/mem_config.c","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/os/vm_pageout.c","type":"MODIFIED","insertions":329,"deletions":-153},{"file":"usr/src/uts/common/sys/vm.h","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/uts/common/sys/vmsystm.h","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/common/vm/vm_page.c","type":"MODIFIED","insertions":7,"deletions":-4},{"file":"usr/src/uts/i86pc/vm/vm_machdep.c","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":351,"sizeDeletions":-160},{"number":"7","revision":"e588685ff67479649785e12bf21236e1713a30b5","parents":["f7cc70fbac79e9f5031906f90d1a9d0a37529e11"],"ref":"refs/changes/76/3076/7","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1514309773,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1513912161,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1513896286,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1513951630,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/os/kstat_fr.c","type":"MODIFIED","insertions":6,"deletions":0},{"file":"usr/src/uts/common/os/mem_config.c","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/os/vm_pageout.c","type":"MODIFIED","insertions":329,"deletions":-153},{"file":"usr/src/uts/common/sys/vm.h","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/uts/common/sys/vmsystm.h","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/common/vm/vm_page.c","type":"MODIFIED","insertions":7,"deletions":-4},{"file":"usr/src/uts/i86pc/vm/vm_machdep.c","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":351,"sizeDeletions":-160},{"number":"8","revision":"e9713db2b2ee3cf0abeb6d93eef730e3dd31970c","parents":["f7cc70fbac79e9f5031906f90d1a9d0a37529e11"],"ref":"refs/changes/76/3076/8","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1514309871,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"SUBM","value":"1","grantedOn":1514311118,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1513912161,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1513896286,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1513951630,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/uts/common/os/kstat_fr.c","type":"MODIFIED","insertions":6,"deletions":0},{"file":"usr/src/uts/common/os/mem_config.c","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/os/vm_pageout.c","type":"MODIFIED","insertions":329,"deletions":-153},{"file":"usr/src/uts/common/sys/vm.h","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/uts/common/sys/vmsystm.h","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/common/vm/vm_page.c","type":"MODIFIED","insertions":7,"deletions":-4},{"file":"usr/src/uts/i86pc/vm/vm_machdep.c","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":351,"sizeDeletions":-160}],"allReviewers":[{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}]}