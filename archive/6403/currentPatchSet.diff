From 102b66efc066378a972e32289ea858b66851f5e2 Mon Sep 17 00:00:00 2001
From: Isaac Davis <isaac.davis@joyent.com>
Date: Thu, 6 Jun 2019 21:54:09 +0000
Subject: [PATCH] TRITON-1730 Want `sdcadm post-setup common-external-nics` to
 not prompt for confirmation

---
 CHANGES.md                             |  5 +++++
 lib/post-setup/common-external-nics.js | 14 +++++++++++++-
 package.json                           |  2 +-
 3 files changed, 19 insertions(+), 2 deletions(-)

diff --git a/CHANGES.md b/CHANGES.md
index b7902ce..92a3d88 100644
--- a/CHANGES.md
+++ b/CHANGES.md
@@ -10,6 +10,11 @@
 
 # sdcadm Changelog
 
+## 1.29.1
+
+- TRITON-1730 Want `sdcadm post-setup common-external-nics` to not prompt for
+  confirmation
+
 ## 1.29.0
 
 - MANTA-3992 Add `sdcadm post-setup grafana` to setup a core Triton
diff --git a/lib/post-setup/common-external-nics.js b/lib/post-setup/common-external-nics.js
index c9cad3b..58b997c 100644
--- a/lib/post-setup/common-external-nics.js
+++ b/lib/post-setup/common-external-nics.js
@@ -39,7 +39,19 @@ function do_common_external_nics(subcmd, opts, args, cb) {
         log: self.log,
         procs: [ensureNicProc],
         sdcadm: self.sdcadm,
-        ui: self.ui
+        ui: self.ui,
+        /*
+         * Before the introduction of the procedure framework, `post-setup
+         * common-external-nics` did not prompt the user for confirmation.
+         * Scripts that run `post-setup common-external-nics` rely on this
+         * behavior, so we hard-code 'skipConfirm' to 'true' to simulate it.
+         *
+         * This may change in the future -- a longer-term solution is to add
+         * a -y/--yes flag to `post-setup common-external-nics` that skips
+         * confirmation, and then update all of the scripts that run this
+         * procedure to use the new flag.
+         */
+        skipConfirm: true
     }, cb);
 }
 
diff --git a/package.json b/package.json
index e368f2f..4a9bbbf 100644
--- a/package.json
+++ b/package.json
@@ -1,7 +1,7 @@
 {
   "name": "sdcadm",
   "description": "Administer a Triton Data Center",
-  "version": "1.29.0",
+  "version": "1.29.1",
   "author": "Joyent (joyent.com)",
   "private": true,
   "dependencies": {
-- 
2.21.0

