{"project":"joyent/sdc-papi","branch":"master","id":"Ia92fbd969fe72addf42117db4d07dcf16fcfb383","number":"143","subject":"PAPI-129 - add a migration to remove stale attributes from packages.","owner":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"url":"https://cr.joyent.us/143","commitMessage":"PAPI-129 - add a migration to remove stale attributes from packages.\n","createdOn":1469541756,"lastUpdated":1471597462,"open":false,"status":"MERGED","comments":[{"timestamp":1469541756,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Uploaded patch set 1."},{"timestamp":1469542746,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Uploaded patch set 2."},{"timestamp":1469569417,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1471471062,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Uploaded patch set 3: Patch Set 2 was rebased."},{"timestamp":1471471086,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3:\n\n\"make check\" passed ok"},{"timestamp":1471539033,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 3: Code-Review-1\n\n(4 comments)\n\nOther than minor stuff with `return`, looks safe to me but for the fact that it assumes that initial connection to moray will not fail.\n\nHow\u0027re you planning to test integration for this one?"},{"timestamp":1471539046,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 3: Code-Review+1\n\n\u003e (4 comments)\n \u003e \n \u003e Other than minor stuff with `return`, looks safe to me but for the\n \u003e fact that it assumes that initial connection to moray will not\n \u003e fail.\n \u003e \n \u003e How\u0027re you planning to test integration for this one?"},{"timestamp":1471568304,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Uploaded patch set 4."},{"timestamp":1471568328,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1471568750,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 4:\n\n\u003e How\u0027re you planning to test integration for this one?\n\nIt seemed like a fair amount of work for a once-off script, so I tested it by hand alone. Checked the indexes were removed from Postgres, that unsupported attributes I added beforehand were removed, and that everything else was unaffected.\n\nThis is me being lazy. If you think we should have tests for migrations added (yes?), I\u0027ll do so."},{"timestamp":1471595687,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 4: Code-Review+1 Integration-Approval+1\n\n\u003e \u003e How\u0027re you planning to test integration for this one?\n \u003e \n \u003e It seemed like a fair amount of work for a once-off script, so I\n \u003e tested it by hand alone. Checked the indexes were removed from\n \u003e Postgres, that unsupported attributes I added beforehand were\n \u003e removed, and that everything else was unaffected.\n \u003e \n \u003e This is me being lazy. If you think we should have tests for\n \u003e migrations added (yes?), I\u0027ll do so.\n\nNo, it\u0027s OK, as far as we have done some testing that the desired attributes - and not any others - are removed"},{"timestamp":1471597462,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Pedro Palazón Candel"}],"currentPatchSet":{"number":"4","revision":"a92fbd969fe72addf42117db4d07dcf16fcfb383","parents":["51cb2aa558c3281ee1482b74425b586b467402a3"],"ref":"refs/changes/43/143/4","uploader":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"createdOn":1471568304,"author":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1471568328,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1471595687,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1471595687,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"SUBM","value":"1","grantedOn":1471597462,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/migrations/migration-001-remove-stale-attributes.js","type":"ADDED","insertions":149,"deletions":0}],"sizeInsertions":149,"sizeDeletions":0},"patchSets":[{"number":"1","revision":"cd042538c3be98992c5ccc5e751b09bdd7f90a57","parents":["9507daf5bbe0b41b75e4993205064af3ff2e886f"],"ref":"refs/changes/43/143/1","uploader":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"createdOn":1469541756,"author":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/migrations/migration-001-remove-stale-attributes.js","type":"ADDED","insertions":142,"deletions":0}],"sizeInsertions":142,"sizeDeletions":0},{"number":"2","revision":"cf49419e2ef049e21aa5c0d6f4b0132bc1d0380a","parents":["9507daf5bbe0b41b75e4993205064af3ff2e886f"],"ref":"refs/changes/43/143/2","uploader":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"createdOn":1469542746,"author":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1469569417,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"lib/migrations/migration-001-remove-stale-attributes.js","type":"ADDED","insertions":145,"deletions":0}],"sizeInsertions":145,"sizeDeletions":0},{"number":"3","revision":"fe96da869a99155f657165f0a43294a4d4f9e97e","parents":["51cb2aa558c3281ee1482b74425b586b467402a3"],"ref":"refs/changes/43/143/3","uploader":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"createdOn":1471471062,"author":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1469569417,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1471539046,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"comments":[{"file":"lib/migrations/migration-001-remove-stale-attributes.js","line":50,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Q: No `onError` handling?"},{"file":"lib/migrations/migration-001-remove-stale-attributes.js","line":52,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"`return` keyword not needed"},{"file":"lib/migrations/migration-001-remove-stale-attributes.js","line":71,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Again, `return` keyword not needed here"},{"file":"lib/migrations/migration-001-remove-stale-attributes.js","line":102,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Again, couple extra returns"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"lib/migrations/migration-001-remove-stale-attributes.js","type":"ADDED","insertions":145,"deletions":0}],"sizeInsertions":145,"sizeDeletions":0},{"number":"4","revision":"a92fbd969fe72addf42117db4d07dcf16fcfb383","parents":["51cb2aa558c3281ee1482b74425b586b467402a3"],"ref":"refs/changes/43/143/4","uploader":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"createdOn":1471568304,"author":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1471568328,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1471595687,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1471595687,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"SUBM","value":"1","grantedOn":1471597462,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/migrations/migration-001-remove-stale-attributes.js","type":"ADDED","insertions":149,"deletions":0}],"sizeInsertions":149,"sizeDeletions":0}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}]}