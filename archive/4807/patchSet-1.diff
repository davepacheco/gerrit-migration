From 4ddaab32930b4c530d8f3bd56f57413d463674e0 Mon Sep 17 00:00:00 2001
From: Trent Mick <trentm@gmail.com>
Date: Fri, 7 Sep 2018 10:48:56 -0700
Subject: [PATCH] TRITON-760 imgapi-external-manta-setup and imgapi-manta-setup
 were broken by sdc-clients 11.x update in TRITON-53

---
 bin/imgapi-external-manta-setup |  3 ++-
 bin/imgapi-manta-setup          | 13 +++++++------
 2 files changed, 9 insertions(+), 7 deletions(-)

diff --git a/bin/imgapi-external-manta-setup b/bin/imgapi-external-manta-setup
index 1e6bd42..d9b5a31 100755
--- a/bin/imgapi-external-manta-setup
+++ b/bin/imgapi-external-manta-setup
@@ -6,7 +6,7 @@
  */
 
 /*
- * Copyright (c) 2017, Joyent, Inc.
+ * Copyright (c) 2018, Joyent, Inc.
  */
 
 /*
@@ -142,6 +142,7 @@ function main() {
 
     var sapi = new sdcClients.SAPI({
         url: 'http://' + config.sapi_service,
+        version: '~2',
         log: log,
         agent: false
     });
diff --git a/bin/imgapi-manta-setup b/bin/imgapi-manta-setup
index e7843fd..c89f8db 100755
--- a/bin/imgapi-manta-setup
+++ b/bin/imgapi-manta-setup
@@ -6,16 +6,16 @@
  */
 
 /*
- * Copyright (c) 2017, Joyent, Inc.
+ * Copyright (c) 2018, Joyent, Inc.
  */
 
 /*
  * Setup this IMGAPI to use a Manta (for storage) that shares the same master
- * UFDS as this IMGAPI. This IMGAPI+Manta setup (provide the Manta is local,
- * i.e. not across the WAN) is the preferred setup.: local Manta, uses the
- * $ufds_admin_login (typically the "admin" login) user.
+ * UFDS as this IMGAPI. This IMGAPI+Manta setup (provided the Manta is local,
+ * i.e. not across the WAN) is the preferred setup. It uses the
+ * $ufds_admin_login (typically the "admin" login) account.
  *
- * The *alternative* (e.g. to have IMAGE use a Manta with a separate UFDS
+ * The *alternative* (e.g. to have IMGAPI use a Manta with a separate UFDS
  * database) is to use the 'imgapi-external-manta-setup' script in this same
  * directory.
  *
@@ -62,7 +62,7 @@ var bunyan = require('bunyan');
 var log; // set in `main()`
 
 var USAGE = (
-    'Setup IMGAPI in this SmartDataCenter to use a Manta sharing the same\n'
+    'Setup IMGAPI in this TritonDC to use a Manta sharing the same\n'
     + 'master UFDS. Preferrably the Manta is local (i.e. not across the WAN).\n'
     + 'This will do the appropriate setup for all instances of IMGAPI in this\n'
     + 'DC. This is also re-runnable if it fails part way.\n'
@@ -134,6 +134,7 @@ function getMantaUrl(mantaUrl, sdcApp, callback) {
 
     var sapi = new sdcClients.SAPI({
         url: 'http://' + sdcApp.metadata.SAPI_SERVICE,
+        version: '~2',
         log: log,
         agent: false
     });
-- 
2.21.0

