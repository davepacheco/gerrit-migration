{"project":"joyent/illumos-joyent","branch":"master","id":"I3bf32d20a3f6b8bfaabf39e2ef539e46e311e973","number":"1198","subject":"OS-5412 \u0027screen\u0027 doesn\u0027t run on centos7 Reviewed by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e Reviewed by: Ryan Zezeski \u003cryan.zeseski@joyent.com\u003e Approved by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e","owner":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"url":"https://cr.joyent.us/1198","commitMessage":"OS-5412 \u0027screen\u0027 doesn\u0027t run on centos7\nReviewed by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e\nReviewed by: Ryan Zezeski \u003cryan.zeseski@joyent.com\u003e\nApproved by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e\n","createdOn":1483471066,"lastUpdated":1483718727,"open":false,"status":"MERGED","comments":[{"timestamp":1483471066,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 1."},{"timestamp":1483630192,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 1:\n\n(4 comments)"},{"timestamp":1483632899,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1483641492,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1483643186,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 2."},{"timestamp":1483643339,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 2:\n\n(1 comment)\n\nThe rest looks good."},{"timestamp":1483678240,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Patch Set 2: Code-Review+1\n\n(1 comment)"},{"timestamp":1483707328,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 3."},{"timestamp":1483714882,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1483717379,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1483718631,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 3: Integration-Approval+1"},{"timestamp":1483718717,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 4: Commit message was updated."},{"timestamp":1483718727,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Jerry Jelinek"}],"currentPatchSet":{"number":"4","revision":"3bf32d20a3f6b8bfaabf39e2ef539e46e311e973","parents":["437707335ad6e34f26bc0e5c3617f80ae42eea45"],"ref":"refs/changes/98/1198/4","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1483718717,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1483714882,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1483717379,"by":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1483718631,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"SUBM","value":"1","grantedOn":1483718727,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/lib/brand/lx/lx_support/lx_support.c","type":"MODIFIED","insertions":69,"deletions":-1},{"file":"usr/src/uts/common/brand/lx/os/lx_brand.c","type":"MODIFIED","insertions":14,"deletions":-1},{"file":"usr/src/uts/common/brand/lx/sys/lx_brand.h","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/common/brand/lx/syscall/lx_ioctl.c","type":"MODIFIED","insertions":14,"deletions":-2}],"sizeInsertions":100,"sizeDeletions":-5},"patchSets":[{"number":"1","revision":"1a42033629a5b5e974d5c9c6eff9daf17ed08297","parents":["c009bfad466702b7c3f2f59cb69eb07291895b75"],"ref":"refs/changes/98/1198/1","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1483471066,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/lib/brand/lx/lx_support/lx_support.c","line":168,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"It\u0027s a stretch of the truth to say that the behavior we\u0027re emulating is \"proper\".  Perhaps we should reference (either directly or to the other comment) the fact that this is a workaround for absent udev functionality."},{"file":"usr/src/lib/brand/lx/lx_support/lx_support.c","line":216,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"It would not be unreasonable for a group line to be larger than MAXPATHLEN if, for some reason, a group contained a large number of users.  It would be valuable to protect against that by checking for a newline at the end of the fgets()ed buffer.  If it\u0027s missing, logic to pull in the rest of the long line would protect us against long inputs breaking this logic.\n\nI think it would be necessary to trigger this for any of the \u0027continue\u0027 lines."},{"file":"usr/src/lib/brand/lx/lx_support/lx_support.c","line":216,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"I actually considered this case and I believe the existing code handles it since it will continue on if it is presented with the remaining list of users in a group that exceeded the buffer from the initial read. Is there a specific problem here that I overlooked?"},{"file":"usr/src/lib/brand/lx/lx_support/lx_support.c","line":216,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Yeah, I suppose it does successfully \"walk over\" an excessively long line.  The only downside to the current behavior is it will perform unnecessary strchr() searches for \u0027:\u0027 when handling the tail portion of long lines.\n\nConsidering that such cases are probably rare, leaving it as-is should be fine. (Although perhaps a small comment about how too-long lines are handled would be nice)"},{"file":"usr/src/uts/common/brand/lx/os/lx_brand.c","line":416,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"If the incoming data is too small, we\u0027ll have stack garbage in \u0027gid\u0027.  Either the above range check should be \u0027\u003d\u003d\u0027 or \u0027gid\u0027 should be initialized to zero."},{"file":"usr/src/uts/common/brand/lx/sys/lx_brand.h","line":610,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Perhaps make the description more specific.  IMO it\u0027s more important that this is being used to auto-chown() ptys rather than the fact that it came from /etc/group.  (at least in the context of LX IKE)"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/brand/lx/lx_support/lx_support.c","type":"MODIFIED","insertions":63,"deletions":-1},{"file":"usr/src/uts/common/brand/lx/os/lx_brand.c","type":"MODIFIED","insertions":14,"deletions":-1},{"file":"usr/src/uts/common/brand/lx/sys/lx_brand.h","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/common/brand/lx/syscall/lx_ioctl.c","type":"MODIFIED","insertions":14,"deletions":-2}],"sizeInsertions":94,"sizeDeletions":-5},{"number":"2","revision":"421453443025db5358129fcaa7afe89c49e8deb6","parents":["0efa8e67ace399ce33019a8701bfe0a23ed037af"],"ref":"refs/changes/98/1198/2","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1483643186,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1483678240,"by":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"}}],"comments":[{"file":"usr/src/lib/brand/lx/lx_support/lx_support.c","line":169,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Nix \u0027but\u0027 and split this into two sentences."},{"file":"usr/src/uts/common/brand/lx/syscall/lx_ioctl.c","line":1033,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"I find the \"Real\" qualifier to be redundant, Linux is Linux, lx is lx -- but that\u0027s just me."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/brand/lx/lx_support/lx_support.c","type":"MODIFIED","insertions":69,"deletions":-1},{"file":"usr/src/uts/common/brand/lx/os/lx_brand.c","type":"MODIFIED","insertions":14,"deletions":-1},{"file":"usr/src/uts/common/brand/lx/sys/lx_brand.h","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/common/brand/lx/syscall/lx_ioctl.c","type":"MODIFIED","insertions":14,"deletions":-2}],"sizeInsertions":100,"sizeDeletions":-5},{"number":"3","revision":"1371bffc2045ea8fed591f63f5e118ab21353a76","parents":["437707335ad6e34f26bc0e5c3617f80ae42eea45"],"ref":"refs/changes/98/1198/3","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1483707328,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1483714882,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1483718631,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1483717379,"by":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/brand/lx/lx_support/lx_support.c","type":"MODIFIED","insertions":69,"deletions":-1},{"file":"usr/src/uts/common/brand/lx/os/lx_brand.c","type":"MODIFIED","insertions":14,"deletions":-1},{"file":"usr/src/uts/common/brand/lx/sys/lx_brand.h","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/common/brand/lx/syscall/lx_ioctl.c","type":"MODIFIED","insertions":14,"deletions":-2}],"sizeInsertions":100,"sizeDeletions":-5},{"number":"4","revision":"3bf32d20a3f6b8bfaabf39e2ef539e46e311e973","parents":["437707335ad6e34f26bc0e5c3617f80ae42eea45"],"ref":"refs/changes/98/1198/4","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1483718717,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"SUBM","value":"1","grantedOn":1483718727,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1483714882,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1483718631,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1483717379,"by":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/lib/brand/lx/lx_support/lx_support.c","type":"MODIFIED","insertions":69,"deletions":-1},{"file":"usr/src/uts/common/brand/lx/os/lx_brand.c","type":"MODIFIED","insertions":14,"deletions":-1},{"file":"usr/src/uts/common/brand/lx/sys/lx_brand.h","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/common/brand/lx/syscall/lx_ioctl.c","type":"MODIFIED","insertions":14,"deletions":-2}],"sizeInsertions":100,"sizeDeletions":-5}],"allReviewers":[{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}]}