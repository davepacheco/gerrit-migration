{"project":"joyent/illumos-joyent","branch":"master","id":"I33df115038809a05a8856b165fabdb823350567e","number":"1095","subject":"OS-5363 dlmgmtd forking with write locks results in deadlock chaos OS-5919 remove zone lock file Reviewed by: Robert Mustacchi \u003crm@joyent.com\u003e Reviewed by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e Approved by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e","owner":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"url":"https://cr.joyent.us/1095","commitMessage":"OS-5363 dlmgmtd forking with write locks results in deadlock chaos\nOS-5919 remove zone lock file\nReviewed by: Robert Mustacchi \u003crm@joyent.com\u003e\nReviewed by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e\nApproved by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e\n","createdOn":1481237183,"lastUpdated":1485796925,"open":false,"status":"MERGED","comments":[{"timestamp":1481237183,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Uploaded patch set 1."},{"timestamp":1481237871,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Patch Set 1: Code-Review-1\n\nThis is WIP, just posted it to share what I have thus far."},{"timestamp":1481325573,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Uploaded patch set 2."},{"timestamp":1481572573,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Uploaded patch set 3."},{"timestamp":1481755371,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Uploaded patch set 4."},{"timestamp":1481827147,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Patch Set 4: -Code-Review"},{"timestamp":1481851237,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Uploaded patch set 5."},{"timestamp":1481919307,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 5:\n\n(3 comments)\n\nIn addition to the comments on specific code, I don\u0027t see the code in this review which actually assigns/creates the new transient links on the zone."},{"timestamp":1482166883,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Uploaded patch set 6."},{"timestamp":1482167295,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Patch Set 5:\n\n(3 comments)"},{"timestamp":1482326033,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 6: Code-Review+1"},{"timestamp":1482771536,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 6:\n\n(8 comments)\n\nThanks for doing a lot of the clean up here Ryan. In general, I think this is looking good."},{"timestamp":1482943186,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Patch Set 6:\n\n(8 comments)"},{"timestamp":1482943970,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Uploaded patch set 7."},{"timestamp":1482944329,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Uploaded patch set 8."},{"timestamp":1482973118,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 8:\n\n(3 comments)\n\nThanks for working through this. I have a minor comment on the current changeset and some follow up to your previous comments, not sure that\u0027ll show up correctly or not so I wanted to mention it here."},{"timestamp":1483035427,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Patch Set 8:\n\n(3 comments)"},{"timestamp":1483036268,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Uploaded patch set 9."},{"timestamp":1483058716,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 9:\n\n(1 comment)"},{"timestamp":1483060111,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Patch Set 9:\n\n(1 comment)"},{"timestamp":1483060336,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 9: Code-Review+1\n\n(1 comment)"},{"timestamp":1483450198,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 9: Code-Review+1"},{"timestamp":1485287151,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Uploaded patch set 10."},{"timestamp":1485296614,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 10: Code-Review+1"},{"timestamp":1485471897,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 10: Code-Review+1"},{"timestamp":1485474847,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Patch Set 10:\n\nTest notes:\n\nThe short of it: I ran a mass zone start/stop along with a dladm stress script which produced deadlocks on the current PI but didn\u0027t on my patched PI. I am confident that these changes are an improvement on the existing code and should greatly reduce if not completely eliminate our \"Manta has stuck zones\" issue.\n\nI merged the OS-3506, OS-5363 and OS-5919 patches into one branch and tested them as a single unit (though I think they should be pushed separate so that the patches can be easily differentiated during code archeology). But before I tested my patches I first made sure I could replicate the bugs on the existing PI (20161222T003450Z). The zone lock file was actually doing it\u0027s job and preventing the concurrency needed to induce the deadlock; but if you induce enough load there is a provision in the lock file code to force drop the lock after 60s of waiting and give it to a new owner, thus allowing concurrent access when there should be none. So I just modified the zone lock logic to immediately drop the lock after acquiring it to fake this 60s timeout and allow more concurrency. Sure enough after making this change I was able to easily replicate several occurrences of the OS-3506 deadlock. I was never able to replicate OS-5363, probably because it\u0027s a trickier three-way deadlock and is hard to hit before hitting OS-3506. After a few days of chasing OS-5363 I gave up and ran my tests on my patched PI. I found a new deadlock introduced by my fix in OS-3506 but then I found a way to fix that deadlock without reintroducing the original one. After that modification I was able to run my stress test many times with no deadlock. With enough dladm load and concurrent zone shutdowns I can induce some EBUSY failures but the zones can eventually be stopped with \"vmadm stop -f\" when needed. Since this is not a deadlock I consider it out of scope for this ticket and is something we should potentially improve under another ticket. So what was my actual test? Here is the rundown:\n\n* Create 121 native zones. There is noting special about 121, I actually meant to do 120 but had an off-by-one error.\n\n* Write a script to loop through all zones and either start or stop them depending on a) if the zone was even or odd and b) the argument to the script. I would type \"./dlt-test ping\" and that would start half and stop half; then I would type \"./dlt-test pong\" and that would stop the half that was previously started and start the other half. Each start/stop command was run as a background process. Between every 9 operations there was a sleep for 1 second as an attempt to get more concurrency between start/stop operations (the stop op is quicker than start).\n\n* I would run the above script a few times as an initial test to make sure mass start/stop didn\u0027t cause an issue. If it passed this test I added dladm load.\n\n* I created another script to generate dladm load. I would do a dladm show-link, show-vnic, and show-phys in a for loop, typically 8 times, and run each command as a background process. This for loop was then put in a while true loop where it slept 1 second between each for loop. So each second 24 dladm commands were generated.\n\n* My main stress test was to run the mass start/stop script and the dladm load script concurrently. I would let the dladm script run in the background while I continuously ran the dlt-test ping/pong stages. I would first wait for each stage to finish by looking on pgrep \u0027^zoneadm$\u0027 and waiting for all requests to finish. This stress test not only generated plenty of deadlocks but also locked up my machine at least 7 times -- so it was definitely stressing the system.\n\n* On some tests I also added various dtrace probes to dlmgmtd/dls/mac just to slow things down even more and try to induce more unique concurrent executions."},{"timestamp":1485475020,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 10: Integration-Approval+1"},{"timestamp":1485796605,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Uploaded patch set 11: Patch Set 10 was rebased."},{"timestamp":1485796686,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Uploaded patch set 12: Commit message was updated."},{"timestamp":1485796881,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Project policy requires all submissions to be a fast-forward.\n\nPlease rebase the change locally and upload again for review."},{"timestamp":1485796915,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Uploaded patch set 13: Patch Set 12 was rebased."},{"timestamp":1485796925,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Ryan Zezeski"}],"currentPatchSet":{"number":"13","revision":"33df115038809a05a8856b165fabdb823350567e","parents":["aefd5a8c21e439a1955ccb6b19739e9bf7e8cec3"],"ref":"refs/changes/95/1095/13","uploader":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"createdOn":1485796915,"author":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1485296614,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1485471897,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1485475020,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"SUBM","value":"1","grantedOn":1485796925,"by":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"usr/src/cmd/dlmgmtd/dlmgmt_db.c","type":"MODIFIED","insertions":3,"deletions":-66},{"file":"usr/src/cmd/dlmgmtd/dlmgmt_door.c","type":"MODIFIED","insertions":19,"deletions":-53},{"file":"usr/src/cmd/dlmgmtd/dlmgmt_impl.h","type":"MODIFIED","insertions":2,"deletions":-6},{"file":"usr/src/cmd/dlmgmtd/dlmgmt_main.c","type":"MODIFIED","insertions":1,"deletions":-3},{"file":"usr/src/cmd/dlmgmtd/dlmgmt_util.c","type":"MODIFIED","insertions":24,"deletions":-5},{"file":"usr/src/cmd/zoneadmd/Makefile.com","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"usr/src/cmd/zoneadmd/vplat.c","type":"MODIFIED","insertions":82,"deletions":0},{"file":"usr/src/lib/libdladm/common/libdlmgmt.c","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"usr/src/uts/common/io/dls/dls_mgmt.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/common/os/zone.c","type":"MODIFIED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/sys/dls_mgmt.h","type":"MODIFIED","insertions":6,"deletions":-2}],"sizeInsertions":156,"sizeDeletions":-140},"patchSets":[{"number":"1","revision":"b9e78e2638d17fc03705ddb83e34ef4e9daaa036","parents":["ae3fecfc6c7e5d6f71984cb725e7edcd55045a79"],"ref":"refs/changes/95/1095/1","uploader":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"createdOn":1481237183,"author":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"-1","grantedOn":1481237871,"by":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/dlmgmtd/dlmgmt_db.c","type":"MODIFIED","insertions":2,"deletions":-65},{"file":"usr/src/cmd/dlmgmtd/dlmgmt_door.c","type":"MODIFIED","insertions":35,"deletions":-26},{"file":"usr/src/cmd/dlmgmtd/dlmgmt_impl.h","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/cmd/dlmgmtd/dlmgmt_util.c","type":"MODIFIED","insertions":22,"deletions":-1},{"file":"usr/src/cmd/zoneadmd/Makefile.com","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/cmd/zoneadmd/vplat.c","type":"MODIFIED","insertions":120,"deletions":0},{"file":"usr/src/lib/libdladm/common/libdlmgmt.c","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"usr/src/uts/common/io/dls/dls_mgmt.c","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/uts/common/sys/dls_mgmt.h","type":"MODIFIED","insertions":20,"deletions":-1}],"sizeInsertions":211,"sizeDeletions":-95},{"number":"2","revision":"9943ba267c9f15104dd7c98818b0fceb502b1e69","parents":["176e482195a7e54ca478f2dd86c77d34f0ca3934"],"ref":"refs/changes/95/1095/2","uploader":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"createdOn":1481325573,"author":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"-1","grantedOn":1481237871,"by":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/dlmgmtd/dlmgmt_db.c","type":"MODIFIED","insertions":3,"deletions":-66},{"file":"usr/src/cmd/dlmgmtd/dlmgmt_door.c","type":"MODIFIED","insertions":36,"deletions":-27},{"file":"usr/src/cmd/dlmgmtd/dlmgmt_impl.h","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/cmd/dlmgmtd/dlmgmt_util.c","type":"MODIFIED","insertions":23,"deletions":-2},{"file":"usr/src/cmd/zoneadmd/Makefile.com","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"usr/src/cmd/zoneadmd/vplat.c","type":"MODIFIED","insertions":103,"deletions":0},{"file":"usr/src/lib/libdladm/common/libdlmgmt.c","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"usr/src/uts/common/io/dls/dls_mgmt.c","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"usr/src/uts/common/sys/dls_mgmt.h","type":"MODIFIED","insertions":6,"deletions":-2}],"sizeInsertions":187,"sizeDeletions":-103},{"number":"3","revision":"dd72025a1b0e9fae82af5632b4d7d9a3a2c1e144","parents":["176e482195a7e54ca478f2dd86c77d34f0ca3934"],"ref":"refs/changes/95/1095/3","uploader":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"createdOn":1481572573,"author":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"-1","grantedOn":1481237871,"by":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/dlmgmtd/dlmgmt_db.c","type":"MODIFIED","insertions":3,"deletions":-66},{"file":"usr/src/cmd/dlmgmtd/dlmgmt_door.c","type":"MODIFIED","insertions":21,"deletions":-33},{"file":"usr/src/cmd/dlmgmtd/dlmgmt_impl.h","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/cmd/dlmgmtd/dlmgmt_util.c","type":"MODIFIED","insertions":25,"deletions":-7},{"file":"usr/src/cmd/zoneadmd/Makefile.com","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"usr/src/cmd/zoneadmd/vplat.c","type":"MODIFIED","insertions":95,"deletions":0},{"file":"usr/src/lib/libdladm/common/libdlmgmt.c","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"usr/src/uts/common/io/dls/dls_mgmt.c","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"usr/src/uts/common/sys/dls_mgmt.h","type":"MODIFIED","insertions":6,"deletions":-2}],"sizeInsertions":168,"sizeDeletions":-114},{"number":"4","revision":"e70ca6cc3cb9a31a70f3779639ca9883a6a9950f","parents":["176e482195a7e54ca478f2dd86c77d34f0ca3934"],"ref":"refs/changes/95/1095/4","uploader":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"createdOn":1481755371,"author":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/dlmgmtd/dlmgmt_db.c","type":"MODIFIED","insertions":3,"deletions":-66},{"file":"usr/src/cmd/dlmgmtd/dlmgmt_door.c","type":"MODIFIED","insertions":19,"deletions":-53},{"file":"usr/src/cmd/dlmgmtd/dlmgmt_impl.h","type":"MODIFIED","insertions":2,"deletions":-4},{"file":"usr/src/cmd/dlmgmtd/dlmgmt_main.c","type":"MODIFIED","insertions":1,"deletions":-3},{"file":"usr/src/cmd/dlmgmtd/dlmgmt_util.c","type":"MODIFIED","insertions":25,"deletions":-7},{"file":"usr/src/cmd/zoneadmd/Makefile.com","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"usr/src/cmd/zoneadmd/vplat.c","type":"MODIFIED","insertions":95,"deletions":0},{"file":"usr/src/lib/libdladm/common/libdlmgmt.c","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"usr/src/uts/common/io/dls/dls_mgmt.c","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"usr/src/uts/common/sys/dls_mgmt.h","type":"MODIFIED","insertions":6,"deletions":-2}],"sizeInsertions":167,"sizeDeletions":-139},{"number":"5","revision":"068af5b86f7cf69e06b3ead663442ca92e63e28b","parents":["6dec4b8146b2d4a9b4bc5b69d92611009b363154"],"ref":"refs/changes/95/1095/5","uploader":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"createdOn":1481851237,"author":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/cmd/dlmgmtd/dlmgmt_util.c","line":393,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"It looks like you have changed the semantics of this function so that it always loans out the link, whereas before it would only loan it out if it belonged to a NGZ. Is this change correct?"},{"file":"usr/src/cmd/dlmgmtd/dlmgmt_util.c","line":393,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"I made a mistake when I read this function last week -- thinking if it was called the link _must_ belong to NGZ. Obviously that was wrong. But I did want to make sure that we set onloan in the second case where the link belongs to NGZ and we add it to the zone\u0027s list."},{"file":"usr/src/cmd/zoneadmd/vplat.c","line":5183,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Why can\u0027t you have an exclusive stack zone with no links assigned? I don\u0027t think zoneadmd should crash if we hit this case."},{"file":"usr/src/cmd/zoneadmd/vplat.c","line":5183,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"You\u0027re right, this is pretty obvious. Not sure what I was thinking last week."},{"file":"usr/src/uts/common/io/dls/dls_mgmt.c","line":181,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"This comment needs to be removed or improved to be useful before you can integrate."},{"file":"usr/src/uts/common/io/dls/dls_mgmt.c","line":181,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Removed."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/dlmgmtd/dlmgmt_db.c","type":"MODIFIED","insertions":3,"deletions":-66},{"file":"usr/src/cmd/dlmgmtd/dlmgmt_door.c","type":"MODIFIED","insertions":19,"deletions":-53},{"file":"usr/src/cmd/dlmgmtd/dlmgmt_impl.h","type":"MODIFIED","insertions":2,"deletions":-6},{"file":"usr/src/cmd/dlmgmtd/dlmgmt_main.c","type":"MODIFIED","insertions":1,"deletions":-3},{"file":"usr/src/cmd/dlmgmtd/dlmgmt_util.c","type":"MODIFIED","insertions":25,"deletions":-7},{"file":"usr/src/cmd/zoneadmd/Makefile.com","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"usr/src/cmd/zoneadmd/vplat.c","type":"MODIFIED","insertions":81,"deletions":0},{"file":"usr/src/lib/libdladm/common/libdlmgmt.c","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"usr/src/uts/common/io/dls/dls_mgmt.c","type":"MODIFIED","insertions":7,"deletions":-2},{"file":"usr/src/uts/common/sys/dls_mgmt.h","type":"MODIFIED","insertions":6,"deletions":-2}],"sizeInsertions":154,"sizeDeletions":-142},{"number":"6","revision":"6f38e0192c7146e6aa39298d34f5c01c35e3102f","parents":["6dec4b8146b2d4a9b4bc5b69d92611009b363154"],"ref":"refs/changes/95/1095/6","uploader":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"createdOn":1482166883,"author":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1482326033,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"comments":[{"file":"usr/src/cmd/dlmgmtd/dlmgmt_util.c","line":358,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"The criteria for being on loan as described in this comment are a little confusing to me. I think we could probably change \u0027belongs to an NGZ and thus ...\u0027 to something that better explains this. As to me, something which belongs to the NGZ is actually something that matches the \u0027zone_check_datalink()\u0027 case being true. As in the zone actually created it or it was assigned to it in the zonecfg.\n\nWhere as when we rename in the link to the zone transiently, that feels more like loaning. I\u0027m not sure I have a good suggestion here though."},{"file":"usr/src/cmd/dlmgmtd/dlmgmt_util.c","line":358,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Well, first off, it seems my comment changes were rearranged somewhere along the line so it doesn\u0027t actually read as I intended. Second, I think you\u0027re observations make sense and I will tweak the comment a bit more."},{"file":"usr/src/cmd/dlmgmtd/dlmgmt_util.c","line":358,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I think this is better, but I have to admit it\u0027s still not clear to me. I think where I\u0027m having trouble is mapping \u0027assigned to an NGZ\u0027 to the case of being on the zone\u0027s datalink list from zonecfg, versus something we\u0027ve just transitively renamed into the zone. I\u0027m not sure I have a good suggestion for what\u0027d be clearer. So maybe we should just go with what we have."},{"file":"usr/src/cmd/dlmgmtd/dlmgmt_util.c","line":358,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Yea, unfortunately I don\u0027t understand the point you are making. I think an actual voice convo would help -- I still find the assignment/onloan semantics to be confusing. It would be nice to compare our understanding of these. For now I\u0027ll leave the comment as-is."},{"file":"usr/src/cmd/dlmgmtd/dlmgmt_util.c","line":443,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Should it be illegal to specify DLMGMT_TRANSIENT and DLMGMT_PERSIST?"},{"file":"usr/src/cmd/dlmgmtd/dlmgmt_util.c","line":443,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Yea, I suppose so since transient implies active only (e.g. in dladm\u0027s do_create_vnic())."},{"file":"usr/src/cmd/zoneadmd/vplat.c","line":5159,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Maybe worth spelling this out. Like \u0027via the kernel\u0027s zone specific data callbacks\u0027?"},{"file":"usr/src/cmd/zoneadmd/vplat.c","line":5159,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Will do."},{"file":"usr/src/cmd/zoneadmd/vplat.c","line":5179,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"You should probably check for a negative value here. The kernel seems to treat this value as a uint_t, but then copies it out to an int, meaning that we could have a negative value theoretically (though that\u0027d be a lot of datalinks!)."},{"file":"usr/src/cmd/zoneadmd/vplat.c","line":5179,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Perhaps I should just cast back to uint_t (or modify the API and all of its consumers)? I don\u0027t see us having more than INT_MAX data links any time soon so if I keep it as int and  add the check I\u0027d want it to be an assert or verify. Would you agree?"},{"file":"usr/src/cmd/zoneadmd/vplat.c","line":5179,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"When it\u0027s not an invariant that you\u0027re responsible for, I\u0027m not sure that aborting is useful. I\u0027d probably just have the kernel return EOVERFLOW if it\u0027s greater than INT_MAX for the moment."},{"file":"usr/src/cmd/zoneadmd/vplat.c","line":5179,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Okay, I\u0027ll add that logic to zone_list_datalink()."},{"file":"usr/src/cmd/zoneadmd/vplat.c","line":5185,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Missing space for the string concatentation. Conventionally, we always have the trailing space like the trailing operator."},{"file":"usr/src/cmd/zoneadmd/vplat.c","line":5185,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Ack."},{"file":"usr/src/cmd/zoneadmd/vplat.c","line":5193,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Should probably be consistent with everything else and use the trailing space on the previous line rather than a leading space on the next."},{"file":"usr/src/cmd/zoneadmd/vplat.c","line":5193,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Will do."},{"file":"usr/src/cmd/zoneadmd/vplat.c","line":5205,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"We should probably include what the status value was that failed. Otherwise, it\u0027s going to be hard to make forward progress if this happens in the field."},{"file":"usr/src/cmd/zoneadmd/vplat.c","line":5205,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Will do."},{"file":"usr/src/cmd/zoneadmd/vplat.c","line":5209,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Why should we assume that a zone only has VNICs? Shouldn\u0027t this happen after we have determined that we have a transient link? Is there something in zone_list_datalink() that indicates this filters to only vnics?"},{"file":"usr/src/cmd/zoneadmd/vplat.c","line":5209,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"You\u0027re right, there could be other classes of data links assigned to the zone, but only VNICs can be transient. So I\u0027ll move the check into the following if block."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/dlmgmtd/dlmgmt_db.c","type":"MODIFIED","insertions":3,"deletions":-66},{"file":"usr/src/cmd/dlmgmtd/dlmgmt_door.c","type":"MODIFIED","insertions":19,"deletions":-53},{"file":"usr/src/cmd/dlmgmtd/dlmgmt_impl.h","type":"MODIFIED","insertions":2,"deletions":-6},{"file":"usr/src/cmd/dlmgmtd/dlmgmt_main.c","type":"MODIFIED","insertions":1,"deletions":-3},{"file":"usr/src/cmd/dlmgmtd/dlmgmt_util.c","type":"MODIFIED","insertions":23,"deletions":-5},{"file":"usr/src/cmd/zoneadmd/Makefile.com","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"usr/src/cmd/zoneadmd/vplat.c","type":"MODIFIED","insertions":78,"deletions":0},{"file":"usr/src/lib/libdladm/common/libdlmgmt.c","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"usr/src/uts/common/io/dls/dls_mgmt.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/common/sys/dls_mgmt.h","type":"MODIFIED","insertions":6,"deletions":-2}],"sizeInsertions":144,"sizeDeletions":-140},{"number":"7","revision":"68cc93c8cae306829cc7a2b0d22d565924a01196","parents":["8572b2205bd02bfe3a6fe609833f8450b8c263d7"],"ref":"refs/changes/95/1095/7","uploader":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"createdOn":1482943970,"author":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/dlmgmtd/dlmgmt_db.c","type":"MODIFIED","insertions":3,"deletions":-66},{"file":"usr/src/cmd/dlmgmtd/dlmgmt_door.c","type":"MODIFIED","insertions":19,"deletions":-53},{"file":"usr/src/cmd/dlmgmtd/dlmgmt_impl.h","type":"MODIFIED","insertions":2,"deletions":-6},{"file":"usr/src/cmd/dlmgmtd/dlmgmt_main.c","type":"MODIFIED","insertions":1,"deletions":-3},{"file":"usr/src/cmd/dlmgmtd/dlmgmt_util.c","type":"MODIFIED","insertions":24,"deletions":-5},{"file":"usr/src/cmd/zoneadmd/Makefile.com","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"usr/src/cmd/zoneadmd/vplat.c","type":"MODIFIED","insertions":78,"deletions":0},{"file":"usr/src/lib/libdladm/common/libdlmgmt.c","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"usr/src/uts/common/io/dls/dls_mgmt.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/common/sys/dls_mgmt.h","type":"MODIFIED","insertions":6,"deletions":-2}],"sizeInsertions":145,"sizeDeletions":-140},{"number":"8","revision":"9f1d9903113ab4d4218e851d2b18daa6ccb91859","parents":["8572b2205bd02bfe3a6fe609833f8450b8c263d7"],"ref":"refs/changes/95/1095/8","uploader":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"createdOn":1482944329,"author":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/cmd/zoneadmd/vplat.c","line":5203,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Setting zerror to B_TRUE here won\u0027t actually print the error message, because it\u0027s a dladm status error that we get back and errno could be arbitrary. You probably want to use dladm_status2str() to convert status to a string or include the value of status.."},{"file":"usr/src/cmd/zoneadmd/vplat.c","line":5203,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Good catch, I\u0027ll update this."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/dlmgmtd/dlmgmt_db.c","type":"MODIFIED","insertions":3,"deletions":-66},{"file":"usr/src/cmd/dlmgmtd/dlmgmt_door.c","type":"MODIFIED","insertions":19,"deletions":-53},{"file":"usr/src/cmd/dlmgmtd/dlmgmt_impl.h","type":"MODIFIED","insertions":2,"deletions":-6},{"file":"usr/src/cmd/dlmgmtd/dlmgmt_main.c","type":"MODIFIED","insertions":1,"deletions":-3},{"file":"usr/src/cmd/dlmgmtd/dlmgmt_util.c","type":"MODIFIED","insertions":24,"deletions":-5},{"file":"usr/src/cmd/zoneadmd/Makefile.com","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"usr/src/cmd/zoneadmd/vplat.c","type":"MODIFIED","insertions":78,"deletions":0},{"file":"usr/src/lib/libdladm/common/libdlmgmt.c","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"usr/src/uts/common/io/dls/dls_mgmt.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/common/sys/dls_mgmt.h","type":"MODIFIED","insertions":6,"deletions":-2}],"sizeInsertions":145,"sizeDeletions":-140},{"number":"9","revision":"d3bddeed77801767954767e1da0cf86acab56082","parents":["8572b2205bd02bfe3a6fe609833f8450b8c263d7"],"ref":"refs/changes/95/1095/9","uploader":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"createdOn":1483036268,"author":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1483060336,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1483450198,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"comments":[{"file":"usr/src/cmd/zoneadmd/vplat.c","line":5206,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"If we\u0027re changing this to include the link id, should we include the human readable name that it used to have?"},{"file":"usr/src/cmd/zoneadmd/vplat.c","line":5206,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Since this message indicates a failed dladm_datalink_id2info() call I figure I can\u0027t rely on link_name being filled out, so I just added the link id in case it might be useful."},{"file":"usr/src/cmd/zoneadmd/vplat.c","line":5206,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Ah right, of course. Sorry I missed that."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/dlmgmtd/dlmgmt_db.c","type":"MODIFIED","insertions":3,"deletions":-66},{"file":"usr/src/cmd/dlmgmtd/dlmgmt_door.c","type":"MODIFIED","insertions":19,"deletions":-53},{"file":"usr/src/cmd/dlmgmtd/dlmgmt_impl.h","type":"MODIFIED","insertions":2,"deletions":-6},{"file":"usr/src/cmd/dlmgmtd/dlmgmt_main.c","type":"MODIFIED","insertions":1,"deletions":-3},{"file":"usr/src/cmd/dlmgmtd/dlmgmt_util.c","type":"MODIFIED","insertions":24,"deletions":-5},{"file":"usr/src/cmd/zoneadmd/Makefile.com","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"usr/src/cmd/zoneadmd/vplat.c","type":"MODIFIED","insertions":82,"deletions":0},{"file":"usr/src/lib/libdladm/common/libdlmgmt.c","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"usr/src/uts/common/io/dls/dls_mgmt.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/common/os/zone.c","type":"MODIFIED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/sys/dls_mgmt.h","type":"MODIFIED","insertions":6,"deletions":-2}],"sizeInsertions":156,"sizeDeletions":-140},{"number":"10","revision":"a92dfac3d4644e60f082b8562477e4f8344561e1","parents":["39356c1d4443c2428f28abe318c71c6ebb2ed256"],"ref":"refs/changes/95/1095/10","uploader":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"createdOn":1485287151,"author":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1485471897,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1485296614,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1485475020,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"usr/src/cmd/dlmgmtd/dlmgmt_db.c","type":"MODIFIED","insertions":3,"deletions":-66},{"file":"usr/src/cmd/dlmgmtd/dlmgmt_door.c","type":"MODIFIED","insertions":19,"deletions":-53},{"file":"usr/src/cmd/dlmgmtd/dlmgmt_impl.h","type":"MODIFIED","insertions":2,"deletions":-6},{"file":"usr/src/cmd/dlmgmtd/dlmgmt_main.c","type":"MODIFIED","insertions":1,"deletions":-3},{"file":"usr/src/cmd/dlmgmtd/dlmgmt_util.c","type":"MODIFIED","insertions":24,"deletions":-5},{"file":"usr/src/cmd/zoneadmd/Makefile.com","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"usr/src/cmd/zoneadmd/vplat.c","type":"MODIFIED","insertions":82,"deletions":0},{"file":"usr/src/lib/libdladm/common/libdlmgmt.c","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"usr/src/uts/common/io/dls/dls_mgmt.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/common/os/zone.c","type":"MODIFIED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/sys/dls_mgmt.h","type":"MODIFIED","insertions":6,"deletions":-2}],"sizeInsertions":156,"sizeDeletions":-140},{"number":"11","revision":"ba1973f250eeb028ee0f2e738d0074f5da7d4cd4","parents":["65823f66c8745c2c8da123b632a68cabacd94799"],"ref":"refs/changes/95/1095/11","uploader":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"createdOn":1485796605,"author":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1485471897,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1485296614,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1485475020,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"usr/src/cmd/dlmgmtd/dlmgmt_db.c","type":"MODIFIED","insertions":3,"deletions":-66},{"file":"usr/src/cmd/dlmgmtd/dlmgmt_door.c","type":"MODIFIED","insertions":19,"deletions":-53},{"file":"usr/src/cmd/dlmgmtd/dlmgmt_impl.h","type":"MODIFIED","insertions":2,"deletions":-6},{"file":"usr/src/cmd/dlmgmtd/dlmgmt_main.c","type":"MODIFIED","insertions":1,"deletions":-3},{"file":"usr/src/cmd/dlmgmtd/dlmgmt_util.c","type":"MODIFIED","insertions":24,"deletions":-5},{"file":"usr/src/cmd/zoneadmd/Makefile.com","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"usr/src/cmd/zoneadmd/vplat.c","type":"MODIFIED","insertions":82,"deletions":0},{"file":"usr/src/lib/libdladm/common/libdlmgmt.c","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"usr/src/uts/common/io/dls/dls_mgmt.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/common/os/zone.c","type":"MODIFIED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/sys/dls_mgmt.h","type":"MODIFIED","insertions":6,"deletions":-2}],"sizeInsertions":156,"sizeDeletions":-140},{"number":"12","revision":"c00cef813cd39756573c89350286ffac05f06201","parents":["65823f66c8745c2c8da123b632a68cabacd94799"],"ref":"refs/changes/95/1095/12","uploader":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"createdOn":1485796686,"author":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1485471897,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1485296614,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1485475020,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"usr/src/cmd/dlmgmtd/dlmgmt_db.c","type":"MODIFIED","insertions":3,"deletions":-66},{"file":"usr/src/cmd/dlmgmtd/dlmgmt_door.c","type":"MODIFIED","insertions":19,"deletions":-53},{"file":"usr/src/cmd/dlmgmtd/dlmgmt_impl.h","type":"MODIFIED","insertions":2,"deletions":-6},{"file":"usr/src/cmd/dlmgmtd/dlmgmt_main.c","type":"MODIFIED","insertions":1,"deletions":-3},{"file":"usr/src/cmd/dlmgmtd/dlmgmt_util.c","type":"MODIFIED","insertions":24,"deletions":-5},{"file":"usr/src/cmd/zoneadmd/Makefile.com","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"usr/src/cmd/zoneadmd/vplat.c","type":"MODIFIED","insertions":82,"deletions":0},{"file":"usr/src/lib/libdladm/common/libdlmgmt.c","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"usr/src/uts/common/io/dls/dls_mgmt.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/common/os/zone.c","type":"MODIFIED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/sys/dls_mgmt.h","type":"MODIFIED","insertions":6,"deletions":-2}],"sizeInsertions":156,"sizeDeletions":-140},{"number":"13","revision":"33df115038809a05a8856b165fabdb823350567e","parents":["aefd5a8c21e439a1955ccb6b19739e9bf7e8cec3"],"ref":"refs/changes/95/1095/13","uploader":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"createdOn":1485796915,"author":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1485471897,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1485296614,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1485475020,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"SUBM","value":"1","grantedOn":1485796925,"by":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"usr/src/cmd/dlmgmtd/dlmgmt_db.c","type":"MODIFIED","insertions":3,"deletions":-66},{"file":"usr/src/cmd/dlmgmtd/dlmgmt_door.c","type":"MODIFIED","insertions":19,"deletions":-53},{"file":"usr/src/cmd/dlmgmtd/dlmgmt_impl.h","type":"MODIFIED","insertions":2,"deletions":-6},{"file":"usr/src/cmd/dlmgmtd/dlmgmt_main.c","type":"MODIFIED","insertions":1,"deletions":-3},{"file":"usr/src/cmd/dlmgmtd/dlmgmt_util.c","type":"MODIFIED","insertions":24,"deletions":-5},{"file":"usr/src/cmd/zoneadmd/Makefile.com","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"usr/src/cmd/zoneadmd/vplat.c","type":"MODIFIED","insertions":82,"deletions":0},{"file":"usr/src/lib/libdladm/common/libdlmgmt.c","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"usr/src/uts/common/io/dls/dls_mgmt.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/common/os/zone.c","type":"MODIFIED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/sys/dls_mgmt.h","type":"MODIFIED","insertions":6,"deletions":-2}],"sizeInsertions":156,"sizeDeletions":-140}],"allReviewers":[{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}]}