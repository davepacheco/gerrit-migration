{"project":"joyent/illumos-joyent","branch":"master","id":"I5a859e8d1c090b10cf82408f7c51c78f93dd543f","number":"1154","subject":"OS-5866 incorrect pid in cmsg for Unix socket with SO_PASSCRED Reviewed by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e Approved by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e","owner":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"url":"https://cr.joyent.us/1154","commitMessage":"OS-5866 incorrect pid in cmsg for Unix socket with SO_PASSCRED\nReviewed by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e\nApproved by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e\n","createdOn":1482341977,"lastUpdated":1482434851,"open":false,"status":"MERGED","comments":[{"timestamp":1482341977,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 1."},{"timestamp":1482359361,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 2."},{"timestamp":1482417839,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 3."},{"timestamp":1482423245,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 3:\n\n(4 comments)"},{"timestamp":1482425457,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 4."},{"timestamp":1482425530,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 4:\n\nI accepted all of your comments."},{"timestamp":1482432341,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 4: Code-Review+1\n\n(1 comment)\n\nLooks good, modulo the spelling nit"},{"timestamp":1482433031,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 5."},{"timestamp":1482434080,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 5: Code-Review+1"},{"timestamp":1482434502,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 5:\n\nFor testing I ran LTP, chromium (without pulseaudio installed) and some new lx-tests that I wrote specifically for this change."},{"timestamp":1482434676,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 5: Integration-Approval+1"},{"timestamp":1482434836,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 6: Commit message was updated."},{"timestamp":1482434851,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Jerry Jelinek"}],"currentPatchSet":{"number":"6","revision":"5a859e8d1c090b10cf82408f7c51c78f93dd543f","parents":["826aed25de4c9b911d0fd07fa6236d199eaff2a6"],"ref":"refs/changes/54/1154/6","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1482434836,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1482434080,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1482434676,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"SUBM","value":"1","grantedOn":1482434851,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/uts/common/brand/lx/syscall/lx_socket.c","type":"MODIFIED","insertions":73,"deletions":-4}],"sizeInsertions":73,"sizeDeletions":-4},"patchSets":[{"number":"1","revision":"e103cd2a55f8a150e7afba05d4f3e30a812dbeba","parents":["8e8d8ab1837147d84c3f901f72f627af7032fdac"],"ref":"refs/changes/54/1154/1","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1482341977,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/brand/lx/syscall/lx_socket.c","type":"MODIFIED","insertions":10,"deletions":0}],"sizeInsertions":10,"sizeDeletions":0},{"number":"2","revision":"440023657cbcede9d15245e74c194db72e5a512a","parents":["8e8d8ab1837147d84c3f901f72f627af7032fdac"],"ref":"refs/changes/54/1154/2","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1482359361,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/brand/lx/syscall/lx_socket.c","type":"MODIFIED","insertions":10,"deletions":0}],"sizeInsertions":10,"sizeDeletions":0},{"number":"3","revision":"13aba3c10effdeda48617976637dedc555ba252d","parents":["826aed25de4c9b911d0fd07fa6236d199eaff2a6"],"ref":"refs/changes/54/1154/3","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1482417839,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/uts/common/brand/lx/syscall/lx_socket.c","line":2982,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"I would spell out that the workaround for socketpair(2) is for SEQPACKET only"},{"file":"usr/src/uts/common/brand/lx/syscall/lx_socket.c","line":3897,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"append comma"},{"file":"usr/src/uts/common/brand/lx/syscall/lx_socket.c","line":3900,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"\"in particular\" repeat a couple sentences later.  Perhaps reword to something like \"The semantics are similar but our native code will not pass cmsg creds over a connection-oriented socket, unlike a connectionless one.\""},{"file":"usr/src/uts/common/brand/lx/syscall/lx_socket.c","line":3958,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"If you move this up above the \u0027setf()\u0027 calls, then you can just pull the vnode/sonode straight out of the fp[] array rather than via getsonode().  Doing so will be less racy.  Also, shouldn\u0027t the attribute be added to both sides?"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/brand/lx/syscall/lx_socket.c","type":"MODIFIED","insertions":75,"deletions":-4}],"sizeInsertions":75,"sizeDeletions":-4},{"number":"4","revision":"444ef909dda9ec43b673628bcd82cde64417e96e","parents":["826aed25de4c9b911d0fd07fa6236d199eaff2a6"],"ref":"refs/changes/54/1154/4","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1482425457,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1482432341,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"comments":[{"file":"usr/src/uts/common/brand/lx/syscall/lx_socket.c","line":3897,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"*special"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/brand/lx/syscall/lx_socket.c","type":"MODIFIED","insertions":73,"deletions":-4}],"sizeInsertions":73,"sizeDeletions":-4},{"number":"5","revision":"a64524f00a89e0ed710d95a7689ce7ef281e2add","parents":["826aed25de4c9b911d0fd07fa6236d199eaff2a6"],"ref":"refs/changes/54/1154/5","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1482433031,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1482434080,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1482434676,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/brand/lx/syscall/lx_socket.c","type":"MODIFIED","insertions":73,"deletions":-4}],"sizeInsertions":73,"sizeDeletions":-4},{"number":"6","revision":"5a859e8d1c090b10cf82408f7c51c78f93dd543f","parents":["826aed25de4c9b911d0fd07fa6236d199eaff2a6"],"ref":"refs/changes/54/1154/6","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1482434836,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"SUBM","value":"1","grantedOn":1482434851,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1482434080,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1482434676,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/uts/common/brand/lx/syscall/lx_socket.c","type":"MODIFIED","insertions":73,"deletions":-4}],"sizeInsertions":73,"sizeDeletions":-4}],"allReviewers":[{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}]}