{"project":"joyent/illumos-joyent","branch":"master","id":"Ibdeddd1b57baed3af78d568e6e27f2fd12209ef8","number":"1774","subject":"OS-6019 missing sysfs /sys/devices/system/cpu and relevant entries below Reviewed by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e Approved by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e","owner":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"url":"https://cr.joyent.us/1774","commitMessage":"OS-6019 missing sysfs /sys/devices/system/cpu and relevant entries below\nReviewed by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e\nApproved by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e\n","createdOn":1491838768,"lastUpdated":1492623255,"open":false,"status":"MERGED","comments":[{"timestamp":1491838768,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 1."},{"timestamp":1491838826,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 1:\n\nI\u0027m putting this up for initial review at your convenience. I still need to do Java testing, plus any additional testing we can think of. I would not integrate this until at least the next build cycle."},{"timestamp":1491859157,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 2."},{"timestamp":1492445565,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 2:\n\n(3 comments)"},{"timestamp":1492468356,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 2:\n\n(3 comments)"},{"timestamp":1492468363,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 3."},{"timestamp":1492517842,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 3:\n\nI updated the node0 code (lxsys_read_devices_sysnode) to also use lxsys_format_cpu"},{"timestamp":1492517901,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 4."},{"timestamp":1492553822,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 4:\n\n(5 comments)"},{"timestamp":1492556607,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 4:\n\nThanks for the suggestions. I have addresses all of them."},{"timestamp":1492556643,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 5."},{"timestamp":1492611666,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 5:\n\n(6 comments)\n\nSome signed/unsigned nits I missed from before.  The rest of it looks great."},{"timestamp":1492617522,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 5:\n\nThanks, I\u0027ve made those changes."},{"timestamp":1492617529,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 6."},{"timestamp":1492617928,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 6: Code-Review+1"},{"timestamp":1492622978,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 6: Integration-Approval+1"},{"timestamp":1492623167,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 7: Patch Set 6 was rebased."},{"timestamp":1492623245,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 8: Commit message was updated."},{"timestamp":1492623255,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Jerry Jelinek"}],"currentPatchSet":{"number":"8","revision":"bdeddd1b57baed3af78d568e6e27f2fd12209ef8","parents":["ab2813222f56f45f141576b0ec87ecb65c0fcbe8"],"ref":"refs/changes/74/1774/8","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1492623245,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1492617928,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1492622978,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"SUBM","value":"1","grantedOn":1492623255,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/uts/common/brand/lx/sysfs/lx_sysvnops.c","type":"MODIFIED","insertions":269,"deletions":-98},{"file":"usr/src/uts/common/os/cpu.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/common/sys/cpuvar.h","type":"MODIFIED","insertions":2,"deletions":-1}],"sizeInsertions":273,"sizeDeletions":-101},"patchSets":[{"number":"1","revision":"7221c3e9f4681470a3b5344120925b3f91d99f3b","parents":["828055a7dbf3653fa97bde566be0e5a556080067"],"ref":"refs/changes/74/1774/1","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1491838768,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/brand/lx/sysfs/lx_sysvnops.c","type":"MODIFIED","insertions":106,"deletions":-24}],"sizeInsertions":106,"sizeDeletions":-24},{"number":"2","revision":"b19063f2dbdc9fa2352079fa59ecb2ba50ccd6e1","parents":["828055a7dbf3653fa97bde566be0e5a556080067"],"ref":"refs/changes/74/1774/2","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1491859157,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/uts/common/brand/lx/sysfs/lx_sysvnops.c","line":1158,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"This operation could be rolled into the above snprintfs by assigning a local char * to \"\" or \",\" based on *first and prepending it to the decimal formatting."},{"file":"usr/src/uts/common/brand/lx/sysfs/lx_sysvnops.c","line":1158,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"done"},{"file":"usr/src/uts/common/brand/lx/sysfs/lx_sysvnops.c","line":1181,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"We tend to loop over CPUs like this a fair bit.  Would it be sensible to make \u0027cpu_available\u0027 non-static so that between it and \u0027cpu_active_set\u0027 a quick snapshot of total CPU state could be taken for operations like this?"},{"file":"usr/src/uts/common/brand/lx/sysfs/lx_sysvnops.c","line":1181,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"done"},{"file":"usr/src/uts/common/brand/lx/sysfs/lx_sysvnops.c","line":1749,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"While this is only being used to emit cpu-related entries, it looks like no part of the actual implementation is specific to that task.  A more general name might be something to consider."},{"file":"usr/src/uts/common/brand/lx/sysfs/lx_sysvnops.c","line":1749,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/brand/lx/sysfs/lx_sysvnops.c","type":"MODIFIED","insertions":208,"deletions":-31}],"sizeInsertions":208,"sizeDeletions":-31},{"number":"3","revision":"fe7e781a2f3468ada500ad03b890cdd86d65e67f","parents":["bcfaedcea7135042c64d088b29fe5248ca14aa45"],"ref":"refs/changes/74/1774/3","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1492468363,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/brand/lx/sysfs/lx_sysvnops.c","type":"MODIFIED","insertions":267,"deletions":-94},{"file":"usr/src/uts/common/os/cpu.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/common/sys/cpuvar.h","type":"MODIFIED","insertions":2,"deletions":-1}],"sizeInsertions":271,"sizeDeletions":-97},{"number":"4","revision":"a59a53dac7a60cc976d661fb1ade80992bce0833","parents":["bcfaedcea7135042c64d088b29fe5248ca14aa45"],"ref":"refs/changes/74/1774/4","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1492517901,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/uts/common/brand/lx/sysfs/lx_sysvnops.c","line":959,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"It might be a good idea to verify with cpu_in_set() (and perhaps start with avlo?) in case there are any holes.  (Not likely, but it keeps us covered.)"},{"file":"usr/src/uts/common/brand/lx/sysfs/lx_sysvnops.c","line":1225,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"double spaced"},{"file":"usr/src/uts/common/brand/lx/sysfs/lx_sysvnops.c","line":1804,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Wrong instance?"},{"file":"usr/src/uts/common/brand/lx/sysfs/lx_sysvnops.c","line":1808,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Wrong instance?"},{"file":"usr/src/uts/common/brand/lx/sysfs/lx_sysvnops.c","line":1835,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Similar to above, perhaps cpu_in_set() should be checked here."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/brand/lx/sysfs/lx_sysvnops.c","type":"MODIFIED","insertions":262,"deletions":-97},{"file":"usr/src/uts/common/os/cpu.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/common/sys/cpuvar.h","type":"MODIFIED","insertions":2,"deletions":-1}],"sizeInsertions":266,"sizeDeletions":-100},{"number":"5","revision":"62d8c43ee53a83ad4ff30e58729b8ec068135dbf","parents":["3c0ca44a7822bdf8fed958f03830ad3bba1cc727"],"ref":"refs/changes/74/1774/5","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1492556643,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/uts/common/brand/lx/sysfs/lx_sysvnops.c","line":953,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Since the param is unsigned, this should probably be \u0027%u\u0027.  It\u0027s not an issue now, given the small size of NCPU, but a smarter compiler might complain about it one day."},{"file":"usr/src/uts/common/brand/lx/sysfs/lx_sysvnops.c","line":1125,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Switch it uint_t"},{"file":"usr/src/uts/common/brand/lx/sysfs/lx_sysvnops.c","line":1140,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Changed to %u to match unsigned types"},{"file":"usr/src/uts/common/brand/lx/sysfs/lx_sysvnops.c","line":1143,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"%u"},{"file":"usr/src/uts/common/brand/lx/sysfs/lx_sysvnops.c","line":1158,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"These should be unsigned to match their counterparts."},{"file":"usr/src/uts/common/brand/lx/sysfs/lx_sysvnops.c","line":1845,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"%u"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/brand/lx/sysfs/lx_sysvnops.c","type":"MODIFIED","insertions":268,"deletions":-97},{"file":"usr/src/uts/common/os/cpu.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/common/sys/cpuvar.h","type":"MODIFIED","insertions":2,"deletions":-1}],"sizeInsertions":272,"sizeDeletions":-100},{"number":"6","revision":"10e36d8eb2814f966675936f1a72226585185c1f","parents":["3c0ca44a7822bdf8fed958f03830ad3bba1cc727"],"ref":"refs/changes/74/1774/6","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1492617529,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1492617928,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1492622978,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/brand/lx/sysfs/lx_sysvnops.c","type":"MODIFIED","insertions":269,"deletions":-98},{"file":"usr/src/uts/common/os/cpu.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/common/sys/cpuvar.h","type":"MODIFIED","insertions":2,"deletions":-1}],"sizeInsertions":273,"sizeDeletions":-101},{"number":"7","revision":"22c02c411c0bead25a90a38a7696fb42a4a5ab6a","parents":["ab2813222f56f45f141576b0ec87ecb65c0fcbe8"],"ref":"refs/changes/74/1774/7","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1492623167,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1492617928,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1492622978,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/brand/lx/sysfs/lx_sysvnops.c","type":"MODIFIED","insertions":269,"deletions":-98},{"file":"usr/src/uts/common/os/cpu.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/common/sys/cpuvar.h","type":"MODIFIED","insertions":2,"deletions":-1}],"sizeInsertions":273,"sizeDeletions":-101},{"number":"8","revision":"bdeddd1b57baed3af78d568e6e27f2fd12209ef8","parents":["ab2813222f56f45f141576b0ec87ecb65c0fcbe8"],"ref":"refs/changes/74/1774/8","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1492623245,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"SUBM","value":"1","grantedOn":1492623255,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1492617928,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1492622978,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/uts/common/brand/lx/sysfs/lx_sysvnops.c","type":"MODIFIED","insertions":269,"deletions":-98},{"file":"usr/src/uts/common/os/cpu.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/common/sys/cpuvar.h","type":"MODIFIED","insertions":2,"deletions":-1}],"sizeInsertions":273,"sizeDeletions":-101}],"allReviewers":[{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}]}