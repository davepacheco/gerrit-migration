{"project":"joyent/pgstatsmon","branch":"master","topic":"lullaby-phase3","id":"I53ad3cdd561d5e0dace84b0e3a023148f02ddcd3","number":"5673","subject":"MANTA-4090 convert pgstatsmon to engbld framework Reviewed by: Kody A Kantor \u003ckody@kkantor.com\u003e Approved by: Kody A Kantor \u003ckody@kkantor.com\u003e","owner":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"url":"https://cr.joyent.us/5673","commitMessage":"MANTA-4090 convert pgstatsmon to engbld framework\nReviewed by: Kody A Kantor \u003ckody@kkantor.com\u003e\nApproved by: Kody A Kantor \u003ckody@kkantor.com\u003e\n","createdOn":1551374888,"lastUpdated":1552474693,"open":false,"status":"MERGED","comments":[{"timestamp":1551374888,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Uploaded patch set 1."},{"timestamp":1551374894,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit 6d1cedafbab5d580e34de8c5101522bd42f58391\n    \n    MANTA-4090 convert pgstatsmon to engbld framework"},{"timestamp":1551375037,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Topic set to lullaby-phase3"},{"timestamp":1551377347,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1551377482,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Uploaded patch set 2."},{"timestamp":1551377489,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit 3aa25851f84c39a807f7176696846193469aba47\n    \n    MANTA-4090 convert pgstatsmon to engbld framework"},{"timestamp":1551377513,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1551737546,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 2: Code-Review+1\n\n(2 comments)\n\nThanks Tim. This is really cool stuff. I\u0027m setting up a build zone for this now to try a build with these changes."},{"timestamp":1551781523,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Patch Set 2:\n\n(2 comments)\n\nThanks for taking a look at this stuff Kelly. Comments below."},{"timestamp":1551781562,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Patch Set 2:\n\n\u003e Thanks for taking a look at this stuff Kelly. Comments below.\n\ns/Kelly/Kody/ - d\u0027oh, need more coffee :)"},{"timestamp":1552060531,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 2: Integration-Approval+1"},{"timestamp":1552062031,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Patch Set 2: Code-Review+1\n\nDitto, the image builds and works fine for me."},{"timestamp":1552064792,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Uploaded patch set 3."},{"timestamp":1552064798,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Patch Set 3:\n\nNew commits:\n    \n    commit bd2327624927ccdd3a19dbcde18891051d624612\n    \n    MANTA-4090 convert pgstatsmon to engbld framework"},{"timestamp":1552065130,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 3: Code-Review+1 Integration-Approval+1\n\nThanks for the rebase. I\u0027m guessing it was non-trivial, which is why we need to +1 again?"},{"timestamp":1552065326,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Patch Set 3:\n\n\u003e Thanks for the rebase. I\u0027m guessing it was non-trivial, which is\n \u003e why we need to +1 again?\n\nRight, though it seemed fairly trivial to me and I was surprised we couldn\u0027t auto-merge: just the addition of a few Makefile macros and a target to install them: \nhttps://github.com/joyent/pgstatsmon/commit/aa333c020dc3f145dccec85535b0e80985eff67b#diff-b67911656ef5d18c4ae36cb6741b7965"},{"timestamp":1552326020,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Uploaded patch set 4."},{"timestamp":1552326027,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Patch Set 4:\n\nNew commits:\n    \n    commit fd6b6765870ffeae2dcfd6e2432326275fc45b60\n    \n    bump deps/eng to get pfexec detection fix, TOOLS-2199"},{"timestamp":1552327522,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 4: Code-Review+1 Integration-Approval+1"},{"timestamp":1552474693,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Tim Foster"}],"currentPatchSet":{"number":"4","revision":"53ad3cdd561d5e0dace84b0e3a023148f02ddcd3","parents":["aa333c020dc3f145dccec85535b0e80985eff67b"],"ref":"refs/changes/73/5673/4","uploader":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"createdOn":1552326020,"author":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1552327522,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1552327522,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}},{"type":"SUBM","value":"1","grantedOn":1552474693,"by":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":5,"deletions":0},{"file":".gitmodules","type":"MODIFIED","insertions":9,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":26,"deletions":-20},{"file":"deps/eng","type":"ADDED","insertions":1,"deletions":0},{"file":"deps/javascriptlint","type":"ADDED","insertions":1,"deletions":0},{"file":"deps/jsstyle","type":"ADDED","insertions":1,"deletions":0},{"file":"tools/mk/Makefile.defs","type":"DELETED","insertions":0,"deletions":-105},{"file":"tools/mk/Makefile.node_modules.defs","type":"DELETED","insertions":0,"deletions":-68},{"file":"tools/mk/Makefile.node_modules.targ","type":"DELETED","insertions":0,"deletions":-31},{"file":"tools/mk/Makefile.node_prebuilt.defs","type":"DELETED","insertions":0,"deletions":-159},{"file":"tools/mk/Makefile.node_prebuilt.targ","type":"DELETED","insertions":0,"deletions":-42},{"file":"tools/mk/Makefile.targ","type":"DELETED","insertions":0,"deletions":-309}],"sizeInsertions":43,"sizeDeletions":-734},"patchSets":[{"number":"1","revision":"ec91af4f577efecc86a4fa07a9c3e7cdb528990b","parents":["84c687ce7178f92097929bfff560c470ceefd83a"],"ref":"refs/changes/73/5673/1","uploader":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"createdOn":1551374888,"author":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1551377347,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":5,"deletions":0},{"file":".gitmodules","type":"MODIFIED","insertions":9,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":32,"deletions":-26},{"file":"deps/eng","type":"ADDED","insertions":1,"deletions":0},{"file":"deps/javascriptlint","type":"ADDED","insertions":1,"deletions":0},{"file":"deps/jsstyle","type":"ADDED","insertions":1,"deletions":0},{"file":"tools/mk/Makefile.defs","type":"DELETED","insertions":0,"deletions":-105},{"file":"tools/mk/Makefile.node_modules.defs","type":"DELETED","insertions":0,"deletions":-68},{"file":"tools/mk/Makefile.node_modules.targ","type":"DELETED","insertions":0,"deletions":-31},{"file":"tools/mk/Makefile.node_prebuilt.defs","type":"DELETED","insertions":0,"deletions":-159},{"file":"tools/mk/Makefile.node_prebuilt.targ","type":"DELETED","insertions":0,"deletions":-42},{"file":"tools/mk/Makefile.targ","type":"DELETED","insertions":0,"deletions":-309}],"sizeInsertions":49,"sizeDeletions":-740},{"number":"2","revision":"1743c6e14b4973e7ab35fda9c8246a75399b29ff","parents":["84c687ce7178f92097929bfff560c470ceefd83a"],"ref":"refs/changes/73/5673/2","uploader":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"createdOn":1551377482,"author":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1551377513,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1551737546,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1552060531,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1552062031,"by":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"}}],"comments":[{"file":"Makefile","line":127,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Does this work without being surrounded by quotes? Maybe this is my gnu make novice speaking..."},{"file":"Makefile","line":127,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Yep, this is fine. e.g.\n\ntimf@jenkins-agent-multiarch-15.4.1 (grr-MANTA-4090) make print-BUILDIMAGE_DESC\nBUILDIMAGE_DESC\u003dPostgres Monitoring Service\n\nThe built image manifest itself shows:\n\ntimf@jenkins-agent-multiarch-15.4.1 (grr-MANTA-4090) cat bits/pgstatsmon/pgstatsmon-zfs-grr-MANTA-4090-20190228T113306Z-gd18db6a.imgmanifest\n{\n  \"v\": 2,\n  \"uuid\": \"f55a6b63-1a8e-4f09-9cfc-ad25f70caa49\",\n  \"name\": \"manta-pgstatsmon\",\n  \"description\": \"Postgres Monitoring Service\",\n  \"version\": \"grr-MANTA-4090-20190228T113306Z-gd18db6a\",\n  \"owner\": \"00000000-0000-0000-0000-000000000000\",\n  \"tags\": {\n    \"smartdc_service\": true\n  },\n  \"requirements\": {\n    \"min_platform\": {\n      \"7.0\": \"20151126T062538Z\"\n    }\n  },\n  \"type\": \"zone-dataset\",\n  \"os\": \"smartos\",\n  \"origin\": \"04a48d7d-6bb5-4e83-8c3b-e60a99e0f48f\",\n  \"files\": [\n    {\n      \"size\": 49563206,\n      \"compression\": \"gzip\",\n      \"sha1\": \"c9c760b1daa5291921971824f31c1b0a0252e332\"\n    }\n  ]\n}"},{"file":"Makefile","line":210,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"nit: this is over 80 cols. Can we wrap, or is that not possible while still being syntactically valid?"},{"file":"Makefile","line":210,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Thanks for asking - I wasn\u0027t sure either, but it turns out we can:\n\ntimf@jenkins-agent-multiarch-15.4.1 cat Makefile\nall: dep1 \\\n        dep2 \\\n        dep3 | \\\n        dep4\n\ndep%:\n        echo $@\ntimf@jenkins-agent-multiarch-15.4.1 make\necho dep1\ndep1\necho dep2\ndep2\necho dep3\ndep3\necho dep4\ndep4\ntimf@jenkins-agent-multiarch-15.4.1\n\nI\u0027ll make that change and resubmit."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":5,"deletions":0},{"file":".gitmodules","type":"MODIFIED","insertions":9,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":27,"deletions":-21},{"file":"deps/eng","type":"ADDED","insertions":1,"deletions":0},{"file":"deps/javascriptlint","type":"ADDED","insertions":1,"deletions":0},{"file":"deps/jsstyle","type":"ADDED","insertions":1,"deletions":0},{"file":"tools/mk/Makefile.defs","type":"DELETED","insertions":0,"deletions":-105},{"file":"tools/mk/Makefile.node_modules.defs","type":"DELETED","insertions":0,"deletions":-68},{"file":"tools/mk/Makefile.node_modules.targ","type":"DELETED","insertions":0,"deletions":-31},{"file":"tools/mk/Makefile.node_prebuilt.defs","type":"DELETED","insertions":0,"deletions":-159},{"file":"tools/mk/Makefile.node_prebuilt.targ","type":"DELETED","insertions":0,"deletions":-42},{"file":"tools/mk/Makefile.targ","type":"DELETED","insertions":0,"deletions":-309}],"sizeInsertions":44,"sizeDeletions":-735},{"number":"3","revision":"1a1b398677844ddad92127c16323ae3821455082","parents":["aa333c020dc3f145dccec85535b0e80985eff67b"],"ref":"refs/changes/73/5673/3","uploader":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"createdOn":1552064792,"author":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1552065130,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1552065130,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":5,"deletions":0},{"file":".gitmodules","type":"MODIFIED","insertions":9,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":26,"deletions":-20},{"file":"deps/eng","type":"ADDED","insertions":1,"deletions":0},{"file":"deps/javascriptlint","type":"ADDED","insertions":1,"deletions":0},{"file":"deps/jsstyle","type":"ADDED","insertions":1,"deletions":0},{"file":"tools/mk/Makefile.defs","type":"DELETED","insertions":0,"deletions":-105},{"file":"tools/mk/Makefile.node_modules.defs","type":"DELETED","insertions":0,"deletions":-68},{"file":"tools/mk/Makefile.node_modules.targ","type":"DELETED","insertions":0,"deletions":-31},{"file":"tools/mk/Makefile.node_prebuilt.defs","type":"DELETED","insertions":0,"deletions":-159},{"file":"tools/mk/Makefile.node_prebuilt.targ","type":"DELETED","insertions":0,"deletions":-42},{"file":"tools/mk/Makefile.targ","type":"DELETED","insertions":0,"deletions":-309}],"sizeInsertions":43,"sizeDeletions":-734},{"number":"4","revision":"53ad3cdd561d5e0dace84b0e3a023148f02ddcd3","parents":["aa333c020dc3f145dccec85535b0e80985eff67b"],"ref":"refs/changes/73/5673/4","uploader":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"createdOn":1552326020,"author":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1552327522,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1552327522,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}},{"type":"SUBM","value":"1","grantedOn":1552474693,"by":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":5,"deletions":0},{"file":".gitmodules","type":"MODIFIED","insertions":9,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":26,"deletions":-20},{"file":"deps/eng","type":"ADDED","insertions":1,"deletions":0},{"file":"deps/javascriptlint","type":"ADDED","insertions":1,"deletions":0},{"file":"deps/jsstyle","type":"ADDED","insertions":1,"deletions":0},{"file":"tools/mk/Makefile.defs","type":"DELETED","insertions":0,"deletions":-105},{"file":"tools/mk/Makefile.node_modules.defs","type":"DELETED","insertions":0,"deletions":-68},{"file":"tools/mk/Makefile.node_modules.targ","type":"DELETED","insertions":0,"deletions":-31},{"file":"tools/mk/Makefile.node_prebuilt.defs","type":"DELETED","insertions":0,"deletions":-159},{"file":"tools/mk/Makefile.node_prebuilt.targ","type":"DELETED","insertions":0,"deletions":-42},{"file":"tools/mk/Makefile.targ","type":"DELETED","insertions":0,"deletions":-309}],"sizeInsertions":43,"sizeDeletions":-734}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"}]}