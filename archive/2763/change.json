{"project":"joyent/node-moray","branch":"master","id":"Id46971bfcaf33c3aa1c23b93d5a0fcb147cde98f","number":"2763","subject":"MORAY-442 node-moray cli option for readOnlyOverride","owner":{"name":"Brittany Wald","email":"brittany.wald@joyent.com","username":"princesspretzel"},"url":"https://cr.joyent.us/2763","commitMessage":"MORAY-442 node-moray cli option for readOnlyOverride\n","createdOn":1507680395,"lastUpdated":1509659219,"open":true,"status":"NEW","comments":[{"timestamp":1507680395,"reviewer":{"name":"Brittany Wald","email":"brittany.wald@joyent.com","username":"princesspretzel"},"message":"Uploaded patch set 1."},{"timestamp":1507680420,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1507751537,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 1:\n\n(4 comments)\n\nThanks for doing this!"},{"timestamp":1507757207,"reviewer":{"name":"Brittany Wald","email":"brittany.wald@joyent.com","username":"princesspretzel"},"message":"Uploaded patch set 2."},{"timestamp":1507757231,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1507769957,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 2: Code-Review+1\n\nThanks!"},{"timestamp":1507770020,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 2:\n\nFor IA: does the moray test suite run successfully?  I think there are some CLI tests as well and I\u0027m not sure if we want to update them to reflect this new flag."},{"timestamp":1508544429,"reviewer":{"name":"Brittany Wald","email":"brittany.wald@joyent.com","username":"princesspretzel"},"message":"Uploaded patch set 3: Patch Set 2 was rebased."},{"timestamp":1508544453,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3:\n\n\"make check\" passed ok"},{"timestamp":1508544468,"reviewer":{"name":"Brittany Wald","email":"brittany.wald@joyent.com","username":"princesspretzel"},"message":"Patch Set 3:\n\nDave -- it does, but I can add those tests!"},{"timestamp":1509659219,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 3:\n\n(2 comments)\n\nWe should also update the troff in man/ with this change. Unfortunately, doing this is a bit of a pain, since you need to install md2man. You can do this by:\n\n    pfexec pkgin in ruby-2.2.4\n    mkdir ~/ruby\n    export GEM_HOME\u003d/home/\u003cuser\u003e/ruby\n    export PATH\u003d~/ruby/bin:$PATH\n    gem install md2man\n    make man"}],"currentPatchSet":{"number":"3","revision":"d46971bfcaf33c3aa1c23b93d5a0fcb147cde98f","parents":["22ab00cf1982302d4cc77546c346ebbbd681e914"],"ref":"refs/changes/63/2763/3","uploader":{"name":"Brittany Wald","email":"brittany.wald@joyent.com","username":"princesspretzel"},"createdOn":1508544429,"author":{"name":"Brittany Wald","email":"brittany.wald@joyent.com","username":"princesspretzel"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1507757231,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1507769957,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}}],"comments":[{"file":"docs/man/man1/sql.md","line":27,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"\"modifications\""},{"file":"docs/man/man1/sql.md","line":31,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"\"as noted\""}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"bin/sql","type":"MODIFIED","insertions":16,"deletions":-5},{"file":"docs/man/man1/sql.md","type":"MODIFIED","insertions":12,"deletions":-3}],"sizeInsertions":28,"sizeDeletions":-8},"patchSets":[{"number":"1","revision":"96f90b48e57374fe5b247d64fb2e5444b2b73f34","parents":["aa8a4c7507ee7ab6b93c8e8e9d50c67893bd5dc2"],"ref":"refs/changes/63/2763/1","uploader":{"name":"Brittany Wald","email":"brittany.wald@joyent.com","username":"princesspretzel"},"createdOn":1507680395,"author":{"name":"Brittany Wald","email":"brittany.wald@joyent.com","username":"princesspretzel"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1507680420,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"bin/sql","line":21,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"If this option doesn\u0027t take an argument, the synopsis part should just say \"[-r]\"."},{"file":"docs/man/man1/sql.md","line":5,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"This summary looks like a copy/paste of `ping`.  Since you\u0027re changing it anyway, would you mind fixing it?"},{"file":"docs/man/man1/sql.md","line":25,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I would suggest starting with the fact that electric-moray normally prohibits raw SQL operations when any vnode is read-only in order to avoid modifications to the read-only metadata.  (Without that, I think the rest of this is somewhat confusing.)  Then I would just tell users that when using this flag, that check is skipped, and the user is responsible for ensuring that the query they\u0027re running will not modify read-only vnodes, and that the result could be data corruption.\n\nNote that the description above already explains that this command requires knowing what you\u0027re doing, should usually be used only for read-only queries, that mistakes can cause data corruption, and that there\u0027s almost no validation on the input.  I don\u0027t think this flag actually makes the command much more dangerous than it already is."},{"file":"docs/man/man1/sql.md","line":27,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I would say \"some vnodes have\", since there\u0027s no particular vnode here."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"bin/sql","type":"MODIFIED","insertions":16,"deletions":-5},{"file":"docs/man/man1/sql.md","type":"MODIFIED","insertions":11,"deletions":-3},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":28,"sizeDeletions":-9},{"number":"2","revision":"3617c6ffd62dede822a6c266023ab3bd24423eeb","parents":["aa8a4c7507ee7ab6b93c8e8e9d50c67893bd5dc2"],"ref":"refs/changes/63/2763/2","uploader":{"name":"Brittany Wald","email":"brittany.wald@joyent.com","username":"princesspretzel"},"createdOn":1507757207,"author":{"name":"Brittany Wald","email":"brittany.wald@joyent.com","username":"princesspretzel"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1507769957,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1507757231,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"bin/sql","type":"MODIFIED","insertions":16,"deletions":-5},{"file":"docs/man/man1/sql.md","type":"MODIFIED","insertions":12,"deletions":-3},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":29,"sizeDeletions":-9},{"number":"3","revision":"d46971bfcaf33c3aa1c23b93d5a0fcb147cde98f","parents":["22ab00cf1982302d4cc77546c346ebbbd681e914"],"ref":"refs/changes/63/2763/3","uploader":{"name":"Brittany Wald","email":"brittany.wald@joyent.com","username":"princesspretzel"},"createdOn":1508544429,"author":{"name":"Brittany Wald","email":"brittany.wald@joyent.com","username":"princesspretzel"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1507769957,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1507757231,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"docs/man/man1/sql.md","line":27,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"\"modifications\""},{"file":"docs/man/man1/sql.md","line":31,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"\"as noted\""}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"bin/sql","type":"MODIFIED","insertions":16,"deletions":-5},{"file":"docs/man/man1/sql.md","type":"MODIFIED","insertions":12,"deletions":-3}],"sizeInsertions":28,"sizeDeletions":-8}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},{"name":"Brittany Wald","email":"brittany.wald@joyent.com","username":"princesspretzel"}]}