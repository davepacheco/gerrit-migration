{"project":"joyent/sdc-manta","branch":"master","id":"Ifb2832a2dfd56120360ed155d0069d04485763f2","number":"6574","subject":"MANTA-4375 port manta-create-topology.sh to node MANTA-4376 expand manta-create-topology to support buckets Reviewed by: Kelly McLaughlin \u003ckelly.mclaughlin@joyent.com\u003e Reviewed by: Dave Eddy \u003cdave.eddy@joyent.com\u003e Approved by: Kelly McLaughlin \u003ckelly.mcla","owner":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"url":"https://cr.joyent.us/6574","commitMessage":"MANTA-4375 port manta-create-topology.sh to node\nMANTA-4376 expand manta-create-topology to support buckets\nReviewed by: Kelly McLaughlin \u003ckelly.mclaughlin@joyent.com\u003e\nReviewed by: Dave Eddy \u003cdave.eddy@joyent.com\u003e\nApproved by: Kelly McLaughlin \u003ckelly.mclaughlin@joyent.com\u003e\n","createdOn":1562635785,"lastUpdated":1564095472,"open":false,"status":"MERGED","comments":[{"timestamp":1562635785,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Uploaded patch set 1."},{"timestamp":1562635848,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1562635900,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Uploaded patch set 2."},{"timestamp":1562635964,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1562636006,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Patch Set 2:\n\nSee ticket for testing notes."},{"timestamp":1563376457,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Patch Set 2: Code-Review+1\n\nThe code looks really nice to me. I\u0027d definitely love to have another person from the manta team look it over as well and I\u0027ll read over your testing notes and do some testing of my own to gear up for IA on it."},{"timestamp":1564082205,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 2: Code-Review+1\n\n(5 comments)\n\nAll of my notes are mostly nits for you to consider - the code/logic itself looks good!"},{"timestamp":1564087594,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Uploaded patch set 3."},{"timestamp":1564087649,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Patch Set 3:\n\n(5 comments)\n\nTesting notes for latest patchset: ran the script once with buckets flag and once without, to make sure the new changes didn\u0027t break anything."},{"timestamp":1564087655,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1564089561,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 3: Code-Review+1\n\nLGTM!"},{"timestamp":1564095248,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Patch Set 3: Code-Review+1 Integration-Approval+1"},{"timestamp":1564095319,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Patch Set 4: Patch Set 3 was rebased"},{"timestamp":1564095380,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4:\n\n\"make check\" passed ok"},{"timestamp":1564095462,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Patch Set 5: Commit message was updated."},{"timestamp":1564095472,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Isaac Davis"}],"currentPatchSet":{"number":"5","revision":"425e1c5c2688d0b2ef65afbba2aa79df3e6aef99","parents":["13e07310f493dfe34d87fd19149855d6ed114ef2"],"ref":"refs/changes/74/6574/5","uploader":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"createdOn":1564095462,"author":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1564087655,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1564089561,"by":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1564095248,"by":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1564095248,"by":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"}},{"type":"SUBM","value":"1","grantedOn":1564095472,"by":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"bin/manta-create-topology.sh","type":"MODIFIED","insertions":4,"deletions":-140},{"file":"bin/manta-deploy-dev","type":"MODIFIED","insertions":2,"deletions":-5},{"file":"cmd/manta-adm.js","type":"MODIFIED","insertions":84,"deletions":0},{"file":"lib/adm.js","type":"MODIFIED","insertions":520,"deletions":0},{"file":"lib/common.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"lib/deploy.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":0}],"sizeInsertions":615,"sizeDeletions":-146},"patchSets":[{"number":"1","revision":"5d63251e58c28e8538f0cf5997d74848157b1570","parents":["0fc81c40b40aec0c8b70e7bd274685767d394cbf"],"ref":"refs/changes/74/6574/1","uploader":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"createdOn":1562635785,"author":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1562635848,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"bin/manta-create-topology.sh","type":"MODIFIED","insertions":4,"deletions":-140},{"file":"bin/manta-deploy-dev","type":"MODIFIED","insertions":2,"deletions":-5},{"file":"cmd/manta-adm.js","type":"MODIFIED","insertions":88,"deletions":-3},{"file":"lib/adm.js","type":"MODIFIED","insertions":512,"deletions":-1},{"file":"lib/common.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"lib/deploy.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":0}],"sizeInsertions":611,"sizeDeletions":-150},{"number":"2","revision":"c13748f7de21dadfe2ed57e0d678fc02aa5e449d","parents":["0fc81c40b40aec0c8b70e7bd274685767d394cbf"],"ref":"refs/changes/74/6574/2","uploader":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"createdOn":1562635900,"author":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1562635964,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1564082205,"by":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1563376457,"by":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"}}],"comments":[{"file":"lib/adm.js","line":4823,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"I would add a note here like \"This will cause a few important changes in the generated if set to true\"... otherwise it\u0027s not immediately clear if the bulleted list applies to \"false\" or \"true\""},{"file":"lib/adm.js","line":4823,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Done"},{"file":"lib/adm.js","line":4905,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"super duper nit:  so, \"uuid\" here is generated above as node_uuid.v4() so we are guaranteed it\u0027ll be safe to use in a filesystem path.  However, because this \"createRingDirs\" function is standalone and not directly connected to where \"uuid\" is defined, I would prefer a guard here just to make sure \"uuid\" is safe to use in a file path.... just in case something changes in the future.\n\nbasically, i\u0027d like to see here:\n\n assertplus.uuid(uuid, \u0027uuid\u0027);\n\nThis way, since \"uuid\" is defined outside of this function, this function can at least be sure it\u0027s safe to use."},{"file":"lib/adm.js","line":4905,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Done"},{"file":"lib/adm.js","line":4944,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"nit: %d"},{"file":"lib/adm.js","line":4944,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Done"},{"file":"lib/adm.js","line":4965,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"note: this can throw, and my or may not be what we expect to happen.  I don\u0027t know this code base super well, but perhaps it\u0027s worth it to try/catch this and callback with an error in the event that JSON.parse fails."},{"file":"lib/adm.js","line":4965,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Done"},{"file":"lib/adm.js","line":5046,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"same comment above about ensuring uuid is safe to use a filesystem path."},{"file":"lib/adm.js","line":5046,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"bin/manta-create-topology.sh","type":"MODIFIED","insertions":4,"deletions":-140},{"file":"bin/manta-deploy-dev","type":"MODIFIED","insertions":2,"deletions":-5},{"file":"cmd/manta-adm.js","type":"MODIFIED","insertions":85,"deletions":-1},{"file":"lib/adm.js","type":"MODIFIED","insertions":512,"deletions":-1},{"file":"lib/common.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"lib/deploy.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":0}],"sizeInsertions":608,"sizeDeletions":-148},{"number":"3","revision":"fb2832a2dfd56120360ed155d0069d04485763f2","parents":["0fc81c40b40aec0c8b70e7bd274685767d394cbf"],"ref":"refs/changes/74/6574/3","uploader":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"createdOn":1564087594,"author":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1564087655,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1564089561,"by":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1564095248,"by":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1564095248,"by":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"bin/manta-create-topology.sh","type":"MODIFIED","insertions":4,"deletions":-140},{"file":"bin/manta-deploy-dev","type":"MODIFIED","insertions":2,"deletions":-5},{"file":"cmd/manta-adm.js","type":"MODIFIED","insertions":85,"deletions":-1},{"file":"lib/adm.js","type":"MODIFIED","insertions":521,"deletions":-1},{"file":"lib/common.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"lib/deploy.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":0}],"sizeInsertions":617,"sizeDeletions":-148},{"number":"4","revision":"54647f34ff12511e8cbc54d6da36501c6dda9c07","parents":["13e07310f493dfe34d87fd19149855d6ed114ef2"],"ref":"refs/changes/74/6574/4","uploader":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"createdOn":1564095319,"author":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1564087655,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1564089561,"by":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1564095248,"by":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1564095248,"by":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"bin/manta-create-topology.sh","type":"MODIFIED","insertions":4,"deletions":-140},{"file":"bin/manta-deploy-dev","type":"MODIFIED","insertions":2,"deletions":-5},{"file":"cmd/manta-adm.js","type":"MODIFIED","insertions":84,"deletions":0},{"file":"lib/adm.js","type":"MODIFIED","insertions":520,"deletions":0},{"file":"lib/common.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"lib/deploy.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":0}],"sizeInsertions":615,"sizeDeletions":-146},{"number":"5","revision":"425e1c5c2688d0b2ef65afbba2aa79df3e6aef99","parents":["13e07310f493dfe34d87fd19149855d6ed114ef2"],"ref":"refs/changes/74/6574/5","uploader":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"createdOn":1564095462,"author":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1564087655,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1564089561,"by":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"}},{"type":"SUBM","value":"1","grantedOn":1564095472,"by":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1564095248,"by":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1564095248,"by":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"bin/manta-create-topology.sh","type":"MODIFIED","insertions":4,"deletions":-140},{"file":"bin/manta-deploy-dev","type":"MODIFIED","insertions":2,"deletions":-5},{"file":"cmd/manta-adm.js","type":"MODIFIED","insertions":84,"deletions":0},{"file":"lib/adm.js","type":"MODIFIED","insertions":520,"deletions":0},{"file":"lib/common.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"lib/deploy.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":0}],"sizeInsertions":615,"sizeDeletions":-146}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"}]}