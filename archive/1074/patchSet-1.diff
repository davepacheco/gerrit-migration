From e9af173e016f43925feea84f7aa511f8144aaaff Mon Sep 17 00:00:00 2001
From: Trent Mick <trent.mick@joyent.com>
Date: Tue, 6 Dec 2016 14:41:53 -0800
Subject: [PATCH] joyent/node-manta#291 get 'make testall' to test with node
 v7, drop node v5

---
 Makefile                | 22 +++++++++++++---------
 test/node.paths.example |  2 +-
 2 files changed, 14 insertions(+), 10 deletions(-)

diff --git a/Makefile b/Makefile
index 5516ece..e2e74d6 100644
--- a/Makefile
+++ b/Makefile
@@ -65,22 +65,26 @@ test: deps
 # This requires a "test/node.paths" file that looks something like
 # "test/node.paths.example".
 #
+# Note: 'test4' is here last on the assumption that Node v4 is the most common
+# current node version for a developer, so a 'make testall' will leave one
+# with a node_modules/ for that version.
+#
 .PHONY: testall
-testall: test6 test5 test4 test012 test010
+testall: test7 test6 test012 test010 test4
 
-.PHONY: test6
-test6:
+.PHONY: test7
+test7:
 	@([[ -f test/node.paths ]] || (echo "no test/node.paths" && exit 1) \
-		&& echo "# Test with node `$(shell awk '/^6/ { print $$2 }' test/node.paths)/node --version`" \
-		&& PATH="$(shell awk '/^6/ { print $$2 }' test/node.paths):$(PATH)" \
+		&& echo "# Test with node `$(shell awk '/^7/ { print $$2 }' test/node.paths)/node --version`" \
+		&& PATH="$(shell awk '/^7/ { print $$2 }' test/node.paths):$(PATH)" \
 			NPM_CONFIG_LOGLEVEL=silent NPM_CONFIG_PROGRESS=false \
 			make clean test)
 
-.PHONY: test5
-test5:
+.PHONY: test6
+test6:
 	@([[ -f test/node.paths ]] || (echo "no test/node.paths" && exit 1) \
-		&& echo "# Test with node `$(shell awk '/^5/ { print $$2 }' test/node.paths)/node --version`" \
-		&& PATH="$(shell awk '/^5/ { print $$2 }' test/node.paths):$(PATH)" \
+		&& echo "# Test with node `$(shell awk '/^6/ { print $$2 }' test/node.paths)/node --version`" \
+		&& PATH="$(shell awk '/^6/ { print $$2 }' test/node.paths):$(PATH)" \
 			NPM_CONFIG_LOGLEVEL=silent NPM_CONFIG_PROGRESS=false \
 			make clean test)
 
diff --git a/test/node.paths.example b/test/node.paths.example
index 81e610c..a80ab6e 100644
--- a/test/node.paths.example
+++ b/test/node.paths.example
@@ -1,5 +1,5 @@
+7 ~/opt/node-7/bin
 6 ~/opt/node-6/bin
-5 ~/opt/node-5/bin
 4 ~/opt/node-4/bin
 0.12 ~/opt/node-0.12/bin
 0.10 ~/opt/node-0.10/bin
-- 
2.21.0

