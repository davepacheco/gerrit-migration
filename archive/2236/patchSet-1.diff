From 5939a0bc0d3f7d4e633f843d5938a53d7ad425a1 Mon Sep 17 00:00:00 2001
From: Jerry Jelinek <jerry.jelinek@joyent.com>
Date: Wed, 19 Jul 2017 21:09:54 +0000
Subject: [PATCH] OS-6238 panic in lxpr_access

---
 usr/src/uts/common/brand/lx/procfs/lx_prvnops.c | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/usr/src/uts/common/brand/lx/procfs/lx_prvnops.c b/usr/src/uts/common/brand/lx/procfs/lx_prvnops.c
index 5978711b2c..34701a4690 100644
--- a/usr/src/uts/common/brand/lx/procfs/lx_prvnops.c
+++ b/usr/src/uts/common/brand/lx/procfs/lx_prvnops.c
@@ -5780,7 +5780,8 @@ lxpr_doaccess(lxpr_node_t *lxpnp, boolean_t shallow, int mode, int flags,
 			return (ENOENT);
 		}
 		if (tp == curproc || secpolicy_proc_access(cr) == 0 ||
-		    priv_proc_cred_perm(cr, tp, NULL, mode) == 0) {
+		    (!((tp->p_flag & SEXITING) || tp->p_stat == SZOMB) &&
+		    priv_proc_cred_perm(cr, tp, NULL, mode) == 0)) {
 			allow_pid_access = B_TRUE;
 		}
 		lxpr_unlock(tp);
-- 
2.21.0

