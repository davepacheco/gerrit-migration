{"project":"joyent/registrar","branch":"master","topic":"HEAD-2350","id":"I2c4b9a7db6b9a215e0fcd2ff6f16bde701673812","number":"1568","subject":"HEAD-2350 binder/registrar documentation could use work Reviewed by: Alex Wilson \u003calex.wilson@joyent.com\u003e Reviewed by: Jordan Hendricks \u003cjordan.hendricks@joyent.com\u003e Reviewed by: Brittany Wald \u003cbrittany.wald@joyent.com\u003e Reviewed by: Trent Mick \u003ctrentm@gma","owner":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"url":"https://cr.joyent.us/1568","commitMessage":"HEAD-2350 binder/registrar documentation could use work\nReviewed by: Alex Wilson \u003calex.wilson@joyent.com\u003e\nReviewed by: Jordan Hendricks \u003cjordan.hendricks@joyent.com\u003e\nReviewed by: Brittany Wald \u003cbrittany.wald@joyent.com\u003e\nReviewed by: Trent Mick \u003ctrentm@gmail.com\u003e\nApproved by: Jordan Hendricks \u003cjordan.hendricks@joyent.com\u003e\n","createdOn":1487957689,"lastUpdated":1488215429,"open":false,"status":"MERGED","comments":[{"timestamp":1487957689,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Uploaded patch set 1."},{"timestamp":1487957713,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1487957771,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Topic set to HEAD-2350"},{"timestamp":1487958676,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Uploaded patch set 2."},{"timestamp":1487958709,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1487960872,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 2:\n\n(4 comments)\n\nThis is great, thanks for putting this together Dave!"},{"timestamp":1487968959,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 2: Code-Review+1\n\n(4 comments)"},{"timestamp":1487974290,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Uploaded patch set 3."},{"timestamp":1487974299,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 2:\n\n(8 comments)\n\nThanks for taking a look!"},{"timestamp":1487974333,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1487974462,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Uploaded patch set 4."},{"timestamp":1487974481,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Patch Set 3:\n\n(13 comments)\n\nThis is great work! Thanks for putting it together. I\u0027m sure it will be really useful for new folks coming on board too.\n\nMost of my feedback is nits and braoder suggestions for some things we can add based on my perspective as a reader of the docs."},{"timestamp":1487974517,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1487975039,"reviewer":{"name":"Brittany Wald","email":"brittany.wald@joyent.com","username":"princesspretzel"},"message":"Patch Set 4:\n\n(15 comments)\n\nThanks for writing all this up, I feel like I understand how these components work much more clearly now!  Most of my comments are nits or places where I wasn\u0027t quite sure how something worked from the context of the sentence/section, so that could just be a lack of more general information on my part."},{"timestamp":1487975590,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 2:\n\n(4 comments)"},{"timestamp":1487975850,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1487975984,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Uploaded patch set 5."},{"timestamp":1487976018,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1487976035,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 2:\n\n(11 comments)\n\nPatchsets 3-4 address Trent and Robert\u0027s comments.  Patchset 5 addresses Jordan\u0027s comments.  Next I\u0027ll work through Brittany\u0027s and Alex\u0027s.  Thanks everyone for taking a look!"},{"timestamp":1487976170,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 2:\n\n(6 comments)"},{"timestamp":1487977379,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Uploaded patch set 6."},{"timestamp":1487977417,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 6: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1487977442,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 2:\n\n(14 comments)"},{"timestamp":1487977628,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 2:\n\n(2 comments)\n\nI think I\u0027ve now addressed all the comments, but let me know if I\u0027ve missed something!"},{"timestamp":1487977859,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 6: Code-Review+1"},{"timestamp":1487978009,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Patch Set 6: Code-Review+1"},{"timestamp":1487979437,"reviewer":{"name":"Brittany Wald","email":"brittany.wald@joyent.com","username":"princesspretzel"},"message":"Patch Set 6: Code-Review+1\n\n(2 comments)"},{"timestamp":1487980481,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 6: Code-Review+1"},{"timestamp":1488211538,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 6:\n\nAnybody want to give this an IA +1?"},{"timestamp":1488213046,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Patch Set 6: Integration-Approval+1"},{"timestamp":1488213599,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Uploaded patch set 7: Commit message was updated."},{"timestamp":1488215429,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by David Pacheco"}],"currentPatchSet":{"number":"7","revision":"2c4b9a7db6b9a215e0fcd2ff6f16bde701673812","parents":["81aab4c9e67dbe1817ca239fcfbbb5cfffa77e26"],"ref":"refs/changes/68/1568/7","uploader":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"createdOn":1488213599,"author":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1487977417,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1487977859,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1487978009,"by":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1487979437,"by":{"name":"Brittany Wald","email":"brittany.wald@joyent.com","username":"princesspretzel"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1487980481,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1488213046,"by":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"}},{"type":"SUBM","value":"1","grantedOn":1488215429,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":12,"deletions":0},{"file":".gitmodules","type":"MODIFIED","insertions":0,"deletions":-3},{"file":"Makefile","type":"MODIFIED","insertions":2,"deletions":-4},{"file":"README.md","type":"MODIFIED","insertions":794,"deletions":-6},{"file":"deps/restdown","type":"DELETED","insertions":0,"deletions":-1},{"file":"docs/index.md","type":"DELETED","insertions":0,"deletions":-127}],"sizeInsertions":796,"sizeDeletions":-141},"patchSets":[{"number":"1","revision":"b7742d1a4c220409f99a0fa169e7268e77bb6bda","parents":["81aab4c9e67dbe1817ca239fcfbbb5cfffa77e26"],"ref":"refs/changes/68/1568/1","uploader":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"createdOn":1487957689,"author":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1487957713,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"README.md","type":"MODIFIED","insertions":785,"deletions":-6},{"file":"docs/index.md","type":"DELETED","insertions":0,"deletions":-127}],"sizeInsertions":785,"sizeDeletions":-134},{"number":"2","revision":"869dab74fdb9f4d6f97e6f1ee8625aa3d0592f7c","parents":["81aab4c9e67dbe1817ca239fcfbbb5cfffa77e26"],"ref":"refs/changes/68/1568/2","uploader":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"createdOn":1487958676,"author":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1487958709,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1487968959,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"comments":[{"file":"README.md","line":37,"reviewer":{"name":"Brittany Wald","email":"brittany.wald@joyent.com","username":"princesspretzel"},"message":"nit: Do you want all instances of binder first-letter-capitalized?"},{"file":"README.md","line":37,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Done"},{"file":"README.md","line":52,"reviewer":{"name":"Brittany Wald","email":"brittany.wald@joyent.com","username":"princesspretzel"},"message":"Is this a default feature of ZooKeeper?  It seems so from later mentions, but I am not sure about ZooKeeper internals, though perhaps anyone working on Registrar would be moreso than I."},{"file":"README.md","line":52,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"\"Ephemeral nodes\" are a standard part of ZK and its terminology, yeah. Maybe a (see ZK docs for more details about ephemeral nodes) or something would do, perhaps even with a link?"},{"file":"README.md","line":52,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I looked for a good place to put a general link, but wasn\u0027t sure where it really fit.  So I linked \"ephemeral node\" here to the canonical documentation for the version that we\u0027re using."},{"file":"README.md","line":58,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"nit: upper case \u0027binder\u0027 here"},{"file":"README.md","line":58,"reviewer":{"name":"Brittany Wald","email":"brittany.wald@joyent.com","username":"princesspretzel"},"message":"nit:  If so, caps here."},{"file":"README.md","line":58,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Done"},{"file":"README.md","line":67,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"After reading the normal example, the next question I have as a reader here is how properly functioning services remain in Zookeeper. The answer here is Zookeeper heartbeats, right? It might be good to explicitly call that out in the example (perhaps you could mention it in step 2)."},{"file":"README.md","line":67,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Done"},{"file":"README.md","line":103,"reviewer":{"name":"Brittany Wald","email":"brittany.wald@joyent.com","username":"princesspretzel"},"message":"nit:  Another caps?"},{"file":"README.md","line":103,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Done"},{"file":"README.md","line":146,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"nit: backticks around the file path might make it a bit easier to read in the rendered version."},{"file":"README.md","line":146,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I kept going back and forth on which to use for file paths, ZK paths, and DNS names.  I decided backticks were too excessive for the ZK paths and DNS names, but this is the only file path, so I went ahead and changed it."},{"file":"README.md","line":156,"reviewer":{"name":"Brittany Wald","email":"brittany.wald@joyent.com","username":"princesspretzel"},"message":"In this case, where is the list fetched from?"},{"file":"README.md","line":156,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"A shell script that looks at the \"deployment size\" parameter in SAPI and then decides how many processes to create. The SMF manifests are parametrized the same way."},{"file":"README.md","line":156,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Brittany,\n\nCurrently hardcoded in the Triton moray\u0027s initial zone setup script: https://github.com/joyent/moray/blob/master/boot/setup.sh#L106-L131\n\nNot sure about the moray setup script for *Manta\u0027s* morays."},{"file":"README.md","line":156,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"What Alex said.  I figured it was enough here to describe when this work happens so that people can dig into those components (e.g., the build process or the zone setup scripts) for the details.  It\u0027s an unusual case and I didn\u0027t want to get to bogged down with it in the text, but let me know if it\u0027s just more confusing to have it here."},{"file":"README.md","line":176,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"It may be worth having these initial names here match the name in property. When I first saw it, I did a double take, since it wasn\u0027t in the table."},{"file":"README.md","line":176,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Done"},{"file":"README.md","line":183,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Heh, really? Because no Triton core zones currently do this :)\n\n```\n[root@headnode (coal) ~]# grep adminIp /zones/*/root/opt/smartdc/registrar/etc/config.json\n[root@headnode (coal) ~]#\n```"},{"file":"README.md","line":183,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I think that works reliably today because Triton zones are generally only on one network.  However, if someone were to add another VNIC to the zone (either as part of the software because the zone now needs to be on a new network, or in an ad hoc way for convenience in a specific deployment), I would expect that could cause registration to do the wrong thing.  By saying it\u0027s not recommended, I\u0027m trying to encourage people to consider which network they want to advertise on instead of relying on there being only one."},{"file":"README.md","line":185,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"As I was reading this part, I was thinking it might be useful to be able to skip to an example configuration before reading more about the fields. It might be worth calling out that there is an example configuration below, but that the final source of truth on the configuration options is the node-zkplus project."},{"file":"README.md","line":185,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Done"},{"file":"README.md","line":202,"reviewer":{"name":"Brittany Wald","email":"brittany.wald@joyent.com","username":"princesspretzel"},"message":"Would these be stored in that \"/us/joyent/emy-10/authcache/a2674d3b-a9c4-46bc-a835-b6ce21d522c2\" file?"},{"file":"README.md","line":202,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Yes, exactly."},{"file":"README.md","line":228,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Do you think it\u0027s worth showing an example looking up a service record for a service that has SRV records as well?"},{"file":"README.md","line":228,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"I was about to type this! :) But there are a bunch of SRV examples further down that cover it quite well, I don\u0027t know if having it here really adds that much? Also authcache is not that great an example for SRV since it only ever makes one process (so one port)"},{"file":"README.md","line":228,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I thought it was a little much to absorb at this point, so I have that further along, but I\u0027m open to moving that up."},{"file":"README.md","line":247,"reviewer":{"name":"Brittany Wald","email":"brittany.wald@joyent.com","username":"princesspretzel"},"message":"These lines hit the 80 character wrap limit but I don\u0027t see why the columns couldn\u0027t be lengthened vertically to let them in."},{"file":"README.md","line":247,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Brittany,\n\n\"Lengthened vertically.\"?\n\nGitHub-flavoured Markdown\u0027s limitation on table rendering is that a cell needs to be all on one line, IIUC."},{"file":"README.md","line":247,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I don\u0027t know of a way to preserve the 80-column limit for tables like this (or blockquoted text, for that matter), so I usually treat them as exceptions to the 80-column limit in Markdown."},{"file":"README.md","line":247,"reviewer":{"name":"Brittany Wald","email":"brittany.wald@joyent.com","username":"princesspretzel"},"message":"Trent/Dave,\nI mean using 2 cells for one line (https://gist.github.com/princesspretzel/ee6e492368a1671fe427b66e65f78480) but I can see why it makes sense as an exception."},{"file":"README.md","line":248,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"imgapi\u0027s and authcache\u0027s registrar config file also has a \"ttl\":60 value here. Is that vestigial?"},{"file":"README.md","line":248,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Nice catch.  It looks like that value is used for the TTL at the top level of the host record, which means it will generally be the TTL of any A answers generated from this record.  (As far as I can tell, registrar does not ever put a TTL on the inner record inside the host record, even though Binder checks for one there.)"},{"file":"README.md","line":251,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"The rendered form of the end of the first sentence + the first word of the second appear as if the record is created at: `($hostname).($domain).($hostname)`. This threw me off for a second. Perhaps we could reword the second sentence so that `$(hostname)` occurs later."},{"file":"README.md","line":251,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Done"},{"file":"README.md","line":255,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"nit: does github markdown have proper em dashes? If so, we should use that here."},{"file":"README.md","line":255,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"The only ways I know of are to use the HTML escape (which starts diverging from the Markdown goal of looking like regular text when not rendered) or to use an actual em dash character (\"—\").  I\u0027ve gone ahead and done the latter and verified that GitHub does the right thing with it, but I don\u0027t know if using non-ASCII characters is problematic in this context."},{"file":"README.md","line":255,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Ew. Ascii or die. :)\nAnyway, more seriously my pref is to not go off ASCII just for things like fancy quotes and emdashes. There are some Markdown renderers that offer an option to automatically transform \u0027--\u0027 to emdash for the output HTML."},{"file":"README.md","line":255,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"That was my original bias, too, but I also don\u0027t mind seeing \"--\" in plain text anyway.  I\u0027m fine with either option here."},{"file":"README.md","line":256,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"If they don\u0027t end with `domain`, what happens?"},{"file":"README.md","line":256,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I have not tested it, but it looks from the code like it will create host records for whatever DNS names are present in the array, even if they\u0027re not subdomains of \"domain\"."},{"file":"README.md","line":263,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"same here with the em dashes"},{"file":"README.md","line":263,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Done"},{"file":"README.md","line":294,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Sorry if this is a dumb Q, and it doesn\u0027t need to be answered for this change:  Why is this not easy to change? For example, portolan is using `rr_host`. Why not just change that to \"load_balancer\"?"},{"file":"README.md","line":294,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"It\u0027s a good question.  There\u0027s one case I know of that would break things, and one that I know of that would just make things confusing.\n\nThe broken case is this: both the \"webapi\" and \"loadbalancer\" Manta services register with the domain \"manta.$suffix\".  \"loadbalancer\" does this like a normal service: there\u0027s a loadbalancer service record at \"manta.$suffix\" and a bunch of \"load_balancer\" host records underneath that.  As a result, you can enumerate the loadbalancers by looking up \"manta.$suffix\", and we use this for anything that contacts the front door from within Manta (e.g., Marlin, log uploading, and Manatee backups).  \"webapi\" uses the same domain, but registers \"host\" records.  As a result, in ZK, under /$suffix/manta, you have host records for both loadbalancer *and* webapi.  If we changed the behavior so that all host records were used when you make a DNS query for the service name, then looking up \"manta.$domain\" would enumerate both loadbalancers and webapis, which wouldn\u0027t work for anything that was trying to find loadbalancers today.  And of course changing the DNS names by which services are known (so that webapi uses a different DNS name) is by definition a flag day.\n\nI\u0027m planning to document that case under Muskie, since it\u0027s confused several people (myself and Alex, at least).  I\u0027ll also flesh out this sentence a bit.\n\nThe other case that I know where this would be confusing is that \"storage\" zones in Manta today register themselves under \"stor.$suffix\", and they also register an alias for their storage_id (which is just an integer).  So a given storage zone has DNS names like 3.stor.$suffix and $uuid.stor.$suffix.  There\u0027s no service record here, so you currently can\u0027t enumerate the storage zones.  If you could, you\u0027d wind up with two DNS answers for each zone, which isn\u0027t wrong exactly, but would be confusing."},{"file":"README.md","line":294,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Thanks for the explanation. And thanks a lot for these docs."},{"file":"README.md","line":305,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Clean up trailing spaces? There are a couple of other occurrences beyond this section."},{"file":"README.md","line":305,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Done"},{"file":"README.md","line":305,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"I would call out explicitly that this is a registrar configuration, at the least to make it easier to find for people skimming.\n\nThere\u0027s also some trailing whitespace here as well."},{"file":"README.md","line":305,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Done"},{"file":"README.md","line":365,"reviewer":{"name":"Brittany Wald","email":"brittany.wald@joyent.com","username":"princesspretzel"},"message":"Wrap if possible?"},{"file":"README.md","line":365,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Can\u0027t with github (or other) markdown renders. E.g.: https://gist.github.com/trentm/3cfbaae643f54883aec27cea12d867aa"},{"file":"README.md","line":365,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Same as above."},{"file":"README.md","line":366,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Authcache\u0027s registrar config has the \"ttl\" up one level:\n\n```\n  \"registration\": {\n    \"domain\": \"authcache.staging.joyent.us\",\n    \"type\": \"redis_host\",\n    \"service\": {\n      \"type\": \"service\",\n      \"service\": {\n        \"srvce\": \"_redis\",\n        \"proto\": \"_tcp\",\n        \"port\": 6379\n      },\n      \"ttl\": 60\n    },\n    \"ttl\": 30\n  },\n```\n\nPortolan and IMGAPI seem to have it at the level you describe here:\n\n```\n  \"registration\": {\n    \"domain\": \"portolan.staging-1.joyent.us\",\n    \"type\": \"rr_host\",\n    \"service\": {\n      \"type\": \"service\",\n      \"service\": {\n        \"srvce\": \"_portolan\",\n        \"proto\": \"_tcp\",\n        \"ttl\": 60,\n        \"port\": 80\n      }\n    },\n    \"ttl\": 60\n  },\n```\n\nIs authcache\u0027s registrar config wrong here?"},{"file":"README.md","line":366,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I\u0027m afraid either one works, based on the description under \"Using TTLs\".  Here\u0027s where Binder starts with the value that comes from registration.service.ttl:\n\nhttps://github.com/joyent/binder/blob/ffcc5cbf05705a8d1481a8fb2a689ea017ab3c3d/lib/server.js#L198-L202\n\nand here\u0027s where it will reach into the value from registration.service.service.ttl:\nhttps://github.com/joyent/binder/blob/ffcc5cbf05705a8d1481a8fb2a689ea017ab3c3d/lib/server.js#L244-L249\n\nI\u0027m not sure if it\u0027s really worth documenting the other option.  What do you think?"},{"file":"README.md","line":366,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"I\u0027m cool not documenting it. Perhaps a section with suggested best practice example configs... and then we could migrate configs to that.  I get lost in `the \"service\" object in a \"service\" object, both with \"type\" fields, but only one with \"ttl\". Ack.` :)"},{"file":"README.md","line":366,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Tell me about it.  Actually, I tried to ensure that the example immediately following this would be a reasonable one to copy and paste, though I didn\u0027t call that out explicitly."},{"file":"README.md","line":449,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Should we note that it\u0027s subject to change as well?"},{"file":"README.md","line":449,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Sure."},{"file":"README.md","line":497,"reviewer":{"name":"Brittany Wald","email":"brittany.wald@joyent.com","username":"princesspretzel"},"message":"nit: \"instances of `authcache`\", maybe?"},{"file":"README.md","line":497,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Done"},{"file":"README.md","line":508,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Why is there another \"type\" field in this object?"},{"file":"README.md","line":508,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"REASONS."},{"file":"README.md","line":508,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I\u0027m afraid any explanation for that is lost to history.  I would guess that the general pattern here of using type\u003dX and having a property called \"X\" was applied one more level than it was intended to be."},{"file":"README.md","line":510,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"it might be worth calling out that this is *not* a typo at some point, too."},{"file":"README.md","line":510,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Done, above."},{"file":"README.md","line":593,"reviewer":{"name":"Brittany Wald","email":"brittany.wald@joyent.com","username":"princesspretzel"},"message":"Could wrap?"},{"file":"README.md","line":593,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Same."},{"file":"README.md","line":597,"reviewer":{"name":"Brittany Wald","email":"brittany.wald@joyent.com","username":"princesspretzel"},"message":"It might be helpful to list them out here again or make \"Registrar configuration` a link to that section, in case the reader has jumped to this link directly."},{"file":"README.md","line":597,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Done"},{"file":"README.md","line":611,"reviewer":{"name":"Brittany Wald","email":"brittany.wald@joyent.com","username":"princesspretzel"},"message":"I feel like maybe db rows are not wrapped by convention, but they could be!"},{"file":"README.md","line":642,"reviewer":{"name":"Brittany Wald","email":"brittany.wald@joyent.com","username":"princesspretzel"},"message":"Ditto the wrapping."},{"file":"README.md","line":663,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"This is a great section."},{"file":"README.md","line":666,"reviewer":{"name":"Brittany Wald","email":"brittany.wald@joyent.com","username":"princesspretzel"},"message":"nit: \"are\""},{"file":"README.md","line":666,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I had learned that \"none\" is always singular, but after some research, I see that it can also be plural!  The sources I find online all seem inconclusive on the appropriate use here, so I\u0027ve reworded it in a way that I think is inoffensive (and probably clearer)."},{"file":"README.md","line":666,"reviewer":{"name":"Brittany Wald","email":"brittany.wald@joyent.com","username":"princesspretzel"},"message":"I was thinking plural because \"none\" is standing in for \"values\" but rewording works!"},{"file":"README.md","line":727,"reviewer":{"name":"Brittany Wald","email":"brittany.wald@joyent.com","username":"princesspretzel"},"message":"It might be helpful to put a date--even just a year/season--of writing here.  Though someone could definitely go through the history, it would help quicker in-context comprehension."},{"file":"README.md","line":727,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I think including a year (and really, even saying \"today\" in the first place) understates how baked-in these assumptions are.  I\u0027ve reworded this to reflect that and eliminate the implied time dependence."},{"file":"README.md","line":749,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"The name of this section confused me when I read it in the table of contents, mostly because I associate \"Frequently Asked Questions\" with a very specific type of documentation. A possible new title could be something like: \"Debugging: Questions to Ask when Binder Doesn\u0027t Report What You Expect\" (along the lines of the first sentence of this section)."},{"file":"README.md","line":749,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I thought that was a little long, so I\u0027ve changed it to \"Debugging Notes\"."},{"file":"README.md","line":782,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Should we link to some documentation for the zookeeper CLI here? I remember wanting that when I was first using it. We could also add examples that are relevant for people debugging Binder, but that might be overkill."},{"file":"README.md","line":782,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I could not immediately find any docs that were obviously canonical, so I\u0027ve added a note about running the command and typing \"help\".  There\u0027s really only two commands worth running, and I\u0027ve clarified them inline in the text."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".gitmodules","type":"MODIFIED","insertions":0,"deletions":-3},{"file":"Makefile","type":"MODIFIED","insertions":2,"deletions":-4},{"file":"README.md","type":"MODIFIED","insertions":785,"deletions":-6},{"file":"deps/restdown","type":"DELETED","insertions":0,"deletions":-1},{"file":"docs/index.md","type":"DELETED","insertions":0,"deletions":-127}],"sizeInsertions":787,"sizeDeletions":-141},{"number":"3","revision":"d6b8136d1b93cac3a2b325633d53e03697d2ecdb","parents":["81aab4c9e67dbe1817ca239fcfbbb5cfffa77e26"],"ref":"refs/changes/68/1568/3","uploader":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"createdOn":1487974290,"author":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1487974333,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".gitmodules","type":"MODIFIED","insertions":0,"deletions":-3},{"file":"Makefile","type":"MODIFIED","insertions":2,"deletions":-4},{"file":"README.md","type":"MODIFIED","insertions":788,"deletions":-6},{"file":"deps/restdown","type":"DELETED","insertions":0,"deletions":-1},{"file":"docs/index.md","type":"DELETED","insertions":0,"deletions":-127}],"sizeInsertions":790,"sizeDeletions":-141},{"number":"4","revision":"f0e906ca1f4c984df34e61636e6e139bc6db4667","parents":["81aab4c9e67dbe1817ca239fcfbbb5cfffa77e26"],"ref":"refs/changes/68/1568/4","uploader":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"createdOn":1487974462,"author":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1487974517,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".gitmodules","type":"MODIFIED","insertions":0,"deletions":-3},{"file":"Makefile","type":"MODIFIED","insertions":2,"deletions":-4},{"file":"README.md","type":"MODIFIED","insertions":788,"deletions":-6},{"file":"deps/restdown","type":"DELETED","insertions":0,"deletions":-1},{"file":"docs/index.md","type":"DELETED","insertions":0,"deletions":-127}],"sizeInsertions":790,"sizeDeletions":-141},{"number":"5","revision":"30d31ab895bcbed782cf394d9d83c71761d064f0","parents":["81aab4c9e67dbe1817ca239fcfbbb5cfffa77e26"],"ref":"refs/changes/68/1568/5","uploader":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"createdOn":1487975984,"author":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1487976018,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".gitmodules","type":"MODIFIED","insertions":0,"deletions":-3},{"file":"Makefile","type":"MODIFIED","insertions":2,"deletions":-4},{"file":"README.md","type":"MODIFIED","insertions":791,"deletions":-6},{"file":"deps/restdown","type":"DELETED","insertions":0,"deletions":-1},{"file":"docs/index.md","type":"DELETED","insertions":0,"deletions":-127}],"sizeInsertions":793,"sizeDeletions":-141},{"number":"6","revision":"c33e3ef8508537962286dbc0e661bbd8788dba1f","parents":["81aab4c9e67dbe1817ca239fcfbbb5cfffa77e26"],"ref":"refs/changes/68/1568/6","uploader":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"createdOn":1487977379,"author":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1487977859,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1487977417,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1487980481,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1487978009,"by":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1488213046,"by":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1487979437,"by":{"name":"Brittany Wald","email":"brittany.wald@joyent.com","username":"princesspretzel"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".gitmodules","type":"MODIFIED","insertions":0,"deletions":-3},{"file":"Makefile","type":"MODIFIED","insertions":2,"deletions":-4},{"file":"README.md","type":"MODIFIED","insertions":794,"deletions":-6},{"file":"deps/restdown","type":"DELETED","insertions":0,"deletions":-1},{"file":"docs/index.md","type":"DELETED","insertions":0,"deletions":-127}],"sizeInsertions":796,"sizeDeletions":-141},{"number":"7","revision":"2c4b9a7db6b9a215e0fcd2ff6f16bde701673812","parents":["81aab4c9e67dbe1817ca239fcfbbb5cfffa77e26"],"ref":"refs/changes/68/1568/7","uploader":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"createdOn":1488213599,"author":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"SUBM","value":"1","grantedOn":1488215429,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1487977859,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1487977417,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1487980481,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1487978009,"by":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1488213046,"by":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1487979437,"by":{"name":"Brittany Wald","email":"brittany.wald@joyent.com","username":"princesspretzel"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":12,"deletions":0},{"file":".gitmodules","type":"MODIFIED","insertions":0,"deletions":-3},{"file":"Makefile","type":"MODIFIED","insertions":2,"deletions":-4},{"file":"README.md","type":"MODIFIED","insertions":794,"deletions":-6},{"file":"deps/restdown","type":"DELETED","insertions":0,"deletions":-1},{"file":"docs/index.md","type":"DELETED","insertions":0,"deletions":-127}],"sizeInsertions":796,"sizeDeletions":-141}],"allReviewers":[{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},{"name":"Brittany Wald","email":"brittany.wald@joyent.com","username":"princesspretzel"},{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}]}