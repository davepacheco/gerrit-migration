{"project":"joyent/node-triton","branch":"master","id":"Icf80a684aa339b2357347e613e64923bf16044d9","number":"1755","subject":"joyent/node-triton#173 Add support for listing and getting triton nfs volumes joyent/node-triton#174 Add support for creating triton nfs volumes joyent/node-triton#175 Add support for deleting triton NFS volumes Reviewed by: Trent Mick \u003ctrentm@gmail.com\u003e ","owner":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"url":"https://cr.joyent.us/1755","commitMessage":"joyent/node-triton#173 Add support for listing and getting triton nfs volumes\njoyent/node-triton#174 Add support for creating triton nfs volumes\njoyent/node-triton#175 Add support for deleting triton NFS volumes\nReviewed by: Trent Mick \u003ctrentm@gmail.com\u003e\nApproved by: Trent Mick \u003ctrentm@gmail.com\u003e\n","createdOn":1491432024,"lastUpdated":1500594549,"open":false,"status":"MERGED","comments":[{"timestamp":1491432024,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 1."},{"timestamp":1491432051,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1491432294,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 1:\n\nSee earlier patch discussion here: https://github.com/joyent/node-triton/pull/188"},{"timestamp":1491439728,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 2."},{"timestamp":1491439756,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1491605248,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 2:\n\n(6 comments)\n\nAs we discussed, the help/docs should clarify the story with networks if none are specified.\n\nDitto for not giving a size."},{"timestamp":1495160395,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 3."},{"timestamp":1495160402,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 2:\n\n(6 comments)"},{"timestamp":1495160437,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1496095724,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 3:\n\n(9 comments)"},{"timestamp":1496624235,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 4."},{"timestamp":1496624246,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 4:\n\n(9 comments)"},{"timestamp":1496624271,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1496625339,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 5."},{"timestamp":1496625367,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1497386837,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 5:\n\n(12 comments)\n\nThis is a cloudapi error. The following bogus predicate should be a 4xx,\nnot a 5xx:\n\n```\n[2017-06-13T20:26:10.420Z]  WARN: cloudapi/audit/16127 on d64f242a-ce2d-463b-8c3a-2361fb24c17d: handled: 500 (req_id\u003ddc508e5b-3bb7-437e-9840-f7a74ab7b7d6, audit\u003dtrue, remoteAddress\u003d172.24.2.9, remotePort\u003d52661, latency\u003d194, route\u003dlistvolumes, _audit\u003dtrue)\n    GET /trent.mick/volumes?predicate\u003d%7B%22eq%22%3A%5B%22size%22%2Cnull%5D%7D HTTP/1.1\n    date: Tue, 13 Jun 2017 20:26:10 GMT\n    authorization: Signature keyId\u003d\"/trent.mick/keys/de:e7:73:9a:b0:91:31:3e:72:8d:9f:62:ca:58:a2:ec\",algorithm\u003d\"rsa-sha256\",headers\u003d\"(request-target) date\",signature\u003d\"C8qKGuqykT5ef4uxfjxJxZ1DF0q+kEv4aQx2U4DfYdJS38OcqjbzU3S2dHuWj1mcyPjydiJ5AS22BfluzlP08wK0SPSgnen9F0X2ZuySaZ5nGRQ5eVvh9rcRyW0JWEFGaurr540nsjfDXXkFJgX0sB5FgJTpNZjdwOeE1Avt3m31F6y1S+kuZ0nw3lZwozoG80dHxeerzhl74cUDZh8A5+fFT7O/0661Wxx/5fqfCQ7kqAHB3NjkQ3wlbn51l2jBOj5Ly7RVkDgoP/LC30Ww2oIq8yCC1965Dw9oLNu6abmBtazgElE1VAu4jSIhIiljmV0/KbCCvYdhNuDb5p214Q\u003d\u003d\"\n    accept: application/json\n    user-agent: triton/5.2.0 (x64-darwin; node/4.8.0)\n    accept-version: ~8||~7\n    host: 172.26.2.8\n    connection: keep-alive\n    x-forwarded-for: ::ffff:172.24.2.9\n    --\n    HTTP/1.1 500 Internal Server Error\n    content-type: application/json\n    content-length: 131\n    access-control-allow-origin: *\n    access-control-allow-headers: Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Api-Version, Response-Time\n    access-control-allow-methods: GET, POST\n    access-control-expose-headers: Api-Version, Request-Id, Response-Time\n    connection: Keep-Alive\n    content-md5: meeIW4g+e6mju/U4ecWwZg\u003d\u003d\n    date: Tue, 13 Jun 2017 20:26:10 GMT\n    server: Joyent Triton 8.1.0\n    api-version: 8.0.0\n    request-id: dc508e5b-3bb7-437e-9840-f7a74ab7b7d6\n    response-time: 194\n    --\n    InternalServerError: {\"message\":\"Invalid list parameters: VError: predicate { eq: [ \u0027size\u0027, null ] }: field \\\"eq\\\" is not a string, number, or boolean\"}\n        at ClientRequest.onResponse (/opt/smartdc/cloudapi/node_modules/sdc-clients/node_modules/restify-clients/lib/HttpClient.js:217:26)\n```\n\n\n\nIn lib/do_volume/do_create.js, the help string for \"--type\" begs the question\nwhat other types are supported. I think that if only \u0027tritonnfs\u0027 is supported\ncurrently by all release versions of TritonDC, then we should say so in that\nhelp string.\n\n\nMight be nice to have `triton vol create -h` help output include a note on what network, if any, is attached to the volume if no \u0027-N\u0027 arg is used."},{"timestamp":1497387159,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 5:\n\n```\n$ ./bin/triton vol create\ntriton volume create: error (ResourceNotFound): The resource you requested does not exist\n```\n\n^^^ error on CreateVolume attempt in a DC without fabrics setup. Perhaps that error could be better? That is likely a CloudAPI bug."},{"timestamp":1497387533,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 5:\n\nSuggested patch for minor help output issue:\n\n```\ndiff --git a/lib/do_volume/do_create.js b/lib/do_volume/do_create.js\nindex f4fed13..15403f7 100644\n--- a/lib/do_volume/do_create.js\n+++ b/lib/do_volume/do_create.js\n@@ -188,7 +188,6 @@ do_create.help \u003d [\n     \u0027{{usage}}\u0027,\n     \u0027\u0027,\n     \u0027{{options}}\u0027,\n-    \u0027\u0027,\n     \u0027Note: Currently this dumps prettified JSON by default. That might change\u0027,\n     \u0027in the future. Use \"-j\" to explicitly get JSON output.\u0027\n     /* END JSSTYLED */\n```"},{"timestamp":1497405412,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 5:\n\n(10 comments)\n\n\u003e This is a cloudapi error. The following bogus predicate should be a 4xx,\nnot a 5xx:\n\nSounds good, will fix with https://devhub.joyent.com/jira/browse/VOLAPI-52 and https://devhub.joyent.com/jira/browse/PUBAPI-1408.\n\n\u003e In lib/do_volume/do_create.js, the help string for \"--type\" begs the question\nwhat other types are supported. I think that if only \u0027tritonnfs\u0027 is supported\ncurrently by all release versions of TritonDC, then we should say so in that\nhelp string.\n\nGood point, will fix.\n\n\u003e Might be nice to have `triton vol create -h` help output include a note on what network, if any, is attached to the volume if no \u0027-N\u0027 arg is used.\n\nAgain good point, will fix."},{"timestamp":1497405453,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 5:\n\nI haven\u0027t uploaded a new patch set yet because I\u0027m still working on addressing your comments, I\u0027ll let you know when that\u0027s done, probably in the next couple days.\n\nThanks again!"},{"timestamp":1497466811,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 5:\n\n(2 comments)"},{"timestamp":1497660219,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 6."},{"timestamp":1497660253,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 6: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1497909170,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 6: Code-Review+1\n\n(5 comments)\n\nWhen we have the lab back I\u0027ll try to play with this to get to an IA."},{"timestamp":1497929815,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 6:\n\n(5 comments)"},{"timestamp":1497929850,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 7."},{"timestamp":1497929883,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 7: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1498071690,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 6:\n\n(1 comment)"},{"timestamp":1498603946,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 7:\n\n(3 comments)"},{"timestamp":1498603972,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 8."},{"timestamp":1498604006,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 8: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1498604267,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 9."},{"timestamp":1498604301,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 9: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1500498508,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 9:\n\n(1 comment)\n\n- Shouldn\u0027t have quotes around the \"CREATED\" value for `triton vol ls -l`\n\n```\n$ triton vol ls -l\nID                                    NAME  SIZE   TYPE       STATE  CREATED\nb134e9c0-bbb5-cd21-9a08-a2725f22871e  vol0  10240  tritonnfs  ready  \"2017-07-18T23:29:34.773Z\"\n```\n\n- I also added https://github.com/joyent/node-triton/issues/216 for later."},{"timestamp":1500584782,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 9:\n\n(1 comment)"},{"timestamp":1500584788,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 10."},{"timestamp":1500584822,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 10: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1500592966,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 10: Code-Review+1 Integration-Approval+1"},{"timestamp":1500594513,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 11: Commit message was updated."},{"timestamp":1500594549,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Julien Gilli"}],"currentPatchSet":{"number":"11","revision":"dc1b6c75b72c5413f16a49d324321ab3c0607f05","parents":["87b196ac314ed791ff8c724509d29560bda95bb7"],"ref":"refs/changes/55/1755/11","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1500594513,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1500584822,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1500592966,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1500592966,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1500594549,"by":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":13,"deletions":-1},{"file":"etc/triton-bash-completion-types.sh","type":"MODIFIED","insertions":6,"deletions":0},{"file":"lib/cli.js","type":"MODIFIED","insertions":18,"deletions":0},{"file":"lib/cloudapi2.js","type":"MODIFIED","insertions":147,"deletions":0},{"file":"lib/common.js","type":"MODIFIED","insertions":152,"deletions":-51},{"file":"lib/do_image/do_list.js","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"lib/do_instance/do_list.js","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"lib/do_network/do_list.js","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"lib/do_package/do_list.js","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"lib/do_volume/do_create.js","type":"ADDED","insertions":200,"deletions":0},{"file":"lib/do_volume/do_delete.js","type":"ADDED","insertions":157,"deletions":0},{"file":"lib/do_volume/do_get.js","type":"ADDED","insertions":79,"deletions":0},{"file":"lib/do_volume/do_list.js","type":"ADDED","insertions":151,"deletions":0},{"file":"lib/do_volume/index.js","type":"ADDED","insertions":53,"deletions":0},{"file":"lib/do_volumes.js","type":"ADDED","insertions":30,"deletions":0},{"file":"lib/tritonapi.js","type":"MODIFIED","insertions":272,"deletions":-7},{"file":"lib/volumes.js","type":"ADDED","insertions":68,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"test/integration/cli-subcommands.test.js","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"test/integration/cli-volumes-size.test.js","type":"ADDED","insertions":103,"deletions":0},{"file":"test/integration/cli-volumes.test.js","type":"ADDED","insertions":251,"deletions":0},{"file":"test/integration/helpers.js","type":"MODIFIED","insertions":11,"deletions":-1},{"file":"test/unit/common.test.js","type":"MODIFIED","insertions":60,"deletions":-4},{"file":"test/unit/parseVolumeSize.test.js","type":"ADDED","insertions":92,"deletions":0}],"sizeInsertions":1892,"sizeDeletions":-71},"patchSets":[{"number":"1","revision":"65f91d5356c8f9b5c3b6f0dc9f5a3a8337a94d98","parents":["33ff58c3d3d5573904c08010a24dc232ba3c346a"],"ref":"refs/changes/55/1755/1","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1491432024,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1491432051,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":16,"deletions":0},{"file":"lib/cli.js","type":"MODIFIED","insertions":3,"deletions":0},{"file":"lib/cloudapi2.js","type":"MODIFIED","insertions":147,"deletions":0},{"file":"lib/common.js","type":"MODIFIED","insertions":100,"deletions":-14},{"file":"lib/do_volume/do_create.js","type":"ADDED","insertions":206,"deletions":0},{"file":"lib/do_volume/do_delete.js","type":"ADDED","insertions":206,"deletions":0},{"file":"lib/do_volume/do_get.js","type":"ADDED","insertions":79,"deletions":0},{"file":"lib/do_volume/do_list.js","type":"ADDED","insertions":142,"deletions":0},{"file":"lib/do_volume/index.js","type":"ADDED","insertions":53,"deletions":0},{"file":"lib/do_volumes.js","type":"ADDED","insertions":30,"deletions":0},{"file":"lib/tritonapi.js","type":"MODIFIED","insertions":142,"deletions":-6},{"file":"lib/volumes.js","type":"ADDED","insertions":68,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"test/integration/cli-subcommands.test.js","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"test/integration/cli-volumes.test.js","type":"ADDED","insertions":172,"deletions":0},{"file":"test/integration/helpers.js","type":"MODIFIED","insertions":11,"deletions":-1},{"file":"test/unit/parseVolumeSize.test.js","type":"ADDED","insertions":92,"deletions":0}],"sizeInsertions":1476,"sizeDeletions":-24},{"number":"2","revision":"9a4874061787f6ccf5845dc62508ba8964db8724","parents":["33ff58c3d3d5573904c08010a24dc232ba3c346a"],"ref":"refs/changes/55/1755/2","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1491439728,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1491439756,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/do_volume/do_create.js","line":33,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"```\n$ triton volume create\ntriton volume create: error (InvalidArgument): Error: Invalid volume name: undefined. Volume name should match /^[a-zA-Z0-9][a-zA-Z0-9_\\.\\-]+$/\n```\n\nI wonder if the required params should be arguments instead of options? \n\nCurrently it isn\u0027t clear which are required without working through them all.\n\nFor the case above it would be nice if it said something about the volume name not being specified, rather then \"undefined\" being invalid."},{"file":"lib/do_volume/do_create.js","line":33,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"That\u0027s a bug. If no name is specified, then a name is automatically generated. This was fixed by https://github.com/joyent/sdc-cloudapi/commit/ce8563f4a23334c1759744b7b1f6333cb7956212."},{"file":"lib/do_volume/do_create.js","line":37,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Is giving  a size required?"},{"file":"lib/do_volume/do_create.js","line":37,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"No, I pushed a change to RFD 26 that clarifies this: https://github.com/joyent/rfd/blob/master/rfd/0026/README.md#size."},{"file":"lib/do_volume/do_create.js","line":65,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"`net.id`"},{"file":"lib/do_volume/do_create.js","line":65,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Done"},{"file":"lib/do_volume/do_create.js","line":85,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Suggest having a tritonapi.createVolume that will resolve network name/shortid."},{"file":"lib/do_volume/do_create.js","line":85,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Done"},{"file":"lib/do_volume/do_create.js","line":124,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Not sure this is what we want. Perhaps having a \"Creating volume ...\" line before the API call, and a \"Created ...\" here if we\u0027ve waited and it is complete."},{"file":"lib/do_volume/do_create.js","line":124,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Done"},{"file":"lib/do_volume/do_create.js","line":159,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Had there been a discussion about exposing via the API what sizes are available?"},{"file":"lib/do_volume/do_create.js","line":159,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Yes, but it hadn\u0027t been documented yet. It\u0027s now documented with https://github.com/joyent/rfd/blob/master/rfd/0026/README.md#size, https://github.com/joyent/rfd/blob/master/rfd/0026/README.md#size-1 and https://github.com/joyent/rfd/blob/master/rfd/0026/README.md#listvolumesizes-get-volumessizes.\n\nI\u0027ll update the help message to mention that not passing any size will pick a default size that corresponds to the smallest size available."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":16,"deletions":0},{"file":"lib/cli.js","type":"MODIFIED","insertions":3,"deletions":0},{"file":"lib/cloudapi2.js","type":"MODIFIED","insertions":147,"deletions":0},{"file":"lib/common.js","type":"MODIFIED","insertions":100,"deletions":-14},{"file":"lib/do_volume/do_create.js","type":"ADDED","insertions":206,"deletions":0},{"file":"lib/do_volume/do_delete.js","type":"ADDED","insertions":206,"deletions":0},{"file":"lib/do_volume/do_get.js","type":"ADDED","insertions":79,"deletions":0},{"file":"lib/do_volume/do_list.js","type":"ADDED","insertions":142,"deletions":0},{"file":"lib/do_volume/index.js","type":"ADDED","insertions":53,"deletions":0},{"file":"lib/do_volumes.js","type":"ADDED","insertions":30,"deletions":0},{"file":"lib/tritonapi.js","type":"MODIFIED","insertions":142,"deletions":-6},{"file":"lib/volumes.js","type":"ADDED","insertions":68,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"test/integration/cli-subcommands.test.js","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"test/integration/cli-volumes.test.js","type":"ADDED","insertions":172,"deletions":0},{"file":"test/integration/helpers.js","type":"MODIFIED","insertions":11,"deletions":-1},{"file":"test/unit/parseVolumeSize.test.js","type":"ADDED","insertions":92,"deletions":0}],"sizeInsertions":1476,"sizeDeletions":-24},{"number":"3","revision":"50e3d06238218246a97ea896f34e500d93103550","parents":["33ff58c3d3d5573904c08010a24dc232ba3c346a"],"ref":"refs/changes/55/1755/3","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1495160395,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1495160437,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/do_volume/do_create.js","line":103,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"That uses ctx.volume *after* it is set below. That should just be `volume`, right?"},{"file":"lib/do_volume/do_create.js","line":103,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Done"},{"file":"lib/do_volume/do_delete.js","line":22,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"This whole function is no longer used."},{"file":"lib/do_volume/do_delete.js","line":22,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Done"},{"file":"lib/do_volume/do_delete.js","line":122,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Let\u0027s not have ellipses, please."},{"file":"lib/do_volume/do_delete.js","line":122,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Done"},{"file":"lib/do_volume/do_delete.js","line":203,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Drop that. Then the completion will allow multiple \u0027tritonvolume\u0027 args."},{"file":"lib/do_volume/do_delete.js","line":203,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Done"},{"file":"lib/do_volume/do_list.js","line":137,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Some help output for what FILTERS are would be nice. E.g. from `triton ls -h`."},{"file":"lib/do_volume/do_list.js","line":137,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Done"},{"file":"lib/tritonapi.js","line":2647,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"size here should be *number*?"},{"file":"lib/tritonapi.js","line":2647,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Done"},{"file":"lib/tritonapi.js","line":2672,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"It looks like CloudApi.createVolume takes a \"networks\" *plural* option, and not \"network\"."},{"file":"lib/tritonapi.js","line":2672,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Done"},{"file":"lib/tritonapi.js","line":2706,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Would it be worthwhile copying how getInstance works: tryUuid, tryName, tryShortId.\n\nThe main differences are (most important first):\n- If searching by unique name (I\u0027m assuming VOLAPI enforces \"name\" uniqueness for volumes within the account), it will do a lighter-weight request to cloudapi and volapi that will return just the single hit, instead of possibly all the instances/volumes the account has.\n- If the instance name happens to be a UUID, it will still find it by name. The current impl here for getVolume won\u0027t. It looks like this was copied from \"getPackage\"."},{"file":"lib/tritonapi.js","line":2706,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Done"},{"file":"lib/tritonapi.js","line":2715,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"nit:\n\ncb(err);\nreturn;"},{"file":"lib/tritonapi.js","line":2715,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":16,"deletions":0},{"file":"etc/triton-bash-completion-types.sh","type":"MODIFIED","insertions":6,"deletions":0},{"file":"lib/cli.js","type":"MODIFIED","insertions":18,"deletions":0},{"file":"lib/cloudapi2.js","type":"MODIFIED","insertions":148,"deletions":-1},{"file":"lib/common.js","type":"MODIFIED","insertions":100,"deletions":-14},{"file":"lib/do_volume/do_create.js","type":"ADDED","insertions":198,"deletions":0},{"file":"lib/do_volume/do_delete.js","type":"ADDED","insertions":206,"deletions":0},{"file":"lib/do_volume/do_get.js","type":"ADDED","insertions":79,"deletions":0},{"file":"lib/do_volume/do_list.js","type":"ADDED","insertions":142,"deletions":0},{"file":"lib/do_volume/index.js","type":"ADDED","insertions":53,"deletions":0},{"file":"lib/do_volumes.js","type":"ADDED","insertions":30,"deletions":0},{"file":"lib/tritonapi.js","type":"MODIFIED","insertions":201,"deletions":-6},{"file":"lib/volumes.js","type":"ADDED","insertions":68,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"test/integration/cli-subcommands.test.js","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"test/integration/cli-volumes.test.js","type":"ADDED","insertions":251,"deletions":0},{"file":"test/integration/helpers.js","type":"MODIFIED","insertions":11,"deletions":-1},{"file":"test/unit/parseVolumeSize.test.js","type":"ADDED","insertions":92,"deletions":0}],"sizeInsertions":1628,"sizeDeletions":-25},{"number":"4","revision":"59dd507ad3a13c7c93efc3441b6258e7582055ed","parents":["33ff58c3d3d5573904c08010a24dc232ba3c346a"],"ref":"refs/changes/55/1755/4","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1496624235,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1496624271,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":16,"deletions":0},{"file":"etc/triton-bash-completion-types.sh","type":"MODIFIED","insertions":6,"deletions":0},{"file":"lib/cli.js","type":"MODIFIED","insertions":18,"deletions":0},{"file":"lib/cloudapi2.js","type":"MODIFIED","insertions":148,"deletions":-1},{"file":"lib/common.js","type":"MODIFIED","insertions":106,"deletions":-14},{"file":"lib/do_volume/do_create.js","type":"ADDED","insertions":199,"deletions":0},{"file":"lib/do_volume/do_delete.js","type":"ADDED","insertions":157,"deletions":0},{"file":"lib/do_volume/do_get.js","type":"ADDED","insertions":79,"deletions":0},{"file":"lib/do_volume/do_list.js","type":"ADDED","insertions":146,"deletions":0},{"file":"lib/do_volume/index.js","type":"ADDED","insertions":53,"deletions":0},{"file":"lib/do_volumes.js","type":"ADDED","insertions":30,"deletions":0},{"file":"lib/tritonapi.js","type":"MODIFIED","insertions":271,"deletions":-7},{"file":"lib/volumes.js","type":"ADDED","insertions":68,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"test/integration/cli-subcommands.test.js","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"test/integration/cli-volumes-size.test.js","type":"ADDED","insertions":103,"deletions":0},{"file":"test/integration/cli-volumes.test.js","type":"ADDED","insertions":251,"deletions":0},{"file":"test/integration/helpers.js","type":"MODIFIED","insertions":11,"deletions":-1},{"file":"test/unit/parseVolumeSize.test.js","type":"ADDED","insertions":92,"deletions":0}],"sizeInsertions":1764,"sizeDeletions":-27},{"number":"5","revision":"3e50e2980b3913535a182bb3bd065d8edbc270f8","parents":["8493c52be3cc71b110bc5d08d4531032f5a282b8"],"ref":"refs/changes/55/1755/5","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1496625339,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1496625367,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/common.js","line":136,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"No longer optional now, right?\n\nPlease document the expected format of the values in `validKeys`, and document that it is doing value parsing now."},{"file":"lib/common.js","line":136,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"\u003e No longer optional now, right?\n\nLooking a bit more at this code, I actually merged \"kvToObj\" with \"objFromKeyValueArgs\", otherwise we would have ended up with a bunch of duplicated code. I hope I\u0027ve done it in a way that is ok.\n\nAs a result, this function has been refactored a bit, and now the \"validKeys\" parameter is optional.\n\n\u003e Please document the expected format of the values in `validKeys`, and document that it is doing value parsing now.\n\nThat\u0027s done: the format of the \"validKeys\" is back to being an array of string, as before, however it is still doing value parsing, and that\u0027s documented now too."},{"file":"lib/common.js","line":178,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"If \u0027validKeys\u0027 to \u0027_parseFilterKeyAndValue\u0027 is no longer optional, then it has to be made not optional here as well.\n\nActually the format of `validKeys` has changed as well, so do the callers of kvToObj need to be updated?"},{"file":"lib/common.js","line":178,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"As mentioned above, I refactored that part, and what replaces \"_parseFilterKeyAndValue\" has now an optional \"validKeys\" parameter, and its format is now the same as it was before.\n\nI\u0027ve also run the unit tests this time (I don\u0027t know why I didn\u0027t run them with my previous patch set), and they all pass.\n\nMy apologies for being very sloppy again :("},{"file":"lib/common.js","line":194,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"no longer optional"},{"file":"lib/common.js","line":194,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Fixed, thanks!"},{"file":"lib/do_volume/do_list.js","line":22,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"FWIW, this doesn\u0027t handle non-number strings that well:\n\n```\n$ triton vol ls size\u003dasdf\nXXX filterPredicate { eq: [ \u0027size\u0027, NaN ] }\n...\n```\n\nresults in this query param:\n\n```\nGET /trent.mick/volumes?predicate\u003d%7B%22eq%22%3A%5B%22size%22%2Cnull%5D%7D HTTP/1.1\n```\n\nOne possibility would be to use some of the \"parse*\" functions from dashdash. They *are* basically about converting a given option arg string from the CLI to a value for the app to use. E.g.:\n\n```\n\u003e Number(\u0027asdf\u0027)\nNaN\n\n\u003e var dd \u003d require(\u0027dashdash\u0027)\nError: Cannot find module \u0027dashdash\u0027\n    at Function.Module._resolveFilename (module.js:325:15)\n    at Function.Module._load (module.js:276:25)\n    ...\n\u003e var dd \u003d require(\u0027cmdln\u0027).dashdash\nundefined\n\u003e dd.parsePositiveInteger({}, \u0027size\u0027, \u0027asdf\u0027)\nError: arg for \"size\" is not a positive integer: \"asdf\"\n    at Object.parsePositiveInteger (/Users/trentm/joy/node-triton2/node_modules/cmdln/node_modules/dashdash/lib/dashdash.js:143:15)\n    at repl:1:4\n    ...\n```\n\nThough, you\u0027d probably want the signature for \"fromString\" functions to be something like `function (arg[, argName])`."},{"file":"lib/tritonapi.js","line":126,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Nit: My understanding of the preference from node-verror.git examples and docs is to just do:\n\n```\nvar VError \u003d require(\u0027verror\u0027);\n```\n\nFor example, \"findCauseByName\" is documented to be on the VError class rather than the module (https://github.com/joyent/node-verror#verrorhascausewithnameerr-name). I know it is somewhat splitting hairs because those two things are the same."},{"file":"lib/tritonapi.js","line":126,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"No that\u0027s correct, I was just used to the old behavior and haven\u0027t adjusted yet, will fix."},{"file":"lib/tritonapi.js","line":2786,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Is my nit\u0027ing about:\n\n```\nnext();\nreturn;\n```\n\njust annoying? :)"},{"file":"lib/tritonapi.js","line":2786,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"No, I agree with that, I just copied and pasted that code from another part of node-triton, which uses that form in a lot of places. Will fix."},{"file":"lib/tritonapi.js","line":2818,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Should this be initialized to `null`, rather than potentially passing back `next(undefined)` below?"},{"file":"lib/tritonapi.js","line":2818,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"It doesn\u0027t make any difference, unless I\u0027m missing something. Calling \"next(undefined)\" will make vasync.pipeline run the next function in the pipeline."},{"file":"lib/tritonapi.js","line":2818,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Yup, fair. I\u0027m just tending to avoiding using `undefined` in my old age."},{"file":"lib/tritonapi.js","line":2821,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"should be `next`, not `cb`."},{"file":"lib/tritonapi.js","line":2821,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Good catch, thanks! Will fix."},{"file":"test/integration/cli-volumes-size.test.js","line":8,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Copyright (c) 2017, Joyent, Inc.\n\nPer eng.git. I know we are inconsistent in this repo. I\u0027d *heard* at one point that we should drop the \"(c)\", but I was mistaken in my source on that."},{"file":"test/integration/cli-volumes-size.test.js","line":8,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Done"},{"file":"test/integration/cli-volumes-size.test.js","line":32,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Does this work in COAL? If so, cool. :)"},{"file":"test/integration/cli-volumes-size.test.js","line":32,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Yes, that works in COAL. What failure modes did you have in mind? That space isn\u0027t allocated up front, it\u0027s just represented as a zfs quota, is that correct?"},{"file":"test/integration/cli-volumes-size.test.js","line":32,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Cool. I believe you are right."},{"file":"test/integration/cli-volumes-size.test.js","line":89,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"*could* just use h.safeTriton for this and it\u0027ll handle non-zero exit via:\n\n```\n        t.error(err, f(\u0027ran \"triton %s\", err\u003d%s\u0027, opts.args.join(\u0027 \u0027), err));\n\n```"},{"file":"test/integration/cli-volumes-size.test.js","line":89,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Done"},{"file":"test/integration/cli-volumes.test.js","line":222,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Perhaps \"JSON.stringify\" stdout and stderr here to encode newlines and not break TAP format of the output.\n\nHowever, for all I know `t.comment` does the right thing for multi-line output."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":13,"deletions":0},{"file":"etc/triton-bash-completion-types.sh","type":"MODIFIED","insertions":6,"deletions":0},{"file":"lib/cli.js","type":"MODIFIED","insertions":18,"deletions":0},{"file":"lib/cloudapi2.js","type":"MODIFIED","insertions":147,"deletions":0},{"file":"lib/common.js","type":"MODIFIED","insertions":106,"deletions":-14},{"file":"lib/do_volume/do_create.js","type":"ADDED","insertions":199,"deletions":0},{"file":"lib/do_volume/do_delete.js","type":"ADDED","insertions":157,"deletions":0},{"file":"lib/do_volume/do_get.js","type":"ADDED","insertions":79,"deletions":0},{"file":"lib/do_volume/do_list.js","type":"ADDED","insertions":146,"deletions":0},{"file":"lib/do_volume/index.js","type":"ADDED","insertions":53,"deletions":0},{"file":"lib/do_volumes.js","type":"ADDED","insertions":30,"deletions":0},{"file":"lib/tritonapi.js","type":"MODIFIED","insertions":271,"deletions":-7},{"file":"lib/volumes.js","type":"ADDED","insertions":68,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"test/integration/cli-subcommands.test.js","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"test/integration/cli-volumes-size.test.js","type":"ADDED","insertions":103,"deletions":0},{"file":"test/integration/cli-volumes.test.js","type":"ADDED","insertions":251,"deletions":0},{"file":"test/integration/helpers.js","type":"MODIFIED","insertions":11,"deletions":-1},{"file":"test/unit/parseVolumeSize.test.js","type":"ADDED","insertions":92,"deletions":0}],"sizeInsertions":1759,"sizeDeletions":-25},{"number":"6","revision":"ee27dbef58bdfebeee38c8fa9f068f436a5a3d55","parents":["8493c52be3cc71b110bc5d08d4531032f5a282b8"],"ref":"refs/changes/55/1755/6","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1497660219,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1497660253,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1497909170,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"comments":[{"file":"lib/common.js","line":138,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Should be \"kv\" ?"},{"file":"lib/common.js","line":138,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Done"},{"file":"lib/common.js","line":213,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"This isn\u0027t used. Accidental? Or is it meant to expose options to _parseKeyValue?"},{"file":"lib/common.js","line":213,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Accidental, I forgot to remove this parameter after the latest refactoring.\n\nIs there a way to make javascriptlint catch that type of errors?"},{"file":"lib/common.js","line":213,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"jsl: Dunno. I\u0027d be interested in changing to eslint (per https://github.com/joyent/rfd/tree/master/rfd/0100). Not positive that it will catch this one."},{"file":"lib/common.js","line":231,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Why a diff with the validKeys and disableDotted usage if just a single kvs entry?"},{"file":"lib/common.js","line":231,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Done"},{"file":"lib/common.js","line":1125,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"FWIW (and for a separate change), it looks to me that *all* uses of this function set disableDotted\u003dtrue. If so, we should just drop the option."},{"file":"lib/common.js","line":1125,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Correct, are you ok with me creating a GH issue for this (just so that I don\u0027t drop the ball)?"},{"file":"lib/common.js","line":1125,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Yes, definitely."},{"file":"lib/tritonapi.js","line":2931,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Is that really the name that comes through? I.e. with mixed CAPITALIZATION_Styles?"},{"file":"lib/tritonapi.js","line":2931,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"I believe this is due to VOLAPI\u0027s error instances\u0027 \"restCode\" being all caps with https://github.com/joyent/sdc-volapi/blob/df8c244ae0505c3d7d1cb27ce2a2b2dc464a29ce/lib/errors.js#L17 and restify appending the string \"Error\" automatically with https://github.com/restify/node-restify/blob/c8cc9ae00411498e2982a17245ffd5a9185a148b/lib/errors/http_error.js#L49.\n\nFrom https://github.com/joyent/eng/blob/master/docs/index.md#error-response-format, it seems we agreed on \"must include a code CamelCase string code field\".\n\nIs it OK with you if I go and change the \"restCode\" property for all VOLAPI\u0027s custom errors to camel-cased strings and update this CR accordingly?"},{"file":"lib/tritonapi.js","line":2931,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Changed that with https://devhub.joyent.com/jira/browse/VOLAPI-54 and the latest patch set in that CR to adapt to those changes."},{"file":"lib/tritonapi.js","line":2931,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Thanks. +1"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":13,"deletions":0},{"file":"etc/triton-bash-completion-types.sh","type":"MODIFIED","insertions":6,"deletions":0},{"file":"lib/cli.js","type":"MODIFIED","insertions":18,"deletions":0},{"file":"lib/cloudapi2.js","type":"MODIFIED","insertions":147,"deletions":0},{"file":"lib/common.js","type":"MODIFIED","insertions":154,"deletions":-51},{"file":"lib/do_image/do_list.js","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"lib/do_instance/do_list.js","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"lib/do_network/do_list.js","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"lib/do_package/do_list.js","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"lib/do_volume/do_create.js","type":"ADDED","insertions":200,"deletions":0},{"file":"lib/do_volume/do_delete.js","type":"ADDED","insertions":157,"deletions":0},{"file":"lib/do_volume/do_get.js","type":"ADDED","insertions":79,"deletions":0},{"file":"lib/do_volume/do_list.js","type":"ADDED","insertions":148,"deletions":0},{"file":"lib/do_volume/index.js","type":"ADDED","insertions":53,"deletions":0},{"file":"lib/do_volumes.js","type":"ADDED","insertions":30,"deletions":0},{"file":"lib/tritonapi.js","type":"MODIFIED","insertions":272,"deletions":-7},{"file":"lib/volumes.js","type":"ADDED","insertions":68,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"test/integration/cli-subcommands.test.js","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"test/integration/cli-volumes-size.test.js","type":"ADDED","insertions":103,"deletions":0},{"file":"test/integration/cli-volumes.test.js","type":"ADDED","insertions":251,"deletions":0},{"file":"test/integration/helpers.js","type":"MODIFIED","insertions":11,"deletions":-1},{"file":"test/unit/common.test.js","type":"MODIFIED","insertions":60,"deletions":-4},{"file":"test/unit/parseVolumeSize.test.js","type":"ADDED","insertions":92,"deletions":0}],"sizeInsertions":1891,"sizeDeletions":-70},{"number":"7","revision":"75cc01c53bb69ab6cfa5867cb2d6396c97a71630","parents":["8493c52be3cc71b110bc5d08d4531032f5a282b8"],"ref":"refs/changes/55/1755/7","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1497929850,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1497929883,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":13,"deletions":0},{"file":"etc/triton-bash-completion-types.sh","type":"MODIFIED","insertions":6,"deletions":0},{"file":"lib/cli.js","type":"MODIFIED","insertions":18,"deletions":0},{"file":"lib/cloudapi2.js","type":"MODIFIED","insertions":147,"deletions":0},{"file":"lib/common.js","type":"MODIFIED","insertions":152,"deletions":-51},{"file":"lib/do_image/do_list.js","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"lib/do_instance/do_list.js","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"lib/do_network/do_list.js","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"lib/do_package/do_list.js","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"lib/do_volume/do_create.js","type":"ADDED","insertions":200,"deletions":0},{"file":"lib/do_volume/do_delete.js","type":"ADDED","insertions":157,"deletions":0},{"file":"lib/do_volume/do_get.js","type":"ADDED","insertions":79,"deletions":0},{"file":"lib/do_volume/do_list.js","type":"ADDED","insertions":148,"deletions":0},{"file":"lib/do_volume/index.js","type":"ADDED","insertions":53,"deletions":0},{"file":"lib/do_volumes.js","type":"ADDED","insertions":30,"deletions":0},{"file":"lib/tritonapi.js","type":"MODIFIED","insertions":272,"deletions":-7},{"file":"lib/volumes.js","type":"ADDED","insertions":68,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"test/integration/cli-subcommands.test.js","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"test/integration/cli-volumes-size.test.js","type":"ADDED","insertions":103,"deletions":0},{"file":"test/integration/cli-volumes.test.js","type":"ADDED","insertions":251,"deletions":0},{"file":"test/integration/helpers.js","type":"MODIFIED","insertions":11,"deletions":-1},{"file":"test/unit/common.test.js","type":"MODIFIED","insertions":60,"deletions":-4},{"file":"test/unit/parseVolumeSize.test.js","type":"ADDED","insertions":92,"deletions":0}],"sizeInsertions":1889,"sizeDeletions":-70},{"number":"8","revision":"549bb75732710b7a2595e080b94c19c35b81cd67","parents":["8493c52be3cc71b110bc5d08d4531032f5a282b8"],"ref":"refs/changes/55/1755/8","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1498603972,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1498604006,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":13,"deletions":0},{"file":"etc/triton-bash-completion-types.sh","type":"MODIFIED","insertions":6,"deletions":0},{"file":"lib/cli.js","type":"MODIFIED","insertions":18,"deletions":0},{"file":"lib/cloudapi2.js","type":"MODIFIED","insertions":147,"deletions":0},{"file":"lib/common.js","type":"MODIFIED","insertions":152,"deletions":-51},{"file":"lib/do_image/do_list.js","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"lib/do_instance/do_list.js","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"lib/do_network/do_list.js","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"lib/do_package/do_list.js","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"lib/do_volume/do_create.js","type":"ADDED","insertions":200,"deletions":0},{"file":"lib/do_volume/do_delete.js","type":"ADDED","insertions":157,"deletions":0},{"file":"lib/do_volume/do_get.js","type":"ADDED","insertions":79,"deletions":0},{"file":"lib/do_volume/do_list.js","type":"ADDED","insertions":148,"deletions":0},{"file":"lib/do_volume/index.js","type":"ADDED","insertions":53,"deletions":0},{"file":"lib/do_volumes.js","type":"ADDED","insertions":30,"deletions":0},{"file":"lib/tritonapi.js","type":"MODIFIED","insertions":272,"deletions":-7},{"file":"lib/volumes.js","type":"ADDED","insertions":68,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"test/integration/cli-subcommands.test.js","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"test/integration/cli-volumes-size.test.js","type":"ADDED","insertions":103,"deletions":0},{"file":"test/integration/cli-volumes.test.js","type":"ADDED","insertions":251,"deletions":0},{"file":"test/integration/helpers.js","type":"MODIFIED","insertions":11,"deletions":-1},{"file":"test/unit/common.test.js","type":"MODIFIED","insertions":60,"deletions":-4},{"file":"test/unit/parseVolumeSize.test.js","type":"ADDED","insertions":92,"deletions":0}],"sizeInsertions":1889,"sizeDeletions":-70},{"number":"9","revision":"405e42da7f2fb358be7f287decb9fe29ae2756ff","parents":["8493c52be3cc71b110bc5d08d4531032f5a282b8"],"ref":"refs/changes/55/1755/9","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1498604267,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1498604301,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"CHANGES.md","line":10,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"nit: we should list at least the joyent/node-triton#173 (and probably all three) here in the change log.\n\n... or just merge those tickets into one and just list the one."},{"file":"CHANGES.md","line":10,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":13,"deletions":0},{"file":"etc/triton-bash-completion-types.sh","type":"MODIFIED","insertions":6,"deletions":0},{"file":"lib/cli.js","type":"MODIFIED","insertions":18,"deletions":0},{"file":"lib/cloudapi2.js","type":"MODIFIED","insertions":147,"deletions":0},{"file":"lib/common.js","type":"MODIFIED","insertions":152,"deletions":-51},{"file":"lib/do_image/do_list.js","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"lib/do_instance/do_list.js","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"lib/do_network/do_list.js","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"lib/do_package/do_list.js","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"lib/do_volume/do_create.js","type":"ADDED","insertions":200,"deletions":0},{"file":"lib/do_volume/do_delete.js","type":"ADDED","insertions":157,"deletions":0},{"file":"lib/do_volume/do_get.js","type":"ADDED","insertions":79,"deletions":0},{"file":"lib/do_volume/do_list.js","type":"ADDED","insertions":147,"deletions":0},{"file":"lib/do_volume/index.js","type":"ADDED","insertions":53,"deletions":0},{"file":"lib/do_volumes.js","type":"ADDED","insertions":30,"deletions":0},{"file":"lib/tritonapi.js","type":"MODIFIED","insertions":272,"deletions":-7},{"file":"lib/volumes.js","type":"ADDED","insertions":68,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"test/integration/cli-subcommands.test.js","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"test/integration/cli-volumes-size.test.js","type":"ADDED","insertions":103,"deletions":0},{"file":"test/integration/cli-volumes.test.js","type":"ADDED","insertions":251,"deletions":0},{"file":"test/integration/helpers.js","type":"MODIFIED","insertions":11,"deletions":-1},{"file":"test/unit/common.test.js","type":"MODIFIED","insertions":60,"deletions":-4},{"file":"test/unit/parseVolumeSize.test.js","type":"ADDED","insertions":92,"deletions":0}],"sizeInsertions":1888,"sizeDeletions":-70},{"number":"10","revision":"cf80a684aa339b2357347e613e64923bf16044d9","parents":["87b196ac314ed791ff8c724509d29560bda95bb7"],"ref":"refs/changes/55/1755/10","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1500584788,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1500584822,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1500592966,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1500592966,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":13,"deletions":-1},{"file":"etc/triton-bash-completion-types.sh","type":"MODIFIED","insertions":6,"deletions":0},{"file":"lib/cli.js","type":"MODIFIED","insertions":18,"deletions":0},{"file":"lib/cloudapi2.js","type":"MODIFIED","insertions":147,"deletions":0},{"file":"lib/common.js","type":"MODIFIED","insertions":152,"deletions":-51},{"file":"lib/do_image/do_list.js","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"lib/do_instance/do_list.js","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"lib/do_network/do_list.js","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"lib/do_package/do_list.js","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"lib/do_volume/do_create.js","type":"ADDED","insertions":200,"deletions":0},{"file":"lib/do_volume/do_delete.js","type":"ADDED","insertions":157,"deletions":0},{"file":"lib/do_volume/do_get.js","type":"ADDED","insertions":79,"deletions":0},{"file":"lib/do_volume/do_list.js","type":"ADDED","insertions":151,"deletions":0},{"file":"lib/do_volume/index.js","type":"ADDED","insertions":53,"deletions":0},{"file":"lib/do_volumes.js","type":"ADDED","insertions":30,"deletions":0},{"file":"lib/tritonapi.js","type":"MODIFIED","insertions":272,"deletions":-7},{"file":"lib/volumes.js","type":"ADDED","insertions":68,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"test/integration/cli-subcommands.test.js","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"test/integration/cli-volumes-size.test.js","type":"ADDED","insertions":103,"deletions":0},{"file":"test/integration/cli-volumes.test.js","type":"ADDED","insertions":251,"deletions":0},{"file":"test/integration/helpers.js","type":"MODIFIED","insertions":11,"deletions":-1},{"file":"test/unit/common.test.js","type":"MODIFIED","insertions":60,"deletions":-4},{"file":"test/unit/parseVolumeSize.test.js","type":"ADDED","insertions":92,"deletions":0}],"sizeInsertions":1892,"sizeDeletions":-71},{"number":"11","revision":"dc1b6c75b72c5413f16a49d324321ab3c0607f05","parents":["87b196ac314ed791ff8c724509d29560bda95bb7"],"ref":"refs/changes/55/1755/11","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1500594513,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1500584822,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1500592966,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1500592966,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1500594549,"by":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":13,"deletions":-1},{"file":"etc/triton-bash-completion-types.sh","type":"MODIFIED","insertions":6,"deletions":0},{"file":"lib/cli.js","type":"MODIFIED","insertions":18,"deletions":0},{"file":"lib/cloudapi2.js","type":"MODIFIED","insertions":147,"deletions":0},{"file":"lib/common.js","type":"MODIFIED","insertions":152,"deletions":-51},{"file":"lib/do_image/do_list.js","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"lib/do_instance/do_list.js","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"lib/do_network/do_list.js","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"lib/do_package/do_list.js","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"lib/do_volume/do_create.js","type":"ADDED","insertions":200,"deletions":0},{"file":"lib/do_volume/do_delete.js","type":"ADDED","insertions":157,"deletions":0},{"file":"lib/do_volume/do_get.js","type":"ADDED","insertions":79,"deletions":0},{"file":"lib/do_volume/do_list.js","type":"ADDED","insertions":151,"deletions":0},{"file":"lib/do_volume/index.js","type":"ADDED","insertions":53,"deletions":0},{"file":"lib/do_volumes.js","type":"ADDED","insertions":30,"deletions":0},{"file":"lib/tritonapi.js","type":"MODIFIED","insertions":272,"deletions":-7},{"file":"lib/volumes.js","type":"ADDED","insertions":68,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"test/integration/cli-subcommands.test.js","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"test/integration/cli-volumes-size.test.js","type":"ADDED","insertions":103,"deletions":0},{"file":"test/integration/cli-volumes.test.js","type":"ADDED","insertions":251,"deletions":0},{"file":"test/integration/helpers.js","type":"MODIFIED","insertions":11,"deletions":-1},{"file":"test/unit/common.test.js","type":"MODIFIED","insertions":60,"deletions":-4},{"file":"test/unit/parseVolumeSize.test.js","type":"ADDED","insertions":92,"deletions":0}],"sizeInsertions":1892,"sizeDeletions":-71}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}]}