{"project":"joyent/sdc-vmapi","branch":"master","id":"Iaad2339bfe7abd80202881e30f331ff2671bbf39","number":"4749","subject":"TRITON-716 Add bhyve to list of allowed brands to do snapshots Reviewed by: Mike Gerdts \u003cmike.gerdts@joyent.com\u003e Reviewed by: Marsell Kukuljevic \u003cmarsell@joyent.com\u003e Approved by: Marsell Kukuljevic \u003cmarsell@joyent.com\u003e","owner":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"url":"https://cr.joyent.us/4749","commitMessage":"TRITON-716 Add bhyve to list of allowed brands to do snapshots\nReviewed by: Mike Gerdts \u003cmike.gerdts@joyent.com\u003e\nReviewed by: Marsell Kukuljevic \u003cmarsell@joyent.com\u003e\nApproved by: Marsell Kukuljevic \u003cmarsell@joyent.com\u003e\n","createdOn":1535380946,"lastUpdated":1542822579,"open":false,"status":"MERGED","comments":[{"timestamp":1535380946,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 1."},{"timestamp":1535380950,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit 322b85e3ac06bd5902a0505d9c83e13b3b6b77b2\n    \n    TRITON-716 Add bhyve to list of allowed brands to do snapshots"},{"timestamp":1535381886,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1535385707,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 1:\n\nWorking as expected so far:\n\n        [root@headnode (coal) /usr/vm/test]# vmadm get 2da1c670-b75f-4050-e6ac-9c8be62f871b | json brand\n        bhyve\n        [root@headnode (coal) /usr/vm/test]# sdc-vmapi /vms/2da1c670-b75f-4050-e6ac-9c8be62f871b?action\u003dcreate_snapshot -d \u0027{ \"snapshot_name\": \"foobar\" }\u0027 -X POST\n        HTTP/1.1 202 Accepted\n        Connection: close\n        workflow-api: http://workflow.coal.joyent.us\n        Content-Type: application/json\n        Content-Length: 100\n        Content-MD5: IokgkFpxMI/q2+8g4U/BlA\u003d\u003d\n        Date: Mon, 27 Aug 2018 16:00:08 GMT\n        Server: VMAPI\n        x-request-id: 5c094218-0c0a-4280-9c18-314c27415bf7\n        x-response-time: 227\n        x-server-name: b3475d8a-d27a-4e93-9f3e-133dc2d36525\n\n        {\n          \"vm_uuid\": \"2da1c670-b75f-4050-e6ac-9c8be62f871b\",\n          \"job_uuid\": \"32cdbe11-25d1-49c2-83d5-0859538a051e\"\n        }"},{"timestamp":1535386538,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 1: Code-Review+1\n\nAny integration tests covering this?"},{"timestamp":1535389090,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 1:\n\n\u003e Any integration tests covering this?\n\nSo far the previous comment I added regarding bhyve snapshot: attempt to snapshot a bhyve VM through VMAPI doesn\u0027t result into a failure.\n\nAs far as I know, there are no VMAPI tests checking for VMs brands for snapshots + no tests involving a bhyve VM, and I\u0027m not absolutely sure we can add those and make test pass fine in COAL w/o extra tuning or in nightly-1"},{"timestamp":1535462072,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 1: Code-Review+1 Integration-Approval-1\n\nCode looks fine; let\u0027s hold the integration until after we have a chance to meet today."},{"timestamp":1535475098,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 2."},{"timestamp":1535475103,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit 2bc12b939dc5197c198f6e11e029a8d3cad792ee\n    \n    TRITON-716 Add bhyve to list of allowed brands to do snapshots"},{"timestamp":1535475132,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1535478793,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 2: -Integration-Approval\n\nRemoving my -1 IA so that it doesn\u0027t hold up integration while I\u0027m on vacation.  The PI version in vms.js needs to to be updated to the PI that is capable of creating snapshots of bhyve instances."},{"timestamp":1539877354,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 3."},{"timestamp":1539877359,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 3:\n\nNew commits:\n    \n    commit c02d9bbee29b071ec31817e65ad049d2412d2ebd\n    \n    TRITON-716 Add bhyve to list of allowed brands to do snapshots"},{"timestamp":1539877406,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1539943143,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 3:\n\nIf no tests are added here, then okay, but we *need* a ticket for writing a batch of bhyve tests (provision, snapshot, destroy, et al). I don\u0027t mind doing that, so assign it to me if you\u0027d like."},{"timestamp":1539943254,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 3:\n\n(1 comment)"},{"timestamp":1540219816,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 3:\n\n(1 comment)\n\n\u003e (1 comment)\n\nStill waiting for couple issues to be finished before we can say which version of PI is the first one supporting it"},{"timestamp":1542650402,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 4."},{"timestamp":1542650406,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 4:\n\nNew commits:\n    \n    commit 1dc57556aead3eda34caec6c03521ff8b0b1b147\n    \n    TRITON-716 Add bhyve to list of allowed brands to do snapshots"},{"timestamp":1542650433,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1542749029,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 4: Code-Review+1"},{"timestamp":1542795637,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 4: Code-Review+1 Integration-Approval+1\n\nSince there\u0027s no unit tests added, please open a ticket to cover adding a bunch of tests for bhyve (not just snapshots)."},{"timestamp":1542814490,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 4:\n\nLet the issue for test suite be TRITON-977. I don\u0027t think it would hurt if we get it completed by the time we make Bhyve available to general purpose customers, though"},{"timestamp":1542822565,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 5: Commit message was updated."},{"timestamp":1542822579,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Pedro Palazón Candel"}],"currentPatchSet":{"number":"5","revision":"aad2339bfe7abd80202881e30f331ff2671bbf39","parents":["4b6e736768f740bd9224c03f014e8dba15888f39"],"ref":"refs/changes/49/4749/5","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1542822565,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1542650433,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1542749029,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1542795637,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1542795637,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}},{"type":"SUBM","value":"1","grantedOn":1542822579,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"lib/endpoints/vms.js","type":"MODIFIED","insertions":15,"deletions":-1}],"sizeInsertions":15,"sizeDeletions":-1},"patchSets":[{"number":"1","revision":"fa2c0772c675b192af032d0bb34457947174dda0","parents":["4f3a5dd787e4878aa5e2a5ee67e435b517f4bc0d"],"ref":"refs/changes/49/4749/1","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1535380946,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1535381886,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1535386538,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1535462072,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"-1","grantedOn":1535462072,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/endpoints/vms.js","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":1,"sizeDeletions":-1},{"number":"2","revision":"a1edc9f23fe615b4c8f2323fd9f51a9431dc94fe","parents":["4f3a5dd787e4878aa5e2a5ee67e435b517f4bc0d"],"ref":"refs/changes/49/4749/2","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1535475098,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1535475132,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/endpoints/vms.js","type":"MODIFIED","insertions":16,"deletions":-1}],"sizeInsertions":16,"sizeDeletions":-1},{"number":"3","revision":"c30d38232d8e8da7beef9e1e816ec5c018c4ca81","parents":["4854f338e210d64909d73fc4df08b6a34c44d4d7"],"ref":"refs/changes/49/4749/3","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1539877354,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1539877406,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/endpoints/vms.js","line":29,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Do we have a more final version yet?"},{"file":"lib/endpoints/vms.js","line":29,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"No, not yet"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/endpoints/vms.js","type":"MODIFIED","insertions":16,"deletions":-1}],"sizeInsertions":16,"sizeDeletions":-1},{"number":"4","revision":"5cd09a9cd027e5f1d8236a9305f2e15ae98b86e9","parents":["4b6e736768f740bd9224c03f014e8dba15888f39"],"ref":"refs/changes/49/4749/4","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1542650402,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1542650433,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1542795637,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1542795637,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1542749029,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/endpoints/vms.js","type":"MODIFIED","insertions":15,"deletions":-1}],"sizeInsertions":15,"sizeDeletions":-1},{"number":"5","revision":"aad2339bfe7abd80202881e30f331ff2671bbf39","parents":["4b6e736768f740bd9224c03f014e8dba15888f39"],"ref":"refs/changes/49/4749/5","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1542822565,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1542650433,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"SUBM","value":"1","grantedOn":1542822579,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1542795637,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1542795637,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1542749029,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"lib/endpoints/vms.js","type":"MODIFIED","insertions":15,"deletions":-1}],"sizeInsertions":15,"sizeDeletions":-1}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}]}