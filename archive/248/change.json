{"project":"joyent/sdcadm","branch":"master","id":"Iafa97268a71ba6984f368e2c5393f820ada8e06a","number":"248","subject":"TOOLS-1503 sdcadm fails to print an error with \"%j\" Reviewed by: Trent Mick \u003ctrent.mick@joyent.com\u003e Reviewed by: Joshua M. Clulow \u003cjmc@joyent.com\u003e","owner":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"url":"https://cr.joyent.us/248","commitMessage":"TOOLS-1503 sdcadm fails to print an error with \"%j\"\nReviewed by: Trent Mick \u003ctrent.mick@joyent.com\u003e\nReviewed by: Joshua M. Clulow \u003cjmc@joyent.com\u003e\n","createdOn":1470465053,"lastUpdated":1476181201,"open":false,"status":"MERGED","comments":[{"timestamp":1470465053,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 1."},{"timestamp":1470465094,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1470898361,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 2."},{"timestamp":1470898392,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1471037816,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1471346735,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 3."},{"timestamp":1471346766,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1471346774,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 2:\n\n(1 comment)\n\nChanges applied"},{"timestamp":1471450350,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 3: Code-Review+1\n\nGiven a change from using util.format/console.log to the more strict extsprintf for formatting (the latter will blow up with, e.g. `fn(\u0027only one percent-code: %s\u0027, argOne, argTwo)`) it is worth a quick look at all the usages of `progress()` to see if there are any obvious gotchas."},{"timestamp":1471519160,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 4."},{"timestamp":1471519194,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1471519254,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 4:\n\n\u003e Given a change from using util.format/console.log to the more\n \u003e strict extsprintf for formatting (the latter will blow up with,\n \u003e e.g. `fn(\u0027only one percent-code: %s\u0027, argOne, argTwo)`) it is worth\n \u003e a quick look at all the usages of `progress()` to see if there are\n \u003e any obvious gotchas.\n\nDone with the boring task of the day! I\u0027ve modified some lazy invocations and replaced couple error objects with the extsprintf provided \u0027%r\u0027."},{"timestamp":1472149546,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 4:\n\n\"Cannot merge\"... does this need a rebase now? Sorry if that is just because of my delay in reviewing."},{"timestamp":1472152315,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 5: Patch Set 4 was rebased."},{"timestamp":1472152362,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5:\n\n\"make check\" passed ok"},{"timestamp":1472221108,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 6: Patch Set 5 was rebased."},{"timestamp":1472221187,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 6:\n\n\"make check\" passed ok"},{"timestamp":1472228247,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 6: Code-Review+1"},{"timestamp":1472834520,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 7: Patch Set 6 was rebased."},{"timestamp":1472834562,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 7:\n\n\"make check\" passed ok"},{"timestamp":1474309634,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 7: Integration-Approval+1"},{"timestamp":1476181183,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 8: Patch Set 7 was rebased"},{"timestamp":1476181201,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Pedro Palazón Candel"}],"currentPatchSet":{"number":"8","revision":"56ee3c4f5a0a6997df5c038ddd32dd06bdd2ff1e","parents":["63860de971e00215e442e4ddbf4484e0a8db2abb"],"ref":"refs/changes/48/248/8","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1476181183,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1471519194,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1472228247,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1474309634,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1476181201,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/cli/index.js","type":"MODIFIED","insertions":4,"deletions":-2},{"file":"lib/common.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/default-fabric.js","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"lib/post-setup/docker.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/post-setup/fabrics.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/procedures/update-dockerlogger.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/sdcadm.js","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":15,"sizeDeletions":-12},"patchSets":[{"number":"1","revision":"2d628f5ca6088ad5b775ffa25470b510143653ce","parents":["f8833f98d7131670c77da8355257a7cca017c6ea"],"ref":"refs/changes/48/248/1","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1470465053,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1470465094,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/cli/index.js","type":"MODIFIED","insertions":2,"deletions":-1}],"sizeInsertions":2,"sizeDeletions":-1},{"number":"2","revision":"d799c64c9141001d745bde578e0a267fe2e8d748","parents":["f8833f98d7131670c77da8355257a7cca017c6ea"],"ref":"refs/changes/48/248/2","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1470898361,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1470898392,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/cli/index.js","line":137,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"I think you should pass the same pre-rendered string to \"log.debug()\".  If you look at the stack trace in the ticket, we\u0027re actually tripping up on a \"util.format()\" call that _bunyan_ makes on our behalf.\n\nI\u0027d probably go for something more like:\n\n    var msg \u003d extsprintf.sprintf.apply(null, args_);\n    self.log.debug({ progress: true }, msg);\n    console.log(msg);"},{"file":"lib/cli/index.js","line":137,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Good idea. Done!"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/cli/index.js","type":"MODIFIED","insertions":2,"deletions":-1}],"sizeInsertions":2,"sizeDeletions":-1},{"number":"3","revision":"046129cc8e74c41ef366180689075962ea24d652","parents":["f8833f98d7131670c77da8355257a7cca017c6ea"],"ref":"refs/changes/48/248/3","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1471346735,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1471346766,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1471450350,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/cli/index.js","type":"MODIFIED","insertions":4,"deletions":-2}],"sizeInsertions":4,"sizeDeletions":-2},{"number":"4","revision":"c597a810496b204213458e4e9c1f99f47257b485","parents":["b834aca07d6f4eb5aac08cb9ae65c002d78f0a06"],"ref":"refs/changes/48/248/4","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1471519160,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1471519194,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/cli/index.js","type":"MODIFIED","insertions":4,"deletions":-2},{"file":"lib/common.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/default-fabric.js","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"lib/post-setup/docker.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/post-setup/fabrics.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/procedures/update-dockerlogger.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/sdcadm.js","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":15,"sizeDeletions":-12},{"number":"5","revision":"01180f7e6ebb6c0590711a1ba4d636065ab1061b","parents":["0f4f6995d7e51f0f6cb17f1fcbe60efd8c684f36"],"ref":"refs/changes/48/248/5","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1472152315,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1471519194,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/cli/index.js","type":"MODIFIED","insertions":4,"deletions":-2},{"file":"lib/common.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/default-fabric.js","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"lib/post-setup/docker.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/post-setup/fabrics.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/procedures/update-dockerlogger.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/sdcadm.js","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":15,"sizeDeletions":-12},{"number":"6","revision":"62189cc9685b5a572f493f46c776de509cd11df9","parents":["ae70eb1382c3c613c83d1f51500440b1e932494c"],"ref":"refs/changes/48/248/6","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1472221108,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1471519194,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1472228247,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/cli/index.js","type":"MODIFIED","insertions":4,"deletions":-2},{"file":"lib/common.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/default-fabric.js","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"lib/post-setup/docker.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/post-setup/fabrics.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/procedures/update-dockerlogger.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/sdcadm.js","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":15,"sizeDeletions":-12},{"number":"7","revision":"afa97268a71ba6984f368e2c5393f820ada8e06a","parents":["28cfd7326210e57a2eba8a01f662c04898c11d3d"],"ref":"refs/changes/48/248/7","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1472834520,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1471519194,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1472228247,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1474309634,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/cli/index.js","type":"MODIFIED","insertions":4,"deletions":-2},{"file":"lib/common.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/default-fabric.js","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"lib/post-setup/docker.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/post-setup/fabrics.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/procedures/update-dockerlogger.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/sdcadm.js","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":15,"sizeDeletions":-12},{"number":"8","revision":"56ee3c4f5a0a6997df5c038ddd32dd06bdd2ff1e","parents":["63860de971e00215e442e4ddbf4484e0a8db2abb"],"ref":"refs/changes/48/248/8","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1476181183,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1471519194,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1472228247,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1474309634,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1476181201,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/cli/index.js","type":"MODIFIED","insertions":4,"deletions":-2},{"file":"lib/common.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/default-fabric.js","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"lib/post-setup/docker.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/post-setup/fabrics.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/procedures/update-dockerlogger.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/sdcadm.js","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":15,"sizeDeletions":-12}],"allReviewers":[{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}]}