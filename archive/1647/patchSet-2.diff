From 4695c42e1f6e4ca55ede54d558f83ebcf0c2288b Mon Sep 17 00:00:00 2001
From: Alex Wilson <alex.wilson@joyent.com>
Date: Fri, 10 Mar 2017 09:31:39 -0800
Subject: [PATCH] DOCKER-1013 broke purpose-less certificates in DOCKER-1005
 Reviewed by: Trent Mick <trent.mick@joyent.com> Approved by: Trent Mick
 <trent.mick@joyent.com>

---
 lib/auth.js | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/lib/auth.js b/lib/auth.js
index 5ab41d7..68fb2c7 100644
--- a/lib/auth.js
+++ b/lib/auth.js
@@ -73,7 +73,7 @@ function authTls(req, res, next) {
      * the expiry time and use the issuer's CN to look up the real account
      * key.
      */
-    if (cert.purposes.indexOf('joyentDocker') !== -1) {
+    if (cert.purposes && cert.purposes.indexOf('joyentDocker') !== -1) {
         log.trace('found "joyentDocker" certificate purpose, will treat as '
             + 'new-style certificate');
 
-- 
2.21.0

