From 5501da2f6ffbce4afdf009706b07df2b3cdae10f Mon Sep 17 00:00:00 2001
From: Trent Mick <trentm@gmail.com>
Date: Thu, 9 Feb 2017 16:39:27 -0800
Subject: [PATCH] TOOLS-1691 'sdcadm post-setup dev-headnode-prov' doesn't
 refresh the correct config-agent

---
 lib/post-setup/dev-headnode-prov.js | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/lib/post-setup/dev-headnode-prov.js b/lib/post-setup/dev-headnode-prov.js
index ed6c8a6..64cc6b5 100644
--- a/lib/post-setup/dev-headnode-prov.js
+++ b/lib/post-setup/dev-headnode-prov.js
@@ -53,7 +53,7 @@ function makeHeadnodeProvisionable(opts, cb) {
             }
 
             progress('Configuring CNAPI to allow headnode provisioning' +
-                ' and over-provisioning (allow a minute to propagate)');
+                ' and over-provisioning');
             var update = {
                 metadata: {
                     ALLOC_FILTER_HEADNODE: false,
@@ -90,6 +90,7 @@ function makeHeadnodeProvisionable(opts, cb) {
                     progress('Refreshing instance %s config-agent', inst.alias);
                     svcadm.svcadmRefresh({
                         server_uuid: inst.server,
+                        zone: inst.instance,
                         wait: true,
                         fmri: 'config-agent',
                         sdcadm: sdcadm,
-- 
2.21.0

