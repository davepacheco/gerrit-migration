{"project":"joyent/eng","branch":"master","topic":"lullaby-phase-1","id":"I7e20148709f217f2b1dd9e2e4217384ec442ff5f","number":"5221","subject":"TOOLS-2043 Lullaby 3: Improving the Manta/Triton build TOOLS-2062 eng.git should be a git submodule of Triton/Manta repositories TOOLS-2063 shared tooling needed to build Manta/Triton agents TOOLS-2064 the build should do more pre-build validation TOOLS-2","owner":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"url":"https://cr.joyent.us/5221","commitMessage":"TOOLS-2043 Lullaby 3: Improving the Manta/Triton build\nTOOLS-2062 eng.git should be a git submodule of Triton/Manta repositories\nTOOLS-2063 shared tooling needed to build Manta/Triton agents\nTOOLS-2064 the build should do more pre-build validation\nTOOLS-2065 Makefile.targ should include a print-% target\nTOOLS-2066 Triton/Manta components should be able to build local zfs images\nTOOLS-2067 Triton/Manta components need a way to upload build artifacts\nReviewed by: Robert Mustacchi \u003crm@joyent.com\u003e\nReviewed by: Chris Burroughs \u003cchris.burroughs@joyent.com\u003e\nReviewed by: Trent Mick \u003ctrentm@gmail.com\u003e\nApproved by: Trent Mick \u003ctrentm@gmail.com\u003e\n","createdOn":1544527225,"lastUpdated":1548185643,"open":false,"status":"MERGED","comments":[{"timestamp":1544527225,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Uploaded patch set 1."},{"timestamp":1544622055,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Uploaded patch set 2."},{"timestamp":1544622210,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Patch Set 2:\n\nThe changes pushed in patch set 2 uncomment the \"updates-imgadm\" line in ./tools/bits-upload.sh, allowing a build to poke updates.joyent.com after it has uploaded bits to manta, allowing your experimental images to be installed from there. It also fixes a regexp bug.\n\nAs this was an eng.git push which was needed in sdc-amon.git, we also bumped the submodule version in those repos."},{"timestamp":1545084652,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 2:\n\n(43 comments)\n\nIn generall, this seems pretty good. Note, I didn\u0027t really review most of the content of tools/buildimage, since it seemed like most of it was from imgadm. If it helps I can go back and look at bin/buildimage."},{"timestamp":1545145196,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Patch Set 2:\n\n(40 comments)\n\nThanks for the review, I really appreciate it!\nIf you have time, looking at buildimage would be great, but I know\nChris also plans on looking at this, so that ought to be sufficient\nand I know everyone\u0027s busy.  I\u0027ll post another patchset with the\nchanges mentioned below later this week."},{"timestamp":1545150653,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1545151804,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Patch Set 2:\n\n(25 comments)\n\nMy personal preference is to get all of the feedback out all at once, but I\u0027m afraid I\u0027m going to have to go through multiple rounds here.  \n\nI\u0027d like next to look at the McBuildy js code in more detail but see my comment on the feasibility of producing a diff from what is in smartos-live."},{"timestamp":1545152083,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1545231698,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Uploaded patch set 3."},{"timestamp":1545231855,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Patch Set 3:\n\nPatch set 3 address comments from rm, and adds more to\n./tools/buildimage/lib/imgadm/README.md to describe the\ndivergence of the code from its smartos-live origin,\nand includes a recursive diff showing the exact difference\nbetween it and the version of imgadm from the hash originally\ndescribed at https://github.com/joyent/buildymcbuildface/commit/da88af2b4a9ee13df5f96a23437dfe9799ddb07a"},{"timestamp":1545236669,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Patch Set 2:\n\n(26 comments)\n\nThanks for the review Chris!\nThe changes I talk about below will be in patch set 4. Hopefully I\u0027ll be\nable to upload that this week."},{"timestamp":1545305216,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Uploaded patch set 4."},{"timestamp":1545305395,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Patch Set 4:\n\nPatch set 4 addresses Chris\u0027s comments from Dec 18. Still need to chase up the comment about Makefile.node_modules.targ"},{"timestamp":1545424168,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Patch Set 4:\n\n(5 comments)"},{"timestamp":1545851459,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 4:\n\n(13 comments)\n\nThe incremental bits look alright. I have some follow ups from last time."},{"timestamp":1546534810,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Patch Set 2:\n\n(14 comments)\n\nThanks again for the reviews.\nThe changes mentioned here will land in patch set 5."},{"timestamp":1546535974,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Uploaded patch set 5."},{"timestamp":1547033206,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Uploaded patch set 6."},{"timestamp":1547033314,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Patch Set 6:\n\nPatch set 6 adds some logic to bits-upload.sh from MG\u0027s configure script to correctly compute the updates.jo.co channel to which we should publish bits. Apologies for missing this in the initial wad."},{"timestamp":1547045104,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Uploaded patch set 7."},{"timestamp":1547045242,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Patch Set 6:\n\nPatch set 7 fixes another bits-upload breakage: we were incorrectly skipping updates.jo.co imports for image files not called \"\u003cfoo\u003e.zfs.gz\""},{"timestamp":1547207438,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Topic set to lullaby-phase-1"},{"timestamp":1547487493,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 7:\n\n(3 comments)\n\nJust a few minor things I\u0027ve noticed in the updates."},{"timestamp":1547560699,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Patch Set 7:\n\n(3 comments)"},{"timestamp":1547561030,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Uploaded patch set 8."},{"timestamp":1547561067,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Patch Set 7:\n\nPatch set 8 addresses rm\u0027s comments on patch set 7."},{"timestamp":1547593602,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 8: Code-Review+1"},{"timestamp":1547644767,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Uploaded patch set 9."},{"timestamp":1547644841,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Patch Set 9:\n\nPatch set 9 modifies the default Manta directory for build artifacts (from /stor/builds to /public/builds, which is what MG uses)"},{"timestamp":1547655978,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Uploaded patch set 10."},{"timestamp":1547656082,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Patch Set 10:\n\nIn light of TOOLS-2151 rather than overloading what \u0027try_branch\u0027 means, we should refer to \u0027agent_branch\u0027 instead."},{"timestamp":1547724272,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Uploaded patch set 11."},{"timestamp":1547724366,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Patch Set 11:\n\nPatch set 11 adds validate-buildenv support for triton-origin-multiarch-18.1.0, needed for sdc-mantatee and manta-manatee components. Apologies for the churn."},{"timestamp":1547829721,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 11:\n\n(1 comment)"},{"timestamp":1547833146,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Patch Set 11:\n\n(1 comment)"},{"timestamp":1547837921,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Uploaded patch set 12."},{"timestamp":1547838862,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Patch Set 12:\n\nPatch set 12 addresses rm\u0027s comment on patch set 11."},{"timestamp":1547840449,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 12: Code-Review+1"},{"timestamp":1547846954,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Patch Set 12: Code-Review+1\n\nTim in your email has had the item \" modify eng.git to specify correct git urls for\n   agents in Makefile.agent_prebuilt.defs \".  I assume that means once more change?  Want to make sure I have that part straight before I click the IA button."},{"timestamp":1548090609,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Patch Set 12:\n\n\u003e Tim in your email has had the item \" modify eng.git to specify\n \u003e correct git urls for\n \u003e agents in Makefile.agent_prebuilt.defs \".  I assume that means once\n \u003e more change?  Want to make sure I have that part straight before I\n \u003e click the IA button.\n\nSorry, my mistake: I\u0027d done that already in patch set 1 (it\u0027s only my personal fork on github of eng.git that has the modified urls of the various agent repositories in Makefile.agent_prebuilt.defs)"},{"timestamp":1548114575,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 12: Code-Review+1\n\n(6 comments)\n\nBasically looks good to me. \"Basically\" because I haven\u0027t been over it with a fine toothed comb. I\u0027ll be trying a full clean start again tomorrow."},{"timestamp":1548158254,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Patch Set 12:\n\n(6 comments)"},{"timestamp":1548159332,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Uploaded patch set 13."},{"timestamp":1548159364,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Patch Set 12:\n\nPatch set 13 addresses trentm\u0027s comments on patch set 12."},{"timestamp":1548180767,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 13:\n\n(1 comment)"},{"timestamp":1548180794,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 13: Code-Review+1 Integration-Approval+1"},{"timestamp":1548181041,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Patch Set 13: Code-Review+1 Integration-Approval+1"},{"timestamp":1548185377,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Uploaded patch set 14: Commit message was updated."},{"timestamp":1548185643,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Tim Foster"}],"currentPatchSet":{"number":"14","revision":"7e20148709f217f2b1dd9e2e4217384ec442ff5f","parents":["8d4add222e0e3463c0f866f3b0d8da2022a1dac9"],"ref":"refs/changes/21/5221/14","uploader":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"createdOn":1548185377,"author":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1548180794,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1548180794,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1548181041,"by":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1548181041,"by":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"}},{"type":"SUBM","value":"1","grantedOn":1548185643,"by":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":17,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"Makefile","type":"MODIFIED","insertions":79,"deletions":-20},{"file":"tools/agent-prebuilt.sh","type":"ADDED","insertions":460,"deletions":0},{"file":"tools/bits-upload.sh","type":"ADDED","insertions":466,"deletions":0},{"file":"tools/buildimage-extract-pkg.sh","type":"ADDED","insertions":35,"deletions":0},{"file":"tools/buildimage/Makefile","type":"ADDED","insertions":54,"deletions":0},{"file":"tools/buildimage/README.md","type":"ADDED","insertions":122,"deletions":0},{"file":"tools/buildimage/bin/buildimage","type":"ADDED","insertions":692,"deletions":0},{"file":"tools/buildimage/lib/imgadm/README.md","type":"ADDED","insertions":28,"deletions":0},{"file":"tools/buildimage/lib/imgadm/imgadm.patch","type":"ADDED","insertions":305,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/IMG.js","type":"ADDED","insertions":81,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/cli.js","type":"ADDED","insertions":2148,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/common.js","type":"ADDED","insertions":846,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/configuration.js","type":"ADDED","insertions":138,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/database.js","type":"ADDED","insertions":171,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/errors.js","type":"ADDED","insertions":827,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/imgadm.js","type":"ADDED","insertions":4329,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/locker.js","type":"ADDED","insertions":177,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/magic.js","type":"ADDED","insertions":102,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/docker.js","type":"ADDED","insertions":386,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/dsapi.js","type":"ADDED","insertions":92,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/imgapi.js","type":"ADDED","insertions":264,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/index.js","type":"ADDED","insertions":82,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/source.js","type":"ADDED","insertions":205,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/upgrade.js","type":"ADDED","insertions":342,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/zfs.js","type":"ADDED","insertions":549,"deletions":0},{"file":"tools/buildimage/lib/imgadm/package-lock.json","type":"ADDED","insertions":3607,"deletions":0},{"file":"tools/buildimage/lib/imgadm/package.json","type":"ADDED","insertions":36,"deletions":0},{"file":"tools/buildimage/lib/imgadm/sbin/imgadm","type":"ADDED","insertions":42,"deletions":0},{"file":"tools/buildimage/package-lock.json","type":"ADDED","insertions":54,"deletions":0},{"file":"tools/buildimage/package.json","type":"ADDED","insertions":14,"deletions":0},{"file":"tools/mk/Makefile.agent_prebuilt.defs","type":"ADDED","insertions":207,"deletions":0},{"file":"tools/mk/Makefile.agent_prebuilt.targ","type":"ADDED","insertions":120,"deletions":0},{"file":"tools/mk/Makefile.ctf.defs","type":"MODIFIED","insertions":14,"deletions":-5},{"file":"tools/mk/Makefile.ctf.targ","type":"MODIFIED","insertions":16,"deletions":-5},{"file":"tools/mk/Makefile.defs","type":"MODIFIED","insertions":101,"deletions":-5},{"file":"tools/mk/Makefile.deps","type":"MODIFIED","insertions":14,"deletions":-9},{"file":"tools/mk/Makefile.go_prebuilt.defs","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.go_prebuilt.targ","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.manpages.defs","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.manpages.targ","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.node.defs","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.node.targ","type":"MODIFIED","insertions":15,"deletions":-6},{"file":"tools/mk/Makefile.node_modules.defs","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.node_modules.targ","type":"MODIFIED","insertions":16,"deletions":-6},{"file":"tools/mk/Makefile.node_prebuilt.defs","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.node_prebuilt.targ","type":"MODIFIED","insertions":15,"deletions":-6},{"file":"tools/mk/Makefile.smf.defs","type":"MODIFIED","insertions":17,"deletions":-6},{"file":"tools/mk/Makefile.smf.targ","type":"MODIFIED","insertions":16,"deletions":-6},{"file":"tools/mk/Makefile.targ","type":"MODIFIED","insertions":176,"deletions":-16},{"file":"tools/mkrepo","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"tools/validate-buildenv.sh","type":"ADDED","insertions":668,"deletions":0}],"sizeInsertions":18239,"sizeDeletions":-129},"patchSets":[{"number":"1","revision":"eac895c5b1e04823d55cd8a761ba49d672b8e3a9","parents":["8d4add222e0e3463c0f866f3b0d8da2022a1dac9"],"ref":"refs/changes/21/5221/1","uploader":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"createdOn":1544527225,"author":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":13,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":3,"deletions":-1},{"file":".gitmodules","type":"MODIFIED","insertions":2,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":65,"deletions":-18},{"file":"tools/agent-prebuilt.sh","type":"ADDED","insertions":420,"deletions":0},{"file":"tools/bits-upload.sh","type":"ADDED","insertions":425,"deletions":0},{"file":"tools/buildimage-extract-pkg.sh","type":"ADDED","insertions":29,"deletions":0},{"file":"tools/buildimage/Makefile","type":"ADDED","insertions":54,"deletions":0},{"file":"tools/buildimage/README.md","type":"ADDED","insertions":123,"deletions":0},{"file":"tools/buildimage/bin/buildimage","type":"ADDED","insertions":708,"deletions":0},{"file":"tools/buildimage/lib/imgadm/README.md","type":"ADDED","insertions":9,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/IMG.js","type":"ADDED","insertions":81,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/cli.js","type":"ADDED","insertions":2148,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/common.js","type":"ADDED","insertions":846,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/configuration.js","type":"ADDED","insertions":138,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/database.js","type":"ADDED","insertions":171,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/errors.js","type":"ADDED","insertions":827,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/imgadm.js","type":"ADDED","insertions":4329,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/locker.js","type":"ADDED","insertions":177,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/magic.js","type":"ADDED","insertions":102,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/docker.js","type":"ADDED","insertions":386,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/dsapi.js","type":"ADDED","insertions":92,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/imgapi.js","type":"ADDED","insertions":264,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/index.js","type":"ADDED","insertions":82,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/source.js","type":"ADDED","insertions":205,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/upgrade.js","type":"ADDED","insertions":342,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/zfs.js","type":"ADDED","insertions":549,"deletions":0},{"file":"tools/buildimage/lib/imgadm/package-lock.json","type":"ADDED","insertions":3607,"deletions":0},{"file":"tools/buildimage/lib/imgadm/package.json","type":"ADDED","insertions":36,"deletions":0},{"file":"tools/buildimage/lib/imgadm/sbin/imgadm","type":"ADDED","insertions":42,"deletions":0},{"file":"tools/buildimage/package-lock.json","type":"ADDED","insertions":54,"deletions":0},{"file":"tools/buildimage/package.json","type":"ADDED","insertions":14,"deletions":0},{"file":"tools/buildimage/tools/cleanup.sh","type":"ADDED","insertions":39,"deletions":0},{"file":"tools/mk/Makefile.agent_prebuilt.defs","type":"ADDED","insertions":206,"deletions":0},{"file":"tools/mk/Makefile.agent_prebuilt.targ","type":"ADDED","insertions":121,"deletions":0},{"file":"tools/mk/Makefile.defs","type":"MODIFIED","insertions":94,"deletions":-4},{"file":"tools/mk/Makefile.deps","type":"MODIFIED","insertions":11,"deletions":-8},{"file":"tools/mk/Makefile.go_prebuilt.defs","type":"MODIFIED","insertions":11,"deletions":-4},{"file":"tools/mk/Makefile.go_prebuilt.targ","type":"MODIFIED","insertions":11,"deletions":-4},{"file":"tools/mk/Makefile.manpages.defs","type":"MODIFIED","insertions":12,"deletions":-5},{"file":"tools/mk/Makefile.manpages.targ","type":"MODIFIED","insertions":12,"deletions":-5},{"file":"tools/mk/Makefile.node.defs","type":"MODIFIED","insertions":12,"deletions":-5},{"file":"tools/mk/Makefile.node.targ","type":"MODIFIED","insertions":12,"deletions":-5},{"file":"tools/mk/Makefile.node_modules.defs","type":"MODIFIED","insertions":12,"deletions":-5},{"file":"tools/mk/Makefile.node_modules.targ","type":"MODIFIED","insertions":13,"deletions":-6},{"file":"tools/mk/Makefile.node_prebuilt.defs","type":"MODIFIED","insertions":12,"deletions":-5},{"file":"tools/mk/Makefile.node_prebuilt.targ","type":"MODIFIED","insertions":12,"deletions":-5},{"file":"tools/mk/Makefile.smf.defs","type":"MODIFIED","insertions":14,"deletions":-5},{"file":"tools/mk/Makefile.smf.targ","type":"MODIFIED","insertions":13,"deletions":-5},{"file":"tools/mk/Makefile.targ","type":"MODIFIED","insertions":157,"deletions":-16},{"file":"tools/mkrepo","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"tools/validate-buildenv.sh","type":"ADDED","insertions":602,"deletions":0}],"sizeInsertions":17709,"sizeDeletions":-109},{"number":"2","revision":"cee999da82f6689732ff85df100d184ff82d3c5f","parents":["8d4add222e0e3463c0f866f3b0d8da2022a1dac9"],"ref":"refs/changes/21/5221/2","uploader":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"createdOn":1544622055,"author":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"isDraft":false,"kind":"REWORK","comments":[{"file":".gitmodules","line":11,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"This submodule seems like it shouldn\u0027t be here."},{"file":".gitmodules","line":11,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Oops yes."},{"file":"Makefile","line":75,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"metadata?"},{"file":"Makefile","line":75,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Done"},{"file":"Makefile","line":85,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"It probably would help to explain why we do that (I assume so it can be overriden or changes behavior)."},{"file":"Makefile","line":85,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Right, fixed"},{"file":"Makefile","line":85,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"I thought that ENGBLD_USE_BUILDIMAGE  signified if we are building an image or not.  I\u0027m not seeing the connection to Makefile.defs"},{"file":"Makefile","line":85,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Correct. (rm brought this up too, and I\u0027ve added a comment explaining this)\n\nIn Makefile.defs, we have an ifeq to set \u0027BUILDIMAGE_TARG\u003dbuildimage\u0027 iff ENGBLD_USE_BUILDIMAGE\u003dtrue. That way, we can conditionally add a \u0027buildimage\u0027 dependency to the \u0027bits-upload\u0027 target iff ENGBLD_USE_BUILDIMAGE is \u0027true\u0027."},{"file":"Makefile","line":187,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"When would I as someone using this sample Makefile in my project  set RELEASE_TARBALL to anything different?"},{"file":"Makefile","line":187,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Good question. They\u0027re _mostly_ all set to this, but some\naren\u0027t, though the differences are pretty cosmetic.\n\nMy inclination is that having RELEASE_TARBALL explicitly\nmentioned in the component Makefile makes it easier to\nunderstand the *-pkg construction process, but I\u0027m easy\nreally.\n\nWe\u0027ve talked a bit about getting rid of *-pkg-*.tar.gz files\naltogether, but that\u0027s not this changeset. I do notice I need\nto s/bz2/gz/ here though, so thanks for pointing it out!"},{"file":"Makefile","line":193,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Could you include a sample comment with the name of the image?"},{"file":"Makefile","line":193,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Great idea, done."},{"file":"Makefile","line":194,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Why the manta- prefix here?"},{"file":"Makefile","line":194,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"I wanted to point out the difference between the component $(NAME) and the $(BUILDIMAGE_NAME) which aren\u0027t always the same. As \u0027manta-\u0027 is a common prefix for Manta-related projects, I thought this would do?"},{"file":"Makefile","line":194,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"I thought most repositories already a manta- prefix. Or is it\n * repo name: manta-foo\n * \"name\": foo\n * image-name: manta-foo"},{"file":"Makefile","line":194,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Manta components mostly have their image as \u0027manta-$(NAME)\u0027\nwhere $(NAME) is the repo name, or if the repo already has\na \u0027manta-\u0027 prefix, we use that.\n\nTriton components tend to set $(NAME) to be the repo name\nwith the \u0027sdc-\u0027 or \u0027triton-\u0027 prefix removed.\n\nThere\u0027s inconsistencies everywhere though, which is why\nI just spelled it out, that way, we don\u0027t have to guess.\n\ntimf@iorangi-eth0 egrep \u0027BUILDIMAGE_NAME|^NAME\u0027 */Makefile\nbinder.git/Makefile:NAME \u003d binder\nbinder.git/Makefile:BUILDIMAGE_NAME \u003d manta-nameservice\nelectric-moray.git/Makefile:NAME \u003d electric-moray\nelectric-moray.git/Makefile:BUILDIMAGE_NAME \u003d manta-electric-moray\neng.git/Makefile:NAME \u003d myproject\neng.git/Makefile:BUILDIMAGE_NAME \u003d manta-myproject\nmahi.git/Makefile:NAME\t\t:\u003d mahi\nmahi.git/Makefile:BUILDIMAGE_NAME \u003d manta-authcache\nmanta-garbage-collector.git/Makefile:NAME :\u003d\t\t\t\tmanta-garbage-collector\nmanta-garbage-collector.git/Makefile:BUILDIMAGE_NAME\t\t\u003d $(NAME)\nmanta-madtom.git/Makefile:NAME                  \u003d madtom\nmanta-madtom.git/Makefile:BUILDIMAGE_NAME \u003d manta-madtom\nmanta-mako.git/Makefile:NAME\t\t\t\u003d mako\nmanta-mako.git/Makefile:BUILDIMAGE_NAME\t\t\u003d manta-storage\nmanta-manatee.git/Makefile:NAME \u003d manta-manatee\nmanta-manatee.git/Makefile:BUILDIMAGE_NAME \u003d manta-postgres\nmanta-marlin-dashboard.git/Makefile:NAME\t\t\t\u003d marlin-dashboard\nmanta-marlin-dashboard.git/Makefile:BUILDIMAGE_NAME \u003d manta-marlin-dashboard\nmanta-marlin.git/Makefile:NAME \t\t \u003d marlin\nmanta-marlin.git/Makefile:BUILDIMAGE_NAME \u003d manta-jobsupervisor\nmanta-medusa.git/Makefile:NAME\t\t\u003d medusa\nmanta-medusa.git/Makefile:BUILDIMAGE_NAME \u003d manta-medusa\nmanta-mola.git/Makefile:NAME                  \u003d mola\nmanta-mola.git/Makefile:BUILDIMAGE_NAME \u003d manta-ops\nmanta-muskie.git/Makefile:NAME \t\t\t\u003d muskie\nmanta-muskie.git/Makefile:BUILDIMAGE_NAME \u003d manta-webapi\nmanta-propeller.git/Makefile:NAME                  \u003d propeller\nmanta-propeller.git/Makefile:BUILDIMAGE_NAME \u003d manta-propeller\nmanta-reshard.git/Makefile:NAME :\u003d\t\t\t\tmanta-reshard\nmanta-reshard.git/Makefile:BUILDIMAGE_NAME \u003d manta-reshard\nmanta-wrasse.git/Makefile:NAME\u003dwrasse\nmanta-wrasse.git/Makefile:BUILDIMAGE_NAME \u003d manta-jobpuller\nmoray.git/Makefile:NAME \u003d moray\nmoray.git/Makefile:BUILDIMAGE_NAME \u003d manta-moray\nmuppet.git/Makefile:NAME\t\t:\u003d muppet\nmuppet.git/Makefile:BUILDIMAGE_NAME \u003d manta-loadbalancer\npgstatsmon.git/Makefile:NAME\t\u003d pgstatsmon\npgstatsmon.git/Makefile:BUILDIMAGE_NAME \u003d manta-pgstatsmon\nsdc-adminui.git/Makefile:NAME\t\t:\u003d adminui\nsdc-adminui.git/Makefile:BUILDIMAGE_NAME \u003d $(NAME)\nsdc-amon.git/Makefile:BUILDIMAGE_NAME\t\t\u003d amon\nsdc-amon.git/Makefile:NAME\t\t\t\u003d amon\nsdc-amonredis.git/Makefile:NAME\u003damonredis\nsdc-amonredis.git/Makefile:BUILDIMAGE_NAME \u003d $(NAME)\nsdc-assets.git/Makefile:NAME\u003dassets\nsdc-assets.git/Makefile:BUILDIMAGE_NAME\t\t\u003d assets\nsdc-booter.git/Makefile:NAME\u003ddhcpd\nsdc-booter.git/Makefile:BUILDIMAGE_NAME \u003d $(NAME)\nsdc-cloud-analytics.git/Makefile:BUILDIMAGE_NAME\t\t\u003d ca\nsdc-cloud-analytics.git/Makefile:NAME\t\t:\u003d ca\nsdc-cloudapi.git/Makefile:NAME\t\t:\u003d cloudapi\nsdc-cloudapi.git/Makefile:BUILDIMAGE_NAME \u003d $(NAME)\nsdc-cnapi.git/Makefile:NAME \u003d cnapi\nsdc-cnapi.git/Makefile:BUILDIMAGE_NAME \u003d $(NAME)\nsdc-docker.git/Makefile:NAME:\u003ddocker\nsdc-docker.git/Makefile:BUILDIMAGE_NAME \u003d $(NAME)\nsdc-fwapi.git/Makefile:NAME \u003d fwapi\nsdc-fwapi.git/Makefile:BUILDIMAGE_NAME \u003d $(NAME)\nsdc-imgapi.git/Makefile:NAME\t\t:\u003d imgapi\nsdc-imgapi.git/Makefile:BUILDIMAGE_NAME\t\t\u003d imgapi\nsdc-manatee.git/Makefile:NAME \u003d sdc-manatee\nsdc-manatee.git/Makefile:BUILDIMAGE_NAME \u003d sdc-postgres\nsdc-manta.git/Makefile:NAME\t\t\u003d manta-deployment\nsdc-manta.git/Makefile:BUILDIMAGE_NAME \u003d $(NAME)\nsdc-napi.git/Makefile:NAME \u003d napi\nsdc-napi.git/Makefile:BUILDIMAGE_NAME \u003d $(NAME)\nsdc-nat.git/Makefile:NAME:\u003dnat\nsdc-nat.git/Makefile:BUILDIMAGE_NAME \u003d $(NAME)\nsdc-nfsserver.git/Makefile:NAME \u003d nfsserver\nsdc-nfsserver.git/Makefile:BUILDIMAGE_NAME \u003d $(NAME)\nsdc-papi.git/Makefile:NAME\t\t:\u003d papi\nsdc-papi.git/Makefile:BUILDIMAGE_NAME \u003d $(NAME)\nsdc-portolan.git/Makefile:NAME:\u003dportolan\nsdc-portolan.git/Makefile:BUILDIMAGE_NAME \u003d $(NAME)\nsdc-rabbitmq.git/Makefile:NAME\u003drabbitmq\nsdc-rabbitmq.git/Makefile:BUILDIMAGE_NAME \u003d $(NAME)\nsdc-sapi.git/Makefile:NAME \u003d sapi\nsdc-sapi.git/Makefile:BUILDIMAGE_NAME \u003d $(NAME)\nsdc-sdc.git/Makefile:NAME\t\t:\u003d sdc\nsdc-sdc.git/Makefile:BUILDIMAGE_NAME \u003d $(NAME)\nsdc-ufds.git/Makefile:NAME\t\t:\u003d ufds\nsdc-ufds.git/Makefile:BUILDIMAGE_NAME \u003d $(NAME)\nsdc-vmapi.git/Makefile:NAME \u003d vmapi\nsdc-vmapi.git/Makefile:BUILDIMAGE_NAME \u003d $(NAME)\nsdc-volapi.git/Makefile:NAME \u003d volapi\nsdc-volapi.git/Makefile:BUILDIMAGE_NAME \u003d $(NAME)\nsdc-workflow.git/Makefile:NAME\t\t:\u003d workflow\nsdc-workflow.git/Makefile:BUILDIMAGE_NAME \u003d $(NAME)\nsdcsso.git/Makefile:NAME \u003d sdcsso\nsdcsso.git/Makefile:BUILDIMAGE_NAME \u003d sdcsso\ntriton-cmon.git/Makefile:NAME\t\t:\u003d cmon\ntriton-cmon.git/Makefile:BUILDIMAGE_NAME \u003d $(NAME)\ntriton-cns.git/Makefile:NAME\t\t\t:\u003d cns\ntriton-cns.git/Makefile:BUILDIMAGE_NAME \u003d $(NAME)\ntriton-mockcloud.git/Makefile:NAME\u003dmockcloud\ntriton-mockcloud.git/Makefile:BUILDIMAGE_NAME \u003d $(NAME)"},{"file":"Makefile","line":196,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Why would I as a user ever change this?  For things that are defaults that will rarely if ever be changed, do they need to be set in the root Makefile?"},{"file":"Makefile","line":196,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"That\u0027s reasonable. These aren\u0027t always the same across every\ncomponent though and in some ways this might demystify the\nbuild. As with RELEASE_TARBALL, I\u0027m happy to do what you\nprefer (at the cost of a bit of churn across all components)\n\nIf it helps, I\u0027ve got a gist showing the prevalence here:\n\nhttps://gist.github.com/timfoster/bee369bd5713ad2fb8b5f225f1be32dd"},{"file":"Makefile","line":196,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Thanks for the gist.\n\nWe have a history of cargo culting as we copy and paste snippets around in the root Makefile and then confusing ourselves later.  That what colors my perception and leads to my inclination to minimize the number the boilerplate variables if they will rarely change.\n\nThe churn would be from moving it in this  CR, and then not including it in CRs for components that don\u0027t vary from the default?"},{"file":"Makefile","line":196,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Ok, that\u0027s fair enough. I\u0027ll make that change here and remove\nit from all of our components, adding a commented out\ndeclaration in eng.git\u0027s Makefile and will make sure that\n$(RELEASE_TARBALL) is non-empty before trying to construct the \ndefault $(BUILDIMAGE_PKG) macro value."},{"file":"Makefile","line":198,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"I think we talked about this before.  Remind me why this doesn\u0027t have a prefix?"},{"file":"Makefile","line":198,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Sure - my rationale for no prefix was this isn\u0027t really\nrelevant to the buildimage tool itself, rather they\u0027re the\nagents that interact with the component itself."},{"file":"tools/agent-prebuilt.sh","line":1,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Several of these shebangs are inconsistent.  WHy not /bin/bash?"},{"file":"tools/agent-prebuilt.sh","line":1,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Good point, I\u0027ll fix all of these."},{"file":"tools/agent-prebuilt.sh","line":5,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Missing license header."},{"file":"tools/agent-prebuilt.sh","line":5,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Done"},{"file":"tools/agent-prebuilt.sh","line":69,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Do we actually want the merging part of git pull here or do we just want to fetch the latest bits via \u0027git fetch\u0027? Depending on the change, it may have implications on later parts."},{"file":"tools/agent-prebuilt.sh","line":69,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"I\u0027d prefer pull, since that will then let developers modify their own cached agent repos in-place, which would allow them to easily test changes to agents without needing to push them up to github first. Granted, they could do that with the (mostly dormant out of the box) \u0027download\u0027 functionality to point at a prebuilt tarball, but this seemed more convenient to me.."},{"file":"tools/agent-prebuilt.sh","line":69,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"If that\u0027s the case is it correct to do a merge and not rebase the local developer\u0027s changes on top? As that would mirror what we\u0027d actually be doing when putting back, we wouldn\u0027t be merging. I think most folks do \u0027git pull --rebase\u0027 (or at least I do)."},{"file":"tools/agent-prebuilt.sh","line":69,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Yes, that makes more sense. That will fail if we\u0027ve got\nuncommitted modifications in the local agent cache repo\nthough, which the existing agent-prebuilt.sh code would\nwarn about and drive on in the face of, but crucially\nwould not pull remote changes, which is incorrect.\n\nI think the best thing to do is look for uncommitted change\nand bail out with an informative error message before\nattempting to \u0027pull --rebase\u0027"},{"file":"tools/agent-prebuilt.sh","line":88,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Given that errexit is no longer operating, shouldn\u0027t this be checked for success?"},{"file":"tools/agent-prebuilt.sh","line":88,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Yep. I think it\u0027s a pretty unlikely error case, but there\u0027s\nno harm in checking here, and a little further down."},{"file":"tools/agent-prebuilt.sh","line":110,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Is there a reason that you want it to create a subshell for this versus just calling the function and having it populate the global as a side effect? Only asking because sometimes the environment games in subshells can throw things off."},{"file":"tools/agent-prebuilt.sh","line":110,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Yep, that\u0027s reasonable. I\u0027ve switched to setting this as a side effect, but explicitly calling that out when we do so."},{"file":"tools/agent-prebuilt.sh","line":137,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Worth a sanity check to make sure that the path isn\u0027t \u0027/\u0027 before issuing an rm -rf?"},{"file":"tools/agent-prebuilt.sh","line":137,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"I think we\u0027re ok here? modern rm has protections against\nremoving the root dir, and we\u0027re already checking that\nrepo_name is non-empty, just after getopts parsing, line 350.\n\n[root@pkgbuild ~]# rm -rf /\nrm: it is dangerous to operate recursively on \u0027/\u0027\nrm: use --no-preserve-root to override this failsafe\n[root@pkgbuild ~]# pwd\n/root\n[root@pkgbuild ~]# which rm\n/opt/local/bin/rm\n[root@pkgbuild ~]# /usr/bin/rm -rf /\nrm of / is not allowed\n[root@pkgbuild ~]#\n\nOf course, I\u0027m happy to do a \"belt \u0026 braces\" here if you like,\nand also check inside this function, but given the limited\nutility of this script, I didn\u0027t think it was worth it."},{"file":"tools/agent-prebuilt.sh","line":137,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"OK, that\u0027s fine."},{"file":"tools/agent-prebuilt.sh","line":153,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"You can also use bash builtins to get a similar effect if that\u0027s worthwhile."},{"file":"tools/agent-prebuilt.sh","line":153,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Yep, while this isn\u0027t performance-critical, there\u0027s no reason not to (I\u0027m not relying on the \u0027.\u0027 behaviour of dirname of a path without \u0027/\u0027 chars)"},{"file":"tools/agent-prebuilt.sh","line":153,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Ha! Turns out I _am_ relying on that behaviour for dirname\n\n164     dir_pattern\u003d$(dirname $tarball_pattern)\n165     if [[ -z \"$agent_url\" ]]; then\n166         latest_tarball_dir\u003d$agent_cache_dir/$repo_name/$dir_pattern/\n\nwhere $dir_pattern becomes the . directory when we\u0027re looking\nfor a tarball with a pattern like \u0027config-agent-.*.tar.gz\u0027\n(i.e. the tarball gets built to the top-level of the agent\nrepository, so the dirname of that pattern should be \u0027.\u0027)"},{"file":"tools/agent-prebuilt.sh","line":164,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"This script is picky about absolute path for ls, but not for other utilities like gunzip or curl.  Is that intentional?"},{"file":"tools/agent-prebuilt.sh","line":164,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Force of habit: I\u0027ve always aliased ls to \u0027ls -sF\u0027 which\ncan break scripts. Do we do this anywhere else? A convention\nI\u0027ve seen in the past is eg.\n\nLS\u003d/usr/bin/ls\n.\n.\n.\n$LS foo"},{"file":"tools/agent-prebuilt.sh","line":164,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"I\u0027m not aware of us doing that anywhere else nor a convention.  (Not that you should not start one!)"},{"file":"tools/agent-prebuilt.sh","line":164,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I would strongly recommend that you use unalias -a at the top of such scripts. I do that to make sure that a user\u0027s ls alias can\u0027t get in the way."},{"file":"tools/agent-prebuilt.sh","line":164,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Yep, done."},{"file":"tools/agent-prebuilt.sh","line":203,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"This function will return with the current working directory having been modified. Is that an OK side effect? I know today this function only gets called from a specific action, but in the future it may not."},{"file":"tools/agent-prebuilt.sh","line":203,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Good point, fixed."},{"file":"tools/agent-prebuilt.sh","line":210,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Should we actually drive on if we hit the default case here?"},{"file":"tools/agent-prebuilt.sh","line":210,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Good point, fixed."},{"file":"tools/agent-prebuilt.sh","line":219,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"If you want to defeat errexit, why not just toggle it around this?"},{"file":"tools/agent-prebuilt.sh","line":219,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Just brevity really - it\u0027s probably better to do what you suggest."},{"file":"tools/agent-prebuilt.sh","line":222,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Is there a reason that we\u0027re always using curl -k? That seems like we\u0027re setting ourselves up for a man-in-the-middle attack. This is true throughout the entire function."},{"file":"tools/agent-prebuilt.sh","line":222,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Just convention, following what Makefile.node_prebuilt.targ does (presumably to allow self-signed https servers during testing) But you\u0027re right, nothing here requires htttps, so test servers could easily be setup to serve http instead and the script would still work. Fixing."},{"file":"tools/agent-prebuilt.sh","line":222,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"I don\u0027t know the full history around node_prebuilt.  I think we should (by default) use https and not -k in all of the build scripts but don\u0027t know all of the ramifications of that nor want to add  anode_prebuilt rework to the scope.  If that sounds reasonable, could you make a ticket for followup?"},{"file":"tools/agent-prebuilt.sh","line":222,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Yep, fixed in patch set 3. I\u0027ve filed TOOLS-2140 to address the changes needed for Makefile.node_prebuilt."},{"file":"tools/agent-prebuilt.sh","line":222,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Thanks, I was going to agree with Chris that we should default to always doing verification because this is part of the build path."},{"file":"tools/agent-prebuilt.sh","line":242,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"The presence of perl is not checked or verified in validate-buildenv.sh. If we require perl to exist, shouldn\u0027t it be checked for?"},{"file":"tools/agent-prebuilt.sh","line":242,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Good point. I\u0027ll switch this to python instead, which is at least checked for in validate-buildenv. Only SmartOS/pkgsrc 1.6.3-based build systems lack \u0027realpath\u0027, so if we ever move off those we can remove this python dependency at that stage."},{"file":"tools/agent-prebuilt.sh","line":326,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Missing the default case?"},{"file":"tools/agent-prebuilt.sh","line":326,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Oops, thanks"},{"file":"tools/agent-prebuilt.sh","line":388,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I don\u0027t believe that this generally guarantees mutual exclusion. If two processes are started at the same time and they both get to the else case and make the directory, neither will fail due to the use of mkdir -p which will exit zero if it exists, this means that both would continue and execute the critical path."},{"file":"tools/agent-prebuilt.sh","line":388,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Och, thanks. I\u0027ve tried a different approach now, which unconditionally tries to mkdir the lock directory, then sleeps depending on whether that succeeds/fails."},{"file":"tools/bits-upload.sh","line":12,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"The agent script had a disclaimer about how humans are rarely expected to run this script directly.  Does the same apply here?"},{"file":"tools/bits-upload.sh","line":12,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Yes, I think so. It\u0027s most likely run as part of the build, or \nat a pinch using \u0027make bits-upload-latest\u0027  I\u0027ll add a\ncomment."},{"file":"tools/bits-upload.sh","line":23,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"If you have a list of things to do before killing MG, please add \"find these docs a better home\" to it."},{"file":"tools/bits-upload.sh","line":23,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Was \"find these docs a better home\" an existing Jira ticket? I couldn\u0027t find it."},{"file":"tools/bits-upload.sh","line":23,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"I don\u0027t think we have an existing ticket.  I meant that if you have an informal list of the things we have to do to \"kill\" MG (besides not using it anywhere), finding a new home for relevant docs should be on it."},{"file":"tools/bits-upload.sh","line":23,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Cool. I\u0027ve filed TOOLS-2143 as a umbrella-bug for retiring MG."},{"file":"tools/bits-upload.sh","line":32,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Is that assumption enforceable? (Or WARNable)"},{"file":"tools/bits-upload.sh","line":32,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Thanks - not sure what I was thinking, but TOP is never\nactually used here. I\u0027ll remove this and the comment."},{"file":"tools/bits-upload.sh","line":54,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Why do these paths have a user name in them? Are we using it to try and simulate a place that is owned by root but not accessible to others or something else? I\u0027d try to avoid adding things to someone\u0027s home directory that they didn\u0027t put there (that wasn\u0027t hidden).\n\nAlso, is there a reason this isn\u0027t checked in the build-validator?"},{"file":"tools/bits-upload.sh","line":54,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"This apes (ha ha :) what mountain gorilla is doing today, by\nmaking an explicit assumption that we\u0027re running on a\njenkins-agent image that has /root populated with\nnon-pkgsrc-available tools. Specifically, we need to have\nmanta client tools available on the path somewhere.\n\nI\u0027ll add something to validate-buildenv to\nlook for those, but keep this path setting since it\u0027ll be\nneeded for smartos-live (which doesn\u0027t use validate-buildenv)\nwhen OS-7453 comes along."},{"file":"tools/bits-upload.sh","line":54,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"OK, I guess this is only used for uploading which we don\u0027t expect humans to be running themselves (at least per the other comments here)? If that\u0027s the case, that\u0027s fine for the time being."},{"file":"tools/bits-upload.sh","line":57,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I assume it\u0027s intentional that this (and other exit stuff doesn\u0027t go to stderr)?"},{"file":"tools/bits-upload.sh","line":57,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Force of (bad?) habit really. I\u0027m happy to change this if\nyou prefer?"},{"file":"tools/bits-upload.sh","line":57,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"It\u0027d be nice, but I wouldn\u0027t block that on this work. Maybe after it goes back we can file a low priority follow up for all the different tools to separate it?"},{"file":"tools/bits-upload.sh","line":57,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Sure."},{"file":"tools/bits-upload.sh","line":63,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Is the line here to basically give additional debugging information? If so, why not do the full stack trace? See for example: https://github.com/joyent/smartos-live/blob/master/tools/lib/build_common.sh#L74-L94."},{"file":"tools/bits-upload.sh","line":63,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Yes. That full stack trace code is neat, though I\u0027m not sure this script is complicated enough to warrant the extra work?"},{"file":"tools/bits-upload.sh","line":63,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"OK, I defer to you here."},{"file":"tools/bits-upload.sh","line":143,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I don\u0027t recall seeing the validate-buildenv.sh script checking for the presence of this file."},{"file":"tools/bits-upload.sh","line":143,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Sure - we\u0027re getting this validation by virtue of requiring\nall build machines to have coreutils installed in /opt/local.\n\nI could add a comment to that effect here, and/or explicitly\nverify (in validate-buildenv, validate_pkgsrc_pkgs()) that\ncertain binaries are present in case those move around pkgsrc\npackages?\n\nGiven that I already need to add checks there for the manta\ntools, this wouldn\u0027t be much extra work. Again, the problem\noccurs when not all builds require validate-buildenv, and\nthe overlap between which binaries we declare we need, vs.\nwhich we\u0027re getting \"accidentally\" by having validate-buildenv\ncheck only for pkgsrc names. :-/"},{"file":"tools/bits-upload.sh","line":143,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"OK, I didn\u0027t think it was part of coreutils, so that\u0027s on me. As long as it\u0027s actually checked."},{"file":"tools/bits-upload.sh","line":143,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Sure. I\u0027ll add a comment declaring that"},{"file":"tools/bits-upload.sh","line":355,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Missing handling of default case. bash getops will print the diagnostic message, but this will keep driving on, which I assume we don\u0027t want."},{"file":"tools/bits-upload.sh","line":355,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Thanks, fixed!"},{"file":"tools/buildimage-extract-pkg.sh","line":1,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Several of these shebangs are inconsistent.  WHy not /bin/bash?"},{"file":"tools/buildimage-extract-pkg.sh","line":1,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Done"},{"file":"tools/buildimage-extract-pkg.sh","line":5,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Missing license."},{"file":"tools/buildimage-extract-pkg.sh","line":5,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Done"},{"file":"tools/buildimage-extract-pkg.sh","line":14,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"If we\u0027re going to keep this, maybe worth a brief comment, as it seems like this is being left for developers."},{"file":"tools/buildimage-extract-pkg.sh","line":14,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Yes, that\u0027s correct. I\u0027ll add a comment."},{"file":"tools/buildimage/Makefile","line":20,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"I\u0027m not sure it\u0027s true that we have frozen the versions in /opt/tools, at least as jenkins-agents build today.  Once the next LTS rolls around we should probably switch to that."},{"file":"tools/buildimage/Makefile","line":20,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"No problem, I\u0027ll reword this to\n\nThis is the expected location of the modern pkgsrc bootstrap,\ncurrently bootstrap-2018Q3-tools.tar.gz"},{"file":"tools/buildimage/README.md","line":16,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I realize this may be a joke on npm trying to correct the typo, but let\u0027s just put the right thing here?"},{"file":"tools/buildimage/README.md","line":16,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Yep, that was inherited humour from an older prototype, I\u0027ll fix this and the other occurrence."},{"file":"tools/buildimage/README.md","line":120,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"When we look at this in the future, it seems like we could leverage the smartos-live \u0027local projects\u0027 feature to try and deal with this and allow the code to be shared."},{"file":"tools/buildimage/README.md","line":120,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"That would work too, depending on how we decide to publish\nimgadm (I agree that outside of smartos, it probably has\nminimal utility) Submodules would be another way to deal with\nthis."},{"file":"tools/buildimage/README.md","line":120,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Please make sure this followup gets a ticket so we don\u0027t shoot ourselves in the foot in  a few years."},{"file":"tools/buildimage/README.md","line":120,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Yep, I\u0027ve filed this as TOOLS-2141"},{"file":"tools/buildimage/README.md","line":123,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"If easy, could you make a diff of what\u0027s here from the smartos source to review?  I\u0027m not familiar with the imgadm code so I don\u0027t have a good intuitive sense for what changed."},{"file":"tools/buildimage/README.md","line":123,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Yep, done as part of patch set 3 and mentioned in TOOLS-2141"},{"file":"tools/buildimage/bin/buildimage","line":3,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"minor: Can this be MPL like the rest of engbuild, or did it from from imgadm?"},{"file":"tools/buildimage/bin/buildimage","line":3,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Good question. It uses (and bundles) some imgadm code, but\nI think it could be MPL since the imgadm code it uses is\nconfined to its own files (not mix/matched with buildimage\nfiles)\n\nI\u0027ll switch to MPL."},{"file":"tools/buildimage/lib/imgadm/README.md","line":1,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Do the rest of the files for imgadm not come from the platform as well? If not, is this their canonical home? If not, where is it?"},{"file":"tools/buildimage/lib/imgadm/README.md","line":1,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Correct, they also come from the platform. I was trying to\ndraw the distinction between \u0027platform imgadm code\u0027 vs. \u0027code\nelsewhere in the platform\u0027, which might otherwise leave\ndevelopers scratching their heads.\n\nI\u0027ll point to this readme from the higher-level README.md in\nbuildimage to clarify and include full relative paths from\nsmartos-live.git for the code we\u0027re using."},{"file":"tools/buildimage/lib/imgadm/package-lock.json","line":1,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Shouldn\u0027t only the root tool (buildimg) have a package-lock.json file? Or is imgadm used outside of buildimg?"},{"file":"tools/buildimage/lib/imgadm/package-lock.json","line":1,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"It\u0027s a bit twisty. Normally yes we\u0027d include all of the\nmodules needed for buildimage and imgadm in the same place,\nbut we need to pass different CFLAGS to buildimage and imgadm,\nand this seemed the easiest way to go about doing that\n(effectively, treat them as separate components)"},{"file":"tools/buildimage/package.json","line":12,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Is there a reason the normal package.json doesn\u0027t have any versions here? I get that the package.lock suggest what we currently have, but I assume the rest of the code is written assuming at least a current major version."},{"file":"tools/buildimage/package.json","line":12,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Yep, I inherited this and didn\u0027t clean up. It\u0027s probably good\nidea to at least declare the major versions, I\u0027ll fix that."},{"file":"tools/buildimage/tools/cleanup.sh","line":3,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Assuming this is the right license (rest of the repo is MPL), can you use the shorter form please which is in https://github.com/joyent/illumos-joyent/tree/master/usr/src/prototypes?"},{"file":"tools/buildimage/tools/cleanup.sh","line":3,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Yeah, I think this script shouldn\u0027t exist at all - I\u0027ve never\nneeded to run it by hand in all the time I\u0027ve been working on\nthis code.\n\nWe can always integrate a cleaned up copy in the future."},{"file":"tools/buildimage/tools/cleanup.sh","line":32,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Is there any way both here and in the section down below we can be stricter about the name matching? I could easily imagine something like root ending up in the mount option string for filesystems and while zoneproto is a bit harder to imagine, seems like if we could better constrain it to only look at the names, that\u0027d be better."},{"file":"tools/buildimage/tools/cleanup.sh","line":32,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Yes I absolutely agree. If we were going to include this\nscript, I\u0027d have buildimage create its datasets with a zfs\nuser-property, \u0027zfs create -o engbld:buildimage\u003dtrue ....\u0027\nand look for that instead of name-matching."},{"file":"tools/buildimage/tools/cleanup.sh","line":33,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Should we be checking for failure to unmount and driving on in the face of that? If unmounting fails, we may not want to continue with zfs destory."},{"file":"tools/buildimage/tools/cleanup.sh","line":33,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Yes, good point."},{"file":"tools/buildimage/tools/cleanup.sh","line":38,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Do we want to warn about failure?"},{"file":"tools/buildimage/tools/cleanup.sh","line":38,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Yep, I would do. Something we should consider if integrating\nthis in the future. For now, I\u0027ll just delete the script -\napologies for not catching all of this before seeking review."},{"file":"tools/mk/Makefile.agent_prebuilt.defs","line":25,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"I don\u0027t think these instructions are accurate in practice, since most repositories are in gerrit."},{"file":"tools/mk/Makefile.agent_prebuilt.defs","line":25,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Good point - these instructions aren\u0027t wrong, but yes I could\ndefinitely add more precise info on how to do the\ngerrit dance. Will fix this, thanks!"},{"file":"tools/mk/Makefile.agent_prebuilt.defs","line":51,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I\u0027m not sure what after this is meant to refer to. I\u0027m not sure where you\u0027re intending this to be included."},{"file":"tools/mk/Makefile.agent_prebuilt.defs","line":51,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Thanks, I\u0027ll fix this, a thinko. s/this/Makefile.defs/g"},{"file":"tools/mk/Makefile.agent_prebuilt.defs","line":69,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Should this XXX be cleaned up and determined before going back?"},{"file":"tools/mk/Makefile.agent_prebuilt.defs","line":69,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Yes, I\u0027ll fix this. We\u0027re trying to mirror\nMakefile.node_prebuilt*, allowing a directory or a url to\nretrieve prebuilt agent tarballs. This really should be\nAGENT_PREBUILT_DOWNLOAD_URL rather than AGENT_PREBUILT_DIR\n(node_prebuilt used NODE_PREBUILT_DIR, hence the confusion)\n\nThe default, and my preference, is to always build agents\nrather than using tarballs that are downloaded or available\non the filesystem, since then we know agents we build will\nalways built on the same build machine as the code that uses\nthem. We don\u0027t have that guarantee with tarballs."},{"file":"tools/mk/Makefile.agent_prebuilt.defs","line":80,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I can\u0027t find anything at this URL, is it correct?"},{"file":"tools/mk/Makefile.agent_prebuilt.defs","line":80,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"That\u0027s a mistake, we should just delete this paragraph,\nit\u0027s boilerplate copied from Makefile.node_prebuild.defs"},{"file":"tools/mk/Makefile.agent_prebuilt.defs","line":93,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Is there a reason that this commented out variable is still here?"},{"file":"tools/mk/Makefile.agent_prebuilt.defs","line":93,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"No, see above - I\u0027ll remove it."},{"file":"tools/mk/Makefile.agent_prebuilt.targ","line":1,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Was this meant to be here? Others don\u0027t seem to have it."},{"file":"tools/mk/Makefile.defs","line":23,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Minor nit, but probably should have a ticket reference in the commit message. This applies to most of the files in tools/mk/, but I\u0027ll only mention it here."},{"file":"tools/mk/Makefile.defs","line":23,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"I forgot to address this in patch set 3. As Chris mentioned in\na previous comment, I should be more precise here wrt.\ndealing with gerrit, so I\u0027ll add that."},{"file":"tools/mk/Makefile.defs","line":174,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"What do we avoid changing by not changing the variable name?"},{"file":"tools/mk/Makefile.defs","line":174,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"This is about compatibility with existing MG and Jenkins jobs during the switchover. That is, modified components can still use BITS_DIR to publish and MG\u0027s existing mantaput-bits script can still work."},{"file":"tools/mk/Makefile.defs","line":174,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Could we have the variable name be ENGBLD_BITS_DIR , and then leave in a temporary if BITS_DIR --\u003e  ENGBLD_BITS_DIR \u003d BITS_DIR?"},{"file":"tools/mk/Makefile.defs","line":174,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Absolutely, I\u0027ll change that here, and everywhere else it\u0027s\nreferenced within eng.git. I haven\u0027t changed every component\nMakefile which still all set BITS_DIR."},{"file":"tools/mk/Makefile.defs","line":176,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"I think we may have talked about this before, but I forget the answer.  Why isn\u0027t this a sub directory of build?"},{"file":"tools/mk/Makefile.defs","line":176,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"It contains different stuff - bits/ contains completed build artifacts, build/ describes an intermediate state of those build artifacts (content we\u0027re still using to assemble the final artifact, .o files, etc.)"},{"file":"tools/mk/Makefile.node_modules.targ","line":34,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"It\u0027s not obvious to me how this relates to the rest of the changes."},{"file":"tools/mk/Makefile.node_modules.targ","line":34,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"This was needed to a build problem in some components which used stampfiles, but I forget which :-(  I\u0027ll go back through those and see if I can add a comment to better describe why this was necessary. Thanks for pointing this out."},{"file":"tools/mk/Makefile.targ","line":379,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I don\u0027t see anything in the Makefile that is causing us to ignore errors here. Missing \u0027-\u0027 before the action?"},{"file":"tools/mk/Makefile.targ","line":379,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Yep, will fix."},{"file":"tools/mk/Makefile.targ","line":388,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"This can be \u0027/usr/bin/ps -o ppid\u003d -p $$$$\u0027. The \u0027\u003d\u0027 after the ppid will remove the header, which gets us out of needing to use tail."},{"file":"tools/mk/Makefile.targ","line":388,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Nice, thanks!"},{"file":"tools/validate-buildenv.sh","line":1,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Several of these shebangs are inconsistent."},{"file":"tools/validate-buildenv.sh","line":1,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Done"},{"file":"tools/validate-buildenv.sh","line":22,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"If this is a constraint, can we enforce this in the scripts please? Some of us do actually put the illumos tools before pkgsrc to force ourselves to eat our own dog food. So if the tooling generally requires that, then something else should enforce that reality."},{"file":"tools/validate-buildenv.sh","line":22,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Yep - we have no Triton equivalent of bldenv(1) to give us\nanywhere central to declare the build environment, short of\nthis validation script, and even then it\u0027s a best-effort\nrather than something comprehensive (like a wrapper that\nclears all unknown environment values before invoking the\nbuild, similar to what lullaby\u0027s build(1) did for Solaris)\n\nAs you mention below, we do have some code here to enforce\nthe environment. In the future perhaps we could become more\nstrict, have per-project build environments so the platform\nbuild could perhaps have its own settings..."},{"file":"tools/validate-buildenv.sh","line":22,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I guess for most folks using the platform this isn\u0027t too much of a concern. Perhaps though having a standard set of shared shell glue library that all the scripts invoke which just sanitizes and standardizes the environment would be a good future RFE or having the Makefile set paths as needed. I think the more we can, over time, divorce the user\u0027s environment (PATH, SHELL, EDITOR, etc.) from what has to be present to run this, the better. But I accept that\u0027s all for some time in the future."},{"file":"tools/validate-buildenv.sh","line":22,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"I\u0027ve added text to the block comment to that effect. I too would like something closer to bldenv (or better yet, build(1)!) but we\u0027re not there yet, sadly."},{"file":"tools/validate-buildenv.sh","line":55,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Technically lowercase i."},{"file":"tools/validate-buildenv.sh","line":55,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Done"},{"file":"tools/validate-buildenv.sh","line":203,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"See earlier note. This is fine for now, but it\u0027d be nice if in the long-term the user environment choices don\u0027t need to leak into here."},{"file":"tools/validate-buildenv.sh","line":203,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Yep."},{"file":"tools/validate-buildenv.sh","line":262,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Is there a reason this isn\u0027t a hard failure?"},{"file":"tools/validate-buildenv.sh","line":262,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Yes - some Triton/Manta components don\u0027t use node at all, so\nwe have no way to use the NODE_PREBUILT image version to\nmap us to the correct pkgsrc version.\n\nI suppose we could default to some value, but that seemed\nweird too. I\u0027m not sure what the right answer is here when we\naren\u0027t getting any hints from the component."},{"file":"tools/validate-buildenv.sh","line":262,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"FWIW when/if we apply these changes to node libraries (which I think we will eventually want to do instead of copy-pasting), then most repos wont have a PREBUILT variable."},{"file":"tools/validate-buildenv.sh","line":262,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Can we at least add a comment explaining the background?"},{"file":"tools/validate-buildenv.sh","line":262,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Yep, done."},{"file":"tools/validate-buildenv.sh","line":329,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Thanks for adding instructions about how to fix things into cases like this."},{"file":"tools/validate-buildenv.sh","line":329,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":":-)"},{"file":"tools/validate-buildenv.sh","line":346,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"In other cases you\u0027ve made this local to avoid leaking into the broader environment. Do you want to here?"},{"file":"tools/validate-buildenv.sh","line":346,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Will do, yes. I was really doing this just to squeeze in under\n80 columns."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":13,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":3,"deletions":-1},{"file":".gitmodules","type":"MODIFIED","insertions":2,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":65,"deletions":-18},{"file":"tools/agent-prebuilt.sh","type":"ADDED","insertions":420,"deletions":0},{"file":"tools/bits-upload.sh","type":"ADDED","insertions":429,"deletions":0},{"file":"tools/buildimage-extract-pkg.sh","type":"ADDED","insertions":29,"deletions":0},{"file":"tools/buildimage/Makefile","type":"ADDED","insertions":54,"deletions":0},{"file":"tools/buildimage/README.md","type":"ADDED","insertions":123,"deletions":0},{"file":"tools/buildimage/bin/buildimage","type":"ADDED","insertions":708,"deletions":0},{"file":"tools/buildimage/lib/imgadm/README.md","type":"ADDED","insertions":9,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/IMG.js","type":"ADDED","insertions":81,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/cli.js","type":"ADDED","insertions":2148,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/common.js","type":"ADDED","insertions":846,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/configuration.js","type":"ADDED","insertions":138,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/database.js","type":"ADDED","insertions":171,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/errors.js","type":"ADDED","insertions":827,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/imgadm.js","type":"ADDED","insertions":4329,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/locker.js","type":"ADDED","insertions":177,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/magic.js","type":"ADDED","insertions":102,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/docker.js","type":"ADDED","insertions":386,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/dsapi.js","type":"ADDED","insertions":92,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/imgapi.js","type":"ADDED","insertions":264,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/index.js","type":"ADDED","insertions":82,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/source.js","type":"ADDED","insertions":205,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/upgrade.js","type":"ADDED","insertions":342,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/zfs.js","type":"ADDED","insertions":549,"deletions":0},{"file":"tools/buildimage/lib/imgadm/package-lock.json","type":"ADDED","insertions":3607,"deletions":0},{"file":"tools/buildimage/lib/imgadm/package.json","type":"ADDED","insertions":36,"deletions":0},{"file":"tools/buildimage/lib/imgadm/sbin/imgadm","type":"ADDED","insertions":42,"deletions":0},{"file":"tools/buildimage/package-lock.json","type":"ADDED","insertions":54,"deletions":0},{"file":"tools/buildimage/package.json","type":"ADDED","insertions":14,"deletions":0},{"file":"tools/buildimage/tools/cleanup.sh","type":"ADDED","insertions":39,"deletions":0},{"file":"tools/mk/Makefile.agent_prebuilt.defs","type":"ADDED","insertions":206,"deletions":0},{"file":"tools/mk/Makefile.agent_prebuilt.targ","type":"ADDED","insertions":121,"deletions":0},{"file":"tools/mk/Makefile.defs","type":"MODIFIED","insertions":94,"deletions":-4},{"file":"tools/mk/Makefile.deps","type":"MODIFIED","insertions":11,"deletions":-8},{"file":"tools/mk/Makefile.go_prebuilt.defs","type":"MODIFIED","insertions":11,"deletions":-4},{"file":"tools/mk/Makefile.go_prebuilt.targ","type":"MODIFIED","insertions":11,"deletions":-4},{"file":"tools/mk/Makefile.manpages.defs","type":"MODIFIED","insertions":12,"deletions":-5},{"file":"tools/mk/Makefile.manpages.targ","type":"MODIFIED","insertions":12,"deletions":-5},{"file":"tools/mk/Makefile.node.defs","type":"MODIFIED","insertions":12,"deletions":-5},{"file":"tools/mk/Makefile.node.targ","type":"MODIFIED","insertions":12,"deletions":-5},{"file":"tools/mk/Makefile.node_modules.defs","type":"MODIFIED","insertions":12,"deletions":-5},{"file":"tools/mk/Makefile.node_modules.targ","type":"MODIFIED","insertions":13,"deletions":-6},{"file":"tools/mk/Makefile.node_prebuilt.defs","type":"MODIFIED","insertions":12,"deletions":-5},{"file":"tools/mk/Makefile.node_prebuilt.targ","type":"MODIFIED","insertions":12,"deletions":-5},{"file":"tools/mk/Makefile.smf.defs","type":"MODIFIED","insertions":14,"deletions":-5},{"file":"tools/mk/Makefile.smf.targ","type":"MODIFIED","insertions":13,"deletions":-5},{"file":"tools/mk/Makefile.targ","type":"MODIFIED","insertions":157,"deletions":-16},{"file":"tools/mkrepo","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"tools/validate-buildenv.sh","type":"ADDED","insertions":602,"deletions":0}],"sizeInsertions":17713,"sizeDeletions":-109},{"number":"3","revision":"4d47d485328fb086e243d0c5225507a8136a3d48","parents":["8d4add222e0e3463c0f866f3b0d8da2022a1dac9"],"ref":"refs/changes/21/5221/3","uploader":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"createdOn":1545231698,"author":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":13,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"Makefile","type":"MODIFIED","insertions":70,"deletions":-19},{"file":"tools/agent-prebuilt.sh","type":"ADDED","insertions":445,"deletions":0},{"file":"tools/bits-upload.sh","type":"ADDED","insertions":432,"deletions":0},{"file":"tools/buildimage-extract-pkg.sh","type":"ADDED","insertions":30,"deletions":0},{"file":"tools/buildimage/Makefile","type":"ADDED","insertions":54,"deletions":0},{"file":"tools/buildimage/README.md","type":"ADDED","insertions":122,"deletions":0},{"file":"tools/buildimage/bin/buildimage","type":"ADDED","insertions":708,"deletions":0},{"file":"tools/buildimage/lib/imgadm/README.md","type":"ADDED","insertions":28,"deletions":0},{"file":"tools/buildimage/lib/imgadm/imgadm.patch","type":"ADDED","insertions":305,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/IMG.js","type":"ADDED","insertions":81,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/cli.js","type":"ADDED","insertions":2148,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/common.js","type":"ADDED","insertions":846,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/configuration.js","type":"ADDED","insertions":138,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/database.js","type":"ADDED","insertions":171,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/errors.js","type":"ADDED","insertions":827,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/imgadm.js","type":"ADDED","insertions":4329,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/locker.js","type":"ADDED","insertions":177,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/magic.js","type":"ADDED","insertions":102,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/docker.js","type":"ADDED","insertions":386,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/dsapi.js","type":"ADDED","insertions":92,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/imgapi.js","type":"ADDED","insertions":264,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/index.js","type":"ADDED","insertions":82,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/source.js","type":"ADDED","insertions":205,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/upgrade.js","type":"ADDED","insertions":342,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/zfs.js","type":"ADDED","insertions":549,"deletions":0},{"file":"tools/buildimage/lib/imgadm/package-lock.json","type":"ADDED","insertions":3607,"deletions":0},{"file":"tools/buildimage/lib/imgadm/package.json","type":"ADDED","insertions":36,"deletions":0},{"file":"tools/buildimage/lib/imgadm/sbin/imgadm","type":"ADDED","insertions":42,"deletions":0},{"file":"tools/buildimage/package-lock.json","type":"ADDED","insertions":54,"deletions":0},{"file":"tools/buildimage/package.json","type":"ADDED","insertions":14,"deletions":0},{"file":"tools/buildimage/tools/cleanup.sh","type":"ADDED","insertions":39,"deletions":0},{"file":"tools/mk/Makefile.agent_prebuilt.defs","type":"ADDED","insertions":200,"deletions":0},{"file":"tools/mk/Makefile.agent_prebuilt.targ","type":"ADDED","insertions":121,"deletions":0},{"file":"tools/mk/Makefile.defs","type":"MODIFIED","insertions":94,"deletions":-4},{"file":"tools/mk/Makefile.deps","type":"MODIFIED","insertions":11,"deletions":-8},{"file":"tools/mk/Makefile.go_prebuilt.defs","type":"MODIFIED","insertions":11,"deletions":-4},{"file":"tools/mk/Makefile.go_prebuilt.targ","type":"MODIFIED","insertions":11,"deletions":-4},{"file":"tools/mk/Makefile.manpages.defs","type":"MODIFIED","insertions":12,"deletions":-5},{"file":"tools/mk/Makefile.manpages.targ","type":"MODIFIED","insertions":12,"deletions":-5},{"file":"tools/mk/Makefile.node.defs","type":"MODIFIED","insertions":12,"deletions":-5},{"file":"tools/mk/Makefile.node.targ","type":"MODIFIED","insertions":12,"deletions":-5},{"file":"tools/mk/Makefile.node_modules.defs","type":"MODIFIED","insertions":12,"deletions":-5},{"file":"tools/mk/Makefile.node_modules.targ","type":"MODIFIED","insertions":13,"deletions":-6},{"file":"tools/mk/Makefile.node_prebuilt.defs","type":"MODIFIED","insertions":12,"deletions":-5},{"file":"tools/mk/Makefile.node_prebuilt.targ","type":"MODIFIED","insertions":12,"deletions":-5},{"file":"tools/mk/Makefile.smf.defs","type":"MODIFIED","insertions":14,"deletions":-5},{"file":"tools/mk/Makefile.smf.targ","type":"MODIFIED","insertions":13,"deletions":-5},{"file":"tools/mk/Makefile.targ","type":"MODIFIED","insertions":157,"deletions":-16},{"file":"tools/mkrepo","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"tools/validate-buildenv.sh","type":"ADDED","insertions":645,"deletions":0}],"sizeInsertions":18105,"sizeDeletions":-110},{"number":"4","revision":"97eade0e564875605db4d33feb142ee75f003252","parents":["8d4add222e0e3463c0f866f3b0d8da2022a1dac9"],"ref":"refs/changes/21/5221/4","uploader":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"createdOn":1545305216,"author":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"isDraft":false,"kind":"REWORK","comments":[{"file":"tools/agent-prebuilt.sh","line":196,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Does this actually need to be exported for future children or do we just need to set the variable?"},{"file":"tools/agent-prebuilt.sh","line":196,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Done"},{"file":"tools/agent-prebuilt.sh","line":204,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Does this actually need to be exported for future children or do we just need to set the variable?"},{"file":"tools/agent-prebuilt.sh","line":204,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Done"},{"file":"tools/mk/Makefile.agent_prebuilt.defs","line":72,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Note differences in spacing from previous lines."},{"file":"tools/mk/Makefile.agent_prebuilt.defs","line":72,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Thanks - fixed"},{"file":"tools/mk/Makefile.agent_prebuilt.defs","line":72,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"It\u0027s still inconsistent. Some lines are using tabs and others spaces. This is pretty minor, I only really noticed because of the symbology provided for the tab."},{"file":"tools/mk/Makefile.agent_prebuilt.defs","line":72,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Apologies, will fix this."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":13,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"Makefile","type":"MODIFIED","insertions":72,"deletions":-19},{"file":"tools/agent-prebuilt.sh","type":"ADDED","insertions":450,"deletions":0},{"file":"tools/bits-upload.sh","type":"ADDED","insertions":435,"deletions":0},{"file":"tools/buildimage-extract-pkg.sh","type":"ADDED","insertions":35,"deletions":0},{"file":"tools/buildimage/Makefile","type":"ADDED","insertions":54,"deletions":0},{"file":"tools/buildimage/README.md","type":"ADDED","insertions":122,"deletions":0},{"file":"tools/buildimage/bin/buildimage","type":"ADDED","insertions":692,"deletions":0},{"file":"tools/buildimage/lib/imgadm/README.md","type":"ADDED","insertions":28,"deletions":0},{"file":"tools/buildimage/lib/imgadm/imgadm.patch","type":"ADDED","insertions":305,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/IMG.js","type":"ADDED","insertions":81,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/cli.js","type":"ADDED","insertions":2148,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/common.js","type":"ADDED","insertions":846,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/configuration.js","type":"ADDED","insertions":138,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/database.js","type":"ADDED","insertions":171,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/errors.js","type":"ADDED","insertions":827,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/imgadm.js","type":"ADDED","insertions":4329,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/locker.js","type":"ADDED","insertions":177,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/magic.js","type":"ADDED","insertions":102,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/docker.js","type":"ADDED","insertions":386,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/dsapi.js","type":"ADDED","insertions":92,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/imgapi.js","type":"ADDED","insertions":264,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/index.js","type":"ADDED","insertions":82,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/source.js","type":"ADDED","insertions":205,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/upgrade.js","type":"ADDED","insertions":342,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/zfs.js","type":"ADDED","insertions":549,"deletions":0},{"file":"tools/buildimage/lib/imgadm/package-lock.json","type":"ADDED","insertions":3607,"deletions":0},{"file":"tools/buildimage/lib/imgadm/package.json","type":"ADDED","insertions":36,"deletions":0},{"file":"tools/buildimage/lib/imgadm/sbin/imgadm","type":"ADDED","insertions":42,"deletions":0},{"file":"tools/buildimage/package-lock.json","type":"ADDED","insertions":54,"deletions":0},{"file":"tools/buildimage/package.json","type":"ADDED","insertions":14,"deletions":0},{"file":"tools/mk/Makefile.agent_prebuilt.defs","type":"ADDED","insertions":203,"deletions":0},{"file":"tools/mk/Makefile.agent_prebuilt.targ","type":"ADDED","insertions":120,"deletions":0},{"file":"tools/mk/Makefile.ctf.defs","type":"MODIFIED","insertions":13,"deletions":-4},{"file":"tools/mk/Makefile.ctf.targ","type":"MODIFIED","insertions":15,"deletions":-4},{"file":"tools/mk/Makefile.defs","type":"MODIFIED","insertions":97,"deletions":-4},{"file":"tools/mk/Makefile.deps","type":"MODIFIED","insertions":14,"deletions":-8},{"file":"tools/mk/Makefile.go_prebuilt.defs","type":"MODIFIED","insertions":14,"deletions":-4},{"file":"tools/mk/Makefile.go_prebuilt.targ","type":"MODIFIED","insertions":14,"deletions":-4},{"file":"tools/mk/Makefile.manpages.defs","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.manpages.targ","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.node.defs","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.node.targ","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.node_modules.defs","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.node_modules.targ","type":"MODIFIED","insertions":16,"deletions":-6},{"file":"tools/mk/Makefile.node_prebuilt.defs","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.node_prebuilt.targ","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.smf.defs","type":"MODIFIED","insertions":17,"deletions":-5},{"file":"tools/mk/Makefile.smf.targ","type":"MODIFIED","insertions":16,"deletions":-5},{"file":"tools/mk/Makefile.targ","type":"MODIFIED","insertions":160,"deletions":-16},{"file":"tools/mkrepo","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"tools/validate-buildenv.sh","type":"ADDED","insertions":650,"deletions":0}],"sizeInsertions":18145,"sizeDeletions":-118},{"number":"5","revision":"0278c38cd1c7dd61bbbabe19186bf2bad770502a","parents":["8d4add222e0e3463c0f866f3b0d8da2022a1dac9"],"ref":"refs/changes/21/5221/5","uploader":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"createdOn":1546535974,"author":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":13,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"Makefile","type":"MODIFIED","insertions":79,"deletions":-20},{"file":"tools/agent-prebuilt.sh","type":"ADDED","insertions":459,"deletions":0},{"file":"tools/bits-upload.sh","type":"ADDED","insertions":435,"deletions":0},{"file":"tools/buildimage-extract-pkg.sh","type":"ADDED","insertions":35,"deletions":0},{"file":"tools/buildimage/Makefile","type":"ADDED","insertions":54,"deletions":0},{"file":"tools/buildimage/README.md","type":"ADDED","insertions":122,"deletions":0},{"file":"tools/buildimage/bin/buildimage","type":"ADDED","insertions":692,"deletions":0},{"file":"tools/buildimage/lib/imgadm/README.md","type":"ADDED","insertions":28,"deletions":0},{"file":"tools/buildimage/lib/imgadm/imgadm.patch","type":"ADDED","insertions":305,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/IMG.js","type":"ADDED","insertions":81,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/cli.js","type":"ADDED","insertions":2148,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/common.js","type":"ADDED","insertions":846,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/configuration.js","type":"ADDED","insertions":138,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/database.js","type":"ADDED","insertions":171,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/errors.js","type":"ADDED","insertions":827,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/imgadm.js","type":"ADDED","insertions":4329,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/locker.js","type":"ADDED","insertions":177,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/magic.js","type":"ADDED","insertions":102,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/docker.js","type":"ADDED","insertions":386,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/dsapi.js","type":"ADDED","insertions":92,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/imgapi.js","type":"ADDED","insertions":264,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/index.js","type":"ADDED","insertions":82,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/source.js","type":"ADDED","insertions":205,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/upgrade.js","type":"ADDED","insertions":342,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/zfs.js","type":"ADDED","insertions":549,"deletions":0},{"file":"tools/buildimage/lib/imgadm/package-lock.json","type":"ADDED","insertions":3607,"deletions":0},{"file":"tools/buildimage/lib/imgadm/package.json","type":"ADDED","insertions":36,"deletions":0},{"file":"tools/buildimage/lib/imgadm/sbin/imgadm","type":"ADDED","insertions":42,"deletions":0},{"file":"tools/buildimage/package-lock.json","type":"ADDED","insertions":54,"deletions":0},{"file":"tools/buildimage/package.json","type":"ADDED","insertions":14,"deletions":0},{"file":"tools/mk/Makefile.agent_prebuilt.defs","type":"ADDED","insertions":203,"deletions":0},{"file":"tools/mk/Makefile.agent_prebuilt.targ","type":"ADDED","insertions":120,"deletions":0},{"file":"tools/mk/Makefile.ctf.defs","type":"MODIFIED","insertions":14,"deletions":-5},{"file":"tools/mk/Makefile.ctf.targ","type":"MODIFIED","insertions":16,"deletions":-5},{"file":"tools/mk/Makefile.defs","type":"MODIFIED","insertions":101,"deletions":-5},{"file":"tools/mk/Makefile.deps","type":"MODIFIED","insertions":14,"deletions":-9},{"file":"tools/mk/Makefile.go_prebuilt.defs","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.go_prebuilt.targ","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.manpages.defs","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.manpages.targ","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.node.defs","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.node.targ","type":"MODIFIED","insertions":15,"deletions":-6},{"file":"tools/mk/Makefile.node_modules.defs","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.node_modules.targ","type":"MODIFIED","insertions":16,"deletions":-6},{"file":"tools/mk/Makefile.node_prebuilt.defs","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.node_prebuilt.targ","type":"MODIFIED","insertions":15,"deletions":-6},{"file":"tools/mk/Makefile.smf.defs","type":"MODIFIED","insertions":17,"deletions":-6},{"file":"tools/mk/Makefile.smf.targ","type":"MODIFIED","insertions":16,"deletions":-6},{"file":"tools/mk/Makefile.targ","type":"MODIFIED","insertions":176,"deletions":-16},{"file":"tools/mkrepo","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"tools/validate-buildenv.sh","type":"ADDED","insertions":664,"deletions":0}],"sizeInsertions":18199,"sizeDeletions":-129},{"number":"6","revision":"87c86445e960b7ee6be2f2abced71a08003909a7","parents":["8d4add222e0e3463c0f866f3b0d8da2022a1dac9"],"ref":"refs/changes/21/5221/6","uploader":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"createdOn":1547033206,"author":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":13,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"Makefile","type":"MODIFIED","insertions":79,"deletions":-20},{"file":"tools/agent-prebuilt.sh","type":"ADDED","insertions":459,"deletions":0},{"file":"tools/bits-upload.sh","type":"ADDED","insertions":464,"deletions":0},{"file":"tools/buildimage-extract-pkg.sh","type":"ADDED","insertions":35,"deletions":0},{"file":"tools/buildimage/Makefile","type":"ADDED","insertions":54,"deletions":0},{"file":"tools/buildimage/README.md","type":"ADDED","insertions":122,"deletions":0},{"file":"tools/buildimage/bin/buildimage","type":"ADDED","insertions":692,"deletions":0},{"file":"tools/buildimage/lib/imgadm/README.md","type":"ADDED","insertions":28,"deletions":0},{"file":"tools/buildimage/lib/imgadm/imgadm.patch","type":"ADDED","insertions":305,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/IMG.js","type":"ADDED","insertions":81,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/cli.js","type":"ADDED","insertions":2148,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/common.js","type":"ADDED","insertions":846,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/configuration.js","type":"ADDED","insertions":138,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/database.js","type":"ADDED","insertions":171,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/errors.js","type":"ADDED","insertions":827,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/imgadm.js","type":"ADDED","insertions":4329,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/locker.js","type":"ADDED","insertions":177,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/magic.js","type":"ADDED","insertions":102,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/docker.js","type":"ADDED","insertions":386,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/dsapi.js","type":"ADDED","insertions":92,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/imgapi.js","type":"ADDED","insertions":264,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/index.js","type":"ADDED","insertions":82,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/source.js","type":"ADDED","insertions":205,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/upgrade.js","type":"ADDED","insertions":342,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/zfs.js","type":"ADDED","insertions":549,"deletions":0},{"file":"tools/buildimage/lib/imgadm/package-lock.json","type":"ADDED","insertions":3607,"deletions":0},{"file":"tools/buildimage/lib/imgadm/package.json","type":"ADDED","insertions":36,"deletions":0},{"file":"tools/buildimage/lib/imgadm/sbin/imgadm","type":"ADDED","insertions":42,"deletions":0},{"file":"tools/buildimage/package-lock.json","type":"ADDED","insertions":54,"deletions":0},{"file":"tools/buildimage/package.json","type":"ADDED","insertions":14,"deletions":0},{"file":"tools/mk/Makefile.agent_prebuilt.defs","type":"ADDED","insertions":203,"deletions":0},{"file":"tools/mk/Makefile.agent_prebuilt.targ","type":"ADDED","insertions":120,"deletions":0},{"file":"tools/mk/Makefile.ctf.defs","type":"MODIFIED","insertions":14,"deletions":-5},{"file":"tools/mk/Makefile.ctf.targ","type":"MODIFIED","insertions":16,"deletions":-5},{"file":"tools/mk/Makefile.defs","type":"MODIFIED","insertions":101,"deletions":-5},{"file":"tools/mk/Makefile.deps","type":"MODIFIED","insertions":14,"deletions":-9},{"file":"tools/mk/Makefile.go_prebuilt.defs","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.go_prebuilt.targ","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.manpages.defs","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.manpages.targ","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.node.defs","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.node.targ","type":"MODIFIED","insertions":15,"deletions":-6},{"file":"tools/mk/Makefile.node_modules.defs","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.node_modules.targ","type":"MODIFIED","insertions":16,"deletions":-6},{"file":"tools/mk/Makefile.node_prebuilt.defs","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.node_prebuilt.targ","type":"MODIFIED","insertions":15,"deletions":-6},{"file":"tools/mk/Makefile.smf.defs","type":"MODIFIED","insertions":17,"deletions":-6},{"file":"tools/mk/Makefile.smf.targ","type":"MODIFIED","insertions":16,"deletions":-6},{"file":"tools/mk/Makefile.targ","type":"MODIFIED","insertions":176,"deletions":-16},{"file":"tools/mkrepo","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"tools/validate-buildenv.sh","type":"ADDED","insertions":664,"deletions":0}],"sizeInsertions":18228,"sizeDeletions":-129},{"number":"7","revision":"4be2382350f6055f1f2062dd551832f3bd3e9113","parents":["8d4add222e0e3463c0f866f3b0d8da2022a1dac9"],"ref":"refs/changes/21/5221/7","uploader":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"createdOn":1547045104,"author":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"isDraft":false,"kind":"REWORK","comments":[{"file":"tools/bits-upload.sh","line":331,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Is there a reason this isn\u0027t capitalized like the other variables? Also, may be better to spell out branch here."},{"file":"tools/bits-upload.sh","line":331,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Yes, I agree. Fixing."},{"file":"tools/mk/Makefile.defs","line":182,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"This comment and code no longer seem in sync. We aren\u0027t setting BITS_DIR it appears anymore, though we\u0027re honoring it."},{"file":"tools/mk/Makefile.defs","line":182,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Thanks for spotting that, fixing."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":13,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"Makefile","type":"MODIFIED","insertions":79,"deletions":-20},{"file":"tools/agent-prebuilt.sh","type":"ADDED","insertions":459,"deletions":0},{"file":"tools/bits-upload.sh","type":"ADDED","insertions":466,"deletions":0},{"file":"tools/buildimage-extract-pkg.sh","type":"ADDED","insertions":35,"deletions":0},{"file":"tools/buildimage/Makefile","type":"ADDED","insertions":54,"deletions":0},{"file":"tools/buildimage/README.md","type":"ADDED","insertions":122,"deletions":0},{"file":"tools/buildimage/bin/buildimage","type":"ADDED","insertions":692,"deletions":0},{"file":"tools/buildimage/lib/imgadm/README.md","type":"ADDED","insertions":28,"deletions":0},{"file":"tools/buildimage/lib/imgadm/imgadm.patch","type":"ADDED","insertions":305,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/IMG.js","type":"ADDED","insertions":81,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/cli.js","type":"ADDED","insertions":2148,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/common.js","type":"ADDED","insertions":846,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/configuration.js","type":"ADDED","insertions":138,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/database.js","type":"ADDED","insertions":171,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/errors.js","type":"ADDED","insertions":827,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/imgadm.js","type":"ADDED","insertions":4329,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/locker.js","type":"ADDED","insertions":177,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/magic.js","type":"ADDED","insertions":102,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/docker.js","type":"ADDED","insertions":386,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/dsapi.js","type":"ADDED","insertions":92,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/imgapi.js","type":"ADDED","insertions":264,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/index.js","type":"ADDED","insertions":82,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/source.js","type":"ADDED","insertions":205,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/upgrade.js","type":"ADDED","insertions":342,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/zfs.js","type":"ADDED","insertions":549,"deletions":0},{"file":"tools/buildimage/lib/imgadm/package-lock.json","type":"ADDED","insertions":3607,"deletions":0},{"file":"tools/buildimage/lib/imgadm/package.json","type":"ADDED","insertions":36,"deletions":0},{"file":"tools/buildimage/lib/imgadm/sbin/imgadm","type":"ADDED","insertions":42,"deletions":0},{"file":"tools/buildimage/package-lock.json","type":"ADDED","insertions":54,"deletions":0},{"file":"tools/buildimage/package.json","type":"ADDED","insertions":14,"deletions":0},{"file":"tools/mk/Makefile.agent_prebuilt.defs","type":"ADDED","insertions":203,"deletions":0},{"file":"tools/mk/Makefile.agent_prebuilt.targ","type":"ADDED","insertions":120,"deletions":0},{"file":"tools/mk/Makefile.ctf.defs","type":"MODIFIED","insertions":14,"deletions":-5},{"file":"tools/mk/Makefile.ctf.targ","type":"MODIFIED","insertions":16,"deletions":-5},{"file":"tools/mk/Makefile.defs","type":"MODIFIED","insertions":101,"deletions":-5},{"file":"tools/mk/Makefile.deps","type":"MODIFIED","insertions":14,"deletions":-9},{"file":"tools/mk/Makefile.go_prebuilt.defs","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.go_prebuilt.targ","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.manpages.defs","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.manpages.targ","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.node.defs","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.node.targ","type":"MODIFIED","insertions":15,"deletions":-6},{"file":"tools/mk/Makefile.node_modules.defs","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.node_modules.targ","type":"MODIFIED","insertions":16,"deletions":-6},{"file":"tools/mk/Makefile.node_prebuilt.defs","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.node_prebuilt.targ","type":"MODIFIED","insertions":15,"deletions":-6},{"file":"tools/mk/Makefile.smf.defs","type":"MODIFIED","insertions":17,"deletions":-6},{"file":"tools/mk/Makefile.smf.targ","type":"MODIFIED","insertions":16,"deletions":-6},{"file":"tools/mk/Makefile.targ","type":"MODIFIED","insertions":176,"deletions":-16},{"file":"tools/mkrepo","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"tools/validate-buildenv.sh","type":"ADDED","insertions":664,"deletions":0}],"sizeInsertions":18230,"sizeDeletions":-129},{"number":"8","revision":"fd3a5dc0f28c3023a4503d2f39e92d3398038322","parents":["8d4add222e0e3463c0f866f3b0d8da2022a1dac9"],"ref":"refs/changes/21/5221/8","uploader":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"createdOn":1547561030,"author":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1547593602,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":13,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"Makefile","type":"MODIFIED","insertions":79,"deletions":-20},{"file":"tools/agent-prebuilt.sh","type":"ADDED","insertions":459,"deletions":0},{"file":"tools/bits-upload.sh","type":"ADDED","insertions":466,"deletions":0},{"file":"tools/buildimage-extract-pkg.sh","type":"ADDED","insertions":35,"deletions":0},{"file":"tools/buildimage/Makefile","type":"ADDED","insertions":54,"deletions":0},{"file":"tools/buildimage/README.md","type":"ADDED","insertions":122,"deletions":0},{"file":"tools/buildimage/bin/buildimage","type":"ADDED","insertions":692,"deletions":0},{"file":"tools/buildimage/lib/imgadm/README.md","type":"ADDED","insertions":28,"deletions":0},{"file":"tools/buildimage/lib/imgadm/imgadm.patch","type":"ADDED","insertions":305,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/IMG.js","type":"ADDED","insertions":81,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/cli.js","type":"ADDED","insertions":2148,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/common.js","type":"ADDED","insertions":846,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/configuration.js","type":"ADDED","insertions":138,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/database.js","type":"ADDED","insertions":171,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/errors.js","type":"ADDED","insertions":827,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/imgadm.js","type":"ADDED","insertions":4329,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/locker.js","type":"ADDED","insertions":177,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/magic.js","type":"ADDED","insertions":102,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/docker.js","type":"ADDED","insertions":386,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/dsapi.js","type":"ADDED","insertions":92,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/imgapi.js","type":"ADDED","insertions":264,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/index.js","type":"ADDED","insertions":82,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/source.js","type":"ADDED","insertions":205,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/upgrade.js","type":"ADDED","insertions":342,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/zfs.js","type":"ADDED","insertions":549,"deletions":0},{"file":"tools/buildimage/lib/imgadm/package-lock.json","type":"ADDED","insertions":3607,"deletions":0},{"file":"tools/buildimage/lib/imgadm/package.json","type":"ADDED","insertions":36,"deletions":0},{"file":"tools/buildimage/lib/imgadm/sbin/imgadm","type":"ADDED","insertions":42,"deletions":0},{"file":"tools/buildimage/package-lock.json","type":"ADDED","insertions":54,"deletions":0},{"file":"tools/buildimage/package.json","type":"ADDED","insertions":14,"deletions":0},{"file":"tools/mk/Makefile.agent_prebuilt.defs","type":"ADDED","insertions":203,"deletions":0},{"file":"tools/mk/Makefile.agent_prebuilt.targ","type":"ADDED","insertions":120,"deletions":0},{"file":"tools/mk/Makefile.ctf.defs","type":"MODIFIED","insertions":14,"deletions":-5},{"file":"tools/mk/Makefile.ctf.targ","type":"MODIFIED","insertions":16,"deletions":-5},{"file":"tools/mk/Makefile.defs","type":"MODIFIED","insertions":101,"deletions":-5},{"file":"tools/mk/Makefile.deps","type":"MODIFIED","insertions":14,"deletions":-9},{"file":"tools/mk/Makefile.go_prebuilt.defs","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.go_prebuilt.targ","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.manpages.defs","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.manpages.targ","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.node.defs","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.node.targ","type":"MODIFIED","insertions":15,"deletions":-6},{"file":"tools/mk/Makefile.node_modules.defs","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.node_modules.targ","type":"MODIFIED","insertions":16,"deletions":-6},{"file":"tools/mk/Makefile.node_prebuilt.defs","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.node_prebuilt.targ","type":"MODIFIED","insertions":15,"deletions":-6},{"file":"tools/mk/Makefile.smf.defs","type":"MODIFIED","insertions":17,"deletions":-6},{"file":"tools/mk/Makefile.smf.targ","type":"MODIFIED","insertions":16,"deletions":-6},{"file":"tools/mk/Makefile.targ","type":"MODIFIED","insertions":176,"deletions":-16},{"file":"tools/mkrepo","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"tools/validate-buildenv.sh","type":"ADDED","insertions":664,"deletions":0}],"sizeInsertions":18230,"sizeDeletions":-129},{"number":"9","revision":"4b8c2a3a5af5a195b26b0293bde7e89fd64a2d4f","parents":["8d4add222e0e3463c0f866f3b0d8da2022a1dac9"],"ref":"refs/changes/21/5221/9","uploader":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"createdOn":1547644767,"author":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":13,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"Makefile","type":"MODIFIED","insertions":79,"deletions":-20},{"file":"tools/agent-prebuilt.sh","type":"ADDED","insertions":459,"deletions":0},{"file":"tools/bits-upload.sh","type":"ADDED","insertions":466,"deletions":0},{"file":"tools/buildimage-extract-pkg.sh","type":"ADDED","insertions":35,"deletions":0},{"file":"tools/buildimage/Makefile","type":"ADDED","insertions":54,"deletions":0},{"file":"tools/buildimage/README.md","type":"ADDED","insertions":122,"deletions":0},{"file":"tools/buildimage/bin/buildimage","type":"ADDED","insertions":692,"deletions":0},{"file":"tools/buildimage/lib/imgadm/README.md","type":"ADDED","insertions":28,"deletions":0},{"file":"tools/buildimage/lib/imgadm/imgadm.patch","type":"ADDED","insertions":305,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/IMG.js","type":"ADDED","insertions":81,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/cli.js","type":"ADDED","insertions":2148,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/common.js","type":"ADDED","insertions":846,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/configuration.js","type":"ADDED","insertions":138,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/database.js","type":"ADDED","insertions":171,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/errors.js","type":"ADDED","insertions":827,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/imgadm.js","type":"ADDED","insertions":4329,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/locker.js","type":"ADDED","insertions":177,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/magic.js","type":"ADDED","insertions":102,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/docker.js","type":"ADDED","insertions":386,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/dsapi.js","type":"ADDED","insertions":92,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/imgapi.js","type":"ADDED","insertions":264,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/index.js","type":"ADDED","insertions":82,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/source.js","type":"ADDED","insertions":205,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/upgrade.js","type":"ADDED","insertions":342,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/zfs.js","type":"ADDED","insertions":549,"deletions":0},{"file":"tools/buildimage/lib/imgadm/package-lock.json","type":"ADDED","insertions":3607,"deletions":0},{"file":"tools/buildimage/lib/imgadm/package.json","type":"ADDED","insertions":36,"deletions":0},{"file":"tools/buildimage/lib/imgadm/sbin/imgadm","type":"ADDED","insertions":42,"deletions":0},{"file":"tools/buildimage/package-lock.json","type":"ADDED","insertions":54,"deletions":0},{"file":"tools/buildimage/package.json","type":"ADDED","insertions":14,"deletions":0},{"file":"tools/mk/Makefile.agent_prebuilt.defs","type":"ADDED","insertions":203,"deletions":0},{"file":"tools/mk/Makefile.agent_prebuilt.targ","type":"ADDED","insertions":120,"deletions":0},{"file":"tools/mk/Makefile.ctf.defs","type":"MODIFIED","insertions":14,"deletions":-5},{"file":"tools/mk/Makefile.ctf.targ","type":"MODIFIED","insertions":16,"deletions":-5},{"file":"tools/mk/Makefile.defs","type":"MODIFIED","insertions":101,"deletions":-5},{"file":"tools/mk/Makefile.deps","type":"MODIFIED","insertions":14,"deletions":-9},{"file":"tools/mk/Makefile.go_prebuilt.defs","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.go_prebuilt.targ","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.manpages.defs","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.manpages.targ","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.node.defs","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.node.targ","type":"MODIFIED","insertions":15,"deletions":-6},{"file":"tools/mk/Makefile.node_modules.defs","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.node_modules.targ","type":"MODIFIED","insertions":16,"deletions":-6},{"file":"tools/mk/Makefile.node_prebuilt.defs","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.node_prebuilt.targ","type":"MODIFIED","insertions":15,"deletions":-6},{"file":"tools/mk/Makefile.smf.defs","type":"MODIFIED","insertions":17,"deletions":-6},{"file":"tools/mk/Makefile.smf.targ","type":"MODIFIED","insertions":16,"deletions":-6},{"file":"tools/mk/Makefile.targ","type":"MODIFIED","insertions":176,"deletions":-16},{"file":"tools/mkrepo","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"tools/validate-buildenv.sh","type":"ADDED","insertions":664,"deletions":0}],"sizeInsertions":18230,"sizeDeletions":-129},{"number":"10","revision":"272efda85ab05aff2b17c7f9ac906e9add36900c","parents":["8d4add222e0e3463c0f866f3b0d8da2022a1dac9"],"ref":"refs/changes/21/5221/10","uploader":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"createdOn":1547655978,"author":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":13,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"Makefile","type":"MODIFIED","insertions":79,"deletions":-20},{"file":"tools/agent-prebuilt.sh","type":"ADDED","insertions":460,"deletions":0},{"file":"tools/bits-upload.sh","type":"ADDED","insertions":466,"deletions":0},{"file":"tools/buildimage-extract-pkg.sh","type":"ADDED","insertions":35,"deletions":0},{"file":"tools/buildimage/Makefile","type":"ADDED","insertions":54,"deletions":0},{"file":"tools/buildimage/README.md","type":"ADDED","insertions":122,"deletions":0},{"file":"tools/buildimage/bin/buildimage","type":"ADDED","insertions":692,"deletions":0},{"file":"tools/buildimage/lib/imgadm/README.md","type":"ADDED","insertions":28,"deletions":0},{"file":"tools/buildimage/lib/imgadm/imgadm.patch","type":"ADDED","insertions":305,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/IMG.js","type":"ADDED","insertions":81,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/cli.js","type":"ADDED","insertions":2148,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/common.js","type":"ADDED","insertions":846,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/configuration.js","type":"ADDED","insertions":138,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/database.js","type":"ADDED","insertions":171,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/errors.js","type":"ADDED","insertions":827,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/imgadm.js","type":"ADDED","insertions":4329,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/locker.js","type":"ADDED","insertions":177,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/magic.js","type":"ADDED","insertions":102,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/docker.js","type":"ADDED","insertions":386,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/dsapi.js","type":"ADDED","insertions":92,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/imgapi.js","type":"ADDED","insertions":264,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/index.js","type":"ADDED","insertions":82,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/source.js","type":"ADDED","insertions":205,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/upgrade.js","type":"ADDED","insertions":342,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/zfs.js","type":"ADDED","insertions":549,"deletions":0},{"file":"tools/buildimage/lib/imgadm/package-lock.json","type":"ADDED","insertions":3607,"deletions":0},{"file":"tools/buildimage/lib/imgadm/package.json","type":"ADDED","insertions":36,"deletions":0},{"file":"tools/buildimage/lib/imgadm/sbin/imgadm","type":"ADDED","insertions":42,"deletions":0},{"file":"tools/buildimage/package-lock.json","type":"ADDED","insertions":54,"deletions":0},{"file":"tools/buildimage/package.json","type":"ADDED","insertions":14,"deletions":0},{"file":"tools/mk/Makefile.agent_prebuilt.defs","type":"ADDED","insertions":207,"deletions":0},{"file":"tools/mk/Makefile.agent_prebuilt.targ","type":"ADDED","insertions":120,"deletions":0},{"file":"tools/mk/Makefile.ctf.defs","type":"MODIFIED","insertions":14,"deletions":-5},{"file":"tools/mk/Makefile.ctf.targ","type":"MODIFIED","insertions":16,"deletions":-5},{"file":"tools/mk/Makefile.defs","type":"MODIFIED","insertions":101,"deletions":-5},{"file":"tools/mk/Makefile.deps","type":"MODIFIED","insertions":14,"deletions":-9},{"file":"tools/mk/Makefile.go_prebuilt.defs","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.go_prebuilt.targ","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.manpages.defs","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.manpages.targ","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.node.defs","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.node.targ","type":"MODIFIED","insertions":15,"deletions":-6},{"file":"tools/mk/Makefile.node_modules.defs","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.node_modules.targ","type":"MODIFIED","insertions":16,"deletions":-6},{"file":"tools/mk/Makefile.node_prebuilt.defs","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.node_prebuilt.targ","type":"MODIFIED","insertions":15,"deletions":-6},{"file":"tools/mk/Makefile.smf.defs","type":"MODIFIED","insertions":17,"deletions":-6},{"file":"tools/mk/Makefile.smf.targ","type":"MODIFIED","insertions":16,"deletions":-6},{"file":"tools/mk/Makefile.targ","type":"MODIFIED","insertions":176,"deletions":-16},{"file":"tools/mkrepo","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"tools/validate-buildenv.sh","type":"ADDED","insertions":664,"deletions":0}],"sizeInsertions":18235,"sizeDeletions":-129},{"number":"11","revision":"5d239781514e7cfa3ec34acdbf26712287826e0a","parents":["8d4add222e0e3463c0f866f3b0d8da2022a1dac9"],"ref":"refs/changes/21/5221/11","uploader":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"createdOn":1547724272,"author":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"isDraft":false,"kind":"REWORK","comments":[{"file":"tools/agent-prebuilt.sh","line":369,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Shouldn\u0027t this be done after the assignment to branch below? Sorry, I only just noticed this. Otherwise, we\u0027ll have agent_branch blank, if branch isn\u0027t set."},{"file":"tools/agent-prebuilt.sh","line":369,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"You\u0027re right. This isn\u0027t a problem the way we\u0027re calling the script today, because we\u0027re always passing the -b \u003cbranch\u003e option, set from this Makefile.defs setting:\n\nBRANCH :\u003d $(shell git symbolic-ref HEAD | $(_AWK) -F/ \u0027{print $$3}\u0027)\n\nMakefile.agent_prebuilt.defs then has:\n\nAGENT_PREBUILT_BRANCH ?\u003d $(BRANCH)\nAGENT_PREBUILT_AGENT_BRANCH ?\u003d $(AGENT_BRANCH)\n\nand Makefile.agent_prebuilt.targ does this and similar everywhere:\n\n%-prebuilt-clone: $(AGENT_PREBUILT_DIR)\n        $(TOP)/deps/eng/tools/agent-prebuilt.sh \\\n                -b \u0027$(AGENT_PREBUILT_BRANCH)\u0027 \\\n                -B \u0027$(AGENT_PREBUILT_AGENT_BRANCH)\u0027 \\\n                -c \u0027$(AGENT_PREBUILT_DIR)\u0027 \\\n                -p \u0027$($*_PREBUILT_TARBALL_PATTERN)\u0027 \\\n                -r \u0027$($*_PREBUILT_REPO)\u0027 \\\n                -t \u0027$($*_PREBUILT_AGENT_TARGETS)\u0027 \\\n                -u \u0027$($*_PREBUILT_GIT_URL)\u0027 clone\n\nStill, it\u0027s worth fixing the script in case that\u0027s ever not the case. Thanks for catching this!"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":13,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"Makefile","type":"MODIFIED","insertions":79,"deletions":-20},{"file":"tools/agent-prebuilt.sh","type":"ADDED","insertions":460,"deletions":0},{"file":"tools/bits-upload.sh","type":"ADDED","insertions":466,"deletions":0},{"file":"tools/buildimage-extract-pkg.sh","type":"ADDED","insertions":35,"deletions":0},{"file":"tools/buildimage/Makefile","type":"ADDED","insertions":54,"deletions":0},{"file":"tools/buildimage/README.md","type":"ADDED","insertions":122,"deletions":0},{"file":"tools/buildimage/bin/buildimage","type":"ADDED","insertions":692,"deletions":0},{"file":"tools/buildimage/lib/imgadm/README.md","type":"ADDED","insertions":28,"deletions":0},{"file":"tools/buildimage/lib/imgadm/imgadm.patch","type":"ADDED","insertions":305,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/IMG.js","type":"ADDED","insertions":81,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/cli.js","type":"ADDED","insertions":2148,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/common.js","type":"ADDED","insertions":846,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/configuration.js","type":"ADDED","insertions":138,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/database.js","type":"ADDED","insertions":171,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/errors.js","type":"ADDED","insertions":827,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/imgadm.js","type":"ADDED","insertions":4329,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/locker.js","type":"ADDED","insertions":177,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/magic.js","type":"ADDED","insertions":102,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/docker.js","type":"ADDED","insertions":386,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/dsapi.js","type":"ADDED","insertions":92,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/imgapi.js","type":"ADDED","insertions":264,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/index.js","type":"ADDED","insertions":82,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/source.js","type":"ADDED","insertions":205,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/upgrade.js","type":"ADDED","insertions":342,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/zfs.js","type":"ADDED","insertions":549,"deletions":0},{"file":"tools/buildimage/lib/imgadm/package-lock.json","type":"ADDED","insertions":3607,"deletions":0},{"file":"tools/buildimage/lib/imgadm/package.json","type":"ADDED","insertions":36,"deletions":0},{"file":"tools/buildimage/lib/imgadm/sbin/imgadm","type":"ADDED","insertions":42,"deletions":0},{"file":"tools/buildimage/package-lock.json","type":"ADDED","insertions":54,"deletions":0},{"file":"tools/buildimage/package.json","type":"ADDED","insertions":14,"deletions":0},{"file":"tools/mk/Makefile.agent_prebuilt.defs","type":"ADDED","insertions":207,"deletions":0},{"file":"tools/mk/Makefile.agent_prebuilt.targ","type":"ADDED","insertions":120,"deletions":0},{"file":"tools/mk/Makefile.ctf.defs","type":"MODIFIED","insertions":14,"deletions":-5},{"file":"tools/mk/Makefile.ctf.targ","type":"MODIFIED","insertions":16,"deletions":-5},{"file":"tools/mk/Makefile.defs","type":"MODIFIED","insertions":101,"deletions":-5},{"file":"tools/mk/Makefile.deps","type":"MODIFIED","insertions":14,"deletions":-9},{"file":"tools/mk/Makefile.go_prebuilt.defs","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.go_prebuilt.targ","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.manpages.defs","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.manpages.targ","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.node.defs","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.node.targ","type":"MODIFIED","insertions":15,"deletions":-6},{"file":"tools/mk/Makefile.node_modules.defs","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.node_modules.targ","type":"MODIFIED","insertions":16,"deletions":-6},{"file":"tools/mk/Makefile.node_prebuilt.defs","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.node_prebuilt.targ","type":"MODIFIED","insertions":15,"deletions":-6},{"file":"tools/mk/Makefile.smf.defs","type":"MODIFIED","insertions":17,"deletions":-6},{"file":"tools/mk/Makefile.smf.targ","type":"MODIFIED","insertions":16,"deletions":-6},{"file":"tools/mk/Makefile.targ","type":"MODIFIED","insertions":176,"deletions":-16},{"file":"tools/mkrepo","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"tools/validate-buildenv.sh","type":"ADDED","insertions":668,"deletions":0}],"sizeInsertions":18239,"sizeDeletions":-129},{"number":"12","revision":"d2168092e47b5cb74b6dc85844fd9c34b912b9f8","parents":["8d4add222e0e3463c0f866f3b0d8da2022a1dac9"],"ref":"refs/changes/21/5221/12","uploader":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"createdOn":1547837921,"author":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1547840449,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1548114575,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1547846954,"by":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"}}],"comments":[{"file":"tools/buildimage/package.json","line":8,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"I\u0027ve not seen the empty string used here before. What does that do? Is this package.json not used for `npm install`?"},{"file":"tools/buildimage/package.json","line":8,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"It\u0027s the same as \u0027*\u0027 (I inherited this from the original bmbf\nprototype) The way I was interpreting the intent here was that\nwe didn\u0027t care about the version, and that using the latest\nversion was fine.\n\nThat said, given our package-lock.json file is also checked\nin, we\u0027re effectively requiring exact versions that way, so we\nmight as well specify those here for clarity."},{"file":"tools/buildimage/package.json","line":8,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"(I\u0027m fine with this being changed *later* if that helps.)\n\nI\u0027d be inclined to specify particular major version ranges at least."},{"file":"tools/validate-buildenv.sh","line":49,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Eventually probably want an update to the triton-origin-image docs to add to eng.git when releasing a new triton-origin-image: https://github.com/joyent/triton-origin-image#releasing-triton-origin-images"},{"file":"tools/validate-buildenv.sh","line":49,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Good point - I\u0027ve filed DOC-782 for this"},{"file":"tools/validate-buildenv.sh","line":69,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Errant period there?"},{"file":"tools/validate-buildenv.sh","line":69,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Yep, thanks"},{"file":"tools/validate-buildenv.sh","line":234,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"nit: tabs vs spaces"},{"file":"tools/validate-buildenv.sh","line":234,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Thanks - fixed that."},{"file":"tools/validate-buildenv.sh","line":315,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Presentation nit (feel free to ignore): I think these commands would be more readable if the \u0027#\u0027 was dropped and the command indented.  Also I\u0027d be fine with ignoring the 80 column limit for those lines here."},{"file":"tools/validate-buildenv.sh","line":315,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Cool, I\u0027m happy to fix this, here and elsewhere."},{"file":"tools/validate-buildenv.sh","line":396,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Could probably drop this one soonish?"},{"file":"tools/validate-buildenv.sh","line":396,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Thanks for making me look - we can drop it now. I\u0027d apparently\nbeen using it to keep the same terminology as MG, then kept\nit on during our discussion to add the ENGBLD prefix. It turns\nout, MG itself never reads this from the environment, it\nonly sets this value via its \u0027-P\u0027 flag\n( http://hound.writev.io/?q\u003dIGNORE_BUILD_PLATFORM )"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":13,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"Makefile","type":"MODIFIED","insertions":79,"deletions":-20},{"file":"tools/agent-prebuilt.sh","type":"ADDED","insertions":460,"deletions":0},{"file":"tools/bits-upload.sh","type":"ADDED","insertions":466,"deletions":0},{"file":"tools/buildimage-extract-pkg.sh","type":"ADDED","insertions":35,"deletions":0},{"file":"tools/buildimage/Makefile","type":"ADDED","insertions":54,"deletions":0},{"file":"tools/buildimage/README.md","type":"ADDED","insertions":122,"deletions":0},{"file":"tools/buildimage/bin/buildimage","type":"ADDED","insertions":692,"deletions":0},{"file":"tools/buildimage/lib/imgadm/README.md","type":"ADDED","insertions":28,"deletions":0},{"file":"tools/buildimage/lib/imgadm/imgadm.patch","type":"ADDED","insertions":305,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/IMG.js","type":"ADDED","insertions":81,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/cli.js","type":"ADDED","insertions":2148,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/common.js","type":"ADDED","insertions":846,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/configuration.js","type":"ADDED","insertions":138,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/database.js","type":"ADDED","insertions":171,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/errors.js","type":"ADDED","insertions":827,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/imgadm.js","type":"ADDED","insertions":4329,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/locker.js","type":"ADDED","insertions":177,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/magic.js","type":"ADDED","insertions":102,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/docker.js","type":"ADDED","insertions":386,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/dsapi.js","type":"ADDED","insertions":92,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/imgapi.js","type":"ADDED","insertions":264,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/index.js","type":"ADDED","insertions":82,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/source.js","type":"ADDED","insertions":205,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/upgrade.js","type":"ADDED","insertions":342,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/zfs.js","type":"ADDED","insertions":549,"deletions":0},{"file":"tools/buildimage/lib/imgadm/package-lock.json","type":"ADDED","insertions":3607,"deletions":0},{"file":"tools/buildimage/lib/imgadm/package.json","type":"ADDED","insertions":36,"deletions":0},{"file":"tools/buildimage/lib/imgadm/sbin/imgadm","type":"ADDED","insertions":42,"deletions":0},{"file":"tools/buildimage/package-lock.json","type":"ADDED","insertions":54,"deletions":0},{"file":"tools/buildimage/package.json","type":"ADDED","insertions":14,"deletions":0},{"file":"tools/mk/Makefile.agent_prebuilt.defs","type":"ADDED","insertions":207,"deletions":0},{"file":"tools/mk/Makefile.agent_prebuilt.targ","type":"ADDED","insertions":120,"deletions":0},{"file":"tools/mk/Makefile.ctf.defs","type":"MODIFIED","insertions":14,"deletions":-5},{"file":"tools/mk/Makefile.ctf.targ","type":"MODIFIED","insertions":16,"deletions":-5},{"file":"tools/mk/Makefile.defs","type":"MODIFIED","insertions":101,"deletions":-5},{"file":"tools/mk/Makefile.deps","type":"MODIFIED","insertions":14,"deletions":-9},{"file":"tools/mk/Makefile.go_prebuilt.defs","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.go_prebuilt.targ","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.manpages.defs","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.manpages.targ","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.node.defs","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.node.targ","type":"MODIFIED","insertions":15,"deletions":-6},{"file":"tools/mk/Makefile.node_modules.defs","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.node_modules.targ","type":"MODIFIED","insertions":16,"deletions":-6},{"file":"tools/mk/Makefile.node_prebuilt.defs","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.node_prebuilt.targ","type":"MODIFIED","insertions":15,"deletions":-6},{"file":"tools/mk/Makefile.smf.defs","type":"MODIFIED","insertions":17,"deletions":-6},{"file":"tools/mk/Makefile.smf.targ","type":"MODIFIED","insertions":16,"deletions":-6},{"file":"tools/mk/Makefile.targ","type":"MODIFIED","insertions":176,"deletions":-16},{"file":"tools/mkrepo","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"tools/validate-buildenv.sh","type":"ADDED","insertions":668,"deletions":0}],"sizeInsertions":18239,"sizeDeletions":-129},{"number":"13","revision":"c89a49cf4774fa862934281d6753751799eea7ba","parents":["8d4add222e0e3463c0f866f3b0d8da2022a1dac9"],"ref":"refs/changes/21/5221/13","uploader":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"createdOn":1548159332,"author":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1548180794,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1548180794,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1548181041,"by":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1548181041,"by":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":13,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"Makefile","type":"MODIFIED","insertions":79,"deletions":-20},{"file":"tools/agent-prebuilt.sh","type":"ADDED","insertions":460,"deletions":0},{"file":"tools/bits-upload.sh","type":"ADDED","insertions":466,"deletions":0},{"file":"tools/buildimage-extract-pkg.sh","type":"ADDED","insertions":35,"deletions":0},{"file":"tools/buildimage/Makefile","type":"ADDED","insertions":54,"deletions":0},{"file":"tools/buildimage/README.md","type":"ADDED","insertions":122,"deletions":0},{"file":"tools/buildimage/bin/buildimage","type":"ADDED","insertions":692,"deletions":0},{"file":"tools/buildimage/lib/imgadm/README.md","type":"ADDED","insertions":28,"deletions":0},{"file":"tools/buildimage/lib/imgadm/imgadm.patch","type":"ADDED","insertions":305,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/IMG.js","type":"ADDED","insertions":81,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/cli.js","type":"ADDED","insertions":2148,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/common.js","type":"ADDED","insertions":846,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/configuration.js","type":"ADDED","insertions":138,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/database.js","type":"ADDED","insertions":171,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/errors.js","type":"ADDED","insertions":827,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/imgadm.js","type":"ADDED","insertions":4329,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/locker.js","type":"ADDED","insertions":177,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/magic.js","type":"ADDED","insertions":102,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/docker.js","type":"ADDED","insertions":386,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/dsapi.js","type":"ADDED","insertions":92,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/imgapi.js","type":"ADDED","insertions":264,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/index.js","type":"ADDED","insertions":82,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/source.js","type":"ADDED","insertions":205,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/upgrade.js","type":"ADDED","insertions":342,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/zfs.js","type":"ADDED","insertions":549,"deletions":0},{"file":"tools/buildimage/lib/imgadm/package-lock.json","type":"ADDED","insertions":3607,"deletions":0},{"file":"tools/buildimage/lib/imgadm/package.json","type":"ADDED","insertions":36,"deletions":0},{"file":"tools/buildimage/lib/imgadm/sbin/imgadm","type":"ADDED","insertions":42,"deletions":0},{"file":"tools/buildimage/package-lock.json","type":"ADDED","insertions":54,"deletions":0},{"file":"tools/buildimage/package.json","type":"ADDED","insertions":14,"deletions":0},{"file":"tools/mk/Makefile.agent_prebuilt.defs","type":"ADDED","insertions":207,"deletions":0},{"file":"tools/mk/Makefile.agent_prebuilt.targ","type":"ADDED","insertions":120,"deletions":0},{"file":"tools/mk/Makefile.ctf.defs","type":"MODIFIED","insertions":14,"deletions":-5},{"file":"tools/mk/Makefile.ctf.targ","type":"MODIFIED","insertions":16,"deletions":-5},{"file":"tools/mk/Makefile.defs","type":"MODIFIED","insertions":101,"deletions":-5},{"file":"tools/mk/Makefile.deps","type":"MODIFIED","insertions":14,"deletions":-9},{"file":"tools/mk/Makefile.go_prebuilt.defs","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.go_prebuilt.targ","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.manpages.defs","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.manpages.targ","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.node.defs","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.node.targ","type":"MODIFIED","insertions":15,"deletions":-6},{"file":"tools/mk/Makefile.node_modules.defs","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.node_modules.targ","type":"MODIFIED","insertions":16,"deletions":-6},{"file":"tools/mk/Makefile.node_prebuilt.defs","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.node_prebuilt.targ","type":"MODIFIED","insertions":15,"deletions":-6},{"file":"tools/mk/Makefile.smf.defs","type":"MODIFIED","insertions":17,"deletions":-6},{"file":"tools/mk/Makefile.smf.targ","type":"MODIFIED","insertions":16,"deletions":-6},{"file":"tools/mk/Makefile.targ","type":"MODIFIED","insertions":176,"deletions":-16},{"file":"tools/mkrepo","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"tools/validate-buildenv.sh","type":"ADDED","insertions":668,"deletions":0}],"sizeInsertions":18239,"sizeDeletions":-129},{"number":"14","revision":"7e20148709f217f2b1dd9e2e4217384ec442ff5f","parents":["8d4add222e0e3463c0f866f3b0d8da2022a1dac9"],"ref":"refs/changes/21/5221/14","uploader":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"createdOn":1548185377,"author":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1548180794,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1548180794,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1548181041,"by":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1548181041,"by":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"}},{"type":"SUBM","value":"1","grantedOn":1548185643,"by":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":17,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"Makefile","type":"MODIFIED","insertions":79,"deletions":-20},{"file":"tools/agent-prebuilt.sh","type":"ADDED","insertions":460,"deletions":0},{"file":"tools/bits-upload.sh","type":"ADDED","insertions":466,"deletions":0},{"file":"tools/buildimage-extract-pkg.sh","type":"ADDED","insertions":35,"deletions":0},{"file":"tools/buildimage/Makefile","type":"ADDED","insertions":54,"deletions":0},{"file":"tools/buildimage/README.md","type":"ADDED","insertions":122,"deletions":0},{"file":"tools/buildimage/bin/buildimage","type":"ADDED","insertions":692,"deletions":0},{"file":"tools/buildimage/lib/imgadm/README.md","type":"ADDED","insertions":28,"deletions":0},{"file":"tools/buildimage/lib/imgadm/imgadm.patch","type":"ADDED","insertions":305,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/IMG.js","type":"ADDED","insertions":81,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/cli.js","type":"ADDED","insertions":2148,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/common.js","type":"ADDED","insertions":846,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/configuration.js","type":"ADDED","insertions":138,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/database.js","type":"ADDED","insertions":171,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/errors.js","type":"ADDED","insertions":827,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/imgadm.js","type":"ADDED","insertions":4329,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/locker.js","type":"ADDED","insertions":177,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/magic.js","type":"ADDED","insertions":102,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/docker.js","type":"ADDED","insertions":386,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/dsapi.js","type":"ADDED","insertions":92,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/imgapi.js","type":"ADDED","insertions":264,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/index.js","type":"ADDED","insertions":82,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/sources/source.js","type":"ADDED","insertions":205,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/upgrade.js","type":"ADDED","insertions":342,"deletions":0},{"file":"tools/buildimage/lib/imgadm/lib/zfs.js","type":"ADDED","insertions":549,"deletions":0},{"file":"tools/buildimage/lib/imgadm/package-lock.json","type":"ADDED","insertions":3607,"deletions":0},{"file":"tools/buildimage/lib/imgadm/package.json","type":"ADDED","insertions":36,"deletions":0},{"file":"tools/buildimage/lib/imgadm/sbin/imgadm","type":"ADDED","insertions":42,"deletions":0},{"file":"tools/buildimage/package-lock.json","type":"ADDED","insertions":54,"deletions":0},{"file":"tools/buildimage/package.json","type":"ADDED","insertions":14,"deletions":0},{"file":"tools/mk/Makefile.agent_prebuilt.defs","type":"ADDED","insertions":207,"deletions":0},{"file":"tools/mk/Makefile.agent_prebuilt.targ","type":"ADDED","insertions":120,"deletions":0},{"file":"tools/mk/Makefile.ctf.defs","type":"MODIFIED","insertions":14,"deletions":-5},{"file":"tools/mk/Makefile.ctf.targ","type":"MODIFIED","insertions":16,"deletions":-5},{"file":"tools/mk/Makefile.defs","type":"MODIFIED","insertions":101,"deletions":-5},{"file":"tools/mk/Makefile.deps","type":"MODIFIED","insertions":14,"deletions":-9},{"file":"tools/mk/Makefile.go_prebuilt.defs","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.go_prebuilt.targ","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.manpages.defs","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.manpages.targ","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.node.defs","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.node.targ","type":"MODIFIED","insertions":15,"deletions":-6},{"file":"tools/mk/Makefile.node_modules.defs","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.node_modules.targ","type":"MODIFIED","insertions":16,"deletions":-6},{"file":"tools/mk/Makefile.node_prebuilt.defs","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"tools/mk/Makefile.node_prebuilt.targ","type":"MODIFIED","insertions":15,"deletions":-6},{"file":"tools/mk/Makefile.smf.defs","type":"MODIFIED","insertions":17,"deletions":-6},{"file":"tools/mk/Makefile.smf.targ","type":"MODIFIED","insertions":16,"deletions":-6},{"file":"tools/mk/Makefile.targ","type":"MODIFIED","insertions":176,"deletions":-16},{"file":"tools/mkrepo","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"tools/validate-buildenv.sh","type":"ADDED","insertions":668,"deletions":0}],"sizeInsertions":18239,"sizeDeletions":-129}],"allReviewers":[{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"}]}