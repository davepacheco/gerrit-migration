From 796072fde8227bb546061be967bda4fd1a76babd Mon Sep 17 00:00:00 2001
From: Kelly McLaughlin <kelly.mclaughlin@joyent.com>
Date: Wed, 5 Sep 2018 15:40:42 -0600
Subject: [PATCH] MANTA-3937 mpicker no longer works

---
 bin/mpicker          |  2 --
 package.json         |  3 ++-
 test/mpicker.test.js | 46 ++++++++++++++++++++++++++++++++++++++++++++
 3 files changed, 48 insertions(+), 3 deletions(-)
 create mode 100644 test/mpicker.test.js

diff --git a/bin/mpicker b/bin/mpicker
index 8f5234f..e36e5a9 100755
--- a/bin/mpicker
+++ b/bin/mpicker
@@ -30,8 +30,6 @@ var sprintf = mod_util.format;
 var VError = mod_verror.VError;
 var muskie_errors = require('../lib/errors');
 
-var consts = require('../lib/constants');
-
 ///-- Globals
 
 var NAME = 'mpicker';
diff --git a/package.json b/package.json
index ec2a59a..59136e1 100644
--- a/package.json
+++ b/package.json
@@ -50,7 +50,8 @@
         "strsplit": "1.0.0",
         "manta": "5.1.0",
         "nodeunit": "0.9.1",
-        "node-uuid": "1.4.1"
+        "node-uuid": "1.4.1",
+        "forkexec": "^1.0.0"
     },
     "scripts": {
         "start": "./build/node/bin/node ./main.js",
diff --git a/test/mpicker.test.js b/test/mpicker.test.js
new file mode 100644
index 0000000..875208d
--- /dev/null
+++ b/test/mpicker.test.js
@@ -0,0 +1,46 @@
+/*
+ * Copyright 2018 Joyent, Inc.
+ */
+
+/*
+ * Test the "mpicker" command.
+ */
+
+var forkExecWait = require('forkexec').forkExecWait;
+var path = require('path');
+
+var BINDIR = path.resolve(__dirname, '../bin');
+var MPICKER = path.resolve(BINDIR, 'mpicker');
+
+
+// ---- helper functions
+
+function test(name, testfunc) {
+    module.exports[name] = testfunc;
+}
+
+// ---- tests
+
+/*
+ * Verify command can be invoked without error
+ */
+test('mpicker -h', function (t) {
+    var argv = [
+        MPICKER,
+        '-h'
+    ];
+
+    var usagePhrase = 'Models the behavior of the Muskie "picker" component.';
+
+    forkExecWait({
+        argv: argv
+    }, function (err, info) {
+        t.ifError(err, err);
+
+        t.equal(info.stderr, '', 'no stderr');
+        t.equal(info.stdout.lastIndexOf(usagePhrase, 0), 0,
+            'stdout from mpicker');
+
+        t.done();
+    });
+});
-- 
2.21.0

