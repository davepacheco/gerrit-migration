From 2c2771cb3996fc57fcf96dea52728fdd76e78046 Mon Sep 17 00:00:00 2001
From: Jerry Jelinek <jerry.jelinek@joyent.com>
Date: Thu, 19 Oct 2017 19:20:24 +0000
Subject: [PATCH] OS-6338 panic from kvm_load_gs

---
 usr/src/uts/common/brand/lx/os/lx_misc.c | 8 ++++++++
 1 file changed, 8 insertions(+)

diff --git a/usr/src/uts/common/brand/lx/os/lx_misc.c b/usr/src/uts/common/brand/lx/os/lx_misc.c
index 53963c0f7d..0990fed430 100644
--- a/usr/src/uts/common/brand/lx/os/lx_misc.c
+++ b/usr/src/uts/common/brand/lx/os/lx_misc.c
@@ -273,6 +273,14 @@ free:
 	}
 	if (sqp)
 		kmem_free(sqp, sizeof (sigqueue_t));
+
+#if defined(__amd64)
+	/*
+	 * We're going to swtch to another process, make sure we don't leave
+	 * any garbage around.
+	 */
+	reset_sregs();
+#endif
 }
 
 void
-- 
2.21.0

