From 46678278fbd55f8eff4086b6f6332aa43228e111 Mon Sep 17 00:00:00 2001
From: "carol.cobine" <carol.cobine@joyent.com>
Date: Thu, 3 Jan 2019 15:52:38 -0500
Subject: [PATCH] DOC-777 Setting up Coal in my Machine

---
 docs/developer-guide/coal-setup.md | 176 ++++++++++++++---------------
 1 file changed, 85 insertions(+), 91 deletions(-)

diff --git a/docs/developer-guide/coal-setup.md b/docs/developer-guide/coal-setup.md
index 2355b15..bc312cc 100644
--- a/docs/developer-guide/coal-setup.md
+++ b/docs/developer-guide/coal-setup.md
@@ -8,139 +8,133 @@
     Copyright (c) 2015, Joyent, Inc.
 -->
 
-# Set Up CoaL
+# Cloud on a Laptop (CoaL)
 
-CoaL stands for "Cloud on a Laptop". It is a VMware virtual appliance
-for a SmartDataCenter headnode. It's useful for developing and testing
-SmartDataCenter (SDC). This document walks through setting up CoaL.
+CoaL is a VMware virtual appliance that provides a full Triton head node for development and testing. Because most Joyent developers work on a Mac, this document walks you through the process of setting up CoaL on a Mac. We recommend that you read this document carefully before you install CoaL.
 
-**WARNING: these steps and command options are not appropriate for
-production deployments.**
+**Note**: Some developers in the community have successfully set up CoaL in Windows and Linux using these instructions only as general guidelines and modifying them as needed.
 
-The minimum requirements, practically speaking, for a good CoaL
-experience is a **Mac with at least 16 GB RAM and an SSD with at least
-45 GB disk available**. Currently, almost all team members using CoaL
-are on Macs with VMware Fusion. Vmware Workstation for Linux is used by
-a few in the community. VMware Workstation for Windows should work, but
-has not recently been tested.
+**WARNING**: these steps and command options are not appropriate for
+production deployments.
 
-At a high level, setting up CoaL involves:
+## Minimum Requirements
 
-1. Downloading the latest build.
-1. Booting the VMware appliance (virtual machine).
-2. Configuring SmartDataCenter.
-3. Waiting for the SDC services to automatically install and setup in
-   the SDC headnode virtual machine. This can take from 10 to 20 minutes
-   on a Mac laptop.
-4. Test and develop.
+The minimum requirements for a good CoaL experience are a Mac with at least 16 GB RAM and an SSD with at least 45 GB disk available.
 
+## Overview
 
-## Run CoaL on VMware
+The high-level steps for setting up CoaL includes:
 
-### Download CoaL and Configure VMware
+1. Downloading the latest CoaL build.
+2. Downloading, installing, and configuring VMware.
+3. Extracting, loading, and configuring CoaL.
+4. Booting the VMware appliance (virtual machine).
+5. Configuring SmartDataCenter.
+6. Waiting for the SDC services to automatically install and setup in the SDC headnode virtual machine. This can take from 10 to 20 minutes.
+7. Testing and developing.
 
-1. Start the download of the latest CoaL build. The tarball is
-   approximately 2 GB.
+## Downloading CoaL
 
-    curl -C - -O https://us-east.manta.joyent.com/Joyent_Dev/public/SmartDataCenter/coal-latest.tgz
+The CoaL tarball is approximately 2 GB and will take some time to complete.
 
-2. Install VMware, if you haven't already.
-    - Mac: [VMware Fusion](http://www.vmware.com/products/fusion) 5, 7, or 8.
-    - Windows or Linux: [VMware Workstation](http://www.vmware.com/products/workstation).
+Start the download of the latest CoaL build by running:
 
-3. Configure VMware virtual networks for CoaL's "external" and "admin"
-   networks. This is a one time configuration for a VMware installation.
+	```
+	curl -C - -O https://us-east.manta.joyent.com/Joyent_Dev/public/SmartDataCenter/release-20180927-20180927T130527Z/headnode/coal-release-20180927-20180927T130527Z-g34dbd8a-4gb.tgz
+	```
 
-    1. Launch VMware at least once after installing VMware.
+While you wait for the tarball download to complete, you can configure and install VMWare.
 
-    2. Run the OS specific CoaL set up script for VMware:
+## Downloading installing, and configuring VMware
 
-         - Mac:
+Most Joyent team members run CoaL from VMware Fusion. You can download it from the [VMware Fusion](http://www.vmware.com/products/fusion) product site.
 
-            ```bash
-            curl -s https://raw.githubusercontent.com/joyent/sdc/master/tools/coal-mac-vmware-setup | sudo bash
-            ```
+1. Download [VMware Fusion](http://www.vmware.com/products/fusion). We recommend VMware version 8.5.3., but users have had success with v5 and v8.
 
-         - Linux:
+**Note**: You can download VMware Workstation for Windows or Linux from [VMware Workstation](http://www.vmware.com/products/workstation.
 
-            ```bash
-            curl -s https://raw.githubusercontent.com/joyent/sdc/master/tools/coal-linux-vmware-setup | sudo bash
-            ```
+2. Install VMWare. When complete, launch the application to confirm that the application is correctly installed, and then close it.
 
-         - Windows:
+Now, you are ready to configure the VMware virtual networks. To do this, you run a one-time script to configure CoaL's external and admin networks.
 
-            ```
-            Download https://raw.githubusercontent.com/joyent/sdc/master/tools/coal-windows-vmware-setup.bat
-            Run coal-windows-vmware-setup.bat
-            ```
+3. To configure the CoaL virtual networks, on a Mac, run:
 
-1. Extract the CoaL virtual machine:
+	```bash
+	curl -s https://raw.githubusercontent.com/joyent/sdc/master/tools/coal-mac-vmware-setup | sudo bash
+	```
+	
+	**Note**: To download set up scripts for Linux and Windows:
+	
+    - On Linux, run:
+	```bash
+	curl -s https://raw.githubusercontent.com/joyent/sdc/master/tools/coal-linux-vmware-setup | sudo bash
+	```
+    - For Windows, download https://raw.githubusercontent.com/joyent/sdc/master/tools/coal-windows-vmware-setup.bat, then run `coal-windows-vmware-setup.bat`.
+	
+## Extracting, loading, and configuring CoaL
 
-    - Mac example:
+1. To unroll the tarball and extract the CoaL virtual machine, run:
 
-        ```bash
-        $ tar -zxvf coal-latest.tgz -C ~/Documents/Virtual\ Machines.localized
-        x root.password.20140911t161518z
-        x coal-master-20140911T194415Z-g1a445f5-4gb.vmwarevm/
-        x coal-master-20140911T194415Z-g1a445f5-4gb.vmwarevm/USB-headnode.vmx
-        x coal-master-20140911T194415Z-g1a445f5-4gb.vmwarevm/zpool.vmdk
-        x coal-master-20140911T194415Z-g1a445f5-4gb.vmwarevm/USB-headnode.vmdk
-        x coal-master-20140911T194415Z-g1a445f5-4gb.vmwarevm/4gb.img
-        ...
-        ```
+	```bash
+	$ tar -zxvf coal-latest.tgz -C ~/Documents/Virtual\ Machines.localized
+	x root.password.20140911t161518z
+	x coal-master-20140911T194415Z-g1a445f5-4gb.vmwarevm/
+	x coal-master-20140911T194415Z-g1a445f5-4gb.vmwarevm/USB-headnode.vmx
+	x coal-master-20140911T194415Z-g1a445f5-4gb.vmwarevm/zpool.vmdk
+	x coal-master-20140911T194415Z-g1a445f5-4gb.vmwarevm/USB-headnode.vmdk
+	x coal-master-20140911T194415Z-g1a445f5-4gb.vmwarevm/4gb.img
+	...
+	```
 
-1. Set memory and run.
+2. To load the CoaL appliance:
+    1. Launch VMware Fusion.
+    2. Select **File** and then click **Open**.
+    3. Navigate to and select the `.vmwarevm` file that contains the CoaL build.
 
-    - Mac example:
+**Note**: If you are working from the command line instead of the VMWare GUI, run:
+	```
+	open coal-<branch>-<build_date_time>-<git_sha1_hash>-4gb.vmwarevm
+	```
+	
+3. To configure memory and run:
+    1. Select **Virtual Machine** and then click **Settings**. The **USB-headnode Settings** dialog displays.
+    2. Click **Processes & Memory**.
+    3. In the **Memory** section, note that the default memory is set to 8192 MB. You can change this setting, but *be sure to leave Mac OS X with at least 8 GB to avoid resource allocation problems*.
 
-        1. Launch VMware Fusion
-        2. File > Open... `coal-<branch>-<build_date_time>-<git_sha1_hash>-4gb.vmwarevm`
-        3. Virtual Machine > Settings
-        4. Processes & Memory > Default memory is set to 8192 MB, but be sure
-	   to leave Mac OS X with at least 8 GB.  If you prefer not to use the
-	   VMWare GUI, the place to change this default is in the CoaL
-	   `USB-headnode.vmx` file, where you can set `memsize = "6144"`, for
-	   example.
-	   WARNING: If you choose to allocate less than 6 GB this may cause
-	   problems, and if you go as low as 4 GB it certainly will. As the
-	   CoaL VM hits its memory limit, it will page rapidly and operations
-	   will contend for resources.  In this situation, the VM will attempt
-	   to perform massive amounts of disk I/O to keep up with the system's
-	   demands, and will slow down and eventually fail to meet them.
+**Note**: If you are not using the VMWare GUI, you can change the default memory in the CoaL `USB-headnode.vmx` file.  You can set memsize = "6144" according to your preference.
 
-1. When you are prompted with the GRUB menu press the down arrow.
+The GRUB boot loader menu displays.
 
-  1. Press the down arrow key to highlight "Live 64-bit".
+### Booting the head node
 
-  2. Press 'c' to go to the command line for GRUB.
+GRUB intervenes in the boot process, enabling you to specify the environment to load. By default, the OS directs the console device to use ttyb. This value is fine for production but not for our use. 
 
-     ![CoaL Grub Boot Menu](../img/coal-grub-menu.png)
+In this section, we first bring up the command line to specify the **vga** console, and then we select **Live 64-bit** to boot the head node.
 
-     By default, the OS will redirect the console to ttyb which is fine
-     for production but needs to be changed for CoaL. At the command line enter
-     "variable os_console vga":
+**GRUB menu navigation tips**
 
-        ```
-        grub> variable os_console vga
-        ```
+When the GRUB menu displays, use the arrow keys to select the menu options. The last step directs you to press **c** to load the GRUB command line. Be prepared to press **c** quickly and immediately. If you are too slow, the **Live 64-bit** option loads instead of the command line. If needed, press **Esc** to redirect the console back to the GRUB menu and try again.
 
-  1. Press enter.
+	![CoaL Grub Boot Menu](../img/coal-grub-menu.png)
 
-  1. Press esc to get back to the GRUB menu.
+#### Specifying the console device
 
-  1. Boot "Live 64-bit" by pressing enter.
+When you are prompted with the GRUB menu:
 
-     If while booting it stays just showing a cursor then you might have
-     forgotten to redirect the console, see instructions above.
+1. Press the down arrow key to highlight **Live 64-bit**.
+2. Quickly press **c** quickly to load the GRUB command line. If needed, press **Esc** to redirect the console back to the GRUB menu and try again.
+3. At the GRUB command prompt, type `variable os_console vga`, and press **Enter**.
+4. Press **Esc** to return to the GRUB menu.
+5. Press **Enter** to boot **Live 64-bit**.
+
+If you see a blank screen with a cursor at the top left while the head node is booting, you may have forgotten to redirect the console. If so, press Esc to return to the GRUB menu.
 
      ![kvm warning on boot](../img/coal-only-cursor.png)
 
-     On boot, being in a virtual environment without Intel VT-x support
-     enabled, you'll receive cpu and kvm warnings:
+Also note that because you are in a virtual environment without Intel VT-x support enabled, you'll receive cpu and kvm warnings. You can safely ignore them:
 
      ![kvm warning on boot](../img/coal-boot-warnings.png)
 
-
 ### Configure the Headnode
 
 Use the following table to configure your CoaL with settings that are
-- 
2.21.0

