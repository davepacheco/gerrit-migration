{"project":"joyent/node-zkstream","branch":"master","id":"Iee5745db2c7aa31c6bb026e5b8fbd6b8f0d3eda2","number":"5422","subject":"joyent/node-zkstream#29 unreliable tests assuming after sync() all watchers have fired joyent/node-zkstream#41 Move time-consuming connect() failure tests to the end Reviewed by: Robert Mustacchi \u003crm@joyent.com\u003e Approved by: Robert Mustacchi \u003crm@joyent.co","owner":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"url":"https://cr.joyent.us/5422","commitMessage":"joyent/node-zkstream#29 unreliable tests assuming after sync() all watchers have fired\njoyent/node-zkstream#41 Move time-consuming connect() failure tests to the end\nReviewed by: Robert Mustacchi \u003crm@joyent.com\u003e\nApproved by: Robert Mustacchi \u003crm@joyent.com\u003e\n","createdOn":1548367345,"lastUpdated":1548377437,"open":false,"status":"MERGED","comments":[{"timestamp":1548367345,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 1."},{"timestamp":1548367405,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1548367931,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 2: Commit message was updated."},{"timestamp":1548370584,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 2:\n\n(3 comments)"},{"timestamp":1548370889,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 2:\n\n(3 comments)"},{"timestamp":1548371434,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 3."},{"timestamp":1548371493,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1548372476,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 3:\n\n(1 comment)"},{"timestamp":1548373200,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 4."},{"timestamp":1548373259,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1548373464,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 4: Code-Review+1"},{"timestamp":1548377050,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 4: Integration-Approval+1"},{"timestamp":1548377098,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 5: Commit message was updated."},{"timestamp":1548377437,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Alex Wilson"}],"currentPatchSet":{"number":"5","revision":"60214ca36fd84f7445b4eeff13de436954237568","parents":["767208ca5fbf54d107b7567834b91c38bc1964c7"],"ref":"refs/changes/22/5422/5","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1548377098,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1548373259,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1548373464,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1548377050,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"SUBM","value":"1","grantedOn":1548377437,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"test/basic.test.js","type":"MODIFIED","insertions":92,"deletions":-68},{"file":"test/multi-node.test.js","type":"MODIFIED","insertions":29,"deletions":-17},{"file":"test/utils.js","type":"ADDED","insertions":38,"deletions":0}],"sizeInsertions":159,"sizeDeletions":-85},"patchSets":[{"number":"1","revision":"ab091b8658d05d737c19069ddc987695c757fc2a","parents":["767208ca5fbf54d107b7567834b91c38bc1964c7"],"ref":"refs/changes/22/5422/1","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1548367345,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1548367405,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"test/basic.test.js","type":"MODIFIED","insertions":87,"deletions":-68},{"file":"test/multi-node.test.js","type":"MODIFIED","insertions":25,"deletions":-16}],"sizeInsertions":112,"sizeDeletions":-84},{"number":"2","revision":"ed1be3f61d79693a4bb01b713032604665cc8311","parents":["767208ca5fbf54d107b7567834b91c38bc1964c7"],"ref":"refs/changes/22/5422/2","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1548367931,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1548367405,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"test/basic.test.js","line":645,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I don\u0027t see how this isn\u0027t racy right now. While there\u0027s the initial callback, there\u0027s nothing that guarantees that we won\u0027t see the dataChanged event the second time before we do the check at the moment."},{"file":"test/basic.test.js","line":645,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Roger that, rewriting."},{"file":"test/multi-node.test.js","line":212,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Just to confirm, stat.version is based on the server\u0027s view of the data, right, not the local watches?"},{"file":"test/multi-node.test.js","line":212,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Yes, everything in stat is from the server."},{"file":"test/multi-node.test.js","line":221,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"In the new set up, why is the sync necessary here? Shouldn\u0027t zkc1 only fire the callback if it actually sees that data has changed regardless of whether or not it\u0027s come up before or after zkc2\u0027s action?"},{"file":"test/multi-node.test.js","line":221,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"That\u0027s correct. It may be delayed though and sync will make it happen faster (we\u0027re telling the zk leader to sync up with its followers right away). It shouldn\u0027t be necessary, but it may make the test complete quicker. idk if that\u0027s a good enough reason to leave it in?"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"test/basic.test.js","type":"MODIFIED","insertions":87,"deletions":-68},{"file":"test/multi-node.test.js","type":"MODIFIED","insertions":25,"deletions":-16}],"sizeInsertions":112,"sizeDeletions":-84},{"number":"3","revision":"385cb3a39d2123ab66a2d6c8292e03f1f93e2aec","parents":["767208ca5fbf54d107b7567834b91c38bc1964c7"],"ref":"refs/changes/22/5422/3","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1548371434,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1548371493,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"test/multi-node.test.js","line":16,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I don\u0027t see the use of this."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"test/basic.test.js","type":"MODIFIED","insertions":92,"deletions":-68},{"file":"test/multi-node.test.js","type":"MODIFIED","insertions":31,"deletions":-17},{"file":"test/utils.js","type":"ADDED","insertions":38,"deletions":0}],"sizeInsertions":161,"sizeDeletions":-85},{"number":"4","revision":"ee5745db2c7aa31c6bb026e5b8fbd6b8f0d3eda2","parents":["767208ca5fbf54d107b7567834b91c38bc1964c7"],"ref":"refs/changes/22/5422/4","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1548373200,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1548373464,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1548377050,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1548373259,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"test/basic.test.js","type":"MODIFIED","insertions":92,"deletions":-68},{"file":"test/multi-node.test.js","type":"MODIFIED","insertions":29,"deletions":-17},{"file":"test/utils.js","type":"ADDED","insertions":38,"deletions":0}],"sizeInsertions":159,"sizeDeletions":-85},{"number":"5","revision":"60214ca36fd84f7445b4eeff13de436954237568","parents":["767208ca5fbf54d107b7567834b91c38bc1964c7"],"ref":"refs/changes/22/5422/5","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1548377098,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1548373464,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1548377050,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"SUBM","value":"1","grantedOn":1548377437,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1548373259,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"test/basic.test.js","type":"MODIFIED","insertions":92,"deletions":-68},{"file":"test/multi-node.test.js","type":"MODIFIED","insertions":29,"deletions":-17},{"file":"test/utils.js","type":"ADDED","insertions":38,"deletions":0}],"sizeInsertions":159,"sizeDeletions":-85}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}]}