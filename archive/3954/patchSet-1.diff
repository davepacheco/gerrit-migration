From ad8bf30863b80754a63c7dffe18d46eb38bf32ab Mon Sep 17 00:00:00 2001
From: Jason King <jason.king@joyent.com>
Date: Tue, 15 May 2018 11:12:52 -0500
Subject: [PATCH] OS-6935 Possible race in lx_start_nfs_lockd

---
 usr/src/uts/common/brand/lx/os/lx_lockd.c | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/usr/src/uts/common/brand/lx/os/lx_lockd.c b/usr/src/uts/common/brand/lx/os/lx_lockd.c
index 234e815d3f..9c76c57352 100644
--- a/usr/src/uts/common/brand/lx/os/lx_lockd.c
+++ b/usr/src/uts/common/brand/lx/os/lx_lockd.c
@@ -77,6 +77,11 @@ lx_lockd_alive(pid_t lockd_pid)
 	}
 
 	mutex_enter(&p->p_lock);
+	if (p->p_stat == SZOMB || (p->p_flag & SEXITING) != 0) {
+		mutex_exit(&p->p_lock);
+		mutex_exit(&pidlock);
+		return (B_FALSE);
+	}
 	vp = p->p_exec;
 	VN_HOLD(vp);
 	mutex_exit(&p->p_lock);
-- 
2.21.0

