{"project":"joyent/smartos-live","branch":"master","topic":"OS-4960","id":"I2655f721e6a7a52d9070654bc41772879bab1d15","number":"5243","subject":"OS-4960 in-gate dmake should be used to build the platform Reviewed by: John Levon \u003cjohn.levon@joyent.com\u003e Reviewed by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e Approved by: John Levon \u003cjohn.levon@joyent.com\u003e","owner":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"url":"https://cr.joyent.us/5243","commitMessage":"OS-4960 in-gate dmake should be used to build the platform\nReviewed by: John Levon \u003cjohn.levon@joyent.com\u003e\nReviewed by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e\nApproved by: John Levon \u003cjohn.levon@joyent.com\u003e\n","createdOn":1544819931,"lastUpdated":1551383471,"open":false,"status":"MERGED","comments":[{"timestamp":1544819931,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Uploaded patch set 1."},{"timestamp":1544819963,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Topic set to OS-4960"},{"timestamp":1544819988,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1544821886,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1544822757,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1544823061,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1544839969,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Uploaded patch set 2."},{"timestamp":1544840025,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1545041971,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 2:\n\n(4 comments)"},{"timestamp":1545412751,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Uploaded patch set 3."},{"timestamp":1545412756,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 2:\n\n(4 comments)"},{"timestamp":1545412803,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1545585702,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 3:\n\n(3 comments)"},{"timestamp":1545586034,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 3:\n\n(1 comment)"},{"timestamp":1545597157,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 3:\n\n(1 comment)"},{"timestamp":1545843009,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Uploaded patch set 4."},{"timestamp":1545843012,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 3:\n\n(2 comments)"},{"timestamp":1545843065,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1546006143,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 4: Code-Review+1"},{"timestamp":1546292109,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 4: Code-Review+1"},{"timestamp":1546977248,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Uploaded patch set 5."},{"timestamp":1546977323,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1546983324,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 5: Code-Review+1"},{"timestamp":1547204350,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 5: Code-Review+1 Integration-Approval+1"},{"timestamp":1551382820,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Uploaded patch set 6: Patch Set 5 was rebased."},{"timestamp":1551382875,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 6:\n\n\"make check\" passed ok"},{"timestamp":1551383063,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Uploaded patch set 7: Commit message was updated."},{"timestamp":1551383471,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Robert Mustacchi"}],"currentPatchSet":{"number":"7","revision":"2655f721e6a7a52d9070654bc41772879bab1d15","parents":["7da6b2e062621c423a56a8c0385888557ada6d1a"],"ref":"refs/changes/43/5243/7","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1551383063,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1546977323,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1546983324,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1547204350,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1547204350,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}},{"type":"SUBM","value":"1","grantedOn":1551383471,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"configure","type":"MODIFIED","insertions":8,"deletions":-2},{"file":"pkgsrc/dmake/prefix","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"tools/build_illumos","type":"MODIFIED","insertions":8,"deletions":0},{"file":"tools/clobber_illumos","type":"MODIFIED","insertions":6,"deletions":-59}],"sizeInsertions":23,"sizeDeletions":-62},"patchSets":[{"number":"1","revision":"fefce6c2b463d0bbe1209eb0e77a428e88f5ca60","parents":["5bbd31725fc1d57535b0b605a3ca657bde1333e1"],"ref":"refs/changes/43/5243/1","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1544819931,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1544819988,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"configure","line":334,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Use $CODEMGR_WS instead, or does that not make sense?"},{"file":"configure","line":334,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I\u0027m actually going to use $SRC here instead. But doing another round of builds first."},{"file":"configure","line":334,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Works for me."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"configure","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"tools/build_illumos","type":"MODIFIED","insertions":2,"deletions":0},{"file":"tools/clobber_illumos","type":"MODIFIED","insertions":8,"deletions":-10}],"sizeInsertions":17,"sizeDeletions":-11},{"number":"2","revision":"7622d2463cbc3fbd928673871573ea1365dd2118","parents":["5bbd31725fc1d57535b0b605a3ca657bde1333e1"],"ref":"refs/changes/43/5243/2","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1544839969,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1544840025,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"tools/build_illumos","line":55,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"why does MAKE need treating differently from PATH on :57 ?"},{"file":"tools/build_illumos","line":55,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Because illumos.sh explicitly sets MAKE in the environment file to point to the tools proto area. I\u0027ll add a comment that explains this."},{"file":"tools/clobber_illumos","line":19,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"\"The one...\" \u003c-- sentence doesn\u0027t make much sense.\n\nMore generally, I\u0027m dubious about the utility of checking for /opt/local/bin/dmake as a sentinel for whether we need to clobber. That\u0027s now a basic build environment thing, not something specific to this workspace.\n\nIf we still want a faster \"make clean\", why don\u0027t we make our sentinel something like usr/src/tools/proto/root_i386-nd ?"},{"file":"tools/clobber_illumos","line":19,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Yeah, now that we have that, there\u0027s no need to do any of this. So I\u0027ve just removed it all."},{"file":"tools/clobber_illumos","line":31,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Are you intending to leave this in?"},{"file":"tools/clobber_illumos","line":31,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"No, thanks."},{"file":"tools/clobber_illumos","line":87,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"This is all no longer relevant"},{"file":"tools/clobber_illumos","line":87,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Yeah, you\u0027re right. I\u0027ve removed it all."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"configure","type":"MODIFIED","insertions":8,"deletions":-2},{"file":"tools/build_illumos","type":"MODIFIED","insertions":2,"deletions":0},{"file":"tools/clobber_illumos","type":"MODIFIED","insertions":10,"deletions":-10}],"sizeInsertions":20,"sizeDeletions":-12},{"number":"3","revision":"3d58b0655a8a7e3d39fd9e5d09c4726495f5a095","parents":["5bbd31725fc1d57535b0b605a3ca657bde1333e1"],"ref":"refs/changes/43/5243/3","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1545412751,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1545412803,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"tools/build_illumos","line":61,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"I\u0027m still not quite following, sorry. I don\u0027t understand how this could be different from changing line :63 to be:\n\n cd usr/src \u0026\u0026 export PATH\u003d... \u0026\u0026 export MAKE\u003d... \u0026\u0026 dmake setup ...\n\nIs there something else in the environment that is based on $MAKE ?"},{"file":"tools/build_illumos","line":61,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"bldenv checks that $MAKE exists. $MAKE is set in illumos.sh to point to the one in the tools proto area. Without this and the corresponding change in bldenv you\u0027ll never successfully enter the shell."},{"file":"tools/build_illumos","line":61,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Ah, OK, it\u0027s the first part I\u0027d not twigged"},{"file":"tools/clobber_illumos","line":0,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Optional, but this seems like it\u0027d be a pretty trivial Makefile target at this point?"},{"file":"tools/clobber_illumos","line":0,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I debated doing that, but since there were a couple of places using this, sometimes conditionally, I didn\u0027t want to go fighting the Makefile yet. Though we probably could clean it up."},{"file":"tools/clobber_illumos","line":28,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"no longer needed"},{"file":"tools/clobber_illumos","line":28,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"configure","type":"MODIFIED","insertions":8,"deletions":-2},{"file":"tools/build_illumos","type":"MODIFIED","insertions":8,"deletions":0},{"file":"tools/clobber_illumos","type":"MODIFIED","insertions":7,"deletions":-59}],"sizeInsertions":23,"sizeDeletions":-61},{"number":"4","revision":"da2e52f71c532f113d744edb1cfe650bd22d0185","parents":["5bbd31725fc1d57535b0b605a3ca657bde1333e1"],"ref":"refs/changes/43/5243/4","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1545843009,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1545843065,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1546292109,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1546006143,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"configure","type":"MODIFIED","insertions":8,"deletions":-2},{"file":"tools/build_illumos","type":"MODIFIED","insertions":8,"deletions":0},{"file":"tools/clobber_illumos","type":"MODIFIED","insertions":6,"deletions":-59}],"sizeInsertions":22,"sizeDeletions":-61},{"number":"5","revision":"02578aa7eb5de3228833147ca4aa887dfebdbbc6","parents":["5bbd31725fc1d57535b0b605a3ca657bde1333e1"],"ref":"refs/changes/43/5243/5","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1546977248,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1546977323,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1546983324,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1547204350,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1547204350,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"configure","type":"MODIFIED","insertions":8,"deletions":-2},{"file":"pkgsrc/dmake/prefix","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"tools/build_illumos","type":"MODIFIED","insertions":8,"deletions":0},{"file":"tools/clobber_illumos","type":"MODIFIED","insertions":6,"deletions":-59}],"sizeInsertions":23,"sizeDeletions":-62},{"number":"6","revision":"bf120d357b6099aa67b6fb633898f0ddde303d01","parents":["7da6b2e062621c423a56a8c0385888557ada6d1a"],"ref":"refs/changes/43/5243/6","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1551382820,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1546977323,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1546983324,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1547204350,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1547204350,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"configure","type":"MODIFIED","insertions":8,"deletions":-2},{"file":"pkgsrc/dmake/prefix","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"tools/build_illumos","type":"MODIFIED","insertions":8,"deletions":0},{"file":"tools/clobber_illumos","type":"MODIFIED","insertions":6,"deletions":-59}],"sizeInsertions":23,"sizeDeletions":-62},{"number":"7","revision":"2655f721e6a7a52d9070654bc41772879bab1d15","parents":["7da6b2e062621c423a56a8c0385888557ada6d1a"],"ref":"refs/changes/43/5243/7","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1551383063,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"SUBM","value":"1","grantedOn":1551383471,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1546977323,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1546983324,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1547204350,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1547204350,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"configure","type":"MODIFIED","insertions":8,"deletions":-2},{"file":"pkgsrc/dmake/prefix","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"tools/build_illumos","type":"MODIFIED","insertions":8,"deletions":0},{"file":"tools/clobber_illumos","type":"MODIFIED","insertions":6,"deletions":-59}],"sizeInsertions":23,"sizeDeletions":-62}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}]}