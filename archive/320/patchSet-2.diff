From 8854ea759827c258634ff1c3e515db3c431244b7 Mon Sep 17 00:00:00 2001
From: Alex Wilson <alex.wilson@joyent.com>
Date: Thu, 18 Aug 2016 20:45:33 -0700
Subject: [PATCH] joyent/node-smartdc-auth#9 requestSigner() regression:
 duplicated prefixes on keyId

---
 lib/index.js | 8 +++++++-
 package.json | 2 +-
 2 files changed, 8 insertions(+), 2 deletions(-)

diff --git a/lib/index.js b/lib/index.js
index 5d36102..a9bedb3 100644
--- a/lib/index.js
+++ b/lib/index.js
@@ -142,7 +142,13 @@ function requestSigner(options) {
 						user += '/users/' + subuser;
 				}
 				var keyId = '/' + user + '/keys/' + res.keyId;
-				res.keyId = keyId;
+				res = {
+				    algorithm: res.algorithm,
+				    keyId: keyId,
+				    signature: res.signature,
+				    user: user,
+				    subuser: subuser
+				};
 			}
 			cb(err, res);
 		});
diff --git a/package.json b/package.json
index 356354e..2956924 100644
--- a/package.json
+++ b/package.json
@@ -1,7 +1,7 @@
 {
     "name": "smartdc-auth",
     "description": "Joyent Authentication Library",
-    "version": "2.5.0",
+    "version": "2.5.1",
     "author": "Joyent (joyent.com)",
     "contributors": [
         "Mark Cavage",
-- 
2.21.0

