From 1a47cc5c9dfa607f73d59ff2a6a20bcc91b434f1 Mon Sep 17 00:00:00 2001
From: Marisa Emerson <mje@uq.edu.au>
Date: Fri, 12 Aug 2016 17:46:03 +1000
Subject: [PATCH] joyent/node-triton-tags#2 allow dns names to start with a
 number Reviewed by: Alex Wilson <alex.wilson@joyent.com>

---
 CHANGES.md            | 6 ++++++
 lib/cns-svc-tag.pegjs | 2 +-
 package.json          | 2 +-
 test/unit.test.js     | 5 +++++
 4 files changed, 13 insertions(+), 2 deletions(-)

diff --git a/CHANGES.md b/CHANGES.md
index 3656894..6e15e1b 100644
--- a/CHANGES.md
+++ b/CHANGES.md
@@ -1,5 +1,11 @@
 # node-triton-tags changelog
 
+## 1.1.3
+
+- joyent/node-triton-tags#2: allow DNS names to start with a number. Even
+  though this is not recommended by the DNS RFCs, in practice it is used
+  fairly commonly (including by a number of major websites)
+
 ## 1.1.2
 
 - CNS-153: Upper case in services tags stopped working (another unplanned
diff --git a/lib/cns-svc-tag.pegjs b/lib/cns-svc-tag.pegjs
index 09df8a5..83b5b2a 100644
--- a/lib/cns-svc-tag.pegjs
+++ b/lib/cns-svc-tag.pegjs
@@ -14,7 +14,7 @@ service = name:dnslabel port:(":" int)? props:(":" key "=" value)*
 	});
 	return (svc);
 }
-dnslabel "DNS name"		= [a-zA-Z] [a-zA-Z0-9-.]* {
+dnslabel "DNS name"		= [a-zA-Z0-9] [a-zA-Z0-9-.]* {
 	return (text().toLowerCase());
 }
 key "property name"		= [a-z] [a-z0-9-]* 	   { return (text()); }
diff --git a/package.json b/package.json
index 566600e..4db90f2 100644
--- a/package.json
+++ b/package.json
@@ -1,7 +1,7 @@
 {
   "name": "triton-tags",
   "description": "Triton tags parsing and validation",
-  "version": "1.1.2",
+  "version": "1.1.3",
   "author": "Joyent (joyent.com)",
   "dependencies": {
     "assert-plus": "^1.0.0"
diff --git a/test/unit.test.js b/test/unit.test.js
index e76026f..c66aa65 100644
--- a/test/unit.test.js
+++ b/test/unit.test.js
@@ -176,6 +176,11 @@ var cases = [
         key: 'triton.cns.services',
         str: 'foobar:priority=aaaaaaa',
         err: /must be within the range 0 - 65535/
+    },
+    {
+        key: 'triton.cns.services',
+        str: '5foobar',
+        val: '5foobar'
     }
 
     // TODO: triton.cns.reverse_ptr
-- 
2.21.0

