{"project":"joyent/illumos-joyent","branch":"master","id":"I285d665c1bfb19b7a0d31074cbb554aae649ca56","number":"6207","subject":"OS-7014 Add libtopo support for Upgradable Firmware Modules OS-7026 Add DDI support for Upgradable Firmware Modules Reviewed by: Robert Mustacchi \u003crobert.mustacchi@joyent.com\u003e Reviewed by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e Approved by: Jerry Jeli","owner":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"url":"https://cr.joyent.us/6207","commitMessage":"OS-7014 Add libtopo support for Upgradable Firmware Modules\nOS-7026 Add DDI support for Upgradable Firmware Modules\nReviewed by: Robert Mustacchi \u003crobert.mustacchi@joyent.com\u003e\nReviewed by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e\nApproved by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e\n","createdOn":1557266290,"lastUpdated":1560987719,"open":false,"status":"MERGED","comments":[{"timestamp":1557266290,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Uploaded patch set 1."},{"timestamp":1557414913,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 1:\n\n(125 comments)"},{"timestamp":1557870759,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Patch Set 1:\n\n(110 comments)\n\nI\u0027m still working through some of the man page comments.\n\nBut I have addressed all of the code comments, so I wanted to send this back to you to look at it as I\u0027ve some significant changes - hopefully for the better ;)"},{"timestamp":1557870841,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Uploaded patch set 2."},{"timestamp":1557963894,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 2:\n\n(34 comments)\n\nThanks for all the clean up. I didn\u0027t look over any of the updated manual pages per your note."},{"timestamp":1559596997,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Uploaded patch set 3."},{"timestamp":1559597157,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Patch Set 3:\n\n(29 comments)\n\nOk - this patch set addresses your most recent comments as well as your earlier comments on the man pages.  It also includes some new stuff related to testing:\n- new ufmtest driver\n- new automated tests under usr/src/test\n\nThere are also some minor tweaks based on bugs/shortcomings encountered while working on the tests."},{"timestamp":1559672822,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 3:\n\n(46 comments)"},{"timestamp":1559854112,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Uploaded patch set 4."},{"timestamp":1559854176,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Patch Set 4:\n\n(41 comments)"},{"timestamp":1559951170,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 2:\n\n(17 comments)"},{"timestamp":1560276821,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Uploaded patch set 5."},{"timestamp":1560277189,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Patch Set 5:\n\n(13 comments)\n\nI hadn\u0027t done a debug build in a while, so  I did that and found a small issues.\n\nSo, in addition to addressing your latest comments, there are some fixes to address some compiler warnings (mostly unused arguments) and a fix to ddi_ufm.c to address a kernel memory leak in ufm_cache_fill().\n\nWith these changes, we are leak-free and warning free.  I also verified that there were no smatch warnings."},{"timestamp":1560291513,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 5:\n\nIn general this looks good. It\u0027s not clear if we\u0027re going to address that a rem_drv basically doesn\u0027t clean up trailing ufm references or not and that once created they\u0027re basically leaked forever, which seems problematic. I\u0027ve given it a +1 CR for now, though it\u0027d be good if we did clean up that issue."},{"timestamp":1560293154,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 5: Code-Review+1"},{"timestamp":1560299638,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Uploaded patch set 6."},{"timestamp":1560299761,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Patch Set 6:\n\nThis patchset is just a rebase - but there were conflicts in two files - both just conflicts over the copyright change.  So gerrit cleared your +1."},{"timestamp":1560364768,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 6: Code-Review+1"},{"timestamp":1560379536,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 6:\n\n(16 comments)"},{"timestamp":1560392484,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Uploaded patch set 7."},{"timestamp":1560396774,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Patch Set 7:\n\n(15 comments)\n\nThanks again for looking at this!"},{"timestamp":1560434978,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 7:\n\n(7 comments)"},{"timestamp":1560444228,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 6:\n\n(1 comment)"},{"timestamp":1560449581,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Uploaded patch set 8."},{"timestamp":1560449631,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Patch Set 8:\n\n(7 comments)"},{"timestamp":1560449955,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 6:\n\n(1 comment)"},{"timestamp":1560451913,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Uploaded patch set 9."},{"timestamp":1560452012,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Patch Set 9:\n\n(1 comment)"},{"timestamp":1560452963,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 9: Code-Review+1"},{"timestamp":1560461797,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 9:\n\n(1 comment)"},{"timestamp":1560465462,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Uploaded patch set 10."},{"timestamp":1560465519,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Patch Set 10:\n\n(1 comment)"},{"timestamp":1560465786,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 10: Code-Review+1"},{"timestamp":1560525590,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 10: Code-Review+1"},{"timestamp":1560793604,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 10: Integration-Approval+1"},{"timestamp":1560799026,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Uploaded patch set 11."},{"timestamp":1560799156,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Patch Set 11:\n\nThere was a merge conflict due to copyright change in libtopo.h when I rebased, so gerrit dropped the +1\u0027s."},{"timestamp":1560799266,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Uploaded patch set 12: Commit message was updated."},{"timestamp":1560804673,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 12: Code-Review+1"},{"timestamp":1560808046,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 12: Code-Review+1"},{"timestamp":1560808283,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 12: Integration-Approval+1"},{"timestamp":1560881550,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Uploaded patch set 13: Patch Set 12 was rebased."},{"timestamp":1560965140,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Uploaded patch set 14."},{"timestamp":1560965185,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Patch Set 14:\n\none line change to ufm-test.c to address a GCC7 warning"},{"timestamp":1560965495,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 14: Code-Review+1"},{"timestamp":1560968335,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 14: Code-Review+1"},{"timestamp":1560973184,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 14: Integration-Approval+1"},{"timestamp":1560987524,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Uploaded patch set 15: Patch Set 14 was rebased."},{"timestamp":1560987719,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Rob Johnston"}],"currentPatchSet":{"number":"15","revision":"285d665c1bfb19b7a0d31074cbb554aae649ca56","parents":["bc37b38f8fdf93069034adc55ecc3fae8f6fd639"],"ref":"refs/changes/07/6207/15","uploader":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"createdOn":1560987524,"author":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1560965495,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1560968335,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1560973184,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"SUBM","value":"1","grantedOn":1560987719,"by":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":21,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/hc.c","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/libtopo.h","type":"MODIFIED","insertions":26,"deletions":-1},{"file":"usr/src/lib/fm/topo/libtopo/common/mapfile-vers","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_hc.h","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_mod.c","type":"MODIFIED","insertions":223,"deletions":-1},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_mod.h","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_mod.map","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/lib/fm/topo/modules/common/disk/disk_common.c","type":"MODIFIED","insertions":20,"deletions":0},{"file":"usr/src/lib/fm/topo/modules/common/ipmi/ipmi_enum.c","type":"MODIFIED","insertions":15,"deletions":-1},{"file":"usr/src/lib/fm/topo/modules/common/pcibus/pcibus.c","type":"MODIFIED","insertions":200,"deletions":-1},{"file":"usr/src/lib/fm/topo/modules/common/smbios/smbios_enum.c","type":"MODIFIED","insertions":39,"deletions":-12},{"file":"usr/src/man/man7d/Makefile","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/man/man7d/ufm.7d","type":"ADDED","insertions":206,"deletions":0},{"file":"usr/src/man/man9e/Makefile","type":"MODIFIED","insertions":11,"deletions":-2},{"file":"usr/src/man/man9e/ddi_ufm.9e","type":"ADDED","insertions":420,"deletions":0},{"file":"usr/src/man/man9f/Makefile","type":"MODIFIED","insertions":21,"deletions":-1},{"file":"usr/src/man/man9f/ddi_ufm.9f","type":"ADDED","insertions":162,"deletions":0},{"file":"usr/src/man/man9f/ddi_ufm_image.9f","type":"ADDED","insertions":101,"deletions":0},{"file":"usr/src/man/man9f/ddi_ufm_slot.9f","type":"ADDED","insertions":111,"deletions":0},{"file":"usr/src/test/os-tests/tests/Makefile","type":"MODIFIED","insertions":15,"deletions":-3},{"file":"usr/src/test/os-tests/tests/ddi_ufm/Makefile","type":"ADDED","insertions":51,"deletions":0},{"file":"usr/src/test/os-tests/tests/ddi_ufm/ufm-test.c","type":"ADDED","insertions":897,"deletions":0},{"file":"usr/src/uts/common/Makefile.files","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/common/io/i40e/i40e_main.c","type":"MODIFIED","insertions":94,"deletions":-4},{"file":"usr/src/uts/common/io/i40e/i40e_sw.h","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/mpt_sas/mptsas.c","type":"MODIFIED","insertions":77,"deletions":-2},{"file":"usr/src/uts/common/io/ufm.c","type":"ADDED","insertions":486,"deletions":0},{"file":"usr/src/uts/common/io/ufm.conf","type":"ADDED","insertions":16,"deletions":0},{"file":"usr/src/uts/common/io/ufmtest.c","type":"ADDED","insertions":438,"deletions":0},{"file":"usr/src/uts/common/io/ufmtest.conf","type":"ADDED","insertions":16,"deletions":0},{"file":"usr/src/uts/common/io/ufmtest.h","type":"ADDED","insertions":75,"deletions":0},{"file":"usr/src/uts/common/mapfiles/ddi.mapfile","type":"MODIFIED","insertions":14,"deletions":-1},{"file":"usr/src/uts/common/os/autoconf.c","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/uts/common/os/ddi_ufm.c","type":"ADDED","insertions":452,"deletions":0},{"file":"usr/src/uts/common/sys/Makefile","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/common/sys/ddi_ufm.h","type":"ADDED","insertions":224,"deletions":0},{"file":"usr/src/uts/common/sys/ddi_ufm_impl.h","type":"ADDED","insertions":87,"deletions":0},{"file":"usr/src/uts/common/sys/scsi/adapters/mpt_sas/mptsas_var.h","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"usr/src/uts/intel/Makefile.intel","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/uts/intel/ufm/Makefile","type":"ADDED","insertions":48,"deletions":0},{"file":"usr/src/uts/intel/ufmtest/Makefile","type":"ADDED","insertions":48,"deletions":0},{"file":"usr/src/uts/sparc/Makefile.sparc","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/sparc/ufm/Makefile","type":"ADDED","insertions":48,"deletions":0},{"file":"usr/src/uts/sparc/ufmtest/Makefile","type":"ADDED","insertions":48,"deletions":0}],"sizeInsertions":4755,"sizeDeletions":-33},"patchSets":[{"number":"1","revision":"cf5518703ff707de275d4b1616747180827703cc","parents":["ccfe2703aae7d898d162354279974ba639cc9cd2"],"ref":"refs/changes/07/6207/1","uploader":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"createdOn":1557266290,"author":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/lib/fm/topo/libtopo/common/libtopo.h","line":1027,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"This feels like we\u0027re missing things. Certainly the slot can just be writeable (like a disk) and we may be able to get the version, but not be able to read or write it at all."},{"file":"usr/src/lib/fm/topo/libtopo/common/libtopo.h","line":1027,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Yep.  Per our conversation, I fleshed this out and also added a comment to make it more clear what these permissions indicate."},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_mod.c","line":1054,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Would you mind putting braces around all of these multi-line if blocks?"},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_mod.c","line":1054,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_mod.c","line":1073,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Should we really be breaking here or should we be doing a continue to make sure that if other values are there we get them all?"},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_mod.c","line":1073,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Makes sense.  Fixed."},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_mod.c","line":1077,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"If this fails, don\u0027t we need to set err to rc because rc is a positive errno here and not -1? Also, I don\u0027t think it matters because of how we\u0027ve been checking rc, but everything else is returning -1 while this is returning a positive value, so if this gets refactored, rc could get misadjusted."},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_mod.c","line":1077,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Yeah, I wasn\u0027t thinking that a lot of the libnvpair functions return errno instead of -1.   I changed this case from +\u003d to -\u003d."},{"file":"usr/src/lib/fm/topo/modules/common/disk/disk_common.c","line":315,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I guess we want to claim that we can write to all disk\u0027s firmware? I\u0027m not sure this is actually universally true. For example, how a USB device which doesn\u0027t have any of the SCSI commands for setting firmware, really can\u0027t be updated.\n\nNote, we can\u0027t actually read a disk\u0027s firmware image, so it feels like the only thing we can say is that the slot is writeable, not that it\u0027s readable."},{"file":"usr/src/lib/fm/topo/modules/common/disk/disk_common.c","line":315,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"I hadn\u0027t considered USB storage devics, but should have.  Seems like the most sane default is to set it to TOPO_UFM_SLOT_MODE_WO for non-USB disks and TOPO_UFM_SLOT_MODE_NONE for USB disks - which is what I\u0027ve changed the code to do for now."},{"file":"usr/src/lib/fm/topo/modules/common/disk/disk_common.c","line":315,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"OK. Eventually we\u0027ll probably want to drive this from something else, but for now it seems reasonable. We do know that most NVMe, SATA, and SAS should be flashable."},{"file":"usr/src/lib/fm/topo/modules/common/ipmi/ipmi_enum.c","line":585,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"What method can we guarantee that we can write the firmware of the service processor? How do we read the firmware? I feel like until we actually can support doing so, we shouldn\u0027t claim that the slot is readable or writeable."},{"file":"usr/src/lib/fm/topo/modules/common/ipmi/ipmi_enum.c","line":585,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Yep, misunderstanding.  Fixed."},{"file":"usr/src/lib/fm/topo/modules/common/ipmi/ipmi_enum.c","line":587,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Does the IPMI spec usually refer to the \u0027Management Controller\u0027 as the LOM?"},{"file":"usr/src/lib/fm/topo/modules/common/ipmi/ipmi_enum.c","line":587,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"No.  The spec uses the term bmc.  Other sources use the terms bmc and serivce processor interchangeably.  There doesn\u0027t seem to be a standard term for software that runs on the bmc.  The spec simpluy refers to it as the bmc firmware and that the firmware implements various logical devices, which in turn implement various portions of the IPMI spec.  Not sure what description is best here.  I\u0027ve changed it to \"Baseboard Management Controller firmware\", but if you can think of anything better, I\u0027m happy to change it."},{"file":"usr/src/lib/fm/topo/modules/common/pcibus/pcibus.c","line":196,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Is strncpy what we want to use here? If for some reason the devpath is equal to MAXPATHLEN in size, then won\u0027t we end up without a null terminated path in the ufm ioctl? It feels like we should use strlcpy and verify that we don\u0027t exceed the size of the ufmg_devpath and if so, error."},{"file":"usr/src/lib/fm/topo/modules/common/pcibus/pcibus.c","line":196,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Yes, good call.  Fixed."},{"file":"usr/src/lib/fm/topo/modules/common/pcibus/pcibus.c","line":204,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Since this is a flag, probably an explicit !\u003d 0? Otherwise, nixt the space."},{"file":"usr/src/lib/fm/topo/modules/common/pcibus/pcibus.c","line":204,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/lib/fm/topo/modules/common/pcibus/pcibus.c","line":219,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"See earlier notes on strncpy."},{"file":"usr/src/lib/fm/topo/modules/common/pcibus/pcibus.c","line":219,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/lib/fm/topo/modules/common/pcibus/pcibus.c","line":247,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"While the kernel shouldn\u0027t change these pointers, should we consider using a local value just in case?"},{"file":"usr/src/lib/fm/topo/modules/common/pcibus/pcibus.c","line":247,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"I think it\u0027s fine how it is."},{"file":"usr/src/lib/fm/topo/modules/common/pcibus/pcibus.c","line":314,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"So, isn\u0027t the UFM ATTR readable supposed to indicate whether or not we can read the firmware image? If so, why are we assuming that we can? I feel like for a number of devices, like a disk, for example, it\u0027s not readable and it\u0027s only writeable."},{"file":"usr/src/lib/fm/topo/modules/common/pcibus/pcibus.c","line":314,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Yep, misunderstood the ATTR stuff.  Fixed."},{"file":"usr/src/lib/fm/topo/modules/common/smbios/smbios_enum.c","line":534,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Is it worth keeping the old properties around for folks?"},{"file":"usr/src/lib/fm/topo/modules/common/smbios/smbios_enum.c","line":534,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"I think it\u0027s fine to get rid of these.  I really doubt anyone is consuming them, outside of hwgrok - which I\u0027ll fix up."},{"file":"usr/src/lib/fm/topo/modules/common/smbios/smbios_enum.c","line":540,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I think that for us, most BIOSes should be set to be neither readable or writeable, until we have tools that we can use to update it. Alternatively, we could say it is writeable, since we know external tools can write to it."},{"file":"usr/src/lib/fm/topo/modules/common/smbios/smbios_enum.c","line":540,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/lib/fm/topo/modules/common/smbios/smbios_enum.c","line":564,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Why do we care about the failure of the range, but not the failure here?"},{"file":"usr/src/lib/fm/topo/modules/common/smbios/smbios_enum.c","line":564,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Because at point we\u0027d execute the same code as if we did a \"goto err\".  Though I did spot a case above wjhere we\u0027d leak the \"extra\" nvlist on failure, so I fixed that."},{"file":"usr/src/man/man7d/ufm.7d","line":0,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Since this is an entirely new manual, we should really be writing it mdoc, and not in roff. I can help rewrite that if that\u0027s helpful. I haven\u0027t gone through the content here yet."},{"file":"usr/src/man/man7d/ufm.7d","line":20,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Probably should also indicate #include \u003csys/ddi_ufm.h\u003e in the synopsis."},{"file":"usr/src/man/man7d/ufm.7d","line":20,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/man/man7d/ufm.7d","line":26,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"9E"},{"file":"usr/src/man/man7d/ufm.7d","line":26,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/man/man7d/ufm.7d","line":27,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I would probably replicate some of the general description about them here to explain what they are. The fact that they\u0027re optional. The fact that a device driver may implement this or not."},{"file":"usr/src/man/man7d/ufm.7d","line":55,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"If there\u0027s nothing for a user to configure, is it worth mentioning?"},{"file":"usr/src/man/man7d/ufm.7d","line":55,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Good point - removed."},{"file":"usr/src/man/man7d/ufm.7d","line":63,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"We should clarify that the DDI_UFM_VERSION_ONE is meant to describe the ioctl structure, so these things can change or have additions without necessarily revving the version, I think?"},{"file":"usr/src/man/man7d/ufm.7d","line":74,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Trailing white space."},{"file":"usr/src/man/man7d/ufm.7d","line":74,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I think it\u0027s worth clarifying that these can change even if we don\u0027t rev the version. The version is about the ioctl structure."},{"file":"usr/src/man/man7d/ufm.7d","line":198,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"As part of the introduction to the errors, we should indicate that these are common errors and may not be entirely complete and that any of the errors mentioned in intro(2) may be returned."},{"file":"usr/src/man/man7d/ufm.7d","line":201,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"ENOTSUP?"},{"file":"usr/src/man/man7d/ufm.7d","line":201,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/man/man7d/ufm.7d","line":213,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"while?"},{"file":"usr/src/man/man7d/ufm.7d","line":213,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"s/from to/from"},{"file":"usr/src/man/man7d/ufm.7d","line":213,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"ufm"},{"file":"usr/src/man/man7d/ufm.7d","line":213,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/man/man7d/ufm.7d","line":230,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Should ENOTTY be listed here?"},{"file":"usr/src/man/man7d/ufm.7d","line":241,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I think this probably wants to start as a more private interface for us and we can open it up as we use it a bit more and add more drivers and support there."},{"file":"usr/src/man/man9e/ddi_ufm.9e","line":12,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"pbchk will probably compaliain about the format."},{"file":"usr/src/man/man9e/ddi_ufm.9e","line":12,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/man/man9e/ddi_ufm.9e","line":53,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"extra space?"},{"file":"usr/src/man/man9e/ddi_ufm.9e","line":53,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/man/man9e/ddi_ufm.9e","line":56,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"extra space?"},{"file":"usr/src/man/man9e/ddi_ufm.9e","line":56,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/man/man9e/ddi_ufm.9e","line":59,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Should be:\n\n.It Fa nimgp"},{"file":"usr/src/man/man9e/ddi_ufm.9e","line":59,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/man/man9e/ddi_ufm.9e","line":61,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Should be:\n\n.It Fa nslotp"},{"file":"usr/src/man/man9e/ddi_ufm.9e","line":61,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/man/man9e/ddi_ufm.9e","line":82,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"maybe it should be \u0027is\u0027 and not \u0027contains\u0027?"},{"file":"usr/src/man/man9e/ddi_ufm.9e","line":82,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/man/man9e/ddi_ufm.9e","line":83,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"which can be?"},{"file":"usr/src/man/man9e/ddi_ufm.9e","line":83,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/man/man9e/ddi_ufm.9e","line":120,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"This should be on the start of its own line as:\n\n.Em active\nslot."},{"file":"usr/src/man/man9e/ddi_ufm.9e","line":120,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/man/man9e/ddi_ufm.9e","line":159,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Needs to be on its own line as:\n\n.Fn ddi_ufm_op_nimages\nentry point"},{"file":"usr/src/man/man9e/ddi_ufm.9e","line":159,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/man/man9e/ddi_ufm.9e","line":290,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Because we folded ACTIVE in with the above attributes, we should probably document it here and talk about the primary slot and how to mark it with that now instead."},{"file":"usr/src/man/man9e/ddi_ufm.9e","line":299,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"It looks like there is no ddi_ufm_set_primary(), so we probably should remove this."},{"file":"usr/src/man/man9e/ddi_ufm.9e","line":299,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/man/man9e/ddi_ufm.9e","line":325,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Trailing white space"},{"file":"usr/src/man/man9e/ddi_ufm.9e","line":325,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/man/man9e/ddi_ufm.9e","line":353,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"This needs to be a proper cross reference as:\n\n.Xr ufm 7D"},{"file":"usr/src/man/man9e/ddi_ufm.9e","line":353,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/man/man9e/ddi_ufm.9e","line":360,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Need a .Xr ufm 7D"},{"file":"usr/src/man/man9e/ddi_ufm.9e","line":360,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/man/man9f/ddi_ufm_image.9f","line":60,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"description"},{"file":"usr/src/man/man9f/ddi_ufm_image.9f","line":60,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/man/man9f/ddi_ufm_slot.9f","line":92,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"We should use a .Vt for the type ddi_ufm_attr_t.\n\nWe should also mention where that\u0027s defined, otherwise someone\u0027s going to go searching for it. Especially as the primary nature of something isn\u0027t an attribute here."},{"file":"usr/src/man/man9f/ddi_ufm_slot.9f","line":111,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"This needs to be filled in."},{"file":"usr/src/uts/common/io/i40e/i40e_main.c","line":3227,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"The ddi_ufm(9E) manual still says that all of these should return 0 and not DDI_SUCCESS. I know they\u0027re an alias, but I don\u0027t think we should match DDI_SUCCESS in here."},{"file":"usr/src/uts/common/io/i40e/i40e_main.c","line":3227,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/uts/common/io/i40e/i40e_main.c","line":3235,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Don\u0027t all of these need to be initialized to NULL otherwise if say we fail after the first ddi_prop_lookup_string() these\u0027ll be garbage and we might free an uninitialized pointer."},{"file":"usr/src/uts/common/io/i40e/i40e_main.c","line":3235,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Doh!  Fixed."},{"file":"usr/src/uts/common/io/scsi/adapters/mpt_sas/mptsas.c","line":1263,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Was this supposed to have a goto fail?"},{"file":"usr/src/uts/common/io/scsi/adapters/mpt_sas/mptsas.c","line":1263,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/uts/common/io/scsi/adapters/mpt_sas/mptsas.c","line":1567,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"So, given that we\u0027re not doing any checking of state in attach, shouldn\u0027t we verify that this is valid before calling ddi_ufm_update()?"},{"file":"usr/src/uts/common/io/scsi/adapters/mpt_sas/mptsas.c","line":1567,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Per your ealier comment, I added the missing \"goto fail\" if the ddi_ufm_init call fails, so if we make it this far then the handle should be valid."},{"file":"usr/src/uts/common/io/scsi/adapters/mpt_sas/mptsas.c","line":17020,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I guess this is kind of an API question, but should we have things return 0 on success so we don\u0027t have a mix of DDI_ operands and errnos?"},{"file":"usr/src/uts/common/io/scsi/adapters/mpt_sas/mptsas.c","line":17020,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Yes, fixed."},{"file":"usr/src/uts/common/io/scsi/adapters/mpt_sas/mptsas.c","line":17035,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"We can\u0027t read or write this today. So I\u0027m not sure it\u0027s appropriate for us to set the readable or writeable flags."},{"file":"usr/src/uts/common/io/scsi/adapters/mpt_sas/mptsas.c","line":17035,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/uts/common/io/ufm.c","line":29,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Should we remove the XXX now?"},{"file":"usr/src/uts/common/io/ufm.c","line":29,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/uts/common/io/ufm.c","line":52,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"If you don\u0027t mind, can we use the C99 initializers for this?"},{"file":"usr/src/uts/common/io/ufm.c","line":52,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/uts/common/io/ufm.c","line":71,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Should we put quiesce not needed here instead?"},{"file":"usr/src/uts/common/io/ufm.c","line":71,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/uts/common/io/ufm.c","line":72,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"If you don\u0027t mind, can we use the C99 initializers for this?"},{"file":"usr/src/uts/common/io/ufm.c","line":72,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/uts/common/io/ufm.c","line":80,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I would avoid compacting these and either use the c99 initializers or put one value per line."},{"file":"usr/src/uts/common/io/ufm.c","line":80,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/uts/common/io/ufm.c","line":101,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"If you want, these can be conslidated into just a single return (mod_install(..)); or return (mod_remove(...));"},{"file":"usr/src/uts/common/io/ufm.c","line":101,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"True - done."},{"file":"usr/src/uts/common/io/ufm.c","line":118,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"So, I suspect we should cast this through a uintptr_t like this:\n\n*result \u003d (void *)(uintptr_t)0;"},{"file":"usr/src/uts/common/io/ufm.c","line":118,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Is that to avoid some sort of comparison error on gcc 7/8?"},{"file":"usr/src/uts/common/io/ufm.c","line":118,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"This is a general thing. We want to assign the instance int 0, which is not the same as the pointer zero."},{"file":"usr/src/uts/common/io/ufm.c","line":128,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"This should probably just return success for DDI_RESUME."},{"file":"usr/src/uts/common/io/ufm.c","line":128,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"My understanding (from skimming the WDD) was that I didn\u0027t need to worry about DDI_SUSPEND/DDI_RESUME because my driver doesn\u0027t have a regs property or a pm-hardware-state property."},{"file":"usr/src/uts/common/io/ufm.c","line":128,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Fair enough, I missed that in detach(9E)."},{"file":"usr/src/uts/common/io/ufm.c","line":129,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"We should sanity check that ufm_devi is NULL before proceeding to ensure that a second instance doesn\u0027t show up."},{"file":"usr/src/uts/common/io/ufm.c","line":129,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/uts/common/io/ufm.c","line":144,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"This needs to return success for DDI_SUSPEND."},{"file":"usr/src/uts/common/io/ufm.c","line":144,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"See earlier comment"},{"file":"usr/src/uts/common/io/ufm.c","line":145,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"We should sanity check that ufm_devi is non-NULL before proceeding."},{"file":"usr/src/uts/common/io/ufm.c","line":145,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/uts/common/io/ufm.c","line":162,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"So, we definitely should be checking things here. While I can understand maybe we don\u0027t care about the credential. We should verify that otyp is actually OTYP_CHR and not OTYP_BLK. We also should look at flag and not just honor it arbitrarily. If someone asks for something like FEXCL, FNDELAY or doesn\u0027t ask for read access we should return an error.\n\nWe may want to consider that a privilege should be required to read this information for the time being like PRIV_DEVICES."},{"file":"usr/src/uts/common/io/ufm.c","line":162,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Thanks.  I added code to open(9E) check otyp, flag and cred_p.  Should I be doing something in close(9E)?"},{"file":"usr/src/uts/common/io/ufm.c","line":162,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I\u0027m not sure there\u0027s too much we need to do in close(9E). Sometimes in paranoia I check it, but not always."},{"file":"usr/src/uts/common/io/ufm.c","line":171,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I don\u0027t think you want this mutex_exit() here. Right now all callers are also doing so when this fails which will result in a double exit. We should make sure we execute this path."},{"file":"usr/src/uts/common/io/ufm.c","line":171,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Yep, fixed."},{"file":"usr/src/uts/common/io/ufm.c","line":186,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Needs to be a uint_t, nimages is unsigned."},{"file":"usr/src/uts/common/io/ufm.c","line":186,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/uts/common/io/ufm.c","line":189,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Because we\u0027re using kmem_sleep, should these all be fnvlist_* family of functions?"},{"file":"usr/src/uts/common/io/ufm.c","line":189,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Very cool - I didn\u0027t even know these existed.  Updated."},{"file":"usr/src/uts/common/io/ufm.c","line":198,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Needs to be unsigned."},{"file":"usr/src/uts/common/io/ufm.c","line":198,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/uts/common/io/ufm.c","line":219,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Every time we generate this we then throw it away. Why is that? Seems like we\u0027re doing a lot of churn that way. Shouldn\u0027t we cache this until we get an invalidate?\n\nMaybe the generation of the nvlist size and data should be part of the ufm module so it can be integrated with the invalidate path. Maybe we should actually have the ddi_ufm stuff just track all of this as an nvlist_t?"},{"file":"usr/src/uts/common/io/ufm.c","line":219,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"I\u0027ve reworked this code and ufm_cache_fill() significantly to avoid re-constructing the nvlist.  I think the new implementation should be simpler and more time-efficient."},{"file":"usr/src/uts/common/io/ufm.c","line":245,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"This will be a lot easier to read and understand if you make each actual ioctl into its own function. I think the 200+ line switch statement doesn\u0027t help anything here."},{"file":"usr/src/uts/common/io/ufm.c","line":245,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Agreed.  I\u0027ve refactored the code accordingly."},{"file":"usr/src/uts/common/io/ufm.c","line":250,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"So the way this is written, an unprivileged user like nobody can do an ioctl and trick you into trying to attach a driver again. Maybe we should make sure this is privileged."},{"file":"usr/src/uts/common/io/ufm.c","line":250,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/uts/common/io/ufm.c","line":252,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Maybe ENOENT?"},{"file":"usr/src/uts/common/io/ufm.c","line":252,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"ENOTUP makes more sense to me.  If it\u0027s not in the tree then the driver doesn\u0027t support UFM.\n\nAlthough I guess you can argue that this isn\u0027t always true - i.e. maybe the driver hasn\u0027t loaded for the first time, yet.  I dunno - kinda six of one, half dozen of the other ;)\n\nIf you really prefer ENOENT, I can change it."},{"file":"usr/src/uts/common/io/ufm.c","line":254,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Please do not pass a user buffer directly to this. You have zero guarantees that it\u0027s a well formed string or even null-terminated."},{"file":"usr/src/uts/common/io/ufm.c","line":254,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"I changed this code (and similar instances for the other ioctls) to strlcpy the user-supplied char[] to a new char[]."},{"file":"usr/src/uts/common/io/ufm.c","line":260,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"extraneous space?"},{"file":"usr/src/uts/common/io/ufm.c","line":260,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/uts/common/io/ufm.c","line":266,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Shouldn\u0027t this be an equality check since if it\u0027s actually a different version then we\u0027ll need to adapt the structure?\n\nThough this raises the question of should the user and kernel version be the same."},{"file":"usr/src/uts/common/io/ufm.c","line":266,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Yeah, changed it to an equal.  I\u0027ve kinda thought of the version as really only applying to the ioctl interface rather than to the DDI UFM interface.  I think we can extend the DDI interface in a way that remains backward compatible."},{"file":"usr/src/uts/common/io/ufm.c","line":266,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Yeah, I think we should really think of them as two separate things and probably not even do the comparison between them. The point of having the version there is so if we do need to rev it in a backwards incompat way we can in the kernel. I\u0027m not sure we want to say we should remove the version argument from ddi_ufm_register()."},{"file":"usr/src/uts/common/io/ufm.c","line":298,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Blind strcpy is dangerous, a hostile user will not give you a null terminated path. We should definitely use strlcpy() here, but we also need to make sure we have a valid, null-terminated string. Someone may be trying to throw illegal characters at us. We may want to check what we\u0027re passing here."},{"file":"usr/src/uts/common/io/ufm.c","line":298,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/uts/common/io/ufm.c","line":308,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"See earlier notes."},{"file":"usr/src/uts/common/io/ufm.c","line":308,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/uts/common/io/ufm.c","line":318,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"See earlier notes"},{"file":"usr/src/uts/common/io/ufm.c","line":318,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/uts/common/io/ufm.c","line":324,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"See earlier notes"},{"file":"usr/src/uts/common/io/ufm.c","line":324,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/uts/common/io/ufm.c","line":355,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"See other notes, but it seems a waste to just throw this out."},{"file":"usr/src/uts/common/io/ufm.c","line":355,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"This has all been reworked."},{"file":"usr/src/uts/common/io/ufm.c","line":376,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"What happens when something changes between the user asking the size and the actual report ioctl. Is there any way to actually handle that?"},{"file":"usr/src/uts/common/io/ufm.c","line":376,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"At a minimum, I think we\u0027ll handle it safely.  If something changes that causes the packed report to change after calling UFM_IOC_REPORTSZ, then UFM_IOC_REPORT will fail with EOVERFLOW.  (Note that I changed the size check in ufm_do_report() to check that the user-supplied buffer size to check for equality rather than \u003c)"},{"file":"usr/src/uts/common/io/ufm.c","line":384,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"See notes about strcpy."},{"file":"usr/src/uts/common/io/ufm.c","line":384,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/uts/common/io/ufm.c","line":396,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"See earlier notes."},{"file":"usr/src/uts/common/io/ufm.c","line":396,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/uts/common/io/ufm.c","line":406,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"See earlier notes."},{"file":"usr/src/uts/common/io/ufm.c","line":406,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/uts/common/io/ufm.c","line":412,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"See earlier notes."},{"file":"usr/src/uts/common/io/ufm.c","line":412,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/uts/common/io/ufm.c","line":446,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"EOVERFLOW feels a little more appropriate for some reason."},{"file":"usr/src/uts/common/io/ufm.c","line":446,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/uts/common/io/ufm.c","line":449,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"KM_NORMALPRI?"},{"file":"usr/src/uts/common/io/ufm.c","line":449,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/uts/common/io/ufm.c","line":476,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"This should be done before the above copyouts as right now you\u0027re leaking this when they return EFAULT."},{"file":"usr/src/uts/common/io/ufm.c","line":476,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/uts/common/io/ufm.c","line":479,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Correct errno for an unknown ioctl is ENOTTY."},{"file":"usr/src/uts/common/io/ufm.c","line":479,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/uts/common/io/ufm.conf","line":16,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Should we put a ddi-forceattach attribute here or do you think that\u0027s unnecessary?"},{"file":"usr/src/uts/common/io/ufm.conf","line":16,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"I think we\u0027re ok not doing a force attach."},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":25,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Based on reading the code, the way that the ufm driver knows that the cache is valid is based on the fact that the images array is filled in. In other words, the images array on the handle should always be 100% valid or it shouldn\u0027t exist. We should probably document that here. And also clarify that the fact that the number of images can be filled in without anything else being specified."},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":25,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"I\u0027ve reworked the caching logic.  We now also cache the final nvlist report and that is the thing we now check for to determine if the cache is valid."},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":33,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"track and provide?"},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":33,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":36,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I would mention that this is when the driver calls these."},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":36,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":44,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"must?"},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":44,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":52,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Can you add just a little bit more to this sentence?"},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":52,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":72,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"nimages is unsigned"},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":72,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":78,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"nslots is unsigned"},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":78,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":80,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Are we missing an nvlist_free of the ufms_misc here?"},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":80,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Yes!  Good catch!  Fixed."},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":86,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Missing nvlist_free of ufmi_misc?"},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":86,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":97,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Please see the notes about using DDI_SUCCESS or not elsewhere in the review. I don\u0027t think we should overload it here."},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":97,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Yes - I changed all the places to check for !\u003d 0 instead."},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":115,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"This XXX should be dealt with."},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":115,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":141,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Should this also be NORMALPRI?"},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":141,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Yeah, I think so.  Done."},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":145,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"ufmh_nimages is a uint_t, this is signed."},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":145,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":164,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"ufmi_nslots is a uint_t, this is signed."},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":164,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":174,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Why are a non-zero attrs required? This seems wrong. For example, when I add support for reading the ME\u0027s firmware, we can neither read nor write its image, so it\u0027s attributes will probably be zero. I know that there is an expectation that something will be marked as primary now that it\u0027s an attribute there, but not sure what else we should do."},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":174,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Fair point.  And in the case where we have multiple slots and not neither readable or writeable then only one slot will be active and so the others would have attrs set to 0.  I\u0027ve removed this condition from the assert."},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":200,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Shouldn\u0027t these be const since the original pointers are?"},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":200,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":236,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Shouldn\u0027t we enter the mutex here before we drop the ufm_lock based on the lock ordering discussion? Otherwise a driver can come in and call ddi_ufm_fini()."},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":236,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Yikes - I\u0027m violating my own lock ordering rules.  Fixed."},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":248,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Why are these asserts? Shouldn\u0027t they actually just be checks we perform? We should consider doing a dev_err(9F) to the system log to notify about these."},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":248,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"I\u0027ve changed all these to VERIFY"},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":250,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Shouldn\u0027t this be !\u003d as this is version 1. A version of zero would be invalid."},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":250,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":265,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Shouldn\u0027t we be checking that there\u0027s nothing with this path already in the avl tree before we add it?"},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":265,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"See response to the next questions, but i reworked the ddi_ufm_init/ddi_ufm_fini logic quite a bit."},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":280,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Shouldn\u0027t we always enter the handle\u0027s lock before we drop the ufm lock?"},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":280,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"See below - this code has been reworked."},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":287,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"A couple of questions:\n\n- Say the ufm driver looks this up. How do we know that it is done using this? Would that be because it has dropped the lock? However, in the current code there\u0027s a window between when it does a look up and when it takes the child lock, which means we could easily have the following order:\n\n* ufm_find does the avl_enter and drops ufm_lock\n* ddi_ufm_fini called and it goes through to the kmem_free\n* ufm_find then does mutex_enter on freed kernel memory\n\n- The second question is if ddi_ufm_fini removes the entry from the tree how does the finding it after detach case ever actually work? I was thinking we probably wanted to know it had ever registered with the UFM framework at a path and that\u0027s how we determine things. Though the current scheme may work, it just does a lot of additional potential driver loading and holding."},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":287,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"I reworked all of this.  See the new comments in ddi_ufm_init().  But in short, we no longer remove the handle from the avl tree during ddi_ufm_fini().   Instead, we just invalidate the cache and update the state\n\nThen during ddi_ufm_init(), we check if there\u0027s a handle from the previous registration."},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":308,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"You can just use ddi_strdup() which takes a const char * so you don\u0027t need the cast."},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":308,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":329,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"See note above."},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":329,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":336,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"So, should we check for valid attributes here? If a driver gives us garbage, we should probably warn or do something more drastic on debug. Maybe we should mask off invalid values?"},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":336,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Yep.  I extended the assert to also check that the attr value is not out of range."},{"file":"usr/src/uts/common/sys/ddi_ufm.h","line":26,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I suspect we should consider using a different set of headers for userland and the kernel. It\u0027s not clear to me that a user trying to build with these would ever need sys/cred.h or that they should use sys/dditypes.h. I\u0027d expect instead they\u0027d include nvpair.h and a sys/types.h or similar."},{"file":"usr/src/uts/common/sys/ddi_ufm.h","line":26,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/uts/common/sys/ddi_ufm.h","line":30,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Should we logically separate out the versions that are used for kernel and user contexts? I\u0027m not sure if they should be the same or not."},{"file":"usr/src/uts/common/sys/ddi_ufm.h","line":41,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Would we rev the version of the ioctl structure if we had new capabilities? I mean, it\u0027s fine to do so probably. Just not sure."},{"file":"usr/src/uts/common/sys/ddi_ufm.h","line":93,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Any particular reason we\u0027re using a char * rather than a void *?"},{"file":"usr/src/uts/common/sys/ddi_ufm.h","line":93,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"It seemed to be the convention that other drivers were using in there ioctl routines."},{"file":"usr/src/uts/common/sys/ddi_ufm.h","line":174,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"whenever"},{"file":"usr/src/uts/common/sys/ddi_ufm.h","line":174,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/uts/common/sys/ddi_ufm.h","line":181,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"should"},{"file":"usr/src/uts/common/sys/ddi_ufm.h","line":181,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/uts/common/sys/ddi_ufm_impl.h","line":68,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Optional thing, but it may be useful to annotate which state is basically based on the lifetime of the registration and which state is based on the lifetime of the validity of the data from the driver (as in invalidate will clear it)."},{"file":"usr/src/uts/common/sys/ddi_ufm_impl.h","line":68,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/uts/intel/Makefile.intel","line":359,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Should there be a SPARC version if we\u0027ve said that we\u0027re going to build this on SPARC in the manual page?"},{"file":"usr/src/uts/intel/Makefile.intel","line":359,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Yes, that was an oversight on my part.  Fixed."},{"file":"usr/src/uts/intel/ufm/Makefile","line":0,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Should there be a SPARC version if we\u0027ve said that we\u0027re going to build this on SPARC in the manual page so it\u0027s not DOA?"},{"file":"usr/src/uts/intel/ufm/Makefile","line":0,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Yes.  Oversight on my part.  Fixed."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":9,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/hc.c","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/libtopo.h","type":"MODIFIED","insertions":14,"deletions":-1},{"file":"usr/src/lib/fm/topo/libtopo/common/mapfile-vers","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_hc.h","type":"MODIFIED","insertions":10,"deletions":-2},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_mod.c","type":"MODIFIED","insertions":219,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_mod.h","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_mod.map","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/lib/fm/topo/modules/common/disk/disk_common.c","type":"MODIFIED","insertions":17,"deletions":0},{"file":"usr/src/lib/fm/topo/modules/common/ipmi/ipmi_enum.c","type":"MODIFIED","insertions":14,"deletions":-1},{"file":"usr/src/lib/fm/topo/modules/common/pcibus/pcibus.c","type":"MODIFIED","insertions":192,"deletions":-1},{"file":"usr/src/lib/fm/topo/modules/common/smbios/smbios_enum.c","type":"MODIFIED","insertions":38,"deletions":-12},{"file":"usr/src/man/man7d/Makefile","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/man/man7d/ufm.7d","type":"ADDED","insertions":247,"deletions":0},{"file":"usr/src/man/man9e/Makefile","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/man/man9e/ddi_ufm.9e","type":"ADDED","insertions":372,"deletions":0},{"file":"usr/src/man/man9f/Makefile","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"usr/src/man/man9f/ddi_ufm.9f","type":"ADDED","insertions":162,"deletions":0},{"file":"usr/src/man/man9f/ddi_ufm_image.9f","type":"ADDED","insertions":88,"deletions":0},{"file":"usr/src/man/man9f/ddi_ufm_slot.9f","type":"ADDED","insertions":111,"deletions":0},{"file":"usr/src/uts/common/Makefile.files","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/common/io/i40e/i40e_main.c","type":"MODIFIED","insertions":96,"deletions":-5},{"file":"usr/src/uts/common/io/i40e/i40e_sw.h","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/mpt_sas/mptsas.c","type":"MODIFIED","insertions":80,"deletions":-2},{"file":"usr/src/uts/common/io/ufm.c","type":"ADDED","insertions":483,"deletions":0},{"file":"usr/src/uts/common/io/ufm.conf","type":"ADDED","insertions":16,"deletions":0},{"file":"usr/src/uts/common/mapfiles/ddi.mapfile","type":"MODIFIED","insertions":14,"deletions":-1},{"file":"usr/src/uts/common/os/autoconf.c","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/uts/common/os/ddi_ufm.c","type":"ADDED","insertions":344,"deletions":0},{"file":"usr/src/uts/common/sys/Makefile","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/uts/common/sys/ddi_ufm.h","type":"ADDED","insertions":211,"deletions":0},{"file":"usr/src/uts/common/sys/ddi_ufm_impl.h","type":"ADDED","insertions":74,"deletions":0},{"file":"usr/src/uts/common/sys/scsi/adapters/mpt_sas/mptsas_var.h","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"usr/src/uts/intel/Makefile.intel","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/intel/ufm/Makefile","type":"ADDED","insertions":48,"deletions":0}],"sizeInsertions":2899,"sizeDeletions":-32},{"number":"2","revision":"d7eea5b9c1487fbc08fad30e43b96be99b6af6b0","parents":["ccfe2703aae7d898d162354279974ba639cc9cd2"],"ref":"refs/changes/07/6207/2","uploader":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"createdOn":1557870841,"author":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"isDraft":false,"kind":"REWORK","comments":[{"file":"manifest","line":19298,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"There\u0027ll be additional symlinks needed her when the manual page bits are fixed up."},{"file":"manifest","line":19298,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/lib/fm/topo/modules/common/disk/disk_common.c","line":315,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Should we be checking if our parent is a usb-device so we don\u0027t assume writeability?"},{"file":"usr/src/lib/fm/topo/modules/common/disk/disk_common.c","line":315,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Yes, that makes sense.  Done."},{"file":"usr/src/lib/fm/topo/modules/common/ipmi/ipmi_enum.c","line":588,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I noticed that some ufm modules have caps, others don\u0027t. Shoudl we make it consistent?"},{"file":"usr/src/lib/fm/topo/modules/common/ipmi/ipmi_enum.c","line":588,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Are you asking if we should surface the ddi_ufm_cap_t value in topo?    We\u0027re not currently because it didn\u0027t seem useufl to topo consumers, but I could certainly add it as a prop on the ufm node?"},{"file":"usr/src/man/man9e/Makefile","line":31,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I missed this on the first pass, but there should be symlinks to each of the non-primary .Nm entries in the manual pages."},{"file":"usr/src/man/man9e/Makefile","line":31,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/man/man9f/Makefile","line":247,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I missed this on the first pass, but there should be symlinks to each of the non-primary .Nm entries in the manual pages."},{"file":"usr/src/man/man9f/Makefile","line":247,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/uts/common/io/i40e/i40e_main.c","line":3259,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Any reason we shouldn\u0027t capture the actual error that was given back to us rather than assume ENOMEM (as these return an errno)."},{"file":"usr/src/uts/common/io/i40e/i40e_main.c","line":3259,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/uts/common/io/scsi/adapters/mpt_sas/mptsas.c","line":17031,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Shouldn\u0027t his be DDI_PROP_DONTPASS so we odn\u0027t try to find such a property on our parents?"},{"file":"usr/src/uts/common/io/scsi/adapters/mpt_sas/mptsas.c","line":17031,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/uts/common/io/ufm.c","line":127,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Is this check right? if ufm_devi is not null, won\u0027t we fail the if statement and therefore clobber it when we should actually return DDI_FAILURE."},{"file":"usr/src/uts/common/io/ufm.c","line":127,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Ooops - good catch.  Fixed."},{"file":"usr/src/uts/common/io/ufm.c","line":157,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"This is the wrong errno for these conditions. There\u0027s nothing permissions based about these, they\u0027re not supported. I\u0027d suggest EINVAL."},{"file":"usr/src/uts/common/io/ufm.c","line":157,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/uts/common/io/ufm.c","line":159,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Maybe better to do if !\u003d 0 that way if there\u0027s a bug in drv_priv, we don\u0027t fail with us suceeding?"},{"file":"usr/src/uts/common/io/ufm.c","line":159,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/uts/common/io/ufm.c","line":197,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Shouldn\u0027t we be checking for overflow here?"},{"file":"usr/src/uts/common/io/ufm.c","line":197,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/uts/common/io/ufm.c","line":226,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Any particular reason that we\u0027re filling the cache when we\u0027re trying to get the report? For example, if something doesn\u0027t support reporting, filling it would return ENOTSUPT, which would cause this to fail, which would mean that we can never report caps.\n\nI realize today we only have a single capability, but that isn\u0027t our long-term intent, so I suggest we fix that now."},{"file":"usr/src/uts/common/io/ufm.c","line":226,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Yep, make sense.  Done."},{"file":"usr/src/uts/common/io/ufm.c","line":262,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"This is unsafe. There is no guarantee that the user has given us a null-terminated path and therefore this will copy and buffer overflow until we hit a NULL."},{"file":"usr/src/uts/common/io/ufm.c","line":262,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/uts/common/io/ufm.c","line":272,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Why aren\u0027t we checking the return value here?"},{"file":"usr/src/uts/common/io/ufm.c","line":272,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/uts/common/io/ufm.c","line":309,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Why is it safe to drop the lock at this point? Once we drop the lock, we should assume we can\u0027t touch ufmh_report as someone else will finish up a detach call and free it."},{"file":"usr/src/uts/common/io/ufm.c","line":309,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Yep, that\u0027s just a mistake from when I refactored this code.  Fixed."},{"file":"usr/src/uts/common/io/ufm.c","line":359,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"See earlier notes."},{"file":"usr/src/uts/common/io/ufm.c","line":359,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/uts/common/io/ufm.c","line":371,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"See earlier notes."},{"file":"usr/src/uts/common/io/ufm.c","line":371,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/uts/common/io/ufm.c","line":420,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"See note about dropping this mutex in previous ioctl. This is unsafe."},{"file":"usr/src/uts/common/io/ufm.c","line":420,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Should be ok in this case, as we\u0027re done with ufmh at this point."},{"file":"usr/src/uts/common/io/ufm.c","line":420,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"You\u0027re correct. My mistake."},{"file":"usr/src/uts/common/io/ufm.c","line":441,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Why are we copying out data here when it doesn\u0027t appear that we\u0027ve updated any of the fields in the structure? I suspect we meant to copy out the updated size that we copied like in the REPORT_SZ ioctl as you mentioned that the size check was \u003c\u003d for the case that something tried and changed."},{"file":"usr/src/uts/common/io/ufm.c","line":441,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"No, just a mistake that I didn\u0027t notice because the ioctl was working.  I\u0027ve removed it."},{"file":"usr/src/uts/common/io/ufm.c","line":452,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"See note in open() about how to structure this check."},{"file":"usr/src/uts/common/io/ufm.c","line":452,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":83,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"The sizing on the kmem_free() is wrong because it\u0027s not taking into account the +1 from the strlen. I suggest using strfree(9F) as that\u0027s the companion to ddi_strdup(9F)."},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":83,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":88,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"See above note."},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":88,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":270,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Should we use defense in depth and make sure that we use strlcpy and check for overflow rather than a blind strcpy?"},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":270,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":293,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Maybe just !\u003d?"},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":293,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"My thinking was to leave this check as-is, so we don\u0027t have to change it later if/when we add DDI_UFM_VERSION_TWO."},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":293,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"OK, fair enough."},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":312,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"If this is \u003e\u003d MAXPATHLEN maybe we should fail instead?"},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":312,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"devpath came from ddi_pathname, so it seems unlikely that it could ever be \u003e\u003d MAXPATHLEN?"},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":312,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"That assumes that you have the same definition of MAXPATHLEN. Which is mostly what my paranoia would be about. While I agree, it\u0027d be unlikely, I\u0027d hope it doesn\u0027t actually happen."},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":333,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Probably worth a comment that umf_find() has the lock. It\u0027s definitely thrown me off a bit that it has that side effect."},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":333,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"That was the gist of  what I was trying to say in the comment above the if statement.  Or should I add more?"},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":333,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I\u0027m not sure why I missed it originally."},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":347,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"It makes sense that this is setting the STATE_SHUTTING_DOWN, but what ends up actually removing or freeing this ever?"},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":347,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"The entry basically never gets removed from the tree or freed, once a driver has registered with DDI UFM.  I\u0027m not sure we can ever get rid of it we want to have in around in the case that the driver gets loaded again."},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":347,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I would have thought that when we come around next and use it, the fact that it\u0027s set as shutting down would cause us to trigger a module load. If by the time that process is done it\u0027s no longer valid, wouldn\u0027t we be able to remove it? Alternatively, there has to be some way to at least know that the module has been removed. /devices doesn\u0027t keep around the old things if rem_drv(1M) has been called."},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":347,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Any thoughts on this?"},{"file":"usr/src/uts/common/sys/ddi_ufm.h","line":95,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Shouldn\u0027t this mention that we\u0027ll copy out the size of the updated buffer? As there\u0027s no reason a caller has to have allocated a buffer that was the size of the one in UFM_IOC_REPORTSIZE."},{"file":"usr/src/uts/common/sys/ddi_ufm.h","line":95,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/uts/sparc/ufm/Makefile","line":24,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Makefile.sparc?"},{"file":"usr/src/uts/sparc/ufm/Makefile","line":24,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":9,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/hc.c","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/libtopo.h","type":"MODIFIED","insertions":27,"deletions":-2},{"file":"usr/src/lib/fm/topo/libtopo/common/mapfile-vers","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_hc.h","type":"MODIFIED","insertions":10,"deletions":-2},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_mod.c","type":"MODIFIED","insertions":223,"deletions":-1},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_mod.h","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_mod.map","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/lib/fm/topo/modules/common/disk/disk_common.c","type":"MODIFIED","insertions":18,"deletions":-1},{"file":"usr/src/lib/fm/topo/modules/common/ipmi/ipmi_enum.c","type":"MODIFIED","insertions":15,"deletions":-1},{"file":"usr/src/lib/fm/topo/modules/common/pcibus/pcibus.c","type":"MODIFIED","insertions":200,"deletions":-1},{"file":"usr/src/lib/fm/topo/modules/common/smbios/smbios_enum.c","type":"MODIFIED","insertions":39,"deletions":-12},{"file":"usr/src/man/man7d/Makefile","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/man/man7d/ufm.7d","type":"ADDED","insertions":243,"deletions":0},{"file":"usr/src/man/man9e/Makefile","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/man/man9e/ddi_ufm.9e","type":"ADDED","insertions":372,"deletions":0},{"file":"usr/src/man/man9f/Makefile","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"usr/src/man/man9f/ddi_ufm.9f","type":"ADDED","insertions":162,"deletions":0},{"file":"usr/src/man/man9f/ddi_ufm_image.9f","type":"ADDED","insertions":88,"deletions":0},{"file":"usr/src/man/man9f/ddi_ufm_slot.9f","type":"ADDED","insertions":111,"deletions":0},{"file":"usr/src/uts/common/Makefile.files","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/common/io/i40e/i40e_main.c","type":"MODIFIED","insertions":96,"deletions":-5},{"file":"usr/src/uts/common/io/i40e/i40e_sw.h","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/mpt_sas/mptsas.c","type":"MODIFIED","insertions":80,"deletions":-2},{"file":"usr/src/uts/common/io/ufm.c","type":"ADDED","insertions":472,"deletions":0},{"file":"usr/src/uts/common/io/ufm.conf","type":"ADDED","insertions":16,"deletions":0},{"file":"usr/src/uts/common/mapfiles/ddi.mapfile","type":"MODIFIED","insertions":14,"deletions":-1},{"file":"usr/src/uts/common/os/autoconf.c","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/uts/common/os/ddi_ufm.c","type":"ADDED","insertions":405,"deletions":0},{"file":"usr/src/uts/common/sys/Makefile","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/uts/common/sys/ddi_ufm.h","type":"ADDED","insertions":221,"deletions":0},{"file":"usr/src/uts/common/sys/ddi_ufm_impl.h","type":"ADDED","insertions":87,"deletions":0},{"file":"usr/src/uts/common/sys/scsi/adapters/mpt_sas/mptsas_var.h","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"usr/src/uts/intel/Makefile.intel","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/intel/ufm/Makefile","type":"ADDED","insertions":48,"deletions":0},{"file":"usr/src/uts/sparc/Makefile.sparc","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/sparc/ufm/Makefile","type":"ADDED","insertions":48,"deletions":0}],"sizeInsertions":3046,"sizeDeletions":-36},{"number":"3","revision":"eb904f778324e63cf09b54b36fe885ec7da5783d","parents":["ccfe2703aae7d898d162354279974ba639cc9cd2"],"ref":"refs/changes/07/6207/3","uploader":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"createdOn":1559596997,"author":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/man/man7d/ufm.7d","line":0,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Weren\u0027t we going to write this in mdoc? Should I put that together for you? We\u0027re not supposed to write new manuals in roff. If you\u0027re not going to change it, let me know and I\u0027ll point out the roff issues."},{"file":"usr/src/man/man7d/ufm.7d","line":0,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Sorry - I simply forgot about the conversion.  It\u0027s now in mandoc format."},{"file":"usr/src/man/man7d/ufm.7d","line":31,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"\u0027via a private ioctl interface\u0027? Isn\u0027t this a private interface for now?"},{"file":"usr/src/man/man7d/ufm.7d","line":31,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/man/man7d/ufm.7d","line":69,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Isn\u0027t pbchk angry about this?"},{"file":"usr/src/man/man7d/ufm.7d","line":69,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Didn\u0027t get complaints from pbchk or mancheck.  Fxied.  I\u0027ve been looking at the changes in webrev, which unfortunately doesn\u0027t deal with whitespace changes very well."},{"file":"usr/src/man/man7d/ufm.7d","line":107,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Should we talk somewhere in here that this can change and there\u0027s a chance for a transitive failure if the device is changing and invalidating itself between this and the UFM_IOC_REPORT call?"},{"file":"usr/src/man/man7d/ufm.7d","line":107,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Yeah, sounds like a good idea.  Done."},{"file":"usr/src/man/man7d/ufm.7d","line":141,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Section is called examples."},{"file":"usr/src/man/man7d/ufm.7d","line":141,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/man/man7d/ufm.7d","line":193,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Technically we can have a large variety of errors, so we should probably say something like we do in other manuals that the set of errors that can be returned is basically all of them and these are the common ones. I can pull up specific language if that\u0027s helpful."},{"file":"usr/src/man/man7d/ufm.7d","line":193,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/man/man7d/ufm.7d","line":199,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"This also can mean that the driver doesn\u0027t support the UFM interfaces or it can also mean that the device doesn\u0027t exist at all."},{"file":"usr/src/man/man7d/ufm.7d","line":199,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Yes, true.  Updated."},{"file":"usr/src/man/man7d/ufm.7d","line":208,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"two spaces?"},{"file":"usr/src/man/man7d/ufm.7d","line":208,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/man/man7d/ufm.7d","line":237,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Attributes are done in a section now. So this should be in mdoc:\n\n.Sh INTERFACE STABILITY\n.Sy Evolving\n\nThough maybe better to just call it private for now."},{"file":"usr/src/man/man7d/ufm.7d","line":237,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/man/man7d/ufm.7d","line":242,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Technically these are supposed to be ordered by sections first than alphabetically, IIRC that\u0027s what mdoc\u0027s lint will say. Though that lint isn\u0027t running because this is in roff."},{"file":"usr/src/man/man7d/ufm.7d","line":242,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/man/man9e/ddi_ufm.9e","line":306,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"You want to use .Pq for parens."},{"file":"usr/src/man/man9e/ddi_ufm.9e","line":306,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/man/man9e/ddi_ufm.9e","line":309,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"extraneous word?"},{"file":"usr/src/man/man9e/ddi_ufm.9e","line":309,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/man/man9e/ddi_ufm.9e","line":345,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":".Pq"},{"file":"usr/src/man/man9e/ddi_ufm.9e","line":345,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/man/man9e/ddi_ufm.9e","line":361,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Should we have what common errors we expect to return here like we do for the others?"},{"file":"usr/src/man/man9e/ddi_ufm.9e","line":361,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/man/man9f/ddi_ufm_image.9f","line":58,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"This can be joined on the previous line."},{"file":"usr/src/man/man9f/ddi_ufm_image.9f","line":58,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/test/os-tests/tests/Makefile","line":32,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"If you\u0027re going to do this, at least make the spacing consistent as in spaces versus tabs?"},{"file":"usr/src/test/os-tests/tests/Makefile","line":32,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/test/os-tests/tests/ddi_ufm/ufm-test.c","line":46,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Is there a reason that this doesn\u0027t have a constant?"},{"file":"usr/src/test/os-tests/tests/ddi_ufm/ufm-test.c","line":46,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"No reason - fixed."},{"file":"usr/src/test/os-tests/tests/ddi_ufm/ufm-test.c","line":72,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Can this be const?"},{"file":"usr/src/test/os-tests/tests/ddi_ufm/ufm-test.c","line":72,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Yes - done."},{"file":"usr/src/test/os-tests/tests/ddi_ufm/ufm-test.c","line":88,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Spacing of the structure with respect to the braces looks a little weird."},{"file":"usr/src/test/os-tests/tests/ddi_ufm/ufm-test.c","line":88,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/test/os-tests/tests/ddi_ufm/ufm-test.c","line":139,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Shouldn\u0027t this return -1? Otherwise won\u0027t everything keep going?"},{"file":"usr/src/test/os-tests/tests/ddi_ufm/ufm-test.c","line":139,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"We can still do the tests in do_negative_open_tests() as those don\u0027t require the ufmtest driver."},{"file":"usr/src/test/os-tests/tests/ddi_ufm/ufm-test.c","line":139,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"OK. Mind adding a comment here to that note? It\u0027d be easy to miss otherwise."},{"file":"usr/src/test/os-tests/tests/ddi_ufm/ufm-test.c","line":147,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"signed / unsigned mismatch"},{"file":"usr/src/test/os-tests/tests/ddi_ufm/ufm-test.c","line":147,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/test/os-tests/tests/ddi_ufm/ufm-test.c","line":154,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"It looks like this is really just returning a boolean_t, maybe change it to that?"},{"file":"usr/src/test/os-tests/tests/ddi_ufm/ufm-test.c","line":154,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"The idea was return 0 on success and non-zero on failure - but I can see where it\u0027s a bit confusing because it was returning either 0 or 1.  So I changed the error paths in this func to return -1 on failure."},{"file":"usr/src/test/os-tests/tests/ddi_ufm/ufm-test.c","line":172,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"cstyle prefers the \u003d\u003d as trailing."},{"file":"usr/src/test/os-tests/tests/ddi_ufm/ufm-test.c","line":172,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/test/os-tests/tests/ddi_ufm/ufm-test.c","line":186,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"In the current design, this may cause you to free uninitialized memory. The problem is that you\u0027re relying a sentinel in free_nvlist_arr() of it being non-NULL. However, the memory allocation isn\u0027t initialized. I think the simplest solution here is to change the malloc to a calloc."},{"file":"usr/src/test/os-tests/tests/ddi_ufm/ufm-test.c","line":186,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Right- because calloc initializes the memory to zero.  Makes sense - done."},{"file":"usr/src/test/os-tests/tests/ddi_ufm/ufm-test.c","line":271,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Should we toss O_NONBLOCK / O_NDELAY into this?"},{"file":"usr/src/test/os-tests/tests/ddi_ufm/ufm-test.c","line":271,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Sure, why not.  Note I had to update ufm.c to error out for FNONBLOCK.  I suppose that adds the question are their other flags we should error out on as they have no meaning with this driver (e.g. FDSYNC, FSYNC, etc)"},{"file":"usr/src/test/os-tests/tests/ddi_ufm/ufm-test.c","line":356,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Don\u0027t you need to null-terminate not_ascii at some point? Otherwise it just will have stack garbage after 256 bytes. Probably worth a CTASSERT that MAXPATHLEN is greater than 256."},{"file":"usr/src/test/os-tests/tests/ddi_ufm/ufm-test.c","line":356,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/test/os-tests/tests/ddi_ufm/ufm-test.c","line":380,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Is there a reason these return with only logging a message but don\u0027t result in a test failure?"},{"file":"usr/src/test/os-tests/tests/ddi_ufm/ufm-test.c","line":380,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Yeah, I wasn\u0027t sure how to handle this.   The failures here cause us to abort tests, but those tests themselves didn\u0027t actually fail because we never ran them.\n\nI\u0027m open to suggestions on better ways to handle this."},{"file":"usr/src/test/os-tests/tests/ddi_ufm/ufm-test.c","line":380,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I think we should just count it as a test failure, as otherwise someone will think the test succeeded, when in reality it didn\u0027t run. If we fail to allocate this memory, someone will need to look at that and rerun things."},{"file":"usr/src/test/os-tests/tests/ddi_ufm/ufm-test.c","line":462,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"What in the kernel side checks for a valid ascii string? Are you sure the kernel actually cares about this?"},{"file":"usr/src/test/os-tests/tests/ddi_ufm/ufm-test.c","line":462,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"I actually wasn\u0027t sure if anything would care - just figured that at a minimum we should verify that the system should not panic - no matter what kind of crazy string we pass in to ufm via an ioctl."},{"file":"usr/src/test/os-tests/tests/ddi_ufm/ufm-test.c","line":854,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Maybe this is clearer if it\u0027s EXIT_FAILURE?"},{"file":"usr/src/test/os-tests/tests/ddi_ufm/ufm-test.c","line":854,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/test/os-tests/tests/ddi_ufm/ufm-test.c","line":870,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Why is this in a while loop? You don\u0027t use the arguments for anything else."},{"file":"usr/src/test/os-tests/tests/ddi_ufm/ufm-test.c","line":870,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Sorry - this is all unnecessary code and I removed it.  I had thoughts of having the -D option enable more verbose logging in the tests but then decided against it."},{"file":"usr/src/test/os-tests/tests/ddi_ufm/ufm-test.c","line":889,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"EXIT_SUCCSESS?"},{"file":"usr/src/test/os-tests/tests/ddi_ufm/ufm-test.c","line":889,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/test/os-tests/tests/ddi_ufm/ufm-test.c","line":892,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Presumably you actually only want to do this if it\u0027s \u003e 0?"},{"file":"usr/src/test/os-tests/tests/ddi_ufm/ufm-test.c","line":892,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/test/os-tests/tests/ddi_ufm/ufm-test.c","line":892,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Sorry, that should have been \u003e\u003d 0."},{"file":"usr/src/uts/common/io/ufm.c","line":277,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Don\u0027t we need to check the return value here? If the user data isn\u0027t null terminated this will cause an overflow and we should probably error out."},{"file":"usr/src/uts/common/io/ufm.c","line":277,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/uts/common/io/ufm.c","line":374,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"See above note."},{"file":"usr/src/uts/common/io/ufm.c","line":374,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/uts/common/io/ufmtest.c","line":137,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Should we actually use ddi_get_instance() here on the primary dip rather than hardcode zero?"},{"file":"usr/src/uts/common/io/ufmtest.c","line":137,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/uts/common/io/ufmtest.c","line":196,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Maybe we should also double check that this is only being used in the global zone since this is a test driver?"},{"file":"usr/src/uts/common/io/ufmtest.c","line":196,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Sounds reasonable.  Done."},{"file":"usr/src/uts/common/io/ufmtest.c","line":252,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"This can return NULL, you must check for memory allocation failure."},{"file":"usr/src/uts/common/io/ufmtest.c","line":252,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/uts/common/io/ufmtest.c","line":283,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Should we check for unsupported flags before we just set this?"},{"file":"usr/src/uts/common/io/ufmtest.c","line":283,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/uts/common/io/ufmtest.c","line":411,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Minor thing, but cstyle prefers the value on the previous line."},{"file":"usr/src/uts/common/io/ufmtest.c","line":411,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/uts/common/io/ufmtest.h","line":60,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Minor, but if it\u0027s a bitfield, it might be clearer to define it as 1 \u003c\u003c 0, 1 \u003c\u003c 1, etc."},{"file":"usr/src/uts/common/io/ufmtest.h","line":60,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/uts/sparc/Makefile.sparc","line":248,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Missing sparc/ufmtest/Makefile?"},{"file":"usr/src/uts/sparc/Makefile.sparc","line":248,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Forgot to do a git add for it.  Fixed."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":21,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/hc.c","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/libtopo.h","type":"MODIFIED","insertions":27,"deletions":-2},{"file":"usr/src/lib/fm/topo/libtopo/common/mapfile-vers","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_hc.h","type":"MODIFIED","insertions":10,"deletions":-2},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_mod.c","type":"MODIFIED","insertions":223,"deletions":-1},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_mod.h","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_mod.map","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/lib/fm/topo/modules/common/disk/disk_common.c","type":"MODIFIED","insertions":21,"deletions":-1},{"file":"usr/src/lib/fm/topo/modules/common/ipmi/ipmi_enum.c","type":"MODIFIED","insertions":15,"deletions":-1},{"file":"usr/src/lib/fm/topo/modules/common/pcibus/pcibus.c","type":"MODIFIED","insertions":200,"deletions":-1},{"file":"usr/src/lib/fm/topo/modules/common/smbios/smbios_enum.c","type":"MODIFIED","insertions":39,"deletions":-12},{"file":"usr/src/man/man7d/Makefile","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/man/man7d/ufm.7d","type":"ADDED","insertions":242,"deletions":0},{"file":"usr/src/man/man9e/Makefile","type":"MODIFIED","insertions":11,"deletions":-2},{"file":"usr/src/man/man9e/ddi_ufm.9e","type":"ADDED","insertions":409,"deletions":0},{"file":"usr/src/man/man9f/Makefile","type":"MODIFIED","insertions":21,"deletions":-1},{"file":"usr/src/man/man9f/ddi_ufm.9f","type":"ADDED","insertions":162,"deletions":0},{"file":"usr/src/man/man9f/ddi_ufm_image.9f","type":"ADDED","insertions":102,"deletions":0},{"file":"usr/src/man/man9f/ddi_ufm_slot.9f","type":"ADDED","insertions":111,"deletions":0},{"file":"usr/src/test/os-tests/tests/Makefile","type":"MODIFIED","insertions":15,"deletions":-3},{"file":"usr/src/test/os-tests/tests/ddi_ufm/Makefile","type":"ADDED","insertions":51,"deletions":0},{"file":"usr/src/test/os-tests/tests/ddi_ufm/ufm-test.c","type":"ADDED","insertions":895,"deletions":0},{"file":"usr/src/uts/common/Makefile.files","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/common/io/i40e/i40e_main.c","type":"MODIFIED","insertions":95,"deletions":-5},{"file":"usr/src/uts/common/io/i40e/i40e_sw.h","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/mpt_sas/mptsas.c","type":"MODIFIED","insertions":81,"deletions":-2},{"file":"usr/src/uts/common/io/ufm.c","type":"ADDED","insertions":476,"deletions":0},{"file":"usr/src/uts/common/io/ufm.conf","type":"ADDED","insertions":16,"deletions":0},{"file":"usr/src/uts/common/io/ufmtest.c","type":"ADDED","insertions":431,"deletions":0},{"file":"usr/src/uts/common/io/ufmtest.conf","type":"ADDED","insertions":16,"deletions":0},{"file":"usr/src/uts/common/io/ufmtest.h","type":"ADDED","insertions":70,"deletions":0},{"file":"usr/src/uts/common/mapfiles/ddi.mapfile","type":"MODIFIED","insertions":14,"deletions":-1},{"file":"usr/src/uts/common/os/autoconf.c","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/uts/common/os/ddi_ufm.c","type":"ADDED","insertions":418,"deletions":0},{"file":"usr/src/uts/common/sys/Makefile","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/uts/common/sys/ddi_ufm.h","type":"ADDED","insertions":224,"deletions":0},{"file":"usr/src/uts/common/sys/ddi_ufm_impl.h","type":"ADDED","insertions":87,"deletions":0},{"file":"usr/src/uts/common/sys/scsi/adapters/mpt_sas/mptsas_var.h","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"usr/src/uts/intel/Makefile.intel","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/intel/ufm/Makefile","type":"ADDED","insertions":48,"deletions":0},{"file":"usr/src/uts/intel/ufmtest/Makefile","type":"ADDED","insertions":48,"deletions":0},{"file":"usr/src/uts/sparc/Makefile.sparc","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/sparc/ufm/Makefile","type":"ADDED","insertions":48,"deletions":0}],"sizeInsertions":4685,"sizeDeletions":-40},{"number":"4","revision":"feb22b00dbad770633bc7d432c139e3acbb7b6d9","parents":["ccfe2703aae7d898d162354279974ba639cc9cd2"],"ref":"refs/changes/07/6207/4","uploader":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"createdOn":1559854112,"author":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/man/man7d/ufm.7d","line":48,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I think you don\u0027t want the \u0027a\u0027 here?"},{"file":"usr/src/man/man7d/ufm.7d","line":48,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/man/man7d/ufm.7d","line":53,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Nix trailing space?"},{"file":"usr/src/man/man7d/ufm.7d","line":53,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/man/man7d/ufm.7d","line":64,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Missing .Dv."},{"file":"usr/src/man/man7d/ufm.7d","line":64,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/man/man7d/ufm.7d","line":105,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Won\u0027t ufmr_bufsz also be updated to contain the actual size that should be passed to nvlist_unpack? Shouldn\u0027t we mention which nvlist encoding is used here and how to unpack it with a cross reference to nvlist_unpack(3NVPAIR)"},{"file":"usr/src/man/man7d/ufm.7d","line":105,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"The bit about updating ufmr_bufsz is covered below.   But I did add the reference to using nvliist_unpack."},{"file":"usr/src/man/man7d/ufm.7d","line":116,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":".Dv"},{"file":"usr/src/man/man7d/ufm.7d","line":116,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/man/man7d/ufm.7d","line":118,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I think you want a .Pp for the blank line?"},{"file":"usr/src/man/man7d/ufm.7d","line":118,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/man/man7d/ufm.7d","line":119,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":".Dv"},{"file":"usr/src/man/man7d/ufm.7d","line":119,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/man/man7d/ufm.7d","line":122,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":".Dv"},{"file":"usr/src/man/man7d/ufm.7d","line":122,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/man/man7d/ufm.7d","line":124,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":".Er"},{"file":"usr/src/man/man7d/ufm.7d","line":124,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/man/man7d/ufm.7d","line":175,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":".Va"},{"file":"usr/src/man/man7d/ufm.7d","line":175,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/man/man9e/ddi_ufm.9e","line":311,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Sorry, missed this, but I think we didn\u0027t mean for this \u0027is\u0027 here."},{"file":"usr/src/man/man9e/ddi_ufm.9e","line":311,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/test/os-tests/tests/ddi_ufm/ufm-test.c","line":898,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Sorry, this should have been \u003e\u003d 0, since 0 is a valid fd."},{"file":"usr/src/test/os-tests/tests/ddi_ufm/ufm-test.c","line":898,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/uts/common/io/ufmtest.c","line":200,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Please use EPERM."},{"file":"usr/src/uts/common/io/ufmtest.c","line":200,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":21,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/hc.c","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/libtopo.h","type":"MODIFIED","insertions":27,"deletions":-2},{"file":"usr/src/lib/fm/topo/libtopo/common/mapfile-vers","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_hc.h","type":"MODIFIED","insertions":10,"deletions":-2},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_mod.c","type":"MODIFIED","insertions":223,"deletions":-1},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_mod.h","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_mod.map","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/lib/fm/topo/modules/common/disk/disk_common.c","type":"MODIFIED","insertions":21,"deletions":-1},{"file":"usr/src/lib/fm/topo/modules/common/ipmi/ipmi_enum.c","type":"MODIFIED","insertions":15,"deletions":-1},{"file":"usr/src/lib/fm/topo/modules/common/pcibus/pcibus.c","type":"MODIFIED","insertions":200,"deletions":-1},{"file":"usr/src/lib/fm/topo/modules/common/smbios/smbios_enum.c","type":"MODIFIED","insertions":39,"deletions":-12},{"file":"usr/src/man/man7d/Makefile","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/man/man7d/ufm.7d","type":"ADDED","insertions":200,"deletions":0},{"file":"usr/src/man/man9e/Makefile","type":"MODIFIED","insertions":11,"deletions":-2},{"file":"usr/src/man/man9e/ddi_ufm.9e","type":"ADDED","insertions":420,"deletions":0},{"file":"usr/src/man/man9f/Makefile","type":"MODIFIED","insertions":21,"deletions":-1},{"file":"usr/src/man/man9f/ddi_ufm.9f","type":"ADDED","insertions":162,"deletions":0},{"file":"usr/src/man/man9f/ddi_ufm_image.9f","type":"ADDED","insertions":101,"deletions":0},{"file":"usr/src/man/man9f/ddi_ufm_slot.9f","type":"ADDED","insertions":111,"deletions":0},{"file":"usr/src/test/os-tests/tests/Makefile","type":"MODIFIED","insertions":15,"deletions":-3},{"file":"usr/src/test/os-tests/tests/ddi_ufm/Makefile","type":"ADDED","insertions":51,"deletions":0},{"file":"usr/src/test/os-tests/tests/ddi_ufm/ufm-test.c","type":"ADDED","insertions":901,"deletions":0},{"file":"usr/src/uts/common/Makefile.files","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/common/io/i40e/i40e_main.c","type":"MODIFIED","insertions":95,"deletions":-5},{"file":"usr/src/uts/common/io/i40e/i40e_sw.h","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/mpt_sas/mptsas.c","type":"MODIFIED","insertions":81,"deletions":-2},{"file":"usr/src/uts/common/io/ufm.c","type":"ADDED","insertions":481,"deletions":0},{"file":"usr/src/uts/common/io/ufm.conf","type":"ADDED","insertions":16,"deletions":0},{"file":"usr/src/uts/common/io/ufmtest.c","type":"ADDED","insertions":441,"deletions":0},{"file":"usr/src/uts/common/io/ufmtest.conf","type":"ADDED","insertions":16,"deletions":0},{"file":"usr/src/uts/common/io/ufmtest.h","type":"ADDED","insertions":75,"deletions":0},{"file":"usr/src/uts/common/mapfiles/ddi.mapfile","type":"MODIFIED","insertions":14,"deletions":-1},{"file":"usr/src/uts/common/os/autoconf.c","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/uts/common/os/ddi_ufm.c","type":"ADDED","insertions":418,"deletions":0},{"file":"usr/src/uts/common/sys/Makefile","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/uts/common/sys/ddi_ufm.h","type":"ADDED","insertions":224,"deletions":0},{"file":"usr/src/uts/common/sys/ddi_ufm_impl.h","type":"ADDED","insertions":87,"deletions":0},{"file":"usr/src/uts/common/sys/scsi/adapters/mpt_sas/mptsas_var.h","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"usr/src/uts/intel/Makefile.intel","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/intel/ufm/Makefile","type":"ADDED","insertions":48,"deletions":0},{"file":"usr/src/uts/intel/ufmtest/Makefile","type":"ADDED","insertions":48,"deletions":0},{"file":"usr/src/uts/sparc/Makefile.sparc","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/sparc/ufm/Makefile","type":"ADDED","insertions":48,"deletions":0},{"file":"usr/src/uts/sparc/ufmtest/Makefile","type":"ADDED","insertions":48,"deletions":0}],"sizeInsertions":4727,"sizeDeletions":-40},{"number":"5","revision":"b4e935fd950d96333c0c4a2827a9bd543831cdf7","parents":["ccfe2703aae7d898d162354279974ba639cc9cd2"],"ref":"refs/changes/07/6207/5","uploader":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"createdOn":1560276821,"author":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1560293154,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":21,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/hc.c","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/libtopo.h","type":"MODIFIED","insertions":27,"deletions":-2},{"file":"usr/src/lib/fm/topo/libtopo/common/mapfile-vers","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_hc.h","type":"MODIFIED","insertions":10,"deletions":-2},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_mod.c","type":"MODIFIED","insertions":223,"deletions":-1},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_mod.h","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_mod.map","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/lib/fm/topo/modules/common/disk/disk_common.c","type":"MODIFIED","insertions":21,"deletions":-1},{"file":"usr/src/lib/fm/topo/modules/common/ipmi/ipmi_enum.c","type":"MODIFIED","insertions":15,"deletions":-1},{"file":"usr/src/lib/fm/topo/modules/common/pcibus/pcibus.c","type":"MODIFIED","insertions":200,"deletions":-1},{"file":"usr/src/lib/fm/topo/modules/common/smbios/smbios_enum.c","type":"MODIFIED","insertions":39,"deletions":-12},{"file":"usr/src/man/man7d/Makefile","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/man/man7d/ufm.7d","type":"ADDED","insertions":206,"deletions":0},{"file":"usr/src/man/man9e/Makefile","type":"MODIFIED","insertions":11,"deletions":-2},{"file":"usr/src/man/man9e/ddi_ufm.9e","type":"ADDED","insertions":420,"deletions":0},{"file":"usr/src/man/man9f/Makefile","type":"MODIFIED","insertions":21,"deletions":-1},{"file":"usr/src/man/man9f/ddi_ufm.9f","type":"ADDED","insertions":162,"deletions":0},{"file":"usr/src/man/man9f/ddi_ufm_image.9f","type":"ADDED","insertions":101,"deletions":0},{"file":"usr/src/man/man9f/ddi_ufm_slot.9f","type":"ADDED","insertions":111,"deletions":0},{"file":"usr/src/test/os-tests/tests/Makefile","type":"MODIFIED","insertions":15,"deletions":-3},{"file":"usr/src/test/os-tests/tests/ddi_ufm/Makefile","type":"ADDED","insertions":51,"deletions":0},{"file":"usr/src/test/os-tests/tests/ddi_ufm/ufm-test.c","type":"ADDED","insertions":898,"deletions":0},{"file":"usr/src/uts/common/Makefile.files","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/common/io/i40e/i40e_main.c","type":"MODIFIED","insertions":95,"deletions":-5},{"file":"usr/src/uts/common/io/i40e/i40e_sw.h","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/mpt_sas/mptsas.c","type":"MODIFIED","insertions":79,"deletions":-2},{"file":"usr/src/uts/common/io/ufm.c","type":"ADDED","insertions":481,"deletions":0},{"file":"usr/src/uts/common/io/ufm.conf","type":"ADDED","insertions":16,"deletions":0},{"file":"usr/src/uts/common/io/ufmtest.c","type":"ADDED","insertions":439,"deletions":0},{"file":"usr/src/uts/common/io/ufmtest.conf","type":"ADDED","insertions":16,"deletions":0},{"file":"usr/src/uts/common/io/ufmtest.h","type":"ADDED","insertions":75,"deletions":0},{"file":"usr/src/uts/common/mapfiles/ddi.mapfile","type":"MODIFIED","insertions":14,"deletions":-1},{"file":"usr/src/uts/common/os/autoconf.c","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/uts/common/os/ddi_ufm.c","type":"ADDED","insertions":430,"deletions":0},{"file":"usr/src/uts/common/sys/Makefile","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/uts/common/sys/ddi_ufm.h","type":"ADDED","insertions":224,"deletions":0},{"file":"usr/src/uts/common/sys/ddi_ufm_impl.h","type":"ADDED","insertions":87,"deletions":0},{"file":"usr/src/uts/common/sys/scsi/adapters/mpt_sas/mptsas_var.h","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"usr/src/uts/intel/Makefile.intel","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/intel/ufm/Makefile","type":"ADDED","insertions":48,"deletions":0},{"file":"usr/src/uts/intel/ufmtest/Makefile","type":"ADDED","insertions":48,"deletions":0},{"file":"usr/src/uts/sparc/Makefile.sparc","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/sparc/ufm/Makefile","type":"ADDED","insertions":48,"deletions":0},{"file":"usr/src/uts/sparc/ufmtest/Makefile","type":"ADDED","insertions":48,"deletions":0}],"sizeInsertions":4738,"sizeDeletions":-40},{"number":"6","revision":"55eb70389414c9037c60f49d0f73634ddb59cd50","parents":["e6de8afafa8b73b0636044f094ba810178b0a271"],"ref":"refs/changes/07/6207/6","uploader":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"createdOn":1560299638,"author":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1560364768,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}}],"comments":[{"file":"usr/src/lib/fm/topo/libtopo/common/topo_hc.h","line":284,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"supposed to be an underscore?"},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_hc.h","line":284,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Good catch!  Fixed."},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_mod.c","line":991,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"nit: missing space?"},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_mod.c","line":991,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/uts/common/io/i40e/i40e_main.c","line":3255,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"\"firmware-build\"?"},{"file":"usr/src/uts/common/io/i40e/i40e_main.c","line":3255,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/uts/common/io/scsi/adapters/mpt_sas/mptsas.c","line":115,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Necessary, with it included in mptsas_var.h too?"},{"file":"usr/src/uts/common/io/scsi/adapters/mpt_sas/mptsas.c","line":115,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Actually not - good spot.  Fixed."},{"file":"usr/src/uts/common/io/ufm.c","line":156,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"nit: Aren\u0027t we done with this now that lint is dead?"},{"file":"usr/src/uts/common/io/ufm.c","line":156,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Yep, I think you\u0027re right.  Removed."},{"file":"usr/src/uts/common/io/ufm.c","line":158,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"style nit: Settle on one (\"cred\"?) name across the different functions in the file?"},{"file":"usr/src/uts/common/io/ufm.c","line":158,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"LOL - I hadn\u0027t realized that I\u0027d used cred, cred_p and credp. I updated the code so that they all use \"credp\""},{"file":"usr/src/uts/common/io/ufm.c","line":164,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"style nit: why not bitwise OR the flags of interest?"},{"file":"usr/src/uts/common/io/ufm.c","line":164,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Yeah, good call.  Fixed."},{"file":"usr/src/uts/common/io/ufm.c","line":207,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"general lamentation: the lack of const in the path routines which result in this being necessary is a bummer."},{"file":"usr/src/uts/common/io/ufm.c","line":236,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"style nit: why not make the \"ufmh_report \u003d\u003d NULL\" check part of ufm_cache_fill(), freeing us from the need to do it here?"},{"file":"usr/src/uts/common/io/ufm.c","line":236,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Good idea - done!"},{"file":"usr/src/uts/common/io/ufm.c","line":326,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"future style nit: If this driver expands any more, it might make sense to do this in a little helper func that takes the path/version and emits the dip/ufmh (or error), rather than repeating it so many times.\n\nFor now it\u0027s totally fine."},{"file":"usr/src/uts/common/io/ufm.c","line":326,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Yep, fair point."},{"file":"usr/src/uts/common/io/ufm.c","line":448,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Should ufmr be copied out after updating this size field?"},{"file":"usr/src/uts/common/io/ufm.c","line":448,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"I\u0027m not sure it matters."},{"file":"usr/src/uts/common/io/ufm.c","line":448,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Is the goal to notify userspace of the actual data size in the buffer, or not?  If not, why update the field here?"},{"file":"usr/src/uts/common/io/ufm.c","line":448,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Yes, that\u0027s the idea.  I guess I\u0027m misunderstanding the larger question.  Do you wan t me to move this line to before the ddi_copyout?"},{"file":"usr/src/uts/common/io/ufm.c","line":448,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"You\u0027re setting ufmr_bufsz in a stack-local copy of that struct.  Unless you copyout ufmr (after doing ufmr_buf, which is obviously separate), userspace will not receive the updated value."},{"file":"usr/src/uts/common/io/ufm.c","line":448,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Yep!  Fixed."},{"file":"usr/src/uts/common/io/ufmtest.c","line":129,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"nit: More \"lint is dead\" clean-up?"},{"file":"usr/src/uts/common/io/ufmtest.c","line":129,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Gone"},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":25,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"nit: no apostrophe for possessive \u0027its\u0027"},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":25,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":151,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"VERIFY that nimgs \u003e 0?"},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":151,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Check added."},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":334,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Although many fields are reset below, would we want to trash any other existing state (like ufmh_report), prior to completing this initialization?"},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":334,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"I think we\u0027re covered as a result of resetting ufmh_state to DDI_UFM_STATE_INIT.  In order for any of the other fields (like ufmh_report) to get referenced ufmh_state has to first transition to DDI_UFM_STATE_READY.  The only way that can happen is for the driver to call ddi_ufm_update(), which will call ufm_cache_invalidate(), which in turn will take care of trashing all that other stuff."},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":334,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"OK, perhaps include a small comment about that here?"},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":334,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Comment added."},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":430,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"For the setters that are dealing with an allocated value, is it worth checking to see if it\u0027s about to overwrite (and therefore leak) an existing value?"},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":430,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Good question.  I double-checked the code and we shouldn\u0027t leak these because these are callbacks which only get called in the context of ufm_cache_fill() and (unless it\u0027s the initial \"fill\") should always be preceeded by a call to ufm_cache_invalidate(), which will first free things like ufmi_desc and ufms_version."},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":430,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"OK, maybe worth a VERIFY or ASSERT that the never-should-be-overwritten fields are always NULL?"},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":430,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I think Patrick\u0027s referring to a different case than you\u0027re thinking of Rob. At least, I read this as what happens if a driver calls something like set_misc twice in a row. We should handle that and free the old one, imho. Basically even if a driver is being a bit malformed, honor the latest thing they set."},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":430,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Ah, ok.  Sorry - yeah - I misunderstood.  Ok, I\u0027ve fixed it to free the old value, where appropriate."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":21,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/hc.c","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/libtopo.h","type":"MODIFIED","insertions":27,"deletions":-2},{"file":"usr/src/lib/fm/topo/libtopo/common/mapfile-vers","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_hc.h","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_mod.c","type":"MODIFIED","insertions":223,"deletions":-1},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_mod.h","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_mod.map","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/lib/fm/topo/modules/common/disk/disk_common.c","type":"MODIFIED","insertions":20,"deletions":0},{"file":"usr/src/lib/fm/topo/modules/common/ipmi/ipmi_enum.c","type":"MODIFIED","insertions":15,"deletions":-1},{"file":"usr/src/lib/fm/topo/modules/common/pcibus/pcibus.c","type":"MODIFIED","insertions":200,"deletions":-1},{"file":"usr/src/lib/fm/topo/modules/common/smbios/smbios_enum.c","type":"MODIFIED","insertions":39,"deletions":-12},{"file":"usr/src/man/man7d/Makefile","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/man/man7d/ufm.7d","type":"ADDED","insertions":206,"deletions":0},{"file":"usr/src/man/man9e/Makefile","type":"MODIFIED","insertions":11,"deletions":-2},{"file":"usr/src/man/man9e/ddi_ufm.9e","type":"ADDED","insertions":420,"deletions":0},{"file":"usr/src/man/man9f/Makefile","type":"MODIFIED","insertions":21,"deletions":-1},{"file":"usr/src/man/man9f/ddi_ufm.9f","type":"ADDED","insertions":162,"deletions":0},{"file":"usr/src/man/man9f/ddi_ufm_image.9f","type":"ADDED","insertions":101,"deletions":0},{"file":"usr/src/man/man9f/ddi_ufm_slot.9f","type":"ADDED","insertions":111,"deletions":0},{"file":"usr/src/test/os-tests/tests/Makefile","type":"MODIFIED","insertions":15,"deletions":-3},{"file":"usr/src/test/os-tests/tests/ddi_ufm/Makefile","type":"ADDED","insertions":51,"deletions":0},{"file":"usr/src/test/os-tests/tests/ddi_ufm/ufm-test.c","type":"ADDED","insertions":898,"deletions":0},{"file":"usr/src/uts/common/Makefile.files","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/common/io/i40e/i40e_main.c","type":"MODIFIED","insertions":94,"deletions":-4},{"file":"usr/src/uts/common/io/i40e/i40e_sw.h","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/mpt_sas/mptsas.c","type":"MODIFIED","insertions":79,"deletions":-2},{"file":"usr/src/uts/common/io/ufm.c","type":"ADDED","insertions":481,"deletions":0},{"file":"usr/src/uts/common/io/ufm.conf","type":"ADDED","insertions":16,"deletions":0},{"file":"usr/src/uts/common/io/ufmtest.c","type":"ADDED","insertions":439,"deletions":0},{"file":"usr/src/uts/common/io/ufmtest.conf","type":"ADDED","insertions":16,"deletions":0},{"file":"usr/src/uts/common/io/ufmtest.h","type":"ADDED","insertions":75,"deletions":0},{"file":"usr/src/uts/common/mapfiles/ddi.mapfile","type":"MODIFIED","insertions":14,"deletions":-1},{"file":"usr/src/uts/common/os/autoconf.c","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/uts/common/os/ddi_ufm.c","type":"ADDED","insertions":430,"deletions":0},{"file":"usr/src/uts/common/sys/Makefile","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/common/sys/ddi_ufm.h","type":"ADDED","insertions":224,"deletions":0},{"file":"usr/src/uts/common/sys/ddi_ufm_impl.h","type":"ADDED","insertions":87,"deletions":0},{"file":"usr/src/uts/common/sys/scsi/adapters/mpt_sas/mptsas_var.h","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"usr/src/uts/intel/Makefile.intel","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/uts/intel/ufm/Makefile","type":"ADDED","insertions":48,"deletions":0},{"file":"usr/src/uts/intel/ufmtest/Makefile","type":"ADDED","insertions":48,"deletions":0},{"file":"usr/src/uts/sparc/Makefile.sparc","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/sparc/ufm/Makefile","type":"ADDED","insertions":48,"deletions":0},{"file":"usr/src/uts/sparc/ufmtest/Makefile","type":"ADDED","insertions":48,"deletions":0}],"sizeInsertions":4733,"sizeDeletions":-34},{"number":"7","revision":"d04648f1627022e4ddbfefbef40c89acb66a7561","parents":["e6de8afafa8b73b0636044f094ba810178b0a271"],"ref":"refs/changes/07/6207/7","uploader":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"createdOn":1560392484,"author":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/uts/common/io/ufm.c","line":158,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"style nit: make this const?"},{"file":"usr/src/uts/common/io/ufm.c","line":158,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/uts/common/io/ufmtest.c","line":185,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"nit: more lint clean-up"},{"file":"usr/src/uts/common/io/ufmtest.c","line":185,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/uts/common/io/ufmtest.c","line":187,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"nit: more credp consistency"},{"file":"usr/src/uts/common/io/ufmtest.c","line":187,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/uts/common/io/ufmtest.c","line":193,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"style nit: same flag treatment as ufm.c?"},{"file":"usr/src/uts/common/io/ufmtest.c","line":193,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":21,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/hc.c","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/libtopo.h","type":"MODIFIED","insertions":27,"deletions":-2},{"file":"usr/src/lib/fm/topo/libtopo/common/mapfile-vers","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_hc.h","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_mod.c","type":"MODIFIED","insertions":223,"deletions":-1},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_mod.h","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_mod.map","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/lib/fm/topo/modules/common/disk/disk_common.c","type":"MODIFIED","insertions":20,"deletions":0},{"file":"usr/src/lib/fm/topo/modules/common/ipmi/ipmi_enum.c","type":"MODIFIED","insertions":15,"deletions":-1},{"file":"usr/src/lib/fm/topo/modules/common/pcibus/pcibus.c","type":"MODIFIED","insertions":200,"deletions":-1},{"file":"usr/src/lib/fm/topo/modules/common/smbios/smbios_enum.c","type":"MODIFIED","insertions":39,"deletions":-12},{"file":"usr/src/man/man7d/Makefile","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/man/man7d/ufm.7d","type":"ADDED","insertions":206,"deletions":0},{"file":"usr/src/man/man9e/Makefile","type":"MODIFIED","insertions":11,"deletions":-2},{"file":"usr/src/man/man9e/ddi_ufm.9e","type":"ADDED","insertions":420,"deletions":0},{"file":"usr/src/man/man9f/Makefile","type":"MODIFIED","insertions":21,"deletions":-1},{"file":"usr/src/man/man9f/ddi_ufm.9f","type":"ADDED","insertions":162,"deletions":0},{"file":"usr/src/man/man9f/ddi_ufm_image.9f","type":"ADDED","insertions":101,"deletions":0},{"file":"usr/src/man/man9f/ddi_ufm_slot.9f","type":"ADDED","insertions":111,"deletions":0},{"file":"usr/src/test/os-tests/tests/Makefile","type":"MODIFIED","insertions":15,"deletions":-3},{"file":"usr/src/test/os-tests/tests/ddi_ufm/Makefile","type":"ADDED","insertions":51,"deletions":0},{"file":"usr/src/test/os-tests/tests/ddi_ufm/ufm-test.c","type":"ADDED","insertions":898,"deletions":0},{"file":"usr/src/uts/common/Makefile.files","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/common/io/i40e/i40e_main.c","type":"MODIFIED","insertions":94,"deletions":-4},{"file":"usr/src/uts/common/io/i40e/i40e_sw.h","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/mpt_sas/mptsas.c","type":"MODIFIED","insertions":77,"deletions":-2},{"file":"usr/src/uts/common/io/ufm.c","type":"ADDED","insertions":470,"deletions":0},{"file":"usr/src/uts/common/io/ufm.conf","type":"ADDED","insertions":16,"deletions":0},{"file":"usr/src/uts/common/io/ufmtest.c","type":"ADDED","insertions":438,"deletions":0},{"file":"usr/src/uts/common/io/ufmtest.conf","type":"ADDED","insertions":16,"deletions":0},{"file":"usr/src/uts/common/io/ufmtest.h","type":"ADDED","insertions":75,"deletions":0},{"file":"usr/src/uts/common/mapfiles/ddi.mapfile","type":"MODIFIED","insertions":14,"deletions":-1},{"file":"usr/src/uts/common/os/autoconf.c","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/uts/common/os/ddi_ufm.c","type":"ADDED","insertions":437,"deletions":0},{"file":"usr/src/uts/common/sys/Makefile","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/common/sys/ddi_ufm.h","type":"ADDED","insertions":224,"deletions":0},{"file":"usr/src/uts/common/sys/ddi_ufm_impl.h","type":"ADDED","insertions":87,"deletions":0},{"file":"usr/src/uts/common/sys/scsi/adapters/mpt_sas/mptsas_var.h","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"usr/src/uts/intel/Makefile.intel","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/uts/intel/ufm/Makefile","type":"ADDED","insertions":48,"deletions":0},{"file":"usr/src/uts/intel/ufmtest/Makefile","type":"ADDED","insertions":48,"deletions":0},{"file":"usr/src/uts/sparc/Makefile.sparc","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/sparc/ufm/Makefile","type":"ADDED","insertions":48,"deletions":0},{"file":"usr/src/uts/sparc/ufmtest/Makefile","type":"ADDED","insertions":48,"deletions":0}],"sizeInsertions":4726,"sizeDeletions":-34},{"number":"8","revision":"5676ce99cf3035b7fd6b44fb3da36991d93ddf4b","parents":["e6de8afafa8b73b0636044f094ba810178b0a271"],"ref":"refs/changes/07/6207/8","uploader":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"createdOn":1560449581,"author":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":21,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/hc.c","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/libtopo.h","type":"MODIFIED","insertions":27,"deletions":-2},{"file":"usr/src/lib/fm/topo/libtopo/common/mapfile-vers","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_hc.h","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_mod.c","type":"MODIFIED","insertions":223,"deletions":-1},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_mod.h","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_mod.map","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/lib/fm/topo/modules/common/disk/disk_common.c","type":"MODIFIED","insertions":20,"deletions":0},{"file":"usr/src/lib/fm/topo/modules/common/ipmi/ipmi_enum.c","type":"MODIFIED","insertions":15,"deletions":-1},{"file":"usr/src/lib/fm/topo/modules/common/pcibus/pcibus.c","type":"MODIFIED","insertions":200,"deletions":-1},{"file":"usr/src/lib/fm/topo/modules/common/smbios/smbios_enum.c","type":"MODIFIED","insertions":39,"deletions":-12},{"file":"usr/src/man/man7d/Makefile","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/man/man7d/ufm.7d","type":"ADDED","insertions":206,"deletions":0},{"file":"usr/src/man/man9e/Makefile","type":"MODIFIED","insertions":11,"deletions":-2},{"file":"usr/src/man/man9e/ddi_ufm.9e","type":"ADDED","insertions":420,"deletions":0},{"file":"usr/src/man/man9f/Makefile","type":"MODIFIED","insertions":21,"deletions":-1},{"file":"usr/src/man/man9f/ddi_ufm.9f","type":"ADDED","insertions":162,"deletions":0},{"file":"usr/src/man/man9f/ddi_ufm_image.9f","type":"ADDED","insertions":101,"deletions":0},{"file":"usr/src/man/man9f/ddi_ufm_slot.9f","type":"ADDED","insertions":111,"deletions":0},{"file":"usr/src/test/os-tests/tests/Makefile","type":"MODIFIED","insertions":15,"deletions":-3},{"file":"usr/src/test/os-tests/tests/ddi_ufm/Makefile","type":"ADDED","insertions":51,"deletions":0},{"file":"usr/src/test/os-tests/tests/ddi_ufm/ufm-test.c","type":"ADDED","insertions":898,"deletions":0},{"file":"usr/src/uts/common/Makefile.files","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/common/io/i40e/i40e_main.c","type":"MODIFIED","insertions":94,"deletions":-4},{"file":"usr/src/uts/common/io/i40e/i40e_sw.h","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/mpt_sas/mptsas.c","type":"MODIFIED","insertions":77,"deletions":-2},{"file":"usr/src/uts/common/io/ufm.c","type":"ADDED","insertions":470,"deletions":0},{"file":"usr/src/uts/common/io/ufm.conf","type":"ADDED","insertions":16,"deletions":0},{"file":"usr/src/uts/common/io/ufmtest.c","type":"ADDED","insertions":438,"deletions":0},{"file":"usr/src/uts/common/io/ufmtest.conf","type":"ADDED","insertions":16,"deletions":0},{"file":"usr/src/uts/common/io/ufmtest.h","type":"ADDED","insertions":75,"deletions":0},{"file":"usr/src/uts/common/mapfiles/ddi.mapfile","type":"MODIFIED","insertions":14,"deletions":-1},{"file":"usr/src/uts/common/os/autoconf.c","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/uts/common/os/ddi_ufm.c","type":"ADDED","insertions":451,"deletions":0},{"file":"usr/src/uts/common/sys/Makefile","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/common/sys/ddi_ufm.h","type":"ADDED","insertions":224,"deletions":0},{"file":"usr/src/uts/common/sys/ddi_ufm_impl.h","type":"ADDED","insertions":87,"deletions":0},{"file":"usr/src/uts/common/sys/scsi/adapters/mpt_sas/mptsas_var.h","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"usr/src/uts/intel/Makefile.intel","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/uts/intel/ufm/Makefile","type":"ADDED","insertions":48,"deletions":0},{"file":"usr/src/uts/intel/ufmtest/Makefile","type":"ADDED","insertions":48,"deletions":0},{"file":"usr/src/uts/sparc/Makefile.sparc","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/sparc/ufm/Makefile","type":"ADDED","insertions":48,"deletions":0},{"file":"usr/src/uts/sparc/ufmtest/Makefile","type":"ADDED","insertions":48,"deletions":0}],"sizeInsertions":4740,"sizeDeletions":-34},{"number":"9","revision":"c39511ea7a1b8b77773523da5b96f277bf4adf3d","parents":["e6de8afafa8b73b0636044f094ba810178b0a271"],"ref":"refs/changes/07/6207/9","uploader":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"createdOn":1560451913,"author":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1560452963,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"comments":[{"file":"usr/src/uts/common/os/ddi_ufm.c","line":451,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Looks like we\u0027re missing the free that we\u0027ve done in other paths here."},{"file":"usr/src/uts/common/os/ddi_ufm.c","line":451,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":21,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/hc.c","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/libtopo.h","type":"MODIFIED","insertions":27,"deletions":-2},{"file":"usr/src/lib/fm/topo/libtopo/common/mapfile-vers","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_hc.h","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_mod.c","type":"MODIFIED","insertions":223,"deletions":-1},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_mod.h","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_mod.map","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/lib/fm/topo/modules/common/disk/disk_common.c","type":"MODIFIED","insertions":20,"deletions":0},{"file":"usr/src/lib/fm/topo/modules/common/ipmi/ipmi_enum.c","type":"MODIFIED","insertions":15,"deletions":-1},{"file":"usr/src/lib/fm/topo/modules/common/pcibus/pcibus.c","type":"MODIFIED","insertions":200,"deletions":-1},{"file":"usr/src/lib/fm/topo/modules/common/smbios/smbios_enum.c","type":"MODIFIED","insertions":39,"deletions":-12},{"file":"usr/src/man/man7d/Makefile","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/man/man7d/ufm.7d","type":"ADDED","insertions":206,"deletions":0},{"file":"usr/src/man/man9e/Makefile","type":"MODIFIED","insertions":11,"deletions":-2},{"file":"usr/src/man/man9e/ddi_ufm.9e","type":"ADDED","insertions":420,"deletions":0},{"file":"usr/src/man/man9f/Makefile","type":"MODIFIED","insertions":21,"deletions":-1},{"file":"usr/src/man/man9f/ddi_ufm.9f","type":"ADDED","insertions":162,"deletions":0},{"file":"usr/src/man/man9f/ddi_ufm_image.9f","type":"ADDED","insertions":101,"deletions":0},{"file":"usr/src/man/man9f/ddi_ufm_slot.9f","type":"ADDED","insertions":111,"deletions":0},{"file":"usr/src/test/os-tests/tests/Makefile","type":"MODIFIED","insertions":15,"deletions":-3},{"file":"usr/src/test/os-tests/tests/ddi_ufm/Makefile","type":"ADDED","insertions":51,"deletions":0},{"file":"usr/src/test/os-tests/tests/ddi_ufm/ufm-test.c","type":"ADDED","insertions":898,"deletions":0},{"file":"usr/src/uts/common/Makefile.files","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/common/io/i40e/i40e_main.c","type":"MODIFIED","insertions":94,"deletions":-4},{"file":"usr/src/uts/common/io/i40e/i40e_sw.h","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/mpt_sas/mptsas.c","type":"MODIFIED","insertions":77,"deletions":-2},{"file":"usr/src/uts/common/io/ufm.c","type":"ADDED","insertions":486,"deletions":0},{"file":"usr/src/uts/common/io/ufm.conf","type":"ADDED","insertions":16,"deletions":0},{"file":"usr/src/uts/common/io/ufmtest.c","type":"ADDED","insertions":438,"deletions":0},{"file":"usr/src/uts/common/io/ufmtest.conf","type":"ADDED","insertions":16,"deletions":0},{"file":"usr/src/uts/common/io/ufmtest.h","type":"ADDED","insertions":75,"deletions":0},{"file":"usr/src/uts/common/mapfiles/ddi.mapfile","type":"MODIFIED","insertions":14,"deletions":-1},{"file":"usr/src/uts/common/os/autoconf.c","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/uts/common/os/ddi_ufm.c","type":"ADDED","insertions":451,"deletions":0},{"file":"usr/src/uts/common/sys/Makefile","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/common/sys/ddi_ufm.h","type":"ADDED","insertions":224,"deletions":0},{"file":"usr/src/uts/common/sys/ddi_ufm_impl.h","type":"ADDED","insertions":87,"deletions":0},{"file":"usr/src/uts/common/sys/scsi/adapters/mpt_sas/mptsas_var.h","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"usr/src/uts/intel/Makefile.intel","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/uts/intel/ufm/Makefile","type":"ADDED","insertions":48,"deletions":0},{"file":"usr/src/uts/intel/ufmtest/Makefile","type":"ADDED","insertions":48,"deletions":0},{"file":"usr/src/uts/sparc/Makefile.sparc","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/sparc/ufm/Makefile","type":"ADDED","insertions":48,"deletions":0},{"file":"usr/src/uts/sparc/ufmtest/Makefile","type":"ADDED","insertions":48,"deletions":0}],"sizeInsertions":4756,"sizeDeletions":-34},{"number":"10","revision":"5b01e5fd634c209999dfc09f75525ddf78916b2a","parents":["e6de8afafa8b73b0636044f094ba810178b0a271"],"ref":"refs/changes/07/6207/10","uploader":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"createdOn":1560465462,"author":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1560465786,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1560793604,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1560525590,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":21,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/hc.c","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/libtopo.h","type":"MODIFIED","insertions":27,"deletions":-2},{"file":"usr/src/lib/fm/topo/libtopo/common/mapfile-vers","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_hc.h","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_mod.c","type":"MODIFIED","insertions":223,"deletions":-1},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_mod.h","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_mod.map","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/lib/fm/topo/modules/common/disk/disk_common.c","type":"MODIFIED","insertions":20,"deletions":0},{"file":"usr/src/lib/fm/topo/modules/common/ipmi/ipmi_enum.c","type":"MODIFIED","insertions":15,"deletions":-1},{"file":"usr/src/lib/fm/topo/modules/common/pcibus/pcibus.c","type":"MODIFIED","insertions":200,"deletions":-1},{"file":"usr/src/lib/fm/topo/modules/common/smbios/smbios_enum.c","type":"MODIFIED","insertions":39,"deletions":-12},{"file":"usr/src/man/man7d/Makefile","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/man/man7d/ufm.7d","type":"ADDED","insertions":206,"deletions":0},{"file":"usr/src/man/man9e/Makefile","type":"MODIFIED","insertions":11,"deletions":-2},{"file":"usr/src/man/man9e/ddi_ufm.9e","type":"ADDED","insertions":420,"deletions":0},{"file":"usr/src/man/man9f/Makefile","type":"MODIFIED","insertions":21,"deletions":-1},{"file":"usr/src/man/man9f/ddi_ufm.9f","type":"ADDED","insertions":162,"deletions":0},{"file":"usr/src/man/man9f/ddi_ufm_image.9f","type":"ADDED","insertions":101,"deletions":0},{"file":"usr/src/man/man9f/ddi_ufm_slot.9f","type":"ADDED","insertions":111,"deletions":0},{"file":"usr/src/test/os-tests/tests/Makefile","type":"MODIFIED","insertions":15,"deletions":-3},{"file":"usr/src/test/os-tests/tests/ddi_ufm/Makefile","type":"ADDED","insertions":51,"deletions":0},{"file":"usr/src/test/os-tests/tests/ddi_ufm/ufm-test.c","type":"ADDED","insertions":898,"deletions":0},{"file":"usr/src/uts/common/Makefile.files","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/common/io/i40e/i40e_main.c","type":"MODIFIED","insertions":94,"deletions":-4},{"file":"usr/src/uts/common/io/i40e/i40e_sw.h","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/mpt_sas/mptsas.c","type":"MODIFIED","insertions":77,"deletions":-2},{"file":"usr/src/uts/common/io/ufm.c","type":"ADDED","insertions":486,"deletions":0},{"file":"usr/src/uts/common/io/ufm.conf","type":"ADDED","insertions":16,"deletions":0},{"file":"usr/src/uts/common/io/ufmtest.c","type":"ADDED","insertions":438,"deletions":0},{"file":"usr/src/uts/common/io/ufmtest.conf","type":"ADDED","insertions":16,"deletions":0},{"file":"usr/src/uts/common/io/ufmtest.h","type":"ADDED","insertions":75,"deletions":0},{"file":"usr/src/uts/common/mapfiles/ddi.mapfile","type":"MODIFIED","insertions":14,"deletions":-1},{"file":"usr/src/uts/common/os/autoconf.c","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/uts/common/os/ddi_ufm.c","type":"ADDED","insertions":452,"deletions":0},{"file":"usr/src/uts/common/sys/Makefile","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/common/sys/ddi_ufm.h","type":"ADDED","insertions":224,"deletions":0},{"file":"usr/src/uts/common/sys/ddi_ufm_impl.h","type":"ADDED","insertions":87,"deletions":0},{"file":"usr/src/uts/common/sys/scsi/adapters/mpt_sas/mptsas_var.h","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"usr/src/uts/intel/Makefile.intel","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/uts/intel/ufm/Makefile","type":"ADDED","insertions":48,"deletions":0},{"file":"usr/src/uts/intel/ufmtest/Makefile","type":"ADDED","insertions":48,"deletions":0},{"file":"usr/src/uts/sparc/Makefile.sparc","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/sparc/ufm/Makefile","type":"ADDED","insertions":48,"deletions":0},{"file":"usr/src/uts/sparc/ufmtest/Makefile","type":"ADDED","insertions":48,"deletions":0}],"sizeInsertions":4757,"sizeDeletions":-34},{"number":"11","revision":"cca40d8e38d08e77f471d27f521a08507d393439","parents":["f8f6faa3a1f8b695cb68dbbb37c24f72b6973d4e"],"ref":"refs/changes/07/6207/11","uploader":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"createdOn":1560799026,"author":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":21,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/hc.c","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/libtopo.h","type":"MODIFIED","insertions":26,"deletions":-1},{"file":"usr/src/lib/fm/topo/libtopo/common/mapfile-vers","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_hc.h","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_mod.c","type":"MODIFIED","insertions":223,"deletions":-1},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_mod.h","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_mod.map","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/lib/fm/topo/modules/common/disk/disk_common.c","type":"MODIFIED","insertions":20,"deletions":0},{"file":"usr/src/lib/fm/topo/modules/common/ipmi/ipmi_enum.c","type":"MODIFIED","insertions":15,"deletions":-1},{"file":"usr/src/lib/fm/topo/modules/common/pcibus/pcibus.c","type":"MODIFIED","insertions":200,"deletions":-1},{"file":"usr/src/lib/fm/topo/modules/common/smbios/smbios_enum.c","type":"MODIFIED","insertions":39,"deletions":-12},{"file":"usr/src/man/man7d/Makefile","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/man/man7d/ufm.7d","type":"ADDED","insertions":206,"deletions":0},{"file":"usr/src/man/man9e/Makefile","type":"MODIFIED","insertions":11,"deletions":-2},{"file":"usr/src/man/man9e/ddi_ufm.9e","type":"ADDED","insertions":420,"deletions":0},{"file":"usr/src/man/man9f/Makefile","type":"MODIFIED","insertions":21,"deletions":-1},{"file":"usr/src/man/man9f/ddi_ufm.9f","type":"ADDED","insertions":162,"deletions":0},{"file":"usr/src/man/man9f/ddi_ufm_image.9f","type":"ADDED","insertions":101,"deletions":0},{"file":"usr/src/man/man9f/ddi_ufm_slot.9f","type":"ADDED","insertions":111,"deletions":0},{"file":"usr/src/test/os-tests/tests/Makefile","type":"MODIFIED","insertions":15,"deletions":-3},{"file":"usr/src/test/os-tests/tests/ddi_ufm/Makefile","type":"ADDED","insertions":51,"deletions":0},{"file":"usr/src/test/os-tests/tests/ddi_ufm/ufm-test.c","type":"ADDED","insertions":898,"deletions":0},{"file":"usr/src/uts/common/Makefile.files","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/common/io/i40e/i40e_main.c","type":"MODIFIED","insertions":94,"deletions":-4},{"file":"usr/src/uts/common/io/i40e/i40e_sw.h","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/mpt_sas/mptsas.c","type":"MODIFIED","insertions":77,"deletions":-2},{"file":"usr/src/uts/common/io/ufm.c","type":"ADDED","insertions":486,"deletions":0},{"file":"usr/src/uts/common/io/ufm.conf","type":"ADDED","insertions":16,"deletions":0},{"file":"usr/src/uts/common/io/ufmtest.c","type":"ADDED","insertions":438,"deletions":0},{"file":"usr/src/uts/common/io/ufmtest.conf","type":"ADDED","insertions":16,"deletions":0},{"file":"usr/src/uts/common/io/ufmtest.h","type":"ADDED","insertions":75,"deletions":0},{"file":"usr/src/uts/common/mapfiles/ddi.mapfile","type":"MODIFIED","insertions":14,"deletions":-1},{"file":"usr/src/uts/common/os/autoconf.c","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/uts/common/os/ddi_ufm.c","type":"ADDED","insertions":452,"deletions":0},{"file":"usr/src/uts/common/sys/Makefile","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/common/sys/ddi_ufm.h","type":"ADDED","insertions":224,"deletions":0},{"file":"usr/src/uts/common/sys/ddi_ufm_impl.h","type":"ADDED","insertions":87,"deletions":0},{"file":"usr/src/uts/common/sys/scsi/adapters/mpt_sas/mptsas_var.h","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"usr/src/uts/intel/Makefile.intel","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/uts/intel/ufm/Makefile","type":"ADDED","insertions":48,"deletions":0},{"file":"usr/src/uts/intel/ufmtest/Makefile","type":"ADDED","insertions":48,"deletions":0},{"file":"usr/src/uts/sparc/Makefile.sparc","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/sparc/ufm/Makefile","type":"ADDED","insertions":48,"deletions":0},{"file":"usr/src/uts/sparc/ufmtest/Makefile","type":"ADDED","insertions":48,"deletions":0}],"sizeInsertions":4756,"sizeDeletions":-33},{"number":"12","revision":"b90d8d5df756a4a1b324700922520acee7ba7d2d","parents":["f8f6faa3a1f8b695cb68dbbb37c24f72b6973d4e"],"ref":"refs/changes/07/6207/12","uploader":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"createdOn":1560799266,"author":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1560808046,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1560808283,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1560804673,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":21,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/hc.c","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/libtopo.h","type":"MODIFIED","insertions":26,"deletions":-1},{"file":"usr/src/lib/fm/topo/libtopo/common/mapfile-vers","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_hc.h","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_mod.c","type":"MODIFIED","insertions":223,"deletions":-1},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_mod.h","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_mod.map","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/lib/fm/topo/modules/common/disk/disk_common.c","type":"MODIFIED","insertions":20,"deletions":0},{"file":"usr/src/lib/fm/topo/modules/common/ipmi/ipmi_enum.c","type":"MODIFIED","insertions":15,"deletions":-1},{"file":"usr/src/lib/fm/topo/modules/common/pcibus/pcibus.c","type":"MODIFIED","insertions":200,"deletions":-1},{"file":"usr/src/lib/fm/topo/modules/common/smbios/smbios_enum.c","type":"MODIFIED","insertions":39,"deletions":-12},{"file":"usr/src/man/man7d/Makefile","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/man/man7d/ufm.7d","type":"ADDED","insertions":206,"deletions":0},{"file":"usr/src/man/man9e/Makefile","type":"MODIFIED","insertions":11,"deletions":-2},{"file":"usr/src/man/man9e/ddi_ufm.9e","type":"ADDED","insertions":420,"deletions":0},{"file":"usr/src/man/man9f/Makefile","type":"MODIFIED","insertions":21,"deletions":-1},{"file":"usr/src/man/man9f/ddi_ufm.9f","type":"ADDED","insertions":162,"deletions":0},{"file":"usr/src/man/man9f/ddi_ufm_image.9f","type":"ADDED","insertions":101,"deletions":0},{"file":"usr/src/man/man9f/ddi_ufm_slot.9f","type":"ADDED","insertions":111,"deletions":0},{"file":"usr/src/test/os-tests/tests/Makefile","type":"MODIFIED","insertions":15,"deletions":-3},{"file":"usr/src/test/os-tests/tests/ddi_ufm/Makefile","type":"ADDED","insertions":51,"deletions":0},{"file":"usr/src/test/os-tests/tests/ddi_ufm/ufm-test.c","type":"ADDED","insertions":898,"deletions":0},{"file":"usr/src/uts/common/Makefile.files","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/common/io/i40e/i40e_main.c","type":"MODIFIED","insertions":94,"deletions":-4},{"file":"usr/src/uts/common/io/i40e/i40e_sw.h","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/mpt_sas/mptsas.c","type":"MODIFIED","insertions":77,"deletions":-2},{"file":"usr/src/uts/common/io/ufm.c","type":"ADDED","insertions":486,"deletions":0},{"file":"usr/src/uts/common/io/ufm.conf","type":"ADDED","insertions":16,"deletions":0},{"file":"usr/src/uts/common/io/ufmtest.c","type":"ADDED","insertions":438,"deletions":0},{"file":"usr/src/uts/common/io/ufmtest.conf","type":"ADDED","insertions":16,"deletions":0},{"file":"usr/src/uts/common/io/ufmtest.h","type":"ADDED","insertions":75,"deletions":0},{"file":"usr/src/uts/common/mapfiles/ddi.mapfile","type":"MODIFIED","insertions":14,"deletions":-1},{"file":"usr/src/uts/common/os/autoconf.c","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/uts/common/os/ddi_ufm.c","type":"ADDED","insertions":452,"deletions":0},{"file":"usr/src/uts/common/sys/Makefile","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/common/sys/ddi_ufm.h","type":"ADDED","insertions":224,"deletions":0},{"file":"usr/src/uts/common/sys/ddi_ufm_impl.h","type":"ADDED","insertions":87,"deletions":0},{"file":"usr/src/uts/common/sys/scsi/adapters/mpt_sas/mptsas_var.h","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"usr/src/uts/intel/Makefile.intel","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/uts/intel/ufm/Makefile","type":"ADDED","insertions":48,"deletions":0},{"file":"usr/src/uts/intel/ufmtest/Makefile","type":"ADDED","insertions":48,"deletions":0},{"file":"usr/src/uts/sparc/Makefile.sparc","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/sparc/ufm/Makefile","type":"ADDED","insertions":48,"deletions":0},{"file":"usr/src/uts/sparc/ufmtest/Makefile","type":"ADDED","insertions":48,"deletions":0}],"sizeInsertions":4756,"sizeDeletions":-33},{"number":"13","revision":"832d8c5c389ece3054b1c7e66ca160c3485f9229","parents":["4227bcffd4e1abf8a3987dbe0f649d7cc7ea4940"],"ref":"refs/changes/07/6207/13","uploader":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"createdOn":1560881550,"author":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1560808046,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1560808283,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1560804673,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":21,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/hc.c","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/libtopo.h","type":"MODIFIED","insertions":26,"deletions":-1},{"file":"usr/src/lib/fm/topo/libtopo/common/mapfile-vers","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_hc.h","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_mod.c","type":"MODIFIED","insertions":223,"deletions":-1},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_mod.h","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_mod.map","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/lib/fm/topo/modules/common/disk/disk_common.c","type":"MODIFIED","insertions":20,"deletions":0},{"file":"usr/src/lib/fm/topo/modules/common/ipmi/ipmi_enum.c","type":"MODIFIED","insertions":15,"deletions":-1},{"file":"usr/src/lib/fm/topo/modules/common/pcibus/pcibus.c","type":"MODIFIED","insertions":200,"deletions":-1},{"file":"usr/src/lib/fm/topo/modules/common/smbios/smbios_enum.c","type":"MODIFIED","insertions":39,"deletions":-12},{"file":"usr/src/man/man7d/Makefile","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/man/man7d/ufm.7d","type":"ADDED","insertions":206,"deletions":0},{"file":"usr/src/man/man9e/Makefile","type":"MODIFIED","insertions":11,"deletions":-2},{"file":"usr/src/man/man9e/ddi_ufm.9e","type":"ADDED","insertions":420,"deletions":0},{"file":"usr/src/man/man9f/Makefile","type":"MODIFIED","insertions":21,"deletions":-1},{"file":"usr/src/man/man9f/ddi_ufm.9f","type":"ADDED","insertions":162,"deletions":0},{"file":"usr/src/man/man9f/ddi_ufm_image.9f","type":"ADDED","insertions":101,"deletions":0},{"file":"usr/src/man/man9f/ddi_ufm_slot.9f","type":"ADDED","insertions":111,"deletions":0},{"file":"usr/src/test/os-tests/tests/Makefile","type":"MODIFIED","insertions":15,"deletions":-3},{"file":"usr/src/test/os-tests/tests/ddi_ufm/Makefile","type":"ADDED","insertions":51,"deletions":0},{"file":"usr/src/test/os-tests/tests/ddi_ufm/ufm-test.c","type":"ADDED","insertions":898,"deletions":0},{"file":"usr/src/uts/common/Makefile.files","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/common/io/i40e/i40e_main.c","type":"MODIFIED","insertions":94,"deletions":-4},{"file":"usr/src/uts/common/io/i40e/i40e_sw.h","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/mpt_sas/mptsas.c","type":"MODIFIED","insertions":77,"deletions":-2},{"file":"usr/src/uts/common/io/ufm.c","type":"ADDED","insertions":486,"deletions":0},{"file":"usr/src/uts/common/io/ufm.conf","type":"ADDED","insertions":16,"deletions":0},{"file":"usr/src/uts/common/io/ufmtest.c","type":"ADDED","insertions":438,"deletions":0},{"file":"usr/src/uts/common/io/ufmtest.conf","type":"ADDED","insertions":16,"deletions":0},{"file":"usr/src/uts/common/io/ufmtest.h","type":"ADDED","insertions":75,"deletions":0},{"file":"usr/src/uts/common/mapfiles/ddi.mapfile","type":"MODIFIED","insertions":14,"deletions":-1},{"file":"usr/src/uts/common/os/autoconf.c","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/uts/common/os/ddi_ufm.c","type":"ADDED","insertions":452,"deletions":0},{"file":"usr/src/uts/common/sys/Makefile","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/common/sys/ddi_ufm.h","type":"ADDED","insertions":224,"deletions":0},{"file":"usr/src/uts/common/sys/ddi_ufm_impl.h","type":"ADDED","insertions":87,"deletions":0},{"file":"usr/src/uts/common/sys/scsi/adapters/mpt_sas/mptsas_var.h","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"usr/src/uts/intel/Makefile.intel","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/uts/intel/ufm/Makefile","type":"ADDED","insertions":48,"deletions":0},{"file":"usr/src/uts/intel/ufmtest/Makefile","type":"ADDED","insertions":48,"deletions":0},{"file":"usr/src/uts/sparc/Makefile.sparc","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/sparc/ufm/Makefile","type":"ADDED","insertions":48,"deletions":0},{"file":"usr/src/uts/sparc/ufmtest/Makefile","type":"ADDED","insertions":48,"deletions":0}],"sizeInsertions":4756,"sizeDeletions":-33},{"number":"14","revision":"40d9d53a4d8e485601f4285b03848a2c80e5fdd8","parents":["4227bcffd4e1abf8a3987dbe0f649d7cc7ea4940"],"ref":"refs/changes/07/6207/14","uploader":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"createdOn":1560965140,"author":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1560968335,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1560973184,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1560965495,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":21,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/hc.c","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/libtopo.h","type":"MODIFIED","insertions":26,"deletions":-1},{"file":"usr/src/lib/fm/topo/libtopo/common/mapfile-vers","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_hc.h","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_mod.c","type":"MODIFIED","insertions":223,"deletions":-1},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_mod.h","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_mod.map","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/lib/fm/topo/modules/common/disk/disk_common.c","type":"MODIFIED","insertions":20,"deletions":0},{"file":"usr/src/lib/fm/topo/modules/common/ipmi/ipmi_enum.c","type":"MODIFIED","insertions":15,"deletions":-1},{"file":"usr/src/lib/fm/topo/modules/common/pcibus/pcibus.c","type":"MODIFIED","insertions":200,"deletions":-1},{"file":"usr/src/lib/fm/topo/modules/common/smbios/smbios_enum.c","type":"MODIFIED","insertions":39,"deletions":-12},{"file":"usr/src/man/man7d/Makefile","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/man/man7d/ufm.7d","type":"ADDED","insertions":206,"deletions":0},{"file":"usr/src/man/man9e/Makefile","type":"MODIFIED","insertions":11,"deletions":-2},{"file":"usr/src/man/man9e/ddi_ufm.9e","type":"ADDED","insertions":420,"deletions":0},{"file":"usr/src/man/man9f/Makefile","type":"MODIFIED","insertions":21,"deletions":-1},{"file":"usr/src/man/man9f/ddi_ufm.9f","type":"ADDED","insertions":162,"deletions":0},{"file":"usr/src/man/man9f/ddi_ufm_image.9f","type":"ADDED","insertions":101,"deletions":0},{"file":"usr/src/man/man9f/ddi_ufm_slot.9f","type":"ADDED","insertions":111,"deletions":0},{"file":"usr/src/test/os-tests/tests/Makefile","type":"MODIFIED","insertions":15,"deletions":-3},{"file":"usr/src/test/os-tests/tests/ddi_ufm/Makefile","type":"ADDED","insertions":51,"deletions":0},{"file":"usr/src/test/os-tests/tests/ddi_ufm/ufm-test.c","type":"ADDED","insertions":897,"deletions":0},{"file":"usr/src/uts/common/Makefile.files","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/common/io/i40e/i40e_main.c","type":"MODIFIED","insertions":94,"deletions":-4},{"file":"usr/src/uts/common/io/i40e/i40e_sw.h","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/mpt_sas/mptsas.c","type":"MODIFIED","insertions":77,"deletions":-2},{"file":"usr/src/uts/common/io/ufm.c","type":"ADDED","insertions":486,"deletions":0},{"file":"usr/src/uts/common/io/ufm.conf","type":"ADDED","insertions":16,"deletions":0},{"file":"usr/src/uts/common/io/ufmtest.c","type":"ADDED","insertions":438,"deletions":0},{"file":"usr/src/uts/common/io/ufmtest.conf","type":"ADDED","insertions":16,"deletions":0},{"file":"usr/src/uts/common/io/ufmtest.h","type":"ADDED","insertions":75,"deletions":0},{"file":"usr/src/uts/common/mapfiles/ddi.mapfile","type":"MODIFIED","insertions":14,"deletions":-1},{"file":"usr/src/uts/common/os/autoconf.c","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/uts/common/os/ddi_ufm.c","type":"ADDED","insertions":452,"deletions":0},{"file":"usr/src/uts/common/sys/Makefile","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/common/sys/ddi_ufm.h","type":"ADDED","insertions":224,"deletions":0},{"file":"usr/src/uts/common/sys/ddi_ufm_impl.h","type":"ADDED","insertions":87,"deletions":0},{"file":"usr/src/uts/common/sys/scsi/adapters/mpt_sas/mptsas_var.h","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"usr/src/uts/intel/Makefile.intel","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/uts/intel/ufm/Makefile","type":"ADDED","insertions":48,"deletions":0},{"file":"usr/src/uts/intel/ufmtest/Makefile","type":"ADDED","insertions":48,"deletions":0},{"file":"usr/src/uts/sparc/Makefile.sparc","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/sparc/ufm/Makefile","type":"ADDED","insertions":48,"deletions":0},{"file":"usr/src/uts/sparc/ufmtest/Makefile","type":"ADDED","insertions":48,"deletions":0}],"sizeInsertions":4755,"sizeDeletions":-33},{"number":"15","revision":"285d665c1bfb19b7a0d31074cbb554aae649ca56","parents":["bc37b38f8fdf93069034adc55ecc3fae8f6fd639"],"ref":"refs/changes/07/6207/15","uploader":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"createdOn":1560987524,"author":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1560968335,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1560973184,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1560965495,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"SUBM","value":"1","grantedOn":1560987719,"by":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":21,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/hc.c","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/libtopo.h","type":"MODIFIED","insertions":26,"deletions":-1},{"file":"usr/src/lib/fm/topo/libtopo/common/mapfile-vers","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_hc.h","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_mod.c","type":"MODIFIED","insertions":223,"deletions":-1},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_mod.h","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_mod.map","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/lib/fm/topo/modules/common/disk/disk_common.c","type":"MODIFIED","insertions":20,"deletions":0},{"file":"usr/src/lib/fm/topo/modules/common/ipmi/ipmi_enum.c","type":"MODIFIED","insertions":15,"deletions":-1},{"file":"usr/src/lib/fm/topo/modules/common/pcibus/pcibus.c","type":"MODIFIED","insertions":200,"deletions":-1},{"file":"usr/src/lib/fm/topo/modules/common/smbios/smbios_enum.c","type":"MODIFIED","insertions":39,"deletions":-12},{"file":"usr/src/man/man7d/Makefile","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/man/man7d/ufm.7d","type":"ADDED","insertions":206,"deletions":0},{"file":"usr/src/man/man9e/Makefile","type":"MODIFIED","insertions":11,"deletions":-2},{"file":"usr/src/man/man9e/ddi_ufm.9e","type":"ADDED","insertions":420,"deletions":0},{"file":"usr/src/man/man9f/Makefile","type":"MODIFIED","insertions":21,"deletions":-1},{"file":"usr/src/man/man9f/ddi_ufm.9f","type":"ADDED","insertions":162,"deletions":0},{"file":"usr/src/man/man9f/ddi_ufm_image.9f","type":"ADDED","insertions":101,"deletions":0},{"file":"usr/src/man/man9f/ddi_ufm_slot.9f","type":"ADDED","insertions":111,"deletions":0},{"file":"usr/src/test/os-tests/tests/Makefile","type":"MODIFIED","insertions":15,"deletions":-3},{"file":"usr/src/test/os-tests/tests/ddi_ufm/Makefile","type":"ADDED","insertions":51,"deletions":0},{"file":"usr/src/test/os-tests/tests/ddi_ufm/ufm-test.c","type":"ADDED","insertions":897,"deletions":0},{"file":"usr/src/uts/common/Makefile.files","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/common/io/i40e/i40e_main.c","type":"MODIFIED","insertions":94,"deletions":-4},{"file":"usr/src/uts/common/io/i40e/i40e_sw.h","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/mpt_sas/mptsas.c","type":"MODIFIED","insertions":77,"deletions":-2},{"file":"usr/src/uts/common/io/ufm.c","type":"ADDED","insertions":486,"deletions":0},{"file":"usr/src/uts/common/io/ufm.conf","type":"ADDED","insertions":16,"deletions":0},{"file":"usr/src/uts/common/io/ufmtest.c","type":"ADDED","insertions":438,"deletions":0},{"file":"usr/src/uts/common/io/ufmtest.conf","type":"ADDED","insertions":16,"deletions":0},{"file":"usr/src/uts/common/io/ufmtest.h","type":"ADDED","insertions":75,"deletions":0},{"file":"usr/src/uts/common/mapfiles/ddi.mapfile","type":"MODIFIED","insertions":14,"deletions":-1},{"file":"usr/src/uts/common/os/autoconf.c","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/uts/common/os/ddi_ufm.c","type":"ADDED","insertions":452,"deletions":0},{"file":"usr/src/uts/common/sys/Makefile","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/common/sys/ddi_ufm.h","type":"ADDED","insertions":224,"deletions":0},{"file":"usr/src/uts/common/sys/ddi_ufm_impl.h","type":"ADDED","insertions":87,"deletions":0},{"file":"usr/src/uts/common/sys/scsi/adapters/mpt_sas/mptsas_var.h","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"usr/src/uts/intel/Makefile.intel","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/uts/intel/ufm/Makefile","type":"ADDED","insertions":48,"deletions":0},{"file":"usr/src/uts/intel/ufmtest/Makefile","type":"ADDED","insertions":48,"deletions":0},{"file":"usr/src/uts/sparc/Makefile.sparc","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/sparc/ufm/Makefile","type":"ADDED","insertions":48,"deletions":0},{"file":"usr/src/uts/sparc/ufmtest/Makefile","type":"ADDED","insertions":48,"deletions":0}],"sizeInsertions":4755,"sizeDeletions":-33}],"allReviewers":[{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"}]}