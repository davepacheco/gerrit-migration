{"project":"joyent/smartos-live","branch":"master","id":"I42ee47eb957ff65d0ec90a1efefadf94c7e1eca4","number":"5053","subject":"OS-7368 vminfod has naive logic for determining zone deletion Reviewed by: Josh Wilsdon \u003cjosh@wilsdon.ca\u003e Approved by: Josh Wilsdon \u003cjosh@wilsdon.ca\u003e","owner":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"url":"https://cr.joyent.us/5053","commitMessage":"OS-7368 vminfod has naive logic for determining zone deletion\nReviewed by: Josh Wilsdon \u003cjosh@wilsdon.ca\u003e\nApproved by: Josh Wilsdon \u003cjosh@wilsdon.ca\u003e\n","createdOn":1542131924,"lastUpdated":1543339193,"open":false,"status":"MERGED","comments":[{"timestamp":1542131924,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Uploaded patch set 1."},{"timestamp":1542131927,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit c18e90798de0d80bb10b6d82b9b8b319a2b26864\n    \n    initial commit"},{"timestamp":1542131972,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1542395443,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Uploaded patch set 2."},{"timestamp":1542395446,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit fd760ff2e4b19fe1230f66fb89848fb97531a628\n    \n    autoboot: false, hide vminfod logging\n    \n    commit 683774576480d0b22004b4a5a81094c5f0770939\n    \n    initial commit"},{"timestamp":1542395511,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1542395699,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Uploaded patch set 3: Patch Set 2 was rebased."},{"timestamp":1542395703,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 3:\n\nNew commits:\n    \n    commit 30819ea0616322cedfdd36f32399d61a8d6eb64d\n    \n    autoboot: false, hide vminfod logging\n    \n    commit 36fbcf6fb9be179b7446d6846c1a8d1fd2a46842\n    \n    initial commit"},{"timestamp":1542395768,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3:\n\n\"make check\" passed ok"},{"timestamp":1542657590,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Uploaded patch set 4."},{"timestamp":1542657593,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 4:\n\nNew commits:\n    \n    commit e51f9d81d92752942758c199317d36fe7f0478a5\n    \n    use `mv`, mention EXDEV"},{"timestamp":1542657641,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1542661842,"reviewer":{"name":"Jorge Schrauwen","email":"sjorge@blackdot.be","username":"sjorge"},"message":"Patch Set 4:\n\n(1 comment)"},{"timestamp":1542670198,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 4:\n\n(1 comment)"},{"timestamp":1542821347,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Uploaded patch set 5: Patch Set 4 was rebased."},{"timestamp":1542821351,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 5:\n\nNew commits:\n    \n    commit 3be21177fce0ad906fa1fff4cdd63b8312fdb8f1\n    \n    use `mv`, mention EXDEV\n    \n    commit 07a9603a45ab33e09343b1efbb19e9946fb1718b\n    \n    autoboot: false, hide vminfod logging\n    \n    commit 69af7c3b2c48753b4f2ebdb8c418182c7a1d6798\n    \n    initial commit"},{"timestamp":1542821426,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5:\n\n\"make check\" passed ok"},{"timestamp":1543254195,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Uploaded patch set 6: Patch Set 5 was rebased."},{"timestamp":1543254199,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 6:\n\nNew commits:\n    \n    commit ff3551ebdcbf8803b03c7902c097e70ba6db9352\n    \n    use `mv`, mention EXDEV\n    \n    commit dd0f18c574ee67529f31e3e8148df53a6d3e83c1\n    \n    autoboot: false, hide vminfod logging\n    \n    commit 20b71a31248c48f5041c6ecf754cbae3aea90e02\n    \n    initial commit"},{"timestamp":1543254252,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 6:\n\n\"make check\" passed ok"},{"timestamp":1543263126,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 6:\n\n(2 comments)"},{"timestamp":1543263820,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 6:\n\n(2 comments)"},{"timestamp":1543265525,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 6:\n\n(1 comment)"},{"timestamp":1543271508,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Uploaded patch set 7."},{"timestamp":1543271512,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 7:\n\nNew commits:\n    \n    commit fcb898fe5bd3d75f39cc222899112174ab89652e\n    \n    make handleChange handle callback properly"},{"timestamp":1543271566,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 7: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1543271578,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 7: Code-Review+1"},{"timestamp":1543281991,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 7: Integration-Approval+1\n\nlgtm"},{"timestamp":1543339179,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Uploaded patch set 8: Commit message was updated."},{"timestamp":1543339193,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Dave Eddy"}],"currentPatchSet":{"number":"8","revision":"42ee47eb957ff65d0ec90a1efefadf94c7e1eca4","parents":["8a53b52438a53d661577a290a5f786736bf7d717"],"ref":"refs/changes/53/5053/8","uploader":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"createdOn":1543339179,"author":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1543271566,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1543271578,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1543281991,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"SUBM","value":"1","grantedOn":1543339193,"by":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"src/vm/node_modules/vminfod/vminfod.js","type":"MODIFIED","insertions":75,"deletions":-11},{"file":"src/vm/tests/test-vminfod.js","type":"MODIFIED","insertions":186,"deletions":-2}],"sizeInsertions":261,"sizeDeletions":-13},"patchSets":[{"number":"1","revision":"02faf3a419e8fc36ea3b1d942b7d543d78c1dad4","parents":["d4982e056e750e83e4d44e94c41395c75a07b766"],"ref":"refs/changes/53/5053/1","uploader":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"createdOn":1542131924,"author":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1542131972,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/vm/node_modules/vminfod/vminfod.js","type":"MODIFIED","insertions":72,"deletions":-10},{"file":"src/vm/tests/test-vminfod.js","type":"MODIFIED","insertions":175,"deletions":-1}],"sizeInsertions":247,"sizeDeletions":-11},{"number":"2","revision":"8bfc8e4fe6228cbe30ea4016de0858ec594879ec","parents":["f6f6b0466549de4784d1f9e50d899fd6ac02294e"],"ref":"refs/changes/53/5053/2","uploader":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"createdOn":1542395443,"author":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1542395511,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/vm/node_modules/vminfod/vminfod.js","type":"MODIFIED","insertions":72,"deletions":-10},{"file":"src/vm/tests/test-vminfod.js","type":"MODIFIED","insertions":158,"deletions":-1}],"sizeInsertions":230,"sizeDeletions":-11},{"number":"3","revision":"cd4c0610974a33b43292e166758a379a2861c4da","parents":["3c1aa42777928dc08c97839aefbb5fbbad7f0228"],"ref":"refs/changes/53/5053/3","uploader":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"createdOn":1542395699,"author":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1542395511,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/vm/node_modules/vminfod/vminfod.js","type":"MODIFIED","insertions":72,"deletions":-10},{"file":"src/vm/tests/test-vminfod.js","type":"MODIFIED","insertions":158,"deletions":-1}],"sizeInsertions":230,"sizeDeletions":-11},{"number":"4","revision":"76893a13d3973e0e372c629e3aa3ac8f8eb9a6ee","parents":["3c1aa42777928dc08c97839aefbb5fbbad7f0228"],"ref":"refs/changes/53/5053/4","uploader":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"createdOn":1542657590,"author":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1542657641,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"src/vm/node_modules/vminfod/vminfod.js","line":2086,"reviewer":{"name":"Jorge Schrauwen","email":"sjorge@blackdot.be","username":"sjorge"},"message":"Some ident funkyness? Or is it just gerrit?"},{"file":"src/vm/node_modules/vminfod/vminfod.js","line":2086,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"I don\u0027t see anything funky I my end.  If you are seeing something weird my money is on it being Gerrit :p."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/vm/node_modules/vminfod/vminfod.js","type":"MODIFIED","insertions":72,"deletions":-10},{"file":"src/vm/tests/test-vminfod.js","type":"MODIFIED","insertions":186,"deletions":-2}],"sizeInsertions":258,"sizeDeletions":-12},{"number":"5","revision":"02f48177ca8033eee74f07a6f99f1004b7f378cd","parents":["ed6c20fdaae08db70ac5bbf60ba6c3d2e53dc6a2"],"ref":"refs/changes/53/5053/5","uploader":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"createdOn":1542821347,"author":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1542657641,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/vm/node_modules/vminfod/vminfod.js","type":"MODIFIED","insertions":72,"deletions":-10},{"file":"src/vm/tests/test-vminfod.js","type":"MODIFIED","insertions":186,"deletions":-2}],"sizeInsertions":258,"sizeDeletions":-12},{"number":"6","revision":"59ea4446fbb698cfbd6533827a1fec9c43dd1b22","parents":["8a53b52438a53d661577a290a5f786736bf7d717"],"ref":"refs/changes/53/5053/6","uploader":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"createdOn":1543254195,"author":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1542657641,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"src/vm/node_modules/vminfod/vminfod.js","line":2108,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"doesn\u0027t callback() need to be called here? If not, where does it get called when there\u0027s no error?"},{"file":"src/vm/node_modules/vminfod/vminfod.js","line":2108,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Since I added the `handleChange` function in this change it may not be perfectly obvious, but \"callback\" is in scope for that function, and it is called at the end of \"handleChange\" with the call to \"self.refreshVmobj\"."},{"file":"src/vm/node_modules/vminfod/vminfod.js","line":2108,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Ah, I see. Would it be possible to add a comment that just says that handleChange calls callback? Just to make that more obvious for others who are reading this code and miss that too?"},{"file":"src/vm/node_modules/vminfod/vminfod.js","line":2113,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"here also: where is callback() called?"},{"file":"src/vm/node_modules/vminfod/vminfod.js","line":2136,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"^ \"callback\" is passed to this function."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/vm/node_modules/vminfod/vminfod.js","type":"MODIFIED","insertions":72,"deletions":-10},{"file":"src/vm/tests/test-vminfod.js","type":"MODIFIED","insertions":186,"deletions":-2}],"sizeInsertions":258,"sizeDeletions":-12},{"number":"7","revision":"5980f41c9e55a26b28fbe99a3a539189fc46a10e","parents":["8a53b52438a53d661577a290a5f786736bf7d717"],"ref":"refs/changes/53/5053/7","uploader":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"createdOn":1543271508,"author":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1543271566,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1543271578,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1543281991,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/vm/node_modules/vminfod/vminfod.js","type":"MODIFIED","insertions":75,"deletions":-11},{"file":"src/vm/tests/test-vminfod.js","type":"MODIFIED","insertions":186,"deletions":-2}],"sizeInsertions":261,"sizeDeletions":-13},{"number":"8","revision":"42ee47eb957ff65d0ec90a1efefadf94c7e1eca4","parents":["8a53b52438a53d661577a290a5f786736bf7d717"],"ref":"refs/changes/53/5053/8","uploader":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"createdOn":1543339179,"author":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1543271566,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1543271578,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1543281991,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"SUBM","value":"1","grantedOn":1543339193,"by":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"src/vm/node_modules/vminfod/vminfod.js","type":"MODIFIED","insertions":75,"deletions":-11},{"file":"src/vm/tests/test-vminfod.js","type":"MODIFIED","insertions":186,"deletions":-2}],"sizeInsertions":261,"sizeDeletions":-13}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},{"name":"Jorge Schrauwen","email":"sjorge@blackdot.be","username":"sjorge"}]}