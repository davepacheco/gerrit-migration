{"project":"joyent/illumos-joyent","branch":"master","id":"I3a1da6de2a216503918b00b0a4524e613a8134d8","number":"6319","subject":"OS-7797 vdev_disk_io_start will panic the system if ldi_strategy returns an error. Reviewed by: Kody Kantor \u003ckody.kantor@joyent.com\u003e Approved by: Kody Kantor \u003ckody.kantor@joyent.com\u003e","owner":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"url":"https://cr.joyent.us/6319","commitMessage":"OS-7797 vdev_disk_io_start will panic the system if ldi_strategy returns an error.\nReviewed by: Kody Kantor \u003ckody.kantor@joyent.com\u003e\nApproved by: Kody Kantor \u003ckody.kantor@joyent.com\u003e\n","createdOn":1558127461,"lastUpdated":1558452542,"open":false,"status":"MERGED","comments":[{"timestamp":1558127461,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 1."},{"timestamp":1558365749,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 1:\n\n(1 comment)\n\nThanks. I just have a question about how this generally works.\n\nDo you think we should change the bug name to be more descriptive of the problem?"},{"timestamp":1558368603,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 1:\n\n(1 comment)\n\nI can change the bug synopsis."},{"timestamp":1558372152,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 2: Commit message was updated."},{"timestamp":1558376505,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 2: Code-Review+1"},{"timestamp":1558376682,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 2:\n\nI added a short testing note in the bug report."},{"timestamp":1558448932,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 2: Integration-Approval+1"},{"timestamp":1558452405,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 3."},{"timestamp":1558452502,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 3: Code-Review+1 Integration-Approval+1"},{"timestamp":1558452542,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Jerry Jelinek"}],"currentPatchSet":{"number":"3","revision":"3a1da6de2a216503918b00b0a4524e613a8134d8","parents":["84af6eface8c46fc41fa613c296cde40e03d557b"],"ref":"refs/changes/19/6319/3","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1558452405,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1558452502,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1558452502,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}},{"type":"SUBM","value":"1","grantedOn":1558452542,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/uts/common/fs/zfs/vdev_disk.c","type":"MODIFIED","insertions":10,"deletions":-3}],"sizeInsertions":10,"sizeDeletions":-3},"patchSets":[{"number":"1","revision":"d0d9854a6176dc7160ebfc4f205794951642c517","parents":["3b107e17f43f4696be2ecd53fc2587a9dfcddd10"],"ref":"refs/changes/19/6319/1","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1558127461,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/uts/common/fs/zfs/vdev_disk.c","line":879,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"To check my understanding here, this will set ENXIO on the zio, and using zio_interrupt makes the failed IO bubble up to this IO\u0027s parents?"},{"file":"usr/src/uts/common/fs/zfs/vdev_disk.c","line":879,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Yes. this is the exact same way we handle an error earlier in the function (see for example lines 786-788) and is also consistent with how ZoL handles errors here (although their interface to the underlying driver code is different."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/fs/zfs/vdev_disk.c","type":"MODIFIED","insertions":10,"deletions":-3}],"sizeInsertions":10,"sizeDeletions":-3},{"number":"2","revision":"b8427aa904c94d89d27532759c656375b7e95d7e","parents":["3b107e17f43f4696be2ecd53fc2587a9dfcddd10"],"ref":"refs/changes/19/6319/2","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1558372152,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1558376505,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1558448932,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/fs/zfs/vdev_disk.c","type":"MODIFIED","insertions":10,"deletions":-3}],"sizeInsertions":10,"sizeDeletions":-3},{"number":"3","revision":"3a1da6de2a216503918b00b0a4524e613a8134d8","parents":["84af6eface8c46fc41fa613c296cde40e03d557b"],"ref":"refs/changes/19/6319/3","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1558452405,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"SUBM","value":"1","grantedOn":1558452542,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1558452502,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1558452502,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/uts/common/fs/zfs/vdev_disk.c","type":"MODIFIED","insertions":10,"deletions":-3}],"sizeInsertions":10,"sizeDeletions":-3}],"allReviewers":[{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}]}