From 6736f4483c01776b421460a9f0a10db4453d3339 Mon Sep 17 00:00:00 2001
From: Trent Mick <trentm@gmail.com>
Date: Thu, 19 Apr 2018 15:54:50 -0700
Subject: [PATCH] TRITON-329 vmapi_vms entries without a 'value.uuid' break
 VMAPI startup data-migration

---
 lib/apis/moray.js | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/lib/apis/moray.js b/lib/apis/moray.js
index 8f3970a..34c3a77 100644
--- a/lib/apis/moray.js
+++ b/lib/apis/moray.js
@@ -1789,10 +1789,11 @@ Moray.prototype.putBatch = function putBatch(modelName, records, callback) {
     assert.string(bucketName, 'bucketName');
 
     this._morayClient.batch(records.map(function generateVmPutBatch(record) {
+        assert.string(record.key, 'record.key');
         return {
             bucket: bucketName,
             operation: 'put',
-            key: record.value.uuid,
+            key: record.key,
             value: record.value,
             etag: record._etag
         };
-- 
2.21.0

