{"project":"joyent/sdcadm","branch":"master","id":"I9453ff15bc397ed97ce5af4d067680446e46c894","number":"1541","subject":"TOOLS-1687 `sdcadm up UUID-OF-INSTANCE-ON-CN1 -s CN2` should fail","owner":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"url":"https://cr.joyent.us/1541","commitMessage":"TOOLS-1687 `sdcadm up UUID-OF-INSTANCE-ON-CN1 -s CN2` should fail\n","createdOn":1487611714,"lastUpdated":1487776540,"open":false,"status":"MERGED","comments":[{"timestamp":1487611714,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 1."},{"timestamp":1487611756,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1487611766,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 1:\n\nTrent, this also handles avoiding the MultiError wrapping when there\u0027s only one error"},{"timestamp":1487613667,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 1: Code-Review+1\n\n(1 comment)"},{"timestamp":1487638887,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 1:\n\nHrm, so this is only on \u0027sdcadm experimental update\u0027. Easy to get confused until we get to just \u0027sdcadm update\u0027 here. :)\n\nI can\u0027t test until this is rebased to include TOOLS-1651, because I hit:\n\n```\n[root@headnode (nightly-1) ~]# sdcadm up 61a29662-e137-4270-a8d6-1ee8e1b52e46@7967cbf0-9e0f-420f-8d78-387f13117675\nUsing channel dev\n\nThis update will make the following changes:\n    download 1 image (9 MiB):\n        image 7967cbf0-9e0f-420f-8d78-387f13117675\n            (vm-agent@1.5.0)\n    update \"61a29662-e137-4270-a8d6-1ee8e1b52e46\" instance of \"vm-agent\" service\n        to image 7967cbf0-9e0f-420f-8d78-387f13117675 (vm-agent@1.5.0)\n\nWould you like to continue? [y/N] y\n\nCreate work dir: /var/sdcadm/updates/20170221T005953Z\nDownloading image 7967cbf0-9e0f-420f-8d78-387f13117675\n    (vm-agent@1.5.0)\nImported image 7967cbf0-9e0f-420f-8d78-387f13117675\n    (vm-agent@1.5.0)\n\n/opt/smartdc/sdcadm/node_modules/assert-plus/assert.js:22\n    throw new assert.AssertionError({\n          ^\nAssertionError: opts.concurrency (number) is required\n    at UpdateAgentV1.uaExecute [as execute] (/opt/smartdc/sdcadm/lib/procedures/update-agent-v1.js:77:12)\n    at execProc (/opt/smartdc/sdcadm/lib/sdcadm.js:3959:26)\n    at Object.func (/opt/smartdc/sdcadm/node_modules/vasync/lib/vasync.js:246:12)\n    at Object._onImmediate (/opt/smartdc/sdcadm/node_modules/vasync/lib/vasync.js:213:20)\n    at processImmediate [as _immediateCallback] (timers.js:330:15)\n```"},{"timestamp":1487669627,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 2."},{"timestamp":1487669663,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1487669907,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 2:\n\nI\u0027ve already rebased it, but I think you would hit exactly the same thing, since the server argument will be checked only for `sdcadm experimental`."},{"timestamp":1487697859,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 2: Code-Review+1 Integration-Approval+1"},{"timestamp":1487776540,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Pedro Palazón Candel"}],"currentPatchSet":{"number":"2","revision":"9453ff15bc397ed97ce5af4d067680446e46c894","parents":["77f82d4536b1293d98bf8e0216409d6c9746d48e"],"ref":"refs/changes/41/1541/2","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1487669627,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1487669663,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1487697859,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1487697859,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1487776540,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/cli/do_update.js","type":"MODIFIED","insertions":2,"deletions":-7},{"file":"lib/procedures/index.js","type":"MODIFIED","insertions":61,"deletions":-23}],"sizeInsertions":63,"sizeDeletions":-30},"patchSets":[{"number":"1","revision":"670d2e63907e3fbc7f548bc6b178dffd838f0bb7","parents":["932c322ab61fced8fff9bfbdbd3defc611b2c08a"],"ref":"refs/changes/41/1541/1","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1487611714,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1487611756,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1487613667,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"comments":[{"file":"lib/procedures/index.js","line":774,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"I\u0027m curious: why was this felt necessary?"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/cli/do_update.js","type":"MODIFIED","insertions":2,"deletions":-7},{"file":"lib/procedures/index.js","type":"MODIFIED","insertions":60,"deletions":-23}],"sizeInsertions":62,"sizeDeletions":-30},{"number":"2","revision":"9453ff15bc397ed97ce5af4d067680446e46c894","parents":["77f82d4536b1293d98bf8e0216409d6c9746d48e"],"ref":"refs/changes/41/1541/2","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1487669627,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1487669663,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1487697859,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1487697859,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1487776540,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/cli/do_update.js","type":"MODIFIED","insertions":2,"deletions":-7},{"file":"lib/procedures/index.js","type":"MODIFIED","insertions":61,"deletions":-23}],"sizeInsertions":63,"sizeDeletions":-30}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}]}