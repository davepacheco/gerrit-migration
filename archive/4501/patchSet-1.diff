commit 71f01048fc6b1c5c290e313c46de41fefb5b2ac7 (refs/changes/01/4501/1)
Author: Alex Wilson <alex.wilson@joyent.com>
Date:   2018-07-09T19:55:49-07:00 (1 year, 3 months ago)
    
    TRITON-580 urclient could include some more details about who's running the command

diff --git a/lib/mq.js b/lib/mq.js
index a082a76..62b2fc4 100644
--- a/lib/mq.js
+++ b/lib/mq.js
@@ -17,6 +17,7 @@ var mod_backoff = require('backoff');
 var mod_jsprim = require('jsprim');
 var mod_uuid = require('libuuid');
 var mod_verror = require('verror');
+var mod_os = require('os');
 
 var lib_common = require('./common');
 
@@ -614,6 +615,8 @@ send_ping(server_uuid)
 	return (infl);
 };
 
+var networkIps;
+
 URConnection.prototype.send_command = function
 send_command(server_id, script, args, env, data)
 {
@@ -623,6 +626,24 @@ send_command(server_id, script, args, env, data)
 		return (null);
 	}
 
+	if (networkIps === undefined) {
+		var netIfs = mod_os.networkInterfaces();
+		networkIps = [];
+		Object.keys(netIfs).forEach(function (ifName) {
+			netIfs[ifName].forEach(function (ifAddr) {
+				if (!ifAddr.internal) {
+					networkIps.push(ifAddr.address);
+				}
+			});
+		});
+	}
+	var origin = {
+		user: process.env.LOGNAME,
+		smf_fmri: process.env.SMF_FMRI,
+		hostname: mod_os.hostname(),
+		ips: networkIps
+	};
+
 	var infl = self.urc_inflights.register(data);
 
 	self.urc_exchange.publish('ur.execute.' + server_id + '.' +
@@ -632,7 +653,8 @@ send_command(server_id, script, args, env, data)
 		args: args.map(function (x) {
 			return (x.replace(/%%ID%%/g, infl.id()));
 		}),
-		env: env
+		env: env,
+		origin: origin
 	});
 
 	return (infl);
diff --git a/package.json b/package.json
index 4f78d6d..5c66115 100644
--- a/package.json
+++ b/package.json
@@ -1,6 +1,6 @@
 {
   "name": "urclient",
-  "version": "1.2.0",
+  "version": "1.2.1",
   "description": "Triton ur client",
   "author": "Joyent (joyent.com)",
   "dependencies": {
