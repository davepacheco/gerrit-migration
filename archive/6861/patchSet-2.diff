commit 529dae2817a28d9f46759acceb6d9488b8b05d94
Author: John Levon <john.levon@joyent.com>
Date:   2019-09-02T15:41:09+00:00 (5 weeks ago)
    
    OS-7977 -fno-shrink-wrap shouldn't be specified for gcc4 build
    Reviewed by: Tim Foster <tim.foster@joyent.com>
    Approved by: Tim Foster <tim.foster@joyent.com>

diff --git a/Makefile b/Makefile
index e478192..cee6818 100644
--- a/Makefile
+++ b/Makefile
@@ -108,7 +108,6 @@ KERNEL_CFLAGS = \
 	$(ALWAYS_CFLAGS) \
 	-m64 \
 	-mcmodel=kernel \
-	-fno-shrink-wrap \
 	-g \
 	-O \
 	-fno-inline \
@@ -119,6 +118,14 @@ KERNEL_CFLAGS = \
 	-std=gnu99 \
 	-mno-red-zone
 
+#
+# Fix fbt entry probes.
+#
+ifneq ($(PRIMARY_COMPILER_VER),4)
+KERNEL_CFLAGS += \
+	-fno-shrink-wrap
+endif
+
 USER_CFLAGS = \
 	-finline \
 	-gdwarf-2 \
