From 86217fbc58e9bfb23025cafd876fcc0bb9759c2e Mon Sep 17 00:00:00 2001
From: Cody Peter Mello <cody.mello@joyent.com>
Date: Wed, 8 Aug 2018 18:15:06 +0000
Subject: [PATCH] TRITON-671 SAPI should fall back to local store when Moray
 returns NoDatabasePeersError

---
 lib/server/stor/moray_local.js | 1 +
 1 file changed, 1 insertion(+)

diff --git a/lib/server/stor/moray_local.js b/lib/server/stor/moray_local.js
index 6618dde..81fc5f8 100644
--- a/lib/server/stor/moray_local.js
+++ b/lib/server/stor/moray_local.js
@@ -49,6 +49,7 @@ function is500(err) {
     //               ^^^^^ <-- Is what should be in the list below
     var names = [
         'NoConnectionError',     // Moray HA Proxy is down
+        'NoDatabasePeersError',  // Moray has no backend connections
         'ConnectionClosedError', // Moray services are down
         'PoolClosedError',       // Postgres is down
         'Error',         // Postgres is down
-- 
2.21.0

