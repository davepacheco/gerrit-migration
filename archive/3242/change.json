{"project":"joyent/sdc-napi","branch":"master","id":"I0fb34611aeaf16a7c9969cef831af7d765595292","number":"3242","subject":"NAPI-440 IP address object needs belongs_to_type of router","owner":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"url":"https://cr.joyent.us/3242","commitMessage":"NAPI-440 IP address object needs belongs_to_type of router\n","createdOn":1516633419,"lastUpdated":1517351328,"open":false,"status":"ABANDONED","comments":[{"timestamp":1516633419,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Uploaded patch set 1."},{"timestamp":1516633477,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1516633486,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 1:\n\nI *know* this will need more.  I\u0027m not sure how best to solicit feedback for a NAPI newbie, so I\u0027m putting this up here."},{"timestamp":1516636910,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Patch Set 1:\n\nnit: Update the docs in the repo to mention \"router\" in \u0027belongs_to_type\u0027\n\nBut I am okay with you putting this off until something actually consumes the new type since nothing will report that back today."},{"timestamp":1516638692,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 1:\n\n\u003e nit: Update the docs in the repo to mention \"router\" in\n \u003e \u0027belongs_to_type\u0027\n\nGood idea.\n\n \u003e But I am okay with you putting this off until something actually\n \u003e consumes the new type since nothing will report that back today.\n\nI\u0027m happy doing that now.  I\u0027m also very concerned that just having the one change I have now is insufficient."},{"timestamp":1516638991,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Uploaded patch set 2."},{"timestamp":1516639047,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1516644087,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 2:\n\n\u003e I *know* this will need more.  I\u0027m not sure how best to solicit feedback for a NAPI newbie, so I\u0027m putting this up here.\n\nSo, things that I think you\u0027ll want to make sure to add:\n\n- \"router\" NICs shouldn\u0027t have mappings added to the portolan tables for them. The mappings are currently set up in the Nic.prototype.batch method.\n- It should be possible to have multiple router NICs with the same IP address. This will require changing the IP.prototype.provisionable method.\n- We\u0027ll want new unit tests to verify that the router NICs work the way we want them to\n\nI think that we may want this to go in together with the work to add router objects to NAPI, so that we can also have tests that show that trying to delete a router object will search for belongs_to_type\u003d\"router\" \u0026\u0026 belongs_to__uuid\u003d\u003crouter object uuid\u003e (and then either cascade the delete or refuse to delete; I don\u0027t recall if we settled on one behaviour or the other)."},{"timestamp":1516648863,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 2:\n\n\u003e So, things that I think you\u0027ll want to make sure to add:\n\u003e \n\u003e - \"router\" NICs shouldn\u0027t have mappings added to the portolan\n\u003e tables for them. The mappings are currently set up in the\n\u003e Nic.prototype.batch method.\n \nThis is because a router NIC instantiates over multiple CNs, right?  This leads into a followup question...\n\n\u003e - It should be possible to have multiple router NICs with the same\n\u003e IP address. This will require changing the IP.prototype.provisionable\n\u003e method.\n\nIf you have, say, five CNs in a DC, each Router Object instantiates five Router Zones.  Does that mean five NIC objects (one per network per Router Zone) or one (one per network per Router Object)?\n\n\u003e - We\u0027ll want new unit tests to verify that the router NICs work the\n\u003e way we want them to\n\nDefinitely.\n\n\u003e I think that we may want this to go in together with the work to\n\u003e add router objects to NAPI, so that we can also have tests that\n\u003e show that trying to delete a router object will search for\n\u003e belongs_to_type\u003d\"router\" \u0026\u0026 belongs_to__uuid\u003d\u003crouter object uuid\u003e\n\u003e (and then either cascade the delete or refuse to delete; I don\u0027t\n\u003e recall if we settled on one behaviour or the other).\n\nI don\u0027t think we\u0027ve settled on that behavior yet. Regardless, you make a strong case for just belongs_to_type\u003d\u0027router\u0027 not being substantial enough to be its own case."},{"timestamp":1517351328,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Abandoned\n\nBy itself NAPI-440 isn\u0027t all that helpful (see Cody\u0027s comments).  Abandoning for that reason."}],"currentPatchSet":{"number":"2","revision":"0fb34611aeaf16a7c9969cef831af7d765595292","parents":["6479f265cda008a6828fe68f083fbb784ef3d9dc"],"ref":"refs/changes/42/3242/2","uploader":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"createdOn":1516638991,"author":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1516639047,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"lib/models/nic/common.js","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":5,"sizeDeletions":-5},"patchSets":[{"number":"1","revision":"e87ca9d21bf962cbf737bf55679af3371c81317b","parents":["6479f265cda008a6828fe68f083fbb784ef3d9dc"],"ref":"refs/changes/42/3242/1","uploader":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"createdOn":1516633419,"author":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1516633477,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/models/nic/common.js","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":1,"sizeDeletions":-1},{"number":"2","revision":"0fb34611aeaf16a7c9969cef831af7d765595292","parents":["6479f265cda008a6828fe68f083fbb784ef3d9dc"],"ref":"refs/changes/42/3242/2","uploader":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"createdOn":1516638991,"author":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1516639047,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"lib/models/nic/common.js","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":5,"sizeDeletions":-5}],"allReviewers":[{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},{"name":"Joyent Automation","username":"joyent-automation"}]}