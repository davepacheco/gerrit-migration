From 973fffb1db27c106fa3c55c74d3e27544dacf2d3 Mon Sep 17 00:00:00 2001
From: Robert Bogart <robert.bogart@joyent.com>
Date: Thu, 18 Apr 2019 23:07:22 +0000
Subject: [PATCH] MANTA-4233 Accelerated garbage collection omits account
 information from instructions

---
 lib/delete_record_transformer.js | 15 ++++++++++++++-
 1 file changed, 14 insertions(+), 1 deletion(-)

diff --git a/lib/delete_record_transformer.js b/lib/delete_record_transformer.js
index 7d6475c..3d08549 100644
--- a/lib/delete_record_transformer.js
+++ b/lib/delete_record_transformer.js
@@ -156,7 +156,20 @@ _process_record(record, done)
 	var key = record.key;
 	var sharks = [];
 
-	var line_data = [value.creator, value.objectId];
+	/*
+	 * Reminder: As discussed earlier, object metadata for objects created
+	 * with the Manta multipart upload API do not have creator uuids.  In
+	 * such a case, we can obtain the uuid from the `owner' field instead.
+	 * Failure to do so will prevent us from deleting the object later on
+	 * down the road because we will not have a means of associating the
+	 * object with an account (a necessary requirement for object deletion
+	 * on a mako).  On a more positive note, this is the last stop in the
+	 * chain where it is necessary to dig through a record for this kind of
+	 * information.  From here on out, account information will be passed
+	 * forward via `line_data'.
+	 */
+	var creator = value.creator || value.owner;
+	var line_data = [creator, value.objectId];
 
 	if (value.type !== 'object' || value.contentLength === 0) {
 		done(null, null, key);
-- 
2.21.0

