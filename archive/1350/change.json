{"project":"joyent/node-libmanta","branch":"master","id":"Ie6e5be210c3e66ae6990c1e1395e25422a2390de","number":"1350","subject":"MANTA-3124 update libmanta to moray v3 Reviewed by: Robert Mustacchi \u003crm@joyent.com\u003e Approved by: Jordan Hendricks \u003cjordan.hendricks@joyent.com\u003e","owner":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"url":"https://cr.joyent.us/1350","commitMessage":"MANTA-3124 update libmanta to moray v3\nReviewed by: Robert Mustacchi \u003crm@joyent.com\u003e\nApproved by: Jordan Hendricks \u003cjordan.hendricks@joyent.com\u003e\n","createdOn":1485474894,"lastUpdated":1486079864,"open":false,"status":"MERGED","comments":[{"timestamp":1485474894,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Uploaded patch set 1."},{"timestamp":1485474928,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1485558908,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 1:\n\n(2 comments)"},{"timestamp":1485815403,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 1:\n\n(2 comments)"},{"timestamp":1485882179,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 1: Code-Review+1\n\n(2 comments)"},{"timestamp":1485910390,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Patch Set 1: Integration-Approval+1"},{"timestamp":1485910442,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Patch Set 1: Integration-Approval-1"},{"timestamp":1485910543,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Patch Set 1: Integration-Approval+1"},{"timestamp":1486079702,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Uploaded patch set 2: Commit message was updated."},{"timestamp":1486079864,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by David Pacheco"}],"currentPatchSet":{"number":"2","revision":"e6e5be210c3e66ae6990c1e1395e25422a2390de","parents":["c8ce77d48c18b51de5573fdec3e5d0ad13d6967a"],"ref":"refs/changes/50/1350/2","uploader":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"createdOn":1486079702,"author":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1485474928,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1485882179,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1485910543,"by":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"}},{"type":"SUBM","value":"1","grantedOn":1486079864,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/moray.js","type":"MODIFIED","insertions":19,"deletions":-57},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/moray.test.js","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"test/trigger/manta/manta-triggers-setup","type":"MODIFIED","insertions":4,"deletions":-3}],"sizeInsertions":29,"sizeDeletions":-65},"patchSets":[{"number":"1","revision":"d8cc28f2efc4d917029275799c0ff7037d6682f0","parents":["c8ce77d48c18b51de5573fdec3e5d0ad13d6967a"],"ref":"refs/changes/50/1350/1","uploader":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"createdOn":1485474894,"author":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1485882179,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1485474928,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1485910543,"by":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"}}],"comments":[{"file":"lib/moray.js","line":394,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I presume that the reason we don\u0027t check any of these options for being present is that we\u0027ll end up passing this down to the moray client itself, is that right?"},{"file":"lib/moray.js","line":394,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"That\u0027s true, but mostly I just avoided changing the existing behavior.  If you didn\u0027t specify these properties, I believe you\u0027d get default values, and those could work.  (\"this.url\" would be wrong, but that would only affect toString().)  I don\u0027t know if anything relies on that today, but I doubt it."},{"file":"lib/moray.js","line":394,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"OK, thanks for clarifying."},{"file":"package.json","line":18,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Is there a reason for the ^ with jsprim, but not say moray?"},{"file":"package.json","line":18,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"The question about the \"moray\" dependency comes up in all the repos, so I\u0027m putting a general answer here.\n\nIn the absence of specific guidance around this, our use of it has been somewhat inconsistent.  eng.git just says:\n\n\u003e The use of version ranges (such as the \"^\" in the example above) is not required and you should use your judgment about the quality of release management and adherence to semantic versioning in the module you depend on.\n\nThe basic tradeoff is that when we use \"^\", then we don\u0027t have to update every consumer every time we publish a small bug fix, but builds are not necessarily repeatable because the publishing of a new module will cause us to pick that up even if we\u0027re rebuilding an older version.  Long-term, I think it would make sense to shrinkwrap release builds, but we don\u0027t do that today, and Manta doesn\u0027t use release builds anyway.\n\nI\u0027ve started using \"^\" more broadly for dependencies that we control, and when I did Moray v2, I changed most things to depend on \"^2.0.0\".  After talking with Alex, I wasn\u0027t sure this was so great.  With the changes for Moray v3, I\u0027ve updated minnow, muskie, libmanta, and marlin back to exact versions because that\u0027s what most of their dependencies were using.  With electric-moray, I didn\u0027t bother because many of its dependencies were using \"^\" already.\n\nI\u0027m sure this isn\u0027t very satisfying.  Short of the work to make releases repeatable and to use release builds in Manta deployment, I\u0027m not sure what else to do."},{"file":"package.json","line":18,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"OK, thanks for the explanation."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/moray.js","type":"MODIFIED","insertions":19,"deletions":-57},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/moray.test.js","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"test/trigger/manta/manta-triggers-setup","type":"MODIFIED","insertions":4,"deletions":-3}],"sizeInsertions":29,"sizeDeletions":-65},{"number":"2","revision":"e6e5be210c3e66ae6990c1e1395e25422a2390de","parents":["c8ce77d48c18b51de5573fdec3e5d0ad13d6967a"],"ref":"refs/changes/50/1350/2","uploader":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"createdOn":1486079702,"author":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"SUBM","value":"1","grantedOn":1486079864,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1485882179,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1485474928,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1485910543,"by":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/moray.js","type":"MODIFIED","insertions":19,"deletions":-57},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/moray.test.js","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"test/trigger/manta/manta-triggers-setup","type":"MODIFIED","insertions":4,"deletions":-3}],"sizeInsertions":29,"sizeDeletions":-65}],"allReviewers":[{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}]}