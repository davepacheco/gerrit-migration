From 13794d0e9f7e7483d68b85ad8247c824f0c9c2ed Mon Sep 17 00:00:00 2001
From: Pedro Palazon Candel <pedro@joyent.com>
Date: Sat, 16 Dec 2017 08:11:28 +0100
Subject: [PATCH] HEAD-2378 Add dns_domain to sapi metadata Reviewed by: Josh
 Wilsdon <josh@wilsdon.ca>

---
 scripts/headnode.sh | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/scripts/headnode.sh b/scripts/headnode.sh
index ce58f72b..b34f7e44 100755
--- a/scripts/headnode.sh
+++ b/scripts/headnode.sh
@@ -639,6 +639,12 @@ download_metadata
 write_initial_config
 registrar_setup
 HERE
+
+        if [[ -n "${CONFIG_dns_domain}" ]]; then
+            vmadm update $sapi_uuid <<EOF
+  {"set_customer_metadata": {"dns_domain": "${CONFIG_dns_domain}"}}
+EOF
+        fi
         setup_state_add "sapi_bootstrapped"
     fi
 }
-- 
2.21.0

