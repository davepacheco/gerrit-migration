From ad691e51cc8488fff7f680eb39fb5b784070c4fe Mon Sep 17 00:00:00 2001
From: dyep49 <dyep49@gmail.com>
Date: Thu, 14 Jun 2018 12:23:10 -0700
Subject: [PATCH] TRITON-492 Add metricPorts metadata to workflow for
 cmon-agent

---
 boot/setup.sh | 5 ++++-
 package.json  | 2 +-
 2 files changed, 5 insertions(+), 2 deletions(-)

diff --git a/boot/setup.sh b/boot/setup.sh
index 7f31f4a..2b66ae9 100755
--- a/boot/setup.sh
+++ b/boot/setup.sh
@@ -7,7 +7,7 @@
 #
 
 #
-# Copyright (c) 2014, Joyent, Inc.
+# Copyright (c) 2018, Joyent, Inc.
 #
 
 export PS4='[\D{%FT%TZ}] ${BASH_SOURCE}:${LINENO}: ${FUNCNAME[0]:+${FUNCNAME[0]}(): }'
@@ -52,6 +52,9 @@ sdc_log_rotation_add wf-runner /var/svc/log/*wf-runner*.log 1g
 sdc_log_rotation_add wf-backfill /var/svc/log/*wf-backfill*.log 1g
 sdc_log_rotation_setup_end
 
+# Add metricsPorts metadata for cmon-agent discovery
+mdata-put metricPorts 8881,8882
+
 # All done, run boilerplate end-of-setup
 sdc_setup_complete
 
diff --git a/package.json b/package.json
index 168e655..a63c0a2 100644
--- a/package.json
+++ b/package.json
@@ -1,7 +1,7 @@
 {
   "name": "workflow",
   "description": "SmartDataCenter Workflow API and Runners",
-  "version": "1.3.0",
+  "version": "1.3.1",
   "author": "Joyent (joyent.com)",
   "private": true,
   "repository": {
-- 
2.21.0

