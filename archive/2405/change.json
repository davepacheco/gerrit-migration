{"project":"joyent/electric-moray","branch":"master","topic":"MANTA-3279","id":"I6bb201f5814c4d99108626d28a0db7595682d17b","number":"2405","subject":"MANTA-3279 node-fash loads the whole leveldb hash ring into memory","owner":{"name":"Brittany Wald","email":"brittany.wald@joyent.com","username":"princesspretzel"},"url":"https://cr.joyent.us/2405","commitMessage":"MANTA-3279 node-fash loads the whole leveldb hash ring into memory\n","createdOn":1502833170,"lastUpdated":1506012041,"open":false,"status":"MERGED","comments":[{"timestamp":1502833170,"reviewer":{"name":"Brittany Wald","email":"brittany.wald@joyent.com","username":"princesspretzel"},"message":"Uploaded patch set 1."},{"timestamp":1502833206,"reviewer":{"name":"Brittany Wald","email":"brittany.wald@joyent.com","username":"princesspretzel"},"message":"Topic set to MANTA-3279"},{"timestamp":1502833218,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1503440098,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 1: Code-Review+1\n\n(1 comment)\n\nThanks! Code looks good. Testing notes would be good to see. Building and deploying an image would be super. It might be overkill for this stuff, but it would make me feel more relaxed at night :)"},{"timestamp":1503514413,"reviewer":{"name":"Brittany Wald","email":"brittany.wald@joyent.com","username":"princesspretzel"},"message":"Patch Set 1:\n\nYes, as far as I can tell it is just a sanity check to see if a given key (a more realistic example than \u0027yunong\u0027 would be something like \u0027poseidon/stor/rings/test_hash_ring/sample.txt\u0027) maps into the hash ring at all.  The return value is a hash containing the pnode and vnode within the ring that that key would deterministically respond to (thus should be idempotent), and the pnode should be an actual pnode on the ring and the vnode should be within the range of given vnodes (say, 1000000).  The data contained should at this point in the code always be 1, which is the default value in fash.  We should definitely create more robust/explicit testing and documentation around this, since the function name doesn\u0027t betray much information about it, and it used in basically all the testing even within fash itself.  I will include this work with this ticket, which I think makes sense, but let me know what you think: https://devhub.joyent.com/jira/browse/MANTA-3382 -- thanks so much for pointing it out!"},{"timestamp":1503514850,"reviewer":{"name":"Brittany Wald","email":"brittany.wald@joyent.com","username":"princesspretzel"},"message":"Patch Set 1:\n\n\u003e Yes, as far as I can tell it is just a sanity check to see if a\n \u003e given key (a more realistic example than \u0027yunong\u0027 would be\n \u003e something like \u0027poseidon/stor/rings/test_hash_ring/sample.txt\u0027)\n \u003e maps into the hash ring at all.  The return value is a hash\n \u003e containing the pnode and vnode within the ring that that key would\n \u003e deterministically respond to (thus should be idempotent), and the\n \u003e pnode should be an actual pnode on the ring and the vnode should be\n \u003e within the range of given vnodes (say, 1000000).  The data\n \u003e contained should at this point in the code always be 1, which is\n \u003e the default value in fash.  We should definitely create more\n \u003e robust/explicit testing and documentation around this, since the\n \u003e function name doesn\u0027t betray much information about it, and it used\n \u003e in basically all the testing even within fash itself.  I will\n \u003e include this work with this ticket, which I think makes sense, but\n \u003e let me know what you think: MANTA-3382\n \u003e -- thanks so much for pointing it out!"},{"timestamp":1503521875,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 1:\n\nOk, cool. More documentation on node-fash would be a good thing which could fit into the MANTA-3382 ticket."},{"timestamp":1505349766,"reviewer":{"name":"Brittany Wald","email":"brittany.wald@joyent.com","username":"princesspretzel"},"message":"Uploaded patch set 2."},{"timestamp":1505349791,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1505749904,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 2: Code-Review+1\n\nLooks good! What\u0027s the status on this one? Are we waiting for other CRs to go through before we publish 2.4.1 to NPM? Once we have 2.4.1 published and are able to verify an automated build works, we should be good to go for IA here (and the sdc-manta MANTA-3279 CR)!"},{"timestamp":1505781815,"reviewer":{"name":"Brittany Wald","email":"brittany.wald@joyent.com","username":"princesspretzel"},"message":"Patch Set 2:\n\nThanks for the review!  Yes, I\u0027m waiting for MANTA-3411 \u0026 MANTA-3413 approval."},{"timestamp":1505933432,"reviewer":{"name":"Brittany Wald","email":"brittany.wald@joyent.com","username":"princesspretzel"},"message":"Uploaded patch set 3: Patch Set 2 was rebased."},{"timestamp":1505933463,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3:\n\n\"make check\" passed ok"},{"timestamp":1506002442,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 3: Integration-Approval+1"},{"timestamp":1506012041,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Brittany Wald"}],"currentPatchSet":{"number":"3","revision":"6bb201f5814c4d99108626d28a0db7595682d17b","parents":["0223cebf56015ed21ebb0b6da35f886338168a10"],"ref":"refs/changes/05/2405/3","uploader":{"name":"Brittany Wald","email":"brittany.wald@joyent.com","username":"princesspretzel"},"createdOn":1505933432,"author":{"name":"Brittany Wald","email":"brittany.wald@joyent.com","username":"princesspretzel"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1505349791,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1505749904,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1506002442,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}},{"type":"SUBM","value":"1","grantedOn":1506012041,"by":{"name":"Brittany Wald","email":"brittany.wald@joyent.com","username":"princesspretzel"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"boot/setup.sh","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":3,"sizeDeletions":-3},"patchSets":[{"number":"1","revision":"b0d84d1f1f30343785f5bba5324ffe23d803ef81","parents":["008f734e951690fedc6332b9053d54c12d25c979"],"ref":"refs/changes/05/2405/1","uploader":{"name":"Brittany Wald","email":"brittany.wald@joyent.com","username":"princesspretzel"},"createdOn":1502833170,"author":{"name":"Brittany Wald","email":"brittany.wald@joyent.com","username":"princesspretzel"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1502833218,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1503440098,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}}],"comments":[{"file":"boot/setup.sh","line":106,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Can you explain what this does? Is it just a sanity test to make sure that the fash utility works? Sorry, I\u0027m new to this code. Maybe we can take this opportunity to change the \u0027yunong\u0027 string to something else that more represents what we\u0027re trying to do here, like \u0027test\u0027 or some such thing."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"boot/setup.sh","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":3,"sizeDeletions":-3},{"number":"2","revision":"e1a9de7446b788f9e1bf4245ff71dac15a0043e3","parents":["008f734e951690fedc6332b9053d54c12d25c979"],"ref":"refs/changes/05/2405/2","uploader":{"name":"Brittany Wald","email":"brittany.wald@joyent.com","username":"princesspretzel"},"createdOn":1505349766,"author":{"name":"Brittany Wald","email":"brittany.wald@joyent.com","username":"princesspretzel"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1505349791,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1505749904,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"boot/setup.sh","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":3,"sizeDeletions":-3},{"number":"3","revision":"6bb201f5814c4d99108626d28a0db7595682d17b","parents":["0223cebf56015ed21ebb0b6da35f886338168a10"],"ref":"refs/changes/05/2405/3","uploader":{"name":"Brittany Wald","email":"brittany.wald@joyent.com","username":"princesspretzel"},"createdOn":1505933432,"author":{"name":"Brittany Wald","email":"brittany.wald@joyent.com","username":"princesspretzel"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1505349791,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"SUBM","value":"1","grantedOn":1506012041,"by":{"name":"Brittany Wald","email":"brittany.wald@joyent.com","username":"princesspretzel"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1505749904,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1506002442,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"boot/setup.sh","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":3,"sizeDeletions":-3}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},{"name":"Brittany Wald","email":"brittany.wald@joyent.com","username":"princesspretzel"}]}