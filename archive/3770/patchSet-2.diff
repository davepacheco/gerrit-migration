From 167c6b01a7131ba2f451e822de907bbbdc663bdc Mon Sep 17 00:00:00 2001
From: Mike Zeller <mike.zeller@joyent.com>
Date: Tue, 3 Apr 2018 19:36:30 -0700
Subject: [PATCH] TRITON-305 TRITON-262 should be more careful with
 async.waterfull arguments

---
 CHANGES.md   | 4 ++++
 agent.js     | 4 +++-
 package.json | 2 +-
 3 files changed, 8 insertions(+), 2 deletions(-)

diff --git a/CHANGES.md b/CHANGES.md
index 1195d59..14baf07 100644
--- a/CHANGES.md
+++ b/CHANGES.md
@@ -1,5 +1,9 @@
 # sdc-config-agent changelog
 
+## 1.7.1
+
+- [TRITON-305] Fix breakage in 1.7.0 that breaks config-agents in zones.
+
 ## 1.7.0
 
 - [TRITON-262] Add support for `auto.INSTANCE_UUID`
diff --git a/agent.js b/agent.js
index 96609ff..0efe864 100644
--- a/agent.js
+++ b/agent.js
@@ -275,7 +275,9 @@ function setInZoneAutoMetadata(callback) {
 				});
 			}
 		]
-	}, callback);
+	}, function doneInZoneAutoMetadata(err) {
+		callback(err);
+	});
 }
 
 async.waterfall([
diff --git a/package.json b/package.json
index ecbc2eb..5a00fc0 100644
--- a/package.json
+++ b/package.json
@@ -1,7 +1,7 @@
 {
     "name": "config-agent",
     "description": "SmartDataCenter Config Agent",
-    "version": "1.7.0",
+    "version": "1.7.1",
     "author": "Joyent (joyent.com)",
     "dependencies": {
         "assert-plus": "0.1.5",
-- 
2.21.0

