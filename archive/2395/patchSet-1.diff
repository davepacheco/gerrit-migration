From 3c53bb693d98f10eacd1ffab942d2ca311bd200f Mon Sep 17 00:00:00 2001
From: Cody Peter Mello <cody.mello@joyent.com>
Date: Tue, 15 Aug 2017 00:34:22 +0000
Subject: [PATCH] MANTA-3375 AMON alarm "upset.manta.postgres.long_query"
 hardcodes path to "psql"

---
 alarm_metadata/probe_templates/postgres.yaml | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/alarm_metadata/probe_templates/postgres.yaml b/alarm_metadata/probe_templates/postgres.yaml
index 97b55e3..323e5f3 100644
--- a/alarm_metadata/probe_templates/postgres.yaml
+++ b/alarm_metadata/probe_templates/postgres.yaml
@@ -243,7 +243,7 @@
         -
             type: cmd
             config:
-                cmd: "/opt/local/bin/psql -U postgres -c \"SELECT pid,usename,client_addr,client_port,waiting,state,NOW() - query_start AS elapsed, query FROM pg_stat_activity WHERE state != 'idle' AND query NOT LIKE 'autovacuum: %' AND NOW() - query_start > interval '120 seconds'\" | tail +3"
+                cmd: "PATH=/opt/postgresql/current/bin:/opt/local/bin:$PATH psql -U postgres -c \"SELECT pid,usename,client_addr,client_port,waiting,state,NOW() - query_start AS elapsed, query FROM pg_stat_activity WHERE state != 'idle' AND query NOT LIKE 'autovacuum: %' AND NOW() - query_start > interval '120 seconds'\" | tail +3"
                 interval: 60
                 timeout: 30
                 threshold: 2
-- 
2.21.0

