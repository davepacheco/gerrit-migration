{"project":"joyent/illumos-joyent","branch":"master","topic":"retpolines","id":"Ifae35450c961f8c5a41382adf0e202906b2c4584","number":"6453","subject":"OS-7598 Kernel needs to be built with retpolines OS-7621 Kernel needs to generally use RSB stuffing Reviewed by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e Reviewed by: John Levon \u003cjohn.levon@joyent.com\u003e Approved by: Joshua M. Clulow \u003cjmc@joyent.com\u003e","owner":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"url":"https://cr.joyent.us/6453","commitMessage":"OS-7598 Kernel needs to be built with retpolines\nOS-7621 Kernel needs to generally use RSB stuffing\nReviewed by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e\nReviewed by: John Levon \u003cjohn.levon@joyent.com\u003e\nApproved by: Joshua M. Clulow \u003cjmc@joyent.com\u003e\n","createdOn":1560790883,"lastUpdated":1566239845,"open":false,"status":"MERGED","comments":[{"timestamp":1560790883,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Uploaded patch set 1."},{"timestamp":1560805000,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 1:\n\nIf it\u0027s intentional to leave the indirect calls in kmdb unmodified, I think they should probably grow comments. (I also looked at usr/src/{common,compat} but they seemed OK.)"},{"timestamp":1560809242,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 1:\n\n\u003e If it\u0027s intentional to leave the indirect calls in kmdb unmodified,\n \u003e I think they should probably grow comments. (I also looked at\n \u003e usr/src/{common,compat} but they seemed OK.)\n\nNo, it wasn\u0027t intentional. I\u0027ll circle back on those."},{"timestamp":1560968065,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 1:\n\n(46 comments)\n\nAs always, thanks for the extensive comments."},{"timestamp":1561037371,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 1:\n\n(46 comments)\n\nI still need to go back and address kmdb, but I wanted to get the round of comment and other fixes out first."},{"timestamp":1561037377,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Uploaded patch set 2."},{"timestamp":1561051918,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 2:\n\n(11 comments)"},{"timestamp":1561061290,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 2:\n\n(5 comments)\n\nI\u0027m still going through all the rest of the code, but I wanted to post my comment nits for cpulid.c in case you\u0027re addressing John\u0027s comments with another update."},{"timestamp":1561140686,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Uploaded patch set 3."},{"timestamp":1561140710,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 2:\n\n(11 comments)\n\nI\u0027ve updated this to address all the feedback so far. At the moment, I\u0027m not sure it makes sense to actually change kmdb to use retpolines. I\u0027m going to follow up and discuss that outside of this review."},{"timestamp":1561373344,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 3:\n\n(4 comments)"},{"timestamp":1561410464,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Uploaded patch set 4."},{"timestamp":1561410474,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 4:\n\n(3 comments)"},{"timestamp":1561411528,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 4: Code-Review+1"},{"timestamp":1561476952,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 4:\n\n(3 comments)\n\nSorry it took me so long to get through this. It looks good to me. I just had a few final nits/questions."},{"timestamp":1561597999,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Uploaded patch set 5."},{"timestamp":1561598004,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 4:\n\n(3 comments)"},{"timestamp":1561628525,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 5: Code-Review+1"},{"timestamp":1561652913,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 5: Code-Review+1"},{"timestamp":1565312975,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Uploaded patch set 6."},{"timestamp":1565313084,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 6:\n\nWhen doing more testing, I discovered that there was an issue with modstubs having not been properly processed. I realize that I\u0027m a little inconsistent and ripped out the 32-bit modstubs stuff, so I can add it back if you\u0027d prefer. Thanks to John Levon for the test suggestions that led to this."},{"timestamp":1565350539,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 6:\n\n(2 comments)"},{"timestamp":1565375470,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Uploaded patch set 7."},{"timestamp":1565375475,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 6:\n\n(2 comments)"},{"timestamp":1565378389,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 7: Code-Review+1"},{"timestamp":1565381226,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 7: Code-Review+1"},{"timestamp":1565631322,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Topic set to retpolines"},{"timestamp":1565998634,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Patch Set 7: Integration-Approval+1\n\nI have read through the testing notes, and they seem quite thorough!  I have also discussed this with Robert in person, and I approve.  Thanks for doing all this."},{"timestamp":1566236964,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Uploaded patch set 8: Patch Set 7 was rebased."},{"timestamp":1566237112,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Uploaded patch set 9: Patch Set 8 was rebased."},{"timestamp":1566237194,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Uploaded patch set 10: Commit message was updated."},{"timestamp":1566239845,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Robert Mustacchi"}],"currentPatchSet":{"number":"10","revision":"fae35450c961f8c5a41382adf0e202906b2c4584","parents":["edccf53a08a5dc2a1536d248367ab3aaf477ae60"],"ref":"refs/changes/53/6453/10","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1566237194,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1565378389,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1565381226,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1565998634,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}},{"type":"SUBM","value":"1","grantedOn":1566239845,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"usr/src/uts/Makefile.uts","type":"MODIFIED","insertions":11,"deletions":-1},{"file":"usr/src/uts/common/mapfiles/ddi.mapfile","type":"MODIFIED","insertions":16,"deletions":0},{"file":"usr/src/uts/i86pc/ml/cpr_wakecode.s","type":"MODIFIED","insertions":15,"deletions":-12},{"file":"usr/src/uts/i86pc/ml/fast_trap_asm.s","type":"MODIFIED","insertions":5,"deletions":-4},{"file":"usr/src/uts/i86pc/ml/interrupt.s","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/i86pc/ml/locore.s","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"usr/src/uts/i86pc/ml/md_clear.s","type":"MODIFIED","insertions":9,"deletions":-7},{"file":"usr/src/uts/i86pc/ml/mpcore.s","type":"MODIFIED","insertions":22,"deletions":-15},{"file":"usr/src/uts/i86pc/ml/syscall_asm_amd64.s","type":"MODIFIED","insertions":14,"deletions":-10},{"file":"usr/src/uts/i86pc/os/cpuid.c","type":"MODIFIED","insertions":477,"deletions":-11},{"file":"usr/src/uts/i86pc/sys/asm_misc.h","type":"MODIFIED","insertions":6,"deletions":-7},{"file":"usr/src/uts/i86pc/sys/machprivregs.h","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/intel/Makefile.files","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/uts/intel/Makefile.rules","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/uts/intel/amd64/krtld/kobj_crt.s","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"usr/src/uts/intel/brand/common/brand_solaris.s","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"usr/src/uts/intel/ia32/ml/copy.s","type":"MODIFIED","insertions":90,"deletions":-82},{"file":"usr/src/uts/intel/ia32/ml/ddi_i86_asm.s","type":"MODIFIED","insertions":48,"deletions":-30},{"file":"usr/src/uts/intel/ia32/ml/exception.s","type":"MODIFIED","insertions":5,"deletions":-4},{"file":"usr/src/uts/intel/ia32/ml/hypersubr.s","type":"MODIFIED","insertions":10,"deletions":-6},{"file":"usr/src/uts/intel/ia32/ml/i86_subr.s","type":"MODIFIED","insertions":50,"deletions":-48},{"file":"usr/src/uts/intel/ia32/ml/lock_prim.s","type":"MODIFIED","insertions":4,"deletions":-2},{"file":"usr/src/uts/intel/ia32/ml/modstubs.s","type":"MODIFIED","insertions":63,"deletions":-185},{"file":"usr/src/uts/intel/ia32/ml/retpoline.s","type":"ADDED","insertions":211,"deletions":0},{"file":"usr/src/uts/intel/ia32/ml/swtch.s","type":"MODIFIED","insertions":15,"deletions":-7},{"file":"usr/src/uts/intel/ia32/sys/asm_linkage.h","type":"MODIFIED","insertions":44,"deletions":-2},{"file":"usr/src/uts/intel/sys/x86_archext.h","type":"MODIFIED","insertions":15,"deletions":-10}],"sizeInsertions":1150,"sizeDeletions":-454},"patchSets":[{"number":"1","revision":"640ffd583a181c028cc0ebf1c7e3405f336dc4de","parents":["8749bcc14fc1d6ed9e45c4001825ed59eb425643"],"ref":"refs/changes/53/6453/1","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1560790883,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/uts/i86pc/ml/cpr_wakecode.s","line":1145,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Needs cleaning back up?"},{"file":"usr/src/uts/i86pc/ml/cpr_wakecode.s","line":1145,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"This is actually #ifdef i386 code that shouldn\u0027t have been changed. It actually doesn\u0027t build at all as the macro doesn\u0027t exist. I\u0027ve undone this. I didn\u0027t want to rip out all of the i386 logic here in this change to make it easier to understand what has changed and why."},{"file":"usr/src/uts/i86pc/ml/cpr_wakecode.s","line":1148,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"ditto"},{"file":"usr/src/uts/i86pc/ml/cpr_wakecode.s","line":1148,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"This is actually #ifdef i386 code that shouldn\u0027t have been changed. It actually doesn\u0027t build at all as the macro doesn\u0027t exist. I\u0027ve undone this. I didn\u0027t want to rip out all of the i386 logic here in this change to make it easier to understand what has changed and why."},{"file":"usr/src/uts/i86pc/ml/md_clear.s","line":50,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Seems a shame to lose the comment about flags getting clobbered?"},{"file":"usr/src/uts/i86pc/ml/md_clear.s","line":50,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Oops, sorry about that. I\u0027ve added this back in."},{"file":"usr/src/uts/i86pc/ml/mpcore.s","line":611,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"needs updating"},{"file":"usr/src/uts/i86pc/ml/mpcore.s","line":611,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I\u0027ve added something here. Sorry about that."},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":901,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Some references to the intel docs would be useful"},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":901,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"So, I\u0027m not sure what to do here. Intel has changed how they\u0027ve done doc layouts a few times already. So the white papers are no longer useful and I\u0027m not sure what web content I should point people towards. Do you have suggestions for what content I should include given the likelihood that the URLs will change?"},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":901,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Previously/elsewhere, we\u0027ve used the document title and section, but maybe if there\u0027s nothing authoritative, we\u0027ve got nothing to point to."},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":909,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"s/exhaustive/exhaustive,/"},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":909,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":929,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"seems like v1 and related should have their own (short) sub-section, as they\u0027re basically totally unrelated to v2 class"},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":929,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":945,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"\"impactful\""},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":945,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":950,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Should we mention the flag that forces register-indirect calls?"},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":950,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":952,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"s/of these so that way/so that/"},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":952,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I\u0027ve changed this a bit to make it clear what these were and what the alternative was."},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":970,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"s/and that/and/"},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":970,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":984,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"\"used to implement retpolines\" here is a little confusing I think, it\u0027d be better if you just didn\u0027t explain further, or said it\u0027s a general mechanism for returning from calls."},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":984,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":998,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"These paragraphs would be clearer if you reversed it, something like:\n\nEIBRS+SMEP is sufficient for mitigating RSB issues when switching between user procs and VMX. If we do not have EIBRS,but do have SMEP, then we need to RSB stuff by hand.\nIF we don\u0027t even have SMEP, then..."},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":998,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I\u0027ve tried to take another swing at this. Any better?"},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":1003,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"I\u0027m not sure it really makes sense to have IBPB code there? Do you think we\u0027ll add the lx interface perhaps?"},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":1003,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"It\u0027s strictly needed for VM vs VM attacks, but that\u0027s not implemented right now. I\u0027ve ripped it out of this change for you. I guess someone else can redo it all later when they add it. Honestly, I\u0027m not sure I should have."},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":1058,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Is it worth mentioning that we don\u0027t stuff unused PTEs in the same way Linux does, so don\u0027t need to concern ourselves there?"},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":1058,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I\u0027ve tried to add something here to make it a bit clearer. Is this what you want?"},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":1066,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"\"Kernel\""},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":1066,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":1074,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"s/it can/the guest can/ ?"},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":1074,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I\u0027ve removed the pronoun here. Hopefully it\u0027s a bit clearer."},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":1076,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"s/ht/SMT/"},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":1076,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":1080,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"s/threads/thread/ ?"},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":1080,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I guess we only support a single other right now, so I can change it."},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":1086,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"MICRO-ARCHITECTURAL"},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":1086,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I\u0027ve fixed the typo, but Intel does not place a hyphen character here so I don\u0027t think it makes sense for me to."},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":1088,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"ditto"},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":1088,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"See above."},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":1104,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Can we work this a little bit to say we need to flush in these transitions, and in addition, MSBDS needs blah blah, and we do this for all cases by calling x86_md_clear() at the needed transition points."},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":1104,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I\u0027ve tried to rephrase this a bit. Is this better?"},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":1109,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"\"idles in\" needs reworking. CPU goes idle?"},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":1109,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":1133,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"\"Retpolines\""},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":1133,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":2439,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"NOP_INSTR please"},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":2439,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"OK, I\u0027ve changed this, but the header file used to define it only under _ASM, which is no longer the case."},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":2512,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"RET_INSTR please"},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":2512,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":2532,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"ditto"},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":2532,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":2586,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"what is this for?"},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":2586,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I was using it just for internal sanity checking and testing. I\u0027ve removed it."},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":2764,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"This isn\u0027t what\u0027s implemented?"},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":2764,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I think this was a pre EIBRS version. I\u0027ve updated it."},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":7275,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Why not just set the cpuset as needed instead of this extra arg?"},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":7275,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Because an xc_sync will not stop all CPUs while we perform this operation and we\u0027re modifying the global state. I want to ensure that all CPUs are paused and in the same state when we\u0027re modifying the instruction text that they could be in the middle of otherwise executing."},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":7275,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"OK, right."},{"file":"usr/src/uts/intel/Makefile.files","line":62,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"If we\u0027re going to introduce a DBOOT_OBJS for both i86pc and i86xpv, could we move the other common ones here too?"},{"file":"usr/src/uts/intel/Makefile.files","line":62,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I think I understand why you\u0027re asking for this; however, I don\u0027t believe this makes sense right now. Right now, retpoline.o is the only file from uts/intel that\u0027s being delivered here that I could see. All the other files live in uts/i86pc, in which case it\u0027s incorrect to put them in uts/intel\u0027s Makfile.files in my opinion."},{"file":"usr/src/uts/intel/Makefile.files","line":62,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"OK. Of course, those shared files should be really be under intel, but I understand that\u0027s not a thread you want to pull on here."},{"file":"usr/src/uts/intel/Makefile.rules","line":82,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"I\u0027d prefer this down around :272 ?"},{"file":"usr/src/uts/intel/Makefile.rules","line":82,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I guess I can see why you wouldn\u0027t want dboot stuff here. However, I don\u0027t really get why it makes sense at +272. That\u0027s all the kdi stuff that\u0027s still being built normally. Perhaps that file number made more sense in a different revision of Makefile.rules? I\u0027ve put it right near the _DBOOT comment for now. If that\u0027s still not good, can you please tell me between what other rules you\u0027d prefer it?"},{"file":"usr/src/uts/intel/Makefile.rules","line":82,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Think I got my files mixed up. Location is fine."},{"file":"usr/src/uts/intel/ia32/ml/i86_subr.s","line":2563,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"status? are you going to leave this in?"},{"file":"usr/src/uts/intel/ia32/ml/i86_subr.s","line":2563,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Ah, yeah. I think I convinced myself that it was ok to have it be a retpolined indirect jump for the time being."},{"file":"usr/src/uts/intel/ia32/ml/retpoline.s","line":16,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"why is this here rather than down before the code?"},{"file":"usr/src/uts/intel/ia32/ml/retpoline.s","line":16,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Because of how the prototype.s file is laid out. Would you rather I move it?"},{"file":"usr/src/uts/intel/ia32/ml/retpoline.s","line":16,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"No, it\u0027s fine."},{"file":"usr/src/uts/intel/ia32/ml/retpoline.s","line":18,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Almost all of this comment duplicates cpuid.c, and I think it should just point there. If we want stuff here, it should maybe go into detail as to where these code sequences came from, and what they actually do/help."},{"file":"usr/src/uts/intel/ia32/ml/retpoline.s","line":18,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I\u0027ve tried to clean this up. If there\u0027s content you believe has been lost that shouldn\u0027t be, please let me know."},{"file":"usr/src/uts/intel/ia32/ml/retpoline.s","line":104,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"\"copied\""},{"file":"usr/src/uts/intel/ia32/ml/retpoline.s","line":104,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"},{"file":"usr/src/uts/intel/ia32/ml/retpoline.s","line":110,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"\"interfere\". And I think it\u0027s Intel not the processor itself doing the claiming?"},{"file":"usr/src/uts/intel/ia32/ml/retpoline.s","line":110,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"},{"file":"usr/src/uts/intel/ia32/ml/retpoline.s","line":140,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Is \"sufficient\" the best wording here? Seems an odd word to then go ahead and talk about disabling the stuffing."},{"file":"usr/src/uts/intel/ia32/ml/retpoline.s","line":140,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"},{"file":"usr/src/uts/intel/ia32/ml/retpoline.s","line":143,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"\"because\""},{"file":"usr/src/uts/intel/ia32/ml/retpoline.s","line":143,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"},{"file":"usr/src/uts/intel/ia32/ml/retpoline.s","line":151,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"I\u0027m really unclear on why we actually have this present."},{"file":"usr/src/uts/intel/ia32/ml/retpoline.s","line":151,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I thought it made sense. I\u0027ve removed it per the feedback in cpuid.c."},{"file":"usr/src/uts/intel/ia32/ml/retpoline.s","line":158,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"\"present\""},{"file":"usr/src/uts/intel/ia32/ml/retpoline.s","line":158,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"},{"file":"usr/src/uts/intel/ia32/sys/asm_linkage.h","line":319,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"could use a trailing colon"},{"file":"usr/src/uts/intel/ia32/sys/asm_linkage.h","line":319,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"},{"file":"usr/src/uts/intel/ia32/sys/asm_linkage.h","line":321,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"\"favorite\""},{"file":"usr/src/uts/intel/ia32/sys/asm_linkage.h","line":321,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"},{"file":"usr/src/uts/intel/ia32/sys/asm_linkage.h","line":325,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"s/instead need/need/"},{"file":"usr/src/uts/intel/ia32/sys/asm_linkage.h","line":325,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"},{"file":"usr/src/uts/intel/ia32/sys/asm_linkage.h","line":327,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"ditto"},{"file":"usr/src/uts/intel/ia32/sys/asm_linkage.h","line":327,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"},{"file":"usr/src/uts/intel/sys/x86_archext.h","line":588,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"\"This controls instruction decoding.\""},{"file":"usr/src/uts/intel/sys/x86_archext.h","line":588,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"usr/src/uts/Makefile.uts","type":"MODIFIED","insertions":11,"deletions":-1},{"file":"usr/src/uts/common/mapfiles/ddi.mapfile","type":"MODIFIED","insertions":17,"deletions":-1},{"file":"usr/src/uts/i86pc/ml/cpr_wakecode.s","type":"MODIFIED","insertions":16,"deletions":-13},{"file":"usr/src/uts/i86pc/ml/fast_trap_asm.s","type":"MODIFIED","insertions":5,"deletions":-4},{"file":"usr/src/uts/i86pc/ml/interrupt.s","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/i86pc/ml/locore.s","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"usr/src/uts/i86pc/ml/md_clear.s","type":"MODIFIED","insertions":6,"deletions":-8},{"file":"usr/src/uts/i86pc/ml/mpcore.s","type":"MODIFIED","insertions":17,"deletions":-15},{"file":"usr/src/uts/i86pc/ml/syscall_asm_amd64.s","type":"MODIFIED","insertions":14,"deletions":-10},{"file":"usr/src/uts/i86pc/os/cpuid.c","type":"MODIFIED","insertions":468,"deletions":-11},{"file":"usr/src/uts/i86pc/sys/machprivregs.h","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/intel/Makefile.files","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/uts/intel/Makefile.rules","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/uts/intel/amd64/krtld/kobj_crt.s","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"usr/src/uts/intel/brand/common/brand_solaris.s","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"usr/src/uts/intel/ia32/ml/copy.s","type":"MODIFIED","insertions":90,"deletions":-82},{"file":"usr/src/uts/intel/ia32/ml/ddi_i86_asm.s","type":"MODIFIED","insertions":48,"deletions":-30},{"file":"usr/src/uts/intel/ia32/ml/exception.s","type":"MODIFIED","insertions":5,"deletions":-4},{"file":"usr/src/uts/intel/ia32/ml/hypersubr.s","type":"MODIFIED","insertions":10,"deletions":-6},{"file":"usr/src/uts/intel/ia32/ml/i86_subr.s","type":"MODIFIED","insertions":51,"deletions":-48},{"file":"usr/src/uts/intel/ia32/ml/lock_prim.s","type":"MODIFIED","insertions":4,"deletions":-2},{"file":"usr/src/uts/intel/ia32/ml/retpoline.s","type":"ADDED","insertions":322,"deletions":0},{"file":"usr/src/uts/intel/ia32/ml/swtch.s","type":"MODIFIED","insertions":15,"deletions":-7},{"file":"usr/src/uts/intel/ia32/sys/asm_linkage.h","type":"MODIFIED","insertions":36,"deletions":-2},{"file":"usr/src/uts/intel/sys/x86_archext.h","type":"MODIFIED","insertions":17,"deletions":-10}],"sizeInsertions":1171,"sizeDeletions":-265},{"number":"2","revision":"493458fa608d45915096fd4002d6edf89e50a873","parents":["f77b706441b4a961d2116fb1ca1e3c3b07d10048"],"ref":"refs/changes/53/6453/2","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1561037377,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/uts/i86pc/os/cpuid.c","line":954,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"\"callsite\" :)"},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":954,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":1007,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"isn\u0027t it better to say \"need to do\" ?"},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":1007,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I\u0027m not sure it is. The reason I say can, is because the basically RSB stuffing is ineffective and it\u0027s not clear what we can do in this situation other than trust the processor. It\u0027s basically an indication that RSB stuffing is ineffective, but if we were worried about user vs. user or other cases, it\u0027s not sufficient."},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":1007,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Well, this does say \"protect the kernel\", but OK."},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":1007,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"OK, I\u0027ve changed it. I guess part of the reason is mostly doubt in the comment."},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":1014,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Worth a brief mention that `vmm` exit has its own stuffing?"},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":1014,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I believe we should replace it with our version so it\u0027s properly nopped out when its not there. I\u0027m going to file a follow up ticket about this and sync with folks on it. So I\u0027d rather not mention it as I fear it\u0027ll just get out of date. Are you OK with that? I filed OS-7851."},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":1014,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Yep, that\u0027s fine."},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":1056,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"defense"},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":1056,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":1057,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"any"},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":1057,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":1079,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"led to this being"},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":1079,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":1166,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Maybe say \"subset\" instead? I was a little confused by the word \"part\" and how to interpret it here."},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":1166,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":2772,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"I\u0027d be inclined to remove the last sentence. You already talk about this in the big comment, and right now it still contradicts the previous sentence."},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":2772,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":7277,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"suit"},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":7277,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"},{"file":"usr/src/uts/i86pc/sys/asm_misc.h","line":24,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"copyright?"},{"file":"usr/src/uts/i86pc/sys/asm_misc.h","line":24,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"},{"file":"usr/src/uts/intel/ia32/ml/retpoline.s","line":22,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"s/i86ps/i86pc/"},{"file":"usr/src/uts/intel/ia32/ml/retpoline.s","line":22,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"usr/src/uts/Makefile.uts","type":"MODIFIED","insertions":11,"deletions":-1},{"file":"usr/src/uts/common/mapfiles/ddi.mapfile","type":"MODIFIED","insertions":16,"deletions":0},{"file":"usr/src/uts/i86pc/ml/cpr_wakecode.s","type":"MODIFIED","insertions":15,"deletions":-12},{"file":"usr/src/uts/i86pc/ml/fast_trap_asm.s","type":"MODIFIED","insertions":5,"deletions":-4},{"file":"usr/src/uts/i86pc/ml/interrupt.s","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/i86pc/ml/locore.s","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"usr/src/uts/i86pc/ml/md_clear.s","type":"MODIFIED","insertions":9,"deletions":-8},{"file":"usr/src/uts/i86pc/ml/mpcore.s","type":"MODIFIED","insertions":22,"deletions":-15},{"file":"usr/src/uts/i86pc/ml/syscall_asm_amd64.s","type":"MODIFIED","insertions":14,"deletions":-10},{"file":"usr/src/uts/i86pc/os/cpuid.c","type":"MODIFIED","insertions":473,"deletions":-11},{"file":"usr/src/uts/i86pc/sys/asm_misc.h","type":"MODIFIED","insertions":5,"deletions":-6},{"file":"usr/src/uts/i86pc/sys/machprivregs.h","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/intel/Makefile.files","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/uts/intel/Makefile.rules","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/uts/intel/amd64/krtld/kobj_crt.s","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"usr/src/uts/intel/brand/common/brand_solaris.s","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"usr/src/uts/intel/ia32/ml/copy.s","type":"MODIFIED","insertions":90,"deletions":-82},{"file":"usr/src/uts/intel/ia32/ml/ddi_i86_asm.s","type":"MODIFIED","insertions":48,"deletions":-30},{"file":"usr/src/uts/intel/ia32/ml/exception.s","type":"MODIFIED","insertions":5,"deletions":-4},{"file":"usr/src/uts/intel/ia32/ml/hypersubr.s","type":"MODIFIED","insertions":10,"deletions":-6},{"file":"usr/src/uts/intel/ia32/ml/i86_subr.s","type":"MODIFIED","insertions":50,"deletions":-48},{"file":"usr/src/uts/intel/ia32/ml/lock_prim.s","type":"MODIFIED","insertions":4,"deletions":-2},{"file":"usr/src/uts/intel/ia32/ml/retpoline.s","type":"ADDED","insertions":211,"deletions":0},{"file":"usr/src/uts/intel/ia32/ml/swtch.s","type":"MODIFIED","insertions":15,"deletions":-7},{"file":"usr/src/uts/intel/ia32/sys/asm_linkage.h","type":"MODIFIED","insertions":36,"deletions":-2},{"file":"usr/src/uts/intel/sys/x86_archext.h","type":"MODIFIED","insertions":15,"deletions":-10}],"sizeInsertions":1074,"sizeDeletions":-269},{"number":"3","revision":"5bd26e19ae6993ac01e9812206381282a43a7d9f","parents":["f77b706441b4a961d2116fb1ca1e3c3b07d10048"],"ref":"refs/changes/53/6453/3","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1561140686,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/uts/i86pc/os/cpuid.c","line":1033,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Elsewhere we really only use \u0027trampolines\u0027 for KPTI. Can we say \"retpoline thunks\" instead?"},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":1033,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":1036,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"So, I agree it\u0027s hard to see an actual meaningful way to exploit KMDB, so I think it\u0027s fine not to do anything.\n\nMaybe I need more coffee, though, but what\u0027s the specific reason kmdb can\u0027t just rely on the kernel-provided thunks?"},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":1036,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I\u0027m not sure how to convince that to be rigged up. It\u0027s not clear to me today that kmdb uses any of the functions that are provided by unix or genunix."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"usr/src/uts/Makefile.uts","type":"MODIFIED","insertions":11,"deletions":-1},{"file":"usr/src/uts/common/mapfiles/ddi.mapfile","type":"MODIFIED","insertions":16,"deletions":0},{"file":"usr/src/uts/i86pc/ml/cpr_wakecode.s","type":"MODIFIED","insertions":15,"deletions":-12},{"file":"usr/src/uts/i86pc/ml/fast_trap_asm.s","type":"MODIFIED","insertions":5,"deletions":-4},{"file":"usr/src/uts/i86pc/ml/interrupt.s","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/i86pc/ml/locore.s","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"usr/src/uts/i86pc/ml/md_clear.s","type":"MODIFIED","insertions":9,"deletions":-8},{"file":"usr/src/uts/i86pc/ml/mpcore.s","type":"MODIFIED","insertions":22,"deletions":-15},{"file":"usr/src/uts/i86pc/ml/syscall_asm_amd64.s","type":"MODIFIED","insertions":14,"deletions":-10},{"file":"usr/src/uts/i86pc/os/cpuid.c","type":"MODIFIED","insertions":477,"deletions":-11},{"file":"usr/src/uts/i86pc/sys/asm_misc.h","type":"MODIFIED","insertions":6,"deletions":-7},{"file":"usr/src/uts/i86pc/sys/machprivregs.h","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/intel/Makefile.files","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/uts/intel/Makefile.rules","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/uts/intel/amd64/krtld/kobj_crt.s","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"usr/src/uts/intel/brand/common/brand_solaris.s","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"usr/src/uts/intel/ia32/ml/copy.s","type":"MODIFIED","insertions":90,"deletions":-82},{"file":"usr/src/uts/intel/ia32/ml/ddi_i86_asm.s","type":"MODIFIED","insertions":48,"deletions":-30},{"file":"usr/src/uts/intel/ia32/ml/exception.s","type":"MODIFIED","insertions":5,"deletions":-4},{"file":"usr/src/uts/intel/ia32/ml/hypersubr.s","type":"MODIFIED","insertions":10,"deletions":-6},{"file":"usr/src/uts/intel/ia32/ml/i86_subr.s","type":"MODIFIED","insertions":50,"deletions":-48},{"file":"usr/src/uts/intel/ia32/ml/lock_prim.s","type":"MODIFIED","insertions":4,"deletions":-2},{"file":"usr/src/uts/intel/ia32/ml/retpoline.s","type":"ADDED","insertions":211,"deletions":0},{"file":"usr/src/uts/intel/ia32/ml/swtch.s","type":"MODIFIED","insertions":15,"deletions":-7},{"file":"usr/src/uts/intel/ia32/sys/asm_linkage.h","type":"MODIFIED","insertions":36,"deletions":-2},{"file":"usr/src/uts/intel/sys/x86_archext.h","type":"MODIFIED","insertions":15,"deletions":-10}],"sizeInsertions":1079,"sizeDeletions":-270},{"number":"4","revision":"0862834361251939e7ec7659eac63543b14b046e","parents":["89f5e4c2201775567c50623101b9f0d303040bf3"],"ref":"refs/changes/53/6453/4","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1561410464,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1561411528,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"comments":[{"file":"usr/src/uts/i86pc/ml/md_clear.s","line":48,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Is there a reason to use the double negative here? I re-read this several times and I\u0027m still not sure I understand it. Do you mean \"... and we know we\u0027re impacted.\"?"},{"file":"usr/src/uts/i86pc/ml/md_clear.s","line":48,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"You\u0027re right. That sentence is pretty terrible! I\u0027ve tried to improve it and get at what it should have."},{"file":"usr/src/uts/intel/ia32/ml/hypersubr.s","line":189,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"since you\u0027re touching this line, why not just remove the ifdef altogether?"},{"file":"usr/src/uts/intel/ia32/ml/hypersubr.s","line":189,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I purposefully left that alone here to make it easier to review and merge. I only touched this because of pbchk."},{"file":"usr/src/uts/intel/ia32/ml/i86_subr.s","line":1683,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Maybe remove this ifdef too and delete the i386 block since you touching this anyway. There\u0027s other places you\u0027re modifying like this in this file below. I guess it\u0027s up to you if you want to do that or not."},{"file":"usr/src/uts/intel/ia32/ml/i86_subr.s","line":1683,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I purposefully left that alone here to make it easier to review and merge."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"usr/src/uts/Makefile.uts","type":"MODIFIED","insertions":11,"deletions":-1},{"file":"usr/src/uts/common/mapfiles/ddi.mapfile","type":"MODIFIED","insertions":16,"deletions":0},{"file":"usr/src/uts/i86pc/ml/cpr_wakecode.s","type":"MODIFIED","insertions":15,"deletions":-12},{"file":"usr/src/uts/i86pc/ml/fast_trap_asm.s","type":"MODIFIED","insertions":5,"deletions":-4},{"file":"usr/src/uts/i86pc/ml/interrupt.s","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/i86pc/ml/locore.s","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"usr/src/uts/i86pc/ml/md_clear.s","type":"MODIFIED","insertions":9,"deletions":-8},{"file":"usr/src/uts/i86pc/ml/mpcore.s","type":"MODIFIED","insertions":22,"deletions":-15},{"file":"usr/src/uts/i86pc/ml/syscall_asm_amd64.s","type":"MODIFIED","insertions":14,"deletions":-10},{"file":"usr/src/uts/i86pc/os/cpuid.c","type":"MODIFIED","insertions":477,"deletions":-11},{"file":"usr/src/uts/i86pc/sys/asm_misc.h","type":"MODIFIED","insertions":6,"deletions":-7},{"file":"usr/src/uts/i86pc/sys/machprivregs.h","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/intel/Makefile.files","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/uts/intel/Makefile.rules","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/uts/intel/amd64/krtld/kobj_crt.s","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"usr/src/uts/intel/brand/common/brand_solaris.s","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"usr/src/uts/intel/ia32/ml/copy.s","type":"MODIFIED","insertions":90,"deletions":-82},{"file":"usr/src/uts/intel/ia32/ml/ddi_i86_asm.s","type":"MODIFIED","insertions":48,"deletions":-30},{"file":"usr/src/uts/intel/ia32/ml/exception.s","type":"MODIFIED","insertions":5,"deletions":-4},{"file":"usr/src/uts/intel/ia32/ml/hypersubr.s","type":"MODIFIED","insertions":10,"deletions":-6},{"file":"usr/src/uts/intel/ia32/ml/i86_subr.s","type":"MODIFIED","insertions":50,"deletions":-48},{"file":"usr/src/uts/intel/ia32/ml/lock_prim.s","type":"MODIFIED","insertions":4,"deletions":-2},{"file":"usr/src/uts/intel/ia32/ml/retpoline.s","type":"ADDED","insertions":211,"deletions":0},{"file":"usr/src/uts/intel/ia32/ml/swtch.s","type":"MODIFIED","insertions":15,"deletions":-7},{"file":"usr/src/uts/intel/ia32/sys/asm_linkage.h","type":"MODIFIED","insertions":36,"deletions":-2},{"file":"usr/src/uts/intel/sys/x86_archext.h","type":"MODIFIED","insertions":15,"deletions":-10}],"sizeInsertions":1079,"sizeDeletions":-270},{"number":"5","revision":"39ef78046a2ae2c237d9dd70c805daa9ceed8b58","parents":["89f5e4c2201775567c50623101b9f0d303040bf3"],"ref":"refs/changes/53/6453/5","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1561597999,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1561652913,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1561628525,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"usr/src/uts/Makefile.uts","type":"MODIFIED","insertions":11,"deletions":-1},{"file":"usr/src/uts/common/mapfiles/ddi.mapfile","type":"MODIFIED","insertions":16,"deletions":0},{"file":"usr/src/uts/i86pc/ml/cpr_wakecode.s","type":"MODIFIED","insertions":15,"deletions":-12},{"file":"usr/src/uts/i86pc/ml/fast_trap_asm.s","type":"MODIFIED","insertions":5,"deletions":-4},{"file":"usr/src/uts/i86pc/ml/interrupt.s","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/i86pc/ml/locore.s","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"usr/src/uts/i86pc/ml/md_clear.s","type":"MODIFIED","insertions":9,"deletions":-7},{"file":"usr/src/uts/i86pc/ml/mpcore.s","type":"MODIFIED","insertions":22,"deletions":-15},{"file":"usr/src/uts/i86pc/ml/syscall_asm_amd64.s","type":"MODIFIED","insertions":14,"deletions":-10},{"file":"usr/src/uts/i86pc/os/cpuid.c","type":"MODIFIED","insertions":477,"deletions":-11},{"file":"usr/src/uts/i86pc/sys/asm_misc.h","type":"MODIFIED","insertions":6,"deletions":-7},{"file":"usr/src/uts/i86pc/sys/machprivregs.h","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/intel/Makefile.files","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/uts/intel/Makefile.rules","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/uts/intel/amd64/krtld/kobj_crt.s","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"usr/src/uts/intel/brand/common/brand_solaris.s","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"usr/src/uts/intel/ia32/ml/copy.s","type":"MODIFIED","insertions":90,"deletions":-82},{"file":"usr/src/uts/intel/ia32/ml/ddi_i86_asm.s","type":"MODIFIED","insertions":48,"deletions":-30},{"file":"usr/src/uts/intel/ia32/ml/exception.s","type":"MODIFIED","insertions":5,"deletions":-4},{"file":"usr/src/uts/intel/ia32/ml/hypersubr.s","type":"MODIFIED","insertions":10,"deletions":-6},{"file":"usr/src/uts/intel/ia32/ml/i86_subr.s","type":"MODIFIED","insertions":50,"deletions":-48},{"file":"usr/src/uts/intel/ia32/ml/lock_prim.s","type":"MODIFIED","insertions":4,"deletions":-2},{"file":"usr/src/uts/intel/ia32/ml/retpoline.s","type":"ADDED","insertions":211,"deletions":0},{"file":"usr/src/uts/intel/ia32/ml/swtch.s","type":"MODIFIED","insertions":15,"deletions":-7},{"file":"usr/src/uts/intel/ia32/sys/asm_linkage.h","type":"MODIFIED","insertions":36,"deletions":-2},{"file":"usr/src/uts/intel/sys/x86_archext.h","type":"MODIFIED","insertions":15,"deletions":-10}],"sizeInsertions":1079,"sizeDeletions":-269},{"number":"6","revision":"a4319601da385b15f07cfe915b8203604528392c","parents":["0b0f2cee148e818b867c0a4453017a8a7fe43099"],"ref":"refs/changes/53/6453/6","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1565312975,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/uts/intel/ia32/ml/modstubs.s","line":152,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"not really for you to fix, but it\u0027s a little gross that MODS_INSTFCN is unused when it really should be used here!"},{"file":"usr/src/uts/intel/ia32/ml/modstubs.s","line":152,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"},{"file":"usr/src/uts/intel/ia32/ml/modstubs.s","line":243,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"\"unsupported\""},{"file":"usr/src/uts/intel/ia32/ml/modstubs.s","line":243,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"usr/src/uts/Makefile.uts","type":"MODIFIED","insertions":11,"deletions":-1},{"file":"usr/src/uts/common/mapfiles/ddi.mapfile","type":"MODIFIED","insertions":16,"deletions":0},{"file":"usr/src/uts/i86pc/ml/cpr_wakecode.s","type":"MODIFIED","insertions":15,"deletions":-12},{"file":"usr/src/uts/i86pc/ml/fast_trap_asm.s","type":"MODIFIED","insertions":5,"deletions":-4},{"file":"usr/src/uts/i86pc/ml/interrupt.s","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/i86pc/ml/locore.s","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"usr/src/uts/i86pc/ml/md_clear.s","type":"MODIFIED","insertions":9,"deletions":-7},{"file":"usr/src/uts/i86pc/ml/mpcore.s","type":"MODIFIED","insertions":22,"deletions":-15},{"file":"usr/src/uts/i86pc/ml/syscall_asm_amd64.s","type":"MODIFIED","insertions":14,"deletions":-10},{"file":"usr/src/uts/i86pc/os/cpuid.c","type":"MODIFIED","insertions":477,"deletions":-11},{"file":"usr/src/uts/i86pc/sys/asm_misc.h","type":"MODIFIED","insertions":6,"deletions":-7},{"file":"usr/src/uts/i86pc/sys/machprivregs.h","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/intel/Makefile.files","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/uts/intel/Makefile.rules","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/uts/intel/amd64/krtld/kobj_crt.s","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"usr/src/uts/intel/brand/common/brand_solaris.s","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"usr/src/uts/intel/ia32/ml/copy.s","type":"MODIFIED","insertions":90,"deletions":-82},{"file":"usr/src/uts/intel/ia32/ml/ddi_i86_asm.s","type":"MODIFIED","insertions":48,"deletions":-30},{"file":"usr/src/uts/intel/ia32/ml/exception.s","type":"MODIFIED","insertions":5,"deletions":-4},{"file":"usr/src/uts/intel/ia32/ml/hypersubr.s","type":"MODIFIED","insertions":10,"deletions":-6},{"file":"usr/src/uts/intel/ia32/ml/i86_subr.s","type":"MODIFIED","insertions":50,"deletions":-48},{"file":"usr/src/uts/intel/ia32/ml/lock_prim.s","type":"MODIFIED","insertions":4,"deletions":-2},{"file":"usr/src/uts/intel/ia32/ml/modstubs.s","type":"MODIFIED","insertions":12,"deletions":-134},{"file":"usr/src/uts/intel/ia32/ml/retpoline.s","type":"ADDED","insertions":211,"deletions":0},{"file":"usr/src/uts/intel/ia32/ml/swtch.s","type":"MODIFIED","insertions":15,"deletions":-7},{"file":"usr/src/uts/intel/ia32/sys/asm_linkage.h","type":"MODIFIED","insertions":44,"deletions":-2},{"file":"usr/src/uts/intel/sys/x86_archext.h","type":"MODIFIED","insertions":15,"deletions":-10}],"sizeInsertions":1099,"sizeDeletions":-403},{"number":"7","revision":"7c66686f4db61f2a6126b7abb2a8b9da7b8f2b1a","parents":["afa2f5988d239a814728fc9aa834b8ef78570783"],"ref":"refs/changes/53/6453/7","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1565375470,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1565998634,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1565381226,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1565378389,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"usr/src/uts/Makefile.uts","type":"MODIFIED","insertions":11,"deletions":-1},{"file":"usr/src/uts/common/mapfiles/ddi.mapfile","type":"MODIFIED","insertions":16,"deletions":0},{"file":"usr/src/uts/i86pc/ml/cpr_wakecode.s","type":"MODIFIED","insertions":15,"deletions":-12},{"file":"usr/src/uts/i86pc/ml/fast_trap_asm.s","type":"MODIFIED","insertions":5,"deletions":-4},{"file":"usr/src/uts/i86pc/ml/interrupt.s","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/i86pc/ml/locore.s","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"usr/src/uts/i86pc/ml/md_clear.s","type":"MODIFIED","insertions":9,"deletions":-7},{"file":"usr/src/uts/i86pc/ml/mpcore.s","type":"MODIFIED","insertions":22,"deletions":-15},{"file":"usr/src/uts/i86pc/ml/syscall_asm_amd64.s","type":"MODIFIED","insertions":14,"deletions":-10},{"file":"usr/src/uts/i86pc/os/cpuid.c","type":"MODIFIED","insertions":477,"deletions":-11},{"file":"usr/src/uts/i86pc/sys/asm_misc.h","type":"MODIFIED","insertions":6,"deletions":-7},{"file":"usr/src/uts/i86pc/sys/machprivregs.h","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/intel/Makefile.files","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/uts/intel/Makefile.rules","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/uts/intel/amd64/krtld/kobj_crt.s","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"usr/src/uts/intel/brand/common/brand_solaris.s","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"usr/src/uts/intel/ia32/ml/copy.s","type":"MODIFIED","insertions":90,"deletions":-82},{"file":"usr/src/uts/intel/ia32/ml/ddi_i86_asm.s","type":"MODIFIED","insertions":48,"deletions":-30},{"file":"usr/src/uts/intel/ia32/ml/exception.s","type":"MODIFIED","insertions":5,"deletions":-4},{"file":"usr/src/uts/intel/ia32/ml/hypersubr.s","type":"MODIFIED","insertions":10,"deletions":-6},{"file":"usr/src/uts/intel/ia32/ml/i86_subr.s","type":"MODIFIED","insertions":50,"deletions":-48},{"file":"usr/src/uts/intel/ia32/ml/lock_prim.s","type":"MODIFIED","insertions":4,"deletions":-2},{"file":"usr/src/uts/intel/ia32/ml/modstubs.s","type":"MODIFIED","insertions":63,"deletions":-185},{"file":"usr/src/uts/intel/ia32/ml/retpoline.s","type":"ADDED","insertions":211,"deletions":0},{"file":"usr/src/uts/intel/ia32/ml/swtch.s","type":"MODIFIED","insertions":15,"deletions":-7},{"file":"usr/src/uts/intel/ia32/sys/asm_linkage.h","type":"MODIFIED","insertions":44,"deletions":-2},{"file":"usr/src/uts/intel/sys/x86_archext.h","type":"MODIFIED","insertions":15,"deletions":-10}],"sizeInsertions":1150,"sizeDeletions":-454},{"number":"8","revision":"965ccc6c24569f9736d33883ecc4a82af2fbdfe6","parents":["a869929c07c7ece125b48e5e1941d16723d26d1e"],"ref":"refs/changes/53/6453/8","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1566236964,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1565998634,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1565381226,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1565378389,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"usr/src/uts/Makefile.uts","type":"MODIFIED","insertions":11,"deletions":-1},{"file":"usr/src/uts/common/mapfiles/ddi.mapfile","type":"MODIFIED","insertions":16,"deletions":0},{"file":"usr/src/uts/i86pc/ml/cpr_wakecode.s","type":"MODIFIED","insertions":15,"deletions":-12},{"file":"usr/src/uts/i86pc/ml/fast_trap_asm.s","type":"MODIFIED","insertions":5,"deletions":-4},{"file":"usr/src/uts/i86pc/ml/interrupt.s","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/i86pc/ml/locore.s","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"usr/src/uts/i86pc/ml/md_clear.s","type":"MODIFIED","insertions":9,"deletions":-7},{"file":"usr/src/uts/i86pc/ml/mpcore.s","type":"MODIFIED","insertions":22,"deletions":-15},{"file":"usr/src/uts/i86pc/ml/syscall_asm_amd64.s","type":"MODIFIED","insertions":14,"deletions":-10},{"file":"usr/src/uts/i86pc/os/cpuid.c","type":"MODIFIED","insertions":477,"deletions":-11},{"file":"usr/src/uts/i86pc/sys/asm_misc.h","type":"MODIFIED","insertions":6,"deletions":-7},{"file":"usr/src/uts/i86pc/sys/machprivregs.h","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/intel/Makefile.files","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/uts/intel/Makefile.rules","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/uts/intel/amd64/krtld/kobj_crt.s","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"usr/src/uts/intel/brand/common/brand_solaris.s","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"usr/src/uts/intel/ia32/ml/copy.s","type":"MODIFIED","insertions":90,"deletions":-82},{"file":"usr/src/uts/intel/ia32/ml/ddi_i86_asm.s","type":"MODIFIED","insertions":48,"deletions":-30},{"file":"usr/src/uts/intel/ia32/ml/exception.s","type":"MODIFIED","insertions":5,"deletions":-4},{"file":"usr/src/uts/intel/ia32/ml/hypersubr.s","type":"MODIFIED","insertions":10,"deletions":-6},{"file":"usr/src/uts/intel/ia32/ml/i86_subr.s","type":"MODIFIED","insertions":50,"deletions":-48},{"file":"usr/src/uts/intel/ia32/ml/lock_prim.s","type":"MODIFIED","insertions":4,"deletions":-2},{"file":"usr/src/uts/intel/ia32/ml/modstubs.s","type":"MODIFIED","insertions":63,"deletions":-185},{"file":"usr/src/uts/intel/ia32/ml/retpoline.s","type":"ADDED","insertions":211,"deletions":0},{"file":"usr/src/uts/intel/ia32/ml/swtch.s","type":"MODIFIED","insertions":15,"deletions":-7},{"file":"usr/src/uts/intel/ia32/sys/asm_linkage.h","type":"MODIFIED","insertions":44,"deletions":-2},{"file":"usr/src/uts/intel/sys/x86_archext.h","type":"MODIFIED","insertions":15,"deletions":-10}],"sizeInsertions":1150,"sizeDeletions":-454},{"number":"9","revision":"dfd7ecd277c229ee97fad1b39b7c4e811859123a","parents":["edccf53a08a5dc2a1536d248367ab3aaf477ae60"],"ref":"refs/changes/53/6453/9","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1566237112,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"NO_CHANGE","approvals":[{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1565998634,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1565381226,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1565378389,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"usr/src/uts/Makefile.uts","type":"MODIFIED","insertions":11,"deletions":-1},{"file":"usr/src/uts/common/mapfiles/ddi.mapfile","type":"MODIFIED","insertions":16,"deletions":0},{"file":"usr/src/uts/i86pc/ml/cpr_wakecode.s","type":"MODIFIED","insertions":15,"deletions":-12},{"file":"usr/src/uts/i86pc/ml/fast_trap_asm.s","type":"MODIFIED","insertions":5,"deletions":-4},{"file":"usr/src/uts/i86pc/ml/interrupt.s","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/i86pc/ml/locore.s","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"usr/src/uts/i86pc/ml/md_clear.s","type":"MODIFIED","insertions":9,"deletions":-7},{"file":"usr/src/uts/i86pc/ml/mpcore.s","type":"MODIFIED","insertions":22,"deletions":-15},{"file":"usr/src/uts/i86pc/ml/syscall_asm_amd64.s","type":"MODIFIED","insertions":14,"deletions":-10},{"file":"usr/src/uts/i86pc/os/cpuid.c","type":"MODIFIED","insertions":477,"deletions":-11},{"file":"usr/src/uts/i86pc/sys/asm_misc.h","type":"MODIFIED","insertions":6,"deletions":-7},{"file":"usr/src/uts/i86pc/sys/machprivregs.h","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/intel/Makefile.files","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/uts/intel/Makefile.rules","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/uts/intel/amd64/krtld/kobj_crt.s","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"usr/src/uts/intel/brand/common/brand_solaris.s","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"usr/src/uts/intel/ia32/ml/copy.s","type":"MODIFIED","insertions":90,"deletions":-82},{"file":"usr/src/uts/intel/ia32/ml/ddi_i86_asm.s","type":"MODIFIED","insertions":48,"deletions":-30},{"file":"usr/src/uts/intel/ia32/ml/exception.s","type":"MODIFIED","insertions":5,"deletions":-4},{"file":"usr/src/uts/intel/ia32/ml/hypersubr.s","type":"MODIFIED","insertions":10,"deletions":-6},{"file":"usr/src/uts/intel/ia32/ml/i86_subr.s","type":"MODIFIED","insertions":50,"deletions":-48},{"file":"usr/src/uts/intel/ia32/ml/lock_prim.s","type":"MODIFIED","insertions":4,"deletions":-2},{"file":"usr/src/uts/intel/ia32/ml/modstubs.s","type":"MODIFIED","insertions":63,"deletions":-185},{"file":"usr/src/uts/intel/ia32/ml/retpoline.s","type":"ADDED","insertions":211,"deletions":0},{"file":"usr/src/uts/intel/ia32/ml/swtch.s","type":"MODIFIED","insertions":15,"deletions":-7},{"file":"usr/src/uts/intel/ia32/sys/asm_linkage.h","type":"MODIFIED","insertions":44,"deletions":-2},{"file":"usr/src/uts/intel/sys/x86_archext.h","type":"MODIFIED","insertions":15,"deletions":-10}],"sizeInsertions":1150,"sizeDeletions":-454},{"number":"10","revision":"fae35450c961f8c5a41382adf0e202906b2c4584","parents":["edccf53a08a5dc2a1536d248367ab3aaf477ae60"],"ref":"refs/changes/53/6453/10","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1566237194,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"SUBM","value":"1","grantedOn":1566239845,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1565998634,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1565381226,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1565378389,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"usr/src/uts/Makefile.uts","type":"MODIFIED","insertions":11,"deletions":-1},{"file":"usr/src/uts/common/mapfiles/ddi.mapfile","type":"MODIFIED","insertions":16,"deletions":0},{"file":"usr/src/uts/i86pc/ml/cpr_wakecode.s","type":"MODIFIED","insertions":15,"deletions":-12},{"file":"usr/src/uts/i86pc/ml/fast_trap_asm.s","type":"MODIFIED","insertions":5,"deletions":-4},{"file":"usr/src/uts/i86pc/ml/interrupt.s","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/i86pc/ml/locore.s","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"usr/src/uts/i86pc/ml/md_clear.s","type":"MODIFIED","insertions":9,"deletions":-7},{"file":"usr/src/uts/i86pc/ml/mpcore.s","type":"MODIFIED","insertions":22,"deletions":-15},{"file":"usr/src/uts/i86pc/ml/syscall_asm_amd64.s","type":"MODIFIED","insertions":14,"deletions":-10},{"file":"usr/src/uts/i86pc/os/cpuid.c","type":"MODIFIED","insertions":477,"deletions":-11},{"file":"usr/src/uts/i86pc/sys/asm_misc.h","type":"MODIFIED","insertions":6,"deletions":-7},{"file":"usr/src/uts/i86pc/sys/machprivregs.h","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/intel/Makefile.files","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/uts/intel/Makefile.rules","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/uts/intel/amd64/krtld/kobj_crt.s","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"usr/src/uts/intel/brand/common/brand_solaris.s","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"usr/src/uts/intel/ia32/ml/copy.s","type":"MODIFIED","insertions":90,"deletions":-82},{"file":"usr/src/uts/intel/ia32/ml/ddi_i86_asm.s","type":"MODIFIED","insertions":48,"deletions":-30},{"file":"usr/src/uts/intel/ia32/ml/exception.s","type":"MODIFIED","insertions":5,"deletions":-4},{"file":"usr/src/uts/intel/ia32/ml/hypersubr.s","type":"MODIFIED","insertions":10,"deletions":-6},{"file":"usr/src/uts/intel/ia32/ml/i86_subr.s","type":"MODIFIED","insertions":50,"deletions":-48},{"file":"usr/src/uts/intel/ia32/ml/lock_prim.s","type":"MODIFIED","insertions":4,"deletions":-2},{"file":"usr/src/uts/intel/ia32/ml/modstubs.s","type":"MODIFIED","insertions":63,"deletions":-185},{"file":"usr/src/uts/intel/ia32/ml/retpoline.s","type":"ADDED","insertions":211,"deletions":0},{"file":"usr/src/uts/intel/ia32/ml/swtch.s","type":"MODIFIED","insertions":15,"deletions":-7},{"file":"usr/src/uts/intel/ia32/sys/asm_linkage.h","type":"MODIFIED","insertions":44,"deletions":-2},{"file":"usr/src/uts/intel/sys/x86_archext.h","type":"MODIFIED","insertions":15,"deletions":-10}],"sizeInsertions":1150,"sizeDeletions":-454}],"allReviewers":[{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}]}