{"project":"joyent/node-triton","branch":"master","id":"I17669f35eac0a45bdff365aadbc2cf4c208fe9ba","number":"1769","subject":"joyent/node-triton#197 Create triton image export command","owner":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"url":"https://cr.joyent.us/1769","commitMessage":"joyent/node-triton#197 Create triton image export command\n","createdOn":1491598829,"lastUpdated":1491937605,"open":false,"status":"MERGED","comments":[{"timestamp":1491598829,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Uploaded patch set 1."},{"timestamp":1491598857,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1491599981,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 1:\n\n(6 comments)"},{"timestamp":1491608999,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Uploaded patch set 2."},{"timestamp":1491609026,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1491854030,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 2:\n\n(15 comments)\n\nThanks! Mostly nits."},{"timestamp":1491861536,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 2:\n\n(2 comments)"},{"timestamp":1491861977,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1491863788,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Uploaded patch set 3."},{"timestamp":1491863815,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1491932756,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 3: Code-Review+1 Integration-Approval+1\n\nCan you please follow up with a node-triton issue to add a test case for \u0027triton image export\u0027. Doing it separately because the mechanics of only testing of the target has an associated Manta is a pain.\n\nQ: What is the behaviour if the DC doesn\u0027t have a Manta to use? E.g. in COAL."},{"timestamp":1491933655,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 3:\n\njoyent/node-triton#198 is there for the test.\n\nBased on our discussion, it appears CloudAPI returns a rather unhelpful \u0027StorageError\u0027 which is then passed through (and is it\u0027s own set of issues)."},{"timestamp":1491937605,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Jason King"}],"currentPatchSet":{"number":"3","revision":"17669f35eac0a45bdff365aadbc2cf4c208fe9ba","parents":["33ff58c3d3d5573904c08010a24dc232ba3c346a"],"ref":"refs/changes/69/1769/3","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1491863788,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1491863815,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1491932756,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1491932756,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1491937605,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":4,"deletions":0},{"file":"lib/cloudapi2.js","type":"MODIFIED","insertions":26,"deletions":-1},{"file":"lib/do_image/do_export.js","type":"ADDED","insertions":120,"deletions":0},{"file":"lib/do_image/index.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"lib/tritonapi.js","type":"MODIFIED","insertions":76,"deletions":-2},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":230,"sizeDeletions":-5},"patchSets":[{"number":"1","revision":"1668e295444306683c6c73f011c5e90fcae95765","parents":["33ff58c3d3d5573904c08010a24dc232ba3c346a"],"ref":"refs/changes/69/1769/1","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1491598829,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1491598857,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/do_image/do_export.js","line":59,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"The current code will not call `next` if dry_run is true."},{"file":"lib/do_image/do_export.js","line":60,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Let\u0027s also add a \u0027exportImage\u0027 method to `TritonApi` (in tritonapi.js). That will handle the resolving an image name/shortid/etc. to an image UUID using the `_stepImgId` function in that file.\n\n/me looks\nOh, there isn\u0027t yet a \"_stepImgId\" function in tritonapi.js. Please add one up where the other \"_stepFOOId\" functions are defined.\n\nIt *does* mean though that the \"Exporting ...\" console.log\ncan only use the given image name/id string rather than the resolved \"$name@$version\"."},{"file":"lib/do_image/do_export.js","line":73,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"don\u0027t need this return statement."},{"file":"lib/do_image/do_export.js","line":86,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Ditto. Don\u0027t need this return statement."},{"file":"lib/do_image/do_export.js","line":105,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"\"exporting\""},{"file":"lib/do_image/do_export.js","line":128,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Add a short paragraph saying that only ones *own* images can be exported."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/cloudapi2.js","type":"MODIFIED","insertions":26,"deletions":-1},{"file":"lib/do_image/do_export.js","type":"ADDED","insertions":133,"deletions":0},{"file":"lib/do_image/index.js","type":"MODIFIED","insertions":3,"deletions":-1}],"sizeInsertions":162,"sizeDeletions":-2},{"number":"2","revision":"30885703e7d13f7f8313a69ca37022812c8c652b","parents":["33ff58c3d3d5573904c08010a24dc232ba3c346a"],"ref":"refs/changes/69/1769/2","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1491608999,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1491609026,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"CHANGES.md","line":10,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"It is a new feature. Let\u0027s bump to \"5.2.0\"."},{"file":"lib/cloudapi2.js","line":679,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Let\u0027s call this `exportInfo`."},{"file":"lib/do_image/do_export.js","line":35,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Curious why this spacing. Do you have lint/style rules I don\u0027t?"},{"file":"lib/do_image/do_export.js","line":35,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"No, just habit from other languages, but looking not used much in node.  I\u0027ll remove."},{"file":"lib/do_image/do_export.js","line":44,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Would it be useful to set some dummy return values here for a dry run?  I see at least a few other commands do that."},{"file":"lib/do_image/do_export.js","line":44,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"I\u0027d worry about it getting out a sync a little bit. I\u0027m fine with it if you like. Or could have `outputResults` just print nothing if it was a dry-run."},{"file":"lib/do_image/do_export.js","line":51,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"It would be nice to change this `path` to `exportInfo` to match the name suggested for this in cloudapi2.js et al."},{"file":"lib/do_image/do_export.js","line":54,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"indentation, and need a `return;`"},{"file":"lib/do_image/do_export.js","line":67,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Not sure about that. Either line up all three lines, or left-justify all three lines."},{"file":"lib/do_image/do_export.js","line":70,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Return statement not needed."},{"file":"lib/tritonapi.js","line":221,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Let\u0027s use `arg.imgId` please."},{"file":"lib/tritonapi.js","line":665,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Some docs of the params and the args given to `cb` would be good. The nearby \u0027getPackage\u0027 is a bad example. See for example `updateFirewallRule`."},{"file":"lib/tritonapi.js","line":674,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"```\nvar res \u003d null;\nvar exportInfo \u003d null;\n```"},{"file":"lib/tritonapi.js","line":675,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Call this \u0027arg\u0027 or \u0027context\u0027."},{"file":"lib/tritonapi.js","line":684,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"`imgId`, see above."},{"file":"lib/tritonapi.js","line":685,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"`function (err, exportInfo_, res_) {`"},{"file":"lib/tritonapi.js","line":691,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"```\nexportInfo \u003d exportInfo_;\nres \u003d res_;\n```"},{"file":"lib/tritonapi.js","line":700,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"`cb(err, exportInfo, res);`"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":4,"deletions":0},{"file":"lib/cloudapi2.js","type":"MODIFIED","insertions":26,"deletions":-1},{"file":"lib/do_image/do_export.js","type":"ADDED","insertions":119,"deletions":0},{"file":"lib/do_image/index.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"lib/tritonapi.js","type":"MODIFIED","insertions":60,"deletions":-2},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":213,"sizeDeletions":-5},{"number":"3","revision":"17669f35eac0a45bdff365aadbc2cf4c208fe9ba","parents":["33ff58c3d3d5573904c08010a24dc232ba3c346a"],"ref":"refs/changes/69/1769/3","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1491863788,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1491863815,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1491932756,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1491932756,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1491937605,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":4,"deletions":0},{"file":"lib/cloudapi2.js","type":"MODIFIED","insertions":26,"deletions":-1},{"file":"lib/do_image/do_export.js","type":"ADDED","insertions":120,"deletions":0},{"file":"lib/do_image/index.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"lib/tritonapi.js","type":"MODIFIED","insertions":76,"deletions":-2},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":230,"sizeDeletions":-5}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}]}