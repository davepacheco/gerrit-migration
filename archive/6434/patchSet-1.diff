From 4851d67896c2492cfcf761ae093aba6d49b88f29 Mon Sep 17 00:00:00 2001
From: Kelly McLaughlin <kelly.mclaughlin@joyent.com>
Date: Thu, 13 Jun 2019 06:49:43 -0600
Subject: [PATCH] MANTA-4338 node-boray' s createBucket should unwrap the Fast
 data payload array

---
 lib/buckets.js | 18 +++++++++++++++++-
 1 file changed, 17 insertions(+), 1 deletion(-)

diff --git a/lib/buckets.js b/lib/buckets.js
index 0bc9642..a163143 100644
--- a/lib/buckets.js
+++ b/lib/buckets.js
@@ -55,7 +55,23 @@ function createBucket(rpcctx, owner, bucket, vnode, callback) {
         rpcargs: [arg],
         ignoreNullValues: true,
         log: log
-    }, callback);
+    }, function (err, buckets) {
+        if (err) {
+            callback(err);
+            return;
+        }
+
+        assert.array(buckets, 'buckets');
+
+        if (buckets.length !== 1) {
+            err = new VError('bad server response: expected 1 bucket, found %d',
+                buckets.length);
+            callback(err);
+            return;
+        }
+
+        callback(null, buckets[0]);
+    });
 }
 
 function createBucketNoVnode(rpcctx, owner, bucket, callback) {
-- 
2.21.0

