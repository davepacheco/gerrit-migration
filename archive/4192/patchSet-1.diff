From d860343a9e6bfabc06883451295d1d07d11fb707 Mon Sep 17 00:00:00 2001
From: Jason King <jason.king@joyent.com>
Date: Tue, 12 Jun 2018 17:16:23 -0500
Subject: [PATCH] libvard_inject_varpd needs to know about routers

---
 usr/src/lib/varpd/libvarpd/common/libvarpd_overlay.c | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/usr/src/lib/varpd/libvarpd/common/libvarpd_overlay.c b/usr/src/lib/varpd/libvarpd/common/libvarpd_overlay.c
index 28b4005dbe..bd5ea51763 100644
--- a/usr/src/lib/varpd/libvarpd/common/libvarpd_overlay.c
+++ b/usr/src/lib/varpd/libvarpd/common/libvarpd_overlay.c
@@ -542,6 +542,8 @@ libvarpd_inject_varp(varpd_provider_handle_t *vph, const uint8_t *mac,
 
 	otc.otc_linkid = inst->vri_linkid;
 	otc.otc_entry.otce_flags = 0;
+	if (IN6_IS_ADDR_UNSPECIFIED(&otp->otp_ip) && otp->otp_port == 0)
+		otc.otc_entry.otce_flags |= OVERLAY_TARGET_CACHE_ROUTER;
 	bcopy(mac, otc.otc_entry.otce_mac.otm_mac, ETHERADDRL);
 	bcopy(otp, &otc.otc_entry.otce_dest, sizeof (overlay_target_point_t));
 
-- 
2.21.0

