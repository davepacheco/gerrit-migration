{"project":"joyent/triton-prometheus","branch":"master","id":"I4a1960e6c49b160dc86250a167bc2af406484cb3","number":"6144","subject":"MANTA-3552 create Triton Prometheus image MANTA-4008 add a core Prometheus service to Manta Reviewed by: Kody Kantor \u003ckody.kantor@joyent.com\u003e Reviewed by: Tim Foster \u003ctim.foster@joyent.com\u003e Approved by: Kody Kantor \u003ckody.kantor@joyent.com\u003e","owner":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"url":"https://cr.joyent.us/6144","commitMessage":"MANTA-3552 create Triton Prometheus image\nMANTA-4008 add a core Prometheus service to Manta\nReviewed by: Kody Kantor \u003ckody.kantor@joyent.com\u003e\nReviewed by: Tim Foster \u003ctim.foster@joyent.com\u003e\nApproved by: Kody Kantor \u003ckody.kantor@joyent.com\u003e\n","createdOn":1555979630,"lastUpdated":1558025923,"open":false,"status":"MERGED","comments":[{"timestamp":1555979630,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Uploaded patch set 1."},{"timestamp":1555979913,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Patch Set 1:\n\nSee tickets for testing notes. Note that this image can be deployed using sdcadm or manta-adm -- the Triton ticket has testing notes for the former, and the Manta ticket for the latter."},{"timestamp":1556063905,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Uploaded patch set 2."},{"timestamp":1556139465,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 2:\n\n(46 comments)\n\nNice! Thanks for putting this together. Should MANTA-3552 be a TRITON ticket?"},{"timestamp":1556139526,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 2:\n\nOh, I noticed there\u0027s a setup-grafana-prod.sh file in the repo. Maybe we can remove that too."},{"timestamp":1556668932,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1556810943,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Patch Set 2:\n\n(6 comments)\n\nThese are mostly nits and drive-by comments: I\u0027m not familiar enough with prometheus to help with the details, sorry!"},{"timestamp":1556930389,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Uploaded patch set 3."},{"timestamp":1556930413,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1556930504,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Patch Set 3:\n\n(51 comments)\n\nThanks for taking a look to both of you! I\u0027ve addressed comments individually.\n\nRegarding moving MANTA-3552 to be a TRITON issue: I think I can do this but I have to look into it further -- the ticket has subtasks and Jira doesn\u0027t seem to like that. Regardless, I\u0027ve uploaded the new patchset."},{"timestamp":1557773681,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 3:\n\n(14 comments)\n\nLooking good! Thanks for making all of these changes. I just added a few more comments and questions. Thanks Isaac."},{"timestamp":1557797144,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Patch Set 3:\n\n(9 comments)"},{"timestamp":1557797162,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Uploaded patch set 4."},{"timestamp":1557797182,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1557797434,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Patch Set 4:\n\nFor PS4: Note that in addition to addressing the feedback, I slightly changed the bind configuration to separate forwarding for the binder DNS zone from the rest of the internet -- this is in response to some resolver flakiness I was seeing in deployed images, and seems to have fixed the issue."},{"timestamp":1557846489,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 4: Code-Review+1\n\n(2 comments)\n\nThanks! Looks good to me."},{"timestamp":1557967437,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Uploaded patch set 5."},{"timestamp":1557967459,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1557967918,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Patch Set 5:\n\nPS5:\n\nSee ticket for new testing notes.\n\nChanges in response to Tim\u0027s latest feedback:\n- RFD-compliant copyright headers\n- Removal of root privileges for SMF refresh method\n- Addition of tools/bashstyle script and edits to bash scripts to make them compliant\n- eng.git version bump\n\nOther changes:\n- Saw that setup-prometheus.sh and setup-grafana.sh are still being contributed to in master -- added them back here; filed TRITON-1669 to sort out the mess later."},{"timestamp":1557968197,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Uploaded patch set 6."},{"timestamp":1557968219,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 6: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1557968236,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Patch Set 6:\n\nPS6: actually bumped the eng commit."},{"timestamp":1557969778,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Uploaded patch set 7."},{"timestamp":1557969798,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 7: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1557969803,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Patch Set 7:\n\n(1 comment)"},{"timestamp":1558017615,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 7: Code-Review+1"},{"timestamp":1558025670,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Patch Set 7: Code-Review+1"},{"timestamp":1558025736,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 7: Integration-Approval+1"},{"timestamp":1558025914,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Patch Set 8: Commit message was updated."},{"timestamp":1558025923,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Isaac Davis"}],"currentPatchSet":{"number":"8","revision":"71d819fd9a562e61e6e933ec6c2588c456152edc","parents":["100cc1d828547ec9019214d20e2d72de1ea2f6d1"],"ref":"refs/changes/44/6144/8","uploader":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"createdOn":1558025914,"author":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1557969798,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1558017615,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1558025670,"by":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1558025736,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}},{"type":"SUBM","value":"1","grantedOn":1558025923,"by":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":".eslintrc","type":"ADDED","insertions":25,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":7,"deletions":-4},{"file":".gitmodules","type":"ADDED","insertions":12,"deletions":0},{"file":"Makefile","type":"ADDED","insertions":137,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":196,"deletions":-63},{"file":"bin/certgen","type":"ADDED","insertions":158,"deletions":0},{"file":"bin/prometheus-configure","type":"ADDED","insertions":424,"deletions":0},{"file":"boot/configure.sh","type":"ADDED","insertions":47,"deletions":0},{"file":"boot/setup.sh","type":"ADDED","insertions":214,"deletions":0},{"file":"deps/eng","type":"ADDED","insertions":1,"deletions":0},{"file":"deps/manta-scripts","type":"ADDED","insertions":1,"deletions":0},{"file":"deps/prometheus","type":"ADDED","insertions":1,"deletions":0},{"file":"deps/sdc-scripts","type":"ADDED","insertions":1,"deletions":0},{"file":"etc/named.conf.in","type":"ADDED","insertions":70,"deletions":0},{"file":"etc/prometheus.yml.in","type":"ADDED","insertions":43,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":20,"deletions":-10},{"file":"sapi_manifests/prometheus/manifest.json","type":"ADDED","insertions":5,"deletions":0},{"file":"sapi_manifests/prometheus/template","type":"ADDED","insertions":30,"deletions":0},{"file":"setup-prometheus-lx.sh","fileOld":"setup-prometheus-prod.sh","type":"RENAMED","insertions":1,"deletions":-1},{"file":"smf/manifests/prometheus.xml","type":"ADDED","insertions":104,"deletions":0},{"file":"tools/bashstyle","type":"ADDED","insertions":180,"deletions":0},{"file":"tools/mk/Makefile.defs","type":"DELETED","insertions":0,"deletions":-105},{"file":"tools/mk/Makefile.deps","type":"DELETED","insertions":0,"deletions":-87},{"file":"tools/mk/Makefile.go_prebuilt.defs","type":"DELETED","insertions":0,"deletions":-132},{"file":"tools/mk/Makefile.go_prebuilt.targ","type":"DELETED","insertions":0,"deletions":-55},{"file":"tools/mk/Makefile.manpages.defs","type":"DELETED","insertions":0,"deletions":-128},{"file":"tools/mk/Makefile.manpages.targ","type":"DELETED","insertions":0,"deletions":-28},{"file":"tools/mk/Makefile.node.defs","type":"DELETED","insertions":0,"deletions":-110},{"file":"tools/mk/Makefile.node.targ","type":"DELETED","insertions":0,"deletions":-42},{"file":"tools/mk/Makefile.node_modules.defs","type":"DELETED","insertions":0,"deletions":-68},{"file":"tools/mk/Makefile.node_modules.targ","type":"DELETED","insertions":0,"deletions":-31},{"file":"tools/mk/Makefile.node_prebuilt.defs","type":"DELETED","insertions":0,"deletions":-159},{"file":"tools/mk/Makefile.node_prebuilt.targ","type":"DELETED","insertions":0,"deletions":-42},{"file":"tools/mk/Makefile.smf.defs","type":"DELETED","insertions":0,"deletions":-40},{"file":"tools/mk/Makefile.smf.targ","type":"DELETED","insertions":0,"deletions":-29},{"file":"tools/mk/Makefile.targ","type":"DELETED","insertions":0,"deletions":-345},{"file":"tools/obliterate-prometheus-service.sh","type":"ADDED","insertions":79,"deletions":0},{"file":"tools/service_bundle.dtd.1","type":"ADDED","insertions":1091,"deletions":0}],"sizeInsertions":2847,"sizeDeletions":-1479},"patchSets":[{"number":"1","revision":"3b830bfea25d080d2781a2473ff5d4e8201b32a3","parents":["69c1c7f6fa21b60504fabf28c8ae6345241b5944"],"ref":"refs/changes/44/6144/1","uploader":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"createdOn":1555979630,"author":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":".eslintrc","type":"ADDED","insertions":25,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":7,"deletions":-4},{"file":".gitmodules","type":"ADDED","insertions":12,"deletions":0},{"file":"Makefile","type":"ADDED","insertions":150,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":177,"deletions":-63},{"file":"bin/certgen","type":"ADDED","insertions":158,"deletions":0},{"file":"bin/prometheus-configure","type":"ADDED","insertions":396,"deletions":0},{"file":"boot/configure.sh","type":"ADDED","insertions":18,"deletions":0},{"file":"boot/setup.sh","type":"ADDED","insertions":211,"deletions":0},{"file":"deps/eng","type":"ADDED","insertions":1,"deletions":0},{"file":"deps/manta-scripts","type":"ADDED","insertions":1,"deletions":0},{"file":"deps/prometheus","type":"ADDED","insertions":1,"deletions":0},{"file":"deps/sdc-scripts","type":"ADDED","insertions":1,"deletions":0},{"file":"etc/named.conf.in","type":"ADDED","insertions":63,"deletions":0},{"file":"etc/prometheus.yml.in","type":"ADDED","insertions":32,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":20,"deletions":-10},{"file":"sapi_manifests/prometheus/manifest.json","type":"ADDED","insertions":5,"deletions":0},{"file":"sapi_manifests/prometheus/template","type":"ADDED","insertions":24,"deletions":0},{"file":"setup-grafana.sh","type":"DELETED","insertions":0,"deletions":-207},{"file":"setup-prometheus-lx.sh","fileOld":"setup-prometheus-prod.sh","type":"RENAMED","insertions":0,"deletions":0},{"file":"setup-prometheus.sh","type":"DELETED","insertions":0,"deletions":-233},{"file":"smf/manifests/prometheus.xml","type":"ADDED","insertions":96,"deletions":0},{"file":"tools/download_go","type":"ADDED","insertions":126,"deletions":0},{"file":"tools/mk/Makefile.defs","type":"DELETED","insertions":0,"deletions":-105},{"file":"tools/mk/Makefile.deps","type":"DELETED","insertions":0,"deletions":-87},{"file":"tools/mk/Makefile.go_prebuilt.defs","type":"DELETED","insertions":0,"deletions":-132},{"file":"tools/mk/Makefile.go_prebuilt.targ","type":"DELETED","insertions":0,"deletions":-55},{"file":"tools/mk/Makefile.manpages.defs","type":"DELETED","insertions":0,"deletions":-128},{"file":"tools/mk/Makefile.manpages.targ","type":"DELETED","insertions":0,"deletions":-28},{"file":"tools/mk/Makefile.node.defs","type":"DELETED","insertions":0,"deletions":-110},{"file":"tools/mk/Makefile.node.targ","type":"DELETED","insertions":0,"deletions":-42},{"file":"tools/mk/Makefile.node_modules.defs","type":"DELETED","insertions":0,"deletions":-68},{"file":"tools/mk/Makefile.node_modules.targ","type":"DELETED","insertions":0,"deletions":-31},{"file":"tools/mk/Makefile.node_prebuilt.defs","type":"DELETED","insertions":0,"deletions":-159},{"file":"tools/mk/Makefile.node_prebuilt.targ","type":"DELETED","insertions":0,"deletions":-42},{"file":"tools/mk/Makefile.smf.defs","type":"DELETED","insertions":0,"deletions":-40},{"file":"tools/mk/Makefile.smf.targ","type":"DELETED","insertions":0,"deletions":-29},{"file":"tools/mk/Makefile.targ","type":"DELETED","insertions":0,"deletions":-345},{"file":"tools/obliterate-prometheus-service.sh","type":"ADDED","insertions":68,"deletions":0},{"file":"tools/service_bundle.dtd.1","type":"ADDED","insertions":1091,"deletions":0}],"sizeInsertions":2683,"sizeDeletions":-1918},{"number":"2","revision":"9eeef984ba2adfb4b892aca532a3f5201ee570c4","parents":["69c1c7f6fa21b60504fabf28c8ae6345241b5944"],"ref":"refs/changes/44/6144/2","uploader":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"createdOn":1556063905,"author":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1556668932,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"Makefile","line":125,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"I think we can remove the check for an empty ENGBLD_BITS_DIR macro. Fairly late into the lullaby project, we added:\n\nhttps://github.com/joyent/eng/blob/master/tools/mk/Makefile.defs#L174,L182\n\nso this macro value will always be set."},{"file":"Makefile","line":125,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Done"},{"file":"Makefile","line":126,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"There are a couple lines \u003e80 cols here."},{"file":"Makefile","line":126,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Done"},{"file":"Makefile","line":132,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"We don\u0027t need this now that eng.git provides the global \u0027print-%\u0027 target, eg.\n\n$ make print-PROMETHEUS_IMPORT"},{"file":"Makefile","line":132,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Done"},{"file":"Makefile","line":141,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"This doesn\u0027t seem load bearing."},{"file":"Makefile","line":141,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Done"},{"file":"README.md","line":4,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"I think you could write \u0027Triton and Manta use Prometheus...\u0027"},{"file":"README.md","line":4,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Done"},{"file":"README.md","line":10,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Technically the image is just a filesystem. Maybe we could use the word \u0027instance\u0027 instead."},{"file":"README.md","line":10,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Done"},{"file":"README.md","line":15,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"The \u0027Triton and Manta Prometheus and Grafana\u0027 line is a little bit of a mouthful. I don\u0027t know how we can trim it down though."},{"file":"README.md","line":15,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"I switched the sentence structure - maybe it\u0027s better now"},{"file":"README.md","line":36,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"instances?"},{"file":"README.md","line":36,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Done"},{"file":"README.md","line":44,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"This is the only time the file refers to this service as \u0027we.\u0027 Maybe it could say \u0027the Prometheus time-series database is stored here.\u0027 or something similar."},{"file":"README.md","line":44,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Done"},{"file":"README.md","line":60,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Does it need to run during all of these routines?"},{"file":"README.md","line":60,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"It definitely needs to run in these two places:\n- boot/setup.sh: for initial setup\n- config-agent `post_cmd`: to post-process the sapi config into the Prometheus config when the sapi config changes\n\nRegarding boot/configure.sh: upon further thinking, I\u0027ve updated this to only include the code that actually needs to run upon every boot, and moved that code out of bin/prometheus-configure -- see the updated files for details."},{"file":"README.md","line":64,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Can these only be set when deployed as part of Triton?"},{"file":"README.md","line":64,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Good catch - updated."},{"file":"README.md","line":69,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"I don\u0027t know why this isn\u0027t on the next line too, but both render fine for me in a Markdown viewer."},{"file":"README.md","line":69,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Weird. I escaped the underscores on the next line too, to be safe."},{"file":"README.md","line":74,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"\u0027it\u0027 being the Prometheus instance?"},{"file":"README.md","line":74,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"yes -- clarified."},{"file":"README.md","line":75,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Probably don\u0027t need the word \u0027and\u0027 here."},{"file":"README.md","line":75,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Done"},{"file":"README.md","line":99,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"In other places CNS is abbreviated using all caps"},{"file":"README.md","line":99,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Done"},{"file":"README.md","line":105,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"I think we need to update the Operator\u0027s guide to reflect this too.\n\nThis is how the operator\u0027s guide reads now w.r.t. services with external NICs.\n\n7. If you\u0027ll be deploying a loadbalancer on any compute nodes other than a headnode, then you\u0027ll need to create the \"external\" NIC tag on those CNs."},{"file":"README.md","line":105,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Good thinking -- I filed MANTA-4243 and assigned it to myself."},{"file":"README.md","line":114,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Does the Grafana in a Manta deployment use the admin network too?"},{"file":"README.md","line":114,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"The current plan is to not have a Manta-specific Grafana service -- a Grafana zone deployed under Triton should be able to scrape Manta and Triton zones alike (See RFD 150 for more discussion). I updated the wording here to make this more clear."},{"file":"README.md","line":140,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"typo?"},{"file":"README.md","line":140,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Good catch - fixed."},{"file":"README.md","line":172,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Is this to make development easier? From reading this I\u0027m not sure why I would use the LX zone.\n\nThe Troubleshooting and LX script sections could arguably go in a separate file in docs/. They\u0027re fine here though."},{"file":"README.md","line":172,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Good point. I added some clarification on when you\u0027d want to use it."},{"file":"README.md","line":177,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"ha - I love the change from \u0027prod\u0027 to \u0027adhoc\u0027"},{"file":"bin/certgen","line":1,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Unsure of the convention here, but should we instead hardcode the path to prometheus\u0027s sdcnode runtime rather than use the first node we find on $PATH?"},{"file":"bin/certgen","line":1,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Good point. It looks like there\u0027s a precedent for hardcoding the sdcnode path in imgapi, so I\u0027ve changed it here."},{"file":"bin/certgen","line":17,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"We use \u0027triton\u0027 in most other places. It looks like we could use \u0027triton\u0027 here too to remain consistent."},{"file":"bin/certgen","line":17,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Done"},{"file":"bin/certgen","line":68,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"this threw me when I saw it first, but then realized it\u0027s just the assert error message. Is it a convention that we include code there, or could we just say \"flavor must be either \u0027manta\u0027 or \u0027sdc\u0027\""},{"file":"bin/certgen","line":68,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"From what I\u0027ve seen, our convention is to exactly duplicate the first argument to the assert function as a string, as is done here and in the assertions immediately above.\n\nWith that said, I did some digging and found some precedent for breaking that convention when it\u0027s unwieldy, so I changed it to your suggestion."},{"file":"bin/prometheus-configure","line":11,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"typo"},{"file":"bin/prometheus-configure","line":11,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Done"},{"file":"bin/prometheus-configure","line":95,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"We could use [[ ! $(...) ]] here."},{"file":"bin/prometheus-configure","line":95,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Done"},{"file":"bin/prometheus-configure","line":96,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Should we use the fatal function defined above?"},{"file":"bin/prometheus-configure","line":96,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Done"},{"file":"bin/prometheus-configure","line":113,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"I think you want quotes around this variable."},{"file":"bin/prometheus-configure","line":113,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Done"},{"file":"bin/prometheus-configure","line":154,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Maybe we could add a comment here describing why we don\u0027t need to update the resolv.conf in this case."},{"file":"bin/prometheus-configure","line":154,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Done"},{"file":"bin/prometheus-configure","line":163,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Hm. The only thing about this is that the original (from when the zone started the first time) is overwritten the next time this script is run. Is that a big deal?"},{"file":"bin/prometheus-configure","line":163,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Good question. I think keeping a backup at all is being extra cautious, given that the end goal is always to have 127.0.0.1 be the only entry in resolv.conf. With that in mind, I think having the immediate previous version is sufficient -- it will allow an operator to revert if something goes horribly wrong. What do you think?"},{"file":"bin/prometheus-configure","line":163,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"I agree, this looks good."},{"file":"bin/prometheus-configure","line":172,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Strictly speaking this doesn\u0027t update /etc/resolv.conf, but rather gathers IPs that will later be used to update resolv.conf."},{"file":"bin/prometheus-configure","line":172,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Ah, yes, this is an old comment I forgot to change. Fixed."},{"file":"bin/prometheus-configure","line":197,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Do you think we should sleep for a second or two between loop iterations?"},{"file":"bin/prometheus-configure","line":197,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"That might make sense to do -- to clarify, do you mean the inner loop or the outer loop?"},{"file":"bin/prometheus-configure","line":197,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"The outer loop is probably more important to include a sleep. My thought is that if this is an infinite loop we might hammer the resolvers.\n\nAlso, maybe we should add a condition to the outer loop so that this gives up eventually with an error message. Maybe after 10 iterations where nothing is found? Otherwise it might be hard to figure out wtf is going wrong since the script is silently looping.\n\nOn the other hand, if we added an iteration limit and the limit was hit it would be hard to know what went wrong. I\u0027m guessing an operator would have to somehow pick up on the problem and log in to the zone. I\u0027m not sure if they would know to look wherever this script logs to (config-agent\u0027s log?).\n\nAnyway, I can\u0027t imagine we\u0027d have this failure mode in production (CNS being down at the same time Prometheus is reconfigured?). However since I have uttered that sentence I have doomed us all."},{"file":"bin/prometheus-configure","line":197,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Good points all around. I changed the outer loop to sleep for two seconds on each iteration, and error out after ten iterations.\n\nIf this script fails when running from boot/setup.sh, mdata:execute will enter maintenance, and the output will appear in that service\u0027s logs. On the other hand, if this script fails when running as the config-agent post_cmd, only a warning will appear in the config-agent logs -- I tested this out. This isn\u0027t ideal, but we\u0027d have to make that change in config-agent.\n\nI\u0027ve updated the readme to include a bit about this.\n\nRegardless, as you say, it\u0027s unlikely the script will fail here in production."},{"file":"bin/prometheus-configure","line":229,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"There seems to be inconsistency in this file in the use of \u0027{\u0027."},{"file":"bin/prometheus-configure","line":229,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Good point. I added the brackets for all variable expansions in this file and the other bash files.\n\nI also made sure the use of single/double quotes is consistent -- my policy is to use single quotes by default, and only use double quotes if the string contains a variable expansion."},{"file":"bin/prometheus-configure","line":229,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Good idea, thanks."},{"file":"bin/prometheus-configure","line":233,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"I think this could just be \u0027shift 2\u0027"},{"file":"bin/prometheus-configure","line":233,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Done"},{"file":"bin/prometheus-configure","line":274,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"You\u0027ll want quotes around these too."},{"file":"bin/prometheus-configure","line":274,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Done"},{"file":"bin/prometheus-configure","line":299,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"This line is \u003e 80 columns. It would be nice if it weren\u0027t."},{"file":"bin/prometheus-configure","line":299,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Done"},{"file":"bin/prometheus-configure","line":336,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Does this need to be split across lines like this?"},{"file":"bin/prometheus-configure","line":336,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Nope. Fixed."},{"file":"bin/prometheus-configure","line":365,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Prometheus supports handling SIGHUP to reload its configuration. Using SIGHUP to instruct Prometheus to reload its configuration has been useful for us in prod when a Prometheus instance is _very_ bogged down and needs a configuration change. Without using SIGHUP Prometheus can take a while to start back up because it has to re-read its transaction log-type thing.\n\nWe may have only seen the slow startup behavior on pre-2.0 Prometheus instances. In 2.0 the storage engine was rewritten IIRC, so it\u0027s possible that it\u0027s no longer as disruptive to hard restart Prometheus."},{"file":"bin/prometheus-configure","line":365,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Good idea -- I changed this to \u0027refresh\u0027"},{"file":"bin/prometheus-configure","line":369,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Under what situations will auto-clearing the service be needed - I\u0027d be a bit worried that this may obscure bugs?"},{"file":"bin/prometheus-configure","line":369,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"This is a good question. This script only runs on zone startup and in response to config-agent changes, so if Prometheus enters maintenance, it will just sit there -- it won\u0027t be cleared automatically unless the user makes a sapi config change.\n\nI could see the auto-clearing being useful if Prometheus is in maintenance and the operator knows that a sapi config change will fix the problem -- it removes the step of clearing the service manually.\n\nWith that said, clearing the service manually isn\u0027t much of a burden, so I don\u0027t feel strongly about this -- I defer to your judgment on whether to remove it."},{"file":"bin/prometheus-configure","line":370,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"I think there may be an asterisk appended to the state when a service is transitioning states. Just something to be aware of.\n\nI\u0027m guessing we don\u0027t want to handle other states, like disabled and offline?"},{"file":"bin/prometheus-configure","line":370,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Good point - I added some code to check if the service is in a transition state and wait for it to stabilize if so.\n\nWe do handle disabled in the first case of the if statement. Good point about handling the offline case -- I\u0027ve updated the code and added a comment explaining the logic if the service is offline."},{"file":"bin/prometheus-configure","line":370,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Ah, right. Sorry, I missed the \u0027disabled\u0027 handling."},{"file":"boot/setup.sh","line":11,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Or Manta!"},{"file":"boot/setup.sh","line":11,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Done"},{"file":"boot/setup.sh","line":78,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"It\u0027s probably easier to do:\n\nzfs get -Ho value mountpoint $dataset"},{"file":"boot/setup.sh","line":78,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Done"},{"file":"boot/setup.sh","line":79,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Just to play it safe (in case the \u0027zfs\u0027 command above returns nothing) you may want quotes around this variable."},{"file":"boot/setup.sh","line":79,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Done"},{"file":"boot/setup.sh","line":85,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"You could do the ol\u0027 [[ ! $() ]] thing here too I think."},{"file":"boot/setup.sh","line":85,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Done"},{"file":"deps/eng","line":1,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"It looks like this isn\u0027t the most recent commit."},{"file":"deps/eng","line":1,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Done"},{"file":"deps/prometheus","line":1,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"This looks like it\u0027s in an alternate tree. Should we be using the joyent/2.6 branch instead?"},{"file":"deps/prometheus","line":1,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"So, this is my fault. Turns out the joyent/2.6 branch is broken because I didn\u0027t test in a clean build environment. I will have to update the patches for our fork and cut a new release. It seems like it will be straightforward.\n\nI\u0027m inclined to make this a separate ticket and get Prometheus into master first, running the 2.5 branch. Do you think that\u0027s ok?"},{"file":"deps/prometheus","line":1,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"When you say \u0027get Prometheus into master first,\u0027 are you referring to this repo (triton-prometheus)?\n\nThat plan sounds fine. Thanks."},{"file":"deps/prometheus","line":1,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Correct, this repo."},{"file":"etc/named.conf.in","line":47,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Should this zone be included when we merge this file?"},{"file":"etc/named.conf.in","line":47,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Ah, this is supposed to be parameterized. Fixed."},{"file":"etc/prometheus.yml.in","line":2,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"I wonder how we can make this value configurable. 15 seconds is a pretty liberal value for large deployments."},{"file":"etc/prometheus.yml.in","line":2,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Good idea -- I added sapi variables for this and for evaluation_interval too. We can specify these in sdcadm for the Triton deployment and in the manta0 zone for production, lab, and coal separately -- what do you think the values should be?"},{"file":"etc/prometheus.yml.in","line":2,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"For defaults? This is what we have in one Prometheus instance:\n\nglobal:\n  scrape_interval: 1m\n  scrape_timeout: 10s\n  evaluation_interval: 1m\n\nOne minute as a default across the board seems reasonable to me. I personally set the scrape interval really low when I\u0027m developing things, but I think my use case is that of a minority.\n\nNow that I see it, it\u0027s probably a good idea to have a configurable scrape timeout too. But too many knobs isn\u0027t a good thing either, especially if they\u0027re never used. It\u0027s up to you if we make scrape_timeout configurable."},{"file":"etc/prometheus.yml.in","line":2,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Good idea -- I added a scrape_timeout SAPI variable. I set the defaults to the values you suggested above."},{"file":"smf/manifests/prometheus.xml","line":73,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"It might be nice to support the \u0027refresh\u0027 method to send a SIGHUP to Prometheus, like I mentioned in another comment."},{"file":"smf/manifests/prometheus.xml","line":73,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Done"},{"file":"tools/download_go","line":0,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Did you have to modify this file at all?"},{"file":"tools/download_go","line":0,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"This can be removed now that TOOLS-2251 is in."},{"file":"tools/obliterate-prometheus-service.sh","line":12,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"I have mixed feelings about this file. It seems useful for development. However we could use sdcadm/manta-adm to undeploy the instances and then use sdc-sapi to delete the service metadata.\n\nIt\u0027s a little more difficult to delete the Prometheus service and its instances without this script, but this script has a (low) maintenance burden. Maybe it\u0027s not much more difficult to just use sdcadm/manta-adm since we need to copy this file from a dev zone onto the headnode."},{"file":"tools/obliterate-prometheus-service.sh","line":12,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Trent threw this script together for development purposes months ago -- I\u0027ve been using it regularly but am not super attached to it. It\u0027s your call whether to leave it or not."},{"file":"tools/obliterate-prometheus-service.sh","line":12,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Sure, we can keep this in if it remains useful."},{"file":"tools/obliterate-prometheus-service.sh","line":42,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"May want quotes here."},{"file":"tools/obliterate-prometheus-service.sh","line":42,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Done"},{"file":"tools/obliterate-prometheus-service.sh","line":66,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Should this script remove this file when it has finished executing? Since this is only for development environments, maybe not?"},{"file":"tools/obliterate-prometheus-service.sh","line":66,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"I figure not, if only because the other scripts that require this file tend to leave it in place."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":".eslintrc","type":"ADDED","insertions":25,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":7,"deletions":-4},{"file":".gitmodules","type":"ADDED","insertions":12,"deletions":0},{"file":"Makefile","type":"ADDED","insertions":150,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":177,"deletions":-63},{"file":"bin/certgen","type":"ADDED","insertions":158,"deletions":0},{"file":"bin/prometheus-configure","type":"ADDED","insertions":396,"deletions":0},{"file":"boot/configure.sh","type":"ADDED","insertions":18,"deletions":0},{"file":"boot/setup.sh","type":"ADDED","insertions":211,"deletions":0},{"file":"deps/eng","type":"ADDED","insertions":1,"deletions":0},{"file":"deps/manta-scripts","type":"ADDED","insertions":1,"deletions":0},{"file":"deps/prometheus","type":"ADDED","insertions":1,"deletions":0},{"file":"deps/sdc-scripts","type":"ADDED","insertions":1,"deletions":0},{"file":"etc/named.conf.in","type":"ADDED","insertions":63,"deletions":0},{"file":"etc/prometheus.yml.in","type":"ADDED","insertions":32,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":20,"deletions":-10},{"file":"sapi_manifests/prometheus/manifest.json","type":"ADDED","insertions":5,"deletions":0},{"file":"sapi_manifests/prometheus/template","type":"ADDED","insertions":24,"deletions":0},{"file":"setup-grafana.sh","type":"DELETED","insertions":0,"deletions":-207},{"file":"setup-prometheus-lx.sh","fileOld":"setup-prometheus-prod.sh","type":"RENAMED","insertions":0,"deletions":0},{"file":"setup-prometheus.sh","type":"DELETED","insertions":0,"deletions":-233},{"file":"smf/manifests/prometheus.xml","type":"ADDED","insertions":96,"deletions":0},{"file":"tools/download_go","type":"ADDED","insertions":126,"deletions":0},{"file":"tools/mk/Makefile.defs","type":"DELETED","insertions":0,"deletions":-105},{"file":"tools/mk/Makefile.deps","type":"DELETED","insertions":0,"deletions":-87},{"file":"tools/mk/Makefile.go_prebuilt.defs","type":"DELETED","insertions":0,"deletions":-132},{"file":"tools/mk/Makefile.go_prebuilt.targ","type":"DELETED","insertions":0,"deletions":-55},{"file":"tools/mk/Makefile.manpages.defs","type":"DELETED","insertions":0,"deletions":-128},{"file":"tools/mk/Makefile.manpages.targ","type":"DELETED","insertions":0,"deletions":-28},{"file":"tools/mk/Makefile.node.defs","type":"DELETED","insertions":0,"deletions":-110},{"file":"tools/mk/Makefile.node.targ","type":"DELETED","insertions":0,"deletions":-42},{"file":"tools/mk/Makefile.node_modules.defs","type":"DELETED","insertions":0,"deletions":-68},{"file":"tools/mk/Makefile.node_modules.targ","type":"DELETED","insertions":0,"deletions":-31},{"file":"tools/mk/Makefile.node_prebuilt.defs","type":"DELETED","insertions":0,"deletions":-159},{"file":"tools/mk/Makefile.node_prebuilt.targ","type":"DELETED","insertions":0,"deletions":-42},{"file":"tools/mk/Makefile.smf.defs","type":"DELETED","insertions":0,"deletions":-40},{"file":"tools/mk/Makefile.smf.targ","type":"DELETED","insertions":0,"deletions":-29},{"file":"tools/mk/Makefile.targ","type":"DELETED","insertions":0,"deletions":-345},{"file":"tools/obliterate-prometheus-service.sh","type":"ADDED","insertions":79,"deletions":0},{"file":"tools/service_bundle.dtd.1","type":"ADDED","insertions":1091,"deletions":0}],"sizeInsertions":2694,"sizeDeletions":-1918},{"number":"3","revision":"6a74e19acc4477757567ca2f0de3a924f88197d4","parents":["69c1c7f6fa21b60504fabf28c8ae6345241b5944"],"ref":"refs/changes/44/6144/3","uploader":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"createdOn":1556930389,"author":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1556930413,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"bin/certgen","line":68,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"\u0027triton\u0027 now?"},{"file":"bin/certgen","line":68,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Done"},{"file":"bin/prometheus-configure","line":19,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Does this still happen, or was that refactored out?"},{"file":"bin/prometheus-configure","line":19,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Ah, good catch. Fixed."},{"file":"bin/prometheus-configure","line":156,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Nice! TIL."},{"file":"bin/prometheus-configure","line":324,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Are the default scrape and evaluation intervals documented somewhere?"},{"file":"bin/prometheus-configure","line":324,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Good point. I\u0027ll put them in the README and config template file for now."},{"file":"boot/configure.sh","line":15,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"I\u0027m not opposed to just running prometheus-configure again if it means less duplicate code.\n\nAnother option is to \u0027source\u0027 prometheus-configure and then directly run the function in that file to update DNS. That\u0027s a bit of an abstraction leak though."},{"file":"boot/configure.sh","line":15,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Now that I think about it, I don\u0027t think prometheus-configure needs to handle updating resolv.conf, so I removed that function from promtheus-configure. resolv.conf isn\u0027t affected by config-agent, so it can just be handled here. I guess this code isn\u0027t duplicate anymore!"},{"file":"boot/configure.sh","line":15,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Ah, okay thanks. Sounds good!"},{"file":"etc/named.conf.in","line":50,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Should this be parameterized as well?"},{"file":"etc/named.conf.in","line":50,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Oy, yup. Nice catch."},{"file":"etc/prometheus.yml.in","line":2,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"I think this comment could be confusing. The defaults should be documented elsewhere since there may be many different defaults (default in Manta (which \u0027size\u0027?), default in Triton, and the ultimate fallback in prometheus-configure)."},{"file":"etc/prometheus.yml.in","line":2,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Good point. I replaced these comments with a block comment explaining the situation, and also added clarifying language in the README.\n\nOnce we actually figure out what the different sdc and manta defaults should be, I can add them here and in the README. For now, I just wrote that sdcadm/manta-adm may specify their own default values."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":".eslintrc","type":"ADDED","insertions":25,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":7,"deletions":-4},{"file":".gitmodules","type":"ADDED","insertions":12,"deletions":0},{"file":"Makefile","type":"ADDED","insertions":135,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":182,"deletions":-63},{"file":"bin/certgen","type":"ADDED","insertions":158,"deletions":0},{"file":"bin/prometheus-configure","type":"ADDED","insertions":422,"deletions":0},{"file":"boot/configure.sh","type":"ADDED","insertions":45,"deletions":0},{"file":"boot/setup.sh","type":"ADDED","insertions":211,"deletions":0},{"file":"deps/eng","type":"ADDED","insertions":1,"deletions":0},{"file":"deps/manta-scripts","type":"ADDED","insertions":1,"deletions":0},{"file":"deps/prometheus","type":"ADDED","insertions":1,"deletions":0},{"file":"deps/sdc-scripts","type":"ADDED","insertions":1,"deletions":0},{"file":"etc/named.conf.in","type":"ADDED","insertions":63,"deletions":0},{"file":"etc/prometheus.yml.in","type":"ADDED","insertions":32,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":20,"deletions":-10},{"file":"sapi_manifests/prometheus/manifest.json","type":"ADDED","insertions":5,"deletions":0},{"file":"sapi_manifests/prometheus/template","type":"ADDED","insertions":30,"deletions":0},{"file":"setup-grafana.sh","type":"DELETED","insertions":0,"deletions":-207},{"file":"setup-prometheus-lx.sh","fileOld":"setup-prometheus-prod.sh","type":"RENAMED","insertions":0,"deletions":0},{"file":"setup-prometheus.sh","type":"DELETED","insertions":0,"deletions":-233},{"file":"smf/manifests/prometheus.xml","type":"ADDED","insertions":106,"deletions":0},{"file":"tools/mk/Makefile.defs","type":"DELETED","insertions":0,"deletions":-105},{"file":"tools/mk/Makefile.deps","type":"DELETED","insertions":0,"deletions":-87},{"file":"tools/mk/Makefile.go_prebuilt.defs","type":"DELETED","insertions":0,"deletions":-132},{"file":"tools/mk/Makefile.go_prebuilt.targ","type":"DELETED","insertions":0,"deletions":-55},{"file":"tools/mk/Makefile.manpages.defs","type":"DELETED","insertions":0,"deletions":-128},{"file":"tools/mk/Makefile.manpages.targ","type":"DELETED","insertions":0,"deletions":-28},{"file":"tools/mk/Makefile.node.defs","type":"DELETED","insertions":0,"deletions":-110},{"file":"tools/mk/Makefile.node.targ","type":"DELETED","insertions":0,"deletions":-42},{"file":"tools/mk/Makefile.node_modules.defs","type":"DELETED","insertions":0,"deletions":-68},{"file":"tools/mk/Makefile.node_modules.targ","type":"DELETED","insertions":0,"deletions":-31},{"file":"tools/mk/Makefile.node_prebuilt.defs","type":"DELETED","insertions":0,"deletions":-159},{"file":"tools/mk/Makefile.node_prebuilt.targ","type":"DELETED","insertions":0,"deletions":-42},{"file":"tools/mk/Makefile.smf.defs","type":"DELETED","insertions":0,"deletions":-40},{"file":"tools/mk/Makefile.smf.targ","type":"DELETED","insertions":0,"deletions":-29},{"file":"tools/mk/Makefile.targ","type":"DELETED","insertions":0,"deletions":-345},{"file":"tools/obliterate-prometheus-service.sh","type":"ADDED","insertions":79,"deletions":0},{"file":"tools/service_bundle.dtd.1","type":"ADDED","insertions":1091,"deletions":0}],"sizeInsertions":2627,"sizeDeletions":-1918},{"number":"4","revision":"42dbf8f75a9b6508fcadec9b229406a0eb78f0e1","parents":["69c1c7f6fa21b60504fabf28c8ae6345241b5944"],"ref":"refs/changes/44/6144/4","uploader":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"createdOn":1557797162,"author":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1557797182,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1557846489,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}}],"comments":[{"file":"bin/prometheus-configure","line":307,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Now that I\u0027m taking another look at this I would personally prefer that these are given variables at the beginning of this file, like DEFAULT_SCRAPE_INTERVAL\u003d60. But it\u0027s not a big deal."},{"file":"bin/prometheus-configure","line":307,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":".eslintrc","type":"ADDED","insertions":25,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":7,"deletions":-4},{"file":".gitmodules","type":"ADDED","insertions":12,"deletions":0},{"file":"Makefile","type":"ADDED","insertions":135,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":196,"deletions":-63},{"file":"bin/certgen","type":"ADDED","insertions":158,"deletions":0},{"file":"bin/prometheus-configure","type":"ADDED","insertions":409,"deletions":0},{"file":"boot/configure.sh","type":"ADDED","insertions":45,"deletions":0},{"file":"boot/setup.sh","type":"ADDED","insertions":211,"deletions":0},{"file":"deps/eng","type":"ADDED","insertions":1,"deletions":0},{"file":"deps/manta-scripts","type":"ADDED","insertions":1,"deletions":0},{"file":"deps/prometheus","type":"ADDED","insertions":1,"deletions":0},{"file":"deps/sdc-scripts","type":"ADDED","insertions":1,"deletions":0},{"file":"etc/named.conf.in","type":"ADDED","insertions":70,"deletions":0},{"file":"etc/prometheus.yml.in","type":"ADDED","insertions":43,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":20,"deletions":-10},{"file":"sapi_manifests/prometheus/manifest.json","type":"ADDED","insertions":5,"deletions":0},{"file":"sapi_manifests/prometheus/template","type":"ADDED","insertions":30,"deletions":0},{"file":"setup-grafana.sh","type":"DELETED","insertions":0,"deletions":-207},{"file":"setup-prometheus-lx.sh","fileOld":"setup-prometheus-prod.sh","type":"RENAMED","insertions":0,"deletions":0},{"file":"setup-prometheus.sh","type":"DELETED","insertions":0,"deletions":-233},{"file":"smf/manifests/prometheus.xml","type":"ADDED","insertions":106,"deletions":0},{"file":"tools/mk/Makefile.defs","type":"DELETED","insertions":0,"deletions":-105},{"file":"tools/mk/Makefile.deps","type":"DELETED","insertions":0,"deletions":-87},{"file":"tools/mk/Makefile.go_prebuilt.defs","type":"DELETED","insertions":0,"deletions":-132},{"file":"tools/mk/Makefile.go_prebuilt.targ","type":"DELETED","insertions":0,"deletions":-55},{"file":"tools/mk/Makefile.manpages.defs","type":"DELETED","insertions":0,"deletions":-128},{"file":"tools/mk/Makefile.manpages.targ","type":"DELETED","insertions":0,"deletions":-28},{"file":"tools/mk/Makefile.node.defs","type":"DELETED","insertions":0,"deletions":-110},{"file":"tools/mk/Makefile.node.targ","type":"DELETED","insertions":0,"deletions":-42},{"file":"tools/mk/Makefile.node_modules.defs","type":"DELETED","insertions":0,"deletions":-68},{"file":"tools/mk/Makefile.node_modules.targ","type":"DELETED","insertions":0,"deletions":-31},{"file":"tools/mk/Makefile.node_prebuilt.defs","type":"DELETED","insertions":0,"deletions":-159},{"file":"tools/mk/Makefile.node_prebuilt.targ","type":"DELETED","insertions":0,"deletions":-42},{"file":"tools/mk/Makefile.smf.defs","type":"DELETED","insertions":0,"deletions":-40},{"file":"tools/mk/Makefile.smf.targ","type":"DELETED","insertions":0,"deletions":-29},{"file":"tools/mk/Makefile.targ","type":"DELETED","insertions":0,"deletions":-345},{"file":"tools/obliterate-prometheus-service.sh","type":"ADDED","insertions":79,"deletions":0},{"file":"tools/service_bundle.dtd.1","type":"ADDED","insertions":1091,"deletions":0}],"sizeInsertions":2646,"sizeDeletions":-1918},{"number":"5","revision":"b30082ad048f088438a98a48f7ddcbdc54caa167","parents":["100cc1d828547ec9019214d20e2d72de1ea2f6d1"],"ref":"refs/changes/44/6144/5","uploader":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"createdOn":1557967437,"author":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1557967459,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":".eslintrc","type":"ADDED","insertions":25,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":7,"deletions":-4},{"file":".gitmodules","type":"ADDED","insertions":12,"deletions":0},{"file":"Makefile","type":"ADDED","insertions":137,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":196,"deletions":-63},{"file":"bin/certgen","type":"ADDED","insertions":158,"deletions":0},{"file":"bin/prometheus-configure","type":"ADDED","insertions":417,"deletions":0},{"file":"boot/configure.sh","type":"ADDED","insertions":47,"deletions":0},{"file":"boot/setup.sh","type":"ADDED","insertions":214,"deletions":0},{"file":"deps/eng","type":"ADDED","insertions":1,"deletions":0},{"file":"deps/manta-scripts","type":"ADDED","insertions":1,"deletions":0},{"file":"deps/prometheus","type":"ADDED","insertions":1,"deletions":0},{"file":"deps/sdc-scripts","type":"ADDED","insertions":1,"deletions":0},{"file":"etc/named.conf.in","type":"ADDED","insertions":70,"deletions":0},{"file":"etc/prometheus.yml.in","type":"ADDED","insertions":43,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":20,"deletions":-10},{"file":"sapi_manifests/prometheus/manifest.json","type":"ADDED","insertions":5,"deletions":0},{"file":"sapi_manifests/prometheus/template","type":"ADDED","insertions":30,"deletions":0},{"file":"setup-prometheus-lx.sh","fileOld":"setup-prometheus-prod.sh","type":"RENAMED","insertions":1,"deletions":-1},{"file":"smf/manifests/prometheus.xml","type":"ADDED","insertions":104,"deletions":0},{"file":"tools/bashstyle","type":"ADDED","insertions":180,"deletions":0},{"file":"tools/mk/Makefile.defs","type":"DELETED","insertions":0,"deletions":-105},{"file":"tools/mk/Makefile.deps","type":"DELETED","insertions":0,"deletions":-87},{"file":"tools/mk/Makefile.go_prebuilt.defs","type":"DELETED","insertions":0,"deletions":-132},{"file":"tools/mk/Makefile.go_prebuilt.targ","type":"DELETED","insertions":0,"deletions":-55},{"file":"tools/mk/Makefile.manpages.defs","type":"DELETED","insertions":0,"deletions":-128},{"file":"tools/mk/Makefile.manpages.targ","type":"DELETED","insertions":0,"deletions":-28},{"file":"tools/mk/Makefile.node.defs","type":"DELETED","insertions":0,"deletions":-110},{"file":"tools/mk/Makefile.node.targ","type":"DELETED","insertions":0,"deletions":-42},{"file":"tools/mk/Makefile.node_modules.defs","type":"DELETED","insertions":0,"deletions":-68},{"file":"tools/mk/Makefile.node_modules.targ","type":"DELETED","insertions":0,"deletions":-31},{"file":"tools/mk/Makefile.node_prebuilt.defs","type":"DELETED","insertions":0,"deletions":-159},{"file":"tools/mk/Makefile.node_prebuilt.targ","type":"DELETED","insertions":0,"deletions":-42},{"file":"tools/mk/Makefile.smf.defs","type":"DELETED","insertions":0,"deletions":-40},{"file":"tools/mk/Makefile.smf.targ","type":"DELETED","insertions":0,"deletions":-29},{"file":"tools/mk/Makefile.targ","type":"DELETED","insertions":0,"deletions":-345},{"file":"tools/obliterate-prometheus-service.sh","type":"ADDED","insertions":79,"deletions":0},{"file":"tools/service_bundle.dtd.1","type":"ADDED","insertions":1091,"deletions":0}],"sizeInsertions":2840,"sizeDeletions":-1479},{"number":"6","revision":"9c470deb543abc4e52b9a3b255e3677582a78288","parents":["100cc1d828547ec9019214d20e2d72de1ea2f6d1"],"ref":"refs/changes/44/6144/6","uploader":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"createdOn":1557968197,"author":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1557968219,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":".eslintrc","type":"ADDED","insertions":25,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":7,"deletions":-4},{"file":".gitmodules","type":"ADDED","insertions":12,"deletions":0},{"file":"Makefile","type":"ADDED","insertions":137,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":196,"deletions":-63},{"file":"bin/certgen","type":"ADDED","insertions":158,"deletions":0},{"file":"bin/prometheus-configure","type":"ADDED","insertions":417,"deletions":0},{"file":"boot/configure.sh","type":"ADDED","insertions":47,"deletions":0},{"file":"boot/setup.sh","type":"ADDED","insertions":214,"deletions":0},{"file":"deps/eng","type":"ADDED","insertions":1,"deletions":0},{"file":"deps/manta-scripts","type":"ADDED","insertions":1,"deletions":0},{"file":"deps/prometheus","type":"ADDED","insertions":1,"deletions":0},{"file":"deps/sdc-scripts","type":"ADDED","insertions":1,"deletions":0},{"file":"etc/named.conf.in","type":"ADDED","insertions":70,"deletions":0},{"file":"etc/prometheus.yml.in","type":"ADDED","insertions":43,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":20,"deletions":-10},{"file":"sapi_manifests/prometheus/manifest.json","type":"ADDED","insertions":5,"deletions":0},{"file":"sapi_manifests/prometheus/template","type":"ADDED","insertions":30,"deletions":0},{"file":"setup-prometheus-lx.sh","fileOld":"setup-prometheus-prod.sh","type":"RENAMED","insertions":1,"deletions":-1},{"file":"smf/manifests/prometheus.xml","type":"ADDED","insertions":104,"deletions":0},{"file":"tools/bashstyle","type":"ADDED","insertions":180,"deletions":0},{"file":"tools/mk/Makefile.defs","type":"DELETED","insertions":0,"deletions":-105},{"file":"tools/mk/Makefile.deps","type":"DELETED","insertions":0,"deletions":-87},{"file":"tools/mk/Makefile.go_prebuilt.defs","type":"DELETED","insertions":0,"deletions":-132},{"file":"tools/mk/Makefile.go_prebuilt.targ","type":"DELETED","insertions":0,"deletions":-55},{"file":"tools/mk/Makefile.manpages.defs","type":"DELETED","insertions":0,"deletions":-128},{"file":"tools/mk/Makefile.manpages.targ","type":"DELETED","insertions":0,"deletions":-28},{"file":"tools/mk/Makefile.node.defs","type":"DELETED","insertions":0,"deletions":-110},{"file":"tools/mk/Makefile.node.targ","type":"DELETED","insertions":0,"deletions":-42},{"file":"tools/mk/Makefile.node_modules.defs","type":"DELETED","insertions":0,"deletions":-68},{"file":"tools/mk/Makefile.node_modules.targ","type":"DELETED","insertions":0,"deletions":-31},{"file":"tools/mk/Makefile.node_prebuilt.defs","type":"DELETED","insertions":0,"deletions":-159},{"file":"tools/mk/Makefile.node_prebuilt.targ","type":"DELETED","insertions":0,"deletions":-42},{"file":"tools/mk/Makefile.smf.defs","type":"DELETED","insertions":0,"deletions":-40},{"file":"tools/mk/Makefile.smf.targ","type":"DELETED","insertions":0,"deletions":-29},{"file":"tools/mk/Makefile.targ","type":"DELETED","insertions":0,"deletions":-345},{"file":"tools/obliterate-prometheus-service.sh","type":"ADDED","insertions":79,"deletions":0},{"file":"tools/service_bundle.dtd.1","type":"ADDED","insertions":1091,"deletions":0}],"sizeInsertions":2840,"sizeDeletions":-1479},{"number":"7","revision":"4a1960e6c49b160dc86250a167bc2af406484cb3","parents":["100cc1d828547ec9019214d20e2d72de1ea2f6d1"],"ref":"refs/changes/44/6144/7","uploader":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"createdOn":1557969778,"author":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1557969798,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1558017615,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1558025736,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1558025670,"by":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":".eslintrc","type":"ADDED","insertions":25,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":7,"deletions":-4},{"file":".gitmodules","type":"ADDED","insertions":12,"deletions":0},{"file":"Makefile","type":"ADDED","insertions":137,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":196,"deletions":-63},{"file":"bin/certgen","type":"ADDED","insertions":158,"deletions":0},{"file":"bin/prometheus-configure","type":"ADDED","insertions":424,"deletions":0},{"file":"boot/configure.sh","type":"ADDED","insertions":47,"deletions":0},{"file":"boot/setup.sh","type":"ADDED","insertions":214,"deletions":0},{"file":"deps/eng","type":"ADDED","insertions":1,"deletions":0},{"file":"deps/manta-scripts","type":"ADDED","insertions":1,"deletions":0},{"file":"deps/prometheus","type":"ADDED","insertions":1,"deletions":0},{"file":"deps/sdc-scripts","type":"ADDED","insertions":1,"deletions":0},{"file":"etc/named.conf.in","type":"ADDED","insertions":70,"deletions":0},{"file":"etc/prometheus.yml.in","type":"ADDED","insertions":43,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":20,"deletions":-10},{"file":"sapi_manifests/prometheus/manifest.json","type":"ADDED","insertions":5,"deletions":0},{"file":"sapi_manifests/prometheus/template","type":"ADDED","insertions":30,"deletions":0},{"file":"setup-prometheus-lx.sh","fileOld":"setup-prometheus-prod.sh","type":"RENAMED","insertions":1,"deletions":-1},{"file":"smf/manifests/prometheus.xml","type":"ADDED","insertions":104,"deletions":0},{"file":"tools/bashstyle","type":"ADDED","insertions":180,"deletions":0},{"file":"tools/mk/Makefile.defs","type":"DELETED","insertions":0,"deletions":-105},{"file":"tools/mk/Makefile.deps","type":"DELETED","insertions":0,"deletions":-87},{"file":"tools/mk/Makefile.go_prebuilt.defs","type":"DELETED","insertions":0,"deletions":-132},{"file":"tools/mk/Makefile.go_prebuilt.targ","type":"DELETED","insertions":0,"deletions":-55},{"file":"tools/mk/Makefile.manpages.defs","type":"DELETED","insertions":0,"deletions":-128},{"file":"tools/mk/Makefile.manpages.targ","type":"DELETED","insertions":0,"deletions":-28},{"file":"tools/mk/Makefile.node.defs","type":"DELETED","insertions":0,"deletions":-110},{"file":"tools/mk/Makefile.node.targ","type":"DELETED","insertions":0,"deletions":-42},{"file":"tools/mk/Makefile.node_modules.defs","type":"DELETED","insertions":0,"deletions":-68},{"file":"tools/mk/Makefile.node_modules.targ","type":"DELETED","insertions":0,"deletions":-31},{"file":"tools/mk/Makefile.node_prebuilt.defs","type":"DELETED","insertions":0,"deletions":-159},{"file":"tools/mk/Makefile.node_prebuilt.targ","type":"DELETED","insertions":0,"deletions":-42},{"file":"tools/mk/Makefile.smf.defs","type":"DELETED","insertions":0,"deletions":-40},{"file":"tools/mk/Makefile.smf.targ","type":"DELETED","insertions":0,"deletions":-29},{"file":"tools/mk/Makefile.targ","type":"DELETED","insertions":0,"deletions":-345},{"file":"tools/obliterate-prometheus-service.sh","type":"ADDED","insertions":79,"deletions":0},{"file":"tools/service_bundle.dtd.1","type":"ADDED","insertions":1091,"deletions":0}],"sizeInsertions":2847,"sizeDeletions":-1479},{"number":"8","revision":"71d819fd9a562e61e6e933ec6c2588c456152edc","parents":["100cc1d828547ec9019214d20e2d72de1ea2f6d1"],"ref":"refs/changes/44/6144/8","uploader":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"createdOn":1558025914,"author":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1557969798,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1558017615,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1558025736,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}},{"type":"SUBM","value":"1","grantedOn":1558025923,"by":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1558025670,"by":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":".eslintrc","type":"ADDED","insertions":25,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":7,"deletions":-4},{"file":".gitmodules","type":"ADDED","insertions":12,"deletions":0},{"file":"Makefile","type":"ADDED","insertions":137,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":196,"deletions":-63},{"file":"bin/certgen","type":"ADDED","insertions":158,"deletions":0},{"file":"bin/prometheus-configure","type":"ADDED","insertions":424,"deletions":0},{"file":"boot/configure.sh","type":"ADDED","insertions":47,"deletions":0},{"file":"boot/setup.sh","type":"ADDED","insertions":214,"deletions":0},{"file":"deps/eng","type":"ADDED","insertions":1,"deletions":0},{"file":"deps/manta-scripts","type":"ADDED","insertions":1,"deletions":0},{"file":"deps/prometheus","type":"ADDED","insertions":1,"deletions":0},{"file":"deps/sdc-scripts","type":"ADDED","insertions":1,"deletions":0},{"file":"etc/named.conf.in","type":"ADDED","insertions":70,"deletions":0},{"file":"etc/prometheus.yml.in","type":"ADDED","insertions":43,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":20,"deletions":-10},{"file":"sapi_manifests/prometheus/manifest.json","type":"ADDED","insertions":5,"deletions":0},{"file":"sapi_manifests/prometheus/template","type":"ADDED","insertions":30,"deletions":0},{"file":"setup-prometheus-lx.sh","fileOld":"setup-prometheus-prod.sh","type":"RENAMED","insertions":1,"deletions":-1},{"file":"smf/manifests/prometheus.xml","type":"ADDED","insertions":104,"deletions":0},{"file":"tools/bashstyle","type":"ADDED","insertions":180,"deletions":0},{"file":"tools/mk/Makefile.defs","type":"DELETED","insertions":0,"deletions":-105},{"file":"tools/mk/Makefile.deps","type":"DELETED","insertions":0,"deletions":-87},{"file":"tools/mk/Makefile.go_prebuilt.defs","type":"DELETED","insertions":0,"deletions":-132},{"file":"tools/mk/Makefile.go_prebuilt.targ","type":"DELETED","insertions":0,"deletions":-55},{"file":"tools/mk/Makefile.manpages.defs","type":"DELETED","insertions":0,"deletions":-128},{"file":"tools/mk/Makefile.manpages.targ","type":"DELETED","insertions":0,"deletions":-28},{"file":"tools/mk/Makefile.node.defs","type":"DELETED","insertions":0,"deletions":-110},{"file":"tools/mk/Makefile.node.targ","type":"DELETED","insertions":0,"deletions":-42},{"file":"tools/mk/Makefile.node_modules.defs","type":"DELETED","insertions":0,"deletions":-68},{"file":"tools/mk/Makefile.node_modules.targ","type":"DELETED","insertions":0,"deletions":-31},{"file":"tools/mk/Makefile.node_prebuilt.defs","type":"DELETED","insertions":0,"deletions":-159},{"file":"tools/mk/Makefile.node_prebuilt.targ","type":"DELETED","insertions":0,"deletions":-42},{"file":"tools/mk/Makefile.smf.defs","type":"DELETED","insertions":0,"deletions":-40},{"file":"tools/mk/Makefile.smf.targ","type":"DELETED","insertions":0,"deletions":-29},{"file":"tools/mk/Makefile.targ","type":"DELETED","insertions":0,"deletions":-345},{"file":"tools/obliterate-prometheus-service.sh","type":"ADDED","insertions":79,"deletions":0},{"file":"tools/service_bundle.dtd.1","type":"ADDED","insertions":1091,"deletions":0}],"sizeInsertions":2847,"sizeDeletions":-1479}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"}]}