{"project":"joyent/illumos-joyent","branch":"master","id":"I2a62096fbdbe65bc486f0bb4d2a0b0c5dc85b423","number":"4713","subject":"OS-7136 nvme driver shouldn\u0027t panic from userland commands Reviewed by: Mike Gerdts \u003cmike.gerdts@joyent.com\u003e Reviewed by: Dan McDonald \u003cdanmcd@joyent.com\u003e Approved by: Jason King \u003cjbk@joyent.com\u003e","owner":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"url":"https://cr.joyent.us/4713","commitMessage":"OS-7136 nvme driver shouldn\u0027t panic from userland commands\nReviewed by: Mike Gerdts \u003cmike.gerdts@joyent.com\u003e\nReviewed by: Dan McDonald \u003cdanmcd@joyent.com\u003e\nApproved by: Jason King \u003cjbk@joyent.com\u003e\n","createdOn":1534525025,"lastUpdated":1534806546,"open":false,"status":"MERGED","comments":[{"timestamp":1534525025,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Uploaded patch set 1."},{"timestamp":1534527045,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 1: Code-Review+1\n\nThanks for the testing notes, and for preventing a \"Dude, I can HAX0R-CR4SH your machine with nvme.\""},{"timestamp":1534529707,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 1:\n\n(1 comment)\n\nAs a nit, I\u0027d probably use.\n\n    cmd-\u003enc_dontpanic \u003d user\n\nIf you think the if statement adds clarity, I\u0027m fine with it."},{"timestamp":1534530075,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 1:\n\n\u003e (1 comment)\n \u003e \n \u003e As a nit, I\u0027d probably use.\n \u003e \n \u003e cmd-\u003enc_dontpanic \u003d user\n \u003e \n \u003e If you think the if statement adds clarity, I\u0027m fine with it.\n\nThere are various places where we\u0027re setting nc_dontpanic independent of whether or not it\u0027s a user command. I guess put differently, if it\u0027s a user command, we definitely shouldn\u0027t panic. However, if it\u0027s not, other policy might exist."},{"timestamp":1534530232,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1534531568,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 1: Code-Review+1\n\n(1 comment)"},{"timestamp":1534545848,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 1: Integration-Approval+1"},{"timestamp":1534796603,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Uploaded patch set 2: Patch Set 1 was rebased."},{"timestamp":1534796659,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Uploaded patch set 3: Commit message was updated."},{"timestamp":1534806011,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Uploaded patch set 4: Patch Set 3 was rebased."},{"timestamp":1534806546,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Robert Mustacchi"}],"currentPatchSet":{"number":"4","revision":"2a62096fbdbe65bc486f0bb4d2a0b0c5dc85b423","parents":["5b2cab42ece4dc10d526d7c535811f1dcaaf6401"],"ref":"refs/changes/13/4713/4","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1534806011,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1534527045,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1534531568,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1534545848,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"SUBM","value":"1","grantedOn":1534806545,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/uts/common/io/nvme/nvme.c","type":"MODIFIED","insertions":51,"deletions":-29}],"sizeInsertions":51,"sizeDeletions":-29},"patchSets":[{"number":"1","revision":"4eb576aba3e1987992285775e56ee202a71ddc34","parents":["757454db6669c1186f60bc625510c1b67217aae6"],"ref":"refs/changes/13/4713/1","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1534525025,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1534545848,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1534527045,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1534531568,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}}],"comments":[{"file":"usr/src/uts/common/io/nvme/nvme.c","line":2191,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"We can get here via nvme_ioctl_attach()."},{"file":"usr/src/uts/common/io/nvme/nvme.c","line":2191,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Yes, I had seen that path and ultimately wasn\u0027t 100% sure what was the right decision on this. In particular, because we had already gone through and done this for each name space for the kernel successfully, it seemed like by the time we were getting here, if it then failed again, something very odd is going on. But perhaps it\u0027s better to split it up anyways?\n\nThoughts?"},{"file":"usr/src/uts/common/io/nvme/nvme.c","line":2191,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"I don\u0027t have a strong opinion on this.  If you were aware of this and felt that any errors that we hit here are indications of kernel bugs or serious hardware issues, it\u0027s fine as is."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/io/nvme/nvme.c","type":"MODIFIED","insertions":51,"deletions":-29}],"sizeInsertions":51,"sizeDeletions":-29},{"number":"2","revision":"aac17e5e73cc1fafdda82426923b928fe0a4a5b1","parents":["1eb19b4a7770efe8736592808ccffef5e3c16bb8"],"ref":"refs/changes/13/4713/2","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1534796603,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1534545848,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1534527045,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1534531568,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/io/nvme/nvme.c","type":"MODIFIED","insertions":51,"deletions":-29}],"sizeInsertions":51,"sizeDeletions":-29},{"number":"3","revision":"881cd965c725d2f1d296e05f587144591223531d","parents":["1eb19b4a7770efe8736592808ccffef5e3c16bb8"],"ref":"refs/changes/13/4713/3","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1534796659,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1534545848,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1534527045,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1534531568,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/uts/common/io/nvme/nvme.c","type":"MODIFIED","insertions":51,"deletions":-29}],"sizeInsertions":51,"sizeDeletions":-29},{"number":"4","revision":"2a62096fbdbe65bc486f0bb4d2a0b0c5dc85b423","parents":["5b2cab42ece4dc10d526d7c535811f1dcaaf6401"],"ref":"refs/changes/13/4713/4","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1534806011,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"SUBM","value":"1","grantedOn":1534806545,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1534545848,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1534527045,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1534531568,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/uts/common/io/nvme/nvme.c","type":"MODIFIED","insertions":51,"deletions":-29}],"sizeInsertions":51,"sizeDeletions":-29}],"allReviewers":[{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}]}