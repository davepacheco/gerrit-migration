{"project":"joyent/node-docker-registry-client","branch":"master","id":"I56307dbe46273d7b3fe5294cecca136dc6b4914b","number":"609","subject":"DOCKER-663 Support Amazon ECR Registry Reviewed by: Trent Mick \u003ctrentm@gmail.com\u003e","owner":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"url":"https://cr.joyent.us/609","commitMessage":"DOCKER-663 Support Amazon ECR Registry\nReviewed by: Trent Mick \u003ctrentm@gmail.com\u003e\n","createdOn":1475780317,"lastUpdated":1475868391,"open":false,"status":"MERGED","comments":[{"timestamp":1475780317,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Uploaded patch set 1."},{"timestamp":1475780368,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1475780467,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Patch Set 1:\n\nNote that I\u0027ve added a generate digest helper function (so IMGAPI can make use of this) when the Docker-Content-Digest header is not provided."},{"timestamp":1475780550,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Uploaded patch set 2: Commit message was updated."},{"timestamp":1475782362,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 2:\n\n(4 comments)"},{"timestamp":1475783999,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Patch Set 2:\n\n(4 comments)"},{"timestamp":1475785015,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Uploaded patch set 3: Patch Set 2 was rebased."},{"timestamp":1475785062,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3:\n\n\"make check\" passed ok"},{"timestamp":1475797504,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Uploaded patch set 4."},{"timestamp":1475797574,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1475867287,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 4: Code-Review+1 Integration-Approval+1"},{"timestamp":1475868391,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Todd Whiteman"}],"currentPatchSet":{"number":"4","revision":"56307dbe46273d7b3fe5294cecca136dc6b4914b","parents":["cf0abedca97a039b265c11101bcb6b31aacfbb10"],"ref":"refs/changes/09/609/4","uploader":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"createdOn":1475797504,"author":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1475797574,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1475867287,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1475867287,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1475868391,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"lib/index.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"lib/registry-client-v2.js","type":"MODIFIED","insertions":57,"deletions":-5},{"file":"test/v2.amazonecr.test.js","type":"ADDED","insertions":307,"deletions":0},{"file":"test/v2.other.test.js","type":"ADDED","insertions":110,"deletions":0}],"sizeInsertions":475,"sizeDeletions":-5},"patchSets":[{"number":"1","revision":"2741a8ccecfbfcdcc9055352e5ff0c8d67a4cfe6","parents":["9a8619965c08137b8f3979e6e09c7b372b817ca4"],"ref":"refs/changes/09/609/1","uploader":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"createdOn":1475780317,"author":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1475780368,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/registry-client-v2.js","type":"MODIFIED","insertions":55,"deletions":-4},{"file":"test/v2.amazonecr.test.js","type":"ADDED","insertions":308,"deletions":0},{"file":"test/v2.other.test.js","type":"ADDED","insertions":120,"deletions":0}],"sizeInsertions":483,"sizeDeletions":-4},{"number":"2","revision":"bf139aa88f4d0aa217be039fc990bc1bf4d9e5f4","parents":["9a8619965c08137b8f3979e6e09c7b372b817ca4"],"ref":"refs/changes/09/609/2","uploader":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"createdOn":1475780550,"author":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1475780368,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/registry-client-v2.js","line":1287,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"My pref name would be \"digestFromManifestStr\" but I won\u0027t fight on it. :)  E.g.:\n\n    common.js:313:function urlFromIndex(index) {\n    registry-client-v2.js:76:function _authHeaderFromAuthInfo(authInfo) {\n    registry-client-v2.js:369:function _jwsFromManifest(manifest, body) {\n\n\nUnrelated: what about making this a top-level function. I.e. not on the client instance. Then export it with the same name from index.js (i.e. don\u0027t bother with the \"V2\" suffix that some of the others have)."},{"file":"lib/registry-client-v2.js","line":1287,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Sure on the name change.\n\nIt\u0027s funny, I originally had it that way - as a top-level function (exported in index.js and reg-client-v2), but it didn\u0027t feel right (as it\u0027s explicitly tied to a v2 schema format and not covered in the client-v1) so then I moved it to be a function of the v2 client. I guess I can change it back."},{"file":"lib/registry-client-v2.js","line":1288,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"assert.string(manifestStr, ...)"},{"file":"lib/registry-client-v2.js","line":1288,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Sure."},{"file":"test/v2.amazonecr.test.js","line":256,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"comment says ECR does not return this header, yet we are still testing it here?"},{"file":"test/v2.amazonecr.test.js","line":256,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Old comment (I copied from quay I think), will drop the comment."},{"file":"test/v2.other.test.js","line":21,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"cheater! :)"},{"file":"test/v2.other.test.js","line":21,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Hah, it was 6-8 jsstyle comments the other way, and then jsstyle was only covering 10 lines of the remaining code - worth it!"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"lib/registry-client-v2.js","type":"MODIFIED","insertions":55,"deletions":-4},{"file":"test/v2.amazonecr.test.js","type":"ADDED","insertions":308,"deletions":0},{"file":"test/v2.other.test.js","type":"ADDED","insertions":120,"deletions":0}],"sizeInsertions":483,"sizeDeletions":-4},{"number":"3","revision":"763190a974f4bef7846e864ea27ae933a863d232","parents":["cf0abedca97a039b265c11101bcb6b31aacfbb10"],"ref":"refs/changes/09/609/3","uploader":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"createdOn":1475785015,"author":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1475780368,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"lib/registry-client-v2.js","type":"MODIFIED","insertions":55,"deletions":-4},{"file":"test/v2.amazonecr.test.js","type":"ADDED","insertions":308,"deletions":0},{"file":"test/v2.other.test.js","type":"ADDED","insertions":120,"deletions":0}],"sizeInsertions":483,"sizeDeletions":-4},{"number":"4","revision":"56307dbe46273d7b3fe5294cecca136dc6b4914b","parents":["cf0abedca97a039b265c11101bcb6b31aacfbb10"],"ref":"refs/changes/09/609/4","uploader":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"createdOn":1475797504,"author":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1475797574,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1475867287,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1475867287,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1475868391,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"lib/index.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"lib/registry-client-v2.js","type":"MODIFIED","insertions":57,"deletions":-5},{"file":"test/v2.amazonecr.test.js","type":"ADDED","insertions":307,"deletions":0},{"file":"test/v2.other.test.js","type":"ADDED","insertions":110,"deletions":0}],"sizeInsertions":475,"sizeDeletions":-5}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}]}