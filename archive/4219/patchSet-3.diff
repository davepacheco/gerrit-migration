From ae84eaf1f5412c14c1d62eaa7e1313cce07d04cc Mon Sep 17 00:00:00 2001
From: dyep49 <dyep49@gmail.com>
Date: Fri, 15 Jun 2018 12:59:32 -0700
Subject: [PATCH] TRITON-490 Add metricPorts metadata to SAPI for cmon-agent
 Reviewed by: Trent Mick <trentm@gmail.com> Approved by: Trent Mick
 <trentm@gmail.com>

---
 boot/setup.sh | 3 +++
 package.json  | 2 +-
 2 files changed, 4 insertions(+), 1 deletion(-)

diff --git a/boot/setup.sh b/boot/setup.sh
index 6969b9e..63a0965 100755
--- a/boot/setup.sh
+++ b/boot/setup.sh
@@ -124,6 +124,9 @@ sdc_log_rotation_add registrar /var/svc/log/*registrar*.log 1g
 sdc_log_rotation_add $role /var/svc/log/*$role*.log 1g
 sdc_log_rotation_setup_end
 
+# Add metadata for cmon-agent discovery
+mdata-put metricPorts 8881
+
 # All done, run boilerplate end-of-setup
 sdc_setup_complete
 
diff --git a/package.json b/package.json
index 7c5974a..ecfea9c 100644
--- a/package.json
+++ b/package.json
@@ -22,7 +22,7 @@
     "sdc-clients": "10.5.0",
     "semver": "5.4.1",
     "sprintf-js": "0.0.7",
-    "triton-metrics": "0.1.0",
+    "triton-metrics": "0.1.1",
     "vasync": "2.2.0",
     "verror": "1.10.0"
   },
-- 
2.21.0

