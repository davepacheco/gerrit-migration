{"project":"joyent/sdc-cloudapi","branch":"master","id":"Ib96bc67cfc80e70a25e28052330d799d3ce582c9","number":"6534","subject":"TRITON-1785 Instance creation should not permit first disk assignment to be lesser than image size Reviewed by: Mike Gerdts \u003cmike.gerdts@joyent.com\u003e Approved by: Mike Gerdts \u003cmike.gerdts@joyent.com\u003e","owner":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"url":"https://cr.joyent.us/6534","commitMessage":"TRITON-1785 Instance creation should not permit first disk assignment to be lesser than image size\nReviewed by: Mike Gerdts \u003cmike.gerdts@joyent.com\u003e\nApproved by: Mike Gerdts \u003cmike.gerdts@joyent.com\u003e\n","createdOn":1562009536,"lastUpdated":1562079138,"open":false,"status":"MERGED","comments":[{"timestamp":1562009536,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 1."},{"timestamp":1562009541,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit 7f628755899de7671254d105059a09228df2dcb3\n    \n    TRITON-1785 Instance creation should not permit first disk assignment to be lesser than image size"},{"timestamp":1562009586,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1562013560,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1562077725,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 1:\n\n(1 comment)\n\nI respectfully disagree :-)"},{"timestamp":1562077975,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 1: Code-Review+1 Integration-Approval+1"},{"timestamp":1562079123,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 2: Commit message was updated."},{"timestamp":1562079138,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Pedro Palazón Candel"}],"currentPatchSet":{"number":"2","revision":"b96bc67cfc80e70a25e28052330d799d3ce582c9","parents":["54b24441903a73a75ca938d7e3f0f03b47c3d3f0"],"ref":"refs/changes/34/6534/2","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1562079123,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1562009586,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1562077975,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1562077975,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}},{"type":"SUBM","value":"1","grantedOn":1562079138,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/machines.js","type":"MODIFIED","insertions":6,"deletions":0},{"file":"test/machines.94.test.js","type":"MODIFIED","insertions":28,"deletions":0}],"sizeInsertions":34,"sizeDeletions":0},"patchSets":[{"number":"1","revision":"6890b90f8349a4a7657ed7231d474eb96023c082","parents":["54b24441903a73a75ca938d7e3f0f03b47c3d3f0"],"ref":"refs/changes/34/6534/1","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1562009536,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1562009586,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1562077975,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1562077975,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}}],"comments":[{"file":"lib/machines.js","line":547,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"At line 520 - 528 we handle disk.image_uuid for all disks.  It would probably be better to move this check near that."},{"file":"lib/machines.js","line":547,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Not really. That conditional is reached only if \"diskSize\" is undefined and in our case, where we\u0027re specifying a wrong size (user is, that is) we would happily skip that branch, since disk size is defined.\n\nNote that I also tried to do that right after that branch (line 529) and it was failing too, b/c on that case, an image_disk with a value of \"remaining\" would have a size of zero assigned at that point."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/machines.js","type":"MODIFIED","insertions":6,"deletions":0},{"file":"test/machines.94.test.js","type":"MODIFIED","insertions":28,"deletions":0}],"sizeInsertions":34,"sizeDeletions":0},{"number":"2","revision":"b96bc67cfc80e70a25e28052330d799d3ce582c9","parents":["54b24441903a73a75ca938d7e3f0f03b47c3d3f0"],"ref":"refs/changes/34/6534/2","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1562079123,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1562009586,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"SUBM","value":"1","grantedOn":1562079138,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1562077975,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1562077975,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/machines.js","type":"MODIFIED","insertions":6,"deletions":0},{"file":"test/machines.94.test.js","type":"MODIFIED","insertions":28,"deletions":0}],"sizeInsertions":34,"sizeDeletions":0}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}]}