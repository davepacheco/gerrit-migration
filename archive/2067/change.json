{"project":"joyent/node-libmanta","branch":"master","id":"If9d436c6978c30d48372784f2fe973cc565df24d","number":"2067","subject":"MANTA-2900 mlocate should not need to setupMantaBuckets Reviewed by: David Pacheco \u003cdap@joyent.com\u003e Approved by: David Pacheco \u003cdap@joyent.com\u003e","owner":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"url":"https://cr.joyent.us/2067","commitMessage":"MANTA-2900 mlocate should not need to setupMantaBuckets\nReviewed by: David Pacheco \u003cdap@joyent.com\u003e\nApproved by: David Pacheco \u003cdap@joyent.com\u003e\n","createdOn":1497019639,"lastUpdated":1500681260,"open":false,"status":"MERGED","comments":[{"timestamp":1497019639,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"Uploaded patch set 1."},{"timestamp":1497019640,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit d42a8757b70b7ac9a425f30b203c6e4fc30a07b5\n    \n    MANTA-2900 mlocate should not need to setupMantaBuckets"},{"timestamp":1497019664,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1498757655,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Patch Set 1:\n\n(10 comments)\n\nThanks for taking this on! MANTA-2900 is a frequent annoyance of mine, so I\u0027ll be happy to see it go :)\n\nLet me know if you have any questions."},{"timestamp":1498758834,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"Patch Set 1:\n\n(10 comments)"},{"timestamp":1498849984,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 1:\n\n(4 comments)\n\nThanks!  This looks great overall."},{"timestamp":1498850904,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"Patch Set 1:\n\n(2 comments)"},{"timestamp":1498854774,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 1:\n\n(2 comments)"},{"timestamp":1498855140,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"Patch Set 1:\n\n(2 comments)"},{"timestamp":1498858991,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1498864061,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"Uploaded patch set 2."},{"timestamp":1498864062,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit 6403ffcbd73c9b68347be944e9fe444e4b36819a\n    \n    Cleanup make check errors\n    \n    commit 2b20d9253ab4ab1565f94bcf7030edc12fa6ca64\n    \n    Address CR review comments"},{"timestamp":1498864090,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1498864528,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"Uploaded patch set 3."},{"timestamp":1498864529,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"Patch Set 3:\n\nNew commits:\n    \n    commit 3c2dd9c21dde757d888c937a0543d12a36a8044f\n    \n    MANTA-2900 mlocate should not need to setupMantaBuckets"},{"timestamp":1498864552,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1500498854,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 1:\n\n(5 comments)\n\nSorry for the delay -- and I assume this was ready for another round?"},{"timestamp":1500500592,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"Patch Set 1:\n\n(3 comments)\n\nYes it was ready for another round of review."},{"timestamp":1500501316,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 1:\n\n(2 comments)"},{"timestamp":1500503102,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1500564728,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"Uploaded patch set 4."},{"timestamp":1500564730,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"Patch Set 4:\n\nNew commits:\n    \n    commit 7a9f14c52d5c754bd1cc81bedf38c409a48d2292\n    \n    MANTA-2900 mlocate should not need to setupMantaBuckets"},{"timestamp":1500564759,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1500565023,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"Uploaded patch set 5."},{"timestamp":1500565024,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"Patch Set 5:\n\nNew commits:\n    \n    commit d6c7ecb9fc544efce5acb42d0093f994949baa5a\n    \n    MANTA-2900 mlocate should not need to setupMantaBuckets"},{"timestamp":1500565046,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1500565146,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"Patch Set 5:\n\n(4 comments)\n\nOkay dap, all comments should be addressed."},{"timestamp":1500594550,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 5: Code-Review+1\n\nThanks!  Thanks for the general cleanup, too.\n\nIn terms of IA: what\u0027s the test plan?"},{"timestamp":1500648647,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"Patch Set 5:\n\nI added test notes to the Jira ticket https://devhub.joyent.com/jira/browse/MANTA-2900?focusedCommentId\u003d155586\u0026page\u003dcom.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-155586\n\nAlso https://cr.joyent.us/#/c/2068/1 should now be ready."},{"timestamp":1500648723,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"Patch Set 5:\n\nWell that link didn\u0027t work out well.  It is in a comment on MANTA-2900"},{"timestamp":1500679073,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 5: Integration-Approval+1\n\nNice!"},{"timestamp":1500681203,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"Uploaded patch set 6: Commit message was updated."},{"timestamp":1500681260,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Jared Morrow"}],"currentPatchSet":{"number":"6","revision":"f9d436c6978c30d48372784f2fe973cc565df24d","parents":["4c001a1f66ee7f93f65319018cd13aa8240415a2"],"ref":"refs/changes/67/2067/6","uploader":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"createdOn":1500681203,"author":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1500565046,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1500594550,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1500679073,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"SUBM","value":"1","grantedOn":1500681260,"by":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/moray.js","type":"MODIFIED","insertions":62,"deletions":-26},{"file":"test/helper.js","type":"MODIFIED","insertions":45,"deletions":-1},{"file":"test/moray-ro.test.js","type":"ADDED","insertions":149,"deletions":0},{"file":"test/moray.test.js","type":"MODIFIED","insertions":22,"deletions":-97}],"sizeInsertions":278,"sizeDeletions":-124},"patchSets":[{"number":"1","revision":"8aeef8e1115bfec39d03898c25e7eedfc99401db","parents":["4c001a1f66ee7f93f65319018cd13aa8240415a2"],"ref":"refs/changes/67/2067/1","uploader":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"createdOn":1497019639,"author":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1497019664,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/moray.js","line":205,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Was this intentionally removed? Same with the other spacing changes toward the end of the file."},{"file":"lib/moray.js","line":205,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"Any spacing changes should be considered unintentional or one of our tools complaining about being over 80-char limit.  I\u0027ll go back through the diff and add newlines where emacs removed them."},{"file":"lib/moray.js","line":463,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"I was going to write that we should add a comment explaining this option to give some context about what a \"read-only\" client looks like. I still think we should still do that, but it would also be good to add a top-level comment on this constructor explaining *all* options, since we don\u0027t do that anywhere in this file."},{"file":"lib/moray.js","line":463,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"I agree, figuring out what options were used was somewhat difficult. I can look to add something in the next commit and if you see anything missing I\u0027m happy to then add it again."},{"file":"lib/moray.js","line":486,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"I think we could simplify this with:\n\nif (options.readOnly \u003d\u003d\u003d true) {\n..."},{"file":"lib/moray.js","line":486,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"Yeah, I think this is a carry-over habit of me getting \"undefined\" trolled relentlessly by angularjs.  I\u0027ll clean it up."},{"file":"lib/moray.js","line":486,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I see that Jordan mentioned this elsewhere, but if you use assertplus.optionalBool(options.readOnly, \u0027options.readOnly\u0027), then you can reasonably just check truthiness (\"if (options.readOnly)\")."},{"file":"lib/moray.js","line":566,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"nit: My preference would be to name this based on the name of the argument as it is passed to vasync, and/or its purpose, rather than the package name. In this case, I would probably call the array `funcs`, or `initFuncs`."},{"file":"lib/moray.js","line":566,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"sounds good"},{"file":"lib/moray.js","line":569,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"nit: For block comments, I think we generally prefer periods (along with complete sentences, though that\u0027s already true here)."},{"file":"lib/moray.js","line":569,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"I will fix it."},{"file":"lib/moray.js","line":570,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Should we mention that the condition here is whether it is a read-only client?"},{"file":"lib/moray.js","line":570,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"yes"},{"file":"lib/moray.js","line":638,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"We should add assert.optionalBool for the new `readOnly` option to all methods that use it (such as this one, putFinalizingMetadata, and so on)."},{"file":"lib/moray.js","line":638,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"Yes, will fix"},{"file":"lib/moray.js","line":639,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"I wonder if there\u0027s a better way to clearly indicate which operations are read-only and which are not. If someone adds a new method in the future, we would want them to have to consider whether it should be allowed on a readonly client or not, for instance. It\u0027s also useful for the reader to be able to clearly see how this is enforced.\n\nPerhaps one way we could do this is to have a static array of functions that are only allowed for non-read-only clients, and initialize all of those to a method that blows up in the constructor.\n\nIf it\u0027s not a read-only method, we could assign them to the real function.\n\nWhat do you think?"},{"file":"lib/moray.js","line":639,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"So I played with a few things around this.  I tried to be clever and make a separate client altogether that inherited from the main Moray client, then subsequently noop\u0027d out methods we shouldn\u0027t allow.  I couldn\u0027t get that to work how I imagined it, so went with a more simple solution.  I\u0027m fine if there is a cleaner way to make this work.  I know my nodejs skills are lacking a bit. I\u0027m open to using the method you described, I might just need some guidance on how to do it exactly.  The docs I looked at on inheritance and function overloading sure didn\u0027t *seem* to work."},{"file":"test/moray.test.js","line":84,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"What is the story with this?"},{"file":"test/moray.test.js","line":84,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"It appeared to be old test code hanging around commented out, so I removed it for cleanliness, but I can put it back if it still gets used."},{"file":"test/moray.test.js","line":84,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I think it\u0027s good to remove the commented-out code.  If it\u0027s worthwhile for some reason, we could create a ticket for re-adding whatever functionality it was providing in a more useful way."},{"file":"test/moray.test.js","line":91,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I thought the Moray client already had similar logic for doing this?"},{"file":"test/moray.test.js","line":91,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"Well sort of.  It asserts on the options used, but it will complain if you mix an ip address with srvDomain.  It doesn\u0027t correct it for you and use host instead.\n\n        assert.ok(!net.isIP(args.srvDomain),\n            \u0027cannot use \"srvDomain\" with an IP address\u0027);\n        assert.notEqual(typeof (args.host), \u0027string\u0027,\n            \u0027cannot specify \"host\" with \"srvDomain\"\u0027);\n        assert.equal(typeof (args.port), \u0027undefined\u0027,\n            \u0027cannot specify \"port\" with \"srvDomain\"\u0027);\n        assert.notEqual(typeof (args.url), \u0027string\u0027,\n            \u0027cannot specify \"url\" with \"srvDomain\"\u0027);"},{"file":"test/moray.test.js","line":91,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"IIRC, the two approaches are to specify \"srvDomain\" or \"host\" and \"port\".  \"srvDomain\" uses the real service discovery mechanism, and that should really be preferred everywhere, but it\u0027s incompatible with an IP address option.  I believe if you use \"host\", then it can be either an IP or a DNS name.  That option is deprecated for most real cases, though, because it has serious deficiencies in the face of service failures.\n\nI think ideally, we want this to work similarly to the way the Moray client tools work.  With those, the user can specify various environment variables to select either \"srvDomain\" or \"host\"-based discovery.  This would allow people to exercise both cases -- the real service discovery mechanism (which is necessary for a lot of scalability and fault testing) and the host/IP-based one (which is useful when you just want to run against a local instance that has no DNS name).\n\nI don\u0027t think that needs to be part of this change, especially since I don\u0027t think the code to manage all that is exported from node-moray today.  But if we\u0027re not going to do that, I think it would be less confusing to leave this the way it is now.  Was there some reason you weren\u0027t able to use the a DNS name for electric-moray in your test environment?"},{"file":"test/moray.test.js","line":91,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"It didn\u0027t appear that I had any DNS for electric-moray in the zone I was using.  I thought someone else might hit the same thing, so I made the test flexible to both methods."},{"file":"test/moray.test.js","line":91,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"That makes sense.  FWIW, I add the Manta resolvers to my dev zone\u0027s /etc/resolv.conf and then use Manta\u0027s DNS.  We should probably add something about that to https://github.com/joyent/manta/blob/master/docs/dev-notes.md (or write a more complete guide than that one), because I think it\u0027s pretty helpful not just for stuff like this, but being able to run a variety of other dev and operator tools.\n\nI agree that it would be best if these tools supported either approach since it\u0027s helpful to be able to use an IP address when you\u0027re running your own electric-moray for testing or to point the test suite at a particular electric-moray instance (e.g., one that seems to be acting up).  We explored something similar to what you have here with the node-moray CLI tools.  It was surprisingly complicated and very confusing to support all of the use-cases we care about (e.g., overriding the TCP port).  There\u0027s some discussion of this in RFD 73 (https://github.com/joyent/rfd/blob/master/rfd/0073/README.md#alternative-approaches).\n\nI think the approach we came up with for the Moray CLI would work fine here as well: using a combination of ELECTRIC_MORAY_SERVICE and ELECTRIC_MORAY_URL variables analogous to the MORAY ones (https://github.com/joyent/node-moray/blob/master/docs/man/man1/moray.md).  We probably would need to add ELECTRIC_MORAY_BOOTSTRAP_DOMAIN as well for the reasons mentioned in RFD 73.  In turn, to do that, I think we\u0027d want to parametrize and export this function from node-moray: https://github.com/joyent/node-moray/blob/791780c7c78c5c0d63b1b75f4e97ea15153c6a0d/lib/cmd.js#L40-L85.\n\nThis probably seems way more complex than it should be to just point the test suite at an instance, but in practice, that\u0027s just one use-case that the service discovery mechanism needs to support, and since it is so complex, I think it would help a lot if all of the Moray and EMoray CLIs used the same pattern.  \nI\u0027m not asking that we actually do this work here now (though that would certainly be welcome).  But I\u0027m reluctant to have us create new, different CLI patterns that we know we can\u0027t use elsewhere.  On the other hand, if not having this is a pain to the workflow, we could just suck this one up as a one-off for now."},{"file":"test/moray.test.js","line":91,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I guess we\u0027re just sucking this up as a one-off for now?"},{"file":"test/moray.test.js","line":91,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"Sorry, this was a few weeks ago, so I don\u0027t quite remember my thoughts at the time on this.  Are you suggesting that I change libmanta.createMorayClient to support the different options like node-moray does?"},{"file":"test/moray.test.js","line":91,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Long-term, I do think the right answer is to support those variables in all electric-moray command-line tools (including this test suite).  To implement that we would probably create library functions, but I don\u0027t think libmanta.createMorayClient() would reach out to the environment.  Its callers would do that.\n\nI realize that\u0027s a fair bit of work to do here and I\u0027m not asking that we do it with this change.  I only brought this up because this change creates new semantics around ELECTRIC_MORAY that I think may be confusing, and I think configuring /etc/resolv.conf in dev zones to contain Manta resolvers seems like a better approach (since that better mirrors what happens on production systems).  If for some reason that\u0027s a pain or not desirable, then maybe it\u0027s best to leave this as you have it for now."},{"file":"test/moray.test.js","line":91,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"I edited my resolv.conf and I\u0027ll remove these bits."},{"file":"test/moray.test.js","line":162,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Why are we using the environment for this?"},{"file":"test/moray.test.js","line":162,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"So this gets reused in the Get tests in the read-only tests because they can\u0027t write an object themselves.  I was hoping for some \"always-there\" key I could get like \u0027user/\u0027 or something, but there is nothing in metadata that I know of that we *know* always exists.  So this was the next best thing I could think of to test a get of an object."},{"file":"test/moray.test.js","line":162,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I see.  How about having the read-only test instantiate a separate writable client, write the metadata with that, and then use that for the rest of the test?  That would allow the tests to remain standalone, which is pretty useful."},{"file":"test/moray.test.js","line":162,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"Okay, I can change to do that.  I attempted that at first, but it was that confusion with how to instantiate both clients that caused me to do it this way.  I\u0027ll try again using vasync this time."},{"file":"test/zmoray-ro.test.js","line":122,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Should we also add a test for putFinalizingMetadata?"},{"file":"test/zmoray-ro.test.js","line":122,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"Sure I can do the same thing for putFinalizingMetadata."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/moray.js","type":"MODIFIED","insertions":57,"deletions":-28},{"file":"test/moray.test.js","type":"MODIFIED","insertions":40,"deletions":-53},{"file":"test/zmoray-ro.test.js","type":"ADDED","insertions":146,"deletions":0}],"sizeInsertions":243,"sizeDeletions":-81},{"number":"2","revision":"a3f87bd58d0f4bdf1bfee31ca7402d93b51499d2","parents":["4c001a1f66ee7f93f65319018cd13aa8240415a2"],"ref":"refs/changes/67/2067/2","uploader":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"createdOn":1498864061,"author":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1498864090,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/moray.js","type":"MODIFIED","insertions":62,"deletions":-27},{"file":"test/moray-ro.test.js","type":"ADDED","insertions":205,"deletions":0},{"file":"test/moray.test.js","type":"MODIFIED","insertions":36,"deletions":-53}],"sizeInsertions":303,"sizeDeletions":-80},{"number":"3","revision":"43a775d6bd434821083b90f495612f9c94d9f481","parents":["4c001a1f66ee7f93f65319018cd13aa8240415a2"],"ref":"refs/changes/67/2067/3","uploader":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"createdOn":1498864528,"author":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1498864552,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/moray.js","line":631,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"This isn\u0027t quite wrapped the way I\u0027d expect.  (The way it was originally is more customary here, I think.)"},{"file":"lib/moray.js","line":631,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"Done"},{"file":"lib/moray.js","line":648,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"This isn\u0027t quite wrapped the way I\u0027d expect.  See, e.g., line 299."},{"file":"lib/moray.js","line":648,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"So my editor wants:\n\n message: \u0027Operation putMetadata \u0027 +\n     \u0027not supported in a read-only client\n\nLine 299 seems to suggest it would be\n\n message: \u0027Operation putMetadata \u0027 +\n \u0027not supported in a read-only client\n\nWhich would you rather?"},{"file":"lib/moray.js","line":648,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"For me, line 299 has a 4 space indent, and its continuation on line 300 has an 8 space indent.  I think the general rule in this repo is 4 spaces per level of indent with 4 more spaces for continuation lines within the same level."},{"file":"lib/moray.js","line":648,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"Done"},{"file":"lib/moray.js","line":718,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Same as above."},{"file":"lib/moray.js","line":718,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"Done"},{"file":"test/moray-ro.test.js","line":97,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"There seems like a lot of overlap between this code and the one in the new test.  Particularly given the semantics at L88-97, can we just move all this to a common file?"},{"file":"test/moray-ro.test.js","line":97,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"Agreed, I\u0027ll move it out."},{"file":"test/moray-ro.test.js","line":97,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/moray.js","type":"MODIFIED","insertions":63,"deletions":-27},{"file":"test/moray-ro.test.js","type":"ADDED","insertions":205,"deletions":0},{"file":"test/moray.test.js","type":"MODIFIED","insertions":36,"deletions":-53}],"sizeInsertions":304,"sizeDeletions":-80},{"number":"4","revision":"16fe62a24f624c328d0e1da3ed2be6948cb9469a","parents":["4c001a1f66ee7f93f65319018cd13aa8240415a2"],"ref":"refs/changes/67/2067/4","uploader":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"createdOn":1500564728,"author":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1500564759,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/moray.js","type":"MODIFIED","insertions":63,"deletions":-27},{"file":"test/helper.js","type":"MODIFIED","insertions":45,"deletions":-1},{"file":"test/moray-ro.test.js","type":"ADDED","insertions":149,"deletions":0},{"file":"test/moray.test.js","type":"MODIFIED","insertions":22,"deletions":-97}],"sizeInsertions":279,"sizeDeletions":-125},{"number":"5","revision":"66da48e44416e2b5ebe498b84cbb13965d05be75","parents":["4c001a1f66ee7f93f65319018cd13aa8240415a2"],"ref":"refs/changes/67/2067/5","uploader":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"createdOn":1500565023,"author":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1500594550,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1500679073,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1500565046,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/moray.js","type":"MODIFIED","insertions":62,"deletions":-26},{"file":"test/helper.js","type":"MODIFIED","insertions":45,"deletions":-1},{"file":"test/moray-ro.test.js","type":"ADDED","insertions":149,"deletions":0},{"file":"test/moray.test.js","type":"MODIFIED","insertions":22,"deletions":-97}],"sizeInsertions":278,"sizeDeletions":-124},{"number":"6","revision":"f9d436c6978c30d48372784f2fe973cc565df24d","parents":["4c001a1f66ee7f93f65319018cd13aa8240415a2"],"ref":"refs/changes/67/2067/6","uploader":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"createdOn":1500681203,"author":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1500594550,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1500679073,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1500565046,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"SUBM","value":"1","grantedOn":1500681260,"by":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/moray.js","type":"MODIFIED","insertions":62,"deletions":-26},{"file":"test/helper.js","type":"MODIFIED","insertions":45,"deletions":-1},{"file":"test/moray-ro.test.js","type":"ADDED","insertions":149,"deletions":0},{"file":"test/moray.test.js","type":"MODIFIED","insertions":22,"deletions":-97}],"sizeInsertions":278,"sizeDeletions":-124}],"allReviewers":[{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},{"name":"Joyent Automation","username":"joyent-automation"},{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"}]}