From 0162e6f5f47c3b79f05df17ddf499cb96d5c18b6 Mon Sep 17 00:00:00 2001
From: Alex Wilson <alex.wilson@joyent.com>
Date: Wed, 12 Oct 2016 18:23:37 -0700
Subject: [PATCH] joyent/node-cueball#39 ConnectionFSM#state_idle calls S.on
 after S.gotoState Reviewed by: David Pacheco <dap@joyent.com>

---
 lib/connection-fsm.js | 2 +-
 package.json          | 2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/lib/connection-fsm.js b/lib/connection-fsm.js
index 395a21d..8cdacb9 100644
--- a/lib/connection-fsm.js
+++ b/lib/connection-fsm.js
@@ -393,8 +393,8 @@ ConnectionFSM.prototype.state_idle = function (S) {
 	if (this.cf_closeAfter === true) {
 		this.cf_closeAfter = false;
 		this.cf_lastError = undefined;
-		S.gotoState('closed');
 		S.on(this, 'closeAsserted', function () { });
+		S.gotoState('closed');
 		return;
 	}
 
diff --git a/package.json b/package.json
index dde76ba..f9dad64 100644
--- a/package.json
+++ b/package.json
@@ -1,6 +1,6 @@
 {
   "name": "cueball",
-  "version": "1.1.0",
+  "version": "1.1.1",
   "description": "",
   "main": "lib/index.js",
   "dependencies": {
-- 
2.21.0

