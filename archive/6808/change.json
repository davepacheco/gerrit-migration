{"project":"joyent/sdc-manta","branch":"master","id":"I2806daeb7bbc76398e3576c87a944c8feec3bcea","number":"6808","subject":"MANTA-2769 manta-init should be channel aware MANTA-4159 manta-init should have an option to specify an image version substring MANTA-3674 manta-adm should have a channel guard","owner":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"url":"https://cr.joyent.us/6808","commitMessage":"MANTA-2769 manta-init should be channel aware\nMANTA-4159 manta-init should have an option to specify an image version substring\nMANTA-3674 manta-adm should have a channel guard\n","createdOn":1566229104,"lastUpdated":1570201778,"open":true,"status":"NEW","comments":[{"timestamp":1566229104,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Uploaded patch set 1."},{"timestamp":1566229113,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit 0f70ed94a320e8ccc869dfa16f0d6d4713b16b50\n    \n    MANTA-2769 manta-init should be channel aware"},{"timestamp":1566229182,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing-1\n\n(2 comments)\n\n\"make check\" exited with status 2"},{"timestamp":1566229966,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Uploaded patch set 2."},{"timestamp":1566229973,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit 4894f32348e2db81439970a97d8a3ba79db02fa3\n    \n    fix \u0027make check\u0027 errors"},{"timestamp":1566230052,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1566296133,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Uploaded patch set 3."},{"timestamp":1566296140,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Patch Set 3:\n\nNew commits:\n    \n    commit 199d8a9de142663146d544059e0abd77884f3118\n    \n    Switch to a default -B value of \u0027\u0027"},{"timestamp":1566296203,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1568805357,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Uploaded patch set 4."},{"timestamp":1568805365,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Patch Set 4:\n\nNew commits:\n    \n    commit 798ac0c8c86d7ee315fa25eea9f4e5ba75d65e4e\n    \n    MANTA-3674 manta-adm should have a channel guard\n    \n    commit a28814f2334a61607edac1b02bf03339b838490a\n    \n    MANTA-2769 manta-init should be channel aware"},{"timestamp":1568805429,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1568806151,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Patch Set 4:\n\nThis needs a little more work - the changes were developed on two\nbranches, and I now want to see if I can refactor the lookup of the SAPI\n\u0027channel\u0027 option so that there\u0027s less duplicated code."},{"timestamp":1568881702,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Uploaded patch set 5."},{"timestamp":1568881709,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Patch Set 5:\n\nNew commits:\n    \n    commit 3e29ce504d3dd40b276c6346fa63a9066af8d3a1\n    \n    share SAPI channel lookup code between manta-init and manta-adm\n    \n    commit 024c59efc33fb7f01c3f4a195956dcc5fc3507b5\n    \n    MANTA-3674 manta-adm should have a channel guard\n    \n    commit b71fa427a1d19d5e2537d412f5474b43b4569cf7\n    \n    MANTA-2769 manta-init should be channel aware"},{"timestamp":1568881781,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1570116040,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 5:\n\n(7 comments)\n\nI think this looks really good. Well done!"},{"timestamp":1570119761,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Patch Set 5:\n\n(7 comments)\n\nThanks for the review! I\u0027ll post the follow-up changes if you can suggest the best approach for lib/adm.js line 4158 (I\u0027m totally easy, either way)"},{"timestamp":1570199018,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 5:\n\n(2 comments)"},{"timestamp":1570201606,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Uploaded patch set 6."},{"timestamp":1570201618,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Patch Set 6:\n\nNew commits:\n    \n    commit ed19d3ea2a951c0ae06534379d38e037d7ec2e17\n    \n    address kkantor\u0027s review feedback"},{"timestamp":1570201635,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Patch Set 5:\n\n(2 comments)\n\nI\u0027ve addressed these changes in patchset 6"},{"timestamp":1570201673,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 6: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1570201778,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 6: Code-Review+1"}],"currentPatchSet":{"number":"6","revision":"2806daeb7bbc76398e3576c87a944c8feec3bcea","parents":["fc04488b427e2e9ee5e7b76836a018b062b5cd12"],"ref":"refs/changes/08/6808/6","uploader":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"createdOn":1570201606,"author":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1570201673,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1570201778,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"cmd/manta-adm.js","type":"MODIFIED","insertions":19,"deletions":0},{"file":"cmd/manta-init.js","type":"MODIFIED","insertions":60,"deletions":-10},{"file":"docs/man/man1/manta-adm.md","type":"MODIFIED","insertions":8,"deletions":-2},{"file":"docs/man/man1/manta-init.md","type":"MODIFIED","insertions":16,"deletions":-2},{"file":"lib/adm.js","type":"MODIFIED","insertions":124,"deletions":0},{"file":"lib/common.js","type":"MODIFIED","insertions":41,"deletions":0}],"sizeInsertions":268,"sizeDeletions":-14},"patchSets":[{"number":"1","revision":"3d38341fc0fa49755dca161a6e6ba121cc0de8d6","parents":["e6da2ce76349a9197a2bf61e0d6551d9b16c65db"],"ref":"refs/changes/08/6808/1","uploader":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"createdOn":1566229104,"author":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1566229182,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"cmd/manta-init.js","line":734,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"missing space between \u0027function\u0027 and paren"},{"file":"cmd/manta-init.js","line":736,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"line \u003e 80 characters"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"cmd/manta-init.js","type":"MODIFIED","insertions":53,"deletions":-7},{"file":"docs/man/man1/manta-init.md","type":"MODIFIED","insertions":12,"deletions":0},{"file":"lib/common.js","type":"MODIFIED","insertions":31,"deletions":0}],"sizeInsertions":96,"sizeDeletions":-7},{"number":"2","revision":"076c285459a8280489807e7ef88dbde64dcf65af","parents":["e6da2ce76349a9197a2bf61e0d6551d9b16c65db"],"ref":"refs/changes/08/6808/2","uploader":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"createdOn":1566229966,"author":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1566230052,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"cmd/manta-init.js","type":"MODIFIED","insertions":55,"deletions":-8},{"file":"docs/man/man1/manta-init.md","type":"MODIFIED","insertions":14,"deletions":-2},{"file":"lib/common.js","type":"MODIFIED","insertions":31,"deletions":0}],"sizeInsertions":100,"sizeDeletions":-10},{"number":"3","revision":"ba1137597018ab44125dea118a18aba5a4ad827d","parents":["e6da2ce76349a9197a2bf61e0d6551d9b16c65db"],"ref":"refs/changes/08/6808/3","uploader":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"createdOn":1566296133,"author":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1566296203,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"cmd/manta-init.js","type":"MODIFIED","insertions":59,"deletions":-10},{"file":"docs/man/man1/manta-init.md","type":"MODIFIED","insertions":15,"deletions":-2},{"file":"lib/common.js","type":"MODIFIED","insertions":31,"deletions":0}],"sizeInsertions":105,"sizeDeletions":-12},{"number":"4","revision":"b10894db1ed56c9e01698ec5d118af83ba22cb6e","parents":["e6da2ce76349a9197a2bf61e0d6551d9b16c65db"],"ref":"refs/changes/08/6808/4","uploader":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"createdOn":1568805357,"author":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1568805429,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"cmd/manta-adm.js","type":"MODIFIED","insertions":18,"deletions":0},{"file":"cmd/manta-init.js","type":"MODIFIED","insertions":59,"deletions":-10},{"file":"docs/man/man1/manta-adm.md","type":"MODIFIED","insertions":8,"deletions":-2},{"file":"docs/man/man1/manta-init.md","type":"MODIFIED","insertions":15,"deletions":-2},{"file":"lib/adm.js","type":"MODIFIED","insertions":132,"deletions":0},{"file":"lib/common.js","type":"MODIFIED","insertions":31,"deletions":0}],"sizeInsertions":263,"sizeDeletions":-14},{"number":"5","revision":"4947bc2af1341507d6ea13ea8c9744a81d1cd9f6","parents":["fc04488b427e2e9ee5e7b76836a018b062b5cd12"],"ref":"refs/changes/08/6808/5","uploader":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"createdOn":1568881702,"author":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1568881781,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"cmd/manta-adm.js","line":881,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"I prefer the \u0027return\u0027 to be on a separate line. This repo is inconsistent about this sort of thing though so it\u0027s not a big deal."},{"file":"cmd/manta-adm.js","line":881,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"No problem, I\u0027ll fix that."},{"file":"cmd/manta-adm.js","line":970,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Should these be spaces (based on the previous two flags)?"},{"file":"cmd/manta-adm.js","line":970,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Yep, thanks"},{"file":"cmd/manta-adm.js","line":973,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Are we missing a comma in this string? It reads a little funny to me."},{"file":"cmd/manta-adm.js","line":973,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"ugh, yes that\u0027s terrible - I\u0027ll reword."},{"file":"cmd/manta-init.js","line":430,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Since the default value for ARGV.branch is already \u0027\u0027, what do you think about removing this condition?\n\nI like the ability to not search on a specific channel, but having a dual-purpose bool/string flag feels a little weird to me. Maybe we can limit that behavior to just the -C flag by eliminating the similar behavior here for -B?"},{"file":"cmd/manta-init.js","line":430,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"That\u0027s reasonable. Fwiw, earlier versions of this code had our default for -B the same as the current code, \u0027master\u0027, but Trent persuaded me out of doing that, hence this proposed change, but I\u0027ve tested that the default of \u0027\u0027 really does give us a string rather than a boolean, so we\u0027re cool."},{"file":"lib/adm.js","line":4158,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Is there an extra tab here?"},{"file":"lib/adm.js","line":4158,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Yeah, I wasn\u0027t sure how to indent this code.\n\nFor editors where 1 tab \u003d\u003d 4 spaces, indenting the 2nd and 3rd clauses of the for-loop by only 4 spaces will result in those lines appearing to start on the same column as the body of the loop.\n\nSo instead, I added an extra tab indent so that it was clear\nwhat was going on. I don\u0027t mind removing that extra indent if you prefer? So we have this:\n\n    for (var i \u003d 0;\n            i \u003c this.ma_plan[svcname][cnid].length;\n            i++) {\n        content;\n        of;\n        loop;\n    }\n\nrather than\n\n    for (var i \u003d 0;\n        i \u003c this.ma_plan[svcname][cnid].length;\n        i++) {\n        content;\n        of;\n        loop;\n    }\n\nI\u0027m easy either way?"},{"file":"lib/adm.js","line":4158,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"I would prefer that this is converted into four spaces since it\u0027s a line continuation. When \u0027for\u0027 statements wrap lines sometimes people add an extra blank line before the loop body to differentiate the content a bit.\n\nI agree that our mix tab and space style can be really frustrating."},{"file":"lib/adm.js","line":4158,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"No problem, will do!"},{"file":"lib/adm.js","line":4179,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Perhaps we need a tab here."},{"file":"lib/adm.js","line":4179,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"yep, thanks!"},{"file":"lib/adm.js","line":4189,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Should this also be spaces, like the next line?"},{"file":"lib/adm.js","line":4189,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Ugh, thanks - I\u0027m basically just doing what jsstyle/jsl wants me to at this point. Solaris ON-style mixed-tab/space indents are nuts imho :-)"},{"file":"lib/adm.js","line":4189,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Yeah, I generally agree with your assessment of the style. Javascript\u0027s tendencies for very long lines doesn\u0027t help. Does jsstyle complain if these are spaces instead of tabs?"},{"file":"lib/adm.js","line":4189,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"nope, jsstyle is fine here"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"cmd/manta-adm.js","type":"MODIFIED","insertions":18,"deletions":0},{"file":"cmd/manta-init.js","type":"MODIFIED","insertions":65,"deletions":-10},{"file":"docs/man/man1/manta-adm.md","type":"MODIFIED","insertions":8,"deletions":-2},{"file":"docs/man/man1/manta-init.md","type":"MODIFIED","insertions":16,"deletions":-2},{"file":"lib/adm.js","type":"MODIFIED","insertions":124,"deletions":0},{"file":"lib/common.js","type":"MODIFIED","insertions":41,"deletions":0}],"sizeInsertions":272,"sizeDeletions":-14},{"number":"6","revision":"2806daeb7bbc76398e3576c87a944c8feec3bcea","parents":["fc04488b427e2e9ee5e7b76836a018b062b5cd12"],"ref":"refs/changes/08/6808/6","uploader":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"createdOn":1570201606,"author":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1570201673,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1570201778,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"cmd/manta-adm.js","type":"MODIFIED","insertions":19,"deletions":0},{"file":"cmd/manta-init.js","type":"MODIFIED","insertions":60,"deletions":-10},{"file":"docs/man/man1/manta-adm.md","type":"MODIFIED","insertions":8,"deletions":-2},{"file":"docs/man/man1/manta-init.md","type":"MODIFIED","insertions":16,"deletions":-2},{"file":"lib/adm.js","type":"MODIFIED","insertions":124,"deletions":0},{"file":"lib/common.js","type":"MODIFIED","insertions":41,"deletions":0}],"sizeInsertions":268,"sizeDeletions":-14}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"}]}