{"project":"joyent/triton-prometheus","branch":"master","id":"I408fc5986d9616d307bfc5f203254a5ea5145839","number":"6387","subject":"MANTA-4309 Add registrar config to prometheus image TRITON-1723 triton-prometheus uses wrong NODE_PREBUILT_IMAGE Reviewed by: Joshua M. Clulow \u003cjmc@joyent.com\u003e Approved by: Joshua M. Clulow \u003cjmc@joyent.com\u003e","owner":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"url":"https://cr.joyent.us/6387","commitMessage":"MANTA-4309 Add registrar config to prometheus image\nTRITON-1723 triton-prometheus uses wrong NODE_PREBUILT_IMAGE\nReviewed by: Joshua M. Clulow \u003cjmc@joyent.com\u003e\nApproved by: Joshua M. Clulow \u003cjmc@joyent.com\u003e\n","createdOn":1559607964,"lastUpdated":1560200629,"open":false,"status":"MERGED","comments":[{"timestamp":1559607964,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Uploaded patch set 1."},{"timestamp":1559607973,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing-1\n\n\"make check\" exited with status 2\n\n fatal: ref HEAD is not a symbolic ref\n fatal: No tags can describe \u00272d9378000e37288aebdacd5455537add0401b8d8\u0027.\n Try --always, or create some tags.\n xmllint --noout --path deps/eng/tools/ --dtdvalid deps/eng/tools/service_bundle.dtd.1 smf/manifests/prometheus.xml\n ESLINT_VER\u003d$(/tmp/repo/build/node/bin/node -e \u0027console.log(require(\"./package.json\").devDependencies[\"eslint\"] || \"\")\u0027) \u0026\u0026 \\\n     ESLINT_JOY_VER\u003d$(/tmp/repo/build/node/bin/node -e \u0027console.log(require(\"./package.json\").devDependencies[\"eslint-plugin-joyent\"] || \"\")\u0027) \u0026\u0026 \\\n     [[ -n $ESLINT_VER \u0026\u0026 -n $ESLINT_JOY_VER ]] \u0026\u0026 \\\n     PATH\u003d/tmp/repo/build/node/bin:/opt/local/sbin:/opt/local/bin:/usr/gnu/bin:/usr/bin:/usr/sbin:/bin:/sbin:/home/build/javascriptlint/build/install:/home/build/jsstyle /tmp/repo/build/node/bin/node /tmp/repo/build/node/bin/npm install --no-save eslint@$ESLINT_VER eslint-plugin-joyent@$ESLINT_JOY_VER \u0026\u0026 \\\n     touch node_modules/.bin/eslint\n ld.so.1: node: fatal: relocation error: file /tmp/repo/build/node/bin/node: symbol _ZNSt8__detail15_List_node_base7_M_hookEPS0_: referenced symbol not found\n /bin/sh: line 3: 218855: Killed\n gmake: *** [deps/eng/tools/mk/Makefile.deps:71: node_modules/.bin/eslint] Killed"},{"timestamp":1559674403,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Uploaded patch set 2."},{"timestamp":1559674425,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1559674608,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Patch Set 2:\n\nSee ticket for testing notes.\n\nWhen determining the values to use in the registrar config template, I used existing templates for other manta services as a guide (I started by copying the config from medusa, because it seemed self-contained and straightforward)."},{"timestamp":1559680128,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Patch Set 2: Code-Review+1\n\nPlease file a bug for the image change in the Makefile.  Otherwise, LGTM!"},{"timestamp":1559680287,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Patch Set 3: Commit message was updated."},{"timestamp":1559681142,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Patch Set 3:\n\nMore testing notes (exercising srv record functionality) added to ticket."},{"timestamp":1560200529,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Patch Set 3: Integration-Approval+1"},{"timestamp":1560200557,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Patch Set 4: Patch Set 3 was rebased"},{"timestamp":1560200623,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Patch Set 5: Commit message was updated."},{"timestamp":1560200629,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Isaac Davis"}],"currentPatchSet":{"number":"5","revision":"c199c74437dfe561bab0c4fec6522e174c348488","parents":["71d819fd9a562e61e6e933ec6c2588c456152edc"],"ref":"refs/changes/87/6387/5","uploader":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"createdOn":1560200623,"author":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1559674425,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1559680128,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1560200529,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}},{"type":"SUBM","value":"1","grantedOn":1560200629,"by":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"sapi_manifests/registrar/manifest.json","type":"ADDED","insertions":4,"deletions":0},{"file":"sapi_manifests/registrar/template","type":"ADDED","insertions":40,"deletions":0}],"sizeInsertions":46,"sizeDeletions":-2},"patchSets":[{"number":"1","revision":"2d9378000e37288aebdacd5455537add0401b8d8","parents":["4a1960e6c49b160dc86250a167bc2af406484cb3"],"ref":"refs/changes/87/6387/1","uploader":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"createdOn":1559607964,"author":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1559607973,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"sapi_manifests/registrar/manifest.json","type":"ADDED","insertions":4,"deletions":0},{"file":"sapi_manifests/registrar/template","type":"ADDED","insertions":40,"deletions":0}],"sizeInsertions":44,"sizeDeletions":0},{"number":"2","revision":"408fc5986d9616d307bfc5f203254a5ea5145839","parents":["4a1960e6c49b160dc86250a167bc2af406484cb3"],"ref":"refs/changes/87/6387/2","uploader":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"createdOn":1559674403,"author":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1559680128,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1559674425,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"sapi_manifests/registrar/manifest.json","type":"ADDED","insertions":4,"deletions":0},{"file":"sapi_manifests/registrar/template","type":"ADDED","insertions":40,"deletions":0}],"sizeInsertions":46,"sizeDeletions":-2},{"number":"3","revision":"cc87f68053559dc06b569e2f30b81f694e4f3bd7","parents":["4a1960e6c49b160dc86250a167bc2af406484cb3"],"ref":"refs/changes/87/6387/3","uploader":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"createdOn":1559680287,"author":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1559680128,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1560200529,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1559674425,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"sapi_manifests/registrar/manifest.json","type":"ADDED","insertions":4,"deletions":0},{"file":"sapi_manifests/registrar/template","type":"ADDED","insertions":40,"deletions":0}],"sizeInsertions":46,"sizeDeletions":-2},{"number":"4","revision":"5709157b62e3bc939176b11c95d8094b30f60d05","parents":["71d819fd9a562e61e6e933ec6c2588c456152edc"],"ref":"refs/changes/87/6387/4","uploader":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"createdOn":1560200557,"author":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"isDraft":false,"kind":"NO_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1559680128,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1560200529,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1559674425,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"sapi_manifests/registrar/manifest.json","type":"ADDED","insertions":4,"deletions":0},{"file":"sapi_manifests/registrar/template","type":"ADDED","insertions":40,"deletions":0}],"sizeInsertions":46,"sizeDeletions":-2},{"number":"5","revision":"c199c74437dfe561bab0c4fec6522e174c348488","parents":["71d819fd9a562e61e6e933ec6c2588c456152edc"],"ref":"refs/changes/87/6387/5","uploader":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"createdOn":1560200623,"author":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1559680128,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1560200529,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1559674425,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"SUBM","value":"1","grantedOn":1560200629,"by":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"sapi_manifests/registrar/manifest.json","type":"ADDED","insertions":4,"deletions":0},{"file":"sapi_manifests/registrar/template","type":"ADDED","insertions":40,"deletions":0}],"sizeInsertions":46,"sizeDeletions":-2}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"}]}