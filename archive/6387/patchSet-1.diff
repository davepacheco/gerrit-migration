From 2d9378000e37288aebdacd5455537add0401b8d8 Mon Sep 17 00:00:00 2001
From: Isaac Davis <isaac.davis@joyent.com>
Date: Mon, 3 Jun 2019 21:29:46 +0000
Subject: [PATCH] MANTA-4309 Add registrar config to prometheus image

---
 sapi_manifests/registrar/manifest.json |  4 +++
 sapi_manifests/registrar/template      | 40 ++++++++++++++++++++++++++
 2 files changed, 44 insertions(+)
 create mode 100644 sapi_manifests/registrar/manifest.json
 create mode 100644 sapi_manifests/registrar/template

diff --git a/sapi_manifests/registrar/manifest.json b/sapi_manifests/registrar/manifest.json
new file mode 100644
index 0000000..6c99cdc
--- /dev/null
+++ b/sapi_manifests/registrar/manifest.json
@@ -0,0 +1,4 @@
+{
+    "name": "registrar",
+    "path": "/opt/smartdc/registrar/etc/config.json"
+}
\ No newline at end of file
diff --git a/sapi_manifests/registrar/template b/sapi_manifests/registrar/template
new file mode 100644
index 0000000..8e6d38b
--- /dev/null
+++ b/sapi_manifests/registrar/template
@@ -0,0 +1,40 @@
+{
+    "registration": {
+        {{#is_manta_service}}
+            "domain": "{{SERVICE_NAME}}",
+        {{/is_manta_service}}
+        {{^is_manta_service}}
+            "domain": "{{SERVICE_NAME}}.{{datacenter_name}}.{{dns_domain}}",
+        {{/is_manta_service}}
+        "type": "load_balancer",
+        "service": {
+            "type": "service",
+            "service": {
+                "srvce": "_prometheus",
+                "proto": "_tcp",
+                "port": 9090
+            },
+            "ttl": 60
+        },
+        "ttl": 30
+    },
+
+    "zookeeper": {
+        "servers": [
+            {{#ZK_SERVERS}}
+                {
+                    "host": "{{host}}",
+                    "port": {{port}}
+                }{{^last}}, {{/last}}
+            {{/ZK_SERVERS}}
+        ],
+        "timeout": 60000
+    },
+
+    {{#is_manta_service}}
+        "adminIp": "{{auto.MANTA_IP}}"
+    {{/is_manta_service}}
+    {{^is_manta_service}}
+        "adminIp": "{{auto.ADMIN_IP}}"
+    {{/is_manta_service}}
+}
-- 
2.21.0

