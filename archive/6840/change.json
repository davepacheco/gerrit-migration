{"project":"joyent/illumos-joyent","branch":"master","id":"Ifa49197bae58cc9833edfa12d6b7ba60b1cd1d94","number":"6840","subject":"OS-7972 Early network admin service may not set the datalink MTU to the correct value Reviewed by: Dan McDonald \u003cdanmcd@joyent.com\u003e Approved by: Brian Bennett \u003cbrian.bennett@joyent.com\u003e","owner":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"url":"https://cr.joyent.us/6840","commitMessage":"OS-7972 Early network admin service may not set the datalink MTU to the correct value\nReviewed by: Dan McDonald \u003cdanmcd@joyent.com\u003e\nApproved by: Brian Bennett \u003cbrian.bennett@joyent.com\u003e\n","createdOn":1566882970,"lastUpdated":1568157845,"open":false,"status":"MERGED","comments":[{"timestamp":1566882970,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Uploaded patch set 1."},{"timestamp":1568059735,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 1: Code-Review+1"},{"timestamp":1568062867,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Uploaded patch set 2: Patch Set 1 was rebased."},{"timestamp":1568072640,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Patch Set 2: Integration-Approval+1"},{"timestamp":1568126083,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Uploaded patch set 3: Commit message was updated."},{"timestamp":1568135053,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Uploaded patch set 4: Patch Set 3 was rebased."},{"timestamp":1568137811,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 4: Code-Review-1"},{"timestamp":1568137818,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 4: -Code-Review Integration-Approval-1"},{"timestamp":1568138003,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 4: -Code-Review\n\n(1 comment)\n\nSince you said it was problematic with aggrs, I figured I\u0027d point out the one place I see aggrs in the diff."},{"timestamp":1568139833,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 4:\n\n(2 comments)"},{"timestamp":1568140372,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 4:\n\n(1 comment)"},{"timestamp":1568144125,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Uploaded patch set 5."},{"timestamp":1568144162,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 5: -Integration-Approval"},{"timestamp":1568145036,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 5: Code-Review+1\n\nGood catch."},{"timestamp":1568150644,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Patch Set 5: Integration-Approval+1\n\nTested with a single nic host with underlay on the same physical nic as admin, and tested on a shrimp with RAN+aggr (but no mtu adjustment)."},{"timestamp":1568157845,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Jason King"}],"currentPatchSet":{"number":"5","revision":"fa49197bae58cc9833edfa12d6b7ba60b1cd1d94","parents":["4e7ed5ff5aed7830c00a00fde7205951f49b4f05"],"ref":"refs/changes/40/6840/5","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1568144125,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1568145036,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1568150644,"by":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"}},{"type":"SUBM","value":"1","grantedOn":1568157845,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/cmd/svc/milestone/net-early-admin","type":"MODIFIED","insertions":30,"deletions":-7}],"sizeInsertions":30,"sizeDeletions":-7},"patchSets":[{"number":"1","revision":"6b588f4f3664de8d123f4e16e3018fc2cf798a00","parents":["679f546c5aa97e75a655a2b0f0cd0cddf2ccdafb"],"ref":"refs/changes/40/6840/1","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1566882970,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1568059735,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/svc/milestone/net-early-admin","type":"MODIFIED","insertions":19,"deletions":-7}],"sizeInsertions":19,"sizeDeletions":-7},{"number":"2","revision":"ac8fd644f0b22e8e10bf240102344250443a0b40","parents":["b67d8733333b09a4f54e1f305953f4186981cdb4"],"ref":"refs/changes/40/6840/2","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1568062867,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1568072640,"by":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1568059735,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/svc/milestone/net-early-admin","type":"MODIFIED","insertions":19,"deletions":-7}],"sizeInsertions":19,"sizeDeletions":-7},{"number":"3","revision":"10f724a644976b4718d9e3bdc14e6e37fae357bb","parents":["b67d8733333b09a4f54e1f305953f4186981cdb4"],"ref":"refs/changes/40/6840/3","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1568126083,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1568072640,"by":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1568059735,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/cmd/svc/milestone/net-early-admin","type":"MODIFIED","insertions":19,"deletions":-7}],"sizeInsertions":19,"sizeDeletions":-7},{"number":"4","revision":"5056821d85179a6611f507fe28b6435eb5297d84","parents":["4e7ed5ff5aed7830c00a00fde7205951f49b4f05"],"ref":"refs/changes/40/6840/4","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1568135053,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1568072640,"by":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"-1","grantedOn":1568137818,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}}],"comments":[{"file":"usr/src/cmd/svc/milestone/net-early-admin","line":149,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Do you need the MTU information HERE as well?"},{"file":"usr/src/cmd/svc/milestone/net-early-admin","line":149,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"No -- it gets set at line 171 (just has to be done before anything\u0027s plumbed on it)"},{"file":"usr/src/cmd/svc/milestone/net-early-admin","line":164,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"The problem is here -- for aggrs link gets set to an empty string because the tag value (tagmac) is \u0027aggrXX\u0027 instead of a mac.  The fix is to set link to $tagmac when $tagmac is an aggr so that it\u0027ll match $nic (which is the link name)."},{"file":"usr/src/cmd/svc/milestone/net-early-admin","line":164,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Wow. Thanks for the explanation."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/cmd/svc/milestone/net-early-admin","type":"MODIFIED","insertions":19,"deletions":-7}],"sizeInsertions":19,"sizeDeletions":-7},{"number":"5","revision":"fa49197bae58cc9833edfa12d6b7ba60b1cd1d94","parents":["4e7ed5ff5aed7830c00a00fde7205951f49b4f05"],"ref":"refs/changes/40/6840/5","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1568144125,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1568150644,"by":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"}},{"type":"SUBM","value":"1","grantedOn":1568157845,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1568145036,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/cmd/svc/milestone/net-early-admin","type":"MODIFIED","insertions":30,"deletions":-7}],"sizeInsertions":30,"sizeDeletions":-7}],"allReviewers":[{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}]}