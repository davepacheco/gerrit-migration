From 4973a49c0046838ad10a0aae797a48bde5022e97 Mon Sep 17 00:00:00 2001
From: Jerry Jelinek <jerry.jelinek@joyent.com>
Date: Fri, 25 Aug 2017 22:24:32 +0000
Subject: [PATCH] OS-6313 backout fix for OS-6275, needs more work Reviewed by:
 Patrick Mooney <patrick.mooney@joyent.com> Approved by: Patrick Mooney
 <patrick.mooney@joyent.com>

---
 usr/src/uts/common/brand/lx/syscall/lx_pipe.c | 11 -----------
 1 file changed, 11 deletions(-)

diff --git a/usr/src/uts/common/brand/lx/syscall/lx_pipe.c b/usr/src/uts/common/brand/lx/syscall/lx_pipe.c
index b96727cd8a..d6c8f1d274 100644
--- a/usr/src/uts/common/brand/lx/syscall/lx_pipe.c
+++ b/usr/src/uts/common/brand/lx/syscall/lx_pipe.c
@@ -179,17 +179,6 @@ lx_hd_pipe(intptr_t arg, int flags)
 	VERIFY((str = vp1->v_stream) != NULL);
 	(void) lx_pipe_setsz(str, LX_DEFAULT_PIPE_SIZE, B_TRUE);
 
-	/*
-	 * Because we're using streams to increase the capacity of the pipe
-	 * up to the default Linux capacity, we have to switch the pipe
-	 * out of FIFOFAST mode and back to a normal stream. In fast mode
-	 * the pipe capacity is limited to "Fifohiwat" which is a compile-time
-	 * limit set to FIFOHIWAT.
-	 */
-	mutex_enter(&VTOF(vp1)->fn_lock->flk_lock);
-	fifo_fastoff(VTOF(vp1));
-	mutex_exit(&VTOF(vp1)->fn_lock->flk_lock);
-
 	/*
 	 * Set the O_NONBLOCK flag if requested.
 	 */
-- 
2.21.0

