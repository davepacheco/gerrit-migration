{"project":"joyent/sdc-vm-agent","branch":"master","id":"I390df790f2dacee3f71af095a01444014cfd6cba","number":"1382","subject":"AGENT-1057 log setup for agents should move to a -setup service instead of the agent\u0027s startup script","owner":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"url":"https://cr.joyent.us/1382","commitMessage":"AGENT-1057 log setup for agents should move to a -setup service instead of the agent\u0027s startup script\n","createdOn":1485904961,"lastUpdated":1486162907,"open":false,"status":"MERGED","comments":[{"timestamp":1485904961,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Uploaded patch set 1."},{"timestamp":1485904962,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit 89765790e03892c70c2e65dc06f742db20bfe287\n    \n    AGENT-1057 log setup for agents should move to a -setup service instead of the agent\u0027s startup script"},{"timestamp":1485905017,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1485932547,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Uploaded patch set 2."},{"timestamp":1485932548,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit a0667736f16a372d2058954bf6df33bd8a303a30\n    \n    bump version, slightly less agressive on the bogus PATH removal"},{"timestamp":1485932604,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1486069254,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 2:\n\n(2 comments)"},{"timestamp":1486070427,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 2:\n\n(2 comments)"},{"timestamp":1486100354,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Uploaded patch set 3."},{"timestamp":1486100355,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 3:\n\nNew commits:\n    \n    commit 8001b22f2e080ed3e80e765ed0dcd10ccd8bafc0\n    \n    more unique variable names"},{"timestamp":1486100398,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1486100447,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 4: Patch Set 3 was rebased"},{"timestamp":1486100498,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4:\n\n\"make check\" passed ok"},{"timestamp":1486143792,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 4: Code-Review+1"},{"timestamp":1486162905,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 4: Integration-Approval+1"},{"timestamp":1486162907,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Josh Wilsdon"}],"currentPatchSet":{"number":"4","revision":"5a6d2114173e7f149057cbf6fec6bb446affbe21","parents":["59616277cb6796289d8e391a0a086472be6d31b2"],"ref":"refs/changes/82/1382/4","uploader":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"createdOn":1486100447,"author":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1486100398,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1486143792,"by":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1486162905,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"SUBM","value":"1","grantedOn":1486162907,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"npm/postinstall.sh","type":"MODIFIED","insertions":18,"deletions":-16},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"smf/manifests/vm-agent-setup.xml.in","type":"ADDED","insertions":55,"deletions":0},{"file":"smf/manifests/vm-agent.xml.in","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"smf/method/vm-agent-setup","fileOld":"smf/method/vm-agent.in","type":"RENAMED","insertions":2,"deletions":-3}],"sizeInsertions":79,"sizeDeletions":-23},"patchSets":[{"number":"1","revision":"b8e2a613a7964e5101d7bba322a08ea8e67250e0","parents":["bfdd351fd904ee84f5416a35993f44728a27e11b"],"ref":"refs/changes/82/1382/1","uploader":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"createdOn":1485904961,"author":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1485905017,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"npm/postinstall.sh","type":"MODIFIED","insertions":16,"deletions":-16},{"file":"smf/manifests/vm-agent-setup.xml.in","type":"ADDED","insertions":55,"deletions":0},{"file":"smf/manifests/vm-agent.xml.in","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"smf/method/vm-agent-setup","fileOld":"smf/method/vm-agent.in","type":"RENAMED","insertions":2,"deletions":-3}],"sizeInsertions":76,"sizeDeletions":-22},{"number":"2","revision":"b72fa1907f2120f4c283c39725ff079c2ef93117","parents":["bfdd351fd904ee84f5416a35993f44728a27e11b"],"ref":"refs/changes/82/1382/2","uploader":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"createdOn":1485932547,"author":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1485932604,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"npm/postinstall.sh","line":73,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Nit: Would it be clearer to use more self explanatory variable names like \"agent_manifest\" and \"agent_setup_manifest\"?\n\nI can imagine how it could become difficult to follow what \"manifest0\" and \"manifest1\" are."},{"file":"npm/postinstall.sh","line":73,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"This is a good point. This naming came from trying to match what cn-agent had already been doing with its multiple manifests. But I will update this CR and the other 4 to use better names."},{"file":"npm/postinstall.sh","line":78,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Should we exit (fatal) when the setup manifest is missing even though the agent manifest is there and could be imported?"},{"file":"npm/postinstall.sh","line":78,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"yes, I believe so because this case would mean a broken build. The manifest .in files come straight from the repo so either of these missing means the build is broken and we should do what we can to fail loudly and get that fixed."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"npm/postinstall.sh","type":"MODIFIED","insertions":16,"deletions":-16},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"smf/manifests/vm-agent-setup.xml.in","type":"ADDED","insertions":55,"deletions":0},{"file":"smf/manifests/vm-agent.xml.in","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"smf/method/vm-agent-setup","fileOld":"smf/method/vm-agent.in","type":"RENAMED","insertions":2,"deletions":-3}],"sizeInsertions":77,"sizeDeletions":-23},{"number":"3","revision":"390df790f2dacee3f71af095a01444014cfd6cba","parents":["bfdd351fd904ee84f5416a35993f44728a27e11b"],"ref":"refs/changes/82/1382/3","uploader":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"createdOn":1486100354,"author":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1486100398,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"npm/postinstall.sh","type":"MODIFIED","insertions":18,"deletions":-16},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"smf/manifests/vm-agent-setup.xml.in","type":"ADDED","insertions":55,"deletions":0},{"file":"smf/manifests/vm-agent.xml.in","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"smf/method/vm-agent-setup","fileOld":"smf/method/vm-agent.in","type":"RENAMED","insertions":2,"deletions":-3}],"sizeInsertions":79,"sizeDeletions":-23},{"number":"4","revision":"5a6d2114173e7f149057cbf6fec6bb446affbe21","parents":["59616277cb6796289d8e391a0a086472be6d31b2"],"ref":"refs/changes/82/1382/4","uploader":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"createdOn":1486100447,"author":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1486100398,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1486162905,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"SUBM","value":"1","grantedOn":1486162907,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1486143792,"by":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"npm/postinstall.sh","type":"MODIFIED","insertions":18,"deletions":-16},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"smf/manifests/vm-agent-setup.xml.in","type":"ADDED","insertions":55,"deletions":0},{"file":"smf/manifests/vm-agent.xml.in","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"smf/method/vm-agent-setup","fileOld":"smf/method/vm-agent.in","type":"RENAMED","insertions":2,"deletions":-3}],"sizeInsertions":79,"sizeDeletions":-23}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}]}