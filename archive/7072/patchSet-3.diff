From a461924c91c1e5a1ef685085ac5b034ef7bb918c Mon Sep 17 00:00:00 2001
From: John Levon <john.levon@joyent.com>
Date: Tue, 5 Nov 2019 14:58:50 +0000
Subject: [PATCH] OS-8022 add os-tests to the tests-archive tarball

---
 manifest                                                      | 2 --
 usr/src/test/smartos-test/smartos-test.sh                     | 4 ++++
 .../test/util-tests/tests/awk/bugs-fixed/system-status.awk    | 2 +-
 usr/src/test/util-tests/tests/awk/bugs-fixed/system-status.ok | 2 +-
 4 files changed, 6 insertions(+), 4 deletions(-)

diff --git a/manifest b/manifest
index 39e3c26ec4..bd07e59fd1 100644
--- a/manifest
+++ b/manifest
@@ -5342,7 +5342,6 @@ f usr/lib/amd64/libsoftcrypto.so.1 0755 root bin
 s usr/lib/amd64/libsoftcrypto.so=libsoftcrypto.so.1
 f usr/lib/amd64/libsrpt.so.1 0755 root bin
 s usr/lib/amd64/libsrpt.so=libsrpt.so.1
-f usr/lib/amd64/libstanddisasm.so 0644 root bin
 f usr/lib/amd64/libstmf.so.1 0755 root bin
 s usr/lib/amd64/libstmf.so=libstmf.so.1
 f usr/lib/amd64/libstmfproxy.so.1 0755 root bin
@@ -6856,7 +6855,6 @@ f usr/lib/libsoftcrypto.so.1 0755 root bin
 s usr/lib/libsoftcrypto.so=libsoftcrypto.so.1
 f usr/lib/libsrpt.so.1 0755 root bin
 s usr/lib/libsrpt.so=libsrpt.so.1
-f usr/lib/libstanddisasm.so 0644 root bin
 f usr/lib/libstmf.so.1 0755 root bin
 s usr/lib/libstmf.so=libstmf.so.1
 f usr/lib/libstmfproxy.so.1 0755 root bin
diff --git a/usr/src/test/smartos-test/smartos-test.sh b/usr/src/test/smartos-test/smartos-test.sh
index 7cc32db76d..d3bc4d1840 100755
--- a/usr/src/test/smartos-test/smartos-test.sh
+++ b/usr/src/test/smartos-test/smartos-test.sh
@@ -264,6 +264,9 @@ function add_test_accounts {
 # By using log_test or log_testrunner, we accumulate the exit codes from each
 # test run to $RESULT.
 #
+# We don't - yet - run net-tests, smbclient-tests, zfs-tests, or the dtrace
+# suite.
+#
 function execute_tests {
 
     log "Starting test runs"
@@ -273,6 +276,7 @@ function execute_tests {
     log_testrunner libc-tests /opt/libc-tests/runfiles/default.run
     log_test vndtest /opt/vndtest/bin/vndtest -a
     log_testrunner util-tests /opt/util-tests/runfiles/default.run
+    log_testrunner os-tests /opt/os-tests/runfiles/default.run
 
     if [[ -n "$FAILED_TESTS" ]]; then
         echo ""
diff --git a/usr/src/test/util-tests/tests/awk/bugs-fixed/system-status.awk b/usr/src/test/util-tests/tests/awk/bugs-fixed/system-status.awk
index 25b92c0492..8c84ff6cfe 100644
--- a/usr/src/test/util-tests/tests/awk/bugs-fixed/system-status.awk
+++ b/usr/src/test/util-tests/tests/awk/bugs-fixed/system-status.awk
@@ -9,7 +9,7 @@ BEGIN {
 	status = system("exit 42")
 	print "normal status", status
 
-	status = system("kill -HUP $$")
+	status = system("kill -KILL $$")
 	print "death by signal status", status
 
 	status = system("cd $WORKDIR && kill -ABRT $$")
diff --git a/usr/src/test/util-tests/tests/awk/bugs-fixed/system-status.ok b/usr/src/test/util-tests/tests/awk/bugs-fixed/system-status.ok
index 737828f5ed..afc0788ce8 100644
--- a/usr/src/test/util-tests/tests/awk/bugs-fixed/system-status.ok
+++ b/usr/src/test/util-tests/tests/awk/bugs-fixed/system-status.ok
@@ -1,3 +1,3 @@
 normal status 42
-death by signal status 257
+death by signal status 265
 death by signal with core dump status 518
-- 
2.17.2 (Apple Git-113)

