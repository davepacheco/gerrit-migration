From 004182a71c4934d928b9ced9a2c2195d9e66da6c Mon Sep 17 00:00:00 2001
From: Alex Wilson <alex.wilson@joyent.com>
Date: Mon, 5 Dec 2016 15:18:04 -0800
Subject: [PATCH] joyent/node-mname#11 name compression offset limits are too
 high

---
 lib/dns-buffer.js | 4 ++--
 package.json      | 2 +-
 2 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/lib/dns-buffer.js b/lib/dns-buffer.js
index 41c0cfd..d048209 100644
--- a/lib/dns-buffer.js
+++ b/lib/dns-buffer.js
@@ -136,7 +136,7 @@ DNSBuffer.prototype.writeName = function (name) {
         var rlen;
         while (rparts.length > 0) {
                 /* Can only use ptrs to things in the first 0xc000 bytes. */
-                if (this._offset < 0xc000)
+                if (this._offset <= 0x3fff)
                         this._ncache.add(parts, this._offset);
 
                 var part = rparts.shift();
@@ -150,7 +150,7 @@ DNSBuffer.prototype.writeName = function (name) {
         }
 
         if (suffix.offset !== undefined) {
-                assert.ok(suffix.offset < 0xc000);
+                assert.ok(suffix.offset <= 0x3fff);
 
                 var ptr = suffix.offset & 0xff;
                 rlen = NAME_PTR | ((suffix.offset & 0x3f00) >> 8);
diff --git a/package.json b/package.json
index b0ec040..0025677 100644
--- a/package.json
+++ b/package.json
@@ -1,7 +1,7 @@
 {
   "name": "mname",
   "description": "DNS server library for node.js",
-  "version": "1.3.0",
+  "version": "1.3.1",
   "author": "arekinath <alex@cooperi.net>",
   "contributors": [
     "Mark Cavage",
-- 
2.21.0

