{"project":"joyent/smartos-live","branch":"master","id":"I0308c8680915823a54bf911a69385020143ee8cb","number":"4834","subject":"TRITON-770 Fix refreservation tests for kvm broken by TRITON-591 Reviewed by: Dave Eddy \u003cdave.eddy@joyent.com\u003e Approved by: Dave Eddy \u003cdave.eddy@joyent.com\u003e","owner":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"url":"https://cr.joyent.us/4834","commitMessage":"TRITON-770 Fix refreservation tests for kvm broken by TRITON-591\nReviewed by: Dave Eddy \u003cdave.eddy@joyent.com\u003e\nApproved by: Dave Eddy \u003cdave.eddy@joyent.com\u003e\n","createdOn":1536859129,"lastUpdated":1537282595,"open":false,"status":"MERGED","comments":[{"timestamp":1536859129,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 1."},{"timestamp":1536859135,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit 0ebf8c4582e7d88bf6e08e3486e5b52cddf87b8d\n    \n    TRITON-770 Fix refreservation tests for kvm broken by TRITON-591"},{"timestamp":1536859182,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1536873845,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 1:\n\n(2 comments)"},{"timestamp":1536933701,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 2."},{"timestamp":1536933709,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit 51a452779e52e62143f623bbe04127c440db3434\n    \n    TRITON-770 Fix refreservation tests for kvm broken by TRITON-591"},{"timestamp":1536933734,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 1:\n\n(2 comments)\n\nDone with the suggested changes Dave, thanks for taking a look!"},{"timestamp":1536933751,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1536957061,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 2: Code-Review+1"},{"timestamp":1537200923,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 2: Code-Review+1"},{"timestamp":1537203779,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 3."},{"timestamp":1537203819,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing-1\n\n\"make check\" exited with status 2\n\n /tmp/repo/src/vm/tests/test-reboot.js\n /tmp/repo/src/vm/tests/test-reprovision.js\n /tmp/repo/src/vm/tests/test-snapshots.js\n /tmp/repo/src/vm/tests/test-spoof-opts.js\n /tmp/repo/src/vm/tests/test-tmpfs.js\n /tmp/repo/src/vm/tests/test-update.js\n /tmp/repo/src/vm/tests/test-vrrp-nics.js\n /tmp/repo/src/vm/lib/metadata/agent.js\n /tmp/repo/src/vm/lib/metadata/common.js\n /tmp/repo/src/vm/lib/metadata/crc32.js\n /tmp/repo/src/vm/lib/metadata/zwatch.js\n /tmp/repo/src/disklayout.js\n /tmp/repo/src/mkzpool.js\n /tmp/repo/src/ntp_config.js\n /tmp/repo/src/node_modules/disklayout.js\n \n 0 error(s), 0 warnings(s)\n \n \u003d\u003d\u003e Running jsstyle...\n (for file in filewait.js node_modules/{system,onlyif,net-boot-config}.js net-boot-config vm/sbin/*.js vm/node_modules/dladm.js vm/node_modules/expander.js vm/node_modules/hrtime.js vm/node_modules/ip.js vm/node_modules/nic.js vm/node_modules/proptable.js vm/node_modules/utils.js vm/node_modules/VM.js vm/node_modules/qmp.js vm/node_modules/openonerrlogger.js vm/node_modules/vmload/*.js vm/node_modules/sysevent-stream.js vm/node_modules/zonecfg.js img/lib/*.js img/sbin/imgadm vm/common/nictag.js vm/tests/test-alias.js vm/tests/test-cleanup-on-failure.js vm/tests/test-create.js vm/tests/test-create-filesystems.js vm/tests/test-docker.js vm/tests/test-defaults.js vm/tests/test-hrtime.js vm/tests/test-indestructible.js vm/tests/test-internal_metadata_namespaces.js vm/tests/test-lastexited.js vm/tests/test-openonerrlogger.js vm/tests/test-reboot.js vm/tests/test-reprovision.js vm/tests/test-snapshots.js vm/tests/test-spoof-opts.js vm/tests/test-tmpfs.js vm/tests/test-update.js vm/tests/test-vrrp-nics.js vm/lib/metadata/*.js; do \\\n \techo /tmp/repo/src/$file; \\\n \t/tmp/repo/src/../tools/jsstyle/jsstyle -o indent\u003d4,strict-indent\u003d1,doxygen,unparenthesized-return\u003d0,continuation-at-front\u003d1,leading-right-paren-ok\u003d1 $file; \\\n \t[[ $? \u003d\u003d \"0\" ]] || exit 1; \\\n done)\n /tmp/repo/src/filewait.js\n /tmp/repo/src/node_modules/system.js\n /tmp/repo/src/node_modules/onlyif.js\n /tmp/repo/src/node_modules/net-boot-config.js\n /tmp/repo/src/net-boot-config\n /tmp/repo/src/vm/sbin/add-userscript.js\n /tmp/repo/src/vm/sbin/metadata.js\n /tmp/repo/src/vm/sbin/vmadm.js\n /tmp/repo/src/vm/sbin/vmadmd.js\n /tmp/repo/src/vm/sbin/vmdf.js\n /tmp/repo/src/vm/node_modules/dladm.js\n /tmp/repo/src/vm/node_modules/expander.js\n /tmp/repo/src/vm/node_modules/hrtime.js\n /tmp/repo/src/vm/node_modules/ip.js\n /tmp/repo/src/vm/node_modules/nic.js\n /tmp/repo/src/vm/node_modules/proptable.js\n /tmp/repo/src/vm/node_modules/utils.js\n /tmp/repo/src/vm/node_modules/VM.js\n vm/node_modules/VM.js: 1339: improper continuation\n vm/node_modules/VM.js: 1341: improper continuation\n Makefile:440: recipe for target \u0027check\u0027 failed\n make[1]: *** [check] Error 1\n make[1]: Leaving directory \u0027/tmp/repo/src\u0027\n Makefile:364: recipe for target \u0027check\u0027 failed\n gmake: *** [check] Error 2"},{"timestamp":1537204021,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 4."},{"timestamp":1537204026,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 4:\n\nNew commits:\n    \n    commit 2fbec4db53a9e8e26ab140af3e9b3824abe727e8\n    \n    TRITON-770 Fix refreservation tests for kvm broken by TRITON-591"},{"timestamp":1537204059,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing-1\n\n\"make check\" exited with status 2\n\n /tmp/repo/src/vm/tests/test-openonerrlogger.js\n /tmp/repo/src/vm/tests/test-reboot.js\n /tmp/repo/src/vm/tests/test-reprovision.js\n /tmp/repo/src/vm/tests/test-snapshots.js\n /tmp/repo/src/vm/tests/test-spoof-opts.js\n /tmp/repo/src/vm/tests/test-tmpfs.js\n /tmp/repo/src/vm/tests/test-update.js\n /tmp/repo/src/vm/tests/test-vrrp-nics.js\n /tmp/repo/src/vm/lib/metadata/agent.js\n /tmp/repo/src/vm/lib/metadata/common.js\n /tmp/repo/src/vm/lib/metadata/crc32.js\n /tmp/repo/src/vm/lib/metadata/zwatch.js\n /tmp/repo/src/disklayout.js\n /tmp/repo/src/mkzpool.js\n /tmp/repo/src/ntp_config.js\n /tmp/repo/src/node_modules/disklayout.js\n \n 0 error(s), 0 warnings(s)\n \n \u003d\u003d\u003e Running jsstyle...\n (for file in filewait.js node_modules/{system,onlyif,net-boot-config}.js net-boot-config vm/sbin/*.js vm/node_modules/dladm.js vm/node_modules/expander.js vm/node_modules/hrtime.js vm/node_modules/ip.js vm/node_modules/nic.js vm/node_modules/proptable.js vm/node_modules/utils.js vm/node_modules/VM.js vm/node_modules/qmp.js vm/node_modules/openonerrlogger.js vm/node_modules/vmload/*.js vm/node_modules/sysevent-stream.js vm/node_modules/zonecfg.js img/lib/*.js img/sbin/imgadm vm/common/nictag.js vm/tests/test-alias.js vm/tests/test-cleanup-on-failure.js vm/tests/test-create.js vm/tests/test-create-filesystems.js vm/tests/test-docker.js vm/tests/test-defaults.js vm/tests/test-hrtime.js vm/tests/test-indestructible.js vm/tests/test-internal_metadata_namespaces.js vm/tests/test-lastexited.js vm/tests/test-openonerrlogger.js vm/tests/test-reboot.js vm/tests/test-reprovision.js vm/tests/test-snapshots.js vm/tests/test-spoof-opts.js vm/tests/test-tmpfs.js vm/tests/test-update.js vm/tests/test-vrrp-nics.js vm/lib/metadata/*.js; do \\\n \techo /tmp/repo/src/$file; \\\n \t/tmp/repo/src/../tools/jsstyle/jsstyle -o indent\u003d4,strict-indent\u003d1,doxygen,unparenthesized-return\u003d0,continuation-at-front\u003d1,leading-right-paren-ok\u003d1 $file; \\\n \t[[ $? \u003d\u003d \"0\" ]] || exit 1; \\\n done)\n /tmp/repo/src/filewait.js\n /tmp/repo/src/node_modules/system.js\n /tmp/repo/src/node_modules/onlyif.js\n /tmp/repo/src/node_modules/net-boot-config.js\n /tmp/repo/src/net-boot-config\n /tmp/repo/src/vm/sbin/add-userscript.js\n /tmp/repo/src/vm/sbin/metadata.js\n /tmp/repo/src/vm/sbin/vmadm.js\n /tmp/repo/src/vm/sbin/vmadmd.js\n /tmp/repo/src/vm/sbin/vmdf.js\n /tmp/repo/src/vm/node_modules/dladm.js\n /tmp/repo/src/vm/node_modules/expander.js\n /tmp/repo/src/vm/node_modules/hrtime.js\n /tmp/repo/src/vm/node_modules/ip.js\n /tmp/repo/src/vm/node_modules/nic.js\n /tmp/repo/src/vm/node_modules/proptable.js\n /tmp/repo/src/vm/node_modules/utils.js\n /tmp/repo/src/vm/node_modules/VM.js\n vm/node_modules/VM.js: 1339: improper continuation\n Makefile:440: recipe for target \u0027check\u0027 failed\n make[1]: *** [check] Error 1\n make[1]: Leaving directory \u0027/tmp/repo/src\u0027\n Makefile:364: recipe for target \u0027check\u0027 failed\n gmake: *** [check] Error 2"},{"timestamp":1537204160,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 5."},{"timestamp":1537204165,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 5:\n\nNew commits:\n    \n    commit b793a643cdb3b6de12b886ca5436279c13c632cd\n    \n    TRITON-770 Fix refreservation tests for kvm broken by TRITON-591"},{"timestamp":1537204206,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1537204822,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 5: Code-Review+1 Integration-Approval+1\n\nI applied this patch onto nightly-3 (vminfod) and both tests passed (`test-send-recv` and `test-create-kvm`)"},{"timestamp":1537205321,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 6: Commit message was updated."},{"timestamp":1537282595,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Pedro Palazón Candel"}],"currentPatchSet":{"number":"6","revision":"0308c8680915823a54bf911a69385020143ee8cb","parents":["8aa883ddc180eeb09ec9ec558c9ce73e0d779bd4"],"ref":"refs/changes/34/4834/6","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1537205321,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1537204206,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1537204822,"by":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1537204822,"by":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"}},{"type":"SUBM","value":"1","grantedOn":1537282595,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"src/vm/node_modules/VM.js","type":"MODIFIED","insertions":2,"deletions":-13},{"file":"src/vm/tests/test-create-kvm.js","type":"MODIFIED","insertions":3,"deletions":-3}],"sizeInsertions":5,"sizeDeletions":-16},"patchSets":[{"number":"1","revision":"80b5dde48ed62c3524683c1b99d1e9a786cdecbd","parents":["8aa883ddc180eeb09ec9ec558c9ce73e0d779bd4"],"ref":"refs/changes/34/4834/1","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1536859129,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1536859182,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"src/vm/tests/test-create-kvm.js","line":1,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"2018"},{"file":"src/vm/tests/test-create-kvm.js","line":1,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"src/vm/tests/test-create-kvm.js","line":298,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"I would update this to `\u003e` as well... in the case of an error that\u0027ll make the output very clear."},{"file":"src/vm/tests/test-create-kvm.js","line":298,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Indeed. Done too."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/vm/tests/test-create-kvm.js","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":2,"sizeDeletions":-2},{"number":"2","revision":"8f17ee28f853982b9bd9448fc7ce926004ae7af7","parents":["8aa883ddc180eeb09ec9ec558c9ce73e0d779bd4"],"ref":"refs/changes/34/4834/2","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1536933701,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1536933751,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1536957061,"by":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1537200923,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/vm/tests/test-create-kvm.js","type":"MODIFIED","insertions":3,"deletions":-3}],"sizeInsertions":3,"sizeDeletions":-3},{"number":"3","revision":"edb79e013dde121a82048157e1a7c66acdd30bed","parents":["8aa883ddc180eeb09ec9ec558c9ce73e0d779bd4"],"ref":"refs/changes/34/4834/3","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1537203779,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1537203819,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"src/vm/node_modules/VM.js","type":"MODIFIED","insertions":4,"deletions":-15},{"file":"src/vm/tests/test-create-kvm.js","type":"MODIFIED","insertions":3,"deletions":-3}],"sizeInsertions":7,"sizeDeletions":-18},{"number":"4","revision":"64abde85c1d3fb961f673c6bb9eb961c74d81866","parents":["8aa883ddc180eeb09ec9ec558c9ce73e0d779bd4"],"ref":"refs/changes/34/4834/4","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1537204021,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1537204059,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/vm/node_modules/VM.js","type":"MODIFIED","insertions":2,"deletions":-13},{"file":"src/vm/tests/test-create-kvm.js","type":"MODIFIED","insertions":3,"deletions":-3}],"sizeInsertions":5,"sizeDeletions":-16},{"number":"5","revision":"fd642bbcc93424e13d024b81dbcb9b91b0cbfe24","parents":["8aa883ddc180eeb09ec9ec558c9ce73e0d779bd4"],"ref":"refs/changes/34/4834/5","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1537204160,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1537204206,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1537204822,"by":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1537204822,"by":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/vm/node_modules/VM.js","type":"MODIFIED","insertions":2,"deletions":-13},{"file":"src/vm/tests/test-create-kvm.js","type":"MODIFIED","insertions":3,"deletions":-3}],"sizeInsertions":5,"sizeDeletions":-16},{"number":"6","revision":"0308c8680915823a54bf911a69385020143ee8cb","parents":["8aa883ddc180eeb09ec9ec558c9ce73e0d779bd4"],"ref":"refs/changes/34/4834/6","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1537205321,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1537204206,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"SUBM","value":"1","grantedOn":1537282595,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1537204822,"by":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1537204822,"by":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"src/vm/node_modules/VM.js","type":"MODIFIED","insertions":2,"deletions":-13},{"file":"src/vm/tests/test-create-kvm.js","type":"MODIFIED","insertions":3,"deletions":-3}],"sizeInsertions":5,"sizeDeletions":-16}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}]}