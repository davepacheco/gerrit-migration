From f71984036139d18d8afb59452ffa16e11ec7c6d3 Mon Sep 17 00:00:00 2001
From: Jerry Jelinek <jerry.jelinek@joyent.com>
Date: Mon, 22 May 2017 18:41:46 +0000
Subject: [PATCH] OS-6141 fix incorrect register usage in xsave_ctxt

---
 usr/src/uts/intel/ia32/ml/float.s | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/usr/src/uts/intel/ia32/ml/float.s b/usr/src/uts/intel/ia32/ml/float.s
index cfc134b219..73c1956054 100644
--- a/usr/src/uts/intel/ia32/ml/float.s
+++ b/usr/src/uts/intel/ia32/ml/float.s
@@ -337,7 +337,7 @@ fpnsave_ctxt(void *arg)
 	 * (see notes above about "exception pointers")
 	 * TODO: does it apply to any machine that uses xsave?
 	 */
-	btw	$7, FXSAVE_STATE_FSW(%rdi)	/* Test saved ES bit */
+	btw	$7, FXSAVE_STATE_FSW(%rsi)	/* Test saved ES bit */
 	jnc	0f				/* jump if ES = 0 */
 	fnclex		/* clear pending x87 exceptions */
 0:	ffree	%st(7)	/* clear tag bit to remove possible stack overflow */
-- 
2.21.0

