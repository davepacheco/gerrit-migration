{"project":"joyent/illumos-joyent","branch":"master","id":"I360e88e03baee24ea9f43d2473d284916741590c","number":"3710","subject":"OS-6810 want problem counters in viona Reviewed by: Ryan Zezeski \u003crpz@joyent.com\u003e Approved by: Bryan Cantrill \u003cbryan@joyent.com\u003e","owner":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"url":"https://cr.joyent.us/3710","commitMessage":"OS-6810 want problem counters in viona\nReviewed by: Ryan Zezeski \u003crpz@joyent.com\u003e\nApproved by: Bryan Cantrill \u003cbryan@joyent.com\u003e\n","createdOn":1521828425,"lastUpdated":1522088174,"open":false,"status":"MERGED","comments":[{"timestamp":1521828425,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 1."},{"timestamp":1521829231,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Patch Set 1:\n\n(6 comments)"},{"timestamp":1521830346,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 1:\n\nAny reason *not* to expose these as kstats? Can be a lot more convenient than walking the sstate etc.\n\nAlso, it seems like with some fairly small massaging, the dtrace probes can be merged to be a single macro that does both?"},{"timestamp":1521830644,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 1:\n\n(2 comments)"},{"timestamp":1521832371,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 1:\n\nWe discussed adding these to kstats in MM chat and decided that it\u0027s something we can follow up on later."},{"timestamp":1521834095,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Patch Set 1: Code-Review+1\n\n(2 comments)"},{"timestamp":1521834347,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1521835765,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 2."},{"timestamp":1521835806,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 3: Patch Set 2 was rebased."},{"timestamp":1521839218,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1522083934,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 4: Patch Set 3 was rebased."},{"timestamp":1522086326,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 4:\n\nBooted up on these bits, the viona stats are visible in mdb:\n\nvr_stats \u003d {\n    vr_stats.rs_ndesc_too_high \u003d 0\n    vr_stats.rs_bad_idx \u003d 0\n    vr_stats.rs_indir_bad_len \u003d 0\n    vr_stats.rs_indir_bad_nest \u003d 0\n    vr_stats.rs_indir_bad_next \u003d 0\n    vr_stats.rs_no_space \u003d 0\n    vr_stats.rs_too_many_desc \u003d 0\n    vr_stats.rs_bad_ring_addr \u003d 0\n    vr_stats.rs_fail_hcksum \u003d 0\n    vr_stats.rs_fail_hcksum6 \u003d 0\n    vr_stats.rs_fail_hcksum_proto \u003d 0\n    vr_stats.rs_bad_rx_frame \u003d 0x11\n    vr_stats.rs_rx_merge_overrun \u003d 0\n    vr_stats.rs_rx_merge_underrun \u003d 0\n    vr_stats.rs_too_short \u003d 0x11\n    vr_stats.rs_tx_absent \u003d 0\n}\n\nIn this case, OS-6815-afflicted short frames are tripping the too_short probe/stat."},{"timestamp":1522087917,"reviewer":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"message":"Patch Set 4: Integration-Approval+1"},{"timestamp":1522088143,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 5: Commit message was updated."},{"timestamp":1522088174,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Patrick Mooney"}],"currentPatchSet":{"number":"5","revision":"360e88e03baee24ea9f43d2473d284916741590c","parents":["85bd3618f496fbfcb9bec6b953b1dd7b26e318ed"],"ref":"refs/changes/10/3710/5","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1522088143,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1521839218,"by":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1522087917,"by":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"}},{"type":"SUBM","value":"1","grantedOn":1522088174,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/uts/i86pc/io/viona/viona.c","type":"MODIFIED","insertions":56,"deletions":-2}],"sizeInsertions":56,"sizeDeletions":-2},"patchSets":[{"number":"1","revision":"fe4755550b5d049dfe629aa1970492169379c577","parents":["7892cb3dceef9f2cbcd853e66fb05601a94bbba2"],"ref":"refs/changes/10/3710/1","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1521828425,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1521834095,"by":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"}}],"comments":[{"file":"usr/src/uts/i86pc/io/viona/viona.c","line":1601,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"I know it would probably be obvious to anyone who works on viona, but I wonder if we could make the stat rx_too_short. That way an operator has a bit more of a clue that the counter refers to an Rx issues. Maybe even rx_pkt_too_short or rx_frame_too_short."},{"file":"usr/src/uts/i86pc/io/viona/viona.c","line":1601,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"None of these are meant to be operator-exposed at this point.  They\u0027re mainly for tracking these problem states in a crash dump (or via mdb -k).  Initially I\u0027ve just duplicated all the probe names, but if we want to circle back to do some renaming, I\u0027d be fine with that."},{"file":"usr/src/uts/i86pc/io/viona/viona.c","line":1601,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Okay. Though not all of the stats match the probename (e.g. merge_overrun). I\u0027ll let you decide if you care or not."},{"file":"usr/src/uts/i86pc/io/viona/viona.c","line":1601,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"I\u0027ll fix the merge_over/underrun so they match.  They should line up with the probes."},{"file":"usr/src/uts/i86pc/io/viona/viona.c","line":1650,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Similar to my other comment: I wonder if we should add \"rx\" in here to give the operator more of a clue."},{"file":"usr/src/uts/i86pc/io/viona/viona.c","line":1743,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"See previous comment on too_short."},{"file":"usr/src/uts/i86pc/io/viona/viona.c","line":1773,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Think about adding the \"rx\" prefix to these stats to match the probes and to give the operator more of a clue."},{"file":"usr/src/uts/i86pc/io/viona/viona.c","line":1995,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Maybe add \"tx\" to these stats?"},{"file":"usr/src/uts/i86pc/io/viona/viona.c","line":2076,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"How is this related to the ticket? Seems like its own thing."},{"file":"usr/src/uts/i86pc/io/viona/viona.c","line":2076,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"It _is_ related to the ticket, so that we have the ring address against which to associate the stats in L1922-L1997"},{"file":"usr/src/uts/i86pc/io/viona/viona.c","line":2076,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Whoops, missed that change to the function prototype."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/i86pc/io/viona/viona.c","type":"MODIFIED","insertions":56,"deletions":-2}],"sizeInsertions":56,"sizeDeletions":-2},{"number":"2","revision":"c363855e0c1044443df03fb7f6ca1bd7817dd881","parents":["7892cb3dceef9f2cbcd853e66fb05601a94bbba2"],"ref":"refs/changes/10/3710/2","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1521835765,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/i86pc/io/viona/viona.c","type":"MODIFIED","insertions":56,"deletions":-2}],"sizeInsertions":56,"sizeDeletions":-2},{"number":"3","revision":"8a85f83445c033534954811c114da419a2ac1da2","parents":["d5eb108ff4a94b03a014e90e6213bf7bf4faa374"],"ref":"refs/changes/10/3710/3","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1521835806,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1521839218,"by":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/i86pc/io/viona/viona.c","type":"MODIFIED","insertions":56,"deletions":-2}],"sizeInsertions":56,"sizeDeletions":-2},{"number":"4","revision":"23ce3bffb6edee277b551dd7d2c95348ed477a90","parents":["85bd3618f496fbfcb9bec6b953b1dd7b26e318ed"],"ref":"refs/changes/10/3710/4","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1522083934,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1522087917,"by":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1521839218,"by":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/i86pc/io/viona/viona.c","type":"MODIFIED","insertions":56,"deletions":-2}],"sizeInsertions":56,"sizeDeletions":-2},{"number":"5","revision":"360e88e03baee24ea9f43d2473d284916741590c","parents":["85bd3618f496fbfcb9bec6b953b1dd7b26e318ed"],"ref":"refs/changes/10/3710/5","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1522088143,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1522087917,"by":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"}},{"type":"SUBM","value":"1","grantedOn":1522088174,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1521839218,"by":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/uts/i86pc/io/viona/viona.c","type":"MODIFIED","insertions":56,"deletions":-2}],"sizeInsertions":56,"sizeDeletions":-2}],"allReviewers":[{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}]}