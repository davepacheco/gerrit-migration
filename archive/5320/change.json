{"project":"joyent/postgres","branch":"joyent/9.6.3","id":"Ifda6203fca5c8a4bd3dda2dc725cf02134e8725e","number":"5320","subject":"MANTA-4053 DMU tx throttling of XLogFileInit() during autovacuum induces extreme outliers Reviewed by: Kody Kantor \u003ckody.kantor@joyent.com\u003e Approved by: Kody Kantor \u003ckody.kantor@joyent.com\u003e","owner":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"url":"https://cr.joyent.us/5320","commitMessage":"MANTA-4053 DMU tx throttling of XLogFileInit() during autovacuum induces extreme outliers\nReviewed by: Kody Kantor \u003ckody.kantor@joyent.com\u003e\nApproved by: Kody Kantor \u003ckody.kantor@joyent.com\u003e\n","createdOn":1546885383,"lastUpdated":1547138569,"open":false,"status":"MERGED","comments":[{"timestamp":1546885383,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 1."},{"timestamp":1546901921,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 1: Code-Review+1\n\n(1 comment)\n\nLooks good to me. Just curious why we need to do the thin provisioning."},{"timestamp":1546950897,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1546977006,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1547137368,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 1: Integration-Approval+1"},{"timestamp":1547138506,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 2: Commit message was updated."},{"timestamp":1547138569,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Jerry Jelinek"}],"currentPatchSet":{"number":"2","revision":"fda6203fca5c8a4bd3dda2dc725cf02134e8725e","parents":["5f50a8f2b09c0e35d72d878c3d498a221aeeb4b8"],"ref":"refs/changes/20/5320/2","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1547138506,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1546901921,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1547137368,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}},{"type":"SUBM","value":"1","grantedOn":1547138569,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"src/backend/access/transam/xlog.c","type":"MODIFIED","insertions":43,"deletions":-23},{"file":"src/backend/utils/misc/guc.c","type":"MODIFIED","insertions":9,"deletions":0},{"file":"src/include/access/xlog.h","type":"MODIFIED","insertions":1,"deletions":0}],"sizeInsertions":53,"sizeDeletions":-23},"patchSets":[{"number":"1","revision":"d64f9a3fd2efda84ab5c9d9644c0d099fb7dc0da","parents":["5f50a8f2b09c0e35d72d878c3d498a221aeeb4b8"],"ref":"refs/changes/20/5320/1","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1546885383,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1546901921,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1547137368,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}}],"comments":[{"file":"src/backend/access/transam/xlog.c","line":3085,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Is running this seek and write necessary on ZFS?\n\nIIUC this is essentially a thin provision, but I don\u0027t understand why we would need to do this. Does PG later iterate through the file looking for an EOF at XLogSegSize?"},{"file":"src/backend/access/transam/xlog.c","line":3085,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"I don\u0027t know for sure if anything depends on the WAL file size, but I wanted to keep things looking as consistent as possible, just in case. For example, if something later stats the file and expects to see a certain size."},{"file":"src/backend/access/transam/xlog.c","line":3085,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Okay, sounds good to me, thanks for the clarification."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/backend/access/transam/xlog.c","type":"MODIFIED","insertions":43,"deletions":-23},{"file":"src/backend/utils/misc/guc.c","type":"MODIFIED","insertions":9,"deletions":0},{"file":"src/include/access/xlog.h","type":"MODIFIED","insertions":1,"deletions":0}],"sizeInsertions":53,"sizeDeletions":-23},{"number":"2","revision":"fda6203fca5c8a4bd3dda2dc725cf02134e8725e","parents":["5f50a8f2b09c0e35d72d878c3d498a221aeeb4b8"],"ref":"refs/changes/20/5320/2","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1547138506,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"SUBM","value":"1","grantedOn":1547138569,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1546901921,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1547137368,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"src/backend/access/transam/xlog.c","type":"MODIFIED","insertions":43,"deletions":-23},{"file":"src/backend/utils/misc/guc.c","type":"MODIFIED","insertions":9,"deletions":0},{"file":"src/include/access/xlog.h","type":"MODIFIED","insertions":1,"deletions":0}],"sizeInsertions":53,"sizeDeletions":-23}],"allReviewers":[{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}]}