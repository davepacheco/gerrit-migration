commit 3b5d59d938b893c4c1495d97d6b33d97bea53624 (refs/changes/84/584/2)
Author: Trent Mick <trentm@gmail.com>
Date:   2016-10-03T16:53:30-07:00 (3 years ago)
    
    TOOLS-1558 TOOLS-1555 broke sdcnode builds: 'npm install' isn't run, buildEnv changes break on spaces

diff --git a/Makefile b/Makefile
index e5185e6..2c6b520 100644
--- a/Makefile
+++ b/Makefile
@@ -34,6 +34,10 @@ HOST_IMAGE=$(shell mdata-get sdc:image_uuid)
 .PHONY: all
 all: build/src nodes bits
 
+.PHONY: npmdeps
+npmdeps:
+    npm install
+
 build/src:
 	git clone https://github.com/nodejs/node.git build/src
 
@@ -43,7 +47,7 @@ nodesrc: | build/src
 		&& git fetch origin && git pull --rebase origin master
 
 .PHONY: nodes
-nodes: nodesrc
+nodes: nodesrc npmdeps
 	./tools/build-all-nodes $(TOP)/build/nodes $(STAMP) "this.image=='$(HOST_IMAGE)'"
 
 .PHONY: bits
diff --git a/package.json b/package.json
index e5440b3..f639040 100644
--- a/package.json
+++ b/package.json
@@ -1,14 +1,13 @@
 {
   "name": "sdcnode",
   "description": "builds of node for SDC",
-  "version": "1.0.0",
+  "version": "1.0.1",
   "private": true,
   "author": "Joyent",
   "engines": [
-    "node >=0.6.0"
+    "node >=0.10.0"
   ],
   "devDependencies": {
-    "async": "0.1",
     "semver": "5.3.0"
   },
   "license": "MPL-2.0"
diff --git a/tools/build-a-node b/tools/build-a-node
index af9788d..66b68a4 100755
--- a/tools/build-a-node
+++ b/tools/build-a-node
@@ -122,8 +122,11 @@ fi
 ./configure $configureFlags --prefix=$buildDir/node
 
 buildEnv=$(echo "$buildOpts" | json build_env)
-make V=1 CC=$GCC CXX=$GXX $buildEnv
-make V=1 CC=$GCC CXX=$GXX $buildEnv install
+if [[ -n "$buildEnv" ]]; then
+    eval "export $buildEnv"
+fi
+make V=1 CC=$GCC CXX=$GXX
+make V=1 CC=$GCC CXX=$GXX install
 
 # Optionally include GCC runtime libs. If a version of GCC was used to compile
 # node is greater than the version of the GCC runtime libs included in the
