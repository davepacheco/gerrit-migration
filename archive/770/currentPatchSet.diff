From d4e5a330148217cee662f7dc186ec1417bf65907 Mon Sep 17 00:00:00 2001
From: Alex Wilson <alex.wilson@joyent.com>
Date: Mon, 24 Oct 2016 16:25:30 -0700
Subject: [PATCH] joyent/node-cueball#43 want fail fast for retries: Infinity

---
 lib/pool.js  |  1 +
 lib/set.js   |  1 +
 lib/utils.js | 11 ++++++++++-
 package.json |  2 +-
 4 files changed, 13 insertions(+), 2 deletions(-)

diff --git a/lib/pool.js b/lib/pool.js
index fad1a11..9103136 100644
--- a/lib/pool.js
+++ b/lib/pool.js
@@ -72,6 +72,7 @@ function CueBallConnectionPool(options) {
 	mod_assert.optionalNumber(options.defaultPort, 'options.defaultPort');
 
 	mod_assert.object(options.recovery, 'options.recovery');
+	mod_utils.assertRecoverySet(options.recovery);
 	this.p_recovery = options.recovery;
 
 	mod_assert.optionalObject(options.log, 'options.log');
diff --git a/lib/set.js b/lib/set.js
index 5427bc1..734581a 100644
--- a/lib/set.js
+++ b/lib/set.js
@@ -41,6 +41,7 @@ function CueBallConnectionSet(options) {
 	this.cs_resolver = options.resolver;
 
 	mod_assert.object(options.recovery, 'options.recovery');
+	mod_utils.assertRecoverySet(options.recovery);
 	this.cs_recovery = options.recovery;
 
 	mod_assert.optionalObject(options.log, 'options.log');
diff --git a/lib/utils.js b/lib/utils.js
index 74a8133..28ff071 100644
--- a/lib/utils.js
+++ b/lib/utils.js
@@ -9,11 +9,20 @@
 module.exports = {
 	shuffle: shuffle,
 	planRebalance: planRebalance,
-	assertRecovery: assertRecovery
+	assertRecovery: assertRecovery,
+	assertRecoverySet: assertRecoverySet
 };
 
 const mod_assert = require('assert-plus');
 
+function assertRecoverySet(obj) {
+	mod_assert.object(obj, 'recovery');
+	var keys = Object.keys(obj);
+	keys.forEach(function (k) {
+		assertRecovery(obj[k], 'recovery.' + k);
+	});
+}
+
 function assertRecovery(obj, name) {
 	if (name === undefined)
 		name = 'recovery';
diff --git a/package.json b/package.json
index f86c575..f93ec47 100644
--- a/package.json
+++ b/package.json
@@ -1,6 +1,6 @@
 {
   "name": "cueball",
-  "version": "1.1.2",
+  "version": "1.1.3",
   "description": "",
   "main": "lib/index.js",
   "dependencies": {
-- 
2.21.0

