{"project":"joyent/manta-remora","branch":"master","id":"I9e1dc5e3c1aee64a19b61a3b7860644b141518c1","number":"6850","subject":"MANTA-4523 Rebalancer Agent requires uuid to accompany list of tasks when posting an assignment. Reviewed by: Rui Loura \u003crui.loura@joyent.com\u003e Approved by: Rui Loura \u003crui.loura@joyent.com\u003e","owner":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"url":"https://cr.joyent.us/6850","commitMessage":"MANTA-4523 Rebalancer Agent requires uuid to accompany list of tasks when posting an assignment.\nReviewed by: Rui Loura \u003crui.loura@joyent.com\u003e\nApproved by: Rui Loura \u003crui.loura@joyent.com\u003e\n","createdOn":1567142170,"lastUpdated":1567623392,"open":false,"status":"MERGED","comments":[{"timestamp":1567142170,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Uploaded patch set 1."},{"timestamp":1567142254,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing-1\n\n\"make check\" exited with status 2\n\n     Checking bytes v0.4.12\n error: aborting due to previous error\n \n     Checking rand v0.6.5\n error: Could not compile `typenum`.\n warning: build failed, waiting for other jobs to finish...\n error[E0658]: use of unstable library feature \u0027try_from\u0027 (see issue #33417)\n  --\u003e /home/build/.cargo/registry/src/github.com-1ecc6299db9ec823/miniz_oxide-0.3.2/src/deflate/core.rs:3:5\n   |\n 3 | use std::convert::TryInto;\n   |     ^^^^^^^^^^^^^^^^^^^^^\n \n error[E0658]: use of unstable library feature \u0027try_from\u0027 (see issue #33417)\n  --\u003e /home/build/.cargo/registry/src/github.com-1ecc6299db9ec823/miniz_oxide-0.3.2/src/inflate/core.rs:6:5\n   |\n 6 | use std::convert::TryInto;\n   |     ^^^^^^^^^^^^^^^^^^^^^\n \n error[E0658]: use of unstable library feature \u0027try_from\u0027 (see issue #33417)\n     --\u003e /home/build/.cargo/registry/src/github.com-1ecc6299db9ec823/miniz_oxide-0.3.2/src/deflate/core.rs:1124:52\n      |\n 1124 |         let bytes: [u8; 4] \u003d self.b.dict[pos..end].try_into().unwrap();\n      |                                                    ^^^^^^^^\n \n error[E0658]: use of unstable library feature \u0027try_from\u0027 (see issue #33417)\n     --\u003e /home/build/.cargo/registry/src/github.com-1ecc6299db9ec823/miniz_oxide-0.3.2/src/deflate/core.rs:1133:56\n      |\n 1133 |         let bytes: [u8; 8] \u003d self.b.dict[pos..pos + 8].try_into().unwrap();\n      |                                                        ^^^^^^^^\n \n error[E0658]: use of unstable library feature \u0027try_from\u0027 (see issue #33417)\n    --\u003e /home/build/.cargo/registry/src/github.com-1ecc6299db9ec823/miniz_oxide-0.3.2/src/inflate/core.rs:342:44\n     |\n 342 |         let two_bytes \u003d iter.as_ref()[..2].try_into().unwrap();\n     |                                            ^^^^^^^^\n \n error[E0658]: use of unstable library feature \u0027try_from\u0027 (see issue #33417)\n    --\u003e /home/build/.cargo/registry/src/github.com-1ecc6299db9ec823/miniz_oxide-0.3.2/src/inflate/core.rs:357:54\n     |\n 357 |         let four_bytes: [u8; 4] \u003d iter.as_ref()[..4].try_into().unwrap();\n     |                                                      ^^^^^^^^\n \n error: aborting due to 6 previous errors\n \n For more information about this error, try `rustc --explain E0658`.\n error: Could not compile `miniz_oxide`.\n warning: build failed, waiting for other jobs to finish...\n error: build failed\n gmake: *** [Makefile:12: check] Error 101"},{"timestamp":1567143212,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Uploaded patch set 2."},{"timestamp":1567143306,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing-1\n\n\"make check\" exited with status 2\n\n \n     Checking futures-cpupool v0.1.8\n error: aborting due to previous error\n \n error: Could not compile `typenum`.\n warning: build failed, waiting for other jobs to finish...\n error[E0658]: use of unstable library feature \u0027try_from\u0027 (see issue #33417)\n  --\u003e /home/build/.cargo/registry/src/github.com-1ecc6299db9ec823/miniz_oxide-0.3.2/src/deflate/core.rs:3:5\n   |\n 3 | use std::convert::TryInto;\n   |     ^^^^^^^^^^^^^^^^^^^^^\n \n error[E0658]: use of unstable library feature \u0027try_from\u0027 (see issue #33417)\n  --\u003e /home/build/.cargo/registry/src/github.com-1ecc6299db9ec823/miniz_oxide-0.3.2/src/inflate/core.rs:6:5\n   |\n 6 | use std::convert::TryInto;\n   |     ^^^^^^^^^^^^^^^^^^^^^\n \n error[E0658]: use of unstable library feature \u0027try_from\u0027 (see issue #33417)\n     --\u003e /home/build/.cargo/registry/src/github.com-1ecc6299db9ec823/miniz_oxide-0.3.2/src/deflate/core.rs:1124:52\n      |\n 1124 |         let bytes: [u8; 4] \u003d self.b.dict[pos..end].try_into().unwrap();\n      |                                                    ^^^^^^^^\n \n error[E0658]: use of unstable library feature \u0027try_from\u0027 (see issue #33417)\n     --\u003e /home/build/.cargo/registry/src/github.com-1ecc6299db9ec823/miniz_oxide-0.3.2/src/deflate/core.rs:1133:56\n      |\n 1133 |         let bytes: [u8; 8] \u003d self.b.dict[pos..pos + 8].try_into().unwrap();\n      |                                                        ^^^^^^^^\n \n error[E0658]: use of unstable library feature \u0027try_from\u0027 (see issue #33417)\n    --\u003e /home/build/.cargo/registry/src/github.com-1ecc6299db9ec823/miniz_oxide-0.3.2/src/inflate/core.rs:342:44\n     |\n 342 |         let two_bytes \u003d iter.as_ref()[..2].try_into().unwrap();\n     |                                            ^^^^^^^^\n \n error[E0658]: use of unstable library feature \u0027try_from\u0027 (see issue #33417)\n    --\u003e /home/build/.cargo/registry/src/github.com-1ecc6299db9ec823/miniz_oxide-0.3.2/src/inflate/core.rs:357:54\n     |\n 357 |         let four_bytes: [u8; 4] \u003d iter.as_ref()[..4].try_into().unwrap();\n     |                                                      ^^^^^^^^\n \n error: aborting due to 6 previous errors\n \n For more information about this error, try `rustc --explain E0658`.\n error: Could not compile `miniz_oxide`.\n warning: build failed, waiting for other jobs to finish...\n error: build failed\n gmake: *** [Makefile:12: check] Error 101"},{"timestamp":1567524228,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1567528733,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1567533888,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Patch Set 2:\n\n\u003e (1 comment)\n\nI poked around a little bit at the kinds of things that can be done with the Chunk data type and with your suggestion, I think we can eliminate that line entirely going straight to something like this:\n\n    let v: Value \u003d match serde_json::from_slice(\u0026body.to_vec()) {\n        Ok(v) \u003d\u003e v,\n        Err(e) \u003d\u003e return Err(format!(\"Failed to deserialize: {}\", e)),\n    };\n\nUsing this approach, it looks like we no longer need:\n\nlet data \u003d String::from_utf8(body.to_vec()).unwrap();\n\nAs far as using AssignmentPayload goes, it would probably make things a little easier on my end to have that too as opposed to working with a typeless JSON object.  It looks like this is not something that is part of the current code base yet.  I can add it in to mine if you don\u0027t mind dealing with some kind of collision when you go to push.  Alternatively, since what I have works, we could leave it this way and replace it with the AssignmentPayload structure once you\u0027ve integrated your change.  I suspect that this will  be ready to go in before yours though."},{"timestamp":1567534798,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Uploaded patch set 3."},{"timestamp":1567534904,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing-1\n\n\"make check\" exited with status 2\n\n \n     Checking bytes v0.4.12\n error: aborting due to previous error\n \n error: Could not compile `typenum`.\n warning: build failed, waiting for other jobs to finish...\n error[E0658]: use of unstable library feature \u0027try_from\u0027 (see issue #33417)\n  --\u003e /home/build/.cargo/registry/src/github.com-1ecc6299db9ec823/miniz_oxide-0.3.2/src/deflate/core.rs:3:5\n   |\n 3 | use std::convert::TryInto;\n   |     ^^^^^^^^^^^^^^^^^^^^^\n \n error[E0658]: use of unstable library feature \u0027try_from\u0027 (see issue #33417)\n  --\u003e /home/build/.cargo/registry/src/github.com-1ecc6299db9ec823/miniz_oxide-0.3.2/src/inflate/core.rs:6:5\n   |\n 6 | use std::convert::TryInto;\n   |     ^^^^^^^^^^^^^^^^^^^^^\n \n error[E0658]: use of unstable library feature \u0027try_from\u0027 (see issue #33417)\n     --\u003e /home/build/.cargo/registry/src/github.com-1ecc6299db9ec823/miniz_oxide-0.3.2/src/deflate/core.rs:1124:52\n      |\n 1124 |         let bytes: [u8; 4] \u003d self.b.dict[pos..end].try_into().unwrap();\n      |                                                    ^^^^^^^^\n \n error[E0658]: use of unstable library feature \u0027try_from\u0027 (see issue #33417)\n     --\u003e /home/build/.cargo/registry/src/github.com-1ecc6299db9ec823/miniz_oxide-0.3.2/src/deflate/core.rs:1133:56\n      |\n 1133 |         let bytes: [u8; 8] \u003d self.b.dict[pos..pos + 8].try_into().unwrap();\n      |                                                        ^^^^^^^^\n \n error[E0658]: use of unstable library feature \u0027try_from\u0027 (see issue #33417)\n    --\u003e /home/build/.cargo/registry/src/github.com-1ecc6299db9ec823/miniz_oxide-0.3.2/src/inflate/core.rs:342:44\n     |\n 342 |         let two_bytes \u003d iter.as_ref()[..2].try_into().unwrap();\n     |                                            ^^^^^^^^\n \n error[E0658]: use of unstable library feature \u0027try_from\u0027 (see issue #33417)\n    --\u003e /home/build/.cargo/registry/src/github.com-1ecc6299db9ec823/miniz_oxide-0.3.2/src/inflate/core.rs:357:54\n     |\n 357 |         let four_bytes: [u8; 4] \u003d iter.as_ref()[..4].try_into().unwrap();\n     |                                                      ^^^^^^^^\n \n error: aborting due to 6 previous errors\n \n For more information about this error, try `rustc --explain E0658`.\n error: Could not compile `miniz_oxide`.\n warning: build failed, waiting for other jobs to finish...\n error: build failed\n gmake: *** [Makefile:12: check] Error 101"},{"timestamp":1567535831,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Patch Set 3:\n\n(1 comment)\n\nUgh... Looks like I didn\u0027t click \"post\" for this comment. \n\nRegardless, I\u0027m ok dealing with collision. I think I put it in job/mod.rs thinking we\u0027d both probably use it."},{"timestamp":1567550383,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Uploaded patch set 4."},{"timestamp":1567550469,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing-1\n\n\"make check\" exited with status 2\n\n     Checking base64 v0.10.1\n    Compiling unicase v2.5.1\n error: aborting due to previous error\n \n error: Could not compile `typenum`.\n warning: build failed, waiting for other jobs to finish...\n error[E0658]: use of unstable library feature \u0027try_from\u0027 (see issue #33417)\n  --\u003e /home/build/.cargo/registry/src/github.com-1ecc6299db9ec823/miniz_oxide-0.3.2/src/deflate/core.rs:3:5\n   |\n 3 | use std::convert::TryInto;\n   |     ^^^^^^^^^^^^^^^^^^^^^\n \n error[E0658]: use of unstable library feature \u0027try_from\u0027 (see issue #33417)\n  --\u003e /home/build/.cargo/registry/src/github.com-1ecc6299db9ec823/miniz_oxide-0.3.2/src/inflate/core.rs:6:5\n   |\n 6 | use std::convert::TryInto;\n   |     ^^^^^^^^^^^^^^^^^^^^^\n \n error[E0658]: use of unstable library feature \u0027try_from\u0027 (see issue #33417)\n     --\u003e /home/build/.cargo/registry/src/github.com-1ecc6299db9ec823/miniz_oxide-0.3.2/src/deflate/core.rs:1124:52\n      |\n 1124 |         let bytes: [u8; 4] \u003d self.b.dict[pos..end].try_into().unwrap();\n      |                                                    ^^^^^^^^\n \n error[E0658]: use of unstable library feature \u0027try_from\u0027 (see issue #33417)\n     --\u003e /home/build/.cargo/registry/src/github.com-1ecc6299db9ec823/miniz_oxide-0.3.2/src/deflate/core.rs:1133:56\n      |\n 1133 |         let bytes: [u8; 8] \u003d self.b.dict[pos..pos + 8].try_into().unwrap();\n      |                                                        ^^^^^^^^\n \n error[E0658]: use of unstable library feature \u0027try_from\u0027 (see issue #33417)\n    --\u003e /home/build/.cargo/registry/src/github.com-1ecc6299db9ec823/miniz_oxide-0.3.2/src/inflate/core.rs:342:44\n     |\n 342 |         let two_bytes \u003d iter.as_ref()[..2].try_into().unwrap();\n     |                                            ^^^^^^^^\n \n error[E0658]: use of unstable library feature \u0027try_from\u0027 (see issue #33417)\n    --\u003e /home/build/.cargo/registry/src/github.com-1ecc6299db9ec823/miniz_oxide-0.3.2/src/inflate/core.rs:357:54\n     |\n 357 |         let four_bytes: [u8; 4] \u003d iter.as_ref()[..4].try_into().unwrap();\n     |                                                      ^^^^^^^^\n \n error: aborting due to 6 previous errors\n \n For more information about this error, try `rustc --explain E0658`.\n error: Could not compile `miniz_oxide`.\n warning: build failed, waiting for other jobs to finish...\n error: build failed\n gmake: *** [Makefile:12: check] Error 101"},{"timestamp":1567550579,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Uploaded patch set 5."},{"timestamp":1567550667,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing-1\n\n\"make check\" exited with status 2\n\n     Checking num-integer v0.1.41\n error: aborting due to previous error\n \n     Checking num-traits v0.1.43\n error: Could not compile `typenum`.\n warning: build failed, waiting for other jobs to finish...\n error[E0658]: use of unstable library feature \u0027try_from\u0027 (see issue #33417)\n  --\u003e /home/build/.cargo/registry/src/github.com-1ecc6299db9ec823/miniz_oxide-0.3.2/src/deflate/core.rs:3:5\n   |\n 3 | use std::convert::TryInto;\n   |     ^^^^^^^^^^^^^^^^^^^^^\n \n error[E0658]: use of unstable library feature \u0027try_from\u0027 (see issue #33417)\n  --\u003e /home/build/.cargo/registry/src/github.com-1ecc6299db9ec823/miniz_oxide-0.3.2/src/inflate/core.rs:6:5\n   |\n 6 | use std::convert::TryInto;\n   |     ^^^^^^^^^^^^^^^^^^^^^\n \n error[E0658]: use of unstable library feature \u0027try_from\u0027 (see issue #33417)\n     --\u003e /home/build/.cargo/registry/src/github.com-1ecc6299db9ec823/miniz_oxide-0.3.2/src/deflate/core.rs:1124:52\n      |\n 1124 |         let bytes: [u8; 4] \u003d self.b.dict[pos..end].try_into().unwrap();\n      |                                                    ^^^^^^^^\n \n error[E0658]: use of unstable library feature \u0027try_from\u0027 (see issue #33417)\n     --\u003e /home/build/.cargo/registry/src/github.com-1ecc6299db9ec823/miniz_oxide-0.3.2/src/deflate/core.rs:1133:56\n      |\n 1133 |         let bytes: [u8; 8] \u003d self.b.dict[pos..pos + 8].try_into().unwrap();\n      |                                                        ^^^^^^^^\n \n error[E0658]: use of unstable library feature \u0027try_from\u0027 (see issue #33417)\n    --\u003e /home/build/.cargo/registry/src/github.com-1ecc6299db9ec823/miniz_oxide-0.3.2/src/inflate/core.rs:342:44\n     |\n 342 |         let two_bytes \u003d iter.as_ref()[..2].try_into().unwrap();\n     |                                            ^^^^^^^^\n \n error[E0658]: use of unstable library feature \u0027try_from\u0027 (see issue #33417)\n    --\u003e /home/build/.cargo/registry/src/github.com-1ecc6299db9ec823/miniz_oxide-0.3.2/src/inflate/core.rs:357:54\n     |\n 357 |         let four_bytes: [u8; 4] \u003d iter.as_ref()[..4].try_into().unwrap();\n     |                                                      ^^^^^^^^\n \n error: aborting due to 6 previous errors\n \n For more information about this error, try `rustc --explain E0658`.\n error: Could not compile `miniz_oxide`.\n warning: build failed, waiting for other jobs to finish...\n error: build failed\n gmake: *** [Makefile:12: check] Error 101"},{"timestamp":1567601093,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Patch Set 5:\n\n(2 comments)"},{"timestamp":1567617619,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Patch Set 5:\n\n(1 comment)"},{"timestamp":1567617793,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Patch Set 5: Code-Review+1 Integration-Approval+1"},{"timestamp":1567618236,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Uploaded patch set 6."},{"timestamp":1567618270,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Patch Set 6:\n\n(1 comment)"},{"timestamp":1567618292,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Patch Set 6: Code-Review+1"},{"timestamp":1567618295,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Patch Set 6: Integration-Approval+1"},{"timestamp":1567618339,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 6: CI-Testing-1\n\n\"make check\" exited with status 2\n\n     Checking threadpool v1.7.1\n     Checking cookie v0.11.1\n error: aborting due to previous error\n \n error: Could not compile `typenum`.\n warning: build failed, waiting for other jobs to finish...\n error[E0658]: use of unstable library feature \u0027try_from\u0027 (see issue #33417)\n  --\u003e /home/build/.cargo/registry/src/github.com-1ecc6299db9ec823/miniz_oxide-0.3.2/src/deflate/core.rs:3:5\n   |\n 3 | use std::convert::TryInto;\n   |     ^^^^^^^^^^^^^^^^^^^^^\n \n error[E0658]: use of unstable library feature \u0027try_from\u0027 (see issue #33417)\n  --\u003e /home/build/.cargo/registry/src/github.com-1ecc6299db9ec823/miniz_oxide-0.3.2/src/inflate/core.rs:6:5\n   |\n 6 | use std::convert::TryInto;\n   |     ^^^^^^^^^^^^^^^^^^^^^\n \n error[E0658]: use of unstable library feature \u0027try_from\u0027 (see issue #33417)\n     --\u003e /home/build/.cargo/registry/src/github.com-1ecc6299db9ec823/miniz_oxide-0.3.2/src/deflate/core.rs:1124:52\n      |\n 1124 |         let bytes: [u8; 4] \u003d self.b.dict[pos..end].try_into().unwrap();\n      |                                                    ^^^^^^^^\n \n error[E0658]: use of unstable library feature \u0027try_from\u0027 (see issue #33417)\n     --\u003e /home/build/.cargo/registry/src/github.com-1ecc6299db9ec823/miniz_oxide-0.3.2/src/deflate/core.rs:1133:56\n      |\n 1133 |         let bytes: [u8; 8] \u003d self.b.dict[pos..pos + 8].try_into().unwrap();\n      |                                                        ^^^^^^^^\n \n error[E0658]: use of unstable library feature \u0027try_from\u0027 (see issue #33417)\n    --\u003e /home/build/.cargo/registry/src/github.com-1ecc6299db9ec823/miniz_oxide-0.3.2/src/inflate/core.rs:342:44\n     |\n 342 |         let two_bytes \u003d iter.as_ref()[..2].try_into().unwrap();\n     |                                            ^^^^^^^^\n \n error[E0658]: use of unstable library feature \u0027try_from\u0027 (see issue #33417)\n    --\u003e /home/build/.cargo/registry/src/github.com-1ecc6299db9ec823/miniz_oxide-0.3.2/src/inflate/core.rs:357:54\n     |\n 357 |         let four_bytes: [u8; 4] \u003d iter.as_ref()[..4].try_into().unwrap();\n     |                                                      ^^^^^^^^\n \n error: aborting due to 6 previous errors\n \n For more information about this error, try `rustc --explain E0658`.\n error: Could not compile `miniz_oxide`.\n warning: build failed, waiting for other jobs to finish...\n error: build failed\n gmake: *** [Makefile:12: check] Error 101"},{"timestamp":1567618410,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Uploaded patch set 7: Commit message was updated."},{"timestamp":1567623392,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Robert Bogart"}],"currentPatchSet":{"number":"7","revision":"9e1dc5e3c1aee64a19b61a3b7860644b141518c1","parents":["05390d63b1fba26a7c5ab0a93af8256aa38fca39"],"ref":"refs/changes/50/6850/7","uploader":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"createdOn":1567618410,"author":{"name":"rhb2","email":"robert.bogart@joyent.com","username":""},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1567618292,"by":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1567618295,"by":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"}},{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1567618339,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"SUBM","value":"1","grantedOn":1567623392,"by":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"src/agent.rs","type":"MODIFIED","insertions":41,"deletions":-16},{"file":"src/jobs/mod.rs","type":"MODIFIED","insertions":13,"deletions":0}],"sizeInsertions":54,"sizeDeletions":-16},"patchSets":[{"number":"1","revision":"ae85376c679c624e3f4176d5733fbfa4452589a9","parents":["05390d63b1fba26a7c5ab0a93af8256aa38fca39"],"ref":"refs/changes/50/6850/1","uploader":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"createdOn":1567142170,"author":{"name":"rhb2","email":"robert.bogart@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1567142254,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/agent.rs","type":"MODIFIED","insertions":52,"deletions":-10}],"sizeInsertions":52,"sizeDeletions":-10},{"number":"2","revision":"ac17b74c385e5d9e365d502bdfeab8d2f34bf1c3","parents":["05390d63b1fba26a7c5ab0a93af8256aa38fca39"],"ref":"refs/changes/50/6850/2","uploader":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"createdOn":1567143212,"author":{"name":"rhb2","email":"robert.bogart@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1567143306,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"src/agent.rs","line":507,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Could we use serde_json::from_slice() here?\n\n   let payload: AssignmentPayload \u003d serde_json::from_slice(\u003c??\u003e)\n\nNot sure if \u003c??\u003e should be body.to_vec(), body.into_bytes() or just body.into().\n\n#[derive(Debug, Clone, Serialize, Deserialize)]\npub struct AssignmentPayload {\n    id: String,\n    tasks: Vec\u003cTask\u003e\n}\n\nI actually created this struct in my wad in job/mod.rs"},{"file":"src/agent.rs","line":507,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"What would that approach (ie from_slice()) get us over what\u0027s currently there?  I didn\u0027t see the AssignmentPayload structure anywhere in the code base when I wrote this.  I\u0027m fine with using it.  Over time, it will be less code if the number of things in the payload increases."},{"file":"src/agent.rs","line":507,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"We wouldn\u0027t have to go from bytes to string to value to tuple.  We could just go from bytes to AssignmentPayload, and return that.\n\nWhat you have is not wrong, but it might just be easier this way.  Again, I\u0027m not 100% sure if Chunk can be passed to from_slice() or what methods might need to be applied to Chunk to make it acceptable for from_slice()."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/agent.rs","type":"MODIFIED","insertions":75,"deletions":-10}],"sizeInsertions":75,"sizeDeletions":-10},{"number":"3","revision":"a7f4f13cd51c1c4cb3a9e9a111f0528bfd1c8f74","parents":["05390d63b1fba26a7c5ab0a93af8256aa38fca39"],"ref":"refs/changes/50/6850/3","uploader":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"createdOn":1567534798,"author":{"name":"rhb2","email":"robert.bogart@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1567534904,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/agent.rs","type":"MODIFIED","insertions":75,"deletions":-12}],"sizeInsertions":75,"sizeDeletions":-12},{"number":"4","revision":"a3666d2998d119b626033a658760d83930b5e558","parents":["05390d63b1fba26a7c5ab0a93af8256aa38fca39"],"ref":"refs/changes/50/6850/4","uploader":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"createdOn":1567550383,"author":{"name":"rhb2","email":"robert.bogart@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1567550469,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/agent.rs","type":"MODIFIED","insertions":44,"deletions":-16},{"file":"src/jobs/mod.rs","type":"MODIFIED","insertions":12,"deletions":0}],"sizeInsertions":56,"sizeDeletions":-16},{"number":"5","revision":"9081ac09594b1ad488adc64398858169a2a9ddf3","parents":["05390d63b1fba26a7c5ab0a93af8256aa38fca39"],"ref":"refs/changes/50/6850/5","uploader":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"createdOn":1567550579,"author":{"name":"rhb2","email":"robert.bogart@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1567550667,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1567617793,"by":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1567617793,"by":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"}}],"comments":[{"file":"src/agent.rs","line":503,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Could this just return an AssignmentPayload?  Then you wouldn\u0027t have to worry about implementing the From trait in jobs/mod.rs.\n\nThen this function could be:\n\n  fn validate_assignment(body: \u0026Chunk) -\u003e Result\u003cAssignmentPayload, String\u003e {\n    serde_json::from_slice::\u003cAssignmentPayload\u003e(\u0026body.to_vec())\n      .map_err(|e| format!(\"Failed to deserialize payload: {}\", e))\n  }"},{"file":"src/agent.rs","line":503,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Of course that is possible, but we\u0027d have to split up the pieces of the payload somewhere else (in this case, the caller).  I knew you\u0027d ask this question and I tried to pre-fetch on that in my comment in 489-495.  The explanation I gave in that comment is the primary motivator.\n\nThe secondary motivation for returning a tuple is to conceal the knowledge and dependence on AssignmentPayload as a data structure to as narrow of a place as possible since we\u0027re really only using it to extract information from a message body and we have other data structures for everything else."},{"file":"src/jobs/mod.rs","line":75,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"nit: insert blank line between blocks"},{"file":"src/jobs/mod.rs","line":75,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/agent.rs","type":"MODIFIED","insertions":41,"deletions":-16},{"file":"src/jobs/mod.rs","type":"MODIFIED","insertions":12,"deletions":0}],"sizeInsertions":53,"sizeDeletions":-16},{"number":"6","revision":"fefae07e79e601db2e2ffd2b20839276e78aa8cb","parents":["05390d63b1fba26a7c5ab0a93af8256aa38fca39"],"ref":"refs/changes/50/6850/6","uploader":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"createdOn":1567618236,"author":{"name":"rhb2","email":"robert.bogart@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1567618339,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1567618292,"by":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1567618295,"by":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/agent.rs","type":"MODIFIED","insertions":41,"deletions":-16},{"file":"src/jobs/mod.rs","type":"MODIFIED","insertions":13,"deletions":0}],"sizeInsertions":54,"sizeDeletions":-16},{"number":"7","revision":"9e1dc5e3c1aee64a19b61a3b7860644b141518c1","parents":["05390d63b1fba26a7c5ab0a93af8256aa38fca39"],"ref":"refs/changes/50/6850/7","uploader":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"createdOn":1567618410,"author":{"name":"rhb2","email":"robert.bogart@joyent.com","username":""},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1567618339,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1567618292,"by":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1567618295,"by":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"}},{"type":"SUBM","value":"1","grantedOn":1567623392,"by":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"src/agent.rs","type":"MODIFIED","insertions":41,"deletions":-16},{"file":"src/jobs/mod.rs","type":"MODIFIED","insertions":13,"deletions":0}],"sizeInsertions":54,"sizeDeletions":-16}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"}]}