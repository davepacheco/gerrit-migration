From 34da8c10a2d0af2de2ac5dd3a829229c9e0fcb0d Mon Sep 17 00:00:00 2001
From: Chris Burroughs <chris.burroughs@joyent.com>
Date: Tue, 9 Jul 2019 15:09:53 -0400
Subject: [PATCH] TRITON-1804 booter's node_module vendoring breaks if "build"
 directory does not exist

---
 Makefile | 7 ++++---
 1 file changed, 4 insertions(+), 3 deletions(-)

diff --git a/Makefile b/Makefile
index efdf2a2..bf5c3aa 100644
--- a/Makefile
+++ b/Makefile
@@ -22,7 +22,7 @@ TOP := $(shell pwd)
 #
 TAPE := ./node_modules/.bin/tape
 ISTANBUL := ./node_modules/.bin/istanbul
-PACK := ./build/pack-0.0.1.tgz
+PACK := ./$(BUILD)/pack-0.0.1.tgz
 
 #
 # Files
@@ -38,7 +38,7 @@ PKG_DIR = $(BUILD)/pkg
 BOOTER_PKG_DIR = $(PKG_DIR)/root/opt/smartdc/booter
 TFTPBOOT_PKG_DIR = $(PKG_DIR)/root/tftpboot/
 RELEASE_TARBALL=dhcpd-pkg-$(STAMP).tar.gz
-CLEAN_FILES += ./node_modules build/pkg $(PACK)
+CLEAN_FILES += ./node_modules $(BUILD)/pkg $(PACK)
 REPO_MODULES := src/node-pack
 JSSTYLE_FLAGS = -o indent=4,doxygen,unparenthesized-return=0
 
@@ -95,7 +95,8 @@ coverage: | $(ISTANBUL) $(TAPE) node_modules
 
 $(PACK):
 	$(NPM) pack file:$(TOP)/src/node-pack
-	mv pack-0.0.1.tgz build/
+	mkdir -p $(TOP)/$(BUILD)
+	mv pack-0.0.1.tgz $(TOP)/$(BUILD)/
 
 #
 # Packaging targets
-- 
2.21.0

