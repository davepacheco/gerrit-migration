{"project":"joyent/illumos-joyent","branch":"vpc","id":"I9dfd8b48e15641cbd518c98d24f1d9df4774b182","number":"3683","subject":"Add dcid property to overlay","owner":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"url":"https://cr.joyent.us/3683","commitMessage":"Add dcid property to overlay\n","createdOn":1521485145,"lastUpdated":1521573604,"open":false,"status":"MERGED","comments":[{"timestamp":1521485145,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Uploaded patch set 1."},{"timestamp":1521486526,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1521489322,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Uploaded patch set 2."},{"timestamp":1521497104,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 2: Code-Review+1 Integration-Approval+1\n\nPer Jason\u0027s request..."},{"timestamp":1521497192,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 2: -Code-Review -Integration-Approval"},{"timestamp":1521507310,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 2:\n\n(4 comments)"},{"timestamp":1521521344,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 2:\n\n(2 comments)"},{"timestamp":1521521349,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Uploaded patch set 3."},{"timestamp":1521556255,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 3: Code-Review+1\n\n(1 comment)"},{"timestamp":1521573588,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Patch Set 3: Code-Review+1 Integration-Approval+1"},{"timestamp":1521573604,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Jason King"}],"currentPatchSet":{"number":"3","revision":"9dfd8b48e15641cbd518c98d24f1d9df4774b182","parents":["613aae8d6b71a4aeca6f1101a0ff305cd0f23a3d"],"ref":"refs/changes/83/3683/3","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1521521349,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1521556255,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1521573588,"by":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1521573588,"by":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"}},{"type":"SUBM","value":"1","grantedOn":1521573604,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/dladm/dladm.c","type":"MODIFIED","insertions":19,"deletions":-5},{"file":"usr/src/lib/libdladm/common/libdloverlay.c","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"usr/src/lib/libdladm/common/libdloverlay.h","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"usr/src/lib/varpd/libvarpd/common/libvarpd.c","type":"MODIFIED","insertions":11,"deletions":-1},{"file":"usr/src/lib/varpd/libvarpd/common/libvarpd_impl.h","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/lib/varpd/libvarpd/common/libvarpd_overlay.c","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"usr/src/lib/varpd/libvarpd/common/libvarpd_persist.c","type":"MODIFIED","insertions":5,"deletions":-3},{"file":"usr/src/lib/varpd/libvarpd/common/libvarpd_provider.h","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/man/man1m/dladm.1m","type":"MODIFIED","insertions":13,"deletions":-3},{"file":"usr/src/uts/common/io/overlay/overlay.c","type":"MODIFIED","insertions":77,"deletions":-4},{"file":"usr/src/uts/common/io/overlay/overlay_target.c","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/common/sys/overlay.h","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/common/sys/overlay_target.h","type":"MODIFIED","insertions":1,"deletions":0}],"sizeInsertions":145,"sizeDeletions":-29},"patchSets":[{"number":"1","revision":"b7c909c5b3ba409c24a834321f87a71b7372e756","parents":["613aae8d6b71a4aeca6f1101a0ff305cd0f23a3d"],"ref":"refs/changes/83/3683/1","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1521485145,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/cmd/dladm/dladm.c","line":9910,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"s/carse/parse"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/dladm/dladm.c","type":"MODIFIED","insertions":17,"deletions":-3},{"file":"usr/src/lib/libdladm/common/libdloverlay.c","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"usr/src/lib/libdladm/common/libdloverlay.h","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"usr/src/lib/varpd/libvarpd/common/libvarpd.c","type":"MODIFIED","insertions":11,"deletions":-1},{"file":"usr/src/lib/varpd/libvarpd/common/libvarpd_impl.h","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/lib/varpd/libvarpd/common/libvarpd_overlay.c","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"usr/src/lib/varpd/libvarpd/common/libvarpd_persist.c","type":"MODIFIED","insertions":5,"deletions":-3},{"file":"usr/src/lib/varpd/libvarpd/common/libvarpd_provider.h","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/man/man1m/dladm.1m","type":"MODIFIED","insertions":13,"deletions":-3},{"file":"usr/src/uts/common/io/overlay/overlay.c","type":"MODIFIED","insertions":77,"deletions":-4},{"file":"usr/src/uts/common/io/overlay/overlay_target.c","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/common/sys/overlay.h","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/sys/overlay_target.h","type":"MODIFIED","insertions":1,"deletions":0}],"sizeInsertions":143,"sizeDeletions":-26},{"number":"2","revision":"88425b209a307844f24c1735f37eab903bc0a19a","parents":["613aae8d6b71a4aeca6f1101a0ff305cd0f23a3d"],"ref":"refs/changes/83/3683/2","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1521489322,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/lib/varpd/libvarpd/common/libvarpd_impl.h","line":80,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Okay, if it lives here (vs. the plugin data), it\u0027s accessible via libvarpd_plugin_dcid().  Gotcha."},{"file":"usr/src/uts/common/io/overlay/overlay.c","line":847,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"There\u0027s an svp/dcid property in libvarpd_svp.c.  Should I get rid of it given it lives here too?  Or feed the kernel\u0027s version?  If the latter, the files plugin would need dcid too."},{"file":"usr/src/uts/common/io/overlay/overlay.c","line":847,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"I\u0027d get rid of the property, but still keep a copy of the value in svp_t (just use the libvarpd function to set it)."},{"file":"usr/src/uts/common/io/overlay/overlay.c","line":847,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Once this goes back I\u0027ll fix svp_t."},{"file":"usr/src/uts/common/io/overlay/overlay.c","line":1908,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"I know this is derived from the vnetid function, but why the constant enter/exits instead of lumping \u0027em all in one enter/exit section?"},{"file":"usr/src/uts/common/io/overlay/overlay.c","line":1908,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"I suspect it\u0027s lock ordering -- the overlay_mux stuff lives separate from any single overlay_dev_t."},{"file":"usr/src/uts/common/sys/overlay.h","line":46,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"We discussed this on ~VPC already... put a uint32_t oic_reserved between dcid and encap."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/dladm/dladm.c","type":"MODIFIED","insertions":17,"deletions":-3},{"file":"usr/src/lib/libdladm/common/libdloverlay.c","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"usr/src/lib/libdladm/common/libdloverlay.h","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"usr/src/lib/varpd/libvarpd/common/libvarpd.c","type":"MODIFIED","insertions":11,"deletions":-1},{"file":"usr/src/lib/varpd/libvarpd/common/libvarpd_impl.h","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/lib/varpd/libvarpd/common/libvarpd_overlay.c","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"usr/src/lib/varpd/libvarpd/common/libvarpd_persist.c","type":"MODIFIED","insertions":5,"deletions":-3},{"file":"usr/src/lib/varpd/libvarpd/common/libvarpd_provider.h","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/man/man1m/dladm.1m","type":"MODIFIED","insertions":13,"deletions":-3},{"file":"usr/src/uts/common/io/overlay/overlay.c","type":"MODIFIED","insertions":77,"deletions":-4},{"file":"usr/src/uts/common/io/overlay/overlay_target.c","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/common/sys/overlay.h","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/sys/overlay_target.h","type":"MODIFIED","insertions":1,"deletions":0}],"sizeInsertions":143,"sizeDeletions":-26},{"number":"3","revision":"9dfd8b48e15641cbd518c98d24f1d9df4774b182","parents":["613aae8d6b71a4aeca6f1101a0ff305cd0f23a3d"],"ref":"refs/changes/83/3683/3","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1521521349,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1521573588,"by":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1521573588,"by":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"}},{"type":"SUBM","value":"1","grantedOn":1521573604,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1521556255,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/dladm/dladm.c","type":"MODIFIED","insertions":19,"deletions":-5},{"file":"usr/src/lib/libdladm/common/libdloverlay.c","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"usr/src/lib/libdladm/common/libdloverlay.h","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"usr/src/lib/varpd/libvarpd/common/libvarpd.c","type":"MODIFIED","insertions":11,"deletions":-1},{"file":"usr/src/lib/varpd/libvarpd/common/libvarpd_impl.h","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/lib/varpd/libvarpd/common/libvarpd_overlay.c","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"usr/src/lib/varpd/libvarpd/common/libvarpd_persist.c","type":"MODIFIED","insertions":5,"deletions":-3},{"file":"usr/src/lib/varpd/libvarpd/common/libvarpd_provider.h","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/man/man1m/dladm.1m","type":"MODIFIED","insertions":13,"deletions":-3},{"file":"usr/src/uts/common/io/overlay/overlay.c","type":"MODIFIED","insertions":77,"deletions":-4},{"file":"usr/src/uts/common/io/overlay/overlay_target.c","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/common/sys/overlay.h","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/common/sys/overlay_target.h","type":"MODIFIED","insertions":1,"deletions":0}],"sizeInsertions":145,"sizeDeletions":-29}],"allReviewers":[{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}]}