From cd172411929a72540ac359d968c3018f7e86b049 Mon Sep 17 00:00:00 2001
From: Robert Mustacchi <rm@joyent.com>
Date: Wed, 29 Jun 2016 17:08:47 +0000
Subject: [PATCH] OS-5492 Tune physical block size for Samsung client SSDs

---
 overlay/generic/kernel/drv/sd.conf | 10 +++++++++-
 1 file changed, 9 insertions(+), 1 deletion(-)

diff --git a/overlay/generic/kernel/drv/sd.conf b/overlay/generic/kernel/drv/sd.conf
index f57fc874..fce0d72c 100644
--- a/overlay/generic/kernel/drv/sd.conf
+++ b/overlay/generic/kernel/drv/sd.conf
@@ -67,8 +67,16 @@ ddi-devid-registrant=1;
 # additional 2 retries for "victim" IOs if a reset is needed.  Retrying is
 # very rarely successful, and it is preferable to let ZFS do it where needed.
 #
+# For the Samsung client drives, users have seen data corruption when they use
+# the advertised 512 byte sectors. The actual sector size of the flash
+# translation layer is 4K, so it's relatively safe to make this change which
+# annecdotally solves that problem.
+#
 sd-config-list=
 	"", "retries-timeout:1,retries-busy:1,retries-reset:1,retries-victim:2",
 	"DELL    PERC H710", "cache-nonvolatile:true",
 	"DELL    PERC H700", "cache-nonvolatile:true",
-	"DELL    PERC/6i", "cache-nonvolatile:true";
+	"DELL    PERC/6i", "cache-nonvolatile:true",
+	"ATA     Samsung SSD 830", "physical-block-size:4096",
+	"ATA     Samsung SSD 840", "physical-block-size:4096",
+	"ATA     Samsung SSD 850", "physical-block-size:4096";
-- 
2.21.0

