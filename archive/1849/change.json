{"project":"joyent/illumos-joyent","branch":"master","id":"I116dc71c1ce421b83a11edca6fe15122f4b49adc","number":"1849","subject":"OS-6064 kernel cpuid support for new processors Reviewed by: Robert Mustacchi \u003crm@joyent.com\u003e Approved by: Robert Mustacchi \u003crm@joyent.com\u003e","owner":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"url":"https://cr.joyent.us/1849","commitMessage":"OS-6064 kernel cpuid support for new processors\nReviewed by: Robert Mustacchi \u003crm@joyent.com\u003e\nApproved by: Robert Mustacchi \u003crm@joyent.com\u003e\n","createdOn":1493236147,"lastUpdated":1493314368,"open":false,"status":"MERGED","comments":[{"timestamp":1493236147,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 1."},{"timestamp":1493254785,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 1:\n\n(4 comments)"},{"timestamp":1493296007,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 1:\n\n(3 comments)\n\nI removed the lx-specific file."},{"timestamp":1493296021,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 2."},{"timestamp":1493309497,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1493310251,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 3."},{"timestamp":1493310335,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1493313703,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 3: Integration-Approval+1"},{"timestamp":1493314286,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 4: Patch Set 3 was rebased."},{"timestamp":1493314346,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 5: Commit message was updated."},{"timestamp":1493314368,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Jerry Jelinek"}],"currentPatchSet":{"number":"5","revision":"116dc71c1ce421b83a11edca6fe15122f4b49adc","parents":["37cab0115ba9ad25a4faa262d56fff4242ef2775"],"ref":"refs/changes/49/1849/5","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1493314346,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1493310335,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1493313703,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"SUBM","value":"1","grantedOn":1493314368,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/uts/i86pc/os/cpuid.c","type":"MODIFIED","insertions":232,"deletions":-9},{"file":"usr/src/uts/intel/sys/fp.h","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"usr/src/uts/intel/sys/x86_archext.h","type":"MODIFIED","insertions":70,"deletions":-4}],"sizeInsertions":309,"sizeDeletions":-14},"patchSets":[{"number":"1","revision":"bd83b2259fa67d0e30ac947ddfa3b3917b9553af","parents":["a7ff345e14ad958016c8d49bdb0d29e53c2ee772"],"ref":"refs/changes/49/1849/1","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1493236147,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/uts/common/brand/lx/procfs/lx_prvnops.c","line":0,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Can we move the lx changes to a separate commit?"},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":1493,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"My read of Intel Volume 1 15.2.1 is that all of the additional AVX512 instruction sets are predicated on the presence of AVX512F and if that\u0027s not there, we shouldn\u0027t be enabling the others."},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":1493,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"I think your reading is correct, but I don\u0027t know how Intel would or could build a CPU which included other AVX512 features without including the foundation. Maybe I am misunderstanding your point here."},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":1493,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I think we still need to only look at saying we detect it if and only if the foundation instructions are present like seen there. I could easily imagine a microcode update or other thing that hides jut the AVX512F and is relying on systems correctly following the guide to not enable the others."},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":1576,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Should this be conditional on xsave_force_disable?"},{"file":"usr/src/uts/i86pc/os/cpuid.c","line":1576,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"done"},{"file":"usr/src/uts/intel/sys/x86_archext.h","line":222,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Caps for the macro"},{"file":"usr/src/uts/intel/sys/x86_archext.h","line":222,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"I had deliberately made that lowercase to distinguish it from a specific flag, but I went ahead and changed it."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/brand/lx/procfs/lx_prvnops.c","type":"MODIFIED","insertions":11,"deletions":-8},{"file":"usr/src/uts/i86pc/os/cpuid.c","type":"MODIFIED","insertions":221,"deletions":-9},{"file":"usr/src/uts/intel/sys/fp.h","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"usr/src/uts/intel/sys/x86_archext.h","type":"MODIFIED","insertions":70,"deletions":-4}],"sizeInsertions":309,"sizeDeletions":-22},{"number":"2","revision":"10ca52daa21a1556175d8dc517f78c1dbc5929d4","parents":["a7ff345e14ad958016c8d49bdb0d29e53c2ee772"],"ref":"refs/changes/49/1849/2","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1493296021,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/i86pc/os/cpuid.c","type":"MODIFIED","insertions":222,"deletions":-9},{"file":"usr/src/uts/intel/sys/fp.h","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"usr/src/uts/intel/sys/x86_archext.h","type":"MODIFIED","insertions":70,"deletions":-4}],"sizeInsertions":299,"sizeDeletions":-14},{"number":"3","revision":"e2442a16b048dc961a516762fd1a6c2dfca81ec5","parents":["a7ff345e14ad958016c8d49bdb0d29e53c2ee772"],"ref":"refs/changes/49/1849/3","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1493310251,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1493310335,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1493313703,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/i86pc/os/cpuid.c","type":"MODIFIED","insertions":232,"deletions":-9},{"file":"usr/src/uts/intel/sys/fp.h","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"usr/src/uts/intel/sys/x86_archext.h","type":"MODIFIED","insertions":70,"deletions":-4}],"sizeInsertions":309,"sizeDeletions":-14},{"number":"4","revision":"71abb861b0c488c32f0075a4072af3b80c75d7c4","parents":["37cab0115ba9ad25a4faa262d56fff4242ef2775"],"ref":"refs/changes/49/1849/4","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1493314286,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1493310335,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1493313703,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/i86pc/os/cpuid.c","type":"MODIFIED","insertions":232,"deletions":-9},{"file":"usr/src/uts/intel/sys/fp.h","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"usr/src/uts/intel/sys/x86_archext.h","type":"MODIFIED","insertions":70,"deletions":-4}],"sizeInsertions":309,"sizeDeletions":-14},{"number":"5","revision":"116dc71c1ce421b83a11edca6fe15122f4b49adc","parents":["37cab0115ba9ad25a4faa262d56fff4242ef2775"],"ref":"refs/changes/49/1849/5","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1493314346,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1493310335,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1493313703,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"SUBM","value":"1","grantedOn":1493314368,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/uts/i86pc/os/cpuid.c","type":"MODIFIED","insertions":232,"deletions":-9},{"file":"usr/src/uts/intel/sys/fp.h","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"usr/src/uts/intel/sys/x86_archext.h","type":"MODIFIED","insertions":70,"deletions":-4}],"sizeInsertions":309,"sizeDeletions":-14}],"allReviewers":[{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}]}