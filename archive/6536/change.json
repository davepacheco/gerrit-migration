{"project":"joyent/triton-cns","branch":"master","id":"Ib3791ed3305f6fd3a8d64e092c9d95f3a16f5e47","number":"6536","subject":"TRITON-1789 cns should automatically publish names for manta_role just like it does for smartdc_role Reviewed by: Alex Wilson \u003calex.wilson@joyent.com\u003e Approved by: Alex Wilson \u003calex.wilson@joyent.com\u003e","owner":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"url":"https://cr.joyent.us/6536","commitMessage":"TRITON-1789 cns should automatically publish names for manta_role just like it does for smartdc_role\nReviewed by: Alex Wilson \u003calex.wilson@joyent.com\u003e\nApproved by: Alex Wilson \u003calex.wilson@joyent.com\u003e\n","createdOn":1562024454,"lastUpdated":1562697492,"open":false,"status":"MERGED","comments":[{"timestamp":1562024454,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Uploaded patch set 1."},{"timestamp":1562024454,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit 5b7e1091d29626a3a5c27efb6baafeda0ad6c900\n    \n    1"},{"timestamp":1562024486,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing-1\n\n\"make check\" exited with status 2\n\n fatal: ref HEAD is not a symbolic ref\n xmllint --noout --path deps/eng/tools/ --dtdvalid deps/eng/tools/service_bundle.dtd.1 smf/manifests/cns-server.xml\n xmllint --noout --path deps/eng/tools/ --dtdvalid deps/eng/tools/service_bundle.dtd.1 smf/manifests/cns-updater.xml\n xmllint --noout --path deps/eng/tools/ --dtdvalid deps/eng/tools/service_bundle.dtd.1 smf/manifests/cns-redis.xml\n deps/javascriptlint/build/install/jsl --nologo --nosummary --conf\u003dtools/jsl.node.conf lib/dns-clients.js lib/cn-filter.js lib/consts.js lib/ufds-filter.js lib/network-info-filter.js lib/config.js lib/cmd-utils.js lib/net-pool-filter.js lib/napi-legacy-filter.js lib/zone-builder.js lib/utils.js lib/dns-server.js lib/net-filter.js lib/update-stream.js lib/changefeed-filter.js lib/ufds-pool.js lib/poller-stream.js lib/reaper-stream.js lib/ufds-watcher.js lib/flag-filter.js lib/api-server.js lib/vm-to-zones.js test/unit/vm-to-zones.test.js test/unit/update-stream.test.js test/unit/mock-redis.js test/unit/dns-server.test.js test/unit/flag-filter.test.js test/unit/test-namer.js test/unit/net-filter.test.js test/unit/utils.test.js test/integration/dummy.test.js server.js updater.js bin/cnsadm\n /tmp/repo/lib/dns-clients.js\n /tmp/repo/lib/cn-filter.js\n /tmp/repo/lib/consts.js\n /tmp/repo/lib/ufds-filter.js\n /tmp/repo/lib/network-info-filter.js\n /tmp/repo/lib/config.js\n /tmp/repo/lib/cmd-utils.js\n /tmp/repo/lib/net-pool-filter.js\n /tmp/repo/lib/napi-legacy-filter.js\n /tmp/repo/lib/zone-builder.js\n /tmp/repo/lib/utils.js\n /tmp/repo/lib/dns-server.js\n /tmp/repo/lib/net-filter.js\n /tmp/repo/lib/update-stream.js\n /tmp/repo/lib/changefeed-filter.js\n /tmp/repo/lib/ufds-pool.js\n /tmp/repo/lib/poller-stream.js\n /tmp/repo/lib/reaper-stream.js\n /tmp/repo/lib/ufds-watcher.js\n /tmp/repo/lib/flag-filter.js\n /tmp/repo/lib/api-server.js\n /tmp/repo/lib/vm-to-zones.js\n /tmp/repo/test/unit/vm-to-zones.test.js\n /tmp/repo/test/unit/update-stream.test.js\n /tmp/repo/test/unit/mock-redis.js\n /tmp/repo/test/unit/dns-server.test.js\n /tmp/repo/test/unit/flag-filter.test.js\n /tmp/repo/test/unit/test-namer.js\n /tmp/repo/test/unit/net-filter.test.js\n /tmp/repo/test/unit/utils.test.js\n /tmp/repo/test/integration/dummy.test.js\n /tmp/repo/server.js\n /tmp/repo/updater.js\n /tmp/repo/bin/cnsadm\n deps/jsstyle/jsstyle -f tools/jsstyle.conf lib/dns-clients.js lib/cn-filter.js lib/consts.js lib/ufds-filter.js lib/network-info-filter.js lib/config.js lib/cmd-utils.js lib/net-pool-filter.js lib/napi-legacy-filter.js lib/zone-builder.js lib/utils.js lib/dns-server.js lib/net-filter.js lib/update-stream.js lib/changefeed-filter.js lib/ufds-pool.js lib/poller-stream.js lib/reaper-stream.js lib/ufds-watcher.js lib/flag-filter.js lib/api-server.js lib/vm-to-zones.js test/unit/vm-to-zones.test.js test/unit/update-stream.test.js test/unit/mock-redis.js test/unit/dns-server.test.js test/unit/flag-filter.test.js test/unit/test-namer.js test/unit/net-filter.test.js test/unit/utils.test.js test/integration/dummy.test.js server.js updater.js bin/cnsadm\n Unescaped left brace in regex is illegal here in regex; marked by \u003c-- HERE in m/\\S{ \u003c-- HERE / at deps/jsstyle/jsstyle line 666.\n gmake: *** [deps/eng/tools/mk/Makefile.targ:264: check-jsstyle] Error 255"},{"timestamp":1562029083,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Uploaded patch set 2: Patch Set 1 was rebased."},{"timestamp":1562029083,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit 2dd0cee1b716fd10705fbb3e51b8f41745155127\n    \n    1"},{"timestamp":1562029118,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1562180182,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Uploaded patch set 3."},{"timestamp":1562180182,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Patch Set 3:\n\nNew commits:\n    \n    commit c13b03b36ed9d257a7f1dcb4cfd18ead9af46797\n    \n    3"},{"timestamp":1562180216,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1562198167,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1562198177,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 3: Integration-Approval+1"},{"timestamp":1562345679,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Uploaded patch set 4."},{"timestamp":1562345679,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Patch Set 4:\n\nNew commits:\n    \n    commit 1fd1be535abfcf2a5c7278e6f78808438f4f4c92\n    \n    should also black list manta network"},{"timestamp":1562345710,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing-1\n\n(1 comment)\n\n\"make check\" exited with status 2"},{"timestamp":1562345910,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Uploaded patch set 5."},{"timestamp":1562345911,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Patch Set 5:\n\nNew commits:\n    \n    commit 07bfeaaff59560ba637b3a638352bfcfa1f3d33f\n    \n    should also black list manta network 2"},{"timestamp":1562345944,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1562349965,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Uploaded patch set 6."},{"timestamp":1562349965,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Patch Set 6:\n\nNew commits:\n    \n    commit 39d8f36fc7988a5ee9fb2b53cec31bce9f77b796\n    \n    updated the wrong npm package"},{"timestamp":1562349999,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 6: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1562350095,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Uploaded patch set 7."},{"timestamp":1562350095,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Patch Set 7:\n\nNew commits:\n    \n    commit 7b36f5df0ba0371930a03142ecf3ee8d5d895de9\n    \n    remove useless jsstyle line"},{"timestamp":1562350128,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 7: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1562618292,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 7:\n\n(1 comment)"},{"timestamp":1562695235,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 7: Code-Review+1"},{"timestamp":1562695960,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 7: Integration-Approval+1"},{"timestamp":1562697451,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Uploaded patch set 8: Commit message was updated."},{"timestamp":1562697492,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Brian Bennett"}],"currentPatchSet":{"number":"8","revision":"b3791ed3305f6fd3a8d64e092c9d95f3a16f5e47","parents":["882d842df9822a6ee68dd8f2cabcdf1cc9898445"],"ref":"refs/changes/36/6536/8","uploader":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"createdOn":1562697451,"author":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1562350128,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1562695235,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1562695960,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"SUBM","value":"1","grantedOn":1562697491,"by":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/flag-filter.js","type":"MODIFIED","insertions":11,"deletions":0},{"file":"lib/net-filter.js","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/unit/flag-filter.test.js","type":"MODIFIED","insertions":64,"deletions":0}],"sizeInsertions":80,"sizeDeletions":-5},"patchSets":[{"number":"1","revision":"aa2980805f9d95accacc5e4a375477e9cf58d347","parents":["7968df721f4186bf564953a20ef76474d9ef2d75"],"ref":"refs/changes/36/6536/1","uploader":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"createdOn":1562024454,"author":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1562024486,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/flag-filter.js","type":"MODIFIED","insertions":11,"deletions":0},{"file":"test/unit/flag-filter.test.js","type":"MODIFIED","insertions":63,"deletions":0}],"sizeInsertions":74,"sizeDeletions":0},{"number":"2","revision":"262078519a2e4b9a3c0c837483c99ed276ef2ba6","parents":["882d842df9822a6ee68dd8f2cabcdf1cc9898445"],"ref":"refs/changes/36/6536/2","uploader":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"createdOn":1562029083,"author":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1562029118,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/flag-filter.js","type":"MODIFIED","insertions":11,"deletions":0},{"file":"test/unit/flag-filter.test.js","type":"MODIFIED","insertions":63,"deletions":0}],"sizeInsertions":74,"sizeDeletions":0},{"number":"3","revision":"5af0b14c96ace9624a66d5c5b020646281866706","parents":["882d842df9822a6ee68dd8f2cabcdf1cc9898445"],"ref":"refs/changes/36/6536/3","uploader":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"createdOn":1562180182,"author":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1562198167,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1562198177,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1562180216,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/flag-filter.js","type":"MODIFIED","insertions":11,"deletions":0},{"file":"test/unit/flag-filter.test.js","type":"MODIFIED","insertions":64,"deletions":0}],"sizeInsertions":75,"sizeDeletions":0},{"number":"4","revision":"2ead37f8f8f6727f1970ae8062636be0fcc03892","parents":["882d842df9822a6ee68dd8f2cabcdf1cc9898445"],"ref":"refs/changes/36/6536/4","uploader":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"createdOn":1562345679,"author":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1562345710,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/net-filter.js","line":56,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"warning: paren_after_cond"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/flag-filter.js","type":"MODIFIED","insertions":11,"deletions":0},{"file":"lib/net-filter.js","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/unit/flag-filter.test.js","type":"MODIFIED","insertions":64,"deletions":0}],"sizeInsertions":80,"sizeDeletions":-5},{"number":"5","revision":"33b2ea9ab975fcd1de347b2973b49587b13c0f23","parents":["882d842df9822a6ee68dd8f2cabcdf1cc9898445"],"ref":"refs/changes/36/6536/5","uploader":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"createdOn":1562345910,"author":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1562345944,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/flag-filter.js","type":"MODIFIED","insertions":11,"deletions":0},{"file":"lib/net-filter.js","type":"MODIFIED","insertions":5,"deletions":-4},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/unit/flag-filter.test.js","type":"MODIFIED","insertions":64,"deletions":0}],"sizeInsertions":81,"sizeDeletions":-5},{"number":"6","revision":"3f9af7feb65015228a9216b110c83369ac537525","parents":["882d842df9822a6ee68dd8f2cabcdf1cc9898445"],"ref":"refs/changes/36/6536/6","uploader":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"createdOn":1562349965,"author":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1562349999,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/flag-filter.js","type":"MODIFIED","insertions":11,"deletions":0},{"file":"lib/net-filter.js","type":"MODIFIED","insertions":5,"deletions":-4},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/unit/flag-filter.test.js","type":"MODIFIED","insertions":64,"deletions":0}],"sizeInsertions":81,"sizeDeletions":-5},{"number":"7","revision":"0011b1488ffdb78b3f6f94a84a4ec712d8f37313","parents":["882d842df9822a6ee68dd8f2cabcdf1cc9898445"],"ref":"refs/changes/36/6536/7","uploader":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"createdOn":1562350095,"author":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1562695235,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1562695960,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1562350128,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/net-filter.js","line":56,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Does isNicManta() check the vlan_id or just the tag?"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/flag-filter.js","type":"MODIFIED","insertions":11,"deletions":0},{"file":"lib/net-filter.js","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/unit/flag-filter.test.js","type":"MODIFIED","insertions":64,"deletions":0}],"sizeInsertions":80,"sizeDeletions":-5},{"number":"8","revision":"b3791ed3305f6fd3a8d64e092c9d95f3a16f5e47","parents":["882d842df9822a6ee68dd8f2cabcdf1cc9898445"],"ref":"refs/changes/36/6536/8","uploader":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"createdOn":1562697451,"author":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1562695235,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1562695960,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1562350128,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"SUBM","value":"1","grantedOn":1562697491,"by":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/flag-filter.js","type":"MODIFIED","insertions":11,"deletions":0},{"file":"lib/net-filter.js","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/unit/flag-filter.test.js","type":"MODIFIED","insertions":64,"deletions":0}],"sizeInsertions":80,"sizeDeletions":-5}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"}]}