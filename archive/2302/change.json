{"project":"joyent/illumos-joyent","branch":"master","id":"Ia9f065e2016c5675e8e95e829bd6bb6440a6f36b","number":"2302","subject":"OS-6257 proc_t changes broke genunix dmods and walker OS-6271 mdb_pid2proc() and consumers should honor return type Reviewed by: Robert Mustacchi \u003crm@joyent.com\u003e Reviewed by: Jason King \u003cjason.king@joyent.com\u003e Approved by: Robert Mustacchi \u003crm@joyent.com\u003e","owner":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"url":"https://cr.joyent.us/2302","commitMessage":"OS-6257 proc_t changes broke genunix dmods and walker\nOS-6271 mdb_pid2proc() and consumers should honor return type\nReviewed by: Robert Mustacchi \u003crm@joyent.com\u003e\nReviewed by: Jason King \u003cjason.king@joyent.com\u003e\nApproved by: Robert Mustacchi \u003crm@joyent.com\u003e\n","createdOn":1501476051,"lastUpdated":1501896670,"open":false,"status":"MERGED","comments":[{"timestamp":1501476051,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Uploaded patch set 1."},{"timestamp":1501514287,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 1:\n\n(2 comments)"},{"timestamp":1501524570,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 1:\n\n(3 comments)\n\nIn addition to the stuff that Jason mentioned, I tried to take a look for other dmods and it looks like the only non-genunix user of the proc walker is in the dtrace dmod and it doesn\u0027t seem to leverage the walk callback value."},{"timestamp":1501539885,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1501679027,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Uploaded patch set 2."},{"timestamp":1501679075,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Patch Set 1:\n\n(5 comments)"},{"timestamp":1501683849,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 2: Code-Review+1\n\n(1 comment)"},{"timestamp":1501795605,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Uploaded patch set 3."},{"timestamp":1501803440,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1501868197,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1501879562,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Uploaded patch set 4."},{"timestamp":1501879606,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 4: Code-Review+1"},{"timestamp":1501879643,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Patch Set 4:\n\nSorry for the additional patch. I forgot to run my 3rd patch thru cstyle."},{"timestamp":1501879745,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 4: Code-Review+1"},{"timestamp":1501880814,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Patch Set 4:\n\nTest notes added to issues."},{"timestamp":1501883344,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 4: Integration-Approval+1"},{"timestamp":1501896541,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Uploaded patch set 5: Patch Set 4 was rebased."},{"timestamp":1501896654,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Uploaded patch set 6: Commit message was updated."},{"timestamp":1501896670,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Ryan Zezeski"}],"currentPatchSet":{"number":"6","revision":"a9f065e2016c5675e8e95e829bd6bb6440a6f36b","parents":["19b397121b32ea668bad14a9e481570668a18a54"],"ref":"refs/changes/02/2302/6","uploader":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"createdOn":1501896654,"author":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1501879606,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1501879745,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1501883344,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"SUBM","value":"1","grantedOn":1501896669,"by":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"usr/src/cmd/mdb/common/modules/dtrace/dtrace.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/cmd/mdb/common/modules/genunix/genunix.c","type":"MODIFIED","insertions":156,"deletions":-46},{"file":"usr/src/cmd/mdb/common/modules/mdb_ks/mdb_ks.c","type":"MODIFIED","insertions":8,"deletions":-7},{"file":"usr/src/cmd/mdb/common/modules/ptm/ptm.c","type":"MODIFIED","insertions":3,"deletions":-4}],"sizeInsertions":169,"sizeDeletions":-59},"patchSets":[{"number":"1","revision":"d01adb82f96f9f213bf272fa5e2308445236f37e","parents":["b4a0b694af35d6c41597f45d411541f6f010f650"],"ref":"refs/changes/02/2302/1","uploader":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"createdOn":1501476051,"author":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/cmd/mdb/common/modules/genunix/genunix.c","line":143,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Random blank?"},{"file":"usr/src/cmd/mdb/common/modules/genunix/genunix.c","line":143,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/cmd/mdb/common/modules/genunix/genunix.c","line":317,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Should we actually be checking the return value here?"},{"file":"usr/src/cmd/mdb/common/modules/genunix/genunix.c","line":317,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/cmd/mdb/common/modules/genunix/genunix.c","line":382,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Shouldn\u0027t we be checking the return value?"},{"file":"usr/src/cmd/mdb/common/modules/genunix/genunix.c","line":382,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/cmd/mdb/common/modules/genunix/genunix.c","line":1943,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Nit: Since uintptr_t is technically defined as an integer type that just happens to be large enough to hold pointer values, should this be \u003d 0?"},{"file":"usr/src/cmd/mdb/common/modules/genunix/genunix.c","line":1943,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"I wanted to use 0 but I noticed that mdb_pid2proc() uses NULL (even though its return type is uintptr_t). I know that NULL is 0 or (void *)0 but I wasn\u0027t sure if I could rely on that in the future so I just went with NULL here. I could change mdb_pid2proc() and all its consumers to use 0 under a separate ticket but include it in this same commit. What do you think?"},{"file":"usr/src/cmd/mdb/common/modules/genunix/genunix.c","line":1943,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"},{"file":"usr/src/cmd/mdb/common/modules/genunix/genunix.c","line":1943,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"I think that\u0027d be fine -- the big thing is ISTR newer versions of GCC getting picky about this, and just wanting to avoid extra work whenever we do make the switch."},{"file":"usr/src/cmd/mdb/common/modules/genunix/genunix.c","line":1956,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Same as above"},{"file":"usr/src/cmd/mdb/common/modules/genunix/genunix.c","line":1956,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/mdb/common/modules/genunix/genunix.c","type":"MODIFIED","insertions":153,"deletions":-44}],"sizeInsertions":153,"sizeDeletions":-44},{"number":"2","revision":"8de1089e0041397d3feb7e9085a4a687fbf2f153","parents":["b4a0b694af35d6c41597f45d411541f6f010f650"],"ref":"refs/changes/02/2302/2","uploader":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"createdOn":1501679027,"author":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1501683849,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/mdb/common/modules/genunix/genunix.c","type":"MODIFIED","insertions":155,"deletions":-45}],"sizeInsertions":155,"sizeDeletions":-45},{"number":"3","revision":"c76a0b473cf43430c6dc4a52b86b0bd536769ee6","parents":["b4a0b694af35d6c41597f45d411541f6f010f650"],"ref":"refs/changes/02/2302/3","uploader":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"createdOn":1501795605,"author":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1501868197,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1501803440,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"usr/src/cmd/mdb/common/modules/dtrace/dtrace.c","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/cmd/mdb/common/modules/genunix/genunix.c","type":"MODIFIED","insertions":156,"deletions":-46},{"file":"usr/src/cmd/mdb/common/modules/mdb_ks/mdb_ks.c","type":"MODIFIED","insertions":7,"deletions":-7},{"file":"usr/src/cmd/mdb/common/modules/ptm/ptm.c","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":166,"sizeDeletions":-56},{"number":"4","revision":"9f535b2ee60e10695b85fa17130721ed4f341210","parents":["b4a0b694af35d6c41597f45d411541f6f010f650"],"ref":"refs/changes/02/2302/4","uploader":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"createdOn":1501879562,"author":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1501879606,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1501883344,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1501879745,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"usr/src/cmd/mdb/common/modules/dtrace/dtrace.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/cmd/mdb/common/modules/genunix/genunix.c","type":"MODIFIED","insertions":156,"deletions":-46},{"file":"usr/src/cmd/mdb/common/modules/mdb_ks/mdb_ks.c","type":"MODIFIED","insertions":8,"deletions":-7},{"file":"usr/src/cmd/mdb/common/modules/ptm/ptm.c","type":"MODIFIED","insertions":3,"deletions":-4}],"sizeInsertions":169,"sizeDeletions":-59},{"number":"5","revision":"fb760da192a7f79d9c3206e26e9f44bd04187b82","parents":["19b397121b32ea668bad14a9e481570668a18a54"],"ref":"refs/changes/02/2302/5","uploader":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"createdOn":1501896541,"author":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1501879606,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1501883344,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1501879745,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"usr/src/cmd/mdb/common/modules/dtrace/dtrace.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/cmd/mdb/common/modules/genunix/genunix.c","type":"MODIFIED","insertions":156,"deletions":-46},{"file":"usr/src/cmd/mdb/common/modules/mdb_ks/mdb_ks.c","type":"MODIFIED","insertions":8,"deletions":-7},{"file":"usr/src/cmd/mdb/common/modules/ptm/ptm.c","type":"MODIFIED","insertions":3,"deletions":-4}],"sizeInsertions":169,"sizeDeletions":-59},{"number":"6","revision":"a9f065e2016c5675e8e95e829bd6bb6440a6f36b","parents":["19b397121b32ea668bad14a9e481570668a18a54"],"ref":"refs/changes/02/2302/6","uploader":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"createdOn":1501896654,"author":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1501879606,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1501883344,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"SUBM","value":"1","grantedOn":1501896669,"by":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1501879745,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"usr/src/cmd/mdb/common/modules/dtrace/dtrace.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/cmd/mdb/common/modules/genunix/genunix.c","type":"MODIFIED","insertions":156,"deletions":-46},{"file":"usr/src/cmd/mdb/common/modules/mdb_ks/mdb_ks.c","type":"MODIFIED","insertions":8,"deletions":-7},{"file":"usr/src/cmd/mdb/common/modules/ptm/ptm.c","type":"MODIFIED","insertions":3,"deletions":-4}],"sizeInsertions":169,"sizeDeletions":-59}],"allReviewers":[{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"}]}