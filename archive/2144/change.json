{"project":"joyent/sdc-docker","branch":"master","id":"Ief3291aae7eecd6d0e763757fbc540fa040ec588","number":"2144","subject":"DOCKER-1072 Work around OS-6193 in tools/check-docs.sh Reviewed by: Dave Eddy \u003cdave@daveeddy.com\u003e Reviewed by: Trent Mick \u003ctrent.mick@joyent.com\u003e Approved by: Trent Mick \u003ctrent.mick@joyent.com\u003e","owner":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"url":"https://cr.joyent.us/2144","commitMessage":"DOCKER-1072 Work around OS-6193 in tools/check-docs.sh\nReviewed by: Dave Eddy \u003cdave@daveeddy.com\u003e\nReviewed by: Trent Mick \u003ctrent.mick@joyent.com\u003e\nApproved by: Trent Mick \u003ctrent.mick@joyent.com\u003e\n","createdOn":1498242500,"lastUpdated":1498515775,"open":false,"status":"MERGED","comments":[{"timestamp":1498242500,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 1."},{"timestamp":1498250886,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1498252420,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 1:\n\n(2 comments)"},{"timestamp":1498253848,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 2."},{"timestamp":1498253886,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1498254288,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 2: Code-Review+1 Integration-Approval+1"},{"timestamp":1498255664,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 3: Commit message was updated."},{"timestamp":1498255673,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 4: Patch Set 3 was rebased"},{"timestamp":1498255704,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4:\n\n\"make check\" passed ok"},{"timestamp":1498496632,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 4:\n\n(1 comment)"},{"timestamp":1498513745,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 5."},{"timestamp":1498513777,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1498514087,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 6: Commit message was updated."},{"timestamp":1498514457,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 5:\n\n(2 comments)"},{"timestamp":1498514681,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 7."},{"timestamp":1498514702,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 7:\n\n(2 comments)"},{"timestamp":1498514723,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 7: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1498515303,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 8."},{"timestamp":1498515339,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 8: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1498515594,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 7: Code-Review+1 Integration-Approval+1"},{"timestamp":1498515601,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 8: Code-Review+1 Integration-Approval+1\n\nthanks for documenting everything as well"},{"timestamp":1498515603,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 8: Code-Review+1 Integration-Approval+1"},{"timestamp":1498515738,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 9: Patch Set 8 was rebased"},{"timestamp":1498515741,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Cody Peter Mello"},{"timestamp":1498515775,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 9:\n\n\"make check\" passed ok"}],"currentPatchSet":{"number":"9","revision":"f91ef9328c48ba9dfb5b81a2c46f8c48b25fdaa1","parents":["524e07aabc9e93e908327d87bda471fdd6698600"],"ref":"refs/changes/44/2144/9","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1498515738,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1498515339,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1498515601,"by":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1498515601,"by":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1498515603,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1498515603,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1498515741,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"deps/javascriptlint","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"tools/check-docs.sh","type":"MODIFIED","insertions":12,"deletions":-7}],"sizeInsertions":13,"sizeDeletions":-8},"patchSets":[{"number":"1","revision":"e66337bfd7a26db2e223ddf11635bc333f66bdd0","parents":["5985176520a9f54f7ffc7898b87d13b430d4e425"],"ref":"refs/changes/44/2144/1","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1498242500,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1498250886,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"tools/check-docs.sh","line":39,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"I\u0027ve had to write a pre-commit check that was similar to this, and found that you pretty much have to rely on non-bash-builtin tools to do this.  You can cut out the call to `head`, `od`, and `awk` completely by using `tail` and `tr`, which have **fairly** standard invocations across unixes in my experience.\n\n\n $ ends-in-newline() { [[ $(tr -d \u0027 \u0027 \u003c \"$1\" | tr \u0027\\n\u0027 \u0027 \u0027 | tail -c 1) \u003d\u003d \u0027 \u0027 ]]; }\n $ echo \u0027newline blah \u0027 \u003e newline\n $ echo -n \u0027nonewline blah \u0027 \u003e nonewline \n $ ends-in-newline newline ; echo $?\n 0\n $ ends-in-newline nonewline ; echo $?\n 1"},{"file":"tools/check-docs.sh","line":42,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Good call, incrementing a counter like this to be an exit value can be problematic:\n\n $ bash -c \u0027exit 254\u0027; echo $?\n 254\n $ bash -c \u0027exit 255\u0027; echo $?\n 255\n $ bash -c \u0027exit 256\u0027; echo $?\n 0"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"deps/javascriptlint","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"tools/check-docs.sh","type":"MODIFIED","insertions":4,"deletions":-4}],"sizeInsertions":5,"sizeDeletions":-5},{"number":"2","revision":"0ef01c7d14b5be7ee1888a8e0a2d0fb2daa7a3a4","parents":["5985176520a9f54f7ffc7898b87d13b430d4e425"],"ref":"refs/changes/44/2144/2","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1498253848,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1498253886,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1498254288,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1498254288,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"deps/javascriptlint","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"tools/check-docs.sh","type":"MODIFIED","insertions":3,"deletions":-4}],"sizeInsertions":4,"sizeDeletions":-5},{"number":"3","revision":"c601098b6857691e9b769dad7bc87ba54b29b136","parents":["5985176520a9f54f7ffc7898b87d13b430d4e425"],"ref":"refs/changes/44/2144/3","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1498255664,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1498253886,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1498254288,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1498254288,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"deps/javascriptlint","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"tools/check-docs.sh","type":"MODIFIED","insertions":3,"deletions":-4}],"sizeInsertions":4,"sizeDeletions":-5},{"number":"4","revision":"d94b12af413bdde1a224121302e327bd98b7f05f","parents":["524e07aabc9e93e908327d87bda471fdd6698600"],"ref":"refs/changes/44/2144/4","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1498255673,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1498253886,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1498254288,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1498254288,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"comments":[{"file":"tools/check-docs.sh","line":39,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"I had a lot of thoughts and tests around this solution I dumped them  into a gist. \n https://gist.github.com/bahamas10/3635eb609f611afbab36dafdfebdb652"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"deps/javascriptlint","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"tools/check-docs.sh","type":"MODIFIED","insertions":3,"deletions":-4}],"sizeInsertions":4,"sizeDeletions":-5},{"number":"5","revision":"cf8d93c364beb4a958c7986f282a392833ae5523","parents":["5985176520a9f54f7ffc7898b87d13b430d4e425"],"ref":"refs/changes/44/2144/5","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1498513745,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1498513777,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"tools/check-docs.sh","line":32,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"I know this line is used in a lot of the code base in various places... for the common case execution it won\u0027t actually cause problems, but i would still feel more comfortable if $0 was quoted, as well as the entire call to dirname.\n\n top\u003d$(cd \"$(dirname \"$0\")/../\"; pwd)\n\nfor anyone interested here\u0027s a case study i did a while back on trying to acquire this information from within a script: http://www.daveeddy.com/2015/04/13/dirname-case-study-for-bash-and-node/.  again, for the common case, this line should work."},{"file":"tools/check-docs.sh","line":32,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Done"},{"file":"tools/check-docs.sh","line":43,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"quote the variable expansion with $TOP\n\n find \"$top/docs\" -name \u0027*.md\u0027 -print0"},{"file":"tools/check-docs.sh","line":43,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"deps/javascriptlint","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"tools/check-docs.sh","type":"MODIFIED","insertions":5,"deletions":-6}],"sizeInsertions":6,"sizeDeletions":-7},{"number":"6","revision":"1a2318b662dfa8bbd1a47736568ffac6d524663b","parents":["5985176520a9f54f7ffc7898b87d13b430d4e425"],"ref":"refs/changes/44/2144/6","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1498514087,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1498513777,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"deps/javascriptlint","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"tools/check-docs.sh","type":"MODIFIED","insertions":5,"deletions":-6}],"sizeInsertions":6,"sizeDeletions":-7},{"number":"7","revision":"9beea09b001e677c71d2efed2d1a0e9e9068bb29","parents":["5985176520a9f54f7ffc7898b87d13b430d4e425"],"ref":"refs/changes/44/2144/7","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1498514681,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1498514723,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1498515594,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1498515594,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"deps/javascriptlint","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"tools/check-docs.sh","type":"MODIFIED","insertions":6,"deletions":-7}],"sizeInsertions":7,"sizeDeletions":-8},{"number":"8","revision":"ef3291aae7eecd6d0e763757fbc540fa040ec588","parents":["5985176520a9f54f7ffc7898b87d13b430d4e425"],"ref":"refs/changes/44/2144/8","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1498515303,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1498515339,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1498515603,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1498515603,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1498515601,"by":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1498515601,"by":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"deps/javascriptlint","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"tools/check-docs.sh","type":"MODIFIED","insertions":12,"deletions":-7}],"sizeInsertions":13,"sizeDeletions":-8},{"number":"9","revision":"f91ef9328c48ba9dfb5b81a2c46f8c48b25fdaa1","parents":["524e07aabc9e93e908327d87bda471fdd6698600"],"ref":"refs/changes/44/2144/9","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1498515738,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"SUBM","value":"1","grantedOn":1498515741,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1498515339,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1498515603,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1498515603,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1498515601,"by":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1498515601,"by":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"deps/javascriptlint","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"tools/check-docs.sh","type":"MODIFIED","insertions":12,"deletions":-7}],"sizeInsertions":13,"sizeDeletions":-8}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}]}