{"project":"joyent/sdc-manta","branch":"master","id":"I49519ba3f2d4874bde93a4504d97dbfcbe673619","number":"2139","subject":"MANTA-3322 want \u0027severity\u0027 column for \u0027manta-adm alarm list\u0027 Reviewed by: David Pacheco \u003cdap@joyent.com\u003e Approved by: David Pacheco \u003cdap@joyent.com\u003e","owner":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"url":"https://cr.joyent.us/2139","commitMessage":"MANTA-3322 want \u0027severity\u0027 column for \u0027manta-adm alarm list\u0027\nReviewed by: David Pacheco \u003cdap@joyent.com\u003e\nApproved by: David Pacheco \u003cdap@joyent.com\u003e\n","createdOn":1498176377,"lastUpdated":1498241661,"open":false,"status":"MERGED","comments":[{"timestamp":1498176377,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Uploaded patch set 1."},{"timestamp":1498176378,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit 1a63fb427e77e4d602d8a5841a235e5c8808f72a\n    \n    add severity optional column, also fix some widths to be at least as wide as the header"},{"timestamp":1498193263,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 1:\n\n@dap: I\u0027ve tested the 3rd case, and updated this ticket comment (https://devhub.joyent.com/jira/browse/MANTA-3322?focusedCommentId\u003d152500\u0026page\u003dcom.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-152500) with the details. Works for me, and I see the \"note: 1 alarm was associated with non-existent probe groups\" warning now (new to this case)."},{"timestamp":1498228665,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 1: Code-Review+1\n\nNice.  How about `make prepush`?"},{"timestamp":1498241425,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 1:\n\nDave,\n\nRegarding make prepush:\n\nFirst, all targets for that except \u0027make test\u0027 pass in my working copy *on my Mac*:\n\n```\n[11:07:32 trentm@danger0:~/joy/sdc-manta (grr-MANTA-3322)]\n$ make prepush\ndeps/javascriptlint/build/install/jsl --nologo --nosummary --conf\u003dtools/jsl.node.conf cmd/manta-adm.js cmd/manta-deploy.js cmd/manta-factoryreset.js cmd/manta-init.js cmd/manta-marlin.js cmd/manta-merge-config.js cmd/manta-oneach.js cmd/manta-replace-cert.js cmd/manta-shardadm.js cmd/manta-undeploy.js lib/adm.js lib/alarms/alarms.js lib/alarms/amon_objects.js lib/alarms/config.js lib/alarms/index.js lib/alarms/metadata.js lib/alarms/update.js lib/common.js lib/deploy.js lib/instance_info.js lib/layout.js lib/oneach/cli.js lib/oneach/oneach.js lib/sdc.js lib/services.js lib/ssh.js lib/ssl.js test/alarms/mock_amon.js test/alarms/tst.alarms.js test/alarms/tst.amon_objects.js test/alarms/tst.config.js test/alarms/tst.metadata_basic.js test/alarms/tst.metadata_files.js test/alarms/tst.update.js test/CollectorStream.js test/common.js test/tst.adm.js test/tst.adm_show.js test/tst.layout.js test/tst.oneach_cli.js test/tst.oneach_cmd.js test/tst.oneach_exec.js test/tst.oneach_formatters.js test/tst.services.js test/tst.stripe.js test/tst.zk.js networking/validate.js\n/Users/trentm/joy/sdc-manta/cmd/manta-adm.js\n/Users/trentm/joy/sdc-manta/cmd/manta-deploy.js\n/Users/trentm/joy/sdc-manta/cmd/manta-factoryreset.js\n/Users/trentm/joy/sdc-manta/cmd/manta-init.js\n/Users/trentm/joy/sdc-manta/cmd/manta-marlin.js\n/Users/trentm/joy/sdc-manta/cmd/manta-merge-config.js\n/Users/trentm/joy/sdc-manta/cmd/manta-oneach.js\n/Users/trentm/joy/sdc-manta/cmd/manta-replace-cert.js\n/Users/trentm/joy/sdc-manta/cmd/manta-shardadm.js\n/Users/trentm/joy/sdc-manta/cmd/manta-undeploy.js\n/Users/trentm/joy/sdc-manta/lib/adm.js\n/Users/trentm/joy/sdc-manta/lib/alarms/alarms.js\n/Users/trentm/joy/sdc-manta/lib/alarms/amon_objects.js\n/Users/trentm/joy/sdc-manta/lib/alarms/config.js\n/Users/trentm/joy/sdc-manta/lib/alarms/index.js\n/Users/trentm/joy/sdc-manta/lib/alarms/metadata.js\n/Users/trentm/joy/sdc-manta/lib/alarms/update.js\n/Users/trentm/joy/sdc-manta/lib/common.js\n/Users/trentm/joy/sdc-manta/lib/deploy.js\n/Users/trentm/joy/sdc-manta/lib/instance_info.js\n/Users/trentm/joy/sdc-manta/lib/layout.js\n/Users/trentm/joy/sdc-manta/lib/oneach/cli.js\n/Users/trentm/joy/sdc-manta/lib/oneach/oneach.js\n/Users/trentm/joy/sdc-manta/lib/sdc.js\n/Users/trentm/joy/sdc-manta/lib/services.js\n/Users/trentm/joy/sdc-manta/lib/ssh.js\n/Users/trentm/joy/sdc-manta/lib/ssl.js\n/Users/trentm/joy/sdc-manta/test/alarms/mock_amon.js\n/Users/trentm/joy/sdc-manta/test/alarms/tst.alarms.js\n/Users/trentm/joy/sdc-manta/test/alarms/tst.amon_objects.js\n/Users/trentm/joy/sdc-manta/test/alarms/tst.config.js\n/Users/trentm/joy/sdc-manta/test/alarms/tst.metadata_basic.js\n/Users/trentm/joy/sdc-manta/test/alarms/tst.metadata_files.js\n/Users/trentm/joy/sdc-manta/test/alarms/tst.update.js\n/Users/trentm/joy/sdc-manta/test/CollectorStream.js\n/Users/trentm/joy/sdc-manta/test/common.js\n/Users/trentm/joy/sdc-manta/test/tst.adm.js\n/Users/trentm/joy/sdc-manta/test/tst.adm_show.js\n/Users/trentm/joy/sdc-manta/test/tst.layout.js\n/Users/trentm/joy/sdc-manta/test/tst.oneach_cli.js\n/Users/trentm/joy/sdc-manta/test/tst.oneach_cmd.js\n/Users/trentm/joy/sdc-manta/test/tst.oneach_exec.js\n/Users/trentm/joy/sdc-manta/test/tst.oneach_formatters.js\n/Users/trentm/joy/sdc-manta/test/tst.services.js\n/Users/trentm/joy/sdc-manta/test/tst.stripe.js\n/Users/trentm/joy/sdc-manta/test/tst.zk.js\n/Users/trentm/joy/sdc-manta/networking/validate.js\njson --validate -f package.json\njson --validate -f config/application.json\njson --validate -f config/services/authcache/service.json\njson --validate -f config/services/authcache/service.json.production\njson --validate -f config/services/electric-moray/service.json\njson --validate -f config/services/electric-moray/service.json.lab\njson --validate -f config/services/electric-moray/service.json.production\njson --validate -f config/services/jobpuller/service.json\njson --validate -f config/services/jobpuller/service.json.production\njson --validate -f config/services/jobsupervisor/service.json\njson --validate -f config/services/jobsupervisor/service.json.production\njson --validate -f config/services/loadbalancer/service.json\njson --validate -f config/services/loadbalancer/service.json.production\njson --validate -f config/services/madtom/service.json\njson --validate -f config/services/madtom/service.json.coal\njson --validate -f config/services/madtom/service.json.production\njson --validate -f config/services/marlin/service.json\njson --validate -f config/services/marlin/service.json.production\njson --validate -f config/services/marlin-dashboard/service.json\njson --validate -f config/services/marlin-dashboard/service.json.production\njson --validate -f config/services/medusa/service.json\njson --validate -f config/services/medusa/service.json.production\njson --validate -f config/services/moray/service.json\njson --validate -f config/services/moray/service.json.lab\njson --validate -f config/services/moray/service.json.production\njson --validate -f config/services/nameservice/service.json\njson --validate -f config/services/nameservice/service.json.production\njson --validate -f config/services/ops/service.json\njson --validate -f config/services/ops/service.json.coal\njson --validate -f config/services/ops/service.json.production\njson --validate -f config/services/postgres/service.json\njson --validate -f config/services/postgres/service.json.lab\njson --validate -f config/services/postgres/service.json.production\njson --validate -f config/services/propeller/service.json\njson --validate -f config/services/propeller/service.json.production\njson --validate -f config/services/storage/service.json\njson --validate -f config/services/storage/service.json.lab\njson --validate -f config/services/storage/service.json.production\njson --validate -f config/services/webapi/service.json\njson --validate -f config/services/webapi/service.json.coal\njson --validate -f config/services/webapi/service.json.lab\njson --validate -f config/services/webapi/service.json.production\njson --validate -f manifests/applications/manta/common/manifest.json\njson --validate -f manifests/applications/manta/dns_client/manifest.json\njson --validate -f manifests/applications/manta/registrar/manifest.json\njson --validate -f manifests/applications/manta/ssh_private_key/manifest.json\njson --validate -f manifests/applications/manta/ssh_public_key/manifest.json\njson --validate -f sapi_manifests/manta/manifest.json\ndeps/jsstyle/jsstyle -o doxygen cmd/manta-adm.js cmd/manta-deploy.js cmd/manta-factoryreset.js cmd/manta-init.js cmd/manta-marlin.js cmd/manta-merge-config.js cmd/manta-oneach.js cmd/manta-replace-cert.js cmd/manta-shardadm.js cmd/manta-undeploy.js lib/adm.js lib/alarms/alarms.js lib/alarms/amon_objects.js lib/alarms/config.js lib/alarms/index.js lib/alarms/metadata.js lib/alarms/update.js lib/common.js lib/deploy.js lib/instance_info.js lib/layout.js lib/oneach/cli.js lib/oneach/oneach.js lib/sdc.js lib/services.js lib/ssh.js lib/ssl.js test/alarms/mock_amon.js test/alarms/tst.alarms.js test/alarms/tst.amon_objects.js test/alarms/tst.config.js test/alarms/tst.metadata_basic.js test/alarms/tst.metadata_files.js test/alarms/tst.update.js test/CollectorStream.js test/common.js test/tst.adm.js test/tst.adm_show.js test/tst.layout.js test/tst.oneach_cli.js test/tst.oneach_cmd.js test/tst.oneach_exec.js test/tst.oneach_formatters.js test/tst.services.js test/tst.stripe.js test/tst.zk.js networking/validate.js\nbash -n scripts/user-script.sh\nbash -n tools/add-dev-user\nbash -n bin/manta-deploy-lab\nbash -n networking/manta-net.sh\nnode tools/bashstyle scripts/user-script.sh\nnode tools/bashstyle tools/add-dev-user\nnode tools/bashstyle bin/manta-deploy-lab\nnode tools/bashstyle networking/manta-net.sh\ncheck ok\nPATH\u003d\"/Users/trentm/opt/node-0.10/bin:$PATH\" deps/catest/catest -a\nConfiguration:\n    SRC:                         /Users/trentm/joy/sdc-manta\n    Output directory:            /var/tmp/catest.3079\n    Temp directory:              /var/tmp/catest.3079_tmpfiles\n    Keep successful test output: false\n    Found 16 test(s) to run\n\n\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\n\nExecuting test test/alarms/tst.alarms.js ... success.\nExecuting test test/alarms/tst.amon_objects.js ... success.\nExecuting test test/alarms/tst.config.js ... success.\nExecuting test test/alarms/tst.metadata_basic.js ... success.\nExecuting test test/alarms/tst.metadata_files.js ... success.\nExecuting test test/alarms/tst.update.js ... success.\nExecuting test test/tst.adm.js ... success.\nExecuting test test/tst.adm_show.js ... success.\nExecuting test test/tst.layout.js ... success.\nExecuting test test/tst.oneach_cli.js ... FAILED.\n\u003e\u003e\u003e failure details in /var/tmp/catest.3079/failure.0\n\nExecuting test test/tst.oneach_cmd.js ... FAILED.\n\u003e\u003e\u003e failure details in /var/tmp/catest.3079/failure.1\n\nExecuting test test/tst.oneach_exec.js ... FAILED.\n\u003e\u003e\u003e failure details in /var/tmp/catest.3079/failure.2\n\nExecuting test test/tst.oneach_formatters.js ... FAILED.\n\u003e\u003e\u003e failure details in /var/tmp/catest.3079/failure.3\n\nExecuting test test/tst.services.js ... success.\nExecuting test test/tst.stripe.js ... success.\nExecuting test test/tst.zk.js ... success.\n\n\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\n\nResults:\n\tTests passed:\t12/16\n\tTests failed:\t 4/16\n\n\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\nCleaning up output from successful tests ... done.\nmake: *** [test] Error 4\n```\n\nTo get the tests to run requires running in SmartOS. I\u0027m able to run the tests fine when getting my changes into a deployed \u0027manta0\u0027 zone. Here is the run on nightly-1:\n\n```\n[root@4688f2c5-5f43-4850-8e17-ceda29c9687c (nightly-1:manta0) /opt/smartdc/manta-deployment]# make test\n/bin/sh: line 1: git: not found\n/bin/sh: line 1: git: not found\nPATH\u003d\"/opt/smartdc/manta-deployment/build/node/bin:$PATH\" deps/catest/catest -a\nConfiguration:\n    SRC:                         /opt/smartdc/manta-deployment\n    Output directory:            /var/tmp/catest.76095\n    Temp directory:              /var/tmp/catest.76095_tmpfiles\n    Keep successful test output: false\n    Found 16 test(s) to run\n\n\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\n\nExecuting test test/alarms/tst.alarms.js ... success.\nExecuting test test/alarms/tst.amon_objects.js ... success.\nExecuting test test/alarms/tst.config.js ... success.\nExecuting test test/alarms/tst.metadata_basic.js ... success.\nExecuting test test/alarms/tst.metadata_files.js ... success.\nExecuting test test/alarms/tst.update.js ... success.\nExecuting test test/tst.adm.js ... success.\nExecuting test test/tst.adm_show.js ... success.\nExecuting test test/tst.layout.js ... success.\nExecuting test test/tst.oneach_cli.js ... success.\nExecuting test test/tst.oneach_cmd.js ... success.\nExecuting test test/tst.oneach_exec.js ... success.\nExecuting test test/tst.oneach_formatters.js ... success.\nExecuting test test/tst.services.js ... success.\nExecuting test test/tst.stripe.js ... success.\nExecuting test test/tst.zk.js ... success.\n\n\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\n\nResults:\n        Tests passed:   16/16\n        Tests failed:    0/16\n\n\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\nCleaning up output from successful tests ... done.\n```\n\nI will have a separate follow-up ticket/CR to sdc-manta.git to document how to run the test suite this way."},{"timestamp":1498241529,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 1: Integration-Approval+1"},{"timestamp":1498241644,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Uploaded patch set 2: Commit message was updated."},{"timestamp":1498241661,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Trent Mick"}],"currentPatchSet":{"number":"2","revision":"49519ba3f2d4874bde93a4504d97dbfcbe673619","parents":["bb7facd68315ba23c9014855ed77c6e80b04999f"],"ref":"refs/changes/39/2139/2","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1498241644,"author":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1498228665,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1498241529,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"SUBM","value":"1","grantedOn":1498241661,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/adm.js","type":"MODIFIED","insertions":8,"deletions":-3}],"sizeInsertions":8,"sizeDeletions":-3},"patchSets":[{"number":"1","revision":"1e49abe7f3711fa18b42ce346d13134b97e6b311","parents":["bb7facd68315ba23c9014855ed77c6e80b04999f"],"ref":"refs/changes/39/2139/1","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1498176377,"author":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1498228665,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1498241529,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/adm.js","type":"MODIFIED","insertions":8,"deletions":-3}],"sizeInsertions":8,"sizeDeletions":-3},{"number":"2","revision":"49519ba3f2d4874bde93a4504d97dbfcbe673619","parents":["bb7facd68315ba23c9014855ed77c6e80b04999f"],"ref":"refs/changes/39/2139/2","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1498241644,"author":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1498228665,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1498241529,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"SUBM","value":"1","grantedOn":1498241661,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/adm.js","type":"MODIFIED","insertions":8,"deletions":-3}],"sizeInsertions":8,"sizeDeletions":-3}],"allReviewers":[{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}]}