From 31da2a743fdc2808f618484743c2a2f2325807d0 Mon Sep 17 00:00:00 2001
From: Angela Fong2 <angela.fong@joyent.com>
Date: Mon, 14 Jan 2019 17:11:34 -0800
Subject: [PATCH] MANTA-3970 Nginx connection count should be tunable via SAPI
 Reviewed by: Robert Bogart <Robert.bogart@joyent.com> Approved by: Robert
 Bogart <Robert.bogart@joyent.com>

---
 README.md                    | 8 ++++++++
 sapi_manifests/mako/template | 5 +++++
 2 files changed, 13 insertions(+)

diff --git a/README.md b/README.md
index 40dcd0b..6a3acfd 100644
--- a/README.md
+++ b/README.md
@@ -92,6 +92,14 @@ server at `http://1.2.3.4:8080/`.
 
 ## SAPI Tunables
 
+    MAKO_WORKER_PROCESSES      Number of nginx worker processes
+
+    MAKO_WORKER_CONNECTIONS    Maximum number of connections per nginx worker
+                               process
+
+    MAKO_THREAD_POOL_SIZE      Number of threads to use for multi-part upload
+                               thread pool
+
     MAKO_PROCESS_MANIFEST      Boolean value which when set, enables the post
                                processing of a mako manifest to produce a
                                summary as well.  The summary provides
diff --git a/sapi_manifests/mako/template b/sapi_manifests/mako/template
index 030f7a2..45183fe 100644
--- a/sapi_manifests/mako/template
+++ b/sapi_manifests/mako/template
@@ -16,7 +16,12 @@ thread_pool mpu threads=8;
 error_log /var/log/mako-error.log info;
 
 events {
+{{#MAKO_WORKER_CONNECTIONS}}
+        worker_connections {{MAKO_WORKER_CONNECTIONS}};
+{{/MAKO_WORKER_CONNECTIONS}}
+{{^MAKO_WORKER_CONNECTIONS}}
 	worker_connections  1024;
+{{/MAKO_WORKER_CONNECTIONS}}
 	use eventport;
 }
 
-- 
2.21.0

