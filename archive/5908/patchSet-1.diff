From 36f3af7d48eb532ca715f07b8c31b068ed103a81 Mon Sep 17 00:00:00 2001
From: Rui Loura <rui@joyent.com>
Date: Mon, 14 Jan 2019 19:49:20 +0000
Subject: [PATCH] TRITON-1020 amon bootstrap tool should use network names
 instead of UUID

---
 tools/bootstrap.js | 18 +-----------------
 1 file changed, 1 insertion(+), 17 deletions(-)

diff --git a/tools/bootstrap.js b/tools/bootstrap.js
index d81a64f..6aa68ff 100755
--- a/tools/bootstrap.js
+++ b/tools/bootstrap.js
@@ -280,21 +280,6 @@ function getSmartosDatasetUuid(next) {
 }
 
 
-function getExternalNetworkUuid(next) {
-    log('# Get "external" network UUID.');
-    exec(format('ssh %s /opt/smartdc/bin/sdc-napi /networks | %s -H -c \'name === "external"\' 0.uuid',
-                            headnodeAlias, JSONTOOL),
-             function (err, stdout, stderr) {
-        if (err) {
-            return next(err);
-        }
-        externalNetworkUuid = stdout.trim();
-        log('# "external" network UUID is "%s".', externalNetworkUuid);
-        next();
-    });
-}
-
-
 function createAmondevzone(next) {
     // First check if there is a zone for bob.
     vmapiClient.listVms({owner_uuid: bob.uuid, alias: 'amondevzone'},
@@ -318,7 +303,7 @@ function createAmondevzone(next) {
                 brand: 'joyent',
                 ram: '128',
                 alias: 'amondevzone',
-                networks: [{uuid: externalNetworkUuid}],
+                networks: [{name: 'external'}],
                 server_uuid: headnodeUuid,
                 customer_metadata: {
                     'user-script': fs.readFileSync(userScriptPath, 'utf8')
@@ -689,7 +674,6 @@ async.series([
         getCnapiClient,
         getHeadnodeUuid,
         getSmartosDatasetUuid,
-        getExternalNetworkUuid,
         createAmondevzone,
         getAmonClient,
         loadAmonObjects
-- 
2.21.0

