{"project":"joyent/sdc-imgapi-cli","branch":"master","id":"I90fadd3ca45e05021f54db1032b0f0ae66ce41b6","number":"4184","subject":"TRITON-493 \u0027--tree\u0027 option to sdc-imgadm, updates-imgadm, joyent-imgadm to show origin hierarchy Reviewed by: Marsell Kukuljevic \u003cmarsell@joyent.com\u003e Approved by: Marsell Kukuljevic \u003cmarsell@joyent.com\u003e","owner":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"url":"https://cr.joyent.us/4184","commitMessage":"TRITON-493 \u0027--tree\u0027 option to sdc-imgadm, updates-imgadm, joyent-imgadm to show origin hierarchy\nReviewed by: Marsell Kukuljevic \u003cmarsell@joyent.com\u003e\nApproved by: Marsell Kukuljevic \u003cmarsell@joyent.com\u003e\n","createdOn":1528752935,"lastUpdated":1528830699,"open":false,"status":"MERGED","comments":[{"timestamp":1528752935,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Uploaded patch set 1."},{"timestamp":1528752936,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit b8d7ccc493fa2944caa9507ec3888536f88e4503\n    \n    do it"},{"timestamp":1528752959,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1528774786,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 1:\n\n(4 comments)\n\nHeh,  sdc-imgapi-cli sure has few tests. Consider improving that with a test for this."},{"timestamp":1528826641,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Uploaded patch set 2."},{"timestamp":1528826643,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit cfb83e00e461f6cb654d3e21be13bca1e43b6738\n    \n    cr feedback; don\u0027t capture programmer errors in tabula call"},{"timestamp":1528826667,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1528826691,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 1:\n\n(4 comments)"},{"timestamp":1528828342,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 2: Code-Review+1 Integration-Approval+1"},{"timestamp":1528828373,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Patch Set 2:\n\n(2 comments)"},{"timestamp":1528830692,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Uploaded patch set 3: Commit message was updated."},{"timestamp":1528830699,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Trent Mick"}],"currentPatchSet":{"number":"3","revision":"90fadd3ca45e05021f54db1032b0f0ae66ce41b6","parents":["cc464ed5cea27386a2e077724941cc35faf78dc5"],"ref":"refs/changes/84/4184/3","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1528830692,"author":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1528826667,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1528828342,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1528828342,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}},{"type":"SUBM","value":"1","grantedOn":1528830699,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":5,"deletions":0},{"file":"lib/cli.js","type":"MODIFIED","insertions":135,"deletions":-31},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":141,"sizeDeletions":-32},"patchSets":[{"number":"1","revision":"f48c63a30dde88dc95c8cd67b59360481e7e8db1","parents":["cc464ed5cea27386a2e077724941cc35faf78dc5"],"ref":"refs/changes/84/4184/1","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1528752935,"author":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1528752959,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/cli.js","line":701,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"One level of indentation could be eliminated below by doing a \"callback(); return\" here instead."},{"file":"lib/cli.js","line":701,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"I chose not to do this."},{"file":"lib/cli.js","line":714,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"s/add/added"},{"file":"lib/cli.js","line":716,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"It\u0027d be helpful if there was more detail here about how remainingUuids and _treeStack are used. It took a while to understand how this algorithm works."},{"file":"lib/cli.js","line":716,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Done"},{"file":"lib/cli.js","line":732,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"If you push img instead of img.uuid here, you don\u0027t need to do a imageFromUuid[] lookup later on."},{"file":"lib/cli.js","line":732,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Done"},{"file":"lib/cli.js","line":753,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"name"},{"file":"lib/cli.js","line":753,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":5,"deletions":0},{"file":"lib/cli.js","type":"MODIFIED","insertions":114,"deletions":-20},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":120,"sizeDeletions":-21},{"number":"2","revision":"0b832b88d4f0bf427a9be5ef0e57cc01e66ebc11","parents":["cc464ed5cea27386a2e077724941cc35faf78dc5"],"ref":"refs/changes/84/4184/2","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1528826641,"author":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1528826667,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1528828342,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1528828342,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}}],"comments":[{"file":"lib/cli.js","line":729,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"This confuses me - I would have thought that on the first pass (above) you would collect the tree roots (i.e. those images that do not have an origin) and also create a childrenFromParent map so you can lookup all the children of a given image (i.e. starting from a root image uuid, you can find all of it\u0027s children, then for each child you can find all of their children and so on).\n\nIn the second loop apply sorting, add tree indentation information and flatten the tree into the final array."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":5,"deletions":0},{"file":"lib/cli.js","type":"MODIFIED","insertions":135,"deletions":-31},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":141,"sizeDeletions":-32},{"number":"3","revision":"90fadd3ca45e05021f54db1032b0f0ae66ce41b6","parents":["cc464ed5cea27386a2e077724941cc35faf78dc5"],"ref":"refs/changes/84/4184/3","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1528830692,"author":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1528826667,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"SUBM","value":"1","grantedOn":1528830699,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1528828342,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1528828342,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":5,"deletions":0},{"file":"lib/cli.js","type":"MODIFIED","insertions":135,"deletions":-31},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":141,"sizeDeletions":-32}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}]}