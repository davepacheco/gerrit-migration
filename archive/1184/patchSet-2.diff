commit d286aa584844b1ca30229211dddc4a52018c3699 (refs/changes/84/1184/2)
Author: Angela Fong <angela.fong@joyent.com>
Date:   2017-01-20T12:58:44-08:00 (2 years, 9 months ago)
    
    joyent/node-sdc-clients#10 Want support for sync parameter for vmapi.getVm

diff --git a/CHANGES.md b/CHANGES.md
index c584e17..7b9852d 100644
--- a/CHANGES.md
+++ b/CHANGES.md
@@ -12,6 +12,10 @@
 
 ## not yet released
 
+## 10.1.0
+
+- joyent/node-sdc-clients#10 Add `params.sync` to VMAPI.getVm.
+
 ## 10.0.4
 
 - IMGAPI-606 Restore support to `imgapi.cliSigner` that the given keyId is
diff --git a/lib/vmapi.js b/lib/vmapi.js
index 8447397..d0a5a54 100644
--- a/lib/vmapi.js
+++ b/lib/vmapi.js
@@ -317,6 +317,7 @@ VMAPI.prototype.getVmProc = function (params, options, callback) {
  * @param {Object} params : Filter params.
  * @param {String} params.uuid : the UUID of the VM.
  * @param {String} params.owner_uuid : Optional, the owner of the VM.
+ * @param {Boolean} params.sync: Optional, sync vm data from the CN.
  * @param {Object} options : Request options.
  * @param {Function} callback : of the form f(err, vm).
  */
@@ -328,6 +329,8 @@ VMAPI.prototype.getVm = function (params, options, callback) {
         options = undefined;
     }
 
+    assert.optionalBool(params.sync, 'params.sync');
+
     if (!params || typeof (params) !== 'object')
         throw new TypeError('params is required (object)');
     if (!params.uuid)
@@ -336,6 +339,8 @@ VMAPI.prototype.getVm = function (params, options, callback) {
         query.owner_uuid = params.owner_uuid;
     if (params.fields)
         query.fields = params.fields;
+    if (params.sync)
+        query.sync = 'true';
 
     var opts = { path: format('/vms/%s', params.uuid), query: query };
     if (options) {
diff --git a/node_modules_zip b/node_modules_zip
new file mode 100644
index 0000000..21f1280
Binary files /dev/null and b/node_modules_zip differ
diff --git a/package.json b/package.json
index afa8a26..804c3a7 100644
--- a/package.json
+++ b/package.json
@@ -1,7 +1,7 @@
 {
   "name": "sdc-clients",
   "description": "node.js client libraries for Triton core REST APIs.",
-  "version": "10.0.4",
+  "version": "10.1.0",
   "homepage": "http://www.joyent.com",
   "repository": {
     "type": "git",
diff --git a/test/vmapi.test.js b/test/vmapi.test.js
index 4006b19..1449d7e 100644
--- a/test/vmapi.test.js
+++ b/test/vmapi.test.js
@@ -372,6 +372,18 @@ test('vmapi', function (tt) {
         });
     });
 
+    tt.test(' sync vm', function (t) {
+        var SYNC_QUERY = {
+            uuid: ZONE,
+            sync: 'true'
+        };
+        vmapi.getVm(SYNC_QUERY, function (err, vm) {
+            t.ifError(err);
+            t.ok(vm);
+            t.end();
+        });
+    });
+
 
     tt.test(' find headnode', function (t) {
         cnapi.listServers(function (err, servers) {
@@ -1181,4 +1193,4 @@ test('vmapi', function (tt) {
         napi.close();
         t.end();
     });
-});
\ No newline at end of file
+});
