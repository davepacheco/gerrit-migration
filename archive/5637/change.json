{"project":"joyent/illumos-joyent","branch":"master","id":"Ie393062f0aebf8081aed83fd67670d9094d2a2a3","number":"5637","subject":"OS-7613 bhyve virtio needs barriers OS-7614 viona should use proper barriers Reviewed by: John Levon \u003cjohn.levon@joyent.com\u003e Reviewed by: Hans Rosenfeld \u003chans.rosenfeld@joyent.com\u003e Approved by: Dan McDonald \u003cdanmcd@joyent.com\u003e","owner":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"url":"https://cr.joyent.us/5637","commitMessage":"OS-7613 bhyve virtio needs barriers\nOS-7614 viona should use proper barriers\nReviewed by: John Levon \u003cjohn.levon@joyent.com\u003e\nReviewed by: Hans Rosenfeld \u003chans.rosenfeld@joyent.com\u003e\nApproved by: Dan McDonald \u003cdanmcd@joyent.com\u003e\n","createdOn":1551135665,"lastUpdated":1551304601,"open":false,"status":"MERGED","comments":[{"timestamp":1551135665,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 1."},{"timestamp":1551195700,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Patch Set 1: Code-Review+1"},{"timestamp":1551196785,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 1:\n\n(2 comments)"},{"timestamp":1551197053,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 2."},{"timestamp":1551197113,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 3: Patch Set 2 was rebased."},{"timestamp":1551197140,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 1:\n\n(2 comments)"},{"timestamp":1551199065,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1551203264,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 3:\n\nSome test notes have been added to the OS-7613 ticket.  Given the subtle changes in behavior, the customer test is of the most interest for assessing the result."},{"timestamp":1551278345,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1551300002,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 3: Integration-Approval+1\n\nBug report has happy customer after 24 hours of testing."},{"timestamp":1551302863,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 4: Patch Set 3 was rebased."},{"timestamp":1551303074,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 5: Commit message was updated."},{"timestamp":1551304586,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 6: Patch Set 5 was rebased."},{"timestamp":1551304601,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Patrick Mooney"}],"currentPatchSet":{"number":"6","revision":"e393062f0aebf8081aed83fd67670d9094d2a2a3","parents":["727500e0fbb95141ea67e4e79412d2dfe2660553"],"ref":"refs/changes/37/5637/6","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1551304586,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1551199065,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1551278345,"by":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1551300002,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"SUBM","value":"1","grantedOn":1551304601,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"usr/src/cmd/bhyve/virtio.c","type":"MODIFIED","insertions":15,"deletions":0},{"file":"usr/src/compat/freebsd/amd64/machine/atomic.h","type":"MODIFIED","insertions":7,"deletions":-2},{"file":"usr/src/uts/i86pc/io/viona/viona.c","type":"MODIFIED","insertions":9,"deletions":-3}],"sizeInsertions":31,"sizeDeletions":-5},"patchSets":[{"number":"1","revision":"cfef56f22e3396a8215ceeb507a9202ed449e004","parents":["a23a88c8822def3a025fde613631b67191ea9ae0"],"ref":"refs/changes/37/5637/1","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1551135665,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1551195700,"by":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"}}],"comments":[{"file":"usr/src/cmd/bhyve/virtio.c","line":425,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"as mentioned, please comment this isn\u0027t needed for x86"},{"file":"usr/src/cmd/bhyve/virtio.c","line":425,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Done"},{"file":"usr/src/cmd/bhyve/virtio.c","line":468,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"\"preceding\""},{"file":"usr/src/cmd/bhyve/virtio.c","line":468,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"usr/src/cmd/bhyve/virtio.c","type":"MODIFIED","insertions":12,"deletions":0},{"file":"usr/src/compat/freebsd/amd64/machine/atomic.h","type":"MODIFIED","insertions":7,"deletions":-2},{"file":"usr/src/uts/i86pc/io/viona/viona.c","type":"MODIFIED","insertions":9,"deletions":-3}],"sizeInsertions":28,"sizeDeletions":-5},{"number":"2","revision":"e435bcfbf4474d39111f6ec4251e35367c3c1380","parents":["a23a88c8822def3a025fde613631b67191ea9ae0"],"ref":"refs/changes/37/5637/2","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1551197053,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"usr/src/cmd/bhyve/virtio.c","type":"MODIFIED","insertions":15,"deletions":0},{"file":"usr/src/compat/freebsd/amd64/machine/atomic.h","type":"MODIFIED","insertions":7,"deletions":-2},{"file":"usr/src/uts/i86pc/io/viona/viona.c","type":"MODIFIED","insertions":9,"deletions":-3}],"sizeInsertions":31,"sizeDeletions":-5},{"number":"3","revision":"a10d488f2bd8ae0041a4b038fe403e6f54c3b1a6","parents":["46c76a4f2a42a132a2957bec5f12b68322f731a7"],"ref":"refs/changes/37/5637/3","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1551197113,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1551278345,"by":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1551300002,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1551199065,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"usr/src/cmd/bhyve/virtio.c","type":"MODIFIED","insertions":15,"deletions":0},{"file":"usr/src/compat/freebsd/amd64/machine/atomic.h","type":"MODIFIED","insertions":7,"deletions":-2},{"file":"usr/src/uts/i86pc/io/viona/viona.c","type":"MODIFIED","insertions":9,"deletions":-3}],"sizeInsertions":31,"sizeDeletions":-5},{"number":"4","revision":"576bbd956f70dbbdcfcf20a6a64cefccdafa95e3","parents":["effbf48007cb2553cf312d93f7e4cf469e837d77"],"ref":"refs/changes/37/5637/4","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1551302863,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1551278345,"by":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1551300002,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1551199065,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"usr/src/cmd/bhyve/virtio.c","type":"MODIFIED","insertions":15,"deletions":0},{"file":"usr/src/compat/freebsd/amd64/machine/atomic.h","type":"MODIFIED","insertions":7,"deletions":-2},{"file":"usr/src/uts/i86pc/io/viona/viona.c","type":"MODIFIED","insertions":9,"deletions":-3}],"sizeInsertions":31,"sizeDeletions":-5},{"number":"5","revision":"cd2d3e38a4c596255cb3c7244a0a79e330cb24b7","parents":["effbf48007cb2553cf312d93f7e4cf469e837d77"],"ref":"refs/changes/37/5637/5","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1551303074,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1551278345,"by":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1551300002,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1551199065,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"usr/src/cmd/bhyve/virtio.c","type":"MODIFIED","insertions":15,"deletions":0},{"file":"usr/src/compat/freebsd/amd64/machine/atomic.h","type":"MODIFIED","insertions":7,"deletions":-2},{"file":"usr/src/uts/i86pc/io/viona/viona.c","type":"MODIFIED","insertions":9,"deletions":-3}],"sizeInsertions":31,"sizeDeletions":-5},{"number":"6","revision":"e393062f0aebf8081aed83fd67670d9094d2a2a3","parents":["727500e0fbb95141ea67e4e79412d2dfe2660553"],"ref":"refs/changes/37/5637/6","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1551304586,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"SUBM","value":"1","grantedOn":1551304601,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1551278345,"by":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1551300002,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1551199065,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"usr/src/cmd/bhyve/virtio.c","type":"MODIFIED","insertions":15,"deletions":0},{"file":"usr/src/compat/freebsd/amd64/machine/atomic.h","type":"MODIFIED","insertions":7,"deletions":-2},{"file":"usr/src/uts/i86pc/io/viona/viona.c","type":"MODIFIED","insertions":9,"deletions":-3}],"sizeInsertions":31,"sizeDeletions":-5}],"allReviewers":[{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}]}