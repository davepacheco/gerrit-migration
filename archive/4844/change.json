{"project":"joyent/illumos-joyent","branch":"master","id":"I540be08e437ce290999b29a244386a4283dca907","number":"4844","subject":"OS-2825 process erroneously shows up from 1970 Reviewed by: Mike Gerdts \u003cmike.gerdts@joyent.com\u003e Approved by: Joshua M. Clulow \u003cjmc@joyent.com\u003e","owner":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"url":"https://cr.joyent.us/4844","commitMessage":"OS-2825 process erroneously shows up from 1970\nReviewed by: Mike Gerdts \u003cmike.gerdts@joyent.com\u003e\nApproved by: Joshua M. Clulow \u003cjmc@joyent.com\u003e\n","createdOn":1537048346,"lastUpdated":1550946867,"open":false,"status":"MERGED","comments":[{"timestamp":1537048346,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Uploaded patch set 1."},{"timestamp":1537202335,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1537240581,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Uploaded patch set 2."},{"timestamp":1538417744,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 2: Code-Review+1"},{"timestamp":1550640194,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Uploaded patch set 3: Patch Set 2 was rebased."},{"timestamp":1550641388,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Uploaded patch set 4."},{"timestamp":1550642188,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Uploaded patch set 5."},{"timestamp":1550663218,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 5: Code-Review+1"},{"timestamp":1550804363,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 5:\n\nLooking closer at the Pgrab(3PROC) implementation, even with the PGRAB_RDONLY|PGRAB_NOSTOP flags set, it still requires elevated privileges to work (this was proven with additional testing).\n\nHowever, looking closer at the various calls Pgrab(3PROC) makes, and finding confirmation deep within proc(4), a number of fields of the psinfo_t struct are set to 0 on a zombie process, and thankfully one does not require special privileges to read a processes psinfo_t.  An update using this will be uploaded shortly."},{"timestamp":1550804914,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Uploaded patch set 6."},{"timestamp":1550868082,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 6:\n\n(1 comment)"},{"timestamp":1550868690,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 6:\n\n(1 comment)"},{"timestamp":1550874994,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Uploaded patch set 7."},{"timestamp":1550877220,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 7: Code-Review+1"},{"timestamp":1550944136,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Patch Set 7: Integration-Approval+1\n\nThanks for the testing notes.  I approve."},{"timestamp":1550946797,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Uploaded patch set 8: Commit message was updated."},{"timestamp":1550946846,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Uploaded patch set 9: Patch Set 8 was rebased."},{"timestamp":1550946867,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Jason King"}],"currentPatchSet":{"number":"9","revision":"540be08e437ce290999b29a244386a4283dca907","parents":["9b2ce9c90f656792c9d27ec8cbcec521f3f8922f"],"ref":"refs/changes/44/4844/9","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1550946846,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1550877220,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1550944136,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}},{"type":"SUBM","value":"1","grantedOn":1550946867,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/cmd/svc/svcs/Makefile","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"usr/src/cmd/svc/svcs/svcs.c","type":"MODIFIED","insertions":11,"deletions":-26}],"sizeInsertions":14,"sizeDeletions":-29},"patchSets":[{"number":"1","revision":"c45fc6cd435a0936a36c2b330e3e0b3fbf742310","parents":["85face0b82dd8468c97810dc191e2d4c9b14c81a"],"ref":"refs/changes/44/4844/1","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1537048346,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/cmd/svc/svcs/svcs.c","line":972,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Check for pserr \u003d\u003d G_NOPROC for this case:\n\nhttp://src.illumos.org/source/xref/illumos-gate/usr/src/lib/libproc/common/Pcontrol.c#921"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/svc/svcs/Makefile","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/cmd/svc/svcs/svcs.c","type":"MODIFIED","insertions":16,"deletions":-10}],"sizeInsertions":18,"sizeDeletions":-12},{"number":"2","revision":"560b3dca4386b2367ca0d01dc77bfd48f5a4cb8b","parents":["85face0b82dd8468c97810dc191e2d4c9b14c81a"],"ref":"refs/changes/44/4844/2","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1537240581,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1538417744,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/svc/svcs/Makefile","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/cmd/svc/svcs/svcs.c","type":"MODIFIED","insertions":21,"deletions":-10}],"sizeInsertions":23,"sizeDeletions":-12},{"number":"3","revision":"1016186d2af95ad28f2b217d905c626568871e22","parents":["20cd42d3954fb7e0280a3cf34a344db285355a0e"],"ref":"refs/changes/44/4844/3","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1550640194,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1538417744,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/svc/svcs/Makefile","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/cmd/svc/svcs/svcs.c","type":"MODIFIED","insertions":21,"deletions":-10}],"sizeInsertions":23,"sizeDeletions":-12},{"number":"4","revision":"5bd9a820c7b9db0c7dd6f79a0dcf2204a5a99bcb","parents":["20cd42d3954fb7e0280a3cf34a344db285355a0e"],"ref":"refs/changes/44/4844/4","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1550641388,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/svc/svcs/Makefile","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/cmd/svc/svcs/svcs.c","type":"MODIFIED","insertions":19,"deletions":-10}],"sizeInsertions":21,"sizeDeletions":-12},{"number":"5","revision":"429b653eef08964c884a55d20a0b470575430de9","parents":["20cd42d3954fb7e0280a3cf34a344db285355a0e"],"ref":"refs/changes/44/4844/5","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1550642188,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1550663218,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/svc/svcs/Makefile","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/cmd/svc/svcs/svcs.c","type":"MODIFIED","insertions":19,"deletions":-10}],"sizeInsertions":21,"sizeDeletions":-12},{"number":"6","revision":"2fb33b1e26a4315a645e0cae74e327ad0c084cb5","parents":["20cd42d3954fb7e0280a3cf34a344db285355a0e"],"ref":"refs/changes/44/4844/6","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1550804914,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/cmd/svc/svcs/svcs.c","line":976,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"This seems to serve no point now.  It seems that the callers should now just call `proc_get_psinfo()` directly."},{"file":"usr/src/cmd/svc/svcs/svcs.c","line":976,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Yeah good point.  I\u0027ll update it and retest (just to be safe) and post the update after that."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/svc/svcs/Makefile","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"usr/src/cmd/svc/svcs/svcs.c","type":"MODIFIED","insertions":17,"deletions":-18}],"sizeInsertions":20,"sizeDeletions":-21},{"number":"7","revision":"29c828d67be0feb30948aa232a98a28edea8aff8","parents":["20cd42d3954fb7e0280a3cf34a344db285355a0e"],"ref":"refs/changes/44/4844/7","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1550874994,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1550944136,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1550877220,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/svc/svcs/Makefile","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"usr/src/cmd/svc/svcs/svcs.c","type":"MODIFIED","insertions":11,"deletions":-26}],"sizeInsertions":14,"sizeDeletions":-29},{"number":"8","revision":"808d33e224f81a93d48b4741801765e53a4c7f9d","parents":["20cd42d3954fb7e0280a3cf34a344db285355a0e"],"ref":"refs/changes/44/4844/8","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1550946797,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1550944136,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1550877220,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/cmd/svc/svcs/Makefile","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"usr/src/cmd/svc/svcs/svcs.c","type":"MODIFIED","insertions":11,"deletions":-26}],"sizeInsertions":14,"sizeDeletions":-29},{"number":"9","revision":"540be08e437ce290999b29a244386a4283dca907","parents":["9b2ce9c90f656792c9d27ec8cbcec521f3f8922f"],"ref":"refs/changes/44/4844/9","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1550946846,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1550944136,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}},{"type":"SUBM","value":"1","grantedOn":1550946867,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1550877220,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/cmd/svc/svcs/Makefile","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"usr/src/cmd/svc/svcs/svcs.c","type":"MODIFIED","insertions":11,"deletions":-26}],"sizeInsertions":14,"sizeDeletions":-29}],"allReviewers":[{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}]}