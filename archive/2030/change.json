{"project":"joyent/illumos-joyent","branch":"master","id":"Ic2fb4392b576cba91431f35fe39f6004e3a7e148","number":"2030","subject":"OS-6137 illumos#8149 introduced deadlock between device detach and kstat read Reviewed by: Robert Mustacchi \u003crm@joyent.com\u003e Reviewed by: Bryan Cantrill \u003cbryan@joyent.com\u003e Approved by: Bryan Cantrill \u003cbryan@joyent.com\u003e","owner":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"url":"https://cr.joyent.us/2030","commitMessage":"OS-6137 illumos#8149 introduced deadlock between device detach and kstat read\nReviewed by: Robert Mustacchi \u003crm@joyent.com\u003e\nReviewed by: Bryan Cantrill \u003cbryan@joyent.com\u003e\nApproved by: Bryan Cantrill \u003cbryan@joyent.com\u003e\n","createdOn":1496367279,"lastUpdated":1496678772,"open":false,"status":"MERGED","comments":[{"timestamp":1496367279,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Uploaded patch set 1."},{"timestamp":1496367618,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Patch Set 1:\n\nWe don\u0027t need to hold the softmac device while trying to grab a devnet reference because for a softmac to detach it first needs to call dls_devnet_unset(). And that function synchronizes with the various devnet hold functions via the i_dls_devnet_lock."},{"timestamp":1496417866,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 1: Code-Review+1\n\nI think this makes sense. Can you make sure that the analysis you have here is in the ticket. We should also probably follow up with upstream on this change."},{"timestamp":1496424561,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Patch Set 1:\n\nAdded testing notes to the ticket."},{"timestamp":1496448577,"reviewer":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"message":"Patch Set 1: Code-Review+1 Integration-Approval+1"},{"timestamp":1496678595,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Uploaded patch set 2: Patch Set 1 was rebased."},{"timestamp":1496678759,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Uploaded patch set 3: Commit message was updated."},{"timestamp":1496678772,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Ryan Zezeski"}],"currentPatchSet":{"number":"3","revision":"c2fb4392b576cba91431f35fe39f6004e3a7e148","parents":["db860a9da66f2fd61f7f2cbaa5bd7f7028fb4767"],"ref":"refs/changes/30/2030/3","uploader":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"createdOn":1496678759,"author":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1496417866,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1496448577,"by":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1496448577,"by":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"}},{"type":"SUBM","value":"1","grantedOn":1496678772,"by":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/uts/common/io/dls/dls_mgmt.c","type":"MODIFIED","insertions":5,"deletions":-27}],"sizeInsertions":5,"sizeDeletions":-27},"patchSets":[{"number":"1","revision":"53f4544ae4ad8320e2cd93333c69bd7580754889","parents":["436974b4ff52a42762168eebf02f0457894b526b"],"ref":"refs/changes/30/2030/1","uploader":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"createdOn":1496367279,"author":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1496417866,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1496448577,"by":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1496448577,"by":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/io/dls/dls_mgmt.c","type":"MODIFIED","insertions":5,"deletions":-27}],"sizeInsertions":5,"sizeDeletions":-27},{"number":"2","revision":"e097e4ff0582ea7b3ce8b69073fcc11784b457d5","parents":["db860a9da66f2fd61f7f2cbaa5bd7f7028fb4767"],"ref":"refs/changes/30/2030/2","uploader":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"createdOn":1496678595,"author":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1496417866,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1496448577,"by":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1496448577,"by":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/io/dls/dls_mgmt.c","type":"MODIFIED","insertions":5,"deletions":-27}],"sizeInsertions":5,"sizeDeletions":-27},{"number":"3","revision":"c2fb4392b576cba91431f35fe39f6004e3a7e148","parents":["db860a9da66f2fd61f7f2cbaa5bd7f7028fb4767"],"ref":"refs/changes/30/2030/3","uploader":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"createdOn":1496678759,"author":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1496417866,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1496448577,"by":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1496448577,"by":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"}},{"type":"SUBM","value":"1","grantedOn":1496678772,"by":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/uts/common/io/dls/dls_mgmt.c","type":"MODIFIED","insertions":5,"deletions":-27}],"sizeInsertions":5,"sizeDeletions":-27}],"allReviewers":[{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"}]}