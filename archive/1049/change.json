{"project":"joyent/manta-muskie","branch":"master","id":"Ie1c45034338460a634c8e5332c7ce76411445e20","number":"1049","subject":"MANTA-2999 muskie: Upgrade Node.js version from 0.10 to 4.x (or 6.x) before its EOL in Oct 2016 Reviewed by: David Pacheco \u003cdap@joyent.com\u003e Reviewed by: Jordan Hendricks \u003cjordan.hendricks@joyent.com\u003e","owner":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"url":"https://cr.joyent.us/1049","commitMessage":"MANTA-2999 muskie: Upgrade Node.js version from 0.10 to 4.x (or 6.x) before its EOL in Oct 2016\nReviewed by: David Pacheco \u003cdap@joyent.com\u003e\nReviewed by: Jordan Hendricks \u003cjordan.hendricks@joyent.com\u003e\n","createdOn":1480706604,"lastUpdated":1546453027,"open":true,"status":"NEW","comments":[{"timestamp":1480706604,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 1."},{"timestamp":1480706635,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 1: Integration-Approval-1"},{"timestamp":1480706679,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing-1\n\n(1 comment)\n\n\"make check\" exited with status 2"},{"timestamp":1480706850,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 2."},{"timestamp":1480706986,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing-1\n\n(1 comment)\n\n\"make check\" exited with status 2"},{"timestamp":1481742456,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 3."},{"timestamp":1481742473,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 3: -Integration-Approval"},{"timestamp":1481742498,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1481743550,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 3:\n\n(13 comments)"},{"timestamp":1481802720,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 3:\n\n(12 comments)\n\nDave, all the comments replied and a new patch pushed for review including some of your suggested changes. I\u0027m adding Jordan as a reviewer too as you suggested"},{"timestamp":1481802729,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 4."},{"timestamp":1481802771,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1481839054,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Patch Set 3:\n\n(1 comment)\n\nI would like to see if Dave has any follow-up questions before you before giving a +1.\n\nHow did you test this change?"},{"timestamp":1481892324,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 5."},{"timestamp":1481892357,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1481892423,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 5:\n\n(1 comment)\n\nSounds good Jordan.\n\nSo far I\u0027ve been testing it just using the test suite in COAL. Any ideas about further testing would be appreciated, though."},{"timestamp":1482517088,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 6."},{"timestamp":1482517135,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 6: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1482517929,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 7."},{"timestamp":1482517961,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 7: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1486064680,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 4:\n\n(7 comments)\n\nSorry again for being behind on reviewing this.  I\u0027ve commented on a few items below.  Like the libmanta change, there are a few other high-priority changes coming, so the best thing is probably to wait for those, then sync this up, and look at it again.  I\u0027m sure it\u0027s close to ready as it is."},{"timestamp":1497285723,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 8."},{"timestamp":1497285751,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 8: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1497305450,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 8:\n\n(9 comments)\n\nIt looks like this was probably a rebase, but that was not recognized by Gerrit.  (Maybe there were other changes included as well?)  So I basically ended up re-reviewing this from scratch.  Sorry if some of these comments re-hash something we discussed earlier."},{"timestamp":1498237442,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 9."},{"timestamp":1498240661,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 10."},{"timestamp":1498240709,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 10:\n\n(8 comments)\n\nMore fixes, mostly related to MPU and node-restify#1380 and some comments/questions. Test suite passing so far"},{"timestamp":1498250922,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 10: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1498671593,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 11: Patch Set 10 was rebased."},{"timestamp":1498671626,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 11:\n\n\"make check\" passed ok"},{"timestamp":1499094616,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 12: Patch Set 11 was rebased."},{"timestamp":1499094643,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 12:\n\n\"make check\" passed ok"},{"timestamp":1499098123,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 12:\n\nI\u0027ve just added details of a fresh VM image built using the latest bits on this CR to the JIRA issue. Obviously, there\u0027s still a change pending to package.json here when we merge libmanta and marlin into their respective masters but, other than that, pretty much everything is finished here and waiting for some more testing."},{"timestamp":1500502140,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 8:\n\n(2 comments)\n\nThanks for your patience, Pedro.  I\u0027ve been pretty behind on a lot of reviews."},{"timestamp":1546453027,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 12:\n\n\"make check\" passed ok"}],"currentPatchSet":{"number":"12","revision":"e1c45034338460a634c8e5332c7ce76411445e20","parents":["7dd22c493b5ba6d7e4d731f6a7cbf0b28251d860"],"ref":"refs/changes/49/1049/12","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1499094616,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1498250922,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/common.js","type":"MODIFIED","insertions":0,"deletions":-7},{"file":"lib/errors.js","type":"MODIFIED","insertions":6,"deletions":-6},{"file":"lib/obj.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/picker.js","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"lib/server.js","type":"MODIFIED","insertions":18,"deletions":-11},{"file":"lib/shark_client.js","type":"MODIFIED","insertions":11,"deletions":-5},{"file":"package.json","type":"MODIFIED","insertions":14,"deletions":-14},{"file":"test/mpu/abort.test.js","type":"MODIFIED","insertions":5,"deletions":-4},{"file":"test/obj.test.js","type":"MODIFIED","insertions":9,"deletions":0},{"file":"tools/jsl.node.conf","type":"MODIFIED","insertions":1,"deletions":0}],"sizeInsertions":67,"sizeDeletions":-51},"patchSets":[{"number":"1","revision":"a9703836033fb36c9f4794fb86db5ab70a6e7d5e","parents":["3e0599ae0391733c19fd2253a27ab932a3d20bd9"],"ref":"refs/changes/49/1049/1","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1480706604,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1480706679,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"-1","grantedOn":1480706635,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"comments":[{"file":"lib/server.js","line":79,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"unparenthesized return expression"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"etc/config.coal.json","type":"MODIFIED","insertions":23,"deletions":-2},{"file":"lib/common.js","type":"MODIFIED","insertions":1,"deletions":-8},{"file":"lib/medusa/connector.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/picker.js","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"lib/server.js","type":"MODIFIED","insertions":5,"deletions":-5},{"file":"lib/shark_client.js","type":"MODIFIED","insertions":13,"deletions":-7},{"file":"package.json","type":"MODIFIED","insertions":17,"deletions":-17}],"sizeInsertions":66,"sizeDeletions":-47},{"number":"2","revision":"584abd5d73b0bba6cc77c30191085c1ad794b0b5","parents":["ecbf9f19cc49d6538dc53a3d094d1a4719a2332e"],"ref":"refs/changes/49/1049/2","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1480706850,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1480706986,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"-1","grantedOn":1480706635,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"comments":[{"file":"lib/server.js","line":79,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"unparenthesized return expression"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"etc/config.coal.json","type":"MODIFIED","insertions":23,"deletions":-2},{"file":"lib/common.js","type":"MODIFIED","insertions":1,"deletions":-8},{"file":"lib/medusa/connector.js","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"lib/picker.js","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"lib/server.js","type":"MODIFIED","insertions":5,"deletions":-5},{"file":"lib/shark_client.js","type":"MODIFIED","insertions":13,"deletions":-7},{"file":"package.json","type":"MODIFIED","insertions":16,"deletions":-16}],"sizeInsertions":73,"sizeDeletions":-44},{"number":"3","revision":"0f3cff98ffa3e4a4facedead4dabf5e1f30c68a7","parents":["ecbf9f19cc49d6538dc53a3d094d1a4719a2332e"],"ref":"refs/changes/49/1049/3","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1481742456,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1481742498,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"etc/config.coal.json","line":25,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"This shouldn\u0027t be necessary."},{"file":"lib/common.js","line":859,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I\u0027m glad we can get rid of this, but what changed here?"},{"file":"lib/common.js","line":859,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"req._path has been removed by restify commit https://github.com/restify/node-restify/commit/557e6aaf994da6dd573be0ef55c9530a5cd5c09. Also, this is a legacy thing which was changed during the upgrade from restify 1.4 to 2.0. restify.sanitizePath() should take care of this as explained here https://github.com/restify/node-restify/issues/285"},{"file":"lib/errors.js","line":503,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Why was this change needed?"},{"file":"lib/errors.js","line":503,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"This change is not strictly required, but I\u0027d say we should modify the error name to match official IANA status code name. Restify and NodeJS already made such change and our only reason to keep the old name here is that it was the option chosen by NodeJS before.\n\nNode change: https://github.com/nodejs/node/commit/2d9456e3e61cf969d5cd11ad85484aa961844ff6#diff-feaf3339998a19f0baf3f82414762c22\n\nRestify related change: https://github.com/restify/node-restify/commit/c803dbb6ecab02d6fcff962671de6c49d165338b\n\nOf course, this is a personal opinion and we can left the old name unmodified"},{"file":"lib/errors.js","line":503,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"This would presumably break consumers that are looking to handle this error, though I don\u0027t think it\u0027s really that handleable anyway."},{"file":"lib/errors.js","line":606,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Why was this change needed?"},{"file":"lib/errors.js","line":606,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"It isn\u0027t needed at all, but I\u0027m wondering why are we using Restify\u0027s ResourceNotFoundError when we\u0027re creating and exporting our own ResourceNotFoundError in errors.js?"},{"file":"lib/errors.js","line":606,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"That\u0027s a good question.  I don\u0027t know the answer, but I\u0027m not sure that means it\u0027s good to change it here."},{"file":"lib/medusa/connector.js","line":57,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I think I just removed these.  These shouldn\u0027t be necessary."},{"file":"lib/medusa/connector.js","line":57,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Sure. Just the retry options or also the reconnect one?"},{"file":"lib/medusa/connector.js","line":57,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Both, but this will probably be updated when you sync up."},{"file":"lib/picker.js","line":319,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Same here -- these should not be necessary."},{"file":"lib/picker.js","line":319,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Same question here"},{"file":"lib/picker.js","line":319,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Same answer :)"},{"file":"lib/server.js","line":47,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Why did this become an asynchronous function?"},{"file":"lib/server.js","line":47,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"This is one of the more notable backward incompatible changes for restify v4. The relevant restify issue is here: https://github.com/restify/node-restify/pull/851#issuecomment-251541881"},{"file":"lib/server.js","line":47,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"I don\u0027t believe \u0027return\u0027 is needed here since the callback is being invoked, and muskie has generally avoided writing \"return (callback)\" from what I have seen."},{"file":"lib/server.js","line":47,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Good call! Done."},{"file":"lib/server.js","line":47,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"In that case, I think we should use setImmediate so that this actually is asynchronous."},{"file":"lib/server.js","line":169,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"What\u0027s the story with req._path vs. req.url?"},{"file":"lib/server.js","line":169,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"req._path has been removed by commit https://github.com/restify/node-restify/commit/557e6aaf994da6dd573be0ef55c9530a5cd5c091 and the only property used now when calling functions like getUrl() or getPath() is `req.url`"},{"file":"lib/shark_client.js","line":133,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Thanks for the explanation here, though I think you can leave out the comment."},{"file":"lib/shark_client.js","line":133,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"package.json","line":13,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"This was a breaking change.  Have you already looked at all instances of assertplus.object() ?  I remember going through this with some repo already -- was it node-libmanta?"},{"file":"package.json","line":13,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"It has been way easier for this repo than for node-libmanta, which was supposed to be used as a module by other projects. On this case, most of the object assertions are regarding objects which, in turn, include some properties which are also assertion targets.\n\nFor the few exceptions, I assumed the only thing which would call this repo code is this repo code itself, and I just checked that the object invocations were always made with proper objects."},{"file":"package.json","line":13,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Thanks!"},{"file":"package.json","line":24,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Presumably this needs to be updated before integration."},{"file":"package.json","line":24,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Correct, passing muskie tests is a requirement to merge libmanta branch into master"},{"file":"package.json","line":29,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Ditto -- will need to be updated before integration."},{"file":"package.json","line":29,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Exactly. Indeed, it was your idea to run muskie tests with updated marlin as a good way to check if it was Integration ready :-)"},{"file":"test/obj.test.js","line":599,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Is there some way we could support this test in COAL?"},{"file":"test/obj.test.js","line":599,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"I don\u0027t think so. If I\u0027m not on a mistake, the only way to reach the code which may raise a `NotEnoughSpaceError` would be setting multiDC to true, which would require the kind of setup we usually don\u0027t have in COAL"},{"file":"test/obj.test.js","line":599,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"It seems like attempting to create an object that large should fail on COAL just as it fails in a lab or production deployment."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"etc/config.coal.json","type":"MODIFIED","insertions":23,"deletions":-2},{"file":"lib/common.js","type":"MODIFIED","insertions":1,"deletions":-8},{"file":"lib/errors.js","type":"MODIFIED","insertions":7,"deletions":-7},{"file":"lib/medusa/connector.js","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"lib/obj.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/picker.js","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"lib/server.js","type":"MODIFIED","insertions":5,"deletions":-5},{"file":"lib/shark_client.js","type":"MODIFIED","insertions":13,"deletions":-7},{"file":"package.json","type":"MODIFIED","insertions":16,"deletions":-16},{"file":"test/obj.test.js","type":"MODIFIED","insertions":9,"deletions":0},{"file":"tools/jsl.node.conf","type":"MODIFIED","insertions":1,"deletions":0}],"sizeInsertions":91,"sizeDeletions":-52},{"number":"4","revision":"b82d65ae4933a2a50b4b4a17b5b7592a5b6ac66e","parents":["ecbf9f19cc49d6538dc53a3d094d1a4719a2332e"],"ref":"refs/changes/49/1049/4","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1481802729,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1481802771,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"etc/config.coal.json","type":"MODIFIED","insertions":23,"deletions":-2},{"file":"lib/common.js","type":"MODIFIED","insertions":1,"deletions":-8},{"file":"lib/errors.js","type":"MODIFIED","insertions":7,"deletions":-7},{"file":"lib/medusa/connector.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/obj.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/picker.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/server.js","type":"MODIFIED","insertions":5,"deletions":-5},{"file":"lib/shark_client.js","type":"MODIFIED","insertions":12,"deletions":-7},{"file":"package.json","type":"MODIFIED","insertions":16,"deletions":-16},{"file":"test/obj.test.js","type":"MODIFIED","insertions":9,"deletions":0},{"file":"tools/jsl.node.conf","type":"MODIFIED","insertions":1,"deletions":0}],"sizeInsertions":82,"sizeDeletions":-52},{"number":"5","revision":"238c16e2efb11c24241948772e5ae527401387ec","parents":["ecbf9f19cc49d6538dc53a3d094d1a4719a2332e"],"ref":"refs/changes/49/1049/5","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1481892324,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1481892357,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"etc/config.coal.json","type":"MODIFIED","insertions":23,"deletions":-2},{"file":"lib/common.js","type":"MODIFIED","insertions":1,"deletions":-8},{"file":"lib/errors.js","type":"MODIFIED","insertions":7,"deletions":-7},{"file":"lib/medusa/connector.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/obj.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/picker.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/server.js","type":"MODIFIED","insertions":5,"deletions":-5},{"file":"lib/shark_client.js","type":"MODIFIED","insertions":12,"deletions":-7},{"file":"package.json","type":"MODIFIED","insertions":16,"deletions":-16},{"file":"test/obj.test.js","type":"MODIFIED","insertions":9,"deletions":0},{"file":"tools/jsl.node.conf","type":"MODIFIED","insertions":1,"deletions":0}],"sizeInsertions":82,"sizeDeletions":-52},{"number":"6","revision":"b9c834c65e19dae6b14ff8558640f06f285c3198","parents":["ecbf9f19cc49d6538dc53a3d094d1a4719a2332e"],"ref":"refs/changes/49/1049/6","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1482517088,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1482517135,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"etc/config.coal.json","type":"MODIFIED","insertions":23,"deletions":-2},{"file":"lib/common.js","type":"MODIFIED","insertions":1,"deletions":-8},{"file":"lib/errors.js","type":"MODIFIED","insertions":7,"deletions":-7},{"file":"lib/medusa/connector.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/obj.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/picker.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/server.js","type":"MODIFIED","insertions":5,"deletions":-5},{"file":"lib/shark_client.js","type":"MODIFIED","insertions":12,"deletions":-7},{"file":"package.json","type":"MODIFIED","insertions":16,"deletions":-16},{"file":"test/obj.test.js","type":"MODIFIED","insertions":9,"deletions":0},{"file":"tools/jsl.node.conf","type":"MODIFIED","insertions":1,"deletions":0}],"sizeInsertions":82,"sizeDeletions":-52},{"number":"7","revision":"17584d63ac8c5d5292a876a835c84d2c79579850","parents":["1967aa4e361998676ccff4f29dcc70a10fd668e1"],"ref":"refs/changes/49/1049/7","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1482517929,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1482517961,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"etc/config.coal.json","type":"MODIFIED","insertions":7,"deletions":-2},{"file":"lib/common.js","type":"MODIFIED","insertions":1,"deletions":-8},{"file":"lib/errors.js","type":"MODIFIED","insertions":7,"deletions":-7},{"file":"lib/medusa/connector.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/obj.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/picker.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/server.js","type":"MODIFIED","insertions":5,"deletions":-5},{"file":"lib/shark_client.js","type":"MODIFIED","insertions":12,"deletions":-7},{"file":"package.json","type":"MODIFIED","insertions":16,"deletions":-16},{"file":"test/obj.test.js","type":"MODIFIED","insertions":9,"deletions":0},{"file":"tools/jsl.node.conf","type":"MODIFIED","insertions":1,"deletions":0}],"sizeInsertions":66,"sizeDeletions":-52},{"number":"8","revision":"bb897d42f84f2edf8fac216af62a0335b96a73f6","parents":["dd5e5f2f78e8e20853b73209862ca5d629fb2351"],"ref":"refs/changes/49/1049/8","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1497285723,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1497285751,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"etc/config.coal.json","line":67,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Spurious delta?"},{"file":"etc/config.coal.json","line":67,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Yes! fixing it now"},{"file":"lib/common.js","line":897,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I feel like we probably talked about this, but I don\u0027t remember: why did we decide that it was okay to remove this?"},{"file":"lib/common.js","line":897,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Yeah, we already talked about this:\n\nreq._path has been removed by restify commit https://github.com/restify/node-restify/commit/557e6aaf994da6dd573be0ef55c9530a5cd5c09. Also, this is a legacy thing which was changed during the upgrade from restify 1.4 to 2.0. restify.sanitizePath() should take care of this as explained here https://github.com/restify/node-restify/issues/285"},{"file":"lib/errors.js","line":540,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Did we already determine that this has no compatibility implications?"},{"file":"lib/errors.js","line":540,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I went back to the previous discussion, but I\u0027m still not sure there aren\u0027t compatibility implications to changing this."},{"file":"lib/picker.js","line":410,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Spurious?"},{"file":"lib/picker.js","line":347,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Spurious?"},{"file":"lib/picker.js","line":347,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/server.js","line":48,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Why did this become asynchronous?  Was that a restify change?"},{"file":"lib/server.js","line":48,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"https://github.com/restify/node-restify/pull/851#issuecomment-251541881"},{"file":"lib/shark_client.js","line":138,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Why was this change made?"},{"file":"lib/shark_client.js","line":138,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Core HTTP Request \"setHeader\" method will throw an exception when trying to set a header to an undefined value.\n\nAlso, note I added a comment here, with exactly this explanation and you suggested me to remove here: https://cr.joyent.us/#/c/1049/3/lib/shark_client.js ;-)"},{"file":"package.json","line":0,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Obviously, this has a few items that need to be changed before integration."},{"file":"package.json","line":0,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Yeah, this is just to be able to build an image with the updated code from other modules. (updates-imgadm get ed1f9e0e-4f9a-11e7-bf44-2fdb523bc073 -C experimental). I\u0027ll probably build another one with up2date code once we consider this issue done and before move forward."},{"file":"test/obj.test.js","line":607,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Isn\u0027t this a bug in the test?"},{"file":"test/obj.test.js","line":607,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Well, I\u0027d say it is. Anyway, any better ideas for COAL?"},{"file":"test/obj.test.js","line":607,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I think COAL should not have a mode that says to ignore the size check.  I assume you were running into MANTA-2500?  \n\nI think we should probably revert MANTA-2510 and replace that instead with a SAPI tunable that\u0027s the space required for streaming uploads.  For COAL, manta-init should set the tunable to something more reasonable.  Nothing aside from manta-init should need to check whether something is COAL."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"etc/config.coal.json","type":"MODIFIED","insertions":1,"deletions":0},{"file":"lib/common.js","type":"MODIFIED","insertions":0,"deletions":-7},{"file":"lib/errors.js","type":"MODIFIED","insertions":6,"deletions":-6},{"file":"lib/obj.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/picker.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/server.js","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"lib/shark_client.js","type":"MODIFIED","insertions":11,"deletions":-5},{"file":"package.json","type":"MODIFIED","insertions":14,"deletions":-14},{"file":"test/obj.test.js","type":"MODIFIED","insertions":9,"deletions":0},{"file":"tools/jsl.node.conf","type":"MODIFIED","insertions":1,"deletions":0}],"sizeInsertions":50,"sizeDeletions":-40},{"number":"9","revision":"3344b003c4ce42dacbaa850272a686395f6d4442","parents":["dd5e5f2f78e8e20853b73209862ca5d629fb2351"],"ref":"refs/changes/49/1049/9","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1498237442,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","comments":[{"file":"lib/server.js","line":472,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Note that all the added contentTypes here are due to restify/node-restify#1380.\n\nAdditionally, and even in the case of back porting the fixed issue into muskie, I\u0027d say we should go for Typed routes here, so we could just avoid another loop over all candidate routes due to similarities into paths, for example, between: \u0027/:account/uploads/[0-f]+/:id/state\u0027, \u0027/:account/uploads/[0-f]+/:id/abort\u0027, \u0027/:account/uploads/[0-f]+/:id/commit\u0027 and \u0027/:account/uploads/[0-f]+/:id/:partNum\u0027\n\nOut of curiosity, is there any reason we\u0027re explicitly adding Forbidden responses instead of just leaving that to Restify, despite of the status code returned on those cases?"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"etc/config.coal.json","type":"MODIFIED","insertions":1,"deletions":0},{"file":"lib/common.js","type":"MODIFIED","insertions":0,"deletions":-7},{"file":"lib/errors.js","type":"MODIFIED","insertions":6,"deletions":-6},{"file":"lib/obj.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/picker.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/server.js","type":"MODIFIED","insertions":18,"deletions":-11},{"file":"lib/shark_client.js","type":"MODIFIED","insertions":11,"deletions":-5},{"file":"package.json","type":"MODIFIED","insertions":14,"deletions":-14},{"file":"test/mpu/abort.test.js","type":"MODIFIED","insertions":5,"deletions":-4},{"file":"test/obj.test.js","type":"MODIFIED","insertions":9,"deletions":0},{"file":"tools/jsl.node.conf","type":"MODIFIED","insertions":1,"deletions":0}],"sizeInsertions":69,"sizeDeletions":-51},{"number":"10","revision":"b340c0b1ebd25bb788123b41a07154e088bbe5f7","parents":["dd5e5f2f78e8e20853b73209862ca5d629fb2351"],"ref":"refs/changes/49/1049/10","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1498240661,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1498250922,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/common.js","type":"MODIFIED","insertions":0,"deletions":-7},{"file":"lib/errors.js","type":"MODIFIED","insertions":6,"deletions":-6},{"file":"lib/obj.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/picker.js","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"lib/server.js","type":"MODIFIED","insertions":18,"deletions":-11},{"file":"lib/shark_client.js","type":"MODIFIED","insertions":11,"deletions":-5},{"file":"package.json","type":"MODIFIED","insertions":14,"deletions":-14},{"file":"test/mpu/abort.test.js","type":"MODIFIED","insertions":5,"deletions":-4},{"file":"test/obj.test.js","type":"MODIFIED","insertions":9,"deletions":0},{"file":"tools/jsl.node.conf","type":"MODIFIED","insertions":1,"deletions":0}],"sizeInsertions":67,"sizeDeletions":-51},{"number":"11","revision":"1ba0ea928863f1205f4d919a67dff9af33401f80","parents":["35b8ea02960fa2f053fc90c66667f5efe997b56c"],"ref":"refs/changes/49/1049/11","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1498671593,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1498250922,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/common.js","type":"MODIFIED","insertions":0,"deletions":-7},{"file":"lib/errors.js","type":"MODIFIED","insertions":6,"deletions":-6},{"file":"lib/obj.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/picker.js","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"lib/server.js","type":"MODIFIED","insertions":18,"deletions":-11},{"file":"lib/shark_client.js","type":"MODIFIED","insertions":11,"deletions":-5},{"file":"package.json","type":"MODIFIED","insertions":14,"deletions":-14},{"file":"test/mpu/abort.test.js","type":"MODIFIED","insertions":5,"deletions":-4},{"file":"test/obj.test.js","type":"MODIFIED","insertions":9,"deletions":0},{"file":"tools/jsl.node.conf","type":"MODIFIED","insertions":1,"deletions":0}],"sizeInsertions":67,"sizeDeletions":-51},{"number":"12","revision":"e1c45034338460a634c8e5332c7ce76411445e20","parents":["7dd22c493b5ba6d7e4d731f6a7cbf0b28251d860"],"ref":"refs/changes/49/1049/12","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1499094616,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1498250922,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/common.js","type":"MODIFIED","insertions":0,"deletions":-7},{"file":"lib/errors.js","type":"MODIFIED","insertions":6,"deletions":-6},{"file":"lib/obj.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/picker.js","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"lib/server.js","type":"MODIFIED","insertions":18,"deletions":-11},{"file":"lib/shark_client.js","type":"MODIFIED","insertions":11,"deletions":-5},{"file":"package.json","type":"MODIFIED","insertions":14,"deletions":-14},{"file":"test/mpu/abort.test.js","type":"MODIFIED","insertions":5,"deletions":-4},{"file":"test/obj.test.js","type":"MODIFIED","insertions":9,"deletions":0},{"file":"tools/jsl.node.conf","type":"MODIFIED","insertions":1,"deletions":0}],"sizeInsertions":67,"sizeDeletions":-51}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"}]}