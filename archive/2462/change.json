{"project":"joyent/smartos-live","branch":"master","id":"Ida3973dedc9cf4d0ac7ada41046bd2199847884f","number":"2462","subject":"OS-6311 test-delete.js: prefer node libuuid binding over external utility Reviewed by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e Reviewed by: Josh Wilsdon \u003cjosh@wilsdon.ca\u003e Approved by: Josh Wilsdon \u003cjosh@wilsdon.ca\u003e","owner":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"url":"https://cr.joyent.us/2462","commitMessage":"OS-6311 test-delete.js: prefer node libuuid binding over external utility\nReviewed by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e\nReviewed by: Josh Wilsdon \u003cjosh@wilsdon.ca\u003e\nApproved by: Josh Wilsdon \u003cjosh@wilsdon.ca\u003e\n","createdOn":1503676939,"lastUpdated":1506012866,"open":false,"status":"MERGED","comments":[{"timestamp":1503676939,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Uploaded patch set 1."},{"timestamp":1503676942,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit 5b4623586aef72c3a09aa4247f78daa608406876\n    \n    initial commit"},{"timestamp":1503676980,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1503677716,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Uploaded patch set 2."},{"timestamp":1503677720,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit d127add5f685fa96518e7251e8630189071a3556\n    \n    this if-statement was vminfod specific"},{"timestamp":1503677757,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1504201180,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 2: Code-Review+1"},{"timestamp":1504628552,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Uploaded patch set 3."},{"timestamp":1504628598,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1504736337,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1505755131,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 3:\n\n(1 comment)"},{"timestamp":1505953903,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 3: Code-Review+1 Integration-Approval+1\n\n(1 comment)\n\nLooks good to me, if you want to go and add a check on the deletion first that\u0027s fine too."},{"timestamp":1506011406,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 3:\n\n(1 comment)"},{"timestamp":1506012823,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 4: Patch Set 3 was rebased"},{"timestamp":1506012837,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Uploaded patch set 5: Commit message was updated."},{"timestamp":1506012865,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Dave Eddy"},{"timestamp":1506012866,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4:\n\n\"make check\" passed ok"}],"currentPatchSet":{"number":"5","revision":"da3973dedc9cf4d0ac7ada41046bd2199847884f","parents":["06dc20a6c060bebf05dd88016ded63f0ed02ae30"],"ref":"refs/changes/62/2462/5","uploader":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"createdOn":1506012837,"author":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1504628598,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1504736337,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1505953903,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1505953903,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"SUBM","value":"1","grantedOn":1506012865,"by":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"src/vm/tests/test-delete.js","type":"MODIFIED","insertions":11,"deletions":-40}],"sizeInsertions":11,"sizeDeletions":-40},"patchSets":[{"number":"1","revision":"6cb217331952ca2b5da3fa7fc170e960d9c68d34","parents":["ed7577cb855337d9a93e66fa0eb73eb604fe8f04"],"ref":"refs/changes/62/2462/1","uploader":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"createdOn":1503676939,"author":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1503676980,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/vm/tests/test-delete.js","type":"MODIFIED","insertions":11,"deletions":-40}],"sizeInsertions":11,"sizeDeletions":-40},{"number":"2","revision":"60ff42d6c34d57fa487b78acb512294755582f3f","parents":["ed7577cb855337d9a93e66fa0eb73eb604fe8f04"],"ref":"refs/changes/62/2462/2","uploader":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"createdOn":1503677716,"author":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1503677757,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1504201180,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/vm/tests/test-delete.js","type":"MODIFIED","insertions":11,"deletions":-40}],"sizeInsertions":11,"sizeDeletions":-40},{"number":"3","revision":"2d7a7265f29abc004902cbb0e16915f8bb1f4485","parents":["02903085fdcd37f35b712d4f2012eae108051838"],"ref":"refs/changes/62/2462/3","uploader":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"createdOn":1504628552,"author":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1504628598,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1504736337,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1505953903,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1505953903,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}}],"comments":[{"file":"src/vm/tests/test-delete.js","line":32,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"The idea of this scares me.  I realize how unique UUID\u0027s are supposed to be - but I don\u0027t know if we should be OK with the idea of this test having the non-zero probability of deleting any VM on the system.  Perhaps doing a load first to ensure the VM doesn\u0027t exist may be preferable?"},{"file":"src/vm/tests/test-delete.js","line":32,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"fwiw: the running of these tests is also gated via runtest(s) on the /lib/sdc/.sdc-test-no-production-data file existing. So worst case we\u0027re deleting a VM on a non-production system. However, having a check to ensure the VM doesn\u0027t exist first doesn\u0027t seem like the worst thing ever either. If we have UUID collisions however I think we have a lot bigger problems."},{"file":"src/vm/tests/test-delete.js","line":32,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Ah good point about the .sdc-test-no-production-data file which explicitly says there is no production data on the machine.\n\nPersonally, I\u0027m fine with this change as-is, since the chance of any sort of UUID is collision is extraordinarily low - I just know precedent has been set inside VM.js (https://github.com/joyent/smartos-live/blob/master/src/vm/node_modules/VM.js#L4030-L4082).  The function _assertUUIDUnique is called inside createZoneUUID to ensure that any new UUID created for a zone does not already exist on the system."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"src/vm/tests/test-delete.js","type":"MODIFIED","insertions":11,"deletions":-40}],"sizeInsertions":11,"sizeDeletions":-40},{"number":"4","revision":"7f530c55890af1dfb4917b91ea3e7bf63cf385f4","parents":["06dc20a6c060bebf05dd88016ded63f0ed02ae30"],"ref":"refs/changes/62/2462/4","uploader":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"createdOn":1506012823,"author":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1504628598,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1504736337,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1505953903,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1505953903,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"src/vm/tests/test-delete.js","type":"MODIFIED","insertions":11,"deletions":-40}],"sizeInsertions":11,"sizeDeletions":-40},{"number":"5","revision":"da3973dedc9cf4d0ac7ada41046bd2199847884f","parents":["06dc20a6c060bebf05dd88016ded63f0ed02ae30"],"ref":"refs/changes/62/2462/5","uploader":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"createdOn":1506012837,"author":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1504628598,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1504736337,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1505953903,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1505953903,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"SUBM","value":"1","grantedOn":1506012865,"by":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"src/vm/tests/test-delete.js","type":"MODIFIED","insertions":11,"deletions":-40}],"sizeInsertions":11,"sizeDeletions":-40}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"}]}