From eb48990c0db8917664800dbfd46c2a2fe7a3e102 Mon Sep 17 00:00:00 2001
From: Jerry Jelinek <jerry.jelinek@joyent.com>
Date: Mon, 17 Oct 2016 17:26:36 +0000
Subject: [PATCH]  7029 want per-process exploit mitigation features (secflags)

---
 overlay/generic/usr/lib/brand/joyent-minimal/config.xml | 1 +
 overlay/generic/usr/lib/brand/joyent-minimal/manifests  | 1 +
 overlay/generic/usr/lib/brand/joyent/config.xml         | 1 +
 overlay/generic/usr/lib/brand/joyent/manifests          | 1 +
 overlay/generic/usr/lib/brand/lx/config.xml             | 1 +
 5 files changed, 5 insertions(+)

diff --git a/overlay/generic/usr/lib/brand/joyent-minimal/config.xml b/overlay/generic/usr/lib/brand/joyent-minimal/config.xml
index fd8c5aec..64e92464 100644
--- a/overlay/generic/usr/lib/brand/joyent-minimal/config.xml
+++ b/overlay/generic/usr/lib/brand/joyent-minimal/config.xml
@@ -81,6 +81,7 @@
 	<privilege set="default" name="proc_lock_memory" />
 	<privilege set="default" name="proc_owner" />
 	<privilege set="default" name="proc_prioup" />
+	<privilege set="default" name="proc_secflags" />
 	<privilege set="default" name="proc_setid" />
 	<privilege set="default" name="proc_taskid" />
 	<privilege set="default" name="sys_acct" />
diff --git a/overlay/generic/usr/lib/brand/joyent-minimal/manifests b/overlay/generic/usr/lib/brand/joyent-minimal/manifests
index 37766a9c..ee68e2ca 100644
--- a/overlay/generic/usr/lib/brand/joyent-minimal/manifests
+++ b/overlay/generic/usr/lib/brand/joyent-minimal/manifests
@@ -110,6 +110,7 @@ milestone/network.xml		enabled
 system/filesystem/joyent-fs.xml	enabled
 system/filesystem/local-fs.xml	enabled
 system/name-service-cache.xml	enabled
+system/process-security.xml	enabled
 milestone/name-services.xml	enabled
 system/identity.xml		enabled
 network/network-initial.xml	enabled
diff --git a/overlay/generic/usr/lib/brand/joyent/config.xml b/overlay/generic/usr/lib/brand/joyent/config.xml
index 352911ba..c6fdb574 100644
--- a/overlay/generic/usr/lib/brand/joyent/config.xml
+++ b/overlay/generic/usr/lib/brand/joyent/config.xml
@@ -81,6 +81,7 @@
 	<privilege set="default" name="proc_lock_memory" />
 	<privilege set="default" name="proc_owner" />
 	<privilege set="default" name="proc_prioup" />
+	<privilege set="default" name="proc_secflags" />
 	<privilege set="default" name="proc_setid" />
 	<privilege set="default" name="proc_taskid" />
 	<privilege set="default" name="sys_acct" />
diff --git a/overlay/generic/usr/lib/brand/joyent/manifests b/overlay/generic/usr/lib/brand/joyent/manifests
index bf4bb1ca..df44ad64 100644
--- a/overlay/generic/usr/lib/brand/joyent/manifests
+++ b/overlay/generic/usr/lib/brand/joyent/manifests
@@ -163,6 +163,7 @@ system/manifest-import.xml				enabled
 system/mdata.xml					disabled
 system/name-service-cache.xml				enabled
 system/pfexecd.xml					enabled
+system/process-security.xml				enabled
 system/rbac.xml						enabled
 system/rcap.xml						disabled
 system/rmtmpfiles.xml					enabled
diff --git a/overlay/generic/usr/lib/brand/lx/config.xml b/overlay/generic/usr/lib/brand/lx/config.xml
index 91468518..ba2192f8 100644
--- a/overlay/generic/usr/lib/brand/lx/config.xml
+++ b/overlay/generic/usr/lib/brand/lx/config.xml
@@ -76,6 +76,7 @@
 	<privilege set="default" name="proc_clock_highres" />
 	<privilege set="default" name="proc_lock_memory" />
 	<privilege set="default" name="proc_owner" />
+	<privilege set="default" name="proc_secflags" />
 	<privilege set="default" name="proc_setid" />
 	<privilege set="default" name="proc_prioup" />
 	<privilege set="default" name="proc_taskid" />
-- 
2.21.0

