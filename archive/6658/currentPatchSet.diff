commit e6e77cf377971399074bd0d7c0d7b977ed6ca384
Author: Mike Gerdts <mike.gerdts@joyent.com>
Date:   2019-07-23T17:23:00+00:00 (3 months ago)
    
    OS-7896 need to workaround ssh failure on vmnat

diff --git a/openssh/Patches/0001-Skip-config-check.patch b/openssh/Patches/0001-Skip-config-check.patch
index dad4e84..51f9da9 100644
--- a/openssh/Patches/0001-Skip-config-check.patch
+++ b/openssh/Patches/0001-Skip-config-check.patch
@@ -1,7 +1,7 @@
-From c73038ed9429a7703b9a7d95334893d1d1fa6a78 Mon Sep 17 00:00:00 2001
+From 0c54c2356c41ac1961ac2f4372761d3b7b00c889 Mon Sep 17 00:00:00 2001
 From: oracle <solaris@oracle.com>
 Date: Mon, 3 Aug 2015 14:31:53 -0700
-Subject: [PATCH 01/35] Skip config check
+Subject: [PATCH 01/34] Skip config check
 
 #
 # This change is to remove some misleading error messages when running
diff --git a/openssh/Patches/0002-PAM-Support.patch b/openssh/Patches/0002-PAM-Support.patch
index ac3255d..e66ae0c 100644
--- a/openssh/Patches/0002-PAM-Support.patch
+++ b/openssh/Patches/0002-PAM-Support.patch
@@ -1,7 +1,7 @@
-From 38db2f2128af55e2fc1a287f114b6c67d09507ff Mon Sep 17 00:00:00 2001
+From aef43e3e38ea103e7cf78ff563f7d8aa310d88d7 Mon Sep 17 00:00:00 2001
 From: oracle <solaris@oracle.com>
 Date: Mon, 3 Aug 2015 14:34:19 -0700
-Subject: [PATCH 02/35] PAM Support
+Subject: [PATCH 02/34] PAM Support
 
 #
 # To comply to the Solaris PAM policy, the UsePAM option is changed to be
diff --git a/openssh/Patches/0003-lastlogin.patch b/openssh/Patches/0003-lastlogin.patch
index ecb2f19..0c82679 100644
--- a/openssh/Patches/0003-lastlogin.patch
+++ b/openssh/Patches/0003-lastlogin.patch
@@ -1,7 +1,7 @@
-From b06c3bd0eb76b40b9b2329bc08b4a04c5721fa8a Mon Sep 17 00:00:00 2001
+From f83213a51710e711b0e446da98691fd680a185ad Mon Sep 17 00:00:00 2001
 From: oracle <solaris@oracle.com>
 Date: Mon, 3 Aug 2015 14:34:41 -0700
-Subject: [PATCH 03/35] lastlogin
+Subject: [PATCH 03/34] lastlogin
 
 *** old/servconf.c Wed Sep 17 02:54:26 2014
 ---
diff --git a/openssh/Patches/0004-Reorganise-man-pages-into-Illumos-numbering-adjust-t.patch b/openssh/Patches/0004-Reorganise-man-pages-into-Illumos-numbering-adjust-t.patch
index 6e18be6..d44e97f 100644
--- a/openssh/Patches/0004-Reorganise-man-pages-into-Illumos-numbering-adjust-t.patch
+++ b/openssh/Patches/0004-Reorganise-man-pages-into-Illumos-numbering-adjust-t.patch
@@ -1,7 +1,7 @@
-From 77ecfcdc322fb88737ba1311d5fe0ef424de2cc0 Mon Sep 17 00:00:00 2001
+From 398483b5d2e6bf432533a0976833a885817e1e9d Mon Sep 17 00:00:00 2001
 From: oracle <solaris@oracle.com>
 Date: Mon, 3 Aug 2015 14:34:55 -0700
-Subject: [PATCH 04/35] Reorganise man pages into Illumos numbering, adjust
+Subject: [PATCH 04/34] Reorganise man pages into Illumos numbering, adjust
  text
 
 ---
diff --git a/openssh/Patches/0005-Deprecated-SunSSH-options.patch b/openssh/Patches/0005-Deprecated-SunSSH-options.patch
index 20532bb..90453d5 100644
--- a/openssh/Patches/0005-Deprecated-SunSSH-options.patch
+++ b/openssh/Patches/0005-Deprecated-SunSSH-options.patch
@@ -1,7 +1,7 @@
-From 3b68156b76d0f41f78153fa778ed294428159db7 Mon Sep 17 00:00:00 2001
+From faf224629c002dfd2c60ee2b1bbc8537aadcb49d Mon Sep 17 00:00:00 2001
 From: oracle <solaris@oracle.com>
 Date: Mon, 3 Aug 2015 14:35:12 -0700
-Subject: [PATCH 05/35] Deprecated SunSSH options
+Subject: [PATCH 05/34] Deprecated SunSSH options
 
 #
 # To make the transition from SunSSH to OpenSSH as smooth as possible, we
diff --git a/openssh/Patches/0006-GSS-store-creds-for-Solaris.patch b/openssh/Patches/0006-GSS-store-creds-for-Solaris.patch
index 7a5d332..8edba9c 100644
--- a/openssh/Patches/0006-GSS-store-creds-for-Solaris.patch
+++ b/openssh/Patches/0006-GSS-store-creds-for-Solaris.patch
@@ -1,7 +1,7 @@
-From 38ea92225566d34b1941865619a526dbacdd95fd Mon Sep 17 00:00:00 2001
+From 11974b021f0053a07bb672548a55bd7f448f8aae Mon Sep 17 00:00:00 2001
 From: oracle <solaris@oracle.com>
 Date: Mon, 3 Aug 2015 14:35:34 -0700
-Subject: [PATCH 06/35] GSS store creds for Solaris
+Subject: [PATCH 06/34] GSS store creds for Solaris
 
 ---
  configure.ac    |  3 +++
diff --git a/openssh/Patches/0007-DTrace-support-for-SFTP.patch b/openssh/Patches/0007-DTrace-support-for-SFTP.patch
index f3876dd..c73598e 100644
--- a/openssh/Patches/0007-DTrace-support-for-SFTP.patch
+++ b/openssh/Patches/0007-DTrace-support-for-SFTP.patch
@@ -1,7 +1,7 @@
-From 321b94d7b0b66c76535c1977e7fa66176c5f3ad1 Mon Sep 17 00:00:00 2001
+From d31c29ea5e2da897832de35fd2ce0b03714beffe Mon Sep 17 00:00:00 2001
 From: oracle <solaris@oracle.com>
 Date: Mon, 3 Aug 2015 14:35:43 -0700
-Subject: [PATCH 07/35] DTrace support for SFTP
+Subject: [PATCH 07/34] DTrace support for SFTP
 
 ---
  Makefile.in          | 24 ++++++++++++---
diff --git a/openssh/Patches/0008-Add-DisableBanner-option.patch b/openssh/Patches/0008-Add-DisableBanner-option.patch
index b940759..eaafa63 100644
--- a/openssh/Patches/0008-Add-DisableBanner-option.patch
+++ b/openssh/Patches/0008-Add-DisableBanner-option.patch
@@ -1,7 +1,7 @@
-From 89b96ba5c87db219f18a1640e6c1004430885e01 Mon Sep 17 00:00:00 2001
+From a0716b61818122bda873a9cff2569b35644a461c Mon Sep 17 00:00:00 2001
 From: oracle <solaris@oracle.com>
 Date: Mon, 3 Aug 2015 14:36:00 -0700
-Subject: [PATCH 08/35] Add DisableBanner option
+Subject: [PATCH 08/34] Add DisableBanner option
 
 ---
  readconf.c    | 31 +++++++++++++++++++++++++++++++
diff --git a/openssh/Patches/0009-PAM-conversation-fix.patch b/openssh/Patches/0009-PAM-conversation-fix.patch
index 6f751f5..f1fa23f 100644
--- a/openssh/Patches/0009-PAM-conversation-fix.patch
+++ b/openssh/Patches/0009-PAM-conversation-fix.patch
@@ -1,7 +1,7 @@
-From e264c94da2b26887dbc28793c6fc42385f0f8a99 Mon Sep 17 00:00:00 2001
+From 3b76d6c3ab7580dbfd256a18988a916a0c25fd50 Mon Sep 17 00:00:00 2001
 From: oracle <solaris@oracle.com>
 Date: Mon, 3 Aug 2015 14:36:13 -0700
-Subject: [PATCH 09/35] PAM conversation fix
+Subject: [PATCH 09/34] PAM conversation fix
 
 ---
  auth-pam.c | 36 ++++++++++++++++++++++++++++++++++++
diff --git a/openssh/Patches/0010-PAM-enhancements-for-Solaris.patch b/openssh/Patches/0010-PAM-enhancements-for-Solaris.patch
index c420117..793a0cd 100644
--- a/openssh/Patches/0010-PAM-enhancements-for-Solaris.patch
+++ b/openssh/Patches/0010-PAM-enhancements-for-Solaris.patch
@@ -1,7 +1,7 @@
-From b3b2132fc89d826365c93715c5dd7d5e902a789d Mon Sep 17 00:00:00 2001
+From 73c958a25fef38dc4958b1a7150c5540c1b92f78 Mon Sep 17 00:00:00 2001
 From: oracle <solaris@oracle.com>
 Date: Mon, 3 Aug 2015 14:36:19 -0700
-Subject: [PATCH 10/35] PAM enhancements for Solaris
+Subject: [PATCH 10/34] PAM enhancements for Solaris
 
 ---
  auth-pam.c     | 113 +++++++++++++++++++++++++++++++++++++++++++++++++
diff --git a/openssh/Patches/0011-SunSSH-compat-default-config-values.patch b/openssh/Patches/0011-SunSSH-compat-default-config-values.patch
index f42d6c0..1ac7876 100644
--- a/openssh/Patches/0011-SunSSH-compat-default-config-values.patch
+++ b/openssh/Patches/0011-SunSSH-compat-default-config-values.patch
@@ -1,7 +1,7 @@
-From 14e01e463b4fd9d7aa89c26d56c8bd697b6ff6af Mon Sep 17 00:00:00 2001
+From 2f80767f63392b047d2f724a22717f7006a76839 Mon Sep 17 00:00:00 2001
 From: oracle <solaris@oracle.com>
 Date: Mon, 3 Aug 2015 14:36:22 -0700
-Subject: [PATCH 11/35] SunSSH compat default config values
+Subject: [PATCH 11/34] SunSSH compat default config values
 
 Some options in OpenSSH have different default values from those in SunSSH.
 To make the transition smoother from SunSSH to OpenSSH, we change default
diff --git a/openssh/Patches/0012-Deprecate-SunSSH-compatible-server-options.patch b/openssh/Patches/0012-Deprecate-SunSSH-compatible-server-options.patch
index b74e802..80a1135 100644
--- a/openssh/Patches/0012-Deprecate-SunSSH-compatible-server-options.patch
+++ b/openssh/Patches/0012-Deprecate-SunSSH-compatible-server-options.patch
@@ -1,7 +1,7 @@
-From d8c9de9b7443dcd97469c16c9cd78925915bb99d Mon Sep 17 00:00:00 2001
+From d87f4d1de4322c31267ba612c0c5163cf09aed49 Mon Sep 17 00:00:00 2001
 From: oracle <solaris@oracle.com>
 Date: Mon, 3 Aug 2015 14:36:33 -0700
-Subject: [PATCH 12/35] Deprecate SunSSH compatible server options
+Subject: [PATCH 12/34] Deprecate SunSSH compatible server options
 
 #
 # Originally we planned to only deprecate client config (ssh_config) options
diff --git a/openssh/Patches/0013-Solaris-Auditing-support.patch b/openssh/Patches/0013-Solaris-Auditing-support.patch
index 389e171..951d5a2 100644
--- a/openssh/Patches/0013-Solaris-Auditing-support.patch
+++ b/openssh/Patches/0013-Solaris-Auditing-support.patch
@@ -1,7 +1,7 @@
-From c31040ba0ca7c7cf14b8e5f9d1c0f5eed011b909 Mon Sep 17 00:00:00 2001
+From 6a680b3bac6c15a68e0062626d0a9136a4478122 Mon Sep 17 00:00:00 2001
 From: oracle <solaris@oracle.com>
 Date: Mon, 3 Aug 2015 14:37:01 -0700
-Subject: [PATCH 13/35] Solaris Auditing support
+Subject: [PATCH 13/34] Solaris Auditing support
 
 ---
  INSTALL         |  15 +-
diff --git a/openssh/Patches/0014-GSS-API-key-exchange-support.patch b/openssh/Patches/0014-GSS-API-key-exchange-support.patch
index 6d8fc59..2e0ab38 100644
--- a/openssh/Patches/0014-GSS-API-key-exchange-support.patch
+++ b/openssh/Patches/0014-GSS-API-key-exchange-support.patch
@@ -1,7 +1,7 @@
-From 5ad94de91adf64484b2538f8b23f1c2a462e76b1 Mon Sep 17 00:00:00 2001
+From 6866e919760f137e1784df0e4d7cffd2fbed8824 Mon Sep 17 00:00:00 2001
 From: Simon Wilkinson <simon@sxw.org.uk>
 Date: Fri, 27 Jan 2017 16:46:31 -0800
-Subject: [PATCH 14/35] GSS-API key exchange support
+Subject: [PATCH 14/34] GSS-API key exchange support
 
 ---
  ChangeLog.gssapi | 113 ++++++++++++++++
diff --git a/openssh/Patches/0015-Enable-login-to-a-role-if-PAM-is-ok-with-it.patch b/openssh/Patches/0015-Enable-login-to-a-role-if-PAM-is-ok-with-it.patch
index bf7cf71..73b8fa2 100644
--- a/openssh/Patches/0015-Enable-login-to-a-role-if-PAM-is-ok-with-it.patch
+++ b/openssh/Patches/0015-Enable-login-to-a-role-if-PAM-is-ok-with-it.patch
@@ -1,7 +1,7 @@
-From 326be58a153548e8218d1cdc2b0224612814d63f Mon Sep 17 00:00:00 2001
+From d19c61c021cc2a59824837d1a8bb5199178f233d Mon Sep 17 00:00:00 2001
 From: oracle <solaris@oracle.com>
 Date: Mon, 3 Aug 2015 14:38:19 -0700
-Subject: [PATCH 15/35] Enable login to a role if PAM is ok with it
+Subject: [PATCH 15/34] Enable login to a role if PAM is ok with it
 
 ---
  auth-pam.c        | 14 ++++++++++++++
diff --git a/openssh/Patches/0016-PAM-setcred-failures.patch b/openssh/Patches/0016-PAM-setcred-failures.patch
index f6e4d33..3c22b1d 100644
--- a/openssh/Patches/0016-PAM-setcred-failures.patch
+++ b/openssh/Patches/0016-PAM-setcred-failures.patch
@@ -1,7 +1,7 @@
-From 587e5e335de79d83365264cbb82a1130bbd991c9 Mon Sep 17 00:00:00 2001
+From 80dc2354a7f09d77e6b10822b30f07c8601b37bc Mon Sep 17 00:00:00 2001
 From: oracle <solaris@oracle.com>
 Date: Mon, 3 Aug 2015 14:38:26 -0700
-Subject: [PATCH 16/35] PAM setcred failures
+Subject: [PATCH 16/34] PAM setcred failures
 
 #
 # This patch contains bug fixes to the PAM credential and session operations.
diff --git a/openssh/Patches/0017-Don-t-call-do_pam_setcred-twice.patch b/openssh/Patches/0017-Don-t-call-do_pam_setcred-twice.patch
index 4d8facd..c265563 100644
--- a/openssh/Patches/0017-Don-t-call-do_pam_setcred-twice.patch
+++ b/openssh/Patches/0017-Don-t-call-do_pam_setcred-twice.patch
@@ -1,7 +1,7 @@
-From c03a29b1e7cbe6c40b4d32c2c9ca704e6e43a00c Mon Sep 17 00:00:00 2001
+From daa8872ac4f48ec3baa4e959b86198de42d93c94 Mon Sep 17 00:00:00 2001
 From: oracle <solaris@oracle.com>
 Date: Mon, 3 Aug 2015 14:38:41 -0700
-Subject: [PATCH 17/35] Don't call do_pam_setcred twice
+Subject: [PATCH 17/34] Don't call do_pam_setcred twice
 
 # This issue has been raised with the upstream OpenSSH community:
 #
diff --git a/openssh/Patches/0018-Per-session-xauthfile.patch b/openssh/Patches/0018-Per-session-xauthfile.patch
index f5b3c73..24baf08 100644
--- a/openssh/Patches/0018-Per-session-xauthfile.patch
+++ b/openssh/Patches/0018-Per-session-xauthfile.patch
@@ -1,7 +1,7 @@
-From 231cc12ac06a3dce54a48548caefa7badc4e0925 Mon Sep 17 00:00:00 2001
+From c73e4b603f12cafa4d5a5dfed896b1a03f9d10d6 Mon Sep 17 00:00:00 2001
 From: oracle <solaris@oracle.com>
 Date: Tue, 22 Dec 2015 17:12:50 -0800
-Subject: [PATCH 18/35] Per-session xauthfile
+Subject: [PATCH 18/34] Per-session xauthfile
 
 This patch is to fix a X11 connection failure when a user's home directory
 is read-only.
diff --git a/openssh/Patches/0019-PubKeyPlugin-support.patch b/openssh/Patches/0019-PubKeyPlugin-support.patch
index dd8b6cf..7fca0b0 100644
--- a/openssh/Patches/0019-PubKeyPlugin-support.patch
+++ b/openssh/Patches/0019-PubKeyPlugin-support.patch
@@ -1,7 +1,7 @@
-From 556dde99419ae10f0ceb60723ccaa90d5b4ebb5f Mon Sep 17 00:00:00 2001
+From db2c39a07d28535cc01fa6071f3b252cf5f402fc Mon Sep 17 00:00:00 2001
 From: Alex Wilson <alex.wilson@joyent.com>
 Date: Mon, 3 Aug 2015 16:27:44 -0700
-Subject: [PATCH 19/35] PubKeyPlugin support
+Subject: [PATCH 19/34] PubKeyPlugin support
 
 This adds the PubKeyPlugin directive and associated code from
 SunSSH, allowing an in-process shared library to be called
diff --git a/openssh/Patches/0020-Compatibility-fix-for-ListenAddress.patch b/openssh/Patches/0020-Compatibility-fix-for-ListenAddress.patch
index 651ef97..48dba3c 100644
--- a/openssh/Patches/0020-Compatibility-fix-for-ListenAddress.patch
+++ b/openssh/Patches/0020-Compatibility-fix-for-ListenAddress.patch
@@ -1,7 +1,7 @@
-From 7bef9919e295caced9cc2c9b73c03516dbff54b2 Mon Sep 17 00:00:00 2001
+From 72a865b4583ba7aefe0efd272b9a79c4a6ba35c7 Mon Sep 17 00:00:00 2001
 From: Alex Wilson <alex.wilson@joyent.com>
 Date: Mon, 3 Aug 2015 17:27:41 -0700
-Subject: [PATCH 20/35] Compatibility fix for "ListenAddress ::"
+Subject: [PATCH 20/34] Compatibility fix for "ListenAddress ::"
 
 In SunSSH, a config that specifies only "ListenAddress ::" in
 fact will listen on both IPv4 and IPv6.
diff --git a/openssh/Patches/0021-Try-to-create-privsep-chroot-dir-if-it-doesn-t-exist.patch b/openssh/Patches/0021-Try-to-create-privsep-chroot-dir-if-it-doesn-t-exist.patch
index 919841b..6f58b3d 100644
--- a/openssh/Patches/0021-Try-to-create-privsep-chroot-dir-if-it-doesn-t-exist.patch
+++ b/openssh/Patches/0021-Try-to-create-privsep-chroot-dir-if-it-doesn-t-exist.patch
@@ -1,7 +1,7 @@
-From 74f1ea24ef32d76b13a51e80db87531631218299 Mon Sep 17 00:00:00 2001
+From 0fd1de72fd63d40007023caf9956de49f99de03a Mon Sep 17 00:00:00 2001
 From: Alex Wilson <alex.wilson@joyent.com>
 Date: Wed, 5 Aug 2015 12:25:15 -0700
-Subject: [PATCH 21/35] Try to create privsep chroot dir if it doesn't exist
+Subject: [PATCH 21/34] Try to create privsep chroot dir if it doesn't exist
  yet
 
 ---
diff --git a/openssh/Patches/0022-Add-SMF-manifest-and-method-and-install-them.patch b/openssh/Patches/0022-Add-SMF-manifest-and-method-and-install-them.patch
index 460c7ce..eb75aef 100644
--- a/openssh/Patches/0022-Add-SMF-manifest-and-method-and-install-them.patch
+++ b/openssh/Patches/0022-Add-SMF-manifest-and-method-and-install-them.patch
@@ -1,7 +1,7 @@
-From 9650f9c45018654a86011193c3f51414e3d69d58 Mon Sep 17 00:00:00 2001
+From a0fe65f2b8ff8656e7446d5d54619cc7ece72bbd Mon Sep 17 00:00:00 2001
 From: Alex Wilson <alex.wilson@joyent.com>
 Date: Fri, 7 Aug 2015 12:19:47 -0700
-Subject: [PATCH 22/35] Add SMF manifest and method, and install them
+Subject: [PATCH 22/34] Add SMF manifest and method, and install them
 
 ---
  Makefile.in      |   6 ++
diff --git a/openssh/Patches/0023-Make-default-sshd_config-more-like-the-old-illumos-o.patch b/openssh/Patches/0023-Make-default-sshd_config-more-like-the-old-illumos-o.patch
index b8cbca0..3288568 100644
--- a/openssh/Patches/0023-Make-default-sshd_config-more-like-the-old-illumos-o.patch
+++ b/openssh/Patches/0023-Make-default-sshd_config-more-like-the-old-illumos-o.patch
@@ -1,7 +1,7 @@
-From 21d32a4b36f94c6eae6e2f9310243a5404cbac81 Mon Sep 17 00:00:00 2001
+From 58ffcf8d03b331bcc9a34337ac68955fc96ca436 Mon Sep 17 00:00:00 2001
 From: Alex Wilson <alex.wilson@joyent.com>
 Date: Fri, 7 Aug 2015 13:24:58 -0700
-Subject: [PATCH 23/35] Make default sshd_config more like the old illumos one
+Subject: [PATCH 23/34] Make default sshd_config more like the old illumos one
 
 ---
  sshd_config | 44 +++++++++++++++++++++++---------------------
diff --git a/openssh/Patches/0024-Add-with-key-dir-configure-option-to-place-SSH-host-.patch b/openssh/Patches/0024-Add-with-key-dir-configure-option-to-place-SSH-host-.patch
index f0dd18a..b4216fa 100644
--- a/openssh/Patches/0024-Add-with-key-dir-configure-option-to-place-SSH-host-.patch
+++ b/openssh/Patches/0024-Add-with-key-dir-configure-option-to-place-SSH-host-.patch
@@ -1,7 +1,7 @@
-From b6173767c53e34b6bfddb2a08954f89f097833fb Mon Sep 17 00:00:00 2001
+From 0e2394b75cc0f520e60f9c451dded673f3583bdf Mon Sep 17 00:00:00 2001
 From: Alex Wilson <alex.wilson@joyent.com>
 Date: Fri, 7 Aug 2015 13:32:53 -0700
-Subject: [PATCH 24/35] Add --with-key-dir configure option to place SSH host
+Subject: [PATCH 24/34] Add --with-key-dir configure option to place SSH host
  keys
 
 ---
diff --git a/openssh/Patches/0025-Re-enable-DSA-keys-for-pk-auth.patch b/openssh/Patches/0025-Re-enable-DSA-keys-for-pk-auth.patch
index 6c4dddb..79665a3 100644
--- a/openssh/Patches/0025-Re-enable-DSA-keys-for-pk-auth.patch
+++ b/openssh/Patches/0025-Re-enable-DSA-keys-for-pk-auth.patch
@@ -1,7 +1,7 @@
-From 4948042cfd14e37fbed3a9cc225f4ec2d44c9d47 Mon Sep 17 00:00:00 2001
+From 6e51ec2fd1f980a56f1c22f1535b3b2b480f3c37 Mon Sep 17 00:00:00 2001
 From: Alex Wilson <alex.wilson@joyent.com>
 Date: Wed, 19 Aug 2015 11:35:32 -0700
-Subject: [PATCH 25/35] Re-enable DSA keys for pk auth
+Subject: [PATCH 25/34] Re-enable DSA keys for pk auth
 
 ---
  myproposal.h  | 4 +++-
diff --git a/openssh/Patches/0026-Don-t-use-krb5-config-to-check-for-GSSAPI-on-Illumos.patch b/openssh/Patches/0026-Don-t-use-krb5-config-to-check-for-GSSAPI-on-Illumos.patch
index cd0d294..98eeb85 100644
--- a/openssh/Patches/0026-Don-t-use-krb5-config-to-check-for-GSSAPI-on-Illumos.patch
+++ b/openssh/Patches/0026-Don-t-use-krb5-config-to-check-for-GSSAPI-on-Illumos.patch
@@ -1,7 +1,7 @@
-From e55139013a14a4855eee7185c2626816d97e9ca3 Mon Sep 17 00:00:00 2001
+From ccc4bebb5d854e5f597c93d699edc62c0aec6dae Mon Sep 17 00:00:00 2001
 From: Alex Wilson <alex.wilson@joyent.com>
 Date: Fri, 21 Aug 2015 18:47:46 -0700
-Subject: [PATCH 26/35] Don't use krb5-config to check for GSSAPI on Illumos
+Subject: [PATCH 26/34] Don't use krb5-config to check for GSSAPI on Illumos
 
 ---
  configure.ac | 7 ++++++-
diff --git a/openssh/Patches/0027-Set-default-sshd-options-based-on-etc-default-login.patch b/openssh/Patches/0027-Set-default-sshd-options-based-on-etc-default-login.patch
index 3119c1f..71dd4a5 100644
--- a/openssh/Patches/0027-Set-default-sshd-options-based-on-etc-default-login.patch
+++ b/openssh/Patches/0027-Set-default-sshd-options-based-on-etc-default-login.patch
@@ -1,7 +1,7 @@
-From 1f49e55db1b8bfc158d95368c39216bf39981d38 Mon Sep 17 00:00:00 2001
+From 86381ff02a3b2a1ba2f81bdb100a364ac779caa7 Mon Sep 17 00:00:00 2001
 From: Alex Wilson <alex.wilson@joyent.com>
 Date: Mon, 24 Aug 2015 18:57:27 -0700
-Subject: [PATCH 27/35] Set default sshd options based on /etc/default/login
+Subject: [PATCH 27/34] Set default sshd options based on /etc/default/login
 
 ---
  pathnames.h   |  1 +
diff --git a/openssh/Patches/0028-Compatibility-for-SunSSH_1.5-should-include-old-DH-K.patch b/openssh/Patches/0028-Compatibility-for-SunSSH_1.5-should-include-old-DH-K.patch
index 2f21319..27452a8 100644
--- a/openssh/Patches/0028-Compatibility-for-SunSSH_1.5-should-include-old-DH-K.patch
+++ b/openssh/Patches/0028-Compatibility-for-SunSSH_1.5-should-include-old-DH-K.patch
@@ -1,7 +1,7 @@
-From 2a080be73f6b1f38b112d1009b79994c69de83c4 Mon Sep 17 00:00:00 2001
+From 6c412749d0cca2b509548c5a2ca3a3a03ed05098 Mon Sep 17 00:00:00 2001
 From: Alex Wilson <alex.wilson@joyent.com>
 Date: Fri, 4 Sep 2015 10:38:28 -0700
-Subject: [PATCH 28/35] Compatibility for SunSSH_1.5* should include old DH KEx
+Subject: [PATCH 28/34] Compatibility for SunSSH_1.5* should include old DH KEx
  algos
 
 We use the kex compat mechanism here to recognise old SunSSH
diff --git a/openssh/Patches/0029-Accept-and-send-LANG-and-LC_-environment-variables-b.patch b/openssh/Patches/0029-Accept-and-send-LANG-and-LC_-environment-variables-b.patch
index db1fd98..c54a045 100644
--- a/openssh/Patches/0029-Accept-and-send-LANG-and-LC_-environment-variables-b.patch
+++ b/openssh/Patches/0029-Accept-and-send-LANG-and-LC_-environment-variables-b.patch
@@ -1,7 +1,7 @@
-From 851736f485d533b7df18d91eab609d769d79a868 Mon Sep 17 00:00:00 2001
+From f247fdf4351f1d2e212f7e2280cc9ebb07ca6f9b Mon Sep 17 00:00:00 2001
 From: Alex Wilson <alex.wilson@joyent.com>
 Date: Fri, 4 Sep 2015 11:04:30 -0700
-Subject: [PATCH 29/35] Accept and send LANG and LC_* environment variables by
+Subject: [PATCH 29/34] Accept and send LANG and LC_* environment variables by
  default
 
 This preserves most of the old SunSSH locale negotiation
diff --git a/openssh/Patches/0030-Temporarily-set-ssh-keygen-and-ssh-add-to-old-FP-for.patch b/openssh/Patches/0030-Temporarily-set-ssh-keygen-and-ssh-add-to-old-FP-for.patch
index 63a061f..d75de43 100644
--- a/openssh/Patches/0030-Temporarily-set-ssh-keygen-and-ssh-add-to-old-FP-for.patch
+++ b/openssh/Patches/0030-Temporarily-set-ssh-keygen-and-ssh-add-to-old-FP-for.patch
@@ -1,7 +1,7 @@
-From 06fe54a51934fa827979584991f37145ca18ea0f Mon Sep 17 00:00:00 2001
+From bcfb2a309325486c30bf022f9236ad680b5a62c1 Mon Sep 17 00:00:00 2001
 From: Alex Wilson <alex.wilson@joyent.com>
 Date: Wed, 9 Sep 2015 10:36:05 -0700
-Subject: [PATCH 30/35] Temporarily set ssh-keygen and ssh-add to old FP format
+Subject: [PATCH 30/34] Temporarily set ssh-keygen and ssh-add to old FP format
 
 SDC and its users have a lot of scripts that expect ssh-add
 and ssh-keygen to return fingerprints in the old format.
diff --git a/openssh/Patches/0031-Restore-tcpwrappers-libwrap-support.patch b/openssh/Patches/0031-Restore-tcpwrappers-libwrap-support.patch
index 2fde3af..b25312c 100644
--- a/openssh/Patches/0031-Restore-tcpwrappers-libwrap-support.patch
+++ b/openssh/Patches/0031-Restore-tcpwrappers-libwrap-support.patch
@@ -1,7 +1,7 @@
-From 7c9d6785b45d7f436f8f5e209cf20ecbd8c34fba Mon Sep 17 00:00:00 2001
+From 149d9b26b85289e6a705048376879a7fedb88f68 Mon Sep 17 00:00:00 2001
 From: Alex Wilson <alex.wilson@joyent.com>
 Date: Wed, 16 Sep 2015 10:54:13 -0700
-Subject: [PATCH 31/35] Restore tcpwrappers/libwrap support
+Subject: [PATCH 31/34] Restore tcpwrappers/libwrap support
 
 This reverts commit f9696566fb41320820f3b257ab564fa321bb3751
 and commit f2719b7c2b8a3b14d778d8a6d8dc729b5174b054.
diff --git a/openssh/Patches/0032-Let-us-put-a-fallback-copy-of-DH-moduli-in-a-system-.patch b/openssh/Patches/0032-Let-us-put-a-fallback-copy-of-DH-moduli-in-a-system-.patch
index 9cb518e..b26d41d 100644
--- a/openssh/Patches/0032-Let-us-put-a-fallback-copy-of-DH-moduli-in-a-system-.patch
+++ b/openssh/Patches/0032-Let-us-put-a-fallback-copy-of-DH-moduli-in-a-system-.patch
@@ -1,7 +1,7 @@
-From 82ea71c2e1ba3fd966a677e0a081794e2d8a3e0f Mon Sep 17 00:00:00 2001
+From 261e07bafc360097ea72684d4672d3a1caa005af Mon Sep 17 00:00:00 2001
 From: Alex Wilson <alex.wilson@joyent.com>
 Date: Thu, 15 Oct 2015 16:02:37 -0700
-Subject: [PATCH 32/35] Let us put a fallback copy of DH moduli in a system
+Subject: [PATCH 32/34] Let us put a fallback copy of DH moduli in a system
  path
 
 Live distributions like SmartOS can't keep and update default
diff --git a/openssh/Patches/0033-Temporarily-set-ssh-keygen-to-use-old-PKCS-1-PEM-for.patch b/openssh/Patches/0033-Temporarily-set-ssh-keygen-to-use-old-PKCS-1-PEM-for.patch
index 129d8a0..bb30750 100644
--- a/openssh/Patches/0033-Temporarily-set-ssh-keygen-to-use-old-PKCS-1-PEM-for.patch
+++ b/openssh/Patches/0033-Temporarily-set-ssh-keygen-to-use-old-PKCS-1-PEM-for.patch
@@ -1,7 +1,7 @@
-From b0852fdcb9ecd2a0518f6e6af5996f86cacbc96d Mon Sep 17 00:00:00 2001
+From 47dd771062115fec61de7223d7a97cf1311a98d2 Mon Sep 17 00:00:00 2001
 From: Alex Wilson <alex.wilson@joyent.com>
 Date: Tue, 16 Jul 2019 13:43:14 -0700
-Subject: [PATCH 33/35] Temporarily set ssh-keygen to use old PKCS#1 PEM format
+Subject: [PATCH 33/34] Temporarily set ssh-keygen to use old PKCS#1 PEM format
 
 SDC and its users have a lot of scripts and tools which expect
 ssh-keygen to produce the old private key format.
diff --git a/openssh/Patches/0034-OS-7896-need-to-workaround-ssh-failure-on-vmnat.patch b/openssh/Patches/0034-OS-7896-need-to-workaround-ssh-failure-on-vmnat.patch
new file mode 100644
index 0000000..f4a08cf
--- /dev/null
+++ b/openssh/Patches/0034-OS-7896-need-to-workaround-ssh-failure-on-vmnat.patch
@@ -0,0 +1,41 @@
+From 68081bdb4a0983370c6c82fd3a2ed8016b14b5d8 Mon Sep 17 00:00:00 2001
+From: Mike Gerdts <mike.gerdts@joyent.com>
+Date: Tue, 23 Jul 2019 11:54:10 +0000
+Subject: [PATCH 34/34] OS-7896 need to workaround ssh failure on vmnat
+
+---
+ ssh_config  | 5 +++++
+ sshd_config | 4 ++++
+ 2 files changed, 9 insertions(+)
+
+diff --git a/ssh_config b/ssh_config
+index bcb9f153..b2b67fc5 100644
+--- a/ssh_config
++++ b/ssh_config
+@@ -46,3 +46,8 @@
+ #   VisualHostKey no
+ #   ProxyCommand ssh -q -W %h:%p gateway.example.com
+ #   RekeyLimit 1G 1h
++
++# VMware's vmnat injects a RST when it sees AF21/CS1 DSCP flags.  This breaks
++# ssh on CoaL and other SmartOS-on-VMware scenarios.
++Host *
++    IPQoS none
+diff --git a/sshd_config b/sshd_config
+index 6184ab75..49974768 100644
+--- a/sshd_config
++++ b/sshd_config
+@@ -116,6 +116,10 @@ PrintLastLog no
+ # override default of no subsystems
+ Subsystem	sftp	/usr/libexec/sftp-server
+ 
++# VMware's vmnat injects a RST when it sees AF21/CS1 DSCP flags.  This breaks
++# ssh on CoaL and other SmartOS-on-VMware scenarios.
++IPQoS none
++
+ # Example of overriding settings on a per-user basis
+ #Match User anoncvs
+ #	X11Forwarding no
+-- 
+2.22.0
+
