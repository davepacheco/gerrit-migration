{"project":"joyent/manta","branch":"master","id":"I902fd6fdf6f76b42b01e64181033502a57c6acbd","number":"4665","subject":"MANTA-3870 operator-guide needs updated marlin NAT instructions Reviewed by: Brian Bennett \u003cbrian.bennett@joyent.com\u003e Approved by: Brian Bennett \u003cbrian.bennett@joyent.com\u003e","owner":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"url":"https://cr.joyent.us/4665","commitMessage":"MANTA-3870 operator-guide needs updated marlin NAT instructions\nReviewed by: Brian Bennett \u003cbrian.bennett@joyent.com\u003e\nApproved by: Brian Bennett \u003cbrian.bennett@joyent.com\u003e\n","createdOn":1534156882,"lastUpdated":1535701960,"open":false,"status":"MERGED","comments":[{"timestamp":1534156882,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Uploaded patch set 1."},{"timestamp":1534156885,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1534156887,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit c6208ed386391cfedae2aede10ecb7a01b1071aa\n    \n    MANTA-3870 operator-guide needs updated marlin NAT instructions"},{"timestamp":1534201393,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Patch Set 1:\n\n(7 comments)"},{"timestamp":1534241700,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Patch Set 1:\n\n(7 comments)\n\n\u003e New commits:\n \u003e \n \u003e commit c6208ed386391cfedae2aede10ecb7a01b1071aa\n \u003e \n \u003e MANTA-3870 operator-guide needs updated marlin NAT instructions\n\nI\u0027ll do another full test through the updated instructions that address these changes, and post an updated review once I\u0027m happy with the changes."},{"timestamp":1534244674,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Uploaded patch set 2."},{"timestamp":1534244676,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1534244678,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit 21fc5d39d26eba5d54807931fecdde3753069456\n    \n    MANTA-3870 operator-guide needs updated marlin NAT instructions"},{"timestamp":1534244853,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Patch Set 2:\n\n\u003e New commits:\n \u003e \n \u003e commit 21fc5d39d26eba5d54807931fecdde3753069456\n \u003e \n \u003e MANTA-3870 operator-guide needs updated marlin NAT instructions\n\nThis change addresses Brian\u0027s comments on Patch Set 1.\n\nOne other change not mentioned there, but reported in the\nmanta-discuss thread was that (today at least) the default gateway\nchange isn\u0027t automatically picked up by the marlin zones. The user on\nthe manta-discuss rebooted his coal instance, but it seems that simply\nrestarting the marlin-agent in the headnode was sufficient, so I\u0027ve\ndocumented that procedure."},{"timestamp":1535653334,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Patch Set 2: Code-Review+1 Integration-Approval+1"},{"timestamp":1535701937,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Uploaded patch set 3: Commit message was updated."},{"timestamp":1535701941,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Patch Set 3:\n\nNew commits:\n    \n    commit 886cc9ee582851d8f3457c35cb23d1391aca0cd8\n    \n    MANTA-3870 operator-guide needs updated marlin NAT instructions\n    Reviewed by: Brian Bennett \u003cbrian.bennett@joyent.com\u003e\n    Approved by: Brian Bennett \u003cbrian.bennett@joyent.com\u003e"},{"timestamp":1535701960,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Tim Foster"}],"currentPatchSet":{"number":"3","revision":"902fd6fdf6f76b42b01e64181033502a57c6acbd","parents":["273a753f3bac11fe49c81c1f493f5572b3068faf"],"ref":"refs/changes/65/4665/3","uploader":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"createdOn":1535701937,"author":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1534244676,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1535653334,"by":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1535653334,"by":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"}},{"type":"SUBM","value":"1","grantedOn":1535701960,"by":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"docs/operator-guide.md","type":"MODIFIED","insertions":133,"deletions":-30}],"sizeInsertions":133,"sizeDeletions":-30},"patchSets":[{"number":"1","revision":"948a96d263b717cacc08662268d02c1328ee30c6","parents":["273a753f3bac11fe49c81c1f493f5572b3068faf"],"ref":"refs/changes/65/4665/1","uploader":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"createdOn":1534156882,"author":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1534156885,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"docs/operator-guide.md","line":3347,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"In some tangental discussion with @dap in chat, we think there should be some warning about the availability implications of running this through a single NAT zone rather than having this provided by HA network hardware."},{"file":"docs/operator-guide.md","line":3347,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Good point, I\u0027ll add a paragraph to that effect."},{"file":"docs/operator-guide.md","line":3359,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"I\u0027m pretty sure you can just set `\"allow_ip_spoofing\": true` here, and not have to bother with going back and touching NAPI."},{"file":"docs/operator-guide.md","line":3359,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Yep, I tested that, and you\u0027re correct (excellent!)"},{"file":"docs/operator-guide.md","line":3361,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"`\"allow_ip_spoofing\":true` should be on both interfaces."},{"file":"docs/operator-guide.md","line":3361,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"The name won\u0027t necessarily always be \"mantanat\". Elsewhere in the documentation it\u0027s referred to as the \"marlin\" network. There should be a note to use the correct network name."},{"file":"docs/operator-guide.md","line":3361,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Yep, that\u0027s confusing. The other reference in the document near line 1068 says:\n\n\u003d\u003d\u003d\n* `marlin`: the network used for compute zones.  This is usually a network that\n  gives out private IPs that are NAT\u0027d to the internet so that users can\n  contact the internet from Marlin jobs, but without needing their own public\n  IP for each zone.\n\nEach of these is an object with several properties:\n\n| Property  | Kind   | Description                                                            |\n| --------- | ------ | ---------------------------------------------------------------------- |\n| `network` | string | Name for the Triton network object (usually the same as the network name) |\n| `nic_tag` | string | NIC tag name for this network (usually the same as the network name)   |\n\u003d\u003d\u003d\n\nso my reading of that is that the networking configuration \"marlin\" refers to the \"mantanat\" Triton network object, but annoyingly, that\u0027s the only place where the phrase \"network object\" is actually used..\n\nI\u0027ve tried to clarify a little in the updated text."},{"file":"docs/operator-guide.md","line":3361,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"fixed."},{"file":"docs/operator-guide.md","line":3378,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Maybe we can update this to be the 2015 image being used as the new base?\n\nI am unsure here. If the answer isn\u0027t clearly \"yes\", this shouldn\u0027t hold up IA. But if we are going to change it, now\u0027s the time."},{"file":"docs/operator-guide.md","line":3378,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Totally agree - I\u0027ve tested this with triton-origin-multiarch-15.4.1 and it works just fine, so have changed that."},{"file":"docs/operator-guide.md","line":3382,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"When I tested this, the `-f` flag was not valid."},{"file":"docs/operator-guide.md","line":3382,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Good catch! That argument is valid with \u0027sdc-vmadm\u0027 but not \u0027sdc-vm\u0027 (yay consistency)\n\nWe don\u0027t reference sdc-vmadm or sdc-vm anywhere else in this document, so there\u0027s no convention to follow. I\u0027ll go with using \u0027sdc-vmadm\u0027 since it\u0027s a more useful command to introduce."},{"file":"docs/operator-guide.md","line":3411,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"This whole section can probably be removed, having added `\"allow_ip_spoofing\":true` to the provisioning config."},{"file":"docs/operator-guide.md","line":3411,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Yep, done."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"docs/operator-guide.md","type":"MODIFIED","insertions":137,"deletions":-22}],"sizeInsertions":137,"sizeDeletions":-22},{"number":"2","revision":"502b687ab0715123fa46ec04bd019b0ea2f8822d","parents":["273a753f3bac11fe49c81c1f493f5572b3068faf"],"ref":"refs/changes/65/4665/2","uploader":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"createdOn":1534244674,"author":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1534244676,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1535653334,"by":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1535653334,"by":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"docs/operator-guide.md","type":"MODIFIED","insertions":133,"deletions":-30}],"sizeInsertions":133,"sizeDeletions":-30},{"number":"3","revision":"902fd6fdf6f76b42b01e64181033502a57c6acbd","parents":["273a753f3bac11fe49c81c1f493f5572b3068faf"],"ref":"refs/changes/65/4665/3","uploader":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"createdOn":1535701937,"author":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1534244676,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1535653334,"by":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1535653334,"by":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"}},{"type":"SUBM","value":"1","grantedOn":1535701960,"by":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"docs/operator-guide.md","type":"MODIFIED","insertions":133,"deletions":-30}],"sizeInsertions":133,"sizeDeletions":-30}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"}]}