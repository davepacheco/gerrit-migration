{"project":"joyent/illumos-joyent","branch":"master","id":"I405aa7460500578f440f2b4135639b3a7d09c27d","number":"7002","subject":"NEX-15279 support NFS server in zone NEX-15520 online NFS shares cause zoneadm halt to hang in nfs_export_zone_fini Portions contributed by: Dan Kruchinin dan.kruchinin@nexenta.com Portions contributed by: Stepan Zastupov stepan.zastupov@gmail.com Reviewe","owner":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"url":"https://cr.joyent.us/7002","commitMessage":"NEX-15279 support NFS server in zone\nNEX-15520 online NFS shares cause zoneadm halt to hang in nfs_export_zone_fini\nPortions contributed by: Dan Kruchinin dan.kruchinin@nexenta.com\nPortions contributed by: Stepan Zastupov stepan.zastupov@gmail.com\nReviewed by: Joyce McIntosh \u003cjoyce.mcintosh@nexenta.com\u003e\nReviewed by: Rob Gittins \u003crob.gittins@nexenta.com\u003e\nReviewed by: Gordon Ross \u003cgordon.ross@nexenta.com\u003e\n","createdOn":1572285559,"lastUpdated":1572292495,"open":false,"status":"ABANDONED","comments":[{"timestamp":1572285559,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Uploaded patch set 1."},{"timestamp":1572292495,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Abandoned\n\nnot yet"}],"currentPatchSet":{"number":"1","revision":"405aa7460500578f440f2b4135639b3a7d09c27d","parents":["d7018f9493926f49caa76a939a8f29dcb4625494"],"ref":"refs/changes/02/7002/1","uploader":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"createdOn":1572285559,"author":{"name":"Evan Layton","email":"evan.layton@nexenta.com","username":""},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":13,"deletions":0},{"file":"usr/src/cmd/dfs.cmds/sharemgr/commands.c","type":"MODIFIED","insertions":7,"deletions":-2},{"file":"usr/src/cmd/fs.d/nfs/svc/nfs-server","type":"MODIFIED","insertions":1,"deletions":-9},{"file":"usr/src/lib/brand/ipkg/zone/platform.xml","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/lib/libshare/common/libshare_zfs.c","type":"MODIFIED","insertions":13,"deletions":-2},{"file":"usr/src/lib/libshare/nfs/libshare_nfs.c","type":"MODIFIED","insertions":11,"deletions":-67},{"file":"usr/src/lib/libzfs/common/libzfs_dataset.c","type":"MODIFIED","insertions":7,"deletions":-5},{"file":"usr/src/lib/libzfs/common/libzfs_mount.c","type":"MODIFIED","insertions":5,"deletions":-11},{"file":"usr/src/uts/common/fs/nfs/nfs3_srv.c","type":"MODIFIED","insertions":59,"deletions":-31},{"file":"usr/src/uts/common/fs/nfs/nfs4_common.c","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/common/fs/nfs/nfs4_db.c","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"usr/src/uts/common/fs/nfs/nfs4_dispatch.c","type":"MODIFIED","insertions":11,"deletions":-8},{"file":"usr/src/uts/common/fs/nfs/nfs4_srv.c","type":"MODIFIED","insertions":372,"deletions":-144},{"file":"usr/src/uts/common/fs/nfs/nfs4_srv_attr.c","type":"MODIFIED","insertions":5,"deletions":-3},{"file":"usr/src/uts/common/fs/nfs/nfs4_srv_deleg.c","type":"MODIFIED","insertions":58,"deletions":-35},{"file":"usr/src/uts/common/fs/nfs/nfs4_srv_ns.c","type":"MODIFIED","insertions":32,"deletions":-35},{"file":"usr/src/uts/common/fs/nfs/nfs4_state.c","type":"MODIFIED","insertions":134,"deletions":-100},{"file":"usr/src/uts/common/fs/nfs/nfs_auth.c","type":"MODIFIED","insertions":165,"deletions":-114},{"file":"usr/src/uts/common/fs/nfs/nfs_client.c","type":"MODIFIED","insertions":16,"deletions":-5},{"file":"usr/src/uts/common/fs/nfs/nfs_cmd.c","type":"MODIFIED","insertions":55,"deletions":-16},{"file":"usr/src/uts/common/fs/nfs/nfs_export.c","type":"MODIFIED","insertions":273,"deletions":-145},{"file":"usr/src/uts/common/fs/nfs/nfs_log.c","type":"MODIFIED","insertions":24,"deletions":-27},{"file":"usr/src/uts/common/fs/nfs/nfs_server.c","type":"MODIFIED","insertions":135,"deletions":-306},{"file":"usr/src/uts/common/fs/nfs/nfs_srv.c","type":"MODIFIED","insertions":88,"deletions":-37},{"file":"usr/src/uts/common/fs/nfs/nfs_sys.c","type":"MODIFIED","insertions":8,"deletions":-13},{"file":"usr/src/uts/common/fs/sharefs/sharefs_vfsops.c","type":"MODIFIED","insertions":4,"deletions":-10},{"file":"usr/src/uts/common/fs/sharefs/sharefs_vnops.c","type":"MODIFIED","insertions":46,"deletions":-37},{"file":"usr/src/uts/common/fs/sharefs/sharetab.c","type":"MODIFIED","insertions":140,"deletions":-138},{"file":"usr/src/uts/common/fs/zfs/zfs_ioctl.c","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"usr/src/uts/common/nfs/auth.h","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"usr/src/uts/common/nfs/export.h","type":"MODIFIED","insertions":50,"deletions":-17},{"file":"usr/src/uts/common/nfs/nfs.h","type":"MODIFIED","insertions":38,"deletions":-9},{"file":"usr/src/uts/common/nfs/nfs4.h","type":"MODIFIED","insertions":61,"deletions":-34},{"file":"usr/src/uts/common/nfs/nfs4_drc.h","type":"MODIFIED","insertions":6,"deletions":-4},{"file":"usr/src/uts/common/nfs/nfs_cmd.h","type":"MODIFIED","insertions":9,"deletions":0},{"file":"usr/src/uts/common/nfs/nfs_log.h","type":"MODIFIED","insertions":6,"deletions":-3},{"file":"usr/src/uts/common/sharefs/sharefs.h","type":"MODIFIED","insertions":19,"deletions":-14},{"file":"usr/src/uts/common/sys/zone.h","type":"MODIFIED","insertions":7,"deletions":-2}],"sizeInsertions":1882,"sizeDeletions":-1393},"patchSets":[{"number":"1","revision":"405aa7460500578f440f2b4135639b3a7d09c27d","parents":["d7018f9493926f49caa76a939a8f29dcb4625494"],"ref":"refs/changes/02/7002/1","uploader":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"createdOn":1572285559,"author":{"name":"Evan Layton","email":"evan.layton@nexenta.com","username":""},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":13,"deletions":0},{"file":"usr/src/cmd/dfs.cmds/sharemgr/commands.c","type":"MODIFIED","insertions":7,"deletions":-2},{"file":"usr/src/cmd/fs.d/nfs/svc/nfs-server","type":"MODIFIED","insertions":1,"deletions":-9},{"file":"usr/src/lib/brand/ipkg/zone/platform.xml","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/lib/libshare/common/libshare_zfs.c","type":"MODIFIED","insertions":13,"deletions":-2},{"file":"usr/src/lib/libshare/nfs/libshare_nfs.c","type":"MODIFIED","insertions":11,"deletions":-67},{"file":"usr/src/lib/libzfs/common/libzfs_dataset.c","type":"MODIFIED","insertions":7,"deletions":-5},{"file":"usr/src/lib/libzfs/common/libzfs_mount.c","type":"MODIFIED","insertions":5,"deletions":-11},{"file":"usr/src/uts/common/fs/nfs/nfs3_srv.c","type":"MODIFIED","insertions":59,"deletions":-31},{"file":"usr/src/uts/common/fs/nfs/nfs4_common.c","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/common/fs/nfs/nfs4_db.c","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"usr/src/uts/common/fs/nfs/nfs4_dispatch.c","type":"MODIFIED","insertions":11,"deletions":-8},{"file":"usr/src/uts/common/fs/nfs/nfs4_srv.c","type":"MODIFIED","insertions":372,"deletions":-144},{"file":"usr/src/uts/common/fs/nfs/nfs4_srv_attr.c","type":"MODIFIED","insertions":5,"deletions":-3},{"file":"usr/src/uts/common/fs/nfs/nfs4_srv_deleg.c","type":"MODIFIED","insertions":58,"deletions":-35},{"file":"usr/src/uts/common/fs/nfs/nfs4_srv_ns.c","type":"MODIFIED","insertions":32,"deletions":-35},{"file":"usr/src/uts/common/fs/nfs/nfs4_state.c","type":"MODIFIED","insertions":134,"deletions":-100},{"file":"usr/src/uts/common/fs/nfs/nfs_auth.c","type":"MODIFIED","insertions":165,"deletions":-114},{"file":"usr/src/uts/common/fs/nfs/nfs_client.c","type":"MODIFIED","insertions":16,"deletions":-5},{"file":"usr/src/uts/common/fs/nfs/nfs_cmd.c","type":"MODIFIED","insertions":55,"deletions":-16},{"file":"usr/src/uts/common/fs/nfs/nfs_export.c","type":"MODIFIED","insertions":273,"deletions":-145},{"file":"usr/src/uts/common/fs/nfs/nfs_log.c","type":"MODIFIED","insertions":24,"deletions":-27},{"file":"usr/src/uts/common/fs/nfs/nfs_server.c","type":"MODIFIED","insertions":135,"deletions":-306},{"file":"usr/src/uts/common/fs/nfs/nfs_srv.c","type":"MODIFIED","insertions":88,"deletions":-37},{"file":"usr/src/uts/common/fs/nfs/nfs_sys.c","type":"MODIFIED","insertions":8,"deletions":-13},{"file":"usr/src/uts/common/fs/sharefs/sharefs_vfsops.c","type":"MODIFIED","insertions":4,"deletions":-10},{"file":"usr/src/uts/common/fs/sharefs/sharefs_vnops.c","type":"MODIFIED","insertions":46,"deletions":-37},{"file":"usr/src/uts/common/fs/sharefs/sharetab.c","type":"MODIFIED","insertions":140,"deletions":-138},{"file":"usr/src/uts/common/fs/zfs/zfs_ioctl.c","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"usr/src/uts/common/nfs/auth.h","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"usr/src/uts/common/nfs/export.h","type":"MODIFIED","insertions":50,"deletions":-17},{"file":"usr/src/uts/common/nfs/nfs.h","type":"MODIFIED","insertions":38,"deletions":-9},{"file":"usr/src/uts/common/nfs/nfs4.h","type":"MODIFIED","insertions":61,"deletions":-34},{"file":"usr/src/uts/common/nfs/nfs4_drc.h","type":"MODIFIED","insertions":6,"deletions":-4},{"file":"usr/src/uts/common/nfs/nfs_cmd.h","type":"MODIFIED","insertions":9,"deletions":0},{"file":"usr/src/uts/common/nfs/nfs_log.h","type":"MODIFIED","insertions":6,"deletions":-3},{"file":"usr/src/uts/common/sharefs/sharefs.h","type":"MODIFIED","insertions":19,"deletions":-14},{"file":"usr/src/uts/common/sys/zone.h","type":"MODIFIED","insertions":7,"deletions":-2}],"sizeInsertions":1882,"sizeDeletions":-1393}]}