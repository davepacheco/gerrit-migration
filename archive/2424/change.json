{"project":"joyent/joyent-gerrit","branch":"master","id":"I51889254f838c6ea7cf912ef6cb9c804d3285ca3","number":"2424","subject":"TOOLS-1545 Prevent accidental pushes to GitHub repos TOOLS-1841 crimport script uses Perl-style regular expressions with grep(1) Reviewed by: Dave Pacheco \u003cdap@joyent.com\u003e Approved by: Dave Pacheco \u003cdap@joyent.com\u003e","owner":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"url":"https://cr.joyent.us/2424","commitMessage":"TOOLS-1545 Prevent accidental pushes to GitHub repos\nTOOLS-1841 crimport script uses Perl-style regular expressions with grep(1)\nReviewed by: Dave Pacheco \u003cdap@joyent.com\u003e\nApproved by: Dave Pacheco \u003cdap@joyent.com\u003e\n","createdOn":1503013630,"lastUpdated":1503339063,"open":false,"status":"MERGED","comments":[{"timestamp":1503013630,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 1."},{"timestamp":1503072933,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 1:\n\n(9 comments)\n\nThanks!\n\nWhat exactly does this change protect?  Can owners in the org still push by default?"},{"timestamp":1503075425,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 1:\n\n(9 comments)\n\nThis will still allow organization admins to push to master, but will prevent everyone else from being able to do so (and being able to click the merge button to merge to master)."},{"timestamp":1503075481,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 2."},{"timestamp":1503079428,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 1:\n\n(2 comments)"},{"timestamp":1503081284,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 3: Commit message was updated."},{"timestamp":1503081328,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 4: Commit message was updated."},{"timestamp":1503085928,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 5."},{"timestamp":1503087246,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 5: Code-Review+1 Integration-Approval+1"},{"timestamp":1503087842,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 6: Commit message was updated."},{"timestamp":1503089118,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 7."},{"timestamp":1503089475,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 8."},{"timestamp":1503092108,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 8: Code-Review+1 Integration-Approval+1"},{"timestamp":1503339063,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Cody Peter Mello"}],"currentPatchSet":{"number":"8","revision":"51889254f838c6ea7cf912ef6cb9c804d3285ca3","parents":["cf4319d27c9734530208b7a57e3c53954ccb39af"],"ref":"refs/changes/24/2424/8","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1503089475,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1503092108,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1503092108,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"SUBM","value":"1","grantedOn":1503339063,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"bin/crimport","type":"MODIFIED","insertions":145,"deletions":-5},{"file":"docs/operator/README.md","type":"MODIFIED","insertions":5,"deletions":0}],"sizeInsertions":150,"sizeDeletions":-5},"patchSets":[{"number":"1","revision":"e1cf9a76abf729c0299ff08fe1c58491c70168de","parents":["cf4319d27c9734530208b7a57e3c53954ccb39af"],"ref":"refs/changes/24/2424/1","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1503013630,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","comments":[{"file":"bin/crimport","line":21,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Can we add a note to the usage message about this file (even if it just refers to the operator guide or GitHub docs)?"},{"file":"bin/crimport","line":21,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Done"},{"file":"bin/crimport","line":103,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Can we put this behind an option (on by default) so that if we have a case where we don\u0027t want it (or if we just need to make progress when GitHub is down, or the API has changed or something), we can still use this?"},{"file":"bin/crimport","line":103,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Sure. What would you want the option named?"},{"file":"bin/crimport","line":103,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I don\u0027t think I care.  If we\u0027re using getopt/short options, maybe \"-A\" for skip authorization?"},{"file":"bin/crimport","line":240,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Is there any reason not to use $() here instead?  I don\u0027t really care -- it just feels like an easier style rule to always use $(), and it seems like one of the few where there aren\u0027t any downsides."},{"file":"bin/crimport","line":240,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"There\u0027s no real reason beyond a stylistic preference on my part. I\u0027ve changed it to $()."},{"file":"bin/crimport","line":267,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Wrap?"},{"file":"bin/crimport","line":267,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Done"},{"file":"bin/crimport","line":286,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I usually follow the illumos/ON style of putting leading and trailing blank \"#\u0027 lines around block comments."},{"file":"bin/crimport","line":286,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Done"},{"file":"bin/crimport","line":308,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Wrap this to 80 columns with a \"\\\\n\" here?"},{"file":"bin/crimport","line":308,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Done"},{"file":"bin/crimport","line":309,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I think this construct doesn\u0027t do quite what you think:\n\n    dap@zathras ~ $ function testfunc() { local foo\u003d$(false); echo $?; }\n    dap@zathras ~ $ testfunc\n    0\n\nFor this reason, I always put \"local\" on a separate line.  It\u0027s not necessary for similar variable assignments, but I think it\u0027s necessary for cases like this one."},{"file":"bin/crimport","line":309,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Huh, that\u0027s extremely unfortunate behaviour. I wasn\u0027t aware of that. I\u0027ve split out the local onto its own line."},{"file":"bin/crimport","line":313,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Wrap?"},{"file":"bin/crimport","line":313,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Done"},{"file":"bin/crimport","line":359,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Was the old regex broken?"},{"file":"bin/crimport","line":359,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"The old regex only worked with GNU grep, which causes issues with the way my PATH is set up. I can file a separate ticket about this and make a separate CR if you want."},{"file":"bin/crimport","line":359,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Either that, or just a note in the existing ticket about this change would be good.  Thanks!  Sorry for the trouble."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"bin/crimport","type":"MODIFIED","insertions":118,"deletions":-1},{"file":"docs/operator/README.md","type":"MODIFIED","insertions":5,"deletions":0}],"sizeInsertions":123,"sizeDeletions":-1},{"number":"2","revision":"b582933a57f33b970a2b1348ed1a594499f2470c","parents":["cf4319d27c9734530208b7a57e3c53954ccb39af"],"ref":"refs/changes/24/2424/2","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1503075481,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"bin/crimport","type":"MODIFIED","insertions":131,"deletions":-4},{"file":"docs/operator/README.md","type":"MODIFIED","insertions":5,"deletions":0}],"sizeInsertions":136,"sizeDeletions":-4},{"number":"3","revision":"7aefcdedd8bcfe40b8bc2ef4bae09efe1fd0cffe","parents":["cf4319d27c9734530208b7a57e3c53954ccb39af"],"ref":"refs/changes/24/2424/3","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1503081284,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"NO_CODE_CHANGE","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"bin/crimport","type":"MODIFIED","insertions":131,"deletions":-4},{"file":"docs/operator/README.md","type":"MODIFIED","insertions":5,"deletions":0}],"sizeInsertions":136,"sizeDeletions":-4},{"number":"4","revision":"04b91bf8e6c910c2d056cc590e98046defb3d113","parents":["cf4319d27c9734530208b7a57e3c53954ccb39af"],"ref":"refs/changes/24/2424/4","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1503081328,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"NO_CODE_CHANGE","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"bin/crimport","type":"MODIFIED","insertions":131,"deletions":-4},{"file":"docs/operator/README.md","type":"MODIFIED","insertions":5,"deletions":0}],"sizeInsertions":136,"sizeDeletions":-4},{"number":"5","revision":"e7250c65af06b30327ebeb0df59db43f3e9860f3","parents":["cf4319d27c9734530208b7a57e3c53954ccb39af"],"ref":"refs/changes/24/2424/5","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1503085928,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1503087246,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1503087246,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"bin/crimport","type":"MODIFIED","insertions":145,"deletions":-5},{"file":"docs/operator/README.md","type":"MODIFIED","insertions":5,"deletions":0}],"sizeInsertions":150,"sizeDeletions":-5},{"number":"6","revision":"b2739e57e0b0114672b503fbfc64ede86a7b96cb","parents":["cf4319d27c9734530208b7a57e3c53954ccb39af"],"ref":"refs/changes/24/2424/6","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1503087842,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1503087246,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1503087246,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"bin/crimport","type":"MODIFIED","insertions":145,"deletions":-5},{"file":"docs/operator/README.md","type":"MODIFIED","insertions":5,"deletions":0}],"sizeInsertions":150,"sizeDeletions":-5},{"number":"7","revision":"6c2cd5174784d50eb3b7937a387dd8a18a812bef","parents":["cf4319d27c9734530208b7a57e3c53954ccb39af"],"ref":"refs/changes/24/2424/7","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1503089118,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"bin/crimport","type":"MODIFIED","insertions":145,"deletions":-5},{"file":"docs/operator/README.md","type":"MODIFIED","insertions":5,"deletions":0}],"sizeInsertions":150,"sizeDeletions":-5},{"number":"8","revision":"51889254f838c6ea7cf912ef6cb9c804d3285ca3","parents":["cf4319d27c9734530208b7a57e3c53954ccb39af"],"ref":"refs/changes/24/2424/8","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1503089475,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1503092108,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1503092108,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"SUBM","value":"1","grantedOn":1503339063,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"bin/crimport","type":"MODIFIED","insertions":145,"deletions":-5},{"file":"docs/operator/README.md","type":"MODIFIED","insertions":5,"deletions":0}],"sizeInsertions":150,"sizeDeletions":-5}],"allReviewers":[{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}]}