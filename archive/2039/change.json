{"project":"joyent/illumos-joyent","branch":"master","id":"I3a5445f1b9d90e4f1538503bd60913c8f302c17f","number":"2039","subject":"OS-6155 NFSv4 locking not working if rpcbind or rpc.statd not running Reviewed by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e Approved by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e","owner":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"url":"https://cr.joyent.us/2039","commitMessage":"OS-6155 NFSv4 locking not working if rpcbind or rpc.statd not running\nReviewed by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e\nApproved by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e\n","createdOn":1496685733,"lastUpdated":1496861454,"open":false,"status":"MERGED","comments":[{"timestamp":1496685733,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 1."},{"timestamp":1496784277,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 1: Code-Review+1"},{"timestamp":1496786804,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 1:\n\nI have tested this with a centos7 zone with no rpcbind service running (which matches the config from the github issue). I did an NFSv4 mount and can lock a file in that mount. In parallel I am running an Ubuntu 14.04 zone which does have rpcbind and rpc.statd running. I can lock the same file in that zone and I tested the correct behavior for locking between the two zones."},{"timestamp":1496860066,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 1: Integration-Approval+1"},{"timestamp":1496861401,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 2: Patch Set 1 was rebased."},{"timestamp":1496861446,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 3: Commit message was updated."},{"timestamp":1496861454,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Jerry Jelinek"}],"currentPatchSet":{"number":"3","revision":"3a5445f1b9d90e4f1538503bd60913c8f302c17f","parents":["2b9d6c0c0b0b0ccf908460c4e3a04c0ca3ca07de"],"ref":"refs/changes/39/2039/3","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1496861446,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1496784277,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1496860066,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"SUBM","value":"1","grantedOn":1496861454,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/cmd/fs.d/nfs/lockd/lockd.c","type":"MODIFIED","insertions":9,"deletions":-6},{"file":"usr/src/lib/brand/lx/lx_lockd/lockd.c","type":"MODIFIED","insertions":21,"deletions":-11},{"file":"usr/src/lib/brand/lx/lx_lockd/nfs_tbind.c","type":"MODIFIED","insertions":12,"deletions":-12},{"file":"usr/src/uts/common/fs/nfs/nfs_sys.c","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/klm/klmmod.c","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/uts/common/klm/nlm_impl.c","type":"MODIFIED","insertions":11,"deletions":-1},{"file":"usr/src/uts/common/klm/nlm_impl.h","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/uts/common/nfs/nfssys.h","type":"MODIFIED","insertions":10,"deletions":-2}],"sizeInsertions":72,"sizeDeletions":-33},"patchSets":[{"number":"1","revision":"58ad2ad46b4fed5733df78e03092b5c4d6d994e1","parents":["db860a9da66f2fd61f7f2cbaa5bd7f7028fb4767"],"ref":"refs/changes/39/2039/1","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1496685733,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1496784277,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1496860066,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/fs.d/nfs/lockd/lockd.c","type":"MODIFIED","insertions":9,"deletions":-6},{"file":"usr/src/lib/brand/lx/lx_lockd/lockd.c","type":"MODIFIED","insertions":21,"deletions":-11},{"file":"usr/src/lib/brand/lx/lx_lockd/nfs_tbind.c","type":"MODIFIED","insertions":12,"deletions":-12},{"file":"usr/src/uts/common/fs/nfs/nfs_sys.c","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/klm/klmmod.c","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/uts/common/klm/nlm_impl.c","type":"MODIFIED","insertions":11,"deletions":-1},{"file":"usr/src/uts/common/klm/nlm_impl.h","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/uts/common/nfs/nfssys.h","type":"MODIFIED","insertions":10,"deletions":-2}],"sizeInsertions":72,"sizeDeletions":-33},{"number":"2","revision":"140bfd8fc900815589dadceacd746fd8637f6b79","parents":["2b9d6c0c0b0b0ccf908460c4e3a04c0ca3ca07de"],"ref":"refs/changes/39/2039/2","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1496861401,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1496784277,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1496860066,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/fs.d/nfs/lockd/lockd.c","type":"MODIFIED","insertions":9,"deletions":-6},{"file":"usr/src/lib/brand/lx/lx_lockd/lockd.c","type":"MODIFIED","insertions":21,"deletions":-11},{"file":"usr/src/lib/brand/lx/lx_lockd/nfs_tbind.c","type":"MODIFIED","insertions":12,"deletions":-12},{"file":"usr/src/uts/common/fs/nfs/nfs_sys.c","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/klm/klmmod.c","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/uts/common/klm/nlm_impl.c","type":"MODIFIED","insertions":11,"deletions":-1},{"file":"usr/src/uts/common/klm/nlm_impl.h","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/uts/common/nfs/nfssys.h","type":"MODIFIED","insertions":10,"deletions":-2}],"sizeInsertions":72,"sizeDeletions":-33},{"number":"3","revision":"3a5445f1b9d90e4f1538503bd60913c8f302c17f","parents":["2b9d6c0c0b0b0ccf908460c4e3a04c0ca3ca07de"],"ref":"refs/changes/39/2039/3","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1496861446,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"SUBM","value":"1","grantedOn":1496861454,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1496784277,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1496860066,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/cmd/fs.d/nfs/lockd/lockd.c","type":"MODIFIED","insertions":9,"deletions":-6},{"file":"usr/src/lib/brand/lx/lx_lockd/lockd.c","type":"MODIFIED","insertions":21,"deletions":-11},{"file":"usr/src/lib/brand/lx/lx_lockd/nfs_tbind.c","type":"MODIFIED","insertions":12,"deletions":-12},{"file":"usr/src/uts/common/fs/nfs/nfs_sys.c","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/klm/klmmod.c","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/uts/common/klm/nlm_impl.c","type":"MODIFIED","insertions":11,"deletions":-1},{"file":"usr/src/uts/common/klm/nlm_impl.h","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/uts/common/nfs/nfssys.h","type":"MODIFIED","insertions":10,"deletions":-2}],"sizeInsertions":72,"sizeDeletions":-33}],"allReviewers":[{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}]}