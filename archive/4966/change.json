{"project":"joyent/sdcadm","branch":"master","id":"I8ed727f0d2dc2e9e7ff35d4441d2be042a48da73","number":"4966","subject":"TRITON-883 `sdcadm up SVC` should update image_uuid associated with the service Reviewed by: Trent Mick \u003ctrentm@gmail.com\u003e Approved by: Trent Mick \u003ctrentm@gmail.com\u003e","owner":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"url":"https://cr.joyent.us/4966","commitMessage":"TRITON-883 `sdcadm up SVC` should update image_uuid associated with the service\nReviewed by: Trent Mick \u003ctrentm@gmail.com\u003e\nApproved by: Trent Mick \u003ctrentm@gmail.com\u003e\n","createdOn":1539718795,"lastUpdated":1540313079,"open":false,"status":"MERGED","comments":[{"timestamp":1539718795,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 1."},{"timestamp":1539718800,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit 1b3c66edd0065c37f1e2274a27e01153fbbd0725\n    \n    TRITON-883 `sdcadm up SVC` should update image_uuid associated with the service"},{"timestamp":1539718843,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1539798858,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1539803066,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 1:\n\n\u003e (1 comment)\n\nI think it\u0027s a good idea to try to figure out how to modify the change.type. I\u0027ll give it a try!"},{"timestamp":1539877193,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 2."},{"timestamp":1539877198,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit c5a120ed6e3013a0ff954a38a7ebf0822ae7d5e4\n    \n    TRITON-883 `sdcadm up SVC` should update image_uuid associated with the service"},{"timestamp":1539877242,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1539877300,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 2:\n\nFor now I think it\u0027ll suffice modifying `change.type` at procedures/index.js since there\u0027s nothing else different between \u0027update-service\u0027 and \u0027update-instances\u0027. Thoughts?"},{"timestamp":1540222536,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 3: Patch Set 2 was rebased."},{"timestamp":1540222541,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 3:\n\nNew commits:\n    \n    commit 0e63ef7fd2501d761d621e68837a46525d4c8fa0\n    \n    TRITON-883 `sdcadm up SVC` should update image_uuid associated with the service"},{"timestamp":1540222592,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3:\n\n\"make check\" passed ok"},{"timestamp":1540310938,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 3: Code-Review+1 Integration-Approval+1\n\nAssuming this works for you. ;)"},{"timestamp":1540313045,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 4: Commit message was updated."},{"timestamp":1540313079,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Pedro Palazón Candel"}],"currentPatchSet":{"number":"4","revision":"8ed727f0d2dc2e9e7ff35d4441d2be042a48da73","parents":["6e909b0b719155c026dc7117afc3059507c8167f"],"ref":"refs/changes/66/4966/4","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1540313045,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1539877242,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1540310938,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1540310938,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1540313079,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/procedures/index.js","type":"MODIFIED","insertions":3,"deletions":0},{"file":"lib/procedures/update-agent-v1.js","type":"MODIFIED","insertions":27,"deletions":0}],"sizeInsertions":30,"sizeDeletions":0},"patchSets":[{"number":"1","revision":"112cc36477ef0aa88619f4aa65a2936ae831111a","parents":["d40f461973dfc27ec699139a3a5f112ae4d06993"],"ref":"refs/changes/66/4966/1","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1539718795,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1539718843,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/procedures/index.js","line":755,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Suggestion for a slight change in where the logic is here. \nMy goal here is to have the `change` objects represent more what the change is, rather than parameters saying how to deal with that change.\n\nFirst, what I\u0027d really like, but perhaps don\u0027t do because it might be a pain.  If there is a change.type\u003d\u0027update-service\u0027 that changes only a *subset* of instances, then it should really be change.type\u003d\u0027update-instances\u0027 instead. If we did that, then the procedure would always just know to update the SAPI \u0027service.params.image_uuid\u0027 for \u0027update-service\u0027 and *not* for \u0027update-instances\u0027.\n\nInstead, this might be easier. Rather than `change.update_sapi_image`, make it `change.instsIsSubset \u003d false/true` here. Then in the update-agent-v1.js procedure:\n\n1. change the summary slightly to point out if it is a subset of insts that are being updated\n2. if `change.instIsSubset` is false, then update SAPI service.params.image_uuid."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/procedures/index.js","type":"MODIFIED","insertions":3,"deletions":0},{"file":"lib/procedures/update-agent-v1.js","type":"MODIFIED","insertions":19,"deletions":0}],"sizeInsertions":22,"sizeDeletions":0},{"number":"2","revision":"a0445169bf9d9ea52fff2ef077d332e8958433ee","parents":["d40f461973dfc27ec699139a3a5f112ae4d06993"],"ref":"refs/changes/66/4966/2","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1539877193,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1539877242,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/procedures/index.js","type":"MODIFIED","insertions":3,"deletions":0},{"file":"lib/procedures/update-agent-v1.js","type":"MODIFIED","insertions":27,"deletions":0}],"sizeInsertions":30,"sizeDeletions":0},{"number":"3","revision":"25abecf7124c51958ea182ef30051e6a55b7f149","parents":["6e909b0b719155c026dc7117afc3059507c8167f"],"ref":"refs/changes/66/4966/3","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1540222536,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1539877242,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1540310938,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1540310938,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/procedures/index.js","type":"MODIFIED","insertions":3,"deletions":0},{"file":"lib/procedures/update-agent-v1.js","type":"MODIFIED","insertions":27,"deletions":0}],"sizeInsertions":30,"sizeDeletions":0},{"number":"4","revision":"8ed727f0d2dc2e9e7ff35d4441d2be042a48da73","parents":["6e909b0b719155c026dc7117afc3059507c8167f"],"ref":"refs/changes/66/4966/4","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1540313045,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1539877242,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1540310938,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1540310938,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1540313079,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/procedures/index.js","type":"MODIFIED","insertions":3,"deletions":0},{"file":"lib/procedures/update-agent-v1.js","type":"MODIFIED","insertions":27,"deletions":0}],"sizeInsertions":30,"sizeDeletions":0}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}]}