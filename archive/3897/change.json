{"project":"joyent/illumos-joyent","branch":"master","id":"I645e986f65abc07569eace83d2c3a98c5aee5e80","number":"3897","subject":"OS-6892 viona should allow promisc interfaces","owner":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"url":"https://cr.joyent.us/3897","commitMessage":"OS-6892 viona should allow promisc interfaces\n","createdOn":1525299595,"lastUpdated":1525373371,"open":true,"status":"NEW","comments":[{"timestamp":1525299595,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Uploaded patch set 1."},{"timestamp":1525356074,"reviewer":{"name":"Jorge Schrauwen","email":"sjorge@blackdot.be","username":"sjorge"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1525361801,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1525372688,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Patch Set 1:\n\n(2 comments)"},{"timestamp":1525372856,"reviewer":{"name":"Jorge Schrauwen","email":"sjorge@blackdot.be","username":"sjorge"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1525373371,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 1: Code-Review+1"}],"currentPatchSet":{"number":"1","revision":"645e986f65abc07569eace83d2c3a98c5aee5e80","parents":["21010238a099cd373426f6caba5f6d15a0bc918d"],"ref":"refs/changes/97/3897/1","uploader":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"createdOn":1525299595,"author":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1525373371,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"comments":[{"file":"usr/src/uts/i86pc/io/viona/viona.c","line":1341,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"When we get a better handle on loopback cksum/LSO, we\u0027ll want to revisit this opt in for frame fix-ups, as it incurs some rather expensive work.  (We end up in that codepath for tagged VLANs anyways, since the tag must be stripped)"},{"file":"usr/src/uts/i86pc/io/viona/viona.c","line":1341,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Agreed."},{"file":"usr/src/uts/i86pc/io/viona/viona.c","line":1345,"reviewer":{"name":"Jorge Schrauwen","email":"sjorge@blackdot.be","username":"sjorge"},"message":"Will this pass up all traffic for the VLAN tagged on the underlying VNIC? Or all traffic for all VLANs on the physical interface the VNIC is created on?\n\nIf the later, this will break stuff like (U)CARP and other because they will then see multiple announce for all VLANs. I think QEMU works in the same way though. But it might be worth a note in the code about this."},{"file":"usr/src/uts/i86pc/io/viona/viona.c","line":1345,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"It\u0027s currently _all_ traffic, which can be confusing if (as you note) you have overlapping VLANs.  This is a bug, though, and I intend to fix that separately.  It does affect QEMU in the same way, which is where I noticed it.\n\nI\u0027ve filed OS-6927 as a placeholder bug and I\u0027ll flesh it out with more details when I get to working on the fix."},{"file":"usr/src/uts/i86pc/io/viona/viona.c","line":1345,"reviewer":{"name":"Jorge Schrauwen","email":"sjorge@blackdot.be","username":"sjorge"},"message":"SGTM"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/brand/bhyve/zone/statechange","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/uts/i86pc/io/viona/viona.c","type":"MODIFIED","insertions":34,"deletions":-2}],"sizeInsertions":36,"sizeDeletions":-2},"patchSets":[{"number":"1","revision":"645e986f65abc07569eace83d2c3a98c5aee5e80","parents":["21010238a099cd373426f6caba5f6d15a0bc918d"],"ref":"refs/changes/97/3897/1","uploader":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"createdOn":1525299595,"author":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1525373371,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"comments":[{"file":"usr/src/uts/i86pc/io/viona/viona.c","line":1341,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"When we get a better handle on loopback cksum/LSO, we\u0027ll want to revisit this opt in for frame fix-ups, as it incurs some rather expensive work.  (We end up in that codepath for tagged VLANs anyways, since the tag must be stripped)"},{"file":"usr/src/uts/i86pc/io/viona/viona.c","line":1341,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Agreed."},{"file":"usr/src/uts/i86pc/io/viona/viona.c","line":1345,"reviewer":{"name":"Jorge Schrauwen","email":"sjorge@blackdot.be","username":"sjorge"},"message":"Will this pass up all traffic for the VLAN tagged on the underlying VNIC? Or all traffic for all VLANs on the physical interface the VNIC is created on?\n\nIf the later, this will break stuff like (U)CARP and other because they will then see multiple announce for all VLANs. I think QEMU works in the same way though. But it might be worth a note in the code about this."},{"file":"usr/src/uts/i86pc/io/viona/viona.c","line":1345,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"It\u0027s currently _all_ traffic, which can be confusing if (as you note) you have overlapping VLANs.  This is a bug, though, and I intend to fix that separately.  It does affect QEMU in the same way, which is where I noticed it.\n\nI\u0027ve filed OS-6927 as a placeholder bug and I\u0027ll flesh it out with more details when I get to working on the fix."},{"file":"usr/src/uts/i86pc/io/viona/viona.c","line":1345,"reviewer":{"name":"Jorge Schrauwen","email":"sjorge@blackdot.be","username":"sjorge"},"message":"SGTM"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/brand/bhyve/zone/statechange","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/uts/i86pc/io/viona/viona.c","type":"MODIFIED","insertions":34,"deletions":-2}],"sizeInsertions":36,"sizeDeletions":-2}],"allReviewers":[{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},{"name":"Jorge Schrauwen","email":"sjorge@blackdot.be","username":"sjorge"},{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}]}