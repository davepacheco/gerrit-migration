{"project":"joyent/boray","branch":"master","id":"Ic222fbbe841a0d331bc6bc1e82472f8686250ab0","number":"6906","subject":"MANTA-4543 Document and update boray configuration options","owner":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"url":"https://cr.joyent.us/6906","commitMessage":"MANTA-4543 Document and update boray configuration options\n","createdOn":1568392221,"lastUpdated":1569957191,"open":false,"status":"MERGED","comments":[{"timestamp":1568392221,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Uploaded patch set 1."},{"timestamp":1568392223,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit 666d606d93ac62b26b58c58324d895dfcbf3ccb3\n    \n    MANTA-4543 Document and update boray configuration options"},{"timestamp":1568392322,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1569952188,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 1:\n\n(4 comments)"},{"timestamp":1569953802,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Uploaded patch set 2."},{"timestamp":1569953804,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit 931e6451b26eccdc0c3d4bb5180ffcd7d8a5be62\n    \n    Add missing backtick in README"},{"timestamp":1569953902,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1569954278,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Patch Set 1:\n\n(4 comments)"},{"timestamp":1569956520,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 2: Code-Review+1 Integration-Approval+1\n\n(1 comment)"},{"timestamp":1569957148,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Patch Set 1:\n\n\u003e (1 comment)\n\nThose are both good points to keep in mind. I don\u0027t know about the history of why we don\u0027t hae those caps on manta zones, but definitely something to keep in mind if and when we look at that."},{"timestamp":1569957191,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Kelly McLaughlin"}],"currentPatchSet":{"number":"2","revision":"c222fbbe841a0d331bc6bc1e82472f8686250ab0","parents":["005d28ba85e6084a2a43723ff0662aa98c6ef0a7"],"ref":"refs/changes/06/6906/2","uploader":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"createdOn":1569953802,"author":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1569953902,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1569956520,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1569956520,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1569957191,"by":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Cargo.lock","type":"MODIFIED","insertions":1,"deletions":0},{"file":"Cargo.toml","type":"MODIFIED","insertions":1,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":101,"deletions":-1},{"file":"config.toml.dist","type":"MODIFIED","insertions":7,"deletions":-2},{"file":"sapi_manifests/boray/template","type":"MODIFIED","insertions":2,"deletions":-14},{"file":"src/config.rs","type":"MODIFIED","insertions":63,"deletions":-12},{"file":"src/lib.rs","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"src/main.rs","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":178,"sizeDeletions":-32},"patchSets":[{"number":"1","revision":"973026ec39873456086851a34056d61508fb7b4d","parents":["005d28ba85e6084a2a43723ff0662aa98c6ef0a7"],"ref":"refs/changes/06/6906/1","uploader":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"createdOn":1568392221,"author":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1568392322,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"README.md","line":22,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Is capitalization ignored in these values? The example config.toml.dist uses \"info\" (lowercase)."},{"file":"README.md","line":22,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Correct and that is enabled by the `serde_alias` annotations here: https://github.com/joyent/boray/blob/master/src/config.rs#L27-L47."},{"file":"README.md","line":46,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"markdown nit: Missing a backtick here"},{"file":"README.md","line":46,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Done"},{"file":"src/config.rs","line":16,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Does num_cpus do what we want in a SmartOS zone that has no cpu_cap on it?"},{"file":"src/config.rs","line":16,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"I think so. I checked and the zone where I tested the num_cpus package does not seem to have a cap set. It reports 16 cpus which matches the output of `psrinfo`. \n\nHere\u0027s what I found for cpu cap for the zone:\n```\n[root@headnode (emy-18) ~]# prctl -n zone.cpu-cap -i zone 8ea89ed5-31c2-6d04-fd06-a489da145ef2\nzone: 68: 8ea89ed5-31c2-6d04-fd06-a489da145ef2\nNAME    PRIVILEGE       VALUE    FLAG   ACTION                       RECIPIENT\nzone.cpu-cap\n        usage               0    \n        system          4.29G     inf   deny                                 -\n```\n\nAnd the `psrinfo` output: \n\n```\n[root@jenkins-agent-x86-64-19 ~]# psrinfo\n0       on-line   since 05/07/2019 16:16:37\n1       on-line   since 05/07/2019 16:16:40\n2       on-line   since 05/07/2019 16:16:40\n3       on-line   since 05/07/2019 16:16:40\n4       on-line   since 05/07/2019 16:16:40\n5       on-line   since 05/07/2019 16:16:40\n6       on-line   since 05/07/2019 16:16:40\n7       on-line   since 05/07/2019 16:16:40\n8       on-line   since 05/07/2019 16:16:40\n9       on-line   since 05/07/2019 16:16:40\n10      on-line   since 05/07/2019 16:16:40\n11      on-line   since 05/07/2019 16:16:40\n12      on-line   since 05/07/2019 16:16:40\n13      on-line   since 05/07/2019 16:16:40\n14      on-line   since 05/07/2019 16:16:40\n15      on-line   since 05/07/2019 16:16:40\n```"},{"file":"src/config.rs","line":16,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"I guess my worry is either of:\n- If we don\u0027t have CPU caps, could a boray zone be a noisy neighbour for other Manta zones on this box. This isn\u0027t a new problem, however, so we can ignore this for this change.\n- If we later add CPU caps to Manta zones, will a boray zone think it has 16 CPUs to work with, but only, perhaps have 4 if cpu_cap\u003d400?  This is also a problem we\u0027d need to evaluate later for all services if we started applying cpu_caps to Manta zones. In other words, this isn\u0027t aproblem we need to solve for this change."},{"file":"src/lib.rs","line":253,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Is this just a more explicit best practice per this note: https://doc.rust-lang.org/edition-guide/rust-2018/trait-system/dyn-trait-for-trait-objects.html ?\n\nI\u0027m asking as a Rust noob."},{"file":"src/lib.rs","line":253,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Yes, that\u0027s the case. I am actually not in the practice of doing this myself yet. I ran the clippy linter and it made this suggestion which is a relatively new lint added to that tool I believe."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Cargo.lock","type":"MODIFIED","insertions":1,"deletions":0},{"file":"Cargo.toml","type":"MODIFIED","insertions":1,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":101,"deletions":-1},{"file":"config.toml.dist","type":"MODIFIED","insertions":7,"deletions":-2},{"file":"sapi_manifests/boray/template","type":"MODIFIED","insertions":2,"deletions":-14},{"file":"src/config.rs","type":"MODIFIED","insertions":63,"deletions":-12},{"file":"src/lib.rs","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"src/main.rs","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":178,"sizeDeletions":-32},{"number":"2","revision":"c222fbbe841a0d331bc6bc1e82472f8686250ab0","parents":["005d28ba85e6084a2a43723ff0662aa98c6ef0a7"],"ref":"refs/changes/06/6906/2","uploader":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"createdOn":1569953802,"author":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1569953902,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1569956520,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1569956520,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1569957191,"by":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Cargo.lock","type":"MODIFIED","insertions":1,"deletions":0},{"file":"Cargo.toml","type":"MODIFIED","insertions":1,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":101,"deletions":-1},{"file":"config.toml.dist","type":"MODIFIED","insertions":7,"deletions":-2},{"file":"sapi_manifests/boray/template","type":"MODIFIED","insertions":2,"deletions":-14},{"file":"src/config.rs","type":"MODIFIED","insertions":63,"deletions":-12},{"file":"src/lib.rs","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"src/main.rs","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":178,"sizeDeletions":-32}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"}]}