{"project":"joyent/manta-mackerel","branch":"master","id":"I98e839c7c9decbeea44e7c37ca53e841ed15ebc4","number":"5212","subject":"MANTA-4019 Want the storage job to process moray dumps in parallel and compress intermediate objects Reviewed by: Rui \u003crui@joyent.com\u003e Reviewed by: Robert Bogart \u003cRobert.bogart@joyent.com\u003e Approved by: Robert Bogart \u003cRobert.bogart@joyent.com\u003e Approved by:","owner":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"url":"https://cr.joyent.us/5212","commitMessage":"MANTA-4019 Want the storage job to process moray dumps in parallel and compress intermediate objects\nReviewed by: Rui \u003crui@joyent.com\u003e\nReviewed by: Robert Bogart \u003cRobert.bogart@joyent.com\u003e\nApproved by: Robert Bogart \u003cRobert.bogart@joyent.com\u003e\nApproved by: Rui \u003crui@joyent.com\u003e\n","createdOn":1544464711,"lastUpdated":1549579574,"open":false,"status":"MERGED","comments":[{"timestamp":1544464711,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Uploaded patch set 1."},{"timestamp":1544464743,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1544465040,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Uploaded patch set 2: Patch Set 1 was rebased."},{"timestamp":1544465074,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2:\n\n\"make check\" passed ok"},{"timestamp":1544465225,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Uploaded patch set 3."},{"timestamp":1544465259,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1544465447,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Uploaded patch set 4."},{"timestamp":1544465480,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1545076659,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Uploaded patch set 5."},{"timestamp":1545076691,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1547331885,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Uploaded patch set 6."},{"timestamp":1547331919,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 6: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1547473636,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Uploaded patch set 7."},{"timestamp":1547473671,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 7: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1547515163,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Patch Set 7:\n\n(3 comments)\n\nI\u0027ve got a ways to go, but I\u0027m trying to give you an honest code review which requires genuinely trying to understand every line.  I am appreciative of how clean and concise the code is and I haven\u0027t seen anything yet that looks wrong, but I did have some opinions on how to make it easier for other people to understand and contribute later on down the road.\n\nMore comments in the code of the variety that I described in my review up until now would go a long way towards knowing what your intentions are.  Currently, I have to first understand the code, then try and determine the intention based on that, then try to understand whether the code matches the intention, then based on much less knowledge on the subject, evaluate whether or not I think it\u0027s correct.\n\nI still need to tackle storage-fanout (which I\u0027ve already started looking at) and storage map in detail, but if you were to add some commentary, it will greatly speed up the review process."},{"timestamp":1547526337,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Patch Set 7:\n\n\u003e (3 comments)\n \u003e \n \u003e I\u0027ve got a ways to go, but I\u0027m trying to give you an honest code\n \u003e review which requires genuinely trying to understand every line.  I\n \u003e am appreciative of how clean and concise the code is and I haven\u0027t\n \u003e seen anything yet that looks wrong, but I did have some opinions on\n \u003e how to make it easier for other people to understand and contribute\n \u003e later on down the road.\n \u003e \n \u003e More comments in the code of the variety that I described in my\n \u003e review up until now would go a long way towards knowing what your\n \u003e intentions are.  Currently, I have to first understand the code,\n \u003e then try and determine the intention based on that, then try to\n \u003e understand whether the code matches the intention, then based on\n \u003e much less knowledge on the subject, evaluate whether or not I think\n \u003e it\u0027s correct.\n \u003e \n \u003e I still need to tackle storage-fanout (which I\u0027ve already started\n \u003e looking at) and storage map in detail, but if you were to add some\n \u003e commentary, it will greatly speed up the review process.\n\nThank you Robert for taking the time to review these changes. I added more comments. Hopefully, that makes it easier to reason about the code. If you\n\n \u003e (3 comments)\n \u003e \n \u003e I\u0027ve got a ways to go, but I\u0027m trying to give you an honest code\n \u003e review which requires genuinely trying to understand every line.  I\n \u003e am appreciative of how clean and concise the code is and I haven\u0027t\n \u003e seen anything yet that looks wrong, but I did have some opinions on\n \u003e how to make it easier for other people to understand and contribute\n \u003e later on down the road.\n \u003e \n \u003e More comments in the code of the variety that I described in my\n \u003e review up until now would go a long way towards knowing what your\n \u003e intentions are.  Currently, I have to first understand the code,\n \u003e then try and determine the intention based on that, then try to\n \u003e understand whether the code matches the intention, then based on\n \u003e much less knowledge on the subject, evaluate whether or not I think\n \u003e it\u0027s correct.\n \u003e \n \u003e I still need to tackle storage-fanout (which I\u0027ve already started\n \u003e looking at) and storage map in detail, but if you were to add some\n \u003e commentary, it will greatly speed up the review process.\n\nThank you Robert for taking the time to review these changes. I added more comments to make it easier to reason about the areas I thought might need some explanation.  If you come across a part of the code that is not immediately clear to you, please let me know. I will see if can be rewritten in a better way or at least add some comment."},{"timestamp":1547526351,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Uploaded patch set 8."},{"timestamp":1547526385,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 8: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1547561399,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Uploaded patch set 9."},{"timestamp":1547561433,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 9: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1547592308,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Patch Set 9:\n\n(9 comments)\n\nI still have a few files to go, but this is my review for storage-fanout.js.  I was hoping that reinforcements would arrive on the code review side today, but it looks like for the time being, it\u0027s still just me.  I\u0027ll just keep marching through until we\u0027re at the end.  Be sure to update the Jira ticket with test notes when you have a chance too."},{"timestamp":1547603445,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Uploaded patch set 10."},{"timestamp":1547603478,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 10: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1547603784,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Patch Set 10:\n\n(10 comments)\n\n\u003e (9 comments)\n \u003e \n \u003e I still have a few files to go, but this is my review for\n \u003e storage-fanout.js.  I was hoping that reinforcements would arrive\n \u003e on the code review side today, but it looks like for the time\n \u003e being, it\u0027s still just me.  I\u0027ll just keep marching through until\n \u003e we\u0027re at the end.  Be sure to update the Jira ticket with test\n \u003e notes when you have a chance too.\n\nThank you!"},{"timestamp":1547684273,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Patch Set 10:\n\n(3 comments)\n\nThanks for your explanation on those points.  I understand better now.  I haven\u0027t had a chance to go further today, because I\u0027m also in the process of wrapping up a manatee issue, but I\u0027ll keep going through this either tonight or in the morning."},{"timestamp":1547766544,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Patch Set 10:\n\n(4 comments)\n\nMarching through the last two noteworthy files here, a couple of general things:\n1. I\u0027m really sorry that you\u0027ve had to wait so long for a review that it\u0027s now 2019 and the copyrights across the files need an update.  It\u0027s really hard to get someone to sit down hit pause on their own work to review yours, but at the end of the day, it\u0027s all Joyent work (at least that\u0027s how I see it).\n2. I think it would be really helpful to have a brief description at the top of storage-map and zsplitter about what their role is in the project.  I understand it now, but it took me a little while.\n3. Don\u0027t forget to update the ticket with test notes.  Once we are done with code review, I will also try to IA so that you can finally integrate."},{"timestamp":1547826737,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Patch Set 10:\n\n(21 comments)\n\nThis looks pretty solid.  I haven\u0027t looked at every file, but I have a couple drive by comments."},{"timestamp":1547859036,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Patch Set 10:\n\n(1 comment)\n\n\u003e (4 comments)\n \u003e \n \u003e Marching through the last two noteworthy files here, a couple of\n \u003e general things:\n \u003e 1. I\u0027m really sorry that you\u0027ve had to wait so long for a review\n \u003e that it\u0027s now 2019 and the copyrights across the files need an\n \u003e update.  It\u0027s really hard to get someone to sit down hit pause on\n \u003e their own work to review yours, but at the end of the day, it\u0027s all\n \u003e Joyent work (at least that\u0027s how I see it).\n \u003e 2. I think it would be really helpful to have a brief description\n \u003e at the top of storage-map and zsplitter about what their role is in\n \u003e the project.  I understand it now, but it took me a little while.\nI added a comment to storage-map.js and zsplitter.js.\n \u003e 3. Don\u0027t forget to update the ticket with test notes.  Once we are\n \u003e done with code review, I will also try to IA so that you can\n \u003e finally integrate.\nUpdated the jira ticket with testing notes."},{"timestamp":1547859221,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Patch Set 10:\n\n\u003e (4 comments)\n \u003e \n \u003e Marching through the last two noteworthy files here, a couple of\n \u003e general things:\n \u003e 1. I\u0027m really sorry that you\u0027ve had to wait so long for a review\n \u003e that it\u0027s now 2019 and the copyrights across the files need an\n \u003e update.  It\u0027s really hard to get someone to sit down hit pause on\n \u003e their own work to review yours, but at the end of the day, it\u0027s all\n \u003e Joyent work (at least that\u0027s how I see it).\nUpdated the copyrights to 2019.\n \u003e 2. I think it would be really helpful to have a brief description\n \u003e at the top of storage-map and zsplitter about what their role is in\n \u003e the project.  I understand it now, but it took me a little while.\n \u003e 3. Don\u0027t forget to update the ticket with test notes.  Once we are\n \u003e done with code review, I will also try to IA so that you can\n \u003e finally integrate."},{"timestamp":1547860798,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Patch Set 10:\n\n(21 comments)\n\n\u003e (21 comments)\n \u003e \n \u003e This looks pretty solid.  I haven\u0027t looked at every file, but I\n \u003e have a couple drive by comments.\n\nThank you Rui for taking a look. Please let me know if I have missed addressing any of your comments.\n\n \u003e (21 comments)\n \u003e \n \u003e This looks pretty solid.  I haven\u0027t looked at every file, but I\n \u003e have a couple drive by comments.\n\nThank you for taking a look. Please let me know if I have missed to address any of your comments."},{"timestamp":1547860977,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Uploaded patch set 11."},{"timestamp":1547861009,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 11: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1547861330,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Patch Set 11:\n\n(1 comment)\n\n\u003e Uploaded patch set 11.\n\nI fixed a regression I introduced in storage-fanout.js"},{"timestamp":1548375491,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Uploaded patch set 12."},{"timestamp":1548375531,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 12: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1548386917,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Uploaded patch set 13."},{"timestamp":1548386958,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 13: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1548433921,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Patch Set 13:\n\n(4 comments)"},{"timestamp":1548444127,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Uploaded patch set 14."},{"timestamp":1548444166,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 14: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1548633641,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Uploaded patch set 15."},{"timestamp":1548633681,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 15: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1548800034,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Patch Set 15:\n\n(4 comments)\n\n\u003e (4 comments)\n\nReplied to your comments."},{"timestamp":1548948762,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Patch Set 15:\n\n(1 comment)\n\nOne nit.  Still looking at storage-fanout.js"},{"timestamp":1548958957,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Patch Set 15:\n\n(5 comments)"},{"timestamp":1548966650,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Uploaded patch set 16."},{"timestamp":1548966695,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 16: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1548966709,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Patch Set 16:\n\n(6 comments)\n\n\u003e (5 comments)\n\nThank you for taking a look."},{"timestamp":1549030339,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Patch Set 15:\n\n(1 comment)"},{"timestamp":1549043854,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Patch Set 15:\n\n(1 comment)\n\n\u003e (1 comment)"},{"timestamp":1549298986,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Patch Set 16:\n\n(2 comments)"},{"timestamp":1549299400,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Patch Set 16:\n\n(1 comment)"},{"timestamp":1549304490,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Patch Set 16:\n\n(1 comment)"},{"timestamp":1549325255,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Patch Set 16:\n\n(4 comments)\n\n\u003e (2 comments)"},{"timestamp":1549325312,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Uploaded patch set 17."},{"timestamp":1549325354,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 17: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1549355073,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Uploaded patch set 18."},{"timestamp":1549355115,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 18: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1549382193,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Patch Set 18:\n\n(2 comments)"},{"timestamp":1549399312,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Uploaded patch set 19."},{"timestamp":1549399355,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 19: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1549400545,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Patch Set 19:\n\n(1 comment)\n\n\u003e (2 comments)"},{"timestamp":1549401138,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Patch Set 19:\n\n(1 comment)\n\n\u003e (2 comments)"},{"timestamp":1549488605,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Uploaded patch set 20."},{"timestamp":1549488651,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 20: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1549492705,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Patch Set 20:\n\n(1 comment)"},{"timestamp":1549496155,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Uploaded patch set 21."},{"timestamp":1549496173,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Patch Set 21:\n\n(1 comment)\n\n\u003e (1 comment)"},{"timestamp":1549496196,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 21: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1549498845,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Patch Set 20:\n\n(5 comments)"},{"timestamp":1549499912,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Uploaded patch set 22."},{"timestamp":1549499956,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 22: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1549500195,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Patch Set 22:\n\n(1 comment)"},{"timestamp":1549500963,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Uploaded patch set 23."},{"timestamp":1549501007,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 23: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1549501064,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Patch Set 23: Code-Review+1"},{"timestamp":1549501157,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Patch Set 23: Code-Review+1"},{"timestamp":1549558739,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Patch Set 23: Integration-Approval+1"},{"timestamp":1549578078,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Patch Set 23: Integration-Approval+1"},{"timestamp":1549579365,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Uploaded patch set 24: Commit message was updated."},{"timestamp":1549579574,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Mohamed Khalfella"}],"currentPatchSet":{"number":"24","revision":"98e839c7c9decbeea44e7c37ca53e841ed15ebc4","parents":["2100772904ad472c0c21b495efe4d80f483bcb91"],"ref":"refs/changes/12/5212/24","uploader":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"createdOn":1549579365,"author":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1549501007,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1549501064,"by":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1549501157,"by":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1549558739,"by":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1549578078,"by":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"}},{"type":"SUBM","value":"1","grantedOn":1549579574,"by":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"assets/bin/storage-fanout","type":"ADDED","insertions":9,"deletions":0},{"file":"assets/bin/storage-map","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"assets/bin/storage-reduce1","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"assets/lib/muploader.js","type":"ADDED","insertions":172,"deletions":0},{"file":"assets/lib/storage-fanout.js","type":"ADDED","insertions":325,"deletions":0},{"file":"assets/lib/storage-map.js","type":"MODIFIED","insertions":237,"deletions":-70},{"file":"assets/lib/zsplitter.js","type":"ADDED","insertions":146,"deletions":0},{"file":"etc/jobs.json","type":"MODIFIED","insertions":19,"deletions":-2},{"file":"package.json","type":"MODIFIED","insertions":7,"deletions":-4},{"file":"sapi_manifests/mackerel-jobs/template","type":"MODIFIED","insertions":18,"deletions":-1},{"file":"test/storagefanout.test.js","type":"ADDED","insertions":183,"deletions":0},{"file":"test/storagemap.test.js","type":"MODIFIED","insertions":253,"deletions":-1},{"file":"test/test_data/lookup.json","type":"MODIFIED","insertions":22,"deletions":-1}],"sizeInsertions":1396,"sizeDeletions":-84},"patchSets":[{"number":"1","revision":"752f1e41159325c3ca9afcf6f359ed0e74b9d218","parents":["024dc0c95ed7eb7bf7fc35bb07ac9a69d2e4aeec"],"ref":"refs/changes/12/5212/1","uploader":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"createdOn":1544464711,"author":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1544464743,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"assets/bin/storage-map","type":"MODIFIED","insertions":2,"deletions":-4},{"file":"assets/bin/storage-reduce1","type":"MODIFIED","insertions":3,"deletions":-23},{"file":"assets/bin/storage-reduce2","type":"MODIFIED","insertions":24,"deletions":-3},{"file":"assets/bin/storage-reduce3","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"assets/bin/storage-reduce4","type":"ADDED","insertions":9,"deletions":0},{"file":"assets/lib/muploader.js","type":"ADDED","insertions":148,"deletions":0},{"file":"assets/lib/storage-map.js","type":"MODIFIED","insertions":121,"deletions":-82},{"file":"assets/lib/storage-reduce1.js","type":"MODIFIED","insertions":186,"deletions":-194},{"file":"assets/lib/storage-reduce2.js","type":"ADDED","insertions":236,"deletions":0},{"file":"assets/lib/storage-reduce4.js","fileOld":"assets/lib/storage-reduce3.js","type":"RENAMED","insertions":0,"deletions":0},{"file":"assets/lib/zsplitter.js","type":"ADDED","insertions":187,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":7,"deletions":-4},{"file":"zsplitter.js","type":"ADDED","insertions":144,"deletions":0}],"sizeInsertions":1072,"sizeDeletions":-314},{"number":"2","revision":"c143b0cc3bdfa66bcdc634953e3d4dcc331f9cf2","parents":["8a0045f8c9b2b289e2cbdd3e00f5d64f8f40c94c"],"ref":"refs/changes/12/5212/2","uploader":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"createdOn":1544465040,"author":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1544464743,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"assets/bin/storage-map","type":"MODIFIED","insertions":2,"deletions":-4},{"file":"assets/bin/storage-reduce1","type":"MODIFIED","insertions":3,"deletions":-23},{"file":"assets/bin/storage-reduce2","type":"MODIFIED","insertions":24,"deletions":-3},{"file":"assets/bin/storage-reduce3","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"assets/bin/storage-reduce4","type":"ADDED","insertions":9,"deletions":0},{"file":"assets/lib/muploader.js","type":"ADDED","insertions":148,"deletions":0},{"file":"assets/lib/storage-map.js","type":"MODIFIED","insertions":121,"deletions":-82},{"file":"assets/lib/storage-reduce1.js","type":"MODIFIED","insertions":186,"deletions":-194},{"file":"assets/lib/storage-reduce2.js","type":"ADDED","insertions":236,"deletions":0},{"file":"assets/lib/storage-reduce4.js","fileOld":"assets/lib/storage-reduce3.js","type":"RENAMED","insertions":0,"deletions":0},{"file":"assets/lib/zsplitter.js","type":"ADDED","insertions":187,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":7,"deletions":-4},{"file":"zsplitter.js","type":"ADDED","insertions":144,"deletions":0}],"sizeInsertions":1069,"sizeDeletions":-311},{"number":"3","revision":"a775e851116d489509d675d77b4e8b8ba96a1b4b","parents":["8a0045f8c9b2b289e2cbdd3e00f5d64f8f40c94c"],"ref":"refs/changes/12/5212/3","uploader":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"createdOn":1544465225,"author":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1544465259,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"assets/bin/storage-map","type":"MODIFIED","insertions":2,"deletions":-4},{"file":"assets/bin/storage-reduce1","type":"MODIFIED","insertions":3,"deletions":-23},{"file":"assets/bin/storage-reduce2","type":"MODIFIED","insertions":24,"deletions":-3},{"file":"assets/bin/storage-reduce3","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"assets/bin/storage-reduce4","type":"ADDED","insertions":9,"deletions":0},{"file":"assets/lib/muploader.js","type":"ADDED","insertions":148,"deletions":0},{"file":"assets/lib/storage-map.js","type":"MODIFIED","insertions":121,"deletions":-82},{"file":"assets/lib/storage-reduce1.js","type":"MODIFIED","insertions":186,"deletions":-194},{"file":"assets/lib/storage-reduce2.js","type":"ADDED","insertions":236,"deletions":0},{"file":"assets/lib/storage-reduce4.js","fileOld":"assets/lib/storage-reduce3.js","type":"RENAMED","insertions":0,"deletions":0},{"file":"assets/lib/zsplitter.js","type":"ADDED","insertions":187,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":7,"deletions":-4}],"sizeInsertions":925,"sizeDeletions":-311},{"number":"4","revision":"ec7bdc3ba7c1d03d8c00dd6f86e6d981eddbe4b9","parents":["8a0045f8c9b2b289e2cbdd3e00f5d64f8f40c94c"],"ref":"refs/changes/12/5212/4","uploader":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"createdOn":1544465447,"author":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1544465480,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"assets/bin/storage-map","type":"MODIFIED","insertions":2,"deletions":-4},{"file":"assets/bin/storage-reduce1","type":"MODIFIED","insertions":3,"deletions":-23},{"file":"assets/bin/storage-reduce2","type":"MODIFIED","insertions":24,"deletions":-3},{"file":"assets/bin/storage-reduce3","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"assets/bin/storage-reduce4","type":"ADDED","insertions":9,"deletions":0},{"file":"assets/lib/muploader.js","type":"ADDED","insertions":148,"deletions":0},{"file":"assets/lib/storage-map.js","type":"MODIFIED","insertions":121,"deletions":-82},{"file":"assets/lib/storage-reduce1.js","type":"MODIFIED","insertions":186,"deletions":-194},{"file":"assets/lib/storage-reduce2.js","type":"ADDED","insertions":236,"deletions":0},{"file":"assets/lib/storage-reduce4.js","fileOld":"assets/lib/storage-reduce3.js","type":"RENAMED","insertions":0,"deletions":0},{"file":"assets/lib/zsplitter.js","type":"ADDED","insertions":186,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":7,"deletions":-4}],"sizeInsertions":924,"sizeDeletions":-311},{"number":"5","revision":"c7e3faec6c181e109d3bd44bc2aff96fd7a260e0","parents":["8a0045f8c9b2b289e2cbdd3e00f5d64f8f40c94c"],"ref":"refs/changes/12/5212/5","uploader":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"createdOn":1545076659,"author":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1545076691,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"assets/bin/storage-fanout","type":"ADDED","insertions":9,"deletions":0},{"file":"assets/bin/storage-map","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"assets/bin/storage-reduce1","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"assets/lib/muploader.js","type":"ADDED","insertions":151,"deletions":0},{"file":"assets/lib/storage-fanout.js","type":"ADDED","insertions":163,"deletions":0},{"file":"assets/lib/storage-map.js","type":"MODIFIED","insertions":193,"deletions":-70},{"file":"assets/lib/zsplitter.js","type":"ADDED","insertions":183,"deletions":0},{"file":"etc/jobs.json","type":"MODIFIED","insertions":20,"deletions":-2},{"file":"package.json","type":"MODIFIED","insertions":7,"deletions":-4}],"sizeInsertions":730,"sizeDeletions":-80},{"number":"6","revision":"28c6e2008193c6a10ade2ddc3324bac530dc9f1b","parents":["8a0045f8c9b2b289e2cbdd3e00f5d64f8f40c94c"],"ref":"refs/changes/12/5212/6","uploader":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"createdOn":1547331885,"author":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1547331919,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"assets/bin/storage-fanout","type":"ADDED","insertions":9,"deletions":0},{"file":"assets/bin/storage-map","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"assets/bin/storage-reduce1","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"assets/lib/muploader.js","type":"ADDED","insertions":151,"deletions":0},{"file":"assets/lib/storage-fanout.js","type":"ADDED","insertions":163,"deletions":0},{"file":"assets/lib/storage-map.js","type":"MODIFIED","insertions":193,"deletions":-70},{"file":"assets/lib/zsplitter.js","type":"ADDED","insertions":183,"deletions":0},{"file":"etc/jobs.json","type":"MODIFIED","insertions":20,"deletions":-2},{"file":"package.json","type":"MODIFIED","insertions":7,"deletions":-4},{"file":"test/storagefanout.test.js","type":"ADDED","insertions":227,"deletions":0},{"file":"test/storagemap.test.js","type":"MODIFIED","insertions":252,"deletions":0},{"file":"test/test_data/lookup.json","type":"MODIFIED","insertions":22,"deletions":-1}],"sizeInsertions":1231,"sizeDeletions":-81},{"number":"7","revision":"d29ae6c80fc00d7272f372f0b9e378217c4037d8","parents":["8a0045f8c9b2b289e2cbdd3e00f5d64f8f40c94c"],"ref":"refs/changes/12/5212/7","uploader":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"createdOn":1547473636,"author":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1547473671,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"assets/lib/muploader.js","line":73,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Opinion: If it were me, I\u0027d rename this to something other than \u0027er\u0027.  Another .25 seconds on the \u0027r\u0027 key and it\u0027s the same as our friend below.  Maybe consider numbering them instead?  Or maybe considering disregarding this entirely."},{"file":"assets/lib/muploader.js","line":73,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Fixed."},{"file":"assets/lib/muploader.js","line":131,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"The impact that this block has on functions further down the call stack is profound.  `cb(err)\u0027 in this case basically appears to mean game over, while `qcb\u0027 (basically) allows us to process the next task in the queue.\n\nAt least for me, what makes this so confusing is that this can either be a process ending function or not, depending on whether or not something is passed to it.  I didn\u0027t understand that at first and as a result, I misunderstood everything above this that gets called later.  I\u0027d advise a couple of things:\n\n1. In the cases where `cb()\u0027 is being called due to a failure that we know is going to end the process, place a comment above it explaining why we\u0027re failing (e.g. too many retries, or we failed to create a directory for some reason other than it already existing).\n\n2. This is more of a question than anything, but does anything aside from storage-fanout use this?  If the answer is no, then cb(err) is going to cause the process to exit before we call queue.kill() and return anyway.  If yes, it would be good to know who else does."},{"file":"assets/lib/muploader.js","line":131,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Errors at this level are process-ending. We try to keep all the retrying logic in uploadReducerFile(). If it returns an error, it means we have exhausted all the retry attempts with no success.\n\n[1] - I tried to add comments to make it clearer. If you find some areas that can be enhanced with more comments, please let me know. I will happily flesh it out with more comments.\n\n[2] - Both storage-fanout.js and storage-map.js use muploader to upload reducer files to manta when direct upload option is specified. Thank you for catching this bug. I swapped the order of function calls such that we always call queue.kill() before cb(err)."},{"file":"assets/lib/storage-fanout.js","line":14,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"breaking**"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"assets/bin/storage-fanout","type":"ADDED","insertions":9,"deletions":0},{"file":"assets/bin/storage-map","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"assets/bin/storage-reduce1","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"assets/lib/muploader.js","type":"ADDED","insertions":151,"deletions":0},{"file":"assets/lib/storage-fanout.js","type":"ADDED","insertions":298,"deletions":0},{"file":"assets/lib/storage-map.js","type":"MODIFIED","insertions":193,"deletions":-70},{"file":"assets/lib/zsplitter.js","type":"ADDED","insertions":183,"deletions":0},{"file":"etc/jobs.json","type":"MODIFIED","insertions":21,"deletions":-3},{"file":"package.json","type":"MODIFIED","insertions":7,"deletions":-4},{"file":"test/storagefanout.test.js","type":"ADDED","insertions":188,"deletions":0},{"file":"test/storagemap.test.js","type":"MODIFIED","insertions":252,"deletions":0},{"file":"test/test_data/lookup.json","type":"MODIFIED","insertions":22,"deletions":-1}],"sizeInsertions":1328,"sizeDeletions":-82},{"number":"8","revision":"ffafa082aa917f9bc419535742debb5d8a607fd5","parents":["8a0045f8c9b2b289e2cbdd3e00f5d64f8f40c94c"],"ref":"refs/changes/12/5212/8","uploader":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"createdOn":1547526351,"author":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1547526385,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"assets/bin/storage-fanout","type":"ADDED","insertions":9,"deletions":0},{"file":"assets/bin/storage-map","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"assets/bin/storage-reduce1","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"assets/lib/muploader.js","type":"ADDED","insertions":173,"deletions":0},{"file":"assets/lib/storage-fanout.js","type":"ADDED","insertions":321,"deletions":0},{"file":"assets/lib/storage-map.js","type":"MODIFIED","insertions":206,"deletions":-70},{"file":"assets/lib/zsplitter.js","type":"ADDED","insertions":184,"deletions":0},{"file":"etc/jobs.json","type":"MODIFIED","insertions":21,"deletions":-3},{"file":"package.json","type":"MODIFIED","insertions":7,"deletions":-4},{"file":"test/storagefanout.test.js","type":"ADDED","insertions":188,"deletions":0},{"file":"test/storagemap.test.js","type":"MODIFIED","insertions":252,"deletions":0},{"file":"test/test_data/lookup.json","type":"MODIFIED","insertions":22,"deletions":-1}],"sizeInsertions":1387,"sizeDeletions":-82},{"number":"9","revision":"1fc58ed1a1d82c7c00fabc2f90ab77ef336ccd18","parents":["8a0045f8c9b2b289e2cbdd3e00f5d64f8f40c94c"],"ref":"refs/changes/12/5212/9","uploader":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"createdOn":1547561399,"author":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1547561433,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"assets/bin/storage-fanout","line":9,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"What is PIGZZ?"},{"file":"assets/bin/storage-fanout","line":9,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"pigz it a tool that does parallel gzip compression and decompression. It is faster that gzip. Strangely, it looks for an environment variable PIGZ, that is why I named the variable PIGZ.\n\nI stopped using PIGZ because it is not helping as I was expecting. It looks like the testing I did in my instance in JPC doesn\u0027t apply when the task is run inside manta."},{"file":"assets/lib/muploader.js","line":21,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Can this be a SAPI tunable and part of a config.json so that we can change it and restart the service if/as needed in prod?"},{"file":"assets/lib/muploader.js","line":21,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"This script is meant to be run inside a manta job. I don\u0027t know how to use SAPI tunables inside a manta job."},{"file":"assets/lib/muploader.js","line":27,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"And there\u0027s no way to set maxSockets for restify-clients?"},{"file":"assets/lib/muploader.js","line":27,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"I think it is possible to set the number of parallel connections for a restify-client. However, in this case, it is manta client that is calling restify and I don\u0027t know if there is an option that manta client exposes which is being passed to restify-client. I copied this code from the current implementation of msplit"},{"file":"assets/lib/muploader.js","line":107,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"nit: whitespace"},{"file":"assets/lib/muploader.js","line":107,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Fixed"},{"file":"assets/lib/storage-fanout.js","line":13,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"multiple"},{"file":"assets/lib/storage-fanout.js","line":13,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"In general, I like this explanation.  One thing that might be helpful to new readers is a description of what the object is as well as the header."},{"file":"assets/lib/storage-fanout.js","line":13,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Fixed. I added more explanation in that comment."},{"file":"assets/lib/storage-fanout.js","line":109,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"This might be a stupid question, but you had mentioned in the comment above that we set the default max to 128.  Is this something different?"},{"file":"assets/lib/storage-fanout.js","line":109,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"This is a mistake - Thank you for catching this."},{"file":"assets/lib/storage-fanout.js","line":134,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"If the process is about to exit anyway, it seems like calling return is not necessary."},{"file":"assets/lib/storage-fanout.js","line":134,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"True - the process will exit anyway, but I like the return statement because it tells the reader we are done with the function at this point, regardless of what fata() does. In other words, when uploadFiles() is read in isolation - without looking at fata(), one can tell we stop the execution as soon as we catch an error."},{"file":"assets/lib/storage-fanout.js","line":155,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"This is petty, I know, but the first character of the descriptions passed to `fatal()\u0027 in most other places appear to be capitalized."},{"file":"assets/lib/storage-fanout.js","line":155,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Fixed."},{"file":"assets/lib/storage-fanout.js","line":211,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"I will readily admit that I am not particularly familiar with the stream-transform API, but is it possible to specify the transform function in the options on line 208 so that we don\u0027t have to directly access `_transform\u0027?"},{"file":"assets/lib/storage-fanout.js","line":211,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"This is definitely possible. Both _transform() and _flush() functions can go inside the options object. I put the function outside for two reasons:\n\n- Stretching the options object to contain that function will hurt the readability of the code, tracking the brackets and the parentheses will be more difficult, and more importantly, I will have to indent the whole function inside Transform() call.\n\n- _transform() accesses decoder and savedString. I wanted to declare and initialize these variables first then write the code that uses them. It is true, I can pass the function to Transform() and then later on declare decoder and savedString. That would have worked without errors, but it is hard to track.\n\nI can modify the code as you suggested, but might be harder to track this way - at least for me :)"},{"file":"assets/lib/storage-fanout.js","line":211,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Nah, now that I know what you were thinking, I think it makes sense to leave it the way you did."},{"file":"assets/lib/storage-fanout.js","line":242,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"This is more of a question than anything, but this looks like we have determined that no more data is coming in and we have an incomplete line, so we just flush it out and add a new line to the end.  Under what kinds of circumstances would that happen and is it a sign of a problem at all?"},{"file":"assets/lib/storage-fanout.js","line":242,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"This should not happen with the existing format for moray dumps. We know for sure that all the lines are properly terminated with \u0027\\n\u0027 at the end of the line. When I wrote this code, I was considering the case where someone has changed the format such that the last line is not always terminated with \u0027\\n\u0027. It is easier to anticipate that now instead of hitting this in the furture. Basically I had these options when dealing with this situation:\n\n- Silently drop the incomplete line, which didn\u0027t make sense. This is a recipe for data loss in the future.\n\n- Raise an error. That make sense, but it is not a capital crime to leave the last line not terminated with \u0027\\n\u0027. It is better to deal with the problem in that case instead of stopping the processing because of this.\n\n- Terminate the line with \u0027\\n\u0027 and push it as normal. This what I decided to do."},{"file":"assets/lib/storage-fanout.js","line":242,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Ah, that makes much more sense.  If we had half of a line, I\u0027d think that\u0027s a sign of a much bigger problem.  I\u0027d recommend revising that comment on 240 then to mention what you just said -- that is, it\u0027s missing the \u0027\\n\u0027, but it\u0027s a full line aside from that."},{"file":"assets/lib/storage-fanout.js","line":242,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Updated the comment."},{"file":"assets/lib/storage-fanout.js","line":268,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"This can be factored by using an \u0027else\u0027 on line 264, then we only have to call `done()\u0027 from one place at the end which (I think) would be a little more clear.  Now that I think about it, something similar could also be considered for the transform function at 211-230."},{"file":"assets/lib/storage-fanout.js","line":268,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"I like to avoid creating new scope as much as possible, that is why I wrote it this way. If it makes it more readable with an else statement, then I should do what you say.\n\nI changed the code as you suggested - sorry for the pain this might have caused."},{"file":"assets/lib/storage-fanout.js","line":268,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"The other motivation that I had aside from the factorization was that it I feel like it\u0027s always easier to debug later when there are fewer ways out of the function.  Obviously this isn\u0027t always the case, but I\u0027ve found it to be often."},{"file":"assets/lib/storage-fanout.js","line":312,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"flushed"},{"file":"assets/lib/storage-fanout.js","line":312,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Fixed."},{"file":"assets/lib/storage-map.js","line":162,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"nit: whitespace"},{"file":"assets/lib/storage-map.js","line":168,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"nit: whitespace"},{"file":"assets/lib/storage-map.js","line":170,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"nit: whitespace"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"assets/bin/storage-fanout","type":"ADDED","insertions":9,"deletions":0},{"file":"assets/bin/storage-map","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"assets/bin/storage-reduce1","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"assets/lib/muploader.js","type":"ADDED","insertions":173,"deletions":0},{"file":"assets/lib/storage-fanout.js","type":"ADDED","insertions":321,"deletions":0},{"file":"assets/lib/storage-map.js","type":"MODIFIED","insertions":199,"deletions":-70},{"file":"assets/lib/zsplitter.js","type":"ADDED","insertions":183,"deletions":0},{"file":"etc/jobs.json","type":"MODIFIED","insertions":21,"deletions":-3},{"file":"package.json","type":"MODIFIED","insertions":7,"deletions":-4},{"file":"test/storagefanout.test.js","type":"ADDED","insertions":188,"deletions":0},{"file":"test/storagemap.test.js","type":"MODIFIED","insertions":252,"deletions":0},{"file":"test/test_data/lookup.json","type":"MODIFIED","insertions":22,"deletions":-1}],"sizeInsertions":1379,"sizeDeletions":-82},{"number":"10","revision":"dfa054cffb243e954c3a3cfa6315d0f05892a241","parents":["8a0045f8c9b2b289e2cbdd3e00f5d64f8f40c94c"],"ref":"refs/changes/12/5212/10","uploader":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"createdOn":1547603445,"author":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1547603478,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"assets/lib/muploader.js","line":21,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Can we make this a SAPI tunable?  If it is not already one with marlin."},{"file":"assets/lib/muploader.js","line":21,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"I don\u0027t know how to make this a SAPI tunable."},{"file":"assets/lib/muploader.js","line":37,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Can this be moved down to line 132, just to keep the MUploader class methods together."},{"file":"assets/lib/muploader.js","line":37,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Moved"},{"file":"assets/lib/muploader.js","line":113,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"It would be nice if these were configurable (sapi_manifests/mackerel/template)."},{"file":"assets/lib/muploader.js","line":113,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"This script is being run inside a manta job. I don\u0027t know how to make these SAPI tunables."},{"file":"assets/lib/storage-map.js","line":51,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"I think it would be really helpful here to add commentary describing the format of a line.  If I\u0027m understanding the project correctly so far, this is the thing that we\u0027re processing through a chain of transforms?"},{"file":"assets/lib/storage-map.js","line":61,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Sorry, this is another petty observation, but I noticed that in some places, comments are added using a double slash (//), then here, we have something different.  I would recommend sticking with one convention through the branch."},{"file":"assets/lib/storage-map.js","line":61,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Fixed."},{"file":"assets/lib/storage-map.js","line":97,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"This looks familiar.  Does this mean that if `opts.directUpload\u0027 is not specified that the output goes to standard out?"},{"file":"assets/lib/storage-map.js","line":97,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Yes. This is the original behavior of storage-map which I didn\u0027t want to change. Instead, I added the option of direct upload  - which is not enabled by default."},{"file":"assets/lib/storage-map.js","line":199,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"It would be nice if we made MANTA_OUTPUT_BASE into an command line option has well."},{"file":"assets/lib/storage-map.js","line":199,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"MANTA_OUTPUT_BASE is required only when direct upload is enabled. Since this script is meant to be run inside a manta job, where this variable is exported by default, I thought it is unnecessary to add a command line option for it."},{"file":"assets/lib/storage-map.js","line":217,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"If Zplitter\u0027s constructor return\u0027s null, we will throw on line 219 below.  Is that what we want?  If so we should assert instead."},{"file":"assets/lib/storage-map.js","line":217,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Updated ZSplitter() to throw an error."},{"file":"assets/lib/zsplitter.js","line":8,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Check copyrights throughout."},{"file":"assets/lib/zsplitter.js","line":8,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Updated"},{"file":"assets/lib/zsplitter.js","line":33,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"callers don\u0027t handled returning undefined."},{"file":"assets/lib/zsplitter.js","line":33,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Fixed"},{"file":"assets/lib/zsplitter.js","line":39,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"callers don\u0027t handled returning undefined."},{"file":"assets/lib/zsplitter.js","line":39,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Fixed"},{"file":"assets/lib/zsplitter.js","line":42,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"space between // and E"},{"file":"assets/lib/zsplitter.js","line":42,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Fixed"},{"file":"assets/lib/zsplitter.js","line":48,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"space between // and T\nalso, \"Temporary\""},{"file":"assets/lib/zsplitter.js","line":48,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Fixed"},{"file":"assets/lib/zsplitter.js","line":63,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"s/We/we/"},{"file":"assets/lib/zsplitter.js","line":63,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Fixed"},{"file":"assets/lib/zsplitter.js","line":76,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Not a huge deal, but using bind() multiple times in a loop like this is likely to decrease performance over the alternative of assigning:\n\n  var self \u003d this;\n\nAnd then using throughout."},{"file":"assets/lib/zsplitter.js","line":76,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Fixed"},{"file":"assets/lib/zsplitter.js","line":93,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"What is \u0027this._fileStreams\u0027 used for?"},{"file":"assets/lib/zsplitter.js","line":93,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"I don\u0027t know what I was thinking when I wrote this code. You are right, this is not needed. I have removed it."},{"file":"assets/lib/zsplitter.js","line":114,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"I might have missed something, but it looks like this is called by the above method, but no one else.  If that\u0027s the case, I\u0027d recommend mentioning that so that people don\u0027t try to use it directly."},{"file":"assets/lib/zsplitter.js","line":114,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Removed writeToReducer()."},{"file":"assets/lib/zsplitter.js","line":127,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"shouldn\u0027t this be:\n\n    if (out.bufferLength + data.length \u003c MAX_BUFFER_SIZE)"},{"file":"assets/lib/zsplitter.js","line":127,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Yes, that makes more sense. Fixed."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"assets/bin/storage-fanout","type":"ADDED","insertions":9,"deletions":0},{"file":"assets/bin/storage-map","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"assets/bin/storage-reduce1","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"assets/lib/muploader.js","type":"ADDED","insertions":173,"deletions":0},{"file":"assets/lib/storage-fanout.js","type":"ADDED","insertions":319,"deletions":0},{"file":"assets/lib/storage-map.js","type":"MODIFIED","insertions":199,"deletions":-70},{"file":"assets/lib/zsplitter.js","type":"ADDED","insertions":183,"deletions":0},{"file":"etc/jobs.json","type":"MODIFIED","insertions":21,"deletions":-3},{"file":"package.json","type":"MODIFIED","insertions":7,"deletions":-4},{"file":"test/storagefanout.test.js","type":"ADDED","insertions":188,"deletions":0},{"file":"test/storagemap.test.js","type":"MODIFIED","insertions":252,"deletions":0},{"file":"test/test_data/lookup.json","type":"MODIFIED","insertions":22,"deletions":-1}],"sizeInsertions":1377,"sizeDeletions":-82},{"number":"11","revision":"6ffc45ebdcce85c7d8cc43e5034fedca9f44d34b","parents":["8a0045f8c9b2b289e2cbdd3e00f5d64f8f40c94c"],"ref":"refs/changes/12/5212/11","uploader":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"createdOn":1547860977,"author":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1547861009,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"assets/lib/storage-fanout.js","line":219,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"I had to update this code to address a regression I introduced few days ago."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"assets/bin/storage-fanout","type":"ADDED","insertions":9,"deletions":0},{"file":"assets/bin/storage-map","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"assets/bin/storage-reduce1","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"assets/lib/muploader.js","type":"ADDED","insertions":172,"deletions":0},{"file":"assets/lib/storage-fanout.js","type":"ADDED","insertions":321,"deletions":0},{"file":"assets/lib/storage-map.js","type":"MODIFIED","insertions":248,"deletions":-70},{"file":"assets/lib/zsplitter.js","type":"ADDED","insertions":175,"deletions":0},{"file":"etc/jobs.json","type":"MODIFIED","insertions":19,"deletions":-2},{"file":"package.json","type":"MODIFIED","insertions":7,"deletions":-4},{"file":"test/storagefanout.test.js","type":"ADDED","insertions":188,"deletions":0},{"file":"test/storagemap.test.js","type":"MODIFIED","insertions":253,"deletions":-1},{"file":"test/test_data/lookup.json","type":"MODIFIED","insertions":22,"deletions":-1}],"sizeInsertions":1419,"sizeDeletions":-83},{"number":"12","revision":"c159f58ac2292117c91a7b01540c943609944369","parents":["cef7bb570e16f2c7872ce1ddd63a608cd169db36"],"ref":"refs/changes/12/5212/12","uploader":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"createdOn":1548375491,"author":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1548375531,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"assets/bin/storage-fanout","type":"ADDED","insertions":9,"deletions":0},{"file":"assets/bin/storage-map","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"assets/bin/storage-reduce1","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"assets/lib/muploader.js","type":"ADDED","insertions":172,"deletions":0},{"file":"assets/lib/storage-fanout.js","type":"ADDED","insertions":329,"deletions":0},{"file":"assets/lib/storage-map.js","type":"MODIFIED","insertions":248,"deletions":-70},{"file":"assets/lib/zsplitter.js","type":"ADDED","insertions":175,"deletions":0},{"file":"etc/jobs.json","type":"MODIFIED","insertions":19,"deletions":-2},{"file":"package.json","type":"MODIFIED","insertions":7,"deletions":-4},{"file":"test/storagefanout.test.js","type":"ADDED","insertions":188,"deletions":0},{"file":"test/storagemap.test.js","type":"MODIFIED","insertions":253,"deletions":-1},{"file":"test/test_data/lookup.json","type":"MODIFIED","insertions":22,"deletions":-1}],"sizeInsertions":1427,"sizeDeletions":-83},{"number":"13","revision":"957525566a739d071e878173e2ddc95f582838df","parents":["cef7bb570e16f2c7872ce1ddd63a608cd169db36"],"ref":"refs/changes/12/5212/13","uploader":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"createdOn":1548386917,"author":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1548386958,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"assets/lib/storage-fanout.js","line":225,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"All the lines are JSON right?\n\nCould you use a combination of jsprim.validateJson() and this https://github.com/joyent/node-vstream-json-parser"},{"file":"assets/lib/storage-fanout.js","line":225,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Parsing, or even validating the JSON objects, at this phase will slow things down. The sole purpose of this phase is to break the dump into smaller files which can be processed in parallel. We defer the validation of the dump to the next phase (storage-map)."},{"file":"assets/lib/storage-map.js","line":97,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Why console and not bunyan \"log\"?"},{"file":"assets/lib/storage-map.js","line":97,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"That is a good suggestion. Will update the code to do so."},{"file":"package.json","line":19,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Why the change to https?\n\nAlso, some of these should be available via npm, so no need to go to git.  I know \u0027manta\u0027 is."},{"file":"package.json","line":19,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"I modified this because it is mentioned in https://github.com/joyent/eng/blob/master/docs/index.md to use git+https. Also, I happen to be one of those people whose private key is not in GH. I found that only \u0027manat\u0027 is available in npm. Will update this file to pull manta from npm instead of GH."},{"file":"test/storagefanout.test.js","line":46,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"str \u003d Array(910).join(\u0027-\u0027)\n\nMade me think of the end of this: https://www.destroyallsoftware.com/talks/wat  :)\n\nYou can also factor this out so you don\u0027t have to generate it every time..."},{"file":"test/storagefanout.test.js","line":46,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Array.join() is way better compared to what I was doing. Thank you for sharing that presentation link :D. My for loop is definitely a big WAT."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"assets/bin/storage-fanout","type":"ADDED","insertions":9,"deletions":0},{"file":"assets/bin/storage-map","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"assets/bin/storage-reduce1","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"assets/lib/muploader.js","type":"ADDED","insertions":172,"deletions":0},{"file":"assets/lib/storage-fanout.js","type":"ADDED","insertions":329,"deletions":0},{"file":"assets/lib/storage-map.js","type":"MODIFIED","insertions":243,"deletions":-70},{"file":"assets/lib/zsplitter.js","type":"ADDED","insertions":168,"deletions":0},{"file":"etc/jobs.json","type":"MODIFIED","insertions":19,"deletions":-2},{"file":"package.json","type":"MODIFIED","insertions":7,"deletions":-4},{"file":"test/storagefanout.test.js","type":"ADDED","insertions":188,"deletions":0},{"file":"test/storagemap.test.js","type":"MODIFIED","insertions":253,"deletions":-1},{"file":"test/test_data/lookup.json","type":"MODIFIED","insertions":22,"deletions":-1}],"sizeInsertions":1415,"sizeDeletions":-83},{"number":"14","revision":"507e27037797ee75af8823e830e77018a67ceb4f","parents":["cef7bb570e16f2c7872ce1ddd63a608cd169db36"],"ref":"refs/changes/12/5212/14","uploader":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"createdOn":1548444127,"author":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1548444166,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"assets/bin/storage-fanout","type":"ADDED","insertions":9,"deletions":0},{"file":"assets/bin/storage-map","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"assets/bin/storage-reduce1","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"assets/lib/muploader.js","type":"ADDED","insertions":172,"deletions":0},{"file":"assets/lib/storage-fanout.js","type":"ADDED","insertions":329,"deletions":0},{"file":"assets/lib/storage-map.js","type":"MODIFIED","insertions":243,"deletions":-70},{"file":"assets/lib/zsplitter.js","type":"ADDED","insertions":168,"deletions":0},{"file":"etc/jobs.json","type":"MODIFIED","insertions":19,"deletions":-2},{"file":"package.json","type":"MODIFIED","insertions":7,"deletions":-4},{"file":"test/storagefanout.test.js","type":"ADDED","insertions":183,"deletions":0},{"file":"test/storagemap.test.js","type":"MODIFIED","insertions":253,"deletions":-1},{"file":"test/test_data/lookup.json","type":"MODIFIED","insertions":22,"deletions":-1}],"sizeInsertions":1410,"sizeDeletions":-83},{"number":"15","revision":"237ee7bb792c9b95adda732da6b9840b5fc7db6d","parents":["cef7bb570e16f2c7872ce1ddd63a608cd169db36"],"ref":"refs/changes/12/5212/15","uploader":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"createdOn":1548633641,"author":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1548633681,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"assets/lib/storage-fanout.js","line":257,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Can we put all the pipes together so they can all be seen at one glance?\n\nI know it may not be possible to put them ALL together because you are fanning out at the rs transform, but it would be helpful to better understand the flow, instead of having to search for calls to pipe().\n\nI think you can probably do something like this around line 278:\nprocess.stdin.pipe(mls)\n.pipe(detachFirstLine);\n\nforEach nReducers {\n  ...\n  detachFirstLine.pipe(rs);\n  ...\n}"},{"file":"assets/lib/storage-fanout.js","line":257,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"I updated the code so that all the plumbing is within few lines of code."},{"file":"assets/lib/storage-fanout.js","line":280,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"can you format this as:\n    for (var n \u003d 0; ...) {\n        var rs \u003d new ...;\n\n        detachFirstLine.pipe(rs);\n        ..."},{"file":"assets/lib/storage-fanout.js","line":280,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Done - assuming this is related to your comment at line 257."},{"file":"assets/lib/storage-map.js","line":250,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"how do we validate the content of each splitkey?  does that matter?\n\ni.e. what if I specified a splitkey of \"foobar\"?"},{"file":"assets/lib/storage-map.js","line":250,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"The short answer is that we don\u0027t. Yes, it matters a LOT. Setting the wrong split keys might cause the same object/owner/type combination to be sent to different reducers. If that happens, then we might end up over charging a customer for creating a snaplink for an object. In stead of charging them once, the customer might be charged as many times as the object has snaplinks.\n\nIf you specify \"foobar\", then all the objects will go to single reducers. This is likely to crash that task. However, the danger is if you specify something like \"key,owner\". This might cause the scenario above to happen.\n\nThe correct split keys are specified in storage-map wrapper shell script."},{"file":"assets/lib/storage-map.js","line":250,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"I guess I don\u0027t know enough about jobs to give any solid advice here, but... 1) what happens if we short circuit the job here in the event that validation fails?, and 2) How much does validation really cost us in performance (it doesn\u0027t seem like much).\n\nGenerally, I\u0027d err on the side of having validation unless there is a specific reason not to."},{"file":"assets/lib/storage-map.js","line":250,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"1- If validation fails, then we exit the process with status code other than 0. Eventually, this will cause the job to be terminated with errors.\n\n2- Since this code is executed once at the process startup, validation should cost us almost nothing. I just don\u0027t know how to implement it. One way I can think of is to hard code the correct split keys here in storage-map.js. However, this is not a big improvement considering the split keys are already hard coded in the wrapper shell-script anyway.\n\nIn my opinion, if someone runs this node script manually in the context of the storage job with wrong split keys, then they deserve to get the wrong results. I think of this same as running \"rm -rf ~\"\n\nHowever, if you think of a better way to implement this, I will be happy to update the code."},{"file":"assets/lib/zsplitter.js","line":77,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Why do we offer this as an option if all input comes from storage-fanout.js which always compresses?"},{"file":"assets/lib/zsplitter.js","line":77,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"I don\u0027t know what I was thinking when I did this. The code has been updated to remove this option."},{"file":"assets/lib/zsplitter.js","line":104,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"How would this happen?  I\u0027d think it is more likely that the result of parseInt() would be NaN, which I think would make fileNumber \u003d\u003d\u003d NaN"},{"file":"assets/lib/zsplitter.js","line":104,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Thank you for catching this one. This should never happen. The coded ended up this way because I had a function `writeToReducer()` which has been removed. I will remove this check all together."},{"file":"package.json","line":17,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"https://www.npmjs.com/package/libmanta"},{"file":"package.json","line":17,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Good catch - updated."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"assets/bin/storage-fanout","type":"ADDED","insertions":9,"deletions":0},{"file":"assets/bin/storage-map","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"assets/bin/storage-reduce1","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"assets/lib/muploader.js","type":"ADDED","insertions":172,"deletions":0},{"file":"assets/lib/storage-fanout.js","type":"ADDED","insertions":329,"deletions":0},{"file":"assets/lib/storage-map.js","type":"MODIFIED","insertions":243,"deletions":-70},{"file":"assets/lib/zsplitter.js","type":"ADDED","insertions":168,"deletions":0},{"file":"etc/jobs.json","type":"MODIFIED","insertions":19,"deletions":-2},{"file":"package.json","type":"MODIFIED","insertions":7,"deletions":-4},{"file":"sapi_manifests/mackerel-jobs/template","type":"MODIFIED","insertions":18,"deletions":-1},{"file":"test/storagefanout.test.js","type":"ADDED","insertions":183,"deletions":0},{"file":"test/storagemap.test.js","type":"MODIFIED","insertions":253,"deletions":-1},{"file":"test/test_data/lookup.json","type":"MODIFIED","insertions":22,"deletions":-1}],"sizeInsertions":1428,"sizeDeletions":-84},{"number":"16","revision":"12f34ef083dd190e0f530d87bfd9f77e210fe410","parents":["cef7bb570e16f2c7872ce1ddd63a608cd169db36"],"ref":"refs/changes/12/5212/16","uploader":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"createdOn":1548966650,"author":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1548966695,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"assets/lib/storage-fanout.js","line":118,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"unused?"},{"file":"assets/lib/storage-fanout.js","line":118,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Thanks for catching this. Removed."},{"file":"assets/lib/storage-map.js","line":195,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"If this is our only use of this module, given it\u0027s history, I think we might want to consider pulling this one function out and adding it to our own local file."},{"file":"assets/lib/storage-map.js","line":195,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"The code has been updated to use split instead of event-stream."},{"file":"package.json","line":14,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"I don\u0027t know if we should be using this at all.  Are there any alternatives?\n\nhttps://github.com/dominictarr/event-stream/issues/116#issuecomment-441745900"},{"file":"package.json","line":14,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"I replaced the module with https://www.npmjs.com/package/split"},{"file":"package.json","line":26,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"I think this has been deprecated.  We should probably use \u0027uuid\u0027 instead https://www.npmjs.com/package/uuid"},{"file":"package.json","line":26,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Updated the code to use uuid instead."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"assets/bin/storage-fanout","type":"ADDED","insertions":9,"deletions":0},{"file":"assets/bin/storage-map","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"assets/bin/storage-reduce1","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"assets/lib/muploader.js","type":"ADDED","insertions":172,"deletions":0},{"file":"assets/lib/storage-fanout.js","type":"ADDED","insertions":327,"deletions":0},{"file":"assets/lib/storage-map.js","type":"MODIFIED","insertions":243,"deletions":-70},{"file":"assets/lib/zsplitter.js","type":"ADDED","insertions":147,"deletions":0},{"file":"etc/jobs.json","type":"MODIFIED","insertions":19,"deletions":-2},{"file":"package.json","type":"MODIFIED","insertions":7,"deletions":-4},{"file":"sapi_manifests/mackerel-jobs/template","type":"MODIFIED","insertions":18,"deletions":-1},{"file":"test/storagefanout.test.js","type":"ADDED","insertions":183,"deletions":0},{"file":"test/storagemap.test.js","type":"MODIFIED","insertions":253,"deletions":-1},{"file":"test/test_data/lookup.json","type":"MODIFIED","insertions":22,"deletions":-1}],"sizeInsertions":1405,"sizeDeletions":-84},{"number":"17","revision":"a039a65f691668cfd78e4aa19f37e652aa5cdb3e","parents":["cef7bb570e16f2c7872ce1ddd63a608cd169db36"],"ref":"refs/changes/12/5212/17","uploader":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"createdOn":1549325312,"author":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1549325354,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"assets/bin/storage-fanout","type":"ADDED","insertions":9,"deletions":0},{"file":"assets/bin/storage-map","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"assets/bin/storage-reduce1","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"assets/lib/muploader.js","type":"ADDED","insertions":172,"deletions":0},{"file":"assets/lib/storage-fanout.js","type":"ADDED","insertions":326,"deletions":0},{"file":"assets/lib/storage-map.js","type":"MODIFIED","insertions":243,"deletions":-70},{"file":"assets/lib/zsplitter.js","type":"ADDED","insertions":147,"deletions":0},{"file":"etc/jobs.json","type":"MODIFIED","insertions":19,"deletions":-2},{"file":"package.json","type":"MODIFIED","insertions":7,"deletions":-4},{"file":"sapi_manifests/mackerel-jobs/template","type":"MODIFIED","insertions":18,"deletions":-1},{"file":"test/storagefanout.test.js","type":"ADDED","insertions":183,"deletions":0},{"file":"test/storagemap.test.js","type":"MODIFIED","insertions":253,"deletions":-1},{"file":"test/test_data/lookup.json","type":"MODIFIED","insertions":22,"deletions":-1}],"sizeInsertions":1404,"sizeDeletions":-84},{"number":"18","revision":"f75702080598fa0c7501b20b5564dfed6542efb4","parents":["cef7bb570e16f2c7872ce1ddd63a608cd169db36"],"ref":"refs/changes/12/5212/18","uploader":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"createdOn":1549355073,"author":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1549355115,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"assets/lib/storage-fanout.js","line":198,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"I am being a very nitty here, but this is sort of bad form.  Generally it is better to import a the parent namespace and then invoke it\u0027s child with a \u0027.\u0027 This way we don\u0027t get confused with other functions, and it is explicit that this method is coming into scope from some place external.\n\nDo you think we could revert this change and change the \u0027require()\u0027 to pull in the full uuid module?\n\n    var mod_uuid \u003d require(\u0027uuid\u0027);\n    \n    ...\n    \n    ...mod_uuid.v4()..."},{"file":"assets/lib/storage-fanout.js","line":198,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Updated the code."},{"file":"package.json","line":25,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Ok.  Interestingly it is the same developer, but there is only one dependency and the code is easily auditable."},{"file":"package.json","line":25,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"Another option was to use [lstream](https://www.npmjs.com/package/lstream). I chose split because it has fewer dependencies."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"assets/bin/storage-fanout","type":"ADDED","insertions":9,"deletions":0},{"file":"assets/bin/storage-map","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"assets/bin/storage-reduce1","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"assets/lib/muploader.js","type":"ADDED","insertions":172,"deletions":0},{"file":"assets/lib/storage-fanout.js","type":"ADDED","insertions":326,"deletions":0},{"file":"assets/lib/storage-map.js","type":"MODIFIED","insertions":243,"deletions":-70},{"file":"assets/lib/zsplitter.js","type":"ADDED","insertions":147,"deletions":0},{"file":"etc/jobs.json","type":"MODIFIED","insertions":19,"deletions":-2},{"file":"package.json","type":"MODIFIED","insertions":7,"deletions":-4},{"file":"sapi_manifests/mackerel-jobs/template","type":"MODIFIED","insertions":18,"deletions":-1},{"file":"test/storagefanout.test.js","type":"ADDED","insertions":183,"deletions":0},{"file":"test/storagemap.test.js","type":"MODIFIED","insertions":253,"deletions":-1},{"file":"test/test_data/lookup.json","type":"MODIFIED","insertions":22,"deletions":-1}],"sizeInsertions":1404,"sizeDeletions":-84},{"number":"19","revision":"122a6e40a8980ff7bd7c61b4781a3fbfa78755eb","parents":["a3e162ac1b4920023cb692f4e4b4c57ddad40aa4"],"ref":"refs/changes/12/5212/19","uploader":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"createdOn":1549399312,"author":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1549399355,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"assets/bin/storage-fanout","type":"ADDED","insertions":9,"deletions":0},{"file":"assets/bin/storage-map","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"assets/bin/storage-reduce1","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"assets/lib/muploader.js","type":"ADDED","insertions":172,"deletions":0},{"file":"assets/lib/storage-fanout.js","type":"ADDED","insertions":326,"deletions":0},{"file":"assets/lib/storage-map.js","type":"MODIFIED","insertions":243,"deletions":-70},{"file":"assets/lib/zsplitter.js","type":"ADDED","insertions":147,"deletions":0},{"file":"etc/jobs.json","type":"MODIFIED","insertions":19,"deletions":-2},{"file":"package.json","type":"MODIFIED","insertions":7,"deletions":-4},{"file":"sapi_manifests/mackerel-jobs/template","type":"MODIFIED","insertions":18,"deletions":-1},{"file":"test/storagefanout.test.js","type":"ADDED","insertions":183,"deletions":0},{"file":"test/storagemap.test.js","type":"MODIFIED","insertions":253,"deletions":-1},{"file":"test/test_data/lookup.json","type":"MODIFIED","insertions":22,"deletions":-1}],"sizeInsertions":1404,"sizeDeletions":-84},{"number":"20","revision":"223632b50f2d341ad4d2d0eb51232dc699b82f28","parents":["2100772904ad472c0c21b495efe4d80f483bcb91"],"ref":"refs/changes/12/5212/20","uploader":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"createdOn":1549488605,"author":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1549488651,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"assets/lib/storage-fanout.js","line":129,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"any reason to not use bunyan here?"},{"file":"assets/lib/storage-fanout.js","line":195,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"If we make \u0027log\u0027 global then we can put this in \"uploadFiles()\" on line 133.\n\nWe initialize it here, but don\u0027t reference again for another 120 lines or so."},{"file":"assets/lib/storage-fanout.js","line":203,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"for these variables from 197 - 203 it seems like we should either declare them at the top of the function or closer to where they are used."},{"file":"assets/lib/storage-map.js","line":176,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Do we still need this? \nhttps://github.com/tjfontaine/node-lstream/commit/30d7900b8bcf8480b64bac74586c081905edd072"},{"file":"assets/lib/storage-map.js","line":176,"reviewer":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"message":"i don\u0027t think we need this any more.\n\n``` js\n# cat /tmp/file\n1\n2\n# cat /tmp/file | od -t x1\n0000000 31 0a 32 0a\n0000004\n# cat test.js\nvar mod_lstream \u003d require(\u0027lstream\u0027);\nvar mod_through2 \u003d require(\u0027through2\u0027);\n\nprocess.stdin\n    .pipe(new mod_lstream())\n    .pipe(mod_through2(function(line, enc, done) {\n        this.push(\u0027#####\u0027 + line + \u0027****\\n\u0027);\n        done();\n    }))\n    .pipe(process.stdout);\n\n# cat /tmp/file | node test.js\n#####1****\n#####2****\n# cat /tmp/file | node test.js | od -t x1\n0000000 23 23 23 23 23 31 2a 2a 2a 2a 0a 23 23 23 23 23\n0000020 32 2a 2a 2a 2a 0a\n0000026\n#\n```"},{"file":"assets/lib/zsplitter.js","line":29,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Move this down to the other this._ initializations."},{"file":"assets/lib/zsplitter.js","line":119,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"extra line"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"assets/bin/storage-fanout","type":"ADDED","insertions":9,"deletions":0},{"file":"assets/bin/storage-map","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"assets/bin/storage-reduce1","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"assets/lib/muploader.js","type":"ADDED","insertions":172,"deletions":0},{"file":"assets/lib/storage-fanout.js","type":"ADDED","insertions":326,"deletions":0},{"file":"assets/lib/storage-map.js","type":"MODIFIED","insertions":243,"deletions":-70},{"file":"assets/lib/zsplitter.js","type":"ADDED","insertions":147,"deletions":0},{"file":"etc/jobs.json","type":"MODIFIED","insertions":19,"deletions":-2},{"file":"package.json","type":"MODIFIED","insertions":7,"deletions":-4},{"file":"sapi_manifests/mackerel-jobs/template","type":"MODIFIED","insertions":18,"deletions":-1},{"file":"test/storagefanout.test.js","type":"ADDED","insertions":183,"deletions":0},{"file":"test/storagemap.test.js","type":"MODIFIED","insertions":253,"deletions":-1},{"file":"test/test_data/lookup.json","type":"MODIFIED","insertions":22,"deletions":-1}],"sizeInsertions":1404,"sizeDeletions":-84},{"number":"21","revision":"96de99d821dc32f9d41d6ff5dfd03909e3949ec4","parents":["2100772904ad472c0c21b495efe4d80f483bcb91"],"ref":"refs/changes/12/5212/21","uploader":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"createdOn":1549496155,"author":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1549496196,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"assets/bin/storage-fanout","type":"ADDED","insertions":9,"deletions":0},{"file":"assets/bin/storage-map","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"assets/bin/storage-reduce1","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"assets/lib/muploader.js","type":"ADDED","insertions":172,"deletions":0},{"file":"assets/lib/storage-fanout.js","type":"ADDED","insertions":326,"deletions":0},{"file":"assets/lib/storage-map.js","type":"MODIFIED","insertions":237,"deletions":-70},{"file":"assets/lib/zsplitter.js","type":"ADDED","insertions":147,"deletions":0},{"file":"etc/jobs.json","type":"MODIFIED","insertions":19,"deletions":-2},{"file":"package.json","type":"MODIFIED","insertions":7,"deletions":-4},{"file":"sapi_manifests/mackerel-jobs/template","type":"MODIFIED","insertions":18,"deletions":-1},{"file":"test/storagefanout.test.js","type":"ADDED","insertions":183,"deletions":0},{"file":"test/storagemap.test.js","type":"MODIFIED","insertions":253,"deletions":-1},{"file":"test/test_data/lookup.json","type":"MODIFIED","insertions":22,"deletions":-1}],"sizeInsertions":1398,"sizeDeletions":-84},{"number":"22","revision":"c08fb4d9d7a34db9eb968d146af2bf7caafa92eb","parents":["2100772904ad472c0c21b495efe4d80f483bcb91"],"ref":"refs/changes/12/5212/22","uploader":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"createdOn":1549499912,"author":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1549499956,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"assets/lib/storage-fanout.js","line":195,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Can you move this down to 275ish"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"assets/bin/storage-fanout","type":"ADDED","insertions":9,"deletions":0},{"file":"assets/bin/storage-map","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"assets/bin/storage-reduce1","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"assets/lib/muploader.js","type":"ADDED","insertions":172,"deletions":0},{"file":"assets/lib/storage-fanout.js","type":"ADDED","insertions":326,"deletions":0},{"file":"assets/lib/storage-map.js","type":"MODIFIED","insertions":237,"deletions":-70},{"file":"assets/lib/zsplitter.js","type":"ADDED","insertions":146,"deletions":0},{"file":"etc/jobs.json","type":"MODIFIED","insertions":19,"deletions":-2},{"file":"package.json","type":"MODIFIED","insertions":7,"deletions":-4},{"file":"sapi_manifests/mackerel-jobs/template","type":"MODIFIED","insertions":18,"deletions":-1},{"file":"test/storagefanout.test.js","type":"ADDED","insertions":183,"deletions":0},{"file":"test/storagemap.test.js","type":"MODIFIED","insertions":253,"deletions":-1},{"file":"test/test_data/lookup.json","type":"MODIFIED","insertions":22,"deletions":-1}],"sizeInsertions":1397,"sizeDeletions":-84},{"number":"23","revision":"d943d2ccebeafca4f049376c412c4c5df683eec5","parents":["2100772904ad472c0c21b495efe4d80f483bcb91"],"ref":"refs/changes/12/5212/23","uploader":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"createdOn":1549500963,"author":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1549501007,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1549501064,"by":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1549578078,"by":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1549501157,"by":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1549558739,"by":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"assets/bin/storage-fanout","type":"ADDED","insertions":9,"deletions":0},{"file":"assets/bin/storage-map","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"assets/bin/storage-reduce1","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"assets/lib/muploader.js","type":"ADDED","insertions":172,"deletions":0},{"file":"assets/lib/storage-fanout.js","type":"ADDED","insertions":325,"deletions":0},{"file":"assets/lib/storage-map.js","type":"MODIFIED","insertions":237,"deletions":-70},{"file":"assets/lib/zsplitter.js","type":"ADDED","insertions":146,"deletions":0},{"file":"etc/jobs.json","type":"MODIFIED","insertions":19,"deletions":-2},{"file":"package.json","type":"MODIFIED","insertions":7,"deletions":-4},{"file":"sapi_manifests/mackerel-jobs/template","type":"MODIFIED","insertions":18,"deletions":-1},{"file":"test/storagefanout.test.js","type":"ADDED","insertions":183,"deletions":0},{"file":"test/storagemap.test.js","type":"MODIFIED","insertions":253,"deletions":-1},{"file":"test/test_data/lookup.json","type":"MODIFIED","insertions":22,"deletions":-1}],"sizeInsertions":1396,"sizeDeletions":-84},{"number":"24","revision":"98e839c7c9decbeea44e7c37ca53e841ed15ebc4","parents":["2100772904ad472c0c21b495efe4d80f483bcb91"],"ref":"refs/changes/12/5212/24","uploader":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"createdOn":1549579365,"author":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1549501007,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1549501064,"by":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1549578078,"by":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1549501157,"by":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1549558739,"by":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"}},{"type":"SUBM","value":"1","grantedOn":1549579574,"by":{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"assets/bin/storage-fanout","type":"ADDED","insertions":9,"deletions":0},{"file":"assets/bin/storage-map","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"assets/bin/storage-reduce1","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"assets/lib/muploader.js","type":"ADDED","insertions":172,"deletions":0},{"file":"assets/lib/storage-fanout.js","type":"ADDED","insertions":325,"deletions":0},{"file":"assets/lib/storage-map.js","type":"MODIFIED","insertions":237,"deletions":-70},{"file":"assets/lib/zsplitter.js","type":"ADDED","insertions":146,"deletions":0},{"file":"etc/jobs.json","type":"MODIFIED","insertions":19,"deletions":-2},{"file":"package.json","type":"MODIFIED","insertions":7,"deletions":-4},{"file":"sapi_manifests/mackerel-jobs/template","type":"MODIFIED","insertions":18,"deletions":-1},{"file":"test/storagefanout.test.js","type":"ADDED","insertions":183,"deletions":0},{"file":"test/storagemap.test.js","type":"MODIFIED","insertions":253,"deletions":-1},{"file":"test/test_data/lookup.json","type":"MODIFIED","insertions":22,"deletions":-1}],"sizeInsertions":1396,"sizeDeletions":-84}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},{"name":"Mohamed Khalfella","email":"khalfella@gmail.com","username":"khalfella"}]}