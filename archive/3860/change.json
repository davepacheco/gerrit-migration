{"project":"joyent/node-triton","branch":"master","id":"I5734123e7538f8b33b152708bd4d58a28e46b926","number":"3860","subject":"joyent/node-triton#245 `triton profile` should generate separate keys for Docker Reviewed by: Trent Mick \u003ctrent.mick@joyent.com\u003e Reviewed by: Marsell Kukuljevic \u003cmarsell@joyent.com\u003e","owner":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"url":"https://cr.joyent.us/3860","commitMessage":"joyent/node-triton#245 `triton profile` should generate separate keys for Docker\nReviewed by: Trent Mick \u003ctrent.mick@joyent.com\u003e\nReviewed by: Marsell Kukuljevic \u003cmarsell@joyent.com\u003e\n","createdOn":1524272319,"lastUpdated":1526428132,"open":false,"status":"MERGED","comments":[{"timestamp":1524272319,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 1."},{"timestamp":1524272349,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing-1\n\n(1 comment)\n\n\"make check\" exited with status 2"},{"timestamp":1524275780,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 2."},{"timestamp":1524275812,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1524691538,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 3."},{"timestamp":1524691570,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1524731591,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 3:\n\n(6 comments)\n\nBike-shed the code. No way will I comment on the actual crypto. :p"},{"timestamp":1524813342,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 4."},{"timestamp":1524813345,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 3:\n\n(6 comments)"},{"timestamp":1524813376,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1524813388,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 5."},{"timestamp":1524813421,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1525211719,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 5:\n\n(2 comments)\n\nAlex,\n\nI also found some potential timing issue with newly created docker certificates. For a minute or two after creating a new cert via `triton profile create` I get a \"Certificate has expired\" error from the server (at least from sdc-docker in east3b). After a while it works.\n\nExample: https://gist.github.com/trentm/e02e87d947e5b6882f0677a2a255efcd\nIt reproduces for me everytime."},{"timestamp":1525299648,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 6."},{"timestamp":1525299680,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 6: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1525299738,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 5:\n\n(2 comments)\n\nChanged it to back-date the certificate that it signs by 5 minutes to account for clock sync."},{"timestamp":1525987231,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 6: Code-Review+1 Integration-Approval+1\n\nA CHANGES.md entry woudl be good... but that can come later with the version bump for a release."},{"timestamp":1526045719,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 6: Code-Review+1\n\n(6 comments)\n\nAs promised, finally went over the crypto. Looks sane to me.\n\nAlbeit a lot of twisty little passages. o.o;"},{"timestamp":1526421992,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 7."},{"timestamp":1526422025,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 7: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1526428013,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 7: Code-Review+1 Integration-Approval+1"},{"timestamp":1526428132,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Alex Wilson"}],"currentPatchSet":{"number":"7","revision":"5734123e7538f8b33b152708bd4d58a28e46b926","parents":["6015cf2145cd4dbd312cd30d4904b65146dc6ab8"],"ref":"refs/changes/60/3860/7","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1526421992,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1526422025,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1526428013,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1526428013,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1526428132,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"lib/do_profile/do_docker_setup.js","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"lib/do_profile/profilecommon.js","type":"MODIFIED","insertions":141,"deletions":-69},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":-3}],"sizeInsertions":155,"sizeDeletions":-74},"patchSets":[{"number":"1","revision":"4dddd2c42311bf0965c3306bda7ba998d9ad138f","parents":["6417595ba60ba213ac51cc160658ed86d7d59e00"],"ref":"refs/changes/60/3860/1","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1524272319,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1524272349,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/do_profile/profilecommon.js","line":380,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"warning: identifer cb hides an identifier in a parent scope"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/do_profile/do_docker_setup.js","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"lib/do_profile/profilecommon.js","type":"MODIFIED","insertions":109,"deletions":-63},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":-3}],"sizeInsertions":119,"sizeDeletions":-67},{"number":"2","revision":"1196e24fcca668a9561329e40829d0f93566006f","parents":["6417595ba60ba213ac51cc160658ed86d7d59e00"],"ref":"refs/changes/60/3860/2","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1524275780,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1524275812,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/do_profile/do_docker_setup.js","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"lib/do_profile/profilecommon.js","type":"MODIFIED","insertions":109,"deletions":-63},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":-3}],"sizeInsertions":119,"sizeDeletions":-67},{"number":"3","revision":"10c37bcd441f0614d167e90b0f11edb0e1073c00","parents":["6015cf2145cd4dbd312cd30d4904b65146dc6ab8"],"ref":"refs/changes/60/3860/3","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1524691538,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1524691570,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/do_profile/do_docker_setup.js","line":2,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Channeling JoshW: 2018"},{"file":"lib/do_profile/do_docker_setup.js","line":2,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Done"},{"file":"lib/do_profile/do_docker_setup.js","line":40,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Would be nice to list the default (10y)."},{"file":"lib/do_profile/do_docker_setup.js","line":40,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Done"},{"file":"lib/do_profile/profilecommon.js","line":368,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Out of curiosity: why?"},{"file":"lib/do_profile/profilecommon.js","line":368,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Because that\u0027s all we have public API for on sshpk at the moment -- you can only generate a certificate already signed, and you have to provide the key to sign it synchronously. So the easiest way is to just self-sign it first, then overwrite the signature afterwards."},{"file":"lib/do_profile/profilecommon.js","line":402,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"It\u0027s complicated enough to give this func a name."},{"file":"lib/do_profile/profilecommon.js","line":402,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Ok, will do."},{"file":"lib/do_profile/profilecommon.js","line":422,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Name this too."},{"file":"lib/do_profile/profilecommon.js","line":422,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Done"},{"file":"lib/do_profile/profilecommon.js","line":433,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Name this."},{"file":"lib/do_profile/profilecommon.js","line":433,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/do_profile/do_docker_setup.js","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"lib/do_profile/profilecommon.js","type":"MODIFIED","insertions":134,"deletions":-69},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":-3}],"sizeInsertions":144,"sizeDeletions":-73},{"number":"4","revision":"0a6a9b497ed0f61da2e50dfd8e581c2ca347bc34","parents":["6015cf2145cd4dbd312cd30d4904b65146dc6ab8"],"ref":"refs/changes/60/3860/4","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1524813342,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1524813376,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/do_profile/do_docker_setup.js","type":"MODIFIED","insertions":8,"deletions":-1},{"file":"lib/do_profile/profilecommon.js","type":"MODIFIED","insertions":137,"deletions":-69},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":-3}],"sizeInsertions":148,"sizeDeletions":-73},{"number":"5","revision":"e555282d33bd7e5e15b26751c4859f7dd632841c","parents":["6015cf2145cd4dbd312cd30d4904b65146dc6ab8"],"ref":"refs/changes/60/3860/5","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1524813388,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1524813421,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/do_profile/profilecommon.js","line":145,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Doc entry for \u0027lifetime\u0027 would be nice."},{"file":"lib/do_profile/profilecommon.js","line":145,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Done"},{"file":"lib/do_profile/profilecommon.js","line":386,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Is there a reason we don\u0027t publish a new sshpk with the public support needed here?"},{"file":"lib/do_profile/profilecommon.js","line":386,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"No specific reason, it\u0027s just that we would have to figure out what API to add to sshpk (today it doesn\u0027t support async signers whatsoever in any of its API) and I\u0027d like to come back to it at some later time to do a good job of it..."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/do_profile/do_docker_setup.js","type":"MODIFIED","insertions":9,"deletions":-2},{"file":"lib/do_profile/profilecommon.js","type":"MODIFIED","insertions":138,"deletions":-70},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":-3}],"sizeInsertions":150,"sizeDeletions":-75},{"number":"6","revision":"eb66721caa3fc4bd684fb5a12a90e7563d17a091","parents":["6015cf2145cd4dbd312cd30d4904b65146dc6ab8"],"ref":"refs/changes/60/3860/6","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1525299648,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1525299680,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1525987231,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1525987231,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1526045719,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}}],"comments":[{"file":"lib/do_profile/profilecommon.js","line":328,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"name"},{"file":"lib/do_profile/profilecommon.js","line":349,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Can\u0027t next be passed directly?"},{"file":"lib/do_profile/profilecommon.js","line":412,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Not needed?"},{"file":"lib/do_profile/profilecommon.js","line":413,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"name"},{"file":"lib/do_profile/profilecommon.js","line":433,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"name"},{"file":"lib/do_profile/profilecommon.js","line":444,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"name"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/do_profile/do_docker_setup.js","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"lib/do_profile/profilecommon.js","type":"MODIFIED","insertions":145,"deletions":-69},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":-3}],"sizeInsertions":155,"sizeDeletions":-73},{"number":"7","revision":"5734123e7538f8b33b152708bd4d58a28e46b926","parents":["6015cf2145cd4dbd312cd30d4904b65146dc6ab8"],"ref":"refs/changes/60/3860/7","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1526421992,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"SUBM","value":"1","grantedOn":1526428132,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1526422025,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1526428013,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1526428013,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"lib/do_profile/do_docker_setup.js","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"lib/do_profile/profilecommon.js","type":"MODIFIED","insertions":141,"deletions":-69},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":-3}],"sizeInsertions":155,"sizeDeletions":-74}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}]}