{"project":"joyent/illumos-joyent","branch":"master","id":"I21e2c666e809045ac5b02a65fa8b9c6708909804","number":"3913","subject":"OS-6930 bhyve PIR can still miss PIR wake-ups Reviewed by: John Levon \u003cjohn.levon@joyent.com\u003e Reviewed by: Bryan Cantrill \u003cbryan@joyent.com\u003e Approved by: Robert Mustacchi \u003crm@joyent.com\u003e","owner":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"url":"https://cr.joyent.us/3913","commitMessage":"OS-6930 bhyve PIR can still miss PIR wake-ups\nReviewed by: John Levon \u003cjohn.levon@joyent.com\u003e\nReviewed by: Bryan Cantrill \u003cbryan@joyent.com\u003e\nApproved by: Robert Mustacchi \u003crm@joyent.com\u003e\n","createdOn":1525471623,"lastUpdated":1527621313,"open":false,"status":"MERGED","comments":[{"timestamp":1525471623,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 1."},{"timestamp":1525787693,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 1: Code-Review+1"},{"timestamp":1526571150,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 2: Patch Set 1 was rebased."},{"timestamp":1527266228,"reviewer":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"message":"Patch Set 2: Code-Review+1\n\n(2 comments)\n\nLooks good! Left a question about whether it\u0027s worth it to have the logic in its own function or not, but entirely stylistic."},{"timestamp":1527280323,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 3: Patch Set 2 was rebased."},{"timestamp":1527283580,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 3:\n\nThe failure mode covered by this patch was completely theoretical, so I\u0027ve not tested for it specifically.  With the changes applied, the normal OS smoke tests pass on Linux and illumos guests."},{"timestamp":1527619288,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 4: Patch Set 3 was rebased."},{"timestamp":1527619650,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 2:\n\n(1 comment)\n\nUpdated per the discussion held afterward"},{"timestamp":1527620516,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 4: Integration-Approval+1"},{"timestamp":1527621250,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 5: Commit message was updated."},{"timestamp":1527621313,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Patrick Mooney"}],"currentPatchSet":{"number":"5","revision":"21e2c666e809045ac5b02a65fa8b9c6708909804","parents":["a342859e706a48afa2e2dd03a1ab5af9a3a2532c"],"ref":"refs/changes/13/3913/5","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1527621250,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1525787693,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1527266228,"by":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1527620516,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"SUBM","value":"1","grantedOn":1527621313,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/intel/vmx.c","type":"MODIFIED","insertions":36,"deletions":-8}],"sizeInsertions":36,"sizeDeletions":-8},"patchSets":[{"number":"1","revision":"3b31c235e00a87053a802c6b9b9d906538af57ca","parents":["734000027845005c8c88895da60e3be5798296e2"],"ref":"refs/changes/13/3913/1","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1525471623,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1525787693,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/intel/vmx.c","type":"MODIFIED","insertions":36,"deletions":-8}],"sizeInsertions":36,"sizeDeletions":-8},{"number":"2","revision":"ee3f18655254b3fb9f4e5ef26656ac002932095d","parents":["2df613f7b7aa3978e80f8e63f228b7ed64ea5d5a"],"ref":"refs/changes/13/3913/2","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1526571150,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1527266228,"by":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1525787693,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"comments":[{"file":"usr/src/uts/i86pc/io/vmm/intel/vmx.c","line":2996,"reviewer":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"message":"If this is to be left as its own function, maybe worth a one-line comment here explaining why we\u0027re calling it?"},{"file":"usr/src/uts/i86pc/io/vmm/intel/vmx.c","line":3773,"reviewer":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"message":"Silly question: why have this as its own function if it\u0027s only called in one placed and has linear logic? Is it worth just dropping this inline into vmx_run()?"},{"file":"usr/src/uts/i86pc/io/vmm/intel/vmx.c","line":3773,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"I wanted it grouped with the rest of the PIR-related logic.  Unless there\u0027s strong objection, I\u0027d like to leave it in this state for now"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/intel/vmx.c","type":"MODIFIED","insertions":36,"deletions":-8}],"sizeInsertions":36,"sizeDeletions":-8},{"number":"3","revision":"35e6e8eafd5e6150059058815cb0cf8eb96457ea","parents":["66904fd497a76f6f9811bbdd9ae5bc32944c8045"],"ref":"refs/changes/13/3913/3","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1527280323,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1527266228,"by":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1525787693,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/intel/vmx.c","type":"MODIFIED","insertions":36,"deletions":-8}],"sizeInsertions":36,"sizeDeletions":-8},{"number":"4","revision":"570201b6e63d9e2b30b3acff55767f82227429cf","parents":["a342859e706a48afa2e2dd03a1ab5af9a3a2532c"],"ref":"refs/changes/13/3913/4","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1527619288,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1527620516,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1527266228,"by":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1525787693,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/intel/vmx.c","type":"MODIFIED","insertions":36,"deletions":-8}],"sizeInsertions":36,"sizeDeletions":-8},{"number":"5","revision":"21e2c666e809045ac5b02a65fa8b9c6708909804","parents":["a342859e706a48afa2e2dd03a1ab5af9a3a2532c"],"ref":"refs/changes/13/3913/5","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1527621250,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1527620516,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1527266228,"by":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"}},{"type":"SUBM","value":"1","grantedOn":1527621313,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1525787693,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/intel/vmx.c","type":"MODIFIED","insertions":36,"deletions":-8}],"sizeInsertions":36,"sizeDeletions":-8}],"allReviewers":[{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}]}