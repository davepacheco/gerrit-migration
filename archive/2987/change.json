{"project":"joyent/sdc-cloudapi","branch":"master","id":"I2e869ca7d0e4b03c2f7483b279aa02b22ad5b876","number":"2987","subject":"PUBAPI-1460 nightly1-080-test-cloudapi fails in volumes-automount.test.js Reviewed by: Josh Wilsdon \u003cjosh@wilsdon.ca\u003e Approved by: Josh Wilsdon \u003cjosh@wilsdon.ca\u003e","owner":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"url":"https://cr.joyent.us/2987","commitMessage":"PUBAPI-1460 nightly1-080-test-cloudapi fails in volumes-automount.test.js\nReviewed by: Josh Wilsdon \u003cjosh@wilsdon.ca\u003e\nApproved by: Josh Wilsdon \u003cjosh@wilsdon.ca\u003e\n","createdOn":1511405809,"lastUpdated":1511572681,"open":false,"status":"MERGED","comments":[{"timestamp":1511405809,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 1."},{"timestamp":1511405841,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing-1\n\n(1 comment)\n\n\"make check\" exited with status 2"},{"timestamp":1511405859,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 2."},{"timestamp":1511405890,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1511405916,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 3."},{"timestamp":1511405946,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1511406814,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 1:\n\nI think the joyent imgapi stuff belongs in tools/coal-setup.sh.\n\nAs far as I recall, none of the other tests reach out of coal. Is this something we should change?"},{"timestamp":1511409598,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 3: Code-Review+1\n\n\u003e I think the joyent imgapi stuff belongs in tools/coal-setup.sh.\n\nCould you explain why this is? The goal of this ticket was to fix an issue in nightly, not COAL so I\u0027m confused as to what COAL has to do with this. \n\n\n \u003e As far as I recall, none of the other tests reach out of coal. Is\n \u003e this something we should change?\n\nActually, a lot of our other tests have to reach out to image sources for this same reason. Docker tests have to talk to docker hub and the platform\u0027s /usr/vm and /usr/img tests also download images. The sdc-imgapi tests also talk to images.joyent.com afaik. VMAPI avoids this problem by not being a very complete test suite (it doesn\u0027t test any KVM or LX instances and only provisions additional VMAPI zones and a hardcoded uuid of a 1.6.3 image which it assumes will exist forever and works by accident, only because we\u0027ve not managed to update our images for so long).\n\nUntil we have a mechanism for creating images consistently locally without any base image (maybe tarball-based images?) any test that wants to actually provision using a real image, *should* ensure that image is downloaded first, since we otherwise have no guarantee that the image exists and the test is likely to eventually fail somewhere."},{"timestamp":1511416141,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 3:\n\nI was referring specifically to cloudapi\u0027s tests.\n\nI\u0027m not a fan of requiring internet connectivity to run out test suites, but it is what it is. Some things are unavoidable, but the rest really should be living in sdcadm post-setup dev-sample-data IMO (something I\u0027ve been meaning to move cloudapi over to for a while, but obviously there are bigger fish to fry).\n\nAs for what does COAL have to do with this: \"coal-setup.sh\"\u0027s name is historical; it sets up the environment for tests."},{"timestamp":1511486898,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 4."},{"timestamp":1511486929,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1511487004,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 4:\n\nTesting notes for the latest patch set of this CR, and the associated sdcadm CR:\n\nI deleted one of the images required for the volumes-automount test, then ran the test and verified that it errored as expected.\n\nThen I built an image of sdcadm with the required changes to post-setup dev-sample-data, installed that image and ran post-setup dev-sample-data.\n\nI then re-ran the volumes-automount test and verified that it passed."},{"timestamp":1511572391,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 4: Code-Review+1 Integration-Approval+1"},{"timestamp":1511572671,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 5: Commit message was updated."},{"timestamp":1511572681,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Julien Gilli"}],"currentPatchSet":{"number":"5","revision":"83e53b9bfaedc3392dcd3bc08c755e7dfb0c6442","parents":["aa9022d182766905959583c22617c5ac6179d239"],"ref":"refs/changes/87/2987/5","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1511572671,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1511486929,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1511572391,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1511572391,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"SUBM","value":"1","grantedOn":1511572681,"by":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"test/common.js","type":"MODIFIED","insertions":13,"deletions":0},{"file":"test/volumes-automount.test.js","type":"MODIFIED","insertions":109,"deletions":-66}],"sizeInsertions":122,"sizeDeletions":-66},"patchSets":[{"number":"1","revision":"0165240a5abe99333cb543c08e66c31c7af84a90","parents":["aa9022d182766905959583c22617c5ac6179d239"],"ref":"refs/changes/87/2987/1","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1511405809,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1511405841,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"test/volumes-automount.test.js","line":302,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"line \u003e 80 characters"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"test/common.js","type":"MODIFIED","insertions":13,"deletions":0},{"file":"test/volumes-automount.test.js","type":"MODIFIED","insertions":144,"deletions":-66}],"sizeInsertions":157,"sizeDeletions":-66},{"number":"2","revision":"00c45c9cb96a2cd9ce2b2345ff671135bd9d9c0b","parents":["aa9022d182766905959583c22617c5ac6179d239"],"ref":"refs/changes/87/2987/2","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1511405859,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1511405890,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"test/common.js","type":"MODIFIED","insertions":13,"deletions":0},{"file":"test/volumes-automount.test.js","type":"MODIFIED","insertions":144,"deletions":-66}],"sizeInsertions":157,"sizeDeletions":-66},{"number":"3","revision":"90dd53a2ec1e5d17d56ce5467df12b807e12a7a7","parents":["aa9022d182766905959583c22617c5ac6179d239"],"ref":"refs/changes/87/2987/3","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1511405916,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1511405946,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1511409598,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"test/common.js","type":"MODIFIED","insertions":13,"deletions":0},{"file":"test/volumes-automount.test.js","type":"MODIFIED","insertions":143,"deletions":-66}],"sizeInsertions":156,"sizeDeletions":-66},{"number":"4","revision":"2e869ca7d0e4b03c2f7483b279aa02b22ad5b876","parents":["aa9022d182766905959583c22617c5ac6179d239"],"ref":"refs/changes/87/2987/4","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1511486898,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1511486929,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1511572391,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1511572391,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"test/common.js","type":"MODIFIED","insertions":13,"deletions":0},{"file":"test/volumes-automount.test.js","type":"MODIFIED","insertions":109,"deletions":-66}],"sizeInsertions":122,"sizeDeletions":-66},{"number":"5","revision":"83e53b9bfaedc3392dcd3bc08c755e7dfb0c6442","parents":["aa9022d182766905959583c22617c5ac6179d239"],"ref":"refs/changes/87/2987/5","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1511572671,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1511486929,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1511572391,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1511572391,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"SUBM","value":"1","grantedOn":1511572681,"by":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"test/common.js","type":"MODIFIED","insertions":13,"deletions":0},{"file":"test/volumes-automount.test.js","type":"MODIFIED","insertions":109,"deletions":-66}],"sizeInsertions":122,"sizeDeletions":-66}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}]}