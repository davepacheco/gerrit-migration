{"project":"joyent/node-triton","branch":"master","id":"If48e96dcfbe8a5910c420d76b70ff1c8f6ccdc6e","number":"6155","subject":"TRITON-967 Add support for flexible disk, disks information and disks modifications to triton Reviewed by: Trent Mick \u003ctrentm@gmail.com\u003e Approved by: Trent Mick \u003ctrentm@gmail.com\u003e","owner":{"name":"Dylan Yep","email":"dyep49@gmail.com","username":"dyep49"},"url":"https://cr.joyent.us/6155","commitMessage":"TRITON-967 Add support for flexible disk, disks information and disks modifications to triton\nReviewed by: Trent Mick \u003ctrentm@gmail.com\u003e\nApproved by: Trent Mick \u003ctrentm@gmail.com\u003e\n","createdOn":1556101023,"lastUpdated":1558112733,"open":false,"status":"MERGED","comments":[{"timestamp":1556101023,"reviewer":{"name":"Dylan Yep","email":"dyep49@gmail.com","username":"dyep49"},"message":"Uploaded patch set 1."},{"timestamp":1556101023,"reviewer":{"name":"Dylan Yep","email":"dyep49@gmail.com","username":"dyep49"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit 28e306a02fc4abb52ceb1430f46e7428cb166aae\n    \n    working disk commands\n    \n    commit 9ebebb508b29c495b3405e7379ad2a8786a1b693\n    \n    some progress on adding disks"},{"timestamp":1556101061,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1556101215,"reviewer":{"name":"Dylan Yep","email":"dyep49@gmail.com","username":"dyep49"},"message":"Patch Set 1:\n\nTo run the tests, there must be a flexible disk package installed.\n\nI added the following to PAPI\n\n{\n  \"uuid\": \"b369a176-a4e4-41aa-93a3-c66936c7ff4a\",\n  \"brand\": \"bhyve\",\n  \"name\": \"flex_disks\",\n  \"flexible_disk\": true,\n  \"max_physical_memory\": 128,\n  \"quota\": 15360,\n  \"max_swap\": 256,\n  \"cpu_cap\": 150,\n  \"max_lwps\": 1000,\n  \"zfs_io_priority\": 10,\n  \"fss\": 25,\n  \"default\": false,\n  \"vcpus\": 1,\n  \"version\": \"1.0.0\",\n  \"active\": true,\n  \"disks\": [\n    {},\n    {\n      \"size\": 512\n    }\n  ]\n}"},{"timestamp":1556110348,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 1:\n\n(22 comments)\n\nAlso consider adding tests to cli-subcommands.test.js (trivial)."},{"timestamp":1556822772,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 2."},{"timestamp":1556822777,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit d2b1708789d1793f38aa2cab3b6e2ced07776334\n    \n    TRITON-967 Add support for flexible disk, disks information and disks modifications to triton"},{"timestamp":1556822803,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1556822917,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 2:\n\n(21 comments)\n\nI think I\u0027ve replied and added all the suggestions made by Marsell, plus some other fixes I found as I go. Would appreciate a pair of fresh eyes taking a look at this. Volunteers?"},{"timestamp":1556842962,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Patch Set 2:\n\n(19 comments)"},{"timestamp":1556897491,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 3."},{"timestamp":1556897496,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 3:\n\nNew commits:\n    \n    commit dd97038294e732cc39c13ba926952b44e6141136\n    \n    Applied Todd\u0027s suggestions"},{"timestamp":1556897524,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1557128116,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 3:\n\n(18 comments)\n\nDone with the suggested changes. May I get another pass? Testing results added to JIRA issue."},{"timestamp":1557244501,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1557273975,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 3:\n\n(32 comments)"},{"timestamp":1557349332,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 3:\n\nI\u0027ve not reviewed the code but did notice that README.md has not been updated.  I think that RFD 154 and/or TRITON-967 have text that is pretty much ready to paste in."},{"timestamp":1557487770,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 4."},{"timestamp":1557487774,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 4:\n\nNew commits:\n    \n    commit edc73e700f961bcfd434868d01307d631e8e95b9\n    \n    Applied Trent\u0027s suggestions"},{"timestamp":1557487803,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1557487848,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 4:\n\n(32 comments)\n\nTrent: Thanks for the CR. A lot of related changes made. Actually, all of them but the ones we already agreed regarding not adding bash completion due to disks being scoped by instance. Tests results added to the JIRA issue."},{"timestamp":1558048501,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 4:\n\n(2 comments)"},{"timestamp":1558108789,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 5."},{"timestamp":1558108794,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 5:\n\nNew commits:\n    \n    commit 7a14a8c7a557699ab0a7db6df0c6b81d29a1f705\n    \n    Went through Trent\u0027s 2nd pass comments"},{"timestamp":1558108824,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1558108829,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 5:\n\n(2 comments)\n\nThanks for taking a look Trent. Couple issues you mentioned fixed now too."},{"timestamp":1558110654,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 5: Code-Review+1 Integration-Approval+1\n\n(1 comment)"},{"timestamp":1558111607,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 6."},{"timestamp":1558111612,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 6:\n\nNew commits:\n    \n    commit 565017cca0bce314dfee48e6b977d5291e7458b6\n    \n    Updated code doc"},{"timestamp":1558111630,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 6:\n\n(1 comment)\n\nOf course! mind to re-stamp?"},{"timestamp":1558111640,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 6: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1558112371,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 6: Code-Review+1 Integration-Approval+1"},{"timestamp":1558112733,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Pedro Palazón Candel"}],"currentPatchSet":{"number":"6","revision":"f48e96dcfbe8a5910c420d76b70ff1c8f6ccdc6e","parents":["43a26927319f35b29e6c7246dbe93024e1d28452"],"ref":"refs/changes/55/6155/6","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1558111607,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1558111640,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1558112371,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1558112371,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1558112733,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":6,"deletions":0},{"file":"lib/cloudapi2.js","type":"MODIFIED","insertions":350,"deletions":-17},{"file":"lib/disks.js","type":"ADDED","insertions":99,"deletions":0},{"file":"lib/do_instance/do_create.js","type":"MODIFIED","insertions":61,"deletions":-12},{"file":"lib/do_instance/do_disk/do_add.js","type":"ADDED","insertions":150,"deletions":0},{"file":"lib/do_instance/do_disk/do_delete.js","type":"ADDED","insertions":126,"deletions":0},{"file":"lib/do_instance/do_disk/do_get.js","type":"ADDED","insertions":83,"deletions":0},{"file":"lib/do_instance/do_disk/do_list.js","type":"ADDED","insertions":109,"deletions":0},{"file":"lib/do_instance/do_disk/do_resize.js","type":"ADDED","insertions":162,"deletions":0},{"file":"lib/do_instance/do_disk/index.js","type":"ADDED","insertions":47,"deletions":0},{"file":"lib/do_instance/do_disks.js","type":"ADDED","insertions":32,"deletions":0},{"file":"lib/do_instance/index.js","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"lib/tritonapi.js","type":"MODIFIED","insertions":240,"deletions":-13},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/config.json.sample","type":"MODIFIED","insertions":4,"deletions":0},{"file":"test/integration/cli-disks.test.js","type":"ADDED","insertions":236,"deletions":0},{"file":"test/integration/cli-subcommands.test.js","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"test/integration/helpers.js","type":"MODIFIED","insertions":131,"deletions":-3}],"sizeInsertions":1847,"sizeDeletions":-49},"patchSets":[{"number":"1","revision":"d9e81530df21c5dd164c4524de9f147d62b7922e","parents":["43a26927319f35b29e6c7246dbe93024e1d28452"],"ref":"refs/changes/55/6155/1","uploader":{"name":"Dylan Yep","email":"dyep49@gmail.com","username":"dyep49"},"createdOn":1556101023,"author":{"name":"Dylan Yep","email":"dyep49@gmail.com","username":"dyep49"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1556101061,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"CHANGES.md","line":12,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Wouldn\u0027t this be above the node-triton#263 above?"},{"file":"CHANGES.md","line":12,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/cloudapi2.js","line":8,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Copyright 2019 Joyent, Inc."},{"file":"lib/cloudapi2.js","line":8,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/cloudapi2.js","line":3131,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"uuid?"},{"file":"lib/cloudapi2.js","line":3131,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/cloudapi2.js","line":3172,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Some of the arg comments in this patch have a comma here, and some don\u0027t."},{"file":"lib/cloudapi2.js","line":3172,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/cloudapi2.js","line":3180,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"uuid?"},{"file":"lib/cloudapi2.js","line":3180,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/cloudapi2.js","line":3209,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"uuid?"},{"file":"lib/cloudapi2.js","line":3209,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/cloudapi2.js","line":3232,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Not used?"},{"file":"lib/cloudapi2.js","line":3232,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/cloudapi2.js","line":3234,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Some funcs in this diff use \"size\", while others use \"diskSize\"."},{"file":"lib/cloudapi2.js","line":3234,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/cloudapi2.js","line":3239,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Is it worth adding an opts.waitTimeout? See the --wait-timeout flag used in some other commands -- it\u0027s a good idea.\n\nSame applies to the other waitFor* funcs in this diff."},{"file":"lib/cloudapi2.js","line":3239,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Not \"cb\"?"},{"file":"lib/cloudapi2.js","line":3239,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/cloudapi2.js","line":3239,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/cloudapi2.js","line":3253,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"oldDiskIds only needs to be calculated once. Can hoist this code out of this inner function."},{"file":"lib/cloudapi2.js","line":3253,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/cloudapi2.js","line":3259,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Will this work if diskSize is \"remaining\"?"},{"file":"lib/cloudapi2.js","line":3343,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"What about \"remaining\" in the comment above?"},{"file":"lib/cloudapi2.js","line":3343,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"\"remaining\" is not allowed for a resize, just for disk creation"},{"file":"lib/disks.js","line":30,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Since this is used several times, I\u0027d assign to its own var."},{"file":"lib/disks.js","line":30,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/do_instance/do_create.js","line":537,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"I think it\u0027d be clearer as \"in an instance with flexible disks\"."},{"file":"lib/do_instance/do_create.js","line":537,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/do_instance/do_disk/do_add.js","line":32,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"There\u0027s ambiguity here. The \u0027missing INST and/or DISKID arguments\u0027 approach in do_get.js files is more suitable?"},{"file":"lib/do_instance/do_disk/do_add.js","line":32,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done!"},{"file":"lib/do_instance/do_disk/do_delete.js","line":32,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"There\u0027s ambiguity here. The \u0027missing INST and/or DISKID arguments\u0027 approach in do_get.js files is more suitable?"},{"file":"lib/do_instance/do_disk/do_delete.js","line":32,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/do_instance/do_disk/do_resize.js","line":36,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Ambiguity."},{"file":"lib/do_instance/do_disk/do_resize.js","line":36,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/do_instance/do_disk/do_resize.js","line":113,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Elide"},{"file":"lib/do_instance/do_disk/do_resize.js","line":113,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/tritonapi.js","line":3915,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Elide"},{"file":"lib/tritonapi.js","line":3915,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/tritonapi.js","line":3966,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Not true? Multiple were found."},{"file":"lib/tritonapi.js","line":3966,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Multiple. True. Anyway it would be really strange to hit this."},{"file":"test/integration/cli-disks.test.js","line":8,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Elide"},{"file":"test/integration/cli-disks.test.js","line":8,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":5,"deletions":0},{"file":"lib/cloudapi2.js","type":"MODIFIED","insertions":273,"deletions":-1},{"file":"lib/disks.js","type":"ADDED","insertions":91,"deletions":0},{"file":"lib/do_instance/do_create.js","type":"MODIFIED","insertions":31,"deletions":0},{"file":"lib/do_instance/do_disk/do_add.js","type":"ADDED","insertions":150,"deletions":0},{"file":"lib/do_instance/do_disk/do_delete.js","type":"ADDED","insertions":137,"deletions":0},{"file":"lib/do_instance/do_disk/do_get.js","type":"ADDED","insertions":83,"deletions":0},{"file":"lib/do_instance/do_disk/do_list.js","type":"ADDED","insertions":108,"deletions":0},{"file":"lib/do_instance/do_disk/do_resize.js","type":"ADDED","insertions":166,"deletions":0},{"file":"lib/do_instance/do_disk/index.js","type":"ADDED","insertions":47,"deletions":0},{"file":"lib/do_instance/do_disks.js","type":"ADDED","insertions":32,"deletions":0},{"file":"lib/do_instance/index.js","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"lib/tritonapi.js","type":"MODIFIED","insertions":221,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/config.json.sample","type":"MODIFIED","insertions":4,"deletions":0},{"file":"test/integration/cli-disks.test.js","type":"ADDED","insertions":206,"deletions":0},{"file":"test/integration/helpers.js","type":"MODIFIED","insertions":129,"deletions":-1}],"sizeInsertions":1688,"sizeDeletions":-4},{"number":"2","revision":"af6eecdb7159286766058ce89668f15eabbe2936","parents":["43a26927319f35b29e6c7246dbe93024e1d28452"],"ref":"refs/changes/55/6155/2","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1556822772,"author":{"name":"Dylan Yep","email":"dyep49@gmail.com","username":"dyep49"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1556822803,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/cloudapi2.js","line":42,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Just delete these unused imports."},{"file":"lib/cloudapi2.js","line":42,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/cloudapi2.js","line":157,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Not sure why this change is here... but drop the argument if it isn\u0027t used."},{"file":"lib/cloudapi2.js","line":157,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Mostly b/c it makes linter complain every time I save the file. Removed!"},{"file":"lib/cloudapi2.js","line":1448,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Why these changes?"},{"file":"lib/cloudapi2.js","line":1448,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Linter complaining about unused args. If you check the function body, you\u0027ll see that none is used at all, but I assume LOMStream needs a given fetch signature. Using \"_\" before arg names makes ESLint to stop complaining about them."},{"file":"lib/cloudapi2.js","line":3154,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Checking - do we ever need to allow a size of zero?"},{"file":"lib/cloudapi2.js","line":3154,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Good call! After checking with Mike let\u0027s just say we don\u0027t :-). Enforced here."},{"file":"lib/do_instance/do_create.js","line":15,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"nuke it"},{"file":"lib/do_instance/do_create.js","line":15,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/do_instance/do_create.js","line":546,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"for"},{"file":"lib/do_instance/do_create.js","line":546,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/do_instance/do_create.js","line":547,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Should be close paren \u0027)\u0027, not close brace \u0027}\u0027."},{"file":"lib/do_instance/do_create.js","line":547,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/do_instance/do_disk/do_add.js","line":43,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"a"},{"file":"lib/do_instance/do_disk/do_add.js","line":145,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Not sure what a \"mebibyte\" is ;)"},{"file":"lib/do_instance/do_disk/do_add.js","line":145,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Have to admit I also searched the wikipedia for it: https://simple.wikipedia.org/wiki/Mebibyte"},{"file":"lib/do_instance/do_disk/do_delete.js","line":56,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"matchingDisk could be an empty array in the case of a bad disk Id, right?"},{"file":"lib/do_instance/do_disk/do_delete.js","line":56,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Indeed"},{"file":"lib/tritonapi.js","line":3929,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Doesn\u0027t look like `res` is returned via the callback."},{"file":"lib/tritonapi.js","line":3929,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/tritonapi.js","line":3973,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Not included in the callback."},{"file":"lib/tritonapi.js","line":3973,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"I would assume copy \u0026 paste goodies. Removed."},{"file":"lib/tritonapi.js","line":4010,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Not included in the callback."},{"file":"lib/tritonapi.js","line":4010,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/tritonapi.js","line":4062,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Not included in the callback."},{"file":"lib/tritonapi.js","line":4062,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"test/integration/cli-subcommands.test.js","line":20,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Delete."},{"file":"test/integration/cli-subcommands.test.js","line":20,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"test/integration/helpers.js","line":258,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Fullstop at end of sentence."},{"file":"test/integration/helpers.js","line":258,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"test/integration/helpers.js","line":262,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"remove extra whitespace"},{"file":"test/integration/helpers.js","line":262,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"test/integration/helpers.js","line":358,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"s/an/a"},{"file":"test/integration/helpers.js","line":358,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"test/integration/helpers.js","line":366,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Not sure what this means."},{"file":"test/integration/helpers.js","line":366,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"I assume testing disks stuff with non-flexible packages. Not sure why this comment is here. Removing it."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":5,"deletions":0},{"file":"lib/cloudapi2.js","type":"MODIFIED","insertions":347,"deletions":-17},{"file":"lib/disks.js","type":"ADDED","insertions":92,"deletions":0},{"file":"lib/do_instance/do_create.js","type":"MODIFIED","insertions":52,"deletions":-12},{"file":"lib/do_instance/do_disk/do_add.js","type":"ADDED","insertions":150,"deletions":0},{"file":"lib/do_instance/do_disk/do_delete.js","type":"ADDED","insertions":142,"deletions":0},{"file":"lib/do_instance/do_disk/do_get.js","type":"ADDED","insertions":83,"deletions":0},{"file":"lib/do_instance/do_disk/do_list.js","type":"ADDED","insertions":108,"deletions":0},{"file":"lib/do_instance/do_disk/do_resize.js","type":"ADDED","insertions":162,"deletions":0},{"file":"lib/do_instance/do_disk/index.js","type":"ADDED","insertions":47,"deletions":0},{"file":"lib/do_instance/do_disks.js","type":"ADDED","insertions":32,"deletions":0},{"file":"lib/do_instance/index.js","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"lib/tritonapi.js","type":"MODIFIED","insertions":231,"deletions":-13},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/config.json.sample","type":"MODIFIED","insertions":4,"deletions":0},{"file":"test/integration/cli-disks.test.js","type":"ADDED","insertions":246,"deletions":0},{"file":"test/integration/cli-subcommands.test.js","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"test/integration/helpers.js","type":"MODIFIED","insertions":129,"deletions":-1}],"sizeInsertions":1842,"sizeDeletions":-46},{"number":"3","revision":"7326369977ae4e45caa6a8e86c9bc9c682f0e205","parents":["43a26927319f35b29e6c7246dbe93024e1d28452"],"ref":"refs/changes/55/6155/3","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1556897491,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1556897524,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1557244501,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}}],"comments":[{"file":"CHANGES.md","line":12,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Drop this \"disk\"?\nPerhaps mention that these are all under `triton instance disk ...`.\nPerhaps a link to a doc on flexible disks? E.g. the RFD."},{"file":"CHANGES.md","line":12,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Ok, modified to try to make little bit more sense now :-)"},{"file":"lib/cloudapi2.js","line":3155,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Could perhaps be more strict here and/or in tritonapi.js addInstanceDisk."},{"file":"lib/cloudapi2.js","line":3155,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/cloudapi2.js","line":3189,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Typically the \"body\" arg isn\u0027t returned for \"delete*\" methods."},{"file":"lib/cloudapi2.js","line":3189,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/cloudapi2.js","line":3298,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Whoa. That\u0027s going to poll as fast as it can. That needs to be in a setTimeout(poll, interval)."},{"file":"lib/cloudapi2.js","line":3298,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Geez, good call. I don\u0027t even noticed if the first time I went through the code."},{"file":"lib/cloudapi2.js","line":3356,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"\"deletion\""},{"file":"lib/cloudapi2.js","line":3356,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/cloudapi2.js","line":3415,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"\"resize\""},{"file":"lib/cloudapi2.js","line":3415,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/disks.js","line":23,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"\"@FILE\"?"},{"file":"lib/disks.js","line":23,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"I think so, yeah"},{"file":"lib/disks.js","line":36,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Why is `opts._order` being used? The option type is `arrayOfString`, which means all the `--disks` args will already be in the `opts.disks` field as an array."},{"file":"lib/disks.js","line":36,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Honestly, I don\u0027t know. Removing, we should be good with the defaults."},{"file":"lib/disks.js","line":45,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Currently the do_create.js comment says \"DATA\" should start with `{`, not with `[`.\n\nSee my comment in do_instance/do_create.js suggesting that `--disk` be singular."},{"file":"lib/disks.js","line":45,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"I\u0027m Ok on making it be singular. Also, regarding the JSON object, I think that should begin with a \"[\" and be proper json, so we can avoid having to do something like: { disks: [{}, {}, ...]} and just for the case we\u0027re providing @FILE option. For common usage scenario of several disk arguments passed through --disk option we should be fine with strings of the type \u0027{\"size\": whatever}\u0027, as usual."},{"file":"lib/disks.js","line":58,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Shouldn\u0027t this validate what fields are in this JSON? That the JSON is an array of objects or whatever?"},{"file":"lib/disks.js","line":58,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"I think do_create.js is already croaking if this isn\u0027t a JSON array of objects, that should be fine IMO. Also, regarding the JSON contents, an attempt to create the machine with invalid disk payload would result into: \n\n        triton instance create: error: error creating instance\n            disks.2.size: MissingParameter"},{"file":"lib/do_instance/do_create.js","line":141,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"If there is only the single option that is needed for this parsing, it would be clearer to do `disks.disksFromArgs(opts.disks, ...)`. The only reason mat.metadataFromOpts does it the way it does is because there are multiple option names in play (--metadata, --metadata-file, --script)."},{"file":"lib/do_instance/do_create.js","line":141,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/do_instance/do_create.js","line":542,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"See the \u0027volume\u0027 and \u0027metadata\u0027 options above. Those are singular. It looks like from the mention of `first character is \"{\")` that the intention is that `--disks DATA` defines *one* disk. It would then be more natural to do `triton inst create --disk \u0027{... first disk ...}\u0027 --disk \u0027{... second disk ...}\u0027 ...`"},{"file":"lib/do_instance/do_create.js","line":542,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Agree"},{"file":"lib/do_instance/do_create.js","line":547,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"This comment should explain the expected format for this JSON."},{"file":"lib/do_instance/do_create.js","line":547,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/do_instance/do_disk/do_add.js","line":45,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"I\u0027d suggested this size value be better guarded in tritonapi.js and cloudapi2.js. If you are going to do that (I\u0027m certainly not going to block this change on that), it might be worthwhile adding a validateMachineDiskSize shared function to cloudapi2.js or disks.js or common.js or something."},{"file":"lib/do_instance/do_disk/do_add.js","line":45,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"CloudAPI is actually validating disks size for everything but createMachine. We could add that validation to the \"disks.js\" file, since it doesn\u0027t appear that other stuff is validated within \"createMachine\".\n\nRegarding adding a shared function, I don\u0027t think it\u0027s too handy due to the differences: createMachine supports exactly the same options than \"addDisk\", and \"resizeDisk\" does not support remaining. I wouldn\u0027t really care about the \"waitFor...\" functions since those just do an \"\u003d\u003d\u003d\" comparison with whatever the disk.size value is for the disk."},{"file":"lib/do_instance/do_disk/do_add.js","line":145,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"should mention \"remaining\" option?"},{"file":"lib/do_instance/do_disk/do_add.js","line":145,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/do_instance/do_disk/do_delete.js","line":44,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"There is more fetching of data from cloudapi than is necessary with how this and deleteInstanceDisk (which against calls getInstanceDisk) is implemented.\n\nI wonder if this whole `function getDisks` could be skipped.\nYou could have `TritonApi.prototype.deleteInstanceDisk` add `res.diskId` (as is done for `res.instId`) so you have the disk UUID to use for waitForDiskDelete."},{"file":"lib/do_instance/do_disk/do_delete.js","line":44,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Sounds good to me!"},{"file":"lib/do_instance/do_disk/do_delete.js","line":144,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Perhaps should have \u0027tritoninstancedisk\u0027 before the none... even if this commit isn\u0027t going to add that completion type."},{"file":"lib/do_instance/do_disk/do_delete.js","line":144,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/do_instance/do_disk/do_get.js","line":81,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Perhaps should have \u0027tritoninstancedisk\u0027 before the none... even if this commit isn\u0027t going to add that completion type."},{"file":"lib/do_instance/do_disk/do_get.js","line":81,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/do_instance/do_disk/do_list.js","line":65,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"YOu don\u0027t want to have the full \"id\" column when using `--long`?"},{"file":"lib/do_instance/do_disk/do_list.js","line":65,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"I _DO_ want! Good catch, I didn\u0027t notice this one during my CR"},{"file":"lib/do_instance/do_disk/do_resize.js","line":29,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"nit: Use \"DISK\" as was used below."},{"file":"lib/do_instance/do_disk/do_resize.js","line":29,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/do_instance/do_disk/do_resize.js","line":32,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"nit: Perhaps \"too many arguments\"."},{"file":"lib/do_instance/do_disk/do_resize.js","line":32,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/do_instance/do_disk/do_resize.js","line":45,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"\"remaining\" isn\u0027t allowed for resize?\n\nAh perhaps not, because wouldn\u0027t know if shrinking it then."},{"file":"lib/do_instance/do_disk/do_resize.js","line":45,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Correct, only for instance creation and disk creation"},{"file":"lib/do_instance/do_disk/do_resize.js","line":132,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"nit: I don\u0027t think we need to define \"truncate\" for the user."},{"file":"lib/do_instance/do_disk/do_resize.js","line":132,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/do_instance/do_disk/do_resize.js","line":153,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"is resize limited to bhyve instances?"},{"file":"lib/do_instance/do_disk/do_resize.js","line":153,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Yes, AFAIK"},{"file":"lib/do_instance/do_disk/do_resize.js","line":160,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Perhaps should have \u0027tritoninstancedisk\u0027 before the none... even if this commit isn\u0027t going to add that completion type."},{"file":"lib/do_instance/do_disk/do_resize.js","line":160,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/tritonapi.js","line":3972,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Doc that \"remaining\" is also allowed here?"},{"file":"lib/tritonapi.js","line":3972,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/tritonapi.js","line":3978,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Could perhaps be more strict here and/or in cloudapi2.js createMachineDisk."},{"file":"lib/tritonapi.js","line":3978,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/tritonapi.js","line":4000,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Per the block comment at the top about callback forms, this should be `cb(err, null, res)` or `cb(err, something, res)` if there is a useful \"something\" coming back from the cloudapi call."},{"file":"lib/tritonapi.js","line":4000,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/tritonapi.js","line":4042,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Maybe dropping this arg. See comment in cloudapi2.js."},{"file":"lib/tritonapi.js","line":4042,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/tritonapi.js","line":4105,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Per the block comment at the top about callback forms, this should be `cb(err, null, res)` or `cb(err, something, res)` if there is a useful \"something\" coming back from the cloudapi call."},{"file":"lib/tritonapi.js","line":4105,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"This one says nothing about \"in the middle\" argument, though."},{"file":"lib/tritonapi.js","line":4105,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"I meant the block comment at the top of the *file*: https://github.com/joyent/node-triton/blob/master/lib/tritonapi.js#L85-L107\n\nSome methods like `resizeInstance` and `renameInstance` already use `cb(err, null, res);`.   I think the \"guidelines\" here are a result of a mix of:\n(a) trying to have `res` always be the third argument; but\n(b) not breaking all the pre-existing \"delete*\" methods that already had `cb(err, res)`."},{"file":"lib/tritonapi.js","line":4105,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Gotcha! Done."},{"file":"test/integration/cli-disks.test.js","line":30,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Drop this block. Per TRITON-1409 changes and basically because using node-tap we don\u0027t need this separate messaging about skips."},{"file":"test/integration/cli-disks.test.js","line":30,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"test/integration/cli-disks.test.js","line":104,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"FWIW there is a `h.safeTriton` that handles doing an exit status check, a stderr check and descriptive assert comments that could shorten many of the `t.triton` usages in here. That \"descriptive assert comments\" can really help debugging as it prints the exact command run."},{"file":"test/integration/cli-disks.test.js","line":104,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Nice tip!"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":5,"deletions":0},{"file":"lib/cloudapi2.js","type":"MODIFIED","insertions":349,"deletions":-17},{"file":"lib/disks.js","type":"ADDED","insertions":92,"deletions":0},{"file":"lib/do_instance/do_create.js","type":"MODIFIED","insertions":51,"deletions":-12},{"file":"lib/do_instance/do_disk/do_add.js","type":"ADDED","insertions":150,"deletions":0},{"file":"lib/do_instance/do_disk/do_delete.js","type":"ADDED","insertions":146,"deletions":0},{"file":"lib/do_instance/do_disk/do_get.js","type":"ADDED","insertions":83,"deletions":0},{"file":"lib/do_instance/do_disk/do_list.js","type":"ADDED","insertions":108,"deletions":0},{"file":"lib/do_instance/do_disk/do_resize.js","type":"ADDED","insertions":162,"deletions":0},{"file":"lib/do_instance/do_disk/index.js","type":"ADDED","insertions":47,"deletions":0},{"file":"lib/do_instance/do_disks.js","type":"ADDED","insertions":32,"deletions":0},{"file":"lib/do_instance/index.js","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"lib/tritonapi.js","type":"MODIFIED","insertions":231,"deletions":-13},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/config.json.sample","type":"MODIFIED","insertions":4,"deletions":0},{"file":"test/integration/cli-disks.test.js","type":"ADDED","insertions":246,"deletions":0},{"file":"test/integration/cli-subcommands.test.js","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"test/integration/helpers.js","type":"MODIFIED","insertions":131,"deletions":-3}],"sizeInsertions":1848,"sizeDeletions":-49},{"number":"4","revision":"725be8aea977ce531be2f7355b0c1e8b51aee5e9","parents":["43a26927319f35b29e6c7246dbe93024e1d28452"],"ref":"refs/changes/55/6155/4","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1557487770,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1557487803,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"test/integration/helpers.js","line":535,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Debugging print that should be removed?"},{"file":"test/integration/helpers.js","line":535,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"I\u0027d say so, yeah"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":6,"deletions":0},{"file":"lib/cloudapi2.js","type":"MODIFIED","insertions":350,"deletions":-17},{"file":"lib/disks.js","type":"ADDED","insertions":99,"deletions":0},{"file":"lib/do_instance/do_create.js","type":"MODIFIED","insertions":61,"deletions":-12},{"file":"lib/do_instance/do_disk/do_add.js","type":"ADDED","insertions":150,"deletions":0},{"file":"lib/do_instance/do_disk/do_delete.js","type":"ADDED","insertions":126,"deletions":0},{"file":"lib/do_instance/do_disk/do_get.js","type":"ADDED","insertions":83,"deletions":0},{"file":"lib/do_instance/do_disk/do_list.js","type":"ADDED","insertions":109,"deletions":0},{"file":"lib/do_instance/do_disk/do_resize.js","type":"ADDED","insertions":162,"deletions":0},{"file":"lib/do_instance/do_disk/index.js","type":"ADDED","insertions":47,"deletions":0},{"file":"lib/do_instance/do_disks.js","type":"ADDED","insertions":32,"deletions":0},{"file":"lib/do_instance/index.js","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"lib/tritonapi.js","type":"MODIFIED","insertions":240,"deletions":-13},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/config.json.sample","type":"MODIFIED","insertions":4,"deletions":0},{"file":"test/integration/cli-disks.test.js","type":"ADDED","insertions":236,"deletions":0},{"file":"test/integration/cli-subcommands.test.js","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"test/integration/helpers.js","type":"MODIFIED","insertions":132,"deletions":-3}],"sizeInsertions":1848,"sizeDeletions":-49},{"number":"5","revision":"989b9c29d7b170113b35e7fd8a6f5c5dc63328f5","parents":["43a26927319f35b29e6c7246dbe93024e1d28452"],"ref":"refs/changes/55/6155/5","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1558108789,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1558108824,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1558110654,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1558110654,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"comments":[{"file":"lib/tritonapi.js","line":4070,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"nit: now this needs an update ;)"},{"file":"lib/tritonapi.js","line":4070,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":6,"deletions":0},{"file":"lib/cloudapi2.js","type":"MODIFIED","insertions":350,"deletions":-17},{"file":"lib/disks.js","type":"ADDED","insertions":99,"deletions":0},{"file":"lib/do_instance/do_create.js","type":"MODIFIED","insertions":61,"deletions":-12},{"file":"lib/do_instance/do_disk/do_add.js","type":"ADDED","insertions":150,"deletions":0},{"file":"lib/do_instance/do_disk/do_delete.js","type":"ADDED","insertions":126,"deletions":0},{"file":"lib/do_instance/do_disk/do_get.js","type":"ADDED","insertions":83,"deletions":0},{"file":"lib/do_instance/do_disk/do_list.js","type":"ADDED","insertions":109,"deletions":0},{"file":"lib/do_instance/do_disk/do_resize.js","type":"ADDED","insertions":162,"deletions":0},{"file":"lib/do_instance/do_disk/index.js","type":"ADDED","insertions":47,"deletions":0},{"file":"lib/do_instance/do_disks.js","type":"ADDED","insertions":32,"deletions":0},{"file":"lib/do_instance/index.js","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"lib/tritonapi.js","type":"MODIFIED","insertions":240,"deletions":-13},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/config.json.sample","type":"MODIFIED","insertions":4,"deletions":0},{"file":"test/integration/cli-disks.test.js","type":"ADDED","insertions":236,"deletions":0},{"file":"test/integration/cli-subcommands.test.js","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"test/integration/helpers.js","type":"MODIFIED","insertions":131,"deletions":-3}],"sizeInsertions":1847,"sizeDeletions":-49},{"number":"6","revision":"f48e96dcfbe8a5910c420d76b70ff1c8f6ccdc6e","parents":["43a26927319f35b29e6c7246dbe93024e1d28452"],"ref":"refs/changes/55/6155/6","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1558111607,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1558111640,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1558112371,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1558112371,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1558112733,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":6,"deletions":0},{"file":"lib/cloudapi2.js","type":"MODIFIED","insertions":350,"deletions":-17},{"file":"lib/disks.js","type":"ADDED","insertions":99,"deletions":0},{"file":"lib/do_instance/do_create.js","type":"MODIFIED","insertions":61,"deletions":-12},{"file":"lib/do_instance/do_disk/do_add.js","type":"ADDED","insertions":150,"deletions":0},{"file":"lib/do_instance/do_disk/do_delete.js","type":"ADDED","insertions":126,"deletions":0},{"file":"lib/do_instance/do_disk/do_get.js","type":"ADDED","insertions":83,"deletions":0},{"file":"lib/do_instance/do_disk/do_list.js","type":"ADDED","insertions":109,"deletions":0},{"file":"lib/do_instance/do_disk/do_resize.js","type":"ADDED","insertions":162,"deletions":0},{"file":"lib/do_instance/do_disk/index.js","type":"ADDED","insertions":47,"deletions":0},{"file":"lib/do_instance/do_disks.js","type":"ADDED","insertions":32,"deletions":0},{"file":"lib/do_instance/index.js","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"lib/tritonapi.js","type":"MODIFIED","insertions":240,"deletions":-13},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/config.json.sample","type":"MODIFIED","insertions":4,"deletions":0},{"file":"test/integration/cli-disks.test.js","type":"ADDED","insertions":236,"deletions":0},{"file":"test/integration/cli-subcommands.test.js","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"test/integration/helpers.js","type":"MODIFIED","insertions":131,"deletions":-3}],"sizeInsertions":1847,"sizeDeletions":-49}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},{"name":"Dylan Yep","email":"dyep49@gmail.com","username":"dyep49"},{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}]}