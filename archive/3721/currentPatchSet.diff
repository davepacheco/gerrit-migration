From abf3fa4b0b3b4201ef27c7c608f2fd86e4193b57 Mon Sep 17 00:00:00 2001
From: Josh Wilsdon <josh@wilsdon.ca>
Date: Sat, 24 Mar 2018 12:42:46 -0700
Subject: [PATCH] OS-6825 should preserve zhyve.log when archiving log files
 from deleted bhyve VMs Reviewed by: Todd Whiteman <todd.whiteman@joyent.com>
 Approved by: Todd Whiteman <todd.whiteman@joyent.com>

---
 src/vm/node_modules/VM.js | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/src/vm/node_modules/VM.js b/src/vm/node_modules/VM.js
index f6679e14..09a53ef3 100644
--- a/src/vm/node_modules/VM.js
+++ b/src/vm/node_modules/VM.js
@@ -6517,6 +6517,11 @@ function archiveVM(uuid, options, callback)
                     targ: path.join(archive_dirname, 'startvm')
                 });
             } else if (vmobj.brand === 'bhyve') {
+                patterns_to_archive.push({
+                    src: path.join(vmobj.zonepath, 'root/tmp/zhyve.log'),
+                    dst: path.join(archive_dirname, 'vmlogs'),
+                    create_dst_dir: true
+                });
                 patterns_to_archive.push({
                     src: path.join(vmobj.zonepath, 'root/var/run/*.log*'),
                     dst: path.join(archive_dirname, 'vmlogs'),
-- 
2.21.0

