{"project":"joyent/manta-remora","branch":"master","id":"Ieb3e362d83b76a4d64b2065b2816e6533b0ec581","number":"6751","subject":"MANTA-4456 rebalancer jobs need some tests MANTA-4458 add ability for rebalancer zone jobs to store assignments in local sqlite database MANTA-4469 add thread to rebalancer zone to handle posting assignments to agent MANTA-4471 add ProcessAssignment trait","owner":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"url":"https://cr.joyent.us/6751","commitMessage":"MANTA-4456 rebalancer jobs need some tests\nMANTA-4458 add ability for rebalancer zone jobs to store assignments in local sqlite database\nMANTA-4469 add thread to rebalancer zone to handle posting assignments to agent\nMANTA-4471 add ProcessAssignment trait to handle processing completed assignment from agent\nMANTA-4480 pin rebalancer to correct rust-moray rust-sharkspotter and rust-libmanta version\nMANTA-4479 unpin rebalancer from diesel workaround\nReviewed by: Michael Zeller \u003cmike.zeller@joyent.com\u003e\nReviewed by: Robert Bogart \u003cRobert.bogart@joyent.com\u003e\nApproved by: Robert Bogart \u003cRobert.bogart@joyent.com\u003e\n","createdOn":1565025950,"lastUpdated":1566243140,"open":false,"status":"MERGED","comments":[{"timestamp":1565025950,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 1."},{"timestamp":1565026223,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 2."},{"timestamp":1565026514,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 3."},{"timestamp":1565032133,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 4: Commit message was updated."},{"timestamp":1565032431,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 5: Commit message was updated."},{"timestamp":1565045538,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Patch Set 5:\n\n(10 comments)\n\nI\u0027d categorize my feedback so far as pedestrian; there\u0027s is still a lot for me to wade through.  While I have a long ways to go, I did want to give you some feedback sooner rather than later.  One big question that I have: the threading model isn\u0027t completely clear to me yet -- is there a maximum number of threads that the zone will ever have running at any point?\n\nOne general observation is that some of these functions seem really long, in the order of \u003e 100 lines.  My preference is to break those up in to smaller functions named after whatever it is that they do.  As it is, it can be hard to follow.  While it\u0027s technically not wrong, I think there is a cost associated with that."},{"timestamp":1565108273,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Patch Set 5:\n\n(9 comments)\n\n\u003e One big question that I have: the threading model isn\u0027t completely clear to me yet -- is there a maximum number of threads that the zone will ever have running at any point?\n\nI think the question of how we are going to tune the zone is still open.  Until then each thread is a singleton.  I am sure that we will eventually decide to create a pool for each \"step\" with a configurable number of threads for each step, but we probably need to discuss what makes the most sense there, and how we plan to adjust that thread count on the fly.\n\nAgain, trying to keep this down to the barebones that we can later expand upon."},{"timestamp":1565110480,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Patch Set 5:\n\n\u003e (9 comments)\n \u003e \n \u003e \u003e One big question that I have: the threading model isn\u0027t\n \u003e completely clear to me yet -- is there a maximum number of threads\n \u003e that the zone will ever have running at any point?\n \u003e \n \u003e I think the question of how we are going to tune the zone is still\n \u003e open.  Until then each thread is a singleton.  I am sure that we\n \u003e will eventually decide to create a pool for each \"step\" with a\n \u003e configurable number of threads for each step, but we probably need\n \u003e to discuss what makes the most sense there, and how we plan to\n \u003e adjust that thread count on the fly.\n \u003e \n \u003e Again, trying to keep this down to the barebones that we can later\n \u003e expand upon.\n\nI see the threading model as a pretty foundational characteristic of this service (or any service really).  Be advised, the further on down the road we commit to one, the more difficult and invasive it may be to change it to what we want.  In my opinion, it\u0027s actually one of the most important decisions about this project."},{"timestamp":1565111094,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 6."},{"timestamp":1565113802,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Patch Set 6:\n\n(1 comment)"},{"timestamp":1565188470,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Patch Set 6:\n\n(3 comments)"},{"timestamp":1565195296,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 7."},{"timestamp":1565195328,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Patch Set 7:\n\n(4 comments)"},{"timestamp":1565203858,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 8."},{"timestamp":1565279255,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 9."},{"timestamp":1565279321,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Patch Set 9:\n\nI added two more CRs to this wad, but they each represent a one line change.  Just managing the dependency versions so we don\u0027t have any other build issues as we work through this review."},{"timestamp":1565280219,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Patch Set 8:\n\n(14 comments)"},{"timestamp":1565283034,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 10."},{"timestamp":1565283058,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Patch Set 10:\n\n(9 comments)"},{"timestamp":1565290546,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Patch Set 6:\n\n(1 comment)"},{"timestamp":1565307956,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Patch Set 9:\n\n(3 comments)\n\nThis isn\u0027t much, but I\u0027m still working on it.  I did have a general question about the crossbeam channel bounding.  If we set it to 1 instead of 5 (or whatever it is) could it help prevent some of the cases where the assignment generator is responsible for hanging on to them (I think you mentioned \"skip\")?  I am not sure, but I don\u0027t think it would have a significant impact on performance would it?  There will come a point when that buffer is full regardless and then you can only insert in to the channel as quickly as the assignment generator can receive."},{"timestamp":1565366277,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 11."},{"timestamp":1565366350,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Patch Set 9:\n\n(3 comments)"},{"timestamp":1565366430,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Patch Set 9:\n\n\u003e This isn\u0027t much, but I\u0027m still working on it.  I did have a general question about the crossbeam channel bounding.  If we set it to 1 instead of 5 (or whatever it is) could it help prevent some of the cases where the assignment generator is responsible for hanging on to them (I think you mentioned \"skip\")?  I am not sure, but I don\u0027t think it would have a significant impact on performance would it?  There will come a point when that buffer is full regardless and then you can only insert in to the channel as quickly as the assignment generator can receive.\n\nI don\u0027t think that would help, but it is certainly an issue, and I\u0027ve filed MANTA-4091 for it."},{"timestamp":1565377674,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Patch Set 11:\n\n\u003e I don\u0027t think that would help, but it is certainly an issue, and\n \u003e I\u0027ve filed MANTA-4091 for it.\n\nMANTA-4091 sounds like a different bug to me.  Did you mean something else?  I guess I\u0027m not really sure what the value add is of having buffering of 5 there.  Eventually, it won\u0027t make a difference.  At any rate, my main focus wasn\u0027t on performance anyway, but on attempting to avoid corner cases for objects that are in between threads."},{"timestamp":1565378945,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Patch Set 11:\n\nSorry MANTA-4491.\n\nThe reason we have a buffer is in the (unlikely) event that the assignment generator is faster than the sharkspotter thread that it wont be held up waiting for the sharkspotter to give it the next object.\n\nIMO this is very unlikely and it is probably worth while experimenting with buffer sizes from 1-5 to see what makes sense.\n\nAlso, if/when we have multiple (n) assignment generator threads  we will still want a single channel and that buffer size will probably want to be \u003e\u003d n.\n\nZeller may have some advice here as well."},{"timestamp":1565380594,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Patch Set 11:\n\n\u003e Sorry MANTA-4491.\nCool thanks.\n \u003e \n \u003e The reason we have a buffer is in the (unlikely) event that the\n \u003e assignment generator is faster than the sharkspotter thread that it\n \u003e wont be held up waiting for the sharkspotter to give it the next\n \u003e object.\n \u003e \n \u003e IMO this is very unlikely and it is probably worth while\n \u003e experimenting with buffer sizes from 1-5 to see what makes sense.\n\nIt\u0027d be interesting to see what the performance difference actually ends up being between a buffered approach and a non-buffered.  At any rate, I agree that it\u0027s something that can be toyed with later.  Even if it\u0027s slightly less performant, if corner cases can be eliminated, I\u0027d be in favor of it when the times comes to consider our options.  For what it\u0027s worth, I only brought this whole thing up as a point of eventual discussion.  Not seeking resolution for it in this CR.\n\n\n \u003e \n \u003e Also, if/when we have multiple (n) assignment generator threads  we\n \u003e will still want a single channel and that buffer size will probably\n \u003e want to be \u003e\u003d n.\n \u003e \n \u003e Zeller may have some advice here as well."},{"timestamp":1565386467,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Patch Set 9:\n\n(15 comments)"},{"timestamp":1565646680,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 12."},{"timestamp":1565646687,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Patch Set 11:\n\n(14 comments)"},{"timestamp":1565898069,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 13."},{"timestamp":1565903455,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Patch Set 13:\n\n(6 comments)"},{"timestamp":1565970141,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 14."},{"timestamp":1565970205,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 15: Commit message was updated."},{"timestamp":1565970242,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Patch Set 15:\n\n(5 comments)"},{"timestamp":1566238105,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Patch Set 15: Code-Review+1"},{"timestamp":1566240086,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Patch Set 15: Code-Review+1 Integration-Approval+1"},{"timestamp":1566242117,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 16: Commit message was updated."},{"timestamp":1566242447,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 17."},{"timestamp":1566242687,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Patch Set 17: Code-Review+1"},{"timestamp":1566242883,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Patch Set 17: Code-Review+1 Integration-Approval+1"},{"timestamp":1566243104,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 18: Commit message was updated."},{"timestamp":1566243140,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Rui"}],"currentPatchSet":{"number":"18","revision":"eb3e362d83b76a4d64b2065b2816e6533b0ec581","parents":["f336205f37ef90f28adf143eab3b769a337929b3"],"ref":"refs/changes/51/6751/18","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1566243104,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1566242687,"by":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1566242883,"by":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1566242883,"by":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"}},{"type":"SUBM","value":"1","grantedOn":1566243140,"by":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":15,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"Cargo.toml","type":"MODIFIED","insertions":24,"deletions":-3},{"file":"Makefile","type":"MODIFIED","insertions":14,"deletions":-1},{"file":"README.md","type":"MODIFIED","insertions":14,"deletions":0},{"file":"src/agent.rs","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"src/config.json","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"src/config.json.in","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"src/config.rs","type":"MODIFIED","insertions":24,"deletions":-6},{"file":"src/error.rs","type":"MODIFIED","insertions":45,"deletions":-7},{"file":"src/job.rs","type":"DELETED","insertions":0,"deletions":-761},{"file":"src/jobs/evacuate.rs","type":"ADDED","insertions":1293,"deletions":0},{"file":"src/jobs/mod.rs","type":"ADDED","insertions":168,"deletions":0},{"file":"src/lib.rs","type":"MODIFIED","insertions":21,"deletions":-4},{"file":"src/main.rs","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"src/picker.rs","type":"MODIFIED","insertions":48,"deletions":-35},{"file":"src/util.rs","type":"MODIFIED","insertions":23,"deletions":-1}],"sizeInsertions":1695,"sizeDeletions":-828},"patchSets":[{"number":"1","revision":"d6cdd84ab50c6f1b444169ed89134aaa05e15902","parents":["199bb7cbf4b88196cd6dd63f7da4f11fbba40735"],"ref":"refs/changes/51/6751/1","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1565025950,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Cargo.toml","type":"MODIFIED","insertions":31,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":14,"deletions":-1},{"file":"README.md","type":"MODIFIED","insertions":14,"deletions":0},{"file":"src/agent.rs","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"src/config.json","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"src/config.json.in","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"src/config.rs","type":"MODIFIED","insertions":11,"deletions":-5},{"file":"src/error.rs","type":"MODIFIED","insertions":19,"deletions":-6},{"file":"src/jobs/evacuate.rs","type":"ADDED","insertions":1281,"deletions":0},{"file":"src/jobs/mod.rs","type":"ADDED","insertions":160,"deletions":0},{"file":"src/lib.rs","type":"MODIFIED","insertions":12,"deletions":-3},{"file":"src/picker.rs","type":"MODIFIED","insertions":39,"deletions":-34},{"file":"src/util.rs","type":"MODIFIED","insertions":14,"deletions":0}],"sizeInsertions":1604,"sizeDeletions":-56},{"number":"2","revision":"e5f0ffed5544c68693d6c33a38f4b6cca8bf14f1","parents":["199bb7cbf4b88196cd6dd63f7da4f11fbba40735"],"ref":"refs/changes/51/6751/2","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1565026223,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"Cargo.toml","type":"MODIFIED","insertions":31,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":14,"deletions":-1},{"file":"README.md","type":"MODIFIED","insertions":14,"deletions":0},{"file":"src/agent.rs","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"src/config.json","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"src/config.json.in","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"src/config.rs","type":"MODIFIED","insertions":11,"deletions":-5},{"file":"src/error.rs","type":"MODIFIED","insertions":19,"deletions":-6},{"file":"src/jobs/evacuate.rs","type":"ADDED","insertions":1281,"deletions":0},{"file":"src/jobs/mod.rs","type":"ADDED","insertions":160,"deletions":0},{"file":"src/lib.rs","type":"MODIFIED","insertions":12,"deletions":-3},{"file":"src/picker.rs","type":"MODIFIED","insertions":39,"deletions":-34},{"file":"src/util.rs","type":"MODIFIED","insertions":14,"deletions":0}],"sizeInsertions":1606,"sizeDeletions":-57},{"number":"3","revision":"9f8e1d370d16b078fc3b1480bf5ab1969625fbea","parents":["199bb7cbf4b88196cd6dd63f7da4f11fbba40735"],"ref":"refs/changes/51/6751/3","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1565026514,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"Cargo.toml","type":"MODIFIED","insertions":31,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":14,"deletions":-1},{"file":"README.md","type":"MODIFIED","insertions":14,"deletions":0},{"file":"src/agent.rs","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"src/config.json","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"src/config.json.in","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"src/config.rs","type":"MODIFIED","insertions":11,"deletions":-5},{"file":"src/error.rs","type":"MODIFIED","insertions":19,"deletions":-6},{"file":"src/job.rs","type":"DELETED","insertions":0,"deletions":-761},{"file":"src/jobs/evacuate.rs","type":"ADDED","insertions":1281,"deletions":0},{"file":"src/jobs/mod.rs","type":"ADDED","insertions":160,"deletions":0},{"file":"src/lib.rs","type":"MODIFIED","insertions":12,"deletions":-3},{"file":"src/picker.rs","type":"MODIFIED","insertions":39,"deletions":-34},{"file":"src/util.rs","type":"MODIFIED","insertions":14,"deletions":0}],"sizeInsertions":1606,"sizeDeletions":-818},{"number":"4","revision":"72596c8abc7862af2ae47a6da3fcc2b4d3a10158","parents":["199bb7cbf4b88196cd6dd63f7da4f11fbba40735"],"ref":"refs/changes/51/6751/4","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1565032133,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"NO_CODE_CHANGE","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"Cargo.toml","type":"MODIFIED","insertions":31,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":14,"deletions":-1},{"file":"README.md","type":"MODIFIED","insertions":14,"deletions":0},{"file":"src/agent.rs","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"src/config.json","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"src/config.json.in","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"src/config.rs","type":"MODIFIED","insertions":11,"deletions":-5},{"file":"src/error.rs","type":"MODIFIED","insertions":19,"deletions":-6},{"file":"src/job.rs","type":"DELETED","insertions":0,"deletions":-761},{"file":"src/jobs/evacuate.rs","type":"ADDED","insertions":1281,"deletions":0},{"file":"src/jobs/mod.rs","type":"ADDED","insertions":160,"deletions":0},{"file":"src/lib.rs","type":"MODIFIED","insertions":12,"deletions":-3},{"file":"src/picker.rs","type":"MODIFIED","insertions":39,"deletions":-34},{"file":"src/util.rs","type":"MODIFIED","insertions":14,"deletions":0}],"sizeInsertions":1606,"sizeDeletions":-818},{"number":"5","revision":"c44b7a64e6b6526ffe12ad678fc4716341e3100b","parents":["199bb7cbf4b88196cd6dd63f7da4f11fbba40735"],"ref":"refs/changes/51/6751/5","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1565032431,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"NO_CODE_CHANGE","comments":[{"file":"src/error.rs","line":1,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Reference to the MPL."},{"file":"src/error.rs","line":1,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"},{"file":"src/jobs/evacuate.rs","line":1,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"We should include a reference to the MPL as well: https://www.mozilla.org/en-US/MPL/2.0/FAQ/#header-locations"},{"file":"src/jobs/evacuate.rs","line":1,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"},{"file":"src/jobs/evacuate.rs","line":62,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Even if you don\u0027t know what the \"reasons\" for skipping might be yet, I\u0027d advise adding `String\u0027 field to this enum now rather than waiting."},{"file":"src/jobs/evacuate.rs","line":62,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Not sure if this should be a string or something else at this point.  Either way I\u0027ve opened MANTA-4473 to cover this."},{"file":"src/jobs/evacuate.rs","line":76,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"It\u0027d be nice to have a comment here detailing what this structure is all about.  As I understand it, it\u0027s sort of the heart and soul of the rebalancer."},{"file":"src/jobs/evacuate.rs","line":76,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"},{"file":"src/jobs/evacuate.rs","line":97,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Not really sure how I feel about the name of this function or the fact that it even exits.  It\u0027s essentially a partial serialization of a given object, where the rest of it remains intact.  I am guessing that you\u0027re serializing this particular member because it has multiple parts, none of which you\u0027ll ever care about changing.  Does diesel provide no way of treating a given member of the struct in a special way?  Seems a shame that you have to create an entirely new data type.\n\nIs the answer is, no there is no way to do this without creating a new data type, I\u0027d at least explain to the reader why that is."},{"file":"src/jobs/evacuate.rs","line":97,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"This is quite close to the example provided in the diesel repo.  One main difference is that he is converting JSON strings into the insertable struct instead of struct A into insertable_A.  I THINK this can be done with the ToSql trait, which might be more idiomatic, but that would require it to be implemented in rust-libmanta.  This would essentially be providing diesel support to Manta objects in rust-libmanta.  I started down this path, but it quickly ballooned.  Considering the current size of this changeset I\u0027d rather not grow it much more, nevermind placing a dependency on another changeset in another repo.\n\nNow that I think about it though, this function should probably be a method of EvacuateObject, and EvacuateObjectDb should probably be renamed to EvacuateObjectInsertable.\n\n  impl EvacuateObject {\n    fn to_insertable(\u0026self) -\u003e EvacuateObjectInsertable {\n      // serialize the object field\n    }\n  }\n\nhttps://github.com/diesel-rs/diesel/blob/v1.3.0/examples/postgres/all_about_inserts/src/lib.rs#L30-L44\n\nI filed MANTA-4474 to track this."},{"file":"src/jobs/evacuate.rs","line":106,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"I\u0027d add the proverbial `default()` method to the enum definition and use that instead."},{"file":"src/jobs/evacuate.rs","line":106,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"},{"file":"src/jobs/evacuate.rs","line":172,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"The guts of this entire thing need way more commentary."},{"file":"src/jobs/evacuate.rs","line":172,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Added some comments.  It is a lot of lines, but it is basically creating the DB table and starting the threads.  Comments are the top of each thread start function have details on what they do."},{"file":"src/jobs/evacuate.rs","line":384,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"While I\u0027m not sure how long we may spend waiting on acquisition of the lock associated with `buffered_objs\u0027, it seems to me that a more fair measure of how long we\u0027re spending inside of diesel code (i.e. interacting with the database) would be to fence the time-related calls as tightly around the call to diesel::insert_into() as possible so that it doesn\u0027t take unnecessary heat for being more latent than it really is."},{"file":"src/jobs/evacuate.rs","line":384,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"You\u0027re absolutely right, and while I was trying to figure out the best way to increase performance here I moved this line around a bit as you suggest.\n\nI was tempted to drop this until we had a more holistic approach to gathering stats.  I looked for a way to bracket it using conditional compilation macros, but apparently \"the right way\" to do that is with build scripts, and again that would grow the size of the commit.\n\nAt this point, now that I have flamegraphs working for unit tests I should drop it all together until we have a good way of gathering stats.  Thoughts?\n\nMANTA-4475"},{"file":"src/jobs/evacuate.rs","line":636,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"What are we doing with the information returned?  Or rather, what *are* we going to do with it?"},{"file":"src/jobs/evacuate.rs","line":636,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Originally I intended it to be a number of available sharks, and if it was 0 to sleep for some configurable interval before checking to see if the sharks were available again.\n\nI am not 100% clear on the best approach here so maybe this is something we could discuss at a higher level.\n\nEssentially we need a way to\na) maintain a list of available destination sharks\nb) keep them updated with their respective available_mb\nc) only allow X assignments to be active on a given shark at a given time (where X is currently 1 but probably configurable in the future)\n\nSee the comments around this function definition for other thoughts I had."},{"file":"src/lib.rs","line":15,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"I\u0027m sure that there is a reason it\u0027s commented out, but how come?"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"Cargo.toml","type":"MODIFIED","insertions":31,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":14,"deletions":-1},{"file":"README.md","type":"MODIFIED","insertions":14,"deletions":0},{"file":"src/agent.rs","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"src/config.json","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"src/config.json.in","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"src/config.rs","type":"MODIFIED","insertions":11,"deletions":-5},{"file":"src/error.rs","type":"MODIFIED","insertions":19,"deletions":-6},{"file":"src/job.rs","type":"DELETED","insertions":0,"deletions":-761},{"file":"src/jobs/evacuate.rs","type":"ADDED","insertions":1281,"deletions":0},{"file":"src/jobs/mod.rs","type":"ADDED","insertions":160,"deletions":0},{"file":"src/lib.rs","type":"MODIFIED","insertions":12,"deletions":-3},{"file":"src/picker.rs","type":"MODIFIED","insertions":39,"deletions":-34},{"file":"src/util.rs","type":"MODIFIED","insertions":14,"deletions":0}],"sizeInsertions":1606,"sizeDeletions":-818},{"number":"6","revision":"e81a5129e2d109255425be1dd90f27aac842504c","parents":["199bb7cbf4b88196cd6dd63f7da4f11fbba40735"],"ref":"refs/changes/51/6751/6","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1565111094,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"REWORK","comments":[{"file":"src/jobs/evacuate.rs","line":244,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"rename"},{"file":"src/jobs/evacuate.rs","line":244,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"},{"file":"src/jobs/evacuate.rs","line":592,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"MANTA-4486"},{"file":"src/jobs/evacuate.rs","line":698,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"This could become:\n\n                    shark_list \u003d job_action\n                        .dest_shark_list\n                        .read()\n                        .unwrap()\n                        .values()\n                        .map(|v| v.shark.to_owned())\n                        .collect();"},{"file":"src/jobs/evacuate.rs","line":698,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"},{"file":"src/jobs/evacuate.rs","line":859,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"should this be .any()?"},{"file":"src/jobs/evacuate.rs","line":859,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"No.  find() short-circuits and returns Option\u003celement\u003e, whereas any() returns a bool if an element is found."},{"file":"src/jobs/evacuate.rs","line":889,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"This must succeed before we send out an assignment so we probably want to flush the buffered objects before line 897."},{"file":"src/jobs/evacuate.rs","line":889,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"Cargo.toml","type":"MODIFIED","insertions":32,"deletions":-1},{"file":"Makefile","type":"MODIFIED","insertions":14,"deletions":-1},{"file":"README.md","type":"MODIFIED","insertions":14,"deletions":0},{"file":"src/agent.rs","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"src/config.json","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"src/config.json.in","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"src/config.rs","type":"MODIFIED","insertions":20,"deletions":-6},{"file":"src/error.rs","type":"MODIFIED","insertions":28,"deletions":-7},{"file":"src/job.rs","type":"DELETED","insertions":0,"deletions":-761},{"file":"src/jobs/evacuate.rs","type":"ADDED","insertions":1307,"deletions":0},{"file":"src/jobs/mod.rs","type":"ADDED","insertions":168,"deletions":0},{"file":"src/lib.rs","type":"MODIFIED","insertions":21,"deletions":-4},{"file":"src/main.rs","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"src/picker.rs","type":"MODIFIED","insertions":48,"deletions":-35},{"file":"src/util.rs","type":"MODIFIED","insertions":23,"deletions":-1}],"sizeInsertions":1695,"sizeDeletions":-825},{"number":"7","revision":"5a4f2e463618e41df174a4e46bb61e012ff75cef","parents":["199bb7cbf4b88196cd6dd63f7da4f11fbba40735"],"ref":"refs/changes/51/6751/7","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1565195296,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"Cargo.toml","type":"MODIFIED","insertions":32,"deletions":-1},{"file":"Makefile","type":"MODIFIED","insertions":14,"deletions":-1},{"file":"README.md","type":"MODIFIED","insertions":14,"deletions":0},{"file":"src/agent.rs","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"src/config.json","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"src/config.json.in","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"src/config.rs","type":"MODIFIED","insertions":20,"deletions":-6},{"file":"src/error.rs","type":"MODIFIED","insertions":28,"deletions":-7},{"file":"src/job.rs","type":"DELETED","insertions":0,"deletions":-761},{"file":"src/jobs/evacuate.rs","type":"ADDED","insertions":1322,"deletions":0},{"file":"src/jobs/mod.rs","type":"ADDED","insertions":168,"deletions":0},{"file":"src/lib.rs","type":"MODIFIED","insertions":21,"deletions":-4},{"file":"src/main.rs","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"src/picker.rs","type":"MODIFIED","insertions":48,"deletions":-35},{"file":"src/util.rs","type":"MODIFIED","insertions":23,"deletions":-1}],"sizeInsertions":1710,"sizeDeletions":-825},{"number":"8","revision":"4766f28226c70359ec88833908a4b60f8432e213","parents":["199bb7cbf4b88196cd6dd63f7da4f11fbba40735"],"ref":"refs/changes/51/6751/8","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1565203858,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"REWORK","comments":[{"file":"Cargo.toml","line":66,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"does this just patch anything else that\u0027s pulling in diesel from crates.io while line 66 is the version of diesel for remora directly?"},{"file":"Cargo.toml","line":66,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Yeah.  My understanding is this grabs patches beyond the most recently released version.  We need this for now because we are hitting https://github.com/diesel-rs/diesel/issues/2100\n\nAnd probably that clippy issue that was just fixed a couple days ago."},{"file":"Makefile","line":1,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"In general you might want to look at the Makefile I used in firewall-logger-agent or the one in boray.  We have some stuff in eng now that drives building rust projects.  Allows for jenkins to run make check and for jenkins to build projects.\n\nJust a note for when you are closer to a finished product."},{"file":"Makefile","line":1,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Good call.  Filed MANTA-4483"},{"file":"src/agent.rs","line":211,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"You could always make this take AsRef\u003cPath\u003e and then do path.as_ref(); Not sure it matters much since its a private API."},{"file":"src/agent.rs","line":211,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Robert is concurrently making changes here, so I\u0027ll file this and let him know.  \n\nThis was only changed by `cargo fmt`.  Same comment for the note below."},{"file":"src/agent.rs","line":222,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Use `ok_or(\"file stem not found\")?` or something along those lines."},{"file":"src/config.rs","line":8,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Format should not have the (c).\nTake a look at eng.git/prototypes/prototype.rs\n\n// Copyright 2019 Joyent, Inc."},{"file":"src/config.rs","line":8,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"},{"file":"src/error.rs","line":8,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Same as other copyright comment."},{"file":"src/error.rs","line":8,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"},{"file":"src/error.rs","line":11,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Not necessary?"},{"file":"src/error.rs","line":11,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"not at all."},{"file":"src/jobs/mod.rs","line":8,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Same as other copyright comment"},{"file":"src/jobs/mod.rs","line":98,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Is there any reason you opted to use String instead of using the uuid crate and making sure we have valid UUIDs?"},{"file":"src/jobs/mod.rs","line":98,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"This probably should change.  Currently rust-libmanta and rust-moray use uuid strings for Manta objects, so that would have to change first.  Let me file a bug and look into this in the short term.\n\nMANTA-4485"},{"file":"src/lib.rs","line":8,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Same copyright styling issue"},{"file":"src/main.rs","line":8,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Same copyright styling issue."},{"file":"src/picker.rs","line":8,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Copyright again"},{"file":"src/picker.rs","line":60,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"This is for future support of other Algorithms?"},{"file":"src/picker.rs","line":60,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Yes.  But maybe this is a bit overkill."},{"file":"src/util.rs","line":8,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Copyright again"},{"file":"src/util.rs","line":8,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"Cargo.toml","type":"MODIFIED","insertions":32,"deletions":-1},{"file":"Makefile","type":"MODIFIED","insertions":14,"deletions":-1},{"file":"README.md","type":"MODIFIED","insertions":14,"deletions":0},{"file":"src/agent.rs","type":"MODIFIED","insertions":16,"deletions":-14},{"file":"src/config.json","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"src/config.json.in","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"src/config.rs","type":"MODIFIED","insertions":21,"deletions":-6},{"file":"src/error.rs","type":"MODIFIED","insertions":28,"deletions":-7},{"file":"src/job.rs","type":"DELETED","insertions":0,"deletions":-761},{"file":"src/jobs/evacuate.rs","type":"ADDED","insertions":1334,"deletions":0},{"file":"src/jobs/mod.rs","type":"ADDED","insertions":168,"deletions":0},{"file":"src/lib.rs","type":"MODIFIED","insertions":21,"deletions":-4},{"file":"src/main.rs","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"src/picker.rs","type":"MODIFIED","insertions":48,"deletions":-35},{"file":"src/util.rs","type":"MODIFIED","insertions":23,"deletions":-1}],"sizeInsertions":1736,"sizeDeletions":-836},{"number":"9","revision":"57f240a21f8f5979099ad45211ab638883b325e3","parents":["199bb7cbf4b88196cd6dd63f7da4f11fbba40735"],"ref":"refs/changes/51/6751/9","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1565279255,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"REWORK","comments":[{"file":"src/jobs/evacuate.rs","line":8,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Remove (c)"},{"file":"src/jobs/evacuate.rs","line":8,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"},{"file":"src/jobs/evacuate.rs","line":36,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"not needed?"},{"file":"src/jobs/evacuate.rs","line":36,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"},{"file":"src/jobs/evacuate.rs","line":40,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"remove {}"},{"file":"src/jobs/evacuate.rs","line":40,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"},{"file":"src/jobs/evacuate.rs","line":92,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"missing space"},{"file":"src/jobs/evacuate.rs","line":92,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"},{"file":"src/jobs/evacuate.rs","line":129,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"If everything here implements Default, can you should just derive it."},{"file":"src/jobs/evacuate.rs","line":129,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"},{"file":"src/jobs/evacuate.rs","line":157,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"I would move these Doc comments so that each is above the actual member of the struct.  This way \"cargo doc\" will render them correctly."},{"file":"src/jobs/evacuate.rs","line":157,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Didn\u0027t know that.  Thanks!"},{"file":"src/jobs/evacuate.rs","line":186,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"I don\u0027t know much about sqlite, but is it okay if each Job has it\u0027s own connection to the database?"},{"file":"src/jobs/evacuate.rs","line":186,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"For now we create a new DB(file) for every Job.  We do this by process ID.  That will probably change to use some form of the job UUID in the future.  This way we have a persistent record of each Job.  MANTA-4496"},{"file":"src/jobs/evacuate.rs","line":215,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Remove unwrap and return the error with \"?\""},{"file":"src/jobs/evacuate.rs","line":215,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"},{"file":"src/jobs/evacuate.rs","line":235,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Some sort of diagram would be nice here that shows how things are wired up."},{"file":"src/jobs/evacuate.rs","line":258,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"What happens if we error here.  Is our state spread out across other threads via other channels? Will those other threads handle this function returning early? If the JoinHandles are dropped I am not sure what happens to the threads. I think they may stay running but there is just no reference to them to wait on to stop the full program from exiting."},{"file":"src/jobs/evacuate.rs","line":258,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"I tested this and the process exits properly.  That makes sense to me because we return here on error all the way up to main(), where the process exits.\n\nI think we could do a better job here of synchronizing these threads and I hope to cover that under MANTA-4457"},{"file":"src/jobs/evacuate.rs","line":309,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"This can become:\n\n        self.dest_shark_list\n            .read()\n            .unwrap()\n            .get(shark.manta_storage_id.as_str())\n            .map_or(false, |eds| {\n                debug!(\n                    \"shark \u0027{}\u0027 status: {:?}\",\n                    shark.manta_storage_id, eds.status\n                );\n                eds.status \u003d\u003d DestSharkStatus::Assigned\n            })"},{"file":"src/jobs/evacuate.rs","line":309,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"},{"file":"src/jobs/evacuate.rs","line":321,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"One thing that just occurred to me about using both log and println.  Are they configured to go to the same place or different locations?"},{"file":"src/jobs/evacuate.rs","line":321,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"that is mostly for the tests, but I\u0027ve switched them all over to log."},{"file":"src/jobs/evacuate.rs","line":324,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"This could be `values_mut()`"},{"file":"src/jobs/evacuate.rs","line":324,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"},{"file":"src/jobs/evacuate.rs","line":503,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Ok(assignment_post_success(self, assignment).map(|_| ())?)"},{"file":"src/jobs/evacuate.rs","line":503,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"},{"file":"src/jobs/evacuate.rs","line":513,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"maybe map these to something in your Error enum since this function already returns a Result?"},{"file":"src/jobs/evacuate.rs","line":513,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"},{"file":"src/jobs/evacuate.rs","line":796,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Can this be trimmed to:\ncont \u003d (assignment.tasks.len() \u003c max_tasks - 1 as usize)\n?"},{"file":"src/jobs/evacuate.rs","line":796,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"},{"file":"src/jobs/evacuate.rs","line":800,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Is this indentation right?  For a second, I thought this was the end of the task loop, but I realized that it\u0027s not."},{"file":"src/jobs/evacuate.rs","line":800,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"This is to handle the feature in rust where you can define your conditional for looping in it\u0027s own code block.  I think that is the right indentation.  Regardless, I factored this out."},{"file":"src/jobs/evacuate.rs","line":827,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"This is just an opinion, so it can be disregarded, but to be able to bust out of both loops from within the inner one via the use of labels is at least confusing to me.  Almost reminds of a goto."},{"file":"src/jobs/evacuate.rs","line":827,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":12,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"Cargo.toml","type":"MODIFIED","insertions":23,"deletions":-2},{"file":"Makefile","type":"MODIFIED","insertions":14,"deletions":-1},{"file":"README.md","type":"MODIFIED","insertions":14,"deletions":0},{"file":"src/agent.rs","type":"MODIFIED","insertions":16,"deletions":-14},{"file":"src/config.json","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"src/config.json.in","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"src/config.rs","type":"MODIFIED","insertions":21,"deletions":-6},{"file":"src/error.rs","type":"MODIFIED","insertions":28,"deletions":-7},{"file":"src/job.rs","type":"DELETED","insertions":0,"deletions":-761},{"file":"src/jobs/evacuate.rs","type":"ADDED","insertions":1334,"deletions":0},{"file":"src/jobs/mod.rs","type":"ADDED","insertions":168,"deletions":0},{"file":"src/lib.rs","type":"MODIFIED","insertions":21,"deletions":-4},{"file":"src/main.rs","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"src/picker.rs","type":"MODIFIED","insertions":48,"deletions":-35},{"file":"src/util.rs","type":"MODIFIED","insertions":23,"deletions":-1}],"sizeInsertions":1727,"sizeDeletions":-837},{"number":"10","revision":"91b5e5fde9f485fe08ba7a17d260a3ab18c274d8","parents":["199bb7cbf4b88196cd6dd63f7da4f11fbba40735"],"ref":"refs/changes/51/6751/10","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1565283034,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":12,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"Cargo.toml","type":"MODIFIED","insertions":23,"deletions":-2},{"file":"Makefile","type":"MODIFIED","insertions":14,"deletions":-1},{"file":"README.md","type":"MODIFIED","insertions":14,"deletions":0},{"file":"src/agent.rs","type":"MODIFIED","insertions":17,"deletions":-15},{"file":"src/config.json","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"src/config.json.in","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"src/config.rs","type":"MODIFIED","insertions":21,"deletions":-6},{"file":"src/error.rs","type":"MODIFIED","insertions":27,"deletions":-7},{"file":"src/job.rs","type":"DELETED","insertions":0,"deletions":-761},{"file":"src/jobs/evacuate.rs","type":"ADDED","insertions":1334,"deletions":0},{"file":"src/jobs/mod.rs","type":"ADDED","insertions":168,"deletions":0},{"file":"src/lib.rs","type":"MODIFIED","insertions":21,"deletions":-4},{"file":"src/main.rs","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"src/picker.rs","type":"MODIFIED","insertions":48,"deletions":-35},{"file":"src/util.rs","type":"MODIFIED","insertions":23,"deletions":-1}],"sizeInsertions":1727,"sizeDeletions":-838},{"number":"11","revision":"a9bcb8798f77445756bf7562e6078603d654ac64","parents":["199bb7cbf4b88196cd6dd63f7da4f11fbba40735"],"ref":"refs/changes/51/6751/11","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1565366277,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":12,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"Cargo.toml","type":"MODIFIED","insertions":23,"deletions":-2},{"file":"Makefile","type":"MODIFIED","insertions":14,"deletions":-1},{"file":"README.md","type":"MODIFIED","insertions":14,"deletions":0},{"file":"src/agent.rs","type":"MODIFIED","insertions":17,"deletions":-15},{"file":"src/config.json","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"src/config.json.in","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"src/config.rs","type":"MODIFIED","insertions":21,"deletions":-6},{"file":"src/error.rs","type":"MODIFIED","insertions":27,"deletions":-7},{"file":"src/job.rs","type":"DELETED","insertions":0,"deletions":-761},{"file":"src/jobs/evacuate.rs","type":"ADDED","insertions":1327,"deletions":0},{"file":"src/jobs/mod.rs","type":"ADDED","insertions":168,"deletions":0},{"file":"src/lib.rs","type":"MODIFIED","insertions":21,"deletions":-4},{"file":"src/main.rs","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"src/picker.rs","type":"MODIFIED","insertions":48,"deletions":-35},{"file":"src/util.rs","type":"MODIFIED","insertions":23,"deletions":-1}],"sizeInsertions":1720,"sizeDeletions":-838},{"number":"12","revision":"eed7e99c4048d9a59d24b1b4e5af866dcc3a551d","parents":["199bb7cbf4b88196cd6dd63f7da4f11fbba40735"],"ref":"refs/changes/51/6751/12","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1565646680,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":12,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"Cargo.toml","type":"MODIFIED","insertions":23,"deletions":-2},{"file":"Makefile","type":"MODIFIED","insertions":14,"deletions":-1},{"file":"README.md","type":"MODIFIED","insertions":14,"deletions":0},{"file":"src/agent.rs","type":"MODIFIED","insertions":17,"deletions":-15},{"file":"src/config.json","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"src/config.json.in","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"src/config.rs","type":"MODIFIED","insertions":24,"deletions":-6},{"file":"src/error.rs","type":"MODIFIED","insertions":45,"deletions":-7},{"file":"src/job.rs","type":"DELETED","insertions":0,"deletions":-761},{"file":"src/jobs/evacuate.rs","type":"ADDED","insertions":1305,"deletions":0},{"file":"src/jobs/mod.rs","type":"ADDED","insertions":168,"deletions":0},{"file":"src/lib.rs","type":"MODIFIED","insertions":21,"deletions":-4},{"file":"src/main.rs","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"src/picker.rs","type":"MODIFIED","insertions":48,"deletions":-35},{"file":"src/util.rs","type":"MODIFIED","insertions":23,"deletions":-1}],"sizeInsertions":1719,"sizeDeletions":-838},{"number":"13","revision":"930202036fa54c58463128b6537a6a8e08a4e6a4","parents":["199bb7cbf4b88196cd6dd63f7da4f11fbba40735"],"ref":"refs/changes/51/6751/13","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1565898069,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"REWORK","comments":[{"file":"src/jobs/evacuate.rs","line":482,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":":)"},{"file":"src/jobs/evacuate.rs","line":525,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Can use .values() again"},{"file":"src/jobs/evacuate.rs","line":525,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Changed to .keys()"},{"file":"src/jobs/evacuate.rs","line":619,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Why create a variable binding to it?"},{"file":"src/jobs/evacuate.rs","line":619,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"changed throughout"},{"file":"src/jobs/evacuate.rs","line":710,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"You could just do if let Err(e) here."},{"file":"src/jobs/evacuate.rs","line":710,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"},{"file":"src/jobs/evacuate.rs","line":734,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"max_tasks.map_or(false, |m| assignment.tasks.len() \u003c m as usize)"},{"file":"src/jobs/evacuate.rs","line":734,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"},{"file":"src/jobs/evacuate.rs","line":753,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"nit dont bother with the binding again"},{"file":"src/jobs/evacuate.rs","line":753,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":12,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"Cargo.toml","type":"MODIFIED","insertions":24,"deletions":-3},{"file":"Makefile","type":"MODIFIED","insertions":14,"deletions":-1},{"file":"README.md","type":"MODIFIED","insertions":14,"deletions":0},{"file":"src/agent.rs","type":"MODIFIED","insertions":17,"deletions":-15},{"file":"src/config.json","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"src/config.json.in","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"src/config.rs","type":"MODIFIED","insertions":24,"deletions":-6},{"file":"src/error.rs","type":"MODIFIED","insertions":45,"deletions":-7},{"file":"src/job.rs","type":"DELETED","insertions":0,"deletions":-761},{"file":"src/jobs/evacuate.rs","type":"ADDED","insertions":1305,"deletions":0},{"file":"src/jobs/mod.rs","type":"ADDED","insertions":168,"deletions":0},{"file":"src/lib.rs","type":"MODIFIED","insertions":21,"deletions":-4},{"file":"src/main.rs","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"src/picker.rs","type":"MODIFIED","insertions":48,"deletions":-35},{"file":"src/util.rs","type":"MODIFIED","insertions":23,"deletions":-1}],"sizeInsertions":1720,"sizeDeletions":-839},{"number":"14","revision":"26463bc84938c09a1aa55d5b64a3d19c887d4b58","parents":["199bb7cbf4b88196cd6dd63f7da4f11fbba40735"],"ref":"refs/changes/51/6751/14","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1565970141,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":12,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"Cargo.toml","type":"MODIFIED","insertions":24,"deletions":-3},{"file":"Makefile","type":"MODIFIED","insertions":14,"deletions":-1},{"file":"README.md","type":"MODIFIED","insertions":14,"deletions":0},{"file":"src/agent.rs","type":"MODIFIED","insertions":17,"deletions":-15},{"file":"src/config.json","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"src/config.json.in","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"src/config.rs","type":"MODIFIED","insertions":24,"deletions":-6},{"file":"src/error.rs","type":"MODIFIED","insertions":45,"deletions":-7},{"file":"src/job.rs","type":"DELETED","insertions":0,"deletions":-761},{"file":"src/jobs/evacuate.rs","type":"ADDED","insertions":1293,"deletions":0},{"file":"src/jobs/mod.rs","type":"ADDED","insertions":168,"deletions":0},{"file":"src/lib.rs","type":"MODIFIED","insertions":21,"deletions":-4},{"file":"src/main.rs","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"src/picker.rs","type":"MODIFIED","insertions":48,"deletions":-35},{"file":"src/util.rs","type":"MODIFIED","insertions":23,"deletions":-1}],"sizeInsertions":1708,"sizeDeletions":-839},{"number":"15","revision":"8180776de0ce3190be96c870924282a957e8b5cc","parents":["199bb7cbf4b88196cd6dd63f7da4f11fbba40735"],"ref":"refs/changes/51/6751/15","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1565970205,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1566238105,"by":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1566240086,"by":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1566240086,"by":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":12,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"Cargo.toml","type":"MODIFIED","insertions":24,"deletions":-3},{"file":"Makefile","type":"MODIFIED","insertions":14,"deletions":-1},{"file":"README.md","type":"MODIFIED","insertions":14,"deletions":0},{"file":"src/agent.rs","type":"MODIFIED","insertions":17,"deletions":-15},{"file":"src/config.json","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"src/config.json.in","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"src/config.rs","type":"MODIFIED","insertions":24,"deletions":-6},{"file":"src/error.rs","type":"MODIFIED","insertions":45,"deletions":-7},{"file":"src/job.rs","type":"DELETED","insertions":0,"deletions":-761},{"file":"src/jobs/evacuate.rs","type":"ADDED","insertions":1293,"deletions":0},{"file":"src/jobs/mod.rs","type":"ADDED","insertions":168,"deletions":0},{"file":"src/lib.rs","type":"MODIFIED","insertions":21,"deletions":-4},{"file":"src/main.rs","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"src/picker.rs","type":"MODIFIED","insertions":48,"deletions":-35},{"file":"src/util.rs","type":"MODIFIED","insertions":23,"deletions":-1}],"sizeInsertions":1708,"sizeDeletions":-839},{"number":"16","revision":"7368b274c6bc7680c4113b1066a1300c558f0599","parents":["199bb7cbf4b88196cd6dd63f7da4f11fbba40735"],"ref":"refs/changes/51/6751/16","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1566242117,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1566238105,"by":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1566240086,"by":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1566240086,"by":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":15,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"Cargo.toml","type":"MODIFIED","insertions":24,"deletions":-3},{"file":"Makefile","type":"MODIFIED","insertions":14,"deletions":-1},{"file":"README.md","type":"MODIFIED","insertions":14,"deletions":0},{"file":"src/agent.rs","type":"MODIFIED","insertions":17,"deletions":-15},{"file":"src/config.json","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"src/config.json.in","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"src/config.rs","type":"MODIFIED","insertions":24,"deletions":-6},{"file":"src/error.rs","type":"MODIFIED","insertions":45,"deletions":-7},{"file":"src/job.rs","type":"DELETED","insertions":0,"deletions":-761},{"file":"src/jobs/evacuate.rs","type":"ADDED","insertions":1293,"deletions":0},{"file":"src/jobs/mod.rs","type":"ADDED","insertions":168,"deletions":0},{"file":"src/lib.rs","type":"MODIFIED","insertions":21,"deletions":-4},{"file":"src/main.rs","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"src/picker.rs","type":"MODIFIED","insertions":48,"deletions":-35},{"file":"src/util.rs","type":"MODIFIED","insertions":23,"deletions":-1}],"sizeInsertions":1708,"sizeDeletions":-839},{"number":"17","revision":"0fdaa4a59bd1a4d1428e78195a36597a7d0e6007","parents":["f336205f37ef90f28adf143eab3b769a337929b3"],"ref":"refs/changes/51/6751/17","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1566242447,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1566242687,"by":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1566242883,"by":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1566242883,"by":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":12,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"Cargo.toml","type":"MODIFIED","insertions":24,"deletions":-3},{"file":"Makefile","type":"MODIFIED","insertions":14,"deletions":-1},{"file":"README.md","type":"MODIFIED","insertions":14,"deletions":0},{"file":"src/agent.rs","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"src/config.json","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"src/config.json.in","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"src/config.rs","type":"MODIFIED","insertions":24,"deletions":-6},{"file":"src/error.rs","type":"MODIFIED","insertions":45,"deletions":-7},{"file":"src/job.rs","type":"DELETED","insertions":0,"deletions":-761},{"file":"src/jobs/evacuate.rs","type":"ADDED","insertions":1293,"deletions":0},{"file":"src/jobs/mod.rs","type":"ADDED","insertions":168,"deletions":0},{"file":"src/lib.rs","type":"MODIFIED","insertions":21,"deletions":-4},{"file":"src/main.rs","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"src/picker.rs","type":"MODIFIED","insertions":48,"deletions":-35},{"file":"src/util.rs","type":"MODIFIED","insertions":23,"deletions":-1}],"sizeInsertions":1695,"sizeDeletions":-828},{"number":"18","revision":"eb3e362d83b76a4d64b2065b2816e6533b0ec581","parents":["f336205f37ef90f28adf143eab3b769a337929b3"],"ref":"refs/changes/51/6751/18","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1566243104,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1566242687,"by":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"}},{"type":"SUBM","value":"1","grantedOn":1566243140,"by":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1566242883,"by":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1566242883,"by":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":15,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"Cargo.toml","type":"MODIFIED","insertions":24,"deletions":-3},{"file":"Makefile","type":"MODIFIED","insertions":14,"deletions":-1},{"file":"README.md","type":"MODIFIED","insertions":14,"deletions":0},{"file":"src/agent.rs","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"src/config.json","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"src/config.json.in","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"src/config.rs","type":"MODIFIED","insertions":24,"deletions":-6},{"file":"src/error.rs","type":"MODIFIED","insertions":45,"deletions":-7},{"file":"src/job.rs","type":"DELETED","insertions":0,"deletions":-761},{"file":"src/jobs/evacuate.rs","type":"ADDED","insertions":1293,"deletions":0},{"file":"src/jobs/mod.rs","type":"ADDED","insertions":168,"deletions":0},{"file":"src/lib.rs","type":"MODIFIED","insertions":21,"deletions":-4},{"file":"src/main.rs","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"src/picker.rs","type":"MODIFIED","insertions":48,"deletions":-35},{"file":"src/util.rs","type":"MODIFIED","insertions":23,"deletions":-1}],"sizeInsertions":1695,"sizeDeletions":-828}],"allReviewers":[{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"}]}