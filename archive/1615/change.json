{"project":"joyent/node-sshpk","branch":"master","id":"I0a7d6e7db8357f670ceda01136e25afd0ebfb128","number":"1615","subject":"joyent/node-sshpk#26 want support for generating ecdsa keys Reviewed by: Trent Mick \u003ctrent.mick@joyent.com\u003e Reviewed by: Brittany Wald \u003cbrittany.wald@joyent.com\u003e Approved by: Trent Mick \u003ctrent.mick@joyent.com\u003e","owner":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"url":"https://cr.joyent.us/1615","commitMessage":"joyent/node-sshpk#26 want support for generating ecdsa keys\nReviewed by: Trent Mick \u003ctrent.mick@joyent.com\u003e\nReviewed by: Brittany Wald \u003cbrittany.wald@joyent.com\u003e\nApproved by: Trent Mick \u003ctrent.mick@joyent.com\u003e\n","createdOn":1488838147,"lastUpdated":1489102646,"open":false,"status":"MERGED","comments":[{"timestamp":1488838147,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 1."},{"timestamp":1488838176,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1488845780,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 2."},{"timestamp":1488845819,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1488847122,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 1: Code-Review+1\n\n(2 comments)"},{"timestamp":1488847157,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 2: Code-Review+1"},{"timestamp":1488852855,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 1:\n\n(2 comments)"},{"timestamp":1488852969,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1488855261,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 3."},{"timestamp":1488855285,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1488856472,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 4."},{"timestamp":1488856507,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1488918357,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 4: Code-Review+1"},{"timestamp":1489022167,"reviewer":{"name":"Brittany Wald","email":"brittany.wald@joyent.com","username":"princesspretzel"},"message":"Patch Set 4:\n\n(4 comments)"},{"timestamp":1489088629,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 4:\n\n(4 comments)"},{"timestamp":1489088708,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 5."},{"timestamp":1489088738,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1489089016,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 5: Code-Review+1"},{"timestamp":1489090902,"reviewer":{"name":"Brittany Wald","email":"brittany.wald@joyent.com","username":"princesspretzel"},"message":"Patch Set 5: Code-Review+1"},{"timestamp":1489102563,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 5: Integration-Approval+1"},{"timestamp":1489102616,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 6: Commit message was updated."},{"timestamp":1489102646,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Alex Wilson"}],"currentPatchSet":{"number":"6","revision":"941d67aa176a758f2f4d2f99cc4a4a7cd08dd113","parents":["1479eb2154178f55aa6ab26a6ab940b1c4a8b13b"],"ref":"refs/changes/15/1615/6","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1489102616,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1489088738,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1489089016,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1489090902,"by":{"name":"Brittany Wald","email":"brittany.wald@joyent.com","username":"princesspretzel"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1489102563,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1489102646,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":15,"deletions":-2},{"file":"lib/dhe.js","type":"MODIFIED","insertions":101,"deletions":-2},{"file":"lib/identity.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/index.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"lib/key.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/private-key.js","type":"MODIFIED","insertions":23,"deletions":-1},{"file":"test/dhe_compat.js","type":"MODIFIED","insertions":8,"deletions":-8},{"file":"test/openssl-cmd.js","type":"MODIFIED","insertions":30,"deletions":-1},{"file":"test/private-key.js","type":"MODIFIED","insertions":58,"deletions":-1}],"sizeInsertions":239,"sizeDeletions":-18},"patchSets":[{"number":"1","revision":"2f5d3479d2c37553cbb76f168c9ad62aa2abfdab","parents":["3bd4c3866a481845683a9e23d5062fff0b4b1bb0"],"ref":"refs/changes/15/1615/1","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1488838147,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1488838176,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1488847122,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"comments":[{"file":"README.md","line":250,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Should docs mention the default curve used for ECDSA? Do we really want a default curve? And if so, \u0027nistp256\u0027? That\u0027s the default in OpenSSL is it (or was at one time)?"},{"file":"README.md","line":250,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"There\u0027s no default in OpenSSL. This default comes from OpenSSH (which does, today, default to using NIST P-256 if you ask it for just an \"ecdsa\" key with no other details).\n\nWill amend to note default here."},{"file":"package.json","line":50,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"FWIW, from the README for this module: \"Note: I (Guy Kloss) now recommend to use TweetNaCl.js (a TweetNaCl port to JavaScript) rather than this implementation, which is more likely to perform in constant time and has likely seen more eyes for review/audits.\""},{"file":"package.json","line":50,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Yes. We use tweetnacl-js already for all ed25519 operations except Diffie-Hellman key exchange (DHE) which is not yet supported by tweetnacl-js. We keep this dep only for the DHE logic."},{"file":"package.json","line":50,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Ah, but we should use tweetnacl.js\u0027 key generation logic for this new code, I see your point. Will amend."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":13,"deletions":-2},{"file":"lib/dhe.js","type":"MODIFIED","insertions":88,"deletions":-1},{"file":"lib/index.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"lib/key.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/private-key.js","type":"MODIFIED","insertions":22,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/dhe_compat.js","type":"MODIFIED","insertions":7,"deletions":-7},{"file":"test/openssl-cmd.js","type":"MODIFIED","insertions":29,"deletions":0},{"file":"test/private-key.js","type":"MODIFIED","insertions":55,"deletions":0}],"sizeInsertions":217,"sizeDeletions":-12},{"number":"2","revision":"5ad6b9c8e6a917f481b9fa035e8cae1ad334515a","parents":["3bd4c3866a481845683a9e23d5062fff0b4b1bb0"],"ref":"refs/changes/15/1615/2","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1488845780,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1488845819,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1488847157,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":13,"deletions":-2},{"file":"lib/dhe.js","type":"MODIFIED","insertions":89,"deletions":-2},{"file":"lib/identity.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/index.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"lib/key.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/private-key.js","type":"MODIFIED","insertions":23,"deletions":-1},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/dhe_compat.js","type":"MODIFIED","insertions":8,"deletions":-8},{"file":"test/openssl-cmd.js","type":"MODIFIED","insertions":30,"deletions":-1},{"file":"test/private-key.js","type":"MODIFIED","insertions":56,"deletions":-1}],"sizeInsertions":224,"sizeDeletions":-19},{"number":"3","revision":"1b9fc89e36c1169531ee3fd7d37770dbfafb54ff","parents":["3bd4c3866a481845683a9e23d5062fff0b4b1bb0"],"ref":"refs/changes/15/1615/3","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1488855261,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1488855285,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":15,"deletions":-2},{"file":"lib/dhe.js","type":"MODIFIED","insertions":86,"deletions":-2},{"file":"lib/identity.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/index.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"lib/key.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/private-key.js","type":"MODIFIED","insertions":23,"deletions":-1},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/dhe_compat.js","type":"MODIFIED","insertions":8,"deletions":-8},{"file":"test/openssl-cmd.js","type":"MODIFIED","insertions":30,"deletions":-1},{"file":"test/private-key.js","type":"MODIFIED","insertions":56,"deletions":-1}],"sizeInsertions":223,"sizeDeletions":-19},{"number":"4","revision":"4816727472c9e35af40a06c01e5f18fc2ca994d2","parents":["3bd4c3866a481845683a9e23d5062fff0b4b1bb0"],"ref":"refs/changes/15/1615/4","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1488856472,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1488856507,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1488918357,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"comments":[{"file":"lib/dhe.js","line":361,"reviewer":{"name":"Brittany Wald","email":"brittany.wald@joyent.com","username":"princesspretzel"},"message":"Just curious, what\u0027s the reason for not using osCurve here?  Is it not supported in PrivateKey creation?"},{"file":"lib/dhe.js","line":361,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"\"osCurve\" is the openssl name for the curve, versus the SSH name for the curve (e.g. what SSH calls \"nistp256\", openssl knows as \"prime256v1\")\n\nThe internal format for sshpk keys uses the SSH names, but the node bindings for OpenSSL (which the crypto module uses) use the OpenSSL names."},{"file":"lib/dhe.js","line":376,"reviewer":{"name":"Brittany Wald","email":"brittany.wald@joyent.com","username":"princesspretzel"},"message":"If \u0027ecc-jsbn\u0027 has already been required, maybe this could be skipped?"},{"file":"lib/dhe.js","line":376,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"We need \"ec\" for ec.ECCurveFp in the X9ECParameters constructor. It\u0027s not exported as part of the \u0027ecc-jsbn\u0027 index.js, so we have to require it like this."},{"file":"lib/dhe.js","line":382,"reviewer":{"name":"Brittany Wald","email":"brittany.wald@joyent.com","username":"princesspretzel"},"message":"B.1.1 is a section describing FFC rather than ECC key generation (and the algos don\u0027t match up!), so I think you might mean B.4.1?"},{"file":"lib/dhe.js","line":382,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Woops. Yes, you\u0027re correct. Will adjust."},{"file":"lib/dhe.js","line":389,"reviewer":{"name":"Brittany Wald","email":"brittany.wald@joyent.com","username":"princesspretzel"},"message":"In the FIPS algorithm it looks like they call for some specific error handling here.  I\u0027m guessing it\u0027s fine to just let `randomBytes` handle it?"},{"file":"lib/dhe.js","line":389,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"The RBG primitive they use in that spec can return error when insufficient entropy is available to fulfill the user\u0027s requirement, or if no RNG is available at all that can reach the security level required.\n\ncrypto.randomBytes calls out to the OpenSSL PRNG framework which will use the OS /dev/random, which will block if we\u0027re early in boot and not seeded yet, instead of returning error. Also it only has one security level of PRNG (which is generally considered acceptable for key generation). So there\u0027s no error to handle here. We\u0027ll just block instead (which is possibly unfortunate with node.js but oh well)"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":15,"deletions":-2},{"file":"lib/dhe.js","type":"MODIFIED","insertions":101,"deletions":-2},{"file":"lib/identity.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/index.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"lib/key.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/private-key.js","type":"MODIFIED","insertions":23,"deletions":-1},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/dhe_compat.js","type":"MODIFIED","insertions":8,"deletions":-8},{"file":"test/openssl-cmd.js","type":"MODIFIED","insertions":30,"deletions":-1},{"file":"test/private-key.js","type":"MODIFIED","insertions":58,"deletions":-1}],"sizeInsertions":240,"sizeDeletions":-19},{"number":"5","revision":"0a7d6e7db8357f670ceda01136e25afd0ebfb128","parents":["1479eb2154178f55aa6ab26a6ab940b1c4a8b13b"],"ref":"refs/changes/15/1615/5","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1489088708,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1489088738,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1489089016,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1489102563,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1489090902,"by":{"name":"Brittany Wald","email":"brittany.wald@joyent.com","username":"princesspretzel"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":15,"deletions":-2},{"file":"lib/dhe.js","type":"MODIFIED","insertions":101,"deletions":-2},{"file":"lib/identity.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/index.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"lib/key.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/private-key.js","type":"MODIFIED","insertions":23,"deletions":-1},{"file":"test/dhe_compat.js","type":"MODIFIED","insertions":8,"deletions":-8},{"file":"test/openssl-cmd.js","type":"MODIFIED","insertions":30,"deletions":-1},{"file":"test/private-key.js","type":"MODIFIED","insertions":58,"deletions":-1}],"sizeInsertions":239,"sizeDeletions":-18},{"number":"6","revision":"941d67aa176a758f2f4d2f99cc4a4a7cd08dd113","parents":["1479eb2154178f55aa6ab26a6ab940b1c4a8b13b"],"ref":"refs/changes/15/1615/6","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1489102616,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"SUBM","value":"1","grantedOn":1489102646,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1489088738,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1489089016,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1489102563,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1489090902,"by":{"name":"Brittany Wald","email":"brittany.wald@joyent.com","username":"princesspretzel"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":15,"deletions":-2},{"file":"lib/dhe.js","type":"MODIFIED","insertions":101,"deletions":-2},{"file":"lib/identity.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/index.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"lib/key.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/private-key.js","type":"MODIFIED","insertions":23,"deletions":-1},{"file":"test/dhe_compat.js","type":"MODIFIED","insertions":8,"deletions":-8},{"file":"test/openssl-cmd.js","type":"MODIFIED","insertions":30,"deletions":-1},{"file":"test/private-key.js","type":"MODIFIED","insertions":58,"deletions":-1}],"sizeInsertions":239,"sizeDeletions":-18}],"allReviewers":[{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},{"name":"Brittany Wald","email":"brittany.wald@joyent.com","username":"princesspretzel"},{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}]}