From 24af66c7d2206c0bafb29bfbefd3fafe9e8bdd89 Mon Sep 17 00:00:00 2001
From: Angela Fong2 <angela.fong@joyent.com>
Date: Mon, 14 Jan 2019 14:36:27 -0800
Subject: [PATCH] TRITON-1086 Docs: Fix incorrect coal image URLs and broken
 formatting in coal setup/readme instructions

---
 README.md                          |   2 +-
 docs/developer-guide/coal-setup.md | 455 +++++++++++++++--------------
 2 files changed, 241 insertions(+), 216 deletions(-)

diff --git a/README.md b/README.md
index 4cf6b4b..b39a94f 100644
--- a/README.md
+++ b/README.md
@@ -127,7 +127,7 @@ the [Joyent Manufacturing Database](https://docs.joyent.com/private-cloud/hardwa
 To install Triton, first download the latest release image:
 
 ```bash
-curl -C - -O https://us-east.manta.joyent.com/Joyent_Dev/public/SmartDataCenter/usb-latest.tgz
+curl -C - -O https://us-east.manta.joyent.com/Joyent_Dev/public/SmartDataCenter/coal-latest.tgz
 ```
 
 Once you have downloaded the latest release image, you will need to
diff --git a/docs/developer-guide/coal-setup.md b/docs/developer-guide/coal-setup.md
index 9ffd912..d4ad9cc 100644
--- a/docs/developer-guide/coal-setup.md
+++ b/docs/developer-guide/coal-setup.md
@@ -5,21 +5,27 @@
 -->
 
 <!--
-    Copyright (c) 2015, Joyent, Inc.
+    Copyright (c) 2019, Joyent, Inc.
 -->
 
 # Cloud on a Laptop (CoaL)
 
-CoaL is a VMware appliance that is a full (Triton)[https://docs.joyent.com/private-cloud) head node for development and testing. Because most Joyent developers work on Macs, this document walks through the process of setting up CoaL on a Mac. Read this document carefully before installing CoaL.
+CoaL is a VMware appliance that is a full [Triton](https://docs.joyent.com/private-cloud)
+head node for development and testing. Because most Joyent developers work on Macs,
+this document walks through the process of setting up CoaL on a Mac. Read this
+document carefully before installing CoaL.
 
-**Note**: Developers in the community have set up CoaL successfully on Windows and on Linux using these instructions as general guidelines, modifying them as needed.
+**Note**: Developers in the community have set up CoaL successfully on Windows and
+on Linux using these instructions as general guidelines, modifying them as needed.
 
-**WARNING**: The installation procedure and configuration options in this document are not appropriate for production deployments.
+**WARNING**: The installation procedure and configuration options in this document
+are not appropriate for production deployments.
 
 
 ## Minimum Requirements
 
-The minimum requirements for a good CoaL experience are a Mac with  16 GB RAM and an SSD with 45 GB disk available.
+The minimum requirements for a good CoaL experience are a Mac with 16 GB RAM and
+an SSD with 45 GB disk available.
 
 ## Overview
 
@@ -35,112 +41,130 @@ The high-level steps for setting up CoaL are:
 
 ## Downloading CoaL
 
-The CoaL tarball is approximately 2 GB and will take some time to download.
+The CoaL tarball is approximately 3 GB and will take some time to download.
 
 To download the latest CoaL build:
 
-	```
-	curl -C - -O https://us-east.manta.joyent.com/Joyent_Dev/public/SmartDataCenter/release-20180927-20180927T130527Z/headnode/coal-release-20180927-20180927T130527Z-g34dbd8a-4gb.tgz
-	```
-
-While you wait for the tarball download to complete, you can configure and install VMware.
+```
+curl -C - -O https://us-east.manta.joyent.com/Joyent_Dev/public/SmartDataCenter/coal-latest.tgz
+```
 
-## Downloading installing, and configuring VMware
+While you wait for the tarball download to complete, you can configure and
+install VMware.
 
-Most Joyent team members run CoaL from VMware Fusion. We recommend VMware version 8.5.3., but users have had success with v5 and v8.
+## Downloading, installing, and configuring VMware
 
-1. Download [VMware Fusion](http://www.vmware.com/products/fusion).
+Most Joyent team members run CoaL from VMware Fusion. We recommend VMware
+version 8.5.3, but users have had success with v5 and v8.
 
-**Note**: For Windows or Linux, download VMware Workstation from [VMware Workstation](http://www.vmware.com/products/workstation.
+1. Download [VMware Fusion](http://www.vmware.com/products/fusion).  
+**Note**: For Windows or Linux, download VMware Workstation from
+[VMware Workstation](http://www.vmware.com/products/workstation).
+1. Install VMware.
+1. When complete, launch the application to confirm that it installed correctly.
+1. Close VMware.
 
-2. Install VMware.
-3. When complete, launch the application to confirm that installed correctly.
-4. Close VMware.
-5. To configure CoaL's external and admin networks:
+To configure CoaL's external and admin networks:
 
-	```bash
-	curl -s https://raw.githubusercontent.com/joyent/sdc/master/tools/coal-mac-vmware-setup | sudo bash
-	```
+- Mac
+    ```bash
+    curl -s https://raw.githubusercontent.com/joyent/triton/master/tools/coal-mac-vmware-setup | sudo bash
+    ```
 
-	**Note**: CoaL network setup scripts are available for Windows and Linux.
+- Linux
+    ```bash
+    curl -s https://raw.githubusercontent.com/joyent/sdc/master/tools/coal-linux-vmware-setup | sudo bash
+    ```
 
-	For Windows, download https://raw.githubusercontent.com/joyent/sdc/master/tools/coal-windows-vmware-setup.bat and run `coal-windows-vmware-setup.bat`.
+- Windows
 
-	On Linux, run:
-	```bash
-	curl -s https://raw.githubusercontent.com/joyent/sdc/master/tools/coal-linux-vmware-setup | sudo bash
-	```
+    Download https://raw.githubusercontent.com/joyent/triton/master/tools/coal-windows-vmware-setup.bat
+    and run `coal-windows-vmware-setup.bat`.
 
 ## Extracting and loading CoaL
 
-1. To extract the CoaL virtual machine:
-
-	```bash
-	$ tar -zxvf coal-latest.tgz -C ~/Documents/Virtual\ Machines.localized
-	x root.password.20140911t161518z
-	x coal-master-20140911T194415Z-g1a445f5-4gb.vmwarevm/
-	x coal-master-20140911T194415Z-g1a445f5-4gb.vmwarevm/USB-headnode.vmx
-	x coal-master-20140911T194415Z-g1a445f5-4gb.vmwarevm/zpool.vmdk
-	x coal-master-20140911T194415Z-g1a445f5-4gb.vmwarevm/USB-headnode.vmdk
-	x coal-master-20140911T194415Z-g1a445f5-4gb.vmwarevm/4gb.img
-	...
-	```
-
-2. To load the CoaL appliance:
-    1. Launch **VMware Fusion**.
-    2. Select **File** and then click **Open**.
-    3. Navigate to and select the `.vmwarevm` file that contains the CoaL build.
-
-**Note**: If you are working from the command line instead of the VMware GUI, run:
-
-	```
-	open coal-<branch>-<build_date_time>-<git_sha1_hash>-4gb.vmwarevm
-	```
-
-**Note**: To configure memory:
-    1. Select **Virtual Machine** and then click **Settings**.
-	The **USB-headnode Settings** dialog displays.
-    2. Click **Processes & Memory**. Change the memory settings, if needed.
-	**Note**: The default memory is set to 8192 MB. You can change this setting, but *be sure to leave Mac OS X with at least 8 GB to avoid resource allocation problems*.
-	If you are not using the VMware GUI, you can change the default memory in the CoaL `USB-headnode.vmx` file.  You can set memsize = "6144", or according to your preference.
-3. If you changed the memory settings, restart VMware.
+To extract the CoaL virtual machine:
+
+```bash
+$ tar -zxvf coal-latest.tgz -C ~/Documents/Virtual\ Machines.localized
+x root.password.20140911t161518z
+x coal-master-20140911T194415Z-g1a445f5-4gb.vmwarevm/
+x coal-master-20140911T194415Z-g1a445f5-4gb.vmwarevm/USB-headnode.vmx
+x coal-master-20140911T194415Z-g1a445f5-4gb.vmwarevm/zpool.vmdk
+x coal-master-20140911T194415Z-g1a445f5-4gb.vmwarevm/USB-headnode.vmdk
+x coal-master-20140911T194415Z-g1a445f5-4gb.vmwarevm/4gb.img
+...
+```
+
+To load the CoaL appliance:
+1. Launch **VMware Fusion**.
+1. Select **File** and then click **Open**.
+1. Navigate to and select the `.vmwarevm` file that contains the CoaL build.  
+   **Note**: If you are working from the command line instead of the GUI, run:
+   ```
+   open coal-<branch>-<build_date_time>-<git_sha1_hash>-4gb.vmwarevm
+   ```
+
+To configure memory:
+
+1. Select **Virtual Machine** and then click **Settings**.  
+   The **USB-headnode Settings** dialog displays.
+1. Click **Processes & Memory**. Change the memory settings, if needed.  
+   **Note**: The default memory is set to 8192 MB. You can change this setting,
+   but be sure to leave Mac OS X with at least 8 GB to avoid resource allocation
+   problems. If you are not using the VMware GUI, you can change the default
+   memory in the CoaL `USB-headnode.vmx` file. You can set memsize = "6144",
+   or according to your preference.
+1. If you have changed the memory settings, restart the VM.
 
 The GRUB boot loader menu displays.
 
-##GRUB menu navigation alert
+## GRUB menu navigation alert
 
-GRUB intervenes in the boot process, enabling you to specify the environment to load. The default is for the console to use ttyb. This is fine for production but not for our use.
+GRUB intervenes in the boot process, enabling you to specify the environment to
+load. The default is for the console to use ttyb. This is fine for production but
+not for our use.
 
-Immediately after highlighting **Live 64-bit** using the arrow keys, press **c** quickly in order to direct the console to use **vga**.
+Immediately after highlighting **Live 64-bit** using the arrow keys, press **c**
+quickly in order to direct the console to use **vga**.
 
-	![CoaL Grub Boot Menu](../img/coal-grub-menu.png)
+![CoaL Grub Boot Menu](../img/coal-grub-menu.png)
 
-If you are too slow, the **Live 64-bit** option loads instead of the GRUB command line. If needed, press **Esc** to redirect the console back to the GRUB menu and try again.
+If you are too slow, the **Live 64-bit** option loads instead of the GRUB command
+line. If needed, press **Esc** to redirect the console back to the GRUB menu and
+try again.
 
 ## Booting the head node
 
 When you are prompted with the GRUB menu:
 
 1. Press the down arrow key to highlight **Live 64-bit**.
-2. Quickly press **c** to load the GRUB command line.
-	If you miss this step, press **Esc** to redirect the console back to the GRUB menu and try again.
-3. At the **GRUB command prompt**, type `variable os_console vga`, and press **Enter**.
-4. Press **Esc** to return to the GRUB menu.
-5. Press **Enter** to boot **Live 64-bit**.
+1. Quickly press **c** to load the GRUB command line.  
+   If you miss this step, press **Esc** to redirect the console back to the GRUB
+   menu and try again.
+1. At the **GRUB command prompt**, type `variable os_console vga`, and press **Enter**.
+1. Press **Esc** to return to the GRUB menu.
+1. Press **Enter** to boot **Live 64-bit**.
 
-**Note**: If you see a blank screen with a cursor at the top left while the head node is booting, you may have forgotten to redirect the console. If so, press Esc to return to the GRUB menu.
+**Note**: If you see a blank screen with a cursor at the top left while the head
+node is booting, you may have forgotten to redirect the console. If so, press
+`Esc` to return to the GRUB menu.
 
-     ![kvm warning on boot](../img/coal-only-cursor.png)
+![cursor_only](../img/coal-only-cursor.png)
 
-**Note**: Because you are in a virtual environment without Intel VT-x support enabled, you'll receive cpu and kvm warnings. You can safely ignore them:
+**Note**: Because you are in a virtual environment without Intel VT-x support
+enabled, you'll receive cpu and kvm warnings. You can safely ignore them:
 
-     ![kvm warning on boot](../img/coal-boot-warnings.png)
+![kvm warning on boot](../img/coal-boot-warnings.png)
 
 ## Configuring the head node
 
-Use the following table to configure the development settings for CoaL. In many cases, you will choose the default values. In others, you must type the literal value provided. Variables are in *italics*. You can set any value for variables.
+Use the following table to configure the development settings for CoaL. In many
+cases, you will choose the default values. In others, you must type the literal
+value provided. Variables are in *italics*. You can set any value for variables.
 
-The final prompt asks that you verify the configuration settings. If you have made a mistake, you can reject the settings and restart the configuration process.
+The final prompt asks that you verify the configuration settings. If you have
+made a mistake, you can reject the settings and restart the configuration process.
 
 |Setting|Value|Notes|
 |---|---|---|
@@ -164,8 +188,8 @@ The final prompt asks that you verify the configuration settings. If you have ma
 |Default gateway IP address:|↵|Press **Enter** to select the default.|
 |Primary DNS Server|↵|Press **Enter** to select the default.|
 |Secondary DNS Server|↵|Press **Enter** to select the default.|
-|Head node domain name|*example.com*|The domain name should be unique. You can ping the domain to verify if its a valid website. If it already exists, select a different domain name.|
-|DNS Search Domain|*example.com*|The search domain should be a unique,  non-reachable web domain name that doesn’t exist.You can ping the domain to verify if its a valid website. If it already exists, select a different domain name|
+|Head node domain name|*example.com*|The domain name should be unique.|
+|DNS Search Domain|*example.com*|The search domain should be unique.|
 |NTP Server IP Address|↵|Press **Enter** to select the default.|
 |Set root password|**rootpass**|Type **rootpass** to set the root password.|
 |Confirm root password|||
@@ -174,8 +198,9 @@ The final prompt asks that you verify the configuration settings. If you have ma
 |Administrator email|↵|Press **Enter** to select the default.|
 |Support email|↵|Press **Enter** to select the default.|
 |Enable telemetry|↵|Press **Enter** to select the default, false.|
-|Verify configuration settings||Review the configuration before proceeding. If the configuration is not correct, type **n** to reject the settings and restart the process.|
-|Confirm configuration||If you verified the configuration settings, you are prompted to confirm them.|
+|Default channel|**release**|Enter **release** to download stable versions by default, or enter another preferred channel.|
+|Verify configuration settings|↵|Review the configuration before proceeding. If the configuration is not correct, type **n** to reject the settings and restart the process.|
+|Confirm configuration|↵|If you verified the configuration settings, you are prompted to confirm them.|
 
 The Verify Configuration prompt looks something like:
 
@@ -183,9 +208,12 @@ The Verify Configuration prompt looks something like:
 
 ## Installing Triton
 
-CoaL will now install the Triton head node based on the  configuration. The installation can take up to 20 minutes. Installation isn’t complete until the **Setup complete** message displays.
+CoaL will now install the Triton head node based on the configuration. The
+installation can take up to 20 minutes. Installation isn’t complete until the
+**Setup complete** message displays.
 
-On a Mac, you will be prompted to enter your admin password several times to enable the VM to monitor all network traffic:
+On a Mac, you will be prompted to enter your admin password several times to
+enable the VM to monitor all network traffic:
 
 ![Mac system dialog confirming VM can monitor all network traffic.](../img/coal-mac-vm-monitor-all-network-traffic.png)
 
@@ -193,9 +221,11 @@ A reboot notification displays when the next phase of installation completes:
 
 ![Reboot message shown on console.](../img/coal-will-reboot.png)
 
-The final phase of installation, setup, is the longest but does not display its progress. You may see either just a cursor on the login page or a login prompt.
+The final phase of installation, setup, is the longest but does not display its
+progress. You may see either just a cursor on the login page or a login prompt.
 
-A message on the console welcomes you to Triton. After some time, a **preparing for setup** message displays:
+A message on the console welcomes you to Triton. After some time, a
+**preparing for setup** message displays:
 
 ![preparing for setup on console.](../img/coal-preparing-for-setup.png)
 
@@ -207,7 +237,8 @@ When the installation completes, **completing setup** displays.
 
 ### Root Access
 
-After setup is complete you should be able to SSH into CoaL using the admin network headnode IP address you configured. For example:
+After setup is complete you should be able to SSH into CoaL using the admin
+network headnode IP address you configured. For example:
 
 ```bash
 ssh root@10.88.88.200  # password 'rootpass'
@@ -215,59 +246,65 @@ ssh root@10.88.88.200  # password 'rootpass'
 
 ### Health checks
 
-Performing health checks is a best practice. You can check the health of CoaL using `sdcadm check-health` before each step. Until [TOOLS-1001](https://smartos.org/bugview/TOOLS-1001) is resolved, you should also run `sdc-healthcheck`.
+Performing health checks is a best practice. You can check the health of CoaL
+using `sdcadm health` before/after rebooting or updating CoaL.
 
 To confirm the health of the services:
 
 ```bash
-root@headnode (coal-1) ~]# sdc-healthcheck
-ZONE                                 STATE           AGENT               STATUS
-global                               running         -                   online
-assets                               running         -                   online
-amon                                 running         -                   online
-binder                               running         -                   online
-rabbitmq                             running         -                   online
-napi                                 running         -                   online
-fwapi                                running         -                   online
-imgapi                               running         -                   online
-adminui                              running         -                   online
-moray                                running         -                   online
-amonredis                            running         -                   online
-sapi                                 running         -                   online
-workflow                             running         -                   online
-mahi                                 running         -                   online
-sdc                                  running         -                   online
-papi                                 running         -                   online
-dhcpd                                running         -                   online
-redis                                running         -                   online
-ufds                                 running         -                   online
-manatee                              running         -                   online
-vmapi                                running         -                   online
-cnapi                                running         -                   online
-ca                                   running         -                   online
-global                               running         provisioner         online
-global                               running         heartbeat           online
-global                               running         ur                  online
-global                               running         smartlogin          online
+root@headnode (coal-1) ~]# sdcadm health
+INSTANCE                              SERVICE          HOSTNAME  ALIAS       HEALTHY
+b25f30b0-e8dc-46e8-a3a3-58e5272b5c16  adminui          headnode  adminui0    true
+1ca8a319-0257-44d5-95a4-64419c7f1ebd  amon             headnode  amon0       true
+1555209d-9d88-4216-a0ff-3a8eec8117a5  amonredis        headnode  amonredis0  true
+cee69840-7778-4cff-872a-5696fef22aff  assets           headnode  assets0     true
+672f2081-0ee4-4815-a523-e0baf80457bd  binder           headnode  binder0     true
+1391af6e-da4a-49d3-8eba-ebb4e2e276c3  ca               headnode  ca0         true
+68f59f8f-bed8-46d0-a08b-99628d524e44  cnapi            headnode  cnapi0      true
+8654d01f-b6f5-4462-a4cf-248944384fbb  dhcpd            headnode  dhcpd0      true
+1774528c-c960-4e3e-8d5c-858c5e4b73de  fwapi            headnode  fwapi0      true
+8f9ee32c-73b0-4ea5-a685-c2fd9141edf0  imgapi           headnode  imgapi0     true
+df0cfe72-6067-450d-bf98-760ed3009783  mahi             headnode  mahi0       true
+9f93657d-2a8d-44fc-831b-f609b22aa3e6  manatee          headnode  manatee0    true
+46b4278d-08c5-4267-9b89-914eaf0c4cd9  moray            headnode  moray0      true
+796f56af-78b1-4a2b-a364-ad1eed275e3a  napi             headnode  napi0       true
+099c7c92-a5e5-42c0-84c2-0774584c808d  papi             headnode  papi0       true
+69980f40-2bfc-4673-8321-38d22e74eea6  rabbitmq         headnode  rabbitmq0   true
+c7cfcfaa-5369-4236-8ed9-96796d3a9ef5  sapi             headnode  sapi0       true
+f30cb983-f1fe-43d0-b093-31b2c5006b01  sdc              headnode  sdc0        true
+247f7e5f-e353-46c5-b615-eab326a96089  ufds             headnode  ufds0       true
+a1e8c136-2fed-4cd1-b3f6-0ec92ecc073e  vmapi            headnode  vmapi0      true
+c47c1b9f-e349-493c-b7d2-4c3a51fd2f21  workflow         headnode  workflow0   true
+564de8b3-3203-b2d7-402b-3698369f114f  global           headnode  global      true
+e80eb8a6-3c53-4ce5-b7b9-6f8bd174a010  amon-agent       headnode  -           true
+618fbb3b-bb5b-49b7-92ff-b8fb5a27e706  amon-relay       headnode  -           true
+03323225-bd5d-4978-b0a5-6ef59be16f9d  cmon-agent       headnode  -           true
+479f9013-73f7-416e-9b16-66486f638195  cn-agent         headnode  -           true
+7084a8b5-7646-406f-a134-97f2a8beb3f0  config-agent     headnode  -           true
+b2fa15f7-b245-4e5a-ad31-b1790f95b77c  firewaller       headnode  -           true
+f32aa368-1632-47b9-a2bc-1079a550a9d2  hagfish-watcher  headnode  -           true
+a411b34d-f1f2-4a16-9454-fb7cb8c21e7c  net-agent        headnode  -           true
+efadb38d-6f53-4d94-bacc-29c04d56a076  smartlogin       headnode  -           true
+eadc8725-8dc7-4d67-82ea-3ca081b821ae  vm-agent         headnode  -           true
 ```
 
 ### Adding external Nics
 
-External NICs are required to access remote update sources and the AdminUI via a browser.
-
-1. To add external nics to `imgapi` and `adminui`:
-
-	```bash
-	[root@headnode (coal-1) ~]# sdcadm post-setup common-external-nics
-	Added external nic to adminui
-	Added external nic to imgapi
-	```
-
-	**Note**: This command does not wait for the `add nics` jobs to complete. Once you submit the command, you might need to wait after the command exits until you are sure that the jobs really finish.
-
-2. To confirm which services have an external IP, run `sdc-vmapi`:
-
-    ```bash
+External NICs are required to access remote update sources and the
+AdminUI via a browser.
+
+To add external nics to `imgapi` and `adminui`:
+   ```bash
+   [root@headnode (coal-1) ~]# sdcadm post-setup common-external-nics
+   Added external nic to adminui
+   Added external nic to imgapi
+   ```
+   **Note**: This command does not wait for the `add nics` jobs to
+   complete. Once you submit the command, you might need to wait after
+   the command exits until you are sure that the jobs really finish.
+
+To confirm which services have an external IP, run `sdc-vmapi`:
+   ```bash
     root@headnode (coal-1) ~]# sdc-vmapi /vms?state=running | json -H -ga alias nics.0.ip nics.1.ip
     dhcpd0 10.99.99.9
     imgapi0 10.99.99.21 10.88.88.4
@@ -291,70 +328,68 @@ External NICs are required to access remote update sources and the AdminUI via a
     ca0 10.99.99.30
     mahi0 10.99.99.33
     adminui0 10.99.99.31 10.88.88.3
-    ```
+   ```
 
-3. To test whether you can access the operations portal, `SDC ADMINUI` in a web browser on the host computer, navigate to https://10.88.88.3/.
+To test whether you can access the AdminUI via the external IP address,
+in a web browser on the host computer, navigate to https://10.88.88.3.
 
 ### Setting up CloudAPI for development
 
-CloudAPI provides the self-serve API access to Triton. If you are developing or testing against CloudAPI then create the CloudAPI zone.
-
-1. To create the CloudAPI zone, run:
-
-    ```bash
-    root@headnode (coal-1) ~]# sdcadm post-setup cloudapi
-    cloudapi0 zone created
-    ```
-
-If you plan to use CloudAPI in CoaL and to provision VMs, you will need to enable the head node to act as a compute node for instances. The head node is excluded from the set of servers used for provisioning customer instances. For development and testing, allowing the head node to act as a compute node for instances is useful.
-
-2. To enable the head node to act as a compute node for instances:
-
-```bash
-[root@headnode (coal-1) ~]# sdcadm post-setup dev-headnode-prov
-Configuring CNAPI to allow headnode provisioning and over-provisioning (allow a minute to propagate)
-```
+CloudAPI provides the self-serve API access to Triton. If you are developing
+or testing against CloudAPI, you can install it by running:
+   ```bash
+   root@headnode (coal-1) ~]# sdcadm post-setup cloudapi
+   cloudapi0 zone created
+   ```
+
+If you plan to use CloudAPI in CoaL and to provision VMs, you will need to
+enable the head node to act as a compute node for instances. The head node
+is excluded from the set of servers used for provisioning customer instances.
+For development and testing, allowing the head node to act as a compute node
+for instances is useful.
+
+To enable the head node to act as a compute node for instances:
+   ```bash
+   [root@headnode (coal-1) ~]# sdcadm post-setup dev-headnode-prov
+   Configuring CNAPI to allow headnode provisioning and over-provisioning (allow a minute to propagate)
+   ```
 
 ### Fabrics
 
-Fabrics are not required to run CoaL. If you need to setup fabrics for development purposes, you can refer to [Set up fabrics in CoaL](./coal-post-setup-fabrics.md)
+Fabrics are not required to run CoaL. If you need to setup fabrics for
+development purposes, you can refer to [Set up fabrics in CoaL](./coal-post-setup-fabrics.md)
 
 ## Maintaining CoaL
 
 ### Set Channel
 
-The first time you update CoaL, set the [updatechannel](../operator-guide/update.md).
-
-1. To set the update channel, run:
-
-```bash
-[root@headnode (coal-1) ~]# sdcadm channel set dev
-Update channel has been successfully set to: 'dev'
-```
-
-2. Check health by running `sdcadm check-health` and `sdc-healthcheck`.
+The default channel can be modified by setting the [update channel](../operator-guide/update.md):
+   ```bash
+   [root@headnode (coal-1) ~]# sdcadm channel set dev
+   Update channel has been successfully set to: 'dev'
+   ```
 
 ### Self Update
 
-1. To update `sdcadm`:
-
-    ```bash
-    [root@headnode (coal-1) ~]# sdcadm --version
-    sdcadm 1.4.4 (release-20150205-20150205T060457Z-g7d76790)
-    [root@headnode (coal-1) ~]# sdcadm self-update --latest
-    Update to sdcadm 1.5.0 (master-20150211T134112Z-gef31015)
-    Download update from https://updates.joyent.com
-    Run sdcadm installer (log at /var/sdcadm/self-updates/20150217T234531Z/install.log)
-    Updated to sdcadm 1.5.0 (master-20150211T134112Z-gef31015, elapsed 7s)
-    ```
-
-2. Run `sdcadm check-health` to confirm the that updated `sdcadm` reports a healthy state.
+To update `sdcadm`:
+   ```bash
+   [root@headnode (coal-1) ~]# sdcadm --version
+   sdcadm 1.4.4 (release-20150205-20150205T060457Z-g7d76790)
+   [root@headnode (coal-1) ~]# sdcadm self-update --latest
+   Update to sdcadm 1.5.0 (master-20150211T134112Z-gef31015)
+   Download update from https://updates.joyent.com
+   Run sdcadm installer (log at /var/sdcadm/self-updates/20150217T234531Z/install.log)
+   Updated to sdcadm 1.5.0 (master-20150211T134112Z-gef31015, elapsed 7s)
+   ```
 
 ### Backing up the manatee zone
 
-Most services store in information in Manatee. None of the other services keep any permanent data locally. (`imgapi` is the occasional exception.)
+Most services store in information in Manatee. None of the other
+services keep any permanent data locally. (`imgapi` is the occasional
+exception.)
 
-To take a ZFS snapshot of the manatee zone and temporarily store on head node's drive:
+To take a ZFS snapshot of the manatee zone and temporarily store on
+head node's drive:
 
 ```bash
 MANATEE0_UUID=$(vmadm lookup -1 alias=~manatee)
@@ -365,10 +400,11 @@ zfs destroy zones/$MANATEE0_UUID/data/manatee@backup
 
 ### Updating Services
 
-Now that you have backed up the Manatee zone, download and install the updated images for the services. This process can take up to 60 minutes depending on how many services have new images.
+Now that you have backed up the Manatee zone, download and install
+the updated images for the services. This process can take up to 60
+minutes depending on how many services have new images.
 
 1. To update global zone tools, run:
-
     ```bash
     [root@headnode (coal-1) ~]# sdcadm experimental update-gz-tools --latest
     Downloading gz-tools image 55d74974-8c0b-4126-8ea4-5c246cf412f5 (2.0.0) to /var/tmp/gz-tools-55d74974-8c0b-4126-8ea4-5c246cf412f5.tgz
@@ -381,21 +417,7 @@ Now that you have backed up the Manatee zone, download and install the updated i
     Cleaning up gz-tools tarball
     Updated gz-tools successfully (elapsed 13s).
     ```
-
-2. To update domain name services:
-
-    ```bash
-    [root@headnode (coal-1) ~]# sdcadm experimental update-other
-    Updating maintain_resolvers for all vm services
-    Updating DNS domain service metadata for papi, mahi
-    Updating DNS domain SDC application metadata for papi, mahi
-    No need to update region_name for this data center
-    sapi_domain already present on node.config
-    Done.
-    ```
-
-3. To update the agents:
-
+1. To update the agents:
     ```
     [root@headnode (coal-1) ~]# sdcadm experimental update-agents --latest -y --all
     UUID of latest installed agents image is: b38d1458-38d1-4884-ab05-6e36692c1700
@@ -414,8 +436,7 @@ Now that you have backed up the Manatee zone, download and install the updated i
     config-agent refresh for all the running servers
     Done.
     ```
-
-3. To update all the services, run the command below. This step can take up to 45 minutes depending on how many services have new images.
+1. To update all the services, run the command below. This step can take up to 45 minutes depending on how many services have new images.
 
     ```bash
     [root@headnode (coal-1) /var/tmp]# sdcadm update --all -y
@@ -630,17 +651,30 @@ Now that you have backed up the Manatee zone, download and install the updated i
     Wait (60s) for mahi instance 0ce580dd-725b-4f80-a341-963359802e90 to come up
     Updated successfully (elapsed 2297s).
     ```
-
-4. To confirm health, run `sdcadm check-health`.
+1. To obtain other miscellaneous updates:
+    ```bash
+    [root@headnode (coal-1) ~]# sdcadm experimental update-other
+    Updating maintain_resolvers for all vm services
+    Updating DNS domain service metadata for papi, mahi
+    Updating DNS domain SDC application metadata for papi, mahi
+    No need to update region_name for this data center
+    sapi_domain already present on node.config
+    Done.
+    ```
+1. To confirm health, run `sdcadm health`.
 
 ### Updating the Platform
 
-[Triton SmartOS](https://smartos.org/) is the operating system, or the platform. You'll find occasional references to SDC in the code, which is an abbreviate for one of the previous versions of the platform. 
+[Triton SmartOS](https://smartos.org/) is the operating system, or the
+platform. You'll find occasional references to SDC in the code, which
+is an abbreviate for one of the previous versions of the platform. 
 
-You may update the platform image (PI) at the same time you install SDC updates. You might not reboot the head node or compute nodes (CN) right away. You will likely install a new PI more frequently than the rest of Triton, so that on reboot you benefit from the most reliable and secure OS.
+You may update the platform image (PI) at the same time you install SDC
+updates. You might not reboot the head node or compute nodes (CN) right
+away. You will likely install a new PI more frequently than the rest of
+Triton, so that on reboot you benefit from the most reliable and secure OS.
 
 1. To download and install the latest platform image:
-
     ```bash
     [root@headnode (coal-1) ~]# sdcadm platform install --latest
     Downloading platform 20150312T155347Z (image 6564370e-da8f-4c40-b66e-9c4ba21e9f50) to /var/tmp/platform-master-20150312T155347Z.tgz
@@ -659,9 +693,7 @@ You may update the platform image (PI) at the same time you install SDC updates.
     Updating 'latest' link
     Installation complete
     ```
-
-2. To update the head node to use the latest platform image, run:
-
+1. To update the head node to use the latest platform image, run:
     ```bash
     [root@headnode (coal-1) ~]# sdcadm platform assign --latest --all
     updating headnode 564dc5bc-f596-6234-8041-bab9c76c2509 to 20150205T055835Z
@@ -669,37 +701,30 @@ You may update the platform image (PI) at the same time you install SDC updates.
     Updating booter cache for servers
     Done updating booter caches
     ```
-	This command assigns the latest platform image to the head node, which is included with the `--all` servers option on the `sdc platform assign` command.
-
-3. To confirm the update:
-
+    This command assigns the latest platform image to the head node,
+    which is included with the `--all` servers option on the
+    `sdc platform assign` command.
+1. To confirm the update:
     ```bash
     [root@headnode (coal-1) ~]# sdcadm platform list
     VERSION           CURRENT_PLATFORM  BOOT_PLATFORM  LATEST
     20150219T182356Z  0                 1              true
     20150205T055835Z  1                 0              false
     ```
-
-4. To reboot the head node:
-
+1. To reboot the head node:
     ```bash
     [root@headnode (coal-1) ~]# reboot
     reboot: Halting 22 zones.
     Connection to 10.88.88.200 closed by remote host.
     ```
-
-5. To log in again and confirm the platform version:
-
+1. To log in again and confirm the platform version:
     ```bash
     % ssh root@10.88.88.200
     Password:
     Last login: Thu Feb 19 21:04:24 2015 from 10.88.88.1
      - SmartOS Live Image v0.147+ build: 20150219T182356Z
     ```
-
-5. To confirm health: `sdc-healthcheck`
-
-Repeat these steps until the state of all services change from `error` or `svc-err` to `online`. Once you are finished, you have successfully updated CoaL.
+1. To confirm health: `sdcadm health`
 
 ## Related Documentation
 
-- 
2.21.0

