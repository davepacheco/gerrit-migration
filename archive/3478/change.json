{"project":"joyent/illumos-extra","branch":"master","id":"Id02e32b9ce98f4342a03410f7faefd7f31c912b2","number":"3478","subject":"OS-6416 add bhyve UEFI firmware to illumos-extra [path to iasl]","owner":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"url":"https://cr.joyent.us/3478","commitMessage":"OS-6416 add bhyve UEFI firmware to illumos-extra [path to iasl]\n","createdOn":1519650710,"lastUpdated":1571853373,"open":false,"status":"ABANDONED","comments":[{"timestamp":1519650710,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Uploaded patch set 1."},{"timestamp":1519654132,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 1: Code-Review+1"},{"timestamp":1519661660,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Uploaded patch set 2."},{"timestamp":1519676888,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1519707974,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 2:\n\nI removed acpica-utils and mounted a shell script that prints an error and exits non-zero over /usr/sbin/iasl.  I then applied the following patch:\n\ndiff --git a/uefi-edk2/Makefile b/uefi-edk2/Makefile\nindex e582e64..582fc6a 100644\n--- a/uefi-edk2/Makefile\n+++ b/uefi-edk2/Makefile\n@@ -24,6 +24,7 @@ UNPACK_SENTINEL \u003d     edksetup.sh\n include ../Makefile.targ\n \n STRAPPROTO\u003d    $(PWD)/../../../proto.strap\n+TOOLSPROTO\u003d    $(PWD)/../../illumos/usr/src/tools/proto/root_i386*\n MAKE_ARGS+\u003d    AS\u003d$(STRAPPROTO)/usr/gnu/bin/gas \\\n                AR\u003d$(STRAPPROTO)/usr/gnu/bin/gar \\\n                LD\u003d$(STRAPPROTO)/usr/gnu/bin/gld \\\n@@ -43,7 +44,7 @@ all: $(VER.64)/$(UNPACK_SENTINEL)\n        ln -sf $(STRAPPROTO)/usr/gnu/bin/gar $(VER.64)/Build/ar\n        ln -sf $(STRAPPROTO)/usr/gnu/bin/gobjcopy $(VER.64)/Build/objcopy\n        ln -sf /opt/local/bin/nasm $(VER.64)/Build/nasm\n-       ln -sf $(STRAPPROTO)/iasl $(VER.64)/Build/iasl\n+       ln -sf $(TOOLSPROTO)/opt/onbld/bin/i386/iasl $(VER.64)/Build/iasl\n        $(MAKE) $(MAKE_ARGS) ARCH\u003d$(ARCH) -C $(VER.64)/BaseTools\n        bash -c \"cd $(VER.64); source edksetup.sh; $(MAKE) $(MAKE_ARGS) ARCH\u003d$(ARCH) -C BhyvePkg/Csm/BhyveCsm16\"\n        bash -c \"cd $(VER.64); source edksetup.sh; export ILGCC_BIN\u003d$(PWD)/$(VER.64)/Build/; build -t ILGCC -a $(ARCH) -b $(UEFI_TARGET) -p BhyvePkg/BhyvePkgX64.dsc -DDEBUG_ON_SERIAL_PORT\u003dTRUE -DFD_SIZE_2MB -DCSM_ENABLE\u003dTRUE\"\n\nI had previously performed a full build with the fix for OS-6696 in illumos-extra.\n\nIn uefi-udk2 I ran:\n\n$ make clean\n$ make install DESTDIR\u003d/tmp/root\n$ find /tmp/root -type f -ls\n2828945861 2048 -rwxr-xr-x   1 mgerdts  other     2097152 Feb 27 05:02 /tmp/root/usr/share/bhyve/uefi-csm-rom.bin"},{"timestamp":1519742778,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Uploaded patch set 3."},{"timestamp":1519744308,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1519749657,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Uploaded patch set 4."},{"timestamp":1519750490,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 4: Code-Review+1"},{"timestamp":1519772423,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 4: Integration-Approval-1"},{"timestamp":1569877124,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 4:\n\nShould probably be discarded at this point?"},{"timestamp":1569877125,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Removed the following votes:\n\n* Integration-Approval-1 by Patrick Mooney \u003cpmooney@pfmooney.com\u003e\n"},{"timestamp":1571853373,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Abandoned"}],"currentPatchSet":{"number":"4","revision":"d02e32b9ce98f4342a03410f7faefd7f31c912b2","parents":["94c729c6489591f1e5b11a82d0752ffe5166706d"],"ref":"refs/changes/78/3478/4","uploader":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"createdOn":1519749657,"author":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1519750490,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":1,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"uefi-edk2/Makefile","type":"MODIFIED","insertions":2,"deletions":0},{"file":"uefi-edk2/Patches/0001-Add-ILGCC-target-to-build-on-illumos.patch","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":5,"sizeDeletions":-2},"patchSets":[{"number":"1","revision":"c16f65d8fda7f70133e344fc4412460812cc96a2","parents":["94c729c6489591f1e5b11a82d0752ffe5166706d"],"ref":"refs/changes/78/3478/1","uploader":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"createdOn":1519650710,"author":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1519654132,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":1,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"uefi-edk2/Makefile","type":"MODIFIED","insertions":1,"deletions":0},{"file":"uefi-edk2/Patches/0001-Add-ILGCC-target-to-build-on-illumos.patch","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":4,"sizeDeletions":-2},{"number":"2","revision":"987905c8915c102ffe8012d4a24c1ec1a73225cf","parents":["94c729c6489591f1e5b11a82d0752ffe5166706d"],"ref":"refs/changes/78/3478/2","uploader":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"createdOn":1519661660,"author":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"isDraft":false,"kind":"REWORK","comments":[{"file":"uefi-edk2/Makefile","line":46,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"This is going to be in the tools directory (same directory as $(CTFBINDRI) in smartos-live Makefile)."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":1,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"uefi-edk2/Makefile","type":"MODIFIED","insertions":1,"deletions":0},{"file":"uefi-edk2/Patches/0001-Add-ILGCC-target-to-build-on-illumos.patch","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":4,"sizeDeletions":-2},{"number":"3","revision":"ebfba558e367a669e48cda0f1ad4b9b2c54695d1","parents":["94c729c6489591f1e5b11a82d0752ffe5166706d"],"ref":"refs/changes/78/3478/3","uploader":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"createdOn":1519742778,"author":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1519744308,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":1,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"uefi-edk2/Makefile","type":"MODIFIED","insertions":2,"deletions":0},{"file":"uefi-edk2/Patches/0001-Add-ILGCC-target-to-build-on-illumos.patch","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":5,"sizeDeletions":-2},{"number":"4","revision":"d02e32b9ce98f4342a03410f7faefd7f31c912b2","parents":["94c729c6489591f1e5b11a82d0752ffe5166706d"],"ref":"refs/changes/78/3478/4","uploader":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"createdOn":1519749657,"author":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1519750490,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":1,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"uefi-edk2/Makefile","type":"MODIFIED","insertions":2,"deletions":0},{"file":"uefi-edk2/Patches/0001-Add-ILGCC-target-to-build-on-illumos.patch","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":5,"sizeDeletions":-2}],"allReviewers":[{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}]}