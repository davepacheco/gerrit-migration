{"project":"joyent/illumos-joyent","branch":"master","id":"I0004add408a25aad114064b5deb597103578e90c","number":"2058","subject":"OS-6127 \"dladm show-overlay \u003coverlay\u003e\" exits zero when varpd doesn\u0027t know about the overlay Reviewed by: Robert Mustacchi \u003crm@joyent.com\u003e Reviewed by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e Approved by: Robert Mustacchi \u003crm@joyent.com\u003e","owner":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"url":"https://cr.joyent.us/2058","commitMessage":"OS-6127 \"dladm show-overlay \u003coverlay\u003e\" exits zero when varpd doesn\u0027t know about the overlay\nReviewed by: Robert Mustacchi \u003crm@joyent.com\u003e\nReviewed by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e\nApproved by: Robert Mustacchi \u003crm@joyent.com\u003e\n","createdOn":1496944720,"lastUpdated":1498240795,"open":false,"status":"MERGED","comments":[{"timestamp":1496944720,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Uploaded patch set 1."},{"timestamp":1496945468,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 1:\n\n(6 comments)"},{"timestamp":1496945723,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 1:\n\n(8 comments)\n\nThis is a good start. In addition, you\u0027re going to want to make sure that the function dladm_overlay_walk_prop() and dladm_overlay_walk_varpd_prop() properly append to the error list."},{"timestamp":1497051697,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Uploaded patch set 2."},{"timestamp":1497197501,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 2:\n\n(9 comments)"},{"timestamp":1497295008,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Uploaded patch set 3."},{"timestamp":1497295272,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Uploaded patch set 4."},{"timestamp":1497308294,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 4: Code-Review+1"},{"timestamp":1497310100,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 4: Code-Review+1"},{"timestamp":1497479686,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 4: Integration-Approval+1"},{"timestamp":1498175928,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Patch Set 5: Patch Set 4 was rebased"},{"timestamp":1498240273,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Patch Set 6: Patch Set 5 was rebased"},{"timestamp":1498240782,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Patch Set 7: Commit message was updated."},{"timestamp":1498240795,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Isaac Davis"}],"currentPatchSet":{"number":"7","revision":"c4b4d807812841c0aa8d1d3e5035edee3d79a805","parents":["16d1a54ce8901bd60aed9a1ec2217832ed696481"],"ref":"refs/changes/58/2058/7","uploader":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"createdOn":1498240782,"author":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1497308294,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1497310100,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1497479686,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"SUBM","value":"1","grantedOn":1498240795,"by":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/cmd/dladm/dladm.c","type":"MODIFIED","insertions":50,"deletions":-16},{"file":"usr/src/lib/libdladm/common/libdloverlay.c","type":"MODIFIED","insertions":28,"deletions":-7},{"file":"usr/src/test/util-tests/runfiles/default.run","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/test/util-tests/tests/dladm/Makefile","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/test/util-tests/tests/dladm/show-overlay-exit.ksh","type":"ADDED","insertions":82,"deletions":0}],"sizeInsertions":162,"sizeDeletions":-24},"patchSets":[{"number":"1","revision":"587b67b2d06f690d639821ce9ca95d2d70e6fed1","parents":["c74b5e77f4d2fbda8db1fe76990657b997609379"],"ref":"refs/changes/58/2058/1","uploader":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"createdOn":1496944720,"author":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/cmd/dladm/dladm.c","line":193,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"The members of this structure need to have a structure prefix. Structure prefixes are important for a couple of reasons. Imagine going through the source base looking for all of the members named len, it\u0027s quite painful, so you want something unique. Look at the other examples."},{"file":"usr/src/cmd/dladm/dladm.c","line":194,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Use a boolean_t instead of int? (And change the 0/1s to B_FALSE/B_TRUEs, respectively)"},{"file":"usr/src/cmd/dladm/dladm.c","line":194,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"If this is only going to be a binary value, then you should use the type boolean_t. Then you will assign the value B_TRUE and B_FALSE to it."},{"file":"usr/src/cmd/dladm/dladm.c","line":195,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"You should use a tab character between the type and the name, like the rest of this file does. Make sure both lines line up."},{"file":"usr/src/cmd/dladm/dladm.c","line":10202,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"nit: move the newline between this and the following code, so the definitions are together"},{"file":"usr/src/cmd/dladm/dladm.c","line":10202,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Group this with the other variable declarations and make sure that the spacing is equivalent as above."},{"file":"usr/src/cmd/dladm/dladm.c","line":10206,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Just setting this isn\u0027t sufficient. We should actually tell the user that something is wrong here, otherwise they\u0027ll just end up frustrated. You probably want to use the warn() function here."},{"file":"usr/src/cmd/dladm/dladm.c","line":10321,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Tab to match"},{"file":"usr/src/cmd/dladm/dladm.c","line":10321,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Same not on tabs / spacing."},{"file":"usr/src/cmd/dladm/dladm.c","line":10381,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Tab to match other definitions."},{"file":"usr/src/cmd/dladm/dladm.c","line":10381,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"See previous notes on spacing."},{"file":"usr/src/cmd/dladm/dladm.c","line":10389,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"nit: The other functions perform this assignment as part of the var definition.  Any reason why this one is different?"},{"file":"usr/src/cmd/dladm/dladm.c","line":10413,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Tab this in to match the other definitions."},{"file":"usr/src/cmd/dladm/dladm.c","line":10413,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"See spacing notes."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/dladm/dladm.c","type":"MODIFIED","insertions":30,"deletions":-12}],"sizeInsertions":30,"sizeDeletions":-12},{"number":"2","revision":"ac1fc6dc001103354df74b81102962daeb48171d","parents":["c74b5e77f4d2fbda8db1fe76990657b997609379"],"ref":"refs/changes/58/2058/2","uploader":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"createdOn":1497051697,"author":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/cmd/dladm/dladm.c","line":10206,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Again, about what. Maybe it would be better to phrase this as \u0027failed to lookup data link %s\u0027."},{"file":"usr/src/lib/libdladm/common/libdloverlay.c","line":404,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Include what you failed to get information about. In this case, the datalink id."},{"file":"usr/src/lib/libdladm/common/libdloverlay.c","line":418,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Include what you failed to get the properties for. As a user this isn\u0027t very clear. \u0027failed to get overlay properties for overlay %s: %s\u0027"},{"file":"usr/src/lib/libdladm/common/libdloverlay.c","line":466,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Again, include the datalink name."},{"file":"usr/src/test/util-tests/tests/dladm/show-overlay-exit.ksh","line":42,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"A continuation should be indented by four spaces. This should be done for the next couple of lines."},{"file":"usr/src/test/util-tests/tests/dladm/show-overlay-exit.ksh","line":44,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"The || should be before the continuation."},{"file":"usr/src/test/util-tests/tests/dladm/show-overlay-exit.ksh","line":46,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Line is longer than 80 chars."},{"file":"usr/src/test/util-tests/tests/dladm/show-overlay-exit.ksh","line":52,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Line is longer than 80 chars."},{"file":"usr/src/test/util-tests/tests/dladm/show-overlay-exit.ksh","line":57,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"May be worth redirecting stdout as well."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/dladm/dladm.c","type":"MODIFIED","insertions":48,"deletions":-16},{"file":"usr/src/lib/libdladm/common/libdloverlay.c","type":"MODIFIED","insertions":23,"deletions":-6},{"file":"usr/src/test/util-tests/runfiles/default.run","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/test/util-tests/tests/dladm/Makefile","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/test/util-tests/tests/dladm/show-overlay-exit.ksh","type":"ADDED","insertions":79,"deletions":0}],"sizeInsertions":152,"sizeDeletions":-23},{"number":"3","revision":"efea82503971bbf03e0a076fe0dc141e30ea1553","parents":["c74b5e77f4d2fbda8db1fe76990657b997609379"],"ref":"refs/changes/58/2058/3","uploader":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"createdOn":1497295008,"author":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/dladm/dladm.c","type":"MODIFIED","insertions":49,"deletions":-16},{"file":"usr/src/lib/libdladm/common/libdloverlay.c","type":"MODIFIED","insertions":28,"deletions":-7},{"file":"usr/src/test/util-tests/runfiles/default.run","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/test/util-tests/tests/dladm/Makefile","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/test/util-tests/tests/dladm/show-overlay-exit.ksh","type":"ADDED","insertions":82,"deletions":0}],"sizeInsertions":161,"sizeDeletions":-24},{"number":"4","revision":"0004add408a25aad114064b5deb597103578e90c","parents":["c74b5e77f4d2fbda8db1fe76990657b997609379"],"ref":"refs/changes/58/2058/4","uploader":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"createdOn":1497295272,"author":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1497308294,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1497479686,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1497310100,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/dladm/dladm.c","type":"MODIFIED","insertions":50,"deletions":-16},{"file":"usr/src/lib/libdladm/common/libdloverlay.c","type":"MODIFIED","insertions":28,"deletions":-7},{"file":"usr/src/test/util-tests/runfiles/default.run","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/test/util-tests/tests/dladm/Makefile","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/test/util-tests/tests/dladm/show-overlay-exit.ksh","type":"ADDED","insertions":82,"deletions":0}],"sizeInsertions":162,"sizeDeletions":-24},{"number":"5","revision":"cbc3d6932d14c3b74aa7db9fa6edfeb5605d177a","parents":["c94ca3d49b9a7d5d1c8f4ec4898f969d57366fae"],"ref":"refs/changes/58/2058/5","uploader":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"createdOn":1498175928,"author":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1497308294,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1497479686,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1497310100,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/dladm/dladm.c","type":"MODIFIED","insertions":50,"deletions":-16},{"file":"usr/src/lib/libdladm/common/libdloverlay.c","type":"MODIFIED","insertions":28,"deletions":-7},{"file":"usr/src/test/util-tests/runfiles/default.run","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/test/util-tests/tests/dladm/Makefile","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/test/util-tests/tests/dladm/show-overlay-exit.ksh","type":"ADDED","insertions":82,"deletions":0}],"sizeInsertions":162,"sizeDeletions":-24},{"number":"6","revision":"a1b4cec262825bafe600aead7fd0a5beb773c515","parents":["16d1a54ce8901bd60aed9a1ec2217832ed696481"],"ref":"refs/changes/58/2058/6","uploader":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"createdOn":1498240273,"author":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1497308294,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1497479686,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1497310100,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/dladm/dladm.c","type":"MODIFIED","insertions":50,"deletions":-16},{"file":"usr/src/lib/libdladm/common/libdloverlay.c","type":"MODIFIED","insertions":28,"deletions":-7},{"file":"usr/src/test/util-tests/runfiles/default.run","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/test/util-tests/tests/dladm/Makefile","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/test/util-tests/tests/dladm/show-overlay-exit.ksh","type":"ADDED","insertions":82,"deletions":0}],"sizeInsertions":162,"sizeDeletions":-24},{"number":"7","revision":"c4b4d807812841c0aa8d1d3e5035edee3d79a805","parents":["16d1a54ce8901bd60aed9a1ec2217832ed696481"],"ref":"refs/changes/58/2058/7","uploader":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"createdOn":1498240782,"author":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1497308294,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1497479686,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1497310100,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"SUBM","value":"1","grantedOn":1498240795,"by":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/cmd/dladm/dladm.c","type":"MODIFIED","insertions":50,"deletions":-16},{"file":"usr/src/lib/libdladm/common/libdloverlay.c","type":"MODIFIED","insertions":28,"deletions":-7},{"file":"usr/src/test/util-tests/runfiles/default.run","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/test/util-tests/tests/dladm/Makefile","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/test/util-tests/tests/dladm/show-overlay-exit.ksh","type":"ADDED","insertions":82,"deletions":0}],"sizeInsertions":162,"sizeDeletions":-24}],"allReviewers":[{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"}]}