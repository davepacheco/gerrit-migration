{"project":"joyent/illumos-joyent","branch":"master","id":"I9cf847e445877b89dda2e814af5af495ec083417","number":"2979","subject":"OS-6466 libtopo mdb module needs generic topo_list_t walker Reviewed by: Robert Mustacchi \u003crobert.mustacchi@joyent.com\u003e Approved by: Robert Mustacchi \u003crobert.mustacchi@joyent.com\u003e","owner":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"url":"https://cr.joyent.us/2979","commitMessage":"OS-6466 libtopo mdb module needs generic topo_list_t walker\nReviewed by: Robert Mustacchi \u003crobert.mustacchi@joyent.com\u003e\nApproved by: Robert Mustacchi \u003crobert.mustacchi@joyent.com\u003e\n","createdOn":1511301797,"lastUpdated":1511985843,"open":false,"status":"MERGED","comments":[{"timestamp":1511301797,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Uploaded patch set 1."},{"timestamp":1511819065,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Uploaded patch set 2: Patch Set 1 was rebased."},{"timestamp":1511827702,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 2:\n\n(4 comments)"},{"timestamp":1511831036,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Uploaded patch set 3."},{"timestamp":1511832215,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 3: Code-Review+1 Integration-Approval+1"},{"timestamp":1511896856,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Uploaded patch set 4: Patch Set 3 was rebased."},{"timestamp":1511981317,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Uploaded patch set 5: Patch Set 4 was rebased."},{"timestamp":1511981437,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Uploaded patch set 6: Commit message was updated."},{"timestamp":1511981681,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Patch Set 6:\n\n(4 comments)"},{"timestamp":1511985756,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Uploaded patch set 7: Patch Set 6 was rebased."},{"timestamp":1511985843,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Rob Johnston"}],"currentPatchSet":{"number":"7","revision":"9cf847e445877b89dda2e814af5af495ec083417","parents":["58853b2326b7e3a605e4e558d0af3e028c87f434"],"ref":"refs/changes/79/2979/7","uploader":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"createdOn":1511985756,"author":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1511832215,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1511832215,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"SUBM","value":"1","grantedOn":1511985843,"by":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/cmd/mdb/common/modules/libtopo/libtopo.c","type":"MODIFIED","insertions":49,"deletions":-2}],"sizeInsertions":49,"sizeDeletions":-2},"patchSets":[{"number":"1","revision":"dce5a9fd1cb4f89474dd142aa03ec2ec41f06a07","parents":["80e874964a249ceff971a86779ea3eeb76350017"],"ref":"refs/changes/79/2979/1","uploader":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"createdOn":1511301797,"author":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/mdb/common/modules/libtopo/libtopo.c","type":"MODIFIED","insertions":55,"deletions":-2}],"sizeInsertions":55,"sizeDeletions":-2},{"number":"2","revision":"91791459b5845c023ee1cabd164e5ad223e376ba","parents":["2ba2c786fc7f279dff78bdfdb8d6f8c63b445314"],"ref":"refs/changes/79/2979/2","uploader":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"createdOn":1511819065,"author":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"isDraft":false,"kind":"TRIVIAL_REBASE","comments":[{"file":"usr/src/cmd/mdb/common/modules/libtopo/libtopo.c","line":900,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Add a trailing \\n here otherwise mdb_warn will try and print out the most recent mdb error with this which won\u0027t make sense (though it does in the later case)."},{"file":"usr/src/cmd/mdb/common/modules/libtopo/libtopo.c","line":900,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/cmd/mdb/common/modules/libtopo/libtopo.c","line":910,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Should we use UM_GC here as well to deal with the case where the command is canceled?"},{"file":"usr/src/cmd/mdb/common/modules/libtopo/libtopo.c","line":910,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/cmd/mdb/common/modules/libtopo/libtopo.c","line":925,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"In tlist_walk_init, you compare with sizeof (topo_list_t); however, here you use -1. I imagine it doesn\u0027t make a big difference, should they be the same?"},{"file":"usr/src/cmd/mdb/common/modules/libtopo/libtopo.c","line":925,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Minor c-style nit, but the \u003d\u003d belongs at the end of the previous line."},{"file":"usr/src/cmd/mdb/common/modules/libtopo/libtopo.c","line":925,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/cmd/mdb/common/modules/libtopo/libtopo.c","line":925,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Looking at the implementation of mdb_vread(), it wil always return -1 on error (including for partial reads), so for consistency I changed the check in tlist_walk_init() to check for -1."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/mdb/common/modules/libtopo/libtopo.c","type":"MODIFIED","insertions":55,"deletions":-2}],"sizeInsertions":55,"sizeDeletions":-2},{"number":"3","revision":"93a486a9cb5c2e8bece5ffce03029e6795b2ab65","parents":["2ba2c786fc7f279dff78bdfdb8d6f8c63b445314"],"ref":"refs/changes/79/2979/3","uploader":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"createdOn":1511831036,"author":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1511832215,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1511832215,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/mdb/common/modules/libtopo/libtopo.c","type":"MODIFIED","insertions":49,"deletions":-2}],"sizeInsertions":49,"sizeDeletions":-2},{"number":"4","revision":"29bd087bb69cee45cfa491a1b52fb6dee01c1e0d","parents":["d34c3f35352d3d27e8f1c35be3da4cb32b1486db"],"ref":"refs/changes/79/2979/4","uploader":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"createdOn":1511896856,"author":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1511832215,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1511832215,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/mdb/common/modules/libtopo/libtopo.c","type":"MODIFIED","insertions":49,"deletions":-2}],"sizeInsertions":49,"sizeDeletions":-2},{"number":"5","revision":"a1288ad59aaabceecb307c5f24e2860be2924a24","parents":["62f3edb48bcd64917d8be4e8d0b56de5aab2b3c4"],"ref":"refs/changes/79/2979/5","uploader":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"createdOn":1511981317,"author":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1511832215,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1511832215,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/mdb/common/modules/libtopo/libtopo.c","type":"MODIFIED","insertions":49,"deletions":-2}],"sizeInsertions":49,"sizeDeletions":-2},{"number":"6","revision":"9a90aa12add2f1f95f422784a5051f02e14821c4","parents":["62f3edb48bcd64917d8be4e8d0b56de5aab2b3c4"],"ref":"refs/changes/79/2979/6","uploader":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"createdOn":1511981437,"author":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1511832215,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1511832215,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/cmd/mdb/common/modules/libtopo/libtopo.c","type":"MODIFIED","insertions":49,"deletions":-2}],"sizeInsertions":49,"sizeDeletions":-2},{"number":"7","revision":"9cf847e445877b89dda2e814af5af495ec083417","parents":["58853b2326b7e3a605e4e558d0af3e028c87f434"],"ref":"refs/changes/79/2979/7","uploader":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"createdOn":1511985756,"author":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1511832215,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1511832215,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"SUBM","value":"1","grantedOn":1511985843,"by":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/cmd/mdb/common/modules/libtopo/libtopo.c","type":"MODIFIED","insertions":49,"deletions":-2}],"sizeInsertions":49,"sizeDeletions":-2}],"allReviewers":[{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"}]}