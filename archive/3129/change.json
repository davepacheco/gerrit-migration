{"project":"joyent/sdc-docker","branch":"master","id":"I95f4963ae0c92a55f273f354ac1c0532c73f025b","number":"3129","subject":"DOCKER-1135 Docker Dumps Core: Potentially Related to Volapi Reviewed by: Todd Whiteman \u003ctodd.whiteman@joyent.com\u003e Approved by: Todd Whiteman \u003ctodd.whiteman@joyent.com\u003e","owner":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"url":"https://cr.joyent.us/3129","commitMessage":"DOCKER-1135 Docker Dumps Core: Potentially Related to Volapi\nReviewed by: Todd Whiteman \u003ctodd.whiteman@joyent.com\u003e\nApproved by: Todd Whiteman \u003ctodd.whiteman@joyent.com\u003e\n","createdOn":1513819272,"lastUpdated":1515097290,"open":false,"status":"MERGED","comments":[{"timestamp":1513819272,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 1."},{"timestamp":1513819306,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1513879499,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Patch Set 1:\n\n(3 comments)"},{"timestamp":1513888175,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Patch Set 1: Code-Review+1 Integration-Approval+1"},{"timestamp":1513888251,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 2: Commit message was updated."},{"timestamp":1513888383,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Julien Gilli"},{"timestamp":1515097290,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 1:\n\n(3 comments)"}],"currentPatchSet":{"number":"2","revision":"46458cb1db3746bfbf0d9e1872d8fd68be5ee6d2","parents":["0a4c3e559e08558dcc4b8c26d164c69a9b8e34ea"],"ref":"refs/changes/29/3129/2","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1513888251,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1513819306,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1513888175,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1513888175,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}},{"type":"SUBM","value":"1","grantedOn":1513888383,"by":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/backends/sdc/containers.js","type":"MODIFIED","insertions":16,"deletions":-11},{"file":"test/images/test-image-with-volume/Dockerfile","type":"ADDED","insertions":4,"deletions":0},{"file":"test/images/test-image-with-volume/Makefile","type":"ADDED","insertions":20,"deletions":0},{"file":"test/images/test-image-with-volume/bar","type":"ADDED","insertions":1,"deletions":0},{"file":"test/integration/api-create-with-volume-from-image.test.js","type":"ADDED","insertions":91,"deletions":0}],"sizeInsertions":132,"sizeDeletions":-11},"patchSets":[{"number":"1","revision":"95f4963ae0c92a55f273f354ac1c0532c73f025b","parents":["0a4c3e559e08558dcc4b8c26d164c69a9b8e34ea"],"ref":"refs/changes/29/3129/1","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1513819272,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1513819306,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1513888175,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1513888175,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}}],"comments":[{"file":"lib/backends/sdc/containers.js","line":2120,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Perhaps also add an Array.isArray check on payload.volumes - otherwise we\u0027ll hit an exception on the forEach call."},{"file":"lib/backends/sdc/containers.js","line":2120,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Added an assert at https://cr.joyent.us/#/c/3157/1/lib/backends/sdc/containers.js@2120 ."},{"file":"test/integration/api-create-with-volume-from-image.test.js","line":61,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Nit: not strictly needed - as the createDockerContainer will run h.ensureImage() too."},{"file":"test/integration/api-create-with-volume-from-image.test.js","line":61,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Done in https://cr.joyent.us/#/c/3157 ."},{"file":"test/integration/api-create-with-volume-from-image.test.js","line":82,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Should a check be made to ensure the volume is created? As this seems to be the only test that sets up a volume from information gathered from the image?\n\nIf volume check is added, please also wrap these tests with the volumes enabled feature (like done in other volumes tests)."},{"file":"test/integration/api-create-with-volume-from-image.test.js","line":82,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"\u003e Should a check be made to ensure the volume is created? As this seems to be the only test that sets up a volume from information gathered from the image?\n\nDone in https://cr.joyent.us/#/c/3157 by changing the Dockerfile so that a file gets created in the image\u0027s volume and the image\u0027s volume is read (with ls).\n\n\u003e If volume check is added, please also wrap these tests with the volumes enabled feature (like done in other volumes tests).\n\nImage\u0027s volumes are different from shared volumes: they\u0027ve been supported for a long time without being guarded by any feature flag, so there\u0027s no need to wrap those tests."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/backends/sdc/containers.js","type":"MODIFIED","insertions":16,"deletions":-11},{"file":"test/images/test-image-with-volume/Dockerfile","type":"ADDED","insertions":4,"deletions":0},{"file":"test/images/test-image-with-volume/Makefile","type":"ADDED","insertions":20,"deletions":0},{"file":"test/images/test-image-with-volume/bar","type":"ADDED","insertions":1,"deletions":0},{"file":"test/integration/api-create-with-volume-from-image.test.js","type":"ADDED","insertions":91,"deletions":0}],"sizeInsertions":132,"sizeDeletions":-11},{"number":"2","revision":"46458cb1db3746bfbf0d9e1872d8fd68be5ee6d2","parents":["0a4c3e559e08558dcc4b8c26d164c69a9b8e34ea"],"ref":"refs/changes/29/3129/2","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1513888251,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1513819306,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"SUBM","value":"1","grantedOn":1513888383,"by":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1513888175,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1513888175,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/backends/sdc/containers.js","type":"MODIFIED","insertions":16,"deletions":-11},{"file":"test/images/test-image-with-volume/Dockerfile","type":"ADDED","insertions":4,"deletions":0},{"file":"test/images/test-image-with-volume/Makefile","type":"ADDED","insertions":20,"deletions":0},{"file":"test/images/test-image-with-volume/bar","type":"ADDED","insertions":1,"deletions":0},{"file":"test/integration/api-create-with-volume-from-image.test.js","type":"ADDED","insertions":91,"deletions":0}],"sizeInsertions":132,"sizeDeletions":-11}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}]}