{"project":"joyent/illumos-joyent","branch":"master","id":"I053ab6d63a92aabacf6aec75c7c0b67ee93727dd","number":"1804","subject":"OS-5977 lxbrand needs get/setfacl support for FreeIPA Reviewed by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e Reviewed by: Ryan Zezeski \u003cryan.zeseski@joyent.com\u003e Approved by: Ryan Zezeski \u003cryan.zeseski@joyent.com\u003e","owner":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"url":"https://cr.joyent.us/1804","commitMessage":"OS-5977 lxbrand needs get/setfacl support for FreeIPA\nReviewed by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e\nReviewed by: Ryan Zezeski \u003cryan.zeseski@joyent.com\u003e\nApproved by: Ryan Zezeski \u003cryan.zeseski@joyent.com\u003e\n","createdOn":1492549358,"lastUpdated":1492714266,"open":false,"status":"MERGED","comments":[{"timestamp":1492549358,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 1."},{"timestamp":1492553262,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 1:\n\n(4 comments)\n\nThis looks good, I only saw a few small things."},{"timestamp":1492555274,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 2."},{"timestamp":1492555280,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 1:\n\n(4 comments)"},{"timestamp":1492628252,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1492634523,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Patch Set 2:\n\n(3 comments)"},{"timestamp":1492700620,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 3."},{"timestamp":1492700644,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 3:\n\n(4 comments)"},{"timestamp":1492703392,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1492704421,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 3:\n\nWith the patch applied, I\u0027m able to successfully complete an \u0027ipa-server-install\u0027 operation under CentOS7.  After the install, the FreeIPA service appears to be functioning along with a local (automatically configured) sssd instance.\n\nLTP coverage of the ACL API is poor.  Existing xattr tests are still excluded due to lack of support for other namespaces.  No regressions were noted in LTP test runs."},{"timestamp":1492705673,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Patch Set 3: Code-Review+1 Integration-Approval+1"},{"timestamp":1492714229,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 4: Commit message was updated."},{"timestamp":1492714266,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Patrick Mooney"}],"currentPatchSet":{"number":"4","revision":"053ab6d63a92aabacf6aec75c7c0b67ee93727dd","parents":["ce33465b99b9a4811a15724b9822c0531560d2b5"],"ref":"refs/changes/04/1804/4","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1492714229,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1492703392,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1492705673,"by":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1492705673,"by":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"}},{"type":"SUBM","value":"1","grantedOn":1492714266,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/uts/common/brand/lx/os/lx_acl.c","type":"ADDED","insertions":210,"deletions":0},{"file":"usr/src/uts/common/brand/lx/sys/lx_acl.h","type":"ADDED","insertions":45,"deletions":0},{"file":"usr/src/uts/common/brand/lx/syscall/lx_xattr.c","type":"MODIFIED","insertions":169,"deletions":-30},{"file":"usr/src/uts/intel/Makefile.files","type":"MODIFIED","insertions":1,"deletions":0}],"sizeInsertions":425,"sizeDeletions":-30},"patchSets":[{"number":"1","revision":"6da3d9f189da5956130fa0541891caf5689e4de0","parents":["3c0ca44a7822bdf8fed958f03830ad3bba1cc727"],"ref":"refs/changes/04/1804/1","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1492549358,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/uts/common/brand/lx/os/lx_acl.c","line":57,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Using uint_t here (and elsewhere you have a naked unsigned) seems more consistent with the style in the rest of the kernel code. It\u0027s shorter too."},{"file":"usr/src/uts/common/brand/lx/os/lx_acl.c","line":57,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Fixed."},{"file":"usr/src/uts/common/brand/lx/os/lx_acl.c","line":148,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Should this comment match the strncmp in the block below? i.e. drop /var"},{"file":"usr/src/uts/common/brand/lx/os/lx_acl.c","line":148,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Good idea.  Fixed."},{"file":"usr/src/uts/common/brand/lx/syscall/lx_xattr.c","line":193,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Unless I am missing it, it looks like the usage of buf and value is mixed up in this function. You pass value in the calls to lx_acl_getxattr above and never seem to put anything into buf."},{"file":"usr/src/uts/common/brand/lx/syscall/lx_xattr.c","line":193,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Right you are.  It\u0027s only because we refuse to emit data here that it \"works\".  I\u0027ll fix that up."},{"file":"usr/src/uts/common/brand/lx/syscall/lx_xattr.c","line":221,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Since lx_acl_listxattr is currently a no-op, this comment seems a little misleading. I am not sure if that matter though."},{"file":"usr/src/uts/common/brand/lx/syscall/lx_xattr.c","line":221,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"I\u0027ll make it a little more clear."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/brand/lx/os/lx_acl.c","type":"ADDED","insertions":210,"deletions":0},{"file":"usr/src/uts/common/brand/lx/sys/lx_acl.h","type":"ADDED","insertions":45,"deletions":0},{"file":"usr/src/uts/common/brand/lx/syscall/lx_xattr.c","type":"MODIFIED","insertions":166,"deletions":-30},{"file":"usr/src/uts/intel/Makefile.files","type":"MODIFIED","insertions":1,"deletions":0}],"sizeInsertions":422,"sizeDeletions":-30},{"number":"2","revision":"f31622bc054bacc4be5600b30ea3ee9c9118a068","parents":["3c0ca44a7822bdf8fed958f03830ad3bba1cc727"],"ref":"refs/changes/04/1804/2","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1492555274,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/uts/common/brand/lx/os/lx_acl.c","line":186,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Should this be !is_dir like setxattr since the default ACL attr is meant for directories?"},{"file":"usr/src/uts/common/brand/lx/os/lx_acl.c","line":186,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Done"},{"file":"usr/src/uts/common/brand/lx/syscall/lx_xattr.c","line":136,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"I think this should be LX_XATTR_POSIX_ACL_DEFAULT."},{"file":"usr/src/uts/common/brand/lx/syscall/lx_xattr.c","line":136,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Done"},{"file":"usr/src/uts/common/brand/lx/syscall/lx_xattr.c","line":181,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"This should be the ACL_DEFAULT constant."},{"file":"usr/src/uts/common/brand/lx/syscall/lx_xattr.c","line":181,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Done"},{"file":"usr/src/uts/common/brand/lx/syscall/lx_xattr.c","line":258,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"This should be the ACL_DEFAULT constant."},{"file":"usr/src/uts/common/brand/lx/syscall/lx_xattr.c","line":258,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/brand/lx/os/lx_acl.c","type":"ADDED","insertions":210,"deletions":0},{"file":"usr/src/uts/common/brand/lx/sys/lx_acl.h","type":"ADDED","insertions":45,"deletions":0},{"file":"usr/src/uts/common/brand/lx/syscall/lx_xattr.c","type":"MODIFIED","insertions":169,"deletions":-30},{"file":"usr/src/uts/intel/Makefile.files","type":"MODIFIED","insertions":1,"deletions":0}],"sizeInsertions":425,"sizeDeletions":-30},{"number":"3","revision":"1bb79ed26988e697ed9bf9c08b937b92d7273c79","parents":["ce33465b99b9a4811a15724b9822c0531560d2b5"],"ref":"refs/changes/04/1804/3","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1492700620,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1492703392,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1492705673,"by":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1492705673,"by":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/brand/lx/os/lx_acl.c","type":"ADDED","insertions":210,"deletions":0},{"file":"usr/src/uts/common/brand/lx/sys/lx_acl.h","type":"ADDED","insertions":45,"deletions":0},{"file":"usr/src/uts/common/brand/lx/syscall/lx_xattr.c","type":"MODIFIED","insertions":169,"deletions":-30},{"file":"usr/src/uts/intel/Makefile.files","type":"MODIFIED","insertions":1,"deletions":0}],"sizeInsertions":425,"sizeDeletions":-30},{"number":"4","revision":"053ab6d63a92aabacf6aec75c7c0b67ee93727dd","parents":["ce33465b99b9a4811a15724b9822c0531560d2b5"],"ref":"refs/changes/04/1804/4","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1492714229,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1492703392,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"SUBM","value":"1","grantedOn":1492714266,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1492705673,"by":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1492705673,"by":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/uts/common/brand/lx/os/lx_acl.c","type":"ADDED","insertions":210,"deletions":0},{"file":"usr/src/uts/common/brand/lx/sys/lx_acl.h","type":"ADDED","insertions":45,"deletions":0},{"file":"usr/src/uts/common/brand/lx/syscall/lx_xattr.c","type":"MODIFIED","insertions":169,"deletions":-30},{"file":"usr/src/uts/intel/Makefile.files","type":"MODIFIED","insertions":1,"deletions":0}],"sizeInsertions":425,"sizeDeletions":-30}],"allReviewers":[{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}]}