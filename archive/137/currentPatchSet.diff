From 2acba06c59019a60f9436dda1f85cfcbf04d7535 Mon Sep 17 00:00:00 2001
From: Cody Peter Mello <cody.mello@joyent.com>
Date: Thu, 28 Apr 2016 18:10:49 +0000
Subject: [PATCH] NAPI-95 /nics/:address does not allow colons in the MAC
 address Reviewed by: Matt Smillie <matt.smillie@joyent.com>

---
 package.json               | 2 +-
 test/unit/nics.test.js     | 7 ++++++-
 test/unit/util-mac.test.js | 2 ++
 3 files changed, 9 insertions(+), 2 deletions(-)

diff --git a/package.json b/package.json
index 60b3f7b..ac9fe5d 100644
--- a/package.json
+++ b/package.json
@@ -17,7 +17,7 @@
     "moray": "git+ssh://git@github.com:joyent/node-moray.git#b84ef0e",
     "node-uuid": "1.4.2",
     "portolan-moray": "git+ssh://git@github.com:joyent/sdc-portolan-moray.git#72eb031",
-    "restify": "git+ssh://git@github.com:mcavage/node-restify.git#0d7b4ba",
+    "restify": "4.1.1",
     "sdc-clients": "git+ssh://git@github.com:joyent/node-sdc-clients.git#beadb69",
     "tape": "3.0.3",
     "trace-event": "1.3.0",
diff --git a/test/unit/nics.test.js b/test/unit/nics.test.js
index 38aaae6..0296530 100644
--- a/test/unit/nics.test.js
+++ b/test/unit/nics.test.js
@@ -559,7 +559,12 @@ test('Provision nic', function (t) {
             }
 
             t.deepEqual(res2, exp, 'get result');
-            return t.end();
+
+            NAPI.get({ path: '/nics/' + res.mac }, function (err3, res3) {
+                t.ifError(err3, 'get NIC with colons in MAC address');
+                t.deepEqual(res3, exp, 'get result');
+                t.end();
+            });
         });
     });
 });
diff --git a/test/unit/util-mac.test.js b/test/unit/util-mac.test.js
index 7b3a8f8..ecaafc0 100644
--- a/test/unit/util-mac.test.js
+++ b/test/unit/util-mac.test.js
@@ -47,6 +47,8 @@ test('macNumberToAddress - valid', function (t) {
             'MAC address "' + macs[m] + '" is valid');
         t.equal(MAC.macAddressToNumber(macs[m]), Number(m),
             'MAC number "' + m + '" is valid');
+        t.equal(MAC.macAddressToNumber(macs[m].replace(/:/g, '')), Number(m),
+            'MAC number "' + m + '" is valid (without colons)');
         t.equal(MAC.macAddressToNumber(macs[m].replace(/:/g, '-')), Number(m),
             'MAC number "' + m + '" is valid (with dashes)');
     }
-- 
2.21.0

