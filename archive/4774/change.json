{"project":"joyent/sdc-cloudapi","branch":"master","id":"I8c97e87f9d5a201bdaefe965b7f03d57b5147249","number":"4774","subject":"TRITON-658 \"triton instance create\" command failed for a CN where there is no \"external\" nictag Reviewed by: Pedro Palazón Candel \u003cpedro@joyent.com\u003e Approved by: Pedro Palazón Candel \u003cpedro@joyent.com\u003e","owner":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"url":"https://cr.joyent.us/4774","commitMessage":"TRITON-658 \"triton instance create\" command failed for a CN where there is no \"external\" nictag\nReviewed by: Pedro Palazón Candel \u003cpedro@joyent.com\u003e\nApproved by: Pedro Palazón Candel \u003cpedro@joyent.com\u003e\n","createdOn":1535728202,"lastUpdated":1536158686,"open":false,"status":"MERGED","comments":[{"timestamp":1535728202,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 1."},{"timestamp":1535728990,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Patch Set 1:\n\nThe essential approach in this change was to abstract away the mechanism for determining if a network was of a certain type (admin, external, etc), while also redefining the way we make that determination.  This change will first look at the network name to determine if the network is of that type.  If the name does not match it will then look for the nictag (using nic_tags_present for pools).  It will also prefer pools over individual networks with the same name/tag."},{"timestamp":1535729100,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 2."},{"timestamp":1535729243,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 3: Patch Set 2 was rebased."},{"timestamp":1535753921,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1535753922,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1535753931,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1535984555,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 3: Code-Review+1\n\n(1 comment)\n\nFine but for a suggestions to do not move to \"common\" shared library a function used by a single file so far."},{"timestamp":1536075538,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 4."},{"timestamp":1536075561,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Patch Set 3:\n\n(1 comment)"},{"timestamp":1536075574,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1536158210,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 4: Code-Review+1 Integration-Approval+1\n\nI assume tests are passing. Stamped!"},{"timestamp":1536158621,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 5: Commit message was updated."},{"timestamp":1536158686,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Rui"}],"currentPatchSet":{"number":"5","revision":"8c97e87f9d5a201bdaefe965b7f03d57b5147249","parents":["32e6d671274c6ce7a8ca2ad761f3620b917e159f"],"ref":"refs/changes/74/4774/5","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1536158621,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1536075574,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1536158210,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1536158210,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"SUBM","value":"1","grantedOn":1536158686,"by":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/middleware/networks.js","type":"MODIFIED","insertions":21,"deletions":-10},{"file":"lib/networks.js","type":"MODIFIED","insertions":55,"deletions":-1},{"file":"lib/plugin-manager.js","type":"MODIFIED","insertions":4,"deletions":-5},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"plugins/filter_owner_networks.js","type":"MODIFIED","insertions":2,"deletions":-6},{"file":"test/machines.test.js","type":"MODIFIED","insertions":255,"deletions":-22}],"sizeInsertions":338,"sizeDeletions":-45},"patchSets":[{"number":"1","revision":"f612a5201e14373332917d56b2ba295d7d180c44","parents":["cb6d496da0fd5f35bfea22ebb0a6a694bfba4ac2"],"ref":"refs/changes/74/4774/1","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1535728202,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1535753921,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/machines.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"lib/middleware/networks.js","type":"MODIFIED","insertions":25,"deletions":-10},{"file":"lib/networks.js","type":"MODIFIED","insertions":55,"deletions":-1},{"file":"lib/plugin-manager.js","type":"MODIFIED","insertions":9,"deletions":-5},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"plugins/filter_owner_networks.js","type":"MODIFIED","insertions":2,"deletions":-6},{"file":"test/common.js","type":"MODIFIED","insertions":22,"deletions":0},{"file":"test/machines.test.js","type":"MODIFIED","insertions":235,"deletions":-21}],"sizeInsertions":350,"sizeDeletions":-44},{"number":"2","revision":"e47fd99a9271396bea8e6343359341a04902f306","parents":["cb6d496da0fd5f35bfea22ebb0a6a694bfba4ac2"],"ref":"refs/changes/74/4774/2","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1535729100,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1535753922,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/middleware/networks.js","type":"MODIFIED","insertions":21,"deletions":-10},{"file":"lib/networks.js","type":"MODIFIED","insertions":55,"deletions":-1},{"file":"lib/plugin-manager.js","type":"MODIFIED","insertions":4,"deletions":-5},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"plugins/filter_owner_networks.js","type":"MODIFIED","insertions":2,"deletions":-6},{"file":"test/common.js","type":"MODIFIED","insertions":21,"deletions":0},{"file":"test/machines.test.js","type":"MODIFIED","insertions":235,"deletions":-20}],"sizeInsertions":339,"sizeDeletions":-43},{"number":"3","revision":"91c2224fbc3c30fbdbd7e0d01b1c0697cc7871db","parents":["32e6d671274c6ce7a8ca2ad761f3620b917e159f"],"ref":"refs/changes/74/4774/3","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1535729243,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1535753931,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1535984555,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"comments":[{"file":"test/machines.test.js","line":165,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"I agree it\u0027s nice to have the getOrCreateNicTag function. What I wouldn\u0027t do is to move it to common yet, since this is the only file using it. I\u0027d say move that function to the top of this file for now?"},{"file":"test/machines.test.js","line":165,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/middleware/networks.js","type":"MODIFIED","insertions":21,"deletions":-10},{"file":"lib/networks.js","type":"MODIFIED","insertions":55,"deletions":-1},{"file":"lib/plugin-manager.js","type":"MODIFIED","insertions":4,"deletions":-5},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"plugins/filter_owner_networks.js","type":"MODIFIED","insertions":2,"deletions":-6},{"file":"test/common.js","type":"MODIFIED","insertions":21,"deletions":0},{"file":"test/machines.test.js","type":"MODIFIED","insertions":235,"deletions":-20}],"sizeInsertions":339,"sizeDeletions":-43},{"number":"4","revision":"d48536148853b61db829ae86c57376282d12d146","parents":["32e6d671274c6ce7a8ca2ad761f3620b917e159f"],"ref":"refs/changes/74/4774/4","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1536075538,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1536075574,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1536158210,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1536158210,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/middleware/networks.js","type":"MODIFIED","insertions":21,"deletions":-10},{"file":"lib/networks.js","type":"MODIFIED","insertions":55,"deletions":-1},{"file":"lib/plugin-manager.js","type":"MODIFIED","insertions":4,"deletions":-5},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"plugins/filter_owner_networks.js","type":"MODIFIED","insertions":2,"deletions":-6},{"file":"test/machines.test.js","type":"MODIFIED","insertions":255,"deletions":-22}],"sizeInsertions":338,"sizeDeletions":-45},{"number":"5","revision":"8c97e87f9d5a201bdaefe965b7f03d57b5147249","parents":["32e6d671274c6ce7a8ca2ad761f3620b917e159f"],"ref":"refs/changes/74/4774/5","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1536158621,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1536075574,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1536158210,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1536158210,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"SUBM","value":"1","grantedOn":1536158686,"by":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/middleware/networks.js","type":"MODIFIED","insertions":21,"deletions":-10},{"file":"lib/networks.js","type":"MODIFIED","insertions":55,"deletions":-1},{"file":"lib/plugin-manager.js","type":"MODIFIED","insertions":4,"deletions":-5},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"plugins/filter_owner_networks.js","type":"MODIFIED","insertions":2,"deletions":-6},{"file":"test/machines.test.js","type":"MODIFIED","insertions":255,"deletions":-22}],"sizeInsertions":338,"sizeDeletions":-45}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}]}