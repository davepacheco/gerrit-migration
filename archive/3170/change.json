{"project":"joyent/pgstatsmon","branch":"master","id":"I9387748417710f740009d4b9ea16181c34bf9838","number":"3170","subject":"joyent/pgstatsmon#3 need a test suite Reviewed by: Richard Kiene \u003crichard.kiene@joyent.com\u003e Approved by: Richard Kiene \u003crichard.kiene@joyent.com\u003e","owner":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"url":"https://cr.joyent.us/3170","commitMessage":"joyent/pgstatsmon#3 need a test suite\nReviewed by: Richard Kiene \u003crichard.kiene@joyent.com\u003e\nApproved by: Richard Kiene \u003crichard.kiene@joyent.com\u003e\n","createdOn":1515442821,"lastUpdated":1525116969,"open":false,"status":"MERGED","comments":[{"timestamp":1515442821,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Uploaded patch set 1."},{"timestamp":1515442824,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1515443200,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Uploaded patch set 2."},{"timestamp":1515443203,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1515443234,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 1:\n\n(3 comments)"},{"timestamp":1515448370,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 2:\n\nI will take a look."},{"timestamp":1515611941,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 2: Code-Review+1\n\n(6 comments)"},{"timestamp":1515792388,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Uploaded patch set 3."},{"timestamp":1515792391,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1515792501,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 2:\n\n(5 comments)"},{"timestamp":1515793692,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1515794556,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 3:\n\n(2 comments)"},{"timestamp":1515797106,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Uploaded patch set 4."},{"timestamp":1515797109,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1516223827,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 4:\n\n(1 comment)"},{"timestamp":1518196010,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Uploaded patch set 5."},{"timestamp":1518196012,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing-1\n\n(2 comments)\n\n\"make check\" exited with status 2"},{"timestamp":1518196327,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Uploaded patch set 6."},{"timestamp":1518196331,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 6: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1518472422,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Uploaded patch set 7."},{"timestamp":1518472425,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 7: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1524616097,"reviewer":{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"},"message":"Patch Set 7:\n\n(4 comments)"},{"timestamp":1524675449,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 7:\n\n(2 comments)\n\nThanks for taking a look at this! I\u0027ll get started on these changes."},{"timestamp":1524685944,"reviewer":{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"},"message":"Patch Set 7:\n\n(2 comments)"},{"timestamp":1524757388,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Uploaded patch set 8."},{"timestamp":1524757392,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 8: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1524757583,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 8:\n\n(4 comments)\n\nUpdated! Thanks."},{"timestamp":1525112273,"reviewer":{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"},"message":"Patch Set 8: Code-Review+1 Integration-Approval+1"},{"timestamp":1525116795,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Uploaded patch set 9: Commit message was updated."},{"timestamp":1525116921,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Uploaded patch set 10: Commit message was updated."},{"timestamp":1525116937,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Uploaded patch set 11: Commit message was updated."},{"timestamp":1525116969,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Kody A Kantor"}],"currentPatchSet":{"number":"11","revision":"9387748417710f740009d4b9ea16181c34bf9838","parents":["160fb6f352499dff07d72a4f69c01a6f6140e56e"],"ref":"refs/changes/70/3170/11","uploader":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"createdOn":1525116937,"author":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1524757392,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1525112273,"by":{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1525112273,"by":{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"}},{"type":"SUBM","value":"1","grantedOn":1525116969,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":".gitmodules","type":"ADDED","insertions":3,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":1,"deletions":0},{"file":"CONTRIBUTING.md","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"Makefile","type":"MODIFIED","insertions":32,"deletions":-3},{"file":"README.md","type":"MODIFIED","insertions":37,"deletions":-8},{"file":"deps/catest","type":"ADDED","insertions":1,"deletions":0},{"file":"jsl.node.conf","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/pgstatsmon.js","type":"MODIFIED","insertions":151,"deletions":-35},{"file":"package.json","type":"MODIFIED","insertions":15,"deletions":-9},{"file":"test/badquery.tst.js","type":"ADDED","insertions":180,"deletions":0},{"file":"test/basic.tst.js","type":"ADDED","insertions":291,"deletions":0},{"file":"test/etc/testconfig.json","type":"ADDED","insertions":12,"deletions":0},{"file":"test/helper.js","type":"ADDED","insertions":213,"deletions":0}],"sizeInsertions":941,"sizeDeletions":-57},"patchSets":[{"number":"1","revision":"3fdeca4060d6878a45750660cec951257d772ef7","parents":["160fb6f352499dff07d72a4f69c01a6f6140e56e"],"ref":"refs/changes/70/3170/1","uploader":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"createdOn":1515442821,"author":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1515442824,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"CONTRIBUTING.md","line":24,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"I see node-fast bundles this as a submodule. I wasn\u0027t sure if we should go that route, or require users to have catest in their environment, like we do with jsstyle and jsl."},{"file":"README.md","line":27,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Sorry, I missed this from the previous CR."},{"file":"package.json","line":0,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Sorry, I guess the formatting of this file has been messed up since the beginning of time... I just noticed it. I updated a few of the dependencies here. I didn\u0027t take the latest node-postgres, but not for any good reason."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"CONTRIBUTING.md","type":"MODIFIED","insertions":49,"deletions":-1},{"file":"Makefile","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"Makefile.targ","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"README.md","type":"MODIFIED","insertions":0,"deletions":-8},{"file":"jsl.node.conf","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/pgstatsmon.js","type":"MODIFIED","insertions":133,"deletions":-34},{"file":"package.json","type":"MODIFIED","insertions":15,"deletions":-9},{"file":"test/badquery.tst.js","type":"ADDED","insertions":140,"deletions":0},{"file":"test/basic.tst.js","type":"ADDED","insertions":252,"deletions":0},{"file":"test/etc/testconfig.json","type":"ADDED","insertions":12,"deletions":0},{"file":"test/helper.js","type":"ADDED","insertions":142,"deletions":0}],"sizeInsertions":752,"sizeDeletions":-55},{"number":"2","revision":"95b70b11788a1875e6e985e1251ca39c5ffbbb8f","parents":["160fb6f352499dff07d72a4f69c01a6f6140e56e"],"ref":"refs/changes/70/3170/2","uploader":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"createdOn":1515443200,"author":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1515611941,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1515443203,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"CONTRIBUTING.md","line":0,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I think most of our newer stuff has a boilerplate CONTRIBUTING.md and testing notes in the README (rather than here), but I don\u0027t think it matters too much."},{"file":"CONTRIBUTING.md","line":25,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"FYI: In many repos, I\u0027ve added catest as a Git submodule that gets pulled in as part of the build.  (There\u0027s nothing wrong with what you\u0027ve got here, though.)"},{"file":"CONTRIBUTING.md","line":25,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Great! I did ask about that, but it looks like it got lost in PS1. I guess I would prefer to have the developer pull in catest on their own if they also have to pull in jsstyle and jsl anyway."},{"file":"Makefile.targ","line":216,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Is this pulling in an updated eng.git Makefile?"},{"file":"Makefile.targ","line":216,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"The NODE_MODULES clean target is defined in a Makefile.defs file in the eng.git repo. If this isn\u0027t fine I could add it to the top-level makefile, like in node-fast: https://github.com/joyent/node-fast/blob/f99797509181363e6db7e925953217b151ea060a/Makefile#L39"},{"file":"Makefile.targ","line":216,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"You can either do that or pull in Makefile.defs, but it\u0027s important that the files that are straight copied out of eng.git not be modified -- otherwise it becomes way too complicated to track all the forks."},{"file":"test/helper.js","line":22,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"It would be nice if this were a little more specific (e.g., loads configuration from a specific file and creates a new pgstatsmon with that config).\n\nI think it\u0027s also pretty helpful if test suites allow you to specify the file name."},{"file":"test/helper.js","line":22,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Done"},{"file":"test/helper.js","line":67,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"It seems like \"pm_targets\" is part of the private details of the class.  Should this be a method on the PgMon class instead?"},{"file":"test/helper.js","line":67,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"I added a function \u0027getTarget()\u0027 which is still listed as private. Is that fine? I\u0027m not sure how we feel about referencing private functions in tests."},{"file":"test/helper.js","line":67,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I do think this is an improvement because if someone were to change that method, they\u0027d presumably know to look for callers, whereas if somebody went to change an internal property name, they might not think to look for uses outside that class.\n\nIf you\u0027d prefer to make it explicitly a public method, that seems reasonable too."},{"file":"test/helper.js","line":95,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"When building SQL strings, short of using a builder library, I like to at least assert that the variables like this don\u0027t have any characters that would allow for injection of bogus stuff.  Even if it\u0027s more conservative than it needs to be, at least things will fail fatally and explicitly if some piece of code accidentally specifies the wrong thing here."},{"file":"test/helper.js","line":95,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Good suggestion. I was disappointed to find that table names can\u0027t be prepared into queries."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"CONTRIBUTING.md","type":"MODIFIED","insertions":49,"deletions":-1},{"file":"Makefile","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"Makefile.targ","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"README.md","type":"MODIFIED","insertions":0,"deletions":-8},{"file":"jsl.node.conf","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/pgstatsmon.js","type":"MODIFIED","insertions":133,"deletions":-34},{"file":"package.json","type":"MODIFIED","insertions":15,"deletions":-9},{"file":"test/badquery.tst.js","type":"ADDED","insertions":140,"deletions":0},{"file":"test/basic.tst.js","type":"ADDED","insertions":252,"deletions":0},{"file":"test/etc/testconfig.json","type":"ADDED","insertions":12,"deletions":0},{"file":"test/helper.js","type":"ADDED","insertions":142,"deletions":0}],"sizeInsertions":752,"sizeDeletions":-55},{"number":"3","revision":"8897977c36e8ac735fe5e9cfe9f24e84c65d0e0e","parents":["160fb6f352499dff07d72a4f69c01a6f6140e56e"],"ref":"refs/changes/70/3170/3","uploader":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"createdOn":1515792388,"author":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1515792391,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"test/helper.js","line":28,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"missing word here?"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"CONTRIBUTING.md","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"Makefile","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"README.md","type":"MODIFIED","insertions":50,"deletions":-8},{"file":"jsl.node.conf","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/pgstatsmon.js","type":"MODIFIED","insertions":143,"deletions":-35},{"file":"package.json","type":"MODIFIED","insertions":15,"deletions":-9},{"file":"test/badquery.tst.js","type":"ADDED","insertions":149,"deletions":0},{"file":"test/basic.tst.js","type":"ADDED","insertions":262,"deletions":0},{"file":"test/etc/testconfig.json","type":"ADDED","insertions":12,"deletions":0},{"file":"test/helper.js","type":"ADDED","insertions":158,"deletions":0}],"sizeInsertions":799,"sizeDeletions":-56},{"number":"4","revision":"b439908c344d5da6cbc9b980c62e94014596f5fe","parents":["160fb6f352499dff07d72a4f69c01a6f6140e56e"],"ref":"refs/changes/70/3170/4","uploader":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"createdOn":1515797106,"author":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1515797109,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"test/helper.js","line":103,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"When handling errors like this, I think it\u0027s generally much safer to either throw them (i.e., if it\u0027s a programmer error) or invoke the callback asynchronously with setImmediate (if it\u0027s an operational error)."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"CONTRIBUTING.md","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"Makefile","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"README.md","type":"MODIFIED","insertions":50,"deletions":-8},{"file":"jsl.node.conf","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/pgstatsmon.js","type":"MODIFIED","insertions":143,"deletions":-35},{"file":"package.json","type":"MODIFIED","insertions":15,"deletions":-9},{"file":"test/badquery.tst.js","type":"ADDED","insertions":149,"deletions":0},{"file":"test/basic.tst.js","type":"ADDED","insertions":262,"deletions":0},{"file":"test/etc/testconfig.json","type":"ADDED","insertions":12,"deletions":0},{"file":"test/helper.js","type":"ADDED","insertions":158,"deletions":0}],"sizeInsertions":799,"sizeDeletions":-56},{"number":"5","revision":"79c74f89c74be664dad93fec3ec1eaf54c5aa26a","parents":["160fb6f352499dff07d72a4f69c01a6f6140e56e"],"ref":"refs/changes/70/3170/5","uploader":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"createdOn":1518196010,"author":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1518196012,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"test/helper.js","line":104,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"warning: unreachable code"},{"file":"test/helper.js","line":120,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"warning: unreachable code"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"CONTRIBUTING.md","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"Makefile","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"README.md","type":"MODIFIED","insertions":50,"deletions":-8},{"file":"jsl.node.conf","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/pgstatsmon.js","type":"MODIFIED","insertions":143,"deletions":-35},{"file":"package.json","type":"MODIFIED","insertions":15,"deletions":-9},{"file":"test/badquery.tst.js","type":"ADDED","insertions":149,"deletions":0},{"file":"test/basic.tst.js","type":"ADDED","insertions":262,"deletions":0},{"file":"test/etc/testconfig.json","type":"ADDED","insertions":12,"deletions":0},{"file":"test/helper.js","type":"ADDED","insertions":158,"deletions":0}],"sizeInsertions":799,"sizeDeletions":-56},{"number":"6","revision":"e49335c50307c239c90c00a71375015a9abd3ea1","parents":["160fb6f352499dff07d72a4f69c01a6f6140e56e"],"ref":"refs/changes/70/3170/6","uploader":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"createdOn":1518196327,"author":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1518196331,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"CONTRIBUTING.md","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"Makefile","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"README.md","type":"MODIFIED","insertions":50,"deletions":-8},{"file":"jsl.node.conf","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/pgstatsmon.js","type":"MODIFIED","insertions":143,"deletions":-35},{"file":"package.json","type":"MODIFIED","insertions":15,"deletions":-9},{"file":"test/badquery.tst.js","type":"ADDED","insertions":149,"deletions":0},{"file":"test/basic.tst.js","type":"ADDED","insertions":262,"deletions":0},{"file":"test/etc/testconfig.json","type":"ADDED","insertions":12,"deletions":0},{"file":"test/helper.js","type":"ADDED","insertions":156,"deletions":0}],"sizeInsertions":797,"sizeDeletions":-56},{"number":"7","revision":"7817fe65ca4c0c62d05e082d3ba84281e5fc130c","parents":["160fb6f352499dff07d72a4f69c01a6f6140e56e"],"ref":"refs/changes/70/3170/7","uploader":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"createdOn":1518472422,"author":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1518472425,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"README.md","line":74,"reviewer":{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"},"message":"I\u0027d expect `make test` to install that for me. What do you think?"},{"file":"README.md","line":74,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"How about a setting up catest as a git submodule?"},{"file":"README.md","line":74,"reviewer":{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"},"message":"I don\u0027t see why not :)"},{"file":"README.md","line":74,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Done"},{"file":"README.md","line":87,"reviewer":{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"},"message":"Other Triton test suites check for the existence of a file to prevent smashing production data. I think we\u0027ll want some sort of precautionary check like that for this as well."},{"file":"README.md","line":87,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Added a note showing this in the GitHub issue. Let me know if that looks good."},{"file":"README.md","line":89,"reviewer":{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"},"message":"Why not create the user, database, and tables as a part of `make test`?"},{"file":"README.md","line":89,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Done"},{"file":"lib/pgstatsmon.js","line":163,"reviewer":{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"},"message":"Are the inlined returns really necessary here?  They seem superfluous at first glance, and the JSSTYLED gives some code smell."},{"file":"lib/pgstatsmon.js","line":163,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"The end result of this code block is similar to this  pseudocode:\n\n/* create arrays for state and data per backend */\nnum_backends \u003d Object.keys(database_obj).length;\nnum_queries \u003d Object.keys(query_obj).length;\nstate_array \u003d new Array(num_backends);\ndata_array \u003d new Array(num_backends).length);\n\nforeach (database_obj, database_index) {\n  /* create arrays for state and data per query */\n  state_array[database_index] \u003d new Array(num_queries);\n  data_array[database_index] \u003d new Array(num_queries);\n\n  foreach (query_obj, query_index) {\n    /* populate state and data arrays with initial values */\n    state_array[database_index][query_index] \u003d null;\n    data_array[database_index][query_index] \u003d {};\n  }\n}\n\nI\u0027m not sure if we need to do the inner \u0027foreach\u0027 in the above pseudocode.\n\nThe difference is that the map code doesn\u0027t pre-allocate arrays and does one big assignment to pm_state and pm_data at the end.\n\nThis code isn\u0027t very readable. I\u0027ll swap this code out for something similar the above pseudocode if you think that would be valuable.\n\nIt looks like jsstyle complains about having more than one keyword per line."},{"file":"lib/pgstatsmon.js","line":163,"reviewer":{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"},"message":"Yeah, I think the multiple return statements add code smell for me personally. It\u0027s not the end of the world, I just want to make sure it\u0027s absolutely necessary if that ends up being how we do it."},{"file":"lib/pgstatsmon.js","line":163,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"It turns out that we have to keep the initialization in there (setting to {} and null). During the \u0027tick\u0027 phase pgstatsmon will check these values and will abort if they\u0027re undefined."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":1,"deletions":0},{"file":"CONTRIBUTING.md","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"Makefile","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"README.md","type":"MODIFIED","insertions":50,"deletions":-8},{"file":"jsl.node.conf","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/pgstatsmon.js","type":"MODIFIED","insertions":143,"deletions":-35},{"file":"package.json","type":"MODIFIED","insertions":15,"deletions":-9},{"file":"test/badquery.tst.js","type":"ADDED","insertions":149,"deletions":0},{"file":"test/basic.tst.js","type":"ADDED","insertions":262,"deletions":0},{"file":"test/etc/testconfig.json","type":"ADDED","insertions":12,"deletions":0},{"file":"test/helper.js","type":"ADDED","insertions":156,"deletions":0}],"sizeInsertions":798,"sizeDeletions":-56},{"number":"8","revision":"bd507bb8fea1850e598f798f4a511b8508a3d0bb","parents":["160fb6f352499dff07d72a4f69c01a6f6140e56e"],"ref":"refs/changes/70/3170/8","uploader":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"createdOn":1524757388,"author":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1524757392,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1525112273,"by":{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1525112273,"by":{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":".gitmodules","type":"ADDED","insertions":3,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":1,"deletions":0},{"file":"CONTRIBUTING.md","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"Makefile","type":"MODIFIED","insertions":32,"deletions":-3},{"file":"README.md","type":"MODIFIED","insertions":37,"deletions":-8},{"file":"deps/catest","type":"ADDED","insertions":1,"deletions":0},{"file":"jsl.node.conf","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/pgstatsmon.js","type":"MODIFIED","insertions":151,"deletions":-35},{"file":"package.json","type":"MODIFIED","insertions":15,"deletions":-9},{"file":"test/badquery.tst.js","type":"ADDED","insertions":180,"deletions":0},{"file":"test/basic.tst.js","type":"ADDED","insertions":291,"deletions":0},{"file":"test/etc/testconfig.json","type":"ADDED","insertions":12,"deletions":0},{"file":"test/helper.js","type":"ADDED","insertions":213,"deletions":0}],"sizeInsertions":941,"sizeDeletions":-57},{"number":"9","revision":"c9ffe01a982c3af2ba049f3f77c4c9cf8c4f1046","parents":["160fb6f352499dff07d72a4f69c01a6f6140e56e"],"ref":"refs/changes/70/3170/9","uploader":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"createdOn":1525116795,"author":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1524757392,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1525112273,"by":{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1525112273,"by":{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":".gitmodules","type":"ADDED","insertions":3,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":1,"deletions":0},{"file":"CONTRIBUTING.md","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"Makefile","type":"MODIFIED","insertions":32,"deletions":-3},{"file":"README.md","type":"MODIFIED","insertions":37,"deletions":-8},{"file":"deps/catest","type":"ADDED","insertions":1,"deletions":0},{"file":"jsl.node.conf","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/pgstatsmon.js","type":"MODIFIED","insertions":151,"deletions":-35},{"file":"package.json","type":"MODIFIED","insertions":15,"deletions":-9},{"file":"test/badquery.tst.js","type":"ADDED","insertions":180,"deletions":0},{"file":"test/basic.tst.js","type":"ADDED","insertions":291,"deletions":0},{"file":"test/etc/testconfig.json","type":"ADDED","insertions":12,"deletions":0},{"file":"test/helper.js","type":"ADDED","insertions":213,"deletions":0}],"sizeInsertions":941,"sizeDeletions":-57},{"number":"10","revision":"762fcf750d40dbe5d93413b96ab77d207d1f7183","parents":["160fb6f352499dff07d72a4f69c01a6f6140e56e"],"ref":"refs/changes/70/3170/10","uploader":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"createdOn":1525116921,"author":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1524757392,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1525112273,"by":{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1525112273,"by":{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":".gitmodules","type":"ADDED","insertions":3,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":1,"deletions":0},{"file":"CONTRIBUTING.md","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"Makefile","type":"MODIFIED","insertions":32,"deletions":-3},{"file":"README.md","type":"MODIFIED","insertions":37,"deletions":-8},{"file":"deps/catest","type":"ADDED","insertions":1,"deletions":0},{"file":"jsl.node.conf","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/pgstatsmon.js","type":"MODIFIED","insertions":151,"deletions":-35},{"file":"package.json","type":"MODIFIED","insertions":15,"deletions":-9},{"file":"test/badquery.tst.js","type":"ADDED","insertions":180,"deletions":0},{"file":"test/basic.tst.js","type":"ADDED","insertions":291,"deletions":0},{"file":"test/etc/testconfig.json","type":"ADDED","insertions":12,"deletions":0},{"file":"test/helper.js","type":"ADDED","insertions":213,"deletions":0}],"sizeInsertions":941,"sizeDeletions":-57},{"number":"11","revision":"9387748417710f740009d4b9ea16181c34bf9838","parents":["160fb6f352499dff07d72a4f69c01a6f6140e56e"],"ref":"refs/changes/70/3170/11","uploader":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"createdOn":1525116937,"author":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1524757392,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1525112273,"by":{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1525112273,"by":{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"}},{"type":"SUBM","value":"1","grantedOn":1525116969,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":".gitmodules","type":"ADDED","insertions":3,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":1,"deletions":0},{"file":"CONTRIBUTING.md","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"Makefile","type":"MODIFIED","insertions":32,"deletions":-3},{"file":"README.md","type":"MODIFIED","insertions":37,"deletions":-8},{"file":"deps/catest","type":"ADDED","insertions":1,"deletions":0},{"file":"jsl.node.conf","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/pgstatsmon.js","type":"MODIFIED","insertions":151,"deletions":-35},{"file":"package.json","type":"MODIFIED","insertions":15,"deletions":-9},{"file":"test/badquery.tst.js","type":"ADDED","insertions":180,"deletions":0},{"file":"test/basic.tst.js","type":"ADDED","insertions":291,"deletions":0},{"file":"test/etc/testconfig.json","type":"ADDED","insertions":12,"deletions":0},{"file":"test/helper.js","type":"ADDED","insertions":213,"deletions":0}],"sizeInsertions":941,"sizeDeletions":-57}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"},{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}]}