From c579125bdb647f8030ac0613bfd7a4b6632fe5d6 Mon Sep 17 00:00:00 2001
From: Cody Peter Mello <cody.mello@joyent.com>
Date: Fri, 15 Jun 2018 00:49:50 +0000
Subject: [PATCH] MORAY-418 Moray should queue requests when new PG connections
 fail MORAY-339 Moray needs to use exponential backoff when connecting to
 Postgres MORAY-294 Suspect Moray doesn't honor its connection limit properly
 MORAY-427 Moray queuing needs work

---
 test/helper.js  | 5 ++---
 tools/configure | 4 ++--
 2 files changed, 4 insertions(+), 5 deletions(-)

diff --git a/test/helper.js b/test/helper.js
index a9c786e..7005c2d 100644
--- a/test/helper.js
+++ b/test/helper.js
@@ -5,7 +5,7 @@
  */
 
 /*
- * Copyright (c) 2017, Joyent, Inc.
+ * Copyright (c) 2018, Joyent, Inc.
  */
 
 var assert = require('assert-plus');
@@ -161,8 +161,7 @@ function createServer(opts, cb) {
 
     pt.on('data', function (c) {
         seen += c.toString('utf8');
-        if (!ready && /moray listening on .*\d+/i.test(seen) &&
-            /manatee ready/.test(seen)) {
+        if (!ready && /moray listening on .*\d+/i.test(seen)) {
             cp.stdout.unpipe(pt);
             ready = true;
             clearTimeout(t);
diff --git a/tools/configure b/tools/configure
index 044f114..db95f10 100755
--- a/tools/configure
+++ b/tools/configure
@@ -8,7 +8,7 @@
  */
 
 /*
- * Copyright (c) 2016, Joyent, Inc.
+ * Copyright (c) 2018, Joyent, Inc.
  */
 
 /*
@@ -695,7 +695,7 @@ function readJsonFile(filename, callback)
         try {
             c = JSON.parse(contents);
         } catch (ex) {
-            callback(new VError(err, 'parse "%s"', filename));
+            callback(new VError(ex, 'parse "%s"', filename));
             return;
         }
 
-- 
2.21.0

