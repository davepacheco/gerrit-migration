{"project":"joyent/illumos-joyent","branch":"master","id":"Ifb2422a25cfeb7137e66e7a24541eafb83165362","number":"4701","subject":"OS-7141 Overlay device-creation weirdness contributes to varpd boot failures Reviewed by: Robert Mustacchi \u003crm@joyent.com\u003e Reviewed by: Jason King \u003cjbk@joyent.com\u003e Approved by: Jason King \u003cjbk@joyent.com\u003e","owner":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"url":"https://cr.joyent.us/4701","commitMessage":"OS-7141 Overlay device-creation weirdness contributes to varpd boot failures\nReviewed by: Robert Mustacchi \u003crm@joyent.com\u003e\nReviewed by: Jason King \u003cjbk@joyent.com\u003e\nApproved by: Jason King \u003cjbk@joyent.com\u003e\n","createdOn":1534450578,"lastUpdated":1535588197,"open":false,"status":"MERGED","comments":[{"timestamp":1534450578,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Uploaded patch set 1."},{"timestamp":1534450728,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Uploaded patch set 2: Patch Set 1 was rebased."},{"timestamp":1534450944,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 2: Code-Review+1"},{"timestamp":1534462877,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1534463789,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Uploaded patch set 3."},{"timestamp":1534463841,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1534464978,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1534873870,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Uploaded patch set 4: Patch Set 3 was rebased."},{"timestamp":1534873943,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Uploaded patch set 5: Commit message was updated."},{"timestamp":1534873996,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 5:\n\nCould not reproduce this bug in a stock PI over 990 reboots.  100 reboots of this fix showed no regressions, but that only partially proves this introduces no regressions.\n\nUnsure of how to proceed."},{"timestamp":1535053389,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Uploaded patch set 6: Patch Set 5 was rebased."},{"timestamp":1535121510,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Uploaded patch set 7."},{"timestamp":1535121561,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 7:\n\nForgot to remove the method script (no longer needed) from the Makefile."},{"timestamp":1535121571,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Uploaded patch set 8: Patch Set 7 was rebased."},{"timestamp":1535410974,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 8: Code-Review+1"},{"timestamp":1535420985,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 8: Code-Review+1"},{"timestamp":1535587700,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Uploaded patch set 9: Patch Set 8 was rebased."},{"timestamp":1535587924,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Uploaded patch set 10: Patch Set 9 was rebased."},{"timestamp":1535588041,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 10:\n\nTesting results already on bug report."},{"timestamp":1535588079,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 10: Integration-Approval+1"},{"timestamp":1535588161,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Uploaded patch set 11: Commit message was updated."},{"timestamp":1535588197,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Dan McDonald"}],"currentPatchSet":{"number":"11","revision":"fb2422a25cfeb7137e66e7a24541eafb83165362","parents":["6ee3a34140b2fc1881eeccb9a5037957b69e14c0"],"ref":"refs/changes/01/4701/11","uploader":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"createdOn":1535588161,"author":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1535410974,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1535420985,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1535588079,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"SUBM","value":"1","grantedOn":1535588197,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"usr/src/cmd/varpd/Makefile","type":"MODIFIED","insertions":1,"deletions":-2},{"file":"usr/src/cmd/varpd/svc-varpd","type":"DELETED","insertions":0,"deletions":-32},{"file":"usr/src/cmd/varpd/varpd.c","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"usr/src/cmd/varpd/varpd.xml","type":"MODIFIED","insertions":9,"deletions":-2}],"sizeInsertions":14,"sizeDeletions":-41},"patchSets":[{"number":"1","revision":"a8b86f899e1652de1cb909cbad8811075824253c","parents":["005d090d5d39829784302a3c8574b81b88fc69d0"],"ref":"refs/changes/01/4701/1","uploader":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"createdOn":1534450578,"author":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"usr/src/cmd/varpd/svc-varpd","type":"DELETED","insertions":0,"deletions":-32},{"file":"usr/src/cmd/varpd/varpd.c","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"usr/src/cmd/varpd/varpd.xml","type":"MODIFIED","insertions":8,"deletions":-1}],"sizeInsertions":11,"sizeDeletions":-37},{"number":"2","revision":"ce2b5bf986d67a4be714732d0200e131cdcd380f","parents":["cb8103400848d09c4fb4721a0aa7a30bc066687f"],"ref":"refs/changes/01/4701/2","uploader":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"createdOn":1534450728,"author":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1534450944,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}}],"comments":[{"file":"usr/src/cmd/varpd/varpd.c","line":13,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Missing update."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"usr/src/cmd/varpd/svc-varpd","type":"DELETED","insertions":0,"deletions":-32},{"file":"usr/src/cmd/varpd/varpd.c","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"usr/src/cmd/varpd/varpd.xml","type":"MODIFIED","insertions":8,"deletions":-1}],"sizeInsertions":11,"sizeDeletions":-37},{"number":"3","revision":"92e53a5687b1d4d2bdda34187783833fe6da24a0","parents":["cb8103400848d09c4fb4721a0aa7a30bc066687f"],"ref":"refs/changes/01/4701/3","uploader":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"createdOn":1534463789,"author":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1534464978,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1534463841,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"usr/src/cmd/varpd/svc-varpd","type":"DELETED","insertions":0,"deletions":-32},{"file":"usr/src/cmd/varpd/varpd.c","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"usr/src/cmd/varpd/varpd.xml","type":"MODIFIED","insertions":9,"deletions":-2}],"sizeInsertions":13,"sizeDeletions":-39},{"number":"4","revision":"ea869c9d7d22049a2ebd27b7afde3d50b0336344","parents":["dce88dec0a5dd9849b881d131e2c0f78a5ba4c97"],"ref":"refs/changes/01/4701/4","uploader":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"createdOn":1534873870,"author":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1534464978,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1534463841,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"usr/src/cmd/varpd/svc-varpd","type":"DELETED","insertions":0,"deletions":-32},{"file":"usr/src/cmd/varpd/varpd.c","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"usr/src/cmd/varpd/varpd.xml","type":"MODIFIED","insertions":9,"deletions":-2}],"sizeInsertions":13,"sizeDeletions":-39},{"number":"5","revision":"b0c921084cd0861f4e6899e5fbf8ce6cf1be7d03","parents":["dce88dec0a5dd9849b881d131e2c0f78a5ba4c97"],"ref":"refs/changes/01/4701/5","uploader":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"createdOn":1534873943,"author":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1534464978,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1534463841,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"usr/src/cmd/varpd/svc-varpd","type":"DELETED","insertions":0,"deletions":-32},{"file":"usr/src/cmd/varpd/varpd.c","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"usr/src/cmd/varpd/varpd.xml","type":"MODIFIED","insertions":9,"deletions":-2}],"sizeInsertions":13,"sizeDeletions":-39},{"number":"6","revision":"52d9c9e1480f2f97f828f305a73e09ea2ab6937f","parents":["e79c50557fdcaf68635086f55afd817419c78661"],"ref":"refs/changes/01/4701/6","uploader":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"createdOn":1535053389,"author":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1534464978,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1534463841,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"usr/src/cmd/varpd/svc-varpd","type":"DELETED","insertions":0,"deletions":-32},{"file":"usr/src/cmd/varpd/varpd.c","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"usr/src/cmd/varpd/varpd.xml","type":"MODIFIED","insertions":9,"deletions":-2}],"sizeInsertions":13,"sizeDeletions":-39},{"number":"7","revision":"33cf4b440af3d35348fe3528cd455e531a099338","parents":["e79c50557fdcaf68635086f55afd817419c78661"],"ref":"refs/changes/01/4701/7","uploader":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"createdOn":1535121510,"author":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"usr/src/cmd/varpd/Makefile","type":"MODIFIED","insertions":1,"deletions":-2},{"file":"usr/src/cmd/varpd/svc-varpd","type":"DELETED","insertions":0,"deletions":-32},{"file":"usr/src/cmd/varpd/varpd.c","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"usr/src/cmd/varpd/varpd.xml","type":"MODIFIED","insertions":9,"deletions":-2}],"sizeInsertions":14,"sizeDeletions":-41},{"number":"8","revision":"660708e4f1a0480bd106c0c6499abdc80b32c219","parents":["785d08b06b18bdf67463a204f82e2e8fe9a56057"],"ref":"refs/changes/01/4701/8","uploader":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"createdOn":1535121571,"author":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1535410974,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1535420985,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"usr/src/cmd/varpd/Makefile","type":"MODIFIED","insertions":1,"deletions":-2},{"file":"usr/src/cmd/varpd/svc-varpd","type":"DELETED","insertions":0,"deletions":-32},{"file":"usr/src/cmd/varpd/varpd.c","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"usr/src/cmd/varpd/varpd.xml","type":"MODIFIED","insertions":9,"deletions":-2}],"sizeInsertions":14,"sizeDeletions":-41},{"number":"9","revision":"09461b227eb1ae74c1f81ffd25cff527ac76916d","parents":["c650fcb85b0d75f9439a65bbbd134566ae69d70d"],"ref":"refs/changes/01/4701/9","uploader":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"createdOn":1535587700,"author":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1535410974,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1535420985,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"usr/src/cmd/varpd/Makefile","type":"MODIFIED","insertions":1,"deletions":-2},{"file":"usr/src/cmd/varpd/svc-varpd","type":"DELETED","insertions":0,"deletions":-32},{"file":"usr/src/cmd/varpd/varpd.c","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"usr/src/cmd/varpd/varpd.xml","type":"MODIFIED","insertions":9,"deletions":-2}],"sizeInsertions":14,"sizeDeletions":-41},{"number":"10","revision":"f398907d0197b035600fcad91c6b7a85396d3500","parents":["6ee3a34140b2fc1881eeccb9a5037957b69e14c0"],"ref":"refs/changes/01/4701/10","uploader":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"createdOn":1535587924,"author":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1535410974,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1535420985,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1535588079,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"usr/src/cmd/varpd/Makefile","type":"MODIFIED","insertions":1,"deletions":-2},{"file":"usr/src/cmd/varpd/svc-varpd","type":"DELETED","insertions":0,"deletions":-32},{"file":"usr/src/cmd/varpd/varpd.c","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"usr/src/cmd/varpd/varpd.xml","type":"MODIFIED","insertions":9,"deletions":-2}],"sizeInsertions":14,"sizeDeletions":-41},{"number":"11","revision":"fb2422a25cfeb7137e66e7a24541eafb83165362","parents":["6ee3a34140b2fc1881eeccb9a5037957b69e14c0"],"ref":"refs/changes/01/4701/11","uploader":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"createdOn":1535588161,"author":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1535410974,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1535420985,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1535588079,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"SUBM","value":"1","grantedOn":1535588197,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"usr/src/cmd/varpd/Makefile","type":"MODIFIED","insertions":1,"deletions":-2},{"file":"usr/src/cmd/varpd/svc-varpd","type":"DELETED","insertions":0,"deletions":-32},{"file":"usr/src/cmd/varpd/varpd.c","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"usr/src/cmd/varpd/varpd.xml","type":"MODIFIED","insertions":9,"deletions":-2}],"sizeInsertions":14,"sizeDeletions":-41}],"allReviewers":[{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}]}