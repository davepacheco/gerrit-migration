{"project":"joyent/illumos-joyent","branch":"master","id":"Ia20a6014d3b07e04924eb17e4c5ec736d28542e2","number":"1565","subject":"OS-5944 add support for aio IOCB_FLAG_RESFD eventfd polling Reviewed by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e Approved by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e","owner":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"url":"https://cr.joyent.us/1565","commitMessage":"OS-5944 add support for aio IOCB_FLAG_RESFD eventfd polling\nReviewed by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e\nApproved by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e\n","createdOn":1487949428,"lastUpdated":1487970493,"open":false,"status":"MERGED","comments":[{"timestamp":1487949428,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 1."},{"timestamp":1487950447,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 1:\n\n(2 comments)"},{"timestamp":1487953591,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 1:\n\n(2 comments)"},{"timestamp":1487953601,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 2."},{"timestamp":1487954702,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1487956438,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 3."},{"timestamp":1487957120,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 3:\n\n(1 comment)"},{"timestamp":1487959461,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 4."},{"timestamp":1487959744,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 4: Code-Review+1"},{"timestamp":1487966149,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 4:\n\n(1 comment)"},{"timestamp":1487967209,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 5."},{"timestamp":1487967429,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 5:\n\n(1 comment)"},{"timestamp":1487968690,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 6."},{"timestamp":1487968734,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 5:\n\n(1 comment)"},{"timestamp":1487968921,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 6: Code-Review+1"},{"timestamp":1487970023,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 6: Integration-Approval+1\n\nLooks good, pending passing test results."},{"timestamp":1487970173,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 7: Patch Set 6 was rebased."},{"timestamp":1487970249,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 8: Commit message was updated."},{"timestamp":1487970493,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Jerry Jelinek"}],"currentPatchSet":{"number":"8","revision":"a20a6014d3b07e04924eb17e4c5ec736d28542e2","parents":["012f57fdf5877c9e9059a07d4a2e1f05bb575540"],"ref":"refs/changes/65/1565/8","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1487970249,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1487968921,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1487970023,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"SUBM","value":"1","grantedOn":1487970493,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/uts/common/brand/lx/syscall/lx_aio.c","type":"MODIFIED","insertions":84,"deletions":-4}],"sizeInsertions":84,"sizeDeletions":-4},"patchSets":[{"number":"1","revision":"40e9c268be3bd26feafde51ad616fb103713e404","parents":["d995dda41781c812878c84191b0e974aacb0cad0"],"ref":"refs/changes/65/1565/1","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1487949428,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/uts/common/brand/lx/syscall/lx_aio.c","line":445,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"We\u0027ll leak the fd reference if we bail via this conditional with do_resfd set."},{"file":"usr/src/uts/common/brand/lx/syscall/lx_aio.c","line":445,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"good catch, fixed"},{"file":"usr/src/uts/common/brand/lx/syscall/lx_aio.c","line":836,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Assign this to NULL at the top of the loop and it should be happy."},{"file":"usr/src/uts/common/brand/lx/syscall/lx_aio.c","line":836,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"yes, that has the same effect as this code. changed"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/brand/lx/syscall/lx_aio.c","type":"MODIFIED","insertions":88,"deletions":-3}],"sizeInsertions":88,"sizeDeletions":-3},{"number":"2","revision":"e8754e12ce90bdf75e07fb010add098873d8e15f","parents":["d995dda41781c812878c84191b0e974aacb0cad0"],"ref":"refs/changes/65/1565/2","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1487953601,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/uts/common/brand/lx/syscall/lx_aio.c","line":195,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Nit: Shouldn\u0027t this (and lxioelem_fd for that matter) both be regular \u0027int\u0027 types?  The rest of our fd-related infrastructure seems to be typed in that manner."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/brand/lx/syscall/lx_aio.c","type":"MODIFIED","insertions":83,"deletions":-3}],"sizeInsertions":83,"sizeDeletions":-3},{"number":"3","revision":"2909953c3fb96d40594dcea6f15b120d4b71eaa9","parents":["d995dda41781c812878c84191b0e974aacb0cad0"],"ref":"refs/changes/65/1565/3","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1487956438,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/uts/common/brand/lx/syscall/lx_aio.c","line":421,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"This should probably be changed to match the struct type change."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/brand/lx/syscall/lx_aio.c","type":"MODIFIED","insertions":84,"deletions":-4}],"sizeInsertions":84,"sizeDeletions":-4},{"number":"4","revision":"6c91b68c603be3385aea9e68c5f60638db3529d4","parents":["d995dda41781c812878c84191b0e974aacb0cad0"],"ref":"refs/changes/65/1565/4","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1487959461,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1487959744,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"comments":[{"file":"usr/src/uts/common/brand/lx/syscall/lx_aio.c","line":459,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"After chatting with Jerry, we agreed that it would be wise to make this write non-blocking to avoid getting stuck up on an eventfd which was full.  The only likely situation where this occur would be malicious manipulation."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/brand/lx/syscall/lx_aio.c","type":"MODIFIED","insertions":84,"deletions":-4}],"sizeInsertions":84,"sizeDeletions":-4},{"number":"5","revision":"8706ab801598a1ee1e1ef23712883c22bc983ebd","parents":["d995dda41781c812878c84191b0e974aacb0cad0"],"ref":"refs/changes/65/1565/5","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1487967209,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/uts/common/brand/lx/syscall/lx_aio.c","line":463,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"I\u0027m not sure this is required for the ioflag argument.  The VOP_WRITE calls in write/pwrite/etc only seem to pass SYNC and APPEND related flags via this argument (all others being communicated via uio_fmode)."},{"file":"usr/src/uts/common/brand/lx/syscall/lx_aio.c","line":463,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Yeah, I am not sure it hurts anything, but I removed it."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/brand/lx/syscall/lx_aio.c","type":"MODIFIED","insertions":84,"deletions":-4}],"sizeInsertions":84,"sizeDeletions":-4},{"number":"6","revision":"cbd6a1921a0979e9e55ba1d592a7872b5ae137df","parents":["d995dda41781c812878c84191b0e974aacb0cad0"],"ref":"refs/changes/65/1565/6","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1487968690,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1487968921,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1487970023,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/brand/lx/syscall/lx_aio.c","type":"MODIFIED","insertions":84,"deletions":-4}],"sizeInsertions":84,"sizeDeletions":-4},{"number":"7","revision":"8111f10a19b8c78e8aa8a402195e83440e1dfd03","parents":["012f57fdf5877c9e9059a07d4a2e1f05bb575540"],"ref":"refs/changes/65/1565/7","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1487970173,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1487968921,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1487970023,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/brand/lx/syscall/lx_aio.c","type":"MODIFIED","insertions":84,"deletions":-4}],"sizeInsertions":84,"sizeDeletions":-4},{"number":"8","revision":"a20a6014d3b07e04924eb17e4c5ec736d28542e2","parents":["012f57fdf5877c9e9059a07d4a2e1f05bb575540"],"ref":"refs/changes/65/1565/8","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1487970249,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"SUBM","value":"1","grantedOn":1487970493,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1487968921,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1487970023,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/uts/common/brand/lx/syscall/lx_aio.c","type":"MODIFIED","insertions":84,"deletions":-4}],"sizeInsertions":84,"sizeDeletions":-4}],"allReviewers":[{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}]}