{"project":"joyent/illumos-joyent","branch":"master","id":"I47c6cb613e8a83891175f5f557440c0f075f1937","number":"500","subject":"OS-5669 want cached cpuset of active CPUs OS-5668 want _MACHDEP-free cpuset_t access Reviewed by: Robert Mustacchi \u003crm@joyent.com\u003e Reviewed by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e Approved by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e","owner":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"url":"https://cr.joyent.us/500","commitMessage":"OS-5669 want cached cpuset of active CPUs\nOS-5668 want _MACHDEP-free cpuset_t access\nReviewed by: Robert Mustacchi \u003crm@joyent.com\u003e\nReviewed by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e\nApproved by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e\n","createdOn":1474314420,"lastUpdated":1475505139,"open":false,"status":"MERGED","comments":[{"timestamp":1474314420,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 1."},{"timestamp":1474326037,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 1: Code-Review+1\n\nI looked at the preliminary webrev, this looks good to me."},{"timestamp":1474498114,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 1:\n\n(2 comments)"},{"timestamp":1474559808,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 1:\n\n(2 comments)"},{"timestamp":1474669536,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 2."},{"timestamp":1474672460,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 2: Code-Review+1\n\nThanks for making the change to make the cpuset_t opaque!"},{"timestamp":1474907057,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 2: Code-Review+1 Integration-Approval+1"},{"timestamp":1475175999,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 3: Patch Set 2 was rebased."},{"timestamp":1475178144,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 4: Commit message was updated."},{"timestamp":1475186540,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 5."},{"timestamp":1475254745,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 5: Code-Review+1"},{"timestamp":1475269594,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 5: Code-Review+1"},{"timestamp":1475269755,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 5: Integration-Approval+1"},{"timestamp":1475272205,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 6: Patch Set 5 was rebased."},{"timestamp":1475505124,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 7: Patch Set 6 was rebased."},{"timestamp":1475505139,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Patrick Mooney"}],"currentPatchSet":{"number":"7","revision":"47c6cb613e8a83891175f5f557440c0f075f1937","parents":["8edc4ddfc5e38d1552a30adcb1ee9c2a9639058b"],"ref":"refs/changes/00/500/7","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1475505124,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1475254745,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1475269594,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1475269755,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"SUBM","value":"1","grantedOn":1475505139,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"usr/src/uts/common/os/cpu.c","type":"MODIFIED","insertions":101,"deletions":-10},{"file":"usr/src/uts/common/sys/cpuvar.h","type":"MODIFIED","insertions":60,"deletions":-93}],"sizeInsertions":161,"sizeDeletions":-103},"patchSets":[{"number":"1","revision":"08607d8f0fb718f1ab129b9e1e7dea87d901c017","parents":["6a41e7224f5dce21547e07eced881016dac9e18a"],"ref":"refs/changes/00/500/1","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1474314420,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1474326037,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"comments":[{"file":"usr/src/uts/common/sys/cpuvar.h","line":412,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I worry that this is going to cause problems with smart compilers potentially. In general, when they see a fixed size, even though it has [1] and thus could extend beyond it, they start to optimize things to the point where they don\u0027t allow access beyond it.\n\nIt may be that this is fine because no callers will ever be compiled that know how to access it. Nor do I actually have a better idea of what we\u0027d do instead.\n\nMaybe we can just make it an opaque struct when _MACHDEP is not defined? Perhaps something like:\n\ntypedef struct cpuset cpuset_t"},{"file":"usr/src/uts/common/sys/cpuvar.h","line":412,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"I was a little on the fence about this one.  The primary reason that the struct isn\u0027t opaque is so that the CPUSET_* macros which aren\u0027t backed by a function would function without additional changes.  I can go the opaque route, but it will mean exposing two versions of the macros:\n\n1. The _MACHDEP savvy ones which act directly on the struct\n2. The generic ones which call into cpuset_* helper functions\n\nThey could be consolidated, but I\u0027m not sure if the function-call overhead would be too much."},{"file":"usr/src/uts/common/sys/cpuvar.h","line":623,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Is there a reason these aren\u0027t under the _KERNEL guard?"},{"file":"usr/src/uts/common/sys/cpuvar.h","line":623,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"They weren\u0027t previously.  I moved them down here so the two _KERNEL | _KMEMUSER sections could be combined."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"usr/src/uts/common/os/cpu.c","type":"MODIFIED","insertions":16,"deletions":-7},{"file":"usr/src/uts/common/sys/cpuvar.h","type":"MODIFIED","insertions":43,"deletions":-34}],"sizeInsertions":59,"sizeDeletions":-41},{"number":"2","revision":"b054f39b7856ccac75ff85d8eb48a60af10cb664","parents":["9608e4c230925bfc3f7987c1f8d43ad6e01e8f86"],"ref":"refs/changes/00/500/2","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1474669536,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1474672460,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1474907057,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1474907057,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"usr/src/uts/common/os/cpu.c","type":"MODIFIED","insertions":96,"deletions":-7},{"file":"usr/src/uts/common/sys/cpuvar.h","type":"MODIFIED","insertions":46,"deletions":-87}],"sizeInsertions":142,"sizeDeletions":-94},{"number":"3","revision":"6e09c9683c4bc1fc0bee577b81baeac5f3c9ab8b","parents":["459894ba5d4c18fb80a6c1fbc78cd9a45c835e26"],"ref":"refs/changes/00/500/3","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1475175999,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1474672460,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1474907057,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1474907057,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"usr/src/uts/common/os/cpu.c","type":"MODIFIED","insertions":96,"deletions":-7},{"file":"usr/src/uts/common/sys/cpuvar.h","type":"MODIFIED","insertions":46,"deletions":-87}],"sizeInsertions":142,"sizeDeletions":-94},{"number":"4","revision":"e886cba8ea2120560d340fd34203e6e2e85ea57f","parents":["459894ba5d4c18fb80a6c1fbc78cd9a45c835e26"],"ref":"refs/changes/00/500/4","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1475178144,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1474672460,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1474907057,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1474907057,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"usr/src/uts/common/os/cpu.c","type":"MODIFIED","insertions":96,"deletions":-7},{"file":"usr/src/uts/common/sys/cpuvar.h","type":"MODIFIED","insertions":46,"deletions":-87}],"sizeInsertions":142,"sizeDeletions":-94},{"number":"5","revision":"a2bb6d9f304f07ec03272b70a148ff9f3e483e5c","parents":["459894ba5d4c18fb80a6c1fbc78cd9a45c835e26"],"ref":"refs/changes/00/500/5","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1475186540,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1475269594,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1475254745,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1475269755,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"usr/src/uts/common/os/cpu.c","type":"MODIFIED","insertions":101,"deletions":-10},{"file":"usr/src/uts/common/sys/cpuvar.h","type":"MODIFIED","insertions":60,"deletions":-93}],"sizeInsertions":161,"sizeDeletions":-103},{"number":"6","revision":"3b0c4da4ff506740132e3f7986d44bcc4f1f44f1","parents":["855466e64239d10643963d520d889d72287f2359"],"ref":"refs/changes/00/500/6","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1475272205,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1475269594,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1475254745,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1475269755,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"usr/src/uts/common/os/cpu.c","type":"MODIFIED","insertions":101,"deletions":-10},{"file":"usr/src/uts/common/sys/cpuvar.h","type":"MODIFIED","insertions":60,"deletions":-93}],"sizeInsertions":161,"sizeDeletions":-103},{"number":"7","revision":"47c6cb613e8a83891175f5f557440c0f075f1937","parents":["8edc4ddfc5e38d1552a30adcb1ee9c2a9639058b"],"ref":"refs/changes/00/500/7","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1475505124,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1475269594,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1475254745,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1475269755,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"SUBM","value":"1","grantedOn":1475505139,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"usr/src/uts/common/os/cpu.c","type":"MODIFIED","insertions":101,"deletions":-10},{"file":"usr/src/uts/common/sys/cpuvar.h","type":"MODIFIED","insertions":60,"deletions":-93}],"sizeInsertions":161,"sizeDeletions":-103}],"allReviewers":[{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}]}