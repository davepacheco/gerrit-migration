From b38351a6882ca01a1b57dfd2bea0b2201b0c0d86 Mon Sep 17 00:00:00 2001
From: Alex Wilson <alex.wilson@joyent.com>
Date: Wed, 1 May 2019 09:33:40 +1000
Subject: [PATCH] joyent/node-zkstream#43 watches being lost in reattach, due
 to lack of `watchersDisconnected()` Reviewed by: Cody Peter Mello
 <cody.mello@joyent.com> Approved by: Cody Peter Mello <cody.mello@joyent.com>

---
 lib/zk-session.js | 1 +
 package.json      | 2 +-
 2 files changed, 2 insertions(+), 1 deletion(-)

diff --git a/lib/zk-session.js b/lib/zk-session.js
index 277cbec..774a7b0 100644
--- a/lib/zk-session.js
+++ b/lib/zk-session.js
@@ -280,6 +280,7 @@ ZKSession.prototype.state_reattaching = function (S) {
 		self.zs_sessionId = sid;
 		self.zs_passwd = pkt.passwd;
 		self.resetExpiryTimer();
+		self.watchersDisconnected();
 		S.gotoState('attached');
 	});
 
diff --git a/package.json b/package.json
index 1e4ef23..5ee4dfc 100644
--- a/package.json
+++ b/package.json
@@ -1,6 +1,6 @@
 {
   "name": "zkstream",
-  "version": "0.11.3",
+  "version": "0.11.4",
   "description": "",
   "repository": {
     "type": "git",
-- 
2.21.0

