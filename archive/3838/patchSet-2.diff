From 8e0d61021fb9b8d6ac088ea4b7499a05baab32e5 Mon Sep 17 00:00:00 2001
From: Jerry Jelinek <jerry.jelinek@joyent.com>
Date: Wed, 18 Apr 2018 16:27:31 +0000
Subject: [PATCH] OS-6898 vforked child java process in infinite segv loop

---
 usr/src/lib/brand/lx/lx_brand/common/clone.c | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/usr/src/lib/brand/lx/lx_brand/common/clone.c b/usr/src/lib/brand/lx/lx_brand/common/clone.c
index 109baf3d0a..b540d5a55e 100644
--- a/usr/src/lib/brand/lx/lx_brand/common/clone.c
+++ b/usr/src/lib/brand/lx/lx_brand/common/clone.c
@@ -556,6 +556,11 @@ lx_clone(uintptr_t p1, uintptr_t p2, uintptr_t p3, uintptr_t p4, uintptr_t p5)
 				LX_REG(&vforkuc, REG_SP) = (uintptr_t)cldstk;
 			}
 
+			/*
+			 * Re-enable signal delivery in the child process.
+			 */
+			lx_unblock_all_signals();
+
 			/*
 			 * Stop for ptrace if required.
 			 */
-- 
2.21.0

