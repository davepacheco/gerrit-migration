From e1e8918e99f14a72ae9bc784955a94b9bc201d7e Mon Sep 17 00:00:00 2001
From: Kelly McLaughlin <kelly.mclaughlin@joyent.com>
Date: Mon, 29 Jan 2018 09:56:22 -0700
Subject: [PATCH] TRITON-85 log-scan probe plugin does not work for SMF
 services that run multiple instances per zone

---
 plugins/lib/log-scan.js | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/plugins/lib/log-scan.js b/plugins/lib/log-scan.js
index db880c0..e05c95d 100644
--- a/plugins/lib/log-scan.js
+++ b/plugins/lib/log-scan.js
@@ -101,7 +101,7 @@ LogScanProbe.prototype._getPath = function (callback) {
                         'error getting SMF service path: `svcs -L %s`: %s',
                         self.smfServiceName, stderr)));
                 } else {
-                    self._pathCache = stdout.trim();
+                    self._pathCache = stdout.trim().replace(/\n/g, '\x20');
                     callback(null, self._pathCache);
                 }
             }
@@ -173,7 +173,7 @@ LogScanProbe.prototype.start = function (callback) {
             }, self.period * SECONDS);
 
             self._running = true;
-            self.tail = spawn('/usr/bin/tail', ['-1cF', path]);
+            self.tail = spawn('/usr/bin/tail', ['-1cF', '-q', path]);
             self.tail.stdout.on('data', function (chunk) {
                 if (!self._running) {
                     return;
-- 
2.21.0

