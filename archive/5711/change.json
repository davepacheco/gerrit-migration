{"project":"joyent/illumos-extra","branch":"master","topic":"OS-7604","id":"I5e7e5ec226e1b8296f26565a4286f0ff28b1e4f2","number":"5711","subject":"OS-4950 bzip2 should be built with optimizations OS-7604 -faggressive-loop-optimizations should be off everywhere Reviewed by: Robert Mustacchi \u003crm@joyent.com\u003e Approved by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e","owner":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"url":"https://cr.joyent.us/5711","commitMessage":"OS-4950 bzip2 should be built with optimizations\nOS-7604 -faggressive-loop-optimizations should be off everywhere\nReviewed by: Robert Mustacchi \u003crm@joyent.com\u003e\nApproved by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e\n","createdOn":1551786031,"lastUpdated":1552395851,"open":false,"status":"MERGED","comments":[{"timestamp":1551786031,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Uploaded patch set 1."},{"timestamp":1551786074,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Topic set to OS-7604"},{"timestamp":1551811989,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 1:\n\n(2 comments)\n\nCan you check the following other places that are manually invoking gcc:\n\n- bzip2/Makefile.com\n- binutils/Makefile (this is built before gcc, though maybe it should use GCC.host so we can pick it up instead)?"},{"timestamp":1551812772,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 1:\n\n(1 comment)\n\nI think bzip2 is OK but will double check"},{"timestamp":1551822216,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1551868254,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 1:\n\nI verified that bzip2 is correctly built with the compiler option in both 32 and 64 bit variants"},{"timestamp":1551888721,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 1:\n\n\u003e I verified that bzip2 is correctly built with the compiler option\n \u003e in both 32 and 64 bit variants\n\nWould you mind removing the generic CC in bzip2/Makefile.com? That\u0027s what caused me to think it might be incorrect."},{"timestamp":1551957159,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Uploaded patch set 2."},{"timestamp":1551985837,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 2: Code-Review+1\n\n(1 comment)"},{"timestamp":1551987292,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1551988314,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1552058357,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 2:\n\nI added testing notes to the tickets"},{"timestamp":1552316324,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 2: Integration-Approval+1"},{"timestamp":1552333839,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Uploaded patch set 3: Commit message was updated."},{"timestamp":1552333847,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 4: Patch Set 3 was rebased"},{"timestamp":1552395851,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by John Levon"}],"currentPatchSet":{"number":"4","revision":"ea62d3f86aef64ad08a10828ef66568b0b0ad753","parents":["5e30c479bc43ae6c7fd255de74e02fdc6a2314dd"],"ref":"refs/changes/11/5711/4","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1552333847,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1551985837,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1552316324,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"SUBM","value":"1","grantedOn":1552395851,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"Makefile.defs","type":"MODIFIED","insertions":12,"deletions":-1},{"file":"bzip2/Makefile","type":"MODIFIED","insertions":3,"deletions":-7},{"file":"bzip2/Makefile.com","type":"MODIFIED","insertions":3,"deletions":-20},{"file":"bzip2/makefile.build","type":"MODIFIED","insertions":1,"deletions":-4},{"file":"bzip2/makefile.build.64","type":"DELETED","insertions":0,"deletions":-32},{"file":"perl/Makefile","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"uefi-edk2/Makefile","type":"MODIFIED","insertions":2,"deletions":-3}],"sizeInsertions":22,"sizeDeletions":-68},"patchSets":[{"number":"1","revision":"cdd26867c55cf678cd10fc6593e9be193f3db2bd","parents":["89c706cd978c26eafee779870d7b0a0619d14b53"],"ref":"refs/changes/11/5711/1","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1551786031,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"REWORK","comments":[{"file":"Makefile.defs","line":51,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Since we\u0027re passing this down via the GCC macros, don\u0027t we need to add the -"},{"file":"Makefile.defs","line":72,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"If we\u0027re going down this path, don\u0027t we need to also append the following variables:\n\n* GCC.host\n* GXX.host\n\nAlso, is this assignment evaluated before the 64-bit variants of GCC.64 and GXX.64? I\u0027m not 100% certain we don\u0027t need it for them as well."},{"file":"Makefile.defs","line":72,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"So, I\u0027m honestly not quite sure what to do about the host GCC. It\u0027s probably possible to parse the version of it somehow, but we should only really be using it for early bootstrap of binutils and gcc itself. Shouldn\u0027t they be fine, in theory at least?\n\nI \"tested\" the build by essentially grepping for gcc/g++ invocations that don\u0027t have the flag set, so I think the 64-bit versions are fine."},{"file":"Makefile.defs","line":72,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Ah right, I guess we can\u0027t know about it. That\u0027s right. Sorry, I wasn\u0027t thinking through it clearly enough. I think you\u0027re probably right that at the moment, we can\u0027t do much. Maybe when we move to 2018.4-base64 and we know that the default gcc is gcc7 we can. But it\u0027s probably less important in those."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile.defs","type":"MODIFIED","insertions":12,"deletions":-1},{"file":"perl/Makefile","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"uefi-edk2/Makefile","type":"MODIFIED","insertions":2,"deletions":-3}],"sizeInsertions":15,"sizeDeletions":-5},{"number":"2","revision":"d8049cc35d4dce2545010dcb3b04934fecfa1821","parents":["89c706cd978c26eafee779870d7b0a0619d14b53"],"ref":"refs/changes/11/5711/2","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1551957159,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1551985837,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1552316324,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"comments":[{"file":"bzip2/Makefile.com","line":91,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"So, while not the best, is it still useful to have these things which refer to the bzip2 repo?"},{"file":"bzip2/Makefile.com","line":91,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"I\u0027m not sure how much value this has as written. If I were to do this I\u0027d much prefer to have a real test target, that we always run, and that validates the strap bzip2 against the one that exists on the build host?"},{"file":"bzip2/Makefile.com","line":91,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I think you\u0027re right. I doubt this has been used much either."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"Makefile.defs","type":"MODIFIED","insertions":12,"deletions":-1},{"file":"bzip2/Makefile","type":"MODIFIED","insertions":3,"deletions":-7},{"file":"bzip2/Makefile.com","type":"MODIFIED","insertions":3,"deletions":-20},{"file":"bzip2/makefile.build","type":"MODIFIED","insertions":1,"deletions":-4},{"file":"bzip2/makefile.build.64","type":"DELETED","insertions":0,"deletions":-32},{"file":"perl/Makefile","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"uefi-edk2/Makefile","type":"MODIFIED","insertions":2,"deletions":-3}],"sizeInsertions":22,"sizeDeletions":-68},{"number":"3","revision":"5e7e5ec226e1b8296f26565a4286f0ff28b1e4f2","parents":["89c706cd978c26eafee779870d7b0a0619d14b53"],"ref":"refs/changes/11/5711/3","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1552333839,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1551985837,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1552316324,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"Makefile.defs","type":"MODIFIED","insertions":12,"deletions":-1},{"file":"bzip2/Makefile","type":"MODIFIED","insertions":3,"deletions":-7},{"file":"bzip2/Makefile.com","type":"MODIFIED","insertions":3,"deletions":-20},{"file":"bzip2/makefile.build","type":"MODIFIED","insertions":1,"deletions":-4},{"file":"bzip2/makefile.build.64","type":"DELETED","insertions":0,"deletions":-32},{"file":"perl/Makefile","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"uefi-edk2/Makefile","type":"MODIFIED","insertions":2,"deletions":-3}],"sizeInsertions":22,"sizeDeletions":-68},{"number":"4","revision":"ea62d3f86aef64ad08a10828ef66568b0b0ad753","parents":["5e30c479bc43ae6c7fd255de74e02fdc6a2314dd"],"ref":"refs/changes/11/5711/4","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1552333847,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1551985837,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1552316324,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"SUBM","value":"1","grantedOn":1552395851,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"Makefile.defs","type":"MODIFIED","insertions":12,"deletions":-1},{"file":"bzip2/Makefile","type":"MODIFIED","insertions":3,"deletions":-7},{"file":"bzip2/Makefile.com","type":"MODIFIED","insertions":3,"deletions":-20},{"file":"bzip2/makefile.build","type":"MODIFIED","insertions":1,"deletions":-4},{"file":"bzip2/makefile.build.64","type":"DELETED","insertions":0,"deletions":-32},{"file":"perl/Makefile","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"uefi-edk2/Makefile","type":"MODIFIED","insertions":2,"deletions":-3}],"sizeInsertions":22,"sizeDeletions":-68}],"allReviewers":[{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}]}