{"project":"joyent/sdc-volapi","branch":"master","id":"Ie0ae10e263fe54e8ee45d814927a6111f23b8917","number":"1954","subject":"VOLAPI-48 volapi should allow creation w/o \u0027name\u0027 and generate names Reviewed by: Julien Gilli \u003cjulien.gilli@joyent.com\u003e Approved by: Julien Gilli \u003cjulien.gilli@joyent.com\u003e","owner":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"url":"https://cr.joyent.us/1954","commitMessage":"VOLAPI-48 volapi should allow creation w/o \u0027name\u0027 and generate names\nReviewed by: Julien Gilli \u003cjulien.gilli@joyent.com\u003e\nApproved by: Julien Gilli \u003cjulien.gilli@joyent.com\u003e\n","createdOn":1494873512,"lastUpdated":1494962977,"open":false,"status":"MERGED","comments":[{"timestamp":1494873512,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Uploaded patch set 1."},{"timestamp":1494873514,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit 9aa93a1a289a18eb8698d21f7a813828fa0e3757\n    \n    Have volapi generate a name when one name is \u0027\u0027 or undefined on CreateVolume"},{"timestamp":1494873546,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing-1\n\n(2 comments)\n\n\"make check\" exited with status 2"},{"timestamp":1494875161,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Uploaded patch set 2."},{"timestamp":1494875163,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit 175343f26dd8188f8fac91f63a1ff09268279266\n    \n    fix make check"},{"timestamp":1494875191,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1494903986,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 2:\n\n(3 comments)"},{"timestamp":1494949349,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 2:\n\n(3 comments)"},{"timestamp":1494950755,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Uploaded patch set 3."},{"timestamp":1494950758,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 3:\n\nNew commits:\n    \n    commit 5e928e15d6de68b06474d7d18f35585d660d6fc0\n    \n    address review comments"},{"timestamp":1494950785,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1494953723,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 3: Code-Review+1 Integration-Approval+1\n\n(1 comment)"},{"timestamp":1494962968,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Uploaded patch set 4: Commit message was updated."},{"timestamp":1494962977,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Josh Wilsdon"}],"currentPatchSet":{"number":"4","revision":"e0ae10e263fe54e8ee45d814927a6111f23b8917","parents":["12050313b08a5c336bbe42f3ef29f6adc31cf4d2"],"ref":"refs/changes/54/1954/4","uploader":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"createdOn":1494962968,"author":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1494950785,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1494953723,"by":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1494953723,"by":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}},{"type":"SUBM","value":"1","grantedOn":1494962977,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/endpoints/volumes.js","type":"MODIFIED","insertions":26,"deletions":-1},{"file":"lib/validation/volumes.js","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"test/integration/nfs-shared-volumes-creation-name-generation.test.js","type":"ADDED","insertions":122,"deletions":0},{"file":"test/runtest.common","type":"MODIFIED","insertions":10,"deletions":-2},{"file":"test/runtests","type":"MODIFIED","insertions":1,"deletions":-5}],"sizeInsertions":174,"sizeDeletions":-13},"patchSets":[{"number":"1","revision":"ec6b3245893839a83eb93d821c2d199fe25c2409","parents":["12050313b08a5c336bbe42f3ef29f6adc31cf4d2"],"ref":"refs/changes/54/1954/1","uploader":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"createdOn":1494873512,"author":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1494873546,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/validation/volumes.js","line":31,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"warning: missing semicolon"},{"file":"test/integration/nfs-shared-volumes-creation-name-generation.test.js","line":55,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"warning: variable is declared but never referenced: volumeName"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/endpoints/volumes.js","type":"MODIFIED","insertions":19,"deletions":-1},{"file":"lib/validation/volumes.js","type":"MODIFIED","insertions":16,"deletions":-5},{"file":"test/integration/nfs-shared-volumes-creation-name-generation.test.js","type":"ADDED","insertions":123,"deletions":0},{"file":"test/runtest.common","type":"MODIFIED","insertions":10,"deletions":-2},{"file":"test/runtests","type":"MODIFIED","insertions":1,"deletions":-5}],"sizeInsertions":169,"sizeDeletions":-13},{"number":"2","revision":"02583eb671650e0bb7db98c067b5b0887afa8381","parents":["12050313b08a5c336bbe42f3ef29f6adc31cf4d2"],"ref":"refs/changes/54/1954/2","uploader":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"createdOn":1494875161,"author":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1494875191,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/endpoints/volumes.js","line":265,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"nit: assert on the type of \"volumeParams\", and assert on the type of \"volumeParams.uuid\"."},{"file":"lib/endpoints/volumes.js","line":265,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"sure, makes sense."},{"file":"lib/endpoints/volumes.js","line":268,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"nit: Should we also mention that the reason we use the volume\u0027s uuid in the first part of the generated volume name is not only to get something that resembles Docker\u0027s way of generating volume names, but also so that we can lookup volumes based on their name more easily if the name was generated?\n\nDocumenting that would help someone new to the codebase understand all the motivations for that choice."},{"file":"lib/endpoints/volumes.js","line":268,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"yep. I\u0027ll do that."},{"file":"test/integration/nfs-shared-volumes-creation-name-generation.test.js","line":60,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Would it be a problem if we created a volume on the external network that we would fail to clean up? If so, should we make sure we create it on the admin network?"},{"file":"test/integration/nfs-shared-volumes-creation-name-generation.test.js","line":60,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"I was just copying from the existing tests, so if we do want to change we should also change the other tests. \n\nThat said, I\u0027m not sure it really makes a difference whether we leave orphaned VMs on the external or admin network. Neither is great. At least with this test we\u0027ll *try* to clean it up. Since these tests are not meant to run in production (you need to set the .sdc-test-no-production-data flag to run them) it seems to me like not the end of the world if we tried to cleanup and failed. I don\u0027t think we can guard against all these cases in all our tests.\n\nIf you think admin is better, I\u0027m fine changing though!"},{"file":"test/integration/nfs-shared-volumes-creation-name-generation.test.js","line":60,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Sounds good to me, I don\u0027t want you to make any change to this test."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/endpoints/volumes.js","type":"MODIFIED","insertions":19,"deletions":-1},{"file":"lib/validation/volumes.js","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"test/integration/nfs-shared-volumes-creation-name-generation.test.js","type":"ADDED","insertions":122,"deletions":0},{"file":"test/runtest.common","type":"MODIFIED","insertions":10,"deletions":-2},{"file":"test/runtests","type":"MODIFIED","insertions":1,"deletions":-5}],"sizeInsertions":167,"sizeDeletions":-13},{"number":"3","revision":"982897fdc9d6faeded64005ae7f5eebcd8c36840","parents":["12050313b08a5c336bbe42f3ef29f6adc31cf4d2"],"ref":"refs/changes/54/1954/3","uploader":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"createdOn":1494950755,"author":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1494950785,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1494953723,"by":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1494953723,"by":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/endpoints/volumes.js","type":"MODIFIED","insertions":26,"deletions":-1},{"file":"lib/validation/volumes.js","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"test/integration/nfs-shared-volumes-creation-name-generation.test.js","type":"ADDED","insertions":122,"deletions":0},{"file":"test/runtest.common","type":"MODIFIED","insertions":10,"deletions":-2},{"file":"test/runtests","type":"MODIFIED","insertions":1,"deletions":-5}],"sizeInsertions":174,"sizeDeletions":-13},{"number":"4","revision":"e0ae10e263fe54e8ee45d814927a6111f23b8917","parents":["12050313b08a5c336bbe42f3ef29f6adc31cf4d2"],"ref":"refs/changes/54/1954/4","uploader":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"createdOn":1494962968,"author":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1494950785,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"SUBM","value":"1","grantedOn":1494962977,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1494953723,"by":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1494953723,"by":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/endpoints/volumes.js","type":"MODIFIED","insertions":26,"deletions":-1},{"file":"lib/validation/volumes.js","type":"MODIFIED","insertions":15,"deletions":-5},{"file":"test/integration/nfs-shared-volumes-creation-name-generation.test.js","type":"ADDED","insertions":122,"deletions":0},{"file":"test/runtest.common","type":"MODIFIED","insertions":10,"deletions":-2},{"file":"test/runtests","type":"MODIFIED","insertions":1,"deletions":-5}],"sizeInsertions":174,"sizeDeletions":-13}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}]}