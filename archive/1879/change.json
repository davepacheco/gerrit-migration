{"project":"joyent/illumos-joyent","branch":"master","id":"Iec3c29a04661882bba8d14463cf699115a0ae61a","number":"1879","subject":"OS-6088 fix mlock errno values and remove tests from the skiplist Reviewed by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e Approved by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e","owner":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"url":"https://cr.joyent.us/1879","commitMessage":"OS-6088 fix mlock errno values and remove tests from the skiplist\nReviewed by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e\nApproved by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e\n","createdOn":1493652784,"lastUpdated":1493747027,"open":false,"status":"MERGED","comments":[{"timestamp":1493652784,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 1."},{"timestamp":1493662724,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 1:\n\n(2 comments)"},{"timestamp":1493665314,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 1:\n\n(2 comments)"},{"timestamp":1493668947,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 1:\n\n(2 comments)"},{"timestamp":1493672184,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 2."},{"timestamp":1493673305,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 2: Code-Review+1"},{"timestamp":1493734290,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 2:\n\nFor testing, I ran LTP and the memcntl tests from lx-tests. Everything passes."},{"timestamp":1493745793,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 2: Integration-Approval+1"},{"timestamp":1493746952,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 3: Patch Set 2 was rebased."},{"timestamp":1493747008,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 4: Commit message was updated."},{"timestamp":1493747027,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Jerry Jelinek"}],"currentPatchSet":{"number":"4","revision":"ec3c29a04661882bba8d14463cf699115a0ae61a","parents":["4137db003c878138f3b24f60b9dab4835ce46dd6"],"ref":"refs/changes/79/1879/4","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1493747008,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1493673305,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1493745793,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"SUBM","value":"1","grantedOn":1493747027,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/lib/brand/lx/testing/ltp_skiplist","type":"MODIFIED","insertions":0,"deletions":-3},{"file":"usr/src/uts/common/brand/lx/syscall/lx_mem.c","type":"MODIFIED","insertions":34,"deletions":-7},{"file":"usr/src/uts/common/brand/lx/syscall/lx_rlimit.c","type":"MODIFIED","insertions":5,"deletions":-6}],"sizeInsertions":39,"sizeDeletions":-16},"patchSets":[{"number":"1","revision":"cfe7934c132cc261b3b5bc159d891739ab34dd1e","parents":["3661208596c321e7fff78aa2bede68d33cf6217b"],"ref":"refs/changes/79/1879/1","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1493652784,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/uts/common/brand/lx/syscall/lx_mem.c","line":109,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"What are your thoughts of flipping this around so it\u0027s structured like the new check in mlockall?: The secpolicy check first, followed by the rlimit query, if necessary."},{"file":"usr/src/uts/common/brand/lx/syscall/lx_mem.c","line":109,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"I thought about that. The main reason I left it this way is because we also do the secpolicy check in lx_mlock_common and I didn\u0027t want to do that twice. I could remove it from that function altogether and make a separate check for the version in munlock as an alternative."},{"file":"usr/src/uts/common/brand/lx/syscall/lx_mem.c","line":109,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"It might be worth pulling it out of lx_mlock_common.  Consider the weird edge-case where a process that has dropped its IPC_LOCK privilege attempts to unlock previously-locked memory.  I\u0027m not sure what Linux would do offhand, but I suspect it would allow the memory to be unlocked."},{"file":"usr/src/uts/common/brand/lx/syscall/lx_mem.c","line":136,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Should the above mlock(2) case exempt from the kernel version check?"},{"file":"usr/src/uts/common/brand/lx/syscall/lx_mem.c","line":136,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"It is not exempt, see the check in lx_mlock_common."},{"file":"usr/src/uts/common/brand/lx/syscall/lx_mem.c","line":136,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"I should have seen that. Sorry."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/brand/lx/testing/ltp_skiplist","type":"MODIFIED","insertions":0,"deletions":-3},{"file":"usr/src/uts/common/brand/lx/syscall/lx_mem.c","type":"MODIFIED","insertions":29,"deletions":-2},{"file":"usr/src/uts/common/brand/lx/syscall/lx_rlimit.c","type":"MODIFIED","insertions":5,"deletions":-6}],"sizeInsertions":34,"sizeDeletions":-11},{"number":"2","revision":"c1189e726f78e50a4319147ed972d0f463f8efe4","parents":["3661208596c321e7fff78aa2bede68d33cf6217b"],"ref":"refs/changes/79/1879/2","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1493672184,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1493673305,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1493745793,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/brand/lx/testing/ltp_skiplist","type":"MODIFIED","insertions":0,"deletions":-3},{"file":"usr/src/uts/common/brand/lx/syscall/lx_mem.c","type":"MODIFIED","insertions":34,"deletions":-7},{"file":"usr/src/uts/common/brand/lx/syscall/lx_rlimit.c","type":"MODIFIED","insertions":5,"deletions":-6}],"sizeInsertions":39,"sizeDeletions":-16},{"number":"3","revision":"543719fba864cd48c15d43ded8068be36188ae04","parents":["4137db003c878138f3b24f60b9dab4835ce46dd6"],"ref":"refs/changes/79/1879/3","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1493746952,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1493673305,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1493745793,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/brand/lx/testing/ltp_skiplist","type":"MODIFIED","insertions":0,"deletions":-3},{"file":"usr/src/uts/common/brand/lx/syscall/lx_mem.c","type":"MODIFIED","insertions":34,"deletions":-7},{"file":"usr/src/uts/common/brand/lx/syscall/lx_rlimit.c","type":"MODIFIED","insertions":5,"deletions":-6}],"sizeInsertions":39,"sizeDeletions":-16},{"number":"4","revision":"ec3c29a04661882bba8d14463cf699115a0ae61a","parents":["4137db003c878138f3b24f60b9dab4835ce46dd6"],"ref":"refs/changes/79/1879/4","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1493747008,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"SUBM","value":"1","grantedOn":1493747027,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1493673305,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1493745793,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/lib/brand/lx/testing/ltp_skiplist","type":"MODIFIED","insertions":0,"deletions":-3},{"file":"usr/src/uts/common/brand/lx/syscall/lx_mem.c","type":"MODIFIED","insertions":34,"deletions":-7},{"file":"usr/src/uts/common/brand/lx/syscall/lx_rlimit.c","type":"MODIFIED","insertions":5,"deletions":-6}],"sizeInsertions":39,"sizeDeletions":-16}],"allReviewers":[{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}]}