{"project":"joyent/illumos-joyent","branch":"master","id":"Ib0dc80cd1eb0844b160e9e2c176e771e4f128efa","number":"4651","subject":"OS-7109 pull in Nexenta\u0027s unmap driver changes Reviewed by: Dan McDonald \u003cdanmcd@joyent.com\u003e Reviewed by: Robert Mustacchi \u003crm@joyent.com\u003e Reviewed by: Jason King \u003cjason.king@joyent.com\u003e Approved by: Dan McDonald \u003cdanmcd@joyent.com\u003e","owner":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"url":"https://cr.joyent.us/4651","commitMessage":"OS-7109 pull in Nexenta\u0027s unmap driver changes\nReviewed by: Dan McDonald \u003cdanmcd@joyent.com\u003e\nReviewed by: Robert Mustacchi \u003crm@joyent.com\u003e\nReviewed by: Jason King \u003cjason.king@joyent.com\u003e\nApproved by: Dan McDonald \u003cdanmcd@joyent.com\u003e\n","createdOn":1533674310,"lastUpdated":1535717800,"open":false,"status":"MERGED","comments":[{"timestamp":1533674310,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 1."},{"timestamp":1533674440,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 1:\n\nThis is part of Nexenta\u0027s work for trim/unmap which they tried to upstream last year, but essentially gave up on. I\u0027ve synced with them and I\u0027m going to try myself. I\u0027ve added Robert as a review since he looked at the whole thing last year, and I\u0027ve arbitrarily picked a couple of other internal reviewers. I can make cosmetic changes, but if we need something more substantial then I\u0027ll abandon this."},{"timestamp":1533675505,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 1:\n\nPlease confirm this following.  This wad includes:\n\n1.) Support in sd and ahci/sata for TRIM/UNMAP devices.\n\n2.) Modifying the existing DKIOCFREE ioctl that lived in the STMF Block Device (SBD) and generalizing it for sd and ahci/sata as well.\n\n(I notice changes in seemingly unrelated wifi driver iwn, but maybe that\u0027s because of a mismerge?)"},{"timestamp":1533675891,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 1:\n\nDan, I believe 1 \u0026 2 are correct. The iwn changes are not a mismerge, they were included in the full patch that Nexenta tried to upstream last year, but I agree that the iwn change is not relevant to the unmap support, so I\u0027ll remove it from this CR and update gerrit."},{"timestamp":1533676447,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 1:\n\n(6 comments)"},{"timestamp":1533676513,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 2."},{"timestamp":1533678327,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 1:\n\n(5 comments)"},{"timestamp":1533679217,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1533680773,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 2:\n\nGiven that this is Nexenta\u0027s code, I\u0027d like to leave it as close to what they did as we can, modulo any bugs. I fixed the TOCTOU bug in kioc_free_util.c and I added a check for num_exts \u003d\u003d 0 in there as well."},{"timestamp":1533680824,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 3."},{"timestamp":1533681724,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1533689233,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 3:\n\n(3 comments)"},{"timestamp":1533730994,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 3:\n\n(3 comments)"},{"timestamp":1533731863,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 4."},{"timestamp":1533740603,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 4: Code-Review+1"},{"timestamp":1533741174,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 4:\n\n(1 comment)\n\nOne last question:  Does ZFS exploit these primitives yet beyond its zvol presentation? I.e. Does ZFS use TRIM-on-SATA/UNMAP-on-SCSI already? Or is that a distinct next-commit?\n\nI just want *an* answer, there\u0027s no right/wrong answer."},{"timestamp":1533741606,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 4:\n\n(1 comment)\n\nZFS does not yet have support for trim in the upstream. The Nexenta work they tried to upstream last summer includes a full set of ZFS trim support, but I split out the driver changes here to make this more digestable and easier for us to upstream as the first step.  Once this is in, I\u0027ll tackle the ZFS trim side next."},{"timestamp":1533741853,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 4: Code-Review+1\n\nThank you.  Checking for testing notes, or awaiting them depending."},{"timestamp":1533741891,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 4:\n\np.s. Will gladly assist in upstreaming these as well."},{"timestamp":1534800243,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 4:\n\nI rebased this and merged in John\u0027s changes for L1TF. The primary impact is in zvol.c."},{"timestamp":1534800274,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 5."},{"timestamp":1534800812,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 5:\n\nIncremental 4..5 seems okay.  Checking whole wad again."},{"timestamp":1534801383,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 5: Code-Review+1\n\nYeah, okay.  Not much else to report I didn\u0027t already see."},{"timestamp":1534802108,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 5: Code-Review+1"},{"timestamp":1535412504,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 5:\n\n(6 comments)"},{"timestamp":1535460835,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 5:\n\n(6 comments)"},{"timestamp":1535469325,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 5:\n\n(1 comment)"},{"timestamp":1535472581,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 5:\n\n(1 comment)"},{"timestamp":1535472856,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 6."},{"timestamp":1535489526,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 6: Code-Review+1\n\nSorry I missed the mutex_exit() problem RM caught.  Code like that can generally benefit from same-line-as-break comments:\n\n     break;  /* out of DKIOCFREE */\n\nor\n\n     break;  /* out of for-loop */\n\nBut that\u0027s not your problem to fix."},{"timestamp":1535492200,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 6: Code-Review+1"},{"timestamp":1535555068,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 6:\n\nSorry for the churn on this, but I ran a clean build and hit some lint complaints due to the C99 change in dkio.h from the last round of CR. I fixed the relevant makefiles to handle that."},{"timestamp":1535555085,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 7."},{"timestamp":1535556203,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 7:\n\n(1 comment)"},{"timestamp":1535558478,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 7:\n\nI don\u0027t know. I just rebased, checked, and there still a lot of Makefiles using the style I used here, but there is also a lot using the style you\u0027re asking about, so it doesn\u0027t seem like we\u0027re actually consistent after all."},{"timestamp":1535558641,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 7:\n\nI did file OS-6970 a while back for that -- we never updated the illumos-joyent exclusive pieces after that change went into illumos-gate (just trying to verify no appreciable changes has been a bit annoying, so it hasn\u0027t gone up yet for review)."},{"timestamp":1535559382,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 7:\n\nOK, I don\u0027t want to make things worse here, so I changed over to the new style in these Makefiles and verified lint is still happy."},{"timestamp":1535559400,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 8."},{"timestamp":1535567326,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 8: Code-Review+1"},{"timestamp":1535571866,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 8: Integration-Approval+1"},{"timestamp":1535571886,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 8: Code-Review+1 -Integration-Approval\n\nOops, pushed the wrong radio button."},{"timestamp":1535580813,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 8: Code-Review+1\n\nThanks for the clean up Jerry."},{"timestamp":1535636988,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 8:\n\nI added a note about testing into the ticket"},{"timestamp":1535637538,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 8:\n\n\u003e I added a note about testing into the ticket\n\nFrom the report:  \"...until we have the corresponding zfs trim support.\"\n\nThere\u0027s no wrong answer, but when and from where is said ZFS trim (and unmap) support coming?  Are we waiting for OpenZFS?"},{"timestamp":1535639724,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 8:\n\nIt is somewhat muddy on the zfs trim support. I\u0027m going to see if I can get the Nexenta trim support integrated, but ZoL also has a different trim implementation which has not been upstreamed either, so it may take a while to work all of this out. This is why I want to split out the unmap support into a separate, less contentious change."},{"timestamp":1535640328,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 8: Integration-Approval+1\n\nShoot.  I was afraid you were gonna say something like that.  Pity I\u0027m not likely to make it out to OpenZFS this year.  That problem needs to Get Solved (TM).\n\nThank you for the answer."},{"timestamp":1535666670,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 9: Patch Set 8 was rebased."},{"timestamp":1535666830,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 10: Commit message was updated."},{"timestamp":1535717518,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 11: Patch Set 10 was rebased."},{"timestamp":1535717800,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Jerry Jelinek"}],"currentPatchSet":{"number":"11","revision":"b0dc80cd1eb0844b160e9e2c176e771e4f128efa","parents":["9b5d9abaa7ded12c3da31ba5f2c72f97a2e40fec"],"ref":"refs/changes/51/4651/11","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1535717518,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1535567326,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1535571886,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1535580813,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1535640328,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"SUBM","value":"1","grantedOn":1535717800,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"usr/src/lib/libdevid/Makefile.com","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/lib/libdiskmgt/Makefile.com","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/lib/libfdisk/Makefile.com","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/lib/libsmedia/library/Makefile.com","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/pkg/manifests/system-header.mf","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/common/Makefile.files","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/common/fs/zfs/zvol.c","type":"MODIFIED","insertions":53,"deletions":-29},{"file":"usr/src/uts/common/io/comstar/lu/stmf_sbd/sbd.c","type":"MODIFIED","insertions":15,"deletions":-11},{"file":"usr/src/uts/common/io/comstar/lu/stmf_sbd/sbd_scsi.c","type":"MODIFIED","insertions":34,"deletions":-16},{"file":"usr/src/uts/common/io/comstar/lu/stmf_sbd/stmf_sbd.h","type":"MODIFIED","insertions":4,"deletions":-2},{"file":"usr/src/uts/common/io/sata/impl/sata.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/common/io/scsi/targets/sd.c","type":"MODIFIED","insertions":395,"deletions":-2},{"file":"usr/src/uts/common/os/dkioc_free_util.c","type":"ADDED","insertions":80,"deletions":0},{"file":"usr/src/uts/common/sys/Makefile","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/sys/dkio.h","type":"MODIFIED","insertions":16,"deletions":-8},{"file":"usr/src/uts/common/sys/dkioc_free_util.h","type":"ADDED","insertions":34,"deletions":0},{"file":"usr/src/uts/common/sys/scsi/targets/sddef.h","type":"MODIFIED","insertions":40,"deletions":-2}],"sizeInsertions":691,"sizeDeletions":-73},"patchSets":[{"number":"1","revision":"3d2c10f1504beee23cbfc1129fcffd6e28486609","parents":["d3addfc9b7be14af44b3fc6ffc3941e4ad892356"],"ref":"refs/changes/51/4651/1","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1533674310,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/uts/common/fs/zfs/zvol.c","line":1930,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"This may be covered in the upcoming changes, but are there any concerns with putting each extent to free into it\u0027s on TXG?  If we fail part-way though the list of extents, do we care about the caller being able to see which succeeded and which failed?  I suspect no -- I think the operations are idempotent (or at least enough, that the caller can safely resubmit the same list on failure if desired), but wanted to ask to be sure."},{"file":"usr/src/uts/common/fs/zfs/zvol.c","line":1930,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"This seems related to a question that was posed on the illumos CR. I\u0027ll include Saso\u0027s response here:\n\nUNMAP being a destructive operation, it really doesn\u0027t matter to the caller if we executed it completely or not before failing. UNMAP is not guaranteed to be atomic either. Even if we think we executed it all, the drive might have simply thrown our commands away, or might have cached them for later processing and subsequently died.\n...\nIOW, if I as a caller get an error here, I don\u0027t care what happened to the target blocks, because the operation itself means \"please destroy this data\". Worst case, I just fix the ranges I sent to sd and ask it to trash the blocks again (on all devices I\u0027ve ever seen, repeated UNMAP of a block is a no-op)."},{"file":"usr/src/uts/common/io/comstar/lu/stmf_sbd/sbd_scsi.c","line":2624,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"If we try to pass too many extents, this will still return STMF_SAA_LBA_OUT_OF_RANGE -- is there a better error we should use?"},{"file":"usr/src/uts/common/io/comstar/lu/stmf_sbd/sbd_scsi.c","line":2624,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"I guess I\u0027d like to keep this the way Nexenta has it."},{"file":"usr/src/uts/common/io/iwn/if_iwn.c","line":22,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"All the changes to this file appear to be unrelated lint fixes.   Since we\u0027re already breaking up the work, do we even need to pull in the changes to this file?"},{"file":"usr/src/uts/common/os/dkioc_free_util.c","line":66,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Should we revalidate num_exts before returning to ensure it didn\u0027t change between the two ddi_copyin requests?  ISTR some previous vulnerabilities surrounding smbd with a similar pattern (though my memory isn\u0027t clear enough to be definitive)."},{"file":"usr/src/uts/common/os/dkioc_free_util.c","line":66,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"I think that\u0027s a good suggestion. I\u0027ll make that change."},{"file":"usr/src/uts/common/sys/dkio.h","line":528,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Does this mean the existing DKIOCFREE interface is considered private (since we\u0027re changing the ioctl)?"},{"file":"usr/src/uts/common/sys/dkio.h","line":528,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"This is a good question.  Based on the internal usage I\u0027ve seen and the fact this never came up in the illumos CR last year, it seems valid to make that assumption."},{"file":"usr/src/uts/common/sys/dkio.h","line":551,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"I know the kernel .c files assume C99, does that extend to this header file? If we can assume C99 (I think it actually works with earlier GNU extensions as well), we could just do \u0027dfl_exts[]\u0027 and simplify the size calculation."},{"file":"usr/src/uts/common/sys/dkio.h","line":551,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"This is related to a question that came up in the illumos CR last year. I\u0027ll post Saso\u0027s response here:\n\nI\u0027m all for moving past 1999. However, feel free to correct me, but don\u0027t \u0027[]\u0027 and \u0027[1]\u0027 don\u0027t mean different things in a struct? The former is a pointer, the latter an in-place array. I meant dkioc_free_list_t to be a variable-length structure with the extents placed directly in the same allocation, rather than the struct being fixed-length and pointing to another variable-length buffer of extents."},{"file":"usr/src/uts/common/sys/dkio.h","line":551,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"https://en.wikipedia.org/wiki/Flexible_array_member has more detail, but tl;dr they\u0027re almost the same -- the [1] implies at least one array member, while [] can have 0 or more trailing members, but they both imply the array follows the rest of the struct in memory.\n\nThis did lead me to notice that if num_exts \u003d\u003d 0, it could trigger some potentially undesirable behavior in terms of the sizing result (it looks like most/all usages aren\u0027t checking for that0.   The [] notation does have the advantage of  dealing with that a bit simpler -- \u0027#define DFL_SZ(num_exts) offsetof(dkio_free_list_t, dfl_exts) + (num_exts) * sizeof (dkioc_free_list_ext_t)\u0027.\n\nNot to say there aren\u0027t other ways to handle it (especially if we don\u0027t want to/can\u0027t use C99 here)."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/pkg/manifests/system-header.mf","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/common/Makefile.files","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/fs/zfs/zvol.c","type":"MODIFIED","insertions":55,"deletions":-31},{"file":"usr/src/uts/common/io/comstar/lu/stmf_sbd/sbd.c","type":"MODIFIED","insertions":19,"deletions":-13},{"file":"usr/src/uts/common/io/comstar/lu/stmf_sbd/sbd_scsi.c","type":"MODIFIED","insertions":34,"deletions":-16},{"file":"usr/src/uts/common/io/comstar/lu/stmf_sbd/stmf_sbd.h","type":"MODIFIED","insertions":4,"deletions":-2},{"file":"usr/src/uts/common/io/iwn/if_iwn.c","type":"MODIFIED","insertions":53,"deletions":-52},{"file":"usr/src/uts/common/io/sata/impl/sata.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/common/io/scsi/targets/sd.c","type":"MODIFIED","insertions":390,"deletions":-2},{"file":"usr/src/uts/common/os/dkioc_free_util.c","type":"ADDED","insertions":82,"deletions":0},{"file":"usr/src/uts/common/sys/Makefile","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/sys/dkio.h","type":"MODIFIED","insertions":27,"deletions":-8},{"file":"usr/src/uts/common/sys/dkioc_free_util.h","type":"ADDED","insertions":34,"deletions":0},{"file":"usr/src/uts/common/sys/scsi/targets/sddef.h","type":"MODIFIED","insertions":40,"deletions":-2}],"sizeInsertions":745,"sizeDeletions":-130},{"number":"2","revision":"3de8e82782247db4e4c32cd5154c5b7b624e7428","parents":["d3addfc9b7be14af44b3fc6ffc3941e4ad892356"],"ref":"refs/changes/51/4651/2","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1533676513,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/pkg/manifests/system-header.mf","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/common/Makefile.files","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/fs/zfs/zvol.c","type":"MODIFIED","insertions":55,"deletions":-31},{"file":"usr/src/uts/common/io/comstar/lu/stmf_sbd/sbd.c","type":"MODIFIED","insertions":19,"deletions":-13},{"file":"usr/src/uts/common/io/comstar/lu/stmf_sbd/sbd_scsi.c","type":"MODIFIED","insertions":34,"deletions":-16},{"file":"usr/src/uts/common/io/comstar/lu/stmf_sbd/stmf_sbd.h","type":"MODIFIED","insertions":4,"deletions":-2},{"file":"usr/src/uts/common/io/sata/impl/sata.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/common/io/scsi/targets/sd.c","type":"MODIFIED","insertions":390,"deletions":-2},{"file":"usr/src/uts/common/os/dkioc_free_util.c","type":"ADDED","insertions":82,"deletions":0},{"file":"usr/src/uts/common/sys/Makefile","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/sys/dkio.h","type":"MODIFIED","insertions":27,"deletions":-8},{"file":"usr/src/uts/common/sys/dkioc_free_util.h","type":"ADDED","insertions":34,"deletions":0},{"file":"usr/src/uts/common/sys/scsi/targets/sddef.h","type":"MODIFIED","insertions":40,"deletions":-2}],"sizeInsertions":692,"sizeDeletions":-78},{"number":"3","revision":"1767769530563aadc1dd761ddfe06936237e8fed","parents":["d3addfc9b7be14af44b3fc6ffc3941e4ad892356"],"ref":"refs/changes/51/4651/3","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1533680824,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1533681724,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}}],"comments":[{"file":"usr/src/uts/common/io/comstar/lu/stmf_sbd/sbd.c","line":3723,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"I\u0027d whine more about this (why not stick with return (VOP_IOCTL...()), but you mention something on JBK\u0027s feedback about sticking to the original diffs modulo bugs, so oh well."},{"file":"usr/src/uts/common/io/comstar/lu/stmf_sbd/sbd.c","line":3723,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"This is just cosmetic, so I\u0027ll change this"},{"file":"usr/src/uts/common/io/scsi/targets/sd.c","line":21741,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"I REALLY don\u0027t like this... it discourages running DEBUG in production.  At least have a global, off-by-default, tunable?"},{"file":"usr/src/uts/common/io/scsi/targets/sd.c","line":21741,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"I\u0027ll remove this for now."},{"file":"usr/src/uts/common/os/dkioc_free_util.c","line":70,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Okay... I wish they\u0027d been more cogent about when/when-not these were used.  Still, I\u0027m glad you got rid of \u0027em."},{"file":"usr/src/uts/common/sys/dkio.h","line":549,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"I\u0027ll need to double-check if a regular user can exploit these for fun and profit.\n\nYeah, I REALLY don\u0027t like this."},{"file":"usr/src/uts/common/sys/dkio.h","line":549,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"I agree that this seems problematic. Since nothing in the current wad is using this debugging feature, I will simply remove it for now."},{"file":"usr/src/uts/common/sys/dkio.h","line":549,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/pkg/manifests/system-header.mf","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/common/Makefile.files","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/fs/zfs/zvol.c","type":"MODIFIED","insertions":55,"deletions":-31},{"file":"usr/src/uts/common/io/comstar/lu/stmf_sbd/sbd.c","type":"MODIFIED","insertions":19,"deletions":-13},{"file":"usr/src/uts/common/io/comstar/lu/stmf_sbd/sbd_scsi.c","type":"MODIFIED","insertions":34,"deletions":-16},{"file":"usr/src/uts/common/io/comstar/lu/stmf_sbd/stmf_sbd.h","type":"MODIFIED","insertions":4,"deletions":-2},{"file":"usr/src/uts/common/io/sata/impl/sata.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/common/io/scsi/targets/sd.c","type":"MODIFIED","insertions":390,"deletions":-2},{"file":"usr/src/uts/common/os/dkioc_free_util.c","type":"ADDED","insertions":84,"deletions":0},{"file":"usr/src/uts/common/sys/Makefile","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/sys/dkio.h","type":"MODIFIED","insertions":27,"deletions":-8},{"file":"usr/src/uts/common/sys/dkioc_free_util.h","type":"ADDED","insertions":34,"deletions":0},{"file":"usr/src/uts/common/sys/scsi/targets/sddef.h","type":"MODIFIED","insertions":40,"deletions":-2}],"sizeInsertions":694,"sizeDeletions":-78},{"number":"4","revision":"f78ff57c7ad912d33601f1a1681b1c2042561252","parents":["d3addfc9b7be14af44b3fc6ffc3941e4ad892356"],"ref":"refs/changes/51/4651/4","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1533731863,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1533740603,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1533741853,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/pkg/manifests/system-header.mf","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/common/Makefile.files","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/fs/zfs/zvol.c","type":"MODIFIED","insertions":55,"deletions":-31},{"file":"usr/src/uts/common/io/comstar/lu/stmf_sbd/sbd.c","type":"MODIFIED","insertions":15,"deletions":-11},{"file":"usr/src/uts/common/io/comstar/lu/stmf_sbd/sbd_scsi.c","type":"MODIFIED","insertions":34,"deletions":-16},{"file":"usr/src/uts/common/io/comstar/lu/stmf_sbd/stmf_sbd.h","type":"MODIFIED","insertions":4,"deletions":-2},{"file":"usr/src/uts/common/io/sata/impl/sata.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/common/io/scsi/targets/sd.c","type":"MODIFIED","insertions":386,"deletions":-2},{"file":"usr/src/uts/common/os/dkioc_free_util.c","type":"ADDED","insertions":80,"deletions":0},{"file":"usr/src/uts/common/sys/Makefile","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/sys/dkio.h","type":"MODIFIED","insertions":16,"deletions":-8},{"file":"usr/src/uts/common/sys/dkioc_free_util.h","type":"ADDED","insertions":34,"deletions":0},{"file":"usr/src/uts/common/sys/scsi/targets/sddef.h","type":"MODIFIED","insertions":40,"deletions":-2}],"sizeInsertions":671,"sizeDeletions":-76},{"number":"5","revision":"fa2597379c53a47b885bfc213908d7f05d64f8a8","parents":["4a3dceb097fceefc13c4471707cd40944dd07ffb"],"ref":"refs/changes/51/4651/5","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1534800274,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1534802108,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1534801383,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}}],"comments":[{"file":"usr/src/uts/common/fs/zfs/zvol.c","line":1907,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"This doesn\u0027t look correct. If we do this and we hit the error cases below, we\u0027ll still try to exit and not hold the zfsdev_state_lock, but then do the unlock at +1992. This will be true for any of the break and non-return paths. I suspect this needs to be returned to where it was below those checks."},{"file":"usr/src/uts/common/fs/zfs/zvol.c","line":1907,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Agreed, fixed."},{"file":"usr/src/uts/common/io/scsi/targets/sd.c","line":5415,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"So, these can be reported as zero by the spec to indicate the device doesn\u0027t report it. In that case shouldn\u0027t these be set to the same value as the case where it isn\u0027t reported?"},{"file":"usr/src/uts/common/io/scsi/targets/sd.c","line":5415,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"I don\u0027t understand your comment here."},{"file":"usr/src/uts/common/io/scsi/targets/sd.c","line":5415,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Let me try again. The spec says that these values can be zero. If they\u0027re zero, that indicates that there are no limits. In which case, we should treat that like we do in the else case, which is where the limits don\u0027t exist."},{"file":"usr/src/uts/common/io/scsi/targets/sd.c","line":5415,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Done"},{"file":"usr/src/uts/common/io/scsi/targets/sd.c","line":21712,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Do we need to worry about overflow here at all? Not sure as it\u0027s two uint32_t\u0027s being multiplied."},{"file":"usr/src/uts/common/io/scsi/targets/sd.c","line":21712,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"I think this check is explicitly handling this before saving the result into a uint64, so it seems ok, but maybe you have an example of what is wrong?"},{"file":"usr/src/uts/common/io/scsi/targets/sd.c","line":21734,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"What guarantees that this check can\u0027t overflow?"},{"file":"usr/src/uts/common/io/scsi/targets/sd.c","line":21734,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Nothing that I can see. I\u0027ll add some checks for that."},{"file":"usr/src/uts/common/os/dkioc_free_util.c","line":48,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Is there any reason to zalloc this if we\u0027re going to bcopy everything?"},{"file":"usr/src/uts/common/os/dkioc_free_util.c","line":48,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Not that I can think of. Changed."},{"file":"usr/src/uts/common/sys/dkio.h","line":540,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I know there was discussion about this, but this is going to be problematic with more compilers as they\u0027re going to treat this as only having one entry. We\u0027ve seen cases where this has backfired and we likely should move this to the c99 style of []. I get that we may want to do this now. But I believe, we should at least do it sooner rather than later."},{"file":"usr/src/uts/common/sys/dkio.h","line":540,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"OK, at this point I guess there is no value in trying to stay close to what Nexenta tried to upstream last year anyway, so I\u0027ll change this."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/pkg/manifests/system-header.mf","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/common/Makefile.files","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/common/fs/zfs/zvol.c","type":"MODIFIED","insertions":55,"deletions":-31},{"file":"usr/src/uts/common/io/comstar/lu/stmf_sbd/sbd.c","type":"MODIFIED","insertions":15,"deletions":-11},{"file":"usr/src/uts/common/io/comstar/lu/stmf_sbd/sbd_scsi.c","type":"MODIFIED","insertions":34,"deletions":-16},{"file":"usr/src/uts/common/io/comstar/lu/stmf_sbd/stmf_sbd.h","type":"MODIFIED","insertions":4,"deletions":-2},{"file":"usr/src/uts/common/io/sata/impl/sata.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/common/io/scsi/targets/sd.c","type":"MODIFIED","insertions":386,"deletions":-2},{"file":"usr/src/uts/common/os/dkioc_free_util.c","type":"ADDED","insertions":80,"deletions":0},{"file":"usr/src/uts/common/sys/Makefile","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/sys/dkio.h","type":"MODIFIED","insertions":16,"deletions":-8},{"file":"usr/src/uts/common/sys/dkioc_free_util.h","type":"ADDED","insertions":34,"deletions":0},{"file":"usr/src/uts/common/sys/scsi/targets/sddef.h","type":"MODIFIED","insertions":40,"deletions":-2}],"sizeInsertions":670,"sizeDeletions":-75},{"number":"6","revision":"6e71ab60e2233f77dd2449245b6fae311d2b4902","parents":["4a3dceb097fceefc13c4471707cd40944dd07ffb"],"ref":"refs/changes/51/4651/6","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1535472856,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1535492200,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1535489526,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/pkg/manifests/system-header.mf","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/common/Makefile.files","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/common/fs/zfs/zvol.c","type":"MODIFIED","insertions":53,"deletions":-29},{"file":"usr/src/uts/common/io/comstar/lu/stmf_sbd/sbd.c","type":"MODIFIED","insertions":15,"deletions":-11},{"file":"usr/src/uts/common/io/comstar/lu/stmf_sbd/sbd_scsi.c","type":"MODIFIED","insertions":34,"deletions":-16},{"file":"usr/src/uts/common/io/comstar/lu/stmf_sbd/stmf_sbd.h","type":"MODIFIED","insertions":4,"deletions":-2},{"file":"usr/src/uts/common/io/sata/impl/sata.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/common/io/scsi/targets/sd.c","type":"MODIFIED","insertions":395,"deletions":-2},{"file":"usr/src/uts/common/os/dkioc_free_util.c","type":"ADDED","insertions":80,"deletions":0},{"file":"usr/src/uts/common/sys/Makefile","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/sys/dkio.h","type":"MODIFIED","insertions":16,"deletions":-8},{"file":"usr/src/uts/common/sys/dkioc_free_util.h","type":"ADDED","insertions":34,"deletions":0},{"file":"usr/src/uts/common/sys/scsi/targets/sddef.h","type":"MODIFIED","insertions":40,"deletions":-2}],"sizeInsertions":677,"sizeDeletions":-73},{"number":"7","revision":"59820056c9b78cd61ea776f1ea656cc1021862ae","parents":["4a3dceb097fceefc13c4471707cd40944dd07ffb"],"ref":"refs/changes/51/4651/7","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1535555085,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/lib/libdevid/Makefile.com","line":46,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Shouldn\u0027t these be using \u0027CSTD\u003d$(CSTD_GNU99)\u0027 with the integration of\n\ncommit bd0ce624be4492bab2f6c53383a40618647aba28\n        9027 Makefiles need to specify C99 mode consistently\n\n?"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/libdevid/Makefile.com","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/lib/libdiskmgt/Makefile.com","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/lib/libfdisk/Makefile.com","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/lib/libsmedia/library/Makefile.com","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/pkg/manifests/system-header.mf","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/common/Makefile.files","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/common/fs/zfs/zvol.c","type":"MODIFIED","insertions":53,"deletions":-29},{"file":"usr/src/uts/common/io/comstar/lu/stmf_sbd/sbd.c","type":"MODIFIED","insertions":15,"deletions":-11},{"file":"usr/src/uts/common/io/comstar/lu/stmf_sbd/sbd_scsi.c","type":"MODIFIED","insertions":34,"deletions":-16},{"file":"usr/src/uts/common/io/comstar/lu/stmf_sbd/stmf_sbd.h","type":"MODIFIED","insertions":4,"deletions":-2},{"file":"usr/src/uts/common/io/sata/impl/sata.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/common/io/scsi/targets/sd.c","type":"MODIFIED","insertions":395,"deletions":-2},{"file":"usr/src/uts/common/os/dkioc_free_util.c","type":"ADDED","insertions":80,"deletions":0},{"file":"usr/src/uts/common/sys/Makefile","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/sys/dkio.h","type":"MODIFIED","insertions":16,"deletions":-8},{"file":"usr/src/uts/common/sys/dkioc_free_util.h","type":"ADDED","insertions":34,"deletions":0},{"file":"usr/src/uts/common/sys/scsi/targets/sddef.h","type":"MODIFIED","insertions":40,"deletions":-2}],"sizeInsertions":695,"sizeDeletions":-73},{"number":"8","revision":"fc7a24eaffe42c36bac48eef9932ab36c90b9793","parents":["1ecb6f51f460bf7d1554e2f44731ab4f47ec97e4"],"ref":"refs/changes/51/4651/8","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1535559400,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1535580813,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1535567326,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1535571886,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1535640328,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/libdevid/Makefile.com","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/lib/libdiskmgt/Makefile.com","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/lib/libfdisk/Makefile.com","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/lib/libsmedia/library/Makefile.com","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/pkg/manifests/system-header.mf","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/common/Makefile.files","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/common/fs/zfs/zvol.c","type":"MODIFIED","insertions":53,"deletions":-29},{"file":"usr/src/uts/common/io/comstar/lu/stmf_sbd/sbd.c","type":"MODIFIED","insertions":15,"deletions":-11},{"file":"usr/src/uts/common/io/comstar/lu/stmf_sbd/sbd_scsi.c","type":"MODIFIED","insertions":34,"deletions":-16},{"file":"usr/src/uts/common/io/comstar/lu/stmf_sbd/stmf_sbd.h","type":"MODIFIED","insertions":4,"deletions":-2},{"file":"usr/src/uts/common/io/sata/impl/sata.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/common/io/scsi/targets/sd.c","type":"MODIFIED","insertions":395,"deletions":-2},{"file":"usr/src/uts/common/os/dkioc_free_util.c","type":"ADDED","insertions":80,"deletions":0},{"file":"usr/src/uts/common/sys/Makefile","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/sys/dkio.h","type":"MODIFIED","insertions":16,"deletions":-8},{"file":"usr/src/uts/common/sys/dkioc_free_util.h","type":"ADDED","insertions":34,"deletions":0},{"file":"usr/src/uts/common/sys/scsi/targets/sddef.h","type":"MODIFIED","insertions":40,"deletions":-2}],"sizeInsertions":691,"sizeDeletions":-73},{"number":"9","revision":"7019bc359ebcfb7dc6916da00800ecaf94c5ae69","parents":["6e567b7bf9c30262784d63ef8e2ad150be55b6c1"],"ref":"refs/changes/51/4651/9","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1535666670,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1535580813,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1535567326,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1535571886,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1535640328,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/libdevid/Makefile.com","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/lib/libdiskmgt/Makefile.com","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/lib/libfdisk/Makefile.com","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/lib/libsmedia/library/Makefile.com","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/pkg/manifests/system-header.mf","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/common/Makefile.files","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/common/fs/zfs/zvol.c","type":"MODIFIED","insertions":53,"deletions":-29},{"file":"usr/src/uts/common/io/comstar/lu/stmf_sbd/sbd.c","type":"MODIFIED","insertions":15,"deletions":-11},{"file":"usr/src/uts/common/io/comstar/lu/stmf_sbd/sbd_scsi.c","type":"MODIFIED","insertions":34,"deletions":-16},{"file":"usr/src/uts/common/io/comstar/lu/stmf_sbd/stmf_sbd.h","type":"MODIFIED","insertions":4,"deletions":-2},{"file":"usr/src/uts/common/io/sata/impl/sata.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/common/io/scsi/targets/sd.c","type":"MODIFIED","insertions":395,"deletions":-2},{"file":"usr/src/uts/common/os/dkioc_free_util.c","type":"ADDED","insertions":80,"deletions":0},{"file":"usr/src/uts/common/sys/Makefile","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/sys/dkio.h","type":"MODIFIED","insertions":16,"deletions":-8},{"file":"usr/src/uts/common/sys/dkioc_free_util.h","type":"ADDED","insertions":34,"deletions":0},{"file":"usr/src/uts/common/sys/scsi/targets/sddef.h","type":"MODIFIED","insertions":40,"deletions":-2}],"sizeInsertions":691,"sizeDeletions":-73},{"number":"10","revision":"440a42b0630e1a2547eccd663cbc98ba186b445a","parents":["6e567b7bf9c30262784d63ef8e2ad150be55b6c1"],"ref":"refs/changes/51/4651/10","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1535666830,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1535580813,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1535567326,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1535571886,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1535640328,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"usr/src/lib/libdevid/Makefile.com","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/lib/libdiskmgt/Makefile.com","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/lib/libfdisk/Makefile.com","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/lib/libsmedia/library/Makefile.com","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/pkg/manifests/system-header.mf","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/common/Makefile.files","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/common/fs/zfs/zvol.c","type":"MODIFIED","insertions":53,"deletions":-29},{"file":"usr/src/uts/common/io/comstar/lu/stmf_sbd/sbd.c","type":"MODIFIED","insertions":15,"deletions":-11},{"file":"usr/src/uts/common/io/comstar/lu/stmf_sbd/sbd_scsi.c","type":"MODIFIED","insertions":34,"deletions":-16},{"file":"usr/src/uts/common/io/comstar/lu/stmf_sbd/stmf_sbd.h","type":"MODIFIED","insertions":4,"deletions":-2},{"file":"usr/src/uts/common/io/sata/impl/sata.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/common/io/scsi/targets/sd.c","type":"MODIFIED","insertions":395,"deletions":-2},{"file":"usr/src/uts/common/os/dkioc_free_util.c","type":"ADDED","insertions":80,"deletions":0},{"file":"usr/src/uts/common/sys/Makefile","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/sys/dkio.h","type":"MODIFIED","insertions":16,"deletions":-8},{"file":"usr/src/uts/common/sys/dkioc_free_util.h","type":"ADDED","insertions":34,"deletions":0},{"file":"usr/src/uts/common/sys/scsi/targets/sddef.h","type":"MODIFIED","insertions":40,"deletions":-2}],"sizeInsertions":691,"sizeDeletions":-73},{"number":"11","revision":"b0dc80cd1eb0844b160e9e2c176e771e4f128efa","parents":["9b5d9abaa7ded12c3da31ba5f2c72f97a2e40fec"],"ref":"refs/changes/51/4651/11","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1535717518,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1535580813,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"SUBM","value":"1","grantedOn":1535717800,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1535567326,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1535571886,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1535640328,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"usr/src/lib/libdevid/Makefile.com","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/lib/libdiskmgt/Makefile.com","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/lib/libfdisk/Makefile.com","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/lib/libsmedia/library/Makefile.com","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/pkg/manifests/system-header.mf","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/common/Makefile.files","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/common/fs/zfs/zvol.c","type":"MODIFIED","insertions":53,"deletions":-29},{"file":"usr/src/uts/common/io/comstar/lu/stmf_sbd/sbd.c","type":"MODIFIED","insertions":15,"deletions":-11},{"file":"usr/src/uts/common/io/comstar/lu/stmf_sbd/sbd_scsi.c","type":"MODIFIED","insertions":34,"deletions":-16},{"file":"usr/src/uts/common/io/comstar/lu/stmf_sbd/stmf_sbd.h","type":"MODIFIED","insertions":4,"deletions":-2},{"file":"usr/src/uts/common/io/sata/impl/sata.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/common/io/scsi/targets/sd.c","type":"MODIFIED","insertions":395,"deletions":-2},{"file":"usr/src/uts/common/os/dkioc_free_util.c","type":"ADDED","insertions":80,"deletions":0},{"file":"usr/src/uts/common/sys/Makefile","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/sys/dkio.h","type":"MODIFIED","insertions":16,"deletions":-8},{"file":"usr/src/uts/common/sys/dkioc_free_util.h","type":"ADDED","insertions":34,"deletions":0},{"file":"usr/src/uts/common/sys/scsi/targets/sddef.h","type":"MODIFIED","insertions":40,"deletions":-2}],"sizeInsertions":691,"sizeDeletions":-73}],"allReviewers":[{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}]}