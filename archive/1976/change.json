{"project":"joyent/sdc-manta","branch":"master","id":"Iad3ee590b3374994327866a48bd80734cc02e190","number":"1976","subject":"MANTA-3274 show how to run sdc-manta \u0027make test\u0027 when developing on non-smartos","owner":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"url":"https://cr.joyent.us/1976","commitMessage":"MANTA-3274 show how to run sdc-manta \u0027make test\u0027 when developing on non-smartos\n","createdOn":1495149508,"lastUpdated":1501580786,"open":true,"status":"NEW","comments":[{"timestamp":1495149508,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Uploaded patch set 1."},{"timestamp":1495149509,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit 7feb8435c572140c265f4298efbe47496bf75dac\n    \n    rsync-to script"},{"timestamp":1495149557,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1498242752,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Uploaded patch set 2."},{"timestamp":1498242754,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit f33acb2a704e39e9acb4eb9375677aaa54b681e6\n    \n    tweaks for dev on macOS"},{"timestamp":1498250821,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1499961984,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Uploaded patch set 3: Patch Set 2 was rebased."},{"timestamp":1499961986,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 3:\n\nNew commits:\n    \n    commit 8a5baf31bd4dc34a253796f5c848d92dfd54a97c\n    \n    tweaks for dev on macOS"},{"timestamp":1499962035,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3:\n\n\"make check\" passed ok"},{"timestamp":1500042647,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"Patch Set 3:\n\nThis looks useful. It\u0027s pretty much what I do manually when working on the joyent/sdc-manta codebase.\n\nI can see we\u0027re syncing deps/, but I don\u0027t know what this would do if `make` had been run already on the MacOS machine before syncing. Would this lead to MacOS-specific binaries being synced to the manta0 zone, or does the \"--exclude build\" prevent us from deploying these build artefacts, even if they\u0027re in subdirectories?"},{"timestamp":1500055323,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 3:\n\nAh, thanks. I should get it to skip deps."},{"timestamp":1500055385,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Uploaded patch set 4."},{"timestamp":1500055386,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 4:\n\nNew commits:\n    \n    commit 6b0d8542e7d569e6d1be0d96f4e8630cc45f93b9\n    \n    skip deps, per CR feedback"},{"timestamp":1500055436,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1501518541,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Uploaded patch set 5: Patch Set 4 was rebased."},{"timestamp":1501518542,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 5:\n\nNew commits:\n    \n    commit f34cd51cdbee26e35c1374aa6a76051bb7f92758\n    \n    skip deps, per CR feedback\n    \n    commit 3e71209f5a75306fbff49e707a579b44aef28f42\n    \n    tweaks for dev on macOS"},{"timestamp":1501518583,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5:\n\n\"make check\" passed ok"},{"timestamp":1501518668,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 5:\n\n@richard: poke"},{"timestamp":1501580786,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"Patch Set 5:\n\n(3 comments)"}],"currentPatchSet":{"number":"5","revision":"ad3ee590b3374994327866a48bd80734cc02e190","parents":["47155494b7d19bc3e275e6ae7151ffc933071214"],"ref":"refs/changes/76/1976/5","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1501518541,"author":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1500055436,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"Makefile","line":66,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"I\u0027m a little ignorant on our Makefiles so some of this could quite possibly be ignored, but I\u0027ve gathered that we\u0027re setting NPM and NODE here because we\u0027re no longer letting \"Makefile.node_prebuilt.defs\" do it (because we\u0027re running on MacOS).\n\nI can see that we\u0027re not using full paths, presumably relying on the developer\u0027s PATH to find these. \"Makefile.node_prebuilt.defs\" will use full paths for these, so is relying on PATH going to be OK here?\n\nIs there anything else from \"Makefile.node_prebuilt.defs\" that we might be lacking by not including it?\n\nLastly, where do we stand on the situation where a developer could be running a different version of node and the suite passes, but it fails on the prebuilt version?"},{"file":"README.md","line":87,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"Could we do the `make prepush` here instead of doing it in step 1?\n\nAlternatively, seeing as `make prepush` is a check and test, maybe step 1 could just be to run `make check`? I understand `make check` to work on MacOS."},{"file":"tools/rsync-to","line":32,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"Nitty, but the comment here still references that \"deps/\" will be moved, but we\u0027ve added it to the exclude list."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":14,"deletions":-3},{"file":"README.md","type":"MODIFIED","insertions":21,"deletions":-2},{"file":"tools/rsync-to","type":"ADDED","insertions":40,"deletions":0}],"sizeInsertions":76,"sizeDeletions":-5},"patchSets":[{"number":"1","revision":"7cc760631132f531a791438f2b6470840d635268","parents":["b4abfc8d0002640430e9beabb19f9de6a9b13607"],"ref":"refs/changes/76/1976/1","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1495149508,"author":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1495149557,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"tools/rsync-to","type":"ADDED","insertions":39,"deletions":0}],"sizeInsertions":39,"sizeDeletions":0},{"number":"2","revision":"bf38e07f4dbc1d0511c1e0b4559f61673fa21b61","parents":["49519ba3f2d4874bde93a4504d97dbfcbe673619"],"ref":"refs/changes/76/1976/2","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1498242752,"author":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1498250821,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":14,"deletions":-3},{"file":"README.md","type":"MODIFIED","insertions":21,"deletions":-2},{"file":"tools/rsync-to","type":"ADDED","insertions":39,"deletions":0}],"sizeInsertions":75,"sizeDeletions":-5},{"number":"3","revision":"371cd77116b7f400e262e68d4946a54a4ac1036c","parents":["59e049b5c4adefe488808bb11009ea585b0c7a6a"],"ref":"refs/changes/76/1976/3","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1499961984,"author":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1498250821,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":14,"deletions":-3},{"file":"README.md","type":"MODIFIED","insertions":21,"deletions":-2},{"file":"tools/rsync-to","type":"ADDED","insertions":39,"deletions":0}],"sizeInsertions":75,"sizeDeletions":-5},{"number":"4","revision":"8af439958e0bbe453c1a68b79893dbb1ac076d4f","parents":["59e049b5c4adefe488808bb11009ea585b0c7a6a"],"ref":"refs/changes/76/1976/4","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1500055385,"author":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1500055436,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":14,"deletions":-3},{"file":"README.md","type":"MODIFIED","insertions":21,"deletions":-2},{"file":"tools/rsync-to","type":"ADDED","insertions":40,"deletions":0}],"sizeInsertions":76,"sizeDeletions":-5},{"number":"5","revision":"ad3ee590b3374994327866a48bd80734cc02e190","parents":["47155494b7d19bc3e275e6ae7151ffc933071214"],"ref":"refs/changes/76/1976/5","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1501518541,"author":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1500055436,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"Makefile","line":66,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"I\u0027m a little ignorant on our Makefiles so some of this could quite possibly be ignored, but I\u0027ve gathered that we\u0027re setting NPM and NODE here because we\u0027re no longer letting \"Makefile.node_prebuilt.defs\" do it (because we\u0027re running on MacOS).\n\nI can see that we\u0027re not using full paths, presumably relying on the developer\u0027s PATH to find these. \"Makefile.node_prebuilt.defs\" will use full paths for these, so is relying on PATH going to be OK here?\n\nIs there anything else from \"Makefile.node_prebuilt.defs\" that we might be lacking by not including it?\n\nLastly, where do we stand on the situation where a developer could be running a different version of node and the suite passes, but it fails on the prebuilt version?"},{"file":"README.md","line":87,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"Could we do the `make prepush` here instead of doing it in step 1?\n\nAlternatively, seeing as `make prepush` is a check and test, maybe step 1 could just be to run `make check`? I understand `make check` to work on MacOS."},{"file":"tools/rsync-to","line":32,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"Nitty, but the comment here still references that \"deps/\" will be moved, but we\u0027ve added it to the exclude list."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":14,"deletions":-3},{"file":"README.md","type":"MODIFIED","insertions":21,"deletions":-2},{"file":"tools/rsync-to","type":"ADDED","insertions":40,"deletions":0}],"sizeInsertions":76,"sizeDeletions":-5}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"}]}