From b06b3f2c6576a906441b6d8d7f1801c0573fd878 Mon Sep 17 00:00:00 2001
From: Jan Wyszynski <jan.wyszynski@joyent.com>
Date: Thu, 28 Feb 2019 01:11:23 +0000
Subject: [PATCH] MANTA-4137 comment about garbage-collector 'cleaned_state'
 should be clearer

---
 lib/delete_record_transformer.js | 16 +++++++++-------
 1 file changed, 9 insertions(+), 7 deletions(-)

diff --git a/lib/delete_record_transformer.js b/lib/delete_record_transformer.js
index 379b9cb..7e9187d 100644
--- a/lib/delete_record_transformer.js
+++ b/lib/delete_record_transformer.js
@@ -170,13 +170,15 @@ _process_record(record, done)
 	}
 
 	/*
-	 * In the MorayDeleteRecordCleaner, Moray#batch may fail a potentially
-	 * large group of delete operations if one of those operations is to
-	 * delete a key that doesn't exist in the delete queue. For this reason,
-	 * we must make sure that no component of the garbage-collector attempts
-	 * requests deletion of the same key twice. This shared status object
-	 * determines whether the MakoInstructionUploader has already requested
-	 * that a record for some key be removed.
+	 * The DeleteRecordTransformer emits a separate instruction for each
+	 * storage node the object referred to by the record's key is stored on.
+	 * Since the metadata record occupies a single row in the metadata tier,
+	 * we use this bit of state to ensure that the key is included in only
+	 * one batch delete.
+	 *
+	 * A Moray batch delete could fail a potentially large number of
+	 * requests if any given delete transaction fails, so not doing this
+	 * opens the collector up to potentially wasting a lot of work.
 	 */
 	var cleaned_state = {
 		cleaned: false
-- 
2.21.0

