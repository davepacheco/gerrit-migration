From 8e7ed0359bc7389167496b905867645e07da7fd2 Mon Sep 17 00:00:00 2001
From: Alex Wilson <alex.wilson@joyent.com>
Date: Tue, 16 Apr 2019 15:15:32 -0700
Subject: [PATCH] MANTA-4222 want to use "region" attribute in aperture
 conditions

---
 lib/auth.js                    | 1 +
 sapi_manifests/muskie/template | 1 +
 2 files changed, 2 insertions(+)

diff --git a/lib/auth.js b/lib/auth.js
index cca494b..0bf6b15 100644
--- a/lib/auth.js
+++ b/lib/auth.js
@@ -986,6 +986,7 @@ function gatherContext(req, res, next) {
     conditions.date = new Date(req._time);
     conditions.day = new Date(req._time);
     conditions.time = new Date(req._time);
+    conditions.region = req.config.region;
     var ip = req.headers['x-forwarded-for'];
     if (ip) {
         conditions.sourceip = ip.split(',')[0].trim();
diff --git a/sapi_manifests/muskie/template b/sapi_manifests/muskie/template
index 1d5827f..03beef2 100644
--- a/sapi_manifests/muskie/template
+++ b/sapi_manifests/muskie/template
@@ -235,6 +235,7 @@
       "clientTimeout": 120000
   },
   "datacenter": "{{DATACENTER}}",
+  "region": "{{REGION}}",
   "server_uuid": "{{auto.SERVER_UUID}}",
   "zone_uuid": "{{auto.ZONENAME}}"
 
-- 
2.21.0

