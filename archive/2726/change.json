{"project":"joyent/node-manta","branch":"master","id":"Ie96ff302dacc334bb38b6ef677565e462570d831","number":"2726","subject":"joyent/node-manta#329 Refactor all commands to use common option parsing code Reviewed by: Robert Bogart \u003cRobert.bogart@joyent.com\u003e Reviewed by: Jared Morrow \u003cjm@joyent.com\u003e","owner":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"url":"https://cr.joyent.us/2726","commitMessage":"joyent/node-manta#329 Refactor all commands to use common option parsing code\nReviewed by: Robert Bogart \u003cRobert.bogart@joyent.com\u003e\nReviewed by: Jared Morrow \u003cjm@joyent.com\u003e\n","createdOn":1507218899,"lastUpdated":1533160032,"open":false,"status":"MERGED","comments":[{"timestamp":1507218899,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Uploaded patch set 1."},{"timestamp":1507218901,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit aad8ed03648644ffbeb2123a4d58f5a983aee01d\n    \n    joyent/node-manta#329 Refactor all commands to use common option parsing code\n    Refactor the following commands to use the common options parsing code: mchattr, mchmod, mfind, minfo, mln, mmd5, mrm, mrmdir, msign"},{"timestamp":1507218927,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1531933419,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Patch Set 2: Patch Set 1 was rebased"},{"timestamp":1531933445,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2:\n\n\"make check\" passed ok"},{"timestamp":1531943710,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1531953686,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Patch Set 2:\n\nOne other thing that I just realized, and it\u0027s minor, but it looks like the copyright date needs a refresh on some of these files."},{"timestamp":1531955642,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Patch Set 2:\n\n(1 comment)\n\n\u003e One other thing that I just realized, and it\u0027s minor, but it looks\n \u003e like the copyright date needs a refresh on some of these files.\n\nNice catch, I\u0027ll update those."},{"timestamp":1531957295,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Patch Set 2: Code-Review+1\n\n(1 comment)\n\nAll in all, looks good.  Sorry it took so long to get you a review.  This thing has a birthday coming up soon. :-)"},{"timestamp":1531958413,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"Patch Set 2: Code-Review+1"},{"timestamp":1532009473,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Uploaded patch set 3."},{"timestamp":1532009474,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Patch Set 3:\n\nNew commits:\n    \n    commit 0f29c3768ae0348d426443ed5d857efed3da3e89\n    \n    Update copyright header dates"},{"timestamp":1532009501,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1532009670,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1532017447,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Patch Set 3: Code-Review+1 Integration-Approval+1\n\nLooks fine to me.  It might be worth adding  a note testing for completeness in the ticket itself.  Maybe you did and I missed that.  At any rate, fire when ready."},{"timestamp":1532362853,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Patch Set 4: Patch Set 3 was rebased"},{"timestamp":1532362880,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4:\n\n\"make check\" passed ok"},{"timestamp":1533160032,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Kelly McLaughlin"}],"currentPatchSet":{"number":"4","revision":"25baf80f684e6c9c710f04c54a6dadf55a364030","parents":["893f15c3ef61f253f02031ddc03863a8e037c118"],"ref":"refs/changes/26/2726/4","uploader":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"createdOn":1532362853,"author":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1532009501,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1532009670,"by":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1532017447,"by":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1532017447,"by":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"}},{"type":"SUBM","value":"1","grantedOn":1533160032,"by":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"bin/mchattr","type":"MODIFIED","insertions":43,"deletions":-76},{"file":"bin/mchmod","type":"MODIFIED","insertions":50,"deletions":-78},{"file":"bin/mfind","type":"MODIFIED","insertions":101,"deletions":-101},{"file":"bin/minfo","type":"MODIFIED","insertions":24,"deletions":-55},{"file":"bin/mln","type":"MODIFIED","insertions":52,"deletions":-58},{"file":"bin/mmd5","type":"MODIFIED","insertions":42,"deletions":-50},{"file":"bin/mput","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"bin/mrm","type":"MODIFIED","insertions":43,"deletions":-71},{"file":"bin/mrmdir","type":"MODIFIED","insertions":26,"deletions":-52},{"file":"bin/msign","type":"MODIFIED","insertions":83,"deletions":-88},{"file":"bin/muntar","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/index.js","type":"MODIFIED","insertions":2,"deletions":-12},{"file":"lib/options.js","type":"MODIFIED","insertions":27,"deletions":-14},{"file":"lib/utils.js","type":"MODIFIED","insertions":15,"deletions":-1}],"sizeInsertions":510,"sizeDeletions":-658},"patchSets":[{"number":"1","revision":"863e038b98b0cd3b9522a22e2d92620dcf0f2790","parents":["db26e1bc598de7e9b1fc20649f03cf9d2b4bc272"],"ref":"refs/changes/26/2726/1","uploader":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"createdOn":1507218899,"author":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1507218927,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"bin/mchattr","type":"MODIFIED","insertions":42,"deletions":-75},{"file":"bin/mchmod","type":"MODIFIED","insertions":49,"deletions":-77},{"file":"bin/mfind","type":"MODIFIED","insertions":100,"deletions":-100},{"file":"bin/minfo","type":"MODIFIED","insertions":24,"deletions":-55},{"file":"bin/mln","type":"MODIFIED","insertions":51,"deletions":-57},{"file":"bin/mmd5","type":"MODIFIED","insertions":41,"deletions":-49},{"file":"bin/mput","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"bin/mrm","type":"MODIFIED","insertions":42,"deletions":-70},{"file":"bin/mrmdir","type":"MODIFIED","insertions":26,"deletions":-52},{"file":"bin/msign","type":"MODIFIED","insertions":82,"deletions":-87},{"file":"bin/muntar","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/index.js","type":"MODIFIED","insertions":1,"deletions":-11},{"file":"lib/options.js","type":"MODIFIED","insertions":26,"deletions":-13},{"file":"lib/utils.js","type":"MODIFIED","insertions":14,"deletions":0}],"sizeInsertions":500,"sizeDeletions":-648},{"number":"2","revision":"dcb73db92fab2924300521916cdfb42bcd59cf3b","parents":["893f15c3ef61f253f02031ddc03863a8e037c118"],"ref":"refs/changes/26/2726/2","uploader":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"createdOn":1531933419,"author":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1507218927,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1531958413,"by":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1531957295,"by":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"}}],"comments":[{"file":"bin/mchattr","line":36,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"From what I\u0027ve seen, it looks like these entries are a common denominator in most of the tables, if not all.  At least with these two, their semantic meaning seems to be consistent across all of the utilities.  In light of that, would be worth factoring this in to some kind of base table?  Maybe there are others that my question applies to, but these were the most obvious to me."},{"file":"bin/mchattr","line":36,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"The DEFAULT_CLI_OPTIONS table I believe was created with this idea in mind. From what I could tell the options that are not in that table may be common, but not universal. We could maybe make another table that has some options like `header` or `group` for a subset of the utilities that use them, but my grepping shows that 11 of them use `group` whereas only 6 of them use `header`. That makes me think maybe the effort isn\u0027t worth it. What do you think?"},{"file":"bin/mchattr","line":36,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"My OCD would probably not allow me to have the scaffolding across more than one file, honestly, but I do understand where you\u0027re coming from.  I\u0027ll leave it up to you."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"bin/mchattr","type":"MODIFIED","insertions":42,"deletions":-75},{"file":"bin/mchmod","type":"MODIFIED","insertions":49,"deletions":-77},{"file":"bin/mfind","type":"MODIFIED","insertions":100,"deletions":-100},{"file":"bin/minfo","type":"MODIFIED","insertions":24,"deletions":-55},{"file":"bin/mln","type":"MODIFIED","insertions":51,"deletions":-57},{"file":"bin/mmd5","type":"MODIFIED","insertions":41,"deletions":-49},{"file":"bin/mput","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"bin/mrm","type":"MODIFIED","insertions":42,"deletions":-70},{"file":"bin/mrmdir","type":"MODIFIED","insertions":26,"deletions":-52},{"file":"bin/msign","type":"MODIFIED","insertions":82,"deletions":-87},{"file":"bin/muntar","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/index.js","type":"MODIFIED","insertions":1,"deletions":-11},{"file":"lib/options.js","type":"MODIFIED","insertions":26,"deletions":-13},{"file":"lib/utils.js","type":"MODIFIED","insertions":14,"deletions":0}],"sizeInsertions":500,"sizeDeletions":-648},{"number":"3","revision":"e96ff302dacc334bb38b6ef677565e462570d831","parents":["168056b072dac39a8b54fec8ee0a1373ce168756"],"ref":"refs/changes/26/2726/3","uploader":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"createdOn":1532009473,"author":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1532009501,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1532009670,"by":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1532017447,"by":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1532017447,"by":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"bin/mchattr","type":"MODIFIED","insertions":43,"deletions":-76},{"file":"bin/mchmod","type":"MODIFIED","insertions":50,"deletions":-78},{"file":"bin/mfind","type":"MODIFIED","insertions":101,"deletions":-101},{"file":"bin/minfo","type":"MODIFIED","insertions":24,"deletions":-55},{"file":"bin/mln","type":"MODIFIED","insertions":52,"deletions":-58},{"file":"bin/mmd5","type":"MODIFIED","insertions":42,"deletions":-50},{"file":"bin/mput","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"bin/mrm","type":"MODIFIED","insertions":43,"deletions":-71},{"file":"bin/mrmdir","type":"MODIFIED","insertions":26,"deletions":-52},{"file":"bin/msign","type":"MODIFIED","insertions":83,"deletions":-88},{"file":"bin/muntar","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/index.js","type":"MODIFIED","insertions":2,"deletions":-12},{"file":"lib/options.js","type":"MODIFIED","insertions":27,"deletions":-14},{"file":"lib/utils.js","type":"MODIFIED","insertions":15,"deletions":-1}],"sizeInsertions":510,"sizeDeletions":-658},{"number":"4","revision":"25baf80f684e6c9c710f04c54a6dadf55a364030","parents":["893f15c3ef61f253f02031ddc03863a8e037c118"],"ref":"refs/changes/26/2726/4","uploader":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"createdOn":1532362853,"author":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1532009501,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1532009670,"by":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"}},{"type":"SUBM","value":"1","grantedOn":1533160032,"by":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1532017447,"by":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1532017447,"by":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"bin/mchattr","type":"MODIFIED","insertions":43,"deletions":-76},{"file":"bin/mchmod","type":"MODIFIED","insertions":50,"deletions":-78},{"file":"bin/mfind","type":"MODIFIED","insertions":101,"deletions":-101},{"file":"bin/minfo","type":"MODIFIED","insertions":24,"deletions":-55},{"file":"bin/mln","type":"MODIFIED","insertions":52,"deletions":-58},{"file":"bin/mmd5","type":"MODIFIED","insertions":42,"deletions":-50},{"file":"bin/mput","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"bin/mrm","type":"MODIFIED","insertions":43,"deletions":-71},{"file":"bin/mrmdir","type":"MODIFIED","insertions":26,"deletions":-52},{"file":"bin/msign","type":"MODIFIED","insertions":83,"deletions":-88},{"file":"bin/muntar","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/index.js","type":"MODIFIED","insertions":2,"deletions":-12},{"file":"lib/options.js","type":"MODIFIED","insertions":27,"deletions":-14},{"file":"lib/utils.js","type":"MODIFIED","insertions":15,"deletions":-1}],"sizeInsertions":510,"sizeDeletions":-658}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"}]}