From da60bfe8804af4d2d9578dd4479fd9e844956012 Mon Sep 17 00:00:00 2001
From: Bryan Cantrill <bryan@joyent.com>
Date: Sat, 24 Mar 2018 04:13:43 +0000
Subject: [PATCH] OS-6798 viona_recv_merged() can corrupt used ring Reviewed
 by: Patrick Mooney <patrick.mooney@joyent.com> Approved by: Patrick Mooney
 <patrick.mooney@joyent.com>

---
 usr/src/uts/i86pc/io/viona/viona.c | 1 +
 1 file changed, 1 insertion(+)

diff --git a/usr/src/uts/i86pc/io/viona/viona.c b/usr/src/uts/i86pc/io/viona/viona.c
index 359f814265..db5f46ae75 100644
--- a/usr/src/uts/i86pc/io/viona/viona.c
+++ b/usr/src/uts/i86pc/io/viona/viona.c
@@ -1670,6 +1670,7 @@ viona_recv_merged(viona_vring_t *ring, const mblk_t *mp, size_t msz)
 				 * drop the packet.
 				 */
 				err = EMSGSIZE;
+				break;
 			}
 			chunk = 0;
 			i = 0;
-- 
2.21.0

