{"project":"joyent/illumos-joyent","branch":"master","id":"I46ccc9cbd93a0e61bba5c20cd79b8503dfe0a32e","number":"2729","subject":"OS-5074 want nvlist_print_json_pretty","owner":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"url":"https://cr.joyent.us/2729","commitMessage":"OS-5074 want nvlist_print_json_pretty\n","createdOn":1507223179,"lastUpdated":1507737213,"open":true,"status":"NEW","comments":[{"timestamp":1507223179,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Uploaded patch set 1."},{"timestamp":1507223182,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit 9ea869da475ca76c78ef7b601a8d8b97deca1d5b\n    \n    initial commit"},{"timestamp":1507226295,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Patch Set 1:\n\n(10 comments)"},{"timestamp":1507229101,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 1:\n\n(6 comments)\n\nThanks for the review!"},{"timestamp":1507229118,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Uploaded patch set 2."},{"timestamp":1507229125,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit 9550390c8026dac698fd3e917bfa0c8b02796d9a\n    \n    changes based on joshc review"},{"timestamp":1507737213,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 2:\n\nParking this CR for now until a functional consumer is in place for this interface."}],"currentPatchSet":{"number":"2","revision":"46ccc9cbd93a0e61bba5c20cd79b8503dfe0a32e","parents":["3df01e00bc5ef3f882d18e8188e4165831f8b694"],"ref":"refs/changes/29/2729/2","uploader":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"createdOn":1507229118,"author":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/libnvpair/libnvpair.h","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/lib/libnvpair/mapfile-vers","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/lib/libnvpair/nvpair_json.c","type":"MODIFIED","insertions":238,"deletions":-128},{"file":"usr/src/test/util-tests/tests/libnvpair_json/json_09_pretty.ksh","type":"ADDED","insertions":34,"deletions":0},{"file":"usr/src/test/util-tests/tests/libnvpair_json/print_json.c","type":"MODIFIED","insertions":17,"deletions":-4}],"sizeInsertions":295,"sizeDeletions":-134},"patchSets":[{"number":"1","revision":"8f8975e7b40e4531b8dbf3a143eefdc3c83c5e0f","parents":["3df01e00bc5ef3f882d18e8188e4165831f8b694"],"ref":"refs/changes/29/2729/1","uploader":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"createdOn":1507223179,"author":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/lib/libnvpair/libnvpair.h","line":23,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"as per eng.git:\n\n    Copyright (c) 2017, Joyent, Inc."},{"file":"usr/src/lib/libnvpair/libnvpair.h","line":23,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Ah great.  I\u0027ll use this format for all of my changes going forward, thanks."},{"file":"usr/src/lib/libnvpair/mapfile-vers","line":24,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"as per eng.git:\n\n    Copyright (c) 2017, Joyent, Inc."},{"file":"usr/src/lib/libnvpair/nvpair_json.c","line":12,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"as per eng.git:\n\n    Copyright (c) 2017, Joyent, Inc."},{"file":"usr/src/lib/libnvpair/nvpair_json.c","line":32,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"I think this might be better spelt \"FPRINTF_JSON_ARRAY()\"."},{"file":"usr/src/lib/libnvpair/nvpair_json.c","line":32,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Agreed."},{"file":"usr/src/lib/libnvpair/nvpair_json.c","line":42,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"I think it would be best to pass in \"level\", rather than leak it in from the containing scope?"},{"file":"usr/src/lib/libnvpair/nvpair_json.c","line":42,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Ah, good catch. I agree - this was something I must have overlooked."},{"file":"usr/src/lib/libnvpair/nvpair_json.c","line":315,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Why did you restructure this to use the intermediate function rather than use the FPRINTF() macro directly?"},{"file":"usr/src/lib/libnvpair/nvpair_json.c","line":315,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"For DATA_TYPE_STRING specifically, it is already using nvlist_print_json_string - I haven\u0027t changed that.\n\nHowever, for the other types below (such as DATA_TYPE_BOOLEAN directly below this case) I\u0027ve refactored it to use nvlist_print_json_boolean_value.  My thinking was that the same function used to print a single value would be used to print the values inside an array.  That way, anytime a (for example) string is printed, it will always use nvlist_print_json_string, or anytime a byte is printed, it will always use nvlist_print_json_byte, etc. regardless of if the value was printed as a singular value, or as part of an array of values."},{"file":"usr/src/test/util-tests/tests/libnvpair_json/json_09_pretty.ksh","line":14,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Should match \"eng.git\" template; i.e.\n\n    Copyright (c) 2017, Joyent, Inc."},{"file":"usr/src/test/util-tests/tests/libnvpair_json/json_09_pretty.ksh","line":24,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"I think this was specifically for \"json_05_strings.ksh\", and shouldn\u0027t be here."},{"file":"usr/src/test/util-tests/tests/libnvpair_json/json_09_pretty.ksh","line":24,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Done"},{"file":"usr/src/test/util-tests/tests/libnvpair_json/print_json.c","line":13,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"as per eng.git:\n\n    Copyright (c) 2017, Joyent, Inc."},{"file":"usr/src/test/util-tests/tests/libnvpair_json/print_json.c","line":830,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Please put braces around the arms of an \"if\" statement with a multi-line expression; i.e.,\n\n    if (nvlist.... ||\n        fprintf(stdout, ...) {\n            goto out;\n    }"},{"file":"usr/src/test/util-tests/tests/libnvpair_json/print_json.c","line":830,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/libnvpair/libnvpair.h","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/lib/libnvpair/mapfile-vers","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/lib/libnvpair/nvpair_json.c","type":"MODIFIED","insertions":236,"deletions":-128},{"file":"usr/src/test/util-tests/tests/libnvpair_json/json_09_pretty.ksh","type":"ADDED","insertions":40,"deletions":0},{"file":"usr/src/test/util-tests/tests/libnvpair_json/print_json.c","type":"MODIFIED","insertions":16,"deletions":-4}],"sizeInsertions":298,"sizeDeletions":-134},{"number":"2","revision":"46ccc9cbd93a0e61bba5c20cd79b8503dfe0a32e","parents":["3df01e00bc5ef3f882d18e8188e4165831f8b694"],"ref":"refs/changes/29/2729/2","uploader":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"createdOn":1507229118,"author":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/libnvpair/libnvpair.h","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/lib/libnvpair/mapfile-vers","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/lib/libnvpair/nvpair_json.c","type":"MODIFIED","insertions":238,"deletions":-128},{"file":"usr/src/test/util-tests/tests/libnvpair_json/json_09_pretty.ksh","type":"ADDED","insertions":34,"deletions":0},{"file":"usr/src/test/util-tests/tests/libnvpair_json/print_json.c","type":"MODIFIED","insertions":17,"deletions":-4}],"sizeInsertions":295,"sizeDeletions":-134}],"allReviewers":[{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"}]}