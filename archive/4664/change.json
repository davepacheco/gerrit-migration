{"project":"joyent/illumos-joyent","branch":"master","id":"I005cc876fb1e7211c23cf918c67e361c16a5da75","number":"4664","subject":"OS-7116 bhyve brand should accept bios and uefi values for bootrom","owner":{"name":"Jorge Schrauwen","email":"sjorge@blackdot.be","username":"sjorge"},"url":"https://cr.joyent.us/4664","commitMessage":"OS-7116 bhyve brand should accept bios and uefi values for bootrom\n","createdOn":1534002691,"lastUpdated":1534200326,"open":false,"status":"MERGED","comments":[{"timestamp":1534002691,"reviewer":{"name":"Jorge Schrauwen","email":"sjorge@blackdot.be","username":"sjorge"},"message":"Uploaded patch set 1."},{"timestamp":1534002881,"reviewer":{"name":"Jorge Schrauwen","email":"sjorge@blackdot.be","username":"sjorge"},"message":"Uploaded patch set 2."},{"timestamp":1534003280,"reviewer":{"name":"Jorge Schrauwen","email":"sjorge@blackdot.be","username":"sjorge"},"message":"Patch Set 2:\n\nA tiny bit of background, I did this when I did the first part of https://github.com/joyent/smartos-live/issues/784 which already got merged a while ago. As I am still new to C I did the 2nd part for myself because it was fun. I saw OS-7116 and dug up the patch I made. So submitting it as the work is already done."},{"timestamp":1534167963,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 2:\n\n(2 comments)\n\nThanks for picking this up.  I have two comments that also apply to the other if statement you added."},{"timestamp":1534168955,"reviewer":{"name":"Jorge Schrauwen","email":"sjorge@blackdot.be","username":"sjorge"},"message":"Patch Set 2:\n\n(2 comments)"},{"timestamp":1534168967,"reviewer":{"name":"Jorge Schrauwen","email":"sjorge@blackdot.be","username":"sjorge"},"message":"Uploaded patch set 3."},{"timestamp":1534173588,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1534173834,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1534180285,"reviewer":{"name":"Jorge Schrauwen","email":"sjorge@blackdot.be","username":"sjorge"},"message":"Patch Set 3:\n\nTest results: https://gist.github.com/sjorge/0953dd5bbacf1f66d9de18487a8eedac\n\nNOTE: booting with UEFI failed because the uefi bootrom is not yet present on the requested location. (I had a look at illumos-extra but could not figure out how to build and ship both.)"},{"timestamp":1534198882,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 3: Integration-Approval+1"},{"timestamp":1534200292,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 4: Patch Set 3 was rebased"},{"timestamp":1534200326,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Mike Gerdts"}],"currentPatchSet":{"number":"4","revision":"b50884db8d84f652919a0d7b6fd6dd3d28fb035e","parents":["520fa152dc874dcf38e4285b33b63345deb3c905"],"ref":"refs/changes/64/4664/4","uploader":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"createdOn":1534200292,"author":{"name":"Jorge Schrauwen","email":"sjorge@blackdot.be","username":"sjorge"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1534173588,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1534173834,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1534198882,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}},{"type":"SUBM","value":"1","grantedOn":1534200326,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/brand/bhyve/zone/boot.c","type":"MODIFIED","insertions":8,"deletions":-2}],"sizeInsertions":8,"sizeDeletions":-2},"patchSets":[{"number":"1","revision":"f557f0d3f085067668a8284b544a433d970be249","parents":["185a422e63f55e51465370d497ca1c1a13366df4"],"ref":"refs/changes/64/4664/1","uploader":{"name":"Jorge Schrauwen","email":"sjorge@blackdot.be","username":"sjorge"},"createdOn":1534002691,"author":{"name":"Jorge Schrauwen","email":"sjorge@blackdot.be","username":"sjorge"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/brand/bhyve/zone/boot.c","type":"MODIFIED","insertions":8,"deletions":-2}],"sizeInsertions":8,"sizeDeletions":-2},{"number":"2","revision":"694fc7727f5e908a969275251414d7e523c74812","parents":["185a422e63f55e51465370d497ca1c1a13366df4"],"ref":"refs/changes/64/4664/2","uploader":{"name":"Jorge Schrauwen","email":"sjorge@blackdot.be","username":"sjorge"},"createdOn":1534002881,"author":{"name":"Jorge Schrauwen","email":"sjorge@blackdot.be","username":"sjorge"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/lib/brand/bhyve/zone/boot.c","line":423,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"We already have val, and is_env_string() is not particularly lightweight.  Instead:\n\nif (strcmp(val, \"bios\") \u003d\u003d 0)\n\nIMHO, this is easier to understand as well."},{"file":"usr/src/lib/brand/bhyve/zone/boot.c","line":423,"reviewer":{"name":"Jorge Schrauwen","email":"sjorge@blackdot.be","username":"sjorge"},"message":"Should we perhaps use strcasecmp() of strcmp()? I noticed that one when reading the man page for strcmp. That way we also catch BIOS and UEFI as wel as bios and uefi ?"},{"file":"usr/src/lib/brand/bhyve/zone/boot.c","line":424,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"val points to a buffer that may be 5 characters long, holding \"bios\\0\".  This writes a much longer string to that space.  This probably causes some other environment variable to be clobbered or writes into some other memory it shouldn\u0027t be writing into.  Instead:\n\nval \u003d DEFAULT_BOOTROM_CSM;"},{"file":"usr/src/lib/brand/bhyve/zone/boot.c","line":424,"reviewer":{"name":"Jorge Schrauwen","email":"sjorge@blackdot.be","username":"sjorge"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/brand/bhyve/zone/boot.c","type":"MODIFIED","insertions":8,"deletions":-2}],"sizeInsertions":8,"sizeDeletions":-2},{"number":"3","revision":"005cc876fb1e7211c23cf918c67e361c16a5da75","parents":["185a422e63f55e51465370d497ca1c1a13366df4"],"ref":"refs/changes/64/4664/3","uploader":{"name":"Jorge Schrauwen","email":"sjorge@blackdot.be","username":"sjorge"},"createdOn":1534168967,"author":{"name":"Jorge Schrauwen","email":"sjorge@blackdot.be","username":"sjorge"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1534173588,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1534173834,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1534198882,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/brand/bhyve/zone/boot.c","type":"MODIFIED","insertions":8,"deletions":-2}],"sizeInsertions":8,"sizeDeletions":-2},{"number":"4","revision":"b50884db8d84f652919a0d7b6fd6dd3d28fb035e","parents":["520fa152dc874dcf38e4285b33b63345deb3c905"],"ref":"refs/changes/64/4664/4","uploader":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"createdOn":1534200292,"author":{"name":"Jorge Schrauwen","email":"sjorge@blackdot.be","username":"sjorge"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1534173588,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}},{"type":"SUBM","value":"1","grantedOn":1534200326,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1534173834,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1534198882,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/brand/bhyve/zone/boot.c","type":"MODIFIED","insertions":8,"deletions":-2}],"sizeInsertions":8,"sizeDeletions":-2}],"allReviewers":[{"name":"Jorge Schrauwen","email":"sjorge@blackdot.be","username":"sjorge"},{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}]}