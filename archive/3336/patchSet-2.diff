commit 1b23a1c6b6660ba7dc9ce80ea5ef672572f01ec3 (refs/changes/36/3336/2)
Author: Cody Peter Mello <cody.mello@joyent.com>
Date:   2018-02-08T23:30:18+00:00 (1 year, 8 months ago)
    
    TRITON-74 Update railroad diagrams in firewall rule language documentation

diff --git a/.npmignore b/.npmignore
index eadfdbb..5899c2e 100644
--- a/.npmignore
+++ b/.npmignore
@@ -3,7 +3,6 @@
 /Makefile
 /coverage
 /deps
-/etc
 /src
 /test
 /tools
diff --git a/Makefile b/Makefile
index b2811fd..84fc01e 100644
--- a/Makefile
+++ b/Makefile
@@ -94,7 +94,7 @@ docs/examples.md: docs/examples.md.in
 	$(RAMSEY) -d etc/examples -f etc/examples.json docs/examples.md.in $@
 
 docs/rules.md: docs/rules.md.in
-	$(RAMSEY) -p wrap=0 docs/rules.md.in $@
+	$(RAMSEY) -f etc/rules.json -p wrap=0 docs/rules.md.in $@
 
 #
 # This rule enables other rules that use files from a git submodule to have
diff --git a/docs/fwrules.ebnf b/docs/fwrules.ebnf
index 77360ad..284625b 100644
--- a/docs/fwrules.ebnf
+++ b/docs/fwrules.ebnf
@@ -1,37 +1,28 @@
-
-/* 
-    Converted from https://mo.joyent.com/fwrule/raw/master/src/fwrule.jison
-    with http://bottlecaps.de/convert/ 
-    then elided for simplicity
-    then generated with http://bottlecaps.de/rr/ui
- */ 
-
-/* converted on Mon Dec 16, 2013, 20:22 (UTC-05) by jison-to-w3c v0.33.722 which is Copyright (c) 2011-2013 by Gunther Rademacher <grd@gmx.net> */
-
-rule     ::= 'FROM' target_list 'TO' target_list action protocol 
-target_list
-         ::= 'ANY'
-           | 'ALL VMS'
-           | '(' target ( 'OR' target )* ')'
-           | target
-target   ::= 'IP ADDRESS'
-           | 'SUBNET'
-           | 'TAG' tag_string
-           | 'TAG' tag_string '=' tag_value
-           | 'VM' uuid
-action   ::= 'BLOCK'
-           | 'ALLOW'
-protocol ::= 'TCP' port_list
-           | 'UDP' port_list
-           | 'ICMP' type_list
-port_list
-         ::= '(' port ( 'AND' port )* ')'
-           | port
-           | '(' 'PORT ALL' ')'
-           | 'PORT ALL'
-port     ::= 'PORT' '1 - 65535'
-type_list
-         ::= '(' type ( 'AND' type )* ')'
-           | type
-type     ::= 'TYPE' '0 - 255' 'CODE' '0 - 255'
-           | 'TYPE' '0 - 255'
+rule        ::= 'FROM' target_list 'TO' target_list action protocol
+target_list ::= 'ANY'
+              | 'ALL VMS'
+              | '(' target ( 'OR' target )* ')'
+              | target
+target      ::= 'IP' address
+              | 'SUBNET' cidr
+              | 'TAG' tag_string
+              | 'TAG' tag_string '=' tag_value
+              | 'VM' uuid
+action      ::= 'BLOCK'
+              | 'ALLOW'
+protocol    ::= 'TCP' port_list
+              | 'UDP' port_list
+              | 'ICMP' type_list
+              | 'ICMP6' type_list
+port_list   ::= '(' port ( 'AND' port )* ')'
+              | port
+              | 'PORTS' portrange ( ',' portrange )*
+              | 'PORT ALL'
+portnumber  ::= '1 - 65535'
+port        ::= 'PORT' portnumber
+portrange   ::= portnumber
+              | portnumber '-' portnumber
+type_list   ::= '(' type ( 'AND' type )* ')'
+              | type
+type        ::= 'TYPE' '0 - 255' ( 'CODE' '0 - 255' )?
+              | 'TYPE ALL'
diff --git a/docs/fwrules.xhtml b/docs/fwrules.xhtml
deleted file mode 100644
index b4c573e..0000000
--- a/docs/fwrules.xhtml
+++ /dev/null
@@ -1,419 +0,0 @@
-
-<!DOCTYPE html
-  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
-<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" /><meta name="generator" content="Railroad Diagram Generator 1.31.721" /><style type="text/css" xml:space="preserve">
-    ::-moz-selection
-    {
-      color: #FFFAF0;
-      background: #0F0A00;
-    }
-    ::selection
-    {
-      color: #FFFAF0;
-      background: #0F0A00;
-    }      
-    .ebnf a
-    {
-      text-decoration: none;
-    }
-    .ebnf a:hover
-    {
-      color: #050300;
-      text-decoration: underline;
-    }    
-    .signature
-    {
-      color: #805500;
-      font-size: 11px;
-      text-align: right;
-    }
-    body
-    {
-      font: normal 12px Verdana, sans-serif;
-      color: #0F0A00;
-      background: #FFFAF0;
-    }
-    a:link, a:visited
-    {
-      color: #0F0A00;
-    }
-    a:link.signature, a:visited.signature
-    {
-      color: #805500;
-    }
-    a.button, #tabs li a
-    {
-      padding: 0.25em 0.5em;
-      border: 1px solid #805500;
-      background: #F1E2C6;
-      color: #805500;
-      text-decoration: none;
-      font-weight: bold;
-    }
-    a.button:hover, #tabs li a:hover
-    {
-      color: #050300;
-      background: #FFF0D1;
-      border-color: #050300;       
-    }     
-    #tabs
-    {
-      padding: 3px 10px;
-      margin-left: 0;
-      margin-top: 58px;
-      border-bottom: 1px solid #0F0A00;
-    }  
-    #tabs li
-    {
-      list-style: none;
-      margin-left: 5px;
-      display: inline;
-    }
-    #tabs li a
-    {     
-      border-bottom: 1px solid #0F0A00;
-    }
-    #tabs li a.active
-    {
-      color: #0F0A00;
-      background: #FFFAF0;
-      border-color: #0F0A00;
-      border-bottom: 1px solid #FFFAF0;
-      outline: none;
-    }
-    #divs div
-    {
-      display: none;
-      overflow:auto;
-    }
-    #divs div.active
-    {
-      display: block;
-    }
-    #text
-    {
-      border-color: #805500;
-      background: #FFFDFA;
-      color: #050300;
-    }
-    .small
-    {
-      vertical-align: top;
-      text-align: right;
-      font-size: 9px;
-      font-weight: normal;
-      line-height: 120%;
-    }
-    td.small
-    {
-      padding-top: 0px;
-    }
-    .hidden
-    {
-      visibility: hidden;
-    }
-    td:hover .hidden 
-    {
-      visibility: visible;
-    }
-    div.download
-    {
-      display: none;
-      background: #FFFAF0;
-      position: absolute;
-      right: 34px;
-      top: 94px;
-      padding: 10px;
-      border: 1px dotted #0F0A00;
-    }
-    #divs div.ebnf, div.ebnf
-    {
-      display: block;
-      padding-left: 16px;
-      padding-top: 2px; 
-      padding-bottom: 2px; 
-      background: #FFF0D1;
-    }
-    table.palette
-    {
-      border-top: 1px solid #050300;
-      border-right: 1px solid #050300;
-      margin-bottom: 4px
-    }
-    td.palette
-    {
-      border-bottom: 1px solid #050300;
-      border-left: 1px solid #050300;
-    }
-    a.palette
-    {
-      padding: 2px 3px 2px 10px;
-      text-decoration: none;
-    }
-    .palette
-    {
-      -webkit-user-select: none;
-      -khtml-user-select: none;
-      -moz-user-select: none;
-      -o-user-select: none;
-      -ms-user-select: none;
-    }
-  </style><svg xmlns="http://www.w3.org/2000/svg"><defs><style type="text/css" xml:space="preserve">
-    @namespace "http://www.w3.org/2000/svg";
-    .line                 {fill: none; stroke: #332200;}
-    .bold-line            {stroke: #140E00; shape-rendering: crispEdges; stroke-width: 2; }
-    .thin-line            {stroke: #1F1400; shape-rendering: crispEdges}
-    .filled               {fill: #332200; stroke: none;}
-    text.terminal         {font-family: Verdana, Sans-serif;
-                            font-size: 12px;
-                            fill: #140E00;
-                            font-weight: bold;
-                          }
-    text.nonterminal      {font-family: Verdana, Sans-serif;
-                            font-size: 12px;
-                            fill: #1A1100;
-                          }
-    text.regexp           {font-family: Verdana, Sans-serif;
-                            font-size: 12px;
-                            fill: #1F1400;
-                          }
-    rect, circle, polygon {fill: #332200; stroke: #332200;}
-    rect.terminal         {fill: #FFC34D; stroke: #332200;}
-    rect.nonterminal      {fill: #FFDF9E; stroke: #332200;}
-    rect.text             {fill: none; stroke: none;}    
-    polygon.regexp        {fill: #FFECC7; stroke: #332200;}
-  </style></defs></svg></head><body><xhtml:p xmlns:xhtml="http://www.w3.org/1999/xhtml" style="font-size: 14px; font-weight:bold"><xhtml:a name="rule">rule:</xhtml:a></xhtml:p><svg xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" width="550" height="36"><defs><style type="text/css" xml:space="preserve">
-    @namespace "http://www.w3.org/2000/svg";
-    .line                 {fill: none; stroke: #332200;}
-    .bold-line            {stroke: #140E00; shape-rendering: crispEdges; stroke-width: 2; }
-    .thin-line            {stroke: #1F1400; shape-rendering: crispEdges}
-    .filled               {fill: #332200; stroke: none;}
-    text.terminal         {font-family: Verdana, Sans-serif;
-                            font-size: 12px;
-                            fill: #140E00;
-                            font-weight: bold;
-                          }
-    text.nonterminal      {font-family: Verdana, Sans-serif;
-                            font-size: 12px;
-                            fill: #1A1100;
-                          }
-    text.regexp           {font-family: Verdana, Sans-serif;
-                            font-size: 12px;
-                            fill: #1F1400;
-                          }
-    rect, circle, polygon {fill: #332200; stroke: #332200;}
-    rect.terminal         {fill: #FFC34D; stroke: #332200;}
-    rect.nonterminal      {fill: #FFDF9E; stroke: #332200;}
-    rect.text             {fill: none; stroke: none;}    
-    polygon.regexp        {fill: #FFECC7; stroke: #332200;}
-  </style></defs><polygon points="9 17 1 13 1 21"></polygon><polygon points="17 17 9 13 9 21"></polygon><line x1="17" y1="17" x2="19" y2="17" class="line"></line><rect x="31" y="3" width="58" height="32" rx="10"></rect><rect x="29" y="1" width="58" height="32" class="terminal" rx="10"></rect><text class="terminal" x="39" y="21">FROM</text><line x1="19" y1="17" x2="29" y2="17" class="line"></line><line x1="87" y1="17" x2="97" y2="17" class="line"></line><a xlink:href="#target_list" xlink:title="target_list" shape="rect"><rect x="109" y="3" width="84" height="32"></rect><rect x="107" y="1" width="84" height="32" class="nonterminal"></rect><text class="nonterminal" x="117" y="21">target_list</text></a><line x1="97" y1="17" x2="107" y2="17" class="line"></line><line x1="191" y1="17" x2="201" y2="17" class="line"></line><rect x="213" y="3" width="38" height="32" rx="10"></rect><rect x="211" y="1" width="38" height="32" class="terminal" rx="10"></rect><text class="terminal" x="221" y="21">TO</text><line x1="201" y1="17" x2="211" y2="17" class="line"></line><line x1="249" y1="17" x2="259" y2="17" class="line"></line><a xlink:href="#target_list" xlink:title="target_list" shape="rect"><rect x="271" y="3" width="84" height="32"></rect><rect x="269" y="1" width="84" height="32" class="nonterminal"></rect><text class="nonterminal" x="279" y="21">target_list</text></a><line x1="259" y1="17" x2="269" y2="17" class="line"></line><line x1="353" y1="17" x2="363" y2="17" class="line"></line><a xlink:href="#action" xlink:title="action" shape="rect"><rect x="375" y="3" width="58" height="32"></rect><rect x="373" y="1" width="58" height="32" class="nonterminal"></rect><text class="nonterminal" x="383" y="21">action</text></a><line x1="363" y1="17" x2="373" y2="17" class="line"></line><line x1="431" y1="17" x2="441" y2="17" class="line"></line><a xlink:href="#protocol" xlink:title="protocol" shape="rect"><rect x="453" y="3" width="70" height="32"></rect><rect x="451" y="1" width="70" height="32" class="nonterminal"></rect><text class="nonterminal" x="461" y="21">protocol</text></a><line x1="441" y1="17" x2="451" y2="17" class="line"></line><line x1="521" y1="17" x2="531" y2="17" class="line"></line><line x1="534" y1="17" x2="531" y2="17" class="line"></line><polygon points="541 17 549 13 549 21"></polygon><polygon points="541 17 533 13 533 21"></polygon></svg><xhtml:p xmlns:xhtml="http://www.w3.org/1999/xhtml"><xhtml:div class="ebnf"><xhtml:pre><a href="#rule" title="rule" shape="rect">rule</a>     ::= 'FROM' <a href="#target_list" title="target_list" shape="rect">target_list</a> 'TO' <a href="#target_list" title="target_list" shape="rect">target_list</a> <a href="#action" title="action" shape="rect">action</a> <a href="#protocol" title="protocol" shape="rect">protocol</a></xhtml:pre></xhtml:div></xhtml:p><xhtml:p xmlns:xhtml="http://www.w3.org/1999/xhtml">no references</xhtml:p><xhtml:br xmlns:xhtml="http://www.w3.org/1999/xhtml" /><xhtml:p xmlns:xhtml="http://www.w3.org/1999/xhtml" style="font-size: 14px; font-weight:bold"><xhtml:a name="target_list">target_list:</xhtml:a></xhtml:p><svg xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" width="288" height="212"><defs><style type="text/css" xml:space="preserve">
-    @namespace "http://www.w3.org/2000/svg";
-    .line                 {fill: none; stroke: #332200;}
-    .bold-line            {stroke: #140E00; shape-rendering: crispEdges; stroke-width: 2; }
-    .thin-line            {stroke: #1F1400; shape-rendering: crispEdges}
-    .filled               {fill: #332200; stroke: none;}
-    text.terminal         {font-family: Verdana, Sans-serif;
-                            font-size: 12px;
-                            fill: #140E00;
-                            font-weight: bold;
-                          }
-    text.nonterminal      {font-family: Verdana, Sans-serif;
-                            font-size: 12px;
-                            fill: #1A1100;
-                          }
-    text.regexp           {font-family: Verdana, Sans-serif;
-                            font-size: 12px;
-                            fill: #1F1400;
-                          }
-    rect, circle, polygon {fill: #332200; stroke: #332200;}
-    rect.terminal         {fill: #FFC34D; stroke: #332200;}
-    rect.nonterminal      {fill: #FFDF9E; stroke: #332200;}
-    rect.text             {fill: none; stroke: none;}    
-    polygon.regexp        {fill: #FFECC7; stroke: #332200;}
-  </style></defs><polygon points="9 17 1 13 1 21"></polygon><polygon points="17 17 9 13 9 21"></polygon><line x1="17" y1="17" x2="19" y2="17" class="line"></line><rect x="51" y="3" width="48" height="32" rx="10"></rect><rect x="49" y="1" width="48" height="32" class="terminal" rx="10"></rect><text class="terminal" x="59" y="21">ANY</text><line x1="39" y1="17" x2="49" y2="17" class="line"></line><line x1="97" y1="17" x2="107" y2="17" class="line"></line><line x1="107" y1="17" x2="249" y2="17" class="line"></line><line x1="19" y1="17" x2="39" y2="17" class="line"></line><line x1="249" y1="17" x2="269" y2="17" class="line"></line><path d="M19 17 Q29 17 29 27" class="line"></path><path d="M259 27 Q259 17 269 17" class="line"></path><line x1="29" y1="27" x2="29" y2="51" class="line"></line><line x1="259" y1="51" x2="259" y2="27" class="line"></line><path d="M29 51 Q29 61 39 61" class="line"></path><path d="M249 61 Q259 61 259 51" class="line"></path><rect x="51" y="47" width="78" height="32" rx="10"></rect><rect x="49" y="45" width="78" height="32" class="terminal" rx="10"></rect><text class="terminal" x="59" y="65">ALL VMS</text><line x1="39" y1="61" x2="49" y2="61" class="line"></line><line x1="127" y1="61" x2="137" y2="61" class="line"></line><line x1="137" y1="61" x2="249" y2="61" class="line"></line><line x1="29" y1="51" x2="29" y2="71" class="line"></line><line x1="259" y1="71" x2="259" y2="51" class="line"></line><line x1="29" y1="71" x2="29" y2="139" class="line"></line><line x1="259" y1="139" x2="259" y2="71" class="line"></line><path d="M29 139 Q29 149 39 149" class="line"></path><path d="M249 149 Q259 149 259 139" class="line"></path><rect x="51" y="135" width="26" height="32" rx="10"></rect><rect x="49" y="133" width="26" height="32" class="terminal" rx="10"></rect><text class="terminal" x="59" y="153">(</text><line x1="39" y1="149" x2="49" y2="149" class="line"></line><line x1="75" y1="149" x2="85" y2="149" class="line"></line><a xlink:href="#target" xlink:title="target" shape="rect"><rect x="117" y="135" width="58" height="32"></rect><rect x="115" y="133" width="58" height="32" class="nonterminal"></rect><text class="nonterminal" x="125" y="153">target</text></a><line x1="105" y1="149" x2="115" y2="149" class="line"></line><line x1="173" y1="149" x2="183" y2="149" class="line"></line><path d="M85 149 L105 149 M104 149 Q95 149 95 139 L95 115 Q95 105 105 105" class="line"></path><path d="M183 149 L203 149 M183 149 Q193 149 193 139 L193 115 Q193 105 183 105" class="line"></path><rect x="117" y="91" width="40" height="32" rx="10"></rect><rect x="115" y="89" width="40" height="32" class="terminal" rx="10"></rect><text class="terminal" x="125" y="109">OR</text><line x1="105" y1="105" x2="115" y2="105" class="line"></line><line x1="155" y1="105" x2="165" y2="105" class="line"></line><line x1="165" y1="105" x2="183" y2="105" class="line"></line><rect x="215" y="135" width="26" height="32" rx="10"></rect><rect x="213" y="133" width="26" height="32" class="terminal" rx="10"></rect><text class="terminal" x="223" y="153">)</text><line x1="203" y1="149" x2="213" y2="149" class="line"></line><line x1="239" y1="149" x2="249" y2="149" class="line"></line><line x1="29" y1="139" x2="29" y2="159" class="line"></line><line x1="259" y1="159" x2="259" y2="139" class="line"></line><line x1="29" y1="159" x2="29" y2="183" class="line"></line><line x1="259" y1="183" x2="259" y2="159" class="line"></line><path d="M29 183 Q29 193 39 193" class="line"></path><path d="M249 193 Q259 193 259 183" class="line"></path><a xlink:href="#target" xlink:title="target" shape="rect"><rect x="51" y="179" width="58" height="32"></rect><rect x="49" y="177" width="58" height="32" class="nonterminal"></rect><text class="nonterminal" x="59" y="197">target</text></a><line x1="39" y1="193" x2="49" y2="193" class="line"></line><line x1="107" y1="193" x2="117" y2="193" class="line"></line><line x1="117" y1="193" x2="249" y2="193" class="line"></line><line x1="272" y1="17" x2="269" y2="17" class="line"></line><polygon points="279 17 287 13 287 21"></polygon><polygon points="279 17 271 13 271 21"></polygon></svg><xhtml:p xmlns:xhtml="http://www.w3.org/1999/xhtml"><xhtml:div class="ebnf"><xhtml:pre><a href="#target_list" title="target_list" shape="rect">target_list</a>
-         ::= 'ANY'
-           | 'ALL VMS'
-           | '(' <a href="#target" title="target" shape="rect">target</a> ( 'OR' <a href="#target" title="target" shape="rect">target</a> )* ')'
-           | <a href="#target" title="target" shape="rect">target</a></xhtml:pre></xhtml:div></xhtml:p><xhtml:p xmlns:xhtml="http://www.w3.org/1999/xhtml">referenced by:<xhtml:ul><xhtml:li><xhtml:a href="#rule" title="rule">rule</xhtml:a></xhtml:li></xhtml:ul></xhtml:p><xhtml:br xmlns:xhtml="http://www.w3.org/1999/xhtml" /><xhtml:p xmlns:xhtml="http://www.w3.org/1999/xhtml" style="font-size: 14px; font-weight:bold"><xhtml:a name="target">target:</xhtml:a></xhtml:p><svg xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" width="400" height="212"><defs><style type="text/css" xml:space="preserve">
-    @namespace "http://www.w3.org/2000/svg";
-    .line                 {fill: none; stroke: #332200;}
-    .bold-line            {stroke: #140E00; shape-rendering: crispEdges; stroke-width: 2; }
-    .thin-line            {stroke: #1F1400; shape-rendering: crispEdges}
-    .filled               {fill: #332200; stroke: none;}
-    text.terminal         {font-family: Verdana, Sans-serif;
-                            font-size: 12px;
-                            fill: #140E00;
-                            font-weight: bold;
-                          }
-    text.nonterminal      {font-family: Verdana, Sans-serif;
-                            font-size: 12px;
-                            fill: #1A1100;
-                          }
-    text.regexp           {font-family: Verdana, Sans-serif;
-                            font-size: 12px;
-                            fill: #1F1400;
-                          }
-    rect, circle, polygon {fill: #332200; stroke: #332200;}
-    rect.terminal         {fill: #FFC34D; stroke: #332200;}
-    rect.nonterminal      {fill: #FFDF9E; stroke: #332200;}
-    rect.text             {fill: none; stroke: none;}    
-    polygon.regexp        {fill: #FFECC7; stroke: #332200;}
-  </style></defs><polygon points="9 17 1 13 1 21"></polygon><polygon points="17 17 9 13 9 21"></polygon><line x1="17" y1="17" x2="19" y2="17" class="line"></line><rect x="51" y="3" width="102" height="32" rx="10"></rect><rect x="49" y="1" width="102" height="32" class="terminal" rx="10"></rect><text class="terminal" x="59" y="21">IP ADDRESS</text><line x1="39" y1="17" x2="49" y2="17" class="line"></line><line x1="151" y1="17" x2="161" y2="17" class="line"></line><line x1="161" y1="17" x2="361" y2="17" class="line"></line><line x1="19" y1="17" x2="39" y2="17" class="line"></line><line x1="361" y1="17" x2="381" y2="17" class="line"></line><path d="M19 17 Q29 17 29 27" class="line"></path><path d="M371 27 Q371 17 381 17" class="line"></path><line x1="29" y1="27" x2="29" y2="51" class="line"></line><line x1="371" y1="51" x2="371" y2="27" class="line"></line><path d="M29 51 Q29 61 39 61" class="line"></path><path d="M361 61 Q371 61 371 51" class="line"></path><rect x="51" y="47" width="74" height="32" rx="10"></rect><rect x="49" y="45" width="74" height="32" class="terminal" rx="10"></rect><text class="terminal" x="59" y="65">SUBNET</text><line x1="39" y1="61" x2="49" y2="61" class="line"></line><line x1="123" y1="61" x2="133" y2="61" class="line"></line><line x1="133" y1="61" x2="361" y2="61" class="line"></line><line x1="29" y1="51" x2="29" y2="71" class="line"></line><line x1="371" y1="71" x2="371" y2="51" class="line"></line><line x1="29" y1="71" x2="29" y2="95" class="line"></line><line x1="371" y1="95" x2="371" y2="71" class="line"></line><path d="M29 95 Q29 105 39 105" class="line"></path><path d="M361 105 Q371 105 371 95" class="line"></path><rect x="51" y="91" width="46" height="32" rx="10"></rect><rect x="49" y="89" width="46" height="32" class="terminal" rx="10"></rect><text class="terminal" x="59" y="109">TAG</text><line x1="39" y1="105" x2="49" y2="105" class="line"></line><line x1="95" y1="105" x2="105" y2="105" class="line"></line><a xlink:href="#tag_string" xlink:title="tag_string" shape="rect"><rect x="117" y="91" width="84" height="32"></rect><rect x="115" y="89" width="84" height="32" class="nonterminal"></rect><text class="nonterminal" x="125" y="109">tag_string</text></a><line x1="105" y1="105" x2="115" y2="105" class="line"></line><line x1="199" y1="105" x2="209" y2="105" class="line"></line><line x1="209" y1="105" x2="361" y2="105" class="line"></line><line x1="29" y1="95" x2="29" y2="115" class="line"></line><line x1="371" y1="115" x2="371" y2="95" class="line"></line><line x1="29" y1="115" x2="29" y2="139" class="line"></line><line x1="371" y1="139" x2="371" y2="115" class="line"></line><path d="M29 139 Q29 149 39 149" class="line"></path><path d="M361 149 Q371 149 371 139" class="line"></path><rect x="51" y="135" width="46" height="32" rx="10"></rect><rect x="49" y="133" width="46" height="32" class="terminal" rx="10"></rect><text class="terminal" x="59" y="153">TAG</text><line x1="39" y1="149" x2="49" y2="149" class="line"></line><line x1="95" y1="149" x2="105" y2="149" class="line"></line><a xlink:href="#tag_string" xlink:title="tag_string" shape="rect"><rect x="117" y="135" width="84" height="32"></rect><rect x="115" y="133" width="84" height="32" class="nonterminal"></rect><text class="nonterminal" x="125" y="153">tag_string</text></a><line x1="105" y1="149" x2="115" y2="149" class="line"></line><line x1="199" y1="149" x2="209" y2="149" class="line"></line><rect x="221" y="135" width="30" height="32" rx="10"></rect><rect x="219" y="133" width="30" height="32" class="terminal" rx="10"></rect><text class="terminal" x="229" y="153">=</text><line x1="209" y1="149" x2="219" y2="149" class="line"></line><line x1="249" y1="149" x2="259" y2="149" class="line"></line><a xlink:href="#tag_value" xlink:title="tag_value" shape="rect"><rect x="271" y="135" width="82" height="32"></rect><rect x="269" y="133" width="82" height="32" class="nonterminal"></rect><text class="nonterminal" x="279" y="153">tag_value</text></a><line x1="259" y1="149" x2="269" y2="149" class="line"></line><line x1="351" y1="149" x2="361" y2="149" class="line"></line><line x1="29" y1="139" x2="29" y2="159" class="line"></line><line x1="371" y1="159" x2="371" y2="139" class="line"></line><line x1="29" y1="159" x2="29" y2="183" class="line"></line><line x1="371" y1="183" x2="371" y2="159" class="line"></line><path d="M29 183 Q29 193 39 193" class="line"></path><path d="M361 193 Q371 193 371 183" class="line"></path><rect x="51" y="179" width="40" height="32" rx="10"></rect><rect x="49" y="177" width="40" height="32" class="terminal" rx="10"></rect><text class="terminal" x="59" y="197">VM</text><line x1="39" y1="193" x2="49" y2="193" class="line"></line><line x1="89" y1="193" x2="99" y2="193" class="line"></line><a xlink:href="#uuid" xlink:title="uuid" shape="rect"><rect x="111" y="179" width="46" height="32"></rect><rect x="109" y="177" width="46" height="32" class="nonterminal"></rect><text class="nonterminal" x="119" y="197">uuid</text></a><line x1="99" y1="193" x2="109" y2="193" class="line"></line><line x1="155" y1="193" x2="165" y2="193" class="line"></line><line x1="165" y1="193" x2="361" y2="193" class="line"></line><line x1="384" y1="17" x2="381" y2="17" class="line"></line><polygon points="391 17 399 13 399 21"></polygon><polygon points="391 17 383 13 383 21"></polygon></svg><xhtml:p xmlns:xhtml="http://www.w3.org/1999/xhtml"><xhtml:div class="ebnf"><xhtml:pre><a href="#target" title="target" shape="rect">target</a>   ::= 'IP ADDRESS'
-           | 'SUBNET'
-           | 'TAG' <a href="#tag_string" title="tag_string" shape="rect">tag_string</a>
-           | 'TAG' <a href="#tag_string" title="tag_string" shape="rect">tag_string</a> '=' <a href="#tag_value" title="tag_value" shape="rect">tag_value</a>
-           | 'VM' <a href="#uuid" title="uuid" shape="rect">uuid</a></xhtml:pre></xhtml:div></xhtml:p><xhtml:p xmlns:xhtml="http://www.w3.org/1999/xhtml">referenced by:<xhtml:ul><xhtml:li><xhtml:a href="#target_list" title="target_list">target_list</xhtml:a></xhtml:li></xhtml:ul></xhtml:p><xhtml:br xmlns:xhtml="http://www.w3.org/1999/xhtml" /><xhtml:p xmlns:xhtml="http://www.w3.org/1999/xhtml" style="font-size: 14px; font-weight:bold"><xhtml:a name="action">action:</xhtml:a></xhtml:p><svg xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" width="168" height="80"><defs><style type="text/css" xml:space="preserve">
-    @namespace "http://www.w3.org/2000/svg";
-    .line                 {fill: none; stroke: #332200;}
-    .bold-line            {stroke: #140E00; shape-rendering: crispEdges; stroke-width: 2; }
-    .thin-line            {stroke: #1F1400; shape-rendering: crispEdges}
-    .filled               {fill: #332200; stroke: none;}
-    text.terminal         {font-family: Verdana, Sans-serif;
-                            font-size: 12px;
-                            fill: #140E00;
-                            font-weight: bold;
-                          }
-    text.nonterminal      {font-family: Verdana, Sans-serif;
-                            font-size: 12px;
-                            fill: #1A1100;
-                          }
-    text.regexp           {font-family: Verdana, Sans-serif;
-                            font-size: 12px;
-                            fill: #1F1400;
-                          }
-    rect, circle, polygon {fill: #332200; stroke: #332200;}
-    rect.terminal         {fill: #FFC34D; stroke: #332200;}
-    rect.nonterminal      {fill: #FFDF9E; stroke: #332200;}
-    rect.text             {fill: none; stroke: none;}    
-    polygon.regexp        {fill: #FFECC7; stroke: #332200;}
-  </style></defs><polygon points="9 17 1 13 1 21"></polygon><polygon points="17 17 9 13 9 21"></polygon><line x1="17" y1="17" x2="19" y2="17" class="line"></line><rect x="51" y="3" width="66" height="32" rx="10"></rect><rect x="49" y="1" width="66" height="32" class="terminal" rx="10"></rect><text class="terminal" x="59" y="21">BLOCK</text><line x1="39" y1="17" x2="49" y2="17" class="line"></line><line x1="115" y1="17" x2="125" y2="17" class="line"></line><line x1="125" y1="17" x2="129" y2="17" class="line"></line><line x1="19" y1="17" x2="39" y2="17" class="line"></line><line x1="129" y1="17" x2="149" y2="17" class="line"></line><path d="M19 17 Q29 17 29 27" class="line"></path><path d="M139 27 Q139 17 149 17" class="line"></path><line x1="29" y1="27" x2="29" y2="51" class="line"></line><line x1="139" y1="51" x2="139" y2="27" class="line"></line><path d="M29 51 Q29 61 39 61" class="line"></path><path d="M129 61 Q139 61 139 51" class="line"></path><rect x="51" y="47" width="70" height="32" rx="10"></rect><rect x="49" y="45" width="70" height="32" class="terminal" rx="10"></rect><text class="terminal" x="59" y="65">ALLOW</text><line x1="39" y1="61" x2="49" y2="61" class="line"></line><line x1="119" y1="61" x2="129" y2="61" class="line"></line><line x1="152" y1="17" x2="149" y2="17" class="line"></line><polygon points="159 17 167 13 167 21"></polygon><polygon points="159 17 151 13 151 21"></polygon></svg><xhtml:p xmlns:xhtml="http://www.w3.org/1999/xhtml"><xhtml:div class="ebnf"><xhtml:pre><a href="#action" title="action" shape="rect">action</a>   ::= 'BLOCK'
-           | 'ALLOW'</xhtml:pre></xhtml:div></xhtml:p><xhtml:p xmlns:xhtml="http://www.w3.org/1999/xhtml">referenced by:<xhtml:ul><xhtml:li><xhtml:a href="#rule" title="rule">rule</xhtml:a></xhtml:li></xhtml:ul></xhtml:p><xhtml:br xmlns:xhtml="http://www.w3.org/1999/xhtml" /><xhtml:p xmlns:xhtml="http://www.w3.org/1999/xhtml" style="font-size: 14px; font-weight:bold"><xhtml:a name="protocol">protocol:</xhtml:a></xhtml:p><svg xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" width="246" height="124"><defs><style type="text/css" xml:space="preserve">
-    @namespace "http://www.w3.org/2000/svg";
-    .line                 {fill: none; stroke: #332200;}
-    .bold-line            {stroke: #140E00; shape-rendering: crispEdges; stroke-width: 2; }
-    .thin-line            {stroke: #1F1400; shape-rendering: crispEdges}
-    .filled               {fill: #332200; stroke: none;}
-    text.terminal         {font-family: Verdana, Sans-serif;
-                            font-size: 12px;
-                            fill: #140E00;
-                            font-weight: bold;
-                          }
-    text.nonterminal      {font-family: Verdana, Sans-serif;
-                            font-size: 12px;
-                            fill: #1A1100;
-                          }
-    text.regexp           {font-family: Verdana, Sans-serif;
-                            font-size: 12px;
-                            fill: #1F1400;
-                          }
-    rect, circle, polygon {fill: #332200; stroke: #332200;}
-    rect.terminal         {fill: #FFC34D; stroke: #332200;}
-    rect.nonterminal      {fill: #FFDF9E; stroke: #332200;}
-    rect.text             {fill: none; stroke: none;}    
-    polygon.regexp        {fill: #FFECC7; stroke: #332200;}
-  </style></defs><polygon points="9 17 1 13 1 21"></polygon><polygon points="17 17 9 13 9 21"></polygon><line x1="17" y1="17" x2="19" y2="17" class="line"></line><rect x="51" y="3" width="46" height="32" rx="10"></rect><rect x="49" y="1" width="46" height="32" class="terminal" rx="10"></rect><text class="terminal" x="59" y="21">TCP</text><line x1="39" y1="17" x2="49" y2="17" class="line"></line><line x1="95" y1="17" x2="105" y2="17" class="line"></line><a xlink:href="#port_list" xlink:title="port_list" shape="rect"><rect x="117" y="3" width="72" height="32"></rect><rect x="115" y="1" width="72" height="32" class="nonterminal"></rect><text class="nonterminal" x="125" y="21">port_list</text></a><line x1="105" y1="17" x2="115" y2="17" class="line"></line><line x1="187" y1="17" x2="197" y2="17" class="line"></line><line x1="197" y1="17" x2="207" y2="17" class="line"></line><line x1="19" y1="17" x2="39" y2="17" class="line"></line><line x1="207" y1="17" x2="227" y2="17" class="line"></line><path d="M19 17 Q29 17 29 27" class="line"></path><path d="M217 27 Q217 17 227 17" class="line"></path><line x1="29" y1="27" x2="29" y2="51" class="line"></line><line x1="217" y1="51" x2="217" y2="27" class="line"></line><path d="M29 51 Q29 61 39 61" class="line"></path><path d="M207 61 Q217 61 217 51" class="line"></path><rect x="51" y="47" width="48" height="32" rx="10"></rect><rect x="49" y="45" width="48" height="32" class="terminal" rx="10"></rect><text class="terminal" x="59" y="65">UDP</text><line x1="39" y1="61" x2="49" y2="61" class="line"></line><line x1="97" y1="61" x2="107" y2="61" class="line"></line><a xlink:href="#port_list" xlink:title="port_list" shape="rect"><rect x="119" y="47" width="72" height="32"></rect><rect x="117" y="45" width="72" height="32" class="nonterminal"></rect><text class="nonterminal" x="127" y="65">port_list</text></a><line x1="107" y1="61" x2="117" y2="61" class="line"></line><line x1="189" y1="61" x2="199" y2="61" class="line"></line><line x1="199" y1="61" x2="207" y2="61" class="line"></line><line x1="29" y1="51" x2="29" y2="71" class="line"></line><line x1="217" y1="71" x2="217" y2="51" class="line"></line><line x1="29" y1="71" x2="29" y2="95" class="line"></line><line x1="217" y1="95" x2="217" y2="71" class="line"></line><path d="M29 95 Q29 105 39 105" class="line"></path><path d="M207 105 Q217 105 217 95" class="line"></path><rect x="51" y="91" width="54" height="32" rx="10"></rect><rect x="49" y="89" width="54" height="32" class="terminal" rx="10"></rect><text class="terminal" x="59" y="109">ICMP</text><line x1="39" y1="105" x2="49" y2="105" class="line"></line><line x1="103" y1="105" x2="113" y2="105" class="line"></line><a xlink:href="#type_list" xlink:title="type_list" shape="rect"><rect x="125" y="91" width="74" height="32"></rect><rect x="123" y="89" width="74" height="32" class="nonterminal"></rect><text class="nonterminal" x="133" y="109">type_list</text></a><line x1="113" y1="105" x2="123" y2="105" class="line"></line><line x1="197" y1="105" x2="207" y2="105" class="line"></line><line x1="230" y1="17" x2="227" y2="17" class="line"></line><polygon points="237 17 245 13 245 21"></polygon><polygon points="237 17 229 13 229 21"></polygon></svg><xhtml:p xmlns:xhtml="http://www.w3.org/1999/xhtml"><xhtml:div class="ebnf"><xhtml:pre><a href="#protocol" title="protocol" shape="rect">protocol</a> ::= 'TCP' <a href="#port_list" title="port_list" shape="rect">port_list</a>
-           | 'UDP' <a href="#port_list" title="port_list" shape="rect">port_list</a>
-           | 'ICMP' <a href="#type_list" title="type_list" shape="rect">type_list</a></xhtml:pre></xhtml:div></xhtml:p><xhtml:p xmlns:xhtml="http://www.w3.org/1999/xhtml">referenced by:<xhtml:ul><xhtml:li><xhtml:a href="#rule" title="rule">rule</xhtml:a></xhtml:li></xhtml:ul></xhtml:p><xhtml:br xmlns:xhtml="http://www.w3.org/1999/xhtml" /><xhtml:p xmlns:xhtml="http://www.w3.org/1999/xhtml" style="font-size: 14px; font-weight:bold"><xhtml:a name="port_list">port_list:</xhtml:a></xhtml:p><svg xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" width="278" height="212"><defs><style type="text/css" xml:space="preserve">
-    @namespace "http://www.w3.org/2000/svg";
-    .line                 {fill: none; stroke: #332200;}
-    .bold-line            {stroke: #140E00; shape-rendering: crispEdges; stroke-width: 2; }
-    .thin-line            {stroke: #1F1400; shape-rendering: crispEdges}
-    .filled               {fill: #332200; stroke: none;}
-    text.terminal         {font-family: Verdana, Sans-serif;
-                            font-size: 12px;
-                            fill: #140E00;
-                            font-weight: bold;
-                          }
-    text.nonterminal      {font-family: Verdana, Sans-serif;
-                            font-size: 12px;
-                            fill: #1A1100;
-                          }
-    text.regexp           {font-family: Verdana, Sans-serif;
-                            font-size: 12px;
-                            fill: #1F1400;
-                          }
-    rect, circle, polygon {fill: #332200; stroke: #332200;}
-    rect.terminal         {fill: #FFC34D; stroke: #332200;}
-    rect.nonterminal      {fill: #FFDF9E; stroke: #332200;}
-    rect.text             {fill: none; stroke: none;}    
-    polygon.regexp        {fill: #FFECC7; stroke: #332200;}
-  </style></defs><polygon points="9 61 1 57 1 65"></polygon><polygon points="17 61 9 57 9 65"></polygon><line x1="17" y1="61" x2="19" y2="61" class="line"></line><rect x="51" y="47" width="26" height="32" rx="10"></rect><rect x="49" y="45" width="26" height="32" class="terminal" rx="10"></rect><text class="terminal" x="59" y="65">(</text><line x1="39" y1="61" x2="49" y2="61" class="line"></line><line x1="75" y1="61" x2="85" y2="61" class="line"></line><a xlink:href="#port" xlink:title="port" shape="rect"><rect x="117" y="47" width="46" height="32"></rect><rect x="115" y="45" width="46" height="32" class="nonterminal"></rect><text class="nonterminal" x="125" y="65">port</text></a><line x1="105" y1="61" x2="115" y2="61" class="line"></line><line x1="161" y1="61" x2="171" y2="61" class="line"></line><line x1="171" y1="61" x2="173" y2="61" class="line"></line><path d="M85 61 L105 61 M104 61 Q95 61 95 51 L95 27 Q95 17 105 17" class="line"></path><path d="M173 61 L193 61 M173 61 Q183 61 183 51 L183 27 Q183 17 173 17" class="line"></path><rect x="117" y="3" width="48" height="32" rx="10"></rect><rect x="115" y="1" width="48" height="32" class="terminal" rx="10"></rect><text class="terminal" x="125" y="21">AND</text><line x1="105" y1="17" x2="115" y2="17" class="line"></line><line x1="163" y1="17" x2="173" y2="17" class="line"></line><rect x="205" y="47" width="26" height="32" rx="10"></rect><rect x="203" y="45" width="26" height="32" class="terminal" rx="10"></rect><text class="terminal" x="213" y="65">)</text><line x1="193" y1="61" x2="203" y2="61" class="line"></line><line x1="229" y1="61" x2="239" y2="61" class="line"></line><line x1="19" y1="61" x2="39" y2="61" class="line"></line><line x1="239" y1="61" x2="259" y2="61" class="line"></line><path d="M19 61 Q29 61 29 71" class="line"></path><path d="M249 71 Q249 61 259 61" class="line"></path><line x1="29" y1="71" x2="29" y2="95" class="line"></line><line x1="249" y1="95" x2="249" y2="71" class="line"></line><path d="M29 95 Q29 105 39 105" class="line"></path><path d="M239 105 Q249 105 249 95" class="line"></path><a xlink:href="#port" xlink:title="port" shape="rect"><rect x="51" y="91" width="46" height="32"></rect><rect x="49" y="89" width="46" height="32" class="nonterminal"></rect><text class="nonterminal" x="59" y="109">port</text></a><line x1="39" y1="105" x2="49" y2="105" class="line"></line><line x1="95" y1="105" x2="105" y2="105" class="line"></line><line x1="105" y1="105" x2="239" y2="105" class="line"></line><line x1="29" y1="95" x2="29" y2="115" class="line"></line><line x1="249" y1="115" x2="249" y2="95" class="line"></line><line x1="29" y1="115" x2="29" y2="139" class="line"></line><line x1="249" y1="139" x2="249" y2="115" class="line"></line><path d="M29 139 Q29 149 39 149" class="line"></path><path d="M239 149 Q249 149 249 139" class="line"></path><rect x="51" y="135" width="26" height="32" rx="10"></rect><rect x="49" y="133" width="26" height="32" class="terminal" rx="10"></rect><text class="terminal" x="59" y="153">(</text><line x1="39" y1="149" x2="49" y2="149" class="line"></line><line x1="75" y1="149" x2="85" y2="149" class="line"></line><rect x="97" y="135" width="86" height="32" rx="10"></rect><rect x="95" y="133" width="86" height="32" class="terminal" rx="10"></rect><text class="terminal" x="105" y="153">PORT ALL</text><line x1="85" y1="149" x2="95" y2="149" class="line"></line><line x1="181" y1="149" x2="191" y2="149" class="line"></line><rect x="203" y="135" width="26" height="32" rx="10"></rect><rect x="201" y="133" width="26" height="32" class="terminal" rx="10"></rect><text class="terminal" x="211" y="153">)</text><line x1="191" y1="149" x2="201" y2="149" class="line"></line><line x1="227" y1="149" x2="237" y2="149" class="line"></line><line x1="237" y1="149" x2="239" y2="149" class="line"></line><line x1="29" y1="139" x2="29" y2="159" class="line"></line><line x1="249" y1="159" x2="249" y2="139" class="line"></line><line x1="29" y1="159" x2="29" y2="183" class="line"></line><line x1="249" y1="183" x2="249" y2="159" class="line"></line><path d="M29 183 Q29 193 39 193" class="line"></path><path d="M239 193 Q249 193 249 183" class="line"></path><rect x="51" y="179" width="86" height="32" rx="10"></rect><rect x="49" y="177" width="86" height="32" class="terminal" rx="10"></rect><text class="terminal" x="59" y="197">PORT ALL</text><line x1="39" y1="193" x2="49" y2="193" class="line"></line><line x1="135" y1="193" x2="145" y2="193" class="line"></line><line x1="145" y1="193" x2="239" y2="193" class="line"></line><line x1="262" y1="61" x2="259" y2="61" class="line"></line><polygon points="269 61 277 57 277 65"></polygon><polygon points="269 61 261 57 261 65"></polygon></svg><xhtml:p xmlns:xhtml="http://www.w3.org/1999/xhtml"><xhtml:div class="ebnf"><xhtml:pre><a href="#port_list" title="port_list" shape="rect">port_list</a>
-         ::= '(' <a href="#port" title="port" shape="rect">port</a> ( 'AND' <a href="#port" title="port" shape="rect">port</a> )* ')'
-           | <a href="#port" title="port" shape="rect">port</a>
-           | '(' 'PORT ALL' ')'
-           | 'PORT ALL'</xhtml:pre></xhtml:div></xhtml:p><xhtml:p xmlns:xhtml="http://www.w3.org/1999/xhtml">referenced by:<xhtml:ul><xhtml:li><xhtml:a href="#protocol" title="protocol">protocol</xhtml:a></xhtml:li></xhtml:ul></xhtml:p><xhtml:br xmlns:xhtml="http://www.w3.org/1999/xhtml" /><xhtml:p xmlns:xhtml="http://www.w3.org/1999/xhtml" style="font-size: 14px; font-weight:bold"><xhtml:a name="port">port:</xhtml:a></xhtml:p><svg xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" width="222" height="36"><defs><style type="text/css" xml:space="preserve">
-    @namespace "http://www.w3.org/2000/svg";
-    .line                 {fill: none; stroke: #332200;}
-    .bold-line            {stroke: #140E00; shape-rendering: crispEdges; stroke-width: 2; }
-    .thin-line            {stroke: #1F1400; shape-rendering: crispEdges}
-    .filled               {fill: #332200; stroke: none;}
-    text.terminal         {font-family: Verdana, Sans-serif;
-                            font-size: 12px;
-                            fill: #140E00;
-                            font-weight: bold;
-                          }
-    text.nonterminal      {font-family: Verdana, Sans-serif;
-                            font-size: 12px;
-                            fill: #1A1100;
-                          }
-    text.regexp           {font-family: Verdana, Sans-serif;
-                            font-size: 12px;
-                            fill: #1F1400;
-                          }
-    rect, circle, polygon {fill: #332200; stroke: #332200;}
-    rect.terminal         {fill: #FFC34D; stroke: #332200;}
-    rect.nonterminal      {fill: #FFDF9E; stroke: #332200;}
-    rect.text             {fill: none; stroke: none;}    
-    polygon.regexp        {fill: #FFECC7; stroke: #332200;}
-  </style></defs><polygon points="9 17 1 13 1 21"></polygon><polygon points="17 17 9 13 9 21"></polygon><line x1="17" y1="17" x2="19" y2="17" class="line"></line><rect x="31" y="3" width="56" height="32" rx="10"></rect><rect x="29" y="1" width="56" height="32" class="terminal" rx="10"></rect><text class="terminal" x="39" y="21">PORT</text><line x1="19" y1="17" x2="29" y2="17" class="line"></line><line x1="85" y1="17" x2="95" y2="17" class="line"></line><rect x="107" y="3" width="88" height="32" rx="10"></rect><rect x="105" y="1" width="88" height="32" class="terminal" rx="10"></rect><text class="terminal" x="115" y="21">1 - 65535</text><line x1="95" y1="17" x2="105" y2="17" class="line"></line><line x1="193" y1="17" x2="203" y2="17" class="line"></line><line x1="206" y1="17" x2="203" y2="17" class="line"></line><polygon points="213 17 221 13 221 21"></polygon><polygon points="213 17 205 13 205 21"></polygon></svg><xhtml:p xmlns:xhtml="http://www.w3.org/1999/xhtml"><xhtml:div class="ebnf"><xhtml:pre><a href="#port" title="port" shape="rect">port</a>     ::= 'PORT' '1 - 65535'</xhtml:pre></xhtml:div></xhtml:p><xhtml:p xmlns:xhtml="http://www.w3.org/1999/xhtml">referenced by:<xhtml:ul><xhtml:li><xhtml:a href="#port_list" title="port_list">port_list</xhtml:a></xhtml:li></xhtml:ul></xhtml:p><xhtml:br xmlns:xhtml="http://www.w3.org/1999/xhtml" /><xhtml:p xmlns:xhtml="http://www.w3.org/1999/xhtml" style="font-size: 14px; font-weight:bold"><xhtml:a name="type_list">type_list:</xhtml:a></xhtml:p><svg xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" width="278" height="124"><defs><style type="text/css" xml:space="preserve">
-    @namespace "http://www.w3.org/2000/svg";
-    .line                 {fill: none; stroke: #332200;}
-    .bold-line            {stroke: #140E00; shape-rendering: crispEdges; stroke-width: 2; }
-    .thin-line            {stroke: #1F1400; shape-rendering: crispEdges}
-    .filled               {fill: #332200; stroke: none;}
-    text.terminal         {font-family: Verdana, Sans-serif;
-                            font-size: 12px;
-                            fill: #140E00;
-                            font-weight: bold;
-                          }
-    text.nonterminal      {font-family: Verdana, Sans-serif;
-                            font-size: 12px;
-                            fill: #1A1100;
-                          }
-    text.regexp           {font-family: Verdana, Sans-serif;
-                            font-size: 12px;
-                            fill: #1F1400;
-                          }
-    rect, circle, polygon {fill: #332200; stroke: #332200;}
-    rect.terminal         {fill: #FFC34D; stroke: #332200;}
-    rect.nonterminal      {fill: #FFDF9E; stroke: #332200;}
-    rect.text             {fill: none; stroke: none;}    
-    polygon.regexp        {fill: #FFECC7; stroke: #332200;}
-  </style></defs><polygon points="9 61 1 57 1 65"></polygon><polygon points="17 61 9 57 9 65"></polygon><line x1="17" y1="61" x2="19" y2="61" class="line"></line><rect x="51" y="47" width="26" height="32" rx="10"></rect><rect x="49" y="45" width="26" height="32" class="terminal" rx="10"></rect><text class="terminal" x="59" y="65">(</text><line x1="39" y1="61" x2="49" y2="61" class="line"></line><line x1="75" y1="61" x2="85" y2="61" class="line"></line><a xlink:href="#type" xlink:title="type" shape="rect"><rect x="117" y="47" width="48" height="32"></rect><rect x="115" y="45" width="48" height="32" class="nonterminal"></rect><text class="nonterminal" x="125" y="65">type</text></a><line x1="105" y1="61" x2="115" y2="61" class="line"></line><line x1="163" y1="61" x2="173" y2="61" class="line"></line><path d="M85 61 L105 61 M104 61 Q95 61 95 51 L95 27 Q95 17 105 17" class="line"></path><path d="M173 61 L193 61 M173 61 Q183 61 183 51 L183 27 Q183 17 173 17" class="line"></path><rect x="117" y="3" width="48" height="32" rx="10"></rect><rect x="115" y="1" width="48" height="32" class="terminal" rx="10"></rect><text class="terminal" x="125" y="21">AND</text><line x1="105" y1="17" x2="115" y2="17" class="line"></line><line x1="163" y1="17" x2="173" y2="17" class="line"></line><rect x="205" y="47" width="26" height="32" rx="10"></rect><rect x="203" y="45" width="26" height="32" class="terminal" rx="10"></rect><text class="terminal" x="213" y="65">)</text><line x1="193" y1="61" x2="203" y2="61" class="line"></line><line x1="229" y1="61" x2="239" y2="61" class="line"></line><line x1="19" y1="61" x2="39" y2="61" class="line"></line><line x1="239" y1="61" x2="259" y2="61" class="line"></line><path d="M19 61 Q29 61 29 71" class="line"></path><path d="M249 71 Q249 61 259 61" class="line"></path><line x1="29" y1="71" x2="29" y2="95" class="line"></line><line x1="249" y1="95" x2="249" y2="71" class="line"></line><path d="M29 95 Q29 105 39 105" class="line"></path><path d="M239 105 Q249 105 249 95" class="line"></path><a xlink:href="#type" xlink:title="type" shape="rect"><rect x="51" y="91" width="48" height="32"></rect><rect x="49" y="89" width="48" height="32" class="nonterminal"></rect><text class="nonterminal" x="59" y="109">type</text></a><line x1="39" y1="105" x2="49" y2="105" class="line"></line><line x1="97" y1="105" x2="107" y2="105" class="line"></line><line x1="107" y1="105" x2="239" y2="105" class="line"></line><line x1="262" y1="61" x2="259" y2="61" class="line"></line><polygon points="269 61 277 57 277 65"></polygon><polygon points="269 61 261 57 261 65"></polygon></svg><xhtml:p xmlns:xhtml="http://www.w3.org/1999/xhtml"><xhtml:div class="ebnf"><xhtml:pre><a href="#type_list" title="type_list" shape="rect">type_list</a>
-         ::= '(' <a href="#type" title="type" shape="rect">type</a> ( 'AND' <a href="#type" title="type" shape="rect">type</a> )* ')'
-           | <a href="#type" title="type" shape="rect">type</a></xhtml:pre></xhtml:div></xhtml:p><xhtml:p xmlns:xhtml="http://www.w3.org/1999/xhtml">referenced by:<xhtml:ul><xhtml:li><xhtml:a href="#protocol" title="protocol">protocol</xhtml:a></xhtml:li></xhtml:ul></xhtml:p><xhtml:br xmlns:xhtml="http://www.w3.org/1999/xhtml" /><xhtml:p xmlns:xhtml="http://www.w3.org/1999/xhtml" style="font-size: 14px; font-weight:bold"><xhtml:a name="type">type:</xhtml:a></xhtml:p><svg xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" width="410" height="80"><defs><style type="text/css" xml:space="preserve">
-    @namespace "http://www.w3.org/2000/svg";
-    .line                 {fill: none; stroke: #332200;}
-    .bold-line            {stroke: #140E00; shape-rendering: crispEdges; stroke-width: 2; }
-    .thin-line            {stroke: #1F1400; shape-rendering: crispEdges}
-    .filled               {fill: #332200; stroke: none;}
-    text.terminal         {font-family: Verdana, Sans-serif;
-                            font-size: 12px;
-                            fill: #140E00;
-                            font-weight: bold;
-                          }
-    text.nonterminal      {font-family: Verdana, Sans-serif;
-                            font-size: 12px;
-                            fill: #1A1100;
-                          }
-    text.regexp           {font-family: Verdana, Sans-serif;
-                            font-size: 12px;
-                            fill: #1F1400;
-                          }
-    rect, circle, polygon {fill: #332200; stroke: #332200;}
-    rect.terminal         {fill: #FFC34D; stroke: #332200;}
-    rect.nonterminal      {fill: #FFDF9E; stroke: #332200;}
-    rect.text             {fill: none; stroke: none;}    
-    polygon.regexp        {fill: #FFECC7; stroke: #332200;}
-  </style></defs><polygon points="9 17 1 13 1 21"></polygon><polygon points="17 17 9 13 9 21"></polygon><line x1="17" y1="17" x2="19" y2="17" class="line"></line><rect x="51" y="3" width="54" height="32" rx="10"></rect><rect x="49" y="1" width="54" height="32" class="terminal" rx="10"></rect><text class="terminal" x="59" y="21">TYPE</text><line x1="39" y1="17" x2="49" y2="17" class="line"></line><line x1="103" y1="17" x2="113" y2="17" class="line"></line><rect x="125" y="3" width="70" height="32" rx="10"></rect><rect x="123" y="1" width="70" height="32" class="terminal" rx="10"></rect><text class="terminal" x="133" y="21">0 - 255</text><line x1="113" y1="17" x2="123" y2="17" class="line"></line><line x1="193" y1="17" x2="203" y2="17" class="line"></line><rect x="215" y="3" width="58" height="32" rx="10"></rect><rect x="213" y="1" width="58" height="32" class="terminal" rx="10"></rect><text class="terminal" x="223" y="21">CODE</text><line x1="203" y1="17" x2="213" y2="17" class="line"></line><line x1="271" y1="17" x2="281" y2="17" class="line"></line><rect x="293" y="3" width="70" height="32" rx="10"></rect><rect x="291" y="1" width="70" height="32" class="terminal" rx="10"></rect><text class="terminal" x="301" y="21">0 - 255</text><line x1="281" y1="17" x2="291" y2="17" class="line"></line><line x1="361" y1="17" x2="371" y2="17" class="line"></line><line x1="19" y1="17" x2="39" y2="17" class="line"></line><line x1="371" y1="17" x2="391" y2="17" class="line"></line><path d="M19 17 Q29 17 29 27" class="line"></path><path d="M381 27 Q381 17 391 17" class="line"></path><line x1="29" y1="27" x2="29" y2="51" class="line"></line><line x1="381" y1="51" x2="381" y2="27" class="line"></line><path d="M29 51 Q29 61 39 61" class="line"></path><path d="M371 61 Q381 61 381 51" class="line"></path><rect x="51" y="47" width="54" height="32" rx="10"></rect><rect x="49" y="45" width="54" height="32" class="terminal" rx="10"></rect><text class="terminal" x="59" y="65">TYPE</text><line x1="39" y1="61" x2="49" y2="61" class="line"></line><line x1="103" y1="61" x2="113" y2="61" class="line"></line><rect x="125" y="47" width="70" height="32" rx="10"></rect><rect x="123" y="45" width="70" height="32" class="terminal" rx="10"></rect><text class="terminal" x="133" y="65">0 - 255</text><line x1="113" y1="61" x2="123" y2="61" class="line"></line><line x1="193" y1="61" x2="203" y2="61" class="line"></line><line x1="203" y1="61" x2="371" y2="61" class="line"></line><line x1="394" y1="17" x2="391" y2="17" class="line"></line><polygon points="401 17 409 13 409 21"></polygon><polygon points="401 17 393 13 393 21"></polygon></svg><xhtml:p xmlns:xhtml="http://www.w3.org/1999/xhtml"><xhtml:div class="ebnf"><xhtml:pre><a href="#type" title="type" shape="rect">type</a>     ::= 'TYPE' '0 - 255' 'CODE' '0 - 255'
-           | 'TYPE' '0 - 255'</xhtml:pre></xhtml:div></xhtml:p><xhtml:p xmlns:xhtml="http://www.w3.org/1999/xhtml">referenced by:<xhtml:ul><xhtml:li><xhtml:a href="#type_list" title="type_list">type_list</xhtml:a></xhtml:li></xhtml:ul></xhtml:p><xhtml:br xmlns:xhtml="http://www.w3.org/1999/xhtml" /><xhtml:hr xmlns:xhtml="http://www.w3.org/1999/xhtml" /><xhtml:p xmlns:xhtml="http://www.w3.org/1999/xhtml"><xhtml:table border="0" class="signature"><xhtml:tr><xhtml:td style="width: 100%"> </xhtml:td><xhtml:td valign="top"><xhtml:nobr class="signature">... generated by <xhtml:a name="Railroad-Diagram-Generator" class="signature" title="http://www.bottlecaps.de/rr/ui" href="http://www.bottlecaps.de/rr/ui" target="_blank">Railroad Diagram Generator</xhtml:a></xhtml:nobr></xhtml:td><xhtml:td><xhtml:a name="Railroad-Diagram-Generator" title="http://www.bottlecaps.de/rr/ui" href="http://www.bottlecaps.de/rr/ui" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"><g transform="scale(0.177777777777777778)"><circle cx="45" cy="45" r="45" style="stroke:none; fill:#FFCC00"></circle><circle cx="45" cy="45" r="42" style="stroke:#332900; stroke-width:2px; fill:#FFCC00"></circle><line x1="15" y1="15" x2="75" y2="75" stroke="#332900" style="stroke-width:9px;"></line><line x1="15" y1="75" x2="75" y2="15" stroke="#332900" style="stroke-width:9px;"></line><text x="7" y="54" style="font-size:26px; font-family:Arial, Sans-serif; font-weight:bold; fill: #332900">R</text><text x="64" y="54" style="font-size:26px; font-family:Arial, Sans-serif; font-weight:bold; fill: #332900">R</text></g></svg></xhtml:a></xhtml:td></xhtml:tr></xhtml:table></xhtml:p></body></html>
\ No newline at end of file
diff --git a/docs/media/img/port-list.svg b/docs/media/img/port-list.svg
new file mode 100644
index 0000000..695f31a
--- /dev/null
+++ b/docs/media/img/port-list.svg
@@ -0,0 +1,136 @@
+<?xml version="1.0" encoding="utf-8" standalone="no"?>
+<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
+<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" class="railroad-diagram" width="401" height="182" viewBox="0 0 401 182">
+<defs><style type="text/css"><![CDATA[
+svg.railroad-diagram path {
+  stroke-width: 3;
+  stroke: black;
+  fill: none;
+}
+svg.railroad-diagram text {
+  font: bold 14px monospace;
+  text-anchor: middle;
+}
+svg.railroad-diagram text.label {
+  text-anchor: start;
+}
+svg.railroad-diagram text.comment {
+  font: italic 12px monospace;
+}
+svg.railroad-diagram rect {
+  stroke-width: 3;
+  stroke: black;
+  fill: hsl(120,100%,90%);
+}
+ ]]></style></defs>
+<g transform="translate(.5 .5)">
+<path d="M 20 21 v 20 m 10 -20 v 20 m -10 -10 h 20.5"></path>
+<g>
+<path d="M40 31h0"></path>
+<path d="M360 31h0"></path>
+<path d="M40 31h20"></path>
+<g>
+<path d="M60 31h0"></path>
+<path d="M340 31h0"></path>
+<path d="M60 31h10"></path>
+<g>
+<path d="M70 31h0"></path>
+<path d="M98 31h0"></path>
+<rect x="70" y="20" width="28" height="22" rx="10" ry="10"></rect>
+<text x="84" y="35">(</text>
+</g>
+<path d="M98 31h10"></path>
+<path d="M108 31h10"></path>
+<g>
+<path d="M118 31h0"></path>
+<path d="M282 31h0"></path>
+<path d="M118 31h10"></path>
+<g>
+<path d="M128 31h0"></path>
+<path d="M272 31h0"></path>
+<path d="M128 31h10"></path>
+<g>
+<path d="M138 31h0"></path>
+<path d="M190 31h0"></path>
+<rect x="138" y="20" width="52" height="22" rx="10" ry="10"></rect>
+<text x="164" y="35">PORT</text>
+</g>
+<path d="M190 31h10"></path>
+<path d="M200 31h10"></path>
+<g>
+<path d="M210 31h0"></path>
+<path d="M262 31h0"></path>
+<rect x="210" y="20" width="52" height="22"></rect>
+<text x="236" y="35">port</text>
+</g>
+<path d="M262 31h10"></path>
+</g>
+<path d="M272 31h10"></path>
+<path d="M128 31a10 10 0 0 0 -10 10v10a10 10 0 0 0 10 10"></path>
+<g>
+<path d="M128 61h50"></path>
+<path d="M222 61h50"></path>
+<rect x="178" y="50" width="44" height="22" rx="10" ry="10"></rect>
+<text x="200" y="65">AND</text>
+</g>
+<path d="M272 61a10 10 0 0 0 10 -10v-10a10 10 0 0 0 -10 -10"></path>
+</g>
+<path d="M282 31h10"></path>
+<path d="M292 31h10"></path>
+<g>
+<path d="M302 31h0"></path>
+<path d="M330 31h0"></path>
+<rect x="302" y="20" width="28" height="22" rx="10" ry="10"></rect>
+<text x="316" y="35">)</text>
+</g>
+<path d="M330 31h10"></path>
+</g>
+<path d="M340 31h20"></path>
+<path d="M40 31a10 10 0 0 1 10 10v40a10 10 0 0 0 10 10"></path>
+<g>
+<path d="M60 91h34"></path>
+<path d="M306 91h34"></path>
+<path d="M94 91h10"></path>
+<g>
+<path d="M104 91h0"></path>
+<path d="M164 91h0"></path>
+<rect x="104" y="80" width="60" height="22" rx="10" ry="10"></rect>
+<text x="134" y="95">PORTS</text>
+</g>
+<path d="M164 91h10"></path>
+<path d="M174 91h10"></path>
+<g>
+<path d="M184 91h0"></path>
+<path d="M296 91h0"></path>
+<path d="M184 91h10"></path>
+<g>
+<path d="M194 91h0"></path>
+<path d="M286 91h0"></path>
+<rect x="194" y="80" width="92" height="22"></rect>
+<text x="240" y="95">portrange</text>
+</g>
+<path d="M286 91h10"></path>
+<path d="M194 91a10 10 0 0 0 -10 10v10a10 10 0 0 0 10 10"></path>
+<g>
+<path d="M194 121h32"></path>
+<path d="M254 121h32"></path>
+<rect x="226" y="110" width="28" height="22" rx="10" ry="10"></rect>
+<text x="240" y="125">,</text>
+</g>
+<path d="M286 121a10 10 0 0 0 10 -10v-10a10 10 0 0 0 -10 -10"></path>
+</g>
+<path d="M296 91h10"></path>
+</g>
+<path d="M340 91a10 10 0 0 0 10 -10v-40a10 10 0 0 1 10 -10"></path>
+<path d="M40 31a10 10 0 0 1 10 10v100a10 10 0 0 0 10 10"></path>
+<g>
+<path d="M60 151h98"></path>
+<path d="M242 151h98"></path>
+<rect x="158" y="140" width="84" height="22" rx="10" ry="10"></rect>
+<text x="200" y="155">PORT ALL</text>
+</g>
+<path d="M340 151a10 10 0 0 0 10 -10v-100a10 10 0 0 1 10 -10"></path>
+</g>
+<path d="M 360 31 h 20 m -10 -10 v 20 m 10 -20 v 20"></path>
+</g>
+</svg>
diff --git a/docs/media/img/protocol.svg b/docs/media/img/protocol.svg
new file mode 100644
index 0000000..eac0c74
--- /dev/null
+++ b/docs/media/img/protocol.svg
@@ -0,0 +1,122 @@
+<?xml version="1.0" encoding="utf-8" standalone="no"?>
+<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
+<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" class="railroad-diagram" width="313" height="152" viewBox="0 0 313 152">
+<defs><style type="text/css"><![CDATA[
+svg.railroad-diagram path {
+  stroke-width: 3;
+  stroke: black;
+  fill: none;
+}
+svg.railroad-diagram text {
+  font: bold 14px monospace;
+  text-anchor: middle;
+}
+svg.railroad-diagram text.label {
+  text-anchor: start;
+}
+svg.railroad-diagram text.comment {
+  font: italic 12px monospace;
+}
+svg.railroad-diagram rect {
+  stroke-width: 3;
+  stroke: black;
+  fill: hsl(120,100%,90%);
+}
+ ]]></style></defs>
+<g transform="translate(.5 .5)">
+<path d="M 20 21 v 20 m 10 -20 v 20 m -10 -10 h 20.5"></path>
+<g>
+<path d="M40 31h0"></path>
+<path d="M272 31h0"></path>
+<path d="M40 31h20"></path>
+<g>
+<path d="M60 31h8"></path>
+<path d="M244 31h8"></path>
+<path d="M68 31h10"></path>
+<g>
+<path d="M78 31h0"></path>
+<path d="M122 31h0"></path>
+<rect x="78" y="20" width="44" height="22" rx="10" ry="10"></rect>
+<text x="100" y="35">TCP</text>
+</g>
+<path d="M122 31h10"></path>
+<path d="M132 31h10"></path>
+<g>
+<path d="M142 31h0"></path>
+<path d="M234 31h0"></path>
+<rect x="142" y="20" width="92" height="22"></rect>
+<text x="188" y="35">port&#95;list</text>
+</g>
+<path d="M234 31h10"></path>
+</g>
+<path d="M252 31h20"></path>
+<path d="M40 31a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"></path>
+<g>
+<path d="M60 61h8"></path>
+<path d="M244 61h8"></path>
+<path d="M68 61h10"></path>
+<g>
+<path d="M78 61h0"></path>
+<path d="M122 61h0"></path>
+<rect x="78" y="50" width="44" height="22" rx="10" ry="10"></rect>
+<text x="100" y="65">UDP</text>
+</g>
+<path d="M122 61h10"></path>
+<path d="M132 61h10"></path>
+<g>
+<path d="M142 61h0"></path>
+<path d="M234 61h0"></path>
+<rect x="142" y="50" width="92" height="22"></rect>
+<text x="188" y="65">port&#95;list</text>
+</g>
+<path d="M234 61h10"></path>
+</g>
+<path d="M252 61a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"></path>
+<path d="M40 31a10 10 0 0 1 10 10v40a10 10 0 0 0 10 10"></path>
+<g>
+<path d="M60 91h4"></path>
+<path d="M248 91h4"></path>
+<path d="M64 91h10"></path>
+<g>
+<path d="M74 91h0"></path>
+<path d="M126 91h0"></path>
+<rect x="74" y="80" width="52" height="22" rx="10" ry="10"></rect>
+<text x="100" y="95">ICMP</text>
+</g>
+<path d="M126 91h10"></path>
+<path d="M136 91h10"></path>
+<g>
+<path d="M146 91h0"></path>
+<path d="M238 91h0"></path>
+<rect x="146" y="80" width="92" height="22"></rect>
+<text x="192" y="95">type&#95;list</text>
+</g>
+<path d="M238 91h10"></path>
+</g>
+<path d="M252 91a10 10 0 0 0 10 -10v-40a10 10 0 0 1 10 -10"></path>
+<path d="M40 31a10 10 0 0 1 10 10v70a10 10 0 0 0 10 10"></path>
+<g>
+<path d="M60 121h0"></path>
+<path d="M252 121h0"></path>
+<path d="M60 121h10"></path>
+<g>
+<path d="M70 121h0"></path>
+<path d="M130 121h0"></path>
+<rect x="70" y="110" width="60" height="22" rx="10" ry="10"></rect>
+<text x="100" y="125">ICMP6</text>
+</g>
+<path d="M130 121h10"></path>
+<path d="M140 121h10"></path>
+<g>
+<path d="M150 121h0"></path>
+<path d="M242 121h0"></path>
+<rect x="150" y="110" width="92" height="22"></rect>
+<text x="196" y="125">type&#95;list</text>
+</g>
+<path d="M242 121h10"></path>
+</g>
+<path d="M252 121a10 10 0 0 0 10 -10v-70a10 10 0 0 1 10 -10"></path>
+</g>
+<path d="M 272 31 h 20 m -10 -10 v 20 m 10 -20 v 20"></path>
+</g>
+</svg>
diff --git a/docs/media/img/rule.svg b/docs/media/img/rule.svg
new file mode 100644
index 0000000..3d54538
--- /dev/null
+++ b/docs/media/img/rule.svg
@@ -0,0 +1,90 @@
+<?xml version="1.0" encoding="utf-8" standalone="no"?>
+<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
+<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" class="railroad-diagram" width="669" height="92" viewBox="0 0 669 92">
+<defs><style type="text/css"><![CDATA[
+svg.railroad-diagram path {
+  stroke-width: 3;
+  stroke: black;
+  fill: none;
+}
+svg.railroad-diagram text {
+  font: bold 14px monospace;
+  text-anchor: middle;
+}
+svg.railroad-diagram text.label {
+  text-anchor: start;
+}
+svg.railroad-diagram text.comment {
+  font: italic 12px monospace;
+}
+svg.railroad-diagram rect {
+  stroke-width: 3;
+  stroke: black;
+  fill: hsl(120,100%,90%);
+}
+ ]]></style></defs>
+<g transform="translate(.5 .5)">
+<path d="M 20 21 v 20 m 10 -20 v 20 m -10 -10 h 20.5"></path>
+<path d="M40 31h10"></path>
+<g>
+<path d="M50 31h0"></path>
+<path d="M102 31h0"></path>
+<rect x="50" y="20" width="52" height="22" rx="10" ry="10"></rect>
+<text x="76" y="35">FROM</text>
+</g>
+<path d="M102 31h10"></path>
+<path d="M112 31h10"></path>
+<g>
+<path d="M122 31h0"></path>
+<path d="M230 31h0"></path>
+<rect x="122" y="20" width="108" height="22"></rect>
+<text x="176" y="35">target&#95;list</text>
+</g>
+<path d="M230 31h10"></path>
+<path d="M240 31h10"></path>
+<g>
+<path d="M250 31h0"></path>
+<path d="M286 31h0"></path>
+<rect x="250" y="20" width="36" height="22" rx="10" ry="10"></rect>
+<text x="268" y="35">TO</text>
+</g>
+<path d="M286 31h10"></path>
+<path d="M296 31h10"></path>
+<g>
+<path d="M306 31h0"></path>
+<path d="M414 31h0"></path>
+<rect x="306" y="20" width="108" height="22"></rect>
+<text x="360" y="35">target&#95;list</text>
+</g>
+<path d="M414 31h10"></path>
+<g>
+<path d="M424 31h0"></path>
+<path d="M524 31h0"></path>
+<path d="M424 31h20"></path>
+<g>
+<path d="M444 31h0"></path>
+<path d="M504 31h0"></path>
+<rect x="444" y="20" width="60" height="22" rx="10" ry="10"></rect>
+<text x="474" y="35">ALLOW</text>
+</g>
+<path d="M504 31h20"></path>
+<path d="M424 31a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"></path>
+<g>
+<path d="M444 61h0"></path>
+<path d="M504 61h0"></path>
+<rect x="444" y="50" width="60" height="22" rx="10" ry="10"></rect>
+<text x="474" y="65">BLOCK</text>
+</g>
+<path d="M504 61a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"></path>
+</g>
+<path d="M524 31h10"></path>
+<g>
+<path d="M534 31h0"></path>
+<path d="M618 31h0"></path>
+<rect x="534" y="20" width="84" height="22"></rect>
+<text x="576" y="35">protocol</text>
+</g>
+<path d="M618 31h10"></path>
+<path d="M 628 31 h 20 m -10 -10 v 20 m 10 -20 v 20"></path>
+</g>
+</svg>
diff --git a/docs/media/img/target-list.svg b/docs/media/img/target-list.svg
new file mode 100644
index 0000000..017e127
--- /dev/null
+++ b/docs/media/img/target-list.svg
@@ -0,0 +1,102 @@
+<?xml version="1.0" encoding="utf-8" standalone="no"?>
+<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
+<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" class="railroad-diagram" width="325" height="182" viewBox="0 0 325 182">
+<defs><style type="text/css"><![CDATA[
+svg.railroad-diagram path {
+  stroke-width: 3;
+  stroke: black;
+  fill: none;
+}
+svg.railroad-diagram text {
+  font: bold 14px monospace;
+  text-anchor: middle;
+}
+svg.railroad-diagram text.label {
+  text-anchor: start;
+}
+svg.railroad-diagram text.comment {
+  font: italic 12px monospace;
+}
+svg.railroad-diagram rect {
+  stroke-width: 3;
+  stroke: black;
+  fill: hsl(120,100%,90%);
+}
+ ]]></style></defs>
+<g transform="translate(.5 .5)">
+<path d="M 20 21 v 20 m 10 -20 v 20 m -10 -10 h 20.5"></path>
+<g>
+<path d="M40 31h0"></path>
+<path d="M284 31h0"></path>
+<path d="M40 31h20"></path>
+<g>
+<path d="M60 31h80"></path>
+<path d="M184 31h80"></path>
+<rect x="140" y="20" width="44" height="22" rx="10" ry="10"></rect>
+<text x="162" y="35">ANY</text>
+</g>
+<path d="M264 31h20"></path>
+<path d="M40 31a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"></path>
+<g>
+<path d="M60 61h64"></path>
+<path d="M200 61h64"></path>
+<rect x="124" y="50" width="76" height="22" rx="10" ry="10"></rect>
+<text x="162" y="65">ALL VMS</text>
+</g>
+<path d="M264 61a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"></path>
+<path d="M40 31a10 10 0 0 1 10 10v40a10 10 0 0 0 10 10"></path>
+<g>
+<path d="M60 91h0"></path>
+<path d="M264 91h0"></path>
+<path d="M60 91h10"></path>
+<g>
+<path d="M70 91h0"></path>
+<path d="M98 91h0"></path>
+<rect x="70" y="80" width="28" height="22" rx="10" ry="10"></rect>
+<text x="84" y="95">(</text>
+</g>
+<path d="M98 91h10"></path>
+<path d="M108 91h10"></path>
+<g>
+<path d="M118 91h0"></path>
+<path d="M206 91h0"></path>
+<path d="M118 91h10"></path>
+<g>
+<path d="M128 91h0"></path>
+<path d="M196 91h0"></path>
+<rect x="128" y="80" width="68" height="22"></rect>
+<text x="162" y="95">target</text>
+</g>
+<path d="M196 91h10"></path>
+<path d="M128 91a10 10 0 0 0 -10 10v10a10 10 0 0 0 10 10"></path>
+<g>
+<path d="M128 121h16"></path>
+<path d="M180 121h16"></path>
+<rect x="144" y="110" width="36" height="22" rx="10" ry="10"></rect>
+<text x="162" y="125">OR</text>
+</g>
+<path d="M196 121a10 10 0 0 0 10 -10v-10a10 10 0 0 0 -10 -10"></path>
+</g>
+<path d="M206 91h10"></path>
+<path d="M216 91h10"></path>
+<g>
+<path d="M226 91h0"></path>
+<path d="M254 91h0"></path>
+<rect x="226" y="80" width="28" height="22" rx="10" ry="10"></rect>
+<text x="240" y="95">)</text>
+</g>
+<path d="M254 91h10"></path>
+</g>
+<path d="M264 91a10 10 0 0 0 10 -10v-40a10 10 0 0 1 10 -10"></path>
+<path d="M40 31a10 10 0 0 1 10 10v100a10 10 0 0 0 10 10"></path>
+<g>
+<path d="M60 151h68"></path>
+<path d="M196 151h68"></path>
+<rect x="128" y="140" width="68" height="22"></rect>
+<text x="162" y="155">target</text>
+</g>
+<path d="M264 151a10 10 0 0 0 10 -10v-100a10 10 0 0 1 10 -10"></path>
+</g>
+<path d="M 284 31 h 20 m -10 -10 v 20 m 10 -20 v 20"></path>
+</g>
+</svg>
diff --git a/docs/media/img/target.svg b/docs/media/img/target.svg
new file mode 100644
index 0000000..a90ed03
--- /dev/null
+++ b/docs/media/img/target.svg
@@ -0,0 +1,160 @@
+<?xml version="1.0" encoding="utf-8" standalone="no"?>
+<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
+<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" class="railroad-diagram" width="465" height="182" viewBox="0 0 465 182">
+<defs><style type="text/css"><![CDATA[
+svg.railroad-diagram path {
+  stroke-width: 3;
+  stroke: black;
+  fill: none;
+}
+svg.railroad-diagram text {
+  font: bold 14px monospace;
+  text-anchor: middle;
+}
+svg.railroad-diagram text.label {
+  text-anchor: start;
+}
+svg.railroad-diagram text.comment {
+  font: italic 12px monospace;
+}
+svg.railroad-diagram rect {
+  stroke-width: 3;
+  stroke: black;
+  fill: hsl(120,100%,90%);
+}
+ ]]></style></defs>
+<g transform="translate(.5 .5)">
+<path d="M 20 21 v 20 m 10 -20 v 20 m -10 -10 h 20.5"></path>
+<g>
+<path d="M40 31h0"></path>
+<path d="M424 31h0"></path>
+<path d="M40 31h20"></path>
+<g>
+<path d="M60 31h96"></path>
+<path d="M308 31h96"></path>
+<path d="M156 31h10"></path>
+<g>
+<path d="M166 31h0"></path>
+<path d="M202 31h0"></path>
+<rect x="166" y="20" width="36" height="22" rx="10" ry="10"></rect>
+<text x="184" y="35">IP</text>
+</g>
+<path d="M202 31h10"></path>
+<path d="M212 31h10"></path>
+<g>
+<path d="M222 31h0"></path>
+<path d="M298 31h0"></path>
+<rect x="222" y="20" width="76" height="22"></rect>
+<text x="260" y="35">address</text>
+</g>
+<path d="M298 31h10"></path>
+</g>
+<path d="M404 31h20"></path>
+<path d="M40 31a10 10 0 0 1 10 10v10a10 10 0 0 0 10 10"></path>
+<g>
+<path d="M60 61h92"></path>
+<path d="M312 61h92"></path>
+<path d="M152 61h10"></path>
+<g>
+<path d="M162 61h0"></path>
+<path d="M230 61h0"></path>
+<rect x="162" y="50" width="68" height="22" rx="10" ry="10"></rect>
+<text x="196" y="65">SUBNET</text>
+</g>
+<path d="M230 61h10"></path>
+<path d="M240 61h10"></path>
+<g>
+<path d="M250 61h0"></path>
+<path d="M302 61h0"></path>
+<rect x="250" y="50" width="52" height="22"></rect>
+<text x="276" y="65">cidr</text>
+</g>
+<path d="M302 61h10"></path>
+</g>
+<path d="M404 61a10 10 0 0 0 10 -10v-10a10 10 0 0 1 10 -10"></path>
+<path d="M40 31a10 10 0 0 1 10 10v40a10 10 0 0 0 10 10"></path>
+<g>
+<path d="M60 91h80"></path>
+<path d="M324 91h80"></path>
+<path d="M140 91h10"></path>
+<g>
+<path d="M150 91h0"></path>
+<path d="M194 91h0"></path>
+<rect x="150" y="80" width="44" height="22" rx="10" ry="10"></rect>
+<text x="172" y="95">TAG</text>
+</g>
+<path d="M194 91h10"></path>
+<path d="M204 91h10"></path>
+<g>
+<path d="M214 91h0"></path>
+<path d="M314 91h0"></path>
+<rect x="214" y="80" width="100" height="22"></rect>
+<text x="264" y="95">tag&#95;string</text>
+</g>
+<path d="M314 91h10"></path>
+</g>
+<path d="M404 91a10 10 0 0 0 10 -10v-40a10 10 0 0 1 10 -10"></path>
+<path d="M40 31a10 10 0 0 1 10 10v70a10 10 0 0 0 10 10"></path>
+<g>
+<path d="M60 121h0"></path>
+<path d="M404 121h0"></path>
+<path d="M60 121h10"></path>
+<g>
+<path d="M70 121h0"></path>
+<path d="M114 121h0"></path>
+<rect x="70" y="110" width="44" height="22" rx="10" ry="10"></rect>
+<text x="92" y="125">TAG</text>
+</g>
+<path d="M114 121h10"></path>
+<path d="M124 121h10"></path>
+<g>
+<path d="M134 121h0"></path>
+<path d="M234 121h0"></path>
+<rect x="134" y="110" width="100" height="22"></rect>
+<text x="184" y="125">tag&#95;string</text>
+</g>
+<path d="M234 121h10"></path>
+<path d="M244 121h10"></path>
+<g>
+<path d="M254 121h0"></path>
+<path d="M282 121h0"></path>
+<rect x="254" y="110" width="28" height="22" rx="10" ry="10"></rect>
+<text x="268" y="125">=</text>
+</g>
+<path d="M282 121h10"></path>
+<path d="M292 121h10"></path>
+<g>
+<path d="M302 121h0"></path>
+<path d="M394 121h0"></path>
+<rect x="302" y="110" width="92" height="22"></rect>
+<text x="348" y="125">tag&#95;value</text>
+</g>
+<path d="M394 121h10"></path>
+</g>
+<path d="M404 121a10 10 0 0 0 10 -10v-70a10 10 0 0 1 10 -10"></path>
+<path d="M40 31a10 10 0 0 1 10 10v100a10 10 0 0 0 10 10"></path>
+<g>
+<path d="M60 151h108"></path>
+<path d="M296 151h108"></path>
+<path d="M168 151h10"></path>
+<g>
+<path d="M178 151h0"></path>
+<path d="M214 151h0"></path>
+<rect x="178" y="140" width="36" height="22" rx="10" ry="10"></rect>
+<text x="196" y="155">VM</text>
+</g>
+<path d="M214 151h10"></path>
+<path d="M224 151h10"></path>
+<g>
+<path d="M234 151h0"></path>
+<path d="M286 151h0"></path>
+<rect x="234" y="140" width="52" height="22"></rect>
+<text x="260" y="155">uuid</text>
+</g>
+<path d="M286 151h10"></path>
+</g>
+<path d="M404 151a10 10 0 0 0 10 -10v-100a10 10 0 0 1 10 -10"></path>
+</g>
+<path d="M 424 31 h 20 m -10 -10 v 20 m 10 -20 v 20"></path>
+</g>
+</svg>
diff --git a/docs/media/img/type-list.svg b/docs/media/img/type-list.svg
new file mode 100644
index 0000000..c2ca2ab
--- /dev/null
+++ b/docs/media/img/type-list.svg
@@ -0,0 +1,131 @@
+<?xml version="1.0" encoding="utf-8" standalone="no"?>
+<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
+<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" class="railroad-diagram" width="633" height="132" viewBox="0 0 633 132">
+<defs><style type="text/css"><![CDATA[
+svg.railroad-diagram path {
+  stroke-width: 3;
+  stroke: black;
+  fill: none;
+}
+svg.railroad-diagram text {
+  font: bold 14px monospace;
+  text-anchor: middle;
+}
+svg.railroad-diagram text.label {
+  text-anchor: start;
+}
+svg.railroad-diagram text.comment {
+  font: italic 12px monospace;
+}
+svg.railroad-diagram rect {
+  stroke-width: 3;
+  stroke: black;
+  fill: hsl(120,100%,90%);
+}
+ ]]></style></defs>
+<g transform="translate(.5 .5)">
+<path d="M 20 31 v 20 m 10 -20 v 20 m -10 -10 h 20.5"></path>
+<g>
+<path d="M40 41h0"></path>
+<path d="M592 41h0"></path>
+<path d="M40 41h20"></path>
+<g>
+<path d="M60 41h0"></path>
+<path d="M572 41h0"></path>
+<path d="M60 41h10"></path>
+<g>
+<path d="M70 41h0"></path>
+<path d="M98 41h0"></path>
+<rect x="70" y="30" width="28" height="22" rx="10" ry="10"></rect>
+<text x="84" y="45">(</text>
+</g>
+<path d="M98 41h10"></path>
+<path d="M108 41h10"></path>
+<g>
+<path d="M118 41h0"></path>
+<path d="M514 41h0"></path>
+<path d="M118 41h10"></path>
+<g>
+<path d="M128 41h0"></path>
+<path d="M504 41h0"></path>
+<path d="M128 41h10"></path>
+<g>
+<path d="M138 41h0"></path>
+<path d="M190 41h0"></path>
+<rect x="138" y="30" width="52" height="22" rx="10" ry="10"></rect>
+<text x="164" y="45">TYPE</text>
+</g>
+<path d="M190 41h10"></path>
+<path d="M200 41h10"></path>
+<g>
+<path d="M210 41h0"></path>
+<path d="M286 41h0"></path>
+<rect x="210" y="30" width="76" height="22" rx="10" ry="10"></rect>
+<text x="248" y="45">0 - 255</text>
+</g>
+<path d="M286 41h10"></path>
+<g>
+<path d="M296 41h0"></path>
+<path d="M504 41h0"></path>
+<path d="M296 41a10 10 0 0 0 10 -10v0a10 10 0 0 1 10 -10"></path>
+<g>
+<path d="M316 21h168"></path>
+</g>
+<path d="M484 21a10 10 0 0 1 10 10v0a10 10 0 0 0 10 10"></path>
+<path d="M296 41h20"></path>
+<g>
+<path d="M316 41h0"></path>
+<path d="M484 41h0"></path>
+<path d="M316 41h10"></path>
+<g>
+<path d="M326 41h0"></path>
+<path d="M378 41h0"></path>
+<rect x="326" y="30" width="52" height="22" rx="10" ry="10"></rect>
+<text x="352" y="45">CODE</text>
+</g>
+<path d="M378 41h10"></path>
+<path d="M388 41h10"></path>
+<g>
+<path d="M398 41h0"></path>
+<path d="M474 41h0"></path>
+<rect x="398" y="30" width="76" height="22" rx="10" ry="10"></rect>
+<text x="436" y="45">0 - 255</text>
+</g>
+<path d="M474 41h10"></path>
+</g>
+<path d="M484 41h20"></path>
+</g>
+</g>
+<path d="M504 41h10"></path>
+<path d="M128 41a10 10 0 0 0 -10 10v10a10 10 0 0 0 10 10"></path>
+<g>
+<path d="M128 71h166"></path>
+<path d="M338 71h166"></path>
+<rect x="294" y="60" width="44" height="22" rx="10" ry="10"></rect>
+<text x="316" y="75">AND</text>
+</g>
+<path d="M504 71a10 10 0 0 0 10 -10v-10a10 10 0 0 0 -10 -10"></path>
+</g>
+<path d="M514 41h10"></path>
+<path d="M524 41h10"></path>
+<g>
+<path d="M534 41h0"></path>
+<path d="M562 41h0"></path>
+<rect x="534" y="30" width="28" height="22" rx="10" ry="10"></rect>
+<text x="548" y="45">)</text>
+</g>
+<path d="M562 41h10"></path>
+</g>
+<path d="M572 41h20"></path>
+<path d="M40 41a10 10 0 0 1 10 10v40a10 10 0 0 0 10 10"></path>
+<g>
+<path d="M60 101h214"></path>
+<path d="M358 101h214"></path>
+<rect x="274" y="90" width="84" height="22" rx="10" ry="10"></rect>
+<text x="316" y="105">TYPE ALL</text>
+</g>
+<path d="M572 101a10 10 0 0 0 10 -10v-40a10 10 0 0 1 10 -10"></path>
+</g>
+<path d="M 592 41 h 20 m -10 -10 v 20 m 10 -20 v 20"></path>
+</g>
+</svg>
diff --git a/docs/rules.md b/docs/rules.md
index 60f71e9..ec29e0d 100644
--- a/docs/rules.md
+++ b/docs/rules.md
@@ -51,40 +51,30 @@ a rule.
 
 Firewall rules are in the following format:
 
-    FROM &lt;from targets> TO &lt;to targets> &lt;action> &lt;protocol> &lt;ports or types>
-    
-The parameters are the following:
+<p style="text-align: center">
+<img alt="Rules are of the form: FROM target_list TO target_list action protocol ports/types" src="./media/img/rule.svg" />
+</p>
 
-**from targets** and **to targets** can be any of the following types
-(see the Target Types section below):
-
-* vm &lt;uuid>
-* ip &lt;IPv4 or IPv6 address>
-* subnet &lt;subnet CIDR>
-* tag &lt;tag name>
-* tag &lt;tag name>=&lt;tag value>
-* a target list of up to 32 of the above
-* all vms
-* any
+Affected sources and destinations can be defined as a list of targets in the
+following syntax:
 
-**action** can be one of (see the Actions section below):
+<p style="text-align: center">
+<img alt="Target List Keywords: ALL VMS, ANY, or a list of targets separated by OR" src="./media/img/target-list.svg" />
+</p>
 
-* ALLOW
-* BLOCK
+**from targets** and **to targets** can be any of the following types
+(see the Target Types section below):
 
-**protocol** can be one of (see the Protocols section below):
+<p style="text-align: center">
+<img alt="Target Keywords: VM, IP, SUBNET, TAG" src="./media/img/target.svg" />
+</p>
 
-* tcp
-* udp
-* icmp
-* icmp6
+Protocols can be targeted using:
 
-**ports** or **types** can be one of (see the Ports section below):
+<p style="text-align: center">
+<img alt="Protocol Keywords: TCP, UDP, ICMP, ICMP6" src="./media/img/protocol.svg" />
+</p>
 
-* port &lt;port number> (if protocol is tcp or udp)
-* ports &lt;port numbers and ranges> (if protocol is tcp or udp)
-* type &lt;ICMP type> (if protocol is icmp)
-* type &lt;ICMP type> code &lt;ICMP code> (if protocol is icmp)
 
 
 The limits for the parameters are:
@@ -98,7 +88,7 @@ The limits for the parameters are:
 
 ## vm
 
-    vm &lt;uuid>
+    vm <uuid>
 
 Targets the VM with that UUID.
 
@@ -110,7 +100,7 @@ Allows HTTP traffic from any host to VM 04128...
 
 ## ip
 
-    ip &lt;IP address>
+    ip <IP address>
 
 Targets the specified IPv4 or IPv6 address.
 
@@ -122,7 +112,7 @@ Blocks SMTP traffic to that IP.
 
 ## subnet
 
-    subnet &lt;subnet CIDR>
+    subnet <subnet CIDR>
 
 Targets the specified IPv4 or IPv6 subnet range.
 
@@ -140,9 +130,9 @@ Allows HTTPS traffic from a private IPv6 /64 to the specified VM.
 
 ## tag
 
-    tag &lt;name>
-    tag &lt;name> = &lt;value>
-    tag "&lt;name with spaces>" = "&lt;value with spaces>"
+    tag <name>
+    tag <name> = <value>
+    tag "<name with spaces>" = "<value with spaces>"
 
 Targets all VMs with the specified tag, or all VMs with the specified tag
 and value.  Both tag name and value can be quoted if they contain spaces.
@@ -188,7 +178,7 @@ Allows HTTP traffic from any IP to all VMs.
 
 ## target list
 
-    ( &lt;target> OR &lt;target> OR ... )
+    ( <target> OR <target> OR ... )
 
 The vm, ip, subnet and tag target types can be combined into a list surrounded
 by parentheses and joined by OR.
@@ -233,13 +223,9 @@ ports or types can be used (see the Ports section below).
 
 # Ports
 
-    port &lt;port number>
-    ( port &lt;port number> AND port &lt;port number> ... )
-    ports &lt;port number or range>
-    ports &lt;port number or range>, &lt;port number or range>, ...
-    type &lt;icmp type>
-    type &lt;icmp type> code &lt;icmp code>
-    ( type &lt;icmp type> AND type &lt;icmp type> code &lt;icmp code> AND ... )
+<p style="text-align: center">
+<img alt="All, specific, or ranges of ports can be allowed and blocked" src="./media/img/port-list.svg" />
+</p>
 
 For TCP and UDP, this specifies the port numbers that the rule applies to.
 Port numbers must be between 1 and 65535, inclusive. Ranges are written as two
@@ -247,9 +233,6 @@ port numbers separated by a - (hyphen), with the lower number coming first, with
 optional spaces around the hyphen. Port ranges are inclusive, so writing the
 range "20 - 22" would cause the rule to apply to the ports 20, 21 and 22.
 
-For ICMP, this specifies the ICMP type and optional code that the rule
-applies to.  Types and codes must be between 0 and 255, inclusive.
-
 **Examples:**
 
     FROM tag www TO any ALLOW tcp (port 80 AND port 443)
@@ -261,6 +244,18 @@ Allows HTTP and HTTPS traffic from any IP to all webservers.
 Allows traffic on HTTP, HTTPS and common alternative HTTP ports from any IP to
 all webservers.
 
+
+# ICMP Types
+
+<p style="text-align: center">
+<img alt="All ICMP types can be specified, or a list of specific ones" src="./media/img/type-list.svg" />
+</p>
+
+For ICMP, this specifies the ICMP type and optional code that the rule
+applies to.  Types and codes must be between 0 and 255, inclusive.
+
+**Examples:**
+
     FROM any TO all vms ALLOW icmp TYPE 8 CODE 0
 
 Allows pinging all VMs. The IPv6 equivalent would be:
diff --git a/docs/rules.md.in b/docs/rules.md.in
index 51f83cb..8a08320 100644
--- a/docs/rules.md.in
+++ b/docs/rules.md.in
@@ -51,8 +51,35 @@ a rule.
 
 Firewall rules are in the following format:
 
+{{#images}}
+<p style="text-align: center">
+<img alt="Rules are of the form: FROM target_list TO target_list action protocol ports/types" src="./media/img/rule.svg" />
+</p>
+
+Affected sources and destinations can be defined as a list of targets in the
+following syntax:
+
+<p style="text-align: center">
+<img alt="Target List Keywords: ALL VMS, ANY, or a list of targets separated by OR" src="./media/img/target-list.svg" />
+</p>
+
+**from targets** and **to targets** can be any of the following types
+(see the Target Types section below):
+
+<p style="text-align: center">
+<img alt="Target Keywords: VM, IP, SUBNET, TAG" src="./media/img/target.svg" />
+</p>
+
+Protocols can be targeted using:
+
+<p style="text-align: center">
+<img alt="Protocol Keywords: TCP, UDP, ICMP, ICMP6" src="./media/img/protocol.svg" />
+</p>
+
+{{/images}}
+{{^images}}
     {{#indent_and_wrap}}
-    FROM &lt;from targets> TO &lt;to targets> &lt;action> &lt;protocol> &lt;ports or types>
+    FROM <from targets> TO <to targets> <action> <protocol> <ports or types>
     {{/indent_and_wrap}}
 
 The parameters are the following:
@@ -87,6 +114,7 @@ The parameters are the following:
 * ports &lt;port numbers and ranges> (if protocol is tcp or udp)
 * type &lt;ICMP type> (if protocol is icmp)
 * type &lt;ICMP type> code &lt;ICMP code> (if protocol is icmp)
+{{/images}}
 
 
 The limits for the parameters are:
@@ -100,7 +128,7 @@ The limits for the parameters are:
 
 ## vm
 
-    vm &lt;uuid>
+    vm <uuid>
 
 Targets the VM with that UUID.
 
@@ -112,7 +140,7 @@ Allows HTTP traffic from any host to VM 04128...
 
 ## ip
 
-    ip &lt;IP address>
+    ip <IP address>
 
 Targets the specified IPv4 or IPv6 address.
 
@@ -124,7 +152,7 @@ Blocks SMTP traffic to that IP.
 
 ## subnet
 
-    subnet &lt;subnet CIDR>
+    subnet <subnet CIDR>
 
 Targets the specified IPv4 or IPv6 subnet range.
 
@@ -146,9 +174,9 @@ Allows HTTPS traffic from a private IPv6 /64 to the specified VM.
 
 ## tag
 
-    tag &lt;name>
-    tag &lt;name> = &lt;value>
-    tag "&lt;name with spaces>" = "&lt;value with spaces>"
+    tag <name>
+    tag <name> = <value>
+    tag "<name with spaces>" = "<value with spaces>"
 
 Targets all VMs with the specified tag, or all VMs with the specified tag
 and value.  Both tag name and value can be quoted if they contain spaces.
@@ -194,7 +222,7 @@ Allows HTTP traffic from any IP to all VMs.
 
 ## target list
 
-    ( &lt;target> OR &lt;target> OR ... )
+    ( <target> OR <target> OR ... )
 
 The vm, ip, subnet and tag target types can be combined into a list surrounded
 by parentheses and joined by OR.
@@ -241,13 +269,18 @@ ports or types can be used (see the Ports section below).
 
 # Ports
 
-    port &lt;port number>
-    ( port &lt;port number> AND port &lt;port number> ... )
-    ports &lt;port number or range>
-    ports &lt;port number or range>, &lt;port number or range>, ...
-    type &lt;icmp type>
-    type &lt;icmp type> code &lt;icmp code>
-    ( type &lt;icmp type> AND type &lt;icmp type> code &lt;icmp code> AND ... )
+{{#images}}
+<p style="text-align: center">
+<img alt="All, specific, or ranges of ports can be allowed and blocked" src="./media/img/port-list.svg" />
+</p>
+{{/images}}
+{{^images}}
+    port all
+    port <port number>
+    ( port <port number> AND port <port number> ... )
+    ports <port number or range>
+    ports <port number or range>, <port number or range>, ...
+{{/images}}
 
 For TCP and UDP, this specifies the port numbers that the rule applies to.
 Port numbers must be between 1 and 65535, inclusive. Ranges are written as two
@@ -255,9 +288,6 @@ port numbers separated by a - (hyphen), with the lower number coming first, with
 optional spaces around the hyphen. Port ranges are inclusive, so writing the
 range "20 - 22" would cause the rule to apply to the ports 20, 21 and 22.
 
-For ICMP, this specifies the ICMP type and optional code that the rule
-applies to.  Types and codes must be between 0 and 255, inclusive.
-
 **Examples:**
 
     FROM tag www TO any ALLOW tcp (port 80 AND port 443)
@@ -269,6 +299,26 @@ Allows HTTP and HTTPS traffic from any IP to all webservers.
 Allows traffic on HTTP, HTTPS and common alternative HTTP ports from any IP to
 all webservers.
 
+
+# ICMP Types
+
+{{#images}}
+<p style="text-align: center">
+<img alt="All ICMP types can be specified, or a list of specific ones" src="./media/img/type-list.svg" />
+</p>
+{{/images}}
+{{^images}}
+    type all
+    type <icmp type>
+    type <icmp type> code <icmp code>
+    ( type <icmp type> AND type <icmp type> code <icmp code> AND ... )
+{{/images}}
+
+For ICMP, this specifies the ICMP type and optional code that the rule
+applies to.  Types and codes must be between 0 and 255, inclusive.
+
+**Examples:**
+
     FROM any TO all vms ALLOW icmp TYPE 8 CODE 0
 
 Allows pinging all VMs. The IPv6 equivalent would be:
diff --git a/etc/rules.json b/etc/rules.json
new file mode 100644
index 0000000..8056063
--- /dev/null
+++ b/etc/rules.json
@@ -0,0 +1,3 @@
+{
+    "images": true
+}
diff --git a/package.json b/package.json
index 8b542da..c7f727d 100644
--- a/package.json
+++ b/package.json
@@ -19,6 +19,7 @@
     "eslint-plugin-joyent": "1.3.0",
     "faucet": "0.0.1",
     "istanbul": "^0.4.0",
+    "railroad-diagrams": "1.0.0",
     "jison": "0.4.2",
     "tape": "^4.2.2",
     "ramsey": "0.1.2"
diff --git a/tools/gen-rr-svgs.js b/tools/gen-rr-svgs.js
new file mode 100755
index 0000000..bb8e125
--- /dev/null
+++ b/tools/gen-rr-svgs.js
@@ -0,0 +1,120 @@
+#! /usr/bin/env node
+
+var mod_fs = require('fs');
+var mod_path = require('path');
+var mod_rr = require('railroad-diagrams');
+
+var Choice = mod_rr.Choice;
+var Diagram = mod_rr.Diagram;
+var NonTerminal = mod_rr.NonTerminal;
+var OneOrMore = mod_rr.OneOrMore;
+var Optional = mod_rr.Optional;
+var Sequence = mod_rr.Sequence;
+var Terminal = mod_rr.Terminal;
+var ZeroOrMore = mod_rr.ZeroOrMore;
+
+var destdir = mod_path.join(__dirname, '..', 'docs', 'media', 'img');
+var svgheader = [
+    '<?xml version="1.0" encoding="utf-8" standalone="no"?>',
+    '<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"' +
+    ' "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">',
+    '<svg xmlns="http://www.w3.org/2000/svg"' +
+    ' xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" $1>',
+    '<defs><style type="text/css"><![CDATA[',
+    'svg.railroad-diagram path {',
+    '  stroke-width: 3;',
+    '  stroke: black;',
+    '  fill: none;',
+    '}',
+    'svg.railroad-diagram text {',
+    '  font: bold 14px monospace;',
+    '  text-anchor: middle;',
+    '}',
+    'svg.railroad-diagram text.label {',
+    '  text-anchor: start;',
+    '}',
+    'svg.railroad-diagram text.comment {',
+    '  font: italic 12px monospace;',
+    '}',
+    'svg.railroad-diagram rect {',
+    '  stroke-width: 3;',
+    '  stroke: black;',
+    '  fill: hsl(120,100%,90%);',
+    '}',
+    ' ]]></style></defs>'
+].join('\n');
+
+
+var ruleDiagram = Diagram(
+  Terminal('FROM'),
+  NonTerminal('target_list'),
+  Terminal('TO'),
+  NonTerminal('target_list'),
+  Choice(0,
+    Terminal('ALLOW'),
+    Terminal('BLOCK')),
+  NonTerminal('protocol'));
+
+var targetListDiagram = Diagram(
+    Choice(0,
+        Terminal('ANY'),
+        Terminal('ALL VMS'),
+        Sequence(
+            Terminal('('),
+            OneOrMore(NonTerminal('target'), Terminal('OR')),
+            Terminal(')')),
+        NonTerminal('target')));
+
+var targetDiagram = Diagram(
+    Choice(0,
+        Sequence(Terminal('IP'), NonTerminal('address')),
+        Sequence(Terminal('SUBNET'), NonTerminal('cidr')),
+        Sequence(Terminal('TAG'), NonTerminal('tag_string')),
+        Sequence(
+          Terminal('TAG'), NonTerminal('tag_string'),
+          Terminal('='),
+          NonTerminal('tag_value')),
+        Sequence(Terminal('VM'), NonTerminal('uuid'))));
+
+var protoDiagram = Diagram(
+    Choice(0,
+        Sequence(Terminal('TCP'), NonTerminal('port_list')),
+        Sequence(Terminal('UDP'), NonTerminal('port_list')),
+        Sequence(Terminal('ICMP'), NonTerminal('type_list')),
+        Sequence(Terminal('ICMP6'), NonTerminal('type_list'))));
+
+var portListDiagram = Diagram(
+    Choice(0,
+        Sequence(
+            Terminal('('),
+            OneOrMore(
+                Sequence(Terminal('PORT'), NonTerminal('port')),
+                Terminal('AND')),
+            Terminal(')')),
+        Sequence(Terminal('PORTS'), OneOrMore(NonTerminal('portrange'), Terminal(','))),
+        Terminal('PORT ALL')));
+
+var typeListDiagram = Diagram(
+    Choice(0,
+        Sequence(
+            Terminal('('),
+            OneOrMore(Sequence(
+            Terminal('TYPE'),
+            Terminal('0 - 255'),
+            Optional(Sequence(Terminal('CODE'), Terminal('0 - 255')))), Terminal('AND')),
+            Terminal(')')),
+        Terminal('TYPE ALL')));
+
+function writeDiagram(diag, filename) {
+    var p = mod_path.join(destdir, filename);
+    var s = diag.format().toString().replace(/<svg ([^>]*)>/, svgheader);
+
+    mod_fs.writeFileSync(p, s);
+}
+
+writeDiagram(ruleDiagram, 'rule.svg');
+writeDiagram(targetListDiagram, 'target-list.svg');
+writeDiagram(targetDiagram, 'target.svg');
+writeDiagram(protoDiagram, 'protocol.svg');
+writeDiagram(portListDiagram, 'port-list.svg');
+writeDiagram(typeListDiagram, 'type-list.svg');
