{"project":"joyent/manta-mako","branch":"master","id":"I6cf64f039140e394906ae10c544eca77dd7d8e3f","number":"5032","subject":"MANTA-4015 Add mako datacenter to header information when uploading mako manifest Reviewed by: David Pacheco \u003cdap@joyent.com\u003e Approved by: Jan Wyszynski \u003cjan.wyszynski@joyent.com\u003e","owner":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"url":"https://cr.joyent.us/5032","commitMessage":"MANTA-4015 Add mako datacenter to header information when uploading mako manifest\nReviewed by: David Pacheco \u003cdap@joyent.com\u003e\nApproved by: Jan Wyszynski \u003cjan.wyszynski@joyent.com\u003e\n","createdOn":1541464814,"lastUpdated":1542321994,"open":false,"status":"MERGED","comments":[{"timestamp":1541464814,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Uploaded patch set 1."},{"timestamp":1541464841,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1541702480,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Uploaded patch set 2."},{"timestamp":1541702507,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1541727840,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Patch Set 2:\n\n(4 comments)"},{"timestamp":1541728465,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Patch Set 2:\n\n(2 comments)"},{"timestamp":1541784870,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Uploaded patch set 3."},{"timestamp":1541784896,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1541784927,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Patch Set 3:\n\n(2 comments)"},{"timestamp":1541801568,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1541808865,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 3:\n\n(1 comment)"},{"timestamp":1541809889,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Uploaded patch set 4."},{"timestamp":1541809916,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1541809975,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Patch Set 4:\n\n(1 comment)"},{"timestamp":1541810156,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Patch Set 4:\n\nAlso worth mentioning is that I removed some of the whitespace in this file because I thought that it was over-gratuitous."},{"timestamp":1542235117,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 4: Code-Review+1"},{"timestamp":1542312666,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Patch Set 4: Integration-Approval+1\n\nTesting seems to be sufficient for this relatively low-risk change. I can\u0027t think of any other cases we\u0027d need."},{"timestamp":1542321980,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Uploaded patch set 5: Commit message was updated."},{"timestamp":1542321994,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Robert Bogart"}],"currentPatchSet":{"number":"5","revision":"6cf64f039140e394906ae10c544eca77dd7d8e3f","parents":["bec43535c914a9455b244cd47bc77697c3423f10"],"ref":"refs/changes/32/5032/5","uploader":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"createdOn":1542321980,"author":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1541809916,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1542235117,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1542312666,"by":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"}},{"type":"SUBM","value":"1","grantedOn":1542321994,"by":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"bin/upload_mako_ls.sh","type":"MODIFIED","insertions":8,"deletions":-8}],"sizeInsertions":8,"sizeDeletions":-8},"patchSets":[{"number":"1","revision":"c62095594b99c9dbe439f861f387a62148602ba1","parents":["bec43535c914a9455b244cd47bc77697c3423f10"],"ref":"refs/changes/32/5032/1","uploader":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"createdOn":1541464814,"author":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1541464841,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"bin/upload_mako_ls.sh","type":"MODIFIED","insertions":26,"deletions":-5}],"sizeInsertions":26,"sizeDeletions":-5},{"number":"2","revision":"67c11c5bef556d7872684ee2d92cc456c7cceb09","parents":["bec43535c914a9455b244cd47bc77697c3423f10"],"ref":"refs/changes/32/5032/2","uploader":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"createdOn":1541702480,"author":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1541702507,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"bin/upload_mako_ls.sh","line":47,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Can you use realpath(1) instead of cd + pwd? I\u0027m not sure if that\u0027s necessarily better though because we use $0 in other places here too."},{"file":"bin/upload_mako_ls.sh","line":47,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Done"},{"file":"bin/upload_mako_ls.sh","line":78,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"For my own context, why are we using version ~2? It looks like SAPI defaults to \u0027~1\u0027 when the client doesn\u0027t include \u0027accept-version\u0027."},{"file":"bin/upload_mako_ls.sh","line":78,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Done"},{"file":"bin/upload_mako_ls.sh","line":109,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Can we condense this into one line? It doesn\u0027t seem like we\u0027re using `metadata` here."},{"file":"bin/upload_mako_ls.sh","line":109,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Done"},{"file":"bin/upload_mako_ls.sh","line":120,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"nit: add a space between these?"},{"file":"bin/upload_mako_ls.sh","line":120,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"bin/upload_mako_ls.sh","type":"MODIFIED","insertions":27,"deletions":-5}],"sizeInsertions":27,"sizeDeletions":-5},{"number":"3","revision":"3554a30b7e7b8f6c541a053004824161e15a0277","parents":["bec43535c914a9455b244cd47bc77697c3423f10"],"ref":"refs/changes/32/5032/3","uploader":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"createdOn":1541784870,"author":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1541784896,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1541801568,"by":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"}}],"comments":[{"file":"bin/upload_mako_ls.sh","line":108,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I think you can use `mdata-get sdc:datacenter_name` here instead of contacting SAPI.  If you haven\u0027t considered that approach, I think it would be better.  (It\u0027s more authoritative, I think; it\u0027s less likely to fail at runtime; and it also won\u0027t put any additional load on SAPI.)"},{"file":"bin/upload_mako_ls.sh","line":108,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Nice.  With this suggestion, I can remove the sapi function above as well.  Thanks for this.  Done."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"bin/upload_mako_ls.sh","type":"MODIFIED","insertions":26,"deletions":-5}],"sizeInsertions":26,"sizeDeletions":-5},{"number":"4","revision":"01a8676002f0c23e92f6cf0401c5289e83286a28","parents":["bec43535c914a9455b244cd47bc77697c3423f10"],"ref":"refs/changes/32/5032/4","uploader":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"createdOn":1541809889,"author":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1542235117,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1541809916,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1542312666,"by":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"bin/upload_mako_ls.sh","type":"MODIFIED","insertions":8,"deletions":-8}],"sizeInsertions":8,"sizeDeletions":-8},{"number":"5","revision":"6cf64f039140e394906ae10c544eca77dd7d8e3f","parents":["bec43535c914a9455b244cd47bc77697c3423f10"],"ref":"refs/changes/32/5032/5","uploader":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"createdOn":1542321980,"author":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1542235117,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1541809916,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1542312666,"by":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"}},{"type":"SUBM","value":"1","grantedOn":1542321994,"by":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"bin/upload_mako_ls.sh","type":"MODIFIED","insertions":8,"deletions":-8}],"sizeInsertions":8,"sizeDeletions":-8}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"}]}