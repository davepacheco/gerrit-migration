From cb83542b039ff7a1b9fba6256ac1eb28afb044ff Mon Sep 17 00:00:00 2001
From: Pedro Palazon Candel <pedro@joyent.com>
Date: Thu, 16 Mar 2017 17:51:31 +0100
Subject: [PATCH] TOOLS-1724 sdcadm trying to read image_uuid of undefined
 Reviewed by: Josh Wilsdon <josh@wilsdon.ca>

---
 lib/sdcadm.js | 5 +++--
 1 file changed, 3 insertions(+), 2 deletions(-)

diff --git a/lib/sdcadm.js b/lib/sdcadm.js
index 2cca542..46e87c8 100644
--- a/lib/sdcadm.js
+++ b/lib/sdcadm.js
@@ -2785,7 +2785,7 @@ SdcAdm.prototype.getCandidateImages = function getCandidateImages(opts, cb) {
             currImgUuids = Object.keys(currImgUuids);
             if (currImgUuids.length === 0) {
                 // No insts -> use the image_uuid set on the service.
-                if (opts.service.params.image_uuid) {
+                if (opts.service.params && opts.service.params.image_uuid) {
                     currImgUuids.push(opts.service.params.image_uuid);
                 }
             }
@@ -3512,7 +3512,8 @@ SdcAdm.prototype.genUpdatePlan = function genUpdatePlan(options, cb) {
                                 ch.service.name !== 'sdcadm') {
                             // No insts -> use the image_uuid set on the
                             // service.
-                            if (ch.service.params.image_uuid) {
+                            if (ch.service.params &&
+                                ch.service.params.image_uuid) {
                                 currImgUuids.push(ch.service.params.image_uuid);
                             }
                         }
-- 
2.21.0

