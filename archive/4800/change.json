{"project":"joyent/illumos-joyent","branch":"master","id":"I5163a1bfa565e26fa9b8b373a6e3a2e623217db4","number":"4800","subject":"OS-7222 thread_create() should ensure -\u003et_cpu is set Reviewed by: Robert Mustacchi \u003crm@joyent.com\u003e Reviewed by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e Approved by: Robert Mustacchi \u003crm@joyent.com\u003e","owner":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"url":"https://cr.joyent.us/4800","commitMessage":"OS-7222 thread_create() should ensure -\u003et_cpu is set\nReviewed by: Robert Mustacchi \u003crm@joyent.com\u003e\nReviewed by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e\nApproved by: Robert Mustacchi \u003crm@joyent.com\u003e\n","createdOn":1536269764,"lastUpdated":1536349313,"open":false,"status":"MERGED","comments":[{"timestamp":1536269764,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Uploaded patch set 1."},{"timestamp":1536269766,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit f24b7c36cea193c6a6c76b8217d271a55566f004\n    \n    OS-7222 thread_create() should ensure -\u003et_cpu is set"},{"timestamp":1536330201,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 1:\n\n(2 comments)"},{"timestamp":1536330530,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Uploaded patch set 2."},{"timestamp":1536330540,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit d21466eaee028f5ee89064cec1611f55eff63580\n    \n    clarify comment"},{"timestamp":1536330574,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 2:\n\nHope the expanded comment makes things clearer. It\u0027s impossible for disp_lowpri_cpu() to return NULL, the problem is it *is* NULL"},{"timestamp":1536330722,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 2: Code-Review+1\n\n(1 comment)"},{"timestamp":1536332587,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 2: Code-Review+1"},{"timestamp":1536347828,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 2: Integration-Approval+1"},{"timestamp":1536347898,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Uploaded patch set 3: Commit message was updated."},{"timestamp":1536347953,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 4: Patch Set 3 was rebased"},{"timestamp":1536349313,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by John Levon"}],"currentPatchSet":{"number":"4","revision":"78b5ec13e46ab3b58f3ef9d6501c98dc7e278d69","parents":["e58cbadf52334f540974293063eec8df9cb5a0da"],"ref":"refs/changes/00/4800/4","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1536347953,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1536330722,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1536332587,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1536347828,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"SUBM","value":"1","grantedOn":1536349313,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/uts/common/disp/thread.c","type":"MODIFIED","insertions":27,"deletions":-30}],"sizeInsertions":27,"sizeDeletions":-30},"patchSets":[{"number":"1","revision":"536ad80e2ef8edfaf3ce0cadfe8919ab9c9821ed","parents":["93e19c9346ce9d27b339cc14132d82b2e8a668e4"],"ref":"refs/changes/00/4800/1","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1536269764,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/uts/common/disp/thread.c","line":505,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Why is this assignment here? Isn\u0027t it always clobbered by the following function call? I couldn\u0027t find where disp_lowpri_cpu() uses t_cpu. If it\u0027s supposed to be here can you please add a comment explaining why? As the naive would remove it."},{"file":"usr/src/uts/common/disp/thread.c","line":506,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"So, it\u0027s not clear what stops disp_lowpri_cpu from returning NULL? At least, it seems like that was the original problem. Or was there a different issue that lead us here? Was that a side effect of setting t_cpu initially to the default?"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/disp/thread.c","type":"MODIFIED","insertions":25,"deletions":-30}],"sizeInsertions":25,"sizeDeletions":-30},{"number":"2","revision":"9ae45de4afedec8542cc524b2b5251c124891a19","parents":["93e19c9346ce9d27b339cc14132d82b2e8a668e4"],"ref":"refs/changes/00/4800/2","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1536330530,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1536330722,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1536347828,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1536332587,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"comments":[{"file":"usr/src/uts/common/disp/thread.c","line":502,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Thanks for clarifying this. It wasn\u0027t immediately clear to me that it was referring to the subsequent code. I had been mentally assuming it was happening later for some reason. Probably due to all the other logic that\u0027s happening later in lwp_create(), etc."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/disp/thread.c","type":"MODIFIED","insertions":27,"deletions":-30}],"sizeInsertions":27,"sizeDeletions":-30},{"number":"3","revision":"5163a1bfa565e26fa9b8b373a6e3a2e623217db4","parents":["93e19c9346ce9d27b339cc14132d82b2e8a668e4"],"ref":"refs/changes/00/4800/3","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1536347898,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1536330722,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1536347828,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1536332587,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/uts/common/disp/thread.c","type":"MODIFIED","insertions":27,"deletions":-30}],"sizeInsertions":27,"sizeDeletions":-30},{"number":"4","revision":"78b5ec13e46ab3b58f3ef9d6501c98dc7e278d69","parents":["e58cbadf52334f540974293063eec8df9cb5a0da"],"ref":"refs/changes/00/4800/4","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1536347953,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1536330722,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1536347828,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1536332587,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"SUBM","value":"1","grantedOn":1536349313,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/uts/common/disp/thread.c","type":"MODIFIED","insertions":27,"deletions":-30}],"sizeInsertions":27,"sizeDeletions":-30}],"allReviewers":[{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}]}