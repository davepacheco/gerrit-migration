{"project":"joyent/illumos-joyent","branch":"master","id":"I176c9d2d1b0c1e10cd280c413e351a271ad73792","number":"827","subject":"OS-4907 kstat -j does not produce valid JSON OS-5724 kstat(1) doesn\u0027t deal well with uninitialized named kstats OS-5757 in some locales, kstat -j produces invalid JSON Reviewed by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e Reviewed by: Robert Mustacchi \u003c","owner":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"url":"https://cr.joyent.us/827","commitMessage":"OS-4907 kstat -j does not produce valid JSON\nOS-5724 kstat(1) doesn\u0027t deal well with uninitialized named kstats\nOS-5757 in some locales, kstat -j produces invalid JSON\nReviewed by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e\nReviewed by: Robert Mustacchi \u003crm@joyent.com\u003e\nApproved by: Robert Mustacchi \u003crm@joyent.com\u003e\n","createdOn":1477960403,"lastUpdated":1478034713,"open":false,"status":"MERGED","comments":[{"timestamp":1477960403,"reviewer":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"message":"Uploaded patch set 1."},{"timestamp":1477961294,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 1: Code-Review+1"},{"timestamp":1477962126,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 1: Code-Review+1\n\n(1 comment)"},{"timestamp":1478024227,"reviewer":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"message":"Uploaded patch set 2."},{"timestamp":1478024940,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 2: Code-Review+1\n\nIs it worth updating the manual page to state that when JSON is being parsed printability / escaping of characters is locale dependent?"},{"timestamp":1478025145,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 2: Code-Review+1"},{"timestamp":1478025260,"reviewer":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"message":"Patch Set 2:\n\n\u003e Is it worth updating the manual page to state that when JSON is\n \u003e being parsed printability / escaping of characters is locale\n \u003e dependent?\n\nWell, we never parse JSON -- we only emit it.  And the JSON we emit is RFC 7159 compliant -- I don\u0027t think it\u0027s worth being more specific than that."},{"timestamp":1478025538,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 2: Integration-Approval+1\n\n\u003e \u003e Is it worth updating the manual page to state that when JSON is\n \u003e \u003e being parsed printability / escaping of characters is locale\n \u003e \u003e dependent?\n \u003e \n \u003e Well, we never parse JSON -- we only emit it.  And the JSON we emit\n \u003e is RFC 7159 compliant -- I don\u0027t think it\u0027s worth being more\n \u003e specific than that.\n\nI had meant emitting it and fair enough."},{"timestamp":1478033770,"reviewer":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"message":"Patch Set 3: Commit message was updated."},{"timestamp":1478034685,"reviewer":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"message":"Patch Set 3:\n\nIn terms of testing, this was largely done by hand (the lack of a kstat mock framework makes automatic testing difficult), testing both the existing failure modes from the tickets, as well as the other operational modes of the command."},{"timestamp":1478034713,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Bryan Cantrill"}],"currentPatchSet":{"number":"3","revision":"71eae4df251e827c8d207b8ccb808a703740b189","parents":["8f4dce5d41f21746863ef9c9670a26b7599ad302"],"ref":"refs/changes/27/827/3","uploader":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"createdOn":1478033770,"author":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1478024940,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1478025145,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1478025538,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"SUBM","value":"1","grantedOn":1478034713,"by":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":12,"deletions":0},{"file":"usr/src/cmd/stat/Makefile.stat","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/cmd/stat/kstat/Makefile","type":"MODIFIED","insertions":8,"deletions":0},{"file":"usr/src/cmd/stat/kstat/kstat.c","type":"MODIFIED","insertions":147,"deletions":-28},{"file":"usr/src/cmd/stat/kstat/kstat.h","type":"MODIFIED","insertions":0,"deletions":-9}],"sizeInsertions":157,"sizeDeletions":-37},"patchSets":[{"number":"1","revision":"9100f3c18aed3f2902a3462bd7d734504c4904e2","parents":["b3e6ba03f521c6890dbb9d6d9bb997834819bf6f"],"ref":"refs/changes/27/827/1","uploader":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"createdOn":1477960403,"author":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1477961294,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1477962126,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"comments":[{"file":"usr/src/cmd/stat/kstat/kstat.c","line":943,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Since it\u0027s only JSON which cares about special behavior for the last matching kstat, we could perhaps skip iterating over the items twice for non-JSON cases.  It wouldn\u0027t be the only thing here which has special output logic for JSON."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/cmd/stat/Makefile.stat","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/cmd/stat/kstat/Makefile","type":"MODIFIED","insertions":8,"deletions":0},{"file":"usr/src/cmd/stat/kstat/kstat.c","type":"MODIFIED","insertions":126,"deletions":-22},{"file":"usr/src/cmd/stat/kstat/kstat.h","type":"MODIFIED","insertions":0,"deletions":-2}],"sizeInsertions":136,"sizeDeletions":-24},{"number":"2","revision":"176c9d2d1b0c1e10cd280c413e351a271ad73792","parents":["8f4dce5d41f21746863ef9c9670a26b7599ad302"],"ref":"refs/changes/27/827/2","uploader":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"createdOn":1478024227,"author":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1478024940,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1478025538,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1478025145,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/cmd/stat/Makefile.stat","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/cmd/stat/kstat/Makefile","type":"MODIFIED","insertions":8,"deletions":0},{"file":"usr/src/cmd/stat/kstat/kstat.c","type":"MODIFIED","insertions":147,"deletions":-28},{"file":"usr/src/cmd/stat/kstat/kstat.h","type":"MODIFIED","insertions":0,"deletions":-9}],"sizeInsertions":157,"sizeDeletions":-37},{"number":"3","revision":"71eae4df251e827c8d207b8ccb808a703740b189","parents":["8f4dce5d41f21746863ef9c9670a26b7599ad302"],"ref":"refs/changes/27/827/3","uploader":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"createdOn":1478033770,"author":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1478024940,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1478025538,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"SUBM","value":"1","grantedOn":1478034713,"by":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1478025145,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":12,"deletions":0},{"file":"usr/src/cmd/stat/Makefile.stat","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/cmd/stat/kstat/Makefile","type":"MODIFIED","insertions":8,"deletions":0},{"file":"usr/src/cmd/stat/kstat/kstat.c","type":"MODIFIED","insertions":147,"deletions":-28},{"file":"usr/src/cmd/stat/kstat/kstat.h","type":"MODIFIED","insertions":0,"deletions":-9}],"sizeInsertions":157,"sizeDeletions":-37}],"allReviewers":[{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"}]}