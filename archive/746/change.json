{"project":"joyent/triton","branch":"master","id":"Iac2e76cf6d02c1745ce249d6d5b1a4a0ceb23cbb","number":"746","subject":"joyent/triton#187 setup script update for CoaL on Ubuntu KVM Reviewed by: Chris Burroughs \u003cchris.burroughs@joyent.com\u003e Approved by: Chris Burroughs \u003cchris.burroughs@joyent.com\u003e","owner":{"name":"June Yi","email":"june.yi@samsung.com","username":"gochist"},"url":"https://cr.joyent.us/746","commitMessage":"joyent/triton#187 setup script update for CoaL on Ubuntu KVM\nReviewed by: Chris Burroughs \u003cchris.burroughs@joyent.com\u003e\nApproved by: Chris Burroughs \u003cchris.burroughs@joyent.com\u003e\n","createdOn":1476975854,"lastUpdated":1477677935,"open":false,"status":"MERGED","comments":[{"timestamp":1476975854,"reviewer":{"name":"June Yi","email":"june.yi@samsung.com","username":"gochist"},"message":"Uploaded patch set 1."},{"timestamp":1476975857,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1477341429,"reviewer":{"name":"Jasper Siepkes","username":"siepkes"},"message":"Patch Set 1:\n\n(1 comment)\n\nAdding of Ubuntu and configuring the e1000 to prevent warnings looks good!\n\nI\u0027m not sure if switching from raw to qcow2 and removing the \u0027x-data-plane\u0027 feature is desirable; Yes, qcow2 will create a smaller image and you have ability to create snapshots. However raw with \u0027x-data-plane\u0027 was considerably faster when I tested it on Fedora. Now that could very well be due to some specific kernel version or FS I was using at the time so I don\u0027t know if that is still a valid concern (I used XFS). Maybe we should make it configurable in the script with a flag? Something like \u0027--use-raw-image\u0027? I would be perfectly fine by setting qcow2 as the default BTW."},{"timestamp":1477348254,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Patch Set 1:\n\n(1 comment)\n\nI was able to run this on a Debian 7 workstation without modification."},{"timestamp":1477403495,"reviewer":{"name":"June Yi","email":"june.yi@samsung.com","username":"gochist"},"message":"Patch Set 1:\n\nAFAIK, virtio-blk-data-plane does not work with qcow2. And even if I use raw image, it looks like that x-data-plane is not supported by Ubuntu currently(see [1, 2] below). \n\nI think adding an option such as --use-raw-image is good idea. I\u0027ll make another patch set to be reviewed soon.\n\n[1] x-data-plane test in my Ubuntu 16.04 desktop\n$ virsh start sdc-headnode\nerror: Failed to start domain sdc-headnode\nerror: internal error: process exited while connecting to monitor: 2016-10-25T13:34:50.852795Z qemu-system-x86_64: -device virtio-blk-pci,scsi\u003doff,bus\u003dpci.0,addr\u003d0x6,drive\u003ddrive-virtio-disk0,id\u003dvirtio-disk0,bootindex\u003d1: Property \u0027.x-data-plane\u0027 not found\n\n[2] properties kvm device virtio-blk-pci\n$ kvm -device virtio-blk-pci,?\nvirtio-blk-pci.request-merging\u003dbool (on/off)\nvirtio-blk-pci.min_io_size\u003duint16\nvirtio-blk-pci.secs\u003duint32\nvirtio-blk-pci.event_idx\u003dbool (on/off)\nvirtio-blk-pci.heads\u003duint32\nvirtio-blk-pci.serial\u003dstr\nvirtio-blk-pci.ioeventfd\u003dbool (on/off)\nvirtio-blk-pci.multifunction\u003dbool (on/off)\nvirtio-blk-pci.rombar\u003duint32\nvirtio-blk-pci.scsi\u003dbool (on/off)\nvirtio-blk-pci.cyls\u003duint32\nvirtio-blk-pci.logical_block_size\u003duint16 (A power of two between 512 and 32768)\nvirtio-blk-pci.x-disable-pcie\u003dbool (on/off)\nvirtio-blk-pci.indirect_desc\u003dbool (on/off)\nvirtio-blk-pci.disable-modern\u003dbool (on/off)\nvirtio-blk-pci.drive\u003dstr (ID of a drive to use as a backend)\nvirtio-blk-pci.disable-legacy\u003dbool (on/off)\nvirtio-blk-pci.command_serr_enable\u003dbool (on/off)\nvirtio-blk-pci.discard_granularity\u003duint32\nvirtio-blk-pci.iothread\u003dlink\u003ciothread\u003e\nvirtio-blk-pci.any_layout\u003dbool (on/off)\nvirtio-blk-pci.class\u003duint32\nvirtio-blk-pci.migrate-extra\u003dbool (on/off)\nvirtio-blk-pci.addr\u003dint32 (Slot and optional function number, example: 06.0 or 06)\nvirtio-blk-pci.modern-pio-notify\u003dbool (on/off)\nvirtio-blk-pci.vectors\u003duint32\nvirtio-blk-pci.physical_block_size\u003duint16 (A power of two between 512 and 32768)\nvirtio-blk-pci.bootindex\u003dint32\nvirtio-blk-pci.virtio-backend\u003dchild\u003cvirtio-blk-device\u003e\nvirtio-blk-pci.config-wce\u003dbool (on/off)\nvirtio-blk-pci.notify_on_empty\u003dbool (on/off)\nvirtio-blk-pci.virtio-pci-bus-master-bug-migration\u003dbool (on/off)\nvirtio-blk-pci.opt_io_size\u003duint32\nvirtio-blk-pci.romfile\u003dstr"},{"timestamp":1477405898,"reviewer":{"name":"June Yi","email":"june.yi@samsung.com","username":"gochist"},"message":"Uploaded patch set 2."},{"timestamp":1477405918,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1477406338,"reviewer":{"name":"June Yi","email":"june.yi@samsung.com","username":"gochist"},"message":"Uploaded patch set 3."},{"timestamp":1477406357,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1477408832,"reviewer":{"name":"June Yi","email":"june.yi@samsung.com","username":"gochist"},"message":"Uploaded patch set 4."},{"timestamp":1477408835,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1477495909,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Patch Set 4: Code-Review+1"},{"timestamp":1477677925,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Patch Set 5: Commit message was updated."},{"timestamp":1477677933,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Patch Set 5: Integration-Approval+1"},{"timestamp":1477677935,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Chris Burroughs"}],"currentPatchSet":{"number":"5","revision":"97aa7c32d73b3c0fd989268b4015d247ab119ae5","parents":["a7be81eacc3788527ce0048df47e59364ee3904a"],"ref":"refs/changes/46/746/5","uploader":{"name":"June Yi","email":"june.yi@samsung.com","username":"gochist"},"createdOn":1477677925,"author":{"name":"June Yi","email":"june.yi@samsung.com","username":"gochist"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1477408835,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1477495909,"by":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1477677933,"by":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"}},{"type":"SUBM","value":"1","grantedOn":1477677935,"by":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"tools/coal-linux-kvm-setup","type":"MODIFIED","insertions":53,"deletions":-23}],"sizeInsertions":53,"sizeDeletions":-23},"patchSets":[{"number":"1","revision":"cb8d56751be0f926caa2a900f72da81036a7b946","parents":["a7be81eacc3788527ce0048df47e59364ee3904a"],"ref":"refs/changes/46/746/1","uploader":{"name":"June Yi","email":"june.yi@samsung.com","username":"gochist"},"createdOn":1476975854,"author":{"name":"June Yi","email":"june.yi@samsung.com","username":"gochist"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1476975857,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"tools/coal-linux-kvm-setup","line":231,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"See Jasper Siepkes comment, but if you think removing these is the right thing, could you explain what they do?  Should they only be removed if we switch the default to qcow2?"},{"file":"tools/coal-linux-kvm-setup","line":24,"reviewer":{"name":"Jasper Siepkes","username":"siepkes"},"message":"Could you list the names of the packages that are required to make the script run under Ubuntu?"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"tools/coal-linux-kvm-setup","type":"MODIFIED","insertions":19,"deletions":-23}],"sizeInsertions":19,"sizeDeletions":-23},{"number":"2","revision":"5e4583dbe905824223a6c03eaa5c5862ead05168","parents":["a7be81eacc3788527ce0048df47e59364ee3904a"],"ref":"refs/changes/46/746/2","uploader":{"name":"June Yi","email":"june.yi@samsung.com","username":"gochist"},"createdOn":1477405898,"author":{"name":"June Yi","email":"june.yi@samsung.com","username":"gochist"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1477405918,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"tools/coal-linux-kvm-setup","type":"MODIFIED","insertions":53,"deletions":-23}],"sizeInsertions":53,"sizeDeletions":-23},{"number":"3","revision":"5d09778b2a322f2470b90eb7ab2ebbb819950487","parents":["a7be81eacc3788527ce0048df47e59364ee3904a"],"ref":"refs/changes/46/746/3","uploader":{"name":"June Yi","email":"june.yi@samsung.com","username":"gochist"},"createdOn":1477406338,"author":{"name":"June Yi","email":"june.yi@samsung.com","username":"gochist"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1477406357,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"tools/coal-linux-kvm-setup","type":"MODIFIED","insertions":53,"deletions":-23}],"sizeInsertions":53,"sizeDeletions":-23},{"number":"4","revision":"ac2e76cf6d02c1745ce249d6d5b1a4a0ceb23cbb","parents":["a7be81eacc3788527ce0048df47e59364ee3904a"],"ref":"refs/changes/46/746/4","uploader":{"name":"June Yi","email":"june.yi@samsung.com","username":"gochist"},"createdOn":1477408832,"author":{"name":"June Yi","email":"june.yi@samsung.com","username":"gochist"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1477408835,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1477495909,"by":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"tools/coal-linux-kvm-setup","type":"MODIFIED","insertions":53,"deletions":-23}],"sizeInsertions":53,"sizeDeletions":-23},{"number":"5","revision":"97aa7c32d73b3c0fd989268b4015d247ab119ae5","parents":["a7be81eacc3788527ce0048df47e59364ee3904a"],"ref":"refs/changes/46/746/5","uploader":{"name":"June Yi","email":"june.yi@samsung.com","username":"gochist"},"createdOn":1477677925,"author":{"name":"June Yi","email":"june.yi@samsung.com","username":"gochist"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1477408835,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1477495909,"by":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1477677933,"by":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"}},{"type":"SUBM","value":"1","grantedOn":1477677935,"by":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"tools/coal-linux-kvm-setup","type":"MODIFIED","insertions":53,"deletions":-23}],"sizeInsertions":53,"sizeDeletions":-23}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},{"name":"June Yi","email":"june.yi@samsung.com","username":"gochist"},{"name":"Jasper Siepkes","username":"siepkes"}]}