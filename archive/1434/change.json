{"project":"joyent/node-cueball","branch":"master","id":"I942b195de26f8abd15a5bcccbdf936b9d349710a","number":"1434","subject":"joyent/node-cueball#26 timers and sockets should not be unref\u0027d Reviewed by: Trent Mick \u003ctrent.mick@joyent.com\u003e","owner":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"url":"https://cr.joyent.us/1434","commitMessage":"joyent/node-cueball#26 timers and sockets should not be unref\u0027d\nReviewed by: Trent Mick \u003ctrent.mick@joyent.com\u003e\n","createdOn":1486181427,"lastUpdated":1486534462,"open":false,"status":"MERGED","comments":[{"timestamp":1486181427,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 1."},{"timestamp":1486181488,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1486181776,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 2."},{"timestamp":1486181837,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1486506368,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1486507965,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1486508817,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 2:\n\nI tried to use this cueball code with my old \"dudewheresmycb.js\" example. Using this script (https://gist.github.com/trentm/c384dcf8695c7c2f70844b29f87ee928) I get an exception on agent.stop():\n\n```\n...\nError: Invalid FSM transition: backoff \u003d\u003e closed\n...\n```\n\nFull run output is here: https://gist.github.com/trentm/f08953916579e4fc6aa4dc635311fc4c"},{"timestamp":1486509009,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 2: Code-Review+1\n\nalex points out there is a ticket for ^^ already: https://github.com/joyent/node-cueball/issues/88"},{"timestamp":1486516465,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 3."},{"timestamp":1486516526,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1486520194,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 3: Code-Review+1 Integration-Approval+1\n\nRe-applying Trent\u0027s +1 from earlier after re-base"},{"timestamp":1486520199,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Alex Wilson"},{"timestamp":1486534462,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 3:\n\n+1\u0027ing again, after the fact."}],"currentPatchSet":{"number":"3","revision":"942b195de26f8abd15a5bcccbdf936b9d349710a","parents":["23762bd51cfa35de3c8e4eb94da957ef3a337312"],"ref":"refs/changes/34/1434/3","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1486516465,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1486516526,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1486520194,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1486520194,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"SUBM","value":"1","grantedOn":1486520199,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"CHANGES.adoc","type":"MODIFIED","insertions":16,"deletions":0},{"file":"docs/api.adoc","type":"MODIFIED","insertions":20,"deletions":-23},{"file":"lib/connection-fsm.js","type":"MODIFIED","insertions":1,"deletions":-21},{"file":"lib/resolver.js","type":"MODIFIED","insertions":1,"deletions":-2},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/pool.test.js","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":41,"sizeDeletions":-49},"patchSets":[{"number":"1","revision":"8063f2d3968a8e5c6ecdad1510a26ba6a83fbe9d","parents":["e51dc59870491c8b48cd33b3180c2b4315a26b5d"],"ref":"refs/changes/34/1434/1","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1486181427,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1486181488,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"docs/api.adoc","type":"MODIFIED","insertions":20,"deletions":-23},{"file":"lib/connection-fsm.js","type":"MODIFIED","insertions":1,"deletions":-21},{"file":"lib/resolver.js","type":"MODIFIED","insertions":1,"deletions":-2},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/pool.test.js","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":25,"sizeDeletions":-49},{"number":"2","revision":"608f42be55b860cc76254db1f17f0a62f77908b8","parents":["e51dc59870491c8b48cd33b3180c2b4315a26b5d"],"ref":"refs/changes/34/1434/2","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1486181776,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1486181837,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1486509009,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"comments":[{"file":"test/pool.test.js","line":172,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Can you clarify why these changed here and at +707?"},{"file":"test/pool.test.js","line":172,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Because we\u0027re no longer calling unref() on them."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"CHANGES.adoc","type":"MODIFIED","insertions":16,"deletions":0},{"file":"docs/api.adoc","type":"MODIFIED","insertions":20,"deletions":-23},{"file":"lib/connection-fsm.js","type":"MODIFIED","insertions":1,"deletions":-21},{"file":"lib/resolver.js","type":"MODIFIED","insertions":1,"deletions":-2},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/pool.test.js","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":41,"sizeDeletions":-49},{"number":"3","revision":"942b195de26f8abd15a5bcccbdf936b9d349710a","parents":["23762bd51cfa35de3c8e4eb94da957ef3a337312"],"ref":"refs/changes/34/1434/3","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1486516465,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1486520194,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1486520194,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"SUBM","value":"1","grantedOn":1486520199,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1486516526,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"CHANGES.adoc","type":"MODIFIED","insertions":16,"deletions":0},{"file":"docs/api.adoc","type":"MODIFIED","insertions":20,"deletions":-23},{"file":"lib/connection-fsm.js","type":"MODIFIED","insertions":1,"deletions":-21},{"file":"lib/resolver.js","type":"MODIFIED","insertions":1,"deletions":-2},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/pool.test.js","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":41,"sizeDeletions":-49}],"allReviewers":[{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}]}