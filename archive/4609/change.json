{"project":"joyent/sdc-ufds","branch":"master","id":"I9ba73060710f6f4e79e86bdfc387f3d46bbbfbb4","number":"4609","subject":"MPAI-27 Ensure UFDS Key Rotation in SPC Does Not Cause Manta Outages/Issues","owner":{"name":"Carol Cobine","email":"carol.cobine@joyent.com","username":"ccobine"},"url":"https://cr.joyent.us/4609","commitMessage":"MPAI-27 Ensure UFDS Key Rotation in SPC Does Not Cause Manta Outages/Issues\n","createdOn":1533072168,"lastUpdated":1554230291,"open":true,"status":"NEW","comments":[{"timestamp":1533072168,"reviewer":{"name":"Carol Cobine","email":"carol.cobine@joyent.com","username":"ccobine"},"message":"Uploaded patch set 1."},{"timestamp":1533072170,"reviewer":{"name":"Carol Cobine","email":"carol.cobine@joyent.com","username":"ccobine"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit cef0e4b9cbb158fcbfb0c2fa90f6841ae5135bd0\n    \n    do it"},{"timestamp":1533072198,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1533072300,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 1:\n\n(2 comments)\n\nA review of the first few lines only. :)"},{"timestamp":1533149027,"reviewer":{"name":"Carol Cobine","email":"carol.cobine@joyent.com","username":"ccobine"},"message":"Uploaded patch set 2."},{"timestamp":1533149030,"reviewer":{"name":"Carol Cobine","email":"carol.cobine@joyent.com","username":"ccobine"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit a5d5c426da0eea170b64c7c8c2d4d3db341a7054\n    \n    update copyright date\n    \n    commit 933cd49f5b92e424cc7de54049f07466ab44e2ad\n    \n    operator guide formatting updates"},{"timestamp":1533149057,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1533190658,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Patch Set 2:\n\n(15 comments)"},{"timestamp":1533225726,"reviewer":{"name":"Carol Cobine","email":"carol.cobine@joyent.com","username":"ccobine"},"message":"Uploaded patch set 3."},{"timestamp":1533225729,"reviewer":{"name":"Carol Cobine","email":"carol.cobine@joyent.com","username":"ccobine"},"message":"Patch Set 3:\n\nNew commits:\n    \n    commit 52e18594a9fb251f5f4dc1f91385a213a67bc331\n    \n    BBennett review revisions v1"},{"timestamp":1533225755,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1533225939,"reviewer":{"name":"Carol Cobine","email":"carol.cobine@joyent.com","username":"ccobine"},"message":"Uploaded patch set 4."},{"timestamp":1533225941,"reviewer":{"name":"Carol Cobine","email":"carol.cobine@joyent.com","username":"ccobine"},"message":"Patch Set 4:\n\nNew commits:\n    \n    commit 9a53121f4916a8210f09de4354f0bb1cefc532e9\n    \n    BBennett review revisions v1.1"},{"timestamp":1533225968,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1533236917,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Patch Set 4:\n\n(18 comments)"},{"timestamp":1533244176,"reviewer":{"name":"Carol Cobine","email":"carol.cobine@joyent.com","username":"ccobine"},"message":"Uploaded patch set 5."},{"timestamp":1533244179,"reviewer":{"name":"Carol Cobine","email":"carol.cobine@joyent.com","username":"ccobine"},"message":"Patch Set 5:\n\nNew commits:\n    \n    commit 6bf573bf48482a887ca21f8613b8d570cfb35d65\n    \n    BBennett review revisions v2"},{"timestamp":1533244206,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1533600067,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Patch Set 5:\n\n(22 comments)"},{"timestamp":1533604499,"reviewer":{"name":"Carol Cobine","email":"carol.cobine@joyent.com","username":"ccobine"},"message":"Uploaded patch set 6."},{"timestamp":1533604501,"reviewer":{"name":"Carol Cobine","email":"carol.cobine@joyent.com","username":"ccobine"},"message":"Patch Set 6:\n\nNew commits:\n    \n    commit 6557e6420d6a5d0514b99ad4934162cd5f221182\n    \n    BBennett review revisions v3"},{"timestamp":1533604528,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 6: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1533605153,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Patch Set 6:\n\n(14 comments)"},{"timestamp":1533610401,"reviewer":{"name":"Carol Cobine","email":"carol.cobine@joyent.com","username":"ccobine"},"message":"Uploaded patch set 7."},{"timestamp":1533610404,"reviewer":{"name":"Carol Cobine","email":"carol.cobine@joyent.com","username":"ccobine"},"message":"Patch Set 7:\n\nNew commits:\n    \n    commit 857d5244b7fd3933c80bd82317a28de6cfad7404\n    \n    BBennett review revisions v4"},{"timestamp":1533610431,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 7: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1533610796,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Patch Set 7:\n\n(6 comments)"},{"timestamp":1533646628,"reviewer":{"name":"Carol Cobine","email":"carol.cobine@joyent.com","username":"ccobine"},"message":"Uploaded patch set 8."},{"timestamp":1533646633,"reviewer":{"name":"Carol Cobine","email":"carol.cobine@joyent.com","username":"ccobine"},"message":"Patch Set 8:\n\nNew commits:\n    \n    commit 328e30c2bf5f51bfc7631ae31d77f4fee91b18b4\n    \n    BBennett fromatting suggestions v5"},{"timestamp":1533646660,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 8: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1533672225,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Patch Set 8:\n\n(13 comments)"},{"timestamp":1533679878,"reviewer":{"name":"Carol Cobine","email":"carol.cobine@joyent.com","username":"ccobine"},"message":"Uploaded patch set 9."},{"timestamp":1533679880,"reviewer":{"name":"Carol Cobine","email":"carol.cobine@joyent.com","username":"ccobine"},"message":"Patch Set 9:\n\nNew commits:\n    \n    commit 4c9ecbc95a98902e36be73a6bef0816ef781a018\n    \n    BBennett Revision requests v6"},{"timestamp":1533680540,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Patch Set 9:\n\n(3 comments)"},{"timestamp":1533681160,"reviewer":{"name":"Carol Cobine","email":"carol.cobine@joyent.com","username":"ccobine"},"message":"Uploaded patch set 10."},{"timestamp":1533681163,"reviewer":{"name":"Carol Cobine","email":"carol.cobine@joyent.com","username":"ccobine"},"message":"Patch Set 10:\n\nNew commits:\n    \n    commit c9b06fd93bae2d9ce8fe7f2a4feda50b6bea350c\n    \n    BBennett Revision requests v7"},{"timestamp":1533681216,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Patch Set 10: Code-Review+1"},{"timestamp":1533681746,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 10: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1533681746,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 9: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1546904367,"reviewer":{"name":"Ryan Puckett","email":"rpuckett@joyent.com","username":"ryanpuck"},"message":"Patch Set 10:\n\n(14 comments)"},{"timestamp":1547126850,"reviewer":{"name":"Carol Cobine","email":"carol.cobine@joyent.com","username":"ccobine"},"message":"Uploaded patch set 11."},{"timestamp":1547126853,"reviewer":{"name":"Carol Cobine","email":"carol.cobine@joyent.com","username":"ccobine"},"message":"Patch Set 11:\n\nNew commits:\n    \n    commit 0365c7ac594a887fbf2dddc8737e3635badcd3c2\n    \n    Integrate QA updates."},{"timestamp":1547126881,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 11: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1547127026,"reviewer":{"name":"Carol Cobine","email":"carol.cobine@joyent.com","username":"ccobine"},"message":"Uploaded patch set 12."},{"timestamp":1547127029,"reviewer":{"name":"Carol Cobine","email":"carol.cobine@joyent.com","username":"ccobine"},"message":"Patch Set 12:\n\nNew commits:\n    \n    commit 5afebdb546b8825b8b635322d3d4d2d3b4eb8cda\n    \n    remove period and a space"},{"timestamp":1547127056,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 12: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1547134546,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Patch Set 10:\n\n(9 comments)"},{"timestamp":1547144610,"reviewer":{"name":"Ryan Puckett","email":"rpuckett@joyent.com","username":"ryanpuck"},"message":"Patch Set 10:\n\n(5 comments)\n\nAdded further comments"},{"timestamp":1553809587,"reviewer":{"name":"Angela Fong","email":"angela.fong@joyent.com","username":"askfongjojo"},"message":"Patch Set 12:\n\n(9 comments)"},{"timestamp":1553815901,"reviewer":{"name":"Angela Fong","email":"angela.fong@joyent.com","username":"askfongjojo"},"message":"Patch Set 12:\n\n(3 comments)"},{"timestamp":1554230244,"reviewer":{"name":"Carol Cobine","email":"carol.cobine@joyent.com","username":"ccobine"},"message":"Uploaded patch set 13: Patch Set 12 was rebased."},{"timestamp":1554230247,"reviewer":{"name":"Carol Cobine","email":"carol.cobine@joyent.com","username":"ccobine"},"message":"Patch Set 13:\n\nNew commits:\n    \n    commit 77b9708ab66eb8f1a26d7efc10fd72505f8adc5d\n    \n    remove period and a space\n    \n    commit 675f318289d95187987621590428f564f8f165d9\n    \n    Integrate QA updates.\n    \n    commit 735a4ef3f768eba06a327c07fdb1b277314166e4\n    \n    BBennett Revision requests v7\n    \n    commit 8e1a8293a126afe64bd417d8dbcac13d7858f49d\n    \n    BBennett Revision requests v6\n    \n    commit de1fe725bf2a79ac86a792517bd027be783324b7\n    \n    BBennett fromatting suggestions v5\n    \n    commit fbcfb8fd8cb9258f61cd378c3800481496893052\n    \n    BBennett review revisions v4\n    \n    commit b0ef3a25f81b46558ac4587a443e3503941c4779\n    \n    BBennett review revisions v3\n    \n    commit 7d43bef955774890dd950ad23da91f6e3b463cc2\n    \n    BBennett review revisions v2\n    \n    commit 4da602e705b9be45a0a108a01375bf30a793bd48\n    \n    BBennett review revisions v1.1\n    \n    commit 1d1599b53ab3df260edd6c0686834d0017927787\n    \n    BBennett review revisions v1\n    \n    commit ce0d6aff035269f1840938cb1e4e1360567a891c\n    \n    update copyright date\n    \n    commit 3974b2fc245064dda62b74f09ecefa780f5fce2d\n    \n    operator guide formatting updates\n    \n    commit 16210411f4ce21209f21e01bf69d98b4106f8238\n    \n    do it"},{"timestamp":1554230291,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 13:\n\n\"make check\" passed ok"}],"currentPatchSet":{"number":"13","revision":"9ba73060710f6f4e79e86bdfc387f3d46bbbfbb4","parents":["372270f233f4f93abc1a5b54ce441cb1fc551bda"],"ref":"refs/changes/09/4609/13","uploader":{"name":"Carol Cobine","email":"carol.cobine@joyent.com","username":"ccobine"},"createdOn":1554230244,"author":{"name":"Carol Cobine","email":"carol.cobine@joyent.com","username":"ccobine"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1547127056,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"docs/operator-guide.md","type":"ADDED","insertions":258,"deletions":0}],"sizeInsertions":258,"sizeDeletions":0},"patchSets":[{"number":"1","revision":"0830b9fee53cae859d483de38002d7fba3515cea","parents":["1dac62ee1a59c95ce069275c80d74fab559c80b1"],"ref":"refs/changes/09/4609/1","uploader":{"name":"Carol Cobine","email":"carol.cobine@joyent.com","username":"ccobine"},"createdOn":1533072168,"author":{"name":"Carol Cobine","email":"carol.cobine@joyent.com","username":"ccobine"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1533072198,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"docs/operator-guide.md","line":13,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"2018 now :)"},{"file":"docs/operator-guide.md","line":30,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Dropping trailing whitespace would be nice."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"docs/operator-guide.md","type":"ADDED","insertions":169,"deletions":0}],"sizeInsertions":169,"sizeDeletions":0},{"number":"2","revision":"c6d0a1340a9c3f8c7032bef8496fd66fac89e044","parents":["1dac62ee1a59c95ce069275c80d74fab559c80b1"],"ref":"refs/changes/09/4609/2","uploader":{"name":"Carol Cobine","email":"carol.cobine@joyent.com","username":"ccobine"},"createdOn":1533149027,"author":{"name":"Carol Cobine","email":"carol.cobine@joyent.com","username":"ccobine"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1533149057,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"docs/operator-guide.md","line":56,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Spell out \"datacenter\""},{"file":"docs/operator-guide.md","line":56,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Avoid use of \"master\"/\"slave\" prefer \"primary\"/\"replica\"."},{"file":"docs/operator-guide.md","line":58,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Inline should use single backtick; \"mount\" is part of the command\n\nRun `sdc-usbkey mount`"},{"file":"docs/operator-guide.md","line":60,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"There should be a note somewhere that it\u0027s *recomended* that all datacenters use the same password, but every datacenter *can* be different."},{"file":"docs/operator-guide.md","line":70,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Replace with:\n\n$(sdcadm insts -j cloudapi adminui mahi fwapi | json -a zonename)"},{"file":"docs/operator-guide.md","line":89,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"This use of \"master\" needs to stay because it\u0027s a specific thing in the UFDS zone, but it\u0027s multiple instances. Replace with:\n\nCheck that the `ufds-master` service logs in the ufds zone don\u0027t have any connection errors."},{"file":"docs/operator-guide.md","line":91,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Specific references to JPC should be removed."},{"file":"docs/operator-guide.md","line":100,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Replace with:\n\n$(sdcadm insts -j cloudapi adminui mahi fwapi | json -a zonename)"},{"file":"docs/operator-guide.md","line":108,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Remove this 0 here."},{"file":"docs/operator-guide.md","line":118,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"These lines are JPC specific, so should be removed"},{"file":"docs/operator-guide.md","line":128,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Replace with:\n\n$(sdcadm insts -j cloudapi adminui mahi fwapi | json -a zonename)"},{"file":"docs/operator-guide.md","line":134,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"The napi-ufds-watcher is usually in maintenance at this point and needs to be cleared."},{"file":"docs/operator-guide.md","line":140,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Change to \"Update Manta Components\". Manta will not always be deployed, so users can skip these steps if they do not have a manta."},{"file":"docs/operator-guide.md","line":166,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"I\u0027m reworking these to remove datacenter dependencies\n\nRemove references to datacenters. Replace commands with the following:\n\n```\nsource /usbkey/config\n\nmdash\u003d$(sdc-sapi /services?name\u003dmarlin-dashboard\\\u0026include_master\u003dtrue | json -Ha uuid)\njson\u003d$(printf \u0027{\"metadata\":{\"UFDS_ROOT_PW\":\"%s\"}}\u0027 \"${ufds_ldap_root_pw}\")\nsdc-sapi /services/$mdash -X PUT -d \"$json\"\n\nmadtom\u003d$(sdc-sapi /services?name\u003dmadtom\\\u0026include_master\u003dtrue | json -Ha uuid)\njson\u003d$(printf \u0027{\"metadata\":{\"UFDS_ROOT_PW\":\"%s\"}}\u0027 \"${ufds_ldap_root_pw}\")\nsdc-sapi /services/$madtom -X PUT -d \"$json\"\n```"},{"file":"docs/operator-guide.md","line":170,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"This is JPC specific, and so should be removed"},{"file":"docs/operator-guide.md","line":170,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"On further consideration, some customers do have portal installed, so this should say something to the effect of \"if you have the portal installed, update the ufds password in the portal config.pro.json file, then restart the portal service\""}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"docs/operator-guide.md","type":"ADDED","insertions":176,"deletions":0}],"sizeInsertions":176,"sizeDeletions":0},{"number":"3","revision":"56d9bdc2708a4ddf6b2f8720b6ca56b6079a7174","parents":["1dac62ee1a59c95ce069275c80d74fab559c80b1"],"ref":"refs/changes/09/4609/3","uploader":{"name":"Carol Cobine","email":"carol.cobine@joyent.com","username":"ccobine"},"createdOn":1533225726,"author":{"name":"Carol Cobine","email":"carol.cobine@joyent.com","username":"ccobine"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1533225755,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"docs/operator-guide.md","type":"ADDED","insertions":176,"deletions":0}],"sizeInsertions":176,"sizeDeletions":0},{"number":"4","revision":"5457962f74e07f9bcc4f9c819d9901a6d4f2da92","parents":["1dac62ee1a59c95ce069275c80d74fab559c80b1"],"ref":"refs/changes/09/4609/4","uploader":{"name":"Carol Cobine","email":"carol.cobine@joyent.com","username":"ccobine"},"createdOn":1533225939,"author":{"name":"Carol Cobine","email":"carol.cobine@joyent.com","username":"ccobine"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1533225968,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"docs/operator-guide.md","line":31,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Needs rewording"},{"file":"docs/operator-guide.md","line":59,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Change to:\n\nRun `sdc-usbkey mount`."},{"file":"docs/operator-guide.md","line":92,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"indentation inconsistency"},{"file":"docs/operator-guide.md","line":94,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"This should be \"consumers\" or possibly \"components\". This refers to software processes, not humans."},{"file":"docs/operator-guide.md","line":96,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"remove references to us-west-1"},{"file":"docs/operator-guide.md","line":98,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Should be PRIMARY_PW"},{"file":"docs/operator-guide.md","line":99,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"PRIMARY_PW"},{"file":"docs/operator-guide.md","line":119,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Remove all references to billing-callback.\nMake note that sdcsso is an optional component provided with portal. SSO/portal steps are only necessary if installed via support contract."},{"file":"docs/operator-guide.md","line":123,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"change to:\n\nhas a UFDS replica"},{"file":"docs/operator-guide.md","line":139,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Missing closing backticks"},{"file":"docs/operator-guide.md","line":141,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"change to:\n\nmay be"},{"file":"docs/operator-guide.md","line":141,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"change to:\n\nwill need"},{"file":"docs/operator-guide.md","line":143,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"This will need to be either `restart` or `clear` depending on whether napi-ufds-watcher is in maintenance."},{"file":"docs/operator-guide.md","line":152,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"change to:\n\ndatacenter"},{"file":"docs/operator-guide.md","line":152,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"remove"},{"file":"docs/operator-guide.md","line":157,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"these commands are for the next section below, and are missing some formatting.\n\nThe commands for this section should be restored"},{"file":"docs/operator-guide.md","line":170,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"What is now in lines 155-157 belong here, but need proper line breaks."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"docs/operator-guide.md","type":"ADDED","insertions":178,"deletions":0}],"sizeInsertions":178,"sizeDeletions":0},{"number":"5","revision":"7616a27d9ae5fef60911d4bd82b9adfa2fa18ba0","parents":["1dac62ee1a59c95ce069275c80d74fab559c80b1"],"ref":"refs/changes/09/4609/5","uploader":{"name":"Carol Cobine","email":"carol.cobine@joyent.com","username":"ccobine"},"createdOn":1533244176,"author":{"name":"Carol Cobine","email":"carol.cobine@joyent.com","username":"ccobine"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1533244206,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"docs/operator-guide.md","line":1,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Should be H1"},{"file":"docs/operator-guide.md","line":17,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"This line can be removed. Anything dated 2017 or later will work."},{"file":"docs/operator-guide.md","line":22,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"This line can be removed. Anything dated 2017 or later will work."},{"file":"docs/operator-guide.md","line":40,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Remove this new line (breaks formatting flow)."},{"file":"docs/operator-guide.md","line":51,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Remove this sentence, only applies to Joyent."},{"file":"docs/operator-guide.md","line":57,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Should be h4"},{"file":"docs/operator-guide.md","line":64,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Change to:\n\n2. Update `/usbkey/config and /mnt/usbkey/config` to set `ufds_ldap_root_pw` to the new `\u003cREPLICA_PW\u003e` then unmount the usbkey with `sdc-usbkey unmount`."},{"file":"docs/operator-guide.md","line":71,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Reformat for readability:\n\nfor uuid in $(sdcadm insts -j cloudapi adminui mahi fwapi | json -a zonename); do\n  echo \"restarting $uuid\"\n  vmadm reboot $uuid\ndone"},{"file":"docs/operator-guide.md","line":94,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Should probably have a single testing section at the end."},{"file":"docs/operator-guide.md","line":96,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Should be h4"},{"file":"docs/operator-guide.md","line":98,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Include `sdc-usbkey mount` and `sdc-usbkey unmount`, same as above"},{"file":"docs/operator-guide.md","line":105,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Reformat for readability (as above)\n\nfor uuid in $(sdcadm insts -j cloudapi adminui mahi fwapi | json -a zonename); do\n    echo \"restarting $uuid\"\n    vmadm reboot $uuid\ndone"},{"file":"docs/operator-guide.md","line":119,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Should be h4. Set title to \"Portal and sdcsso\""},{"file":"docs/operator-guide.md","line":121,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Follow with bullet points:\n\n* For sdcsso, edit `/opt/smartdc/sdcsso/cfg/config.json` in the sdcsso zone, then restart the `sdcsso` service.\n* For each portal instances, edit `site/config/config.pro.json` in the portal installation directory, then restart the `portal` service."},{"file":"docs/operator-guide.md","line":123,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Should be h4"},{"file":"docs/operator-guide.md","line":131,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Reformat for readability (as above)\n\nfor uuid in $(sdcadm insts -j cloudapi adminui mahi fwapi | json -a zonename); do\n    echo \"restarting $uuid\"\n    vmadm reboot $uuid\ndone"},{"file":"docs/operator-guide.md","line":147,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Switch these:\n\n4. Now restart napi-ufds-watcher.\n\u003ccommand\u003e\nNote: it may be in maintenance, to clear:\n\u003ccommand\u003e"},{"file":"docs/operator-guide.md","line":161,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"remove this newline"},{"file":"docs/operator-guide.md","line":169,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Missing done line:\n\nfor m in \"${mahi[@]}\"; do\n  sapiadm update \"$m\" metadata.UFDS_ROOT_PW\u003d\"${ufds_ldap_root_pw}\"\nmanta-oneach -z \"$m\" reboot\ndone"},{"file":"docs/operator-guide.md","line":171,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Remove"},{"file":"docs/operator-guide.md","line":173,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Remove this line"},{"file":"docs/operator-guide.md","line":178,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Remove these three lines"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"docs/operator-guide.md","type":"ADDED","insertions":187,"deletions":0}],"sizeInsertions":187,"sizeDeletions":0},{"number":"6","revision":"4003282d4599f63249a8edc917129a46bb19f100","parents":["1dac62ee1a59c95ce069275c80d74fab559c80b1"],"ref":"refs/changes/09/4609/6","uploader":{"name":"Carol Cobine","email":"carol.cobine@joyent.com","username":"ccobine"},"createdOn":1533604499,"author":{"name":"Carol Cobine","email":"carol.cobine@joyent.com","username":"ccobine"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1533604528,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"docs/operator-guide.md","line":1,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Use:\n\n# UFDS Credential Rotation"},{"file":"docs/operator-guide.md","line":26,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"end of line whitespace"},{"file":"docs/operator-guide.md","line":39,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"end of line whitespace"},{"file":"docs/operator-guide.md","line":41,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"end of line whitespace"},{"file":"docs/operator-guide.md","line":57,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Use:\n\n### On each datacenter that has a UFDS replica"},{"file":"docs/operator-guide.md","line":66,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"end of line whitespace"},{"file":"docs/operator-guide.md","line":76,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"end of line whitespace"},{"file":"docs/operator-guide.md","line":112,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Use:\n\n### On the UFDS Primary"},{"file":"docs/operator-guide.md","line":125,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"end of line whitespace"},{"file":"docs/operator-guide.md","line":130,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"end of line whitespace"},{"file":"docs/operator-guide.md","line":147,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Use:\n\n### Portal and sdcsso"},{"file":"docs/operator-guide.md","line":156,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Use:\n\n### On each datacenter..."},{"file":"docs/operator-guide.md","line":165,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"end of line whitespace"},{"file":"docs/operator-guide.md","line":222,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Indent this block"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"docs/operator-guide.md","type":"ADDED","insertions":238,"deletions":0}],"sizeInsertions":238,"sizeDeletions":0},{"number":"7","revision":"bd2ca3c488162a1a6aeccee9f60ff5c072e5434a","parents":["1dac62ee1a59c95ce069275c80d74fab559c80b1"],"ref":"refs/changes/09/4609/7","uploader":{"name":"Carol Cobine","email":"carol.cobine@joyent.com","username":"ccobine"},"createdOn":1533610401,"author":{"name":"Carol Cobine","email":"carol.cobine@joyent.com","username":"ccobine"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1533610431,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"docs/operator-guide.md","line":100,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Add empty line above"},{"file":"docs/operator-guide.md","line":150,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Add empty line above"},{"file":"docs/operator-guide.md","line":152,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Remove empty line"},{"file":"docs/operator-guide.md","line":187,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Indent this to preserve formatting"},{"file":"docs/operator-guide.md","line":195,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Indent this to preserve formatting"},{"file":"docs/operator-guide.md","line":238,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Does not need to be indented"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"docs/operator-guide.md","type":"ADDED","insertions":238,"deletions":0}],"sizeInsertions":238,"sizeDeletions":0},{"number":"8","revision":"51bbb32ca5269a3aab96c6a28793f24444cafee1","parents":["1dac62ee1a59c95ce069275c80d74fab559c80b1"],"ref":"refs/changes/09/4609/8","uploader":{"name":"Carol Cobine","email":"carol.cobine@joyent.com","username":"ccobine"},"createdOn":1533646628,"author":{"name":"Carol Cobine","email":"carol.cobine@joyent.com","username":"ccobine"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1533646660,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"docs/operator-guide.md","line":44,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Reword this entire section:\n\n### Before you begin\n\n- Parts of this guide assume you have already enabled UFDS replication using the `sdc-ufds-m2s` script. If you have not set up UFDS replication, you may skip all sections that refer to **replicas**.\n\n- Generate passwords ahead of time. You may use a single password for all datacenters (since they have the same content) or a unique password per datacenter. If you use unique passwords, all replica data centers must use the primary\u0027s password as the remote password. If you are unsure which datacenter is primary, check `/usbkey/config` on the headnode for the line `ufds_is_master\u003dtrue`. \n\n- During these procedures, log into the ufds zone and monitor the UFDS log file.\n\n    ```\n    tail -1f $(svcs -L ufds-master) | bunyan\n    ```\n\n- For replicas, also monitor the ufds-replicator log.\n\n    ```\n    tail -1f $(svcs -L ufds-replicator)\n    ```"},{"file":"docs/operator-guide.md","line":65,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Change to:\n\n2. Update `/usbkey/config and /mnt/usbkey/config` to set `ufds_ldap_root_pw` to the new `\u003cREPLICA_PW\u003e`\n\n3. Run `sdc-usbkey unmount`"},{"file":"docs/operator-guide.md","line":67,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Renumber the rest of the list"},{"file":"docs/operator-guide.md","line":100,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"whitespace at end of line"},{"file":"docs/operator-guide.md","line":111,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Move the testing section to the very end, after the `sdcadm dc-maint stop/status` commands have been run"},{"file":"docs/operator-guide.md","line":115,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Change to:\n\n1. Run `sdc-usbkey mount`\n\n2. Update `/usbkey/config and /mnt/usbkey/config` to set `ufds_ldap_root_pw` to the new `\u003cREPLICA_PW\u003e`\n\n3. Run `sdc-usbkey unmount`"},{"file":"docs/operator-guide.md","line":117,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Renumber the rest of the list"},{"file":"docs/operator-guide.md","line":123,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Each of these should have a single backtick instead of 3"},{"file":"docs/operator-guide.md","line":152,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Make this two bullet points:\n\n- To update sdcsso:\n    - In the sdcsso zone, edit `/opt/smartdc/sdcsso/cfg/config.json`\n    - Restart the `sdcsso` service"},{"file":"docs/operator-guide.md","line":154,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Make this two bullet points:\n\n- To update each of the portal instances:\n    - In the portal installation directory, edit `/site/config/config.pro.json`\n    - Restart the `portal` service"},{"file":"docs/operator-guide.md","line":156,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Change to:\n\n### On each replica datacenter"},{"file":"docs/operator-guide.md","line":164,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Change to:\n\n2. Update `/usbkey/config and /mnt/usbkey/config` to set `ufds_ldap_root_pw` to the new `\u003cREMOTE_PW\u003e`\n\n3. Run `sdc-usbkey unmount`"},{"file":"docs/operator-guide.md","line":238,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"This block should not be indented"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"docs/operator-guide.md","type":"ADDED","insertions":238,"deletions":0}],"sizeInsertions":238,"sizeDeletions":0},{"number":"9","revision":"6f42cb2ae16a9f256127b18b435a77a6be1a1e4c","parents":["1dac62ee1a59c95ce069275c80d74fab559c80b1"],"ref":"refs/changes/09/4609/9","uploader":{"name":"Carol Cobine","email":"carol.cobine@joyent.com","username":"ccobine"},"createdOn":1533679878,"author":{"name":"Carol Cobine","email":"carol.cobine@joyent.com","username":"ccobine"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1533681746,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"docs/operator-guide.md","line":37,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Missing close paren here"},{"file":"docs/operator-guide.md","line":43,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Missing pipe to bunyan:\n\ntail -1f $(svcs -L ufds-replicator) | bunyan"},{"file":"docs/operator-guide.md","line":113,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Use only single bacticks here:\n\n5. Reboot `cloudapi`, `mahi`, `adminui`, and `fwapi`."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"docs/operator-guide.md","type":"ADDED","insertions":241,"deletions":0}],"sizeInsertions":241,"sizeDeletions":0},{"number":"10","revision":"db0c7f229e2b373acc433a9e8d194073ebd1d2bd","parents":["1dac62ee1a59c95ce069275c80d74fab559c80b1"],"ref":"refs/changes/09/4609/10","uploader":{"name":"Carol Cobine","email":"carol.cobine@joyent.com","username":"ccobine"},"createdOn":1533681160,"author":{"name":"Carol Cobine","email":"carol.cobine@joyent.com","username":"ccobine"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1533681746,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1533681216,"by":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"}}],"comments":[{"file":"docs/operator-guide.md","line":71,"reviewer":{"name":"Ryan Puckett","email":"rpuckett@joyent.com","username":"ryanpuck"},"message":"Reboot cloudapi, mahi, adminui, fwapi, imgapi to ensure that new password takes effect"},{"file":"docs/operator-guide.md","line":74,"reviewer":{"name":"Ryan Puckett","email":"rpuckett@joyent.com","username":"ryanpuck"},"message":"lines 74-77 should be replaced with:\n\nhn\u003d$(sysinfo | json UUID)\nhn2\u003d$(sdc-server lookup traits.triton\u003dheadnode)\n# check that the csv of HN and secondary HN uuids look correct (expects 3 of them)\necho $hn $hn2 | tr \" \" \",\"\n\nsdc-oneachnode -n $(echo $hn $hn2 | tr \" \" \",\") \u0027for uuid in $(sdcadm insts cloudapi adminui mahi fwapi imgapi | grep -v INSTANCE | awk \u0027{print $1}\u0027); do echo \"restarting $uuid\"; vmadm reboot $uuid; done\u0027"},{"file":"docs/operator-guide.md","line":74,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"traits.triton is a joyent specific implementation detail. It won\u0027t be present on customer sites and should not be in our general documentation.\n\nA better change would be to use VMAPI to reboot active instances matching the necessary roles."},{"file":"docs/operator-guide.md","line":74,"reviewer":{"name":"Ryan Puckett","email":"rpuckett@joyent.com","username":"ryanpuck"},"message":"Good point"},{"file":"docs/operator-guide.md","line":92,"reviewer":{"name":"Ryan Puckett","email":"rpuckett@joyent.com","username":"ryanpuck"},"message":"Remove this section (lines 92-97)"},{"file":"docs/operator-guide.md","line":92,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Why? This section is necessary."},{"file":"docs/operator-guide.md","line":92,"reviewer":{"name":"Ryan Puckett","email":"rpuckett@joyent.com","username":"ryanpuck"},"message":"This was suggested for removal as manta authcache is covered later in \"update manta components\" The command shown here actually updates the triton mahi, which is not needed and just adds  clutter to the sapi metadata for those instances."},{"file":"docs/operator-guide.md","line":92,"reviewer":{"name":"Angela Fong","email":"angela.fong@joyent.com","username":"askfongjojo"},"message":"This version already had the step in question removed. This step of updating manta authcache is correct and should be kept."},{"file":"docs/operator-guide.md","line":92,"reviewer":{"name":"Angela Fong","email":"angela.fong@joyent.com","username":"askfongjojo"},"message":"Sorry, nvm what I said above - I confused myself. It is right to take out `sapiadm update $(sdc-vmname mahi) metadata.UFDS_ROOT_PW\u003d\u003cLOCAL_UFDS_PW\u003e` (and reboot), since it was trying to update the sdc mahi zone, not the ones in manta (authcache). The step to update authcache is already documented in a later section."},{"file":"docs/operator-guide.md","line":98,"reviewer":{"name":"Ryan Puckett","email":"rpuckett@joyent.com","username":"ryanpuck"},"message":"Test all features affected (CRUD account/sub-user/role, provisioning, list firewall rules, manta CLI). Check CNS as well - it should automatically pick up the password change. Finally check that ufds-master log doesn\u0027t have any connection errors. Those errors indicate that some consumers still have the old password"},{"file":"docs/operator-guide.md","line":113,"reviewer":{"name":"Ryan Puckett","email":"rpuckett@joyent.com","username":"ryanpuck"},"message":"Reboot `cloudapi`, `mahi`, `adminui`, imgapi, and `fwapi`."},{"file":"docs/operator-guide.md","line":115,"reviewer":{"name":"Ryan Puckett","email":"rpuckett@joyent.com","username":"ryanpuck"},"message":"Lines 116-119 should be:\n\nhn\u003d$(sysinfo | json UUID)\nhn2\u003d$(sdc-server lookup traits.triton\u003dheadnode)\n# check that the csv of HN and secondary HN uuids look correct (expects 3 of them)\necho $hn $hn2 | tr \" \" \",\"\n\nsdc-oneachnode -n $(echo $hn $hn2 | tr \" \" \",\") \u0027for uuid in $(sdcadm insts cloudapi adminui mahi fwapi imgapi | grep -v INSTANCE | awk \u0027{print $1}\u0027); do echo \"restarting $uuid\"; vmadm reboot $uuid; done\u0027"},{"file":"docs/operator-guide.md","line":115,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"traits.triton is a joyent specific implementation detail. It won\u0027t be present on customer sites and should not be in our general documentation.\n\nA better change would be to use VMAPI to reboot active instances matching the necessary roles."},{"file":"docs/operator-guide.md","line":115,"reviewer":{"name":"Angela Fong","email":"angela.fong@joyent.com","username":"askfongjojo"},"message":"Ok, I\u0027ll have a recommended change to address this in the patchset #12 review comments."},{"file":"docs/operator-guide.md","line":134,"reviewer":{"name":"Ryan Puckett","email":"rpuckett@joyent.com","username":"ryanpuck"},"message":"Remove"},{"file":"docs/operator-guide.md","line":134,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"If manta is installed, this is necessary."},{"file":"docs/operator-guide.md","line":134,"reviewer":{"name":"Ryan Puckett","email":"rpuckett@joyent.com","username":"ryanpuck"},"message":"This was suggested for removal as it\u0027s covered later in \"update manta components\""},{"file":"docs/operator-guide.md","line":134,"reviewer":{"name":"Angela Fong","email":"angela.fong@joyent.com","username":"askfongjojo"},"message":"This version already had the step in question removed. This step of updating manta authcache is correct and should be kept."},{"file":"docs/operator-guide.md","line":134,"reviewer":{"name":"Angela Fong","email":"angela.fong@joyent.com","username":"askfongjojo"},"message":"Sorry, nvm what I said above - I confused myself. It is right to take out this step, since it\u0027s trying to update the sdc mahi zone, not the ones in manta (authcache). The step to update authcache is already documented in a later section."},{"file":"docs/operator-guide.md","line":136,"reviewer":{"name":"Ryan Puckett","email":"rpuckett@joyent.com","username":"ryanpuck"},"message":"8. Test."},{"file":"docs/operator-guide.md","line":142,"reviewer":{"name":"Ryan Puckett","email":"rpuckett@joyent.com","username":"ryanpuck"},"message":"On billing-callback-a/b zones:"},{"file":"docs/operator-guide.md","line":142,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"billing callback zones no longer exist, and are a joyent specific implementation that should not be referenced in general documentation."},{"file":"docs/operator-guide.md","line":143,"reviewer":{"name":"Ryan Puckett","email":"rpuckett@joyent.com","username":"ryanpuck"},"message":"Update billing-callback ufds password in /opt/piranha-billing-server/config.json, restart service"},{"file":"docs/operator-guide.md","line":143,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"billing callback zones no longer exist, and are a joyent specific implementation that should not be referenced in general documentation."},{"file":"docs/operator-guide.md","line":144,"reviewer":{"name":"Ryan Puckett","email":"rpuckett@joyent.com","username":"ryanpuck"},"message":"Remove this line"},{"file":"docs/operator-guide.md","line":144,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Again, I think this is necessary."},{"file":"docs/operator-guide.md","line":144,"reviewer":{"name":"Ryan Puckett","email":"rpuckett@joyent.com","username":"ryanpuck"},"message":"Per the notes in CM-2470, this section is crossed out stating that config-agent handles this correctly now. I may be mistaken here but was going by that."},{"file":"docs/operator-guide.md","line":146,"reviewer":{"name":"Ryan Puckett","email":"rpuckett@joyent.com","username":"ryanpuck"},"message":"We have not been updating the portal zones to my knowledge. Lines 146-148 can be removed"},{"file":"docs/operator-guide.md","line":146,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Not all triton installs will have portal, but the ones that do will need to be updated. This needs to stay."},{"file":"docs/operator-guide.md","line":202,"reviewer":{"name":"Ryan Puckett","email":"rpuckett@joyent.com","username":"ryanpuck"},"message":"add, above: \nsource /usbkey/config"},{"file":"docs/operator-guide.md","line":223,"reviewer":{"name":"Ryan Puckett","email":"rpuckett@joyent.com","username":"ryanpuck"},"message":"Add the following:\n\n## Locate any reshard zone in the DC (there is normally one in each SPC region) and update its metadata:\n\n```\nreshard\u003dmanta-adm show -Ho zonename reshard\nsdc-sapi /instances/$reshard -X PUT -d\u0027{\"action\" : \"update\", \"metadata\": {\"UFDS_ROOT_PW\" : \"${ufds_ldap_root_pw}\"}}\u0027\n```\n\n## Restart chef on portal instances if applicable\n\n```\nsvcadm restart chef\n```"},{"file":"docs/operator-guide.md","line":223,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Do not reference Joyent specific datacenter in general documentation."},{"file":"docs/operator-guide.md","line":223,"reviewer":{"name":"Ryan Puckett","email":"rpuckett@joyent.com","username":"ryanpuck"},"message":"change to:\n\n## Locate any reshard zone in the DC (there is normally one in each region if reshard is deployed) and update its metadata:\n\nreshard\u003dmanta-adm show -Ho zonename reshard\nsdc-sapi /instances/$reshard -X PUT -d\u0027{\"action\" : \"update\", \"metadata\": {\"UFDS_ROOT_PW\" : \"${ufds_ldap_root_pw}\"}}\u0027"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"docs/operator-guide.md","type":"ADDED","insertions":241,"deletions":0}],"sizeInsertions":241,"sizeDeletions":0},{"number":"11","revision":"d969d3f76d64dbbf8790e85585c1079629a562c4","parents":["410149230860b710cf9a396e50017f39f172309d"],"ref":"refs/changes/09/4609/11","uploader":{"name":"Carol Cobine","email":"carol.cobine@joyent.com","username":"ccobine"},"createdOn":1547126850,"author":{"name":"Carol Cobine","email":"carol.cobine@joyent.com","username":"ccobine"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1547126881,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"docs/operator-guide.md","type":"ADDED","insertions":258,"deletions":0}],"sizeInsertions":258,"sizeDeletions":0},{"number":"12","revision":"0f3b233304db7e29a57536e5f64afc98cc9c731b","parents":["410149230860b710cf9a396e50017f39f172309d"],"ref":"refs/changes/09/4609/12","uploader":{"name":"Carol Cobine","email":"carol.cobine@joyent.com","username":"ccobine"},"createdOn":1547127026,"author":{"name":"Carol Cobine","email":"carol.cobine@joyent.com","username":"ccobine"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1547127056,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"docs/operator-guide.md","line":121,"reviewer":{"name":"Angela Fong","email":"angela.fong@joyent.com","username":"askfongjojo"},"message":"Per Brian\u0027s comment in patchset 10, we\u0027ll modify this section to just an one-liner:\n```\nfor uuid in $(sdcadm insts cloudapi adminui mahi fwapi imgapi | grep -v INSTANCE | awk \u0027{print $1}\u0027); do echo \"restarting $uuid\"; sdc-vmapi /vms/$uuid?action\u003dreboot -X POST; done\n```\nWe can remove hn and hn2 altogether."},{"file":"docs/operator-guide.md","line":141,"reviewer":{"name":"Angela Fong","email":"angela.fong@joyent.com","username":"askfongjojo"},"message":"We can remove references to sdcsso/SSO from the section heading and the sentences below, since we\u0027ve determined that it doesn\u0027t require any manual intervention."},{"file":"docs/operator-guide.md","line":141,"reviewer":{"name":"Angela Fong","email":"angela.fong@joyent.com","username":"askfongjojo"},"message":"I just checked sdcsso install for on-prem scenarios. We actually need to update sdcsso as well (because there is no config-agent for the on-prem version). Please ignore what I said earlier about sdcsso, and include back the step:\n\n\"Update sdcsso ufds password in /opt/smartdc/sdcsso/cfg/config.json, restart service.\""},{"file":"docs/operator-guide.md","line":145,"reviewer":{"name":"Angela Fong","email":"angela.fong@joyent.com","username":"askfongjojo"},"message":"We can drop the billing-callback-a/b update because customers do not have that. We\u0027ll be deprecating them shortly in JPC."},{"file":"docs/operator-guide.md","line":167,"reviewer":{"name":"Angela Fong","email":"angela.fong@joyent.com","username":"askfongjojo"},"message":"Same change as line 121, i.e. replace the command with:\n\n```\nfor uuid in $(sdcadm insts cloudapi adminui mahi fwapi imgapi | grep -v INSTANCE | awk \u0027{print $1}\u0027); do echo \"restarting $uuid\"; sdc-vmapi /vms/$uuid?action\u003dreboot -X POST; done\n```"},{"file":"docs/operator-guide.md","line":231,"reviewer":{"name":"Angela Fong","email":"angela.fong@joyent.com","username":"askfongjojo"},"message":"We probably don\u0027t want to reference SPC here. How about this?\n\n\"If the reshard service has not been installed in the Manta deployment, skip these steps.\""},{"file":"docs/operator-guide.md","line":236,"reviewer":{"name":"Angela Fong","email":"angela.fong@joyent.com","username":"askfongjojo"},"message":"This step is specific to us (SPC/JPC) since we keep track of ufds password for portal instances in the chef scripts. We can take out this step for on-prem customers."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"docs/operator-guide.md","type":"ADDED","insertions":258,"deletions":0}],"sizeInsertions":258,"sizeDeletions":0},{"number":"13","revision":"9ba73060710f6f4e79e86bdfc387f3d46bbbfbb4","parents":["372270f233f4f93abc1a5b54ce441cb1fc551bda"],"ref":"refs/changes/09/4609/13","uploader":{"name":"Carol Cobine","email":"carol.cobine@joyent.com","username":"ccobine"},"createdOn":1554230244,"author":{"name":"Carol Cobine","email":"carol.cobine@joyent.com","username":"ccobine"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1547127056,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"docs/operator-guide.md","type":"ADDED","insertions":258,"deletions":0}],"sizeInsertions":258,"sizeDeletions":0}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},{"name":"Carol Cobine","email":"carol.cobine@joyent.com","username":"ccobine"},{"name":"Ryan Puckett","email":"rpuckett@joyent.com","username":"ryanpuck"},{"name":"Angela Fong","email":"angela.fong@joyent.com","username":"askfongjojo"}]}