commit 41c2d6e190ca887234d6f9e7c49dbb318b2a16b1 (refs/changes/41/2841/2)
Author: Orlando Vazquez <ovazquez@gmail.com>
Date:   2017-10-24T02:20:28-07:00 (1 year, 11 months ago)
    
    CNAPI-725 test-task test failing because of a change introduced in CNAPI-724

diff --git a/lib/endpoints/tasks.js b/lib/endpoints/tasks.js
index 1aa5f58..050f36a 100644
--- a/lib/endpoints/tasks.js
+++ b/lib/endpoints/tasks.js
@@ -85,10 +85,8 @@ Task.wait = function handlerTaskWait(req, res, next) {
 
         wait(function (err) {
             if (err) {
-                req.log.error(err, 'error waiting on task');
-
-                next(new restify.InternalError(
-                    'error waiting on task'));
+                req.log.error(err, 'task we waited on had an error');
+                next(new restify.InternalError('error waiting on task'));
                 return;
             }
 
@@ -131,14 +129,14 @@ Task.wait = function handlerTaskWait(req, res, next) {
             taskid: req.params.taskid,
             timeoutSeconds:
                 req.params.timeout && parseInt(req.params.timeout, 10) || 3600
-        }, function (err, _task) {
+        }, function (err, taskResult) {
             if (err) {
                 req.log.debug(
                     { err: err }, 'handlerTaskWait: waitForTask error');
                 cb(err);
                 return;
             }
-            task = _task;
+            task = taskResult;
             cb();
         });
     }
diff --git a/lib/models/server.js b/lib/models/server.js
index e167280..0c4a56f 100644
--- a/lib/models/server.js
+++ b/lib/models/server.js
@@ -2222,7 +2222,7 @@ function (opts) {
 
                     updateTask(function () {
                         ModelServer.getApp().alertWaitingTasks(
-                            err, taskstatus.id, taskstatus);
+                            null, taskstatus.id, taskstatus);
                     });
 
                     var e = new VError(err, 'posting task to cn-agent');
@@ -2249,7 +2249,7 @@ function (opts) {
                 if (persist) {
                     updateTask(function () {
                         ModelServer.getApp().alertWaitingTasks(
-                            err, taskstatus.id, taskstatus);
+                            null, taskstatus.id, taskstatus);
                     });
                 }
 
