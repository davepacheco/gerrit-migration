From 7354012d871a98cfeba6ab962af30b16d0455e5f Mon Sep 17 00:00:00 2001
From: Jerry Jelinek <jerry.jelinek@joyent.com>
Date: Tue, 7 Nov 2017 21:42:26 +0000
Subject: [PATCH] OS-6435 cred reference count leak leads to zone livelock
 Reviewed by: Patrick Mooney <patrick.mooney@joyent.com> Approved by: Patrick
 Mooney <patrick.mooney@joyent.com>

---
 usr/src/uts/common/inet/squeue.c | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/usr/src/uts/common/inet/squeue.c b/usr/src/uts/common/inet/squeue.c
index 33bc43ca9a..a1c0dbe697 100644
--- a/usr/src/uts/common/inet/squeue.c
+++ b/usr/src/uts/common/inet/squeue.c
@@ -1500,6 +1500,9 @@ squeue_try_drain_one(squeue_t *sqp, conn_t *compare_conn)
 	CONN_DEC_REF(connp);
 	SQUEUE_DBG_CLEAR(sqp);
 
+	if (ira != NULL)
+		ira_cleanup(ira, B_TRUE);
+
 done:
 	mutex_enter(&sqp->sq_lock);
 	sqp->sq_state &= ~(SQS_PROC);
-- 
2.21.0

