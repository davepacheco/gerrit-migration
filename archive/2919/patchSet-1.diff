From c9963f4214e7cb80076f859261aca5c1d5114c10 Mon Sep 17 00:00:00 2001
From: Jerry Jelinek <jerry.jelinek@joyent.com>
Date: Tue, 7 Nov 2017 16:50:47 +0000
Subject: [PATCH] OS-6435 cred reference count leak leads to zone livelock

---
 usr/src/uts/common/inet/squeue.c | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/usr/src/uts/common/inet/squeue.c b/usr/src/uts/common/inet/squeue.c
index 33bc43ca9a..a1c0dbe697 100644
--- a/usr/src/uts/common/inet/squeue.c
+++ b/usr/src/uts/common/inet/squeue.c
@@ -1500,6 +1500,9 @@ squeue_try_drain_one(squeue_t *sqp, conn_t *compare_conn)
 	CONN_DEC_REF(connp);
 	SQUEUE_DBG_CLEAR(sqp);
 
+	if (ira != NULL)
+		ira_cleanup(ira, B_TRUE);
+
 done:
 	mutex_enter(&sqp->sq_lock);
 	sqp->sq_state &= ~(SQS_PROC);
-- 
2.21.0

