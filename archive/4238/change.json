{"project":"joyent/sdc-config-agent","branch":"master","id":"I3ff19c6e3454a2e5c0ce5e0b2cdd8b2c8c050ba7","number":"4238","subject":"TRITON-508 config-agent autometadata should contain an array of IPs for each nic TRITON-509 config-agent should use \u0027\u003ctag\u003e_rack_\u003crackid\u003e\u0027 as rack aware namespace Reviewed by: Cody Peter Mello \u003ccody.mello@joyent.com\u003e Approved by: Cody Peter Mello \u003ccody.mel","owner":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"url":"https://cr.joyent.us/4238","commitMessage":"TRITON-508 config-agent autometadata should contain an array of IPs for each nic\nTRITON-509 config-agent should use \u0027\u003ctag\u003e_rack_\u003crackid\u003e\u0027 as rack aware namespace\nReviewed by: Cody Peter Mello \u003ccody.mello@joyent.com\u003e\nApproved by: Cody Peter Mello \u003ccody.mello@joyent.com\u003e\n","createdOn":1529091719,"lastUpdated":1530562402,"open":false,"status":"MERGED","comments":[{"timestamp":1529091719,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 1."},{"timestamp":1529091750,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1529091890,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 2."},{"timestamp":1529091916,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1529104828,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 2:\n\n(3 comments)"},{"timestamp":1530021821,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 3."},{"timestamp":1530021849,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1530128835,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 3:\n\n(2 comments)"},{"timestamp":1530132460,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 4."},{"timestamp":1530132466,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Patch Set 3:\n\n(2 comments)"},{"timestamp":1530132487,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1530554556,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 4: Code-Review+1 Integration-Approval+1"},{"timestamp":1530554814,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 5: Commit message was updated."},{"timestamp":1530562402,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Rui"}],"currentPatchSet":{"number":"5","revision":"3ff19c6e3454a2e5c0ce5e0b2cdd8b2c8c050ba7","parents":["a1ae27747f1950e71922563ad3371a5bc74665c7"],"ref":"refs/changes/38/4238/5","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1530554814,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1530132487,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1530554556,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1530554556,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"SUBM","value":"1","grantedOn":1530562402,"by":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"agent.js","type":"MODIFIED","insertions":34,"deletions":-10}],"sizeInsertions":34,"sizeDeletions":-10},"patchSets":[{"number":"1","revision":"737382f03554b6593b125175dd3878a58c906a06","parents":["a1ae27747f1950e71922563ad3371a5bc74665c7"],"ref":"refs/changes/38/4238/1","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1529091719,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1529091750,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"agent.js","type":"MODIFIED","insertions":74,"deletions":-33}],"sizeInsertions":74,"sizeDeletions":-33},{"number":"2","revision":"8527134a961bcd9a23a4c317a73d29b82d3556a2","parents":["a1ae27747f1950e71922563ad3371a5bc74665c7"],"ref":"refs/changes/38/4238/2","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1529091890,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1529091916,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"/COMMIT_MSG","line":8,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Accidental newline"},{"file":"agent.js","line":207,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Do we need this indexOf anymore if we\u0027re going to use \u0027Admin NIC Tag\u0027 for RAN?"},{"file":"agent.js","line":239,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"What\u0027s the plan for this to work inside the zone?"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"agent.js","type":"MODIFIED","insertions":74,"deletions":-33}],"sizeInsertions":74,"sizeDeletions":-33},{"number":"3","revision":"3a742a89a4b7d79ef7bd23aa1fa4d6f1044ebff4","parents":["a1ae27747f1950e71922563ad3371a5bc74665c7"],"ref":"refs/changes/38/4238/3","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1530021821,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1530021849,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"agent.js","line":290,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"You may want to write this as:\n\n    if (nic.nic_tag \u0026\u0026 Array.isArray(nic.ips)) {\n\nJust to be safe. We\u0027ve bumped the minimum platform to a version that has nic.ips, but if someone creates a NIC w/o any addresses, then I believe the array will be absent."},{"file":"agent.js","line":290,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"},{"file":"agent.js","line":291,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Since you\u0027re using nic.ips here, you can remove the nic.ip line below, since it is just a representative IPv4 address from the array."},{"file":"agent.js","line":291,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"See the comment above.  I was treating \u0027nic.ip\u0027 as the primary IP for that NIC.  \n\nIn the event that a user is using multiple IPs for a nic, and this change treats auto.\u003cTAG\u003e_IP as being the last in the \u0027nic.ip\u0027 array, that may result in unexpected behavior for such a user.\n\nIf you don\u0027t think this is a concern, then I\u0027ll remove the \"setNicTag(nic.nic_tag, nic.ip);\" line."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"agent.js","type":"MODIFIED","insertions":33,"deletions":-9}],"sizeInsertions":33,"sizeDeletions":-9},{"number":"4","revision":"71fe26b47a7ef52c5793c618c9fbc04b08a065e9","parents":["a1ae27747f1950e71922563ad3371a5bc74665c7"],"ref":"refs/changes/38/4238/4","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1530132460,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1530554556,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1530554556,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1530132487,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"agent.js","type":"MODIFIED","insertions":34,"deletions":-10}],"sizeInsertions":34,"sizeDeletions":-10},{"number":"5","revision":"3ff19c6e3454a2e5c0ce5e0b2cdd8b2c8c050ba7","parents":["a1ae27747f1950e71922563ad3371a5bc74665c7"],"ref":"refs/changes/38/4238/5","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1530554814,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1530554556,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1530554556,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1530132487,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"SUBM","value":"1","grantedOn":1530562402,"by":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"agent.js","type":"MODIFIED","insertions":34,"deletions":-10}],"sizeInsertions":34,"sizeDeletions":-10}],"allReviewers":[{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"}]}