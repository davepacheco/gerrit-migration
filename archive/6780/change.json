{"project":"joyent/pgstatsmon","branch":"master","topic":"MANTA-4318","id":"I98ba9e8f6938fce01cd68af8cdc3e167dfa07b00","number":"6780","subject":"MANTA-4318 pgstatsmon needs to be able to talk to buckets postgres MANTA-4378 pgstatsmon should consider schema when gathering relation-specific data","owner":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"url":"https://cr.joyent.us/6780","commitMessage":"MANTA-4318 pgstatsmon needs to be able to talk to buckets postgres\nMANTA-4378 pgstatsmon should consider schema when gathering relation-specific data\n","createdOn":1565621130,"lastUpdated":1571156748,"open":true,"status":"NEW","comments":[{"timestamp":1565621130,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"Uploaded patch set 1."},{"timestamp":1565621168,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing-1\n\n\"make check\" exited with status 2\n\n fatal: ref HEAD is not a symbolic ref\n deps/javascriptlint/build/install/jsl --nologo --nosummary --conf\u003djsl.node.conf bin/pgstatsmon.js lib/pgstatsmon.js lib/pgclient.js lib/dtrace.js lib/dbinit.js lib/queries.js test/badquery.tst.js test/validate_queries.tst.js test/basic.tst.js test/get_queries.tst.js test/helper.js\n /tmp/repo/bin/pgstatsmon.js\n /tmp/repo/lib/pgstatsmon.js\n /tmp/repo/lib/pgclient.js\n /tmp/repo/lib/dtrace.js\n /tmp/repo/lib/dbinit.js\n /tmp/repo/lib/queries.js\n /tmp/repo/test/badquery.tst.js\n /tmp/repo/test/validate_queries.tst.js\n /tmp/repo/test/basic.tst.js\n /tmp/repo/test/get_queries.tst.js\n /tmp/repo/test/helper.js\n json --validate -f package.json\n json --validate -f etc/vmapi.json\n json --validate -f etc/static.json\n json --validate -f test/etc/testconfig.json\n deps/jsstyle/jsstyle  bin/pgstatsmon.js lib/pgstatsmon.js lib/pgclient.js lib/dtrace.js lib/dbinit.js lib/queries.js test/badquery.tst.js test/validate_queries.tst.js test/basic.tst.js test/get_queries.tst.js test/helper.js\n deps/eng/tools/check-copyright -q\n error: lib/dbinit.js: copyright not in RFD 164 form, \u0027 * Copyright (c) 2019 Joyent, Inc.\u0027 does not match /Copyright [0-9]{4} Joyent, Inc\\.$/\n error: lib/pgclient.js: copyright not in RFD 164 form, \u0027 * Copyright (c) 2019, Joyent, Inc.\u0027 does not match /Copyright [0-9]{4} Joyent, Inc\\.$/\n error: lib/pgstatsmon.js: copyright not in RFD 164 form, \u0027 * Copyright (c) 2019 Joyent, Inc.\u0027 does not match /Copyright [0-9]{4} Joyent, Inc\\.$/\n error: lib/queries.js: copyright not in RFD 164 form, \u0027 * Copyright (c) 2019 Joyent, Inc.\u0027 does not match /Copyright [0-9]{4} Joyent, Inc\\.$/\n gmake: *** [deps/eng/tools/mk/Makefile.targ:292: check-copyright] Error 1"},{"timestamp":1565621400,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"Uploaded patch set 2."},{"timestamp":1565621438,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1567631757,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 2:\n\n(1 comment)\n\nThis looks good to me too. Thanks."},{"timestamp":1567689921,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"Topic set to MANTA-4318"},{"timestamp":1567690021,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1568078318,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1568100044,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1568125318,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1568126738,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Patch Set 2: Code-Review+1"},{"timestamp":1570199234,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 2: Code-Review+1"},{"timestamp":1570642437,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 2:\n\nI think this looks good for IA once we have the new node-vmapi-resolver version up and add it to the package.json file."},{"timestamp":1571156393,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"Uploaded patch set 3."},{"timestamp":1571156431,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1571156552,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 3: Code-Review+1 Integration-Approval+1"},{"timestamp":1571156748,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"Patch Set 3:\n\nI\u0027ve pushed PS3 to use vmapi-resolver by version number instead of my fork.\n\nI added a few lines to the bottom of my testing notes here to show an image being built and used:\n\n    https://jira.joyent.us/browse/MANTA-4318?focusedCommentId\u003d263669\u0026page\u003dcom.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-263669\n\nHopefully it\u0027s not too confusing adding to these notes, but I tend to prefer to keep them all in one place!"}],"currentPatchSet":{"number":"3","revision":"98ba9e8f6938fce01cd68af8cdc3e167dfa07b00","parents":["b7bba02b2bd2f5c35dcbfa87b59bbca00e8dd332"],"ref":"refs/changes/80/6780/3","uploader":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"createdOn":1571156393,"author":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1571156431,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1571156552,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1571156552,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"etc/vmapi.json","type":"MODIFIED","insertions":10,"deletions":-2},{"file":"lib/dbinit.js","type":"MODIFIED","insertions":9,"deletions":-2},{"file":"lib/pgclient.js","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"lib/pgstatsmon.js","type":"MODIFIED","insertions":48,"deletions":-14},{"file":"lib/queries.js","type":"MODIFIED","insertions":29,"deletions":-24},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"sapi_manifests/pgstatsmon/template","type":"MODIFIED","insertions":7,"deletions":0}],"sizeInsertions":107,"sizeDeletions":-45},"patchSets":[{"number":"1","revision":"49b7adec70babb310155b2bfbdd18375b233ba5d","parents":["b7bba02b2bd2f5c35dcbfa87b59bbca00e8dd332"],"ref":"refs/changes/80/6780/1","uploader":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"createdOn":1565621130,"author":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1565621168,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"etc/vmapi.json","type":"MODIFIED","insertions":10,"deletions":-2},{"file":"lib/dbinit.js","type":"MODIFIED","insertions":8,"deletions":-1},{"file":"lib/pgclient.js","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"lib/pgstatsmon.js","type":"MODIFIED","insertions":47,"deletions":-13},{"file":"lib/queries.js","type":"MODIFIED","insertions":28,"deletions":-23},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"sapi_manifests/pgstatsmon/template","type":"MODIFIED","insertions":7,"deletions":0}],"sizeInsertions":104,"sizeDeletions":-42},{"number":"2","revision":"d7be08569f1c16c6a0918558266a18a5e87c48ba","parents":["b7bba02b2bd2f5c35dcbfa87b59bbca00e8dd332"],"ref":"refs/changes/80/6780/2","uploader":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"createdOn":1565621400,"author":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1565621438,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1570199234,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1568126738,"by":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"}}],"comments":[{"file":"etc/vmapi.json","line":16,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Should we also change the SAPI configuration here (https://github.com/joyent/sdc-manta/blob/master/config/services/pgstatsmon/service.json#L9)?"},{"file":"etc/vmapi.json","line":16,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"Yes, thanks for the reminder! I pushed https://cr.joyent.us/#/c/6873/ for that and have linked these changes with a topic in gerrit."},{"file":"package.json","line":21,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Is this going to be updated to a proper release prior to merge or is it going to be this way for a while? Just curious so that we can make sure to file a ticket to not indefinitely use a branch."},{"file":"package.json","line":21,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"Sorry, Kelly! I should have made a note about this somewhere.\n\nIt\u0027s a bit of a pain, but I tend to do this when there are dependency updates required as part of the overall change so that local builds or local testing doesn\u0027t need to differ when I push patch sets for review. Once the dependency has been integrated I\u0027ll make sure it\u0027s properly released and update this line, then probably add to the testing notes as well."},{"file":"package.json","line":21,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Not a problem at all. I assumed that was the case, but I just wanted to double-check with you."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"etc/vmapi.json","type":"MODIFIED","insertions":10,"deletions":-2},{"file":"lib/dbinit.js","type":"MODIFIED","insertions":9,"deletions":-2},{"file":"lib/pgclient.js","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"lib/pgstatsmon.js","type":"MODIFIED","insertions":48,"deletions":-14},{"file":"lib/queries.js","type":"MODIFIED","insertions":29,"deletions":-24},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"sapi_manifests/pgstatsmon/template","type":"MODIFIED","insertions":7,"deletions":0}],"sizeInsertions":107,"sizeDeletions":-45},{"number":"3","revision":"98ba9e8f6938fce01cd68af8cdc3e167dfa07b00","parents":["b7bba02b2bd2f5c35dcbfa87b59bbca00e8dd332"],"ref":"refs/changes/80/6780/3","uploader":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"createdOn":1571156393,"author":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1571156431,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1571156552,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1571156552,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"etc/vmapi.json","type":"MODIFIED","insertions":10,"deletions":-2},{"file":"lib/dbinit.js","type":"MODIFIED","insertions":9,"deletions":-2},{"file":"lib/pgclient.js","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"lib/pgstatsmon.js","type":"MODIFIED","insertions":48,"deletions":-14},{"file":"lib/queries.js","type":"MODIFIED","insertions":29,"deletions":-24},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"sapi_manifests/pgstatsmon/template","type":"MODIFIED","insertions":7,"deletions":0}],"sizeInsertions":107,"sizeDeletions":-45}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"}]}