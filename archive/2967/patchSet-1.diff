From eb786d929f116a7192fff2db990c5fc873e74f65 Mon Sep 17 00:00:00 2001
From: Andy Fiddaman <omnios@citrus-it.co.uk>
Date: Sun, 19 Nov 2017 22:42:50 +0000
Subject: [PATCH] OS-6463 Clearing a thread name before setting causes panic

---
 usr/src/uts/common/brand/lx/syscall/lx_prctl.c | 6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

diff --git a/usr/src/uts/common/brand/lx/syscall/lx_prctl.c b/usr/src/uts/common/brand/lx/syscall/lx_prctl.c
index 4aeb2b191e..2662826281 100644
--- a/usr/src/uts/common/brand/lx/syscall/lx_prctl.c
+++ b/usr/src/uts/common/brand/lx/syscall/lx_prctl.c
@@ -200,8 +200,10 @@ lx_prctl(int opt, uintptr_t data)
 		 * Linux.
 		 */
 		mutex_enter(&p->p_lock);
-		(void) strncpy(p->p_user.u_comm, t->t_name, MAXCOMLEN + 1);
-		(void) strncpy(p->p_user.u_psargs, t->t_name, PSARGSZ);
+		(void) strncpy(p->p_user.u_comm,
+		    t->t_name != NULL ? t->t_name : name, MAXCOMLEN + 1);
+		(void) strncpy(p->p_user.u_psargs,
+		    t->t_name != NULL ? t->t_name : name, PSARGSZ);
 		mutex_exit(&p->p_lock);
 		return (0);
 	}
-- 
2.21.0

