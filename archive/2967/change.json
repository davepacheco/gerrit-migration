{"project":"joyent/illumos-joyent","branch":"master","id":"I99b859c7466d1745fdbf023efbb434b0e9f38e53","number":"2967","subject":"OS-6463 Don\u0027t allow clearing of thread name in LX on TID 1 Reviewed by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e Reviewed by: Dan McDonald \u003cdanmcd@joyent.com\u003e Approved by: Dan McDonald \u003cdanmcd@joyent.com\u003e","owner":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"url":"https://cr.joyent.us/2967","commitMessage":"OS-6463 Don\u0027t allow clearing of thread name in LX on TID 1\nReviewed by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e\nReviewed by: Dan McDonald \u003cdanmcd@joyent.com\u003e\nApproved by: Dan McDonald \u003cdanmcd@joyent.com\u003e\n","createdOn":1511195373,"lastUpdated":1511227448,"open":false,"status":"MERGED","comments":[{"timestamp":1511195373,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Uploaded patch set 1."},{"timestamp":1511196057,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 1:\n\nI\u0027m not sure I agree with this fix. It seems like it would make more sense to skip setting the process names if t_name is NULL. Is there a reason that approach was not chosen? What does Linux do for this case? Are the processes unnamed there?"},{"timestamp":1511196538,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 1: Code-Review+1\n\n(1 comment)"},{"timestamp":1511196633,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 1: Code-Review-1\n\nI tested this on Linux with a pause at the end of the test program and ps still shows the program name, so I think this fix is incorrect."},{"timestamp":1511196685,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 1:\n\n\u003e I tested this on Linux with a pause at the end of the test program\n \u003e and ps still shows the program name, so I think this fix is\n \u003e incorrect.\n\nJason -- didn\u0027t you say that ps on Linux finds this in a different spot?"},{"timestamp":1511196813,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 1:\n\nYes -- at least on the (older) debian box I tested, ps still showed the cmdline invocation, while reading /proc/PID/task/TID/comm came back empty -- I\u0027m trying to see if I can determine what\u0027s going on with ps now (though there appear to be multiple fork/branches of the ps source, so no clue if i\u0027m looking at the \u0027right\u0027 one)"},{"timestamp":1511197128,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 1:\n\nI think the best option is to simply change the fix so it does not overwrite the process variables when the input it null."},{"timestamp":1511201017,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Uploaded patch set 2."},{"timestamp":1511201646,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 2: Code-Review+1\n\nBetter, and I see you\u0027re already checking with Andy about what OmniOSce found."},{"timestamp":1511203950,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 2: Code-Review+1\n\nThanks for humoring me!"},{"timestamp":1511205409,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 2:\n\nOne comment. Before you IA this, can you make the bug summary something blander"},{"timestamp":1511205526,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 2:\n\nWill do -- I\u0027m waiting for the patch set 2 code to build to verify the fix works with it as well (and am looking at the code that caused the original issue to see if I can figure out if it\u0027ll be unhappy or not), so I\u0027ll take care of that once I\u0027ve updated the testing results."},{"timestamp":1511208335,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Uploaded patch set 3: Commit message was updated."},{"timestamp":1511208517,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 3: Integration-Approval+1"},{"timestamp":1511213569,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Uploaded patch set 4: Commit message was updated."},{"timestamp":1511227448,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Jason King"}],"currentPatchSet":{"number":"4","revision":"99b859c7466d1745fdbf023efbb434b0e9f38e53","parents":["2d0998ba9095083be74c87c6dd61bd2d364b00ac"],"ref":"refs/changes/67/2967/4","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1511213569,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1511201646,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1511203950,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1511208517,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"SUBM","value":"1","grantedOn":1511227448,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/uts/common/brand/lx/syscall/lx_prctl.c","type":"MODIFIED","insertions":10,"deletions":0}],"sizeInsertions":10,"sizeDeletions":0},"patchSets":[{"number":"1","revision":"eb786d929f116a7192fff2db990c5fc873e74f65","parents":["2d0998ba9095083be74c87c6dd61bd2d364b00ac"],"ref":"refs/changes/67/2967/1","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1511195373,"author":{"name":"Andy Fiddaman","email":"omnios@citrus-it.co.uk","username":"citrus-it"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"-1","grantedOn":1511196633,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1511196538,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}}],"comments":[{"file":"usr/src/uts/common/brand/lx/syscall/lx_prctl.c","line":194,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"It may mess up the paragraph formatting but:\n\n\"We explicitly use t-\u003et_name (if it\u0027s not NULL) here...\""}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/brand/lx/syscall/lx_prctl.c","type":"MODIFIED","insertions":4,"deletions":-2}],"sizeInsertions":4,"sizeDeletions":-2},{"number":"2","revision":"18f58dd7ad366c8a87f5fbd1cd98c62d45aa233e","parents":["2d0998ba9095083be74c87c6dd61bd2d364b00ac"],"ref":"refs/changes/67/2967/2","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1511201017,"author":{"name":"Andy Fiddaman","email":"omnios@citrus-it.co.uk","username":"citrus-it"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1511203950,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1511201646,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/brand/lx/syscall/lx_prctl.c","type":"MODIFIED","insertions":10,"deletions":0}],"sizeInsertions":10,"sizeDeletions":0},{"number":"3","revision":"b44cac39a0d0fd01483726546f06b3b79f9c9951","parents":["2d0998ba9095083be74c87c6dd61bd2d364b00ac"],"ref":"refs/changes/67/2967/3","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1511208335,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1511203950,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1511201646,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1511208517,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/uts/common/brand/lx/syscall/lx_prctl.c","type":"MODIFIED","insertions":10,"deletions":0}],"sizeInsertions":10,"sizeDeletions":0},{"number":"4","revision":"99b859c7466d1745fdbf023efbb434b0e9f38e53","parents":["2d0998ba9095083be74c87c6dd61bd2d364b00ac"],"ref":"refs/changes/67/2967/4","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1511213569,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1511203950,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"SUBM","value":"1","grantedOn":1511227448,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1511201646,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1511208517,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/uts/common/brand/lx/syscall/lx_prctl.c","type":"MODIFIED","insertions":10,"deletions":0}],"sizeInsertions":10,"sizeDeletions":0}],"allReviewers":[{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}]}