commit 18f58dd7ad366c8a87f5fbd1cd98c62d45aa233e (refs/changes/67/2967/2)
Author: Andy Fiddaman <omnios@citrus-it.co.uk>
Date:   2017-11-20T18:02:37+00:00 (1 year, 11 months ago)
    
    OS-6463 Clearing a thread name before setting causes panic

diff --git a/usr/src/uts/common/brand/lx/syscall/lx_prctl.c b/usr/src/uts/common/brand/lx/syscall/lx_prctl.c
index 4aeb2b191e..4aecb6e9cc 100644
--- a/usr/src/uts/common/brand/lx/syscall/lx_prctl.c
+++ b/usr/src/uts/common/brand/lx/syscall/lx_prctl.c
@@ -190,6 +190,16 @@ lx_prctl(int opt, uintptr_t data)
 			return (0);
 		}
 
+		/*
+		 * We are currently choosing to not allow an empty thread
+		 * name to clear p->p_user.u_comm and p->p_user.u_psargs.
+		 * This is a slight divergence from linux behavior (which
+		 * allows this) so that we can preserve the original command.
+		 */
+		if (strlen(name) == 0) {
+			return (0);
+		}
+
 		/*
 		 * We explicitly use t->t_name here instead of name in case
 		 * a thread has come in between the above thread_setname()
