From 9b56e204c9533d054deb64cbb28ca86b9b5f102b Mon Sep 17 00:00:00 2001
From: Marsell Kukuljevic <marsell@joyent.com>
Date: Tue, 18 Sep 2018 00:32:27 +1200
Subject: [PATCH] =?UTF-8?q?TRITON-773=20Error=20when=20creating=20bhyve=20?=
 =?UTF-8?q?instance=20using=20an=20image=20without=20a=20requirements=20at?=
 =?UTF-8?q?tribute=20Reviewed=20by:=20Mike=20Gerdts=20<mike.gerdts@joyent.?=
 =?UTF-8?q?com>=20Reviewed=20by:=20Pedro=20Palaz=C3=B3n=20Candel=20<pedro@?=
 =?UTF-8?q?joyent.com>=20Approved=20by:=20Pedro=20Palaz=C3=B3n=20Candel=20?=
 =?UTF-8?q?<pedro@joyent.com>?=
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

---
 lib/machines.js | 6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

diff --git a/lib/machines.js b/lib/machines.js
index 1b5d721..153afd1 100644
--- a/lib/machines.js
+++ b/lib/machines.js
@@ -423,8 +423,10 @@ function getCreateOptions(req) {
             // With bhyve we also need to always set boot=true for the image
             // disk. This avoids the problem described in OS-6604.
             opts.disks[0].boot = true;
-            if (img.requirements.hasOwnProperty('bootrom')) {
-                opts.bootrom = img.requirements.bootrom;
+
+            var imgBootrom = img.requirements && img.requirements.bootrom;
+            if (imgBootrom) {
+                opts.bootrom = imgBootrom;
             }
         }
 
-- 
2.21.0

