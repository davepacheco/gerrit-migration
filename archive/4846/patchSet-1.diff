From 005182cd92ec5dd23fb30e35290cba55bfb0f7ae Mon Sep 17 00:00:00 2001
From: Marsell Kukuljevic <marsell@joyent.com>
Date: Tue, 18 Sep 2018 00:32:27 +1200
Subject: [PATCH] TRITON-773 Error when creating bhyve instance using an image
 without a requirements attribute

---
 lib/machines.js | 6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

diff --git a/lib/machines.js b/lib/machines.js
index 1b5d721..153afd1 100644
--- a/lib/machines.js
+++ b/lib/machines.js
@@ -423,8 +423,10 @@ function getCreateOptions(req) {
             // With bhyve we also need to always set boot=true for the image
             // disk. This avoids the problem described in OS-6604.
             opts.disks[0].boot = true;
-            if (img.requirements.hasOwnProperty('bootrom')) {
-                opts.bootrom = img.requirements.bootrom;
+
+            var imgBootrom = img.requirements && img.requirements.bootrom;
+            if (imgBootrom) {
+                opts.bootrom = imgBootrom;
             }
         }
 
-- 
2.21.0

