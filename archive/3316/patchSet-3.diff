From aa98bc79bfe78995eb28263c8e9a1ae278141b21 Mon Sep 17 00:00:00 2001
From: Mike Gerdts <mike.gerdts@joyent.com>
Date: Fri, 5 Jan 2018 05:30:25 +0000
Subject: [PATCH] OS-6552 devnet_filldir should only call sdev_cleandir on
 directories, again

---
 usr/src/uts/common/fs/dev/sdev_netops.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/usr/src/uts/common/fs/dev/sdev_netops.c b/usr/src/uts/common/fs/dev/sdev_netops.c
index 41441ec52d..a0edd668f2 100644
--- a/usr/src/uts/common/fs/dev/sdev_netops.c
+++ b/usr/src/uts/common/fs/dev/sdev_netops.c
@@ -21,7 +21,7 @@
 /*
  * Copyright 2009 Sun Microsystems, Inc.  All rights reserved.
  * Use is subject to license terms.
- * Copyright (c) 2014, Joyent, Inc.  All rights reserved.
+ * Copyright (c) 2018, Joyent, Inc.  All rights reserved.
  */
 
 /*
@@ -487,7 +487,7 @@ devnet_filldir(struct sdev_node *ddv)
 		/*
 		 * Clean out everything underneath before we remove ourselves.
 		 */
-		if (SDEVTOV(ddv)->v_type == VDIR) {
+		if (SDEVTOV(dv)->v_type == VDIR) {
 			ret = sdev_cleandir(dv, NULL, 0);
 			ASSERT(ret == 0);
 		}
-- 
2.21.0

