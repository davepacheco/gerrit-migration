commit 520fa152dc874dcf38e4285b33b63345deb3c905 (refs/changes/16/4616/4)
Author: Dan McDonald <danmcd@joyent.com>
Date:   2018-08-13T16:39:26-04:00 (1 year, 2 months ago)
    
    OS-7009 varpd fails to start on boot, missing overlay module
    Reviewed by: Jason King <jbk@joyent.com>
    Reviewed by: John Levon <john.levon@joyent.com>
    Approved by: Angela Fong <angela.fong@joyent.com>

diff --git a/usr/src/cmd/zoneadm/zones.xml b/usr/src/cmd/zoneadm/zones.xml
index 1b6f8cd49b..b094bc660b 100644
--- a/usr/src/cmd/zoneadm/zones.xml
+++ b/usr/src/cmd/zoneadm/zones.xml
@@ -54,6 +54,19 @@
 		<service_fmri value='svc:/milestone/multi-user-server' />
 	</dependency>
 
+	<!--
+	    Until overlay device creation is moved out of the zone
+	    state-change script, zones must be dependent on varpd's
+	    successful launch.
+	-->
+	<dependency
+		name='varpd'
+		type='service'
+		grouping='require_all'
+		restart_on='none'>
+		<service_fmri value='svc:/network/varpd' />
+	</dependency>
+
 	<dependency
 		name='metadata'
 		type='service'
