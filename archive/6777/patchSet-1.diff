From 8a63496baf8e570e5d528372eedb4550682dbf96 Mon Sep 17 00:00:00 2001
From: Tim Foster <tim.foster@joyent.com>
Date: Fri, 9 Aug 2019 14:14:55 +0100
Subject: [PATCH] OS-7921 SmartOS bash_completions should complete alias names

---
 src/vm/etc/vmadm.completion | 9 +++++++++
 1 file changed, 9 insertions(+)

diff --git a/src/vm/etc/vmadm.completion b/src/vm/etc/vmadm.completion
index 89871e13..6d9f7f85 100644
--- a/src/vm/etc/vmadm.completion
+++ b/src/vm/etc/vmadm.completion
@@ -27,6 +27,9 @@ _vmadm()
         vms_uuids=$(zoneadm list -cp | grep -v ':global:' | cut -d':' -f5 | \
             sort | uniq)
         COMPREPLY=( $(compgen -W "${vms_uuids}" -- ${cur}) )
+        if [[ -z "$COMPREPLY" ]]; then
+            _zone_alias
+        fi
 
     elif [[ ${prev} == 'info'
           || ${prev} == 'sysrq' ]]; then
@@ -36,6 +39,9 @@ _vmadm()
             grep ":[bh]*[ky]v[em]:excl:" | \
             cut -d':' -f5 | sort | uniq)
         COMPREPLY=( $(compgen -W "${vms_uuids}" -- ${cur}) )
+        if [[ -z "$COMPREPLY" ]]; then
+            _zone_alias
+        fi
 
     elif [[ ${prev} == 'create-snapshot'
         || ${prev} == 'delete-snapshot'
@@ -44,6 +50,9 @@ _vmadm()
         vms_uuids=$(zoneadm list -cp |
 	    nawk -F: '$2 != "global" && $6 != "kvm" { print $5 }' | sort -u)
         COMPREPLY=( $(compgen -W "${vms_uuids}" -- ${cur}) )
+        if [[ -z "$COMPREPLY" ]]; then
+            _zone_alias
+        fi
 
     elif [[ ${prev} == 'validate' ]]; then
 
-- 
2.21.0

