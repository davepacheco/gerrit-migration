{"project":"joyent/sdc-headnode","branch":"master","id":"I1da8bdd09abc6c68f39d70ef9cce0bb242891171","number":"6857","subject":"CAPI-527 UFDS needs to generate dynamic root credentials. Reviewed by: Pedro Palazón Candel \u003cpedro@joyent.com\u003e Approved by: Trent Mick \u003ctrentm@gmail.com\u003e","owner":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"url":"https://cr.joyent.us/6857","commitMessage":"CAPI-527 UFDS needs to generate dynamic root credentials.\nReviewed by: Pedro Palazón Candel \u003cpedro@joyent.com\u003e\nApproved by: Trent Mick \u003ctrentm@gmail.com\u003e\n","createdOn":1567214743,"lastUpdated":1568759615,"open":false,"status":"MERGED","comments":[{"timestamp":1567214743,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Uploaded patch set 1."},{"timestamp":1567214744,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit 57f06fa98b2f6e006cd60435ab95cd9edcd3f09e\n    \n    1"},{"timestamp":1567214848,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1567637840,"reviewer":{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"},"message":"Patch Set 1: Code-Review+1"},{"timestamp":1567705710,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Uploaded patch set 2: Commit message was updated."},{"timestamp":1567706447,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 2: Code-Review+1"},{"timestamp":1567720324,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 2: Integration-Approval+1\n\nBrian,\n\nThanks. I\u0027m giving IA, but it would be good to do the following:\n- don\u0027t merge this right before a release is going out (to give us a day or two to run nightly before a release is cut)\n- watch ~nightly the next day or two to ensure that headnode setup completes successfully"},{"timestamp":1567790714,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Patch Set 2:\n\nI also want to make sure that sdc-ufds-m2s works with this change. At a minimum it should prompt for the remote ufds root password and add that to the local sapi. In prod, we\u0027ve always run with the same ufds root password for all DCs, so I\u0027m not 100% sure everything will work if they\u0027re different. I don\u0027t have a great place for testing this though."},{"timestamp":1567811476,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Uploaded patch set 3."},{"timestamp":1567811476,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Patch Set 3:\n\nNew commits:\n    \n    commit 971383ceefba0db68671be7ed32ea1aca2250639\n    \n    3"},{"timestamp":1567811593,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing-1\n\n\"make check\" exited with status 2\n\n buildtools/bashstyle scripts/update-usbkey.0.esp.sh\n buildtools/bashstyle scripts/joysetup.sh\n buildtools/bashstyle tools/bin/sdc\n buildtools/bashstyle tools/bin/sdc-healthcheck\n buildtools/bashstyle tools/bin/sdc-vm\n buildtools/bashstyle tools/bin/sdc-backup\n buildtools/bashstyle tools/bin/sdc-sbcreate\n buildtools/bashstyle tools/bin/sdc-ldap\n buildtools/bashstyle tools/bin/sdc-vmmanifest\n buildtools/bashstyle tools/bin/libdc.sh\n buildtools/bashstyle tools/bin/sdc-network\n buildtools/bashstyle tools/bin/sdc-phonehome\n buildtools/bashstyle tools/bin/sdc-login\n buildtools/bashstyle tools/bin/sdc-image-sync\n buildtools/bashstyle tools/bin/sdc-setconsole\n buildtools/bashstyle tools/bin/sdc-role\n buildtools/bashstyle tools/bin/sdc-amonrelay\n buildtools/bashstyle tools/bin/sdc-ufds-m2s\n buildtools/bashstyle tools/bin/sdc-restore\n buildtools/bashstyle tools/bin/sdc-vmname\n buildtools/bashstyle tools/bin/joyent-imgadm\n buildtools/bashstyle tools/lib/wrap.sh\n buildtools/bashstyle buildtools/lib/common.sh\n buildtools/bashstyle buildtools/lib/error_handler.sh\n buildtools/bashstyle buildtools/lib/trace_logger.sh\n buildtools/bashstyle bin/include-tar-generic\n buildtools/bashstyle bin/build-image\n buildtools/bashstyle bin/build-usb-image\n buildtools/bashstyle bin/mk-sdc-clients-light.sh\n buildtools/bashstyle bin/build-tar-image\n buildtools/bashstyle bin/reflash\n buildtools/bashstyle bin/build-coal-image\n buildtools/bashstyle bin/build-dataset\n buildtools/bashstyle bin/rsync-to\n for dev in ; do  \\\n     mount | grep \"on ${dev}\" | cut -d\u0027 \u0027 -f1 | while read mntpath; do \\\n         pfexec umount ${mntpath}; \\\n         done; \\\n     pfexec lofiadm -d ${dev}; \\\n done\n pfexec rm -rf /tmp/sdc-headnode-tmp.*\n cd buildtools/novus \u0026\u0026 gmake check\n gmake[1]: Entering directory \u0027/tmp/repo/buildtools/novus\u0027\n No code style errors found.\n gmake[1]: Leaving directory \u0027/tmp/repo/buildtools/novus\u0027\n deps/jsstyle/jsstyle -o indent\u003d4,doxygen,unparenthesized-return\u003d0 scripts/update-usbkey.5.copy-contents.js scripts/sdc-init.js scripts/build-payload.js scripts/sdc-deploy.js tools/cmd/sdc-usbkey.js tools/lib/usbkey.js tools/lib/oscmds.js tools/lib/common.js tools/bin/sdc-rabbitstat tools/bin/sdc-server tools/bin/sdc-heartbeatsnoop\n deps/eng/tools/check-copyright -q\n error: tools/bin/sdc-ufds-m2s: copyright not in RFD 164 form, \u0027# Copyright (c) 2019, Joyent, Inc.\u0027 does not match /Copyright [0-9]{4} Joyent, Inc\\.$/\n gmake: *** [deps/eng/tools/mk/Makefile.targ:292: check-copyright] Error 1"},{"timestamp":1567811825,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Uploaded patch set 4."},{"timestamp":1567811825,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Patch Set 4:\n\nNew commits:\n    \n    commit a8306cbd1c8690ff3c7552c38a6211394608bed2\n    \n    4 pass make check"},{"timestamp":1567811931,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1568021738,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 4: Code-Review+1\n\nLooks great Brian! Thanks for taking the time to do this."},{"timestamp":1568071930,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 4: Integration-Approval+1"},{"timestamp":1568072127,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Uploaded patch set 5: Commit message was updated."},{"timestamp":1568759615,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Brian Bennett"}],"currentPatchSet":{"number":"5","revision":"1da8bdd09abc6c68f39d70ef9cce0bb242891171","parents":["4751111ab26017aeb0f9f74ef7762087b12331f2"],"ref":"refs/changes/57/6857/5","uploader":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"createdOn":1568072127,"author":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1567811931,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1568021738,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1568071930,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1568759615,"by":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"scripts/prompt-config.sh","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"tools/bin/sdc-ufds-m2s","type":"MODIFIED","insertions":30,"deletions":-12}],"sizeInsertions":35,"sizeDeletions":-13},"patchSets":[{"number":"1","revision":"fd16f63af8ee02c7c07230ef0c814bb59206c962","parents":["4751111ab26017aeb0f9f74ef7762087b12331f2"],"ref":"refs/changes/57/6857/1","uploader":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"createdOn":1567214743,"author":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1567214848,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1567637840,"by":{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"scripts/prompt-config.sh","type":"MODIFIED","insertions":5,"deletions":-1}],"sizeInsertions":5,"sizeDeletions":-1},{"number":"2","revision":"14f0b23db2624b4ab9f27584dffb0f26b1579215","parents":["4751111ab26017aeb0f9f74ef7762087b12331f2"],"ref":"refs/changes/57/6857/2","uploader":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"createdOn":1567705710,"author":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1567214848,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1567637840,"by":{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1567720324,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1567706447,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"scripts/prompt-config.sh","type":"MODIFIED","insertions":5,"deletions":-1}],"sizeInsertions":5,"sizeDeletions":-1},{"number":"3","revision":"440b4c007bfa861598c765f79014426fdce9d79e","parents":["4751111ab26017aeb0f9f74ef7762087b12331f2"],"ref":"refs/changes/57/6857/3","uploader":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"createdOn":1567811476,"author":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1567811593,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"scripts/prompt-config.sh","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"tools/bin/sdc-ufds-m2s","type":"MODIFIED","insertions":29,"deletions":-11}],"sizeInsertions":34,"sizeDeletions":-12},{"number":"4","revision":"1cb625ca560a253f42a9b6feea6d21e4e9312c94","parents":["4751111ab26017aeb0f9f74ef7762087b12331f2"],"ref":"refs/changes/57/6857/4","uploader":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"createdOn":1567811825,"author":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1567811931,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1568071930,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1568021738,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"scripts/prompt-config.sh","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"tools/bin/sdc-ufds-m2s","type":"MODIFIED","insertions":30,"deletions":-12}],"sizeInsertions":35,"sizeDeletions":-13},{"number":"5","revision":"1da8bdd09abc6c68f39d70ef9cce0bb242891171","parents":["4751111ab26017aeb0f9f74ef7762087b12331f2"],"ref":"refs/changes/57/6857/5","uploader":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"createdOn":1568072127,"author":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1567811931,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1568071930,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1568759615,"by":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1568021738,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"scripts/prompt-config.sh","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"tools/bin/sdc-ufds-m2s","type":"MODIFIED","insertions":30,"deletions":-12}],"sizeInsertions":35,"sizeDeletions":-13}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"}]}