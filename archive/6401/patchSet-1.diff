commit 060e6e19d49d92cefe54d2c127045de2471140a3
Author: Pedro Palazon Candel <pedro@joyent.com>
Date:   2019-06-06T20:20:52+02:00 (4 months ago)
    
    TRITON-1728 TRITON-1681 breaks PAPI initialization

diff --git a/lib/backend.js b/lib/backend.js
index 9de6a93..b19c561 100644
--- a/lib/backend.js
+++ b/lib/backend.js
@@ -324,7 +324,7 @@ function createMorayClient(options) {
     assert.ok(options);
     var morayOptions = jsprim.deepCopy(options.moray);
     morayOptions.log = options.log.child({ component: 'moray' });
-    moray.createClient(morayOptions);
+    return moray.createClient(morayOptions);
 }
 
 
diff --git a/test/api.test.js b/test/api.test.js
index 1ecd336..abcc915 100644
--- a/test/api.test.js
+++ b/test/api.test.js
@@ -272,7 +272,7 @@ test('POST /packages/:uuid (invalid package name)', function (t) {
             { field: 'name',
               code: 'Invalid',
               message: 'must match ' +
-                '/^[a-zA-Z0-9]([a-zA-Z0-9\\_\\-\\.]+)?[a-zA-Z0-9]$/ and not' +
+                '/^[a-zA-Z0-9]([a-zA-Z0-9_\\-.]+)?[a-zA-Z0-9]$/ and not' +
                 ' contain repeated \'-\', \'_\' or \'.\' characters'
             }
         ];
