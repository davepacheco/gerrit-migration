From f48895c2c4be4072dee91e6df2396dc6fffcb526 Mon Sep 17 00:00:00 2001
From: Pedro Palazon Candel <pedro@joyent.com>
Date: Thu, 6 Jun 2019 21:14:30 +0200
Subject: [PATCH] TRITON-1728 TRITON-1681 breaks PAPI initialization Reviewed
 by: Trent Mick <trentm@gmail.com> Approved by: Trent Mick <trentm@gmail.com>

---
 lib/backend.js   | 2 +-
 test/api.test.js | 2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/lib/backend.js b/lib/backend.js
index 9de6a93..b19c561 100644
--- a/lib/backend.js
+++ b/lib/backend.js
@@ -324,7 +324,7 @@ function createMorayClient(options) {
     assert.ok(options);
     var morayOptions = jsprim.deepCopy(options.moray);
     morayOptions.log = options.log.child({ component: 'moray' });
-    moray.createClient(morayOptions);
+    return moray.createClient(morayOptions);
 }
 
 
diff --git a/test/api.test.js b/test/api.test.js
index 1ecd336..abcc915 100644
--- a/test/api.test.js
+++ b/test/api.test.js
@@ -272,7 +272,7 @@ test('POST /packages/:uuid (invalid package name)', function (t) {
             { field: 'name',
               code: 'Invalid',
               message: 'must match ' +
-                '/^[a-zA-Z0-9]([a-zA-Z0-9\\_\\-\\.]+)?[a-zA-Z0-9]$/ and not' +
+                '/^[a-zA-Z0-9]([a-zA-Z0-9_\\-.]+)?[a-zA-Z0-9]$/ and not' +
                 ' contain repeated \'-\', \'_\' or \'.\' characters'
             }
         ];
-- 
2.21.0

