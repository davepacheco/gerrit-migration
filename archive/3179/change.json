{"project":"joyent/sdc-docker","branch":"master","id":"Idec833c3e42505f11b45285d63fd050e5f48fe09","number":"3179","subject":"DOCKER-1138 Errors With Docker-Compose and TritonFS DOCKER-916 Add support for using docker-compose in CLI integration tests DOCKER-503 tests: add docker-compose testing in nightly Reviewed by: Todd Whiteman \u003ctodd.whiteman@joyent.com\u003e Approved by: Todd Wh","owner":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"url":"https://cr.joyent.us/3179","commitMessage":"DOCKER-1138 Errors With Docker-Compose and TritonFS\nDOCKER-916 Add support for using docker-compose in CLI integration tests\nDOCKER-503 tests: add docker-compose testing in nightly\nReviewed by: Todd Whiteman \u003ctodd.whiteman@joyent.com\u003e\nApproved by: Todd Whiteman \u003ctodd.whiteman@joyent.com\u003e\n","createdOn":1515529547,"lastUpdated":1515543016,"open":false,"status":"MERGED","comments":[{"timestamp":1515529547,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 1."},{"timestamp":1515529581,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1515529644,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 2: Commit message was updated."},{"timestamp":1515533849,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Patch Set 2:\n\n(5 comments)"},{"timestamp":1515537268,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 3: Commit message was updated."},{"timestamp":1515537860,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 2:\n\n(5 comments)"},{"timestamp":1515537922,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 4."},{"timestamp":1515537957,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1515539530,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Patch Set 4: Code-Review+1 Integration-Approval+1\n\n(1 comment)"},{"timestamp":1515543008,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 5: Commit message was updated."},{"timestamp":1515543016,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Julien Gilli"}],"currentPatchSet":{"number":"5","revision":"26629c6f6e85ce4660112ade5fcc7b8f59e4d6af","parents":["064b88a7576382698d45d45f8de4e060a731943e"],"ref":"refs/changes/79/3179/5","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1515543008,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1515537957,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1515539530,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1515539530,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}},{"type":"SUBM","value":"1","grantedOn":1515543016,"by":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"lib/validate.js","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"test/compose/compose-with-nfs-volume/docker-compose.yml","type":"ADDED","insertions":10,"deletions":0},{"file":"test/integration/compose-with-nfs-volume.test.js","type":"ADDED","insertions":112,"deletions":0},{"file":"test/integration/helpers.js","type":"MODIFIED","insertions":27,"deletions":-1},{"file":"test/integration/sdcdockertest_client.user-script.in","type":"MODIFIED","insertions":11,"deletions":0},{"file":"test/lib/compose-cli.js","type":"ADDED","insertions":37,"deletions":0},{"file":"test/runtest.common","type":"MODIFIED","insertions":25,"deletions":0},{"file":"test/runtests","type":"MODIFIED","insertions":13,"deletions":0},{"file":"tools/get-compose-clients.sh","type":"ADDED","insertions":84,"deletions":0}],"sizeInsertions":328,"sizeDeletions":-3},"patchSets":[{"number":"1","revision":"d3c479bffc0cf79178647700b4b98506014fd847","parents":["6e4060b0f6c98ea3bf4a7b7aef06599f3d4ef30c"],"ref":"refs/changes/79/3179/1","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1515529547,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1515529581,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"test/compose/compose-with-nfs-volume/docker-compose.yml","type":"ADDED","insertions":10,"deletions":0},{"file":"test/integration/compose-with-nfs-volume.test.js","type":"ADDED","insertions":112,"deletions":0},{"file":"test/integration/helpers.js","type":"MODIFIED","insertions":27,"deletions":-1},{"file":"test/integration/sdcdockertest_client.user-script.in","type":"MODIFIED","insertions":11,"deletions":0},{"file":"test/lib/compose-cli.js","type":"ADDED","insertions":37,"deletions":0},{"file":"test/runtest.common","type":"MODIFIED","insertions":25,"deletions":0},{"file":"test/runtests","type":"MODIFIED","insertions":13,"deletions":0},{"file":"tools/get-compose-clients.sh","type":"ADDED","insertions":84,"deletions":0}],"sizeInsertions":323,"sizeDeletions":-2},{"number":"2","revision":"586c94d0de05db1a2aecc4b624b133446d83ab6d","parents":["064b88a7576382698d45d45f8de4e060a731943e"],"ref":"refs/changes/79/3179/2","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1515529644,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1515529581,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/validate.js","line":600,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"This change meant to be in this PR? Note: change is fine, I\u0027m just wondering if it was meant for another PR."},{"file":"lib/validate.js","line":600,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Yes, it basically fixes DOCKER-1138, which would make sdc-docker crash by accessing req.params.DriverOpts.size when req.params.DriverOpts would be undefined."},{"file":"test/integration/compose-with-nfs-volume.test.js","line":8,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"2018"},{"file":"test/integration/compose-with-nfs-volume.test.js","line":8,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Done"},{"file":"test/integration/compose-with-nfs-volume.test.js","line":58,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Should this skip these tests when there is no COMPOSE_CLI_VERSION to test with?"},{"file":"test/integration/compose-with-nfs-volume.test.js","line":58,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Isn\u0027t that handled by https://cr.joyent.us/#/c/3179/3/test/runtests@115 ?"},{"file":"test/integration/compose-with-nfs-volume.test.js","line":58,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Looks like it - good to go here."},{"file":"test/integration/compose-with-nfs-volume.test.js","line":76,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Nit: maybe \"next(composeUpErr)\" - no point in further testing if there was a compose up failure."},{"file":"test/integration/compose-with-nfs-volume.test.js","line":76,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Good catch, also passed the \"listVolsErr\" to the \"next\" callback in the \"checkVolumeExists\" function for the same reason, in case we add a third or more steps to this pipeline in the future."},{"file":"test/runtest.common","line":78,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"space"},{"file":"test/runtest.common","line":78,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"lib/validate.js","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"test/compose/compose-with-nfs-volume/docker-compose.yml","type":"ADDED","insertions":10,"deletions":0},{"file":"test/integration/compose-with-nfs-volume.test.js","type":"ADDED","insertions":112,"deletions":0},{"file":"test/integration/helpers.js","type":"MODIFIED","insertions":27,"deletions":-1},{"file":"test/integration/sdcdockertest_client.user-script.in","type":"MODIFIED","insertions":11,"deletions":0},{"file":"test/lib/compose-cli.js","type":"ADDED","insertions":37,"deletions":0},{"file":"test/runtest.common","type":"MODIFIED","insertions":25,"deletions":0},{"file":"test/runtests","type":"MODIFIED","insertions":13,"deletions":0},{"file":"tools/get-compose-clients.sh","type":"ADDED","insertions":84,"deletions":0}],"sizeInsertions":328,"sizeDeletions":-3},{"number":"3","revision":"fa39620af4c5aac9b0f94099883d43e77abbca5e","parents":["064b88a7576382698d45d45f8de4e060a731943e"],"ref":"refs/changes/79/3179/3","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1515537268,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1515529581,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"lib/validate.js","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"test/compose/compose-with-nfs-volume/docker-compose.yml","type":"ADDED","insertions":10,"deletions":0},{"file":"test/integration/compose-with-nfs-volume.test.js","type":"ADDED","insertions":112,"deletions":0},{"file":"test/integration/helpers.js","type":"MODIFIED","insertions":27,"deletions":-1},{"file":"test/integration/sdcdockertest_client.user-script.in","type":"MODIFIED","insertions":11,"deletions":0},{"file":"test/lib/compose-cli.js","type":"ADDED","insertions":37,"deletions":0},{"file":"test/runtest.common","type":"MODIFIED","insertions":25,"deletions":0},{"file":"test/runtests","type":"MODIFIED","insertions":13,"deletions":0},{"file":"tools/get-compose-clients.sh","type":"ADDED","insertions":84,"deletions":0}],"sizeInsertions":328,"sizeDeletions":-3},{"number":"4","revision":"dec833c3e42505f11b45285d63fd050e5f48fe09","parents":["064b88a7576382698d45d45f8de4e060a731943e"],"ref":"refs/changes/79/3179/4","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1515537922,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1515537957,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1515539530,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1515539530,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"lib/validate.js","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"test/compose/compose-with-nfs-volume/docker-compose.yml","type":"ADDED","insertions":10,"deletions":0},{"file":"test/integration/compose-with-nfs-volume.test.js","type":"ADDED","insertions":112,"deletions":0},{"file":"test/integration/helpers.js","type":"MODIFIED","insertions":27,"deletions":-1},{"file":"test/integration/sdcdockertest_client.user-script.in","type":"MODIFIED","insertions":11,"deletions":0},{"file":"test/lib/compose-cli.js","type":"ADDED","insertions":37,"deletions":0},{"file":"test/runtest.common","type":"MODIFIED","insertions":25,"deletions":0},{"file":"test/runtests","type":"MODIFIED","insertions":13,"deletions":0},{"file":"tools/get-compose-clients.sh","type":"ADDED","insertions":84,"deletions":0}],"sizeInsertions":328,"sizeDeletions":-3},{"number":"5","revision":"26629c6f6e85ce4660112ade5fcc7b8f59e4d6af","parents":["064b88a7576382698d45d45f8de4e060a731943e"],"ref":"refs/changes/79/3179/5","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1515543008,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1515537957,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"SUBM","value":"1","grantedOn":1515543016,"by":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1515539530,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1515539530,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"lib/validate.js","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"test/compose/compose-with-nfs-volume/docker-compose.yml","type":"ADDED","insertions":10,"deletions":0},{"file":"test/integration/compose-with-nfs-volume.test.js","type":"ADDED","insertions":112,"deletions":0},{"file":"test/integration/helpers.js","type":"MODIFIED","insertions":27,"deletions":-1},{"file":"test/integration/sdcdockertest_client.user-script.in","type":"MODIFIED","insertions":11,"deletions":0},{"file":"test/lib/compose-cli.js","type":"ADDED","insertions":37,"deletions":0},{"file":"test/runtest.common","type":"MODIFIED","insertions":25,"deletions":0},{"file":"test/runtests","type":"MODIFIED","insertions":13,"deletions":0},{"file":"tools/get-compose-clients.sh","type":"ADDED","insertions":84,"deletions":0}],"sizeInsertions":328,"sizeDeletions":-3}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}]}