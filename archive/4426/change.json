{"project":"joyent/illumos-joyent","branch":"master","id":"I07a0f7fd1d6a204b5e8936d62bbcd4cd84bc4958","number":"4426","subject":"OS-3356 UFS freebehind can induce hat_pageunload()/htable_purge_hat() race Reviewed by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e Reviewed by: Robert Mustacchi \u003crm@joyent.com\u003e Reviewed by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e Approved by: Patrick Moo","owner":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"url":"https://cr.joyent.us/4426","commitMessage":"OS-3356 UFS freebehind can induce hat_pageunload()/htable_purge_hat() race\nReviewed by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e\nReviewed by: Robert Mustacchi \u003crm@joyent.com\u003e\nReviewed by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e\nApproved by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e\n","createdOn":1529948393,"lastUpdated":1538676680,"open":false,"status":"MERGED","comments":[{"timestamp":1529948393,"reviewer":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"message":"Uploaded patch set 1."},{"timestamp":1529949131,"reviewer":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"message":"Uploaded patch set 2."},{"timestamp":1529961267,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 2: Code-Review+1"},{"timestamp":1529963699,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 2:\n\n(3 comments)\n\nSome minor clean-up nits around \u0027flags\u0027, but it looks good."},{"timestamp":1529971791,"reviewer":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"message":"Patch Set 2:\n\n(3 comments)"},{"timestamp":1529972348,"reviewer":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"message":"Uploaded patch set 3."},{"timestamp":1530011408,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1530021918,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1530837423,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1532455347,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 3: Integration-Approval+1"},{"timestamp":1536363645,"reviewer":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"message":"Patch Set 4: Patch Set 3 was rebased"},{"timestamp":1538676416,"reviewer":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"message":"Patch Set 5: Patch Set 4 was rebased"},{"timestamp":1538676550,"reviewer":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"message":"Patch Set 6: Commit message was updated."},{"timestamp":1538676680,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Bryan Cantrill"}],"currentPatchSet":{"number":"6","revision":"1f946b3740393b0dc458e4d386c40f40dd9b8465","parents":["ee4c7a44cc40ef09d84ad16a742b124f3122fea2"],"ref":"refs/changes/26/4426/6","uploader":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"createdOn":1538676550,"author":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1530011408,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1530021918,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1530837423,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1532455347,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"SUBM","value":"1","grantedOn":1538676680,"by":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"usr/src/uts/common/fs/hsfs/hsfs_vnops.c","type":"MODIFIED","insertions":0,"deletions":-48},{"file":"usr/src/uts/common/fs/ufs/ufs_vnops.c","type":"MODIFIED","insertions":1,"deletions":-106}],"sizeInsertions":1,"sizeDeletions":-154},"patchSets":[{"number":"1","revision":"71be89110bde924b08db446a39618a1d38652e75","parents":["a449eb75c6b8137021ca42d49ee3753e36804dc7"],"ref":"refs/changes/26/4426/1","uploader":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"createdOn":1529948393,"author":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/fs/ufs/ufs_vnops.c","type":"MODIFIED","insertions":1,"deletions":-95}],"sizeInsertions":1,"sizeDeletions":-95},{"number":"2","revision":"946f5d54dbbd310ee21183fa56de967155a54b73","parents":["a449eb75c6b8137021ca42d49ee3753e36804dc7"],"ref":"refs/changes/26/4426/2","uploader":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"createdOn":1529949131,"author":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1529961267,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"comments":[{"file":"usr/src/uts/common/fs/ufs/ufs_vnops.c","line":1470,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"With most of the flags manipulation gone with the removal of freebehind, perhaps lift its definition (and assignment) into the if-statement scope?"},{"file":"usr/src/uts/common/fs/ufs/ufs_vnops.c","line":1470,"reviewer":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"message":"See comments below."},{"file":"usr/src/uts/common/fs/ufs/ufs_vnops.c","line":1493,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"nit: this is unnecessary now, right?"},{"file":"usr/src/uts/common/fs/ufs/ufs_vnops.c","line":1493,"reviewer":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"message":"Agreed -- gone!"},{"file":"usr/src/uts/common/fs/ufs/ufs_vnops.c","line":1505,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"If the \u0027flags\u0027 stuff is cleaned up, these could be changed to constant arguments here."},{"file":"usr/src/uts/common/fs/ufs/ufs_vnops.c","line":1505,"reviewer":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"message":"I think I would rather leave these as a flags argument rather than passing the constant 0 (which of course could be many things). For the same reason, I would like to leave the definition of flags where it is."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/fs/hsfs/hsfs_vnops.c","type":"MODIFIED","insertions":0,"deletions":-48},{"file":"usr/src/uts/common/fs/ufs/ufs_vnops.c","type":"MODIFIED","insertions":1,"deletions":-105}],"sizeInsertions":1,"sizeDeletions":-153},{"number":"3","revision":"07a0f7fd1d6a204b5e8936d62bbcd4cd84bc4958","parents":["a449eb75c6b8137021ca42d49ee3753e36804dc7"],"ref":"refs/changes/26/4426/3","uploader":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"createdOn":1529972348,"author":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1530837423,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1530011408,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1530021918,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1532455347,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/fs/hsfs/hsfs_vnops.c","type":"MODIFIED","insertions":0,"deletions":-48},{"file":"usr/src/uts/common/fs/ufs/ufs_vnops.c","type":"MODIFIED","insertions":1,"deletions":-106}],"sizeInsertions":1,"sizeDeletions":-154},{"number":"4","revision":"ea2b227d93fbd8e682d85ecf5b29adf26cffe792","parents":["192e1e6405f98e4b0a12f9488793c5dd000f3f7e"],"ref":"refs/changes/26/4426/4","uploader":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"createdOn":1536363645,"author":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1530837423,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1530011408,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1530021918,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1532455347,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/fs/hsfs/hsfs_vnops.c","type":"MODIFIED","insertions":0,"deletions":-48},{"file":"usr/src/uts/common/fs/ufs/ufs_vnops.c","type":"MODIFIED","insertions":1,"deletions":-106}],"sizeInsertions":1,"sizeDeletions":-154},{"number":"5","revision":"06878f5860b563e0686749e118353b70c713e0d0","parents":["ee4c7a44cc40ef09d84ad16a742b124f3122fea2"],"ref":"refs/changes/26/4426/5","uploader":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"createdOn":1538676416,"author":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1530837423,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1530011408,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1530021918,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1532455347,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/fs/hsfs/hsfs_vnops.c","type":"MODIFIED","insertions":0,"deletions":-48},{"file":"usr/src/uts/common/fs/ufs/ufs_vnops.c","type":"MODIFIED","insertions":1,"deletions":-106}],"sizeInsertions":1,"sizeDeletions":-154},{"number":"6","revision":"1f946b3740393b0dc458e4d386c40f40dd9b8465","parents":["ee4c7a44cc40ef09d84ad16a742b124f3122fea2"],"ref":"refs/changes/26/4426/6","uploader":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"createdOn":1538676550,"author":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1530837423,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"SUBM","value":"1","grantedOn":1538676680,"by":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1530011408,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1530021918,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1532455347,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"usr/src/uts/common/fs/hsfs/hsfs_vnops.c","type":"MODIFIED","insertions":0,"deletions":-48},{"file":"usr/src/uts/common/fs/ufs/ufs_vnops.c","type":"MODIFIED","insertions":1,"deletions":-106}],"sizeInsertions":1,"sizeDeletions":-154}],"allReviewers":[{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"}]}