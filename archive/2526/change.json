{"project":"joyent/sdc-docker","branch":"master","id":"I7293f3e73ae71daf842cdf978c9bbd5626a3fe24","number":"2526","subject":"DOCKER-793: First pass for NFS shared volumes DOCKER-863: Create shared volume when mounting nonexistent volume DOCKER-878: Make docker volume ls list only \"active\" volumes DOCKER-890: docker volume integration tests fail with docker version 1.12-rc2 DOCK","owner":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"url":"https://cr.joyent.us/2526","commitMessage":"DOCKER-793: First pass for NFS shared volumes\nDOCKER-863: Create shared volume when mounting nonexistent volume\nDOCKER-878: Make docker volume ls list only \"active\" volumes\nDOCKER-890: docker volume integration tests fail with docker version 1.12-rc2\nDOCKER-880: add regression test\nDOCKER-895 duplicate volume name error at volume creation time should be properly communicated to docker client\nDOCKER-895 (fix make check)\nDOCKER-896 invalid volume size error at volume creation time should be properly communicated to docker client\nDOCKER-906: support modes when mounting volumes\nDOCKER-911: tritonnfs volume mounted by container with docker-compose v2 fails to mount\nVOLAPI-9 Implement asynchronous NFS shared volume creation\nVOLAPI-6: Deleting a tritonnfs volume used by an active Docker container should fail\nVOLAPI-23 docker run -v fails when the mount point is an existing folder in the image\nVOLAPI-25 Docker volume create does not honor the network selection\nPUBAPI-1300 Implement CRUD volumes endpoints\nVOLAPI-42 implement volumes renaming constraints\nDOCKER-1011 docker run -v option for local volume (non-tritonnfs) should continue to work\nVOLAPI-27 Divergence in `docker create -v` behavior; volume is not created until `docker start`\nDOCKER-1021 docker volume create should output error message when volume creation fails in storage VM\u0027s provisioning workflow\nDOCKER-1055 volume names for sdc-docker should match those from PUBAPI-1372\nVOLAPI-49 DELETE should delete\nDOCKER-1030 restrain number of size unit suffixes supported when creating NFS volumes\nDOCKER-1066 sdc-docker should expose current config\nDOCKER-894 NFS shared volumes tests should check for \"NFS shared volumes not supported\" error in a separate tests suite\nVOLAPI-54 Custom errors\u0027 rest codes should follow engineering guide\u0027s guidelines\nDOCKER-1034 support docker volume ls -f dangling\u003dtrue\nVOLAPI-65 rename required_nfs_volumes VM objects\u0027 property to volumes\nTOOLS-1830 replace sdcadm experimental nfs-volumes with cloudapi-nfs-volumes/docker-nfs-volumes subcommands\nTOOLS-1829 add sdcadm experimental docker-nfs-volumes-automount\nDOCKER-1088 sdc-docker should not modify VMs\u0027 internal docker:nfsvolumes metadata\nVOLAPI-72 creating volume with unsupported size should result in error, not in volume being created with closest matching size\n","createdOn":1504883027,"lastUpdated":1504883109,"open":false,"status":"ABANDONED","comments":[{"timestamp":1504883027,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 1."},{"timestamp":1504883069,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1504883109,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Abandoned"}],"currentPatchSet":{"number":"1","revision":"7293f3e73ae71daf842cdf978c9bbd5626a3fe24","parents":["94fa554d7402b61ddfa643d4e76f5169797d049e"],"ref":"refs/changes/26/2526/1","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1504883027,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1504883069,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":37,"deletions":0},{"file":"docs/api/features/volumes.md","type":"MODIFIED","insertions":36,"deletions":0},{"file":"lib/backends/sdc/containers.js","type":"MODIFIED","insertions":141,"deletions":-269},{"file":"lib/backends/sdc/index.js","type":"MODIFIED","insertions":7,"deletions":-2},{"file":"lib/backends/sdc/networks.js","type":"MODIFIED","insertions":248,"deletions":-12},{"file":"lib/backends/sdc/volumes.js","type":"ADDED","insertions":383,"deletions":0},{"file":"lib/common.js","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"lib/containers.js","type":"ADDED","insertions":28,"deletions":0},{"file":"lib/docker.js","type":"MODIFIED","insertions":44,"deletions":-36},{"file":"lib/endpoints/_ping.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/endpoints/auth.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/endpoints/build.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/endpoints/ca.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/endpoints/commit.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/endpoints/containers.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/endpoints/events.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/endpoints/exec.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/endpoints/images.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/endpoints/index.js","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"lib/endpoints/info.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/endpoints/networks.js","type":"MODIFIED","insertions":7,"deletions":-3},{"file":"lib/endpoints/version.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/endpoints/volumes.js","type":"ADDED","insertions":294,"deletions":0},{"file":"lib/errors.js","type":"MODIFIED","insertions":19,"deletions":-1},{"file":"lib/ufds.js","type":"ADDED","insertions":37,"deletions":0},{"file":"lib/units.js","type":"ADDED","insertions":13,"deletions":0},{"file":"lib/validate.js","type":"MODIFIED","insertions":170,"deletions":-2},{"file":"lib/volumes.js","type":"ADDED","insertions":55,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"sapi_manifests/docker/template","type":"MODIFIED","insertions":11,"deletions":-2},{"file":"test/integration/api-mount-nfs-shared-volume-as-docker-compose.test.js","type":"ADDED","insertions":165,"deletions":0},{"file":"test/integration/api-rename-used-nfs-shared-volume.test.js","type":"ADDED","insertions":229,"deletions":0},{"file":"test/integration/cli-commit.test.js","type":"MODIFIED","insertions":6,"deletions":-4},{"file":"test/integration/cli-filters.test.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/integration/cli-labels.test.js","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"test/integration/cli-local-volumes.test.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/integration/cli-mount-nfs-volume-created-with-docker-create.test.js","type":"ADDED","insertions":143,"deletions":0},{"file":"test/integration/cli-nfs-shared-volumes-create-duplicate-name.test.js","type":"ADDED","insertions":107,"deletions":0},{"file":"test/integration/cli-nfs-shared-volumes-create-failure.test.js","type":"ADDED","insertions":154,"deletions":0},{"file":"test/integration/cli-nfs-shared-volumes-create-size.test.js","type":"ADDED","insertions":152,"deletions":0},{"file":"test/integration/cli-nfs-shared-volumes-delete-in-use.test.js","type":"ADDED","insertions":141,"deletions":0},{"file":"test/integration/cli-nfs-shared-volumes-disabled.test.js","type":"ADDED","insertions":231,"deletions":0},{"file":"test/integration/cli-nfs-shared-volumes-docker-880.test.js","type":"ADDED","insertions":352,"deletions":0},{"file":"test/integration/cli-nfs-shared-volumes-filter-dangling.test.js","type":"ADDED","insertions":204,"deletions":0},{"file":"test/integration/cli-nfs-shared-volumes-mount-overrides-local-volume.test.js","type":"ADDED","insertions":131,"deletions":0},{"file":"test/integration/cli-nfs-shared-volumes-mounting-mode.test.js","type":"ADDED","insertions":281,"deletions":0},{"file":"test/integration/cli-nfs-shared-volumes-networks.test.js","type":"ADDED","insertions":389,"deletions":0},{"file":"test/integration/cli-nfs-shared-volumes.test.js","type":"ADDED","insertions":514,"deletions":0},{"file":"test/integration/helpers.js","type":"MODIFIED","insertions":50,"deletions":-5},{"file":"test/lib/cli.js","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"test/lib/common.js","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"test/lib/volumes-api.js","type":"ADDED","insertions":88,"deletions":0},{"file":"test/lib/volumes-cli.js","type":"ADDED","insertions":216,"deletions":0},{"file":"test/lib/volumes.js","type":"ADDED","insertions":153,"deletions":0},{"file":"test/runtest.common","type":"MODIFIED","insertions":12,"deletions":-3}],"sizeInsertions":5244,"sizeDeletions":-371},"patchSets":[{"number":"1","revision":"7293f3e73ae71daf842cdf978c9bbd5626a3fe24","parents":["94fa554d7402b61ddfa643d4e76f5169797d049e"],"ref":"refs/changes/26/2526/1","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1504883027,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1504883069,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":37,"deletions":0},{"file":"docs/api/features/volumes.md","type":"MODIFIED","insertions":36,"deletions":0},{"file":"lib/backends/sdc/containers.js","type":"MODIFIED","insertions":141,"deletions":-269},{"file":"lib/backends/sdc/index.js","type":"MODIFIED","insertions":7,"deletions":-2},{"file":"lib/backends/sdc/networks.js","type":"MODIFIED","insertions":248,"deletions":-12},{"file":"lib/backends/sdc/volumes.js","type":"ADDED","insertions":383,"deletions":0},{"file":"lib/common.js","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"lib/containers.js","type":"ADDED","insertions":28,"deletions":0},{"file":"lib/docker.js","type":"MODIFIED","insertions":44,"deletions":-36},{"file":"lib/endpoints/_ping.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/endpoints/auth.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/endpoints/build.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/endpoints/ca.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/endpoints/commit.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/endpoints/containers.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/endpoints/events.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/endpoints/exec.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/endpoints/images.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/endpoints/index.js","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"lib/endpoints/info.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/endpoints/networks.js","type":"MODIFIED","insertions":7,"deletions":-3},{"file":"lib/endpoints/version.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/endpoints/volumes.js","type":"ADDED","insertions":294,"deletions":0},{"file":"lib/errors.js","type":"MODIFIED","insertions":19,"deletions":-1},{"file":"lib/ufds.js","type":"ADDED","insertions":37,"deletions":0},{"file":"lib/units.js","type":"ADDED","insertions":13,"deletions":0},{"file":"lib/validate.js","type":"MODIFIED","insertions":170,"deletions":-2},{"file":"lib/volumes.js","type":"ADDED","insertions":55,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"sapi_manifests/docker/template","type":"MODIFIED","insertions":11,"deletions":-2},{"file":"test/integration/api-mount-nfs-shared-volume-as-docker-compose.test.js","type":"ADDED","insertions":165,"deletions":0},{"file":"test/integration/api-rename-used-nfs-shared-volume.test.js","type":"ADDED","insertions":229,"deletions":0},{"file":"test/integration/cli-commit.test.js","type":"MODIFIED","insertions":6,"deletions":-4},{"file":"test/integration/cli-filters.test.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/integration/cli-labels.test.js","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"test/integration/cli-local-volumes.test.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/integration/cli-mount-nfs-volume-created-with-docker-create.test.js","type":"ADDED","insertions":143,"deletions":0},{"file":"test/integration/cli-nfs-shared-volumes-create-duplicate-name.test.js","type":"ADDED","insertions":107,"deletions":0},{"file":"test/integration/cli-nfs-shared-volumes-create-failure.test.js","type":"ADDED","insertions":154,"deletions":0},{"file":"test/integration/cli-nfs-shared-volumes-create-size.test.js","type":"ADDED","insertions":152,"deletions":0},{"file":"test/integration/cli-nfs-shared-volumes-delete-in-use.test.js","type":"ADDED","insertions":141,"deletions":0},{"file":"test/integration/cli-nfs-shared-volumes-disabled.test.js","type":"ADDED","insertions":231,"deletions":0},{"file":"test/integration/cli-nfs-shared-volumes-docker-880.test.js","type":"ADDED","insertions":352,"deletions":0},{"file":"test/integration/cli-nfs-shared-volumes-filter-dangling.test.js","type":"ADDED","insertions":204,"deletions":0},{"file":"test/integration/cli-nfs-shared-volumes-mount-overrides-local-volume.test.js","type":"ADDED","insertions":131,"deletions":0},{"file":"test/integration/cli-nfs-shared-volumes-mounting-mode.test.js","type":"ADDED","insertions":281,"deletions":0},{"file":"test/integration/cli-nfs-shared-volumes-networks.test.js","type":"ADDED","insertions":389,"deletions":0},{"file":"test/integration/cli-nfs-shared-volumes.test.js","type":"ADDED","insertions":514,"deletions":0},{"file":"test/integration/helpers.js","type":"MODIFIED","insertions":50,"deletions":-5},{"file":"test/lib/cli.js","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"test/lib/common.js","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"test/lib/volumes-api.js","type":"ADDED","insertions":88,"deletions":0},{"file":"test/lib/volumes-cli.js","type":"ADDED","insertions":216,"deletions":0},{"file":"test/lib/volumes.js","type":"ADDED","insertions":153,"deletions":0},{"file":"test/runtest.common","type":"MODIFIED","insertions":12,"deletions":-3}],"sizeInsertions":5244,"sizeDeletions":-371}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"}]}