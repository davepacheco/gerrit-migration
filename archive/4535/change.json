{"project":"joyent/sdc-cn-agent","branch":"master","id":"I3ce58a35d8a2603ea11065d7367279299a8d09eb","number":"4535","subject":"TRITON-607 cn-agent should be aware of alternate admin nictags Reviewed by: Cody Peter Mello \u003ccody.mello@joyent.com\u003e Approved by: Trent Mick \u003ctrentm@gmail.com\u003e","owner":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"url":"https://cr.joyent.us/4535","commitMessage":"TRITON-607 cn-agent should be aware of alternate admin nictags\nReviewed by: Cody Peter Mello \u003ccody.mello@joyent.com\u003e\nApproved by: Trent Mick \u003ctrentm@gmail.com\u003e\n","createdOn":1531930150,"lastUpdated":1532440796,"open":false,"status":"MERGED","comments":[{"timestamp":1531930150,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 1."},{"timestamp":1531930180,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1532025377,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 1:\n\n(4 comments)"},{"timestamp":1532027851,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Patch Set 1:\n\n(4 comments)"},{"timestamp":1532027899,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 2."},{"timestamp":1532027927,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1532035685,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 2: Code-Review+1\n\n(1 comment)"},{"timestamp":1532133003,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 2: Code-Review+1\n\n(2 comments)"},{"timestamp":1532170956,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Patch Set 2:\n\n(2 comments)"},{"timestamp":1532170994,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 3."},{"timestamp":1532171025,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1532364243,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1532375469,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 3: Integration-Approval+1\n\nSure, I\u0027m willing to take the chance here. cn-agent isn\u0027t my strong area. We can watch nightly-1 test runs tomorrow. :)"},{"timestamp":1532376055,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 4: Commit message was updated."},{"timestamp":1532376444,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 5."},{"timestamp":1532376472,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1532376622,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 5: Code-Review+1 Integration-Approval+1"},{"timestamp":1532378202,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 5: Code-Review+1"},{"timestamp":1532440791,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Patch Set 5:\n\nuploaded these changes and the latest cnapi msan changes to my running deployment, and reran the cnapi test suite.  No failures."},{"timestamp":1532440796,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Rui"}],"currentPatchSet":{"number":"5","revision":"3ce58a35d8a2603ea11065d7367279299a8d09eb","parents":["f3798e88d93004ed89e6fd6a8572d733b75096c2"],"ref":"refs/changes/35/4535/5","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1532376444,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1532376472,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1532376622,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1532376622,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1532378202,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"SUBM","value":"1","grantedOn":1532440796,"by":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"bin/cn-agent.js","type":"MODIFIED","insertions":12,"deletions":-30},{"file":"lib/backends/dummy/index.js","type":"MODIFIED","insertions":40,"deletions":0},{"file":"lib/backends/dummy/tools/run-servers.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"lib/backends/smartos/index.js","type":"MODIFIED","insertions":16,"deletions":-15},{"file":"lib/backends/smartos/smartdc-config.js","type":"MODIFIED","insertions":55,"deletions":-16},{"file":"lib/backends/smartos/tasks/docker_exec.js","type":"MODIFIED","insertions":31,"deletions":-40},{"file":"lib/backends/smartos/tasks/machine_create.js","type":"MODIFIED","insertions":2,"deletions":-23},{"file":"test/http-task.test.js","type":"MODIFIED","insertions":3,"deletions":-27}],"sizeInsertions":162,"sizeDeletions":-152},"patchSets":[{"number":"1","revision":"24a60fe4e7b6e0a8c1acdd5a2e95906910d2e4b2","parents":["f3798e88d93004ed89e6fd6a8572d733b75096c2"],"ref":"refs/changes/35/4535/1","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1531930150,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1531930180,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/backends/dummy/index.js","line":164,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"nit: This should fit on the previous line."},{"file":"lib/backends/dummy/index.js","line":164,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"The previous line uses all 80char. ???"},{"file":"lib/backends/dummy/index.js","line":164,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Sorry, Gerrit\u0027s default column marker is at 100 chars, apparently."},{"file":"lib/backends/dummy/tools/run-servers.js","line":49,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Did you want to do this before integrating? The dummy backend stuff is for triton-mockcloud, I believe, so I guess this will only be run when trying to do rack-aware testing with mockcloud?"},{"file":"lib/backends/dummy/tools/run-servers.js","line":49,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Yes.  I was going to punt on this since the mockcloud stuff is still in the works, and we\u0027re kind of under the gun to the manta RAN stuff put back."},{"file":"lib/backends/smartos/smartdc-config.js","line":24,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"If you use VError here and elsewhere, you can use its printf-like formatting:\n\n    err \u003d new VError(\u0027Could not parse agent config: \"%s\"\u0027, e.message);\n\nOr, in this specific case, you can use its error chaining (which will format the cause\u0027s message after a colon):\n\n    err \u003d new VError(e, \u0027Could not parse agent config\u0027);"},{"file":"lib/backends/smartos/smartdc-config.js","line":24,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"},{"file":"lib/backends/smartos/smartdc-config.js","line":77,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"adminifaces.length !\u003d\u003d 0"},{"file":"lib/backends/smartos/smartdc-config.js","line":77,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"bin/cn-agent.js","type":"MODIFIED","insertions":12,"deletions":-30},{"file":"lib/backends/dummy/index.js","type":"MODIFIED","insertions":40,"deletions":0},{"file":"lib/backends/dummy/tools/run-servers.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"lib/backends/smartos/index.js","type":"MODIFIED","insertions":16,"deletions":-15},{"file":"lib/backends/smartos/smartdc-config.js","type":"MODIFIED","insertions":55,"deletions":-16},{"file":"lib/backends/smartos/tasks/docker_exec.js","type":"MODIFIED","insertions":31,"deletions":-40},{"file":"lib/backends/smartos/tasks/machine_create.js","type":"MODIFIED","insertions":2,"deletions":-23},{"file":"test/http-task.test.js","type":"MODIFIED","insertions":3,"deletions":-27}],"sizeInsertions":162,"sizeDeletions":-152},{"number":"2","revision":"4e69cfdda3479c49edf4ce393d4fce57fc40b4ad","parents":["f3798e88d93004ed89e6fd6a8572d733b75096c2"],"ref":"refs/changes/35/4535/2","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1532027899,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1532035685,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1532027927,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1532133003,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"comments":[{"file":"lib/backends/smartos/smartdc-config.js","line":82,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"drop that part now that we\u0027re no longer using config.json for this?"},{"file":"lib/backends/smartos/smartdc-config.js","line":82,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"},{"file":"test/http-task.test.js","line":22,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"nit: adminIp if wanting to follow var style in this repo. Ditto other parts of this CR."},{"file":"test/http-task.test.js","line":22,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"bin/cn-agent.js","type":"MODIFIED","insertions":12,"deletions":-30},{"file":"lib/backends/dummy/index.js","type":"MODIFIED","insertions":40,"deletions":0},{"file":"lib/backends/dummy/tools/run-servers.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"lib/backends/smartos/index.js","type":"MODIFIED","insertions":16,"deletions":-15},{"file":"lib/backends/smartos/smartdc-config.js","type":"MODIFIED","insertions":55,"deletions":-16},{"file":"lib/backends/smartos/tasks/docker_exec.js","type":"MODIFIED","insertions":31,"deletions":-40},{"file":"lib/backends/smartos/tasks/machine_create.js","type":"MODIFIED","insertions":2,"deletions":-23},{"file":"test/http-task.test.js","type":"MODIFIED","insertions":3,"deletions":-27}],"sizeInsertions":162,"sizeDeletions":-152},{"number":"3","revision":"2469a7a8f693e68a547bc99d76b3b52c3d258d7a","parents":["f3798e88d93004ed89e6fd6a8572d733b75096c2"],"ref":"refs/changes/35/4535/3","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1532170994,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1532364243,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1532171025,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1532375469,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"bin/cn-agent.js","type":"MODIFIED","insertions":12,"deletions":-30},{"file":"lib/backends/dummy/index.js","type":"MODIFIED","insertions":40,"deletions":0},{"file":"lib/backends/dummy/tools/run-servers.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"lib/backends/smartos/index.js","type":"MODIFIED","insertions":16,"deletions":-15},{"file":"lib/backends/smartos/smartdc-config.js","type":"MODIFIED","insertions":55,"deletions":-16},{"file":"lib/backends/smartos/tasks/docker_exec.js","type":"MODIFIED","insertions":31,"deletions":-40},{"file":"lib/backends/smartos/tasks/machine_create.js","type":"MODIFIED","insertions":2,"deletions":-23},{"file":"test/http-task.test.js","type":"MODIFIED","insertions":3,"deletions":-27}],"sizeInsertions":162,"sizeDeletions":-152},{"number":"4","revision":"1477ed8b93ee7b1dfee90f257241cac24e31f53c","parents":["f3798e88d93004ed89e6fd6a8572d733b75096c2"],"ref":"refs/changes/35/4535/4","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1532376055,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1532364243,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1532171025,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1532375469,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"bin/cn-agent.js","type":"MODIFIED","insertions":12,"deletions":-30},{"file":"lib/backends/dummy/index.js","type":"MODIFIED","insertions":40,"deletions":0},{"file":"lib/backends/dummy/tools/run-servers.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"lib/backends/smartos/index.js","type":"MODIFIED","insertions":16,"deletions":-15},{"file":"lib/backends/smartos/smartdc-config.js","type":"MODIFIED","insertions":55,"deletions":-16},{"file":"lib/backends/smartos/tasks/docker_exec.js","type":"MODIFIED","insertions":31,"deletions":-40},{"file":"lib/backends/smartos/tasks/machine_create.js","type":"MODIFIED","insertions":2,"deletions":-23},{"file":"test/http-task.test.js","type":"MODIFIED","insertions":3,"deletions":-27}],"sizeInsertions":162,"sizeDeletions":-152},{"number":"5","revision":"3ce58a35d8a2603ea11065d7367279299a8d09eb","parents":["f3798e88d93004ed89e6fd6a8572d733b75096c2"],"ref":"refs/changes/35/4535/5","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1532376444,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1532378202,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1532376472,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1532376622,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1532376622,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1532440796,"by":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"bin/cn-agent.js","type":"MODIFIED","insertions":12,"deletions":-30},{"file":"lib/backends/dummy/index.js","type":"MODIFIED","insertions":40,"deletions":0},{"file":"lib/backends/dummy/tools/run-servers.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"lib/backends/smartos/index.js","type":"MODIFIED","insertions":16,"deletions":-15},{"file":"lib/backends/smartos/smartdc-config.js","type":"MODIFIED","insertions":55,"deletions":-16},{"file":"lib/backends/smartos/tasks/docker_exec.js","type":"MODIFIED","insertions":31,"deletions":-40},{"file":"lib/backends/smartos/tasks/machine_create.js","type":"MODIFIED","insertions":2,"deletions":-23},{"file":"test/http-task.test.js","type":"MODIFIED","insertions":3,"deletions":-27}],"sizeInsertions":162,"sizeDeletions":-152}],"allReviewers":[{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"}]}