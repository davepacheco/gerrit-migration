{"project":"joyent/sdc-fwrule","branch":"master","id":"I916122221c7e6c7ce4c0096279f8cedd0ce960b0","number":"3338","subject":"TRITON-77 Add support for ESP and AH protocols in firewall rules Reviewed by: Jason King \u003cjason.king@joyent.com\u003e Reviewed by: Mike Zeller \u003cmike.zeller@joyent.com\u003e Approved by: Mike Zeller \u003cmike.zeller@joyent.com\u003e","owner":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"url":"https://cr.joyent.us/3338","commitMessage":"TRITON-77 Add support for ESP and AH protocols in firewall rules\nReviewed by: Jason King \u003cjason.king@joyent.com\u003e\nReviewed by: Mike Zeller \u003cmike.zeller@joyent.com\u003e\nApproved by: Mike Zeller \u003cmike.zeller@joyent.com\u003e\n","createdOn":1518131730,"lastUpdated":1519770954,"open":false,"status":"MERGED","comments":[{"timestamp":1518131730,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 1."},{"timestamp":1518132957,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 2."},{"timestamp":1518134117,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing-1\n\n\"make check\" exited with status 2\n\n /tmp/repo/lib/index.js\n /tmp/repo/lib/validators.js\n /tmp/repo/lib/rule.js\n /tmp/repo/lib/rule.js(601): warning: missing break statement\n /tmp/repo/test/validators.test.js\n /tmp/repo/test/invalid.test.js\n /tmp/repo/test/rule.test.js\n /tmp/repo/test/run.js\n /tmp/repo/test/parser.test.js\n Makefile:134: recipe for target \u0027check-jsl\u0027 failed\n gmake: *** [check-jsl] Error 1"},{"timestamp":1518134378,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1518143677,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 3."},{"timestamp":1518143720,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1518204621,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 4."},{"timestamp":1518204667,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1518562989,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 4: Code-Review+1"},{"timestamp":1519767984,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Patch Set 4:\n\n(2 comments)"},{"timestamp":1519770398,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 5."},{"timestamp":1519770448,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1519770871,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 5:\n\n(1 comment)"},{"timestamp":1519770875,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Patch Set 5: Code-Review+1 Integration-Approval+1"},{"timestamp":1519770935,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 6: Commit message was updated."},{"timestamp":1519770954,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Cody Peter Mello"}],"currentPatchSet":{"number":"6","revision":"b7949726b60f83c285e398b7931f0cf240da258c","parents":["768233916f1eb263a9008264fc6e953e46930880"],"ref":"refs/changes/38/3338/6","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1519770935,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1519770448,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1519770875,"by":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1519770875,"by":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"}},{"type":"SUBM","value":"1","grantedOn":1519770954,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"docs/media/img/protocol.svg","type":"MODIFIED","insertions":17,"deletions":-1},{"file":"docs/rules.md","type":"MODIFIED","insertions":12,"deletions":-3},{"file":"docs/rules.md.in","type":"MODIFIED","insertions":14,"deletions":-3},{"file":"lib/index.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/rule.js","type":"MODIFIED","insertions":43,"deletions":-10},{"file":"lib/validators.js","type":"MODIFIED","insertions":14,"deletions":-6},{"file":"src/fwrule.jison","type":"MODIFIED","insertions":10,"deletions":0},{"file":"test/parser.test.js","type":"MODIFIED","insertions":32,"deletions":-2},{"file":"test/rule.test.js","type":"MODIFIED","insertions":123,"deletions":-1},{"file":"test/validators.test.js","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"tools/gen-rr-svgs.js","type":"MODIFIED","insertions":3,"deletions":-1}],"sizeInsertions":276,"sizeDeletions":-30},"patchSets":[{"number":"1","revision":"76718119f565c8b817c09bc96b8fb96306263e6d","parents":["9d3a4bce64d5600b36b559069499401227e6362a"],"ref":"refs/changes/38/3338/1","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1518131730,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1518134117,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"docs/media/img/protocol.svg","type":"MODIFIED","insertions":17,"deletions":-1},{"file":"docs/rules.md","type":"MODIFIED","insertions":11,"deletions":-2},{"file":"docs/rules.md.in","type":"MODIFIED","insertions":13,"deletions":-2},{"file":"lib/index.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/rule.js","type":"MODIFIED","insertions":42,"deletions":-10},{"file":"lib/validators.js","type":"MODIFIED","insertions":12,"deletions":-4},{"file":"src/fwrule.jison","type":"MODIFIED","insertions":10,"deletions":0},{"file":"test/parser.test.js","type":"MODIFIED","insertions":32,"deletions":-2},{"file":"test/rule.test.js","type":"MODIFIED","insertions":123,"deletions":-1},{"file":"test/validators.test.js","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"tools/gen-rr-svgs.js","type":"MODIFIED","insertions":3,"deletions":-1}],"sizeInsertions":271,"sizeDeletions":-26},{"number":"2","revision":"23ecd5faf08a860c5fca75c06138d5e9fe5b63b1","parents":["20fc29ce7ae4bd2665ee63082bc63540c6c681c8"],"ref":"refs/changes/38/3338/2","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1518132957,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1518134378,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"docs/media/img/protocol.svg","type":"MODIFIED","insertions":17,"deletions":-1},{"file":"docs/rules.md","type":"MODIFIED","insertions":11,"deletions":-2},{"file":"docs/rules.md.in","type":"MODIFIED","insertions":13,"deletions":-2},{"file":"lib/index.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/rule.js","type":"MODIFIED","insertions":43,"deletions":-10},{"file":"lib/validators.js","type":"MODIFIED","insertions":12,"deletions":-4},{"file":"src/fwrule.jison","type":"MODIFIED","insertions":10,"deletions":0},{"file":"test/parser.test.js","type":"MODIFIED","insertions":32,"deletions":-2},{"file":"test/rule.test.js","type":"MODIFIED","insertions":123,"deletions":-1},{"file":"test/validators.test.js","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"tools/gen-rr-svgs.js","type":"MODIFIED","insertions":3,"deletions":-1}],"sizeInsertions":272,"sizeDeletions":-26},{"number":"3","revision":"b1faff98b694d109271a2038c9ae2fe658707ea3","parents":["c1a3a1c0d14612fbc6dbc5185538115ac81b1b00"],"ref":"refs/changes/38/3338/3","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1518143677,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1518143720,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"docs/media/img/protocol.svg","type":"MODIFIED","insertions":17,"deletions":-1},{"file":"docs/rules.md","type":"MODIFIED","insertions":11,"deletions":-2},{"file":"docs/rules.md.in","type":"MODIFIED","insertions":14,"deletions":-3},{"file":"lib/index.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/rule.js","type":"MODIFIED","insertions":43,"deletions":-10},{"file":"lib/validators.js","type":"MODIFIED","insertions":12,"deletions":-4},{"file":"src/fwrule.jison","type":"MODIFIED","insertions":10,"deletions":0},{"file":"test/parser.test.js","type":"MODIFIED","insertions":32,"deletions":-2},{"file":"test/rule.test.js","type":"MODIFIED","insertions":123,"deletions":-1},{"file":"test/validators.test.js","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"tools/gen-rr-svgs.js","type":"MODIFIED","insertions":3,"deletions":-1}],"sizeInsertions":273,"sizeDeletions":-27},{"number":"4","revision":"97f4019e68b8fe9eaa7f16a0fbf18458150e0ee5","parents":["c1a3a1c0d14612fbc6dbc5185538115ac81b1b00"],"ref":"refs/changes/38/3338/4","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1518204621,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1518204667,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1518562989,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}}],"comments":[{"file":"lib/rule.js","line":702,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"What is protoTxt used for? It seems the surrounding items in the case statement set it to something other than an empty string."},{"file":"lib/rule.js","line":702,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"protoTxt is the text specific to the protocol. For ICMP(6), that\u0027s the ICMP types that are allowed through. For TCP and UDP, that\u0027s the ports. AH and ESP don\u0027t have anything specific to their protocol to filter on, so we just make the value an empty string here."},{"file":"lib/validators.js","line":132,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"nit: update comment to mention ah and esp protocols"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"docs/media/img/protocol.svg","type":"MODIFIED","insertions":17,"deletions":-1},{"file":"docs/rules.md","type":"MODIFIED","insertions":12,"deletions":-3},{"file":"docs/rules.md.in","type":"MODIFIED","insertions":14,"deletions":-3},{"file":"lib/index.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/rule.js","type":"MODIFIED","insertions":43,"deletions":-10},{"file":"lib/validators.js","type":"MODIFIED","insertions":12,"deletions":-4},{"file":"src/fwrule.jison","type":"MODIFIED","insertions":10,"deletions":0},{"file":"test/parser.test.js","type":"MODIFIED","insertions":32,"deletions":-2},{"file":"test/rule.test.js","type":"MODIFIED","insertions":123,"deletions":-1},{"file":"test/validators.test.js","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"tools/gen-rr-svgs.js","type":"MODIFIED","insertions":3,"deletions":-1}],"sizeInsertions":274,"sizeDeletions":-28},{"number":"5","revision":"916122221c7e6c7ce4c0096279f8cedd0ce960b0","parents":["768233916f1eb263a9008264fc6e953e46930880"],"ref":"refs/changes/38/3338/5","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1519770398,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1519770448,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1519770875,"by":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1519770875,"by":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"docs/media/img/protocol.svg","type":"MODIFIED","insertions":17,"deletions":-1},{"file":"docs/rules.md","type":"MODIFIED","insertions":12,"deletions":-3},{"file":"docs/rules.md.in","type":"MODIFIED","insertions":14,"deletions":-3},{"file":"lib/index.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/rule.js","type":"MODIFIED","insertions":43,"deletions":-10},{"file":"lib/validators.js","type":"MODIFIED","insertions":14,"deletions":-6},{"file":"src/fwrule.jison","type":"MODIFIED","insertions":10,"deletions":0},{"file":"test/parser.test.js","type":"MODIFIED","insertions":32,"deletions":-2},{"file":"test/rule.test.js","type":"MODIFIED","insertions":123,"deletions":-1},{"file":"test/validators.test.js","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"tools/gen-rr-svgs.js","type":"MODIFIED","insertions":3,"deletions":-1}],"sizeInsertions":276,"sizeDeletions":-30},{"number":"6","revision":"b7949726b60f83c285e398b7931f0cf240da258c","parents":["768233916f1eb263a9008264fc6e953e46930880"],"ref":"refs/changes/38/3338/6","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1519770935,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"SUBM","value":"1","grantedOn":1519770954,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1519770448,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1519770875,"by":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1519770875,"by":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"docs/media/img/protocol.svg","type":"MODIFIED","insertions":17,"deletions":-1},{"file":"docs/rules.md","type":"MODIFIED","insertions":12,"deletions":-3},{"file":"docs/rules.md.in","type":"MODIFIED","insertions":14,"deletions":-3},{"file":"lib/index.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/rule.js","type":"MODIFIED","insertions":43,"deletions":-10},{"file":"lib/validators.js","type":"MODIFIED","insertions":14,"deletions":-6},{"file":"src/fwrule.jison","type":"MODIFIED","insertions":10,"deletions":0},{"file":"test/parser.test.js","type":"MODIFIED","insertions":32,"deletions":-2},{"file":"test/rule.test.js","type":"MODIFIED","insertions":123,"deletions":-1},{"file":"test/validators.test.js","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"tools/gen-rr-svgs.js","type":"MODIFIED","insertions":3,"deletions":-1}],"sizeInsertions":276,"sizeDeletions":-30}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}]}