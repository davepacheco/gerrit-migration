commit 564a64a9e4f254de3af29adb7f78bac0660bedcc (refs/changes/12/4812/2)
Author: Pedro Palazon Candel <pedro@joyent.com>
Date:   2018-09-11T17:16:47+02:00 (1 year, 1 month ago)
    
    TRITON-762 Remove incremental upgrade scripts from sdc-headnode

diff --git a/Makefile b/Makefile
index 4701f4b..7a4120e 100644
--- a/Makefile
+++ b/Makefile
@@ -2831,21 +2831,6 @@ gz-tools_publish_image:
 	$(UPDATES_IMGADM) import -ddd -m $(GZ_TOOLS_MANIFEST_OUTPUT) -f $(GZ_TOOLS_OUTPUT)
 	@echo ""
 
-INCR_UPGRADE_BUILD=$(USB_BUILD_DIR)/incr-upgrade-$(_headnode_stamp).tgz
-INCR_UPGRADE_OUTPUT=$(USB_BITS_DIR)/incr-upgrade$(HEADNODE_SUFFIX)-$(_headnode_stamp).tgz
-
-.PHONY: incr-upgrade
-incr-upgrade: $(INCR_UPGRADE_OUTPUT)
-
-$(INCR_UPGRADE_OUTPUT): $(USB_BITS_SPEC) $(BOOT_OUTPUT)
-	@echo "# Build incr-upgrade: sdc-headnode branch $(SDC_HEADNODE_BRANCH), sha $(SDC_HEADNODE_SHA), time `date -u +%Y%m%dT%H%M%SZ`"
-	cd "build/sdc-headnode" && \
-	    BITS_DIR=$(BITS_DIR) TIMESTAMP=$(TIMESTAMP) \
-	    gmake incr-upgrade
-	mv $(INCR_UPGRADE_BUILD) $(INCR_UPGRADE_OUTPUT)
-	@echo "# Created incr-upgrade bits (time `date -u +%Y%m%dT%H%M%SZ`):"
-	@ls -l $(INCR_UPGRADE_OUTPUT)
-	@echo ""
 
 #
 # Of the "headnode*" family of builds, only the base "headnode" job currently
diff --git a/tools/targets-1.6.3.sh b/tools/targets-1.6.3.sh
index 5109aa4..31ac6e6 100755
--- a/tools/targets-1.6.3.sh
+++ b/tools/targets-1.6.3.sh
@@ -6,7 +6,7 @@
 #
 
 #
-# Copyright (c) 2014, Joyent, Inc.
+# Copyright (c) 2018, Joyent, Inc.
 #
 
 #
@@ -28,7 +28,7 @@ cd ${BASE}
 if [[ ! -f "targets.json" ]]; then
     bash < targets.json.in | json > targets.json
 fi
-node -e "var targets = require('./targets.json'); Object.keys(targets).forEach(function (t) { if (['all', 'usbheadnode', 'usbheadnode-debug', 'platform', 'platform-debug', 'agentsshar', 'minnow', 'amon', 'registar', 'config-agent', 'mockcloud', 'incr-upgrade', 'zonetracker'].indexOf(t) !== -1) { return; }; if (targets[t].image_uuid !== 'b4bdc598-8939-11e3-bea4-8341f6861379') { console.log(t); } });" | sort
+node -e "var targets = require('./targets.json'); Object.keys(targets).forEach(function (t) { if (['all', 'usbheadnode', 'usbheadnode-debug', 'platform', 'platform-debug', 'agentsshar', 'minnow', 'amon', 'registar', 'config-agent', 'mockcloud', 'zonetracker'].indexOf(t) !== -1) { return; }; if (targets[t].image_uuid !== 'b4bdc598-8939-11e3-bea4-8341f6861379') { console.log(t); } });" | sort
 
 # This comes last as it depends on all the individual agents to be built first.
 echo "agentsshar"
