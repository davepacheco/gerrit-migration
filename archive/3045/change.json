{"project":"joyent/illumos-joyent","branch":"master","topic":"OS-5195","id":"Ic6b0ac12851403af18c06800770e65c0314956fb","number":"3045","subject":"OS-5195 DHCP spoofing protection should allow permitting all Client Identifiers Reviewed by: Robert Mustacchi \u003crm@joyent.com\u003e Approved by: Dan McDonald \u003cdanmcd@joyent.com\u003e","owner":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"url":"https://cr.joyent.us/3045","commitMessage":"OS-5195 DHCP spoofing protection should allow permitting all Client Identifiers\nReviewed by: Robert Mustacchi \u003crm@joyent.com\u003e\nApproved by: Dan McDonald \u003cdanmcd@joyent.com\u003e\n","createdOn":1512523820,"lastUpdated":1528483639,"open":false,"status":"MERGED","comments":[{"timestamp":1512523820,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 1."},{"timestamp":1512524728,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Topic set to OS-5195"},{"timestamp":1512595877,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 1:\n\n(10 comments)"},{"timestamp":1512673129,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 2."},{"timestamp":1512673188,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 1:\n\n(9 comments)"},{"timestamp":1512685928,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 2: Code-Review+1\n\nI think this is reasonably good. One minor thing is I don\u0027t know if you need to have your own MPT_TRUE and MPT_FALSE values vs. B_TRUE and B_FALSE or not."},{"timestamp":1528418218,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 3."},{"timestamp":1528419372,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1528421491,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 3: Integration-Approval+1"},{"timestamp":1528479880,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 4: Commit message was updated."},{"timestamp":1528483508,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 5: Patch Set 4 was rebased."},{"timestamp":1528483639,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Cody Peter Mello"}],"currentPatchSet":{"number":"5","revision":"c6b0ac12851403af18c06800770e65c0314956fb","parents":["d8dd35875a530f93803ac5c9384765e988d715c3"],"ref":"refs/changes/45/3045/5","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1528483508,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"NO_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1528419372,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1528421491,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"SUBM","value":"1","grantedOn":1528483639,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/common/net/dhcp/octet.c","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/lib/libdladm/Makefile","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/lib/libdladm/common/libdladm_impl.h","type":"MODIFIED","insertions":5,"deletions":-5},{"file":"usr/src/lib/libdladm/common/linkprop.c","type":"MODIFIED","insertions":54,"deletions":-2},{"file":"usr/src/man/man1m/dladm.1m","type":"MODIFIED","insertions":49,"deletions":-2},{"file":"usr/src/test/util-tests/tests/dladm/allowed-cids.ksh","type":"ADDED","insertions":95,"deletions":0},{"file":"usr/src/test/util-tests/tests/dladm/allowed-ips.ksh","type":"MODIFIED","insertions":4,"deletions":-39},{"file":"usr/src/test/util-tests/tests/dladm/common.ksh","type":"ADDED","insertions":57,"deletions":0},{"file":"usr/src/uts/common/io/mac/mac_protect.c","type":"MODIFIED","insertions":25,"deletions":-2},{"file":"usr/src/uts/common/sys/mac_flow.h","type":"MODIFIED","insertions":9,"deletions":-6}],"sizeInsertions":303,"sizeDeletions":-57},"patchSets":[{"number":"1","revision":"4de7131c51fa696062c5de1e4138c75e3083af92","parents":["86aa638917f0ec83401d6523f879fbdf56cde0b9"],"ref":"refs/changes/45/3045/1","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1512523820,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/lib/libdladm/common/libdladm_impl.h","line":151,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Is there a reason these were reordered?"},{"file":"usr/src/lib/libdladm/common/libdladm_impl.h","line":151,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"I reordered them to make it easier to stay under 80 columns between this change and OS-4683."},{"file":"usr/src/man/man1m/dladm.1m","line":12,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"This needs to be updated."},{"file":"usr/src/man/man1m/dladm.1m","line":12,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Done"},{"file":"usr/src/test/util-tests/tests/dladm/allowed-cids.ksh","line":28,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"What happens with 0x0?"},{"file":"usr/src/test/util-tests/tests/dladm/allowed-cids.ksh","line":28,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"It fails too, since it\u0027s not an even length. I\u0027ll add a test to this section."},{"file":"usr/src/test/util-tests/tests/dladm/allowed-cids.ksh","line":87,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"What happens with an octal string? Will it be interpreted literally?"},{"file":"usr/src/test/util-tests/tests/dladm/allowed-cids.ksh","line":87,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Yep. It\u0027ll be treated as a string of bytes."},{"file":"usr/src/test/util-tests/tests/dladm/common.ksh","line":27,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I know this is an existing bug, but I think this should be ai_arg0."},{"file":"usr/src/test/util-tests/tests/dladm/common.ksh","line":27,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Done"},{"file":"usr/src/test/util-tests/tests/dladm/common.ksh","line":58,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Remove the trailing lines?"},{"file":"usr/src/test/util-tests/tests/dladm/common.ksh","line":58,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Done"},{"file":"usr/src/uts/common/io/mac/mac_protect.c","line":2162,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I assume this was removed because we\u0027re deferring this to dhcpnospoof_check()?"},{"file":"usr/src/uts/common/io/mac/mac_protect.c","line":2162,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Yeah, I removed it because this is actually done in mac_protect_check_one when this fails, along with firing the sdt probe."},{"file":"usr/src/uts/common/io/mac/mac_protect.c","line":2579,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Should we assume this has been initialized to B_FALSE? Or should we capture that with the MPT_RESET case? If I update from true to false will that work?"},{"file":"usr/src/uts/common/sys/mac_flow.h","line":177,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"We should probably add a check in libdladm ala lib/varpd/libvarpd/Makefile to make sure that this type is equivalent in both ILP32 and LP64."},{"file":"usr/src/uts/common/sys/mac_flow.h","line":177,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Done"},{"file":"usr/src/uts/common/sys/mac_flow.h","line":183,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I\u0027m not sure that we should really call this a boolean_t. It feels like we should really be calling this an int32_t based on the fact that we\u0027re using it for values such as -1, 0, 1 (-1 for the reset value). Having it be a boolean_t, but then using non-B_TRUE/B_FALSE values seems bad."},{"file":"usr/src/uts/common/sys/mac_flow.h","line":183,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/common/net/dhcp/octet.c","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/lib/libdladm/common/libdladm_impl.h","type":"MODIFIED","insertions":5,"deletions":-5},{"file":"usr/src/lib/libdladm/common/linkprop.c","type":"MODIFIED","insertions":54,"deletions":-2},{"file":"usr/src/man/man1m/dladm.1m","type":"MODIFIED","insertions":48,"deletions":-1},{"file":"usr/src/test/util-tests/tests/dladm/allowed-cids.ksh","type":"ADDED","insertions":94,"deletions":0},{"file":"usr/src/test/util-tests/tests/dladm/allowed-ips.ksh","type":"MODIFIED","insertions":4,"deletions":-39},{"file":"usr/src/test/util-tests/tests/dladm/common.ksh","type":"ADDED","insertions":59,"deletions":0},{"file":"usr/src/uts/common/io/mac/mac_protect.c","type":"MODIFIED","insertions":25,"deletions":-2},{"file":"usr/src/uts/common/sys/mac_flow.h","type":"MODIFIED","insertions":7,"deletions":-6}],"sizeInsertions":299,"sizeDeletions":-55},{"number":"2","revision":"2174ce02cf662e5d327c7636de22e541462478ec","parents":["86aa638917f0ec83401d6523f879fbdf56cde0b9"],"ref":"refs/changes/45/3045/2","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1512673129,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1512685928,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/common/net/dhcp/octet.c","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/lib/libdladm/Makefile","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/lib/libdladm/common/libdladm_impl.h","type":"MODIFIED","insertions":5,"deletions":-5},{"file":"usr/src/lib/libdladm/common/linkprop.c","type":"MODIFIED","insertions":54,"deletions":-2},{"file":"usr/src/man/man1m/dladm.1m","type":"MODIFIED","insertions":49,"deletions":-2},{"file":"usr/src/test/util-tests/tests/dladm/allowed-cids.ksh","type":"ADDED","insertions":95,"deletions":0},{"file":"usr/src/test/util-tests/tests/dladm/allowed-ips.ksh","type":"MODIFIED","insertions":4,"deletions":-39},{"file":"usr/src/test/util-tests/tests/dladm/common.ksh","type":"ADDED","insertions":57,"deletions":0},{"file":"usr/src/uts/common/io/mac/mac_protect.c","type":"MODIFIED","insertions":25,"deletions":-2},{"file":"usr/src/uts/common/sys/mac_flow.h","type":"MODIFIED","insertions":9,"deletions":-6}],"sizeInsertions":303,"sizeDeletions":-57},{"number":"3","revision":"31aa541845007e9bf93c236b2be9192f16371dfc","parents":["788e26d53d698f1ae7fc91da6c1c4cd40d05dfd8"],"ref":"refs/changes/45/3045/3","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1528418218,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1528419372,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1528421491,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/common/net/dhcp/octet.c","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/lib/libdladm/Makefile","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/lib/libdladm/common/libdladm_impl.h","type":"MODIFIED","insertions":5,"deletions":-5},{"file":"usr/src/lib/libdladm/common/linkprop.c","type":"MODIFIED","insertions":54,"deletions":-2},{"file":"usr/src/man/man1m/dladm.1m","type":"MODIFIED","insertions":49,"deletions":-2},{"file":"usr/src/test/util-tests/tests/dladm/allowed-cids.ksh","type":"ADDED","insertions":95,"deletions":0},{"file":"usr/src/test/util-tests/tests/dladm/allowed-ips.ksh","type":"MODIFIED","insertions":4,"deletions":-39},{"file":"usr/src/test/util-tests/tests/dladm/common.ksh","type":"ADDED","insertions":57,"deletions":0},{"file":"usr/src/uts/common/io/mac/mac_protect.c","type":"MODIFIED","insertions":25,"deletions":-2},{"file":"usr/src/uts/common/sys/mac_flow.h","type":"MODIFIED","insertions":9,"deletions":-6}],"sizeInsertions":303,"sizeDeletions":-57},{"number":"4","revision":"78ec08d5489b18ec0a341bd70e52f1546a6534f1","parents":["788e26d53d698f1ae7fc91da6c1c4cd40d05dfd8"],"ref":"refs/changes/45/3045/4","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1528479880,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1528419372,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1528421491,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/common/net/dhcp/octet.c","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/lib/libdladm/Makefile","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/lib/libdladm/common/libdladm_impl.h","type":"MODIFIED","insertions":5,"deletions":-5},{"file":"usr/src/lib/libdladm/common/linkprop.c","type":"MODIFIED","insertions":54,"deletions":-2},{"file":"usr/src/man/man1m/dladm.1m","type":"MODIFIED","insertions":49,"deletions":-2},{"file":"usr/src/test/util-tests/tests/dladm/allowed-cids.ksh","type":"ADDED","insertions":95,"deletions":0},{"file":"usr/src/test/util-tests/tests/dladm/allowed-ips.ksh","type":"MODIFIED","insertions":4,"deletions":-39},{"file":"usr/src/test/util-tests/tests/dladm/common.ksh","type":"ADDED","insertions":57,"deletions":0},{"file":"usr/src/uts/common/io/mac/mac_protect.c","type":"MODIFIED","insertions":25,"deletions":-2},{"file":"usr/src/uts/common/sys/mac_flow.h","type":"MODIFIED","insertions":9,"deletions":-6}],"sizeInsertions":303,"sizeDeletions":-57},{"number":"5","revision":"c6b0ac12851403af18c06800770e65c0314956fb","parents":["d8dd35875a530f93803ac5c9384765e988d715c3"],"ref":"refs/changes/45/3045/5","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1528483508,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"NO_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1528419372,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"SUBM","value":"1","grantedOn":1528483639,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1528421491,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/common/net/dhcp/octet.c","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/lib/libdladm/Makefile","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/lib/libdladm/common/libdladm_impl.h","type":"MODIFIED","insertions":5,"deletions":-5},{"file":"usr/src/lib/libdladm/common/linkprop.c","type":"MODIFIED","insertions":54,"deletions":-2},{"file":"usr/src/man/man1m/dladm.1m","type":"MODIFIED","insertions":49,"deletions":-2},{"file":"usr/src/test/util-tests/tests/dladm/allowed-cids.ksh","type":"ADDED","insertions":95,"deletions":0},{"file":"usr/src/test/util-tests/tests/dladm/allowed-ips.ksh","type":"MODIFIED","insertions":4,"deletions":-39},{"file":"usr/src/test/util-tests/tests/dladm/common.ksh","type":"ADDED","insertions":57,"deletions":0},{"file":"usr/src/uts/common/io/mac/mac_protect.c","type":"MODIFIED","insertions":25,"deletions":-2},{"file":"usr/src/uts/common/sys/mac_flow.h","type":"MODIFIED","insertions":9,"deletions":-6}],"sizeInsertions":303,"sizeDeletions":-57}],"allReviewers":[{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}]}