{"project":"joyent/illumos-joyent","branch":"vpc","id":"I18c72eb41876b3accb94af053e84dd48c937b9ba","number":"3689","subject":"Update varpd_files to support VL3-\u003eUL3 lookups","owner":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"url":"https://cr.joyent.us/3689","commitMessage":"Update varpd_files to support VL3-\u003eUL3 lookups\n","createdOn":1521496644,"lastUpdated":1521649269,"open":false,"status":"MERGED","comments":[{"timestamp":1521496644,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Uploaded patch set 1."},{"timestamp":1521497090,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 1: Code-Review+1 Integration-Approval+1\n\nPer Jason\u0027s request..."},{"timestamp":1521497198,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 1: -Code-Review -Integration-Approval"},{"timestamp":1521498114,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 1:\n\n(1 comment)\n\nOne nit..."},{"timestamp":1521521153,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Uploaded patch set 2."},{"timestamp":1521521286,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Uploaded patch set 3."},{"timestamp":1521556099,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 3:\n\n(1 comment)"},{"timestamp":1521556315,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Uploaded patch set 4."},{"timestamp":1521556349,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 3:\n\n(1 comment)"},{"timestamp":1521559279,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 4:\n\n(2 comments)"},{"timestamp":1521560300,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 4:\n\n(2 comments)\n\nLast batch."},{"timestamp":1521562170,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Uploaded patch set 5."},{"timestamp":1521562931,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 4:\n\n(1 comment)"},{"timestamp":1521564053,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 5: Code-Review+1"},{"timestamp":1521590769,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Patch Set 5:\n\n(8 comments)"},{"timestamp":1521594006,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 5:\n\n(8 comments)"},{"timestamp":1521594017,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Uploaded patch set 6."},{"timestamp":1521594274,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Uploaded patch set 7."},{"timestamp":1521595262,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Uploaded patch set 8."},{"timestamp":1521595365,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 8: Code-Review+1"},{"timestamp":1521605830,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Patch Set 8: Code-Review+1"},{"timestamp":1521649217,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Uploaded patch set 9: Patch Set 8 was rebased."},{"timestamp":1521649261,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 9: Integration-Approval+1"},{"timestamp":1521649269,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Jason King"}],"currentPatchSet":{"number":"9","revision":"18c72eb41876b3accb94af053e84dd48c937b9ba","parents":["b0486ca67460fa052c5eab8e8a5c78e138a79104"],"ref":"refs/changes/89/3689/9","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1521649217,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1521595365,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1521605830,"by":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1521649261,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"SUBM","value":"1","grantedOn":1521649268,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/varpd/files/common/libvarpd_files.c","type":"MODIFIED","insertions":669,"deletions":-23},{"file":"usr/src/lib/varpd/libvarpd/common/mapfile-plugin","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/lib/varpd/libvarpd/common/mapfile-vers","type":"MODIFIED","insertions":2,"deletions":-1}],"sizeInsertions":673,"sizeDeletions":-25},"patchSets":[{"number":"1","revision":"7c76dbf83e9fbcdd3125eb37baa340902725591d","parents":["88425b209a307844f24c1735f37eab903bc0a19a"],"ref":"refs/changes/89/3689/1","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1521496644,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/lib/varpd/files/common/libvarpd_files.c","line":408,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"vlan is signed.... do you make vlan unsigned or do a check like you do below in ..._remote_subnet() ?"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/varpd/files/common/libvarpd_files.c","type":"MODIFIED","insertions":653,"deletions":-23},{"file":"usr/src/lib/varpd/libvarpd/common/mapfile-plugin","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/lib/varpd/libvarpd/common/mapfile-vers","type":"MODIFIED","insertions":2,"deletions":-1}],"sizeInsertions":657,"sizeDeletions":-25},{"number":"2","revision":"1cd7f615b438b439d97e006aae43776eabca5674","parents":["9dfd8b48e15641cbd518c98d24f1d9df4774b182"],"ref":"refs/changes/89/3689/2","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1521521153,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/varpd/files/common/libvarpd_files.c","type":"MODIFIED","insertions":660,"deletions":-23},{"file":"usr/src/lib/varpd/libvarpd/common/mapfile-plugin","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/lib/varpd/libvarpd/common/mapfile-vers","type":"MODIFIED","insertions":2,"deletions":-1}],"sizeInsertions":664,"sizeDeletions":-25},{"number":"3","revision":"1c7d392e887b072f600f606a69385004a5234d4c","parents":["9dfd8b48e15641cbd518c98d24f1d9df4774b182"],"ref":"refs/changes/89/3689/3","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1521521286,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/lib/varpd/files/common/libvarpd_files.c","line":900,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Extra bzero?!"},{"file":"usr/src/lib/varpd/files/common/libvarpd_files.c","line":900,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Doh!"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/varpd/files/common/libvarpd_files.c","type":"MODIFIED","insertions":660,"deletions":-23},{"file":"usr/src/lib/varpd/libvarpd/common/mapfile-plugin","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/lib/varpd/libvarpd/common/mapfile-vers","type":"MODIFIED","insertions":2,"deletions":-1}],"sizeInsertions":664,"sizeDeletions":-25},{"number":"4","revision":"5bfe0abfa9728b60f8a5d2d85c04de1ac04964a5","parents":["9dfd8b48e15641cbd518c98d24f1d9df4774b182"],"ref":"refs/changes/89/3689/4","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1521556315,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/lib/varpd/files/common/libvarpd_files.c","line":39,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Mention here that \"local-\", \"remote-\", and \"attach-\" prefixes mean something."},{"file":"usr/src/lib/varpd/files/common/libvarpd_files.c","line":410,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Big-theory comments don\u0027t have it mentioned.  Do you need it?"},{"file":"usr/src/lib/varpd/files/common/libvarpd_files.c","line":410,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Since it\u0027s not sure yet how we\u0027re setting/creating this, I sort of punted for the moment until we figure that out."},{"file":"usr/src/lib/varpd/files/common/libvarpd_files.c","line":803,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Why bcopy?  You aren\u0027t writing into these, so why not just hand over the pointer to otl3_{src,dst}ip?"},{"file":"usr/src/lib/varpd/files/common/libvarpd_files.c","line":822,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"necessary?"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/varpd/files/common/libvarpd_files.c","type":"MODIFIED","insertions":659,"deletions":-23},{"file":"usr/src/lib/varpd/libvarpd/common/mapfile-plugin","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/lib/varpd/libvarpd/common/mapfile-vers","type":"MODIFIED","insertions":2,"deletions":-1}],"sizeInsertions":663,"sizeDeletions":-25},{"number":"5","revision":"f11a88c231bd2f5d52816d19efeef75cb09c4e74","parents":["9dfd8b48e15641cbd518c98d24f1d9df4774b182"],"ref":"refs/changes/89/3689/5","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1521562170,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1521564053,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}}],"comments":[{"file":"usr/src/lib/varpd/files/common/libvarpd_files.c","line":134,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"wording is a bit awkward"},{"file":"usr/src/lib/varpd/files/common/libvarpd_files.c","line":134,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"I\u0027ll rework it a bit and see if it\u0027s better."},{"file":"usr/src/lib/varpd/files/common/libvarpd_files.c","line":280,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"rem needs to be freed even if the nvlist_add_nvlist fails."},{"file":"usr/src/lib/varpd/files/common/libvarpd_files.c","line":280,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Done"},{"file":"usr/src/lib/varpd/files/common/libvarpd_files.c","line":361,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Should this be !\u003d 0?"},{"file":"usr/src/lib/varpd/files/common/libvarpd_files.c","line":361,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Yeah"},{"file":"usr/src/lib/varpd/files/common/libvarpd_files.c","line":363,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"same point as above, mout needs to be freed if this fails or succeeds."},{"file":"usr/src/lib/varpd/files/common/libvarpd_files.c","line":363,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Done"},{"file":"usr/src/lib/varpd/files/common/libvarpd_files.c","line":401,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Is it okay if we truncate name to the sizeof (net-\u003evafs_name)?"},{"file":"usr/src/lib/varpd/files/common/libvarpd_files.c","line":401,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"It should be -- this backend was only really meant for testing and not actual production use (that\u0027s what the SVP backend is for), though I can add a note up with the examples."},{"file":"usr/src/lib/varpd/files/common/libvarpd_files.c","line":425,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"same question as above about truncating name"},{"file":"usr/src/lib/varpd/files/common/libvarpd_files.c","line":425,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Same answer as above :)"},{"file":"usr/src/lib/varpd/files/common/libvarpd_files.c","line":429,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Would be better if we didnt shadow the \"name\" parameter passed into the function."},{"file":"usr/src/lib/varpd/files/common/libvarpd_files.c","line":429,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Yes, much better"},{"file":"usr/src/lib/varpd/files/common/libvarpd_files.c","line":462,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"macs is only valid as long as \"pair\" isn\u0027t freed.  Is that okay?  (I assume the nvlist nvl stays around for the life of this, but I wanted to double check for my own sake)"},{"file":"usr/src/lib/varpd/files/common/libvarpd_files.c","line":462,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Yeah, should use nvlist_dup()"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/varpd/files/common/libvarpd_files.c","type":"MODIFIED","insertions":662,"deletions":-23},{"file":"usr/src/lib/varpd/libvarpd/common/mapfile-plugin","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/lib/varpd/libvarpd/common/mapfile-vers","type":"MODIFIED","insertions":2,"deletions":-1}],"sizeInsertions":666,"sizeDeletions":-25},{"number":"6","revision":"1353a91b6a41dbdb9dfb81a6bd61101927437b87","parents":["9dfd8b48e15641cbd518c98d24f1d9df4774b182"],"ref":"refs/changes/89/3689/6","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1521594017,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/varpd/files/common/libvarpd_files.c","type":"MODIFIED","insertions":662,"deletions":-23},{"file":"usr/src/lib/varpd/libvarpd/common/mapfile-plugin","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/lib/varpd/libvarpd/common/mapfile-vers","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/io/overlay/overlay_target.c","type":"MODIFIED","insertions":28,"deletions":-14},{"file":"usr/src/uts/common/sys/overlay_impl.h","type":"MODIFIED","insertions":2,"deletions":-1}],"sizeInsertions":696,"sizeDeletions":-40},{"number":"7","revision":"cd8ef4a76691708d1ed45a6b523f6e20f894d355","parents":["9dfd8b48e15641cbd518c98d24f1d9df4774b182"],"ref":"refs/changes/89/3689/7","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1521594274,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/varpd/files/common/libvarpd_files.c","type":"MODIFIED","insertions":669,"deletions":-23},{"file":"usr/src/lib/varpd/libvarpd/common/mapfile-plugin","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/lib/varpd/libvarpd/common/mapfile-vers","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/io/overlay/overlay_target.c","type":"MODIFIED","insertions":28,"deletions":-14},{"file":"usr/src/uts/common/sys/overlay_impl.h","type":"MODIFIED","insertions":2,"deletions":-1}],"sizeInsertions":703,"sizeDeletions":-40},{"number":"8","revision":"6c56ab0421d14a30578e6fa224092c9a4266086a","parents":["9dfd8b48e15641cbd518c98d24f1d9df4774b182"],"ref":"refs/changes/89/3689/8","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1521595262,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1521605830,"by":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1521595365,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/varpd/files/common/libvarpd_files.c","type":"MODIFIED","insertions":669,"deletions":-23},{"file":"usr/src/lib/varpd/libvarpd/common/mapfile-plugin","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/lib/varpd/libvarpd/common/mapfile-vers","type":"MODIFIED","insertions":2,"deletions":-1}],"sizeInsertions":673,"sizeDeletions":-25},{"number":"9","revision":"18c72eb41876b3accb94af053e84dd48c937b9ba","parents":["b0486ca67460fa052c5eab8e8a5c78e138a79104"],"ref":"refs/changes/89/3689/9","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1521649217,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1521605830,"by":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1521649261,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"SUBM","value":"1","grantedOn":1521649268,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1521595365,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/varpd/files/common/libvarpd_files.c","type":"MODIFIED","insertions":669,"deletions":-23},{"file":"usr/src/lib/varpd/libvarpd/common/mapfile-plugin","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/lib/varpd/libvarpd/common/mapfile-vers","type":"MODIFIED","insertions":2,"deletions":-1}],"sizeInsertions":673,"sizeDeletions":-25}],"allReviewers":[{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}]}