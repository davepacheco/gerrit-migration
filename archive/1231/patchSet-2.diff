From 2788ebca0546de1c049d2eff98ea8b6661dcb230 Mon Sep 17 00:00:00 2001
From: Alex Wilson <alex.wilson@joyent.com>
Date: Tue, 10 Jan 2017 12:12:56 -0800
Subject: [PATCH] joyent/node-cueball#69 connectionFSM could log when it's
 trying to connect, abandoning, and delaying

---
 lib/connection-fsm.js | 6 ++++++
 package.json          | 2 +-
 2 files changed, 7 insertions(+), 1 deletion(-)

diff --git a/lib/connection-fsm.js b/lib/connection-fsm.js
index bcbd5a1..c7f10dd 100644
--- a/lib/connection-fsm.js
+++ b/lib/connection-fsm.js
@@ -325,6 +325,9 @@ ConnectionFSM.prototype.state_error = function (S) {
 		--this.cf_retriesLeft;
 
 	if (this.cf_retries === Infinity || this.cf_retriesLeft > 0) {
+		this.cf_log.trace(this.cf_lastError, 'failed to connect to ' +
+		    'backend %s (%j), delaying before retry',
+		    this.cf_backend.key, this.cf_backend);
 		S.gotoState('delay');
 	} else {
 		this.cf_log.warn(this.cf_lastError, 'failed to connect to ' +
@@ -611,6 +614,9 @@ ConnectionFSM.prototype.state_busy = function (S) {
 		}
 	});
 	S.on(this.cf_conn, 'error', function (err) {
+		self.cf_log.error(err, 'connection to %s (%j) emitted ' +
+		    '"error" while busy (claimed)', self.cf_backend.key,
+		    self.cf_backend);
 		self.cf_lastError = err;
 		S.gotoState('error');
 		self.cf_pool._incrCounter('error-during-busy');
diff --git a/package.json b/package.json
index c1000b6..151ef20 100644
--- a/package.json
+++ b/package.json
@@ -1,6 +1,6 @@
 {
   "name": "cueball",
-  "version": "1.3.0",
+  "version": "1.3.1",
   "description": "",
   "main": "lib/index.js",
   "dependencies": {
-- 
2.21.0

