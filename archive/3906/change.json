{"project":"joyent/sdc-napi","branch":"master","id":"I7c8f186df2758d7c0dca7c354cc0c7bd104bdc1a","number":"3906","subject":"TRITON-367 Check network pool owners during NIC provisioning Reviewed by: Mike Zeller \u003cmike.zeller@joyent.com\u003e Reviewed by: Trent Mick \u003ctrentm@gmail.com\u003e Approved by: Trent Mick \u003ctrentm@gmail.com\u003e","owner":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"url":"https://cr.joyent.us/3906","commitMessage":"TRITON-367 Check network pool owners during NIC provisioning\nReviewed by: Mike Zeller \u003cmike.zeller@joyent.com\u003e\nReviewed by: Trent Mick \u003ctrentm@gmail.com\u003e\nApproved by: Trent Mick \u003ctrentm@gmail.com\u003e\n","createdOn":1525383514,"lastUpdated":1525459796,"open":false,"status":"MERGED","comments":[{"timestamp":1525383514,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 1."},{"timestamp":1525383576,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1525383687,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 2."},{"timestamp":1525383753,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1525458050,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Patch Set 2: Code-Review+1"},{"timestamp":1525458140,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 2:\n\n(2 comments)"},{"timestamp":1525458733,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 2:\n\n(2 comments)"},{"timestamp":1525458969,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 2: Code-Review+1 Integration-Approval+1\n\n(1 comment)"},{"timestamp":1525459175,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 3: Commit message was updated."},{"timestamp":1525459347,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 4."},{"timestamp":1525459411,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1525459719,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 4: Code-Review+1 Integration-Approval+1"},{"timestamp":1525459720,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 4: Code-Review+1 Integration-Approval+1"},{"timestamp":1525459731,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 4: -Code-Review -Integration-Approval"},{"timestamp":1525459736,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 5: Patch Set 4 was rebased"},{"timestamp":1525459741,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Cody Peter Mello"},{"timestamp":1525459796,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5:\n\n\"make check\" passed ok"}],"currentPatchSet":{"number":"5","revision":"25bf4e9db56a15626d8ea275b88c2b74d5cbacb6","parents":["0f05c2f2afce82fa06391dd2e65bd42bb1875aa7"],"ref":"refs/changes/06/3906/5","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1525459736,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1525459411,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1525459719,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1525459719,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1525459741,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"lib/models/network-pool.js","type":"MODIFIED","insertions":22,"deletions":-1},{"file":"lib/models/network.js","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"lib/models/nic/common.js","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"test/unit/network-owner.test.js","type":"MODIFIED","insertions":21,"deletions":-3},{"file":"test/unit/network-pools.test.js","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":57,"sizeDeletions":-8},"patchSets":[{"number":"1","revision":"e6bcc8c35e59949e567b34fb6e08e4f4cde6c980","parents":["1c5cbf8cb02eaf78d83c71a3d6acfff535efd466"],"ref":"refs/changes/06/3906/1","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1525383514,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1525383576,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/models/network-pool.js","type":"MODIFIED","insertions":15,"deletions":-1},{"file":"lib/models/nic/common.js","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"test/unit/network-owner.test.js","type":"MODIFIED","insertions":21,"deletions":-3},{"file":"test/unit/network-pools.test.js","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":45,"sizeDeletions":-7},{"number":"2","revision":"68430c7e747fb282297f2c40730424e180f2b21c","parents":["1c5cbf8cb02eaf78d83c71a3d6acfff535efd466"],"ref":"refs/changes/06/3906/2","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1525383687,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1525383753,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1525458969,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1525458969,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1525458050,"by":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"}}],"comments":[{"file":"lib/models/network-pool.js","line":418,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Why the special casing for \u0027admin\u0027? Is there some existing usage that would break otherwise? Might the same happen to \u0027poseidon\u0027? Could those usages use `check_owner\u003dfalse`?"},{"file":"lib/models/network-pool.js","line":418,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"I\u0027m not sure if there\u0027s any existing cases that this would break for pools, but we do need it for networks, so that we can provision fabric NAT and volume zones owned by the admin user on networks belonging to others. This might not be a problem for pools currently, but I figured they should behave consistently.\n\nI don\u0027t think we poseidon will be affected, since Manta doesn\u0027t leverage pools at the moment. Once we have multiple admin subnets, we can add poseidon to the owners of the admin pool.\n\nSome of those usages could perhaps use check_owner\u003dfalse to bypass the checks. As far as I\u0027m aware, only net-agent uses it at the moment when syncing NICs."},{"file":"lib/models/network-pool.js","line":418,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Ah, thanks. I hadn\u0027t thought of the nat and vol zones cases. And +1 to the consistency with network.owner_uuids checking.\nIf you like, I think a comment there explaining why the \u0027admin\u0027 special case would be helpful."},{"file":"test/unit/network-owner.test.js","line":554,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"https://9p.io/plan9/screenshot.html !"},{"file":"test/unit/network-owner.test.js","line":554,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Testing from outer space!"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/models/network-pool.js","type":"MODIFIED","insertions":15,"deletions":-1},{"file":"lib/models/nic/common.js","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"test/unit/network-owner.test.js","type":"MODIFIED","insertions":21,"deletions":-3},{"file":"test/unit/network-pools.test.js","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":45,"sizeDeletions":-7},{"number":"3","revision":"e0022cfdecf6727538d28aa9a115ddb7f361a92d","parents":["1c5cbf8cb02eaf78d83c71a3d6acfff535efd466"],"ref":"refs/changes/06/3906/3","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1525459175,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1525383753,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1525458969,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1525458969,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1525458050,"by":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"lib/models/network-pool.js","type":"MODIFIED","insertions":15,"deletions":-1},{"file":"lib/models/nic/common.js","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"test/unit/network-owner.test.js","type":"MODIFIED","insertions":21,"deletions":-3},{"file":"test/unit/network-pools.test.js","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":45,"sizeDeletions":-7},{"number":"4","revision":"7c8f186df2758d7c0dca7c354cc0c7bd104bdc1a","parents":["1c5cbf8cb02eaf78d83c71a3d6acfff535efd466"],"ref":"refs/changes/06/3906/4","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1525459347,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1525459411,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1525459719,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1525459719,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"lib/models/network-pool.js","type":"MODIFIED","insertions":22,"deletions":-1},{"file":"lib/models/network.js","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"lib/models/nic/common.js","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"test/unit/network-owner.test.js","type":"MODIFIED","insertions":21,"deletions":-3},{"file":"test/unit/network-pools.test.js","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":57,"sizeDeletions":-8},{"number":"5","revision":"25bf4e9db56a15626d8ea275b88c2b74d5cbacb6","parents":["0f05c2f2afce82fa06391dd2e65bd42bb1875aa7"],"ref":"refs/changes/06/3906/5","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1525459736,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"SUBM","value":"1","grantedOn":1525459741,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1525459411,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1525459719,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1525459719,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"lib/models/network-pool.js","type":"MODIFIED","insertions":22,"deletions":-1},{"file":"lib/models/network.js","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"lib/models/nic/common.js","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"test/unit/network-owner.test.js","type":"MODIFIED","insertions":21,"deletions":-3},{"file":"test/unit/network-pools.test.js","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":57,"sizeDeletions":-8}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}]}