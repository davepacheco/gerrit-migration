{"project":"joyent/manta-marlin","branch":"master","id":"I25eb5ec493e3a8082eddbb9d25eb23d97f466cfd","number":"623","subject":"MANTA-2998 marlin\u0027s dev/package.json is broken by latest node-sdc-clients Reviewed by: David Pacheco \u003cdap@joyent.com\u003e Approved by: David Pacheco \u003cdap@joyent.com\u003e","owner":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"url":"https://cr.joyent.us/623","commitMessage":"MANTA-2998 marlin\u0027s dev/package.json is broken by latest node-sdc-clients\nReviewed by: David Pacheco \u003cdap@joyent.com\u003e\nApproved by: David Pacheco \u003cdap@joyent.com\u003e\n","createdOn":1475861728,"lastUpdated":1476461848,"open":false,"status":"MERGED","comments":[{"timestamp":1475861728,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Uploaded patch set 1."},{"timestamp":1475861728,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit 9c9fdd86c13f6c8411d99eb6a28f7f014585c682\n    \n    sdc-clients.UFDS -\u003e ufds.UFDS"},{"timestamp":1475861799,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1475965040,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 1: Code-Review+1\n\nHave you run the Marlin test suite with this change?"},{"timestamp":1476217111,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 1:\n\nI\u0027m blocked by this, so I tried applying the fix in patchset 1, but it fails in almost the exact same way as before:\n\n\u003cpre\u003e\n/home/dap/node-moray2-testing/manta-marlin/build/proto/root/opt/smartdc/marlin/test/common.js:100\n        ufds_client \u003d new mod_ufds.UFDS({\n                      ^\nTypeError: undefined is not a function\n    at Object.setup (/home/dap/node-moray2-testing/manta-marlin/build/proto/root/opt/smartdc/marlin/test/common.js:100:16)\n    at Array.setup [as 0] (/home/dap/node-moray2-testing/manta-marlin/build/proto/root/opt/smartdc/marlin/test/util/tst.validate.js:99:11)\n    at Object.pipeline (/home/dap/node-moray2-testing/manta-marlin/build/proto/root/opt/smartdc/marlin/node_modules/vasync/lib/vasync.js:219:10)\n    at Object.pipeline (/home/dap/node-moray2-testing/manta-marlin/build/proto/root/opt/smartdc/marlin/test/common.js:204:13)\n    at Object.\u003canonymous\u003e (/home/dap/node-moray2-testing/manta-marlin/build/proto/root/opt/smartdc/marlin/test/util/tst.validate.js:95:10)\n    at Module._compile (module.js:456:26)\n    at Object.Module._extensions..js (module.js:474:10)\n    at Module.load (module.js:356:32)\n    at Function.Module._load (module.js:312:12)\n    at Function.Module.runMain (module.js:497:10)\n\u003c/pre\u003e\n\nI think the problem is that node-ufds exposes the UFDS constructor as the module itself.  Using mod_ufds.UFDS doesn\u0027t work."},{"timestamp":1476221270,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 1:\n\n@dap: I am sorry about that! You are correct. Also I haven\u0027t run the test suite here. I\u0027ve not setup Manta in a long while. I\u0027m currently attempting to setup in my COAL to test this. In the meantime I\u0027ll add a patchset that should be correct."},{"timestamp":1476221927,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Uploaded patch set 2."},{"timestamp":1476221971,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Uploaded patch set 3: Commit message was updated."},{"timestamp":1476221974,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1476232284,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1476393110,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Patch Set 3:\n\nI tested this patch by running the marlin test suite in a Manta standup in the lab, and all tests passed."},{"timestamp":1476405058,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Uploaded patch set 4."},{"timestamp":1476405059,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 4:\n\nNew commits:\n    \n    commit d6247974686a5fe410b4675eabfdb06dfd6839d3\n    \n    correct usage of node-ufds\n    \n    commit b3bc620c3b5f0da2fcf3e25d090ad708e8345ab4\n    \n    sdc-clients.UFDS -\u003e ufds.UFDS"},{"timestamp":1476405095,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 4:\n\nrebased on master, need @dap\u0027s +1 again :)"},{"timestamp":1476405104,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4:\n\n\"make check\" passed ok"},{"timestamp":1476405616,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 4: Code-Review+1 Integration-Approval+1"},{"timestamp":1476461843,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Uploaded patch set 5: Commit message was updated."},{"timestamp":1476461848,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Trent Mick"}],"currentPatchSet":{"number":"5","revision":"25eb5ec493e3a8082eddbb9d25eb23d97f466cfd","parents":["4487d1032ebbeaed0b7670010ded91ed9ec5702f"],"ref":"refs/changes/23/623/5","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1476461843,"author":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1476221974,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1476405616,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1476405616,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"SUBM","value":"1","grantedOn":1476461848,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"common/lib/ufds.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"dev/package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"dev/test/common.js","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":4,"sizeDeletions":-4},"patchSets":[{"number":"1","revision":"7dff6709506396873ed2240716459a0caf3dccac","parents":["64996dd12382e1db4a6114adf467a35a9dbc4009"],"ref":"refs/changes/23/623/1","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1475861728,"author":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1475965040,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1475861799,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"common/lib/ufds.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"dev/package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"dev/test/common.js","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":4,"sizeDeletions":-4},{"number":"2","revision":"74bc08b9ea84b4464a98979c5d83ddb62e6f8a68","parents":["64996dd12382e1db4a6114adf467a35a9dbc4009"],"ref":"refs/changes/23/623/2","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1476221927,"author":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1476221974,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"common/lib/ufds.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"dev/package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"dev/test/common.js","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":4,"sizeDeletions":-4},{"number":"3","revision":"29d4702be8992ca96cd7be11c1c2ada47a2ed433","parents":["64996dd12382e1db4a6114adf467a35a9dbc4009"],"ref":"refs/changes/23/623/3","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1476221971,"author":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1476232284,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"common/lib/ufds.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"dev/package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"dev/test/common.js","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":4,"sizeDeletions":-4},{"number":"4","revision":"636e846395106af95d73744cf0df7bdb9f304c03","parents":["4487d1032ebbeaed0b7670010ded91ed9ec5702f"],"ref":"refs/changes/23/623/4","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1476405058,"author":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1476405616,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1476405616,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1476221974,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"common/lib/ufds.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"dev/package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"dev/test/common.js","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":4,"sizeDeletions":-4},{"number":"5","revision":"25eb5ec493e3a8082eddbb9d25eb23d97f466cfd","parents":["4487d1032ebbeaed0b7670010ded91ed9ec5702f"],"ref":"refs/changes/23/623/5","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1476461843,"author":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1476405616,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1476405616,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1476221974,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"SUBM","value":"1","grantedOn":1476461848,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"common/lib/ufds.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"dev/package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"dev/test/common.js","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":4,"sizeDeletions":-4}],"allReviewers":[{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"}]}