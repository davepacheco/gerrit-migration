{"project":"joyent/illumos-joyent","branch":"master","id":"I2f72a3db04d009eba87c9098498c909dbd34ee45","number":"2142","subject":"OS-6193 tail(1) ignores arguments after -c/b/l Reviewed by: Robert Mustacchi \u003crm@joyent.com\u003e Approved by: Jason King \u003cjason.king@joyent.com\u003e","owner":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"url":"https://cr.joyent.us/2142","commitMessage":"OS-6193 tail(1) ignores arguments after -c/b/l\nReviewed by: Robert Mustacchi \u003crm@joyent.com\u003e\nApproved by: Jason King \u003cjason.king@joyent.com\u003e\n","createdOn":1498239792,"lastUpdated":1501623282,"open":false,"status":"MERGED","comments":[{"timestamp":1498239792,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 1."},{"timestamp":1498242449,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 1:\n\n(8 comments)"},{"timestamp":1498512239,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 2."},{"timestamp":1500077013,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 3."},{"timestamp":1500077116,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 3:\n\n(8 comments)"},{"timestamp":1501025899,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 3:\n\n(1 comment)\n\nThanks for the changes. In general, I think this looks pretty good."},{"timestamp":1501027867,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 4: Patch Set 3 was rebased."},{"timestamp":1501027895,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 5."},{"timestamp":1501027918,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 5:\n\n(1 comment)"},{"timestamp":1501285096,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 5: Code-Review+1"},{"timestamp":1501620588,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 5: Integration-Approval+1"},{"timestamp":1501620654,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 6: Commit message was updated."},{"timestamp":1501622716,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 7: Patch Set 6 was rebased"},{"timestamp":1501623094,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 8: Published edit on patch set 7."},{"timestamp":1501623199,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 8: Code-Review+1"},{"timestamp":1501623212,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 8: Integration-Approval+1"},{"timestamp":1501623282,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Cody Peter Mello"}],"currentPatchSet":{"number":"8","revision":"61e0728f89f043d8d2fcb1049dab2fe7d9c8062e","parents":["d7a09389149f499d724340c440e0d81e5676632d"],"ref":"refs/changes/42/2142/8","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1501623094,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1501623199,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1501623212,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"SUBM","value":"1","grantedOn":1501623282,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/cmd/tail/tail.c","type":"MODIFIED","insertions":96,"deletions":-18},{"file":"usr/src/cmd/tail/tests/sun_solaris_tail.sh","type":"MODIFIED","insertions":15,"deletions":0},{"file":"usr/src/cmd/tail/tests/tailtests.sh","type":"MODIFIED","insertions":148,"deletions":-26}],"sizeInsertions":259,"sizeDeletions":-44},"patchSets":[{"number":"1","revision":"b77d7ef06ed6b0d7518f7abaf9efc7b6a485a9a8","parents":["3d094ef1183b3f309a9d1ce850dec289df28c532"],"ref":"refs/changes/42/2142/1","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1498239792,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/cmd/tail/Makefile","line":29,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Any particular reason you\u0027ve linked libumem in? If that\u0027s something we want to do, it seems like that should at least be a separate ticket explaining why."},{"file":"usr/src/cmd/tail/Makefile","line":29,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"There\u0027s no real need to, so I\u0027ll turn it back."},{"file":"usr/src/cmd/tail/tail.c","line":235,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Shouldn\u0027t this be const?"},{"file":"usr/src/cmd/tail/tail.c","line":235,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Done."},{"file":"usr/src/cmd/tail/tail.c","line":246,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"How do you know that ap[1] is a valid memory location? It seems like the caller should be passing in a length or this function should be checking it."},{"file":"usr/src/cmd/tail/tail.c","line":246,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"ap comes from the process arguments, so it\u0027s either NULL or a valid C string. If it\u0027s a valid C string, then it\u0027ll end in \u0027\\0\u0027, so we can read from it a byte at a time until we get to the end. If ap[0] is the end, then we won\u0027t read ap[1]."},{"file":"usr/src/cmd/tail/tail.c","line":321,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"This comment should be updated to clarify that one can do more here or rather that we want to make sure we don\u0027t break other behavior and thus the changes going on."},{"file":"usr/src/cmd/tail/tail.c","line":321,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Done"},{"file":"usr/src/cmd/tail/tail.c","line":338,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Maybe just use asprintf rather than allocating."},{"file":"usr/src/cmd/tail/tail.c","line":338,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Done"},{"file":"usr/src/cmd/tail/tail.c","line":347,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I would replace this and the snprintf all with asprintf()."},{"file":"usr/src/cmd/tail/tail.c","line":347,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Done"},{"file":"usr/src/cmd/tail/tests/sun_solaris_tail.sh","line":34,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Is there a reason you didn\u0027t just leverage the environment for this to override the TAIL value set above?"},{"file":"usr/src/cmd/tail/tests/sun_solaris_tail.sh","line":34,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"I wanted to make this work more like the other test script, so that the two could be run similarly when making changes."},{"file":"usr/src/cmd/tail/tests/sun_solaris_tail.sh","line":37,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"You cannot rely on readlink. It is not a part of illumos and may not be installed."},{"file":"usr/src/cmd/tail/tests/sun_solaris_tail.sh","line":37,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"I\u0027ve replaced the readlink usage with dirname \u0026 basename instead."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/tail/Makefile","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/cmd/tail/tail.c","type":"MODIFIED","insertions":83,"deletions":-14},{"file":"usr/src/cmd/tail/tests/sun_solaris_tail.sh","type":"MODIFIED","insertions":15,"deletions":0},{"file":"usr/src/cmd/tail/tests/tailtests.sh","type":"MODIFIED","insertions":148,"deletions":-26}],"sizeInsertions":248,"sizeDeletions":-40},{"number":"2","revision":"1e97588e67705691280041eb138396c7f600d25c","parents":["3d094ef1183b3f309a9d1ce850dec289df28c532"],"ref":"refs/changes/42/2142/2","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1498512239,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/tail/Makefile","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/cmd/tail/tail.c","type":"MODIFIED","insertions":91,"deletions":-15},{"file":"usr/src/cmd/tail/tests/sun_solaris_tail.sh","type":"MODIFIED","insertions":15,"deletions":0},{"file":"usr/src/cmd/tail/tests/tailtests.sh","type":"MODIFIED","insertions":148,"deletions":-26}],"sizeInsertions":256,"sizeDeletions":-41},{"number":"3","revision":"6d910630e7810f78c49f70947ad8a61402531189","parents":["3d094ef1183b3f309a9d1ce850dec289df28c532"],"ref":"refs/changes/42/2142/3","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1500077013,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/cmd/tail/tail.c","line":361,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Is this free required? It seems like it can only ever free NULL."},{"file":"usr/src/cmd/tail/tail.c","line":361,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Nope, not anymore. I\u0027ve removed it."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/tail/tail.c","type":"MODIFIED","insertions":98,"deletions":-18},{"file":"usr/src/cmd/tail/tests/sun_solaris_tail.sh","type":"MODIFIED","insertions":15,"deletions":0},{"file":"usr/src/cmd/tail/tests/tailtests.sh","type":"MODIFIED","insertions":148,"deletions":-26}],"sizeInsertions":261,"sizeDeletions":-44},{"number":"4","revision":"99bae87301599833ce216a80a2f2f0e5f33ead80","parents":["2bcd0c2213ad2567e05837f2b5406447e005a44b"],"ref":"refs/changes/42/2142/4","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1501027867,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"TRIVIAL_REBASE","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/tail/tail.c","type":"MODIFIED","insertions":98,"deletions":-18},{"file":"usr/src/cmd/tail/tests/sun_solaris_tail.sh","type":"MODIFIED","insertions":15,"deletions":0},{"file":"usr/src/cmd/tail/tests/tailtests.sh","type":"MODIFIED","insertions":148,"deletions":-26}],"sizeInsertions":261,"sizeDeletions":-44},{"number":"5","revision":"2f72a3db04d009eba87c9098498c909dbd34ee45","parents":["2bcd0c2213ad2567e05837f2b5406447e005a44b"],"ref":"refs/changes/42/2142/5","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1501027895,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1501285096,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1501620588,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/tail/tail.c","type":"MODIFIED","insertions":97,"deletions":-18},{"file":"usr/src/cmd/tail/tests/sun_solaris_tail.sh","type":"MODIFIED","insertions":15,"deletions":0},{"file":"usr/src/cmd/tail/tests/tailtests.sh","type":"MODIFIED","insertions":148,"deletions":-26}],"sizeInsertions":260,"sizeDeletions":-44},{"number":"6","revision":"214ca0681a61c3e5bc0626156dd81e48340c65d4","parents":["2bcd0c2213ad2567e05837f2b5406447e005a44b"],"ref":"refs/changes/42/2142/6","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1501620654,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1501285096,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1501620588,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/cmd/tail/tail.c","type":"MODIFIED","insertions":97,"deletions":-18},{"file":"usr/src/cmd/tail/tests/sun_solaris_tail.sh","type":"MODIFIED","insertions":15,"deletions":0},{"file":"usr/src/cmd/tail/tests/tailtests.sh","type":"MODIFIED","insertions":148,"deletions":-26}],"sizeInsertions":260,"sizeDeletions":-44},{"number":"7","revision":"3f0d350982e940869ca7733335dc9037a744b5cf","parents":["d7a09389149f499d724340c440e0d81e5676632d"],"ref":"refs/changes/42/2142/7","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1501622716,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1501285096,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1501620588,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/cmd/tail/tail.c","type":"MODIFIED","insertions":97,"deletions":-18},{"file":"usr/src/cmd/tail/tests/sun_solaris_tail.sh","type":"MODIFIED","insertions":15,"deletions":0},{"file":"usr/src/cmd/tail/tests/tailtests.sh","type":"MODIFIED","insertions":148,"deletions":-26}],"sizeInsertions":260,"sizeDeletions":-44},{"number":"8","revision":"61e0728f89f043d8d2fcb1049dab2fe7d9c8062e","parents":["d7a09389149f499d724340c440e0d81e5676632d"],"ref":"refs/changes/42/2142/8","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1501623094,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1501623199,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"SUBM","value":"1","grantedOn":1501623282,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1501623212,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/cmd/tail/tail.c","type":"MODIFIED","insertions":96,"deletions":-18},{"file":"usr/src/cmd/tail/tests/sun_solaris_tail.sh","type":"MODIFIED","insertions":15,"deletions":0},{"file":"usr/src/cmd/tail/tests/tailtests.sh","type":"MODIFIED","insertions":148,"deletions":-26}],"sizeInsertions":259,"sizeDeletions":-44}],"allReviewers":[{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}]}