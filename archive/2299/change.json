{"project":"joyent/illumos-joyent","branch":"master","id":"I114cce701d05e73449f00758ae8dafbe196f4c07","number":"2299","subject":"OS-6255 mdb txg_list walker is not using CTF Reviewed by: Robert Mustacchi \u003crm@joyent.com\u003e Approved by: Bryan Cantrill \u003cbryan@joyent.com\u003e","owner":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"url":"https://cr.joyent.us/2299","commitMessage":"OS-6255 mdb txg_list walker is not using CTF\nReviewed by: Robert Mustacchi \u003crm@joyent.com\u003e\nApproved by: Bryan Cantrill \u003cbryan@joyent.com\u003e\n","createdOn":1501282690,"lastUpdated":1503010632,"open":false,"status":"MERGED","comments":[{"timestamp":1501282690,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Uploaded patch set 1."},{"timestamp":1501284967,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1501288441,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1501288931,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 1: Code-Review+1\n\nOK. I think that\u0027s probably reasonable for now."},{"timestamp":1503009375,"reviewer":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"message":"Patch Set 1: Integration-Approval+1"},{"timestamp":1503009447,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 2: Patch Set 1 was rebased"},{"timestamp":1503010006,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 3: Commit message was updated."},{"timestamp":1503010632,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Jason King"}],"currentPatchSet":{"number":"3","revision":"ac90a18349ad21775b962971502e0fb76a4fa237","parents":["ca3ddfea61d5e35b3e017e8fdb707047e5c7a5da"],"ref":"refs/changes/99/2299/3","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1503010006,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1501288931,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1503009375,"by":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"}},{"type":"SUBM","value":"1","grantedOn":1503010632,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/cmd/mdb/common/modules/zfs/zfs.c","type":"MODIFIED","insertions":9,"deletions":-2}],"sizeInsertions":9,"sizeDeletions":-2},"patchSets":[{"number":"1","revision":"114cce701d05e73449f00758ae8dafbe196f4c07","parents":["2b6211c70cd9e899b15e259d53790f01e46bb88a"],"ref":"refs/changes/99/2299/1","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1501282690,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1501288931,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1503009375,"by":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"}}],"comments":[{"file":"usr/src/cmd/mdb/common/modules/zfs/zfs.c","line":2467,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Isn\u0027t this still compiling in the notion of the size of TXG_SIZE? If TXG_SIZE changes, won\u0027t this still be impacted?"},{"file":"usr/src/cmd/mdb/common/modules/zfs/zfs.c","line":2467,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"I thought about that, though there were a few things that made me think it shouldn\u0027t be a huge concern:\n\nSuch a change would also break several other commands in the module, including ::spa_size and ::vdev that already have gone through pains to be backwards compatible via CTF (via the use of mdb_ctf_vread() and other such mechanisms), so it\u0027s no worse in that respect.\n\nIt also looks like the TXG_SIZE value is deeply tied to the structure of the transaction engine of zfs itself, so a change in it would reflect a rather substantial change to the transaction group logic.  That alone would likely require extensive reworking of the mdb module independent of this -- though someone far more familiar with ZFS should to confirm or deny that since that\u0027s just based off my somewhat casual reading of it\u0027s use in the zfs code.\n\nThe value itself hasn\u0027t changed since at least 12 years (Opensolaris launch) -- though I admit this is a weaker justification, but does suggest at least that this aspect doesn\u0027t appear to be rapid changing."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/mdb/common/modules/zfs/zfs.c","type":"MODIFIED","insertions":9,"deletions":-2}],"sizeInsertions":9,"sizeDeletions":-2},{"number":"2","revision":"da5059e9e89af233bfa9f885a5751aeb2a224cd2","parents":["ca3ddfea61d5e35b3e017e8fdb707047e5c7a5da"],"ref":"refs/changes/99/2299/2","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1503009447,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1501288931,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1503009375,"by":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/mdb/common/modules/zfs/zfs.c","type":"MODIFIED","insertions":9,"deletions":-2}],"sizeInsertions":9,"sizeDeletions":-2},{"number":"3","revision":"ac90a18349ad21775b962971502e0fb76a4fa237","parents":["ca3ddfea61d5e35b3e017e8fdb707047e5c7a5da"],"ref":"refs/changes/99/2299/3","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1503010006,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1501288931,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1503009375,"by":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"}},{"type":"SUBM","value":"1","grantedOn":1503010632,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/cmd/mdb/common/modules/zfs/zfs.c","type":"MODIFIED","insertions":9,"deletions":-2}],"sizeInsertions":9,"sizeDeletions":-2}],"allReviewers":[{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}]}