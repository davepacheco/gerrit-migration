From 36af7ae0eceeac153124cba04da8d75c38447692 Mon Sep 17 00:00:00 2001
From: Josh Wilsdon <jwilsdon@joyent.com>
Date: Fri, 21 Apr 2017 22:49:51 -0700
Subject: [PATCH] PUBAPI-1200 Would like to be able to use {{shortId}} in alias

---
 docs/index.md   | 11 +++++++++--
 lib/machines.js |  4 ++--
 package.json    |  2 +-
 3 files changed, 12 insertions(+), 5 deletions(-)

diff --git a/docs/index.md b/docs/index.md
index 3b12340..e733d0f 100644
--- a/docs/index.md
+++ b/docs/index.md
@@ -12,7 +12,7 @@ markdown2extras: tables, code-friendly
 -->
 
 <!--
-    Copyright 2016, Joyent, Inc.
+    Copyright 2017, Joyent, Inc.
 -->
 
 
@@ -859,6 +859,13 @@ variable or the `--api-version=RANGE` option to each command.
 
 The rest of this section describes API changes in each version.
 
+## 8.2.0
+
+- This version adds support for {{shortId}} tags in the 'name' parameter when
+  creating a machine using [CreateMachine](#CreateMachine) machine. Any
+  instances of {{shortId}} in the name will be replaced with the shortened
+  version (first 8 characters) of the machine's id.
+
 
 ## 8.1.1
 
@@ -4257,7 +4264,7 @@ be changed later within the instance, if desired.
 
 **Field** | **Type** | **Description**
 --------- | -------- | ---------------
-name      | String   | Friendly name for this instance; default is the first 8 characters of the machine id
+name      | String   | Friendly name for this instance; default is the first 8 characters of the machine id. If the name includes the string {{shortId}}, any instances of that tag within the name will be replaced by the first 8 characters of the machine id.
 package   | String   | Id of the package to use on provisioning, obtained from [ListPackages](#ListPackages)
 image     | String   | The image UUID (the "id" field in [ListImages](#ListImages))
 networks  | Array    | Desired networks ids, obtained from [ListNetworks](#ListNetworks)
diff --git a/lib/machines.js b/lib/machines.js
index 9ab90bf..116c7f4 100644
--- a/lib/machines.js
+++ b/lib/machines.js
@@ -5,7 +5,7 @@
  */
 
 /*
- * Copyright (c) 2014, Joyent, Inc.
+ * Copyright (c) 2017, Joyent, Inc.
  */
 
 /*
@@ -563,7 +563,7 @@ function getCreateOptions(req) {
     opts.uuid = uuid();
     shortId = opts.uuid.split(/-/)[0];
     if (params.name) {
-        opts.alias = params.name;
+        opts.alias = params.name.replace(/{{shortId}}/g, shortId);
     } else {
         opts.alias = shortId;
     }
diff --git a/package.json b/package.json
index 3cf0868..78b9c58 100644
--- a/package.json
+++ b/package.json
@@ -1,7 +1,7 @@
 {
     "name": "cloudapi",
     "description": "SmartDataCenter CloudAPI",
-    "version": "8.1.1",
+    "version": "8.2.0",
     "author": "Joyent (joyent.com)",
     "private": true,
     "engines": {
-- 
2.21.0

