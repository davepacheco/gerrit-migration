From af362d0b912f6c457afbe3a34cbd6ec1d723ab2f Mon Sep 17 00:00:00 2001
From: Josh Wilsdon <jwilsdon@joyent.com>
Date: Thu, 1 Dec 2016 15:06:30 -0800
Subject: [PATCH] FWAPI-268 fwapi should send req_id to VMAPI

---
 lib/endpoints/firewalls/vms.js | 4 +++-
 lib/endpoints/rules/vms.js     | 4 +++-
 2 files changed, 6 insertions(+), 2 deletions(-)

diff --git a/lib/endpoints/firewalls/vms.js b/lib/endpoints/firewalls/vms.js
index b5be7d9..b8280b3 100644
--- a/lib/endpoints/firewalls/vms.js
+++ b/lib/endpoints/firewalls/vms.js
@@ -53,7 +53,9 @@ function validateParams(req, res, next) {
  * GET /firewalls/vms/:uuid
  */
 function getVMrules(req, res, next) {
-    req._vmapi.getVm(req.params, function (err, vm) {
+    req._vmapi.getVm(req.params, {
+        headers: {'request-id': req.getId()}
+    }, function (err, vm) {
         if (err) {
             return next(err);
         }
diff --git a/lib/endpoints/rules/vms.js b/lib/endpoints/rules/vms.js
index c00894f..20c7bf2 100644
--- a/lib/endpoints/rules/vms.js
+++ b/lib/endpoints/rules/vms.js
@@ -64,7 +64,9 @@ function getRuleVMs(req, res, next) {
     var filterTxt = filter.join('');
     req.log.debug('listing VMs: %s', filterTxt);
 
-    req._vmapi.listVms({ query: filterTxt }, function (err, vmList) {
+    req._vmapi.listVms({ query: filterTxt }, {
+        headers: {'request-id': req.getId()}
+    }, function (err, vmList) {
         if (err) {
             return next(err);
         }
-- 
2.21.0

