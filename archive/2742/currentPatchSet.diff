From 3a2080bade245956b311cb9226e252129d438687 Mon Sep 17 00:00:00 2001
From: "Joshua M. Clulow" <jmc@joyent.com>
Date: Fri, 6 Oct 2017 13:57:51 +0000
Subject: [PATCH] TOOLS-1876 mountain-gorilla should sync git submodule URLs
 Reviewed by: Julien Gilli <julien.gilli@joyent.com> Approved by: Julien Gilli
 <julien.gilli@joyent.com>

---
 configure | 8 ++++++--
 1 file changed, 6 insertions(+), 2 deletions(-)

diff --git a/configure b/configure
index 23a5258..424223f 100755
--- a/configure
+++ b/configure
@@ -395,7 +395,9 @@ function get_repo_cache() {
         (cd $MG_CACHE_DIR/repos/$repo_dir; git pull)
     fi
     if [[ "$submodule_update" == "true" ]]; then
-        (cd $MG_CACHE_DIR/repos/$repo_dir; git submodule update --init --recursive)
+        (cd "$MG_CACHE_DIR/repos/$repo_dir" &&
+            git submodule sync --recursive &&
+            git submodule update --init --recursive)
     fi
 
     # Error out if the cached repo is dirty. These thigns should always
@@ -441,7 +443,9 @@ function get_repo2() {
         (cd build/$repo_dir ; git checkout $try_branch && git pull || true)
     fi
     if [[ "$submodule_update" == "true" ]]; then
-        (cd build/$repo_dir; git submodule update --init --recursive)
+        (cd "build/$repo_dir" &&
+            git submodule sync --recursive &&
+            git submodule update --init --recursive)
     fi
 }
 
-- 
2.21.0

