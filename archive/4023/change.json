{"project":"joyent/illumos-joyent","branch":"master","id":"Ia1545e5248d66d8e5558f0b034d4bb9a23e051e9","number":"4023","subject":"OS-6988 bhyve wastes 1GB of RAM for each VM using more than 3GB Reviewed by: John Levon \u003cjohn.levon@joyent.com\u003e Reviewed by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e Approved by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e","owner":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"url":"https://cr.joyent.us/4023","commitMessage":"OS-6988 bhyve wastes 1GB of RAM for each VM using more than 3GB\nReviewed by: John Levon \u003cjohn.levon@joyent.com\u003e\nReviewed by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e\nApproved by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e\n","createdOn":1527693558,"lastUpdated":1528755648,"open":false,"status":"MERGED","comments":[{"timestamp":1527693558,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Uploaded patch set 1."},{"timestamp":1527899117,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 1:\n\n(2 comments)"},{"timestamp":1528114325,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1528125751,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Patch Set 2: Patch Set 1 was rebased"},{"timestamp":1528126153,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Uploaded patch set 3."},{"timestamp":1528126452,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Patch Set 3:\n\n(3 comments)"},{"timestamp":1528127201,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1528485956,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1528747199,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 3: Integration-Approval+1"},{"timestamp":1528748620,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Patch Set 4: Patch Set 3 was rebased"},{"timestamp":1528751254,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Uploaded patch set 5: Commit message was updated."},{"timestamp":1528755617,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Patch Set 6: Patch Set 5 was rebased"},{"timestamp":1528755648,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Hans Rosenfeld"}],"currentPatchSet":{"number":"6","revision":"2d24d386afb2debdcfd0eb0aa496b2642ce2e7b7","parents":["ed1b4e2adca66e5932ad3f323759a69ff876a64d"],"ref":"refs/changes/23/4023/6","uploader":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"createdOn":1528755617,"author":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1528127201,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1528485956,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1528747199,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"SUBM","value":"1","grantedOn":1528755647,"by":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/lib/libvmmapi/common/vmmapi.c","type":"MODIFIED","insertions":40,"deletions":0},{"file":"usr/src/lib/libvmmapi/common/vmmapi.h","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/vmm.c","type":"MODIFIED","insertions":4,"deletions":0}],"sizeInsertions":49,"sizeDeletions":0},"patchSets":[{"number":"1","revision":"cc953edc6dfa4faf8cb85e1804d5e0cbe1fffeb4","parents":["b64971bdda5ebae57056a4d21f436426ccab8f25"],"ref":"refs/changes/23/4023/1","uploader":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"createdOn":1527693558,"author":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/lib/libvmmapi/common/vmmapi.c","line":401,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"The forcing of \u0027off\u0027 to zero could at least do with a comment?"},{"file":"usr/src/lib/libvmmapi/common/vmmapi.c","line":401,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Done"},{"file":"usr/src/lib/libvmmapi/common/vmmapi.c","line":488,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Style nit: Rather than braiding these ifdefs together like this, what about duplicating the shared code so it\u0027s a big #ifndef .. #else .. #endif in each of the if-statements?"},{"file":"usr/src/lib/libvmmapi/common/vmmapi.c","line":488,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Done"},{"file":"usr/src/lib/libvmmapi/common/vmmapi.h","line":90,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Style nit: Toss this up in the same ifdef as VM_LOWMEM for readability?  (Unless there\u0027s a reason the order matters?)"},{"file":"usr/src/lib/libvmmapi/common/vmmapi.h","line":90,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/libvmmapi/common/vmmapi.c","type":"MODIFIED","insertions":29,"deletions":0},{"file":"usr/src/lib/libvmmapi/common/vmmapi.h","type":"MODIFIED","insertions":7,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/vmm.c","type":"MODIFIED","insertions":4,"deletions":0}],"sizeInsertions":40,"sizeDeletions":0},{"number":"2","revision":"aeac56c4aee0a13e5f9879aca32e1c0583a04c88","parents":["2e89f711f976473351ffb54856bc5738de8778aa"],"ref":"refs/changes/23/4023/2","uploader":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"createdOn":1528125751,"author":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"isDraft":false,"kind":"TRIVIAL_REBASE","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/libvmmapi/common/vmmapi.c","type":"MODIFIED","insertions":29,"deletions":0},{"file":"usr/src/lib/libvmmapi/common/vmmapi.h","type":"MODIFIED","insertions":7,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/vmm.c","type":"MODIFIED","insertions":4,"deletions":0}],"sizeInsertions":40,"sizeDeletions":0},{"number":"3","revision":"af686218614f7e38a2ced5780bf7d9c46ea9d7cd","parents":["2e89f711f976473351ffb54856bc5738de8778aa"],"ref":"refs/changes/23/4023/3","uploader":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"createdOn":1528126153,"author":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1528485956,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1528747199,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1528127201,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/libvmmapi/common/vmmapi.c","type":"MODIFIED","insertions":40,"deletions":0},{"file":"usr/src/lib/libvmmapi/common/vmmapi.h","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/vmm.c","type":"MODIFIED","insertions":4,"deletions":0}],"sizeInsertions":49,"sizeDeletions":0},{"number":"4","revision":"5a6411ad55a053ee9c8e4f4dca9c751cdec5f660","parents":["f59fd9b79855b1f49adcb2be38d95df7b32d5eea"],"ref":"refs/changes/23/4023/4","uploader":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"createdOn":1528748620,"author":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1528485956,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1528747199,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1528127201,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/libvmmapi/common/vmmapi.c","type":"MODIFIED","insertions":40,"deletions":0},{"file":"usr/src/lib/libvmmapi/common/vmmapi.h","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/vmm.c","type":"MODIFIED","insertions":4,"deletions":0}],"sizeInsertions":49,"sizeDeletions":0},{"number":"5","revision":"a1545e5248d66d8e5558f0b034d4bb9a23e051e9","parents":["f59fd9b79855b1f49adcb2be38d95df7b32d5eea"],"ref":"refs/changes/23/4023/5","uploader":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"createdOn":1528751254,"author":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1528485956,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1528747199,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1528127201,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/lib/libvmmapi/common/vmmapi.c","type":"MODIFIED","insertions":40,"deletions":0},{"file":"usr/src/lib/libvmmapi/common/vmmapi.h","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/vmm.c","type":"MODIFIED","insertions":4,"deletions":0}],"sizeInsertions":49,"sizeDeletions":0},{"number":"6","revision":"2d24d386afb2debdcfd0eb0aa496b2642ce2e7b7","parents":["ed1b4e2adca66e5932ad3f323759a69ff876a64d"],"ref":"refs/changes/23/4023/6","uploader":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"createdOn":1528755617,"author":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1528485956,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1528747199,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"SUBM","value":"1","grantedOn":1528755647,"by":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1528127201,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/lib/libvmmapi/common/vmmapi.c","type":"MODIFIED","insertions":40,"deletions":0},{"file":"usr/src/lib/libvmmapi/common/vmmapi.h","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/vmm.c","type":"MODIFIED","insertions":4,"deletions":0}],"sizeInsertions":49,"sizeDeletions":0}],"allReviewers":[{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"}]}