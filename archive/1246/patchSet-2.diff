From 7f2894ad50e5601244135822371f30e4ca4a0c4d Mon Sep 17 00:00:00 2001
From: Pedro Palazon Candel <pedro@joyent.com>
Date: Fri, 13 Jan 2017 10:57:51 +0100
Subject: [PATCH] TOOLS-1631 'sdcadm experimental update SOME-AGENT' fails if
 there are no instances yet

---
 lib/procedures/update-agent-v1.js | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/lib/procedures/update-agent-v1.js b/lib/procedures/update-agent-v1.js
index 83aa868..a547353 100644
--- a/lib/procedures/update-agent-v1.js
+++ b/lib/procedures/update-agent-v1.js
@@ -177,6 +177,11 @@ UpdateAgentV1.prototype.execute = function uaExecute(opts, callback) {
             },
 
             function checkCNsAvailability(_, next) {
+                // Move into the next step if we have zero instances:
+                if (change.insts.length === 0) {
+                    next();
+                    return;
+                }
                 sdcadm.cnapi.listServers({
                     uuids: change.insts.map(function (i) {
                         return (i.server);
-- 
2.21.0

