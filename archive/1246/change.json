{"project":"joyent/sdcadm","branch":"master","id":"I4652d5c797853c3028f8531bb057c1e460cb112a","number":"1246","subject":"TOOLS-1631 \u0027sdcadm experimental update SOME-AGENT\u0027 fails if there are no instances yet Reviewed by: Trent Mick \u003ctrent.mick@joyent.com\u003e","owner":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"url":"https://cr.joyent.us/1246","commitMessage":"TOOLS-1631 \u0027sdcadm experimental update SOME-AGENT\u0027 fails if there are no instances yet\nReviewed by: Trent Mick \u003ctrent.mick@joyent.com\u003e\n","createdOn":1484301482,"lastUpdated":1484931276,"open":false,"status":"MERGED","comments":[{"timestamp":1484301482,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 1."},{"timestamp":1484301517,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1484301566,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 2: Commit message was updated."},{"timestamp":1484337336,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 3."},{"timestamp":1484337378,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1484338138,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 3:\n\nDiscussed with pedro and he is going to update this CR to not add the \"procedure\" to update agents if there are 0 instances to update. That\u0027s so we don\u0027t get the do-nothing procedure:\n\n```\nThis update will make the following changes:\n   update \"cmon-agent\" service to image 0473c054-8d62-45ff-a7ad-798a17a0cd14\n       cmon-agent@1.0.0\n   in 0 servers\n```"},{"timestamp":1484585497,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 4."},{"timestamp":1484585541,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1484586082,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 4:\n\nTrent, updated to provide the following feedback now (w/o adding the updateAgent procedure when there are no agent instances):\n\n    [root@headnode (coal) ~]# sdcadm experimental update cmon-agent@4f5d2ac2-699a-422f-801c-bc7733c0f017 -C experimental\n    Using channel experimental\n\n    This update will make the following changes:\n        download 1 image (15 MiB):\n            image 4f5d2ac2-699a-422f-801c-bc7733c0f017\n                (cmon-agent@1.0.0)\n\n    Would you like to continue? [y/N] y"},{"timestamp":1484586122,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 5."},{"timestamp":1484586192,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1484698018,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 5: Code-Review+1\n\n(2 comments)"},{"timestamp":1484843431,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 6."},{"timestamp":1484843470,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 6:\n\n(2 comments)\n\nTrent, both modified"},{"timestamp":1484843483,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 6: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1484872060,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 6: Code-Review+1 Integration-Approval+1"},{"timestamp":1484931276,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Pedro Palazón Candel"}],"currentPatchSet":{"number":"6","revision":"4652d5c797853c3028f8531bb057c1e460cb112a","parents":["5334e7bc0b626cbbbd155e559d931cd6b2e49630"],"ref":"refs/changes/46/1246/6","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1484843431,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1484843483,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1484872060,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1484872060,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1484931276,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"lib/procedures/index.js","type":"MODIFIED","insertions":15,"deletions":-7},{"file":"lib/procedures/update-agent-v1.js","type":"MODIFIED","insertions":10,"deletions":-3},{"file":"lib/sdcadm.js","type":"MODIFIED","insertions":6,"deletions":-8}],"sizeInsertions":31,"sizeDeletions":-18},"patchSets":[{"number":"1","revision":"8604e532e35bd5c1e9d120dc53eb2f77aac971d4","parents":["5334e7bc0b626cbbbd155e559d931cd6b2e49630"],"ref":"refs/changes/46/1246/1","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1484301482,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1484301517,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/procedures/update-agent-v1.js","type":"MODIFIED","insertions":5,"deletions":0}],"sizeInsertions":5,"sizeDeletions":0},{"number":"2","revision":"7f2894ad50e5601244135822371f30e4ca4a0c4d","parents":["5334e7bc0b626cbbbd155e559d931cd6b2e49630"],"ref":"refs/changes/46/1246/2","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1484301566,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1484301517,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/procedures/update-agent-v1.js","type":"MODIFIED","insertions":5,"deletions":0}],"sizeInsertions":5,"sizeDeletions":0},{"number":"3","revision":"603ffdbdb645c5dc632fe5b027d8e7b290589327","parents":["5334e7bc0b626cbbbd155e559d931cd6b2e49630"],"ref":"refs/changes/46/1246/3","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1484337336,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1484337378,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/procedures/update-agent-v1.js","type":"MODIFIED","insertions":5,"deletions":0},{"file":"lib/sdcadm.js","type":"MODIFIED","insertions":6,"deletions":-8}],"sizeInsertions":11,"sizeDeletions":-8},{"number":"4","revision":"b5f216e26e68880cbce346124ef866d89d13da5d","parents":["5334e7bc0b626cbbbd155e559d931cd6b2e49630"],"ref":"refs/changes/46/1246/4","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1484585497,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1484585541,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"lib/procedures/update-agent-v1.js","type":"MODIFIED","insertions":10,"deletions":-3},{"file":"lib/sdcadm.js","type":"MODIFIED","insertions":6,"deletions":-8}],"sizeInsertions":16,"sizeDeletions":-11},{"number":"5","revision":"096a1a2ad5e4fe7e1c681d0ff65ffd48b9772b65","parents":["5334e7bc0b626cbbbd155e559d931cd6b2e49630"],"ref":"refs/changes/46/1246/5","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1484586122,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1484586192,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1484698018,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"comments":[{"file":"lib/procedures/index.js","line":755,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Perhaps move this log.debug inside the following if-block?"},{"file":"lib/procedures/index.js","line":755,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/procedures/update-agent-v1.js","line":47,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"\"on\" rather than \"in\"."},{"file":"lib/procedures/update-agent-v1.js","line":47,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"lib/procedures/index.js","type":"MODIFIED","insertions":12,"deletions":-4},{"file":"lib/procedures/update-agent-v1.js","type":"MODIFIED","insertions":10,"deletions":-3},{"file":"lib/sdcadm.js","type":"MODIFIED","insertions":6,"deletions":-8}],"sizeInsertions":28,"sizeDeletions":-15},{"number":"6","revision":"4652d5c797853c3028f8531bb057c1e460cb112a","parents":["5334e7bc0b626cbbbd155e559d931cd6b2e49630"],"ref":"refs/changes/46/1246/6","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1484843431,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1484843483,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1484872060,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1484872060,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1484931276,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"lib/procedures/index.js","type":"MODIFIED","insertions":15,"deletions":-7},{"file":"lib/procedures/update-agent-v1.js","type":"MODIFIED","insertions":10,"deletions":-3},{"file":"lib/sdcadm.js","type":"MODIFIED","insertions":6,"deletions":-8}],"sizeInsertions":31,"sizeDeletions":-18}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}]}