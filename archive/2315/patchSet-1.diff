From 33d1d8165bb9f57586287225f5b5028f9b84d72c Mon Sep 17 00:00:00 2001
From: Cody Peter Mello <cody.mello@joyent.com>
Date: Wed, 22 Mar 2017 21:11:13 +0000
Subject: [PATCH] MORAY-397 Remove query timeouts unless requested by client

---
 test/sql.test.js | 16 ++++++++++++++++
 1 file changed, 16 insertions(+)

diff --git a/test/sql.test.js b/test/sql.test.js
index 1a844fa..6df05fb 100644
--- a/test/sql.test.js
+++ b/test/sql.test.js
@@ -102,3 +102,19 @@ test('sql - cleanup', function (t) {
         t.end();
     });
 });
+
+test('MORAY-397: client timeout respected', function (t) {
+    q = c.sql('SELECT pg_sleep(5);', [], { timeout: 1000 });
+    q.on('error', function (err) {
+        t.ok(VError.hasCauseWithName(err, 'QueryTimeoutError'),
+            'correct error');
+        t.end();
+    });
+    q.on('record', function (r) {
+        t.deepEqual(r, null, 'no row should be returned');
+    });
+    q.on('end', function (r) {
+        t.fail('"error" should have been emitted');
+        t.end();
+    });
+});
-- 
2.21.0

