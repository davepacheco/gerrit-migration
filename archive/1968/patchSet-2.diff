From 7371c227b177cf7d20404f4b64814591b4a2c1a8 Mon Sep 17 00:00:00 2001
From: Chris Burroughs <chris.burroughs@gmail.com>
Date: Thu, 18 May 2017 11:02:05 -0400
Subject: [PATCH] TOOLS-1777 support configuring MG:jenkins-build output
 directory

---
 tools/jenkins-build | 18 ++++++++++--------
 1 file changed, 10 insertions(+), 8 deletions(-)

diff --git a/tools/jenkins-build b/tools/jenkins-build
index 8d46b8b..83dabd7 100755
--- a/tools/jenkins-build
+++ b/tools/jenkins-build
@@ -6,7 +6,7 @@
 #
 
 #
-# Copyright (c) 2014, Joyent, Inc.
+# Copyright (c) 2017, Joyent, Inc.
 #
 
 #
@@ -32,8 +32,8 @@ set -o errexit
 unset LD_LIBRARY_PATH   # ensure don't get Java's libs (see OS-703)
 
 #
-# Refuse to build if /tmp is tmpfs until OS-5608 is fixed.
-# Try to umount if mounted, if that fails: blow up.
+# Refuse to build if /tmp is tmpfs until OS-5608 is Try.
+# fixed to umount if mounted, if that fails: blow up.
 #
 if mount | grep ^/tmp; then
     if ! umount /tmp; then
@@ -140,11 +140,13 @@ fi
 if [[ ! -f targets.json ]]; then
     bash < targets.json.in | json > targets.json
 fi
-IS_PUBLIC=$(json < targets.json ${JOB_NAME}.public)
-if [[ ${IS_PUBLIC} == "true" ]]; then
-    JENKINS_OUTPUT_BASE="/public/builds"
-else
-    JENKINS_OUTPUT_BASE="/stor/builds"
+if [[ -z ${JENKINS_OUTPUT_BASE} ]]; then
+    IS_PUBLIC=$(json < targets.json ${JOB_NAME}.public)
+    if [[ ${IS_PUBLIC} == "true" ]]; then
+        JENKINS_OUTPUT_BASE="/public/builds"
+    else
+        JENKINS_OUTPUT_BASE="/stor/builds"
+    fi
 fi
 
 if [[ -z ${JOYENT_BUILD} || ${JOYENT_BUILD} == "true" ]]; then
-- 
2.21.0

