{"project":"joyent/node-moray-sandbox","branch":"master","id":"I54fc0e9090d6c1d283d752142eb528986b95b506","number":"1081","subject":"TOOLS-1629 Want library for setting up sandboxed Moray instances","owner":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"url":"https://cr.joyent.us/1081","commitMessage":"TOOLS-1629 Want library for setting up sandboxed Moray instances\n","createdOn":1481144242,"lastUpdated":1484100037,"open":false,"status":"MERGED","comments":[{"timestamp":1481144242,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 1."},{"timestamp":1481144371,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1481149415,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 2."},{"timestamp":1481149918,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1481150262,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 1:\n\n(20 comments)"},{"timestamp":1481227362,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 3."},{"timestamp":1481227485,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 2:\n\n(17 comments)"},{"timestamp":1481227579,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1481301525,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 1:\n\n(7 comments)\n\nThanks for looking at the feedback."},{"timestamp":1483746963,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 4."},{"timestamp":1483747071,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1483747304,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 4:\n\n(3 comments)"},{"timestamp":1484099779,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 4: Code-Review+1 Integration-Approval+1"},{"timestamp":1484100037,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Cody Peter Mello"}],"currentPatchSet":{"number":"4","revision":"54fc0e9090d6c1d283d752142eb528986b95b506","parents":["60a49ee49c509bcc31d6f48bc5012d85ae4b9ee9"],"ref":"refs/changes/81/1081/4","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1483746963,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1483747071,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1484099779,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1484099779,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"SUBM","value":"1","grantedOn":1484100037,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"ADDED","insertions":67,"deletions":0},{"file":"README.md","type":"ADDED","insertions":101,"deletions":0},{"file":"deps/javascriptlint","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/client.js","type":"ADDED","insertions":382,"deletions":0},{"file":"lib/index.js","type":"ADDED","insertions":53,"deletions":0},{"file":"lib/pg-server.js","type":"ADDED","insertions":133,"deletions":0},{"file":"lib/run.js","type":"ADDED","insertions":133,"deletions":0},{"file":"lib/sandbox.js","type":"ADDED","insertions":241,"deletions":0},{"file":"package.json","type":"ADDED","insertions":34,"deletions":0},{"file":"test/lib/log.js","type":"ADDED","insertions":21,"deletions":0},{"file":"test/unit/basic.test.js","type":"ADDED","insertions":425,"deletions":0},{"file":"test/unit/run.js","type":"ADDED","insertions":32,"deletions":0},{"file":"tools/eslint.node.conf","type":"MODIFIED","insertions":1,"deletions":0}],"sizeInsertions":1624,"sizeDeletions":-1},"patchSets":[{"number":"1","revision":"26e2141ebc3eb381e764221ee918d21044d7c526","parents":["60a49ee49c509bcc31d6f48bc5012d85ae4b9ee9"],"ref":"refs/changes/81/1081/1","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1481144242,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1481144371,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"Makefile","line":0,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"The Makefile references a lot of files in \"tools/\" that aren\u0027t in the change (tools/jsl.node.conf, tools/jstyle.conf, tools/eslint.node.conf, tools/mk/Makefile.deps, and tools/mk/Makefile.targ)."},{"file":"Makefile","line":0,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"I put those in the initial commit, since they were mostly stock files copied from eng.git."},{"file":"README.md","line":20,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I really like the idea of being able to easily stand up a PostgreSQL+standalone Moray.  But I wonder if this wouldn\u0027t be more useful as a standalone tool for doing that instead of a library.  A tool would still make it very easy for developers and CI environments to stand up their own cluster for testing, but it would be more flexible for a couple of reasons:\n\n- you could use it for one-off manual tests and experimentation instead of just automated tests\n- you could easily run modified moray servers (e.g., with extra logging)\n- you could easily modify the configuration of Moray or PostgreSQL\n- if you did nothing, you would still have all the debugging state (the database contents and the Moray and PostgreSQL log files)\n- the CI environment could decide exactly where it wants to put the on-disk state so that if the test failed, it could bundle that up and store it somewhere else.\n\nA tool-based approach would also address the problems of process management and cleaning up the disk files.  (I imagine you\u0027d run standalone instances under SMF services, and there\u0027d be tooling to create and destroy instances.)"},{"file":"README.md","line":46,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Can you create clients with different properties (e.g., a different logger)?"},{"file":"README.md","line":46,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Not currently. I considered adding an options object to pass to clone to allow for not inheriting the same mock errors, but since I didn\u0027t need that at the moment, I figured I\u0027d leave it for the future."},{"file":"README.md","line":73,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"The mock error facility is great.  I\u0027d love to build something like this into the real Moray client.  I\u0027ve long wanted to do this against a real Moray (see MANTA-1753).  It might also be nice to have facilities for:\n\n- failing a certain percentage of requests\n- failing individual RPCs based on parameters (instead of relying on order)"},{"file":"README.md","line":73,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"For failing a certain percentage, I could see something like .setFailureRate(name, rate, err).\n\nFor failing based on parameters, what do you think would be a good interface? Maybe allow passing a function instead of an array of errors? It could be called with (name, infoObj), and could return null or an error."},{"file":"README.md","line":73,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Yeah, exactly.  To be clear though I didn\u0027t mean to suggest this needs to be part of this work now, just that it would be nice if the abstraction supported that kind of thing later.\n\nI\u0027d probably suggest making it a method-based interface, so that the first argument would be an object with methods that you use to pull out the RPC method name, arguments, and so on.  That way, we could extend it later to support fancier behavior too (like simulating delays).  Again, I\u0027m assuming this is all future stuff."},{"file":"lib/client.js","line":43,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"It seems like \"stack\" is actually an Error.  Is this just for viewing in a core file?"},{"file":"lib/client.js","line":43,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"I wanted to make sure that I was closing the Moray clients I created in different tests and shutdown code, so the TemporaryPostgres.stop() method throws this error if you forgot to close any of the clients created with the library. I called it .stack, because I wanted to see where the client was created (via .clone(), .spawnMoray(), etc.)."},{"file":"lib/client.js","line":43,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"That makes sense.  (The name raised a flag for me because accessing \".stack\" of Errors before you actually need the stack defeats some of the VM\u0027s optimizations around that, but that doesn\u0027t seem to apply here.)"},{"file":"lib/client.js","line":210,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Why not just have consumers specify this when they use findObjects?  I\u0027m worried that having the testing moray client silently work meaningfully differently than the real one would introduce hard-to-debug bugs."},{"file":"lib/client.js","line":210,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"I\u0027ve removed it."},{"file":"lib/index.js","line":51,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"What do you think about having the exported names match the names defined here?"},{"file":"lib/pg-server.js","line":12,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Some more documentation on this would be helpful."},{"file":"lib/run.js","line":8,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"This file could really use a block comment that mentions that it\u0027s run as a separate standalone program and maybe describes the protocol in use with the parent process.  I might even put it in a different directory (like bin/sandbox or something)."},{"file":"lib/run.js","line":8,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Done"},{"file":"lib/run.js","line":13,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"This is probably fine, but something I noticed: this module adds an \u0027uncaughtException\u0027 listener on Node 0.9.5 and earlier.  On newer releases it relies on the \u0027exit\u0027 event firing for uncaught exceptions.  That seems to do what I\u0027d like when --abort-on-uncaught-exception is used (namely, the \"exit\" listener is not executed, and the core file is generated in the right context).  But it seems clear that their intent is to continue running code after arbitrary failure, and if they decide to implement that differently, we may not be able to get useful core files for failed tests."},{"file":"lib/run.js","line":13,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"That\u0027s good to keep in mind for the future. I don\u0027t actually know if run.js would inherit --abort-on-uncaught-exception from the parent or not. child_process.fork() might not account for that."},{"file":"lib/run.js","line":45,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Where does this get created?\n\nIs it ever useful to preserve the database on test failure?"},{"file":"lib/run.js","line":45,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"This gets created under $TMPDIR or /tmp if unspecified.\n\nI haven\u0027t found myself wanting the database after test failure yet."},{"file":"lib/run.js","line":45,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Could we document that?"},{"file":"lib/run.js","line":45,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Done"},{"file":"lib/sandbox.js","line":12,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"It might be useful to point out here that we\u0027re standing up \"temporary Moray instances in standalone mode and associated PostgreSQL databases\""},{"file":"lib/sandbox.js","line":12,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Done"},{"file":"lib/sandbox.js","line":19,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"It seems pretty dicey to reach into a private file inside a dependent module.  What about running Moray in a child process?  That does make the child process problem worse.  But if we\u0027re going to create a contracted interface between the Moray server and external consumers, I think it needs to be a real thing (documented as such and exported from the module)."},{"file":"lib/sandbox.js","line":19,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"I can put together some documentation for Moray to do this. For now, I can document just the standalone mode as a supported interface."},{"file":"lib/sandbox.js","line":19,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I wasn\u0027t so much worried about using \"standalone\" mode so much as reaching into the subpackage to get at the MorayServer constructor.  I don\u0027t think that\u0027s intended to be exposed outside that module today.  We could expose it explicitly and at least put a comment on it so people would know that there might be external dependencies."},{"file":"lib/sandbox.js","line":19,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Done"},{"file":"lib/sandbox.js","line":28,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Nitty: what about putting this into a separate file for clarity?"},{"file":"lib/sandbox.js","line":28,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Does the way I\u0027ve rewritten this make it clearer? I do like having it live right next to the other other constants."},{"file":"lib/sandbox.js","line":28,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Okay."},{"file":"lib/sandbox.js","line":33,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Is this replicated from Moray?"},{"file":"lib/sandbox.js","line":33,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Yeah. I think I got it from the README."},{"file":"lib/sandbox.js","line":51,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"What do you think about making this deterministic to avoid having tests that fail spuriously (and rarely)?"},{"file":"lib/sandbox.js","line":51,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Are you thinking that this could be something like a counter that increments by one for every new Moray instance?"},{"file":"lib/sandbox.js","line":51,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Yeah."},{"file":"lib/sandbox.js","line":103,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"You might want to take a look at node-forkexec here.  I don\u0027t know if this has changed, but it used to be possible for this function to throw an exception in cases like EAGAIN/ENOMEM.  Besides that, the errors from node-forkexec are generally much clearer than from Node."},{"file":"lib/sandbox.js","line":103,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Done"},{"file":"lib/sandbox.js","line":114,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"What do you think about wrapping this (and the one from mkdir below) in VErrors to get clearer error messages when things go wrong?"},{"file":"lib/sandbox.js","line":114,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Done"},{"file":"lib/sandbox.js","line":128,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"What happens to the child processes if the test fails fatally?  This was a pretty common (and annoying) problem with the Moray test suite.  I addressed it there by starting tests under ctrun with arguments that will cause those processes to be killed if the parent process goes away, although that won\u0027t clean up the database files.  Maybe put them on tmpfs?"},{"file":"lib/sandbox.js","line":128,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"If the test fails fatally, then the run.js child process receives the \u0027disconnect\u0027 event, and starts the cleanup. Since  it is the session leader of its own process group, it can send SIGTERM to -\u003cpid\u003e and clean up all of the PG children. self._cleanup() will take care of removing the database files which were created under $TMPDIR (or /tmp if it didn\u0027t exist)."},{"file":"lib/sandbox.js","line":151,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Why the retries here?"},{"file":"lib/sandbox.js","line":151,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"When Postgres is slow to start, createdb fails with \"the database system is starting up\", and you need to retry. Looking at the logs I currently have in /tmp, it succeeded on the first try 45 times, and on the second 170 times. It hasn\u0027t needed to try more than that."},{"file":"lib/sandbox.js","line":151,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"It seems really odd that createdb would fail that way, and also that the response would be to try to create the same database again when the first one seems to be starting up.  (Or is it that createdb is idempotent?)  Is that documented somewhere?"},{"file":"lib/sandbox.js","line":151,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"The word \"database\" is being used in two different ways here. The one starting up is the database cluster, created by initdb, and starting after running the postgres command. The other \"database\" is the one being created inside the database cluster with the createdb command. If postgres is still initializing, then createdb aborts with this error message without doing anything."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"ADDED","insertions":67,"deletions":0},{"file":"README.md","type":"ADDED","insertions":101,"deletions":0},{"file":"deps/javascriptlint","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/client.js","type":"ADDED","insertions":391,"deletions":0},{"file":"lib/index.js","type":"ADDED","insertions":53,"deletions":0},{"file":"lib/pg-server.js","type":"ADDED","insertions":112,"deletions":0},{"file":"lib/run.js","type":"ADDED","insertions":123,"deletions":0},{"file":"lib/sandbox.js","type":"ADDED","insertions":229,"deletions":0},{"file":"package.json","type":"ADDED","insertions":33,"deletions":0},{"file":"test/lib/log.js","type":"ADDED","insertions":21,"deletions":0},{"file":"test/unit/basic.test.js","type":"ADDED","insertions":425,"deletions":0},{"file":"test/unit/run.js","type":"ADDED","insertions":32,"deletions":0}],"sizeInsertions":1588,"sizeDeletions":-1},{"number":"2","revision":"54e44a88582e9087284aaf0083a67168ed031ee2","parents":["60a49ee49c509bcc31d6f48bc5012d85ae4b9ee9"],"ref":"refs/changes/81/1081/2","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1481149415,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1481149918,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"ADDED","insertions":67,"deletions":0},{"file":"README.md","type":"ADDED","insertions":101,"deletions":0},{"file":"deps/javascriptlint","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/client.js","type":"ADDED","insertions":391,"deletions":0},{"file":"lib/index.js","type":"ADDED","insertions":53,"deletions":0},{"file":"lib/pg-server.js","type":"ADDED","insertions":112,"deletions":0},{"file":"lib/run.js","type":"ADDED","insertions":123,"deletions":0},{"file":"lib/sandbox.js","type":"ADDED","insertions":234,"deletions":0},{"file":"package.json","type":"ADDED","insertions":33,"deletions":0},{"file":"test/lib/log.js","type":"ADDED","insertions":21,"deletions":0},{"file":"test/unit/basic.test.js","type":"ADDED","insertions":425,"deletions":0},{"file":"test/unit/run.js","type":"ADDED","insertions":32,"deletions":0}],"sizeInsertions":1593,"sizeDeletions":-1},{"number":"3","revision":"47b616c1331f758fc06fd6d8cc1baf3c1316b897","parents":["60a49ee49c509bcc31d6f48bc5012d85ae4b9ee9"],"ref":"refs/changes/81/1081/3","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1481227362,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1481227579,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"ADDED","insertions":67,"deletions":0},{"file":"README.md","type":"ADDED","insertions":101,"deletions":0},{"file":"deps/javascriptlint","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/client.js","type":"ADDED","insertions":382,"deletions":0},{"file":"lib/index.js","type":"ADDED","insertions":53,"deletions":0},{"file":"lib/pg-server.js","type":"ADDED","insertions":133,"deletions":0},{"file":"lib/run.js","type":"ADDED","insertions":132,"deletions":0},{"file":"lib/sandbox.js","type":"ADDED","insertions":251,"deletions":0},{"file":"package.json","type":"ADDED","insertions":34,"deletions":0},{"file":"test/lib/log.js","type":"ADDED","insertions":21,"deletions":0},{"file":"test/unit/basic.test.js","type":"ADDED","insertions":425,"deletions":0},{"file":"test/unit/run.js","type":"ADDED","insertions":32,"deletions":0},{"file":"tools/eslint.node.conf","type":"MODIFIED","insertions":1,"deletions":0}],"sizeInsertions":1633,"sizeDeletions":-1},{"number":"4","revision":"54fc0e9090d6c1d283d752142eb528986b95b506","parents":["60a49ee49c509bcc31d6f48bc5012d85ae4b9ee9"],"ref":"refs/changes/81/1081/4","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1483746963,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1484099779,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1484099779,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"SUBM","value":"1","grantedOn":1484100037,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1483747071,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"ADDED","insertions":67,"deletions":0},{"file":"README.md","type":"ADDED","insertions":101,"deletions":0},{"file":"deps/javascriptlint","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/client.js","type":"ADDED","insertions":382,"deletions":0},{"file":"lib/index.js","type":"ADDED","insertions":53,"deletions":0},{"file":"lib/pg-server.js","type":"ADDED","insertions":133,"deletions":0},{"file":"lib/run.js","type":"ADDED","insertions":133,"deletions":0},{"file":"lib/sandbox.js","type":"ADDED","insertions":241,"deletions":0},{"file":"package.json","type":"ADDED","insertions":34,"deletions":0},{"file":"test/lib/log.js","type":"ADDED","insertions":21,"deletions":0},{"file":"test/unit/basic.test.js","type":"ADDED","insertions":425,"deletions":0},{"file":"test/unit/run.js","type":"ADDED","insertions":32,"deletions":0},{"file":"tools/eslint.node.conf","type":"MODIFIED","insertions":1,"deletions":0}],"sizeInsertions":1624,"sizeDeletions":-1}],"allReviewers":[{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}]}