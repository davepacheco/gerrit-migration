commit 7338ab4c1fba351e9239d157db90bf00138e73c5 (refs/changes/44/2744/1)
Author: Julien Gilli <julien.gilli@joyent.com>
Date:   2017-10-06T16:19:20-07:00 (2 years ago)
    
    VOLAPI-85 replace smartdc_role=nfsvolumestorage with triton.system_role=nfsvolumestorage

diff --git a/lib/endpoints/volumes.js b/lib/endpoints/volumes.js
index 6420dd7..2b6e680 100644
--- a/lib/endpoints/volumes.js
+++ b/lib/endpoints/volumes.js
@@ -95,7 +95,8 @@ function _buildStorageVMPayload(volumeParams, storageVmUuid, imageUuid,
         delegate_dataset: true,
         owner_uuid: volumeParams.owner_uuid,
         tags: {
-            smartdc_role: volumeUtils.NFS_SHARED_VOLUME_SMARTDC_ROLE
+            'triton.system_role':
+                volumeUtils.NFS_SHARED_VOLUME_TRITON_SYSTEM_ROLE
         }
     };
 
diff --git a/lib/volumes.js b/lib/volumes.js
index 2b7a246..4f530ff 100644
--- a/lib/volumes.js
+++ b/lib/volumes.js
@@ -13,11 +13,11 @@ var assert = require('assert-plus');
 var NFS_SHARED_VOLUME_EXPORTS_BASEDIR = '/exports';
 var NFS_SHARED_VOLUME_EXPORTS_DIRNAME = 'data';
 var NFS_SHARED_VOLUME_VM_ALIAS_PREFIX = 'nfs-shared-volume';
-var NFS_SHARED_VOLUME_SMARTDC_ROLE = 'nfsvolumestorage';
+var NFS_SHARED_VOLUME_TRITON_SYSTEM_ROLE = 'nfsvolumestorage';
 
 module.exports = {
     NFS_SHARED_VOLUME_EXPORTS_BASEDIR: NFS_SHARED_VOLUME_EXPORTS_BASEDIR,
     NFS_SHARED_VOLUME_EXPORTS_DIRNAME: NFS_SHARED_VOLUME_EXPORTS_DIRNAME,
-    NFS_SHARED_VOLUME_SMARTDC_ROLE: NFS_SHARED_VOLUME_SMARTDC_ROLE,
+    NFS_SHARED_VOLUME_TRITON_SYSTEM_ROLE: NFS_SHARED_VOLUME_TRITON_SYSTEM_ROLE,
     NFS_SHARED_VOLUME_VM_ALIAS_PREFIX: NFS_SHARED_VOLUME_VM_ALIAS_PREFIX
 };
\ No newline at end of file
diff --git a/volapi-updater.js b/volapi-updater.js
index d62e550..1aca5eb 100644
--- a/volapi-updater.js
+++ b/volapi-updater.js
@@ -554,7 +554,8 @@ function updateAllVolumesFromVmApi(vmapiClient, log, callback) {
     mod_assert.func(callback, 'callback');
 
     vmapiClient.listVms({
-        'tag.smartdc_role': mod_volumeUtils.NFS_SHARED_VOLUME_SMARTDC_ROLE
+        'tag.triton.system_role':
+            mod_volumeUtils.NFS_SHARED_VOLUME_TRITON_SYSTEM_ROLE
     }, function onGetAllVolumesVms(getVmsErr, volumeVms) {
         if (getVmsErr) {
             log.error({error: getVmsErr}, 'Error when fetching VMs');
