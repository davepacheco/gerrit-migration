From 8e5fcb4a6d3c414fdc8a98278e4c57f401366e58 Mon Sep 17 00:00:00 2001
From: Todd Whiteman <todd.whiteman@joyent.com>
Date: Wed, 6 Sep 2017 13:50:48 -0700
Subject: [PATCH] DOCKER-1097 docker pull fails for registry server that has no
 auth setup

---
 CHANGES.md                | 4 ++++
 lib/registry-client-v2.js | 4 +++-
 package.json              | 2 +-
 3 files changed, 8 insertions(+), 2 deletions(-)

diff --git a/CHANGES.md b/CHANGES.md
index f936c5d..7757280 100644
--- a/CHANGES.md
+++ b/CHANGES.md
@@ -4,6 +4,10 @@
 
 (nothing yet)
 
+## 3.2.9
+
+- DOCKER-1097 docker pull fails for registry server that has no auth setup
+
 ## 3.2.8
 
 - DOCKER-1091 Cannot login into Artifactory private docker registry. This change
diff --git a/lib/registry-client-v2.js b/lib/registry-client-v2.js
index bdb991f..2530f35 100644
--- a/lib/registry-client-v2.js
+++ b/lib/registry-client-v2.js
@@ -710,6 +710,8 @@ function ping(opts, cb) {
  *          authInfo    an object with authentication info, examples:
  *                          {type: 'basic', username: '...', password: '...'}
  *                          {type: 'bearer', token: '...'}
+ *                      which can be the empty object when no auth is needed:
+ *                          {}
  */
 function login(opts, cb) {
     assert.object(opts, 'opts');
@@ -755,7 +757,7 @@ function login(opts, cb) {
         scope: opts.scope, insecure: opts.insecure}, 'login');
 
     var scope = opts.scope || '';
-    var authInfo;
+    var authInfo = {};
     var context = {
         pingErr: opts.pingErr
     };
diff --git a/package.json b/package.json
index c3dd33d..bfad19f 100644
--- a/package.json
+++ b/package.json
@@ -1,6 +1,6 @@
 {
     "name": "docker-registry-client",
-    "version": "3.2.8",
+    "version": "3.2.9",
     "description": "node.js client for the Docker Registry API",
     "author": "Joyent (joyent.com)",
     "main": "./lib/index.js",
-- 
2.21.0

