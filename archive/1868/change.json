{"project":"joyent/illumos-joyent","branch":"master","id":"I220368cc257e84d2f21ed336b4243b8f8e1fee01","number":"1868","subject":"OS-6085 pcplusmp shouldn\u0027t support x2APIC mode Reviewed by: Robert Mustacchi \u003crm@joyent.com\u003e Reviewed by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e Approved by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e","owner":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"url":"https://cr.joyent.us/1868","commitMessage":"OS-6085 pcplusmp shouldn\u0027t support x2APIC mode\nReviewed by: Robert Mustacchi \u003crm@joyent.com\u003e\nReviewed by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e\nApproved by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e\n","createdOn":1493387821,"lastUpdated":1494233706,"open":false,"status":"MERGED","comments":[{"timestamp":1493387821,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Uploaded patch set 1."},{"timestamp":1493398772,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 1:\n\n(11 comments)\n\nSo, it seems like the net impact is that we still have the different vector options, but all the logic for the x2apic has been moved into a separate file that\u0027s not builtin into pcplsump. Is that the right summary?\n\nDid any of the logic actually change, aside from a few of the apic changes which are now consolidated?"},{"timestamp":1493399911,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1493730093,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Patch Set 1:\n\n(11 comments)\n\n\u003e (11 comments)\n \u003e \n \u003e So, it seems like the net impact is that we still have the\n \u003e different vector options, but all the logic for the x2apic has been\n \u003e moved into a separate file that\u0027s not builtin into pcplsump. Is\n \u003e that the right summary?\n \u003e \n \u003e Did any of the logic actually change, aside from a few of the apic\n \u003e changes which are now consolidated?\n\nYes, thats correct. The only real changes are in apic, which now has only panicking stubs for the few x2apic-specific functions called by the common code."},{"timestamp":1493731275,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1493731711,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Uploaded patch set 2."},{"timestamp":1493758397,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 2: Code-Review+1"},{"timestamp":1493766225,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 2: Code-Review+1"},{"timestamp":1494023413,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 2: Integration-Approval+1"},{"timestamp":1494233661,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Uploaded patch set 3: Commit message was updated."},{"timestamp":1494233678,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Patch Set 4: Patch Set 3 was rebased"},{"timestamp":1494233706,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Hans Rosenfeld"}],"currentPatchSet":{"number":"4","revision":"56f03ffa93d78b09f5d08328b97ee73234660f22","parents":["6a968985a46f0a8d77b8c029edb43dfd4a44ae66"],"ref":"refs/changes/68/1868/4","uploader":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"createdOn":1494233678,"author":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1493758397,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1493766225,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1494023413,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"SUBM","value":"1","grantedOn":1494233706,"by":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/uts/i86pc/Makefile.files","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/i86pc/apix/Makefile","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"usr/src/uts/i86pc/io/apix/apix.c","type":"MODIFIED","insertions":42,"deletions":0},{"file":"usr/src/uts/i86pc/io/apix/apix_regops.c","type":"ADDED","insertions":252,"deletions":0},{"file":"usr/src/uts/i86pc/io/pcplusmp/apic.c","type":"MODIFIED","insertions":35,"deletions":-101},{"file":"usr/src/uts/i86pc/io/pcplusmp/apic_common.c","type":"MODIFIED","insertions":1,"deletions":-42},{"file":"usr/src/uts/i86pc/io/pcplusmp/apic_regops.c","type":"MODIFIED","insertions":3,"deletions":-198},{"file":"usr/src/uts/i86pc/sys/apic.h","type":"MODIFIED","insertions":5,"deletions":-1}],"sizeInsertions":343,"sizeDeletions":-347},"patchSets":[{"number":"1","revision":"b87ef77c83ade6a56d4b2f0ec95ee3beb7455c31","parents":["ce33465b99b9a4811a15724b9822c0531560d2b5"],"ref":"refs/changes/68/1868/1","uploader":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"createdOn":1493387821,"author":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/uts/i86pc/io/apix/apix.c","line":2555,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Was this just copied and pasted from somewhere else? If so, may not be worth fixing up the comment based on the notes below."},{"file":"usr/src/uts/i86pc/io/apix/apix.c","line":2555,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"This was moved from apic_common.c as it\u0027s no longer common. I think cleaning it up isn\u0027t a bad idea."},{"file":"usr/src/uts/i86pc/io/apix/apix.c","line":2556,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"\u0027an IPI\u0027?"},{"file":"usr/src/uts/i86pc/io/apix/apix.c","line":2556,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Same as previous."},{"file":"usr/src/uts/i86pc/io/apix/apix.c","line":2556,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Maybe \u0027The CPU\u0027?"},{"file":"usr/src/uts/i86pc/io/apix/apix.c","line":2556,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Done"},{"file":"usr/src/uts/i86pc/io/apix/apix.c","line":2556,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Done"},{"file":"usr/src/uts/i86pc/io/apix/apix.c","line":2556,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Done"},{"file":"usr/src/uts/i86pc/io/apix/apix.c","line":2557,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Missing verb? Maybe we\u0027re saying \u0027it still needs to use the xAPIC method.\u0027?"},{"file":"usr/src/uts/i86pc/io/apix/apix.c","line":2557,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Done"},{"file":"usr/src/uts/i86pc/io/apix/apix.c","line":2558,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"\u0027a StartIPI to the target CPU\u0027?"},{"file":"usr/src/uts/i86pc/io/apix/apix.c","line":2558,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Done"},{"file":"usr/src/uts/i86pc/io/apix/apix.c","line":2559,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"\u0027uses the right\u0027"},{"file":"usr/src/uts/i86pc/io/apix/apix.c","line":2559,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Done"},{"file":"usr/src/uts/i86pc/io/apix/apix.c","line":2560,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"\u0027an IPI\u0027?"},{"file":"usr/src/uts/i86pc/io/apix/apix.c","line":2560,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Done"},{"file":"usr/src/uts/i86pc/io/apix/apix_regops.c","line":0,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Was this file changed at all beyond being moved from apic_regops.c?"},{"file":"usr/src/uts/i86pc/io/apix/apix_regops.c","line":0,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"A few cosmetic changes in the comment, but nothing functional."},{"file":"usr/src/uts/i86pc/io/pcplusmp/apic_regops.c","line":0,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"It looks like this file is also used by the xpv kernel. How do the changes here impact it?"},{"file":"usr/src/uts/i86pc/io/pcplusmp/apic_regops.c","line":0,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Shouldn\u0027t be impacted at all. xpv_psm only supports apic, not x2apic, and all access to apic_regops.c functions/variables are made through mp_platform_common.c., which is the same in all three.\n\nI have of course not at all tested xpv beyond building it."},{"file":"usr/src/uts/i86pc/io/pcplusmp/apic_regops.c","line":181,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"This is now in \u003csys/apic.h\u003e. Is there any reason this is needed here?"},{"file":"usr/src/uts/i86pc/io/pcplusmp/apic_regops.c","line":181,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"None, removed."},{"file":"usr/src/uts/i86pc/sys/apic.h","line":24,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Any erason this was deleted?"},{"file":"usr/src/uts/i86pc/sys/apic.h","line":24,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"No reason other than that I found that extra empty line irritating."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/i86pc/Makefile.files","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/i86pc/apix/Makefile","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"usr/src/uts/i86pc/io/apix/apix.c","type":"MODIFIED","insertions":42,"deletions":0},{"file":"usr/src/uts/i86pc/io/apix/apix_regops.c","type":"ADDED","insertions":252,"deletions":0},{"file":"usr/src/uts/i86pc/io/pcplusmp/apic.c","type":"MODIFIED","insertions":35,"deletions":-101},{"file":"usr/src/uts/i86pc/io/pcplusmp/apic_common.c","type":"MODIFIED","insertions":1,"deletions":-42},{"file":"usr/src/uts/i86pc/io/pcplusmp/apic_regops.c","type":"MODIFIED","insertions":4,"deletions":-198},{"file":"usr/src/uts/i86pc/sys/apic.h","type":"MODIFIED","insertions":5,"deletions":-1}],"sizeInsertions":344,"sizeDeletions":-347},{"number":"2","revision":"fb56850d473ac7d4847f9c03b065346244700361","parents":["4137db003c878138f3b24f60b9dab4835ce46dd6"],"ref":"refs/changes/68/1868/2","uploader":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"createdOn":1493731711,"author":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1493758397,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1493766225,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1494023413,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/i86pc/Makefile.files","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/i86pc/apix/Makefile","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"usr/src/uts/i86pc/io/apix/apix.c","type":"MODIFIED","insertions":42,"deletions":0},{"file":"usr/src/uts/i86pc/io/apix/apix_regops.c","type":"ADDED","insertions":252,"deletions":0},{"file":"usr/src/uts/i86pc/io/pcplusmp/apic.c","type":"MODIFIED","insertions":35,"deletions":-101},{"file":"usr/src/uts/i86pc/io/pcplusmp/apic_common.c","type":"MODIFIED","insertions":1,"deletions":-42},{"file":"usr/src/uts/i86pc/io/pcplusmp/apic_regops.c","type":"MODIFIED","insertions":3,"deletions":-198},{"file":"usr/src/uts/i86pc/sys/apic.h","type":"MODIFIED","insertions":5,"deletions":-1}],"sizeInsertions":343,"sizeDeletions":-347},{"number":"3","revision":"220368cc257e84d2f21ed336b4243b8f8e1fee01","parents":["4137db003c878138f3b24f60b9dab4835ce46dd6"],"ref":"refs/changes/68/1868/3","uploader":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"createdOn":1494233661,"author":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1493758397,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1493766225,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1494023413,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/uts/i86pc/Makefile.files","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/i86pc/apix/Makefile","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"usr/src/uts/i86pc/io/apix/apix.c","type":"MODIFIED","insertions":42,"deletions":0},{"file":"usr/src/uts/i86pc/io/apix/apix_regops.c","type":"ADDED","insertions":252,"deletions":0},{"file":"usr/src/uts/i86pc/io/pcplusmp/apic.c","type":"MODIFIED","insertions":35,"deletions":-101},{"file":"usr/src/uts/i86pc/io/pcplusmp/apic_common.c","type":"MODIFIED","insertions":1,"deletions":-42},{"file":"usr/src/uts/i86pc/io/pcplusmp/apic_regops.c","type":"MODIFIED","insertions":3,"deletions":-198},{"file":"usr/src/uts/i86pc/sys/apic.h","type":"MODIFIED","insertions":5,"deletions":-1}],"sizeInsertions":343,"sizeDeletions":-347},{"number":"4","revision":"56f03ffa93d78b09f5d08328b97ee73234660f22","parents":["6a968985a46f0a8d77b8c029edb43dfd4a44ae66"],"ref":"refs/changes/68/1868/4","uploader":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"createdOn":1494233678,"author":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1493758397,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1493766225,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1494023413,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"SUBM","value":"1","grantedOn":1494233706,"by":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/uts/i86pc/Makefile.files","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/i86pc/apix/Makefile","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"usr/src/uts/i86pc/io/apix/apix.c","type":"MODIFIED","insertions":42,"deletions":0},{"file":"usr/src/uts/i86pc/io/apix/apix_regops.c","type":"ADDED","insertions":252,"deletions":0},{"file":"usr/src/uts/i86pc/io/pcplusmp/apic.c","type":"MODIFIED","insertions":35,"deletions":-101},{"file":"usr/src/uts/i86pc/io/pcplusmp/apic_common.c","type":"MODIFIED","insertions":1,"deletions":-42},{"file":"usr/src/uts/i86pc/io/pcplusmp/apic_regops.c","type":"MODIFIED","insertions":3,"deletions":-198},{"file":"usr/src/uts/i86pc/sys/apic.h","type":"MODIFIED","insertions":5,"deletions":-1}],"sizeInsertions":343,"sizeDeletions":-347}],"allReviewers":[{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"}]}