From fbcd05b305677e963e21164df65f7fb50a396d7f Mon Sep 17 00:00:00 2001
From: Trent Mick <trent.mick@joyent.com>
Date: Tue, 1 Nov 2016 15:52:28 -0700
Subject: [PATCH] joyent/node-manta#279 mjob should expressly list out allowed
 sizes for memory

---
 CHANGES.md   |  6 ++++++
 bin/mjob     | 39 +++++++++++++++++++++++----------------
 package.json |  2 +-
 3 files changed, 30 insertions(+), 17 deletions(-)

diff --git a/CHANGES.md b/CHANGES.md
index a1a936b..b9ae177 100644
--- a/CHANGES.md
+++ b/CHANGES.md
@@ -2,6 +2,12 @@
 
 ## not yet released
 
+(nothing yet)
+
+## 3.1.4
+
+- joyent/node-manta#279 Improvements to "mjob create -h" help output.
+
 ## 3.1.3
 
 - joyent/node-manta#277 mjob fails with "mjob: AssertionError: body (object) is required"
diff --git a/bin/mjob b/bin/mjob
index d08dfa7..3f8cb9f 100755
--- a/bin/mjob
+++ b/bin/mjob
@@ -765,13 +765,13 @@ MJob.prototype.do_create.options = manta.DEFAULT_CLI_OPTIONS.concat([
     {
         names: ['disk'],
         type: 'positiveInteger',
-        help: 'amount of disk space available for all phases (gigabytes)',
+        help: 'amount of disk space available for the next phase (gigabytes)',
         helpArg: 'DISK_GB'
     },
     {
         names: ['memory'],
         type: 'positiveInteger',
-        help: 'amount of memory available for all phases (megabytes)',
+        help: 'amount of memory available for the next phase (megabytes)',
         helpArg: 'MEMORY_MB'
     },
     {
@@ -842,22 +842,29 @@ MJob.prototype.do_create.options = manta.DEFAULT_CLI_OPTIONS.concat([
     }
 ]);
 
-MJob.prototype.do_create.help = (
+MJob.prototype.do_create.help = [
     /* BEGIN JSSTYLED */
-    'Creates a Manta Job.\n' +
-        'You can create a job, feed inputs and wait for completion like this:\n' +
-        'Example:\n' +
-        '    mfind -t o /user/stor | mjob create "grep foo || true" ^^ cat\n' +
-        '\n' +
-        'Usage:\n' +
-        '     mjob create [OPTIONS] [map [^ map] [^^ reduce]]\n' +
-        '\n' +
-        '{{options}}\n' +
-        'The --asset, --count, --disk, --image, --init, and â€”-memory ' +
-        'options all\n' +
-        'apply to the next phase specified with --map or --reduce.'
+    'Creates a Manta Job.',
+    '',
+    'Usage:',
+    '    mjob create [OPTIONS] [map [^ map] [^^ reduce]]',
+    '',
+    '{{options}}',
+    'Map and reduce phases can be specified via -m,--map and -r,--reduce:',
+    '    mjob create -m "grep foo || true" -m "cut -d: -f1" -r cat',
+    'or via the "^" and "^^" syntax:',
+    '    mjob create "grep foo || true" ^ "cut -d: -f1" ^^ cat',
+    '',
+    'Input objects can be fed to a Manta job via stdin to `mjob create`:',
+    '    mfind -t o /user/stor | mjob create -m "grep foo || true" -r cat',
+    'or via `mjob addinputs`.',
+    '',
+    'The --asset, --count, --disk, --image, --init, and --memory options all',
+    'apply to the next phase specified with -m,--map or -r,--reduce. Supported',
+    'values for --disk and --memory are described at',
+    'https://apidocs.joyent.com/manta/jobs-reference.html#resource-usage-memory-and-disk-properties'
     /* END JSSTYLED */
-);
+].join('\n');
 
 
 //-- GetJob
diff --git a/package.json b/package.json
index 85df63c..e2ef9cd 100644
--- a/package.json
+++ b/package.json
@@ -7,7 +7,7 @@
         "type": "git",
         "url": "git://github.com/joyent/node-manta.git"
     },
-    "version": "3.1.3",
+    "version": "3.1.4",
     "main": "./lib/index.js",
     "dependencies": {
         "assert-plus": "^1.0.0",
-- 
2.21.0

