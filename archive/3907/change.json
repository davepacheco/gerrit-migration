{"project":"joyent/illumos-joyent","branch":"master","id":"I59e2e8a00ad00a43a42231ef1e3a8ada027da9a1","number":"3907","subject":"OS-6928 recursive mutex in pci_xhci Reviewed by: John Levon \u003cjohn.levon@joyent.com\u003e Reviewed by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e Approved by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e","owner":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"url":"https://cr.joyent.us/3907","commitMessage":"OS-6928 recursive mutex in pci_xhci\nReviewed by: John Levon \u003cjohn.levon@joyent.com\u003e\nReviewed by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e\nApproved by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e\n","createdOn":1525405590,"lastUpdated":1525827683,"open":false,"status":"MERGED","comments":[{"timestamp":1525405590,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Uploaded patch set 1."},{"timestamp":1525793619,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Uploaded patch set 2."},{"timestamp":1525794190,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1525794746,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 2:\n\nI would like to see an explanatory comment in at least on of the locations so \"future us\" will have more context about why the difference is present."},{"timestamp":1525802936,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Uploaded patch set 3."},{"timestamp":1525803333,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1525803517,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 3:\n\n(1 comment)"},{"timestamp":1525803836,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Uploaded patch set 4."},{"timestamp":1525804048,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 3:\n\n(2 comments)"},{"timestamp":1525804612,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 4: Code-Review+1\n\n(1 comment)"},{"timestamp":1525804715,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 4: Code-Review+1"},{"timestamp":1525805761,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 4:\n\nRepeated the testing described in the ticket with the final code.  All is well."},{"timestamp":1525824186,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 4: Integration-Approval+1"},{"timestamp":1525827641,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 5: Commit message was updated."},{"timestamp":1525827654,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 6: Patch Set 5 was rebased"},{"timestamp":1525827683,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Mike Gerdts"}],"currentPatchSet":{"number":"6","revision":"db9746572d6692af88b9f55827fcb63f1bcb3c46","parents":["cd2e7e66ffa1c4b5f8d136fb0913699fbac5c6d8"],"ref":"refs/changes/07/3907/6","uploader":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"createdOn":1525827654,"author":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1525804612,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1525804715,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1525824186,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"SUBM","value":"1","grantedOn":1525827683,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/cmd/bhyve/pci_xhci.c","type":"MODIFIED","insertions":18,"deletions":-1},{"file":"usr/src/cmd/bhyve/usb_emul.h","type":"MODIFIED","insertions":7,"deletions":-1}],"sizeInsertions":25,"sizeDeletions":-2},"patchSets":[{"number":"1","revision":"5bc6922be3074d62fc1d3b2a7a549193a389f389","parents":["77b57dc55fffa7007fdcbac3f84f00c7211e2754"],"ref":"refs/changes/07/3907/1","uploader":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"createdOn":1525405590,"author":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/bhyve/pci_xhci.c","type":"MODIFIED","insertions":2,"deletions":-4}],"sizeInsertions":2,"sizeDeletions":-4},{"number":"2","revision":"118bb08e7bfbcf35da14b4e18b4b964ac8e64332","parents":["77b57dc55fffa7007fdcbac3f84f00c7211e2754"],"ref":"refs/changes/07/3907/2","uploader":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"createdOn":1525793619,"author":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/cmd/bhyve/pci_xhci.c","line":1664,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Can we assert the mutex is held instead?"},{"file":"usr/src/cmd/bhyve/pci_xhci.c","line":1664,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/bhyve/pci_xhci.c","type":"MODIFIED","insertions":10,"deletions":-1}],"sizeInsertions":10,"sizeDeletions":-1},{"number":"3","revision":"089ab8fd305741888f2065816c87a8987d3104f3","parents":["77b57dc55fffa7007fdcbac3f84f00c7211e2754"],"ref":"refs/changes/07/3907/3","uploader":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"createdOn":1525802936,"author":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1525803333,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"comments":[{"file":"usr/src/cmd/bhyve/pci_xhci.c","line":1669,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"I would just focus on explaining the lock recursion itself and not any of the political situation.  (Also, toss it inside the #else block)"},{"file":"usr/src/cmd/bhyve/pci_xhci.c","line":1669,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/bhyve/pci_xhci.c","type":"MODIFIED","insertions":18,"deletions":-1},{"file":"usr/src/cmd/bhyve/usb_emul.h","type":"MODIFIED","insertions":7,"deletions":-1}],"sizeInsertions":25,"sizeDeletions":-2},{"number":"4","revision":"59e2e8a00ad00a43a42231ef1e3a8ada027da9a1","parents":["77b57dc55fffa7007fdcbac3f84f00c7211e2754"],"ref":"refs/changes/07/3907/4","uploader":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"createdOn":1525803836,"author":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1525804612,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1525824186,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1525804715,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"comments":[{"file":"usr/src/cmd/bhyve/pci_xhci.c","line":1672,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Thanks.  I should have been clearer when asking for a comment here."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/bhyve/pci_xhci.c","type":"MODIFIED","insertions":18,"deletions":-1},{"file":"usr/src/cmd/bhyve/usb_emul.h","type":"MODIFIED","insertions":7,"deletions":-1}],"sizeInsertions":25,"sizeDeletions":-2},{"number":"5","revision":"197a56a527bc597830dae5c97c3ea8361249da92","parents":["77b57dc55fffa7007fdcbac3f84f00c7211e2754"],"ref":"refs/changes/07/3907/5","uploader":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"createdOn":1525827641,"author":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1525804612,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1525824186,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1525804715,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/cmd/bhyve/pci_xhci.c","type":"MODIFIED","insertions":18,"deletions":-1},{"file":"usr/src/cmd/bhyve/usb_emul.h","type":"MODIFIED","insertions":7,"deletions":-1}],"sizeInsertions":25,"sizeDeletions":-2},{"number":"6","revision":"db9746572d6692af88b9f55827fcb63f1bcb3c46","parents":["cd2e7e66ffa1c4b5f8d136fb0913699fbac5c6d8"],"ref":"refs/changes/07/3907/6","uploader":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"createdOn":1525827654,"author":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1525804612,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1525824186,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"SUBM","value":"1","grantedOn":1525827683,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1525804715,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/cmd/bhyve/pci_xhci.c","type":"MODIFIED","insertions":18,"deletions":-1},{"file":"usr/src/cmd/bhyve/usb_emul.h","type":"MODIFIED","insertions":7,"deletions":-1}],"sizeInsertions":25,"sizeDeletions":-2}],"allReviewers":[{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}]}