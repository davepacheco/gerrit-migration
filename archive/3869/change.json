{"project":"joyent/sdcadm","branch":"master","id":"Ia968cbeede4bff9f4c2b3f3603d029f2db13b929","number":"3869","subject":"TOOLS-1977 Modify `sdcadm post-setup ha-binder` to move insts to different servers Reviewed by: Marsell Kukuljevic \u003cmarsell@joyent.com\u003e Approved by: Marsell Kukuljevic \u003cmarsell@joyent.com\u003e","owner":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"url":"https://cr.joyent.us/3869","commitMessage":"TOOLS-1977 Modify `sdcadm post-setup ha-binder` to move insts to different servers\nReviewed by: Marsell Kukuljevic \u003cmarsell@joyent.com\u003e\nApproved by: Marsell Kukuljevic \u003cmarsell@joyent.com\u003e\n","createdOn":1524668059,"lastUpdated":1526636262,"open":false,"status":"MERGED","comments":[{"timestamp":1524668059,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 1."},{"timestamp":1524668065,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit 4cb78373897e8cae988304ef8959db1b8ef5b986\n    \n    TOOLS-1977 Modify `sdcadm post-setup ha-binder` to move insts to different servers"},{"timestamp":1524668095,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1524668121,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 2: Patch Set 1 was rebased."},{"timestamp":1524668126,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit cd1579bbcca0e1d8d3827f2f1bfc2d1991698b4a\n    \n    TOOLS-1977 Modify `sdcadm post-setup ha-binder` to move insts to different servers"},{"timestamp":1524668155,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2:\n\n\"make check\" passed ok"},{"timestamp":1524751825,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 3: Patch Set 2 was rebased."},{"timestamp":1524751832,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 3:\n\nNew commits:\n    \n    commit 6d0a7db12879c3cf5bf6ee2fcbae37d22e0ad8f0\n    \n    TOOLS-1977 Modify `sdcadm post-setup ha-binder` to move insts to different servers"},{"timestamp":1524751862,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3:\n\n\"make check\" passed ok"},{"timestamp":1525357543,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 4: Patch Set 3 was rebased."},{"timestamp":1525357548,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 4:\n\nNew commits:\n    \n    commit 5ff77ed0cd19d6da8f3cf7d1b646f94a02848a0a\n    \n    TOOLS-1977 Modify `sdcadm post-setup ha-binder` to move insts to different servers"},{"timestamp":1525357580,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4:\n\n\"make check\" passed ok"},{"timestamp":1525781770,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 4:\n\n(38 comments)\n\nThis isn\u0027t my final CR, but it\u0027s probably better I don\u0027t sit on it until it\u0027s all perfect. :p\n\nI\u0027ll take another round in a day or two."},{"timestamp":1525862290,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 4:\n\n(8 comments)"},{"timestamp":1525964690,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 5."},{"timestamp":1525964695,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 5:\n\nNew commits:\n    \n    commit cca3783504a6266857b8c0187b692d1ae00bf299\n    \n    TOOLS-1977 Modify `sdcadm post-setup ha-binder` to move insts to different servers"},{"timestamp":1525964726,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1525964797,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 4:\n\n(44 comments)\n\nDone with pretty much all your suggestions Marsell. Would appreciate another pass. Note I still need to update the man page, which I plan to do once we\u0027re set with everything else, just in case we change minds regarding some of the involved steps. Also, note I\u0027ve added a bunch of tests :-)"},{"timestamp":1526038434,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 5:\n\n(12 comments)"},{"timestamp":1526489537,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 6."},{"timestamp":1526489542,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 6:\n\nNew commits:\n    \n    commit 63e44c4f24e11fafa3904b427c819ff9ebb707fc\n    \n    TOOLS-1977 Modify `sdcadm post-setup ha-binder` to move insts to different servers"},{"timestamp":1526489573,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 6: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1526489775,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 7."},{"timestamp":1526489781,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 7:\n\nNew commits:\n    \n    commit 757fd54a75d228f89650607995783356b4e91949\n    \n    TOOLS-1977 Modify `sdcadm post-setup ha-binder` to move insts to different servers"},{"timestamp":1526489811,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 7: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1526490184,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 8."},{"timestamp":1526490190,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 8:\n\nNew commits:\n    \n    commit ae2dafc67b28328435ec9282bdaa29075423454a\n    \n    TOOLS-1977 Modify `sdcadm post-setup ha-binder` to move insts to different servers"},{"timestamp":1526490217,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 8:\n\n(9 comments)\n\nApplied suggested changes + updated docs, man page, bumped package version ... !!!"},{"timestamp":1526490220,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 8: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1526522275,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 8:\n\n(7 comments)\n\nLGTM, except for that one small \"ch.inst \u0026\u0026 ch.instance.instance\" bug I stumbled across."},{"timestamp":1526549244,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 9."},{"timestamp":1526549250,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 9:\n\nNew commits:\n    \n    commit 18ebe0a9fb7a0aafce8e3b5de4e361ade47266d5\n    \n    TOOLS-1977 Modify `sdcadm post-setup ha-binder` to move insts to different servers"},{"timestamp":1526549282,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 9: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1526550129,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 9:\n\n(7 comments)\n\nDone Marsell. Time for another pass?"},{"timestamp":1526557559,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 9:\n\n(1 comment)"},{"timestamp":1526566284,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 10."},{"timestamp":1526566290,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 10:\n\nNew commits:\n    \n    commit 2900367b880b43e1802d2a58f14a8a57cfff56c7\n    \n    TOOLS-1977 Modify `sdcadm post-setup ha-binder` to move insts to different servers"},{"timestamp":1526566322,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 10: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1526566396,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 8:\n\n(1 comment)\n\nYou\u0027re right!"},{"timestamp":1526591154,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 10: Code-Review+1 Integration-Approval+1"},{"timestamp":1526636230,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 11: Commit message was updated."},{"timestamp":1526636262,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Pedro Palazón Candel"}],"currentPatchSet":{"number":"11","revision":"a968cbeede4bff9f4c2b3f3603d029f2db13b929","parents":["3db0cb4107a7c609e3614bd448fec321916fafa7"],"ref":"refs/changes/69/3869/11","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1526636230,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1526566322,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1526591154,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1526591154,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}},{"type":"SUBM","value":"1","grantedOn":1526636262,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":".eslintrc","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"CHANGES.md","type":"MODIFIED","insertions":5,"deletions":0},{"file":"docs/post-setup.md","type":"MODIFIED","insertions":3,"deletions":-5},{"file":"lib/cli/do_create.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/common.js","type":"MODIFIED","insertions":66,"deletions":-31},{"file":"lib/post-setup/ha-binder.js","type":"MODIFIED","insertions":389,"deletions":-899},{"file":"lib/procedures/create-service-instance-v1.js","type":"MODIFIED","insertions":23,"deletions":-22},{"file":"lib/procedures/shared.js","type":"MODIFIED","insertions":93,"deletions":-24},{"file":"lib/sdcadm.js","type":"MODIFIED","insertions":31,"deletions":-26},{"file":"lib/steps/index.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/steps/zookeeper.js","type":"ADDED","insertions":790,"deletions":0},{"file":"lib/vmadm.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"man/man1/sdcadm.1.ronn","type":"MODIFIED","insertions":49,"deletions":-17},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/post-setup-ha-binder.test.js","type":"ADDED","insertions":230,"deletions":0},{"file":"test/post-setup.test.js","type":"MODIFIED","insertions":0,"deletions":-44}],"sizeInsertions":1686,"sizeDeletions":-1073},"patchSets":[{"number":"1","revision":"07dde87c822b71200c20445e0f19cc34ee85181a","parents":["fb179c09ff4131e781cdbdd372496f44db462ca0"],"ref":"refs/changes/69/3869/1","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1524668059,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1524668095,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/cli/do_create.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/post-setup/ha-binder.js","type":"MODIFIED","insertions":379,"deletions":-898},{"file":"lib/procedures/create-service-instance-v1.js","type":"MODIFIED","insertions":17,"deletions":-21},{"file":"lib/procedures/shared.js","type":"MODIFIED","insertions":37,"deletions":-2},{"file":"lib/steps/index.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/steps/zookeeper.js","type":"ADDED","insertions":824,"deletions":0}],"sizeInsertions":1260,"sizeDeletions":-923},{"number":"2","revision":"bfe4fec6da32e983a9d9c700b3dc07293345d97c","parents":["1ad282c7141bdb6fe13a2cd03264dc9e77997226"],"ref":"refs/changes/69/3869/2","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1524668121,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1524668095,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/cli/do_create.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/post-setup/ha-binder.js","type":"MODIFIED","insertions":379,"deletions":-898},{"file":"lib/procedures/create-service-instance-v1.js","type":"MODIFIED","insertions":17,"deletions":-21},{"file":"lib/procedures/shared.js","type":"MODIFIED","insertions":37,"deletions":-2},{"file":"lib/steps/index.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/steps/zookeeper.js","type":"ADDED","insertions":824,"deletions":0}],"sizeInsertions":1260,"sizeDeletions":-923},{"number":"3","revision":"5736739d8e2278c5ef036d3df8bf5fc610ac4fff","parents":["d6fa013c245ceb9c11155238f76705205097a704"],"ref":"refs/changes/69/3869/3","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1524751825,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1524668095,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/cli/do_create.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/post-setup/ha-binder.js","type":"MODIFIED","insertions":379,"deletions":-898},{"file":"lib/procedures/create-service-instance-v1.js","type":"MODIFIED","insertions":17,"deletions":-21},{"file":"lib/procedures/shared.js","type":"MODIFIED","insertions":37,"deletions":-2},{"file":"lib/steps/index.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/steps/zookeeper.js","type":"ADDED","insertions":824,"deletions":0}],"sizeInsertions":1260,"sizeDeletions":-923},{"number":"4","revision":"1df5987188bbb484f0dcab9d111ef628a31b8d9d","parents":["f2bf9bb71062b09fcbf05034c1ef768358696cbc"],"ref":"refs/changes/69/3869/4","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1525357543,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1524668095,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/cli/do_create.js","line":8,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Eh. This is the only change in the file?"},{"file":"lib/cli/do_create.js","line":8,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Yeah. There were more changes. Then we changed mind and modified the original design so there\u0027s no need to modify this file at all. Anyway, Copyright can be safely updated to current year ;)"},{"file":"lib/post-setup/ha-binder.js","line":73,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"I think the logic would be clearer like this:\n\nvar aLen \u003d args.length;\nif (!opts.servers \u0026\u0026 aLen !\u003d\u003d 1 \u0026\u0026 aLen !\u003d\u003d 3 \u0026\u0026 aLen !\u003d\u003d 5) {\n    cb(...);\n    next;\n}"},{"file":"lib/post-setup/ha-binder.js","line":73,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/post-setup/ha-binder.js","line":82,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Does this not fit on the previous line?"},{"file":"lib/post-setup/ha-binder.js","line":82,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/post-setup/ha-binder.js","line":99,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"If existingVmsUUIDs contains \"UUID\" (a fine idea!), why not targetServerUUIDs too? Could even call it unvalidatedTargetServerUUIDs, heh."},{"file":"lib/post-setup/ha-binder.js","line":99,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Good call on the `targetServerUUIDs`. Will not add \"unvalidated\" b/c those get validated along the way."},{"file":"lib/post-setup/ha-binder.js","line":104,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"on"},{"file":"lib/post-setup/ha-binder.js","line":104,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/post-setup/ha-binder.js","line":177,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"This is unfortunate. I\u0027m glad --servers is deprecated, so we can get rid of it eventually."},{"file":"lib/post-setup/ha-binder.js","line":177,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"We need to preload them any way in order to allow passing a hostname instead of a UUID through the command line"},{"file":"lib/post-setup/ha-binder.js","line":177,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Sad panda."},{"file":"lib/post-setup/ha-binder.js","line":194,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"on"},{"file":"lib/post-setup/ha-binder.js","line":194,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/post-setup/ha-binder.js","line":196,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"name"},{"file":"lib/post-setup/ha-binder.js","line":196,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/post-setup/ha-binder.js","line":221,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"name"},{"file":"lib/post-setup/ha-binder.js","line":221,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/post-setup/ha-binder.js","line":224,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Don\u0027t really need an else here. Saves one level of indentation."},{"file":"lib/post-setup/ha-binder.js","line":224,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/post-setup/ha-binder.js","line":225,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"name"},{"file":"lib/post-setup/ha-binder.js","line":225,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/post-setup/ha-binder.js","line":226,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"This is the same as \"server.hostname \u003d\u003d\u003d s\""},{"file":"lib/post-setup/ha-binder.js","line":226,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/procedures/create-service-instance-v1.js","line":77,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Since you\u0027re here, might as well name the func."},{"file":"lib/procedures/create-service-instance-v1.js","line":77,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/procedures/create-service-instance-v1.js","line":99,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Maybe add a comment here? I had no idea what this is for. :|"},{"file":"lib/procedures/create-service-instance-v1.js","line":99,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/procedures/create-service-instance-v1.js","line":116,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"I can guess what this does, but methinks a comment here too would help."},{"file":"lib/procedures/create-service-instance-v1.js","line":116,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/procedures/shared.js","line":715,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Niiiiice. :D\n\nMaybe toss in an assert.func(next, \u0027next\u0027) too."},{"file":"lib/procedures/shared.js","line":715,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/procedures/shared.js","line":777,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"This has enough going on that it could use a name."},{"file":"lib/procedures/shared.js","line":777,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/steps/zookeeper.js","line":30,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"replaying"},{"file":"lib/steps/zookeeper.js","line":30,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/steps/zookeeper.js","line":96,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"name"},{"file":"lib/steps/zookeeper.js","line":96,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/steps/zookeeper.js","line":103,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"name"},{"file":"lib/steps/zookeeper.js","line":103,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/steps/zookeeper.js","line":118,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"This totally belongs in common.js. It\u0027s used twice in sdcadm.js too.\n\nIt\u0027s also the only usage of sprintf() in this file."},{"file":"lib/steps/zookeeper.js","line":118,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/steps/zookeeper.js","line":137,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Given how often \"ctx.binderVms[0]\" is used, a \"ctx.binderVm\" might be in order. Or even a \"ctx.binderServerUuid\" and \"ctx.binderUuid\"."},{"file":"lib/steps/zookeeper.js","line":137,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/steps/zookeeper.js","line":144,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"typo"},{"file":"lib/steps/zookeeper.js","line":144,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Uh, this isn\u0027t a typo. Ignore."},{"file":"lib/steps/zookeeper.js","line":144,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/steps/zookeeper.js","line":144,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Haha. :)"},{"file":"lib/steps/zookeeper.js","line":169,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Typo"},{"file":"lib/steps/zookeeper.js","line":169,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/steps/zookeeper.js","line":171,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"If there is any err in backupZookeeperData(), then ZK is left disabled. Is this okay?"},{"file":"lib/steps/zookeeper.js","line":171,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Well, let\u0027s say it\u0027s normal that if this procedure fails at any point, operators will notice and, at a minimum, will run `sdcadm health`. There are so many failure points that I\u0027m not sure we could recover from all of them. Anyway, I\u0027ll think about this one again and see if I can figure out a way to recover from such issue. Not a bad idea."},{"file":"lib/steps/zookeeper.js","line":202,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"name"},{"file":"lib/steps/zookeeper.js","line":202,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/steps/zookeeper.js","line":226,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"There are two copies of this in the file. Move them into a single helper function."},{"file":"lib/steps/zookeeper.js","line":226,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/steps/zookeeper.js","line":268,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"in VM"},{"file":"lib/steps/zookeeper.js","line":268,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/steps/zookeeper.js","line":275,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"This almost identical to disableZkForBakup above. I think a helper function here too?"},{"file":"lib/steps/zookeeper.js","line":277,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"from"},{"file":"lib/steps/zookeeper.js","line":277,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/steps/zookeeper.js","line":298,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"This pattern shows up four times in this file. Other than the progress() message and the cmd, they\u0027re nearly identical."},{"file":"lib/steps/zookeeper.js","line":298,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/steps/zookeeper.js","line":303,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Given that this is where many errors could occur, I think it should run before disableZk(). It\u0027ll also reduce downtime.\n\nI also think a more recoverable approach would be handy. Instead of doing a rf -rf in removeZkDataFromInst(), how about renaming the original directory? Only do an rm -rf of the renamed original once ZK has been reenabled with the new data."},{"file":"lib/steps/zookeeper.js","line":303,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"We don\u0027t care about downtime for new instances. Indeed, those should remain down if anything fails. Actually, we only care of downtime for the zk leader (and any existing instances), new instances are dangerous if added to DNS with the incorrect zookeeper data on them."},{"file":"lib/steps/zookeeper.js","line":325,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"name"},{"file":"lib/steps/zookeeper.js","line":325,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/steps/zookeeper.js","line":352,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Methinks that untar should be to a different directory\n\nSuggestion:\n\nCopy tarball to instance.\nUntar tarball to new timestamped directory in /zookeeper/zookeeper\nDisable ZK service\nRename /zookeeper/zookeeper/version-2 to something else\nRename the untarballed directory to version-2\nRestart ZK service\nDelete the renamed original directory\n\nIs there any risk of new zookeepers chatting with old zookeepers before they\u0027ve all been updated (that would be confusing)?"},{"file":"lib/steps/zookeeper.js","line":352,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Well, I already went through the path you suggested and had problems with zookeeper instances. Given the only way we want a zookeeper instance to proceed is using the data from the tarball and the previous data isn\u0027t of any value, I\u0027d rather got rid of it straight. The problem is not between the zk instances, it would be if manatee reaches the wrong zk instance without the proper history."},{"file":"lib/steps/zookeeper.js","line":387,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Almost identical to enableZkAfterBakup. Make a helper func?"},{"file":"lib/steps/zookeeper.js","line":387,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"I don\u0027t think it\u0027s worth another helper function. enableRemoteSvc is pretty much that."},{"file":"lib/steps/zookeeper.js","line":410,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Could \u0027rm /zookeeper/zookeeper/zookeeper-\u0027 + opts.stamp + \u0027.tgz\u0027"},{"file":"lib/steps/zookeeper.js","line":410,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/steps/zookeeper.js","line":533,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"name"},{"file":"lib/steps/zookeeper.js","line":533,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/steps/zookeeper.js","line":541,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"definitely name!"},{"file":"lib/steps/zookeeper.js","line":541,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/steps/zookeeper.js","line":548,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"I think this would be a tad clearer if you assigned to vars \"primary\", \"sync\" and \"async\" first."},{"file":"lib/steps/zookeeper.js","line":548,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/steps/zookeeper.js","line":564,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"name"},{"file":"lib/steps/zookeeper.js","line":564,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/steps/zookeeper.js","line":615,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"name"},{"file":"lib/steps/zookeeper.js","line":615,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/steps/zookeeper.js","line":627,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Can original ZK instances ever have this attribute already set?"},{"file":"lib/steps/zookeeper.js","line":627,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Yeah, but we\u0027re overriding it completely since we\u0027re rebuilding the HA_ZK_JSON array from scratch."},{"file":"lib/steps/zookeeper.js","line":782,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"in"},{"file":"lib/steps/zookeeper.js","line":782,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/steps/zookeeper.js","line":790,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Where are the Manatees first frozen? Or does Manatee start up frozen?"},{"file":"lib/steps/zookeeper.js","line":790,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Those are frozen from ha-binder. It wouldn\u0027t hurt to retry unfreezing it, b/c it will just go ahead if it\u0027s already unfrozen"},{"file":"lib/steps/zookeeper.js","line":808,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Common pattern."},{"file":"lib/steps/zookeeper.js","line":808,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/cli/do_create.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/post-setup/ha-binder.js","type":"MODIFIED","insertions":379,"deletions":-898},{"file":"lib/procedures/create-service-instance-v1.js","type":"MODIFIED","insertions":17,"deletions":-21},{"file":"lib/procedures/shared.js","type":"MODIFIED","insertions":37,"deletions":-2},{"file":"lib/steps/index.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/steps/zookeeper.js","type":"ADDED","insertions":824,"deletions":0}],"sizeInsertions":1260,"sizeDeletions":-923},{"number":"5","revision":"065eb3184233064e5d795ed1d70dfd69f78225ec","parents":["f2bf9bb71062b09fcbf05034c1ef768358696cbc"],"ref":"refs/changes/69/3869/5","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1525964690,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1525964726,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/common.js","line":856,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"This doesn\u0027t need to be in the try/catch block."},{"file":"lib/common.js","line":856,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/common.js","line":860,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"If there was an exception in the try/catch, res may not be an array."},{"file":"lib/common.js","line":860,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/common.js","line":919,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Make sure that manateeAdmRemote\u0027s \"out\" is always a string if no err. The \"... ? ... : null\" there makes me nervous."},{"file":"lib/common.js","line":919,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/common.js","line":1177,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Not sure what the point of this is. :p\n\nIt might be useful to provide this in the subsequent InternalError, but it isn\u0027t."},{"file":"lib/common.js","line":1177,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"It\u0027s given \"as is\" to the callback as \"parseErr\" in case there is no res value."},{"file":"lib/post-setup/ha-binder.js","line":222,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"This can have an array containing nulls. While subsequent code looks like it handles this correctly, maybe adding a filter() step to remove nulls will avoid surprises in the future?"},{"file":"lib/post-setup/ha-binder.js","line":222,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/procedures/shared.js","line":1167,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Intentional, or leftover debugging?"},{"file":"lib/procedures/shared.js","line":1167,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Leftover, good catch"},{"file":"lib/procedures/shared.js","line":1475,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"I think this could use a comment."},{"file":"lib/procedures/shared.js","line":1475,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/procedures/shared.js","line":1801,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"It might be a tad clearer so:\n\n    var filter \u003d opts.ips.length !\u003d\u003d 1 ?\n        function (r) { return (r !\u003d\u003d \u0027leader\u0027 \u0026\u0026 r !\u003d\u003d \u0027follower\u0027); } :\n        function (r) { return (r !\u003d\u003d \u0027standalone\u0027); }\n    var notOk \u003d results.successes.filter(filter);\n\nPersonal taste though."},{"file":"lib/procedures/shared.js","line":1801,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Why not :-)"},{"file":"lib/procedures/shared.js","line":1963,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Good idea."},{"file":"lib/sdcadm.js","line":5084,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Does this make a difference?"},{"file":"lib/sdcadm.js","line":5084,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"It actually does. If you check most of our JSON.parse calls in sdcadm, all of them call trim() before attempting to parse output from commands. That\u0027s obviously due to previous \"bad experiences\" with outputs plenty of tabs/spaces and nothing else. \n\nGiven it doesn\u0027t hurt, it\u0027s not a bad practice, though."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/cli/do_create.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/common.js","type":"MODIFIED","insertions":64,"deletions":-30},{"file":"lib/post-setup/ha-binder.js","type":"MODIFIED","insertions":387,"deletions":-899},{"file":"lib/procedures/create-service-instance-v1.js","type":"MODIFIED","insertions":23,"deletions":-22},{"file":"lib/procedures/shared.js","type":"MODIFIED","insertions":92,"deletions":-19},{"file":"lib/sdcadm.js","type":"MODIFIED","insertions":34,"deletions":-27},{"file":"lib/steps/index.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/steps/zookeeper.js","type":"ADDED","insertions":790,"deletions":0},{"file":"lib/vmadm.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"test/post-setup-ha-binder.test.js","type":"ADDED","insertions":230,"deletions":0},{"file":"test/post-setup.test.js","type":"MODIFIED","insertions":0,"deletions":-44}],"sizeInsertions":1625,"sizeDeletions":-1044},{"number":"6","revision":"fbab98e11da081498d2a650f9240d6d12e3182b6","parents":["116b1e545c2af44ecac21155a5101f03fdd73fdb"],"ref":"refs/changes/69/3869/6","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1526489537,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1526489573,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".eslintrc","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/cli/do_create.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/common.js","type":"MODIFIED","insertions":64,"deletions":-31},{"file":"lib/post-setup/ha-binder.js","type":"MODIFIED","insertions":389,"deletions":-899},{"file":"lib/procedures/create-service-instance-v1.js","type":"MODIFIED","insertions":23,"deletions":-22},{"file":"lib/procedures/shared.js","type":"MODIFIED","insertions":84,"deletions":-16},{"file":"lib/sdcadm.js","type":"MODIFIED","insertions":30,"deletions":-25},{"file":"lib/steps/index.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/steps/zookeeper.js","type":"ADDED","insertions":790,"deletions":0},{"file":"lib/vmadm.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"test/post-setup-ha-binder.test.js","type":"ADDED","insertions":230,"deletions":0},{"file":"test/post-setup.test.js","type":"MODIFIED","insertions":0,"deletions":-44}],"sizeInsertions":1616,"sizeDeletions":-1041},{"number":"7","revision":"d906db0a8cdab06317e80c5bd09717d04f80ca1d","parents":["116b1e545c2af44ecac21155a5101f03fdd73fdb"],"ref":"refs/changes/69/3869/7","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1526489775,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1526489811,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".eslintrc","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/cli/do_create.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/common.js","type":"MODIFIED","insertions":64,"deletions":-31},{"file":"lib/post-setup/ha-binder.js","type":"MODIFIED","insertions":389,"deletions":-899},{"file":"lib/procedures/create-service-instance-v1.js","type":"MODIFIED","insertions":23,"deletions":-22},{"file":"lib/procedures/shared.js","type":"MODIFIED","insertions":84,"deletions":-16},{"file":"lib/sdcadm.js","type":"MODIFIED","insertions":30,"deletions":-25},{"file":"lib/steps/index.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/steps/zookeeper.js","type":"ADDED","insertions":790,"deletions":0},{"file":"lib/vmadm.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"man/man1/sdcadm.1.ronn","type":"MODIFIED","insertions":50,"deletions":-17},{"file":"test/post-setup-ha-binder.test.js","type":"ADDED","insertions":230,"deletions":0},{"file":"test/post-setup.test.js","type":"MODIFIED","insertions":0,"deletions":-44}],"sizeInsertions":1666,"sizeDeletions":-1058},{"number":"8","revision":"275337cefbec9593e77cf930c6bf2e28083ff535","parents":["116b1e545c2af44ecac21155a5101f03fdd73fdb"],"ref":"refs/changes/69/3869/8","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1526490184,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1526490220,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/common.js","line":868,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Could assign to \"var outputs\" or something."},{"file":"lib/common.js","line":868,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/common.js","line":1196,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Same thing here."},{"file":"lib/common.js","line":1196,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/procedures/shared.js","line":1297,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Could use its own var."},{"file":"lib/procedures/shared.js","line":1297,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/sdcadm.js","line":2224,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Is this right?"},{"file":"lib/sdcadm.js","line":2224,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"No, it should be `ch.inst \u0026\u0026 ch.inst.instance`."},{"file":"lib/sdcadm.js","line":2224,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Are you certain? While ch.inst is used in other files, this file (and indeed, other functions inside genUpdatePlan()) only has ch.instance."},{"file":"lib/sdcadm.js","line":2224,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Apologies! `ch.instance \u0026 change.instance.instance` as in\n\n       { type: \u0027vm\u0027,\n       alias: \u0027sapi0\u0027,\n       version: \u0027master-20180321T144110Z-g0eac2c7\u0027,\n       instance: \u0027ab1c2fbd-094f-4729-8e5b-53f51a51f542\u0027,\n       zonename: \u0027ab1c2fbd-094f-4729-8e5b-53f51a51f542\u0027,\n       service: \u0027sapi\u0027,\n       image: \u002797f6d686-2d16-11e8-abe6-57f5e4bbec2f\u0027,\n       state: \u0027running\u0027,\n       server: \u0027564d5859-4525-e02a-6c88-cf4b6d170ddc\u0027,\n       hostname: \u0027headnode\u0027,\n       server_ip: \u002710.99.99.7\u0027,\n       ip: \u002710.99.99.31\u0027 }"},{"file":"man/man1/sdcadm.1.ronn","line":444,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"I think this could be reworded more clearly."},{"file":"man/man1/sdcadm.1.ronn","line":444,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"man/man1/sdcadm.1.ronn","line":449,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Replace all but the first instance"},{"file":"man/man1/sdcadm.1.ronn","line":449,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"man/man1/sdcadm.1.ronn","line":452,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Having said that, I am a total fan of examples, so this bit is +1"},{"file":"man/man1/sdcadm.1.ronn","line":452,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".eslintrc","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"CHANGES.md","type":"MODIFIED","insertions":4,"deletions":0},{"file":"docs/post-setup.md","type":"MODIFIED","insertions":3,"deletions":-5},{"file":"lib/cli/do_create.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/common.js","type":"MODIFIED","insertions":64,"deletions":-31},{"file":"lib/post-setup/ha-binder.js","type":"MODIFIED","insertions":389,"deletions":-899},{"file":"lib/procedures/create-service-instance-v1.js","type":"MODIFIED","insertions":23,"deletions":-22},{"file":"lib/procedures/shared.js","type":"MODIFIED","insertions":84,"deletions":-16},{"file":"lib/sdcadm.js","type":"MODIFIED","insertions":30,"deletions":-25},{"file":"lib/steps/index.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/steps/zookeeper.js","type":"ADDED","insertions":790,"deletions":0},{"file":"lib/vmadm.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"man/man1/sdcadm.1.ronn","type":"MODIFIED","insertions":51,"deletions":-18},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/post-setup-ha-binder.test.js","type":"ADDED","insertions":230,"deletions":0},{"file":"test/post-setup.test.js","type":"MODIFIED","insertions":0,"deletions":-44}],"sizeInsertions":1675,"sizeDeletions":-1065},{"number":"9","revision":"01c06019162f0a7efae8917bb37dbd036e27706a","parents":["3db0cb4107a7c609e3614bd448fec321916fafa7"],"ref":"refs/changes/69/3869/9","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1526549244,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1526549282,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".eslintrc","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"CHANGES.md","type":"MODIFIED","insertions":5,"deletions":0},{"file":"docs/post-setup.md","type":"MODIFIED","insertions":3,"deletions":-5},{"file":"lib/cli/do_create.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/common.js","type":"MODIFIED","insertions":66,"deletions":-31},{"file":"lib/post-setup/ha-binder.js","type":"MODIFIED","insertions":389,"deletions":-899},{"file":"lib/procedures/create-service-instance-v1.js","type":"MODIFIED","insertions":23,"deletions":-22},{"file":"lib/procedures/shared.js","type":"MODIFIED","insertions":93,"deletions":-24},{"file":"lib/sdcadm.js","type":"MODIFIED","insertions":31,"deletions":-26},{"file":"lib/steps/index.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/steps/zookeeper.js","type":"ADDED","insertions":790,"deletions":0},{"file":"lib/vmadm.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"man/man1/sdcadm.1.ronn","type":"MODIFIED","insertions":49,"deletions":-17},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/post-setup-ha-binder.test.js","type":"ADDED","insertions":230,"deletions":0},{"file":"test/post-setup.test.js","type":"MODIFIED","insertions":0,"deletions":-44}],"sizeInsertions":1686,"sizeDeletions":-1073},{"number":"10","revision":"85275be5e1a52de60f63eb5797eaf7ae0d251d5d","parents":["3db0cb4107a7c609e3614bd448fec321916fafa7"],"ref":"refs/changes/69/3869/10","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1526566284,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1526566322,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1526591154,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1526591154,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".eslintrc","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"CHANGES.md","type":"MODIFIED","insertions":5,"deletions":0},{"file":"docs/post-setup.md","type":"MODIFIED","insertions":3,"deletions":-5},{"file":"lib/cli/do_create.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/common.js","type":"MODIFIED","insertions":66,"deletions":-31},{"file":"lib/post-setup/ha-binder.js","type":"MODIFIED","insertions":389,"deletions":-899},{"file":"lib/procedures/create-service-instance-v1.js","type":"MODIFIED","insertions":23,"deletions":-22},{"file":"lib/procedures/shared.js","type":"MODIFIED","insertions":93,"deletions":-24},{"file":"lib/sdcadm.js","type":"MODIFIED","insertions":31,"deletions":-26},{"file":"lib/steps/index.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/steps/zookeeper.js","type":"ADDED","insertions":790,"deletions":0},{"file":"lib/vmadm.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"man/man1/sdcadm.1.ronn","type":"MODIFIED","insertions":49,"deletions":-17},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/post-setup-ha-binder.test.js","type":"ADDED","insertions":230,"deletions":0},{"file":"test/post-setup.test.js","type":"MODIFIED","insertions":0,"deletions":-44}],"sizeInsertions":1686,"sizeDeletions":-1073},{"number":"11","revision":"a968cbeede4bff9f4c2b3f3603d029f2db13b929","parents":["3db0cb4107a7c609e3614bd448fec321916fafa7"],"ref":"refs/changes/69/3869/11","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1526636230,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1526566322,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"SUBM","value":"1","grantedOn":1526636262,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1526591154,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1526591154,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":".eslintrc","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"CHANGES.md","type":"MODIFIED","insertions":5,"deletions":0},{"file":"docs/post-setup.md","type":"MODIFIED","insertions":3,"deletions":-5},{"file":"lib/cli/do_create.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/common.js","type":"MODIFIED","insertions":66,"deletions":-31},{"file":"lib/post-setup/ha-binder.js","type":"MODIFIED","insertions":389,"deletions":-899},{"file":"lib/procedures/create-service-instance-v1.js","type":"MODIFIED","insertions":23,"deletions":-22},{"file":"lib/procedures/shared.js","type":"MODIFIED","insertions":93,"deletions":-24},{"file":"lib/sdcadm.js","type":"MODIFIED","insertions":31,"deletions":-26},{"file":"lib/steps/index.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/steps/zookeeper.js","type":"ADDED","insertions":790,"deletions":0},{"file":"lib/vmadm.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"man/man1/sdcadm.1.ronn","type":"MODIFIED","insertions":49,"deletions":-17},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/post-setup-ha-binder.test.js","type":"ADDED","insertions":230,"deletions":0},{"file":"test/post-setup.test.js","type":"MODIFIED","insertions":0,"deletions":-44}],"sizeInsertions":1686,"sizeDeletions":-1073}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}]}