From 8334d6431952c5bb11a5517c88e2abc79f4a8c80 Mon Sep 17 00:00:00 2001
From: Brian Bennett <brian.bennett@joyent.com>
Date: Wed, 28 Aug 2019 09:38:59 -0700
Subject: [PATCH] joyent/manta-thoth#95 thoth should work inside a job

---
 bin/thoth | 10 ++++++----
 1 file changed, 6 insertions(+), 4 deletions(-)

diff --git a/bin/thoth b/bin/thoth
index 8dea1a6..68314ee 100755
--- a/bin/thoth
+++ b/bin/thoth
@@ -3549,10 +3549,12 @@ var connect = function ()
 	var i, opts = {};
 	var mvars = [ 'MANTA_URL', 'MANTA_USER', 'MANTA_KEY_ID' ];
 
-	for (i = 0; i < mvars.length; i++) {
-		if (!process.env[mvars[i]]) {
-			fatal('expected ' + mvars[i] +
-			    ' environment variable to be set');
+	if (process.env.MANTA_NO_AUTH !== 'true') {
+		for (i = 0; i < mvars.length; i++) {
+			if (!process.env[mvars[i]]) {
+				fatal('expected ' + mvars[i] +
+				    ' environment variable to be set');
+			}
 		}
 	}
 
-- 
2.21.0

