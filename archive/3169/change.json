{"project":"joyent/sdc-booter","branch":"master","id":"I384214d49dd5deb78c84603f0f606367411c859e","number":"3169","subject":"NET-384 sdc-booter should dump core on uncaught exception NET-385 sdc-booter panics while handling discover on log level trace NET-386 booter should be able to handle option 82 as nictags Reviewed by: Cody Peter Mello \u003ccody.mello@joyent.com\u003e Reviewed by: ","owner":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"url":"https://cr.joyent.us/3169","commitMessage":"NET-384 sdc-booter should dump core on uncaught exception\nNET-385 sdc-booter panics while handling discover on log level trace\nNET-386 booter should be able to handle option 82 as nictags\nReviewed by: Cody Peter Mello \u003ccody.mello@joyent.com\u003e\nReviewed by: Chris Burroughs \u003cchris.burroughs@joyent.com\u003e\nApproved by: Chris Burroughs \u003cchris.burroughs@joyent.com\u003e\n","createdOn":1515440830,"lastUpdated":1532714563,"open":false,"status":"MERGED","comments":[{"timestamp":1515440830,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 1."},{"timestamp":1515440856,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1515526959,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Patch Set 1:\n\nDid you find the earlier  table-esque formatting useful once you got it working?  At least to me it feels like an odd use of an object based logger.  We could drop almost the entire block of code if `msg.toString(\u0027hex\u0027)` was satisfactory.\n\nTable Example:\n```\n[2018-01-09T19:28:37.727Z] DEBUG: dhcpd/21146 on b104bf7f-3271-4f3e-9f1d-3ef775c2d5a3: [000]: 0x01 0x01 0x06 0x00\n[2018-01-09T19:28:37.728Z] DEBUG: dhcpd/21146 on b104bf7f-3271-4f3e-9f1d-3ef775c2d5a3: [004]: 0xeb 0xc5 0xa7 0x55\n[2018-01-09T19:28:37.728Z] DEBUG: dhcpd/21146 on b104bf7f-3271-4f3e-9f1d-3ef775c2d5a3: [008]: 0x00 0x10 0x00 0x00\n[2018-01-09T19:28:37.728Z] DEBUG: dhcpd/21146 on b104bf7f-3271-4f3e-9f1d-3ef775c2d5a3: [012]: 0x00 0x00 0x00 0x00\n[2018-01-09T19:28:37.728Z] DEBUG: dhcpd/21146 on b104bf7f-3271-4f3e-9f1d-3ef775c2d5a3: [016]: 0x00 0x00 0x00 0x00\n[2018-01-09T19:28:37.728Z] DEBUG: dhcpd/21146 on b104bf7f-3271-4f3e-9f1d-3ef775c2d5a3: \n```"},{"timestamp":1516652200,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 2."},{"timestamp":1516652227,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1516652278,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Patch Set 2:\n\nStill working on some of these changes, but wanted to push a check point.  Please hold off on reviewing for now."},{"timestamp":1516725342,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 3."},{"timestamp":1516725367,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing-1\n\n(3 comments)\n\n\"make check\" exited with status 2"},{"timestamp":1516725499,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 4."},{"timestamp":1516725526,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1517342545,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 5."},{"timestamp":1517342572,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1517419657,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 6."},{"timestamp":1517419700,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 6: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1517419925,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Patch Set 6:\n\nRebased on master.  I should probably update some of the variable names in the config template."},{"timestamp":1518650039,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 6:\n\n(6 comments)"},{"timestamp":1520559226,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 7."},{"timestamp":1520559253,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 7: CI-Testing-1\n\n(9 comments)\n\n\"make check\" exited with status 2"},{"timestamp":1531426827,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 8."},{"timestamp":1531426858,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 8: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1531497030,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 9."},{"timestamp":1531497058,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 9: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1531505303,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Patch Set 9:\n\nLet me know when you feel like this has moved from work in progress, to ready to review."},{"timestamp":1531509535,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 10: Commit message was updated."},{"timestamp":1531860677,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Patch Set 10:\n\n(23 comments)"},{"timestamp":1531922368,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Patch Set 10:\n\n(18 comments)"},{"timestamp":1531922390,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 11."},{"timestamp":1531922424,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 11: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1532046800,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 11:\n\n(9 comments)"},{"timestamp":1532106329,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Patch Set 11:\n\n(9 comments)"},{"timestamp":1532106447,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 12."},{"timestamp":1532106477,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 12: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1532113158,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 12:\n\n(1 comment)"},{"timestamp":1532120603,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 13."},{"timestamp":1532120629,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 13: CI-Testing-1\n\n(1 comment)\n\n\"make check\" exited with status 2"},{"timestamp":1532120842,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 14."},{"timestamp":1532120870,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 14: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1532120900,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Patch Set 11:\n\n(1 comment)"},{"timestamp":1532126030,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 14:\n\n(2 comments)"},{"timestamp":1532128798,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 15."},{"timestamp":1532128829,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 15: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1532128918,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Patch Set 14:\n\n(2 comments)"},{"timestamp":1532129025,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 15: Code-Review+1"},{"timestamp":1532542811,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 16."},{"timestamp":1532542841,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 16: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1532631046,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Patch Set 16:\n\n(10 comments)\n\nSorry it took me so long to circle back.  I noticed a few things on my final read through, but I think this is very close.\n\nI know you added some tests (yeah!) and had a physical lab.  For when the next person comes along and need to make an adjacent change, is this possible to mimic the rack setup in CoaL?"},{"timestamp":1532633283,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 17."},{"timestamp":1532633311,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 17: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1532633380,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Patch Set 17:\n\n(10 comments)\n\nIt would be tough to mimic this in a COAL due to resource requirements as it requires at least 2 VMs.  Perhaps a COAL that had 64GB RAM :)"},{"timestamp":1532710552,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Patch Set 16:\n\n(1 comment)"},{"timestamp":1532710923,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 18."},{"timestamp":1532710951,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 18: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1532711028,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Patch Set 18:\n\n(1 comment)"},{"timestamp":1532713730,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Patch Set 18: Code-Review+1 Integration-Approval+1"},{"timestamp":1532714425,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Uploaded patch set 19: Commit message was updated."},{"timestamp":1532714563,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Rui"}],"currentPatchSet":{"number":"19","revision":"384214d49dd5deb78c84603f0f606367411c859e","parents":["595aa8e96070a84704dc322a4ba7b747e4965dca"],"ref":"refs/changes/69/3169/19","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1532714425,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1532710951,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1532713730,"by":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1532713730,"by":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"}},{"type":"SUBM","value":"1","grantedOn":1532714563,"by":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":12,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"bin/dhcpd","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"config.json.sample","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"lib/admin-pool-cache.js","type":"ADDED","insertions":163,"deletions":0},{"file":"lib/boot-files.js","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"lib/booter.js","type":"MODIFIED","insertions":16,"deletions":-4},{"file":"lib/bootparams.js","type":"MODIFIED","insertions":144,"deletions":-59},{"file":"lib/cache.js","type":"MODIFIED","insertions":55,"deletions":0},{"file":"lib/dhcp.js","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"lib/dhcpd.js","type":"MODIFIED","insertions":142,"deletions":-22},{"file":"lib/json-file.js","type":"MODIFIED","insertions":39,"deletions":-7},{"file":"lib/net-file.js","type":"MODIFIED","insertions":17,"deletions":-11},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"sapi_manifests/dhcpd/template","type":"MODIFIED","insertions":4,"deletions":0},{"file":"server.js","type":"MODIFIED","insertions":34,"deletions":-3},{"file":"test/bootparams.test.js","type":"MODIFIED","insertions":168,"deletions":-11},{"file":"test/lib/file.js","type":"MODIFIED","insertions":24,"deletions":-3},{"file":"test/lib/mocks.js","type":"MODIFIED","insertions":12,"deletions":-1},{"file":"test/lib/server.js","type":"MODIFIED","insertions":53,"deletions":-22},{"file":"tools/jsl.node.conf","type":"MODIFIED","insertions":1,"deletions":0}],"sizeInsertions":895,"sizeDeletions":-151},"patchSets":[{"number":"1","revision":"ed3f4d7943d3cfc3d639102afbb443f23a0734bc","parents":["5f665800fdbd42846bc7ee83a9fd356c59babb8f"],"ref":"refs/changes/69/3169/1","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1515440830,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1515440856,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"bin/dhcpd","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/dhcpd.js","type":"MODIFIED","insertions":9,"deletions":-4}],"sizeInsertions":10,"sizeDeletions":-5},{"number":"2","revision":"6963f21a7a60a9acf84bc916c5d05fb8f2a4a7c8","parents":["5f665800fdbd42846bc7ee83a9fd356c59babb8f"],"ref":"refs/changes/69/3169/2","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1516652200,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1516652227,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"bin/dhcpd","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"config.json.sample","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/admin-pool-cache.js","type":"ADDED","insertions":149,"deletions":0},{"file":"lib/boot-files.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/bootparams.js","type":"MODIFIED","insertions":8,"deletions":-2},{"file":"lib/dhcp.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/dhcpd.js","type":"MODIFIED","insertions":68,"deletions":-5},{"file":"sapi_manifests/dhcpd/template","type":"MODIFIED","insertions":2,"deletions":-1}],"sizeInsertions":235,"sizeDeletions":-13},{"number":"3","revision":"6f1297e47a7e46dd8cd9cc8a0e307323af5820f9","parents":["5f665800fdbd42846bc7ee83a9fd356c59babb8f"],"ref":"refs/changes/69/3169/3","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1516725342,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1516725367,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/bootparams.js","line":134,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"warning: trailing_comma"},{"file":"lib/bootparams.js","line":193,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"warning: missing semicolon"},{"file":"lib/bootparams.js","line":197,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"warning: identifer uuid hides an identifier in a parent scope"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"bin/dhcpd","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"config.json.sample","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/admin-pool-cache.js","type":"ADDED","insertions":150,"deletions":0},{"file":"lib/boot-files.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"lib/booter.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/bootparams.js","type":"MODIFIED","insertions":35,"deletions":-4},{"file":"lib/dhcp.js","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"lib/dhcpd.js","type":"MODIFIED","insertions":74,"deletions":-6},{"file":"sapi_manifests/dhcpd/template","type":"MODIFIED","insertions":2,"deletions":-1}],"sizeInsertions":275,"sizeDeletions":-17},{"number":"4","revision":"c13a175b16de5d4aa92f433dade9c923633dd8e5","parents":["5f665800fdbd42846bc7ee83a9fd356c59babb8f"],"ref":"refs/changes/69/3169/4","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1516725499,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1516725526,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"bin/dhcpd","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"config.json.sample","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/admin-pool-cache.js","type":"ADDED","insertions":150,"deletions":0},{"file":"lib/boot-files.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"lib/booter.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/bootparams.js","type":"MODIFIED","insertions":35,"deletions":-4},{"file":"lib/dhcp.js","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"lib/dhcpd.js","type":"MODIFIED","insertions":74,"deletions":-6},{"file":"sapi_manifests/dhcpd/template","type":"MODIFIED","insertions":2,"deletions":-1}],"sizeInsertions":275,"sizeDeletions":-17},{"number":"5","revision":"8bd0200fc2e6061bef67a3e98f6f20418b9eecac","parents":["5f665800fdbd42846bc7ee83a9fd356c59babb8f"],"ref":"refs/changes/69/3169/5","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1517342545,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1517342572,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"bin/dhcpd","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"config.json.sample","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/admin-pool-cache.js","type":"ADDED","insertions":193,"deletions":0},{"file":"lib/boot-files.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"lib/booter.js","type":"MODIFIED","insertions":13,"deletions":-3},{"file":"lib/bootparams.js","type":"MODIFIED","insertions":36,"deletions":-4},{"file":"lib/dhcp.js","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"lib/dhcpd.js","type":"MODIFIED","insertions":70,"deletions":-9},{"file":"lib/net-file.js","type":"MODIFIED","insertions":11,"deletions":-4},{"file":"sapi_manifests/dhcpd/template","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"server.js","type":"MODIFIED","insertions":33,"deletions":-2},{"file":"test/bootparams.test.js","type":"MODIFIED","insertions":143,"deletions":-7},{"file":"test/lib/mocks.js","type":"MODIFIED","insertions":11,"deletions":0},{"file":"test/lib/server.js","type":"MODIFIED","insertions":54,"deletions":-19}],"sizeInsertions":579,"sizeDeletions":-54},{"number":"6","revision":"a72fd050078e620af8b88fed0a61f51e486f0c1d","parents":["a7591ed721b1402703b9d5230923bf05ed6dbea4"],"ref":"refs/changes/69/3169/6","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1517419657,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1517419700,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/admin-pool-cache.js","line":49,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"In new code, please place the \"return\" on its own line when calling a callback. This will make it easier for us to turn on the consistent-return checks in eslint over time."},{"file":"lib/admin-pool-cache.js","line":65,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"You should make this something like:\n\n    log.error({\n        pools: res\n    }, \u0027More than one network pools found for \"admin\"\u0027);\n    next(new Error(\u0027Too many admin network pools\u0027));\n    return;\n\nSo that we pass an actual Error to the callback, and so that we log the pools array with a useful field name in the output JSON logs."},{"file":"lib/admin-pool-cache.js","line":78,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Since this is the last step in the waterfall, I think that it would be better to just call next() with nothing, and not do the \"err !\u003d\u003d true\" bit below."},{"file":"lib/admin-pool-cache.js","line":81,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"I don\u0027t think we need to do the nic_tag caching part. Instead, I think we should fetch the \"admin\" network uuid or the \"admin\" network pool uuid, save those, and when we create the NIC, pass the pool or network uuid to provisionNic() and set the \"nic_tag\" field to what we were passed in from DHCP. This will allow us to, if needed, have and utilize multiple admin networks in a pool with the same nic_tag, since NAPI will be able to attempt provisions on all of them. It will also allow us to avoid worrying about pagination with this listNetworks() call, when a deployment has more than 1000 networks."},{"file":"lib/bootparams.js","line":214,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"assert.ok"},{"file":"lib/bootparams.js","line":271,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"This is correct. We should also pass:\n\n    \"nic_tag\": fArg.nic_tag,\n\nSo that when fArg.network_uuid is the \"admin\" pool uuid, it can select usable networks using that."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"bin/dhcpd","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"config.json.sample","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/admin-pool-cache.js","type":"ADDED","insertions":193,"deletions":0},{"file":"lib/boot-files.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"lib/booter.js","type":"MODIFIED","insertions":13,"deletions":-3},{"file":"lib/bootparams.js","type":"MODIFIED","insertions":36,"deletions":-4},{"file":"lib/dhcp.js","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"lib/dhcpd.js","type":"MODIFIED","insertions":65,"deletions":-7},{"file":"lib/net-file.js","type":"MODIFIED","insertions":11,"deletions":-4},{"file":"sapi_manifests/dhcpd/template","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"server.js","type":"MODIFIED","insertions":33,"deletions":-2},{"file":"test/bootparams.test.js","type":"MODIFIED","insertions":143,"deletions":-7},{"file":"test/lib/mocks.js","type":"MODIFIED","insertions":11,"deletions":0},{"file":"test/lib/server.js","type":"MODIFIED","insertions":54,"deletions":-19}],"sizeInsertions":574,"sizeDeletions":-52},{"number":"7","revision":"3b4eeea73e5e2e3df3385e90152c99131ad460df","parents":["a7591ed721b1402703b9d5230923bf05ed6dbea4"],"ref":"refs/changes/69/3169/7","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1520559226,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1520559253,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/bootparams.js","line":465,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"space or tab at end of line"},{"file":"lib/bootparams.js","line":469,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"space or tab at end of line"},{"file":"lib/bootparams.js","line":470,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"space or tab at end of line"},{"file":"lib/bootparams.js","line":471,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"space or tab at end of line"},{"file":"lib/bootparams.js","line":472,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"space or tab at end of line"},{"file":"lib/bootparams.js","line":473,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"space or tab at end of line"},{"file":"lib/cache.js","line":233,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"literal string using double-quote instead of single"},{"file":"lib/dhcpd.js","line":260,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"improper first line of block comment"},{"file":"lib/dhcpd.js","line":271,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"whitespace before right paren"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"bin/dhcpd","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"config.json.sample","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/admin-pool-cache.js","type":"ADDED","insertions":127,"deletions":0},{"file":"lib/boot-files.js","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"lib/booter.js","type":"MODIFIED","insertions":17,"deletions":-4},{"file":"lib/bootparams.js","type":"MODIFIED","insertions":123,"deletions":-57},{"file":"lib/cache.js","type":"MODIFIED","insertions":67,"deletions":0},{"file":"lib/dhcp.js","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"lib/dhcpd.js","type":"MODIFIED","insertions":109,"deletions":-17},{"file":"lib/json-file.js","type":"MODIFIED","insertions":31,"deletions":-1},{"file":"lib/net-file.js","type":"MODIFIED","insertions":14,"deletions":-5},{"file":"sapi_manifests/dhcpd/template","type":"MODIFIED","insertions":4,"deletions":0},{"file":"server.js","type":"MODIFIED","insertions":34,"deletions":-2},{"file":"test/bootparams.test.js","type":"MODIFIED","insertions":166,"deletions":-8},{"file":"test/lib/mocks.js","type":"MODIFIED","insertions":11,"deletions":-1},{"file":"test/lib/server.js","type":"MODIFIED","insertions":57,"deletions":-18}],"sizeInsertions":775,"sizeDeletions":-118},{"number":"8","revision":"a7c16962055455e8ff7277020e57546845428ce7","parents":["595aa8e96070a84704dc322a4ba7b747e4965dca"],"ref":"refs/changes/69/3169/8","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1531426827,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1531426858,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"bin/dhcpd","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"config.json.sample","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/admin-pool-cache.js","type":"ADDED","insertions":160,"deletions":0},{"file":"lib/boot-files.js","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"lib/booter.js","type":"MODIFIED","insertions":16,"deletions":-4},{"file":"lib/bootparams.js","type":"MODIFIED","insertions":128,"deletions":-57},{"file":"lib/cache.js","type":"MODIFIED","insertions":54,"deletions":0},{"file":"lib/dhcp.js","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"lib/dhcpd.js","type":"MODIFIED","insertions":146,"deletions":-22},{"file":"lib/json-file.js","type":"MODIFIED","insertions":31,"deletions":-1},{"file":"lib/net-file.js","type":"MODIFIED","insertions":15,"deletions":-6},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":0},{"file":"sapi_manifests/dhcpd/template","type":"MODIFIED","insertions":4,"deletions":0},{"file":"server.js","type":"MODIFIED","insertions":34,"deletions":-2},{"file":"test/bootparams.test.js","type":"MODIFIED","insertions":171,"deletions":-9},{"file":"test/lib/file.js","type":"MODIFIED","insertions":23,"deletions":-2},{"file":"test/lib/mocks.js","type":"MODIFIED","insertions":12,"deletions":-1},{"file":"test/lib/server.js","type":"MODIFIED","insertions":54,"deletions":-20}],"sizeInsertions":864,"sizeDeletions":-129},{"number":"9","revision":"856d042523e051b6a76a9e7aa3b2d367658865ab","parents":["595aa8e96070a84704dc322a4ba7b747e4965dca"],"ref":"refs/changes/69/3169/9","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1531497030,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1531497058,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"bin/dhcpd","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"config.json.sample","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/admin-pool-cache.js","type":"ADDED","insertions":160,"deletions":0},{"file":"lib/boot-files.js","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"lib/booter.js","type":"MODIFIED","insertions":16,"deletions":-4},{"file":"lib/bootparams.js","type":"MODIFIED","insertions":129,"deletions":-57},{"file":"lib/cache.js","type":"MODIFIED","insertions":54,"deletions":0},{"file":"lib/dhcp.js","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"lib/dhcpd.js","type":"MODIFIED","insertions":144,"deletions":-22},{"file":"lib/json-file.js","type":"MODIFIED","insertions":31,"deletions":-1},{"file":"lib/net-file.js","type":"MODIFIED","insertions":14,"deletions":-6},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":0},{"file":"sapi_manifests/dhcpd/template","type":"MODIFIED","insertions":4,"deletions":0},{"file":"server.js","type":"MODIFIED","insertions":33,"deletions":-2},{"file":"test/bootparams.test.js","type":"MODIFIED","insertions":167,"deletions":-10},{"file":"test/lib/file.js","type":"MODIFIED","insertions":22,"deletions":-2},{"file":"test/lib/mocks.js","type":"MODIFIED","insertions":12,"deletions":-1},{"file":"test/lib/server.js","type":"MODIFIED","insertions":54,"deletions":-20}],"sizeInsertions":856,"sizeDeletions":-130},{"number":"10","revision":"eadf0f06bdfd31262fb7ce62d9d068b3f2608203","parents":["595aa8e96070a84704dc322a4ba7b747e4965dca"],"ref":"refs/changes/69/3169/10","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1531509535,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1531497058,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":".gitignore","line":1,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"What is this for?"},{"file":".gitignore","line":1,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"so that .swp files don\u0027t end up in your staging area and accidentally get committed."},{"file":".gitignore","line":1,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Tangent: Is that a common vi thing?  If so we should add it to node-triton-package-boilerplate."},{"file":".gitignore","line":1,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Yes.  Agreed."},{"file":"bin/dhcpd","line":9,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"nit: year"},{"file":"bin/dhcpd","line":9,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"},{"file":"lib/admin-pool-cache.js","line":7,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"nit: Need the (c)\nhttps://github.com/joyent/eng/blob/master/docs/index.md#copyright\nTRITON-560"},{"file":"lib/admin-pool-cache.js","line":7,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"},{"file":"lib/admin-pool-cache.js","line":38,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Nice! I did not know about this js feature."},{"file":"lib/admin-pool-cache.js","line":44,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Obviously the existing code is not a model of consistency.  If you prefer I think `Foo.prototype.methodName \u003d function methodName()` is fine without \u0027fully qualifying\u0027 the method name."},{"file":"lib/admin-pool-cache.js","line":44,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"},{"file":"lib/admin-pool-cache.js","line":90,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"I\u0027m still(!) trying to wrap my had around callbacks and error handling: https://www.joyent.com/node-js/production/design/errors\n\nI\u0027m not sure this assert is capturing a \"programmer\" error.  If NAPI is spewing garbage, wouldn\u0027t it be better to just the old cache data instead of crashing booter?"},{"file":"lib/admin-pool-cache.js","line":90,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Good point.  Fixed."},{"file":"lib/admin-pool-cache.js","line":94,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"The code looks fine, but I don\u0027t have enough context to know  why this is a problem. nor how having 4 networks in one pool vs 2 networks in each of 2 pools is different  Isn\u0027t the point of rack aware networking to have multiple admin networks?"},{"file":"lib/admin-pool-cache.js","line":94,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"You\u0027re correct about rack aware networking to have more than one admin network.\n\nWhat this is checking is if there exists more than one network _pool_ with the name admin, and that is not allowed.\n\nThere can be only one (tm) pool, but that pool can have multiple networks."},{"file":"lib/admin-pool-cache.js","line":116,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Another area where we are not globally consistent.  But within this class all methods all methods ought to either use or not use named functions."},{"file":"lib/admin-pool-cache.js","line":116,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"},{"file":"lib/admin-pool-cache.js","line":132,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Minor possible DRY: There are two nearly identical inline readCache functions."},{"file":"lib/admin-pool-cache.js","line":132,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"},{"file":"lib/admin-pool-cache.js","line":157,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Why this indirection instead of calling the constructor?"},{"file":"lib/admin-pool-cache.js","line":157,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"do you mean:\n    module.exports \u003d AdminPoolCache;\n\nInstead of calling \u0027new\u0027 everywhere I intend to use it this way I just call create.  I am not sure what the style guide says about this type of thing, so I am open to suggestions."},{"file":"lib/bootparams.js","line":163,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"What does \"provision\" mean in this context? Booting a CN? Allocating a nic?"},{"file":"lib/bootparams.js","line":163,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"updated"},{"file":"lib/cache.js","line":178,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"\"No admin pool cache\" --\u003e Does this mean there is no only one admin network (no pools?)."},{"file":"lib/cache.js","line":178,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"By implication, yes.\n\nI suppose it is possible there is NO admin network or admin network pool.  But then we have bigger problems :)"},{"file":"lib/cache.js","line":206,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Does this end up being a parallel call per CN? Rack?"},{"file":"lib/cache.js","line":206,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Presumably there will be one admin network per Rack, not per CN.  At least that is the plan that ops has AFAIK."},{"file":"lib/dhcp.js","line":8,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"nit: year"},{"file":"lib/dhcpd.js","line":44,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"What\u0027s this new way to pass in an already created \u0027napi\u0027 used for?"},{"file":"lib/dhcpd.js","line":44,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"The server and the test framework server used to get it\u0027s napi and cnapi from starting the dhcpd server, but now the adminpoolcache is created before the dhcpd server starts, so it needs the napi first.  No sense in creating it twice."},{"file":"lib/dhcpd.js","line":73,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"So this works now?"},{"file":"lib/dhcpd.js","line":73,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"It works for unicast replies, which we now have because dhcp relays are supported.  TTL is invalid for broadcast packets, that is why it \"didnt work\" before."},{"file":"lib/json-file.js","line":8,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"nit: year"},{"file":"lib/json-file.js","line":8,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"},{"file":"lib/json-file.js","line":32,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"I think this could just be path.resolve."},{"file":"lib/json-file.js","line":32,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Oh nice.  I was not aware of that!  Unfortuntely though, jsl doesn\u0027t like \u0027path\u0027 considers it an undeclared identifier."},{"file":"lib/json-file.js","line":32,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"You would first need to require(\u0027path\u0027) at the top."},{"file":"lib/json-file.js","line":32,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"},{"file":"lib/net-file.js","line":8,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"nit: year"},{"file":"lib/net-file.js","line":8,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"},{"file":"lib/net-file.js","line":230,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Should we implement this as part of this change, and pass the result of JSON.stringify() to this callback?"},{"file":"lib/net-file.js","line":230,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"},{"file":"sapi_manifests/dhcpd/template","line":45,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"So I can\u0027t claim any sort of wide standardization. But I do find the pattern (used above) where the config names for time include their units  useful."},{"file":"sapi_manifests/dhcpd/template","line":45,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"},{"file":"server.js","line":8,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"nit: year"},{"file":"test/bootparams.test.js","line":8,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"nit: year"},{"file":"test/lib/file.js","line":8,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"nit: year"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"bin/dhcpd","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"config.json.sample","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/admin-pool-cache.js","type":"ADDED","insertions":160,"deletions":0},{"file":"lib/boot-files.js","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"lib/booter.js","type":"MODIFIED","insertions":16,"deletions":-4},{"file":"lib/bootparams.js","type":"MODIFIED","insertions":129,"deletions":-57},{"file":"lib/cache.js","type":"MODIFIED","insertions":54,"deletions":0},{"file":"lib/dhcp.js","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"lib/dhcpd.js","type":"MODIFIED","insertions":144,"deletions":-22},{"file":"lib/json-file.js","type":"MODIFIED","insertions":31,"deletions":-1},{"file":"lib/net-file.js","type":"MODIFIED","insertions":14,"deletions":-6},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":0},{"file":"sapi_manifests/dhcpd/template","type":"MODIFIED","insertions":4,"deletions":0},{"file":"server.js","type":"MODIFIED","insertions":33,"deletions":-2},{"file":"test/bootparams.test.js","type":"MODIFIED","insertions":167,"deletions":-10},{"file":"test/lib/file.js","type":"MODIFIED","insertions":22,"deletions":-2},{"file":"test/lib/mocks.js","type":"MODIFIED","insertions":12,"deletions":-1},{"file":"test/lib/server.js","type":"MODIFIED","insertions":54,"deletions":-20}],"sizeInsertions":856,"sizeDeletions":-130},{"number":"11","revision":"059c7650329884a3f624249bae25f9f0a6906ef9","parents":["595aa8e96070a84704dc322a4ba7b747e4965dca"],"ref":"refs/changes/69/3169/11","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1531922390,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1531922424,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/admin-pool-cache.js","line":64,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"This might be better as a method that we can call here and in the constructor."},{"file":"lib/admin-pool-cache.js","line":64,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"},{"file":"lib/bootparams.js","line":211,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"We\u0027ll want to move _checkAdminPoolCache() one up in the chain, and put this payload with \"nic_tag: fArg.nic_tag\" value for when this is a pool."},{"file":"lib/bootparams.js","line":211,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done.  And I updated the comment here as well."},{"file":"lib/bootparams.js","line":248,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"I wonder if we should have an object, admin_nic_tags, whose keys are the values in nic_tags_present, so that we can then test presence here and below with:\n\n    if (mod_jsprim.hasKey(fArg.admin_nic_tags, ntag)) {"},{"file":"lib/bootparams.js","line":248,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Do you mean to create on here, or that we should have one as part of the napi object.  The napi object approach would be a bit disjoint considering not all pools would be \u0027admin\u0027 pools.  If it is only added to special pools then we\u0027d still end up with essentially the same code here because we\u0027d have to check for the presence of \u0027admin_nic_tags\u0027.\n\nAlso what would the values of they keys be?  \u0027null\u0027?\n\nClearly more impetus for network traits.  :)"},{"file":"lib/bootparams.js","line":248,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"I mean that we can create one here in booter. If we kept the object empty when we don\u0027t have a pool, then the key check will always return false. (I also just realized that booter has been upgraded to node v4, which has Sets, so that might be a better fit here.)\n\nMy main concern is making it easy for people extending this in the future get the checks right. Lifting this test out into an isAdminPoolTag(fArg, ntag) function could also work."},{"file":"lib/bootparams.js","line":248,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"},{"file":"lib/cache.js","line":172,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"You can use jsprim.isEmpty(data) here."},{"file":"lib/cache.js","line":172,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"},{"file":"lib/dhcpd.js","line":422,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Is this the right place to assert this option? It seems like we should probably do it in the AdminPoolCache constructor before it\u0027s used."},{"file":"lib/dhcpd.js","line":422,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"yeah, that\u0027s some leftovers... removed."},{"file":"test/lib/server.js","line":34,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"This will always be false, since \"\u003d\u003d\u003d\" does non-coercive, shallow equality. You could have a field in the object, like \"setup: false\", that then gets set to true at the end of this function."},{"file":"test/lib/server.js","line":34,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"We actually have to fill this out again for every test case because it holds the mock values."},{"file":"test/lib/server.js","line":82,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Missing return"},{"file":"test/lib/server.js","line":82,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"},{"file":"test/lib/server.js","line":135,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Should this be \"tftpRoot\" like the other directories above?"},{"file":"test/lib/server.js","line":135,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"bin/dhcpd","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"config.json.sample","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/admin-pool-cache.js","type":"ADDED","insertions":163,"deletions":0},{"file":"lib/boot-files.js","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"lib/booter.js","type":"MODIFIED","insertions":16,"deletions":-4},{"file":"lib/bootparams.js","type":"MODIFIED","insertions":129,"deletions":-57},{"file":"lib/cache.js","type":"MODIFIED","insertions":54,"deletions":0},{"file":"lib/dhcp.js","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"lib/dhcpd.js","type":"MODIFIED","insertions":144,"deletions":-22},{"file":"lib/json-file.js","type":"MODIFIED","insertions":32,"deletions":-2},{"file":"lib/net-file.js","type":"MODIFIED","insertions":15,"deletions":-7},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":0},{"file":"sapi_manifests/dhcpd/template","type":"MODIFIED","insertions":4,"deletions":0},{"file":"server.js","type":"MODIFIED","insertions":34,"deletions":-3},{"file":"test/bootparams.test.js","type":"MODIFIED","insertions":168,"deletions":-11},{"file":"test/lib/file.js","type":"MODIFIED","insertions":23,"deletions":-3},{"file":"test/lib/mocks.js","type":"MODIFIED","insertions":12,"deletions":-1},{"file":"test/lib/server.js","type":"MODIFIED","insertions":54,"deletions":-20}],"sizeInsertions":866,"sizeDeletions":-137},{"number":"12","revision":"2128afd109c80f55e0c74af1c4773dfb93584c27","parents":["595aa8e96070a84704dc322a4ba7b747e4965dca"],"ref":"refs/changes/69/3169/12","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1532106447,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1532106477,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"bin/dhcpd","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"config.json.sample","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/admin-pool-cache.js","type":"ADDED","insertions":168,"deletions":0},{"file":"lib/boot-files.js","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"lib/booter.js","type":"MODIFIED","insertions":16,"deletions":-4},{"file":"lib/bootparams.js","type":"MODIFIED","insertions":139,"deletions":-58},{"file":"lib/cache.js","type":"MODIFIED","insertions":55,"deletions":0},{"file":"lib/dhcp.js","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"lib/dhcpd.js","type":"MODIFIED","insertions":142,"deletions":-22},{"file":"lib/json-file.js","type":"MODIFIED","insertions":37,"deletions":-5},{"file":"lib/net-file.js","type":"MODIFIED","insertions":16,"deletions":-10},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":0},{"file":"sapi_manifests/dhcpd/template","type":"MODIFIED","insertions":4,"deletions":0},{"file":"server.js","type":"MODIFIED","insertions":34,"deletions":-3},{"file":"test/bootparams.test.js","type":"MODIFIED","insertions":168,"deletions":-11},{"file":"test/lib/file.js","type":"MODIFIED","insertions":23,"deletions":-3},{"file":"test/lib/mocks.js","type":"MODIFIED","insertions":12,"deletions":-1},{"file":"test/lib/server.js","type":"MODIFIED","insertions":53,"deletions":-22}],"sizeInsertions":886,"sizeDeletions":-146},{"number":"13","revision":"805c60790623149bac4d267794efdc72a85efb09","parents":["595aa8e96070a84704dc322a4ba7b747e4965dca"],"ref":"refs/changes/69/3169/13","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1532120603,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1532120629,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/bootparams.js","line":156,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"warning: undeclared identifier: Set"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"bin/dhcpd","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"config.json.sample","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/admin-pool-cache.js","type":"ADDED","insertions":168,"deletions":0},{"file":"lib/boot-files.js","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"lib/booter.js","type":"MODIFIED","insertions":16,"deletions":-4},{"file":"lib/bootparams.js","type":"MODIFIED","insertions":145,"deletions":-58},{"file":"lib/cache.js","type":"MODIFIED","insertions":55,"deletions":0},{"file":"lib/dhcp.js","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"lib/dhcpd.js","type":"MODIFIED","insertions":142,"deletions":-22},{"file":"lib/json-file.js","type":"MODIFIED","insertions":37,"deletions":-5},{"file":"lib/net-file.js","type":"MODIFIED","insertions":16,"deletions":-10},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":0},{"file":"sapi_manifests/dhcpd/template","type":"MODIFIED","insertions":4,"deletions":0},{"file":"server.js","type":"MODIFIED","insertions":34,"deletions":-3},{"file":"test/bootparams.test.js","type":"MODIFIED","insertions":168,"deletions":-11},{"file":"test/lib/file.js","type":"MODIFIED","insertions":23,"deletions":-3},{"file":"test/lib/mocks.js","type":"MODIFIED","insertions":12,"deletions":-1},{"file":"test/lib/server.js","type":"MODIFIED","insertions":53,"deletions":-22}],"sizeInsertions":892,"sizeDeletions":-146},{"number":"14","revision":"076ff0a6acf675d5e35cbc836220c6051cb6cb63","parents":["595aa8e96070a84704dc322a4ba7b747e4965dca"],"ref":"refs/changes/69/3169/14","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1532120842,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1532120870,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/bootparams.js","line":186,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"We should test whether nic_tags_present is on the pool object, since it didn\u0027t exist until NAPI-403 (release-20170608)."},{"file":"lib/bootparams.js","line":186,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Im going to pull this out into a function."},{"file":"lib/bootparams.js","line":466,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Also update here and line 491"},{"file":"lib/bootparams.js","line":466,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"bin/dhcpd","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"config.json.sample","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/admin-pool-cache.js","type":"ADDED","insertions":168,"deletions":0},{"file":"lib/boot-files.js","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"lib/booter.js","type":"MODIFIED","insertions":16,"deletions":-4},{"file":"lib/bootparams.js","type":"MODIFIED","insertions":145,"deletions":-58},{"file":"lib/cache.js","type":"MODIFIED","insertions":55,"deletions":0},{"file":"lib/dhcp.js","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"lib/dhcpd.js","type":"MODIFIED","insertions":142,"deletions":-22},{"file":"lib/json-file.js","type":"MODIFIED","insertions":37,"deletions":-5},{"file":"lib/net-file.js","type":"MODIFIED","insertions":16,"deletions":-10},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":0},{"file":"sapi_manifests/dhcpd/template","type":"MODIFIED","insertions":4,"deletions":0},{"file":"server.js","type":"MODIFIED","insertions":34,"deletions":-3},{"file":"test/bootparams.test.js","type":"MODIFIED","insertions":168,"deletions":-11},{"file":"test/lib/file.js","type":"MODIFIED","insertions":23,"deletions":-3},{"file":"test/lib/mocks.js","type":"MODIFIED","insertions":12,"deletions":-1},{"file":"test/lib/server.js","type":"MODIFIED","insertions":53,"deletions":-22},{"file":"tools/jsl.node.conf","type":"MODIFIED","insertions":1,"deletions":0}],"sizeInsertions":893,"sizeDeletions":-146},{"number":"15","revision":"9c599c9b45fa9418f649b3f5b96b29d42689ed2e","parents":["595aa8e96070a84704dc322a4ba7b747e4965dca"],"ref":"refs/changes/69/3169/15","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1532128798,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1532129025,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1532128829,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"bin/dhcpd","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"config.json.sample","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/admin-pool-cache.js","type":"ADDED","insertions":168,"deletions":0},{"file":"lib/boot-files.js","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"lib/booter.js","type":"MODIFIED","insertions":16,"deletions":-4},{"file":"lib/bootparams.js","type":"MODIFIED","insertions":141,"deletions":-58},{"file":"lib/cache.js","type":"MODIFIED","insertions":55,"deletions":0},{"file":"lib/dhcp.js","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"lib/dhcpd.js","type":"MODIFIED","insertions":142,"deletions":-22},{"file":"lib/json-file.js","type":"MODIFIED","insertions":37,"deletions":-5},{"file":"lib/net-file.js","type":"MODIFIED","insertions":16,"deletions":-10},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":0},{"file":"sapi_manifests/dhcpd/template","type":"MODIFIED","insertions":4,"deletions":0},{"file":"server.js","type":"MODIFIED","insertions":34,"deletions":-3},{"file":"test/bootparams.test.js","type":"MODIFIED","insertions":168,"deletions":-11},{"file":"test/lib/file.js","type":"MODIFIED","insertions":23,"deletions":-3},{"file":"test/lib/mocks.js","type":"MODIFIED","insertions":12,"deletions":-1},{"file":"test/lib/server.js","type":"MODIFIED","insertions":53,"deletions":-22},{"file":"tools/jsl.node.conf","type":"MODIFIED","insertions":1,"deletions":0}],"sizeInsertions":889,"sizeDeletions":-146},{"number":"16","revision":"8f7b0c1cec86e74a4dbd7329263151d065bfd7b3","parents":["595aa8e96070a84704dc322a4ba7b747e4965dca"],"ref":"refs/changes/69/3169/16","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1532542811,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1532542841,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"config.json.sample","line":20,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Should this name match  sapi_manifests/dhcpd/template ?"},{"file":"config.json.sample","line":20,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"},{"file":"lib/admin-pool-cache.js","line":62,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Commented out code?"},{"file":"lib/admin-pool-cache.js","line":62,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"},{"file":"lib/admin-pool-cache.js","line":116,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"I\u0027m not sure I understand the context here.  Isn\u0027t not having an admin network pool an invalid state where we might prefer what is in the cache? Or is this for when there is no *pool*, but is a vanilla network?"},{"file":"lib/admin-pool-cache.js","line":116,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"This is when there is no pool.  So we clear out the cache."},{"file":"lib/admin-pool-cache.js","line":137,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"minor: Is there anything else we will wish we were including here when debugging a problem?  eg in cache.js there is self.log.info(\u0027cache refresh for %d items in %d ms\u0027"},{"file":"lib/admin-pool-cache.js","line":137,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"There\u0027s really only 1 item to update and that is the admin pool.  If we are worried about latency we could issue sdc-napi /network_pools?name\u003dadmin to validate or assuage that concern."},{"file":"lib/bootparams.js","line":234,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"minor: Can this message specify which bootNic was not found, where it looked, or who asked for it?  I\u0027m unsure of the level.  Is this routinely masked by what we check next (in which case debug might be a more appropriate level), or a waning that should be investigated?"},{"file":"lib/bootparams.js","line":234,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"I updated the message and moved it to debug."},{"file":"lib/cache.js","line":17,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"nit: Retain import sorting."},{"file":"lib/cache.js","line":17,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"},{"file":"server.js","line":37,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Maybe poolCache or adminPoolCache would be clearer name, since there are two caches in play."},{"file":"server.js","line":37,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Done"},{"file":"server.js","line":53,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"I\u0027m trying to think this through in light of the problem we tried to fix in HEAD-2207.  Specifically if napi or cnapi are down, we still want to be able to boot CNs.  Particularly if those CNs are the ones where napi or cnapi reside!  If we kill the server when the initial cache load fails we can\u0027t do that.\n\nWhat would the consequences be of starting with a stale cache?"},{"file":"server.js","line":53,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"The cache file would simply be empty, and we\u0027d drive on.  Unless of course it was already created and booter just restarted in which case it should leave the existing cache file alone.\n\nTo be clear, you\u0027re referring to subsequent CN boots, right.  AFAIK, unless all of the networking configuration is pre-loaded via napi and cnapi we cannot complete an initial boot of a CN with them down."},{"file":"server.js","line":53,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"\u003e The cache file would simply be empty, and we\u0027d drive on.\n\nIsn\u0027t there a  throw err --\u003e process.exit in this block?\n\n\u003e To be clear, you\u0027re referring to subsequent CN boots, right.\n\nCorrect a 2nd or later boot.  Not trying to *setup* a CN."},{"file":"server.js","line":53,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Yes, but admin-pool-cache.update() won\u0027t pass a non-null err in the event of a napi failure.  It just logs it and moves on.  \n\nSee admin-pool-cache.js:92."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"bin/dhcpd","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"config.json.sample","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/admin-pool-cache.js","type":"ADDED","insertions":168,"deletions":0},{"file":"lib/boot-files.js","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"lib/booter.js","type":"MODIFIED","insertions":16,"deletions":-4},{"file":"lib/bootparams.js","type":"MODIFIED","insertions":141,"deletions":-58},{"file":"lib/cache.js","type":"MODIFIED","insertions":55,"deletions":0},{"file":"lib/dhcp.js","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"lib/dhcpd.js","type":"MODIFIED","insertions":142,"deletions":-22},{"file":"lib/json-file.js","type":"MODIFIED","insertions":37,"deletions":-5},{"file":"lib/net-file.js","type":"MODIFIED","insertions":16,"deletions":-10},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"sapi_manifests/dhcpd/template","type":"MODIFIED","insertions":4,"deletions":0},{"file":"server.js","type":"MODIFIED","insertions":34,"deletions":-3},{"file":"test/bootparams.test.js","type":"MODIFIED","insertions":168,"deletions":-11},{"file":"test/lib/file.js","type":"MODIFIED","insertions":23,"deletions":-3},{"file":"test/lib/mocks.js","type":"MODIFIED","insertions":12,"deletions":-1},{"file":"test/lib/server.js","type":"MODIFIED","insertions":53,"deletions":-22},{"file":"tools/jsl.node.conf","type":"MODIFIED","insertions":1,"deletions":0}],"sizeInsertions":890,"sizeDeletions":-147},{"number":"17","revision":"76cdc6e5f93c7873e44d784479f90c649d13c859","parents":["595aa8e96070a84704dc322a4ba7b747e4965dca"],"ref":"refs/changes/69/3169/17","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1532633283,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1532633311,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"bin/dhcpd","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"config.json.sample","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"lib/admin-pool-cache.js","type":"ADDED","insertions":163,"deletions":0},{"file":"lib/boot-files.js","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"lib/booter.js","type":"MODIFIED","insertions":16,"deletions":-4},{"file":"lib/bootparams.js","type":"MODIFIED","insertions":144,"deletions":-59},{"file":"lib/cache.js","type":"MODIFIED","insertions":55,"deletions":0},{"file":"lib/dhcp.js","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"lib/dhcpd.js","type":"MODIFIED","insertions":142,"deletions":-22},{"file":"lib/json-file.js","type":"MODIFIED","insertions":39,"deletions":-7},{"file":"lib/net-file.js","type":"MODIFIED","insertions":17,"deletions":-11},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"sapi_manifests/dhcpd/template","type":"MODIFIED","insertions":4,"deletions":0},{"file":"server.js","type":"MODIFIED","insertions":34,"deletions":-3},{"file":"test/bootparams.test.js","type":"MODIFIED","insertions":168,"deletions":-11},{"file":"test/lib/file.js","type":"MODIFIED","insertions":24,"deletions":-3},{"file":"test/lib/mocks.js","type":"MODIFIED","insertions":12,"deletions":-1},{"file":"test/lib/server.js","type":"MODIFIED","insertions":53,"deletions":-22},{"file":"tools/jsl.node.conf","type":"MODIFIED","insertions":1,"deletions":0}],"sizeInsertions":895,"sizeDeletions":-151},{"number":"18","revision":"bbad1b8023e034e2dce4fc1acdb3661513ae8f10","parents":["595aa8e96070a84704dc322a4ba7b747e4965dca"],"ref":"refs/changes/69/3169/18","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1532710923,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1532710951,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1532713730,"by":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1532713730,"by":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"bin/dhcpd","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"config.json.sample","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"lib/admin-pool-cache.js","type":"ADDED","insertions":163,"deletions":0},{"file":"lib/boot-files.js","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"lib/booter.js","type":"MODIFIED","insertions":16,"deletions":-4},{"file":"lib/bootparams.js","type":"MODIFIED","insertions":144,"deletions":-59},{"file":"lib/cache.js","type":"MODIFIED","insertions":55,"deletions":0},{"file":"lib/dhcp.js","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"lib/dhcpd.js","type":"MODIFIED","insertions":142,"deletions":-22},{"file":"lib/json-file.js","type":"MODIFIED","insertions":39,"deletions":-7},{"file":"lib/net-file.js","type":"MODIFIED","insertions":17,"deletions":-11},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"sapi_manifests/dhcpd/template","type":"MODIFIED","insertions":4,"deletions":0},{"file":"server.js","type":"MODIFIED","insertions":34,"deletions":-3},{"file":"test/bootparams.test.js","type":"MODIFIED","insertions":168,"deletions":-11},{"file":"test/lib/file.js","type":"MODIFIED","insertions":24,"deletions":-3},{"file":"test/lib/mocks.js","type":"MODIFIED","insertions":12,"deletions":-1},{"file":"test/lib/server.js","type":"MODIFIED","insertions":53,"deletions":-22},{"file":"tools/jsl.node.conf","type":"MODIFIED","insertions":1,"deletions":0}],"sizeInsertions":895,"sizeDeletions":-151},{"number":"19","revision":"384214d49dd5deb78c84603f0f606367411c859e","parents":["595aa8e96070a84704dc322a4ba7b747e4965dca"],"ref":"refs/changes/69/3169/19","uploader":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"createdOn":1532714425,"author":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1532710951,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1532713730,"by":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1532713730,"by":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"}},{"type":"SUBM","value":"1","grantedOn":1532714563,"by":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":12,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"bin/dhcpd","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"config.json.sample","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"lib/admin-pool-cache.js","type":"ADDED","insertions":163,"deletions":0},{"file":"lib/boot-files.js","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"lib/booter.js","type":"MODIFIED","insertions":16,"deletions":-4},{"file":"lib/bootparams.js","type":"MODIFIED","insertions":144,"deletions":-59},{"file":"lib/cache.js","type":"MODIFIED","insertions":55,"deletions":0},{"file":"lib/dhcp.js","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"lib/dhcpd.js","type":"MODIFIED","insertions":142,"deletions":-22},{"file":"lib/json-file.js","type":"MODIFIED","insertions":39,"deletions":-7},{"file":"lib/net-file.js","type":"MODIFIED","insertions":17,"deletions":-11},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"sapi_manifests/dhcpd/template","type":"MODIFIED","insertions":4,"deletions":0},{"file":"server.js","type":"MODIFIED","insertions":34,"deletions":-3},{"file":"test/bootparams.test.js","type":"MODIFIED","insertions":168,"deletions":-11},{"file":"test/lib/file.js","type":"MODIFIED","insertions":24,"deletions":-3},{"file":"test/lib/mocks.js","type":"MODIFIED","insertions":12,"deletions":-1},{"file":"test/lib/server.js","type":"MODIFIED","insertions":53,"deletions":-22},{"file":"tools/jsl.node.conf","type":"MODIFIED","insertions":1,"deletions":0}],"sizeInsertions":895,"sizeDeletions":-151}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"}]}