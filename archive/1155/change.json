{"project":"joyent/binder","branch":"master","id":"Ic4a893bfeca9b2f45492b7062224b5171fdd9c4a","number":"1155","subject":"MANTA-3064 binder not serving host TTLs properly Reviewed by: David Pacheco \u003cdap@joyent.com\u003e","owner":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"url":"https://cr.joyent.us/1155","commitMessage":"MANTA-3064 binder not serving host TTLs properly\nReviewed by: David Pacheco \u003cdap@joyent.com\u003e\n","createdOn":1482348807,"lastUpdated":1482351962,"open":false,"status":"MERGED","comments":[{"timestamp":1482348807,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 1."},{"timestamp":1482348844,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1482349305,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 1:\n\n(2 comments)"},{"timestamp":1482350426,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 2."},{"timestamp":1482350458,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1482351262,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 2:\n\n(2 comments)"},{"timestamp":1482351483,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 2: Code-Review+1\n\nIt sounds from Alex like this would have blown up in those cases anyway."},{"timestamp":1482351586,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 3: Commit message was updated."},{"timestamp":1482351960,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 3: Integration-Approval+1"},{"timestamp":1482351962,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Alex Wilson"}],"currentPatchSet":{"number":"3","revision":"6fb3b95b91fa9a3585448060a6f4f04327103c6c","parents":["0f325f906446e153dd19049e6147177625ab3cdd"],"ref":"refs/changes/55/1155/3","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1482351586,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1482350458,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1482351483,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1482351960,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"SUBM","value":"1","grantedOn":1482351962,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"lib/server.js","type":"MODIFIED","insertions":55,"deletions":-6}],"sizeInsertions":55,"sizeDeletions":-6},"patchSets":[{"number":"1","revision":"6ca228169e9dc523911dfd42521f0dc9eff481ee","parents":["0f325f906446e153dd19049e6147177625ab3cdd"],"ref":"refs/changes/55/1155/1","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1482348807,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1482348844,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/server.js","line":180,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Could we add a comment summarizing the current TTL behavior (for both \"ttl\" and \"rttl\")?"},{"file":"lib/server.js","line":219,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Is there any chance that \"s\" would be undefined or null here?"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/server.js","type":"MODIFIED","insertions":12,"deletions":-4}],"sizeInsertions":12,"sizeDeletions":-4},{"number":"2","revision":"c4a893bfeca9b2f45492b7062224b5171fdd9c4a","parents":["0f325f906446e153dd19049e6147177625ab3cdd"],"ref":"refs/changes/55/1155/2","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1482350426,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1482351483,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1482350458,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/server.js","line":175,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I\u0027d already convinced myself that if \"record.type\" was null or undefined, we already would have blown up.  It\u0027s certainly better to validate as you have here, but in terms of reasoning about risk: I\u0027m wondering if anything could have been working by accident with a record.type that was not a string, or for which record[record.type] was not a valid object.  It seems like the existing code tried to avoid blowing up in exactly that case, though if I\u0027m reading it right, it would have logged an error at line 283 (in the old code) and not sent a response.  If that\u0027s the case, this may be not break anything that was working by accident.  What do you think?\n\nI think line 175 is redundant with line 177, but that\u0027s not a big deal."},{"file":"lib/server.js","line":237,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Similarly, I think the old code would have ignored the case where \"s\" was undefined or null, and I\u0027m not sure if this would break anything that was working by accident."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/server.js","type":"MODIFIED","insertions":55,"deletions":-6}],"sizeInsertions":55,"sizeDeletions":-6},{"number":"3","revision":"6fb3b95b91fa9a3585448060a6f4f04327103c6c","parents":["0f325f906446e153dd19049e6147177625ab3cdd"],"ref":"refs/changes/55/1155/3","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1482351586,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1482351483,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1482351960,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"SUBM","value":"1","grantedOn":1482351962,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1482350458,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"lib/server.js","type":"MODIFIED","insertions":55,"deletions":-6}],"sizeInsertions":55,"sizeDeletions":-6}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}]}