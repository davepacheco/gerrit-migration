commit 1350b858fb885136443cf588e9b8549377331995 (refs/changes/38/2138/1)
Author: Isaac Davis <isaac.davis@joyent.com>
Date:   2017-06-22T20:27:40+00:00 (2 years, 4 months ago)
    
    OS-6203 VM.lookup breaks if "options" argument is empty

diff --git a/src/vm/node_modules/VM.js b/src/vm/node_modules/VM.js
index 3ce23319..f97bfe84 100644
--- a/src/vm/node_modules/VM.js
+++ b/src/vm/node_modules/VM.js
@@ -1476,7 +1476,6 @@ exports.lookup = function (search, options, callback)
     var key;
     var matches;
     var need_fields = [];
-    var results = [];
     var tracers_obj;
     var transform;
 
@@ -1559,8 +1558,7 @@ exports.lookup = function (search, options, callback)
 
     lookup_opts = {log: log, fields: need_fields};
     vmload.getVmobjs(lookupFilter, lookup_opts, function gotVMs(err, vmobjs) {
-        var r;
-        var short_results = [];
+        var short_results;
 
         if (err) {
             callback(err);
@@ -1589,9 +1587,9 @@ exports.lookup = function (search, options, callback)
                 }
             }));
         } else {
-            for (r in vmobjs) {
-                short_results.push(results[r].uuid);
-            }
+            short_results = vmobjs.map(function (vmobj) {
+                return vmobj.uuid;
+            });
             callback(null, short_results);
         }
     });
