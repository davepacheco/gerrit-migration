From 620ea803d2df7ad5681f0f95be4a5babdee1dc64 Mon Sep 17 00:00:00 2001
From: Jan Wyszynski <jan.wyszynski@joyent.com>
Date: Mon, 16 Oct 2017 18:30:54 +0000
Subject: [PATCH] joyent/node-manta#332 Add support for Content-Encoding for
 objects

---
 bin/mmpu      | 3 ++-
 lib/client.js | 5 +++++
 2 files changed, 7 insertions(+), 1 deletion(-)

diff --git a/bin/mmpu b/bin/mmpu
index 306e00a..60ddc8a 100755
--- a/bin/mmpu
+++ b/bin/mmpu
@@ -154,7 +154,8 @@ MMpu.prototype.do_create = function do_create(subcmd, opts, args, cb) {
         account: opts.account,
         md5: opts.md5,
         copies: opts.copies,
-        size: opts.size
+        size: opts.size,
+        encoding: opts.encoding
     };
 
     client.createUpload(objectPath, createUploadOpts, function (err, obj) {
diff --git a/lib/client.js b/lib/client.js
index ba0495a..36d93f9 100644
--- a/lib/client.js
+++ b/lib/client.js
@@ -3405,6 +3405,7 @@ MantaClient.prototype.createUpload = function createUpload(p, opts, cb) {
     assert.optionalNumber(opts.copies, 'opts.copies');
     assert.optionalNumber(opts.size, 'opts.size');
     assert.optionalString(opts.md5, 'opts.md5');
+    assert.optionalString(opts.encoding, 'opts.encoding');
     assert.func(cb, 'callback');
 
     var self = this;
@@ -3454,6 +3455,10 @@ MantaClient.prototype.createUpload = function createUpload(p, opts, cb) {
             targetObjectHeaders['content-md5'] = opts.md5;
         }
 
+        if (opts.encoding) {
+            targetObjectHeaders['content-encoding'] = opts.encoding;
+        }
+
         var log = self.log.child({
             path: url,
             req_id: options.id
-- 
2.21.0

