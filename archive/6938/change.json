{"project":"joyent/smartos-live","branch":"master","id":"Icd7639473bdbbdbc55ba6de3f364f9af0687da63","number":"6938","subject":"TRITON-1908 create bhyve vm update tests Reviewed by: Mike Gerdts \u003cmike.gerdts@joyent.com\u003e Approved by: Mike Gerdts \u003cmike.gerdts@joyent.com\u003e","owner":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"url":"https://cr.joyent.us/6938","commitMessage":"TRITON-1908 create bhyve vm update tests\nReviewed by: Mike Gerdts \u003cmike.gerdts@joyent.com\u003e\nApproved by: Mike Gerdts \u003cmike.gerdts@joyent.com\u003e\n","createdOn":1569618738,"lastUpdated":1570478720,"open":false,"status":"MERGED","comments":[{"timestamp":1569618738,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Uploaded patch set 1."},{"timestamp":1569618740,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit 91887eeed7b4a38d7f704e66d9d7fdfe0c3feb12\n    \n    TRITON-1908 create bhyve vm update tests"},{"timestamp":1569618829,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1569867709,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Uploaded patch set 2: Patch Set 1 was rebased."},{"timestamp":1569867710,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit 5b953ac7be7e3e0fd27fd8c8332aa07ae41d1e6a\n    \n    TRITON-1908 create bhyve vm update tests"},{"timestamp":1569867800,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2:\n\n\"make check\" passed ok"},{"timestamp":1570219145,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 2:\n\n(7 comments)\n\nSince this is a slightly modified copy of the same tests for kvm, is there a way we could structure this such that we have one copy that is shared between kvm and bhyve?\n\nFWIW, almost all of my criticisms of this were inherited from the KVM variant."},{"timestamp":1570219946,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Patch Set 2:\n\nI did think about sharing these - but if we eventually want to drop (or not support KVM anymore) I thought it would be prudent to keep it separate.\n\nFor the long lines (and other syntax checks), I discovered at the beginning of the week that make check wasn\u0027t covering the \u0027test-update-kvm.js\u0027 file, and once I added checking (and the new test-update-bhyve.js file) I hit hundreds of errors - I have a pending change that fixes the syntax parts (I just didn\u0027t want it in the initial review/pass for the noise it creates - I\u0027ll push it up here at the end of the review)."},{"timestamp":1570220587,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Uploaded patch set 3."},{"timestamp":1570220589,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Patch Set 3:\n\nNew commits:\n    \n    commit 1434ba92df8e1c92d5388f116ed25c57180b6643\n    \n    add syntax checking for test-update js files"},{"timestamp":1570220636,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Patch Set 3:\n\nFYI - patch set 3 was the syntax checking changes."},{"timestamp":1570220681,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1570222122,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Uploaded patch set 4."},{"timestamp":1570222123,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Patch Set 4:\n\nNew commits:\n    \n    commit 2b651a7854150fb32e0e61cd2987599b9c5c9a37\n    \n    updates from code review"},{"timestamp":1570222168,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Uploaded patch set 5: Patch Set 4 was rebased."},{"timestamp":1570222170,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Patch Set 5:\n\nNew commits:\n    \n    commit 51dec251ffa583b03d6cb0cd8ea4dfdf285708e1\n    \n    updates from code review\n    \n    commit 26090b3a2509c04476e28a7b2327cb5ab3644d0e\n    \n    add syntax checking for test-update js files\n    \n    commit 56084155e474bea734718e89a234de628a2f5ee6\n    \n    TRITON-1908 create bhyve vm update tests"},{"timestamp":1570222191,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Patch Set 2:\n\n(7 comments)"},{"timestamp":1570222214,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1570222258,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1570222884,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 5:\n\n(2 comments)"},{"timestamp":1570226634,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Patch Set 5:\n\n(2 comments)"},{"timestamp":1570226641,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Uploaded patch set 6."},{"timestamp":1570226642,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Patch Set 6:\n\nNew commits:\n    \n    commit c16686454c086a5fe91d4b0bd08b1c9ed617836c\n    \n    correct err variables names"},{"timestamp":1570226732,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 6: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1570461155,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 6: Code-Review+1\n\nTests passed before tons of changes.  They still pass, right?"},{"timestamp":1570470306,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Patch Set 6:\n\nYes, tests still pass for me:\n\ntest-update-kvm.js\n# tests 123\n# pass  123\n\ntest-update-bhyve.js\n# tests 95\n# pass  95"},{"timestamp":1570478090,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 6: Integration-Approval+1"},{"timestamp":1570478711,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Uploaded patch set 7: Commit message was updated."},{"timestamp":1570478720,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Todd Whiteman"}],"currentPatchSet":{"number":"7","revision":"cd7639473bdbbdbc55ba6de3f364f9af0687da63","parents":["a11a7d0bed2c1854959846700bf7739983094826"],"ref":"refs/changes/38/6938/7","uploader":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"createdOn":1570478711,"author":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1570226732,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1570461155,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1570478090,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}},{"type":"SUBM","value":"1","grantedOn":1570478720,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"src/Makefile","type":"MODIFIED","insertions":2,"deletions":0},{"file":"src/vm/tests/test-update-bhyve.js","type":"ADDED","insertions":1125,"deletions":0},{"file":"src/vm/tests/test-update-kvm.js","type":"MODIFIED","insertions":370,"deletions":-259}],"sizeInsertions":1497,"sizeDeletions":-259},"patchSets":[{"number":"1","revision":"de8e24ef597dc99e88005450ccd7c17133a68c0c","parents":["4dd1ea34fabfe06f126c63b2446f799c2728f0cc"],"ref":"refs/changes/38/6938/1","uploader":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"createdOn":1569618738,"author":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1569618829,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/vm/tests/test-update-bhyve.js","type":"ADDED","insertions":1035,"deletions":0}],"sizeInsertions":1035,"sizeDeletions":0},{"number":"2","revision":"de64f320b8d11cd153868f37f2cf263142b1b3c5","parents":["1fcc5743c47ccdfb35edc18128f28efe977089c1"],"ref":"refs/changes/38/6938/2","uploader":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"createdOn":1569867709,"author":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1569618829,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"src/vm/tests/test-update-bhyve.js","line":170,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"here and other places: we generally use lower-case for bhyve."},{"file":"src/vm/tests/test-update-bhyve.js","line":170,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Done"},{"file":"src/vm/tests/test-update-bhyve.js","line":193,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"+ err.message?"},{"file":"src/vm/tests/test-update-bhyve.js","line":193,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Done"},{"file":"src/vm/tests/test-update-bhyve.js","line":219,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"+ err.message\n\nThere are many occurrences of the same pattern below that should be fixed as well."},{"file":"src/vm/tests/test-update-bhyve.js","line":219,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Done"},{"file":"src/vm/tests/test-update-bhyve.js","line":263,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"long line"},{"file":"src/vm/tests/test-update-bhyve.js","line":263,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Done"},{"file":"src/vm/tests/test-update-bhyve.js","line":296,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"long line"},{"file":"src/vm/tests/test-update-bhyve.js","line":296,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Done"},{"file":"src/vm/tests/test-update-bhyve.js","line":365,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Some more long lines here.\n\nThere are many other lines that are too long below.  I\u0027ll not add any more comments for lines that need to be wrapped."},{"file":"src/vm/tests/test-update-bhyve.js","line":365,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Done"},{"file":"src/vm/tests/test-update-bhyve.js","line":839,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"I\u0027ve seen this test fail on KVM when compression!\u003doff on zones. To prevent this, the payload that creates the VM could be explicit in setting compression\u003doff on each disk."},{"file":"src/vm/tests/test-update-bhyve.js","line":839,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/vm/tests/test-update-bhyve.js","type":"ADDED","insertions":1035,"deletions":0}],"sizeInsertions":1035,"sizeDeletions":0},{"number":"3","revision":"11a56b087d0b45dfdb12970b0fbdccdb75174976","parents":["1fcc5743c47ccdfb35edc18128f28efe977089c1"],"ref":"refs/changes/38/6938/3","uploader":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"createdOn":1570220587,"author":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1570220681,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/Makefile","type":"MODIFIED","insertions":2,"deletions":0},{"file":"src/vm/tests/test-update-bhyve.js","type":"ADDED","insertions":1125,"deletions":0},{"file":"src/vm/tests/test-update-kvm.js","type":"MODIFIED","insertions":370,"deletions":-259}],"sizeInsertions":1497,"sizeDeletions":-259},{"number":"4","revision":"c06903e7dd56fd7134382239fdaf1c3c576fb925","parents":["1fcc5743c47ccdfb35edc18128f28efe977089c1"],"ref":"refs/changes/38/6938/4","uploader":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"createdOn":1570222122,"author":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1570222214,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/Makefile","type":"MODIFIED","insertions":2,"deletions":0},{"file":"src/vm/tests/test-update-bhyve.js","type":"ADDED","insertions":1125,"deletions":0},{"file":"src/vm/tests/test-update-kvm.js","type":"MODIFIED","insertions":370,"deletions":-259}],"sizeInsertions":1497,"sizeDeletions":-259},{"number":"5","revision":"e6feac1dd49120cdf6091476176e3408f3f65fab","parents":["a11a7d0bed2c1854959846700bf7739983094826"],"ref":"refs/changes/38/6938/5","uploader":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"createdOn":1570222168,"author":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1570222258,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"src/vm/tests/test-update-bhyve.js","line":277,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"err2"},{"file":"src/vm/tests/test-update-bhyve.js","line":277,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Done - good spotting."},{"file":"src/vm/tests/test-update-bhyve.js","line":458,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"err2"},{"file":"src/vm/tests/test-update-bhyve.js","line":458,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/Makefile","type":"MODIFIED","insertions":2,"deletions":0},{"file":"src/vm/tests/test-update-bhyve.js","type":"ADDED","insertions":1125,"deletions":0},{"file":"src/vm/tests/test-update-kvm.js","type":"MODIFIED","insertions":370,"deletions":-259}],"sizeInsertions":1497,"sizeDeletions":-259},{"number":"6","revision":"10aea80f1f46bc64119d5c389921415c10054e81","parents":["a11a7d0bed2c1854959846700bf7739983094826"],"ref":"refs/changes/38/6938/6","uploader":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"createdOn":1570226641,"author":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1570226732,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1570461155,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1570478090,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/Makefile","type":"MODIFIED","insertions":2,"deletions":0},{"file":"src/vm/tests/test-update-bhyve.js","type":"ADDED","insertions":1125,"deletions":0},{"file":"src/vm/tests/test-update-kvm.js","type":"MODIFIED","insertions":370,"deletions":-259}],"sizeInsertions":1497,"sizeDeletions":-259},{"number":"7","revision":"cd7639473bdbbdbc55ba6de3f364f9af0687da63","parents":["a11a7d0bed2c1854959846700bf7739983094826"],"ref":"refs/changes/38/6938/7","uploader":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"createdOn":1570478711,"author":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1570226732,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"SUBM","value":"1","grantedOn":1570478720,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1570461155,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1570478090,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"src/Makefile","type":"MODIFIED","insertions":2,"deletions":0},{"file":"src/vm/tests/test-update-bhyve.js","type":"ADDED","insertions":1125,"deletions":0},{"file":"src/vm/tests/test-update-kvm.js","type":"MODIFIED","insertions":370,"deletions":-259}],"sizeInsertions":1497,"sizeDeletions":-259}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}]}