{"project":"joyent/illumos-joyent","branch":"master","id":"Ie4c684bd612282f2a2c7205cff55c477ef31ff1a","number":"4513","subject":"OS-7076 lx netlink msg_done only sends header Reviewed by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e Reviewed by: Mike Gerdts \u003cmike.gerdts@joyent.com\u003e Approved by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e","owner":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"url":"https://cr.joyent.us/4513","commitMessage":"OS-7076 lx netlink msg_done only sends header\nReviewed by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e\nReviewed by: Mike Gerdts \u003cmike.gerdts@joyent.com\u003e\nApproved by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e\n","createdOn":1531466480,"lastUpdated":1531509872,"open":false,"status":"MERGED","comments":[{"timestamp":1531466480,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Uploaded patch set 1."},{"timestamp":1531487896,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 1: Code-Review+1"},{"timestamp":1531491640,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 1: Integration-Approval+1"},{"timestamp":1531491758,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1531491797,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 1: Integration-Approval-1\n\ncounteracting jerry\u0027s +1 until my comment is addressed."},{"timestamp":1531492899,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1531496020,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1531501171,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Uploaded patch set 2."},{"timestamp":1531501739,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Uploaded patch set 3."},{"timestamp":1531501881,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 3: Code-Review+1 -Integration-Approval"},{"timestamp":1531507128,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1531509731,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 3: Integration-Approval+1"},{"timestamp":1531509847,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Uploaded patch set 4: Commit message was updated."},{"timestamp":1531509872,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Jason King"}],"currentPatchSet":{"number":"4","revision":"e4c684bd612282f2a2c7205cff55c477ef31ff1a","parents":["a14a61c954e512b21fc1be4a408e945f7f15df17"],"ref":"refs/changes/13/4513/4","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1531509847,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1531501881,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1531507128,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1531509731,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"SUBM","value":"1","grantedOn":1531509872,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/uts/common/brand/lx/io/lx_netlink.c","type":"MODIFIED","insertions":17,"deletions":0}],"sizeInsertions":17,"sizeDeletions":0},"patchSets":[{"number":"1","revision":"02d6d03286a313f7dd16974fe430d87ff24764fe","parents":["a14a61c954e512b21fc1be4a408e945f7f15df17"],"ref":"refs/changes/13/4513/1","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1531466480,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1531487896,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1531491640,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"-1","grantedOn":1531491797,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}}],"comments":[{"file":"usr/src/uts/common/brand/lx/io/lx_netlink.c","line":934,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Shouldn\u0027t there be a check for the message becoming too long for the buffer?   Call lx_netlink_reply_add() instead?"},{"file":"usr/src/uts/common/brand/lx/io/lx_netlink.c","line":934,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"The mblk_t should be at least lx_netlink_bufsize bytes (4096) long (see lx_netlink_reply_msg -- it uses .lxns_bufsize, which is set to lx_netlink_bufsize) -- large enough to hold the 20-byte reply.\n\nWould adding a comment stating as much (or adding an assert or verify) be better?"},{"file":"usr/src/uts/common/brand/lx/io/lx_netlink.c","line":934,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"I don\u0027t see the value in duplicating the code that already exists in lx_netlink_reply_add().  Without this change, the only code that increments (+\u003d) lxnh_len is lx_netlink_reply_add().  Frankly, I\u0027m a little confused as to why the initial part of the reply is not set with lx_netlink_reply_add(), but that\u0027s a separate issue (maybe).\n\nIf there is a reason that lx_netlink_reply_add() is the wrong tool for the job, please add appropriate error handling and a comment as to why lx_netlink_reply_add() is not suitable.  The error handling probably shouldn\u0027t panic the box for non-debug builds."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/brand/lx/io/lx_netlink.c","type":"MODIFIED","insertions":11,"deletions":-1}],"sizeInsertions":11,"sizeDeletions":-1},{"number":"2","revision":"c952ad1846a34c748ad29b5fa57f3d3bd4a1decb","parents":["a14a61c954e512b21fc1be4a408e945f7f15df17"],"ref":"refs/changes/13/4513/2","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1531501171,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Integration-Approval","description":"Integration-Approval","value":"-1","grantedOn":1531491797,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/brand/lx/io/lx_netlink.c","type":"MODIFIED","insertions":18,"deletions":-1}],"sizeInsertions":18,"sizeDeletions":-1},{"number":"3","revision":"82c638329754df2457181929324235d9badaf945","parents":["a14a61c954e512b21fc1be4a408e945f7f15df17"],"ref":"refs/changes/13/4513/3","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1531501739,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1531507128,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1531509731,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1531501881,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/brand/lx/io/lx_netlink.c","type":"MODIFIED","insertions":17,"deletions":0}],"sizeInsertions":17,"sizeDeletions":0},{"number":"4","revision":"e4c684bd612282f2a2c7205cff55c477ef31ff1a","parents":["a14a61c954e512b21fc1be4a408e945f7f15df17"],"ref":"refs/changes/13/4513/4","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1531509847,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1531507128,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1531509731,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"SUBM","value":"1","grantedOn":1531509872,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1531501881,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/uts/common/brand/lx/io/lx_netlink.c","type":"MODIFIED","insertions":17,"deletions":0}],"sizeInsertions":17,"sizeDeletions":0}],"allReviewers":[{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}]}