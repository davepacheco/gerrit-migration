{"project":"joyent/sdc-net-agent","branch":"master","id":"Ic5f4af1d15c16e5a8c6a3722ef723f88a6488bee","number":"6218","subject":"TRITON-1413 Move common patterns in net-agent into helper functions Reviewed by: Alex Wilson \u003calex.wilson@joyent.com\u003e Approved by: Alex Wilson \u003calex.wilson@joyent.com\u003e","owner":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"url":"https://cr.joyent.us/6218","commitMessage":"TRITON-1413 Move common patterns in net-agent into helper functions\nReviewed by: Alex Wilson \u003calex.wilson@joyent.com\u003e\nApproved by: Alex Wilson \u003calex.wilson@joyent.com\u003e\n","createdOn":1557361650,"lastUpdated":1558383324,"open":false,"status":"MERGED","comments":[{"timestamp":1557361650,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 1."},{"timestamp":1557361693,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1557435924,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 2."},{"timestamp":1557435964,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1557511298,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 3."},{"timestamp":1557511338,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1557511455,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 4: Patch Set 3 was rebased."},{"timestamp":1557511500,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4:\n\n\"make check\" passed ok"},{"timestamp":1557866416,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 5: Patch Set 4 was rebased."},{"timestamp":1557866456,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5:\n\n\"make check\" passed ok"},{"timestamp":1558049591,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 5:\n\n(3 comments)"},{"timestamp":1558120355,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 6."},{"timestamp":1558120395,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 6: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1558120416,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 6:\n\n(3 comments)\n\nI\u0027m making a new build of net-agent now, and then I\u0027ll rerun the tests."},{"timestamp":1558383234,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 6: Code-Review+1 Integration-Approval+1"},{"timestamp":1558383289,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 7: Commit message was updated."},{"timestamp":1558383324,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Cody Peter Mello"}],"currentPatchSet":{"number":"7","revision":"3459512f2f640da44537abc8a25253d948213725","parents":["2c1ad49dffeffabb665ff0ac824eb4c760929c10"],"ref":"refs/changes/18/6218/7","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1558383289,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1558120395,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1558383234,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1558383234,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"SUBM","value":"1","grantedOn":1558383324,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/aggr-fsm.js","type":"MODIFIED","insertions":16,"deletions":-65},{"file":"lib/common.js","type":"MODIFIED","insertions":83,"deletions":-1},{"file":"lib/inst-fsm.js","type":"MODIFIED","insertions":13,"deletions":-33},{"file":"lib/net-agent.js","type":"MODIFIED","insertions":16,"deletions":-26},{"file":"lib/net-fsm.js","type":"MODIFIED","insertions":12,"deletions":-24},{"file":"lib/nic-fsm.js","type":"MODIFIED","insertions":18,"deletions":-71},{"file":"lib/server-fsm.js","type":"MODIFIED","insertions":7,"deletions":-12},{"file":"lib/utils.js","type":"DELETED","insertions":0,"deletions":-30},{"file":"lib/vmadm-watcher-fsm.js","type":"MODIFIED","insertions":99,"deletions":-151},{"file":"lib/watcher-fsm.js","type":"MODIFIED","insertions":8,"deletions":-38},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":273,"sizeDeletions":-452},"patchSets":[{"number":"1","revision":"d4248523c646b974039ec9f834244f40af8dbbb7","parents":["be5ac64948db0a51d7a0f286b17cb8b2288fe929"],"ref":"refs/changes/18/6218/1","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1557361650,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1557361693,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/aggr-fsm.js","type":"MODIFIED","insertions":16,"deletions":-65},{"file":"lib/common.js","type":"MODIFIED","insertions":85,"deletions":0},{"file":"lib/inst-fsm.js","type":"MODIFIED","insertions":13,"deletions":-33},{"file":"lib/net-agent.js","type":"MODIFIED","insertions":16,"deletions":-26},{"file":"lib/net-fsm.js","type":"MODIFIED","insertions":12,"deletions":-24},{"file":"lib/nic-fsm.js","type":"MODIFIED","insertions":22,"deletions":-72},{"file":"lib/server-fsm.js","type":"MODIFIED","insertions":7,"deletions":-12},{"file":"lib/utils.js","type":"DELETED","insertions":0,"deletions":-30},{"file":"lib/vmadm-watcher-fsm.js","type":"MODIFIED","insertions":102,"deletions":-143},{"file":"lib/watcher-fsm.js","type":"MODIFIED","insertions":8,"deletions":-38}],"sizeInsertions":281,"sizeDeletions":-443},{"number":"2","revision":"a8cbd9b82b4a47600408e5e7028381f4e038309c","parents":["be5ac64948db0a51d7a0f286b17cb8b2288fe929"],"ref":"refs/changes/18/6218/2","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1557435924,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1557435964,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/aggr-fsm.js","type":"MODIFIED","insertions":16,"deletions":-65},{"file":"lib/common.js","type":"MODIFIED","insertions":85,"deletions":0},{"file":"lib/inst-fsm.js","type":"MODIFIED","insertions":13,"deletions":-33},{"file":"lib/net-agent.js","type":"MODIFIED","insertions":16,"deletions":-26},{"file":"lib/net-fsm.js","type":"MODIFIED","insertions":12,"deletions":-24},{"file":"lib/nic-fsm.js","type":"MODIFIED","insertions":18,"deletions":-71},{"file":"lib/server-fsm.js","type":"MODIFIED","insertions":7,"deletions":-12},{"file":"lib/utils.js","type":"DELETED","insertions":0,"deletions":-30},{"file":"lib/vmadm-watcher-fsm.js","type":"MODIFIED","insertions":102,"deletions":-143},{"file":"lib/watcher-fsm.js","type":"MODIFIED","insertions":8,"deletions":-38}],"sizeInsertions":277,"sizeDeletions":-442},{"number":"3","revision":"f2fb4b009c799e463513526fb5274877f803c850","parents":["be5ac64948db0a51d7a0f286b17cb8b2288fe929"],"ref":"refs/changes/18/6218/3","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1557511298,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1557511338,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/aggr-fsm.js","type":"MODIFIED","insertions":16,"deletions":-65},{"file":"lib/common.js","type":"MODIFIED","insertions":66,"deletions":0},{"file":"lib/inst-fsm.js","type":"MODIFIED","insertions":13,"deletions":-33},{"file":"lib/net-agent.js","type":"MODIFIED","insertions":16,"deletions":-26},{"file":"lib/net-fsm.js","type":"MODIFIED","insertions":12,"deletions":-24},{"file":"lib/nic-fsm.js","type":"MODIFIED","insertions":18,"deletions":-71},{"file":"lib/server-fsm.js","type":"MODIFIED","insertions":7,"deletions":-12},{"file":"lib/utils.js","type":"DELETED","insertions":0,"deletions":-30},{"file":"lib/vmadm-watcher-fsm.js","type":"MODIFIED","insertions":102,"deletions":-143},{"file":"lib/watcher-fsm.js","type":"MODIFIED","insertions":8,"deletions":-38},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":259,"sizeDeletions":-443},{"number":"4","revision":"9a5773242714e7f01d2aa74f4520874c164752be","parents":["f18e6bace910d2c7f05897dfc7bb46237fd16c4f"],"ref":"refs/changes/18/6218/4","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1557511455,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1557511338,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/aggr-fsm.js","type":"MODIFIED","insertions":16,"deletions":-65},{"file":"lib/common.js","type":"MODIFIED","insertions":66,"deletions":0},{"file":"lib/inst-fsm.js","type":"MODIFIED","insertions":13,"deletions":-33},{"file":"lib/net-agent.js","type":"MODIFIED","insertions":16,"deletions":-26},{"file":"lib/net-fsm.js","type":"MODIFIED","insertions":12,"deletions":-24},{"file":"lib/nic-fsm.js","type":"MODIFIED","insertions":18,"deletions":-71},{"file":"lib/server-fsm.js","type":"MODIFIED","insertions":7,"deletions":-12},{"file":"lib/utils.js","type":"DELETED","insertions":0,"deletions":-30},{"file":"lib/vmadm-watcher-fsm.js","type":"MODIFIED","insertions":102,"deletions":-143},{"file":"lib/watcher-fsm.js","type":"MODIFIED","insertions":8,"deletions":-38},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":259,"sizeDeletions":-443},{"number":"5","revision":"fe8baaa2fff18a7ed1f23b5a09127206faa6d81f","parents":["2c1ad49dffeffabb665ff0ac824eb4c760929c10"],"ref":"refs/changes/18/6218/5","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1557866416,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1557511338,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/common.js","line":64,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Would it be useful to store the last 8 or something timestamps when we fired these events for debugging? Now that it\u0027s all handled in a common place here it seems easier to add a feature like that, and maybe it would be useful in a core file?"},{"file":"lib/common.js","line":64,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Sure. I\u0027ve added that below."},{"file":"lib/vmadm-watcher-fsm.js","line":89,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Is there any point making a closure here now instead of just supplying  this.handleEvent.bind(this)  as the handler below?"},{"file":"lib/vmadm-watcher-fsm.js","line":89,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Done"},{"file":"lib/vmadm-watcher-fsm.js","line":255,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Why not do the body of this function above where we call this?"},{"file":"lib/vmadm-watcher-fsm.js","line":255,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Sure. I\u0027ve updated the several placed where it\u0027s called."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/aggr-fsm.js","type":"MODIFIED","insertions":16,"deletions":-65},{"file":"lib/common.js","type":"MODIFIED","insertions":66,"deletions":0},{"file":"lib/inst-fsm.js","type":"MODIFIED","insertions":13,"deletions":-33},{"file":"lib/net-agent.js","type":"MODIFIED","insertions":16,"deletions":-26},{"file":"lib/net-fsm.js","type":"MODIFIED","insertions":12,"deletions":-24},{"file":"lib/nic-fsm.js","type":"MODIFIED","insertions":18,"deletions":-71},{"file":"lib/server-fsm.js","type":"MODIFIED","insertions":7,"deletions":-12},{"file":"lib/utils.js","type":"DELETED","insertions":0,"deletions":-30},{"file":"lib/vmadm-watcher-fsm.js","type":"MODIFIED","insertions":102,"deletions":-143},{"file":"lib/watcher-fsm.js","type":"MODIFIED","insertions":8,"deletions":-38},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":259,"sizeDeletions":-443},{"number":"6","revision":"c5f4af1d15c16e5a8c6a3722ef723f88a6488bee","parents":["2c1ad49dffeffabb665ff0ac824eb4c760929c10"],"ref":"refs/changes/18/6218/6","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1558120355,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1558383234,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1558383234,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1558120395,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/aggr-fsm.js","type":"MODIFIED","insertions":16,"deletions":-65},{"file":"lib/common.js","type":"MODIFIED","insertions":83,"deletions":-1},{"file":"lib/inst-fsm.js","type":"MODIFIED","insertions":13,"deletions":-33},{"file":"lib/net-agent.js","type":"MODIFIED","insertions":16,"deletions":-26},{"file":"lib/net-fsm.js","type":"MODIFIED","insertions":12,"deletions":-24},{"file":"lib/nic-fsm.js","type":"MODIFIED","insertions":18,"deletions":-71},{"file":"lib/server-fsm.js","type":"MODIFIED","insertions":7,"deletions":-12},{"file":"lib/utils.js","type":"DELETED","insertions":0,"deletions":-30},{"file":"lib/vmadm-watcher-fsm.js","type":"MODIFIED","insertions":99,"deletions":-151},{"file":"lib/watcher-fsm.js","type":"MODIFIED","insertions":8,"deletions":-38},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":273,"sizeDeletions":-452},{"number":"7","revision":"3459512f2f640da44537abc8a25253d948213725","parents":["2c1ad49dffeffabb665ff0ac824eb4c760929c10"],"ref":"refs/changes/18/6218/7","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1558383289,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"SUBM","value":"1","grantedOn":1558383324,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1558383234,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1558383234,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1558120395,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/aggr-fsm.js","type":"MODIFIED","insertions":16,"deletions":-65},{"file":"lib/common.js","type":"MODIFIED","insertions":83,"deletions":-1},{"file":"lib/inst-fsm.js","type":"MODIFIED","insertions":13,"deletions":-33},{"file":"lib/net-agent.js","type":"MODIFIED","insertions":16,"deletions":-26},{"file":"lib/net-fsm.js","type":"MODIFIED","insertions":12,"deletions":-24},{"file":"lib/nic-fsm.js","type":"MODIFIED","insertions":18,"deletions":-71},{"file":"lib/server-fsm.js","type":"MODIFIED","insertions":7,"deletions":-12},{"file":"lib/utils.js","type":"DELETED","insertions":0,"deletions":-30},{"file":"lib/vmadm-watcher-fsm.js","type":"MODIFIED","insertions":99,"deletions":-151},{"file":"lib/watcher-fsm.js","type":"MODIFIED","insertions":8,"deletions":-38},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":273,"sizeDeletions":-452}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}]}