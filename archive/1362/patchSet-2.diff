From 92e3ed3e2db2fabdc0b4eaf1e0f0fdaf4f64b1cf Mon Sep 17 00:00:00 2001
From: Alex Wilson <alex.wilson@joyent.com>
Date: Fri, 27 Jan 2017 09:50:11 -0800
Subject: [PATCH] joyent/node-cueball#70 crash in ConnectionSet during
 reliability testing

---
 lib/pool-monitor.js | 4 ++--
 package.json        | 2 +-
 2 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/lib/pool-monitor.js b/lib/pool-monitor.js
index 779cf32..e6041d4 100644
--- a/lib/pool-monitor.js
+++ b/lib/pool-monitor.js
@@ -78,7 +78,7 @@ CueBallPoolMonitor.prototype.toKangOptions = function () {
 		var obj = {};
 		obj.backends = pool.p_backends;
 		obj.connections = {};
-		var ks = pool.p_keys;
+		var ks = pool.p_keys.slice();
 		Object.keys(pool.p_connections).forEach(function (k) {
 			if (ks.indexOf(k) === -1)
 				ks.push(k);
@@ -118,7 +118,7 @@ CueBallPoolMonitor.prototype.toKangOptions = function () {
 		obj.backends = cset.cs_backends;
 		obj.fsms = {};
 		obj.connections = Object.keys(cset.cs_connections);
-		var ks = cset.cs_keys;
+		var ks = cset.cs_keys.slice();
 		Object.keys(cset.cs_fsms).forEach(function (k) {
 			if (ks.indexOf(k) === -1)
 				ks.push(k);
diff --git a/package.json b/package.json
index 151ef20..66801a0 100644
--- a/package.json
+++ b/package.json
@@ -1,6 +1,6 @@
 {
   "name": "cueball",
-  "version": "1.3.1",
+  "version": "1.3.2",
   "description": "",
   "main": "lib/index.js",
   "dependencies": {
-- 
2.21.0

