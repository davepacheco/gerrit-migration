{"project":"joyent/node-cueball","branch":"master","id":"Id491e5d114b559e7caaeecae407cc91a667dace5","number":"1475","subject":"joyent/node-cueball#92 ConnectionSet emits \u0027removed\u0027 for connection it never \u0027added\u0027 Reviewed by: Cody Peter Mello \u003ccody.mello@joyent.com\u003e","owner":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"url":"https://cr.joyent.us/1475","commitMessage":"joyent/node-cueball#92 ConnectionSet emits \u0027removed\u0027 for connection it never \u0027added\u0027\nReviewed by: Cody Peter Mello \u003ccody.mello@joyent.com\u003e\n","createdOn":1486608370,"lastUpdated":1486693494,"open":false,"status":"MERGED","comments":[{"timestamp":1486608370,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 1."},{"timestamp":1486608425,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1486608511,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 2: Patch Set 1 was rebased."},{"timestamp":1486608556,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 3: Patch Set 2 was rebased."},{"timestamp":1486608626,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3:\n\n\"make check\" passed ok"},{"timestamp":1486671180,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 4."},{"timestamp":1486671239,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1486691304,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 4: Code-Review+1\n\n(4 comments)"},{"timestamp":1486691443,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 4:\n\nIt would be nice if a note were made about this in the cueball internals document, but I think it\u0027d be fine if that were done in a separate commit."},{"timestamp":1486691883,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 5: Published edit on patch set 4."},{"timestamp":1486691887,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 5:\n\n(2 comments)"},{"timestamp":1486691956,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing-1\n\n(1 comment)\n\n\"make check\" exited with status 2"},{"timestamp":1486692366,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 6."},{"timestamp":1486692433,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 6: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1486693030,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 6: Code-Review+1"},{"timestamp":1486693490,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 6: Integration-Approval+1"},{"timestamp":1486693494,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Alex Wilson"}],"currentPatchSet":{"number":"6","revision":"d491e5d114b559e7caaeecae407cc91a667dace5","parents":["ae02874a7304f43ab932f000e23566828a52e89d"],"ref":"refs/changes/75/1475/6","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1486692366,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1486692433,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1486693030,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1486693490,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"SUBM","value":"1","grantedOn":1486693494,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"docs/internals.adoc","type":"MODIFIED","insertions":20,"deletions":0},{"file":"lib/set.js","type":"MODIFIED","insertions":286,"deletions":-153},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/cset.test.js","type":"MODIFIED","insertions":62,"deletions":0}],"sizeInsertions":369,"sizeDeletions":-154},"patchSets":[{"number":"1","revision":"e83f2697d223f439b8d9ffa0716366f39067fc6b","parents":["ae02874a7304f43ab932f000e23566828a52e89d"],"ref":"refs/changes/75/1475/1","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1486608370,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1486608425,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/pool-monitor.js","type":"MODIFIED","insertions":12,"deletions":-6},{"file":"lib/set.js","type":"MODIFIED","insertions":287,"deletions":-151},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/cset.test.js","type":"MODIFIED","insertions":60,"deletions":0}],"sizeInsertions":360,"sizeDeletions":-158},{"number":"2","revision":"90a0b27c825ac612287c25b627d003e58c26f1e2","parents":["488d2c2aeaf1c2257ac708a0b244374ec29f749a"],"ref":"refs/changes/75/1475/2","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1486608511,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"NO_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1486608425,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/set.js","type":"MODIFIED","insertions":287,"deletions":-151},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/cset.test.js","type":"MODIFIED","insertions":60,"deletions":0}],"sizeInsertions":348,"sizeDeletions":-152},{"number":"3","revision":"0f233cf0c050a71d4f014b5d5f93cc23dc8b2745","parents":["ae02874a7304f43ab932f000e23566828a52e89d"],"ref":"refs/changes/75/1475/3","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1486608556,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1486608425,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/set.js","type":"MODIFIED","insertions":287,"deletions":-151},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/cset.test.js","type":"MODIFIED","insertions":60,"deletions":0}],"sizeInsertions":348,"sizeDeletions":-152},{"number":"4","revision":"806d86cbeddcd3ea44cb06e56b740cbc4b1626a0","parents":["ae02874a7304f43ab932f000e23566828a52e89d"],"ref":"refs/changes/75/1475/4","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1486671180,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1486691304,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1486671239,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/set.js","line":534,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Do we not check fsm.isInState(\u0027idle\u0027) anymore so that rebalancing happens even if we keep moving into and out of idle before the \u0027stateChanged\u0027 fires?"},{"file":"lib/set.js","line":534,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"We used to do that in order to avoid taking actions that require the fsm to still actually be in the \u0027idle\u0027 state (like setting up a handle and calling .try). Those are now handled by the LogicalConnection, and nothing we have left here actually minds."},{"file":"lib/set.js","line":616,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"I think that this could also be written out as \u0027handle\u0027."},{"file":"lib/set.js","line":674,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Maybe use assert.ifError() instead, so that it shows the stack and error message? Or do you want the stack shown to be the stack in onClaimed()?"},{"file":"lib/set.js","line":674,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Yeah, we never fail this claim, so I\u0027d like the assert to show who called .fail() and not the stack of the error they gave it."},{"file":"test/cset.test.js","line":520,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"inset should be empty when this is emitted, right? If so, we should assert that."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/set.js","type":"MODIFIED","insertions":286,"deletions":-153},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/cset.test.js","type":"MODIFIED","insertions":60,"deletions":0}],"sizeInsertions":347,"sizeDeletions":-154},{"number":"5","revision":"84ad3d772cf0ca92162559e057aed8dd3661d365","parents":["ae02874a7304f43ab932f000e23566828a52e89d"],"ref":"refs/changes/75/1475/5","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1486691883,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1486691956,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"test/cset.test.js","line":523,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"indent by spaces instead of tabs"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/set.js","type":"MODIFIED","insertions":286,"deletions":-153},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/cset.test.js","type":"MODIFIED","insertions":62,"deletions":0}],"sizeInsertions":349,"sizeDeletions":-154},{"number":"6","revision":"d491e5d114b559e7caaeecae407cc91a667dace5","parents":["ae02874a7304f43ab932f000e23566828a52e89d"],"ref":"refs/changes/75/1475/6","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1486692366,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1486693030,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1486693490,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"SUBM","value":"1","grantedOn":1486693494,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1486692433,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"docs/internals.adoc","type":"MODIFIED","insertions":20,"deletions":0},{"file":"lib/set.js","type":"MODIFIED","insertions":286,"deletions":-153},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/cset.test.js","type":"MODIFIED","insertions":62,"deletions":0}],"sizeInsertions":369,"sizeDeletions":-154}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}]}