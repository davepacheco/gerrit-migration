{"project":"joyent/sdcadm","branch":"master","id":"I71caa629b8865de8f37c7f9dcf9e73b4d9b1d37c","number":"4754","subject":"TRITON-723 sdcadm health can exit non-zero on failure due to TOOLS-1699 Reviewed by: Pedro Palazón Candel \u003cpedro@joyent.com\u003e Approved by: Pedro Palazón Candel \u003cpedro@joyent.com\u003e","owner":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"url":"https://cr.joyent.us/4754","commitMessage":"TRITON-723 sdcadm health can exit non-zero on failure due to TOOLS-1699\nReviewed by: Pedro Palazón Candel \u003cpedro@joyent.com\u003e\nApproved by: Pedro Palazón Candel \u003cpedro@joyent.com\u003e\n","createdOn":1535401442,"lastUpdated":1535487868,"open":false,"status":"MERGED","comments":[{"timestamp":1535401442,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Uploaded patch set 1."},{"timestamp":1535401443,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit 32e9cc1f709e0f6d6f5cfd3ef3eb07fa89a2e545\n    \n    doc checkHealth and improve sdcadm health error report output"},{"timestamp":1535401478,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing-1\n\n\"make check\" exited with status 2\n\n fatal: ref HEAD is not a symbolic ref\n fatal: No tags can describe \u00271a1af8ab6d8c01984e149742d1c560b6f3267a8f\u0027.\n Try --always, or create some tags.\n version is: 1.21.1\n Version check ok.\n /tmp/repo/./build/node/bin/node node_modules/.bin/eslint  lib/locker.js lib/channel.js lib/common.js lib/svcadm.js lib/post-setup/cloudapi.js lib/post-setup/dev-headnode-prov.js lib/post-setup/volapi.js lib/post-setup/cns.js lib/post-setup/common-external-nics.js lib/post-setup/underlay-nics.js lib/post-setup/cmon.js lib/post-setup/index.js lib/post-setup/dev-sample-data.js lib/post-setup/fabrics.js lib/post-setup/docker.js lib/post-setup/ha-binder.js lib/post-setup/ha-manatee.js lib/platform.js lib/ur.js lib/sdcadm.js lib/dc-maint.js lib/default-fabric.js lib/steps/sapi.js lib/steps/dnsdomain.js lib/steps/noRabbit.js lib/steps/updateVmSize.js lib/steps/index.js lib/steps/binder.js lib/steps/usbkey.js lib/steps/zookeeper.js lib/steps/servers.js lib/logging.js lib/vmadm.js lib/procedures/update-manatee-v2.js lib/procedures/update-agent-v1.js lib/procedures/shared.js lib/procedures/update-stateless-services-v1.js lib/procedures/index.js lib/procedures/procedure.js lib/procedures/update-dockerlogger.js lib/procedures/update-single-hn-sapi-v1.js lib/procedures/create-service-instance-v1.js lib/procedures/download-images.js lib/procedures/update-moray-v2.js lib/procedures/update-single-headnode-imgapi.js lib/procedures/update-sapi-v2.js lib/procedures/update-binder-v2.js lib/errors.js lib/cli/do_create.js lib/cli/do_info.js lib/cli/do_update_other.js lib/cli/do_update_agents.js lib/cli/do_instances.js lib/cli/do_update_gz_tools.js lib/cli/do_rollback.js lib/cli/index.js lib/cli/experimental.js lib/cli/do_check_health.js lib/cli/do_add_new_agent_svcs.js lib/cli/do_install_docker_cert.js lib/cli/do_self_update.js lib/cli/do_avail.js lib/cli/do_update.js lib/cli/do_completion.js lib/cli/do_nfs_volumes.js lib/cli/do_services.js lib/cli/do_fix_core_vm_resolvers.js lib/cli/do_update_docker.js lib/cli/do_check_config.js test/update.test.js test/manatee.test.js test/experimental.test.js test/common.test.js test/create.test.js test/instances.test.js test/rollback.test.js test/dc-maint.test.js test/services.test.js test/post-setup.test.js test/available.test.js test/channel.test.js test/post-setup-ha-binder.test.js test/check-health.test.js test/help.test.js test/common.js test/update-gz-tools.test.js test/sdcadm.test.js test/unit/steps/usbkey.test.js test/unit/cli/do_update_agents.test.js test/unit/testutil.js test/platform.test.js test/self-update.test.js test/check-config.test.js test/shared.js\n \n /tmp/repo/lib/cli/do_check_health.js\n   138:44  error  Unexpected trailing comma  comma-dangle\n \n ✖ 1 problem (1 error, 0 warnings)\n   1 error, 0 warnings potentially fixable with the `--fix` option.\n \n tools/mk/Makefile.targ:201: recipe for target \u0027check-eslint\u0027 failed\n gmake: *** [check-eslint] Error 1"},{"timestamp":1535401513,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Uploaded patch set 2."},{"timestamp":1535401514,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit 65da76e93316b8f4b5f9683a8bc470e97a8870d0\n    \n    bumpver\n    \n    commit 7cb9b875d54ed01ed5adc833ffca968c2c56b9ba\n    \n    doc checkHealth and improve sdcadm health error report output"},{"timestamp":1535401633,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing-1\n\n\"make check\" exited with status 2\n\n fatal: ref HEAD is not a symbolic ref\n version is: 1.21.3\n Version check ok.\n /tmp/repo/./build/node/bin/node node_modules/.bin/eslint  lib/procedures/shared.js lib/procedures/update-moray-v2.js lib/procedures/download-images.js lib/procedures/update-binder-v2.js lib/procedures/index.js lib/procedures/update-manatee-v2.js lib/procedures/procedure.js lib/procedures/create-service-instance-v1.js lib/procedures/update-sapi-v2.js lib/procedures/update-stateless-services-v1.js lib/procedures/update-single-hn-sapi-v1.js lib/procedures/update-single-headnode-imgapi.js lib/procedures/update-dockerlogger.js lib/procedures/update-agent-v1.js lib/ur.js lib/default-fabric.js lib/locker.js lib/svcadm.js lib/common.js lib/cli/do_info.js lib/cli/do_check_config.js lib/cli/do_install_docker_cert.js lib/cli/do_create.js lib/cli/do_instances.js lib/cli/do_self_update.js lib/cli/do_avail.js lib/cli/do_update_agents.js lib/cli/do_completion.js lib/cli/do_nfs_volumes.js lib/cli/do_check_health.js lib/cli/do_rollback.js lib/cli/index.js lib/cli/do_update_gz_tools.js lib/cli/do_update_other.js lib/cli/do_add_new_agent_svcs.js lib/cli/experimental.js lib/cli/do_fix_core_vm_resolvers.js lib/cli/do_update.js lib/cli/do_update_docker.js lib/cli/do_services.js lib/dc-maint.js lib/vmadm.js lib/logging.js lib/post-setup/ha-manatee.js lib/post-setup/ha-binder.js lib/post-setup/docker.js lib/post-setup/index.js lib/post-setup/cns.js lib/post-setup/common-external-nics.js lib/post-setup/cloudapi.js lib/post-setup/dev-headnode-prov.js lib/post-setup/dev-sample-data.js lib/post-setup/underlay-nics.js lib/post-setup/cmon.js lib/post-setup/fabrics.js lib/post-setup/volapi.js lib/sdcadm.js lib/platform.js lib/channel.js lib/errors.js lib/steps/usbkey.js lib/steps/servers.js lib/steps/noRabbit.js lib/steps/zookeeper.js lib/steps/index.js lib/steps/sapi.js lib/steps/dnsdomain.js lib/steps/updateVmSize.js lib/steps/binder.js test/manatee.test.js test/check-health.test.js test/services.test.js test/unit/testutil.js test/unit/steps/usbkey.test.js test/unit/cli/do_update_agents.test.js test/update-gz-tools.test.js test/sdcadm.test.js test/dc-maint.test.js test/rollback.test.js test/check-config.test.js test/channel.test.js test/common.test.js test/create.test.js test/self-update.test.js test/help.test.js test/experimental.test.js test/update.test.js test/instances.test.js test/platform.test.js test/common.js test/post-setup.test.js test/available.test.js test/shared.js test/post-setup-ha-binder.test.js\n \n /tmp/repo/lib/cli/do_check_health.js\n   138:44  error  Unexpected trailing comma  comma-dangle\n \n ✖ 1 problem (1 error, 0 warnings)\n   1 error, 0 warnings potentially fixable with the `--fix` option.\n \n tools/mk/Makefile.targ:201: recipe for target \u0027check-eslint\u0027 failed\n gmake: *** [check-eslint] Error 1"},{"timestamp":1535402008,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Uploaded patch set 3."},{"timestamp":1535402010,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 3:\n\nNew commits:\n    \n    commit 0b81a2d3d7ca3eba96c53b28876c227cda17ebf8\n    \n    fix \u0027make check\u0027"},{"timestamp":1535402044,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1535442595,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 3: Code-Review+1 Integration-Approval+1"},{"timestamp":1535487845,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Uploaded patch set 4: Commit message was updated."},{"timestamp":1535487868,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Trent Mick"}],"currentPatchSet":{"number":"4","revision":"71caa629b8865de8f37c7f9dcf9e73b4d9b1d37c","parents":["63bcf2b54b16a729efe9f3858e8c3d14f3fd53fb"],"ref":"refs/changes/54/4754/4","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1535487845,"author":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1535402044,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1535442595,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1535442595,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"SUBM","value":"1","grantedOn":1535487868,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":4,"deletions":0},{"file":"lib/cli/do_check_health.js","type":"MODIFIED","insertions":56,"deletions":-15},{"file":"lib/logging.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/sdcadm.js","type":"MODIFIED","insertions":38,"deletions":-1},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":100,"sizeDeletions":-18},"patchSets":[{"number":"1","revision":"1a1af8ab6d8c01984e149742d1c560b6f3267a8f","parents":["d3f31ce533facdf89706c70f2868627198640c47"],"ref":"refs/changes/54/4754/1","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1535401442,"author":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1535401478,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/cli/do_check_health.js","type":"MODIFIED","insertions":56,"deletions":-15},{"file":"lib/logging.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/sdcadm.js","type":"MODIFIED","insertions":38,"deletions":-1}],"sizeInsertions":95,"sizeDeletions":-17},{"number":"2","revision":"5d9e72627f1a36db118a6d032588a7158aecb48a","parents":["63bcf2b54b16a729efe9f3858e8c3d14f3fd53fb"],"ref":"refs/changes/54/4754/2","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1535401513,"author":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1535401633,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":4,"deletions":0},{"file":"lib/cli/do_check_health.js","type":"MODIFIED","insertions":56,"deletions":-15},{"file":"lib/logging.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/sdcadm.js","type":"MODIFIED","insertions":38,"deletions":-1},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":100,"sizeDeletions":-18},{"number":"3","revision":"096c74bef027009a4ac70068d1d2c6fc952b0dc1","parents":["63bcf2b54b16a729efe9f3858e8c3d14f3fd53fb"],"ref":"refs/changes/54/4754/3","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1535402008,"author":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1535402044,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1535442595,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1535442595,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":4,"deletions":0},{"file":"lib/cli/do_check_health.js","type":"MODIFIED","insertions":56,"deletions":-15},{"file":"lib/logging.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/sdcadm.js","type":"MODIFIED","insertions":38,"deletions":-1},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":100,"sizeDeletions":-18},{"number":"4","revision":"71caa629b8865de8f37c7f9dcf9e73b4d9b1d37c","parents":["63bcf2b54b16a729efe9f3858e8c3d14f3fd53fb"],"ref":"refs/changes/54/4754/4","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1535487845,"author":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1535402044,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"SUBM","value":"1","grantedOn":1535487868,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1535442595,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1535442595,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":4,"deletions":0},{"file":"lib/cli/do_check_health.js","type":"MODIFIED","insertions":56,"deletions":-15},{"file":"lib/logging.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/sdcadm.js","type":"MODIFIED","insertions":38,"deletions":-1},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":100,"sizeDeletions":-18}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}]}