{"project":"joyent/sdcadm","branch":"master","id":"Ie61bc57a395dbc16551cd3dfb887012a0c6025ff","number":"935","subject":"joyent/sdcadm#28 --force-data-path is not needed for `sdcadm create portolan`","owner":{"name":"June Yi","email":"june.yi@samsung.com","username":"gochist"},"url":"https://cr.joyent.us/935","commitMessage":"joyent/sdcadm#28 --force-data-path is not needed for `sdcadm create portolan`\n","createdOn":1479832276,"lastUpdated":1480376982,"open":false,"status":"MERGED","comments":[{"timestamp":1479832276,"reviewer":{"name":"June Yi","email":"june.yi@samsung.com","username":"gochist"},"message":"Uploaded patch set 1."},{"timestamp":1479832322,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1480001256,"reviewer":{"name":"June Yi","email":"june.yi@samsung.com","username":"gochist"},"message":"Patch Set 2: Patch Set 1 was rebased"},{"timestamp":1480001302,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2:\n\n\"make check\" passed ok"},{"timestamp":1480011241,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 2:\n\nDiscussed with Pedro:\n\nActually ...\nI wonder if there  is a reason to disallow \u0027sdcadm create\u0027 for data path things?\nPerhaps the only reason to disallow \u0027sdcadm create\u0027 is for components that we know are NOT ready for HA. I.e. nothing to do with data path or not.\n\nE.g. \u0027sdcadm create imgapi\u0027 might work right now, but that would totally screw things up.\n\nThe first Q:  1. is portolan ready right now for HA.\nThen we probably hardcode `forceDataPath:true` for \u0027sdcadm create\u0027 to not even require the flag.\n\nThen we have a separate ticket that disallows \u0027sdcadm create\u0027 by default for everything except for a whitelist of things that we know are HA ready.\nAnd then have a force flag to ignore that."},{"timestamp":1480090182,"reviewer":{"name":"June Yi","email":"june.yi@samsung.com","username":"gochist"},"message":"Patch Set 2:\n\nThank you for reviewing this!\n\n1. Why `--force-data-path` is needed?\n\nI thought that it can\u0027t be guaranteed that there\u0027s no impact on customer\u0027s data path when the operator creates additional portolan instance. \n\nHere\u0027s one of my scenario impacting on customer\u0027s data path.\nA. execute `sdcadm create portolan`\nB. binder starts to resolve both portolan0 and portolan1 for portolan service.\nC. portolan1 instance is created and after that, portolan1 service daemon is ready.\n\nEven It can be a very short moment between B and C, I think portolan service can be failed within that time period. \n\n2. is portolan ready right now for HA?\n\nAFAIK, we already have `--skip-ha-check` option for the service that is not ready for HA. I think we still need the option for `sdcadm create portolan`.\n\nAnyhow, my colleague, Marcus tested it in our staging environment and there was no big issue with multiple portolan instances so far."},{"timestamp":1480113652,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 2:\n\nJune Yi,\n\nYou are correct. When discussing this with Pedro I missed that \u0027--skip-ha-check\u0027 is already an option for this.\n\nSo I think for this ticket all we\u0027d really want is for do_create.js to hardcode \u0027forceDataPath: true\u0027 for the call to genUpdatePlan.\n\n\n\n\u003e Anyhow, my colleague, Marcus tested it in our staging environment and there was no big issue with multiple portolan instances so far.\n\nOkay. I\u0027d like the relevant Triton engineers to verify that before sdcadm will stop requiring the \u0027--skip-ha-check\u0027 for portolan. :)"},{"timestamp":1480257137,"reviewer":{"name":"June Yi","email":"june.yi@samsung.com","username":"gochist"},"message":"Uploaded patch set 3."},{"timestamp":1480257179,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1480376965,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 3: Code-Review+1 Integration-Approval+1\n\nI added a side-note to https://github.com/joyent/sdcadm/issues/28#issuecomment-263432171\n\nBut this change looks fine."},{"timestamp":1480376982,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Trent Mick"}],"currentPatchSet":{"number":"3","revision":"e61bc57a395dbc16551cd3dfb887012a0c6025ff","parents":["80d13804d754f9ab9ab0f4bbcfd007fe383c3c05"],"ref":"refs/changes/35/935/3","uploader":{"name":"June Yi","email":"june.yi@samsung.com","username":"gochist"},"createdOn":1480257137,"author":{"name":"June Yi","email":"june.yi@samsung.com","username":"gochist"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1480257179,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1480376965,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1480376965,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1480376982,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/cli/do_create.js","type":"MODIFIED","insertions":2,"deletions":-1}],"sizeInsertions":2,"sizeDeletions":-1},"patchSets":[{"number":"1","revision":"6b8ac9713c5fdcfcc968581339c52b100426ec81","parents":["6b63a4162a2bc9526713eb7aa260440b9befee07"],"ref":"refs/changes/35/935/1","uploader":{"name":"June Yi","email":"june.yi@samsung.com","username":"gochist"},"createdOn":1479832276,"author":{"name":"June Yi","email":"june.yi@samsung.com","username":"gochist"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1479832322,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/cli/do_create.js","type":"MODIFIED","insertions":7,"deletions":-1}],"sizeInsertions":7,"sizeDeletions":-1},{"number":"2","revision":"aea8f19ee42871bcbea7fc4e8301da8f1c3c6a8d","parents":["888c41138a524b0fe5111119b9eced2015f3a7b6"],"ref":"refs/changes/35/935/2","uploader":{"name":"June Yi","email":"june.yi@samsung.com","username":"gochist"},"createdOn":1480001256,"author":{"name":"June Yi","email":"june.yi@samsung.com","username":"gochist"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1479832322,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/cli/do_create.js","type":"MODIFIED","insertions":7,"deletions":-1}],"sizeInsertions":7,"sizeDeletions":-1},{"number":"3","revision":"e61bc57a395dbc16551cd3dfb887012a0c6025ff","parents":["80d13804d754f9ab9ab0f4bbcfd007fe383c3c05"],"ref":"refs/changes/35/935/3","uploader":{"name":"June Yi","email":"june.yi@samsung.com","username":"gochist"},"createdOn":1480257137,"author":{"name":"June Yi","email":"june.yi@samsung.com","username":"gochist"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1480257179,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1480376965,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1480376965,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1480376982,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/cli/do_create.js","type":"MODIFIED","insertions":2,"deletions":-1}],"sizeInsertions":2,"sizeDeletions":-1}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},{"name":"June Yi","email":"june.yi@samsung.com","username":"gochist"}]}