{"project":"joyent/node-triton","branch":"master","id":"Ic24235a3ae07102ac024e0714f17ff3e49d43bbe","number":"880","subject":"joyent/node-triton#129 triton reboot --wait INST\u0027 doesn\u0027t wait","owner":{"name":"Yang Yong","email":"yy1111.yang@samsung.com","username":"YangYong3"},"url":"https://cr.joyent.us/880","commitMessage":"joyent/node-triton#129 triton reboot --wait INST\u0027 doesn\u0027t wait\n","createdOn":1478836245,"lastUpdated":1486687865,"open":false,"status":"ABANDONED","comments":[{"timestamp":1478836245,"reviewer":{"name":"Yang Yong","email":"yy1111.yang@samsung.com","username":"YangYong3"},"message":"Uploaded patch set 1."},{"timestamp":1478836295,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1479859461,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 1: Code-Review-1\n\nThanks for looking into this. Unfortunately this won\u0027t work either. There is a race here. If the instance fully reboots back to a \u0027running\u0027 state before \u0027waitForMachineStates\u0027 can notice the \u0027stopped\u0027 or \u0027stopping\u0027 states, then this will incorrectly never complete.\n\nI\u0027ll post to the GitHub issue what I think might be a workable solution."},{"timestamp":1486455706,"reviewer":{"name":"Yang Yong","email":"yy1111.yang@samsung.com","username":"YangYong3"},"message":"Uploaded patch set 2."},{"timestamp":1486455749,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1486596907,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 2: -Code-Review\n\nYang Yong,\n\nThanks for the update. While reviewing your changes, I want to point out a number of things. I ended up coming up with a different change:\nhttps://cr.joyent.us/#/c/1473/\n\nDifferences:\n- It doesn\u0027t push the gen_do_action stuff into \"tritonapi.js\"\n- It uses the \"Date\" header from the RebootMachine request for time comparison. This should help in the case that the local machine and the DC server have skewed time.\n- It separates \u0027triton inst reboot\u0027 out from the CLI handler for \u0027triton start/stop\u0027 because it was now different enough, in my opinion.\n- It adds \u0027tritonapi.rebootMachine\u0027 with wait support, which might be useful to library users.\n- It adds a test case.\n\nWould you mind reviewing that change?"},{"timestamp":1486687865,"reviewer":{"name":"Yang Yong","email":"yy1111.yang@samsung.com","username":"YangYong3"},"message":"Abandoned\n\nit`s duplicated"}],"currentPatchSet":{"number":"2","revision":"c24235a3ae07102ac024e0714f17ff3e49d43bbe","parents":["1503088abd917f40368d5d80ce1c1e2c83ea5a96"],"ref":"refs/changes/80/880/2","uploader":{"name":"Yang Yong","email":"yy1111.yang@samsung.com","username":"YangYong3"},"createdOn":1486455706,"author":{"name":"Yang Yong","email":"yy1111.yang@samsung.com","username":"YangYong3"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1486455749,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/do_instance/gen_do_ACTION.js","type":"MODIFIED","insertions":20,"deletions":-71},{"file":"lib/tritonapi.js","type":"MODIFIED","insertions":124,"deletions":0}],"sizeInsertions":144,"sizeDeletions":-71},"patchSets":[{"number":"1","revision":"0706e3604a9818c5d67308c4ed965c9698b82027","parents":["84338a44b2314225a4233dd1907bf1e4c530012a"],"ref":"refs/changes/80/880/1","uploader":{"name":"Yang Yong","email":"yy1111.yang@samsung.com","username":"YangYong3"},"createdOn":1478836245,"author":{"name":"Yang Yong","email":"yy1111.yang@samsung.com","username":"YangYong3"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1478836295,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"-1","grantedOn":1479859461,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/do_instance/gen_do_ACTION.js","type":"MODIFIED","insertions":28,"deletions":-15}],"sizeInsertions":28,"sizeDeletions":-15},{"number":"2","revision":"c24235a3ae07102ac024e0714f17ff3e49d43bbe","parents":["1503088abd917f40368d5d80ce1c1e2c83ea5a96"],"ref":"refs/changes/80/880/2","uploader":{"name":"Yang Yong","email":"yy1111.yang@samsung.com","username":"YangYong3"},"createdOn":1486455706,"author":{"name":"Yang Yong","email":"yy1111.yang@samsung.com","username":"YangYong3"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1486455749,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/do_instance/gen_do_ACTION.js","type":"MODIFIED","insertions":20,"deletions":-71},{"file":"lib/tritonapi.js","type":"MODIFIED","insertions":124,"deletions":0}],"sizeInsertions":144,"sizeDeletions":-71}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}]}