{"project":"joyent/illumos-joyent","branch":"master","id":"Iec6f18e946abf1cebedfd0d7ca47dd5a5d183ff8","number":"5720","subject":"OS-7622 bhyve vioapic writes can deadlock instance Reviewed by: Hans Rosenfeld \u003chans.rosenfeld@joyent.com\u003e Reviewed by: John Baldwin \u003cjhb@FreeBSD.org\u003e Reviewed by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e Approved by: Robert Mustacchi \u003crm@joyent.com\u003e","owner":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"url":"https://cr.joyent.us/5720","commitMessage":"OS-7622 bhyve vioapic writes can deadlock instance\nReviewed by: Hans Rosenfeld \u003chans.rosenfeld@joyent.com\u003e\nReviewed by: John Baldwin \u003cjhb@FreeBSD.org\u003e\nReviewed by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e\nApproved by: Robert Mustacchi \u003crm@joyent.com\u003e\n","createdOn":1551828092,"lastUpdated":1561055127,"open":false,"status":"MERGED","comments":[{"timestamp":1551828092,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 1."},{"timestamp":1551911964,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 2."},{"timestamp":1551914730,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 3."},{"timestamp":1551914746,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 4: Patch Set 3 was rebased."},{"timestamp":1552064998,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 5."},{"timestamp":1552941614,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 6: Patch Set 5 was rebased."},{"timestamp":1552943811,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 7."},{"timestamp":1554749872,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 8: Patch Set 7 was rebased."},{"timestamp":1556214519,"reviewer":{"name":"John Baldwin","email":"jhb@FreeBSD.org","username":"bsdjhb"},"message":"Patch Set 8:\n\n(15 comments)"},{"timestamp":1556220358,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 8:\n\n(6 comments)\n\nThanks for taking a look.  I\u0027ll get to work on your comments."},{"timestamp":1556569216,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 9."},{"timestamp":1556569331,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 7:\n\n(10 comments)"},{"timestamp":1556919888,"reviewer":{"name":"John Baldwin","email":"jhb@FreeBSD.org","username":"bsdjhb"},"message":"Patch Set 9: Code-Review+1\n\n(4 comments)"},{"timestamp":1556921955,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 10."},{"timestamp":1556921978,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 10:\n\n(2 comments)"},{"timestamp":1556924113,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 11: Patch Set 10 was rebased."},{"timestamp":1558434969,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Patch Set 11: Code-Review+1"},{"timestamp":1559676712,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 12: Patch Set 11 was rebased."},{"timestamp":1559861649,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 13."},{"timestamp":1560264889,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 13: Code-Review+1\n\nI\u0027m not really familiar with all of the relevant code here, so my review probably doesn\u0027t count for much, but this looks fine to me."},{"timestamp":1560282144,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 14: Patch Set 13 was rebased."},{"timestamp":1560282175,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 15: Commit message was updated."},{"timestamp":1560287424,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 15:\n\nUpdated test details in the ticket"},{"timestamp":1560288080,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Patch Set 15: Code-Review+1"},{"timestamp":1560461647,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 15: Integration-Approval+1"},{"timestamp":1560537112,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 16."},{"timestamp":1560537155,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 16:\n\nI had to untangle the conflict from the VM_MAXCPU work in the to-be-removed vm_rendezvous logic."},{"timestamp":1560792401,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 17: Patch Set 16 was rebased."},{"timestamp":1560798818,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 17:\n\nBehavior is the same after the conflict-resolution rebase"},{"timestamp":1560801239,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Patch Set 17: Code-Review+1"},{"timestamp":1560803162,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 17:\n\n(1 comment)\n\nLooks good to me, I just had one small question."},{"timestamp":1560803344,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 17:\n\n(1 comment)"},{"timestamp":1560804038,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 17: Code-Review+1"},{"timestamp":1560807998,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 17: Integration-Approval+1"},{"timestamp":1561037302,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 18: Patch Set 17 was rebased."},{"timestamp":1561037348,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 19: Commit message was updated."},{"timestamp":1561055127,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Patrick Mooney"}],"currentPatchSet":{"number":"19","revision":"ec6f18e946abf1cebedfd0d7ca47dd5a5d183ff8","parents":["0d05320d3398b8b3197651d60300801cee9d054e"],"ref":"refs/changes/20/5720/19","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1561037348,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1560801239,"by":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1560804038,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1560807998,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"SUBM","value":"1","grantedOn":1561055126,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"usr/src/compat/freebsd/sys/cpuset.h","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"usr/src/uts/i86pc/io/vmm/amd/svm.c","type":"MODIFIED","insertions":6,"deletions":-4},{"file":"usr/src/uts/i86pc/io/vmm/intel/vmx.c","type":"MODIFIED","insertions":11,"deletions":-25},{"file":"usr/src/uts/i86pc/io/vmm/io/vioapic.c","type":"MODIFIED","insertions":128,"deletions":-40},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic.c","type":"MODIFIED","insertions":63,"deletions":-45},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic.h","type":"MODIFIED","insertions":4,"deletions":-9},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic_priv.h","type":"MODIFIED","insertions":17,"deletions":-1},{"file":"usr/src/uts/i86pc/io/vmm/vmm.c","type":"MODIFIED","insertions":85,"deletions":-179},{"file":"usr/src/uts/i86pc/io/vmm/vmm_sol_glue.c","type":"MODIFIED","insertions":16,"deletions":-13},{"file":"usr/src/uts/i86pc/io/vmm/vmm_stat.c","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/i86pc/io/vmm/vmm_stat.h","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/i86pc/sys/vmm.h","type":"MODIFIED","insertions":8,"deletions":-22}],"sizeInsertions":345,"sizeDeletions":-342},"patchSets":[{"number":"1","revision":"25f23fa3ad790310832556c0e674f149e862b403","parents":["31fd5d7bc7a22f5f61d4a1b782a407e05cf49ad1"],"ref":"refs/changes/20/5720/1","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1551828092,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/amd/svm.c","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"usr/src/uts/i86pc/io/vmm/intel/vmx.c","type":"MODIFIED","insertions":9,"deletions":-15},{"file":"usr/src/uts/i86pc/io/vmm/io/vioapic.c","type":"MODIFIED","insertions":66,"deletions":-44},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic.c","type":"MODIFIED","insertions":46,"deletions":-45},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic.h","type":"MODIFIED","insertions":8,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic_priv.h","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"usr/src/uts/i86pc/io/vmm/vmm.c","type":"MODIFIED","insertions":84,"deletions":-178},{"file":"usr/src/uts/i86pc/io/vmm/vmm_stat.c","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/i86pc/io/vmm/vmm_stat.h","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/i86pc/sys/vmm.h","type":"MODIFIED","insertions":7,"deletions":-22}],"sizeInsertions":233,"sizeDeletions":-311},{"number":"2","revision":"5c9ec1782906954ad8b1b5b84d224bc5fc1a8d7e","parents":["31fd5d7bc7a22f5f61d4a1b782a407e05cf49ad1"],"ref":"refs/changes/20/5720/2","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1551911964,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/amd/svm.c","type":"MODIFIED","insertions":6,"deletions":-4},{"file":"usr/src/uts/i86pc/io/vmm/intel/vmx.c","type":"MODIFIED","insertions":11,"deletions":-15},{"file":"usr/src/uts/i86pc/io/vmm/io/vioapic.c","type":"MODIFIED","insertions":66,"deletions":-44},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic.c","type":"MODIFIED","insertions":55,"deletions":-45},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic.h","type":"MODIFIED","insertions":4,"deletions":-9},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic_priv.h","type":"MODIFIED","insertions":17,"deletions":-1},{"file":"usr/src/uts/i86pc/io/vmm/vmm.c","type":"MODIFIED","insertions":84,"deletions":-178},{"file":"usr/src/uts/i86pc/io/vmm/vmm_stat.c","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/i86pc/io/vmm/vmm_stat.h","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/i86pc/sys/vmm.h","type":"MODIFIED","insertions":7,"deletions":-22}],"sizeInsertions":252,"sizeDeletions":-320},{"number":"3","revision":"787650cde3e0d7f05c206d055e06a68fe1f4d224","parents":["31fd5d7bc7a22f5f61d4a1b782a407e05cf49ad1"],"ref":"refs/changes/20/5720/3","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1551914730,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/amd/svm.c","type":"MODIFIED","insertions":6,"deletions":-4},{"file":"usr/src/uts/i86pc/io/vmm/intel/vmx.c","type":"MODIFIED","insertions":11,"deletions":-17},{"file":"usr/src/uts/i86pc/io/vmm/io/vioapic.c","type":"MODIFIED","insertions":66,"deletions":-44},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic.c","type":"MODIFIED","insertions":55,"deletions":-45},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic.h","type":"MODIFIED","insertions":4,"deletions":-9},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic_priv.h","type":"MODIFIED","insertions":17,"deletions":-1},{"file":"usr/src/uts/i86pc/io/vmm/vmm.c","type":"MODIFIED","insertions":84,"deletions":-178},{"file":"usr/src/uts/i86pc/io/vmm/vmm_stat.c","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/i86pc/io/vmm/vmm_stat.h","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/i86pc/sys/vmm.h","type":"MODIFIED","insertions":7,"deletions":-22}],"sizeInsertions":252,"sizeDeletions":-322},{"number":"4","revision":"0d9d48a4e1e6af7d55ddc6830b5ca6489e70bc10","parents":["b4bede175d4c50ac1b36078a677b69388f6fb59f"],"ref":"refs/changes/20/5720/4","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1551914746,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"TRIVIAL_REBASE","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/amd/svm.c","type":"MODIFIED","insertions":6,"deletions":-4},{"file":"usr/src/uts/i86pc/io/vmm/intel/vmx.c","type":"MODIFIED","insertions":11,"deletions":-17},{"file":"usr/src/uts/i86pc/io/vmm/io/vioapic.c","type":"MODIFIED","insertions":66,"deletions":-44},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic.c","type":"MODIFIED","insertions":55,"deletions":-45},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic.h","type":"MODIFIED","insertions":4,"deletions":-9},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic_priv.h","type":"MODIFIED","insertions":17,"deletions":-1},{"file":"usr/src/uts/i86pc/io/vmm/vmm.c","type":"MODIFIED","insertions":84,"deletions":-178},{"file":"usr/src/uts/i86pc/io/vmm/vmm_stat.c","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/i86pc/io/vmm/vmm_stat.h","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/i86pc/sys/vmm.h","type":"MODIFIED","insertions":7,"deletions":-22}],"sizeInsertions":252,"sizeDeletions":-322},{"number":"5","revision":"bf8e5b9edd6d513f588087c808c7f789777d0e52","parents":["b4bede175d4c50ac1b36078a677b69388f6fb59f"],"ref":"refs/changes/20/5720/5","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1552064998,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/amd/svm.c","type":"MODIFIED","insertions":6,"deletions":-4},{"file":"usr/src/uts/i86pc/io/vmm/intel/vmx.c","type":"MODIFIED","insertions":11,"deletions":-17},{"file":"usr/src/uts/i86pc/io/vmm/io/vioapic.c","type":"MODIFIED","insertions":66,"deletions":-44},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic.c","type":"MODIFIED","insertions":55,"deletions":-45},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic.h","type":"MODIFIED","insertions":4,"deletions":-9},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic_priv.h","type":"MODIFIED","insertions":17,"deletions":-1},{"file":"usr/src/uts/i86pc/io/vmm/vmm.c","type":"MODIFIED","insertions":84,"deletions":-178},{"file":"usr/src/uts/i86pc/io/vmm/vmm_stat.c","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/i86pc/io/vmm/vmm_stat.h","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/i86pc/sys/vmm.h","type":"MODIFIED","insertions":8,"deletions":-22}],"sizeInsertions":253,"sizeDeletions":-322},{"number":"6","revision":"c8cd10415324ee1c88f7a683ca181a3fd1d3c09f","parents":["e491baa0a1b31529d9013d65872913722b512db9"],"ref":"refs/changes/20/5720/6","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1552941614,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"TRIVIAL_REBASE","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/amd/svm.c","type":"MODIFIED","insertions":6,"deletions":-4},{"file":"usr/src/uts/i86pc/io/vmm/intel/vmx.c","type":"MODIFIED","insertions":11,"deletions":-17},{"file":"usr/src/uts/i86pc/io/vmm/io/vioapic.c","type":"MODIFIED","insertions":66,"deletions":-44},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic.c","type":"MODIFIED","insertions":55,"deletions":-45},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic.h","type":"MODIFIED","insertions":4,"deletions":-9},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic_priv.h","type":"MODIFIED","insertions":17,"deletions":-1},{"file":"usr/src/uts/i86pc/io/vmm/vmm.c","type":"MODIFIED","insertions":84,"deletions":-178},{"file":"usr/src/uts/i86pc/io/vmm/vmm_stat.c","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/i86pc/io/vmm/vmm_stat.h","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/i86pc/sys/vmm.h","type":"MODIFIED","insertions":8,"deletions":-22}],"sizeInsertions":253,"sizeDeletions":-322},{"number":"7","revision":"b2968153e2593e4bfc0fee10e39321d607a479c8","parents":["e491baa0a1b31529d9013d65872913722b512db9"],"ref":"refs/changes/20/5720/7","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1552943811,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/uts/i86pc/io/vmm/intel/vmx.c","line":4047,"reviewer":{"name":"John Baldwin","email":"jhb@FreeBSD.org","username":"bsdjhb"},"message":"result seems like a bit of an unusual name for an input variable (I had initially read it as being an output var).  maybe \u0027masks\u0027 instead of \u0027result\u0027 or some such?"},{"file":"usr/src/uts/i86pc/io/vmm/intel/vmx.c","line":4047,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"masks is much better, will change"},{"file":"usr/src/uts/i86pc/io/vmm/intel/vmx.c","line":4047,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Done"},{"file":"usr/src/uts/i86pc/io/vmm/io/vioapic.c","line":241,"reviewer":{"name":"John Baldwin","email":"jhb@FreeBSD.org","username":"bsdjhb"},"message":"Maybe add the comment here that used to be in vlapic.c about level trigger only being valid for fixed and lowprio delivery modes?"},{"file":"usr/src/uts/i86pc/io/vmm/io/vioapic.c","line":241,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Done"},{"file":"usr/src/uts/i86pc/io/vmm/io/vioapic.c","line":247,"reviewer":{"name":"John Baldwin","email":"jhb@FreeBSD.org","username":"bsdjhb"},"message":"Maybe a block comment for the function is still useful, something like:\n\n/*\n * Update trigger-mode registers in all vlapics to reflect ioapic pin configuration.\n */"},{"file":"usr/src/uts/i86pc/io/vmm/io/vioapic.c","line":247,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Done"},{"file":"usr/src/uts/i86pc/io/vmm/io/vioapic.c","line":263,"reviewer":{"name":"John Baldwin","email":"jhb@FreeBSD.org","username":"bsdjhb"},"message":"Not sure if we want some comment here similar to the one in vlapic_deliver_intr() to explain why \u0027false\u0027 is passed to vlapic_calcdest().  It could even just be \"See comment in vlapic_deliver_intr() for why we assume legacy xAPIC format for I/O APIC entries.\""},{"file":"usr/src/uts/i86pc/io/vmm/io/vioapic.c","line":263,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"For convenience, I\u0027ve moved a bunch of this logic into a vioapic_calcdest(), where a comment to that effect can be centralized."},{"file":"usr/src/uts/i86pc/io/vmm/io/vioapic.c","line":280,"reviewer":{"name":"John Baldwin","email":"jhb@FreeBSD.org","username":"bsdjhb"},"message":"FreeBSD\u0027s CPU set thing doesn\u0027t have an equivalent to CPUSET_BOUNDS FWIW.  For FreeBSD I would probably tweak this a bit (and I\u0027m happy to do this) by using CPU_FFS on bounds and loop so long as bounds is not zero."},{"file":"usr/src/uts/i86pc/io/vmm/io/vioapic.c","line":280,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Shoot, I ctags-ed this and didn\u0027t realize I\u0027d stumbled into the opensolaris contrib directory in my freebsd sources.  I\u0027ll fix it up so there\u0027s no diff between the implementations."},{"file":"usr/src/uts/i86pc/io/vmm/io/vioapic.c","line":280,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"I believe I\u0027ve fixed all the CPUSET_ calls, using the appropriate FreeBSD macros instead."},{"file":"usr/src/uts/i86pc/io/vmm/io/vioapic.c","line":282,"reviewer":{"name":"John Baldwin","email":"jhb@FreeBSD.org","username":"bsdjhb"},"message":"So I think both the old and new implementations are assuming that an OS wouldn\u0027t route both an edge and level triggered interrupt from separate I/O APICs to the same IDT vector on a given vCPU.  Actually, it\u0027s worse than that, you could have multiple pins routed to the same IDT vector (and thus TMR bit) and if the OS clears one of them while both are pending we would clear TMR when it should perhaps be set.  FreeBSD 4.x did this as it tried to fit all hardware interrupts into a single 24-bit mask to support spl() interrupt blocking, so multiple I/O APIC pins would all share the same IDT vector, but it didn\u0027t move once assigned.  I don\u0027t think 4.x had the workaround for rewriting the pins to switch from level to edge either when unmasking.  I don\u0027t think this edge case is worth fixing, but it might warrant a comment to the effect of \"this assumes that no other I/O APIC pin references an affected (vCPU, IDT vector) tuple.  This should be true as well behaved OS\u0027s that migrate interrupts among CPUs should remove an existing interrupt from a (vCPU, IDT vector) before assigning a new one.\""},{"file":"usr/src/uts/i86pc/io/vmm/io/vioapic.c","line":282,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"At least thinking briefly about it, adapting the new code to avoid deasserting the TMR when 2+ redir entries refer to it seems doable.  I\u0027ll try to prototype it up."},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic.c","line":1649,"reviewer":{"name":"John Baldwin","email":"jhb@FreeBSD.org","username":"bsdjhb"},"message":"Can we assert this about the vCPU or does the vlapic not have a backpointer to let you do that?"},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic.c","line":1649,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"In this context, the \u0027vm\u0027 and \u0027vcpu\u0027 structs are opaque.  If you feel strongly about it, I can add a state accessor to use for the assertion.  Really, this is only called from the vmx_run/svm_vmrun contexts."},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic.c","line":1649,"reviewer":{"name":"John Baldwin","email":"jhb@FreeBSD.org","username":"bsdjhb"},"message":"Ok, it is fine as-is."},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic.c","line":1659,"reviewer":{"name":"John Baldwin","email":"jhb@FreeBSD.org","username":"bsdjhb"},"message":"I would maybe add a \u0027VLAPIC_CTR0(vlapic, \"synchronizing TMR\");\u0027 to keep the tracing the old code had."},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic.c","line":1659,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Done"},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic.c","line":1693,"reviewer":{"name":"John Baldwin","email":"jhb@FreeBSD.org","username":"bsdjhb"},"message":"Maybe add a trace here as well, something like \u0027VLAPIC_CTR2(vlapic, \"TMR for vector %d %sasserted\", vector, active ? \"\" : \"de\");\u0027"},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic.c","line":1693,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Done"},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic.c","line":1700,"reviewer":{"name":"John Baldwin","email":"jhb@FreeBSD.org","username":"bsdjhb"},"message":"Given that I didn\u0027t see this ever tested except for 0 vs non-zero, can this just be \u0027vlapic-\u003etmr_pending \u003d 1\u0027 now?"},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic.c","line":1700,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"The values \u003e\u003d are meant for tracing purposes.  If you were fbt-dtracing vlapic_tmr_update:entry, it would serve as a useful indicator for the number of TMR updates which occurred since the last VMX/SVM entry."},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic.c","line":1700,"reviewer":{"name":"John Baldwin","email":"jhb@FreeBSD.org","username":"bsdjhb"},"message":"Ok.  Maybe a comment either here or where it is defined in the header to note it is a counter for debugging/tracing purposes to help future readers?"},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic.c","line":1700,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"I\u0027d rather put the comment here, tbh.  I don\u0027t want to suggest too strongly that it\u0027s for debugging/tracing only."},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic_priv.h","line":141,"reviewer":{"name":"John Baldwin","email":"jhb@FreeBSD.org","username":"bsdjhb"},"message":"I didn\u0027t see this used.  Did you earlier try to use this as a max on tmr_pending for when you would force a TMR update or some such?"},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic_priv.h","line":141,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"It sizes tmr_vec_assert/tmr_vec_deassert and the loops which access them."},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic_priv.h","line":141,"reviewer":{"name":"John Baldwin","email":"jhb@FreeBSD.org","username":"bsdjhb"},"message":"Bah, that\u0027s what I get for trying to do the review just via the webui."},{"file":"usr/src/uts/i86pc/io/vmm/vmm.c","line":1404,"reviewer":{"name":"John Baldwin","email":"jhb@FreeBSD.org","username":"bsdjhb"},"message":"I think this should be \u0027msleep_spin(\u0026vcpu-\u003estate, \u0026vcpu-\u003emtx, \"vcpublk\", 0);\u0027"},{"file":"usr/src/uts/i86pc/io/vmm/vmm.c","line":1404,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Done"},{"file":"usr/src/uts/i86pc/io/vmm/vmm.c","line":1719,"reviewer":{"name":"John Baldwin","email":"jhb@FreeBSD.org","username":"bsdjhb"},"message":"This line also needs to be unindented one level."},{"file":"usr/src/uts/i86pc/io/vmm/vmm.c","line":1719,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Done"},{"file":"usr/src/uts/i86pc/io/vmm/vmm.c","line":2725,"reviewer":{"name":"John Baldwin","email":"jhb@FreeBSD.org","username":"bsdjhb"},"message":"Maybe \u0027msleep_spin(\u0026vcpu-\u003estate, \u0026vcpu-\u003emtx, \"vcpublk\", 0)\u0027"},{"file":"usr/src/uts/i86pc/io/vmm/vmm.c","line":2725,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Done"},{"file":"usr/src/uts/i86pc/sys/vmm.h","line":567,"reviewer":{"name":"John Baldwin","email":"jhb@FreeBSD.org","username":"bsdjhb"},"message":"I think renaming this is fine as I don\u0027t think userspace ever sees this exit code."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/amd/svm.c","type":"MODIFIED","insertions":6,"deletions":-4},{"file":"usr/src/uts/i86pc/io/vmm/intel/vmx.c","type":"MODIFIED","insertions":11,"deletions":-17},{"file":"usr/src/uts/i86pc/io/vmm/io/vioapic.c","type":"MODIFIED","insertions":66,"deletions":-44},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic.c","type":"MODIFIED","insertions":55,"deletions":-45},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic.h","type":"MODIFIED","insertions":4,"deletions":-9},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic_priv.h","type":"MODIFIED","insertions":17,"deletions":-1},{"file":"usr/src/uts/i86pc/io/vmm/vmm.c","type":"MODIFIED","insertions":84,"deletions":-178},{"file":"usr/src/uts/i86pc/io/vmm/vmm_stat.c","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/i86pc/io/vmm/vmm_stat.h","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/i86pc/sys/vmm.h","type":"MODIFIED","insertions":8,"deletions":-22}],"sizeInsertions":253,"sizeDeletions":-322},{"number":"8","revision":"a7f8b0fe9dd548f2611121eef4824681028502b1","parents":["919d37f67476ae6f9911035197d34891582d50e6"],"ref":"refs/changes/20/5720/8","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1554749872,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"TRIVIAL_REBASE","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/amd/svm.c","type":"MODIFIED","insertions":6,"deletions":-4},{"file":"usr/src/uts/i86pc/io/vmm/intel/vmx.c","type":"MODIFIED","insertions":11,"deletions":-17},{"file":"usr/src/uts/i86pc/io/vmm/io/vioapic.c","type":"MODIFIED","insertions":66,"deletions":-44},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic.c","type":"MODIFIED","insertions":55,"deletions":-45},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic.h","type":"MODIFIED","insertions":4,"deletions":-9},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic_priv.h","type":"MODIFIED","insertions":17,"deletions":-1},{"file":"usr/src/uts/i86pc/io/vmm/vmm.c","type":"MODIFIED","insertions":84,"deletions":-178},{"file":"usr/src/uts/i86pc/io/vmm/vmm_stat.c","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/i86pc/io/vmm/vmm_stat.h","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/i86pc/sys/vmm.h","type":"MODIFIED","insertions":8,"deletions":-22}],"sizeInsertions":253,"sizeDeletions":-322},{"number":"9","revision":"ef108aad410aab6071cb8d4895aecfd42d53f6fb","parents":["1a27fd6eae02a9c3ae14546c3461c70569b40158"],"ref":"refs/changes/20/5720/9","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1556569216,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1556919888,"by":{"name":"John Baldwin","email":"jhb@FreeBSD.org","username":"bsdjhb"}}],"comments":[{"file":"usr/src/uts/i86pc/io/vmm/io/vioapic.c","line":254,"reviewer":{"name":"John Baldwin","email":"jhb@FreeBSD.org","username":"bsdjhb"},"message":"This looks good (the wrapper function).  One unusual style nit for when this goes into FreeBSD is that FreeBSD places a blank line at the start of functions with no local variables."},{"file":"usr/src/uts/i86pc/io/vmm/io/vioapic.c","line":254,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/compat/freebsd/sys/cpuset.h","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"usr/src/uts/i86pc/io/vmm/amd/svm.c","type":"MODIFIED","insertions":6,"deletions":-4},{"file":"usr/src/uts/i86pc/io/vmm/intel/vmx.c","type":"MODIFIED","insertions":11,"deletions":-25},{"file":"usr/src/uts/i86pc/io/vmm/io/vioapic.c","type":"MODIFIED","insertions":128,"deletions":-41},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic.c","type":"MODIFIED","insertions":58,"deletions":-45},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic.h","type":"MODIFIED","insertions":4,"deletions":-9},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic_priv.h","type":"MODIFIED","insertions":17,"deletions":-1},{"file":"usr/src/uts/i86pc/io/vmm/vmm.c","type":"MODIFIED","insertions":85,"deletions":-179},{"file":"usr/src/uts/i86pc/io/vmm/vmm_sol_glue.c","type":"MODIFIED","insertions":16,"deletions":-13},{"file":"usr/src/uts/i86pc/io/vmm/vmm_stat.c","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/i86pc/io/vmm/vmm_stat.h","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/i86pc/sys/vmm.h","type":"MODIFIED","insertions":8,"deletions":-22}],"sizeInsertions":340,"sizeDeletions":-343},{"number":"10","revision":"f0b8bb84d9fb2887f3e7b8eb83d2c32f2c2b10cb","parents":["1a27fd6eae02a9c3ae14546c3461c70569b40158"],"ref":"refs/changes/20/5720/10","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1556921955,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/compat/freebsd/sys/cpuset.h","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"usr/src/uts/i86pc/io/vmm/amd/svm.c","type":"MODIFIED","insertions":6,"deletions":-4},{"file":"usr/src/uts/i86pc/io/vmm/intel/vmx.c","type":"MODIFIED","insertions":11,"deletions":-25},{"file":"usr/src/uts/i86pc/io/vmm/io/vioapic.c","type":"MODIFIED","insertions":128,"deletions":-40},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic.c","type":"MODIFIED","insertions":64,"deletions":-45},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic.h","type":"MODIFIED","insertions":4,"deletions":-9},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic_priv.h","type":"MODIFIED","insertions":17,"deletions":-1},{"file":"usr/src/uts/i86pc/io/vmm/vmm.c","type":"MODIFIED","insertions":85,"deletions":-179},{"file":"usr/src/uts/i86pc/io/vmm/vmm_sol_glue.c","type":"MODIFIED","insertions":16,"deletions":-13},{"file":"usr/src/uts/i86pc/io/vmm/vmm_stat.c","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/i86pc/io/vmm/vmm_stat.h","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/i86pc/sys/vmm.h","type":"MODIFIED","insertions":8,"deletions":-22}],"sizeInsertions":346,"sizeDeletions":-342},{"number":"11","revision":"676b271eb86b05d5c83cde231fccbe23e0c6cbd8","parents":["284c8b9ddb86cb1a6eacb20e9fae77e6e440db05"],"ref":"refs/changes/20/5720/11","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1556924113,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1558434969,"by":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/compat/freebsd/sys/cpuset.h","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"usr/src/uts/i86pc/io/vmm/amd/svm.c","type":"MODIFIED","insertions":6,"deletions":-4},{"file":"usr/src/uts/i86pc/io/vmm/intel/vmx.c","type":"MODIFIED","insertions":11,"deletions":-25},{"file":"usr/src/uts/i86pc/io/vmm/io/vioapic.c","type":"MODIFIED","insertions":128,"deletions":-40},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic.c","type":"MODIFIED","insertions":64,"deletions":-45},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic.h","type":"MODIFIED","insertions":4,"deletions":-9},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic_priv.h","type":"MODIFIED","insertions":17,"deletions":-1},{"file":"usr/src/uts/i86pc/io/vmm/vmm.c","type":"MODIFIED","insertions":85,"deletions":-179},{"file":"usr/src/uts/i86pc/io/vmm/vmm_sol_glue.c","type":"MODIFIED","insertions":16,"deletions":-13},{"file":"usr/src/uts/i86pc/io/vmm/vmm_stat.c","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/i86pc/io/vmm/vmm_stat.h","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/i86pc/sys/vmm.h","type":"MODIFIED","insertions":8,"deletions":-22}],"sizeInsertions":346,"sizeDeletions":-342},{"number":"12","revision":"79aac639c96b5276f6d1c33ba91cf3de710f8ef4","parents":["4263771df9801298a3c76c40fc650aab69de04e7"],"ref":"refs/changes/20/5720/12","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1559676712,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1558434969,"by":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/compat/freebsd/sys/cpuset.h","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"usr/src/uts/i86pc/io/vmm/amd/svm.c","type":"MODIFIED","insertions":6,"deletions":-4},{"file":"usr/src/uts/i86pc/io/vmm/intel/vmx.c","type":"MODIFIED","insertions":11,"deletions":-25},{"file":"usr/src/uts/i86pc/io/vmm/io/vioapic.c","type":"MODIFIED","insertions":128,"deletions":-40},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic.c","type":"MODIFIED","insertions":64,"deletions":-45},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic.h","type":"MODIFIED","insertions":4,"deletions":-9},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic_priv.h","type":"MODIFIED","insertions":17,"deletions":-1},{"file":"usr/src/uts/i86pc/io/vmm/vmm.c","type":"MODIFIED","insertions":85,"deletions":-179},{"file":"usr/src/uts/i86pc/io/vmm/vmm_sol_glue.c","type":"MODIFIED","insertions":16,"deletions":-13},{"file":"usr/src/uts/i86pc/io/vmm/vmm_stat.c","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/i86pc/io/vmm/vmm_stat.h","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/i86pc/sys/vmm.h","type":"MODIFIED","insertions":8,"deletions":-22}],"sizeInsertions":346,"sizeDeletions":-342},{"number":"13","revision":"ee253aa64fc10c7f825fa6f42c71956231a8d903","parents":["aa2898c4ff7db0df94db22a2ce5d7958a806e4d8"],"ref":"refs/changes/20/5720/13","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1559861649,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1560264889,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/compat/freebsd/sys/cpuset.h","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"usr/src/uts/i86pc/io/vmm/amd/svm.c","type":"MODIFIED","insertions":6,"deletions":-4},{"file":"usr/src/uts/i86pc/io/vmm/intel/vmx.c","type":"MODIFIED","insertions":11,"deletions":-25},{"file":"usr/src/uts/i86pc/io/vmm/io/vioapic.c","type":"MODIFIED","insertions":128,"deletions":-40},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic.c","type":"MODIFIED","insertions":63,"deletions":-45},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic.h","type":"MODIFIED","insertions":4,"deletions":-9},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic_priv.h","type":"MODIFIED","insertions":17,"deletions":-1},{"file":"usr/src/uts/i86pc/io/vmm/vmm.c","type":"MODIFIED","insertions":85,"deletions":-179},{"file":"usr/src/uts/i86pc/io/vmm/vmm_sol_glue.c","type":"MODIFIED","insertions":16,"deletions":-13},{"file":"usr/src/uts/i86pc/io/vmm/vmm_stat.c","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/i86pc/io/vmm/vmm_stat.h","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/i86pc/sys/vmm.h","type":"MODIFIED","insertions":8,"deletions":-22}],"sizeInsertions":345,"sizeDeletions":-342},{"number":"14","revision":"3db2d29742ea71dc3f27418ac7b923236ab7d053","parents":["e6de8afafa8b73b0636044f094ba810178b0a271"],"ref":"refs/changes/20/5720/14","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1560282144,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1560264889,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/compat/freebsd/sys/cpuset.h","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"usr/src/uts/i86pc/io/vmm/amd/svm.c","type":"MODIFIED","insertions":6,"deletions":-4},{"file":"usr/src/uts/i86pc/io/vmm/intel/vmx.c","type":"MODIFIED","insertions":11,"deletions":-25},{"file":"usr/src/uts/i86pc/io/vmm/io/vioapic.c","type":"MODIFIED","insertions":128,"deletions":-40},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic.c","type":"MODIFIED","insertions":63,"deletions":-45},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic.h","type":"MODIFIED","insertions":4,"deletions":-9},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic_priv.h","type":"MODIFIED","insertions":17,"deletions":-1},{"file":"usr/src/uts/i86pc/io/vmm/vmm.c","type":"MODIFIED","insertions":85,"deletions":-179},{"file":"usr/src/uts/i86pc/io/vmm/vmm_sol_glue.c","type":"MODIFIED","insertions":16,"deletions":-13},{"file":"usr/src/uts/i86pc/io/vmm/vmm_stat.c","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/i86pc/io/vmm/vmm_stat.h","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/i86pc/sys/vmm.h","type":"MODIFIED","insertions":8,"deletions":-22}],"sizeInsertions":345,"sizeDeletions":-342},{"number":"15","revision":"59a7976f7c7d4bed52b329e69c8ad4b3e826b36c","parents":["e6de8afafa8b73b0636044f094ba810178b0a271"],"ref":"refs/changes/20/5720/15","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1560282175,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1560461647,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1560264889,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1560288080,"by":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/compat/freebsd/sys/cpuset.h","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"usr/src/uts/i86pc/io/vmm/amd/svm.c","type":"MODIFIED","insertions":6,"deletions":-4},{"file":"usr/src/uts/i86pc/io/vmm/intel/vmx.c","type":"MODIFIED","insertions":11,"deletions":-25},{"file":"usr/src/uts/i86pc/io/vmm/io/vioapic.c","type":"MODIFIED","insertions":128,"deletions":-40},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic.c","type":"MODIFIED","insertions":63,"deletions":-45},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic.h","type":"MODIFIED","insertions":4,"deletions":-9},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic_priv.h","type":"MODIFIED","insertions":17,"deletions":-1},{"file":"usr/src/uts/i86pc/io/vmm/vmm.c","type":"MODIFIED","insertions":85,"deletions":-179},{"file":"usr/src/uts/i86pc/io/vmm/vmm_sol_glue.c","type":"MODIFIED","insertions":16,"deletions":-13},{"file":"usr/src/uts/i86pc/io/vmm/vmm_stat.c","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/i86pc/io/vmm/vmm_stat.h","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/i86pc/sys/vmm.h","type":"MODIFIED","insertions":8,"deletions":-22}],"sizeInsertions":345,"sizeDeletions":-342},{"number":"16","revision":"a28b27495d379638479436580d4de8ba422c6d7c","parents":["c3cbf49c8d881ba57710e7e8b70aa6275bc5fc44"],"ref":"refs/changes/20/5720/16","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1560537112,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/compat/freebsd/sys/cpuset.h","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"usr/src/uts/i86pc/io/vmm/amd/svm.c","type":"MODIFIED","insertions":6,"deletions":-4},{"file":"usr/src/uts/i86pc/io/vmm/intel/vmx.c","type":"MODIFIED","insertions":11,"deletions":-25},{"file":"usr/src/uts/i86pc/io/vmm/io/vioapic.c","type":"MODIFIED","insertions":128,"deletions":-40},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic.c","type":"MODIFIED","insertions":63,"deletions":-45},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic.h","type":"MODIFIED","insertions":4,"deletions":-9},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic_priv.h","type":"MODIFIED","insertions":17,"deletions":-1},{"file":"usr/src/uts/i86pc/io/vmm/vmm.c","type":"MODIFIED","insertions":85,"deletions":-179},{"file":"usr/src/uts/i86pc/io/vmm/vmm_sol_glue.c","type":"MODIFIED","insertions":16,"deletions":-13},{"file":"usr/src/uts/i86pc/io/vmm/vmm_stat.c","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/i86pc/io/vmm/vmm_stat.h","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/i86pc/sys/vmm.h","type":"MODIFIED","insertions":8,"deletions":-22}],"sizeInsertions":345,"sizeDeletions":-342},{"number":"17","revision":"55d9839fdbbd99a0edf4718ac8316fa3b856c0b0","parents":["f8f6faa3a1f8b695cb68dbbb37c24f72b6973d4e"],"ref":"refs/changes/20/5720/17","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1560792401,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1560807998,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1560804038,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1560801239,"by":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"}}],"comments":[{"file":"usr/src/uts/i86pc/io/vmm/vmm.c","line":613,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"should this function be updated to remove the unused argument?"},{"file":"usr/src/uts/i86pc/io/vmm/vmm.c","line":613,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"I don\u0027t think it\u0027s worthwhile to diverge from upstream, considering the small benefit.  There is work on the horizon to improve per-VM maxcpus in general, so hopefully it\u0027ll be addressed then."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/compat/freebsd/sys/cpuset.h","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"usr/src/uts/i86pc/io/vmm/amd/svm.c","type":"MODIFIED","insertions":6,"deletions":-4},{"file":"usr/src/uts/i86pc/io/vmm/intel/vmx.c","type":"MODIFIED","insertions":11,"deletions":-25},{"file":"usr/src/uts/i86pc/io/vmm/io/vioapic.c","type":"MODIFIED","insertions":128,"deletions":-40},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic.c","type":"MODIFIED","insertions":63,"deletions":-45},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic.h","type":"MODIFIED","insertions":4,"deletions":-9},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic_priv.h","type":"MODIFIED","insertions":17,"deletions":-1},{"file":"usr/src/uts/i86pc/io/vmm/vmm.c","type":"MODIFIED","insertions":85,"deletions":-179},{"file":"usr/src/uts/i86pc/io/vmm/vmm_sol_glue.c","type":"MODIFIED","insertions":16,"deletions":-13},{"file":"usr/src/uts/i86pc/io/vmm/vmm_stat.c","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/i86pc/io/vmm/vmm_stat.h","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/i86pc/sys/vmm.h","type":"MODIFIED","insertions":8,"deletions":-22}],"sizeInsertions":345,"sizeDeletions":-342},{"number":"18","revision":"c63a108bf09473985298805ab09398d2db413add","parents":["0d05320d3398b8b3197651d60300801cee9d054e"],"ref":"refs/changes/20/5720/18","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1561037302,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1560807998,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1560804038,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1560801239,"by":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/compat/freebsd/sys/cpuset.h","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"usr/src/uts/i86pc/io/vmm/amd/svm.c","type":"MODIFIED","insertions":6,"deletions":-4},{"file":"usr/src/uts/i86pc/io/vmm/intel/vmx.c","type":"MODIFIED","insertions":11,"deletions":-25},{"file":"usr/src/uts/i86pc/io/vmm/io/vioapic.c","type":"MODIFIED","insertions":128,"deletions":-40},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic.c","type":"MODIFIED","insertions":63,"deletions":-45},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic.h","type":"MODIFIED","insertions":4,"deletions":-9},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic_priv.h","type":"MODIFIED","insertions":17,"deletions":-1},{"file":"usr/src/uts/i86pc/io/vmm/vmm.c","type":"MODIFIED","insertions":85,"deletions":-179},{"file":"usr/src/uts/i86pc/io/vmm/vmm_sol_glue.c","type":"MODIFIED","insertions":16,"deletions":-13},{"file":"usr/src/uts/i86pc/io/vmm/vmm_stat.c","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/i86pc/io/vmm/vmm_stat.h","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/i86pc/sys/vmm.h","type":"MODIFIED","insertions":8,"deletions":-22}],"sizeInsertions":345,"sizeDeletions":-342},{"number":"19","revision":"ec6f18e946abf1cebedfd0d7ca47dd5a5d183ff8","parents":["0d05320d3398b8b3197651d60300801cee9d054e"],"ref":"refs/changes/20/5720/19","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1561037348,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1560807998,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1560804038,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"SUBM","value":"1","grantedOn":1561055126,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1560801239,"by":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"usr/src/compat/freebsd/sys/cpuset.h","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"usr/src/uts/i86pc/io/vmm/amd/svm.c","type":"MODIFIED","insertions":6,"deletions":-4},{"file":"usr/src/uts/i86pc/io/vmm/intel/vmx.c","type":"MODIFIED","insertions":11,"deletions":-25},{"file":"usr/src/uts/i86pc/io/vmm/io/vioapic.c","type":"MODIFIED","insertions":128,"deletions":-40},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic.c","type":"MODIFIED","insertions":63,"deletions":-45},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic.h","type":"MODIFIED","insertions":4,"deletions":-9},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic_priv.h","type":"MODIFIED","insertions":17,"deletions":-1},{"file":"usr/src/uts/i86pc/io/vmm/vmm.c","type":"MODIFIED","insertions":85,"deletions":-179},{"file":"usr/src/uts/i86pc/io/vmm/vmm_sol_glue.c","type":"MODIFIED","insertions":16,"deletions":-13},{"file":"usr/src/uts/i86pc/io/vmm/vmm_stat.c","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/i86pc/io/vmm/vmm_stat.h","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/i86pc/sys/vmm.h","type":"MODIFIED","insertions":8,"deletions":-22}],"sizeInsertions":345,"sizeDeletions":-342}],"allReviewers":[{"name":"John Baldwin","email":"jhb@FreeBSD.org","username":"bsdjhb"},{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}]}