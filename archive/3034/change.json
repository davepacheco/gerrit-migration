{"project":"joyent/illumos-joyent","branch":"master","id":"Ie8cfefab6125b49d22045889ce804924fabad71b","number":"3034","subject":"OS-6485 CTF conversion fails with large files","owner":{"name":"Jonathan Perkin","email":"jperkin@joyent.com","username":"jperkin"},"url":"https://cr.joyent.us/3034","commitMessage":"OS-6485 CTF conversion fails with large files\n","createdOn":1512468458,"lastUpdated":1512751069,"open":true,"status":"NEW","comments":[{"timestamp":1512468458,"reviewer":{"name":"Jonathan Perkin","email":"jperkin@joyent.com","username":"jperkin"},"message":"Uploaded patch set 1."},{"timestamp":1512492836,"reviewer":{"name":"Jonathan Perkin","email":"jperkin@joyent.com","username":"jperkin"},"message":"Uploaded patch set 2."},{"timestamp":1512751069,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 2:\n\n(2 comments)"}],"currentPatchSet":{"number":"2","revision":"e8cfefab6125b49d22045889ce804924fabad71b","parents":["9ba45b30b3b7aaeb1b63f85670403e6ea3a550eb"],"ref":"refs/changes/34/3034/2","uploader":{"name":"Jonathan Perkin","email":"jperkin@joyent.com","username":"jperkin"},"createdOn":1512492836,"author":{"name":"Jonathan Perkin","email":"jperkin@joyent.com","username":"jperkin"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/lib/libctf/common/ctf_dwarf.c","line":2608,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"I know this is pretty much the original comment and this particular piece code is mostly just moved around, but it confused me a bit.\n\nThis function appears to be creating (or really initializing) a single ctf_die_t whose index is cdp-\u003ecd_ndie (and is called as we iterate over all the dies).  The comment implies (to me at least) that it is what is doing the iterating and creating all of them (when really ctf_dwarf_convert() is what is iterating) -- that it itself has to iterate through to effectively seek to the correct dwarf CU adds to the confusion.\n\nIt\u0027d be nice if we could reword the comment to be clearer on what is happening -- maybe something along the lines of \u0027Initialize cdp for the die at index cdp-\u003ecd_ndie.  Called as we iterate over all the dies.  This is used ....\u0027 though I\u0027m not really concerned about the specific text as much as just having it better describe what\u0027s going on."},{"file":"usr/src/lib/libctf/common/ctf_dwarf.c","line":2646,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"nit: VERIFY3S might be nicer here (if it trips, it\u0027ll display both values in the abort message)"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/ctfconvert/ctfconvert.c","type":"MODIFIED","insertions":27,"deletions":-11},{"file":"usr/src/lib/libctf/common/ctf_convert.c","type":"MODIFIED","insertions":7,"deletions":-6},{"file":"usr/src/lib/libctf/common/ctf_dwarf.c","type":"MODIFIED","insertions":326,"deletions":-270},{"file":"usr/src/lib/libctf/common/libctf.h","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/lib/libctf/common/libctf_impl.h","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":364,"sizeDeletions":-291},"patchSets":[{"number":"1","revision":"4301fb0c5799c14494c0650b3897345f818096dc","parents":["758ae53701bec2fed98db901e5af051af2ac0c6d"],"ref":"refs/changes/34/3034/1","uploader":{"name":"Jonathan Perkin","email":"jperkin@joyent.com","username":"jperkin"},"createdOn":1512468458,"author":{"name":"Jonathan Perkin","email":"jperkin@joyent.com","username":"jperkin"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/ctfconvert/ctfconvert.c","type":"MODIFIED","insertions":27,"deletions":-11},{"file":"usr/src/lib/libctf/common/ctf_convert.c","type":"MODIFIED","insertions":7,"deletions":-6},{"file":"usr/src/lib/libctf/common/ctf_dwarf.c","type":"MODIFIED","insertions":328,"deletions":-270},{"file":"usr/src/lib/libctf/common/libctf.h","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/lib/libctf/common/libctf_impl.h","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":366,"sizeDeletions":-291},{"number":"2","revision":"e8cfefab6125b49d22045889ce804924fabad71b","parents":["9ba45b30b3b7aaeb1b63f85670403e6ea3a550eb"],"ref":"refs/changes/34/3034/2","uploader":{"name":"Jonathan Perkin","email":"jperkin@joyent.com","username":"jperkin"},"createdOn":1512492836,"author":{"name":"Jonathan Perkin","email":"jperkin@joyent.com","username":"jperkin"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/lib/libctf/common/ctf_dwarf.c","line":2608,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"I know this is pretty much the original comment and this particular piece code is mostly just moved around, but it confused me a bit.\n\nThis function appears to be creating (or really initializing) a single ctf_die_t whose index is cdp-\u003ecd_ndie (and is called as we iterate over all the dies).  The comment implies (to me at least) that it is what is doing the iterating and creating all of them (when really ctf_dwarf_convert() is what is iterating) -- that it itself has to iterate through to effectively seek to the correct dwarf CU adds to the confusion.\n\nIt\u0027d be nice if we could reword the comment to be clearer on what is happening -- maybe something along the lines of \u0027Initialize cdp for the die at index cdp-\u003ecd_ndie.  Called as we iterate over all the dies.  This is used ....\u0027 though I\u0027m not really concerned about the specific text as much as just having it better describe what\u0027s going on."},{"file":"usr/src/lib/libctf/common/ctf_dwarf.c","line":2646,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"nit: VERIFY3S might be nicer here (if it trips, it\u0027ll display both values in the abort message)"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/ctfconvert/ctfconvert.c","type":"MODIFIED","insertions":27,"deletions":-11},{"file":"usr/src/lib/libctf/common/ctf_convert.c","type":"MODIFIED","insertions":7,"deletions":-6},{"file":"usr/src/lib/libctf/common/ctf_dwarf.c","type":"MODIFIED","insertions":326,"deletions":-270},{"file":"usr/src/lib/libctf/common/libctf.h","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/lib/libctf/common/libctf_impl.h","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":364,"sizeDeletions":-291}],"allReviewers":[{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}]}