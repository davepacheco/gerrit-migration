{"project":"joyent/illumos-extra","branch":"master","id":"I48a865e41d503edfa9c2d442ca4e86450c908eb6","number":"2126","subject":"OS-6192 `pigz` (parallel gzip) support in the platform","owner":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"url":"https://cr.joyent.us/2126","commitMessage":"OS-6192 `pigz` (parallel gzip) support in the platform\n","createdOn":1497904444,"lastUpdated":1501024956,"open":true,"status":"NEW","comments":[{"timestamp":1497904444,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Uploaded patch set 1."},{"timestamp":1497904445,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit 7e818c7663b8a9a464c98ca07c76b6614ffd7b0e\n    \n    OS-6192 `pigz` (parallel gzip) support in the platform"},{"timestamp":1499459937,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 1:\n\n(4 comments)\n\nIn general, it looks like the right basics are here. There are some open question around the location in the image. One other thing to look through is to make sure that when building, the right flags are being passed and that we\u0027re properly building against the proto area. If we have the output of building this somewhere, I can take a look and confirm that."},{"timestamp":1499792715,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Patch Set 1:\n\n(4 comments)\n\nThe build output for pigz is here:\nhttps://gist.github.com/twhiteman/3b36617cb9f38bc53b355849b42eabcf"},{"timestamp":1499792861,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Patch Set 1:\n\nOne issue with moving pigz to /usr/img, is that the smartos-live imgadm build/install will wipe away the /usr/img directory when it copies across the imgadm bits... is there a known way to deal with something like this?"},{"timestamp":1499891770,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1499891805,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 1:\n\n\u003e One issue with moving pigz to /usr/img, is that the smartos-live\n \u003e imgadm build/install will wipe away the /usr/img directory when it\n \u003e copies across the imgadm bits... is there a known way to deal with\n \u003e something like this?\n\nThat seems like a bug with the smartos-live piece then. We should probably just change that not to remove the entire directory and install what it needs."},{"timestamp":1500329130,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Uploaded patch set 2."},{"timestamp":1500329131,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit 23a98de3613bf0bf3ec1eb4efd7bec955eb446fa\n    \n    move pigz to /usr/img/sbin, drop man pages and unpigz symlink, add configure doc"},{"timestamp":1500403711,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Patch Set 2:\n\nI\u0027ve also changed smartos-live/src/Makefile so that the /usr/img is no longer wiped, through change 2127.\n\nhttps://cr.joyent.us/#/c/2127/"},{"timestamp":1501024956,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 2:\n\n\u003e (4 comments)\n \u003e \n \u003e The build output for pigz is here:\n \u003e https://gist.github.com/twhiteman/3b36617cb9f38bc53b355849b42eabcf\n\nSo based on this, it looks like pigz isn\u0027t picking up any of the CFLAGS or LDFLAGS that we specify so it\u0027s actually building against the build system and not against the proto area, potentially with the wrong compiler."}],"currentPatchSet":{"number":"2","revision":"48a865e41d503edfa9c2d442ca4e86450c908eb6","parents":["591c23412e2f32c1bd57db71d578014c73984613"],"ref":"refs/changes/26/2126/2","uploader":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"createdOn":1500329130,"author":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":2,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":2,"deletions":0},{"file":"pigz/Makefile","type":"ADDED","insertions":32,"deletions":0},{"file":"pigz/pigz-2.3.4.tar.gz","type":"ADDED","insertions":0,"deletions":0},{"file":"pigz/pigz-Makefile.patch","type":"ADDED","insertions":9,"deletions":0},{"file":"pigz/pigz-configure.patch","type":"ADDED","insertions":6,"deletions":0}],"sizeInsertions":51,"sizeDeletions":0},"patchSets":[{"number":"1","revision":"6792b33ebcab4ea538a105fe43ab9710d278bb2a","parents":["591c23412e2f32c1bd57db71d578014c73984613"],"ref":"refs/changes/26/2126/1","uploader":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"createdOn":1497904444,"author":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"isDraft":false,"kind":"REWORK","comments":[{"file":"manifest","line":2991,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"If we can avoid it, I\u0027d prefer to avoid shipping pigz in /usr/bin, as that just adds one more thing we have to always keep around. I think we had talked about maybe installing it in /usr/img or someplace similar. Can that still be done?"},{"file":"manifest","line":2991,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Moved to /usr/img/sbin (which already holds some imgadm executable bits).\n\nDropped unpigz hardlink and the dropped the man pages."},{"file":"pigz/Makefile","line":2,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Can you use the newer header for this? You can find the modern version of this in the top-level Makefile in the repo. Same with the copyright statement."},{"file":"pigz/Makefile","line":2,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Done"},{"file":"pigz/Makefile","line":49,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Manual pages that are the same are conventionally linked by a symlink. That said, I\u0027m not sure if we ship the manual pages given that it\u0027ll be for private use."},{"file":"pigz/Makefile","line":49,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Moved to /usr/img/sbin. Dropped man pages and also dropped unpigz hard link."},{"file":"pigz/pigz-configure.patch","line":0,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Is there some missing content in this file? If this is all that\u0027s in the patch, I\u0027m not sure what we\u0027re patching and changing with this entry."},{"file":"pigz/pigz-configure.patch","line":0,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Pigz doesn\u0027t have a configure script. I needed to create a configure script, as the top-level Makefile is invoking pigz/configure when building this component, and without the configure the build would fail.\n\nIs there a better way to deal with this?"},{"file":"pigz/pigz-configure.patch","line":0,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I see. We should probably look at changing the Makefile targets, but otherwise maybe a comment about this in the Makefile would work."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":2,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":5,"deletions":0},{"file":"pigz/Makefile","type":"ADDED","insertions":49,"deletions":0},{"file":"pigz/pigz-2.3.4.tar.gz","type":"ADDED","insertions":0,"deletions":0},{"file":"pigz/pigz-Makefile.patch","type":"ADDED","insertions":9,"deletions":0},{"file":"pigz/pigz-configure.patch","type":"ADDED","insertions":3,"deletions":0}],"sizeInsertions":68,"sizeDeletions":0},{"number":"2","revision":"48a865e41d503edfa9c2d442ca4e86450c908eb6","parents":["591c23412e2f32c1bd57db71d578014c73984613"],"ref":"refs/changes/26/2126/2","uploader":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"createdOn":1500329130,"author":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":2,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":2,"deletions":0},{"file":"pigz/Makefile","type":"ADDED","insertions":32,"deletions":0},{"file":"pigz/pigz-2.3.4.tar.gz","type":"ADDED","insertions":0,"deletions":0},{"file":"pigz/pigz-Makefile.patch","type":"ADDED","insertions":9,"deletions":0},{"file":"pigz/pigz-configure.patch","type":"ADDED","insertions":6,"deletions":0}],"sizeInsertions":51,"sizeDeletions":0}],"allReviewers":[{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}]}