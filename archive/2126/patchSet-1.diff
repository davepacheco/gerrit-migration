commit 6792b33ebcab4ea538a105fe43ab9710d278bb2a (refs/changes/26/2126/1)
Author: Todd Whiteman <todd.whiteman@joyent.com>
Date:   2017-06-19T13:34:03-07:00 (2 years, 4 months ago)
    
    OS-6192 `pigz` (parallel gzip) support in the platform

diff --git a/Makefile b/Makefile
index 78e49f8..3c3b703 100644
--- a/Makefile
+++ b/Makefile
@@ -59,6 +59,7 @@ SUBDIRS = \
 	openssh \
 	pbzip2 \
 	perl \
+	pigz \
 	rsync \
 	rsyslog \
 	screen \
@@ -117,6 +118,7 @@ curl: libz openssl1x libidn2
 gzip: libz
 node.js: openssl1x
 dialog: ncurses
+pigz: libz
 socat: openssl1x
 wget: openssl1x libidn
 openldap: openssl1x
diff --git a/manifest b/manifest
index 3399611..ba9f4ca 100644
--- a/manifest
+++ b/manifest
@@ -2987,6 +2987,11 @@ s usr/perl5/bin/perl=../5.12/bin/perl
 d usr/perl5/site_perl 0755 root bin
 d usr/perl5/site_perl/5.12 0755 root bin
 d usr/perl5/site_perl/5.12/i86pc-solaris-64int 0755 root bin
+# pigz
+f usr/bin/pigz 0555 root bin
+h usr/bin/unpigz=usr/bin/pigz
+f usr/share/man/man1/pigz.1 0444 root bin
+h usr/share/man/man1/unpigz.1=usr/share/man/man1/pigz.1
 # rsync
 f usr/bin/rsync 0555 root bin
 f usr/share/man/man1/rsync.1 0444 root bin
diff --git a/pigz/Makefile b/pigz/Makefile
new file mode 100644
index 0000000..321171e
--- /dev/null
+++ b/pigz/Makefile
@@ -0,0 +1,49 @@
+#
+# CDDL HEADER START
+#
+# The contents of this file are subject to the terms of the
+# Common Development and Distribution License, Version 1.0 only
+# (the "License").  You may not use this file except in compliance
+# with the License.
+#
+# You can obtain a copy of the license at COPYING
+# See the License for the specific language governing permissions
+# and limitations under the License.
+#
+# When distributing Covered Code, include this CDDL HEADER in each
+# file and include the License file at COPYING.
+# If applicable, add the following below this CDDL HEADER, with the
+# fields enclosed by brackets "[]" replaced with your own identifying
+# information: Portions Copyright [yyyy] [name of copyright owner]
+#
+# CDDL HEADER END
+#
+# Copyright (c) 2017, Joyent, Inc.  All rights reserved.
+#
+
+VER =	pigz-2.3.4
+
+include ../Makefile.defs
+
+BINDIR =	$(DESTDIR)/usr/bin
+MANDIR =	$(DESTDIR)/usr/share/man/man1
+
+PATCHES = \
+	pigz-configure.patch \
+	pigz-Makefile.patch
+
+AUTOCONF_OPTS += \
+	--mandir=/usr/share/man
+
+include ../Makefile.targ
+
+all: all_autoconf
+
+install: all
+	mkdir -p $(BINDIR) $(MANDIR)
+	rm -f $(BINDIR)/pigz $(BINDIR)/unpigz
+	ginstall -m 0555 $(BASE)/$(VER.32)/pigz $(BINDIR)/pigz
+	ln $(BINDIR)/pigz $(BINDIR)/unpigz
+	ginstall -m 0444 $(BASE)/$(VER.32)/pigz.1 $(MANDIR)/pigz.1
+	rm -f $(MANDIR)/unpigz.1
+	ln $(MANDIR)/pigz.1 $(MANDIR)/unpigz.1
diff --git a/pigz/pigz-2.3.4.tar.gz b/pigz/pigz-2.3.4.tar.gz
new file mode 100644
index 0000000..65fa66a
Binary files /dev/null and b/pigz/pigz-2.3.4.tar.gz differ
diff --git a/pigz/pigz-Makefile.patch b/pigz/pigz-Makefile.patch
new file mode 100644
index 0000000..48ab00b
--- /dev/null
+++ b/pigz/pigz-Makefile.patch
@@ -0,0 +1,9 @@
+--- pigz-2.3.4/Makefile	2016-05-29 22:09:41.000000000 -0700
++++ pigz-2.3.4/Makefile	2017-06-14 17:04:57.000000000 -0700
+@@ -1,5 +1,6 @@
+ CC=cc
+ CFLAGS=-O3 -Wall -Wextra
++CFLAGS+=-std=gnu99
+ LDFLAGS=
+ LIBS=-lm -lpthread -lz
+ ZOPFLI=zopfli/src/zopfli/
diff --git a/pigz/pigz-configure.patch b/pigz/pigz-configure.patch
new file mode 100644
index 0000000..6f0f9b7
--- /dev/null
+++ b/pigz/pigz-configure.patch
@@ -0,0 +1,3 @@
+diff --git 2.3.4/configure 2.3.4/configure
+new file mode 100644
+index 0000000..e69de29
