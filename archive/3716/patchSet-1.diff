From b73b646e15e9e495ec1f350b908357317cd5c605 Mon Sep 17 00:00:00 2001
From: Nick Zivkovic <nick.zivkovic@joyent.com>
Date: Fri, 23 Mar 2018 23:43:27 +0000
Subject: [PATCH] DOCKER-1114 network inspect of an unknown network should
 return 404 error

---
 lib/backends/sdc/networks.js         | 6 ++++++
 test/integration/api-network.test.js | 9 +++++++++
 2 files changed, 15 insertions(+)

diff --git a/lib/backends/sdc/networks.js b/lib/backends/sdc/networks.js
index 3aba583..40e6533 100644
--- a/lib/backends/sdc/networks.js
+++ b/lib/backends/sdc/networks.js
@@ -468,6 +468,12 @@ function findNetworkOrPoolByNameOrId(name, opts, callback) {
                 getNetworksOrPools(listParams, opts, cb);
             },
             function byDockerId(cb) {
+                if (!name.match(/^[a-f0-9]+$/)) {
+                    log.debug({ name: name },
+                        'Networks: impossible docker id: %s, skipping', name);
+                    setImmediate(cb, null, []);
+                    return;
+                }
                 // we assume the 'double uuid' convention for networks here,
                 // that is, dockerId = (uuid + uuid).replace(/-/g, '').
                 // So if we have a name.length > 31, 32... must be a prefix of
diff --git a/test/integration/api-network.test.js b/test/integration/api-network.test.js
index 475ec41..16e81a6 100644
--- a/test/integration/api-network.test.js
+++ b/test/integration/api-network.test.js
@@ -130,4 +130,13 @@ test('docker network inspect', function (tt) {
             t.end();
         });
     });
+    tt.test('inspect non-existent network', function (t) {
+        DOCKER_ALICE.get('/networks/some_random_name',
+            function (err, res, req, net)
+        {
+            t.ok(err, 'expecting error');
+            t.ok(err.statusCode === 404, 'Expecting 404');
+            t.end();
+        });
+    });
 });
-- 
2.21.0

