{"project":"joyent/node-triton","branch":"master","id":"Ib1ebc95763dfd4e5a10e3cbb357c27459e7e5318","number":"1667","subject":"joyent/node-triton#190 Exception when using current docker client Reviewed by: Kody A Kantor \u003ckody.kantor@gmail.com\u003e Reviewed by: Trent Mick \u003ctrentm@gmail.com\u003e Approved by: Trent Mick \u003ctrentm@gmail.com\u003e","owner":{"name":"Marc Tremblay","email":"marcandre.tr@gmail.com","username":"marctrem"},"url":"https://cr.joyent.us/1667","commitMessage":"joyent/node-triton#190 Exception when using current docker client\nReviewed by: Kody A Kantor \u003ckody.kantor@gmail.com\u003e\nReviewed by: Trent Mick \u003ctrentm@gmail.com\u003e\nApproved by: Trent Mick \u003ctrentm@gmail.com\u003e\n","createdOn":1489606323,"lastUpdated":1489777761,"open":false,"status":"MERGED","comments":[{"timestamp":1489606323,"reviewer":{"name":"Marc Tremblay","email":"marcandre.tr@gmail.com","username":"marctrem"},"message":"Uploaded patch set 1."},{"timestamp":1489606362,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1489611812,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 1: Code-Review-1\n\nThe other thing is that we can\u0027t use semver at all when checking docker versions, since they don\u0027t follow semver. It\u0027s not really safe to change the docker version string to feed it into semver. If we need to check versions, we should explicitly check a version string against another version string without modifying either. This patch would introduce a case where \u002717.03.0\u0027 is equivalent to \u002717.3.0\u0027.\n\nIf we\u0027re going to keep logic in there to use only one env var, we should remove the logic to use semver."},{"timestamp":1489612608,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1489702584,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 1:\n\nMarc,\n\nThanks for starting a patch for this! To start, I\u0027ve added a comment on the github issue.\n\nThe patch you add here goes through a bit of pain to try to shoehorn a docker version into something semver.gte can cope with. Instead, I think a more future-proof approach would be to:\n\n- Make a separate function called `dockerVersionGte19(dockerVersion)` which is documented to return true if the given `dockerVersion` is greater than or equal to \"1.9.x\"\n- Then, in that function the usage of semver (if at all) is an implementation detail, which helps convey the intent a little better.\n- Then use:\n\n```\nif (!semver.parse(dockerVersion)) {\n    // Version isn\u0027t valid semver, all versions of Docker before 1.9 *were*, so\n    // we know this is \u003e\u003d 1.9.\n    return true;\n} else if (semver.gte(dockerVersion, \u00271.9.0\u0027)) {\n    return true;\n} else {\n    return false;\n}\n```\n\nWould you be willing to update your patch to that?"},{"timestamp":1489706095,"reviewer":{"name":"Marc Tremblay","email":"marcandre.tr@gmail.com","username":"marctrem"},"message":"Patch Set 1:\n\nHi Trent,\n\nSure, it make a lot of sense. Will do.\n\n \u003e Marc,\n \u003e \n \u003e Thanks for starting a patch for this! To start, I\u0027ve added a\n \u003e comment on the github issue.\n \u003e \n \u003e The patch you add here goes through a bit of pain to try to\n \u003e shoehorn a docker version into something semver.gte can cope with.\n \u003e Instead, I think a more future-proof approach would be to:\n \u003e \n \u003e - Make a separate function called `dockerVersionGte19(dockerVersion)`\n \u003e which is documented to return true if the given `dockerVersion` is\n \u003e greater than or equal to \"1.9.x\"\n \u003e - Then, in that function the usage of semver (if at all) is an\n \u003e implementation detail, which helps convey the intent a little\n \u003e better.\n \u003e - Then use:\n \u003e \n \u003e ```\n \u003e if (!semver.parse(dockerVersion)) {\n \u003e // Version isn\u0027t valid semver, all versions of Docker before 1.9\n \u003e *were*, so\n \u003e // we know this is \u003e\u003d 1.9.\n \u003e return true;\n \u003e } else if (semver.gte(dockerVersion, \u00271.9.0\u0027)) {\n \u003e return true;\n \u003e } else {\n \u003e return false;\n \u003e }\n \u003e ```\n \u003e \n \u003e Would you be willing to update your patch to that?"},{"timestamp":1489709158,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Uploaded patch set 2."},{"timestamp":1489709160,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit 6e9fecf9d2fdc25e54da901217c46f8daf96e234\n    \n    joyent/node-triton#190 Modification to previous patch following Trent Mick\u0027s suggestions.\n    Signed-off-by: Marc-André Tremblay \u003cm.tremblay@samsung.com\u003e\n    \n    commit 44a50c06ac71fdaca2fcdff937d8548e360c28e4\n    \n    joyent/node-triton#190 Exception when using current docker client\n    Signed-off-by: Marc-André Tremblay \u003cm.tremblay@samsung.com\u003e"},{"timestamp":1489709192,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1489710750,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Uploaded patch set 3."},{"timestamp":1489710752,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 3:\n\nNew commits:\n    \n    commit f8c53ddf4ff85cf274e8ec697a3d9df427894da1\n    \n    joyent/node-triton#190 Exception when using current docker client\n    Signed-off-by: Marc-André Tremblay \u003cm.tremblay@samsung.com\u003e"},{"timestamp":1489710788,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1489710842,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 3: Code-Review+1\n\nMarc,\n\nI brought your updated change that accidentally was used to create a new CR (https://cr.joyent.us/#/c/1680) back to here where the discussion is. I also tweaked the indentation.\n\nKody,\n\nWould you like to comment?"},{"timestamp":1489760785,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 3: Code-Review+1\n\nOk, this is good enough for me now."},{"timestamp":1489777747,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 4: Commit message was updated."},{"timestamp":1489777752,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 4: Integration-Approval+1"},{"timestamp":1489777761,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Trent Mick"}],"currentPatchSet":{"number":"4","revision":"f27d502d92c29e938342a73b82c3e63159b3d06c","parents":["a3071585aa8b36bded88fa1860332977280b0537"],"ref":"refs/changes/67/1667/4","uploader":{"name":"Marc Tremblay","email":"marcandre.tr@gmail.com","username":"marctrem"},"createdOn":1489777747,"author":{"name":"Marc Tremblay","email":"marcandre.tr@gmail.com","username":"marctrem"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1489710788,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1489710842,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1489760785,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1489777752,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1489777761,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"lib/do_profile/profilecommon.js","type":"MODIFIED","insertions":4,"deletions":-1}],"sizeInsertions":4,"sizeDeletions":-1},"patchSets":[{"number":"1","revision":"44a50c06ac71fdaca2fcdff937d8548e360c28e4","parents":["a3071585aa8b36bded88fa1860332977280b0537"],"ref":"refs/changes/67/1667/1","uploader":{"name":"Marc Tremblay","email":"marcandre.tr@gmail.com","username":"marctrem"},"createdOn":1489606323,"author":{"name":"Marc Tremblay","email":"marcandre.tr@gmail.com","username":"marctrem"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1489606362,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"-1","grantedOn":1489611812,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}}],"comments":[{"file":"lib/do_profile/profilecommon.js","line":481,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"These lines should be indented an additional 2 spaces."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/do_profile/profilecommon.js","type":"MODIFIED","insertions":25,"deletions":-3}],"sizeInsertions":25,"sizeDeletions":-3},{"number":"2","revision":"56ca37eef03f21321d6b61593be9d9dc7872a145","parents":["a3071585aa8b36bded88fa1860332977280b0537"],"ref":"refs/changes/67/1667/2","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1489709158,"author":{"name":"Marc Tremblay","email":"marcandre.tr@gmail.com","username":"marctrem"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1489709192,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"-1","grantedOn":1489611812,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"lib/do_profile/profilecommon.js","type":"MODIFIED","insertions":6,"deletions":-1}],"sizeInsertions":6,"sizeDeletions":-1},{"number":"3","revision":"b1ebc95763dfd4e5a10e3cbb357c27459e7e5318","parents":["a3071585aa8b36bded88fa1860332977280b0537"],"ref":"refs/changes/67/1667/3","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1489710750,"author":{"name":"Marc Tremblay","email":"marcandre.tr@gmail.com","username":"marctrem"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1489710788,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1489710842,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1489760785,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"lib/do_profile/profilecommon.js","type":"MODIFIED","insertions":4,"deletions":-1}],"sizeInsertions":4,"sizeDeletions":-1},{"number":"4","revision":"f27d502d92c29e938342a73b82c3e63159b3d06c","parents":["a3071585aa8b36bded88fa1860332977280b0537"],"ref":"refs/changes/67/1667/4","uploader":{"name":"Marc Tremblay","email":"marcandre.tr@gmail.com","username":"marctrem"},"createdOn":1489777747,"author":{"name":"Marc Tremblay","email":"marcandre.tr@gmail.com","username":"marctrem"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1489710788,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1489710842,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1489777752,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1489777761,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1489760785,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"lib/do_profile/profilecommon.js","type":"MODIFIED","insertions":4,"deletions":-1}],"sizeInsertions":4,"sizeDeletions":-1}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},{"name":"Marc Tremblay","email":"marcandre.tr@gmail.com","username":"marctrem"}]}