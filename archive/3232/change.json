{"project":"joyent/sdc-manta","branch":"master","id":"I3f31937e8ce0f152935f3dfd363549c060eafeea","number":"3232","subject":"MANTA-3417 long-running query probe does not work with PostgreSQL 9.6.3 Reviewed by: David Pacheco \u003cdap@joyent.com\u003e","owner":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"url":"https://cr.joyent.us/3232","commitMessage":"MANTA-3417 long-running query probe does not work with PostgreSQL 9.6.3\nReviewed by: David Pacheco \u003cdap@joyent.com\u003e\n","createdOn":1516291630,"lastUpdated":1528393758,"open":false,"status":"MERGED","comments":[{"timestamp":1516291630,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Uploaded patch set 1."},{"timestamp":1516291632,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit ba1f3a8aee66254bdd43d6982d3e39c63d2b766d\n    \n    MANTA-3417 long-running query probe does not work with PostgreSQL 9.6.3"},{"timestamp":1516291675,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1516300613,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 1:\n\n(1 comment)\n\nThanks for taking this one!"},{"timestamp":1516301907,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1516302278,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 1: Code-Review+1\n\nAlright.\n\nFor what it\u0027s worth, I expect we\u0027ll be supporting 9.2.4 for years to come."},{"timestamp":1516400841,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1516401934,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Uploaded patch set 2."},{"timestamp":1516401935,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit 61a8e7dae74ef60b8d625a4bc7c44f3e6fd2d74c\n    \n    MANTA-3417 long-running query probe does not work with PostgreSQL 9.6.3"},{"timestamp":1516401980,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1516401984,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1516402017,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"Patch Set 2: Code-Review+1"},{"timestamp":1516408616,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1516647572,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1522860718,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Patch Set 3: Patch Set 2 was rebased"},{"timestamp":1522860765,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3:\n\n\"make check\" passed ok"},{"timestamp":1528390142,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"Patch Set 3: Integration-Approval+1"},{"timestamp":1528393300,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Patch Set 4: Patch Set 3 was rebased"},{"timestamp":1528393350,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4:\n\n\"make check\" passed ok"},{"timestamp":1528393758,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Kelly McLaughlin"}],"currentPatchSet":{"number":"4","revision":"7d1a1c5c0e2e67c34e7de4a8e7b2fff75554a0c1","parents":["5e01ed2614c70adf9eb4c567e4bb22edbf923212"],"ref":"refs/changes/32/3232/4","uploader":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"createdOn":1528393300,"author":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1516401984,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1516402017,"by":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1528390142,"by":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"}},{"type":"SUBM","value":"1","grantedOn":1528393758,"by":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"alarm_metadata/probe_templates/postgres.yaml","type":"MODIFIED","insertions":3,"deletions":-2}],"sizeInsertions":3,"sizeDeletions":-2},"patchSets":[{"number":"1","revision":"dc02e73330344fcdf8fdea71c65b884372fdd3c2","parents":["325ac225f0aed800dc61f5b4670e86bdb043b40a"],"ref":"refs/changes/32/3232/1","uploader":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"createdOn":1516291630,"author":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1516302278,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1516291675,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"alarm_metadata/probe_templates/postgres.yaml","line":246,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"How important do you think is having the \"waiting\" column in the output?  It\u0027s certainly nice, but I\u0027m not sure it\u0027s worth the complexity (and brittleness) of dealing with the version difference."},{"file":"alarm_metadata/probe_templates/postgres.yaml","line":246,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Good question. I think for the 9.2 pg instances it\u0027s less valuable, but in 9.6 the information about the type of wait event seems fairly extensive (https://www.postgresql.org/docs/9.6/static/monitoring-stats.html#WAIT-EVENT-TABLE) so is arguably more valuable. \n\nI think either way we\u0027ll want to update this probe after fully moving to 9.6, be it to add back in wait* column info or to remove the conditional expression. I guess I would lean towards accepting the brittleness for now and having more info in the case of the shards we have on 9.6 all things considered. I\u0027m certainly open to just taking out the waiting/wait* columns for now if you feel that\u0027s really a better way to go."},{"file":"alarm_metadata/probe_templates/postgres.yaml","line":246,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"Hardcoded path fails on 9.2 instances."},{"file":"alarm_metadata/probe_templates/postgres.yaml","line":246,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Done"},{"file":"alarm_metadata/probe_templates/postgres.yaml","line":246,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I don\u0027t understand why that failed -- Manatee should provide the symlink for both 9.2 and 9.6 instances, although only after MANATEE-335.  Was that the problem?"},{"file":"alarm_metadata/probe_templates/postgres.yaml","line":246,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"I might have an image older than that for the postgres zones. My zones did not have a `/current` symlink."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"alarm_metadata/probe_templates/postgres.yaml","type":"MODIFIED","insertions":3,"deletions":-1}],"sizeInsertions":3,"sizeDeletions":-1},{"number":"2","revision":"3f31937e8ce0f152935f3dfd363549c060eafeea","parents":["325ac225f0aed800dc61f5b4670e86bdb043b40a"],"ref":"refs/changes/32/3232/2","uploader":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"createdOn":1516401934,"author":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1516401984,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1516402017,"by":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"alarm_metadata/probe_templates/postgres.yaml","type":"MODIFIED","insertions":3,"deletions":-2}],"sizeInsertions":3,"sizeDeletions":-2},{"number":"3","revision":"552ab8e1c0e89179688c4cc356db41876d67a5fa","parents":["7598057228c657c0e4ec961925b146c23d1c6118"],"ref":"refs/changes/32/3232/3","uploader":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"createdOn":1522860718,"author":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1516401984,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1516402017,"by":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1528390142,"by":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"alarm_metadata/probe_templates/postgres.yaml","type":"MODIFIED","insertions":3,"deletions":-2}],"sizeInsertions":3,"sizeDeletions":-2},{"number":"4","revision":"7d1a1c5c0e2e67c34e7de4a8e7b2fff75554a0c1","parents":["5e01ed2614c70adf9eb4c567e4bb22edbf923212"],"ref":"refs/changes/32/3232/4","uploader":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"createdOn":1528393300,"author":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1516401984,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1516402017,"by":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1528390142,"by":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"}},{"type":"SUBM","value":"1","grantedOn":1528393758,"by":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"alarm_metadata/probe_templates/postgres.yaml","type":"MODIFIED","insertions":3,"deletions":-2}],"sizeInsertions":3,"sizeDeletions":-2}],"allReviewers":[{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"}]}