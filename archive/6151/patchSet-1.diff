From 41a0197881ec8f9fef02279e78446196d2432e20 Mon Sep 17 00:00:00 2001
From: Todd Whiteman <todd.whiteman@joyent.com>
Date: Tue, 23 Apr 2019 14:38:28 -0700
Subject: [PATCH] TRITON-1628 migration provision test failing with "invalid
 networks" when no fabrics available

---
 test/vms.migrate.test.js | 7 +++++--
 1 file changed, 5 insertions(+), 2 deletions(-)

diff --git a/test/vms.migrate.test.js b/test/vms.migrate.test.js
index 75f8813..c7d4347 100644
--- a/test/vms.migrate.test.js
+++ b/test/vms.migrate.test.js
@@ -40,7 +40,7 @@ var testMigration = require('./lib/migration');
 /* Globals */
 
 var ADMIN_USER_UUID = common.config.ufdsAdminUuid;
-var PROVISION_NETWORKS = [];
+var PROVISION_NETWORKS;
 var client;
 
 var configurations = [
@@ -188,7 +188,10 @@ exports.config_setup = function configSetup(t) {
             assert.string(cfg.packageName, 'cfg.packageName');
             assert.object(cfg.vm, 'cfg.vm');
 
-            cfg.vm.networks = [PROVISION_NETWORKS];
+            cfg.vm.networks = [];
+            if (PROVISION_NETWORKS) {
+                cfg.vm.networks.push(PROVISION_NETWORKS);
+            }
 
             vasync.pipeline({funcs: [
                 function loadPackages(_, next) {
-- 
2.21.0

