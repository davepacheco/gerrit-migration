{"project":"joyent/illumos-joyent","branch":"master","id":"Iafe3f9d8d23796457bfe72d173ddfad10fb73385","number":"6120","subject":"OS-7717 Want PCIe dcmds and walkers Reviewed by: Jon Anderson \u003cjon.anderson@joyent.com\u003e Reviewed by: Rob Johnston \u003crob.johnston@joyent.com\u003e Approved by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e","owner":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"url":"https://cr.joyent.us/6120","commitMessage":"OS-7717 Want PCIe dcmds and walkers\nReviewed by: Jon Anderson \u003cjon.anderson@joyent.com\u003e\nReviewed by: Rob Johnston \u003crob.johnston@joyent.com\u003e\nApproved by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e\n","createdOn":1555453905,"lastUpdated":1556060410,"open":false,"status":"MERGED","comments":[{"timestamp":1555453905,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Uploaded patch set 1."},{"timestamp":1555950785,"reviewer":{"name":"Jon Anderson","email":"jon.anderson@joyent.com","username":"bowrocker"},"message":"Patch Set 1:\n\n(3 comments)"},{"timestamp":1555967017,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 1:\n\n(3 comments)"},{"timestamp":1555974933,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Patch Set 1:\n\n(2 comments)\n\nTwo minor typos - otherwise, looks good."},{"timestamp":1555976647,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Uploaded patch set 2."},{"timestamp":1555976653,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 1:\n\n(2 comments)"},{"timestamp":1555977391,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Patch Set 2: Code-Review+1"},{"timestamp":1556019847,"reviewer":{"name":"Jon Anderson","email":"jon.anderson@joyent.com","username":"bowrocker"},"message":"Patch Set 2: Code-Review-1 Integration-Approval-1"},{"timestamp":1556019858,"reviewer":{"name":"Jon Anderson","email":"jon.anderson@joyent.com","username":"bowrocker"},"message":"Patch Set 2: Code-Review+1 Integration-Approval+1"},{"timestamp":1556040267,"reviewer":{"name":"Jon Anderson","email":"jon.anderson@joyent.com","username":"bowrocker"},"message":"Patch Set 2: -Integration-Approval"},{"timestamp":1556055174,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 2: Integration-Approval+1"},{"timestamp":1556060351,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Uploaded patch set 3: Patch Set 2 was rebased."},{"timestamp":1556060405,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Uploaded patch set 4: Commit message was updated."},{"timestamp":1556060410,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Robert Mustacchi"}],"currentPatchSet":{"number":"4","revision":"afe3f9d8d23796457bfe72d173ddfad10fb73385","parents":["0cba37f035f83ba6fad928fce41542860dfb62cd"],"ref":"refs/changes/20/6120/4","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1556060405,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1555977391,"by":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1556019858,"by":{"name":"Jon Anderson","email":"jon.anderson@joyent.com","username":"bowrocker"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1556055174,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"SUBM","value":"1","grantedOn":1556060410,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/cmd/mdb/common/modules/genunix/Makefile.files","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/cmd/mdb/common/modules/genunix/devinfo.c","type":"MODIFIED","insertions":65,"deletions":-9},{"file":"usr/src/cmd/mdb/common/modules/genunix/devinfo.h","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"usr/src/cmd/mdb/common/modules/genunix/genunix.c","type":"MODIFIED","insertions":10,"deletions":-5},{"file":"usr/src/cmd/mdb/common/modules/genunix/hotplug.c","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/cmd/mdb/common/modules/genunix/pci.c","type":"ADDED","insertions":79,"deletions":0},{"file":"usr/src/cmd/mdb/common/modules/genunix/pci.h","type":"ADDED","insertions":40,"deletions":0}],"sizeInsertions":204,"sizeDeletions":-16},"patchSets":[{"number":"1","revision":"70507d95b11c4b3ab524eba3104354e229b95774","parents":["39324c3c3e700905593cf884cb6987cf0db01381"],"ref":"refs/changes/20/6120/1","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1555453905,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/cmd/mdb/common/modules/genunix/devinfo.c","line":90,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"s/maches/matches/"},{"file":"usr/src/cmd/mdb/common/modules/genunix/devinfo.c","line":90,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"},{"file":"usr/src/cmd/mdb/common/modules/genunix/devinfo.c","line":1131,"reviewer":{"name":"Jon Anderson","email":"jon.anderson@joyent.com","username":"bowrocker"},"message":"You might consider renaming the \u0027bus\u0027 variable to something more contextualized."},{"file":"usr/src/cmd/mdb/common/modules/genunix/devinfo.c","line":1131,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"What would be clearer to you in this context? I thought that perhaps because the help message for the option indicates that we\u0027re looking at the devinfo bus structures and the argument has the name of a bus type, that might help. But if there\u0027s something clearer, I\u0027d rather use that."},{"file":"usr/src/cmd/mdb/common/modules/genunix/devinfo.c","line":1184,"reviewer":{"name":"Jon Anderson","email":"jon.anderson@joyent.com","username":"bowrocker"},"message":"Newbie question: how does \u0027bus\u0027 get set to point to something meaningful?"},{"file":"usr/src/cmd/mdb/common/modules/genunix/devinfo.c","line":1184,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"If you look at line +1177 there is a call to mdb_getopts(). As part of the option processing we ask it to set the string bus, if the -b option is passed. Basically the format is roughly, \u003cflag\u003e \u003coption type\u003e \u003ctype specific values\u003e. So in this case the \u0027b\u0027, MDB_OPT_STR, \u0026bus, refer to those three types above. As part of processing the variable arguments, mdb_getopt will place the operand of the -b option in the pointer to the variable \u0027bus\u0027.\n\nDoes that help?"},{"file":"usr/src/cmd/mdb/common/modules/genunix/devinfo.c","line":1191,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Should this be -d?"},{"file":"usr/src/cmd/mdb/common/modules/genunix/devinfo.c","line":1191,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Yeah, it should be. Thanks."},{"file":"usr/src/cmd/mdb/common/modules/genunix/pci.c","line":41,"reviewer":{"name":"Jon Anderson","email":"jon.anderson@joyent.com","username":"bowrocker"},"message":"Just for my edification: this file does not define a fini function, I assume because there is no memory allocated in the init that needs clean-up, is that right?"},{"file":"usr/src/cmd/mdb/common/modules/genunix/pci.c","line":41,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"That\u0027s right. In this case there\u0027s no state for us to clean up or other action to take. If there were, we\u0027d probably have allocated memory with mdb_alloc flag UM_GC. That would cause the memory to be associated with the invocation and get cleaned up when the command finishes. It\u0027s a slightly different form of garbage collection."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/mdb/common/modules/genunix/Makefile.files","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/cmd/mdb/common/modules/genunix/devinfo.c","type":"MODIFIED","insertions":65,"deletions":-9},{"file":"usr/src/cmd/mdb/common/modules/genunix/devinfo.h","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"usr/src/cmd/mdb/common/modules/genunix/genunix.c","type":"MODIFIED","insertions":10,"deletions":-5},{"file":"usr/src/cmd/mdb/common/modules/genunix/hotplug.c","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/cmd/mdb/common/modules/genunix/pci.c","type":"ADDED","insertions":79,"deletions":0},{"file":"usr/src/cmd/mdb/common/modules/genunix/pci.h","type":"ADDED","insertions":40,"deletions":0}],"sizeInsertions":204,"sizeDeletions":-16},{"number":"2","revision":"5eb1b41478b78fed082305d2c71a1e49da50c888","parents":["39324c3c3e700905593cf884cb6987cf0db01381"],"ref":"refs/changes/20/6120/2","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1555976647,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1556055174,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1555977391,"by":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1556019858,"by":{"name":"Jon Anderson","email":"jon.anderson@joyent.com","username":"bowrocker"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/mdb/common/modules/genunix/Makefile.files","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/cmd/mdb/common/modules/genunix/devinfo.c","type":"MODIFIED","insertions":65,"deletions":-9},{"file":"usr/src/cmd/mdb/common/modules/genunix/devinfo.h","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"usr/src/cmd/mdb/common/modules/genunix/genunix.c","type":"MODIFIED","insertions":10,"deletions":-5},{"file":"usr/src/cmd/mdb/common/modules/genunix/hotplug.c","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/cmd/mdb/common/modules/genunix/pci.c","type":"ADDED","insertions":79,"deletions":0},{"file":"usr/src/cmd/mdb/common/modules/genunix/pci.h","type":"ADDED","insertions":40,"deletions":0}],"sizeInsertions":204,"sizeDeletions":-16},{"number":"3","revision":"54ea6a0e8d1297200da3385f3e642a150d8e17e6","parents":["0cba37f035f83ba6fad928fce41542860dfb62cd"],"ref":"refs/changes/20/6120/3","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1556060351,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1556055174,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1555977391,"by":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1556019858,"by":{"name":"Jon Anderson","email":"jon.anderson@joyent.com","username":"bowrocker"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/mdb/common/modules/genunix/Makefile.files","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/cmd/mdb/common/modules/genunix/devinfo.c","type":"MODIFIED","insertions":65,"deletions":-9},{"file":"usr/src/cmd/mdb/common/modules/genunix/devinfo.h","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"usr/src/cmd/mdb/common/modules/genunix/genunix.c","type":"MODIFIED","insertions":10,"deletions":-5},{"file":"usr/src/cmd/mdb/common/modules/genunix/hotplug.c","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/cmd/mdb/common/modules/genunix/pci.c","type":"ADDED","insertions":79,"deletions":0},{"file":"usr/src/cmd/mdb/common/modules/genunix/pci.h","type":"ADDED","insertions":40,"deletions":0}],"sizeInsertions":204,"sizeDeletions":-16},{"number":"4","revision":"afe3f9d8d23796457bfe72d173ddfad10fb73385","parents":["0cba37f035f83ba6fad928fce41542860dfb62cd"],"ref":"refs/changes/20/6120/4","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1556060405,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"SUBM","value":"1","grantedOn":1556060410,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1556055174,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1555977391,"by":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1556019858,"by":{"name":"Jon Anderson","email":"jon.anderson@joyent.com","username":"bowrocker"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/cmd/mdb/common/modules/genunix/Makefile.files","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/cmd/mdb/common/modules/genunix/devinfo.c","type":"MODIFIED","insertions":65,"deletions":-9},{"file":"usr/src/cmd/mdb/common/modules/genunix/devinfo.h","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"usr/src/cmd/mdb/common/modules/genunix/genunix.c","type":"MODIFIED","insertions":10,"deletions":-5},{"file":"usr/src/cmd/mdb/common/modules/genunix/hotplug.c","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/cmd/mdb/common/modules/genunix/pci.c","type":"ADDED","insertions":79,"deletions":0},{"file":"usr/src/cmd/mdb/common/modules/genunix/pci.h","type":"ADDED","insertions":40,"deletions":0}],"sizeInsertions":204,"sizeDeletions":-16}],"allReviewers":[{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},{"name":"Jon Anderson","email":"jon.anderson@joyent.com","username":"bowrocker"},{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}]}