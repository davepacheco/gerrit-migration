From 1edbfe1e4a0f5a56c90a6402e2671cab471e9a35 Mon Sep 17 00:00:00 2001
From: Angela Fong <angela.fong@joyent.com>
Date: Thu, 19 Oct 2017 22:52:06 -0700
Subject: [PATCH] ADMINUI-2388 When packages with similar names are created,
 their package versions are listed in the other's versions

---
 lib/packages.js          | 8 ++++++--
 www/js/views/packages.js | 2 +-
 2 files changed, 7 insertions(+), 3 deletions(-)

diff --git a/lib/packages.js b/lib/packages.js
index 66da16ca..506867e0 100644
--- a/lib/packages.js
+++ b/lib/packages.js
@@ -127,14 +127,18 @@ module.exports.list = function (req, res, next) {
                 return;
             }
             if (typeof (value) === 'string' && value.length) {
-                if (key === 'billing_id' || value === 'true' || value === 'false') {
+                if (key === 'billing_id' || key === 'name' || value === 'true' || value === 'false') {
                     if (key === 'billing_id') {
                         filter.push(sprintf('(%s=%s)', 'uuid', value));
                     } else {
                         filter.push(sprintf('(%s=%s)', key, value));
                     }
                 } else {
-                    filter.push(sprintf('(%s:caseIgnoreSubstringsMatch:=*%s*)', key, value));
+                    if (key === 'name_substring') {
+                        filter.push(sprintf('(%s:caseIgnoreSubstringsMatch:=*%s*)', 'name', value));
+                    } else {
+                        filter.push(sprintf('(%s:caseIgnoreSubstringsMatch:=*%s*)', key, value));
+                    }
                 }
                 return;
             }
diff --git a/www/js/views/packages.js b/www/js/views/packages.js
index caf76183..8799573a 100644
--- a/www/js/views/packages.js
+++ b/www/js/views/packages.js
@@ -222,7 +222,7 @@ var PackagesView = Backbone.Marionette.Layout.extend({
 
         var data = {
             active: getValue('active'),
-            name: getValue('name'),
+            name_substring: getValue('name'),
             traits: getValue('traits'),
             group: getValue('group'),
             billing_id: getValue('billing_id')
-- 
2.21.0

