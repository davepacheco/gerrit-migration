{"project":"joyent/sdc-headnode","branch":"master","id":"I260aec3a03b49b5afe49929427510a6924fa6623","number":"4434","subject":"TRITON-92 set \u0027dns_domain\u0027 on all Triton core VMs Reviewed by: Marsell Kukuljevic \u003cmarsell@joyent.com\u003e Approved by: Marsell Kukuljevic \u003cmarsell@joyent.com\u003e","owner":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"url":"https://cr.joyent.us/4434","commitMessage":"TRITON-92 set \u0027dns_domain\u0027 on all Triton core VMs\nReviewed by: Marsell Kukuljevic \u003cmarsell@joyent.com\u003e\nApproved by: Marsell Kukuljevic \u003cmarsell@joyent.com\u003e\n","createdOn":1530023254,"lastUpdated":1530714844,"open":false,"status":"MERGED","comments":[{"timestamp":1530023254,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 1."},{"timestamp":1530023259,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit 3a91c0d0512677d8dfe306cea27bac0e045da6cb\n    \n    TRITON-92 set \u0027dns_domain\u0027 on all Triton core VMs"},{"timestamp":1530023342,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1530023575,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 1:\n\nI\u0027ve also got the sdcadm required changes ready, but those depend into TOOLS-1896 getting merged first, since the changes will affect both, update sapi v1 and v2"},{"timestamp":1530631728,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 1:\n\n(3 comments)"},{"timestamp":1530637770,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 2."},{"timestamp":1530637776,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit d4a16813ece75fe9d1262cbaefaa2e9c9b3abbcc\n    \n    TRITON-92 set \u0027dns_domain\u0027 on all Triton core VMs"},{"timestamp":1530637860,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1530637948,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 1:\n\n(3 comments)\n\nDone with the missing function names!"},{"timestamp":1530638115,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 2: Code-Review+1\n\nHow was this tested?"},{"timestamp":1530639791,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 2:\n\n\u003e How was this tested?\n\nFor new setups built including this feature, we need to check that SAPI\u0027s SDC application contains the \"dns_domain\" parameter with the right value (usually \"joyent.us\").\n\nOnce this is checked, we need to verify that every core VM has the \"dns_domain\" metadata value set using `mdata-get sdc:dns_domain`. Additionally, this means that `resolv.conf` will include a search value equal to the provided dns_domain value. \n\nThe following is an example of a today\u0027s build:\n\n    [root@cf40cbff-8444-4849-abb0-657a489d8bde (coal:papi0) ~]# mdata-get sdc:dns_domain\n    joyent.us\n    [root@cf40cbff-8444-4849-abb0-657a489d8bde (coal:papi0) ~]# cat /etc/resolv.conf\n    search joyent.us\n    nameserver 10.99.99.11\n\n    [root@headnode (coal) ~]# sdc-sapi /applications?name\u003dsdc|json -Ha params\n    {\n      \"brand\": \"joyent-minimal\",\n      \"zfs_storage_pool_name\": \"zones\",\n      \"owner_uuid\": \"930896af-bf8c-48d4-885c-6573a94b1853\",\n      \"dns_domain\": \"joyent.us\"\n    }"},{"timestamp":1530639949,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 3: Commit message was updated."},{"timestamp":1530654810,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 3: Integration-Approval+1"},{"timestamp":1530714831,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 4: Commit message was updated."},{"timestamp":1530714844,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Pedro Palazón Candel"}],"currentPatchSet":{"number":"4","revision":"260aec3a03b49b5afe49929427510a6924fa6623","parents":["2e63d0477a955bef55d20c8a22196dec29b5604d"],"ref":"refs/changes/34/4434/4","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1530714831,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1530637860,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1530638115,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1530654810,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}},{"type":"SUBM","value":"1","grantedOn":1530714844,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"scripts/build-payload.js","type":"MODIFIED","insertions":4,"deletions":-7},{"file":"scripts/headnode.sh","type":"MODIFIED","insertions":0,"deletions":-6},{"file":"scripts/sdc-init.js","type":"MODIFIED","insertions":29,"deletions":-28}],"sizeInsertions":33,"sizeDeletions":-41},"patchSets":[{"number":"1","revision":"a743c5bbbab70b3b9d3a42353f1f00989ed222d9","parents":["2e63d0477a955bef55d20c8a22196dec29b5604d"],"ref":"refs/changes/34/4434/1","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1530023254,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1530023342,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"scripts/build-payload.js","line":44,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Might as well name it."},{"file":"scripts/build-payload.js","line":44,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"scripts/build-payload.js","line":62,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Might as well name it."},{"file":"scripts/build-payload.js","line":62,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"scripts/sdc-init.js","line":326,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Since you\u0027re here, might as well name it."},{"file":"scripts/sdc-init.js","line":326,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"scripts/build-payload.js","type":"MODIFIED","insertions":4,"deletions":-7},{"file":"scripts/headnode.sh","type":"MODIFIED","insertions":0,"deletions":-6},{"file":"scripts/sdc-init.js","type":"MODIFIED","insertions":21,"deletions":-21}],"sizeInsertions":25,"sizeDeletions":-34},{"number":"2","revision":"d631336f3cbbd2bfa3d55304dc760b98396fbd81","parents":["2e63d0477a955bef55d20c8a22196dec29b5604d"],"ref":"refs/changes/34/4434/2","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1530637770,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1530637860,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1530638115,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"scripts/build-payload.js","type":"MODIFIED","insertions":4,"deletions":-7},{"file":"scripts/headnode.sh","type":"MODIFIED","insertions":0,"deletions":-6},{"file":"scripts/sdc-init.js","type":"MODIFIED","insertions":29,"deletions":-28}],"sizeInsertions":33,"sizeDeletions":-41},{"number":"3","revision":"fbd35632cae715594e98ab9512370f9b7e6ba664","parents":["2e63d0477a955bef55d20c8a22196dec29b5604d"],"ref":"refs/changes/34/4434/3","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1530639949,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1530637860,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1530638115,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1530654810,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"scripts/build-payload.js","type":"MODIFIED","insertions":4,"deletions":-7},{"file":"scripts/headnode.sh","type":"MODIFIED","insertions":0,"deletions":-6},{"file":"scripts/sdc-init.js","type":"MODIFIED","insertions":29,"deletions":-28}],"sizeInsertions":33,"sizeDeletions":-41},{"number":"4","revision":"260aec3a03b49b5afe49929427510a6924fa6623","parents":["2e63d0477a955bef55d20c8a22196dec29b5604d"],"ref":"refs/changes/34/4434/4","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1530714831,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1530637860,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"SUBM","value":"1","grantedOn":1530714844,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1530638115,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1530654810,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"scripts/build-payload.js","type":"MODIFIED","insertions":4,"deletions":-7},{"file":"scripts/headnode.sh","type":"MODIFIED","insertions":0,"deletions":-6},{"file":"scripts/sdc-init.js","type":"MODIFIED","insertions":29,"deletions":-28}],"sizeInsertions":33,"sizeDeletions":-41}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}]}