{"project":"joyent/illumos-joyent","branch":"master","id":"I6adf3572d162d303f514f35caa5e1a118d604374","number":"5092","subject":"OS-7387 document and create scaffolding to run zfstest on SmartOS Reviewed by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e Approved by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e","owner":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"url":"https://cr.joyent.us/5092","commitMessage":"OS-7387 document and create scaffolding to run zfstest on SmartOS\nReviewed by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e\nApproved by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e\n","createdOn":1542833883,"lastUpdated":1543245975,"open":false,"status":"MERGED","comments":[{"timestamp":1542833883,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Uploaded patch set 1."},{"timestamp":1542834822,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Uploaded patch set 2."},{"timestamp":1542834970,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 2:\n\n(1 comment)\n\nThoughts on this? This isn\u0027t clean enough to upstream, but maybe we can carry the changes until we implement something better?"},{"timestamp":1542837752,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 2:\n\n(4 comments)\n\nThis is great work. I just had a few minor nits."},{"timestamp":1542840827,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1542841312,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Uploaded patch set 3."},{"timestamp":1542842161,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 3: Code-Review+1\n\nThanks for the update and explanation on the change in zfstest.ksh. There is no need to spend more time working on this."},{"timestamp":1542842226,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 3: Integration-Approval+1"},{"timestamp":1543245800,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Uploaded patch set 4: Patch Set 3 was rebased."},{"timestamp":1543245944,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Uploaded patch set 5: Commit message was updated."},{"timestamp":1543245975,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Kody A Kantor"}],"currentPatchSet":{"number":"5","revision":"6adf3572d162d303f514f35caa5e1a118d604374","parents":["495b9ab8bcfc42bce11417bd7024a5247d6ded2c"],"ref":"refs/changes/92/5092/5","uploader":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"createdOn":1543245944,"author":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1542842161,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1542842226,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"SUBM","value":"1","grantedOn":1543245975,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/test/Readme.smartos","type":"MODIFIED","insertions":38,"deletions":-6},{"file":"usr/src/test/test-runner/cmd/run","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"usr/src/test/zfs-tests/cmd/scripts/zfstest.ksh","type":"MODIFIED","insertions":15,"deletions":0},{"file":"usr/src/test/zfs-tests/runfiles/smartos.run","type":"ADDED","insertions":298,"deletions":0}],"sizeInsertions":358,"sizeDeletions":-7},"patchSets":[{"number":"1","revision":"dd7c598340afd55354c469d5d701265f74bc442a","parents":["4c0a6530a73bb7c1c797ba4ceded374baa75017e"],"ref":"refs/changes/92/5092/1","uploader":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"createdOn":1542833883,"author":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/test/Readme.smartos","type":"MODIFIED","insertions":38,"deletions":-6},{"file":"usr/src/test/test-runner/cmd/run","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"usr/src/test/zfs-tests/cmd/scripts/zfstest.ksh","type":"MODIFIED","insertions":15,"deletions":0},{"file":"usr/src/test/zfs-tests/runfiles/smartos.run","type":"ADDED","insertions":297,"deletions":0},{"file":"usr/src/test/zfs-tests/tests/functional/zvol/zvol_common.shlib","type":"MODIFIED","insertions":2,"deletions":-1}],"sizeInsertions":359,"sizeDeletions":-8},{"number":"2","revision":"68cfbd315ae02bc475753c35372568e5025e9c9d","parents":["4c0a6530a73bb7c1c797ba4ceded374baa75017e"],"ref":"refs/changes/92/5092/2","uploader":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"createdOn":1542834822,"author":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/test/Readme.smartos","line":79,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"this is wrong and not possible.  I think you can just say they must be installed though (or mention that the test runner will properly find them)"},{"file":"usr/src/test/Readme.smartos","line":105,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"maybe reiterate this must be done after 4.e above?"},{"file":"usr/src/test/test-runner/cmd/run","line":49,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"The changes here and in the \u0027zfstest.ksh\u0027 script are ugly and brittle. I don\u0027t know of an easy way of getting this stuff working reliably without doing a big refactor. Thoughts?"},{"file":"usr/src/test/test-runner/cmd/run","line":49,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"I think it\u0027s fine for us to carry this as a local patch in illumos-joyent. There won\u0027t be any big merge issues around these"},{"file":"usr/src/test/zfs-tests/cmd/scripts/zfstest.ksh","line":136,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"this rm seems unnecessary and confusing given the test block we\u0027re in. same comment for the following one as well"},{"file":"usr/src/test/zfs-tests/cmd/scripts/zfstest.ksh","line":136,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"I agree it seems strange! The create_links function will create a broken link which must be removed before we create a new link here.\n\nApparently a broken link file passes this conditional because the underlying file doesn\u0027t exist. However the link remains, which must be removed. Since this is confusing I\u0027ll try a few different combinations of \u0027if\u0027 conditionals that might make it clearer.\n\nFor the record this is the error we get if we run this without the \u0027rm\u0027:\n\n root@pepsi:/opt/zfs-tests/bin# ./zfstest\n ln: cannot create /var/tmp/constrained_path.aOVb/sudo: File exists\n Couldn\u0027t link sudo"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/test/Readme.smartos","type":"MODIFIED","insertions":38,"deletions":-6},{"file":"usr/src/test/test-runner/cmd/run","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"usr/src/test/zfs-tests/cmd/scripts/zfstest.ksh","type":"MODIFIED","insertions":15,"deletions":0},{"file":"usr/src/test/zfs-tests/runfiles/smartos.run","type":"ADDED","insertions":297,"deletions":0}],"sizeInsertions":357,"sizeDeletions":-7},{"number":"3","revision":"6d954d6bdddb49a10b00f0ae6d8820e617a69261","parents":["4c0a6530a73bb7c1c797ba4ceded374baa75017e"],"ref":"refs/changes/92/5092/3","uploader":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"createdOn":1542841312,"author":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1542842161,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1542842226,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/test/Readme.smartos","type":"MODIFIED","insertions":38,"deletions":-6},{"file":"usr/src/test/test-runner/cmd/run","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"usr/src/test/zfs-tests/cmd/scripts/zfstest.ksh","type":"MODIFIED","insertions":15,"deletions":0},{"file":"usr/src/test/zfs-tests/runfiles/smartos.run","type":"ADDED","insertions":298,"deletions":0}],"sizeInsertions":358,"sizeDeletions":-7},{"number":"4","revision":"46d395e4d6dc4df4fe9a3117f442a1d8b7966591","parents":["495b9ab8bcfc42bce11417bd7024a5247d6ded2c"],"ref":"refs/changes/92/5092/4","uploader":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"createdOn":1543245800,"author":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1542842161,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1542842226,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/test/Readme.smartos","type":"MODIFIED","insertions":38,"deletions":-6},{"file":"usr/src/test/test-runner/cmd/run","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"usr/src/test/zfs-tests/cmd/scripts/zfstest.ksh","type":"MODIFIED","insertions":15,"deletions":0},{"file":"usr/src/test/zfs-tests/runfiles/smartos.run","type":"ADDED","insertions":298,"deletions":0}],"sizeInsertions":358,"sizeDeletions":-7},{"number":"5","revision":"6adf3572d162d303f514f35caa5e1a118d604374","parents":["495b9ab8bcfc42bce11417bd7024a5247d6ded2c"],"ref":"refs/changes/92/5092/5","uploader":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"createdOn":1543245944,"author":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1542842161,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1542842226,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"SUBM","value":"1","grantedOn":1543245975,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/test/Readme.smartos","type":"MODIFIED","insertions":38,"deletions":-6},{"file":"usr/src/test/test-runner/cmd/run","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"usr/src/test/zfs-tests/cmd/scripts/zfstest.ksh","type":"MODIFIED","insertions":15,"deletions":0},{"file":"usr/src/test/zfs-tests/runfiles/smartos.run","type":"ADDED","insertions":298,"deletions":0}],"sizeInsertions":358,"sizeDeletions":-7}],"allReviewers":[{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}]}