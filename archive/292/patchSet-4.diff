From 528aa3eb3c3580c9aa7e8d80e86b533868a75e56 Mon Sep 17 00:00:00 2001
From: Johanan Lai <lai.johanan@gmail.com>
Date: Mon, 15 Aug 2016 16:12:14 -0700
Subject: [PATCH] ADMINUI-2333 Incompletely setup CN shows NaN% disk
 utilization

---
 www/js/components/pages/server/disk-overview.jsx | 16 ++++++++++++++--
 .../pages/server/disk-utilization-circle.jsx     | 15 ++++++++++++---
 2 files changed, 26 insertions(+), 5 deletions(-)

diff --git a/www/js/components/pages/server/disk-overview.jsx b/www/js/components/pages/server/disk-overview.jsx
index daa884b3..24de17b7 100644
--- a/www/js/components/pages/server/disk-overview.jsx
+++ b/www/js/components/pages/server/disk-overview.jsx
@@ -21,8 +21,20 @@ var ServerDiskOverview = React.createClass({
     render: function() {
         var server = this.props.server.toJSON();
 
-        var provisionable = utils.getReadableSize(server.unreserved_disk * 1048576);
-        var provisioned = utils.getReadableSize(server.disk_pool_size_bytes - (server.unreserved_disk * 1048576));
+        var provisionable = server.unreserved_disk * 1048576;
+        var provisioned = server.disk_pool_size_bytes - (server.unreserved_disk * 1048576);
+
+        if (provisioned < 0 || typeof provisioned !== "number") { provisioned = 0; }
+        if (provisionable < 0) {
+            provisionable = 0;
+        } else if (typeof provisioned !== "number" && typeof server.disk_pool_size_bytes === "number") {
+            provisionable = server.disk_pool_size_bytes;
+        } else if (typeof provisioned !== "number") {
+            provisionable = 0;
+        }
+
+        var provisionable = utils.getReadableSize(provisionable);
+        var provisioned = utils.getReadableSize(provisioned);
         var total = utils.getReadableSize(server.disk_pool_size_bytes);
 
         return <div className="disk-overview">
diff --git a/www/js/components/pages/server/disk-utilization-circle.jsx b/www/js/components/pages/server/disk-utilization-circle.jsx
index 99faae0d..598915f8 100644
--- a/www/js/components/pages/server/disk-utilization-circle.jsx
+++ b/www/js/components/pages/server/disk-utilization-circle.jsx
@@ -31,8 +31,14 @@ var ServerMemoryUtilizationCircle = React.createClass({
         var provisioned = server.disk_pool_size_bytes - (server.unreserved_disk * 1048576);
         var provisionable = server.unreserved_disk * 1048576;
 
-        if (provisioned < 0) { provisioned = 0; }
-        if (provisionable < 0) { provisionable = 0; }
+        if (provisioned < 0 || typeof provisioned !== "number") { provisioned = 0; }
+        if (provisionable < 0) {
+            provisionable = 0;
+        } else if (typeof provisioned !== "number" && typeof server.disk_pool_size_bytes === "number") {
+            provisionable = server.disk_pool_size_bytes;
+        } else if (typeof provisioned !== "number") {
+            provisionable = 0;
+        }
 
         var pieData = [
             {label: 'Provisioned', value: provisioned },
@@ -72,7 +78,10 @@ var ServerMemoryUtilizationCircle = React.createClass({
         var provisioned = server.disk_pool_size_bytes - (server.unreserved_disk * 1048576);
         var total = server.disk_pool_size_bytes;
 
-        var util_percent = Math.round(provisioned / total * 100);
+        if (typeof provisioned !== "number") { provisioned = 0; }
+        if (typeof total !== "number") { total = 0; }
+
+        var util_percent = (total > 0) ? Math.round(provisioned / total * 100) : 0;
         if (util_percent < 0) { util_percent = 0; }
 
         var pctSize, labelSize;
-- 
2.21.0

