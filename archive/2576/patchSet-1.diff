commit 5d30d26fd2cfbe1b73ea6645bf9c48a403b276c9 (refs/changes/76/2576/1)
Author: Todd Whiteman <todd.whiteman@joyent.com>
Date:   2017-09-14T16:29:04-07:00 (2 years, 1 month ago)
    
    DOCKER-1102 docker pull by manifest digest fails with an InternalError

diff --git a/lib/wfapi/workflows/pull-image-v2.js b/lib/wfapi/workflows/pull-image-v2.js
index 4da3f51..e43a01a 100644
--- a/lib/wfapi/workflows/pull-image-v2.js
+++ b/lib/wfapi/workflows/pull-image-v2.js
@@ -111,7 +111,7 @@ function pullImageLayersV2(job, cb) {
     var opts = {
         repo: job.params.rat.canonicalName,
         tag: job.params.rat.tag,
-        config_digest: job.params.rat.digest,
+        digest: job.params.rat.digest,
         regAuth: job.params.regAuth,
         regConfig: job.params.regConfig,
         /*
diff --git a/package.json b/package.json
index 9a9c30f..92ca099 100644
--- a/package.json
+++ b/package.json
@@ -1,6 +1,6 @@
 {
   "name": "sdc-docker",
-  "version": "0.4.3",
+  "version": "0.4.4",
   "author": "Joyent (joyent.com)",
   "private": true,
   "dependencies": {
diff --git a/test/integration/api-images.test.js b/test/integration/api-images.test.js
index 2899b02..0c16f25 100644
--- a/test/integration/api-images.test.js
+++ b/test/integration/api-images.test.js
@@ -84,7 +84,6 @@ test('docker images', function (tt) {
             name: 'ubuntu:latest',
             user: ALICE
         }, function (err) {
-            console.log('ubuntu pull err: ', err);
             t.error(err, 'should be no error pulling image');
             t.end();
         });
@@ -185,4 +184,26 @@ test('docker images', function (tt) {
             t.end();
         });
     });
+
+
+    // Ensure an image can be pulled using the manifest digest.
+    tt.test('pull ubuntu image by manifest digest', function (t) {
+        var repoDigest = img.RepoDigests[0];
+        h.ensureImage({
+            name: repoDigest,
+            user: ALICE
+        }, function (err) {
+            t.error(err, 'should be no error pulling image');
+            t.end();
+        });
+    });
+
+
+    tt.test('delete image', function (t) {
+        DOCKER_ALICE.del('/images/ubuntu', ondel);
+        function ondel(err, req, res) {
+            t.error(err, 'should be no error retrieving images');
+            t.end();
+        }
+    });
 });
