From 7574d7c9506736675ed0afe85cd84bf33d6ffaae Mon Sep 17 00:00:00 2001
From: Trent Mick <trentm@gmail.com>
Date: Wed, 11 Oct 2017 16:16:30 -0700
Subject: [PATCH] ZAPI-807 allow sdc-vmapi's rsync-to to work with a VMAPI
 instance *not* named "vmapi0"

---
 tools/rsync-to | 9 +++++++--
 1 file changed, 7 insertions(+), 2 deletions(-)

diff --git a/tools/rsync-to b/tools/rsync-to
index a510662..4e5818f 100755
--- a/tools/rsync-to
+++ b/tools/rsync-to
@@ -13,14 +13,19 @@
 # Rsync the master in this working copy to the install on the given HN.
 #
 
-#set -o xtrace
+if [[ -n "$TRACE" ]]; then
+    export PS4='[\D{%FT%TZ}] ${BASH_SOURCE}:${LINENO}: ${FUNCNAME[0]:+${FUNCNAME[0]}(): }'
+    set -o xtrace
+fi
 set -o errexit
+set -o pipefail
+
 
 TOP=$(cd $(dirname $0)/../; pwd)
 NODE="root@$1"
 
 if [[ -z "$VMAPI_ZONE" ]]; then
-    VMAPI_ZONE=$(ssh $NODE "vmadm lookup -1 alias=vmapi0" 2>/dev/null)
+    VMAPI_ZONE=$(ssh $NODE "vmadm lookup -1 alias=~^vmapi" 2>/dev/null)
 fi
 echo "VMAPI_ZONE: $VMAPI_ZONE"
 
-- 
2.21.0

