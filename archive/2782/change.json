{"project":"joyent/smartos-live","branch":"master","id":"I1c2c59922161a9d98f109983c9e07205eb1d7889","number":"2782","subject":"OS-2647 add vminfod to keep track of VM state and speed up lookups in vmadm Reviewed by: Josh Wilsdon \u003cjosh@wilsdon.ca\u003e Approved by: Angela Fong \u003cangela.fong@joyent.com\u003e","owner":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"url":"https://cr.joyent.us/2782","commitMessage":"OS-2647 add vminfod to keep track of VM state and speed up lookups in vmadm\nReviewed by: Josh Wilsdon \u003cjosh@wilsdon.ca\u003e\nApproved by: Angela Fong \u003cangela.fong@joyent.com\u003e\n","createdOn":1507917779,"lastUpdated":1537568981,"open":false,"status":"MERGED","comments":[{"timestamp":1507917779,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Uploaded patch set 1."},{"timestamp":1507917822,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1507918047,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 1:\n\nA couple of review notes:\n\n1. node-vasync is updated to the latest version with this change, as well as with node-vasync#37 integrated.  Once this change is merged (https://github.com/joyent/node-vasync/issues/37, https://cr.joyent.us/#/c/2398/) these files can be removed from this vminfod review to make it simpler.\n\n2. vm-agent requires a vminfod watcher (see https://devhub.joyent.com/jira/browse/AGENT-979, https://cr.joyent.us/#/c/2730/).  However, that implementation currently uses `vminfod/client` from this CR.  The problem with that is vminfod/client is shipped with the platform, and as such, can cause issues when called from an unexpected version of node.\n\nIf you\u0027d like to review this code, please not these above 2 issues that will likely result in changes to this CR."},{"timestamp":1510683689,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Uploaded patch set 2."},{"timestamp":1510683692,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit fff98eabd3a334e915bedbd657bf721704875242\n    \n    fswatcher docs\n    \n    commit c1cc265293e255c3df0410346bcbfad8e16ebe58\n    \n    align with vminfod branch"},{"timestamp":1510683729,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1511198808,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Uploaded patch set 3."},{"timestamp":1511198850,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1511897283,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Patch Set 3:\n\n(2 comments)"},{"timestamp":1511908876,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 3:\n\n(16 comments)\n\nI\u0027ve only looked at fswatcher so far, and just some fairly minor questions/suggestions."},{"timestamp":1511983450,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 3:\n\n(15 comments)"},{"timestamp":1511984035,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Uploaded patch set 4."},{"timestamp":1511984076,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1511984140,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Uploaded patch set 5."},{"timestamp":1511984144,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 5:\n\nNew commits:\n    \n    commit 85c8132ce18fef457fa01d43d602894541952959\n    \n    changes based on Tim and Jason review (thanks!)"},{"timestamp":1511984182,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1511990173,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Patch Set 5:\n\n(2 comments)"},{"timestamp":1511990516,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 5:\n\n(2 comments)"},{"timestamp":1511996491,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 5:\n\n(3 comments)"},{"timestamp":1511996753,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Uploaded patch set 6."},{"timestamp":1511996757,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 6:\n\nNew commits:\n    \n    commit d86876901fc485a326e68605a79423545e367fef\n    \n    fswatcher: 64 bit ints, check thr_create failure, remove pthread in favor of thread"},{"timestamp":1511996795,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 6: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1512511060,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Uploaded patch set 7."},{"timestamp":1512511105,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 7: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1512511439,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Uploaded patch set 8."},{"timestamp":1512511443,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 8:\n\nNew commits:\n    \n    commit e1a00fda8bf2ccc0db56229b9bfbb03bcd17dd40\n    \n    deal with fallout from rebase"},{"timestamp":1512511484,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 8: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1513151754,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 8:\n\n(58 comments)\n\nI had initially added hundreds of comments but I realized partway through doing\nthat, that it wasn\u0027t going to be helpful to have so many similar comments. A\nlot of the comments were style-related and since we don\u0027t have good tools (yet,\nwe\u0027re working on it) to enforce/fix style issues, I\u0027ve decided to remove most\nof those comments. I might not have removed them all, but I tried to narrow it\ndown so it was easier not to miss any non-style comments.\n\nFor what it\u0027s worth, the bulk of the issues I had were (some more important than\nothers):\n\n\n * missing function names. Using:\n\n    function (arguments) {\n    }\n\n without giving the function a name, makes things harder later when we\u0027re\n trying to debug a core or a stack trace. I realize some of the existing code\n is missing function names, but it\u0027s always good to add them wherever possible.\n\n\n * missing curly brackets on if/else:\n\n    if (condition)\n        doSomething\n\n I guess it\u0027s personal preference until we codify it, but the rest of /usr/vm\n has tried to always use curly braces for consistency (I noticed you added new\n code both ways here for example).\n\n\n * variables sprinkled all over the code. Doing something like:\n\n    function processevent(ev) {\n        if (isDone)\n            return;\n\n        // filter out events that don\u0027t match our predicate (obj)\n        if (!objSameValues(obj, ev))\n            return;\n\n        self.vs_logger.trace({ev: ev},\n            \u0027inspecting possible match from vminfod\u0027);\n\n        // loop changes found from vminfod\n        (ev.changes || []).forEach(function processChange(change) {\n            /*\n             * Compare to changes we are looking for.  Return false to remove\n             * the item from the changes array (meaning we matched it) or true\n             * to keep it in the array (meaning it was not a match).\n             *\n             * It\u0027s possible that there are duplicate changes we are looking\n             * for, so only filter out one element per change.\n             */\n            var hasMatched \u003d false;\n            changes \u003d changes.filter(function (wantedArr) {\n                if (isDone)\n                    return false;\n\n                if (hasMatched)\n                    return true;\n\n                if (!Array.isArray(wantedArr))\n                    wantedArr \u003d [wantedArr];\n\n                for (var i \u003d 0; i \u003c wantedArr.length; i++) {\n                    var match;\n\n\n means that the variable \"match\" at the last line here, is defined several\n levels past the point where its scope actually starts. if instead this we had:\n\n    function processevent(ev) {\n        var match;\n\n        ...\n\n it would make it much more clear what the scope is, and what variables are\n used in this scope.\n\n\n * multiple variables defined with a single var:\n\n    var x, y, z;\n\n is less obvious than:\n\n    var x;\n    var y;\n    var z;\n\n even more so when spread across lines like:\n\n    var x, y,\n        z;\n\n\n * ordering properties in an object. Whenever I see an object or array with a\n bunch of properties like:\n\n    var whatever \u003d {\n        greeting: \u0027hello\u0027,\n        target: \u0027world\u0027\n    };\n\n or:\n\n    var whatever \u003d [\n        \u0027hello\u0027,\n        \u0027world\u0027\n    ];\n\n I like to alphabetize them unless there\u0027s some other obvious (or documented)\n ordering. This makes it easier when someone else is coming in and adding code\n because they know exactly where to add their new property/element and reduces\n the amount of time they\u0027ll need to spend puzzling over why things are ordered\n how they are. There were a lot of examples in this review where properties seem\n to be randomly ordered.\n\n * Empty blocks like:\n\n    try {\n       whatever;\n    } catch (e) {\n    }\n\n if we\u0027re going to use try/catch, I think the catch block should always contain\n at least a comment explaining why we don\u0027t care about the exception. Otherwise\n when someone\u0027s reading this code, they\u0027ll think that looks like a potential\n error.\n\n\nAll of these style issues I hope we can deal with later however, when we\u0027ve got\nbetter tools in place, since they don\u0027t immediately impact the performance of\nvminfod here. The only one that I\u0027d ask you to at least consider doing for now\nis adding function names. Since that\u0027s work now that will really help us later.\n\n\nGeneral comments/questions:\n\n * I didn\u0027t review the fswatcher.c file since several other people have already\n gone through that.\n\n * It\u0027s really unfortunate that there\u0027s so much reorganizing of the code mixed\n in with code changes. VM.js especially has a lot of reorganizing the code\n without meaningful changes, which made it much more tedious to review than\n it could have been if that refactoring had been a separate CR.\n\n * I\u0027m a bit worried about the virtual last_modified handling here, as I mention\n in comments in vminfod.js.\n\n * Have you done any testing to ensure that we\u0027re not leaking memory?\n\n * Do we need some documentation/guidance for Ops as to how vminfod works at a\n high level, and what to do if things go wrong with it or there\u0027s suspicion that\n something has gone wrong? Maybe a brief debugging/troubleshooting guide with\n some problems/solutions that you\u0027ve seen/used while working on this?\n\n * Have you done testing with a system under heavy I/O and/or CPU load and\n watched the behavior with and without vminfod?\n\n * Have you run through all the tests with loadManually set?\n\n * Have you noticed that svc:/smartdc/agent/amon-zoneevents:default in maint on\n emy-12 apparently because unable to connect to vminfod?\n\n * With vminfod how many more/fewer log messages do we generate when performing\n basic VM operations?"},{"timestamp":1513205268,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 8:\n\n(52 comments)\n\nFirst round of review - thanks Josh!  There are a couple comments of yours I have yet to address still - I will get to those before I push a new patchset."},{"timestamp":1514916449,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 8:\n\n(8 comments)"},{"timestamp":1514931658,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 8:\n\n(6 comments)"},{"timestamp":1516210839,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Uploaded patch set 9."},{"timestamp":1516210886,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 9: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1516926336,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 9:\n\n(11 comments)"},{"timestamp":1518200261,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Uploaded patch set 10."},{"timestamp":1518200309,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 10: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1519663035,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 8:\n\n(6 comments)\n\nThere are other comments you\u0027ve made josh that i\u0027ll take care of before the next patchset."},{"timestamp":1519666157,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 8:\n\n(2 comments)"},{"timestamp":1519924237,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Uploaded patch set 11."},{"timestamp":1519924554,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 8:\n\n(1 comment)"},{"timestamp":1519924863,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 10:\n\nThings to still be addressed:\n\n1. writeAllMetadata possible race condition - lock not being acquired soon enough\n2. List of keys that are immutable in VM.update when constructing the vminfod list of changes to look for\n\nThis list may not be complete"},{"timestamp":1520474297,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 11: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1523289147,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Uploaded patch set 12."},{"timestamp":1523289152,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 12:\n\nNew commits:\n    \n    commit 3512ac069e46d3e08b819b4207281ede057e5e84\n    \n    everything sadly"},{"timestamp":1523574270,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 12:\n\nWhat testing have you done w/ bhyve VMs?"},{"timestamp":1523690460,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 12:\n\n(1 comment)\n\nI haven\u0027t managed to get through *everything* here, especially since it means re-reviewing a lot of bhyve. However, I think the biggest question I\u0027ve got is what sort of testing you think still needs to be done."},{"timestamp":1523978806,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 12: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1525902177,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Uploaded patch set 13."},{"timestamp":1525902183,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 13:\n\nNew commits:\n    \n    commit 746f127fea269dbdf38ea882a1cd92f92a442de4\n    \n    everything sadly"},{"timestamp":1525902232,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 13: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1525902314,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Uploaded patch set 14."},{"timestamp":1525902321,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 14:\n\nNew commits:\n    \n    commit 628144132749eb0c35e1f709883a36caa59ae766\n    \n    fix nics logic for changing the primary\n    \n    commit 3580ca2ccb7d37ec4f8d0ffad4b3c7027bfeab30\n    \n    update status output of vminfo command"},{"timestamp":1525902367,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 14: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1527005749,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Uploaded patch set 15: Patch Set 14 was rebased."},{"timestamp":1527005756,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 15:\n\nNew commits:\n    \n    commit c7922474172c9a1e18851bdbc6ff50469cf4a1c9\n    \n    fix nics logic for changing the primary\n    \n    commit a16e504f85f62624cf085041550233e5681975ab\n    \n    update status output of vminfo command\n    \n    commit 979e1750a472b8e469200cb5c517177f56466bcf\n    \n    everything sadly"},{"timestamp":1527005804,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 15:\n\n\"make check\" passed ok"},{"timestamp":1531758871,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Uploaded patch set 16."},{"timestamp":1531758876,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 16:\n\nNew commits:\n    \n    commit 73700d4828c6a141ca9dbde3b2fa629de7962d9a\n    \n    fix nics logic for changing the primary\n    \n    commit fb633e0b7d52e27f85e080b5831e70d0d34d4f1a\n    \n    update status output of vminfo command\n    \n    commit 510369971c600cbed37a1c2eb85eb1ef5242ebab\n    \n    everything sadly"},{"timestamp":1531758906,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Uploaded patch set 17."},{"timestamp":1531758911,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 17:\n\nNew commits:\n    \n    commit eb9cdc2f49b7cc42615483e206597325be86f0f9\n    \n    add vminfod logs to logadm"},{"timestamp":1531758923,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 16: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1531758957,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 17: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1533141855,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Uploaded patch set 18: Patch Set 17 was rebased."},{"timestamp":1533141860,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 18:\n\nNew commits:\n    \n    commit bed0b718eab95d361649c2bac7784f58a3780355\n    \n    add vminfod logs to logadm\n    \n    commit b42746d4e4257ee83b3939dfce52ad4bf8c607b1\n    \n    fix nics logic for changing the primary\n    \n    commit 2fa83890022b3f7c57dbdd0aa80db319a986d810\n    \n    update status output of vminfo command\n    \n    commit 6ab023f247bca986dd5a2c95b01eb9ecf21622f9\n    \n    everything sadly"},{"timestamp":1533141907,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 18:\n\n\"make check\" passed ok"},{"timestamp":1533141928,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Uploaded patch set 19."},{"timestamp":1533141934,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 19:\n\nNew commits:\n    \n    commit 550b448d3e8390874a4e8d667998df9a2141b26d\n    \n    zoneevent.js retry indefinitely"},{"timestamp":1533141978,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 19: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1537487399,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Uploaded patch set 20."},{"timestamp":1537487405,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 20:\n\nNew commits:\n    \n    commit bbd4f7408d972198e6084c378b70488146f21658\n    \n    vminfod branch @ bae5696f113cec94951b8089496981d0c6d56836"},{"timestamp":1537487453,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 20: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1537510511,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 20: Code-Review+1\n\nHooray! 🎉"},{"timestamp":1537549584,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Uploaded patch set 21: Commit message was updated."},{"timestamp":1537566466,"reviewer":{"name":"Angela Fong","email":"angela.fong@joyent.com","username":"askfongjojo"},"message":"Patch Set 21: Integration-Approval+1"},{"timestamp":1537566932,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Uploaded patch set 22: Commit message was updated."},{"timestamp":1537568981,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Dave Eddy"}],"currentPatchSet":{"number":"22","revision":"1c2c59922161a9d98f109983c9e07205eb1d7889","parents":["0308c8680915823a54bf911a69385020143ee8cb"],"ref":"refs/changes/82/2782/22","uploader":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"createdOn":1537566932,"author":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1537487453,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1537510511,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1537566466,"by":{"name":"Angela Fong","email":"angela.fong@joyent.com","username":"askfongjojo"}},{"type":"SUBM","value":"1","grantedOn":1537568981,"by":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"man/src/vminfo.1m.md","type":"ADDED","insertions":51,"deletions":0},{"file":"overlay/generic/etc/logadm.conf","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"src/Makefile","type":"MODIFIED","insertions":24,"deletions":-7},{"file":"src/fswatcher.c","type":"ADDED","insertions":1031,"deletions":0},{"file":"src/manifest","type":"MODIFIED","insertions":48,"deletions":-1},{"file":"src/vm/common/vmtest.js","type":"MODIFIED","insertions":31,"deletions":-7},{"file":"src/vm/lib/metadata/agent.js","type":"MODIFIED","insertions":317,"deletions":-849},{"file":"src/vm/lib/metadata/zwatch.js","type":"DELETED","insertions":0,"deletions":-64},{"file":"src/vm/man/vmadm.1m.md","type":"MODIFIED","insertions":12,"deletions":0},{"file":"src/vm/node_modules/VM.js","type":"MODIFIED","insertions":3993,"deletions":-2053},{"file":"src/vm/node_modules/diff.js","type":"ADDED","insertions":505,"deletions":0},{"file":"src/vm/node_modules/expander.js","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"src/vm/node_modules/fswatcher.js","type":"ADDED","insertions":943,"deletions":0},{"file":"src/vm/node_modules/jsprim/LICENSE","type":"ADDED","insertions":19,"deletions":0},{"file":"src/vm/node_modules/jsprim/lib/jsprim.js","type":"ADDED","insertions":735,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/assert-plus/assert.js","type":"ADDED","insertions":211,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/assert-plus/package.json","type":"ADDED","insertions":82,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/extsprintf/LICENSE","type":"ADDED","insertions":19,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/extsprintf/lib/extsprintf.js","type":"ADDED","insertions":183,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/extsprintf/package.json","type":"ADDED","insertions":41,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/json-schema/README.md","type":"ADDED","insertions":5,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/json-schema/lib/links.js","type":"ADDED","insertions":66,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/json-schema/lib/validate.js","type":"ADDED","insertions":273,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/json-schema/package.json","type":"ADDED","insertions":65,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/LICENSE","type":"ADDED","insertions":19,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/lib/verror.js","type":"ADDED","insertions":451,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/node_modules/core-util-is/LICENSE","type":"ADDED","insertions":19,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/node_modules/core-util-is/lib/util.js","type":"ADDED","insertions":107,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/node_modules/core-util-is/package.json","type":"ADDED","insertions":59,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/package.json","type":"ADDED","insertions":50,"deletions":0},{"file":"src/vm/node_modules/jsprim/package.json","type":"ADDED","insertions":51,"deletions":0},{"file":"src/vm/node_modules/proptable.js","type":"MODIFIED","insertions":38,"deletions":-18},{"file":"src/vm/node_modules/queue.js","type":"ADDED","insertions":589,"deletions":0},{"file":"src/vm/node_modules/sysevent-stream.js","type":"MODIFIED","insertions":13,"deletions":-3},{"file":"src/vm/node_modules/vasync/package.json","type":"MODIFIED","insertions":1,"deletions":0},{"file":"src/vm/node_modules/vminfod/client.js","type":"ADDED","insertions":1118,"deletions":0},{"file":"src/vm/node_modules/vminfod/vminfod.js","type":"ADDED","insertions":2446,"deletions":0},{"file":"src/vm/node_modules/vminfod/zonewatcher.js","type":"ADDED","insertions":82,"deletions":0},{"file":"src/vm/node_modules/vminfod/zpoolwatcher.js","type":"ADDED","insertions":133,"deletions":0},{"file":"src/vm/node_modules/vmload/dump-json.js","type":"MODIFIED","insertions":32,"deletions":-31},{"file":"src/vm/node_modules/vmload/dump-vmobjs.js","type":"MODIFIED","insertions":4,"deletions":-5},{"file":"src/vm/node_modules/vmload/dump-zonexml.js","type":"MODIFIED","insertions":7,"deletions":-4},{"file":"src/vm/node_modules/vmload/index.js","type":"MODIFIED","insertions":503,"deletions":-409},{"file":"src/vm/node_modules/vmload/vmload-datasets.js","type":"MODIFIED","insertions":22,"deletions":-12},{"file":"src/vm/node_modules/vmload/vmload-json.js","type":"MODIFIED","insertions":11,"deletions":-7},{"file":"src/vm/node_modules/vmload/vmload-zoneadm.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"src/vm/node_modules/zoneevent.js","type":"ADDED","insertions":182,"deletions":0},{"file":"src/vm/runtests","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"src/vm/sbin/vmadm.js","type":"MODIFIED","insertions":117,"deletions":-2},{"file":"src/vm/sbin/vmadmd.js","type":"MODIFIED","insertions":18,"deletions":-23},{"file":"src/vm/sbin/vminfo.js","type":"ADDED","insertions":391,"deletions":0},{"file":"src/vm/sbin/vminfod.js","type":"ADDED","insertions":68,"deletions":0},{"file":"src/vm/smf/system-metadata.xml","type":"MODIFIED","insertions":4,"deletions":0},{"file":"src/vm/smf/system-vmadmd.xml","type":"MODIFIED","insertions":4,"deletions":0},{"file":"src/vm/smf/system-vminfod","type":"ADDED","insertions":53,"deletions":0},{"file":"src/vm/smf/system-vminfod.xml","type":"ADDED","insertions":47,"deletions":0},{"file":"src/vm/tests/common.js","type":"ADDED","insertions":129,"deletions":0},{"file":"src/vm/tests/test-defaults.js","type":"MODIFIED","insertions":73,"deletions":-9},{"file":"src/vm/tests/test-delete.js","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"src/vm/tests/test-diff.js","type":"ADDED","insertions":262,"deletions":0},{"file":"src/vm/tests/test-docker.js","type":"MODIFIED","insertions":103,"deletions":-60},{"file":"src/vm/tests/test-fswatcher.js","type":"ADDED","insertions":525,"deletions":0},{"file":"src/vm/tests/test-internal_metadata_namespaces.js","type":"MODIFIED","insertions":86,"deletions":-22},{"file":"src/vm/tests/test-lastexited.js","type":"MODIFIED","insertions":48,"deletions":-20},{"file":"src/vm/tests/test-queue.js","type":"ADDED","insertions":361,"deletions":0},{"file":"src/vm/tests/test-send-recv.js","type":"MODIFIED","insertions":216,"deletions":-137},{"file":"src/vm/tests/test-snapshots.js","type":"MODIFIED","insertions":53,"deletions":-57},{"file":"src/vm/tests/test-update.js","type":"MODIFIED","insertions":94,"deletions":-58},{"file":"src/vm/tests/test-vminfod-zonewatcher-overflow.js","type":"ADDED","insertions":308,"deletions":0},{"file":"src/vm/tests/test-vminfod-zonewatcher.js","type":"ADDED","insertions":123,"deletions":0},{"file":"src/vm/tests/test-vminfod-zpoolwatcher.js","type":"ADDED","insertions":131,"deletions":0},{"file":"src/vm/tests/test-vminfod.js","type":"ADDED","insertions":42,"deletions":0},{"file":"src/zoneevent.c","type":"DELETED","insertions":0,"deletions":-144},{"file":"src/zoneevent.js","type":"ADDED","insertions":155,"deletions":0}],"sizeInsertions":18017,"sizeDeletions":-4010},"patchSets":[{"number":"1","revision":"adae8e93dd37a9e70d62ad2b8578f00f619ea942","parents":["8276e59807a1f341347c69d5ea1c1ea6b5bc0e08"],"ref":"refs/changes/82/2782/1","uploader":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"createdOn":1507917779,"author":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1507917822,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"src/Makefile","type":"MODIFIED","insertions":22,"deletions":-6},{"file":"src/fswatcher.c","type":"ADDED","insertions":1009,"deletions":0},{"file":"src/manifest","type":"MODIFIED","insertions":23,"deletions":-1},{"file":"src/vm/common/vmtest.js","type":"MODIFIED","insertions":31,"deletions":-7},{"file":"src/vm/lib/metadata/agent.js","type":"MODIFIED","insertions":235,"deletions":-829},{"file":"src/vm/lib/metadata/zwatch.js","type":"DELETED","insertions":0,"deletions":-64},{"file":"src/vm/node_modules/VM.js","type":"MODIFIED","insertions":3195,"deletions":-1715},{"file":"src/vm/node_modules/diff.js","type":"ADDED","insertions":505,"deletions":0},{"file":"src/vm/node_modules/expander.js","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"src/vm/node_modules/fswatcher.js","type":"ADDED","insertions":927,"deletions":0},{"file":"src/vm/node_modules/proptable.js","type":"MODIFIED","insertions":38,"deletions":-18},{"file":"src/vm/node_modules/queue.js","type":"ADDED","insertions":509,"deletions":0},{"file":"src/vm/node_modules/vasync/lib/vasync.js","type":"MODIFIED","insertions":381,"deletions":-95},{"file":"src/vm/node_modules/vasync/node_modules/verror/LICENSE","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"src/vm/node_modules/vasync/node_modules/verror/lib/verror.js","type":"MODIFIED","insertions":304,"deletions":-102},{"file":"src/vm/node_modules/vasync/node_modules/verror/node_modules/assert-plus/assert.js","type":"ADDED","insertions":211,"deletions":0},{"file":"src/vm/node_modules/vasync/node_modules/verror/node_modules/assert-plus/package.json","type":"ADDED","insertions":83,"deletions":0},{"file":"src/vm/node_modules/vasync/node_modules/verror/node_modules/core-util-is/LICENSE","type":"ADDED","insertions":19,"deletions":0},{"file":"src/vm/node_modules/vasync/node_modules/verror/node_modules/core-util-is/lib/util.js","type":"ADDED","insertions":107,"deletions":0},{"file":"src/vm/node_modules/vasync/node_modules/verror/node_modules/core-util-is/package.json","type":"ADDED","insertions":59,"deletions":0},{"file":"src/vm/node_modules/vasync/node_modules/verror/node_modules/extsprintf/lib/extsprintf.js","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"src/vm/node_modules/vasync/node_modules/verror/node_modules/extsprintf/package.json","type":"MODIFIED","insertions":25,"deletions":-5},{"file":"src/vm/node_modules/vasync/node_modules/verror/package.json","type":"MODIFIED","insertions":27,"deletions":-9},{"file":"src/vm/node_modules/vasync/package.json","type":"MODIFIED","insertions":9,"deletions":-6},{"file":"src/vm/node_modules/vminfod/client.js","type":"ADDED","insertions":1052,"deletions":0},{"file":"src/vm/node_modules/vminfod/vminfod.js","type":"ADDED","insertions":2228,"deletions":0},{"file":"src/vm/node_modules/vminfod/zonewatcher.js","type":"ADDED","insertions":76,"deletions":0},{"file":"src/vm/node_modules/vminfod/zpoolwatcher.js","type":"ADDED","insertions":119,"deletions":0},{"file":"src/vm/node_modules/vmload/dump-json.js","type":"MODIFIED","insertions":33,"deletions":-31},{"file":"src/vm/node_modules/vmload/dump-vmobjs.js","type":"MODIFIED","insertions":4,"deletions":-5},{"file":"src/vm/node_modules/vmload/dump-zonexml.js","type":"MODIFIED","insertions":7,"deletions":-4},{"file":"src/vm/node_modules/vmload/index.js","type":"MODIFIED","insertions":525,"deletions":-412},{"file":"src/vm/node_modules/vmload/vmload-datasets.js","type":"MODIFIED","insertions":22,"deletions":-12},{"file":"src/vm/node_modules/vmload/vmload-json.js","type":"MODIFIED","insertions":11,"deletions":-7},{"file":"src/vm/node_modules/vmload/vmload-zoneadm.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"src/vm/node_modules/zoneevent.js","type":"ADDED","insertions":289,"deletions":0},{"file":"src/vm/sbin/vmadmd.js","type":"MODIFIED","insertions":17,"deletions":-22},{"file":"src/vm/sbin/vminfod.js","type":"ADDED","insertions":80,"deletions":0},{"file":"src/vm/smf/system-metadata.xml","type":"MODIFIED","insertions":4,"deletions":0},{"file":"src/vm/smf/system-vmadmd.xml","type":"MODIFIED","insertions":4,"deletions":0},{"file":"src/vm/smf/system-vminfod","type":"ADDED","insertions":49,"deletions":0},{"file":"src/vm/smf/system-vminfod.xml","type":"ADDED","insertions":47,"deletions":0},{"file":"src/vm/tests/test-50-creates.js","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"src/vm/tests/test-defaults.js","type":"MODIFIED","insertions":48,"deletions":-6},{"file":"src/vm/tests/test-delete.js","type":"MODIFIED","insertions":5,"deletions":-4},{"file":"src/vm/tests/test-diff.js","type":"ADDED","insertions":262,"deletions":0},{"file":"src/vm/tests/test-docker.js","type":"MODIFIED","insertions":100,"deletions":-59},{"file":"src/vm/tests/test-fswatcher.js","type":"ADDED","insertions":525,"deletions":0},{"file":"src/vm/tests/test-internal_metadata_namespaces.js","type":"MODIFIED","insertions":86,"deletions":-22},{"file":"src/vm/tests/test-lastexited.js","type":"MODIFIED","insertions":48,"deletions":-20},{"file":"src/vm/tests/test-queue.js","type":"ADDED","insertions":265,"deletions":0},{"file":"src/vm/tests/test-send-recv.js","type":"MODIFIED","insertions":215,"deletions":-131},{"file":"src/vm/tests/test-snapshots.js","type":"MODIFIED","insertions":45,"deletions":-18},{"file":"src/vm/tests/test-update.js","type":"MODIFIED","insertions":94,"deletions":-58},{"file":"src/vm/tests/test-vminfod.js","type":"ADDED","insertions":42,"deletions":0},{"file":"src/vm/tests/test-zonewatcher.js","type":"ADDED","insertions":183,"deletions":0},{"file":"src/vm/tests/test-zpoolwatcher.js","type":"ADDED","insertions":144,"deletions":0},{"file":"src/vminfod.js","type":"ADDED","insertions":283,"deletions":0},{"file":"src/zoneevent.c","type":"DELETED","insertions":0,"deletions":-144},{"file":"src/zoneevent.js","type":"ADDED","insertions":82,"deletions":0}],"sizeInsertions":14733,"sizeDeletions":-3819},{"number":"2","revision":"075ac8b55d3809982b2d5bad3e4ad8007052d586","parents":["acca68c2832608f712329636aec97fd8bb5cd829"],"ref":"refs/changes/82/2782/2","uploader":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"createdOn":1510683689,"author":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1510683729,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"src/Makefile","type":"MODIFIED","insertions":22,"deletions":-6},{"file":"src/fswatcher.c","type":"ADDED","insertions":1006,"deletions":0},{"file":"src/manifest","type":"MODIFIED","insertions":23,"deletions":-1},{"file":"src/vm/common/vmtest.js","type":"MODIFIED","insertions":31,"deletions":-7},{"file":"src/vm/lib/metadata/agent.js","type":"MODIFIED","insertions":235,"deletions":-829},{"file":"src/vm/lib/metadata/zwatch.js","type":"DELETED","insertions":0,"deletions":-64},{"file":"src/vm/man/vmadm.1m.md","type":"MODIFIED","insertions":11,"deletions":0},{"file":"src/vm/node_modules/VM.js","type":"MODIFIED","insertions":3357,"deletions":-1723},{"file":"src/vm/node_modules/diff.js","type":"ADDED","insertions":505,"deletions":0},{"file":"src/vm/node_modules/expander.js","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"src/vm/node_modules/fswatcher.js","type":"ADDED","insertions":927,"deletions":0},{"file":"src/vm/node_modules/proptable.js","type":"MODIFIED","insertions":38,"deletions":-18},{"file":"src/vm/node_modules/queue.js","type":"ADDED","insertions":515,"deletions":0},{"file":"src/vm/node_modules/vasync/lib/vasync.js","type":"MODIFIED","insertions":381,"deletions":-95},{"file":"src/vm/node_modules/vasync/node_modules/verror/LICENSE","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"src/vm/node_modules/vasync/node_modules/verror/lib/verror.js","type":"MODIFIED","insertions":304,"deletions":-102},{"file":"src/vm/node_modules/vasync/node_modules/verror/node_modules/assert-plus/assert.js","type":"ADDED","insertions":211,"deletions":0},{"file":"src/vm/node_modules/vasync/node_modules/verror/node_modules/assert-plus/package.json","type":"ADDED","insertions":83,"deletions":0},{"file":"src/vm/node_modules/vasync/node_modules/verror/node_modules/core-util-is/LICENSE","type":"ADDED","insertions":19,"deletions":0},{"file":"src/vm/node_modules/vasync/node_modules/verror/node_modules/core-util-is/lib/util.js","type":"ADDED","insertions":107,"deletions":0},{"file":"src/vm/node_modules/vasync/node_modules/verror/node_modules/core-util-is/package.json","type":"ADDED","insertions":59,"deletions":0},{"file":"src/vm/node_modules/vasync/node_modules/verror/node_modules/extsprintf/lib/extsprintf.js","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"src/vm/node_modules/vasync/node_modules/verror/node_modules/extsprintf/package.json","type":"MODIFIED","insertions":25,"deletions":-5},{"file":"src/vm/node_modules/vasync/node_modules/verror/package.json","type":"MODIFIED","insertions":27,"deletions":-9},{"file":"src/vm/node_modules/vasync/package.json","type":"MODIFIED","insertions":9,"deletions":-6},{"file":"src/vm/node_modules/vminfod/client.js","type":"ADDED","insertions":1052,"deletions":0},{"file":"src/vm/node_modules/vminfod/vminfod.js","type":"ADDED","insertions":2374,"deletions":0},{"file":"src/vm/node_modules/vminfod/zonewatcher.js","type":"ADDED","insertions":76,"deletions":0},{"file":"src/vm/node_modules/vminfod/zpoolwatcher.js","type":"ADDED","insertions":119,"deletions":0},{"file":"src/vm/node_modules/vmload/dump-json.js","type":"MODIFIED","insertions":33,"deletions":-31},{"file":"src/vm/node_modules/vmload/dump-vmobjs.js","type":"MODIFIED","insertions":4,"deletions":-5},{"file":"src/vm/node_modules/vmload/dump-zonexml.js","type":"MODIFIED","insertions":7,"deletions":-4},{"file":"src/vm/node_modules/vmload/index.js","type":"MODIFIED","insertions":525,"deletions":-412},{"file":"src/vm/node_modules/vmload/vmload-datasets.js","type":"MODIFIED","insertions":22,"deletions":-12},{"file":"src/vm/node_modules/vmload/vmload-json.js","type":"MODIFIED","insertions":11,"deletions":-7},{"file":"src/vm/node_modules/vmload/vmload-zoneadm.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"src/vm/node_modules/zoneevent.js","type":"ADDED","insertions":178,"deletions":0},{"file":"src/vm/sbin/vmadm.js","type":"MODIFIED","insertions":106,"deletions":-2},{"file":"src/vm/sbin/vmadmd.js","type":"MODIFIED","insertions":17,"deletions":-22},{"file":"src/vm/sbin/vminfod.js","type":"ADDED","insertions":80,"deletions":0},{"file":"src/vm/smf/system-metadata.xml","type":"MODIFIED","insertions":4,"deletions":0},{"file":"src/vm/smf/system-vmadmd.xml","type":"MODIFIED","insertions":4,"deletions":0},{"file":"src/vm/smf/system-vminfod","type":"ADDED","insertions":49,"deletions":0},{"file":"src/vm/smf/system-vminfod.xml","type":"ADDED","insertions":47,"deletions":0},{"file":"src/vm/tests/test-50-creates.js","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"src/vm/tests/test-defaults.js","type":"MODIFIED","insertions":48,"deletions":-6},{"file":"src/vm/tests/test-delete.js","type":"MODIFIED","insertions":5,"deletions":-4},{"file":"src/vm/tests/test-diff.js","type":"ADDED","insertions":262,"deletions":0},{"file":"src/vm/tests/test-docker.js","type":"MODIFIED","insertions":100,"deletions":-59},{"file":"src/vm/tests/test-fswatcher.js","type":"ADDED","insertions":525,"deletions":0},{"file":"src/vm/tests/test-internal_metadata_namespaces.js","type":"MODIFIED","insertions":86,"deletions":-22},{"file":"src/vm/tests/test-lastexited.js","type":"MODIFIED","insertions":48,"deletions":-20},{"file":"src/vm/tests/test-queue.js","type":"ADDED","insertions":265,"deletions":0},{"file":"src/vm/tests/test-send-recv.js","type":"MODIFIED","insertions":215,"deletions":-131},{"file":"src/vm/tests/test-snapshots.js","type":"MODIFIED","insertions":45,"deletions":-18},{"file":"src/vm/tests/test-update.js","type":"MODIFIED","insertions":94,"deletions":-58},{"file":"src/vm/tests/test-vminfod.js","type":"ADDED","insertions":42,"deletions":0},{"file":"src/vm/tests/test-zonewatcher.js","type":"ADDED","insertions":183,"deletions":0},{"file":"src/vm/tests/test-zpoolwatcher.js","type":"ADDED","insertions":144,"deletions":0},{"file":"src/vminfod.js","type":"ADDED","insertions":315,"deletions":0},{"file":"src/zoneevent.c","type":"DELETED","insertions":0,"deletions":-144},{"file":"src/zoneevent.js","type":"ADDED","insertions":108,"deletions":0}],"sizeInsertions":15108,"sizeDeletions":-3829},{"number":"3","revision":"a25b71f2e4f782790df0e0acf872ad1344fa5326","parents":["db39437ba4ae5311c95581158048d2054288ef53"],"ref":"refs/changes/82/2782/3","uploader":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"createdOn":1511198808,"author":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1511198850,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"src/Makefile","line":66,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"You probably want to add \u0027fswatcher: CPPFLAGS +\u003d -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS\u003d64\u0027 similar to vmbundle -- otherwise fswatcher may crash if given a largefile to watch"},{"file":"src/fswatcher.c","line":200,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Could we be explicit and add \u003d DEFAULTMUTEX (or ERRORCHECKMUTEX)?"},{"file":"src/fswatcher.c","line":200,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Done"},{"file":"src/fswatcher.c","line":293,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"I\u0027d just go ahead and use the fnvlist_ versions everywhere -- if it does abort w/ ENOMEM, it\u0027d be good to have a core just in case it\u0027s due to a memory leak and not low system memory."},{"file":"src/fswatcher.c","line":293,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"See the comment here for an explanation of why ENSURE0 is used https://cr.joyent.us/#/c/1484/6/src/sysevent.c@48"},{"file":"src/fswatcher.c","line":298,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"If built as a 64-bit binary, struct timeval\u0027s members will be 64-bit -- it might be better to go ahead and use 64-bit ints here -- zfs (and ls) already use 2 uint64_t\u0027s for crtime for example."},{"file":"src/fswatcher.c","line":298,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"The problem is that this C program exists as a helper program for fswatcher.js... JavaScript won\u0027t be able to properly handle 64 bit integers as far as I know."},{"file":"src/fswatcher.c","line":464,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"calloc would be better here -- it\u0027ll do an overflow check on the product"},{"file":"src/fswatcher.c","line":464,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Done"},{"file":"src/fswatcher.c","line":467,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Nit: `EXIT_FAILURE` could be used instead of 1"},{"file":"src/fswatcher.c","line":467,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"I personally prefer to explicitly use numbers for exit codes since this program will be executed from within JavaScript.  This way, though not currently the case, the JavaScript could check the exit code and look for specific failure cases.\n\nHowever, since the JavaScript pretty much just aborts on *any* failure, if you feel strongly about it I can use EXIT_FAILURE."},{"file":"src/fswatcher.c","line":467,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"It\u0027s mostly just convention in case you wanted to use that -- in theory some value other than 1 could be used on some system to denote failure.  In practice, if it hasn\u0027t changed in ~30-40 years it seems unlikely it\u0027ll change anytime soon :), so if you want to leave as is, that\u0027s fine with me."},{"file":"src/fswatcher.c","line":603,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Minor nit, but I\u0027m not sure if there\u0027s any point in distinguishing between these cases and \u0027default\u0027 -- you\u0027re aborting either way."},{"file":"src/fswatcher.c","line":603,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"True, this is just a way of explicitly stating that these errors (EFAULT, EIO, ENAMETOOLONG, etc.) are accounted for and should abort the process, and are not simply ignored or forgotten by the programmer."},{"file":"src/fswatcher.c","line":700,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"VERIFY3S might be preferable here -- if the test fails, it\u0027ll print both values in the abort msg"},{"file":"src/fswatcher.c","line":700,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Done"},{"file":"src/fswatcher.c","line":718,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Consider VERIFY3S as above"},{"file":"src/fswatcher.c","line":718,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Done"},{"file":"src/fswatcher.c","line":746,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Nit: `EXIT_FAILURE` could be used here instead."},{"file":"src/fswatcher.c","line":748,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"the lifetime of this allocation is slightly confusing (I see that it gets free()d in the destroy_handle() call. maybe that\u0027s worth a comment ? (the args for check_and_rearm_event() are what makes this confusing to me, I think)."},{"file":"src/fswatcher.c","line":748,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"I\u0027ll add a comment.  I\u0027ll need to refresh my own memory, but I know when creating the watch with event ports and not duplicating the name, it was possible that the next file being watched would overwrite the original file... i\u0027ll figure this out and add a comment."},{"file":"src/fswatcher.c","line":750,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Nit: `EXIT_FAILURE` could be used here instead."},{"file":"src/fswatcher.c","line":888,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Is this to silence an unused parameter warning?  If so, you can use \u0027void *arg __unused\u0027 to suppress the warning."},{"file":"src/fswatcher.c","line":888,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"ah perfect, ty!"},{"file":"src/fswatcher.c","line":901,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"EXIT_FAILURE as above -- also err(3C) should already append \u0027strerror(errno)\u0027 to the string passed in the argument (after formatting).\n\nAlso, have you verified what happens if stdin is just closed?  I think fgets() returns NULL, but I\u0027m not sure that errno gets set -- you may need to call feof(3C) to determine that (and display a sensible error message)."},{"file":"src/fswatcher.c","line":901,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Ah, good call!\n\n # echo -n | ./fswatcher \n fswatcher: fswatcher: error on stdin (errno: 0): Error 0\n : Error 0\n\nThat\u0027s a pretty lame error message - I\u0027ll clean this up."},{"file":"src/fswatcher.c","line":911,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Same as above."},{"file":"src/fswatcher.c","line":911,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Done"},{"file":"src/fswatcher.c","line":939,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"EXIT_FAILURE as above, though perhaps perror + abort() since this shouldn\u0027t happen + would we want a core in this case?"},{"file":"src/fswatcher.c","line":939,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Good call, this shouldn\u0027t happen... so if it does it should abort()."},{"file":"src/fswatcher.c","line":972,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Maybe just use err(3C) like in other functions?"},{"file":"src/fswatcher.c","line":972,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"+1, not sure how this snuck in there... most likely this had been written first before i switched over to err(3C)."},{"file":"src/fswatcher.c","line":992,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"I\u0027m confused by the intermixed use of pthread and thr functions here.\n\nif we\u0027re joining these, should we use pthread_join() and for locks pthread_mutex_lock() ?\n\nOr perhaps thr_create() here (and leave the rest alone) ?"},{"file":"src/fswatcher.c","line":992,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"This is just my lack of experience programming in C with threading - i\u0027ll rewrite this to use `thr_create()` to be consistent."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"src/Makefile","type":"MODIFIED","insertions":22,"deletions":-6},{"file":"src/fswatcher.c","type":"ADDED","insertions":1006,"deletions":0},{"file":"src/manifest","type":"MODIFIED","insertions":23,"deletions":-1},{"file":"src/vm/common/vmtest.js","type":"MODIFIED","insertions":31,"deletions":-7},{"file":"src/vm/lib/metadata/agent.js","type":"MODIFIED","insertions":235,"deletions":-829},{"file":"src/vm/lib/metadata/zwatch.js","type":"DELETED","insertions":0,"deletions":-64},{"file":"src/vm/man/vmadm.1m.md","type":"MODIFIED","insertions":11,"deletions":0},{"file":"src/vm/node_modules/VM.js","type":"MODIFIED","insertions":3357,"deletions":-1723},{"file":"src/vm/node_modules/diff.js","type":"ADDED","insertions":505,"deletions":0},{"file":"src/vm/node_modules/expander.js","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"src/vm/node_modules/fswatcher.js","type":"ADDED","insertions":927,"deletions":0},{"file":"src/vm/node_modules/proptable.js","type":"MODIFIED","insertions":38,"deletions":-18},{"file":"src/vm/node_modules/queue.js","type":"ADDED","insertions":515,"deletions":0},{"file":"src/vm/node_modules/vasync/lib/vasync.js","type":"MODIFIED","insertions":381,"deletions":-95},{"file":"src/vm/node_modules/vasync/node_modules/verror/LICENSE","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"src/vm/node_modules/vasync/node_modules/verror/lib/verror.js","type":"MODIFIED","insertions":304,"deletions":-102},{"file":"src/vm/node_modules/vasync/node_modules/verror/node_modules/assert-plus/assert.js","type":"ADDED","insertions":211,"deletions":0},{"file":"src/vm/node_modules/vasync/node_modules/verror/node_modules/assert-plus/package.json","type":"ADDED","insertions":83,"deletions":0},{"file":"src/vm/node_modules/vasync/node_modules/verror/node_modules/core-util-is/LICENSE","type":"ADDED","insertions":19,"deletions":0},{"file":"src/vm/node_modules/vasync/node_modules/verror/node_modules/core-util-is/lib/util.js","type":"ADDED","insertions":107,"deletions":0},{"file":"src/vm/node_modules/vasync/node_modules/verror/node_modules/core-util-is/package.json","type":"ADDED","insertions":59,"deletions":0},{"file":"src/vm/node_modules/vasync/node_modules/verror/node_modules/extsprintf/lib/extsprintf.js","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"src/vm/node_modules/vasync/node_modules/verror/node_modules/extsprintf/package.json","type":"MODIFIED","insertions":25,"deletions":-5},{"file":"src/vm/node_modules/vasync/node_modules/verror/package.json","type":"MODIFIED","insertions":27,"deletions":-9},{"file":"src/vm/node_modules/vasync/package.json","type":"MODIFIED","insertions":9,"deletions":-6},{"file":"src/vm/node_modules/vminfod/client.js","type":"ADDED","insertions":1052,"deletions":0},{"file":"src/vm/node_modules/vminfod/vminfod.js","type":"ADDED","insertions":2374,"deletions":0},{"file":"src/vm/node_modules/vminfod/zonewatcher.js","type":"ADDED","insertions":76,"deletions":0},{"file":"src/vm/node_modules/vminfod/zpoolwatcher.js","type":"ADDED","insertions":119,"deletions":0},{"file":"src/vm/node_modules/vmload/dump-json.js","type":"MODIFIED","insertions":33,"deletions":-31},{"file":"src/vm/node_modules/vmload/dump-vmobjs.js","type":"MODIFIED","insertions":4,"deletions":-5},{"file":"src/vm/node_modules/vmload/dump-zonexml.js","type":"MODIFIED","insertions":7,"deletions":-4},{"file":"src/vm/node_modules/vmload/index.js","type":"MODIFIED","insertions":525,"deletions":-412},{"file":"src/vm/node_modules/vmload/vmload-datasets.js","type":"MODIFIED","insertions":22,"deletions":-12},{"file":"src/vm/node_modules/vmload/vmload-json.js","type":"MODIFIED","insertions":11,"deletions":-7},{"file":"src/vm/node_modules/vmload/vmload-zoneadm.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"src/vm/node_modules/zoneevent.js","type":"ADDED","insertions":178,"deletions":0},{"file":"src/vm/sbin/vmadm.js","type":"MODIFIED","insertions":106,"deletions":-2},{"file":"src/vm/sbin/vmadmd.js","type":"MODIFIED","insertions":17,"deletions":-22},{"file":"src/vm/sbin/vminfod.js","type":"ADDED","insertions":80,"deletions":0},{"file":"src/vm/smf/system-metadata.xml","type":"MODIFIED","insertions":4,"deletions":0},{"file":"src/vm/smf/system-vmadmd.xml","type":"MODIFIED","insertions":4,"deletions":0},{"file":"src/vm/smf/system-vminfod","type":"ADDED","insertions":49,"deletions":0},{"file":"src/vm/smf/system-vminfod.xml","type":"ADDED","insertions":47,"deletions":0},{"file":"src/vm/tests/test-50-creates.js","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"src/vm/tests/test-defaults.js","type":"MODIFIED","insertions":48,"deletions":-6},{"file":"src/vm/tests/test-delete.js","type":"MODIFIED","insertions":5,"deletions":-4},{"file":"src/vm/tests/test-diff.js","type":"ADDED","insertions":262,"deletions":0},{"file":"src/vm/tests/test-docker.js","type":"MODIFIED","insertions":100,"deletions":-59},{"file":"src/vm/tests/test-fswatcher.js","type":"ADDED","insertions":525,"deletions":0},{"file":"src/vm/tests/test-internal_metadata_namespaces.js","type":"MODIFIED","insertions":86,"deletions":-22},{"file":"src/vm/tests/test-lastexited.js","type":"MODIFIED","insertions":48,"deletions":-20},{"file":"src/vm/tests/test-queue.js","type":"ADDED","insertions":265,"deletions":0},{"file":"src/vm/tests/test-send-recv.js","type":"MODIFIED","insertions":215,"deletions":-131},{"file":"src/vm/tests/test-snapshots.js","type":"MODIFIED","insertions":45,"deletions":-18},{"file":"src/vm/tests/test-update.js","type":"MODIFIED","insertions":94,"deletions":-58},{"file":"src/vm/tests/test-vminfod.js","type":"ADDED","insertions":42,"deletions":0},{"file":"src/vm/tests/test-zonewatcher.js","type":"ADDED","insertions":183,"deletions":0},{"file":"src/vm/tests/test-zpoolwatcher.js","type":"ADDED","insertions":144,"deletions":0},{"file":"src/vminfod.js","type":"ADDED","insertions":315,"deletions":0},{"file":"src/zoneevent.c","type":"DELETED","insertions":0,"deletions":-144},{"file":"src/zoneevent.js","type":"ADDED","insertions":108,"deletions":0}],"sizeInsertions":15108,"sizeDeletions":-3829},{"number":"4","revision":"4288baf9dd69060eb84496d08f453ff40ff36c5d","parents":["1d55b897d363f99cb7d4070166ca9433f0c14274"],"ref":"refs/changes/82/2782/4","uploader":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"createdOn":1511984035,"author":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1511984076,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"src/Makefile","type":"MODIFIED","insertions":22,"deletions":-6},{"file":"src/fswatcher.c","type":"ADDED","insertions":1006,"deletions":0},{"file":"src/manifest","type":"MODIFIED","insertions":23,"deletions":-1},{"file":"src/vm/common/vmtest.js","type":"MODIFIED","insertions":31,"deletions":-7},{"file":"src/vm/lib/metadata/agent.js","type":"MODIFIED","insertions":235,"deletions":-829},{"file":"src/vm/lib/metadata/zwatch.js","type":"DELETED","insertions":0,"deletions":-64},{"file":"src/vm/man/vmadm.1m.md","type":"MODIFIED","insertions":11,"deletions":0},{"file":"src/vm/node_modules/VM.js","type":"MODIFIED","insertions":3357,"deletions":-1723},{"file":"src/vm/node_modules/diff.js","type":"ADDED","insertions":505,"deletions":0},{"file":"src/vm/node_modules/expander.js","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"src/vm/node_modules/fswatcher.js","type":"ADDED","insertions":927,"deletions":0},{"file":"src/vm/node_modules/proptable.js","type":"MODIFIED","insertions":38,"deletions":-18},{"file":"src/vm/node_modules/queue.js","type":"ADDED","insertions":515,"deletions":0},{"file":"src/vm/node_modules/vasync/lib/vasync.js","type":"MODIFIED","insertions":381,"deletions":-95},{"file":"src/vm/node_modules/vasync/node_modules/verror/LICENSE","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"src/vm/node_modules/vasync/node_modules/verror/lib/verror.js","type":"MODIFIED","insertions":304,"deletions":-102},{"file":"src/vm/node_modules/vasync/node_modules/verror/node_modules/assert-plus/assert.js","type":"ADDED","insertions":211,"deletions":0},{"file":"src/vm/node_modules/vasync/node_modules/verror/node_modules/assert-plus/package.json","type":"ADDED","insertions":83,"deletions":0},{"file":"src/vm/node_modules/vasync/node_modules/verror/node_modules/core-util-is/LICENSE","type":"ADDED","insertions":19,"deletions":0},{"file":"src/vm/node_modules/vasync/node_modules/verror/node_modules/core-util-is/lib/util.js","type":"ADDED","insertions":107,"deletions":0},{"file":"src/vm/node_modules/vasync/node_modules/verror/node_modules/core-util-is/package.json","type":"ADDED","insertions":59,"deletions":0},{"file":"src/vm/node_modules/vasync/node_modules/verror/node_modules/extsprintf/lib/extsprintf.js","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"src/vm/node_modules/vasync/node_modules/verror/node_modules/extsprintf/package.json","type":"MODIFIED","insertions":25,"deletions":-5},{"file":"src/vm/node_modules/vasync/node_modules/verror/package.json","type":"MODIFIED","insertions":27,"deletions":-9},{"file":"src/vm/node_modules/vasync/package.json","type":"MODIFIED","insertions":9,"deletions":-6},{"file":"src/vm/node_modules/vminfod/client.js","type":"ADDED","insertions":1052,"deletions":0},{"file":"src/vm/node_modules/vminfod/vminfod.js","type":"ADDED","insertions":2374,"deletions":0},{"file":"src/vm/node_modules/vminfod/zonewatcher.js","type":"ADDED","insertions":76,"deletions":0},{"file":"src/vm/node_modules/vminfod/zpoolwatcher.js","type":"ADDED","insertions":119,"deletions":0},{"file":"src/vm/node_modules/vmload/dump-json.js","type":"MODIFIED","insertions":33,"deletions":-31},{"file":"src/vm/node_modules/vmload/dump-vmobjs.js","type":"MODIFIED","insertions":4,"deletions":-5},{"file":"src/vm/node_modules/vmload/dump-zonexml.js","type":"MODIFIED","insertions":7,"deletions":-4},{"file":"src/vm/node_modules/vmload/index.js","type":"MODIFIED","insertions":524,"deletions":-412},{"file":"src/vm/node_modules/vmload/vmload-datasets.js","type":"MODIFIED","insertions":22,"deletions":-12},{"file":"src/vm/node_modules/vmload/vmload-json.js","type":"MODIFIED","insertions":11,"deletions":-7},{"file":"src/vm/node_modules/vmload/vmload-zoneadm.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"src/vm/node_modules/zoneevent.js","type":"ADDED","insertions":178,"deletions":0},{"file":"src/vm/sbin/vmadm.js","type":"MODIFIED","insertions":106,"deletions":-2},{"file":"src/vm/sbin/vmadmd.js","type":"MODIFIED","insertions":17,"deletions":-22},{"file":"src/vm/sbin/vminfod.js","type":"ADDED","insertions":80,"deletions":0},{"file":"src/vm/smf/system-metadata.xml","type":"MODIFIED","insertions":4,"deletions":0},{"file":"src/vm/smf/system-vmadmd.xml","type":"MODIFIED","insertions":4,"deletions":0},{"file":"src/vm/smf/system-vminfod","type":"ADDED","insertions":49,"deletions":0},{"file":"src/vm/smf/system-vminfod.xml","type":"ADDED","insertions":47,"deletions":0},{"file":"src/vm/tests/test-50-creates.js","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"src/vm/tests/test-defaults.js","type":"MODIFIED","insertions":48,"deletions":-6},{"file":"src/vm/tests/test-delete.js","type":"MODIFIED","insertions":5,"deletions":-4},{"file":"src/vm/tests/test-diff.js","type":"ADDED","insertions":262,"deletions":0},{"file":"src/vm/tests/test-docker.js","type":"MODIFIED","insertions":100,"deletions":-59},{"file":"src/vm/tests/test-fswatcher.js","type":"ADDED","insertions":525,"deletions":0},{"file":"src/vm/tests/test-internal_metadata_namespaces.js","type":"MODIFIED","insertions":86,"deletions":-22},{"file":"src/vm/tests/test-lastexited.js","type":"MODIFIED","insertions":48,"deletions":-20},{"file":"src/vm/tests/test-queue.js","type":"ADDED","insertions":265,"deletions":0},{"file":"src/vm/tests/test-send-recv.js","type":"MODIFIED","insertions":215,"deletions":-131},{"file":"src/vm/tests/test-snapshots.js","type":"MODIFIED","insertions":45,"deletions":-18},{"file":"src/vm/tests/test-update.js","type":"MODIFIED","insertions":94,"deletions":-58},{"file":"src/vm/tests/test-vminfod.js","type":"ADDED","insertions":42,"deletions":0},{"file":"src/vm/tests/test-zonewatcher.js","type":"ADDED","insertions":183,"deletions":0},{"file":"src/vm/tests/test-zpoolwatcher.js","type":"ADDED","insertions":144,"deletions":0},{"file":"src/vminfod.js","type":"ADDED","insertions":315,"deletions":0},{"file":"src/zoneevent.c","type":"DELETED","insertions":0,"deletions":-144},{"file":"src/zoneevent.js","type":"ADDED","insertions":108,"deletions":0}],"sizeInsertions":15107,"sizeDeletions":-3829},{"number":"5","revision":"eade8d964d9843d44b0f1066494d0a42dcfad0e1","parents":["1d55b897d363f99cb7d4070166ca9433f0c14274"],"ref":"refs/changes/82/2782/5","uploader":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"createdOn":1511984140,"author":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1511984182,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"src/fswatcher.c","line":119,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"remove (see below)"},{"file":"src/fswatcher.c","line":119,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Done"},{"file":"src/fswatcher.c","line":955,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"since you\u0027ve settled on the non-pthread versions, change this to thread_t and then you\u0027re pthread free (and can remove the header include directive)."},{"file":"src/fswatcher.c","line":955,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Will do, ty."},{"file":"src/fswatcher.c","line":999,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Apologies for not catching this on the first pass, but probably should check and error if the threads don\u0027t get created (it\u0027s rare, but can happen either due to resource controls or if segkpm (I think, one of them) is exhausted."},{"file":"src/fswatcher.c","line":999,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Will do."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"src/Makefile","type":"MODIFIED","insertions":22,"deletions":-6},{"file":"src/fswatcher.c","type":"ADDED","insertions":1014,"deletions":0},{"file":"src/manifest","type":"MODIFIED","insertions":23,"deletions":-1},{"file":"src/vm/common/vmtest.js","type":"MODIFIED","insertions":31,"deletions":-7},{"file":"src/vm/lib/metadata/agent.js","type":"MODIFIED","insertions":235,"deletions":-829},{"file":"src/vm/lib/metadata/zwatch.js","type":"DELETED","insertions":0,"deletions":-64},{"file":"src/vm/man/vmadm.1m.md","type":"MODIFIED","insertions":11,"deletions":0},{"file":"src/vm/node_modules/VM.js","type":"MODIFIED","insertions":3357,"deletions":-1723},{"file":"src/vm/node_modules/diff.js","type":"ADDED","insertions":505,"deletions":0},{"file":"src/vm/node_modules/expander.js","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"src/vm/node_modules/fswatcher.js","type":"ADDED","insertions":927,"deletions":0},{"file":"src/vm/node_modules/proptable.js","type":"MODIFIED","insertions":38,"deletions":-18},{"file":"src/vm/node_modules/queue.js","type":"ADDED","insertions":515,"deletions":0},{"file":"src/vm/node_modules/vasync/lib/vasync.js","type":"MODIFIED","insertions":381,"deletions":-95},{"file":"src/vm/node_modules/vasync/node_modules/verror/LICENSE","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"src/vm/node_modules/vasync/node_modules/verror/lib/verror.js","type":"MODIFIED","insertions":304,"deletions":-102},{"file":"src/vm/node_modules/vasync/node_modules/verror/node_modules/assert-plus/assert.js","type":"ADDED","insertions":211,"deletions":0},{"file":"src/vm/node_modules/vasync/node_modules/verror/node_modules/assert-plus/package.json","type":"ADDED","insertions":83,"deletions":0},{"file":"src/vm/node_modules/vasync/node_modules/verror/node_modules/core-util-is/LICENSE","type":"ADDED","insertions":19,"deletions":0},{"file":"src/vm/node_modules/vasync/node_modules/verror/node_modules/core-util-is/lib/util.js","type":"ADDED","insertions":107,"deletions":0},{"file":"src/vm/node_modules/vasync/node_modules/verror/node_modules/core-util-is/package.json","type":"ADDED","insertions":59,"deletions":0},{"file":"src/vm/node_modules/vasync/node_modules/verror/node_modules/extsprintf/lib/extsprintf.js","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"src/vm/node_modules/vasync/node_modules/verror/node_modules/extsprintf/package.json","type":"MODIFIED","insertions":25,"deletions":-5},{"file":"src/vm/node_modules/vasync/node_modules/verror/package.json","type":"MODIFIED","insertions":27,"deletions":-9},{"file":"src/vm/node_modules/vasync/package.json","type":"MODIFIED","insertions":9,"deletions":-6},{"file":"src/vm/node_modules/vminfod/client.js","type":"ADDED","insertions":1052,"deletions":0},{"file":"src/vm/node_modules/vminfod/vminfod.js","type":"ADDED","insertions":2374,"deletions":0},{"file":"src/vm/node_modules/vminfod/zonewatcher.js","type":"ADDED","insertions":76,"deletions":0},{"file":"src/vm/node_modules/vminfod/zpoolwatcher.js","type":"ADDED","insertions":119,"deletions":0},{"file":"src/vm/node_modules/vmload/dump-json.js","type":"MODIFIED","insertions":33,"deletions":-31},{"file":"src/vm/node_modules/vmload/dump-vmobjs.js","type":"MODIFIED","insertions":4,"deletions":-5},{"file":"src/vm/node_modules/vmload/dump-zonexml.js","type":"MODIFIED","insertions":7,"deletions":-4},{"file":"src/vm/node_modules/vmload/index.js","type":"MODIFIED","insertions":524,"deletions":-412},{"file":"src/vm/node_modules/vmload/vmload-datasets.js","type":"MODIFIED","insertions":22,"deletions":-12},{"file":"src/vm/node_modules/vmload/vmload-json.js","type":"MODIFIED","insertions":11,"deletions":-7},{"file":"src/vm/node_modules/vmload/vmload-zoneadm.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"src/vm/node_modules/zoneevent.js","type":"ADDED","insertions":178,"deletions":0},{"file":"src/vm/sbin/vmadm.js","type":"MODIFIED","insertions":106,"deletions":-2},{"file":"src/vm/sbin/vmadmd.js","type":"MODIFIED","insertions":17,"deletions":-22},{"file":"src/vm/sbin/vminfod.js","type":"ADDED","insertions":80,"deletions":0},{"file":"src/vm/smf/system-metadata.xml","type":"MODIFIED","insertions":4,"deletions":0},{"file":"src/vm/smf/system-vmadmd.xml","type":"MODIFIED","insertions":4,"deletions":0},{"file":"src/vm/smf/system-vminfod","type":"ADDED","insertions":49,"deletions":0},{"file":"src/vm/smf/system-vminfod.xml","type":"ADDED","insertions":47,"deletions":0},{"file":"src/vm/tests/test-50-creates.js","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"src/vm/tests/test-defaults.js","type":"MODIFIED","insertions":48,"deletions":-6},{"file":"src/vm/tests/test-delete.js","type":"MODIFIED","insertions":5,"deletions":-4},{"file":"src/vm/tests/test-diff.js","type":"ADDED","insertions":262,"deletions":0},{"file":"src/vm/tests/test-docker.js","type":"MODIFIED","insertions":100,"deletions":-59},{"file":"src/vm/tests/test-fswatcher.js","type":"ADDED","insertions":525,"deletions":0},{"file":"src/vm/tests/test-internal_metadata_namespaces.js","type":"MODIFIED","insertions":86,"deletions":-22},{"file":"src/vm/tests/test-lastexited.js","type":"MODIFIED","insertions":48,"deletions":-20},{"file":"src/vm/tests/test-queue.js","type":"ADDED","insertions":265,"deletions":0},{"file":"src/vm/tests/test-send-recv.js","type":"MODIFIED","insertions":215,"deletions":-131},{"file":"src/vm/tests/test-snapshots.js","type":"MODIFIED","insertions":45,"deletions":-18},{"file":"src/vm/tests/test-update.js","type":"MODIFIED","insertions":94,"deletions":-58},{"file":"src/vm/tests/test-vminfod.js","type":"ADDED","insertions":42,"deletions":0},{"file":"src/vm/tests/test-zonewatcher.js","type":"ADDED","insertions":183,"deletions":0},{"file":"src/vm/tests/test-zpoolwatcher.js","type":"ADDED","insertions":144,"deletions":0},{"file":"src/vminfod.js","type":"ADDED","insertions":315,"deletions":0},{"file":"src/zoneevent.c","type":"DELETED","insertions":0,"deletions":-144},{"file":"src/zoneevent.js","type":"ADDED","insertions":108,"deletions":0}],"sizeInsertions":15115,"sizeDeletions":-3829},{"number":"6","revision":"e5f496e8de00c4a0572e001a5978f703635e81c3","parents":["1d55b897d363f99cb7d4070166ca9433f0c14274"],"ref":"refs/changes/82/2782/6","uploader":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"createdOn":1511996753,"author":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1511996795,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"src/Makefile","type":"MODIFIED","insertions":22,"deletions":-6},{"file":"src/fswatcher.c","type":"ADDED","insertions":1024,"deletions":0},{"file":"src/manifest","type":"MODIFIED","insertions":23,"deletions":-1},{"file":"src/vm/common/vmtest.js","type":"MODIFIED","insertions":31,"deletions":-7},{"file":"src/vm/lib/metadata/agent.js","type":"MODIFIED","insertions":235,"deletions":-829},{"file":"src/vm/lib/metadata/zwatch.js","type":"DELETED","insertions":0,"deletions":-64},{"file":"src/vm/man/vmadm.1m.md","type":"MODIFIED","insertions":11,"deletions":0},{"file":"src/vm/node_modules/VM.js","type":"MODIFIED","insertions":3357,"deletions":-1723},{"file":"src/vm/node_modules/diff.js","type":"ADDED","insertions":505,"deletions":0},{"file":"src/vm/node_modules/expander.js","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"src/vm/node_modules/fswatcher.js","type":"ADDED","insertions":927,"deletions":0},{"file":"src/vm/node_modules/proptable.js","type":"MODIFIED","insertions":38,"deletions":-18},{"file":"src/vm/node_modules/queue.js","type":"ADDED","insertions":515,"deletions":0},{"file":"src/vm/node_modules/vasync/lib/vasync.js","type":"MODIFIED","insertions":381,"deletions":-95},{"file":"src/vm/node_modules/vasync/node_modules/verror/LICENSE","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"src/vm/node_modules/vasync/node_modules/verror/lib/verror.js","type":"MODIFIED","insertions":304,"deletions":-102},{"file":"src/vm/node_modules/vasync/node_modules/verror/node_modules/assert-plus/assert.js","type":"ADDED","insertions":211,"deletions":0},{"file":"src/vm/node_modules/vasync/node_modules/verror/node_modules/assert-plus/package.json","type":"ADDED","insertions":83,"deletions":0},{"file":"src/vm/node_modules/vasync/node_modules/verror/node_modules/core-util-is/LICENSE","type":"ADDED","insertions":19,"deletions":0},{"file":"src/vm/node_modules/vasync/node_modules/verror/node_modules/core-util-is/lib/util.js","type":"ADDED","insertions":107,"deletions":0},{"file":"src/vm/node_modules/vasync/node_modules/verror/node_modules/core-util-is/package.json","type":"ADDED","insertions":59,"deletions":0},{"file":"src/vm/node_modules/vasync/node_modules/verror/node_modules/extsprintf/lib/extsprintf.js","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"src/vm/node_modules/vasync/node_modules/verror/node_modules/extsprintf/package.json","type":"MODIFIED","insertions":25,"deletions":-5},{"file":"src/vm/node_modules/vasync/node_modules/verror/package.json","type":"MODIFIED","insertions":27,"deletions":-9},{"file":"src/vm/node_modules/vasync/package.json","type":"MODIFIED","insertions":9,"deletions":-6},{"file":"src/vm/node_modules/vminfod/client.js","type":"ADDED","insertions":1052,"deletions":0},{"file":"src/vm/node_modules/vminfod/vminfod.js","type":"ADDED","insertions":2374,"deletions":0},{"file":"src/vm/node_modules/vminfod/zonewatcher.js","type":"ADDED","insertions":76,"deletions":0},{"file":"src/vm/node_modules/vminfod/zpoolwatcher.js","type":"ADDED","insertions":119,"deletions":0},{"file":"src/vm/node_modules/vmload/dump-json.js","type":"MODIFIED","insertions":33,"deletions":-31},{"file":"src/vm/node_modules/vmload/dump-vmobjs.js","type":"MODIFIED","insertions":4,"deletions":-5},{"file":"src/vm/node_modules/vmload/dump-zonexml.js","type":"MODIFIED","insertions":7,"deletions":-4},{"file":"src/vm/node_modules/vmload/index.js","type":"MODIFIED","insertions":524,"deletions":-412},{"file":"src/vm/node_modules/vmload/vmload-datasets.js","type":"MODIFIED","insertions":22,"deletions":-12},{"file":"src/vm/node_modules/vmload/vmload-json.js","type":"MODIFIED","insertions":11,"deletions":-7},{"file":"src/vm/node_modules/vmload/vmload-zoneadm.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"src/vm/node_modules/zoneevent.js","type":"ADDED","insertions":178,"deletions":0},{"file":"src/vm/sbin/vmadm.js","type":"MODIFIED","insertions":106,"deletions":-2},{"file":"src/vm/sbin/vmadmd.js","type":"MODIFIED","insertions":17,"deletions":-22},{"file":"src/vm/sbin/vminfod.js","type":"ADDED","insertions":80,"deletions":0},{"file":"src/vm/smf/system-metadata.xml","type":"MODIFIED","insertions":4,"deletions":0},{"file":"src/vm/smf/system-vmadmd.xml","type":"MODIFIED","insertions":4,"deletions":0},{"file":"src/vm/smf/system-vminfod","type":"ADDED","insertions":49,"deletions":0},{"file":"src/vm/smf/system-vminfod.xml","type":"ADDED","insertions":47,"deletions":0},{"file":"src/vm/tests/test-50-creates.js","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"src/vm/tests/test-defaults.js","type":"MODIFIED","insertions":48,"deletions":-6},{"file":"src/vm/tests/test-delete.js","type":"MODIFIED","insertions":5,"deletions":-4},{"file":"src/vm/tests/test-diff.js","type":"ADDED","insertions":262,"deletions":0},{"file":"src/vm/tests/test-docker.js","type":"MODIFIED","insertions":100,"deletions":-59},{"file":"src/vm/tests/test-fswatcher.js","type":"ADDED","insertions":525,"deletions":0},{"file":"src/vm/tests/test-internal_metadata_namespaces.js","type":"MODIFIED","insertions":86,"deletions":-22},{"file":"src/vm/tests/test-lastexited.js","type":"MODIFIED","insertions":48,"deletions":-20},{"file":"src/vm/tests/test-queue.js","type":"ADDED","insertions":265,"deletions":0},{"file":"src/vm/tests/test-send-recv.js","type":"MODIFIED","insertions":215,"deletions":-131},{"file":"src/vm/tests/test-snapshots.js","type":"MODIFIED","insertions":45,"deletions":-18},{"file":"src/vm/tests/test-update.js","type":"MODIFIED","insertions":94,"deletions":-58},{"file":"src/vm/tests/test-vminfod.js","type":"ADDED","insertions":42,"deletions":0},{"file":"src/vm/tests/test-zonewatcher.js","type":"ADDED","insertions":183,"deletions":0},{"file":"src/vm/tests/test-zpoolwatcher.js","type":"ADDED","insertions":144,"deletions":0},{"file":"src/vminfod.js","type":"ADDED","insertions":315,"deletions":0},{"file":"src/zoneevent.c","type":"DELETED","insertions":0,"deletions":-144},{"file":"src/zoneevent.js","type":"ADDED","insertions":108,"deletions":0}],"sizeInsertions":15125,"sizeDeletions":-3829},{"number":"7","revision":"2d7054704316b148f96600cb0c2fce4a7f89d801","parents":["692769ff8c7c8b180f8d35bf4dfe68ea05a87599"],"ref":"refs/changes/82/2782/7","uploader":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"createdOn":1512511060,"author":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1512511105,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"src/Makefile","type":"MODIFIED","insertions":22,"deletions":-6},{"file":"src/fswatcher.c","type":"ADDED","insertions":1024,"deletions":0},{"file":"src/manifest","type":"MODIFIED","insertions":23,"deletions":-1},{"file":"src/vm/common/vmtest.js","type":"MODIFIED","insertions":31,"deletions":-7},{"file":"src/vm/lib/metadata/agent.js","type":"MODIFIED","insertions":235,"deletions":-829},{"file":"src/vm/lib/metadata/zwatch.js","type":"DELETED","insertions":0,"deletions":-64},{"file":"src/vm/man/vmadm.1m.md","type":"MODIFIED","insertions":11,"deletions":0},{"file":"src/vm/node_modules/VM.js","type":"MODIFIED","insertions":3354,"deletions":-1720},{"file":"src/vm/node_modules/diff.js","type":"ADDED","insertions":505,"deletions":0},{"file":"src/vm/node_modules/expander.js","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"src/vm/node_modules/fswatcher.js","type":"ADDED","insertions":927,"deletions":0},{"file":"src/vm/node_modules/proptable.js","type":"MODIFIED","insertions":38,"deletions":-18},{"file":"src/vm/node_modules/queue.js","type":"ADDED","insertions":515,"deletions":0},{"file":"src/vm/node_modules/vminfod/client.js","type":"ADDED","insertions":1052,"deletions":0},{"file":"src/vm/node_modules/vminfod/vminfod.js","type":"ADDED","insertions":2374,"deletions":0},{"file":"src/vm/node_modules/vminfod/zonewatcher.js","type":"ADDED","insertions":76,"deletions":0},{"file":"src/vm/node_modules/vminfod/zpoolwatcher.js","type":"ADDED","insertions":119,"deletions":0},{"file":"src/vm/node_modules/vmload/dump-json.js","type":"MODIFIED","insertions":33,"deletions":-31},{"file":"src/vm/node_modules/vmload/dump-vmobjs.js","type":"MODIFIED","insertions":4,"deletions":-5},{"file":"src/vm/node_modules/vmload/dump-zonexml.js","type":"MODIFIED","insertions":7,"deletions":-4},{"file":"src/vm/node_modules/vmload/index.js","type":"MODIFIED","insertions":524,"deletions":-412},{"file":"src/vm/node_modules/vmload/vmload-datasets.js","type":"MODIFIED","insertions":22,"deletions":-12},{"file":"src/vm/node_modules/vmload/vmload-json.js","type":"MODIFIED","insertions":11,"deletions":-7},{"file":"src/vm/node_modules/vmload/vmload-zoneadm.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"src/vm/node_modules/zoneevent.js","type":"ADDED","insertions":178,"deletions":0},{"file":"src/vm/sbin/vmadm.js","type":"MODIFIED","insertions":106,"deletions":-2},{"file":"src/vm/sbin/vmadmd.js","type":"MODIFIED","insertions":17,"deletions":-22},{"file":"src/vm/sbin/vminfod.js","type":"ADDED","insertions":80,"deletions":0},{"file":"src/vm/smf/system-metadata.xml","type":"MODIFIED","insertions":4,"deletions":0},{"file":"src/vm/smf/system-vmadmd.xml","type":"MODIFIED","insertions":4,"deletions":0},{"file":"src/vm/smf/system-vminfod","type":"ADDED","insertions":49,"deletions":0},{"file":"src/vm/smf/system-vminfod.xml","type":"ADDED","insertions":47,"deletions":0},{"file":"src/vm/tests/test-50-creates.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"src/vm/tests/test-defaults.js","type":"MODIFIED","insertions":48,"deletions":-6},{"file":"src/vm/tests/test-delete.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"src/vm/tests/test-diff.js","type":"ADDED","insertions":262,"deletions":0},{"file":"src/vm/tests/test-docker.js","type":"MODIFIED","insertions":100,"deletions":-59},{"file":"src/vm/tests/test-fswatcher.js","type":"ADDED","insertions":525,"deletions":0},{"file":"src/vm/tests/test-internal_metadata_namespaces.js","type":"MODIFIED","insertions":86,"deletions":-22},{"file":"src/vm/tests/test-lastexited.js","type":"MODIFIED","insertions":48,"deletions":-20},{"file":"src/vm/tests/test-queue.js","type":"ADDED","insertions":265,"deletions":0},{"file":"src/vm/tests/test-send-recv.js","type":"MODIFIED","insertions":215,"deletions":-131},{"file":"src/vm/tests/test-update.js","type":"MODIFIED","insertions":94,"deletions":-58},{"file":"src/vm/tests/test-vminfod.js","type":"ADDED","insertions":42,"deletions":0},{"file":"src/vm/tests/test-zonewatcher.js","type":"ADDED","insertions":183,"deletions":0},{"file":"src/vm/tests/test-zpoolwatcher.js","type":"ADDED","insertions":144,"deletions":0},{"file":"src/vminfod.js","type":"ADDED","insertions":315,"deletions":0},{"file":"src/zoneevent.c","type":"DELETED","insertions":0,"deletions":-144},{"file":"src/zoneevent.js","type":"ADDED","insertions":108,"deletions":0}],"sizeInsertions":13837,"sizeDeletions":-3585},{"number":"8","revision":"49d315bb4944cf69c079da41c6b0e45ec77c3778","parents":["692769ff8c7c8b180f8d35bf4dfe68ea05a87599"],"ref":"refs/changes/82/2782/8","uploader":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"createdOn":1512511439,"author":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1512511484,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"src/Makefile","line":389,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"I think to match vmadm, we should change this so that the executable itself is in /usr/vm/sbin and if there\u0027s a link it\u0027s from /usr/sbin/vminfod. Also: what do you think about renaming the cli tool \"vminfo\" to distinguish it from the daemon vminfod?"},{"file":"src/Makefile","line":389,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Agreed on both points... will change."},{"file":"src/manifest","line":824,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"See my comment in Makefile, I think this should be in /usr/vm/sbin instead."},{"file":"src/manifest","line":824,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Done"},{"file":"src/vm/lib/metadata/agent.js","line":378,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"nit, the codebase here prefers:\n\n    if (self.zoneConnections[ev.zonename]) {\n        return;\n    }"},{"file":"src/vm/lib/metadata/agent.js","line":378,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Done"},{"file":"src/vm/lib/metadata/agent.js","line":408,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"nit, the codebase here prefers:\n\n    if (ev.vm_brand !\u003d\u003d \u0027kvm\u0027) {\n        return;\n    }"},{"file":"src/vm/lib/metadata/agent.js","line":408,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Done"},{"file":"src/vm/lib/metadata/agent.js","line":560,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Why do we no longer need to care here about ECONNREFUSED, and trying to reconnect?"},{"file":"src/vm/lib/metadata/agent.js","line":560,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"oh no, this must have somehow gotten lost from OS-5999 during a merge from master.  I\u0027ll review this file and figure out how to get all of that logic back in here."},{"file":"src/vm/lib/metadata/agent.js","line":867,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"\"also *apply* to routes\", though I realize that\u0027s not your bug. :)"},{"file":"src/vm/lib/metadata/agent.js","line":867,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"ha, good catch - will fix as well."},{"file":"src/vm/man/vmadm.1m.md","line":106,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"I think this -r text might be confusing. Specifically: my first thought at seeing this was: how does it make sense to ever output events when the events are *not* ready?"},{"file":"src/vm/man/vmadm.1m.md","line":106,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"hm, do you know how I could reword it? when `-r` is supplied, a special event is emitted when the stream is ready, ie.\n\n\n [root@headnode (emy-12) /usr/vm]# vmadm events -r\n [18:15:24.610Z] ready\n [18:15:25.362Z] 31400151 sdcdockertest_affinity_b9ce... modify: \n zone_state changed :: \"installed\" -\u003e \"incomplete\"\n\n\nWithout `-r`, that \"ready\" line won\u0027t be printed and the event stream will start *sometime after* the command is successfully forked and exec\u0027d."},{"file":"src/vm/man/vmadm.1m.md","line":106,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"I think your description in your comment sounds good. :) Indicating that it\u0027s a special/extra event when the stream is ready would make this more clear. Even just adding the word \"extra\" after \"Output an\" would make this clearer to me I think."},{"file":"src/vm/man/vmadm.1m.md","line":106,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Done"},{"file":"src/vm/node_modules/VM.js","line":2394,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"I wonder if naming this cancelFn (and everywhere else cancel() is used) would make it more obvious that it\u0027s a function here?"},{"file":"src/vm/node_modules/VM.js","line":2394,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Agreed - will change."},{"file":"src/vm/node_modules/VM.js","line":7385,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"again, consider cancelFn?"},{"file":"src/vm/node_modules/VM.js","line":7385,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Done"},{"file":"src/vm/node_modules/VM.js","line":7386,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"It\u0027s possible to do a single:\n\n    zfs set prop1\u003dvalue1 prop2\u003dvalue2 dataset\n\nis there a reason not to do that here? Is that so we can know which one failed without reading the stderr?"},{"file":"src/vm/node_modules/VM.js","line":7386,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"That was the reasoning I had used actually - I\u0027d want the failure to be obvious if a command failed.  I could rewrite this to all be one command but I don\u0027t think it\u0027s strictly necessary.  Also, the vminfod stream is reused so we don\u0027t have to worry about creating and tearing that down every command."},{"file":"src/vm/node_modules/VM.js","line":7386,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Ok, so maybe just a comment then just indicating that these are set separately in order to make it clearer which one failed?"},{"file":"src/vm/node_modules/VM.js","line":7386,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Done"},{"file":"src/vm/node_modules/VM.js","line":7432,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"same here, and I\u0027m going to stop pointing these out. The comment obviously applies to all cases. :)"},{"file":"src/vm/node_modules/VM.js","line":7432,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Done"},{"file":"src/vm/node_modules/VM.js","line":7433,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"when doing these in parallel, are we guaranteed that the watcher will be ready before the makeIndestructible() does its business in all cases?"},{"file":"src/vm/node_modules/VM.js","line":7433,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"So that\u0027s an interesting point.  watchForEvent is synchronous, in that the watcher is already created, and the call to watchForEvent just attaches a listener.  The only way this could break is if vasync.parallel for some reason decided to run the second function first... I actually don\u0027t know if parallel guarantees it\u0027ll run them in order."},{"file":"src/vm/node_modules/VM.js","line":7433,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Might be worth checking, or at least documenting that this is the assumption."},{"file":"src/vm/node_modules/VM.js","line":7433,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"https://github.com/joyent/node-vasync/issues/38"},{"file":"src/vm/node_modules/VM.js","line":7433,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Based on dap\u0027s comment there, should we change where we\u0027re using this pattern to using barriers?"},{"file":"src/vm/node_modules/VM.js","line":7433,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"I have to look into this more.  Converting this pattern to use barriers will require a lot more boilerplate code, specifically around manually handling errors from either the vminfod blocking code, or the code itself to do work (in this case, makeIndestructible).  I may be able to abstract this logic into a function specifically for the vminfod work case, but I don\u0027t know yet. I\u0027ll check this out."},{"file":"src/vm/node_modules/VM.js","line":7604,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"... because it was already empty, right?"},{"file":"src/vm/node_modules/VM.js","line":7604,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"correct."},{"file":"src/vm/node_modules/VM.js","line":7604,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"will add more descriptive comment about \"shouldBlock\""},{"file":"src/vm/node_modules/VM.js","line":8686,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Where did this come from?\n\nAnd what happens when there\u0027s no /usr/bin/sleep? Or that doesn\u0027t support an \"Inf\" argument?\n\nAlso I think the comment here might be confusing since sleep !\u003d halt for a zone."},{"file":"src/vm/node_modules/VM.js","line":8686,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Oh wow... this is old and actually might not be relevant anymore - this came from the time where short-lived vms were causing issues - but that should be fixed now.  I\u0027ll do some testing and see if it\u0027s necessary anymore."},{"file":"src/vm/node_modules/VM.js","line":9979,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"seems like this could just be:\n\n    createConfigDir(vmobj.zonepath, log, cb);\n\nmaybe? Not sure if that\u0027s clearer or just more concise though."},{"file":"src/vm/node_modules/VM.js","line":9979,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":":D get ready.\n\nI *may* or *may not* be able to da that. How do I know this? I got absolutely screwed by it.\n\nThis is not a vasync.pipeline, but instead is a vasync.waterfall.  This means the results passed to the callback are propagated to the function below it.  *THIS MEANS*, the positional argument of the callback function *can change* based on how the callback above it was invoked.  Right or wrong, I\u0027m trying to be very explicit here to avoid any weirdness from that.  Perhaps this can be changed from waterfall? I haven\u0027t looked too closely into it but I will now."},{"file":"src/vm/node_modules/VM.js","line":9979,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Sure, what\u0027s here is fine then."},{"file":"src/vm/node_modules/VM.js","line":10789,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Under what circumstances would this \"retry\" ever work? Especially given that there\u0027s little to no delay between the ready event and us doing this VM.load, it seems surprising to me that without a bug this would happen. Is this here in order to detect a bug in vminfod? If so, should we blow up or at least warn that it wasn\u0027t there initially, but was on the VM.load?"},{"file":"src/vm/node_modules/VM.js","line":10789,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"This was me being lazy and not forming my own error message.  But in reality, because of how much we need to rely on vminfod, I should removed this whole VM.load section and just use the VM found in vminfod, and throw an error if it is not found."},{"file":"src/vm/node_modules/VM.js","line":10789,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"That sounds reasonable."},{"file":"src/vm/node_modules/VM.js","line":12694,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Why do we no longer need to lock here? I see that writeAllMetadata now does locking itself, but that lock is not around the load and increment here which seems like it could cause problems. If two things tried to update at once, for any reason the value will not be incremented twice. If two things tried to set the restartdelay at once, one of the updates would be lost. etc.\n\nIf we\u0027re assuming this is safe because we know all the callers and know that there\u0027s never going to be a case where two updates happen at once, that should be called out clearly to ensure nothing else tries to use this function as it would be dangerous to do so."},{"file":"src/vm/node_modules/VM.js","line":12694,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"hm, yes that is a bug.  I\u0027ll fix the locking here."},{"file":"src/vm/node_modules/VM.js","line":12711,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Is there a reason for switching here to parseInt instead of Number?\n\nI think instead of replacing one with the other (they\u0027re both bad in different ways), if we\u0027re going to replace with anything we should switch to using:\n\nhttps://github.com/joyent/node-jsprim#parseintegerstr-options"},{"file":"src/vm/node_modules/VM.js","line":12711,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"I always prefer parseInt because you can specify the base (base 10) to avoid any weirdness with octals.  I can replace this with jsprim."},{"file":"src/vm/node_modules/VM.js","line":12711,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"It\u0027s fine to make this a followup ticket I think."},{"file":"src/vm/node_modules/VM.js","line":14239,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Same question as above: when could this happen?"},{"file":"src/vm/node_modules/VM.js","line":14239,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"same as above."},{"file":"src/vm/node_modules/VM.js","line":14265,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"*to* block for?"},{"file":"src/vm/node_modules/VM.js","line":14265,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"yes, good catch."},{"file":"src/vm/node_modules/VM.js","line":14269,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"proptable.js?"},{"file":"src/vm/node_modules/VM.js","line":14269,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"I\u0027ll use that."},{"file":"src/vm/node_modules/VM.js","line":14269,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"I don\u0027t see that code was added to use these from proptable.js, am I missing something?"},{"file":"src/vm/node_modules/VM.js","line":14292,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"If this isn\u0027t going to be done now, should we create a ticket for it and point to that here?"},{"file":"src/vm/node_modules/VM.js","line":14292,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"oh, i missed this.  I\u0027ll make that change now."},{"file":"src/vm/node_modules/VM.js","line":14292,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Again: I don\u0027t see that this was done?"},{"file":"src/vm/node_modules/VM.js","line":14555,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"While not an error, I find that defining variables in the middle of their scope like this (and elsewhere in this file) has a tendency to eventually cause problems (it\u0027s similar to using global variables all over in bash). Luckily these are usually caught by the linter when they happen, but still I recommend in general moving all variables to the top of their scope rather than sprinkling them around all over the scope. Not something that I\u0027d block the change over, but something to think about."},{"file":"src/vm/node_modules/VM.js","line":14555,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"I\u0027ll make the change."},{"file":"src/vm/node_modules/VM.js","line":14761,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Isn\u0027t this still sending as stdin via the opts.stdin below?"},{"file":"src/vm/node_modules/VM.js","line":14761,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"hm, it is. not sure how that happened.  will update."},{"file":"src/vm/node_modules/diff.js","line":89,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"The purpose of prettyPath is to be printable/human readable, I wonder if the name could reflect that more somehow? humanPath. strPath, printablePath? I don\u0027t know. I\u0027m just not sure prettyPath is the most obvious name if one runs across it, and since it appears in the output of `vmadm events` it seems once this is released we\u0027ll be stuck with it. I wonder if others have opinions here."},{"file":"src/vm/node_modules/diff.js","line":89,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Personally, when I see \"pretty\" I assume that it isn\u0027t meant for to be used programmatically, or that if I do use it it is subject to change or not fully consistent.  I wouldn\u0027t be against changing the keyname though if others have opinions on this."},{"file":"src/vm/node_modules/diff.js","line":107,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"The to/from naming here seems like it\u0027s not so obvious what it means when we\u0027re talking about added/removed... I wonder if \"old\"/\"new\" would make more sense? Just a thought."},{"file":"src/vm/node_modules/diff.js","line":107,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Ah, I can see that - especially in the codebase here we consider it A vs B.  \"old\"/\"new\" is a change i\u0027d be happy to make."},{"file":"src/vm/node_modules/diff.js","line":431,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"s/tha/the/"},{"file":"src/vm/node_modules/diff.js","line":431,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Done"},{"file":"src/vm/node_modules/fswatcher.js","line":54,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"If for some reason fswatcher.c is streaming out events faster than we can read them (for example, if node\u0027s busy with other work), how could that  be detected? Could we look at the time value in the stream messages and keep the average delta between that and the current time for the last 10, 100 and 1000 messages or something like that? Just a thought."},{"file":"src/vm/node_modules/fswatcher.js","line":54,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"I suppose this is definitely possible - basically you want a way to detect if the delta is larger than some acceptable value averaged over the last X messages AFAICT.  I\u0027ll try something like that and see."},{"file":"src/vm/node_modules/fswatcher.js","line":54,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Any results to report?"},{"file":"src/vm/node_modules/fswatcher.js","line":54,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Will be in the next patchset"},{"file":"src/vm/node_modules/fswatcher.js","line":54,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"In milliseconds, we have:\n\n\n [root@headnode (emy-12) ~]# vminfo status -f | json fswatcher.message_delays\n {\n   \"1\": 0,\n   \"10\": 0,\n   \"100\": 0,\n   \"1000\": 0.008\n }\n\n\nWhen under heavy load (typically during a test run where multiple VMs are being modified at the same time)\n\n [2018-02-28T21:36:39.836Z]  WARN: vminfod/4423 on headnode: message took 47ms to process (\u003e 10ms) (deltaMs\u003d47)\n     avg: {\n       \"1\": 47,\n       \"10\": 4.8,\n       \"100\": 1.56,\n       \"1000\": 1.145\n     }\n\nThe last 1 messages is the single message that took 47ms... the last 10 messages are ~4.8ms which pretty much means that the 47ms message is the outlier.  Interesting stats to see definitely."},{"file":"src/vm/node_modules/fswatcher.js","line":82,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"10 seconds, not 5 I think?"},{"file":"src/vm/node_modules/fswatcher.js","line":82,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Good catch - it was 5 before Isaac started roughing up vminfod with his crazy tests ha."},{"file":"src/vm/node_modules/fswatcher.js","line":886,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Does \"Date\" need to be a special case here given that this is also the default case? Would https://github.com/joyent/node-jsprim#deepcopyobj also work here?"},{"file":"src/vm/node_modules/fswatcher.js","line":886,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Unfortunately yes, because typeof a date object returns \u0027object\u0027.  I\u0027ll look into pulling jsprim into the platform."},{"file":"src/vm/node_modules/fswatcher.js","line":886,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Ah, cool."},{"file":"src/vm/node_modules/proptable.js","line":1508,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"The default value for restart_init should be true."},{"file":"src/vm/node_modules/proptable.js","line":1508,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Done"},{"file":"src/vm/node_modules/queue.js","line":103,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"s/minuto/minute/"},{"file":"src/vm/node_modules/queue.js","line":103,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"HA - good catch."},{"file":"src/vm/node_modules/vminfod/client.js","line":56,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Is it possible for an even to be too large for a single read such that you\u0027d do a vs.read and get only part of an event? If not, what prevents that? If so, should the example include code to handle this?\n\nConversely, if we always read a whole event object, how does this behave if a VM has a 10M blob added to its metadata?"},{"file":"src/vm/node_modules/vminfod/client.js","line":56,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"I don\u0027t actually know.  The stream is set with objectMode: true so I don\u0027t *think* so.  The data is taken and piped to a node-lstream first so that should buffer up all of the data until a full object can be constructed.  Also, I have no idea what would happen if the JSON blob got huge - it probably wouldn\u0027t be good."},{"file":"src/vm/node_modules/vminfod/client.js","line":151,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Should this be vw.vms and vw.vm?"},{"file":"src/vm/node_modules/vminfod/client.js","line":151,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"yes, good catch."},{"file":"src/vm/node_modules/vminfod/client.js","line":325,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Could we set an error code instead and check for either the message or code?"},{"file":"src/vm/node_modules/vminfod/client.js","line":325,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"I\u0027m not sure I understand what you mean?  Perhaps just leave the code as 404 and check that in VM.js?"},{"file":"src/vm/node_modules/vminfod/client.js","line":325,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"I meant, set an error code here on the err we\u0027re returning and have the code that\u0027s currently calling this and expecting to see \"No such zone configured\" message check either for the message or the code. If that\u0027s too much hassle, that\u0027s fine."},{"file":"src/vm/node_modules/vminfod/client.js","line":403,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Is it the client\u0027s responsibility to reconnect in this case I assume? If so, maybe what a client should do should be called out in the block comment at the top of the file? Is reconnecting immediately the best choice? I assume one case here is if the vminfod service crashes or otherwise restarts while a client is streaming... Hopefully those are not common cases, but for correctness we should make sure clients handling that."},{"file":"src/vm/node_modules/vminfod/client.js","line":403,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Right now there is 0 handling for that as the daemon *should* never crash.  If it does currently, pretty much everything relying on it goes down with it.\n\nWhat do you think the proper way to handle the daemon dying is?"},{"file":"src/vm/node_modules/vminfod/client.js","line":403,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"To me, it would seem that we\u0027d want to retry but perhaps some sort of backoff? I don\u0027t know what point we\u0027d want to give up... Probably never because there\u0027s no clearly correct thing to do. If the daemon crashes and all clients are hung waiting on it, hopefully that\u0027ll make it very obvious quickly what the problem is."},{"file":"src/vm/node_modules/vminfod/client.js","line":503,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Since this is not part of the API and not used outside this file, maybe use the name _exhaustEvents to indicate that it\u0027s not something that should be used? I\u0027m not sure \"exhaust\" is the best name here either. Perhaps consider _clearEvents?"},{"file":"src/vm/node_modules/vminfod/client.js","line":503,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Agreed with both of these, thanks."},{"file":"src/vm/node_modules/vminfod/client.js","line":753,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"I think \"readable\" is a confusing name here. Perhaps processEvents?"},{"file":"src/vm/node_modules/vminfod/client.js","line":753,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Done"},{"file":"src/vm/node_modules/vminfod/client.js","line":760,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Is there a reason most multi-word functions are using camelCase but this one is not? processChange below for example or watchForChanges above make me think this would be called processEvent."},{"file":"src/vm/node_modules/vminfod/client.js","line":760,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"So, the *actual* reason is I probably wrote `processevent` a year or two ago when I wasn\u0027t using the standard camelCase\u0027ing :p.  I\u0027ll change it to be consistent."},{"file":"src/vm/node_modules/vminfod/client.js","line":772,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Suggestion: using the name \"expectedChange\" instead of \"change\" here might make it clearer what\u0027s going on. It\u0027s otherwise not obvious what the difference between a change or an event is until one reads the whole block comment here and even then I had to double-check that my understanding was correct and things weren\u0027t just accidentally misnamed here."},{"file":"src/vm/node_modules/vminfod/client.js","line":772,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"OK, i\u0027ll rename the changes so it\u0027s clear what we \"want\" vs what we actually received."},{"file":"src/vm/node_modules/vminfod/client.js","line":793,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"This is another place where it seems like it would be good to move the variable declaration to the top of their scope to limit confusion."},{"file":"src/vm/node_modules/vminfod/client.js","line":793,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"If only JavaScript had some good way to break out of a `forEach`....  Agreed, i\u0027ll make the change."},{"file":"src/vm/node_modules/vminfod/vminfod.js","line":102,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Does this mean that if vminfod is restarted, the last_modified can go backward? I wonder if that causes problems for anything.\n\nThe only way I can think to work around this would be to \"touch\" the xml file whenever we bump the last_modified, so that on startup when we first load the VM we\u0027ll start with the same last_modified as we had before."},{"file":"src/vm/node_modules/vminfod/vminfod.js","line":102,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Any further thoughts here?"},{"file":"src/vm/node_modules/vminfod/vminfod.js","line":102,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"I have removed all of the `last_modified` logic from vminfod completely - it will no longer be a special value that is modified manually by the daemon.  Instead, vminfod will just pull the value from the vmload logic."},{"file":"src/vm/node_modules/vminfod/vminfod.js","line":135,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Have you seen this happen in your testing?"},{"file":"src/vm/node_modules/vminfod/vminfod.js","line":135,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"?"},{"file":"src/vm/node_modules/vminfod/vminfod.js","line":135,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Yes.  I have seen the cache objects are different, but i have NEVER seen the vmobjs generated as a result of the cache objects being different.\n\nBasically, if the system is being used (like during the test suite running), it\u0027s possible that the full load will show some ZFS snapshots that weren\u0027t seen by vminfod (i\u0027m not sure why yet, this is very rare).  However, there is no changes to the actual vmobj blobs as a result. \n\n\n vminfo status -f  | json refresh_errors refresh_log\n\n\nrefresh_errors hold any error messages from vminfod failing to do a full refresh and refresh_log shows any refreshes that resulted in the cache or the vmobjects being different."},{"file":"src/vm/node_modules/vminfod/vminfod.js","line":464,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"How long does this typically take?"},{"file":"src/vm/node_modules/vminfod/vminfod.js","line":464,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"~5s on emy-12... this could take minutes though (when Isaac was testing).  It grows with the number of VMs"},{"file":"src/vm/node_modules/vminfod/vminfod.js","line":855,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"It might be worth creating a ticket (not to be done now) for exposing this data using artedi as well so that it can be monitored with our monitoring systems to detect problems.\n\nSince the data\u0027s already here, that should be pretty simple.\n\nLooking at this data on a live system, it looks like it\u0027s going to be really helpful!"},{"file":"src/vm/node_modules/vminfod/vminfod.js","line":1232,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"It looks like this function fails to call cb2, and instead calls cb. That seems like a bug. Does that mean the next function here in the pipeline is never run by any tests?"},{"file":"src/vm/node_modules/vminfod/vminfod.js","line":1232,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"This *has* to be a bug - there\u0027s no way I intended this."},{"file":"src/vm/node_modules/vminfod/vminfod.js","line":1943,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"I think \"teardown\" here might be misleading. We\u0027re just removing the object from the cache, right?"},{"file":"src/vm/node_modules/vminfod/vminfod.js","line":1943,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"ha, this comment predates me https://github.com/joyent/smartos-live/blob/OS-2647/src/vm/node_modules/vmevent/vminfo.js#L419\n\n\nI\u0027ll remove it."},{"file":"src/vm/node_modules/vminfod/vminfod.js","line":1943,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"thanks!"},{"file":"src/vm/node_modules/vminfod/vminfod.js","line":2367,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"There\u0027s already an isUUID function in src/vm/node_modules/utils.js, is there some reason not to use that one?"},{"file":"src/vm/node_modules/vminfod/vminfod.js","line":2367,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"ah, will use that instead."},{"file":"src/vm/node_modules/vminfod/zpoolwatcher.js","line":102,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"once again it would be nice imo to declare variables at the top of their scope rather than hidden in some nesting. But ¯\\_(ツ)_/¯"},{"file":"src/vm/node_modules/vminfod/zpoolwatcher.js","line":102,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"I can do that."},{"file":"src/vm/node_modules/vmload/dump-json.js","line":87,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"fyi: I think you could also use assert.ifError(err) here. If you:\n\n    var assert \u003d require(\u0027assert-plus\u0027);"},{"file":"src/vm/node_modules/vmload/dump-json.js","line":87,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"cool, will do - this is just the same logic that\u0027s already there but i\u0027ll make the change."},{"file":"src/vm/node_modules/vmload/index.js","line":677,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"following the reformatting you were doing elsewhere, should this be:\n\n    if () {\n        ...\n        cb();\n        return;\n    }\n    new_err \u003d ...\n    ...\n\n?"},{"file":"src/vm/node_modules/vmload/index.js","line":677,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"yes.\n\nSo, my intention wasn\u0027t to reformat everything like that, but it just so happened as I was testing over the months I found it easier to follow the flow of the code like that, and also avoid and weird possibilities of double callbacks.\n\nBasically, the diff on this CR will sometimes make it look like i *only* reformatted sections to look like that, when in reality they\u0027ve gone through many iterations and had been rewritten only to be un-rewritten :p.  But yes, I prefer that style and it cuts down on a level of indentation so I\u0027ll change it."},{"file":"src/vm/node_modules/vmload/index.js","line":1628,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"would https://github.com/joyent/node-jsprim#deepcopyobj work here?"},{"file":"src/vm/node_modules/vmload/index.js","line":1628,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"I think so - I\u0027ll test that out.  If it doesn\u0027t for some reason, i\u0027ll document that in a block comment above this function."},{"file":"src/vm/node_modules/vmload/index.js","line":1628,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"any update on this?"},{"file":"src/vm/node_modules/vmload/index.js","line":1628,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Will be in next patchset"},{"file":"src/vm/sbin/vminfod.js","line":56,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Why are we doing this? This seems like a very bad idea since it eliminates the value of:\n\n    --abort_on_uncaught_exception"},{"file":"src/vm/sbin/vminfod.js","line":56,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"predates me in the OS-2647 branch - I\u0027ll *happily* remove it to let the process run its normal course if it has an uncaught exception."},{"file":"src/vm/sbin/vminfod.js","line":56,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"I\u0027m a bit confused. Gerrit is showing that this whole file was deleted. Was that intentional?"},{"file":"src/vm/sbin/vminfod.js","line":56,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"I\u0027m not sure how that happened."},{"file":"src/vm/tests/test-fswatcher.js","line":52,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"maybe switch to assert-plus and use assert.ifError(err)?"},{"file":"src/vm/tests/test-fswatcher.js","line":52,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Agreed."},{"file":"src/vm/tests/test-fswatcher.js","line":109,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"is the extra line here intentional?"},{"file":"src/vm/tests/test-fswatcher.js","line":109,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"No! good catch :)\n\nI personally don\u0027t use more than one blank line, so any extra newline by me is a mistake."},{"file":"src/vm/tests/test-queue.js","line":58,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"If somehow a task ran more than once, this would not be caught here. Is that fine? We\u0027d happily call cb() 101+ times if there were such a bug."},{"file":"src/vm/tests/test-queue.js","line":58,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Good catch.  I\u0027ll add some logic to detect an extra task being ran after the 100th task and throw an error."},{"file":"src/vm/tests/test-zonewatcher.js","line":40,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"why is this indented an extra level?"},{"file":"src/vm/tests/test-zonewatcher.js","line":40,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"No idea - will fix."},{"file":"src/vminfod.js","line":281,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Is there a ticket that explains this problem? Might be worth linking to that here."},{"file":"src/vminfod.js","line":281,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"wow! funny story - I changed this and had completely forgot haha https://github.com/davepacheco/node-getopt/commit/a13c791d0252d4d9a66eed39e9bfe5cd983a8260.  I\u0027ll link to that in the file as a comment."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"src/Makefile","type":"MODIFIED","insertions":22,"deletions":-6},{"file":"src/fswatcher.c","type":"ADDED","insertions":1024,"deletions":0},{"file":"src/manifest","type":"MODIFIED","insertions":15,"deletions":-1},{"file":"src/vm/common/vmtest.js","type":"MODIFIED","insertions":31,"deletions":-7},{"file":"src/vm/lib/metadata/agent.js","type":"MODIFIED","insertions":235,"deletions":-829},{"file":"src/vm/lib/metadata/zwatch.js","type":"DELETED","insertions":0,"deletions":-64},{"file":"src/vm/man/vmadm.1m.md","type":"MODIFIED","insertions":11,"deletions":0},{"file":"src/vm/node_modules/VM.js","type":"MODIFIED","insertions":3354,"deletions":-1720},{"file":"src/vm/node_modules/diff.js","type":"ADDED","insertions":505,"deletions":0},{"file":"src/vm/node_modules/expander.js","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"src/vm/node_modules/fswatcher.js","type":"ADDED","insertions":927,"deletions":0},{"file":"src/vm/node_modules/proptable.js","type":"MODIFIED","insertions":38,"deletions":-18},{"file":"src/vm/node_modules/queue.js","type":"ADDED","insertions":515,"deletions":0},{"file":"src/vm/node_modules/vminfod/client.js","type":"ADDED","insertions":1052,"deletions":0},{"file":"src/vm/node_modules/vminfod/vminfod.js","type":"ADDED","insertions":2374,"deletions":0},{"file":"src/vm/node_modules/vminfod/zonewatcher.js","type":"ADDED","insertions":76,"deletions":0},{"file":"src/vm/node_modules/vminfod/zpoolwatcher.js","type":"ADDED","insertions":119,"deletions":0},{"file":"src/vm/node_modules/vmload/dump-json.js","type":"MODIFIED","insertions":33,"deletions":-31},{"file":"src/vm/node_modules/vmload/dump-vmobjs.js","type":"MODIFIED","insertions":4,"deletions":-5},{"file":"src/vm/node_modules/vmload/dump-zonexml.js","type":"MODIFIED","insertions":7,"deletions":-4},{"file":"src/vm/node_modules/vmload/index.js","type":"MODIFIED","insertions":524,"deletions":-412},{"file":"src/vm/node_modules/vmload/vmload-datasets.js","type":"MODIFIED","insertions":22,"deletions":-12},{"file":"src/vm/node_modules/vmload/vmload-json.js","type":"MODIFIED","insertions":11,"deletions":-7},{"file":"src/vm/node_modules/vmload/vmload-zoneadm.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"src/vm/node_modules/zoneevent.js","type":"ADDED","insertions":177,"deletions":0},{"file":"src/vm/sbin/vmadm.js","type":"MODIFIED","insertions":106,"deletions":-2},{"file":"src/vm/sbin/vmadmd.js","type":"MODIFIED","insertions":17,"deletions":-22},{"file":"src/vm/sbin/vminfod.js","type":"ADDED","insertions":80,"deletions":0},{"file":"src/vm/smf/system-metadata.xml","type":"MODIFIED","insertions":4,"deletions":0},{"file":"src/vm/smf/system-vmadmd.xml","type":"MODIFIED","insertions":4,"deletions":0},{"file":"src/vm/smf/system-vminfod","type":"ADDED","insertions":49,"deletions":0},{"file":"src/vm/smf/system-vminfod.xml","type":"ADDED","insertions":47,"deletions":0},{"file":"src/vm/tests/test-defaults.js","type":"MODIFIED","insertions":48,"deletions":-6},{"file":"src/vm/tests/test-delete.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"src/vm/tests/test-diff.js","type":"ADDED","insertions":262,"deletions":0},{"file":"src/vm/tests/test-docker.js","type":"MODIFIED","insertions":100,"deletions":-59},{"file":"src/vm/tests/test-fswatcher.js","type":"ADDED","insertions":525,"deletions":0},{"file":"src/vm/tests/test-internal_metadata_namespaces.js","type":"MODIFIED","insertions":86,"deletions":-22},{"file":"src/vm/tests/test-lastexited.js","type":"MODIFIED","insertions":48,"deletions":-20},{"file":"src/vm/tests/test-queue.js","type":"ADDED","insertions":265,"deletions":0},{"file":"src/vm/tests/test-send-recv.js","type":"MODIFIED","insertions":215,"deletions":-131},{"file":"src/vm/tests/test-update.js","type":"MODIFIED","insertions":94,"deletions":-58},{"file":"src/vm/tests/test-vminfod.js","type":"ADDED","insertions":42,"deletions":0},{"file":"src/vm/tests/test-zonewatcher.js","type":"ADDED","insertions":183,"deletions":0},{"file":"src/vm/tests/test-zpoolwatcher.js","type":"ADDED","insertions":144,"deletions":0},{"file":"src/vminfod.js","type":"ADDED","insertions":315,"deletions":0},{"file":"src/zoneevent.c","type":"DELETED","insertions":0,"deletions":-144},{"file":"src/zoneevent.js","type":"ADDED","insertions":108,"deletions":0}],"sizeInsertions":13827,"sizeDeletions":-3584},{"number":"9","revision":"ea27f877162e77f9ec37a18d522a413c9e837861","parents":["7f2f38edaf7f2a1e9428ce842081e097c9b3b342"],"ref":"refs/changes/82/2782/9","uploader":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"createdOn":1516210839,"author":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1516210886,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"src/vm/node_modules/vasync/package.json","line":27,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"ooc: what sets this?"},{"file":"src/vm/node_modules/vasync/package.json","line":27,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"npm... i used `npm install` to pull in the package."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"src/Makefile","type":"MODIFIED","insertions":21,"deletions":-6},{"file":"src/fswatcher.c","type":"ADDED","insertions":1024,"deletions":0},{"file":"src/manifest","type":"MODIFIED","insertions":16,"deletions":-1},{"file":"src/vm/common/vmtest.js","type":"MODIFIED","insertions":31,"deletions":-7},{"file":"src/vm/lib/metadata/agent.js","type":"MODIFIED","insertions":214,"deletions":-722},{"file":"src/vm/lib/metadata/zwatch.js","type":"DELETED","insertions":0,"deletions":-64},{"file":"src/vm/man/vmadm.1m.md","type":"MODIFIED","insertions":12,"deletions":0},{"file":"src/vm/node_modules/VM.js","type":"MODIFIED","insertions":3356,"deletions":-1741},{"file":"src/vm/node_modules/diff.js","type":"ADDED","insertions":505,"deletions":0},{"file":"src/vm/node_modules/expander.js","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"src/vm/node_modules/fswatcher.js","type":"ADDED","insertions":927,"deletions":0},{"file":"src/vm/node_modules/proptable.js","type":"MODIFIED","insertions":38,"deletions":-18},{"file":"src/vm/node_modules/queue.js","type":"ADDED","insertions":515,"deletions":0},{"file":"src/vm/node_modules/vasync/package.json","type":"MODIFIED","insertions":1,"deletions":0},{"file":"src/vm/node_modules/vminfod/client.js","type":"ADDED","insertions":1090,"deletions":0},{"file":"src/vm/node_modules/vminfod/vminfod.js","type":"ADDED","insertions":2391,"deletions":0},{"file":"src/vm/node_modules/vminfod/zonewatcher.js","type":"ADDED","insertions":76,"deletions":0},{"file":"src/vm/node_modules/vminfod/zpoolwatcher.js","type":"ADDED","insertions":121,"deletions":0},{"file":"src/vm/node_modules/vmload/dump-json.js","type":"MODIFIED","insertions":32,"deletions":-31},{"file":"src/vm/node_modules/vmload/dump-vmobjs.js","type":"MODIFIED","insertions":4,"deletions":-5},{"file":"src/vm/node_modules/vmload/dump-zonexml.js","type":"MODIFIED","insertions":7,"deletions":-4},{"file":"src/vm/node_modules/vmload/index.js","type":"MODIFIED","insertions":519,"deletions":-405},{"file":"src/vm/node_modules/vmload/vmload-datasets.js","type":"MODIFIED","insertions":22,"deletions":-12},{"file":"src/vm/node_modules/vmload/vmload-json.js","type":"MODIFIED","insertions":11,"deletions":-7},{"file":"src/vm/node_modules/vmload/vmload-zoneadm.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"src/vm/node_modules/zoneevent.js","type":"ADDED","insertions":180,"deletions":0},{"file":"src/vm/sbin/vmadm.js","type":"MODIFIED","insertions":106,"deletions":-2},{"file":"src/vm/sbin/vmadmd.js","type":"MODIFIED","insertions":17,"deletions":-22},{"file":"src/vm/sbin/vminfo.js","type":"ADDED","insertions":318,"deletions":0},{"file":"src/vm/smf/system-metadata.xml","type":"MODIFIED","insertions":4,"deletions":0},{"file":"src/vm/smf/system-vmadmd.xml","type":"MODIFIED","insertions":4,"deletions":0},{"file":"src/vm/smf/system-vminfod","type":"ADDED","insertions":49,"deletions":0},{"file":"src/vm/smf/system-vminfod.xml","type":"ADDED","insertions":47,"deletions":0},{"file":"src/vm/tests/test-defaults.js","type":"MODIFIED","insertions":48,"deletions":-6},{"file":"src/vm/tests/test-delete.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"src/vm/tests/test-diff.js","type":"ADDED","insertions":262,"deletions":0},{"file":"src/vm/tests/test-docker.js","type":"MODIFIED","insertions":102,"deletions":-60},{"file":"src/vm/tests/test-fswatcher.js","type":"ADDED","insertions":524,"deletions":0},{"file":"src/vm/tests/test-internal_metadata_namespaces.js","type":"MODIFIED","insertions":86,"deletions":-22},{"file":"src/vm/tests/test-lastexited.js","type":"MODIFIED","insertions":48,"deletions":-20},{"file":"src/vm/tests/test-queue.js","type":"ADDED","insertions":277,"deletions":0},{"file":"src/vm/tests/test-send-recv.js","type":"MODIFIED","insertions":215,"deletions":-131},{"file":"src/vm/tests/test-update.js","type":"MODIFIED","insertions":94,"deletions":-58},{"file":"src/vm/tests/test-vminfod.js","type":"ADDED","insertions":42,"deletions":0},{"file":"src/vm/tests/test-zonewatcher.js","type":"ADDED","insertions":183,"deletions":0},{"file":"src/vm/tests/test-zpoolwatcher.js","type":"ADDED","insertions":144,"deletions":0},{"file":"src/vminfod.js","type":"ADDED","insertions":315,"deletions":0},{"file":"src/zoneevent.c","type":"DELETED","insertions":0,"deletions":-144},{"file":"src/zoneevent.js","type":"ADDED","insertions":145,"deletions":0}],"sizeInsertions":14152,"sizeDeletions":-3492},{"number":"10","revision":"8456a510e11c815dc35eca35fef76eb216661acd","parents":["feed8677b44d3508bc39e838bfb6aafcf66b1cfd"],"ref":"refs/changes/82/2782/10","uploader":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"createdOn":1518200261,"author":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1518200309,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"src/Makefile","type":"MODIFIED","insertions":23,"deletions":-6},{"file":"src/fswatcher.c","type":"ADDED","insertions":1024,"deletions":0},{"file":"src/manifest","type":"MODIFIED","insertions":16,"deletions":-1},{"file":"src/vm/common/vmtest.js","type":"MODIFIED","insertions":31,"deletions":-7},{"file":"src/vm/lib/metadata/agent.js","type":"MODIFIED","insertions":214,"deletions":-722},{"file":"src/vm/lib/metadata/zwatch.js","type":"DELETED","insertions":0,"deletions":-64},{"file":"src/vm/man/vmadm.1m.md","type":"MODIFIED","insertions":12,"deletions":0},{"file":"src/vm/node_modules/VM.js","type":"MODIFIED","insertions":3685,"deletions":-1983},{"file":"src/vm/node_modules/diff.js","type":"ADDED","insertions":505,"deletions":0},{"file":"src/vm/node_modules/expander.js","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"src/vm/node_modules/fswatcher.js","type":"ADDED","insertions":927,"deletions":0},{"file":"src/vm/node_modules/proptable.js","type":"MODIFIED","insertions":38,"deletions":-18},{"file":"src/vm/node_modules/queue.js","type":"ADDED","insertions":515,"deletions":0},{"file":"src/vm/node_modules/sysevent-stream.js","type":"MODIFIED","insertions":13,"deletions":-3},{"file":"src/vm/node_modules/vasync/package.json","type":"MODIFIED","insertions":1,"deletions":0},{"file":"src/vm/node_modules/vminfod/client.js","type":"ADDED","insertions":1090,"deletions":0},{"file":"src/vm/node_modules/vminfod/vminfod.js","type":"ADDED","insertions":2369,"deletions":0},{"file":"src/vm/node_modules/vminfod/zonewatcher.js","type":"ADDED","insertions":82,"deletions":0},{"file":"src/vm/node_modules/vminfod/zpoolwatcher.js","type":"ADDED","insertions":121,"deletions":0},{"file":"src/vm/node_modules/vmload/dump-json.js","type":"MODIFIED","insertions":32,"deletions":-31},{"file":"src/vm/node_modules/vmload/dump-vmobjs.js","type":"MODIFIED","insertions":4,"deletions":-5},{"file":"src/vm/node_modules/vmload/dump-zonexml.js","type":"MODIFIED","insertions":7,"deletions":-4},{"file":"src/vm/node_modules/vmload/index.js","type":"MODIFIED","insertions":519,"deletions":-405},{"file":"src/vm/node_modules/vmload/vmload-datasets.js","type":"MODIFIED","insertions":22,"deletions":-12},{"file":"src/vm/node_modules/vmload/vmload-json.js","type":"MODIFIED","insertions":11,"deletions":-7},{"file":"src/vm/node_modules/vmload/vmload-zoneadm.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"src/vm/node_modules/zoneevent.js","type":"ADDED","insertions":180,"deletions":0},{"file":"src/vm/sbin/vmadm.js","type":"MODIFIED","insertions":106,"deletions":-2},{"file":"src/vm/sbin/vmadmd.js","type":"MODIFIED","insertions":17,"deletions":-22},{"file":"src/vm/sbin/vminfo.js","type":"ADDED","insertions":318,"deletions":0},{"file":"src/vm/smf/system-metadata.xml","type":"MODIFIED","insertions":4,"deletions":0},{"file":"src/vm/smf/system-vmadmd.xml","type":"MODIFIED","insertions":4,"deletions":0},{"file":"src/vm/smf/system-vminfod","type":"ADDED","insertions":49,"deletions":0},{"file":"src/vm/smf/system-vminfod.xml","type":"ADDED","insertions":47,"deletions":0},{"file":"src/vm/tests/common.js","type":"ADDED","insertions":124,"deletions":0},{"file":"src/vm/tests/test-defaults.js","type":"MODIFIED","insertions":48,"deletions":-6},{"file":"src/vm/tests/test-delete.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"src/vm/tests/test-diff.js","type":"ADDED","insertions":262,"deletions":0},{"file":"src/vm/tests/test-docker.js","type":"MODIFIED","insertions":102,"deletions":-60},{"file":"src/vm/tests/test-fswatcher.js","type":"ADDED","insertions":524,"deletions":0},{"file":"src/vm/tests/test-internal_metadata_namespaces.js","type":"MODIFIED","insertions":86,"deletions":-22},{"file":"src/vm/tests/test-lastexited.js","type":"MODIFIED","insertions":48,"deletions":-20},{"file":"src/vm/tests/test-queue.js","type":"ADDED","insertions":277,"deletions":0},{"file":"src/vm/tests/test-send-recv.js","type":"MODIFIED","insertions":215,"deletions":-131},{"file":"src/vm/tests/test-update.js","type":"MODIFIED","insertions":94,"deletions":-58},{"file":"src/vm/tests/test-vminfod-zonewatcher-overflow.js","type":"ADDED","insertions":308,"deletions":0},{"file":"src/vm/tests/test-vminfod-zonewatcher.js","type":"ADDED","insertions":123,"deletions":0},{"file":"src/vm/tests/test-vminfod-zpoolwatcher.js","type":"ADDED","insertions":131,"deletions":0},{"file":"src/vm/tests/test-vminfod.js","type":"ADDED","insertions":42,"deletions":0},{"file":"src/vminfod.js","type":"ADDED","insertions":315,"deletions":0},{"file":"src/zoneevent.c","type":"DELETED","insertions":0,"deletions":-144},{"file":"src/zoneevent.js","type":"ADDED","insertions":145,"deletions":0}],"sizeInsertions":14839,"sizeDeletions":-3737},{"number":"11","revision":"d7bf4de1270d7cc8f2736f5336487a327412b737","parents":["987ab9a0c79fc3cc7aee901b4fb876ab1885434e"],"ref":"refs/changes/82/2782/11","uploader":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"createdOn":1519924237,"author":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1520474297,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"src/Makefile","type":"MODIFIED","insertions":23,"deletions":-6},{"file":"src/fswatcher.c","type":"ADDED","insertions":1024,"deletions":0},{"file":"src/manifest","type":"MODIFIED","insertions":47,"deletions":-1},{"file":"src/vm/common/vmtest.js","type":"MODIFIED","insertions":31,"deletions":-7},{"file":"src/vm/lib/metadata/agent.js","type":"MODIFIED","insertions":214,"deletions":-782},{"file":"src/vm/lib/metadata/zwatch.js","type":"DELETED","insertions":0,"deletions":-64},{"file":"src/vm/man/vmadm.1m.md","type":"MODIFIED","insertions":12,"deletions":0},{"file":"src/vm/node_modules/VM.js","type":"MODIFIED","insertions":3688,"deletions":-1986},{"file":"src/vm/node_modules/diff.js","type":"ADDED","insertions":505,"deletions":0},{"file":"src/vm/node_modules/expander.js","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"src/vm/node_modules/fswatcher.js","type":"ADDED","insertions":943,"deletions":0},{"file":"src/vm/node_modules/jsprim/LICENSE","type":"ADDED","insertions":19,"deletions":0},{"file":"src/vm/node_modules/jsprim/lib/jsprim.js","type":"ADDED","insertions":735,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/assert-plus/assert.js","type":"ADDED","insertions":211,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/assert-plus/package.json","type":"ADDED","insertions":82,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/extsprintf/LICENSE","type":"ADDED","insertions":19,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/extsprintf/lib/extsprintf.js","type":"ADDED","insertions":183,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/extsprintf/package.json","type":"ADDED","insertions":41,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/json-schema/README.md","type":"ADDED","insertions":5,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/json-schema/lib/links.js","type":"ADDED","insertions":66,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/json-schema/lib/validate.js","type":"ADDED","insertions":273,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/json-schema/package.json","type":"ADDED","insertions":65,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/LICENSE","type":"ADDED","insertions":19,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/lib/verror.js","type":"ADDED","insertions":451,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/node_modules/core-util-is/LICENSE","type":"ADDED","insertions":19,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/node_modules/core-util-is/lib/util.js","type":"ADDED","insertions":107,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/node_modules/core-util-is/package.json","type":"ADDED","insertions":59,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/package.json","type":"ADDED","insertions":50,"deletions":0},{"file":"src/vm/node_modules/jsprim/package.json","type":"ADDED","insertions":51,"deletions":0},{"file":"src/vm/node_modules/proptable.js","type":"MODIFIED","insertions":38,"deletions":-18},{"file":"src/vm/node_modules/queue.js","type":"ADDED","insertions":515,"deletions":0},{"file":"src/vm/node_modules/sysevent-stream.js","type":"MODIFIED","insertions":13,"deletions":-3},{"file":"src/vm/node_modules/vasync/package.json","type":"MODIFIED","insertions":1,"deletions":0},{"file":"src/vm/node_modules/vminfod/client.js","type":"ADDED","insertions":1090,"deletions":0},{"file":"src/vm/node_modules/vminfod/vminfod.js","type":"ADDED","insertions":2369,"deletions":0},{"file":"src/vm/node_modules/vminfod/zonewatcher.js","type":"ADDED","insertions":82,"deletions":0},{"file":"src/vm/node_modules/vminfod/zpoolwatcher.js","type":"ADDED","insertions":121,"deletions":0},{"file":"src/vm/node_modules/vmload/dump-json.js","type":"MODIFIED","insertions":32,"deletions":-31},{"file":"src/vm/node_modules/vmload/dump-vmobjs.js","type":"MODIFIED","insertions":4,"deletions":-5},{"file":"src/vm/node_modules/vmload/dump-zonexml.js","type":"MODIFIED","insertions":7,"deletions":-4},{"file":"src/vm/node_modules/vmload/index.js","type":"MODIFIED","insertions":499,"deletions":-405},{"file":"src/vm/node_modules/vmload/vmload-datasets.js","type":"MODIFIED","insertions":22,"deletions":-12},{"file":"src/vm/node_modules/vmload/vmload-json.js","type":"MODIFIED","insertions":11,"deletions":-7},{"file":"src/vm/node_modules/vmload/vmload-zoneadm.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"src/vm/node_modules/zoneevent.js","type":"ADDED","insertions":180,"deletions":0},{"file":"src/vm/sbin/vmadm.js","type":"MODIFIED","insertions":106,"deletions":-2},{"file":"src/vm/sbin/vmadmd.js","type":"MODIFIED","insertions":17,"deletions":-22},{"file":"src/vm/sbin/vminfo.js","type":"ADDED","insertions":318,"deletions":0},{"file":"src/vm/sbin/vminfod.js","type":"ADDED","insertions":65,"deletions":0},{"file":"src/vm/smf/system-metadata.xml","type":"MODIFIED","insertions":4,"deletions":0},{"file":"src/vm/smf/system-vmadmd.xml","type":"MODIFIED","insertions":4,"deletions":0},{"file":"src/vm/smf/system-vminfod","type":"ADDED","insertions":49,"deletions":0},{"file":"src/vm/smf/system-vminfod.xml","type":"ADDED","insertions":47,"deletions":0},{"file":"src/vm/tests/common.js","type":"ADDED","insertions":124,"deletions":0},{"file":"src/vm/tests/test-defaults.js","type":"MODIFIED","insertions":48,"deletions":-6},{"file":"src/vm/tests/test-delete.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"src/vm/tests/test-diff.js","type":"ADDED","insertions":262,"deletions":0},{"file":"src/vm/tests/test-docker.js","type":"MODIFIED","insertions":102,"deletions":-60},{"file":"src/vm/tests/test-fswatcher.js","type":"ADDED","insertions":524,"deletions":0},{"file":"src/vm/tests/test-internal_metadata_namespaces.js","type":"MODIFIED","insertions":86,"deletions":-22},{"file":"src/vm/tests/test-lastexited.js","type":"MODIFIED","insertions":48,"deletions":-20},{"file":"src/vm/tests/test-queue.js","type":"ADDED","insertions":277,"deletions":0},{"file":"src/vm/tests/test-send-recv.js","type":"MODIFIED","insertions":215,"deletions":-131},{"file":"src/vm/tests/test-update.js","type":"MODIFIED","insertions":94,"deletions":-58},{"file":"src/vm/tests/test-vminfod-zonewatcher-overflow.js","type":"ADDED","insertions":308,"deletions":0},{"file":"src/vm/tests/test-vminfod-zonewatcher.js","type":"ADDED","insertions":123,"deletions":0},{"file":"src/vm/tests/test-vminfod-zpoolwatcher.js","type":"ADDED","insertions":131,"deletions":0},{"file":"src/vm/tests/test-vminfod.js","type":"ADDED","insertions":42,"deletions":0},{"file":"src/vminfod.js","type":"ADDED","insertions":315,"deletions":0},{"file":"src/zoneevent.c","type":"DELETED","insertions":0,"deletions":-144},{"file":"src/zoneevent.js","type":"ADDED","insertions":145,"deletions":0}],"sizeInsertions":17389,"sizeDeletions":-3800},{"number":"12","revision":"d47ab2134dffc55a6f815737bec0eaa19b115e63","parents":["c6f5e9955adbc45688074ab1b8cac5d340262c56"],"ref":"refs/changes/82/2782/12","uploader":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"createdOn":1523289147,"author":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1523978806,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"src/vm/sbin/vmadmd.js","line":972,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"space after +?"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"src/Makefile","type":"MODIFIED","insertions":24,"deletions":-7},{"file":"src/fswatcher.c","type":"ADDED","insertions":1031,"deletions":0},{"file":"src/manifest","type":"MODIFIED","insertions":47,"deletions":-1},{"file":"src/vm/common/vmtest.js","type":"MODIFIED","insertions":31,"deletions":-7},{"file":"src/vm/lib/metadata/agent.js","type":"MODIFIED","insertions":236,"deletions":-808},{"file":"src/vm/lib/metadata/zwatch.js","type":"DELETED","insertions":0,"deletions":-64},{"file":"src/vm/man/vmadm.1m.md","type":"MODIFIED","insertions":12,"deletions":0},{"file":"src/vm/node_modules/VM.js","type":"MODIFIED","insertions":3955,"deletions":-2055},{"file":"src/vm/node_modules/diff.js","type":"ADDED","insertions":505,"deletions":0},{"file":"src/vm/node_modules/expander.js","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"src/vm/node_modules/fswatcher.js","type":"ADDED","insertions":943,"deletions":0},{"file":"src/vm/node_modules/jsprim/LICENSE","type":"ADDED","insertions":19,"deletions":0},{"file":"src/vm/node_modules/jsprim/lib/jsprim.js","type":"ADDED","insertions":735,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/assert-plus/assert.js","type":"ADDED","insertions":211,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/assert-plus/package.json","type":"ADDED","insertions":82,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/extsprintf/LICENSE","type":"ADDED","insertions":19,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/extsprintf/lib/extsprintf.js","type":"ADDED","insertions":183,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/extsprintf/package.json","type":"ADDED","insertions":41,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/json-schema/README.md","type":"ADDED","insertions":5,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/json-schema/lib/links.js","type":"ADDED","insertions":66,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/json-schema/lib/validate.js","type":"ADDED","insertions":273,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/json-schema/package.json","type":"ADDED","insertions":65,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/LICENSE","type":"ADDED","insertions":19,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/lib/verror.js","type":"ADDED","insertions":451,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/node_modules/core-util-is/LICENSE","type":"ADDED","insertions":19,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/node_modules/core-util-is/lib/util.js","type":"ADDED","insertions":107,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/node_modules/core-util-is/package.json","type":"ADDED","insertions":59,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/package.json","type":"ADDED","insertions":50,"deletions":0},{"file":"src/vm/node_modules/jsprim/package.json","type":"ADDED","insertions":51,"deletions":0},{"file":"src/vm/node_modules/proptable.js","type":"MODIFIED","insertions":38,"deletions":-18},{"file":"src/vm/node_modules/queue.js","type":"ADDED","insertions":589,"deletions":0},{"file":"src/vm/node_modules/sysevent-stream.js","type":"MODIFIED","insertions":13,"deletions":-3},{"file":"src/vm/node_modules/vasync/package.json","type":"MODIFIED","insertions":1,"deletions":0},{"file":"src/vm/node_modules/vminfod/client.js","type":"ADDED","insertions":1112,"deletions":0},{"file":"src/vm/node_modules/vminfod/vminfod.js","type":"ADDED","insertions":2446,"deletions":0},{"file":"src/vm/node_modules/vminfod/zonewatcher.js","type":"ADDED","insertions":82,"deletions":0},{"file":"src/vm/node_modules/vminfod/zpoolwatcher.js","type":"ADDED","insertions":121,"deletions":0},{"file":"src/vm/node_modules/vmload/dump-json.js","type":"MODIFIED","insertions":32,"deletions":-31},{"file":"src/vm/node_modules/vmload/dump-vmobjs.js","type":"MODIFIED","insertions":4,"deletions":-5},{"file":"src/vm/node_modules/vmload/dump-zonexml.js","type":"MODIFIED","insertions":7,"deletions":-4},{"file":"src/vm/node_modules/vmload/index.js","type":"MODIFIED","insertions":503,"deletions":-409},{"file":"src/vm/node_modules/vmload/vmload-datasets.js","type":"MODIFIED","insertions":22,"deletions":-12},{"file":"src/vm/node_modules/vmload/vmload-json.js","type":"MODIFIED","insertions":11,"deletions":-7},{"file":"src/vm/node_modules/vmload/vmload-zoneadm.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"src/vm/node_modules/zoneevent.js","type":"ADDED","insertions":182,"deletions":0},{"file":"src/vm/runtests","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"src/vm/sbin/vmadm.js","type":"MODIFIED","insertions":117,"deletions":-2},{"file":"src/vm/sbin/vmadmd.js","type":"MODIFIED","insertions":18,"deletions":-23},{"file":"src/vm/sbin/vminfo.js","type":"ADDED","insertions":318,"deletions":0},{"file":"src/vm/sbin/vminfod.js","type":"ADDED","insertions":68,"deletions":0},{"file":"src/vm/smf/system-metadata.xml","type":"MODIFIED","insertions":4,"deletions":0},{"file":"src/vm/smf/system-vmadmd.xml","type":"MODIFIED","insertions":4,"deletions":0},{"file":"src/vm/smf/system-vminfod","type":"ADDED","insertions":53,"deletions":0},{"file":"src/vm/smf/system-vminfod.xml","type":"ADDED","insertions":47,"deletions":0},{"file":"src/vm/tests/common.js","type":"ADDED","insertions":129,"deletions":0},{"file":"src/vm/tests/test-defaults.js","type":"MODIFIED","insertions":73,"deletions":-9},{"file":"src/vm/tests/test-delete.js","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"src/vm/tests/test-diff.js","type":"ADDED","insertions":262,"deletions":0},{"file":"src/vm/tests/test-docker.js","type":"MODIFIED","insertions":103,"deletions":-60},{"file":"src/vm/tests/test-fswatcher.js","type":"ADDED","insertions":525,"deletions":0},{"file":"src/vm/tests/test-internal_metadata_namespaces.js","type":"MODIFIED","insertions":86,"deletions":-22},{"file":"src/vm/tests/test-lastexited.js","type":"MODIFIED","insertions":48,"deletions":-20},{"file":"src/vm/tests/test-queue.js","type":"ADDED","insertions":361,"deletions":0},{"file":"src/vm/tests/test-send-recv.js","type":"MODIFIED","insertions":216,"deletions":-137},{"file":"src/vm/tests/test-snapshots.js","type":"MODIFIED","insertions":53,"deletions":-57},{"file":"src/vm/tests/test-update.js","type":"MODIFIED","insertions":94,"deletions":-58},{"file":"src/vm/tests/test-vminfod-zonewatcher-overflow.js","type":"ADDED","insertions":308,"deletions":0},{"file":"src/vm/tests/test-vminfod-zonewatcher.js","type":"ADDED","insertions":123,"deletions":0},{"file":"src/vm/tests/test-vminfod-zpoolwatcher.js","type":"ADDED","insertions":131,"deletions":0},{"file":"src/vm/tests/test-vminfod.js","type":"ADDED","insertions":42,"deletions":0},{"file":"src/zoneevent.c","type":"DELETED","insertions":0,"deletions":-144},{"file":"src/zoneevent.js","type":"ADDED","insertions":183,"deletions":0}],"sizeInsertions":17781,"sizeDeletions":-3970},{"number":"13","revision":"a41ef6c51f549d605ba3c979c619b4eceec653a9","parents":["ee76b399a8cb19702dde8834deb47c237d33f7bc"],"ref":"refs/changes/82/2782/13","uploader":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"createdOn":1525902177,"author":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1525902232,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"src/Makefile","type":"MODIFIED","insertions":24,"deletions":-7},{"file":"src/fswatcher.c","type":"ADDED","insertions":1031,"deletions":0},{"file":"src/manifest","type":"MODIFIED","insertions":47,"deletions":-1},{"file":"src/vm/common/vmtest.js","type":"MODIFIED","insertions":31,"deletions":-7},{"file":"src/vm/lib/metadata/agent.js","type":"MODIFIED","insertions":277,"deletions":-849},{"file":"src/vm/lib/metadata/zwatch.js","type":"DELETED","insertions":0,"deletions":-64},{"file":"src/vm/man/vmadm.1m.md","type":"MODIFIED","insertions":12,"deletions":0},{"file":"src/vm/node_modules/VM.js","type":"MODIFIED","insertions":3955,"deletions":-2055},{"file":"src/vm/node_modules/diff.js","type":"ADDED","insertions":505,"deletions":0},{"file":"src/vm/node_modules/expander.js","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"src/vm/node_modules/fswatcher.js","type":"ADDED","insertions":943,"deletions":0},{"file":"src/vm/node_modules/jsprim/LICENSE","type":"ADDED","insertions":19,"deletions":0},{"file":"src/vm/node_modules/jsprim/lib/jsprim.js","type":"ADDED","insertions":735,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/assert-plus/assert.js","type":"ADDED","insertions":211,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/assert-plus/package.json","type":"ADDED","insertions":82,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/extsprintf/LICENSE","type":"ADDED","insertions":19,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/extsprintf/lib/extsprintf.js","type":"ADDED","insertions":183,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/extsprintf/package.json","type":"ADDED","insertions":41,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/json-schema/README.md","type":"ADDED","insertions":5,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/json-schema/lib/links.js","type":"ADDED","insertions":66,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/json-schema/lib/validate.js","type":"ADDED","insertions":273,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/json-schema/package.json","type":"ADDED","insertions":65,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/LICENSE","type":"ADDED","insertions":19,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/lib/verror.js","type":"ADDED","insertions":451,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/node_modules/core-util-is/LICENSE","type":"ADDED","insertions":19,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/node_modules/core-util-is/lib/util.js","type":"ADDED","insertions":107,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/node_modules/core-util-is/package.json","type":"ADDED","insertions":59,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/package.json","type":"ADDED","insertions":50,"deletions":0},{"file":"src/vm/node_modules/jsprim/package.json","type":"ADDED","insertions":51,"deletions":0},{"file":"src/vm/node_modules/proptable.js","type":"MODIFIED","insertions":38,"deletions":-18},{"file":"src/vm/node_modules/queue.js","type":"ADDED","insertions":589,"deletions":0},{"file":"src/vm/node_modules/sysevent-stream.js","type":"MODIFIED","insertions":13,"deletions":-3},{"file":"src/vm/node_modules/vasync/package.json","type":"MODIFIED","insertions":1,"deletions":0},{"file":"src/vm/node_modules/vminfod/client.js","type":"ADDED","insertions":1112,"deletions":0},{"file":"src/vm/node_modules/vminfod/vminfod.js","type":"ADDED","insertions":2446,"deletions":0},{"file":"src/vm/node_modules/vminfod/zonewatcher.js","type":"ADDED","insertions":82,"deletions":0},{"file":"src/vm/node_modules/vminfod/zpoolwatcher.js","type":"ADDED","insertions":121,"deletions":0},{"file":"src/vm/node_modules/vmload/dump-json.js","type":"MODIFIED","insertions":32,"deletions":-31},{"file":"src/vm/node_modules/vmload/dump-vmobjs.js","type":"MODIFIED","insertions":4,"deletions":-5},{"file":"src/vm/node_modules/vmload/dump-zonexml.js","type":"MODIFIED","insertions":7,"deletions":-4},{"file":"src/vm/node_modules/vmload/index.js","type":"MODIFIED","insertions":503,"deletions":-409},{"file":"src/vm/node_modules/vmload/vmload-datasets.js","type":"MODIFIED","insertions":22,"deletions":-12},{"file":"src/vm/node_modules/vmload/vmload-json.js","type":"MODIFIED","insertions":11,"deletions":-7},{"file":"src/vm/node_modules/vmload/vmload-zoneadm.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"src/vm/node_modules/zoneevent.js","type":"ADDED","insertions":182,"deletions":0},{"file":"src/vm/runtests","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"src/vm/sbin/vmadm.js","type":"MODIFIED","insertions":117,"deletions":-2},{"file":"src/vm/sbin/vmadmd.js","type":"MODIFIED","insertions":18,"deletions":-23},{"file":"src/vm/sbin/vminfo.js","type":"ADDED","insertions":318,"deletions":0},{"file":"src/vm/sbin/vminfod.js","type":"ADDED","insertions":68,"deletions":0},{"file":"src/vm/smf/system-metadata.xml","type":"MODIFIED","insertions":4,"deletions":0},{"file":"src/vm/smf/system-vmadmd.xml","type":"MODIFIED","insertions":4,"deletions":0},{"file":"src/vm/smf/system-vminfod","type":"ADDED","insertions":53,"deletions":0},{"file":"src/vm/smf/system-vminfod.xml","type":"ADDED","insertions":47,"deletions":0},{"file":"src/vm/tests/common.js","type":"ADDED","insertions":129,"deletions":0},{"file":"src/vm/tests/test-defaults.js","type":"MODIFIED","insertions":73,"deletions":-9},{"file":"src/vm/tests/test-delete.js","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"src/vm/tests/test-diff.js","type":"ADDED","insertions":262,"deletions":0},{"file":"src/vm/tests/test-docker.js","type":"MODIFIED","insertions":103,"deletions":-60},{"file":"src/vm/tests/test-fswatcher.js","type":"ADDED","insertions":525,"deletions":0},{"file":"src/vm/tests/test-internal_metadata_namespaces.js","type":"MODIFIED","insertions":86,"deletions":-22},{"file":"src/vm/tests/test-lastexited.js","type":"MODIFIED","insertions":48,"deletions":-20},{"file":"src/vm/tests/test-queue.js","type":"ADDED","insertions":361,"deletions":0},{"file":"src/vm/tests/test-send-recv.js","type":"MODIFIED","insertions":216,"deletions":-137},{"file":"src/vm/tests/test-snapshots.js","type":"MODIFIED","insertions":53,"deletions":-57},{"file":"src/vm/tests/test-update.js","type":"MODIFIED","insertions":94,"deletions":-58},{"file":"src/vm/tests/test-vminfod-zonewatcher-overflow.js","type":"ADDED","insertions":308,"deletions":0},{"file":"src/vm/tests/test-vminfod-zonewatcher.js","type":"ADDED","insertions":123,"deletions":0},{"file":"src/vm/tests/test-vminfod-zpoolwatcher.js","type":"ADDED","insertions":131,"deletions":0},{"file":"src/vm/tests/test-vminfod.js","type":"ADDED","insertions":42,"deletions":0},{"file":"src/zoneevent.c","type":"DELETED","insertions":0,"deletions":-144},{"file":"src/zoneevent.js","type":"ADDED","insertions":183,"deletions":0}],"sizeInsertions":17822,"sizeDeletions":-4011},{"number":"14","revision":"582f8f9431b2e2e45e14a9e050bc0f1b5dda5631","parents":["ee76b399a8cb19702dde8834deb47c237d33f7bc"],"ref":"refs/changes/82/2782/14","uploader":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"createdOn":1525902314,"author":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1525902367,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"src/Makefile","type":"MODIFIED","insertions":24,"deletions":-7},{"file":"src/fswatcher.c","type":"ADDED","insertions":1031,"deletions":0},{"file":"src/manifest","type":"MODIFIED","insertions":47,"deletions":-1},{"file":"src/vm/common/vmtest.js","type":"MODIFIED","insertions":31,"deletions":-7},{"file":"src/vm/lib/metadata/agent.js","type":"MODIFIED","insertions":277,"deletions":-849},{"file":"src/vm/lib/metadata/zwatch.js","type":"DELETED","insertions":0,"deletions":-64},{"file":"src/vm/man/vmadm.1m.md","type":"MODIFIED","insertions":12,"deletions":0},{"file":"src/vm/node_modules/VM.js","type":"MODIFIED","insertions":3997,"deletions":-2055},{"file":"src/vm/node_modules/diff.js","type":"ADDED","insertions":505,"deletions":0},{"file":"src/vm/node_modules/expander.js","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"src/vm/node_modules/fswatcher.js","type":"ADDED","insertions":943,"deletions":0},{"file":"src/vm/node_modules/jsprim/LICENSE","type":"ADDED","insertions":19,"deletions":0},{"file":"src/vm/node_modules/jsprim/lib/jsprim.js","type":"ADDED","insertions":735,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/assert-plus/assert.js","type":"ADDED","insertions":211,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/assert-plus/package.json","type":"ADDED","insertions":82,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/extsprintf/LICENSE","type":"ADDED","insertions":19,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/extsprintf/lib/extsprintf.js","type":"ADDED","insertions":183,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/extsprintf/package.json","type":"ADDED","insertions":41,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/json-schema/README.md","type":"ADDED","insertions":5,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/json-schema/lib/links.js","type":"ADDED","insertions":66,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/json-schema/lib/validate.js","type":"ADDED","insertions":273,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/json-schema/package.json","type":"ADDED","insertions":65,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/LICENSE","type":"ADDED","insertions":19,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/lib/verror.js","type":"ADDED","insertions":451,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/node_modules/core-util-is/LICENSE","type":"ADDED","insertions":19,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/node_modules/core-util-is/lib/util.js","type":"ADDED","insertions":107,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/node_modules/core-util-is/package.json","type":"ADDED","insertions":59,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/package.json","type":"ADDED","insertions":50,"deletions":0},{"file":"src/vm/node_modules/jsprim/package.json","type":"ADDED","insertions":51,"deletions":0},{"file":"src/vm/node_modules/proptable.js","type":"MODIFIED","insertions":38,"deletions":-18},{"file":"src/vm/node_modules/queue.js","type":"ADDED","insertions":589,"deletions":0},{"file":"src/vm/node_modules/sysevent-stream.js","type":"MODIFIED","insertions":13,"deletions":-3},{"file":"src/vm/node_modules/vasync/package.json","type":"MODIFIED","insertions":1,"deletions":0},{"file":"src/vm/node_modules/vminfod/client.js","type":"ADDED","insertions":1112,"deletions":0},{"file":"src/vm/node_modules/vminfod/vminfod.js","type":"ADDED","insertions":2446,"deletions":0},{"file":"src/vm/node_modules/vminfod/zonewatcher.js","type":"ADDED","insertions":82,"deletions":0},{"file":"src/vm/node_modules/vminfod/zpoolwatcher.js","type":"ADDED","insertions":121,"deletions":0},{"file":"src/vm/node_modules/vmload/dump-json.js","type":"MODIFIED","insertions":32,"deletions":-31},{"file":"src/vm/node_modules/vmload/dump-vmobjs.js","type":"MODIFIED","insertions":4,"deletions":-5},{"file":"src/vm/node_modules/vmload/dump-zonexml.js","type":"MODIFIED","insertions":7,"deletions":-4},{"file":"src/vm/node_modules/vmload/index.js","type":"MODIFIED","insertions":503,"deletions":-409},{"file":"src/vm/node_modules/vmload/vmload-datasets.js","type":"MODIFIED","insertions":22,"deletions":-12},{"file":"src/vm/node_modules/vmload/vmload-json.js","type":"MODIFIED","insertions":11,"deletions":-7},{"file":"src/vm/node_modules/vmload/vmload-zoneadm.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"src/vm/node_modules/zoneevent.js","type":"ADDED","insertions":182,"deletions":0},{"file":"src/vm/runtests","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"src/vm/sbin/vmadm.js","type":"MODIFIED","insertions":117,"deletions":-2},{"file":"src/vm/sbin/vmadmd.js","type":"MODIFIED","insertions":18,"deletions":-23},{"file":"src/vm/sbin/vminfo.js","type":"ADDED","insertions":391,"deletions":0},{"file":"src/vm/sbin/vminfod.js","type":"ADDED","insertions":68,"deletions":0},{"file":"src/vm/smf/system-metadata.xml","type":"MODIFIED","insertions":4,"deletions":0},{"file":"src/vm/smf/system-vmadmd.xml","type":"MODIFIED","insertions":4,"deletions":0},{"file":"src/vm/smf/system-vminfod","type":"ADDED","insertions":53,"deletions":0},{"file":"src/vm/smf/system-vminfod.xml","type":"ADDED","insertions":47,"deletions":0},{"file":"src/vm/tests/common.js","type":"ADDED","insertions":129,"deletions":0},{"file":"src/vm/tests/test-defaults.js","type":"MODIFIED","insertions":73,"deletions":-9},{"file":"src/vm/tests/test-delete.js","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"src/vm/tests/test-diff.js","type":"ADDED","insertions":262,"deletions":0},{"file":"src/vm/tests/test-docker.js","type":"MODIFIED","insertions":103,"deletions":-60},{"file":"src/vm/tests/test-fswatcher.js","type":"ADDED","insertions":525,"deletions":0},{"file":"src/vm/tests/test-internal_metadata_namespaces.js","type":"MODIFIED","insertions":86,"deletions":-22},{"file":"src/vm/tests/test-lastexited.js","type":"MODIFIED","insertions":48,"deletions":-20},{"file":"src/vm/tests/test-queue.js","type":"ADDED","insertions":361,"deletions":0},{"file":"src/vm/tests/test-send-recv.js","type":"MODIFIED","insertions":216,"deletions":-137},{"file":"src/vm/tests/test-snapshots.js","type":"MODIFIED","insertions":53,"deletions":-57},{"file":"src/vm/tests/test-update.js","type":"MODIFIED","insertions":94,"deletions":-58},{"file":"src/vm/tests/test-vminfod-zonewatcher-overflow.js","type":"ADDED","insertions":308,"deletions":0},{"file":"src/vm/tests/test-vminfod-zonewatcher.js","type":"ADDED","insertions":123,"deletions":0},{"file":"src/vm/tests/test-vminfod-zpoolwatcher.js","type":"ADDED","insertions":131,"deletions":0},{"file":"src/vm/tests/test-vminfod.js","type":"ADDED","insertions":42,"deletions":0},{"file":"src/zoneevent.c","type":"DELETED","insertions":0,"deletions":-144},{"file":"src/zoneevent.js","type":"ADDED","insertions":183,"deletions":0}],"sizeInsertions":17937,"sizeDeletions":-4011},{"number":"15","revision":"7e07c0205933924062f6b9d0637ab22f9f76a966","parents":["f4a171b97ae700f0067362dd8283a2394e574af2"],"ref":"refs/changes/82/2782/15","uploader":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"createdOn":1527005749,"author":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1525902367,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"src/Makefile","type":"MODIFIED","insertions":24,"deletions":-7},{"file":"src/fswatcher.c","type":"ADDED","insertions":1031,"deletions":0},{"file":"src/manifest","type":"MODIFIED","insertions":47,"deletions":-1},{"file":"src/vm/common/vmtest.js","type":"MODIFIED","insertions":31,"deletions":-7},{"file":"src/vm/lib/metadata/agent.js","type":"MODIFIED","insertions":277,"deletions":-849},{"file":"src/vm/lib/metadata/zwatch.js","type":"DELETED","insertions":0,"deletions":-64},{"file":"src/vm/man/vmadm.1m.md","type":"MODIFIED","insertions":12,"deletions":0},{"file":"src/vm/node_modules/VM.js","type":"MODIFIED","insertions":3997,"deletions":-2055},{"file":"src/vm/node_modules/diff.js","type":"ADDED","insertions":505,"deletions":0},{"file":"src/vm/node_modules/expander.js","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"src/vm/node_modules/fswatcher.js","type":"ADDED","insertions":943,"deletions":0},{"file":"src/vm/node_modules/jsprim/LICENSE","type":"ADDED","insertions":19,"deletions":0},{"file":"src/vm/node_modules/jsprim/lib/jsprim.js","type":"ADDED","insertions":735,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/assert-plus/assert.js","type":"ADDED","insertions":211,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/assert-plus/package.json","type":"ADDED","insertions":82,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/extsprintf/LICENSE","type":"ADDED","insertions":19,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/extsprintf/lib/extsprintf.js","type":"ADDED","insertions":183,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/extsprintf/package.json","type":"ADDED","insertions":41,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/json-schema/README.md","type":"ADDED","insertions":5,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/json-schema/lib/links.js","type":"ADDED","insertions":66,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/json-schema/lib/validate.js","type":"ADDED","insertions":273,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/json-schema/package.json","type":"ADDED","insertions":65,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/LICENSE","type":"ADDED","insertions":19,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/lib/verror.js","type":"ADDED","insertions":451,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/node_modules/core-util-is/LICENSE","type":"ADDED","insertions":19,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/node_modules/core-util-is/lib/util.js","type":"ADDED","insertions":107,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/node_modules/core-util-is/package.json","type":"ADDED","insertions":59,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/package.json","type":"ADDED","insertions":50,"deletions":0},{"file":"src/vm/node_modules/jsprim/package.json","type":"ADDED","insertions":51,"deletions":0},{"file":"src/vm/node_modules/proptable.js","type":"MODIFIED","insertions":38,"deletions":-18},{"file":"src/vm/node_modules/queue.js","type":"ADDED","insertions":589,"deletions":0},{"file":"src/vm/node_modules/sysevent-stream.js","type":"MODIFIED","insertions":13,"deletions":-3},{"file":"src/vm/node_modules/vasync/package.json","type":"MODIFIED","insertions":1,"deletions":0},{"file":"src/vm/node_modules/vminfod/client.js","type":"ADDED","insertions":1112,"deletions":0},{"file":"src/vm/node_modules/vminfod/vminfod.js","type":"ADDED","insertions":2446,"deletions":0},{"file":"src/vm/node_modules/vminfod/zonewatcher.js","type":"ADDED","insertions":82,"deletions":0},{"file":"src/vm/node_modules/vminfod/zpoolwatcher.js","type":"ADDED","insertions":121,"deletions":0},{"file":"src/vm/node_modules/vmload/dump-json.js","type":"MODIFIED","insertions":32,"deletions":-31},{"file":"src/vm/node_modules/vmload/dump-vmobjs.js","type":"MODIFIED","insertions":4,"deletions":-5},{"file":"src/vm/node_modules/vmload/dump-zonexml.js","type":"MODIFIED","insertions":7,"deletions":-4},{"file":"src/vm/node_modules/vmload/index.js","type":"MODIFIED","insertions":503,"deletions":-409},{"file":"src/vm/node_modules/vmload/vmload-datasets.js","type":"MODIFIED","insertions":22,"deletions":-12},{"file":"src/vm/node_modules/vmload/vmload-json.js","type":"MODIFIED","insertions":11,"deletions":-7},{"file":"src/vm/node_modules/vmload/vmload-zoneadm.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"src/vm/node_modules/zoneevent.js","type":"ADDED","insertions":182,"deletions":0},{"file":"src/vm/runtests","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"src/vm/sbin/vmadm.js","type":"MODIFIED","insertions":117,"deletions":-2},{"file":"src/vm/sbin/vmadmd.js","type":"MODIFIED","insertions":18,"deletions":-23},{"file":"src/vm/sbin/vminfo.js","type":"ADDED","insertions":391,"deletions":0},{"file":"src/vm/sbin/vminfod.js","type":"ADDED","insertions":68,"deletions":0},{"file":"src/vm/smf/system-metadata.xml","type":"MODIFIED","insertions":4,"deletions":0},{"file":"src/vm/smf/system-vmadmd.xml","type":"MODIFIED","insertions":4,"deletions":0},{"file":"src/vm/smf/system-vminfod","type":"ADDED","insertions":53,"deletions":0},{"file":"src/vm/smf/system-vminfod.xml","type":"ADDED","insertions":47,"deletions":0},{"file":"src/vm/tests/common.js","type":"ADDED","insertions":129,"deletions":0},{"file":"src/vm/tests/test-defaults.js","type":"MODIFIED","insertions":73,"deletions":-9},{"file":"src/vm/tests/test-delete.js","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"src/vm/tests/test-diff.js","type":"ADDED","insertions":262,"deletions":0},{"file":"src/vm/tests/test-docker.js","type":"MODIFIED","insertions":103,"deletions":-60},{"file":"src/vm/tests/test-fswatcher.js","type":"ADDED","insertions":525,"deletions":0},{"file":"src/vm/tests/test-internal_metadata_namespaces.js","type":"MODIFIED","insertions":86,"deletions":-22},{"file":"src/vm/tests/test-lastexited.js","type":"MODIFIED","insertions":48,"deletions":-20},{"file":"src/vm/tests/test-queue.js","type":"ADDED","insertions":361,"deletions":0},{"file":"src/vm/tests/test-send-recv.js","type":"MODIFIED","insertions":216,"deletions":-137},{"file":"src/vm/tests/test-snapshots.js","type":"MODIFIED","insertions":53,"deletions":-57},{"file":"src/vm/tests/test-update.js","type":"MODIFIED","insertions":94,"deletions":-58},{"file":"src/vm/tests/test-vminfod-zonewatcher-overflow.js","type":"ADDED","insertions":308,"deletions":0},{"file":"src/vm/tests/test-vminfod-zonewatcher.js","type":"ADDED","insertions":123,"deletions":0},{"file":"src/vm/tests/test-vminfod-zpoolwatcher.js","type":"ADDED","insertions":131,"deletions":0},{"file":"src/vm/tests/test-vminfod.js","type":"ADDED","insertions":42,"deletions":0},{"file":"src/zoneevent.c","type":"DELETED","insertions":0,"deletions":-144},{"file":"src/zoneevent.js","type":"ADDED","insertions":183,"deletions":0}],"sizeInsertions":17937,"sizeDeletions":-4011},{"number":"16","revision":"3a34038d666bb183036cc7848e503efbdf6bc9c0","parents":["6d232f498952cf009c7dbd046d99cf65acf6ef08"],"ref":"refs/changes/82/2782/16","uploader":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"createdOn":1531758871,"author":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1531758923,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"src/Makefile","type":"MODIFIED","insertions":24,"deletions":-7},{"file":"src/fswatcher.c","type":"ADDED","insertions":1031,"deletions":0},{"file":"src/manifest","type":"MODIFIED","insertions":47,"deletions":-1},{"file":"src/vm/common/vmtest.js","type":"MODIFIED","insertions":31,"deletions":-7},{"file":"src/vm/lib/metadata/agent.js","type":"MODIFIED","insertions":277,"deletions":-849},{"file":"src/vm/lib/metadata/zwatch.js","type":"DELETED","insertions":0,"deletions":-64},{"file":"src/vm/man/vmadm.1m.md","type":"MODIFIED","insertions":12,"deletions":0},{"file":"src/vm/node_modules/VM.js","type":"MODIFIED","insertions":3994,"deletions":-2053},{"file":"src/vm/node_modules/diff.js","type":"ADDED","insertions":505,"deletions":0},{"file":"src/vm/node_modules/expander.js","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"src/vm/node_modules/fswatcher.js","type":"ADDED","insertions":943,"deletions":0},{"file":"src/vm/node_modules/jsprim/LICENSE","type":"ADDED","insertions":19,"deletions":0},{"file":"src/vm/node_modules/jsprim/lib/jsprim.js","type":"ADDED","insertions":735,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/assert-plus/assert.js","type":"ADDED","insertions":211,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/assert-plus/package.json","type":"ADDED","insertions":82,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/extsprintf/LICENSE","type":"ADDED","insertions":19,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/extsprintf/lib/extsprintf.js","type":"ADDED","insertions":183,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/extsprintf/package.json","type":"ADDED","insertions":41,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/json-schema/README.md","type":"ADDED","insertions":5,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/json-schema/lib/links.js","type":"ADDED","insertions":66,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/json-schema/lib/validate.js","type":"ADDED","insertions":273,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/json-schema/package.json","type":"ADDED","insertions":65,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/LICENSE","type":"ADDED","insertions":19,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/lib/verror.js","type":"ADDED","insertions":451,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/node_modules/core-util-is/LICENSE","type":"ADDED","insertions":19,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/node_modules/core-util-is/lib/util.js","type":"ADDED","insertions":107,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/node_modules/core-util-is/package.json","type":"ADDED","insertions":59,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/package.json","type":"ADDED","insertions":50,"deletions":0},{"file":"src/vm/node_modules/jsprim/package.json","type":"ADDED","insertions":51,"deletions":0},{"file":"src/vm/node_modules/proptable.js","type":"MODIFIED","insertions":38,"deletions":-18},{"file":"src/vm/node_modules/queue.js","type":"ADDED","insertions":589,"deletions":0},{"file":"src/vm/node_modules/sysevent-stream.js","type":"MODIFIED","insertions":13,"deletions":-3},{"file":"src/vm/node_modules/vasync/package.json","type":"MODIFIED","insertions":1,"deletions":0},{"file":"src/vm/node_modules/vminfod/client.js","type":"ADDED","insertions":1112,"deletions":0},{"file":"src/vm/node_modules/vminfod/vminfod.js","type":"ADDED","insertions":2446,"deletions":0},{"file":"src/vm/node_modules/vminfod/zonewatcher.js","type":"ADDED","insertions":82,"deletions":0},{"file":"src/vm/node_modules/vminfod/zpoolwatcher.js","type":"ADDED","insertions":121,"deletions":0},{"file":"src/vm/node_modules/vmload/dump-json.js","type":"MODIFIED","insertions":32,"deletions":-31},{"file":"src/vm/node_modules/vmload/dump-vmobjs.js","type":"MODIFIED","insertions":4,"deletions":-5},{"file":"src/vm/node_modules/vmload/dump-zonexml.js","type":"MODIFIED","insertions":7,"deletions":-4},{"file":"src/vm/node_modules/vmload/index.js","type":"MODIFIED","insertions":503,"deletions":-409},{"file":"src/vm/node_modules/vmload/vmload-datasets.js","type":"MODIFIED","insertions":22,"deletions":-12},{"file":"src/vm/node_modules/vmload/vmload-json.js","type":"MODIFIED","insertions":11,"deletions":-7},{"file":"src/vm/node_modules/vmload/vmload-zoneadm.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"src/vm/node_modules/zoneevent.js","type":"ADDED","insertions":182,"deletions":0},{"file":"src/vm/runtests","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"src/vm/sbin/vmadm.js","type":"MODIFIED","insertions":117,"deletions":-2},{"file":"src/vm/sbin/vmadmd.js","type":"MODIFIED","insertions":18,"deletions":-23},{"file":"src/vm/sbin/vminfo.js","type":"ADDED","insertions":391,"deletions":0},{"file":"src/vm/sbin/vminfod.js","type":"ADDED","insertions":68,"deletions":0},{"file":"src/vm/smf/system-metadata.xml","type":"MODIFIED","insertions":4,"deletions":0},{"file":"src/vm/smf/system-vmadmd.xml","type":"MODIFIED","insertions":4,"deletions":0},{"file":"src/vm/smf/system-vminfod","type":"ADDED","insertions":53,"deletions":0},{"file":"src/vm/smf/system-vminfod.xml","type":"ADDED","insertions":47,"deletions":0},{"file":"src/vm/tests/common.js","type":"ADDED","insertions":129,"deletions":0},{"file":"src/vm/tests/test-defaults.js","type":"MODIFIED","insertions":73,"deletions":-9},{"file":"src/vm/tests/test-delete.js","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"src/vm/tests/test-diff.js","type":"ADDED","insertions":262,"deletions":0},{"file":"src/vm/tests/test-docker.js","type":"MODIFIED","insertions":103,"deletions":-60},{"file":"src/vm/tests/test-fswatcher.js","type":"ADDED","insertions":525,"deletions":0},{"file":"src/vm/tests/test-internal_metadata_namespaces.js","type":"MODIFIED","insertions":86,"deletions":-22},{"file":"src/vm/tests/test-lastexited.js","type":"MODIFIED","insertions":48,"deletions":-20},{"file":"src/vm/tests/test-queue.js","type":"ADDED","insertions":361,"deletions":0},{"file":"src/vm/tests/test-send-recv.js","type":"MODIFIED","insertions":216,"deletions":-137},{"file":"src/vm/tests/test-snapshots.js","type":"MODIFIED","insertions":53,"deletions":-57},{"file":"src/vm/tests/test-update.js","type":"MODIFIED","insertions":94,"deletions":-58},{"file":"src/vm/tests/test-vminfod-zonewatcher-overflow.js","type":"ADDED","insertions":308,"deletions":0},{"file":"src/vm/tests/test-vminfod-zonewatcher.js","type":"ADDED","insertions":123,"deletions":0},{"file":"src/vm/tests/test-vminfod-zpoolwatcher.js","type":"ADDED","insertions":131,"deletions":0},{"file":"src/vm/tests/test-vminfod.js","type":"ADDED","insertions":42,"deletions":0},{"file":"src/zoneevent.c","type":"DELETED","insertions":0,"deletions":-144},{"file":"src/zoneevent.js","type":"ADDED","insertions":183,"deletions":0}],"sizeInsertions":17934,"sizeDeletions":-4009},{"number":"17","revision":"3cae56242acf432d489dbd8fe27fb3dd752436ea","parents":["6d232f498952cf009c7dbd046d99cf65acf6ef08"],"ref":"refs/changes/82/2782/17","uploader":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"createdOn":1531758906,"author":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1531758957,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"overlay/generic/etc/logadm.conf","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"src/Makefile","type":"MODIFIED","insertions":24,"deletions":-7},{"file":"src/fswatcher.c","type":"ADDED","insertions":1031,"deletions":0},{"file":"src/manifest","type":"MODIFIED","insertions":47,"deletions":-1},{"file":"src/vm/common/vmtest.js","type":"MODIFIED","insertions":31,"deletions":-7},{"file":"src/vm/lib/metadata/agent.js","type":"MODIFIED","insertions":277,"deletions":-849},{"file":"src/vm/lib/metadata/zwatch.js","type":"DELETED","insertions":0,"deletions":-64},{"file":"src/vm/man/vmadm.1m.md","type":"MODIFIED","insertions":12,"deletions":0},{"file":"src/vm/node_modules/VM.js","type":"MODIFIED","insertions":3994,"deletions":-2053},{"file":"src/vm/node_modules/diff.js","type":"ADDED","insertions":505,"deletions":0},{"file":"src/vm/node_modules/expander.js","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"src/vm/node_modules/fswatcher.js","type":"ADDED","insertions":943,"deletions":0},{"file":"src/vm/node_modules/jsprim/LICENSE","type":"ADDED","insertions":19,"deletions":0},{"file":"src/vm/node_modules/jsprim/lib/jsprim.js","type":"ADDED","insertions":735,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/assert-plus/assert.js","type":"ADDED","insertions":211,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/assert-plus/package.json","type":"ADDED","insertions":82,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/extsprintf/LICENSE","type":"ADDED","insertions":19,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/extsprintf/lib/extsprintf.js","type":"ADDED","insertions":183,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/extsprintf/package.json","type":"ADDED","insertions":41,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/json-schema/README.md","type":"ADDED","insertions":5,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/json-schema/lib/links.js","type":"ADDED","insertions":66,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/json-schema/lib/validate.js","type":"ADDED","insertions":273,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/json-schema/package.json","type":"ADDED","insertions":65,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/LICENSE","type":"ADDED","insertions":19,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/lib/verror.js","type":"ADDED","insertions":451,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/node_modules/core-util-is/LICENSE","type":"ADDED","insertions":19,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/node_modules/core-util-is/lib/util.js","type":"ADDED","insertions":107,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/node_modules/core-util-is/package.json","type":"ADDED","insertions":59,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/package.json","type":"ADDED","insertions":50,"deletions":0},{"file":"src/vm/node_modules/jsprim/package.json","type":"ADDED","insertions":51,"deletions":0},{"file":"src/vm/node_modules/proptable.js","type":"MODIFIED","insertions":38,"deletions":-18},{"file":"src/vm/node_modules/queue.js","type":"ADDED","insertions":589,"deletions":0},{"file":"src/vm/node_modules/sysevent-stream.js","type":"MODIFIED","insertions":13,"deletions":-3},{"file":"src/vm/node_modules/vasync/package.json","type":"MODIFIED","insertions":1,"deletions":0},{"file":"src/vm/node_modules/vminfod/client.js","type":"ADDED","insertions":1112,"deletions":0},{"file":"src/vm/node_modules/vminfod/vminfod.js","type":"ADDED","insertions":2446,"deletions":0},{"file":"src/vm/node_modules/vminfod/zonewatcher.js","type":"ADDED","insertions":82,"deletions":0},{"file":"src/vm/node_modules/vminfod/zpoolwatcher.js","type":"ADDED","insertions":121,"deletions":0},{"file":"src/vm/node_modules/vmload/dump-json.js","type":"MODIFIED","insertions":32,"deletions":-31},{"file":"src/vm/node_modules/vmload/dump-vmobjs.js","type":"MODIFIED","insertions":4,"deletions":-5},{"file":"src/vm/node_modules/vmload/dump-zonexml.js","type":"MODIFIED","insertions":7,"deletions":-4},{"file":"src/vm/node_modules/vmload/index.js","type":"MODIFIED","insertions":503,"deletions":-409},{"file":"src/vm/node_modules/vmload/vmload-datasets.js","type":"MODIFIED","insertions":22,"deletions":-12},{"file":"src/vm/node_modules/vmload/vmload-json.js","type":"MODIFIED","insertions":11,"deletions":-7},{"file":"src/vm/node_modules/vmload/vmload-zoneadm.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"src/vm/node_modules/zoneevent.js","type":"ADDED","insertions":182,"deletions":0},{"file":"src/vm/runtests","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"src/vm/sbin/vmadm.js","type":"MODIFIED","insertions":117,"deletions":-2},{"file":"src/vm/sbin/vmadmd.js","type":"MODIFIED","insertions":18,"deletions":-23},{"file":"src/vm/sbin/vminfo.js","type":"ADDED","insertions":391,"deletions":0},{"file":"src/vm/sbin/vminfod.js","type":"ADDED","insertions":68,"deletions":0},{"file":"src/vm/smf/system-metadata.xml","type":"MODIFIED","insertions":4,"deletions":0},{"file":"src/vm/smf/system-vmadmd.xml","type":"MODIFIED","insertions":4,"deletions":0},{"file":"src/vm/smf/system-vminfod","type":"ADDED","insertions":53,"deletions":0},{"file":"src/vm/smf/system-vminfod.xml","type":"ADDED","insertions":47,"deletions":0},{"file":"src/vm/tests/common.js","type":"ADDED","insertions":129,"deletions":0},{"file":"src/vm/tests/test-defaults.js","type":"MODIFIED","insertions":73,"deletions":-9},{"file":"src/vm/tests/test-delete.js","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"src/vm/tests/test-diff.js","type":"ADDED","insertions":262,"deletions":0},{"file":"src/vm/tests/test-docker.js","type":"MODIFIED","insertions":103,"deletions":-60},{"file":"src/vm/tests/test-fswatcher.js","type":"ADDED","insertions":525,"deletions":0},{"file":"src/vm/tests/test-internal_metadata_namespaces.js","type":"MODIFIED","insertions":86,"deletions":-22},{"file":"src/vm/tests/test-lastexited.js","type":"MODIFIED","insertions":48,"deletions":-20},{"file":"src/vm/tests/test-queue.js","type":"ADDED","insertions":361,"deletions":0},{"file":"src/vm/tests/test-send-recv.js","type":"MODIFIED","insertions":216,"deletions":-137},{"file":"src/vm/tests/test-snapshots.js","type":"MODIFIED","insertions":53,"deletions":-57},{"file":"src/vm/tests/test-update.js","type":"MODIFIED","insertions":94,"deletions":-58},{"file":"src/vm/tests/test-vminfod-zonewatcher-overflow.js","type":"ADDED","insertions":308,"deletions":0},{"file":"src/vm/tests/test-vminfod-zonewatcher.js","type":"ADDED","insertions":123,"deletions":0},{"file":"src/vm/tests/test-vminfod-zpoolwatcher.js","type":"ADDED","insertions":131,"deletions":0},{"file":"src/vm/tests/test-vminfod.js","type":"ADDED","insertions":42,"deletions":0},{"file":"src/zoneevent.c","type":"DELETED","insertions":0,"deletions":-144},{"file":"src/zoneevent.js","type":"ADDED","insertions":183,"deletions":0}],"sizeInsertions":17936,"sizeDeletions":-4010},{"number":"18","revision":"8106bf69c3ede25539fa85aaf2e238f3891e12f1","parents":["17c3a1a1a22c468f3cfe4801e034fa76dbddb9aa"],"ref":"refs/changes/82/2782/18","uploader":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"createdOn":1533141855,"author":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1531758957,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"overlay/generic/etc/logadm.conf","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"src/Makefile","type":"MODIFIED","insertions":24,"deletions":-7},{"file":"src/fswatcher.c","type":"ADDED","insertions":1031,"deletions":0},{"file":"src/manifest","type":"MODIFIED","insertions":47,"deletions":-1},{"file":"src/vm/common/vmtest.js","type":"MODIFIED","insertions":31,"deletions":-7},{"file":"src/vm/lib/metadata/agent.js","type":"MODIFIED","insertions":277,"deletions":-849},{"file":"src/vm/lib/metadata/zwatch.js","type":"DELETED","insertions":0,"deletions":-64},{"file":"src/vm/man/vmadm.1m.md","type":"MODIFIED","insertions":12,"deletions":0},{"file":"src/vm/node_modules/VM.js","type":"MODIFIED","insertions":3994,"deletions":-2053},{"file":"src/vm/node_modules/diff.js","type":"ADDED","insertions":505,"deletions":0},{"file":"src/vm/node_modules/expander.js","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"src/vm/node_modules/fswatcher.js","type":"ADDED","insertions":943,"deletions":0},{"file":"src/vm/node_modules/jsprim/LICENSE","type":"ADDED","insertions":19,"deletions":0},{"file":"src/vm/node_modules/jsprim/lib/jsprim.js","type":"ADDED","insertions":735,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/assert-plus/assert.js","type":"ADDED","insertions":211,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/assert-plus/package.json","type":"ADDED","insertions":82,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/extsprintf/LICENSE","type":"ADDED","insertions":19,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/extsprintf/lib/extsprintf.js","type":"ADDED","insertions":183,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/extsprintf/package.json","type":"ADDED","insertions":41,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/json-schema/README.md","type":"ADDED","insertions":5,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/json-schema/lib/links.js","type":"ADDED","insertions":66,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/json-schema/lib/validate.js","type":"ADDED","insertions":273,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/json-schema/package.json","type":"ADDED","insertions":65,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/LICENSE","type":"ADDED","insertions":19,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/lib/verror.js","type":"ADDED","insertions":451,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/node_modules/core-util-is/LICENSE","type":"ADDED","insertions":19,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/node_modules/core-util-is/lib/util.js","type":"ADDED","insertions":107,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/node_modules/core-util-is/package.json","type":"ADDED","insertions":59,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/package.json","type":"ADDED","insertions":50,"deletions":0},{"file":"src/vm/node_modules/jsprim/package.json","type":"ADDED","insertions":51,"deletions":0},{"file":"src/vm/node_modules/proptable.js","type":"MODIFIED","insertions":38,"deletions":-18},{"file":"src/vm/node_modules/queue.js","type":"ADDED","insertions":589,"deletions":0},{"file":"src/vm/node_modules/sysevent-stream.js","type":"MODIFIED","insertions":13,"deletions":-3},{"file":"src/vm/node_modules/vasync/package.json","type":"MODIFIED","insertions":1,"deletions":0},{"file":"src/vm/node_modules/vminfod/client.js","type":"ADDED","insertions":1112,"deletions":0},{"file":"src/vm/node_modules/vminfod/vminfod.js","type":"ADDED","insertions":2446,"deletions":0},{"file":"src/vm/node_modules/vminfod/zonewatcher.js","type":"ADDED","insertions":82,"deletions":0},{"file":"src/vm/node_modules/vminfod/zpoolwatcher.js","type":"ADDED","insertions":121,"deletions":0},{"file":"src/vm/node_modules/vmload/dump-json.js","type":"MODIFIED","insertions":32,"deletions":-31},{"file":"src/vm/node_modules/vmload/dump-vmobjs.js","type":"MODIFIED","insertions":4,"deletions":-5},{"file":"src/vm/node_modules/vmload/dump-zonexml.js","type":"MODIFIED","insertions":7,"deletions":-4},{"file":"src/vm/node_modules/vmload/index.js","type":"MODIFIED","insertions":503,"deletions":-409},{"file":"src/vm/node_modules/vmload/vmload-datasets.js","type":"MODIFIED","insertions":22,"deletions":-12},{"file":"src/vm/node_modules/vmload/vmload-json.js","type":"MODIFIED","insertions":11,"deletions":-7},{"file":"src/vm/node_modules/vmload/vmload-zoneadm.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"src/vm/node_modules/zoneevent.js","type":"ADDED","insertions":182,"deletions":0},{"file":"src/vm/runtests","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"src/vm/sbin/vmadm.js","type":"MODIFIED","insertions":117,"deletions":-2},{"file":"src/vm/sbin/vmadmd.js","type":"MODIFIED","insertions":18,"deletions":-23},{"file":"src/vm/sbin/vminfo.js","type":"ADDED","insertions":391,"deletions":0},{"file":"src/vm/sbin/vminfod.js","type":"ADDED","insertions":68,"deletions":0},{"file":"src/vm/smf/system-metadata.xml","type":"MODIFIED","insertions":4,"deletions":0},{"file":"src/vm/smf/system-vmadmd.xml","type":"MODIFIED","insertions":4,"deletions":0},{"file":"src/vm/smf/system-vminfod","type":"ADDED","insertions":53,"deletions":0},{"file":"src/vm/smf/system-vminfod.xml","type":"ADDED","insertions":47,"deletions":0},{"file":"src/vm/tests/common.js","type":"ADDED","insertions":129,"deletions":0},{"file":"src/vm/tests/test-defaults.js","type":"MODIFIED","insertions":73,"deletions":-9},{"file":"src/vm/tests/test-delete.js","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"src/vm/tests/test-diff.js","type":"ADDED","insertions":262,"deletions":0},{"file":"src/vm/tests/test-docker.js","type":"MODIFIED","insertions":103,"deletions":-60},{"file":"src/vm/tests/test-fswatcher.js","type":"ADDED","insertions":525,"deletions":0},{"file":"src/vm/tests/test-internal_metadata_namespaces.js","type":"MODIFIED","insertions":86,"deletions":-22},{"file":"src/vm/tests/test-lastexited.js","type":"MODIFIED","insertions":48,"deletions":-20},{"file":"src/vm/tests/test-queue.js","type":"ADDED","insertions":361,"deletions":0},{"file":"src/vm/tests/test-send-recv.js","type":"MODIFIED","insertions":216,"deletions":-137},{"file":"src/vm/tests/test-snapshots.js","type":"MODIFIED","insertions":53,"deletions":-57},{"file":"src/vm/tests/test-update.js","type":"MODIFIED","insertions":94,"deletions":-58},{"file":"src/vm/tests/test-vminfod-zonewatcher-overflow.js","type":"ADDED","insertions":308,"deletions":0},{"file":"src/vm/tests/test-vminfod-zonewatcher.js","type":"ADDED","insertions":123,"deletions":0},{"file":"src/vm/tests/test-vminfod-zpoolwatcher.js","type":"ADDED","insertions":131,"deletions":0},{"file":"src/vm/tests/test-vminfod.js","type":"ADDED","insertions":42,"deletions":0},{"file":"src/zoneevent.c","type":"DELETED","insertions":0,"deletions":-144},{"file":"src/zoneevent.js","type":"ADDED","insertions":183,"deletions":0}],"sizeInsertions":17936,"sizeDeletions":-4010},{"number":"19","revision":"a5cb30f7a0d59ece36c6d03b0f99b39e6bbc7bac","parents":["17c3a1a1a22c468f3cfe4801e034fa76dbddb9aa"],"ref":"refs/changes/82/2782/19","uploader":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"createdOn":1533141928,"author":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1533141978,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"overlay/generic/etc/logadm.conf","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"src/Makefile","type":"MODIFIED","insertions":24,"deletions":-7},{"file":"src/fswatcher.c","type":"ADDED","insertions":1031,"deletions":0},{"file":"src/manifest","type":"MODIFIED","insertions":47,"deletions":-1},{"file":"src/vm/common/vmtest.js","type":"MODIFIED","insertions":31,"deletions":-7},{"file":"src/vm/lib/metadata/agent.js","type":"MODIFIED","insertions":277,"deletions":-849},{"file":"src/vm/lib/metadata/zwatch.js","type":"DELETED","insertions":0,"deletions":-64},{"file":"src/vm/man/vmadm.1m.md","type":"MODIFIED","insertions":12,"deletions":0},{"file":"src/vm/node_modules/VM.js","type":"MODIFIED","insertions":3994,"deletions":-2053},{"file":"src/vm/node_modules/diff.js","type":"ADDED","insertions":505,"deletions":0},{"file":"src/vm/node_modules/expander.js","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"src/vm/node_modules/fswatcher.js","type":"ADDED","insertions":943,"deletions":0},{"file":"src/vm/node_modules/jsprim/LICENSE","type":"ADDED","insertions":19,"deletions":0},{"file":"src/vm/node_modules/jsprim/lib/jsprim.js","type":"ADDED","insertions":735,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/assert-plus/assert.js","type":"ADDED","insertions":211,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/assert-plus/package.json","type":"ADDED","insertions":82,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/extsprintf/LICENSE","type":"ADDED","insertions":19,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/extsprintf/lib/extsprintf.js","type":"ADDED","insertions":183,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/extsprintf/package.json","type":"ADDED","insertions":41,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/json-schema/README.md","type":"ADDED","insertions":5,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/json-schema/lib/links.js","type":"ADDED","insertions":66,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/json-schema/lib/validate.js","type":"ADDED","insertions":273,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/json-schema/package.json","type":"ADDED","insertions":65,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/LICENSE","type":"ADDED","insertions":19,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/lib/verror.js","type":"ADDED","insertions":451,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/node_modules/core-util-is/LICENSE","type":"ADDED","insertions":19,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/node_modules/core-util-is/lib/util.js","type":"ADDED","insertions":107,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/node_modules/core-util-is/package.json","type":"ADDED","insertions":59,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/package.json","type":"ADDED","insertions":50,"deletions":0},{"file":"src/vm/node_modules/jsprim/package.json","type":"ADDED","insertions":51,"deletions":0},{"file":"src/vm/node_modules/proptable.js","type":"MODIFIED","insertions":38,"deletions":-18},{"file":"src/vm/node_modules/queue.js","type":"ADDED","insertions":589,"deletions":0},{"file":"src/vm/node_modules/sysevent-stream.js","type":"MODIFIED","insertions":13,"deletions":-3},{"file":"src/vm/node_modules/vasync/package.json","type":"MODIFIED","insertions":1,"deletions":0},{"file":"src/vm/node_modules/vminfod/client.js","type":"ADDED","insertions":1112,"deletions":0},{"file":"src/vm/node_modules/vminfod/vminfod.js","type":"ADDED","insertions":2446,"deletions":0},{"file":"src/vm/node_modules/vminfod/zonewatcher.js","type":"ADDED","insertions":82,"deletions":0},{"file":"src/vm/node_modules/vminfod/zpoolwatcher.js","type":"ADDED","insertions":121,"deletions":0},{"file":"src/vm/node_modules/vmload/dump-json.js","type":"MODIFIED","insertions":32,"deletions":-31},{"file":"src/vm/node_modules/vmload/dump-vmobjs.js","type":"MODIFIED","insertions":4,"deletions":-5},{"file":"src/vm/node_modules/vmload/dump-zonexml.js","type":"MODIFIED","insertions":7,"deletions":-4},{"file":"src/vm/node_modules/vmload/index.js","type":"MODIFIED","insertions":503,"deletions":-409},{"file":"src/vm/node_modules/vmload/vmload-datasets.js","type":"MODIFIED","insertions":22,"deletions":-12},{"file":"src/vm/node_modules/vmload/vmload-json.js","type":"MODIFIED","insertions":11,"deletions":-7},{"file":"src/vm/node_modules/vmload/vmload-zoneadm.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"src/vm/node_modules/zoneevent.js","type":"ADDED","insertions":182,"deletions":0},{"file":"src/vm/runtests","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"src/vm/sbin/vmadm.js","type":"MODIFIED","insertions":117,"deletions":-2},{"file":"src/vm/sbin/vmadmd.js","type":"MODIFIED","insertions":18,"deletions":-23},{"file":"src/vm/sbin/vminfo.js","type":"ADDED","insertions":391,"deletions":0},{"file":"src/vm/sbin/vminfod.js","type":"ADDED","insertions":68,"deletions":0},{"file":"src/vm/smf/system-metadata.xml","type":"MODIFIED","insertions":4,"deletions":0},{"file":"src/vm/smf/system-vmadmd.xml","type":"MODIFIED","insertions":4,"deletions":0},{"file":"src/vm/smf/system-vminfod","type":"ADDED","insertions":53,"deletions":0},{"file":"src/vm/smf/system-vminfod.xml","type":"ADDED","insertions":47,"deletions":0},{"file":"src/vm/tests/common.js","type":"ADDED","insertions":129,"deletions":0},{"file":"src/vm/tests/test-defaults.js","type":"MODIFIED","insertions":73,"deletions":-9},{"file":"src/vm/tests/test-delete.js","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"src/vm/tests/test-diff.js","type":"ADDED","insertions":262,"deletions":0},{"file":"src/vm/tests/test-docker.js","type":"MODIFIED","insertions":103,"deletions":-60},{"file":"src/vm/tests/test-fswatcher.js","type":"ADDED","insertions":525,"deletions":0},{"file":"src/vm/tests/test-internal_metadata_namespaces.js","type":"MODIFIED","insertions":86,"deletions":-22},{"file":"src/vm/tests/test-lastexited.js","type":"MODIFIED","insertions":48,"deletions":-20},{"file":"src/vm/tests/test-queue.js","type":"ADDED","insertions":361,"deletions":0},{"file":"src/vm/tests/test-send-recv.js","type":"MODIFIED","insertions":216,"deletions":-137},{"file":"src/vm/tests/test-snapshots.js","type":"MODIFIED","insertions":53,"deletions":-57},{"file":"src/vm/tests/test-update.js","type":"MODIFIED","insertions":94,"deletions":-58},{"file":"src/vm/tests/test-vminfod-zonewatcher-overflow.js","type":"ADDED","insertions":308,"deletions":0},{"file":"src/vm/tests/test-vminfod-zonewatcher.js","type":"ADDED","insertions":123,"deletions":0},{"file":"src/vm/tests/test-vminfod-zpoolwatcher.js","type":"ADDED","insertions":131,"deletions":0},{"file":"src/vm/tests/test-vminfod.js","type":"ADDED","insertions":42,"deletions":0},{"file":"src/zoneevent.c","type":"DELETED","insertions":0,"deletions":-144},{"file":"src/zoneevent.js","type":"ADDED","insertions":155,"deletions":0}],"sizeInsertions":17908,"sizeDeletions":-4010},{"number":"20","revision":"b73accfb6ab995d98a7d1a0c32ac96333b3d3792","parents":["0308c8680915823a54bf911a69385020143ee8cb"],"ref":"refs/changes/82/2782/20","uploader":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"createdOn":1537487399,"author":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1537487453,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1537510511,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"man/src/vminfo.1m.md","type":"ADDED","insertions":51,"deletions":0},{"file":"overlay/generic/etc/logadm.conf","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"src/Makefile","type":"MODIFIED","insertions":24,"deletions":-7},{"file":"src/fswatcher.c","type":"ADDED","insertions":1031,"deletions":0},{"file":"src/manifest","type":"MODIFIED","insertions":48,"deletions":-1},{"file":"src/vm/common/vmtest.js","type":"MODIFIED","insertions":31,"deletions":-7},{"file":"src/vm/lib/metadata/agent.js","type":"MODIFIED","insertions":317,"deletions":-849},{"file":"src/vm/lib/metadata/zwatch.js","type":"DELETED","insertions":0,"deletions":-64},{"file":"src/vm/man/vmadm.1m.md","type":"MODIFIED","insertions":12,"deletions":0},{"file":"src/vm/node_modules/VM.js","type":"MODIFIED","insertions":3993,"deletions":-2053},{"file":"src/vm/node_modules/diff.js","type":"ADDED","insertions":505,"deletions":0},{"file":"src/vm/node_modules/expander.js","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"src/vm/node_modules/fswatcher.js","type":"ADDED","insertions":943,"deletions":0},{"file":"src/vm/node_modules/jsprim/LICENSE","type":"ADDED","insertions":19,"deletions":0},{"file":"src/vm/node_modules/jsprim/lib/jsprim.js","type":"ADDED","insertions":735,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/assert-plus/assert.js","type":"ADDED","insertions":211,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/assert-plus/package.json","type":"ADDED","insertions":82,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/extsprintf/LICENSE","type":"ADDED","insertions":19,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/extsprintf/lib/extsprintf.js","type":"ADDED","insertions":183,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/extsprintf/package.json","type":"ADDED","insertions":41,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/json-schema/README.md","type":"ADDED","insertions":5,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/json-schema/lib/links.js","type":"ADDED","insertions":66,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/json-schema/lib/validate.js","type":"ADDED","insertions":273,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/json-schema/package.json","type":"ADDED","insertions":65,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/LICENSE","type":"ADDED","insertions":19,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/lib/verror.js","type":"ADDED","insertions":451,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/node_modules/core-util-is/LICENSE","type":"ADDED","insertions":19,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/node_modules/core-util-is/lib/util.js","type":"ADDED","insertions":107,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/node_modules/core-util-is/package.json","type":"ADDED","insertions":59,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/package.json","type":"ADDED","insertions":50,"deletions":0},{"file":"src/vm/node_modules/jsprim/package.json","type":"ADDED","insertions":51,"deletions":0},{"file":"src/vm/node_modules/proptable.js","type":"MODIFIED","insertions":38,"deletions":-18},{"file":"src/vm/node_modules/queue.js","type":"ADDED","insertions":589,"deletions":0},{"file":"src/vm/node_modules/sysevent-stream.js","type":"MODIFIED","insertions":13,"deletions":-3},{"file":"src/vm/node_modules/vasync/package.json","type":"MODIFIED","insertions":1,"deletions":0},{"file":"src/vm/node_modules/vminfod/client.js","type":"ADDED","insertions":1118,"deletions":0},{"file":"src/vm/node_modules/vminfod/vminfod.js","type":"ADDED","insertions":2446,"deletions":0},{"file":"src/vm/node_modules/vminfod/zonewatcher.js","type":"ADDED","insertions":82,"deletions":0},{"file":"src/vm/node_modules/vminfod/zpoolwatcher.js","type":"ADDED","insertions":133,"deletions":0},{"file":"src/vm/node_modules/vmload/dump-json.js","type":"MODIFIED","insertions":32,"deletions":-31},{"file":"src/vm/node_modules/vmload/dump-vmobjs.js","type":"MODIFIED","insertions":4,"deletions":-5},{"file":"src/vm/node_modules/vmload/dump-zonexml.js","type":"MODIFIED","insertions":7,"deletions":-4},{"file":"src/vm/node_modules/vmload/index.js","type":"MODIFIED","insertions":503,"deletions":-409},{"file":"src/vm/node_modules/vmload/vmload-datasets.js","type":"MODIFIED","insertions":22,"deletions":-12},{"file":"src/vm/node_modules/vmload/vmload-json.js","type":"MODIFIED","insertions":11,"deletions":-7},{"file":"src/vm/node_modules/vmload/vmload-zoneadm.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"src/vm/node_modules/zoneevent.js","type":"ADDED","insertions":182,"deletions":0},{"file":"src/vm/runtests","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"src/vm/sbin/vmadm.js","type":"MODIFIED","insertions":117,"deletions":-2},{"file":"src/vm/sbin/vmadmd.js","type":"MODIFIED","insertions":18,"deletions":-23},{"file":"src/vm/sbin/vminfo.js","type":"ADDED","insertions":391,"deletions":0},{"file":"src/vm/sbin/vminfod.js","type":"ADDED","insertions":68,"deletions":0},{"file":"src/vm/smf/system-metadata.xml","type":"MODIFIED","insertions":4,"deletions":0},{"file":"src/vm/smf/system-vmadmd.xml","type":"MODIFIED","insertions":4,"deletions":0},{"file":"src/vm/smf/system-vminfod","type":"ADDED","insertions":53,"deletions":0},{"file":"src/vm/smf/system-vminfod.xml","type":"ADDED","insertions":47,"deletions":0},{"file":"src/vm/tests/common.js","type":"ADDED","insertions":129,"deletions":0},{"file":"src/vm/tests/test-defaults.js","type":"MODIFIED","insertions":73,"deletions":-9},{"file":"src/vm/tests/test-delete.js","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"src/vm/tests/test-diff.js","type":"ADDED","insertions":262,"deletions":0},{"file":"src/vm/tests/test-docker.js","type":"MODIFIED","insertions":103,"deletions":-60},{"file":"src/vm/tests/test-fswatcher.js","type":"ADDED","insertions":525,"deletions":0},{"file":"src/vm/tests/test-internal_metadata_namespaces.js","type":"MODIFIED","insertions":86,"deletions":-22},{"file":"src/vm/tests/test-lastexited.js","type":"MODIFIED","insertions":48,"deletions":-20},{"file":"src/vm/tests/test-queue.js","type":"ADDED","insertions":361,"deletions":0},{"file":"src/vm/tests/test-send-recv.js","type":"MODIFIED","insertions":216,"deletions":-137},{"file":"src/vm/tests/test-snapshots.js","type":"MODIFIED","insertions":53,"deletions":-57},{"file":"src/vm/tests/test-update.js","type":"MODIFIED","insertions":94,"deletions":-58},{"file":"src/vm/tests/test-vminfod-zonewatcher-overflow.js","type":"ADDED","insertions":308,"deletions":0},{"file":"src/vm/tests/test-vminfod-zonewatcher.js","type":"ADDED","insertions":123,"deletions":0},{"file":"src/vm/tests/test-vminfod-zpoolwatcher.js","type":"ADDED","insertions":131,"deletions":0},{"file":"src/vm/tests/test-vminfod.js","type":"ADDED","insertions":42,"deletions":0},{"file":"src/zoneevent.c","type":"DELETED","insertions":0,"deletions":-144},{"file":"src/zoneevent.js","type":"ADDED","insertions":155,"deletions":0}],"sizeInsertions":18017,"sizeDeletions":-4010},{"number":"21","revision":"ab3dc69bd517ff71d7df1842ec4558f455250725","parents":["0308c8680915823a54bf911a69385020143ee8cb"],"ref":"refs/changes/82/2782/21","uploader":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"createdOn":1537549584,"author":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1537487453,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1537510511,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1537566466,"by":{"name":"Angela Fong","email":"angela.fong@joyent.com","username":"askfongjojo"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"man/src/vminfo.1m.md","type":"ADDED","insertions":51,"deletions":0},{"file":"overlay/generic/etc/logadm.conf","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"src/Makefile","type":"MODIFIED","insertions":24,"deletions":-7},{"file":"src/fswatcher.c","type":"ADDED","insertions":1031,"deletions":0},{"file":"src/manifest","type":"MODIFIED","insertions":48,"deletions":-1},{"file":"src/vm/common/vmtest.js","type":"MODIFIED","insertions":31,"deletions":-7},{"file":"src/vm/lib/metadata/agent.js","type":"MODIFIED","insertions":317,"deletions":-849},{"file":"src/vm/lib/metadata/zwatch.js","type":"DELETED","insertions":0,"deletions":-64},{"file":"src/vm/man/vmadm.1m.md","type":"MODIFIED","insertions":12,"deletions":0},{"file":"src/vm/node_modules/VM.js","type":"MODIFIED","insertions":3993,"deletions":-2053},{"file":"src/vm/node_modules/diff.js","type":"ADDED","insertions":505,"deletions":0},{"file":"src/vm/node_modules/expander.js","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"src/vm/node_modules/fswatcher.js","type":"ADDED","insertions":943,"deletions":0},{"file":"src/vm/node_modules/jsprim/LICENSE","type":"ADDED","insertions":19,"deletions":0},{"file":"src/vm/node_modules/jsprim/lib/jsprim.js","type":"ADDED","insertions":735,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/assert-plus/assert.js","type":"ADDED","insertions":211,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/assert-plus/package.json","type":"ADDED","insertions":82,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/extsprintf/LICENSE","type":"ADDED","insertions":19,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/extsprintf/lib/extsprintf.js","type":"ADDED","insertions":183,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/extsprintf/package.json","type":"ADDED","insertions":41,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/json-schema/README.md","type":"ADDED","insertions":5,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/json-schema/lib/links.js","type":"ADDED","insertions":66,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/json-schema/lib/validate.js","type":"ADDED","insertions":273,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/json-schema/package.json","type":"ADDED","insertions":65,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/LICENSE","type":"ADDED","insertions":19,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/lib/verror.js","type":"ADDED","insertions":451,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/node_modules/core-util-is/LICENSE","type":"ADDED","insertions":19,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/node_modules/core-util-is/lib/util.js","type":"ADDED","insertions":107,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/node_modules/core-util-is/package.json","type":"ADDED","insertions":59,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/package.json","type":"ADDED","insertions":50,"deletions":0},{"file":"src/vm/node_modules/jsprim/package.json","type":"ADDED","insertions":51,"deletions":0},{"file":"src/vm/node_modules/proptable.js","type":"MODIFIED","insertions":38,"deletions":-18},{"file":"src/vm/node_modules/queue.js","type":"ADDED","insertions":589,"deletions":0},{"file":"src/vm/node_modules/sysevent-stream.js","type":"MODIFIED","insertions":13,"deletions":-3},{"file":"src/vm/node_modules/vasync/package.json","type":"MODIFIED","insertions":1,"deletions":0},{"file":"src/vm/node_modules/vminfod/client.js","type":"ADDED","insertions":1118,"deletions":0},{"file":"src/vm/node_modules/vminfod/vminfod.js","type":"ADDED","insertions":2446,"deletions":0},{"file":"src/vm/node_modules/vminfod/zonewatcher.js","type":"ADDED","insertions":82,"deletions":0},{"file":"src/vm/node_modules/vminfod/zpoolwatcher.js","type":"ADDED","insertions":133,"deletions":0},{"file":"src/vm/node_modules/vmload/dump-json.js","type":"MODIFIED","insertions":32,"deletions":-31},{"file":"src/vm/node_modules/vmload/dump-vmobjs.js","type":"MODIFIED","insertions":4,"deletions":-5},{"file":"src/vm/node_modules/vmload/dump-zonexml.js","type":"MODIFIED","insertions":7,"deletions":-4},{"file":"src/vm/node_modules/vmload/index.js","type":"MODIFIED","insertions":503,"deletions":-409},{"file":"src/vm/node_modules/vmload/vmload-datasets.js","type":"MODIFIED","insertions":22,"deletions":-12},{"file":"src/vm/node_modules/vmload/vmload-json.js","type":"MODIFIED","insertions":11,"deletions":-7},{"file":"src/vm/node_modules/vmload/vmload-zoneadm.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"src/vm/node_modules/zoneevent.js","type":"ADDED","insertions":182,"deletions":0},{"file":"src/vm/runtests","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"src/vm/sbin/vmadm.js","type":"MODIFIED","insertions":117,"deletions":-2},{"file":"src/vm/sbin/vmadmd.js","type":"MODIFIED","insertions":18,"deletions":-23},{"file":"src/vm/sbin/vminfo.js","type":"ADDED","insertions":391,"deletions":0},{"file":"src/vm/sbin/vminfod.js","type":"ADDED","insertions":68,"deletions":0},{"file":"src/vm/smf/system-metadata.xml","type":"MODIFIED","insertions":4,"deletions":0},{"file":"src/vm/smf/system-vmadmd.xml","type":"MODIFIED","insertions":4,"deletions":0},{"file":"src/vm/smf/system-vminfod","type":"ADDED","insertions":53,"deletions":0},{"file":"src/vm/smf/system-vminfod.xml","type":"ADDED","insertions":47,"deletions":0},{"file":"src/vm/tests/common.js","type":"ADDED","insertions":129,"deletions":0},{"file":"src/vm/tests/test-defaults.js","type":"MODIFIED","insertions":73,"deletions":-9},{"file":"src/vm/tests/test-delete.js","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"src/vm/tests/test-diff.js","type":"ADDED","insertions":262,"deletions":0},{"file":"src/vm/tests/test-docker.js","type":"MODIFIED","insertions":103,"deletions":-60},{"file":"src/vm/tests/test-fswatcher.js","type":"ADDED","insertions":525,"deletions":0},{"file":"src/vm/tests/test-internal_metadata_namespaces.js","type":"MODIFIED","insertions":86,"deletions":-22},{"file":"src/vm/tests/test-lastexited.js","type":"MODIFIED","insertions":48,"deletions":-20},{"file":"src/vm/tests/test-queue.js","type":"ADDED","insertions":361,"deletions":0},{"file":"src/vm/tests/test-send-recv.js","type":"MODIFIED","insertions":216,"deletions":-137},{"file":"src/vm/tests/test-snapshots.js","type":"MODIFIED","insertions":53,"deletions":-57},{"file":"src/vm/tests/test-update.js","type":"MODIFIED","insertions":94,"deletions":-58},{"file":"src/vm/tests/test-vminfod-zonewatcher-overflow.js","type":"ADDED","insertions":308,"deletions":0},{"file":"src/vm/tests/test-vminfod-zonewatcher.js","type":"ADDED","insertions":123,"deletions":0},{"file":"src/vm/tests/test-vminfod-zpoolwatcher.js","type":"ADDED","insertions":131,"deletions":0},{"file":"src/vm/tests/test-vminfod.js","type":"ADDED","insertions":42,"deletions":0},{"file":"src/zoneevent.c","type":"DELETED","insertions":0,"deletions":-144},{"file":"src/zoneevent.js","type":"ADDED","insertions":155,"deletions":0}],"sizeInsertions":18017,"sizeDeletions":-4010},{"number":"22","revision":"1c2c59922161a9d98f109983c9e07205eb1d7889","parents":["0308c8680915823a54bf911a69385020143ee8cb"],"ref":"refs/changes/82/2782/22","uploader":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"createdOn":1537566932,"author":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1537487453,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1537510511,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1537566466,"by":{"name":"Angela Fong","email":"angela.fong@joyent.com","username":"askfongjojo"}},{"type":"SUBM","value":"1","grantedOn":1537568981,"by":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":1,"deletions":0},{"file":"man/src/vminfo.1m.md","type":"ADDED","insertions":51,"deletions":0},{"file":"overlay/generic/etc/logadm.conf","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"src/Makefile","type":"MODIFIED","insertions":24,"deletions":-7},{"file":"src/fswatcher.c","type":"ADDED","insertions":1031,"deletions":0},{"file":"src/manifest","type":"MODIFIED","insertions":48,"deletions":-1},{"file":"src/vm/common/vmtest.js","type":"MODIFIED","insertions":31,"deletions":-7},{"file":"src/vm/lib/metadata/agent.js","type":"MODIFIED","insertions":317,"deletions":-849},{"file":"src/vm/lib/metadata/zwatch.js","type":"DELETED","insertions":0,"deletions":-64},{"file":"src/vm/man/vmadm.1m.md","type":"MODIFIED","insertions":12,"deletions":0},{"file":"src/vm/node_modules/VM.js","type":"MODIFIED","insertions":3993,"deletions":-2053},{"file":"src/vm/node_modules/diff.js","type":"ADDED","insertions":505,"deletions":0},{"file":"src/vm/node_modules/expander.js","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"src/vm/node_modules/fswatcher.js","type":"ADDED","insertions":943,"deletions":0},{"file":"src/vm/node_modules/jsprim/LICENSE","type":"ADDED","insertions":19,"deletions":0},{"file":"src/vm/node_modules/jsprim/lib/jsprim.js","type":"ADDED","insertions":735,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/assert-plus/assert.js","type":"ADDED","insertions":211,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/assert-plus/package.json","type":"ADDED","insertions":82,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/extsprintf/LICENSE","type":"ADDED","insertions":19,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/extsprintf/lib/extsprintf.js","type":"ADDED","insertions":183,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/extsprintf/package.json","type":"ADDED","insertions":41,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/json-schema/README.md","type":"ADDED","insertions":5,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/json-schema/lib/links.js","type":"ADDED","insertions":66,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/json-schema/lib/validate.js","type":"ADDED","insertions":273,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/json-schema/package.json","type":"ADDED","insertions":65,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/LICENSE","type":"ADDED","insertions":19,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/lib/verror.js","type":"ADDED","insertions":451,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/node_modules/core-util-is/LICENSE","type":"ADDED","insertions":19,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/node_modules/core-util-is/lib/util.js","type":"ADDED","insertions":107,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/node_modules/core-util-is/package.json","type":"ADDED","insertions":59,"deletions":0},{"file":"src/vm/node_modules/jsprim/node_modules/verror/package.json","type":"ADDED","insertions":50,"deletions":0},{"file":"src/vm/node_modules/jsprim/package.json","type":"ADDED","insertions":51,"deletions":0},{"file":"src/vm/node_modules/proptable.js","type":"MODIFIED","insertions":38,"deletions":-18},{"file":"src/vm/node_modules/queue.js","type":"ADDED","insertions":589,"deletions":0},{"file":"src/vm/node_modules/sysevent-stream.js","type":"MODIFIED","insertions":13,"deletions":-3},{"file":"src/vm/node_modules/vasync/package.json","type":"MODIFIED","insertions":1,"deletions":0},{"file":"src/vm/node_modules/vminfod/client.js","type":"ADDED","insertions":1118,"deletions":0},{"file":"src/vm/node_modules/vminfod/vminfod.js","type":"ADDED","insertions":2446,"deletions":0},{"file":"src/vm/node_modules/vminfod/zonewatcher.js","type":"ADDED","insertions":82,"deletions":0},{"file":"src/vm/node_modules/vminfod/zpoolwatcher.js","type":"ADDED","insertions":133,"deletions":0},{"file":"src/vm/node_modules/vmload/dump-json.js","type":"MODIFIED","insertions":32,"deletions":-31},{"file":"src/vm/node_modules/vmload/dump-vmobjs.js","type":"MODIFIED","insertions":4,"deletions":-5},{"file":"src/vm/node_modules/vmload/dump-zonexml.js","type":"MODIFIED","insertions":7,"deletions":-4},{"file":"src/vm/node_modules/vmload/index.js","type":"MODIFIED","insertions":503,"deletions":-409},{"file":"src/vm/node_modules/vmload/vmload-datasets.js","type":"MODIFIED","insertions":22,"deletions":-12},{"file":"src/vm/node_modules/vmload/vmload-json.js","type":"MODIFIED","insertions":11,"deletions":-7},{"file":"src/vm/node_modules/vmload/vmload-zoneadm.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"src/vm/node_modules/zoneevent.js","type":"ADDED","insertions":182,"deletions":0},{"file":"src/vm/runtests","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"src/vm/sbin/vmadm.js","type":"MODIFIED","insertions":117,"deletions":-2},{"file":"src/vm/sbin/vmadmd.js","type":"MODIFIED","insertions":18,"deletions":-23},{"file":"src/vm/sbin/vminfo.js","type":"ADDED","insertions":391,"deletions":0},{"file":"src/vm/sbin/vminfod.js","type":"ADDED","insertions":68,"deletions":0},{"file":"src/vm/smf/system-metadata.xml","type":"MODIFIED","insertions":4,"deletions":0},{"file":"src/vm/smf/system-vmadmd.xml","type":"MODIFIED","insertions":4,"deletions":0},{"file":"src/vm/smf/system-vminfod","type":"ADDED","insertions":53,"deletions":0},{"file":"src/vm/smf/system-vminfod.xml","type":"ADDED","insertions":47,"deletions":0},{"file":"src/vm/tests/common.js","type":"ADDED","insertions":129,"deletions":0},{"file":"src/vm/tests/test-defaults.js","type":"MODIFIED","insertions":73,"deletions":-9},{"file":"src/vm/tests/test-delete.js","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"src/vm/tests/test-diff.js","type":"ADDED","insertions":262,"deletions":0},{"file":"src/vm/tests/test-docker.js","type":"MODIFIED","insertions":103,"deletions":-60},{"file":"src/vm/tests/test-fswatcher.js","type":"ADDED","insertions":525,"deletions":0},{"file":"src/vm/tests/test-internal_metadata_namespaces.js","type":"MODIFIED","insertions":86,"deletions":-22},{"file":"src/vm/tests/test-lastexited.js","type":"MODIFIED","insertions":48,"deletions":-20},{"file":"src/vm/tests/test-queue.js","type":"ADDED","insertions":361,"deletions":0},{"file":"src/vm/tests/test-send-recv.js","type":"MODIFIED","insertions":216,"deletions":-137},{"file":"src/vm/tests/test-snapshots.js","type":"MODIFIED","insertions":53,"deletions":-57},{"file":"src/vm/tests/test-update.js","type":"MODIFIED","insertions":94,"deletions":-58},{"file":"src/vm/tests/test-vminfod-zonewatcher-overflow.js","type":"ADDED","insertions":308,"deletions":0},{"file":"src/vm/tests/test-vminfod-zonewatcher.js","type":"ADDED","insertions":123,"deletions":0},{"file":"src/vm/tests/test-vminfod-zpoolwatcher.js","type":"ADDED","insertions":131,"deletions":0},{"file":"src/vm/tests/test-vminfod.js","type":"ADDED","insertions":42,"deletions":0},{"file":"src/zoneevent.c","type":"DELETED","insertions":0,"deletions":-144},{"file":"src/zoneevent.js","type":"ADDED","insertions":155,"deletions":0}],"sizeInsertions":18017,"sizeDeletions":-4010}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},{"name":"Angela Fong","email":"angela.fong@joyent.com","username":"askfongjojo"},{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"}]}