{"project":"joyent/node-triton","branch":"master","id":"Iee1212ce5217b6792f5e1ed78adfa3607105155e","number":"6445","subject":"TRITON-1736 Add relevant error message when creating more than 8 disks in Flexible Disk instance","owner":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"url":"https://cr.joyent.us/6445","commitMessage":"TRITON-1736 Add relevant error message when creating more than 8 disks in Flexible Disk instance\n","createdOn":1560513564,"lastUpdated":1560785192,"open":false,"status":"ABANDONED","comments":[{"timestamp":1560513564,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 1."},{"timestamp":1560513569,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit 43b9a16570e9436404e992dd05c37860f44592d6\n    \n    TRITON-1736 Add relevant error message when creating more than 8 disks in Flexible Disk instance"},{"timestamp":1560513608,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1560519633,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 1:\n\nIs this the right place to fix this?  It seems as though we could have the same problem with other callers of CloudAPI.  If we were to only check in CloudAPI would the cost of the call be so expensive that we should do client side checking to avoid it?\n\nThe 8 disk limitation is imposed by implementation details on the CN - we could easily increase this in response to customer demand.  If we were to do so, does it make since to require triton users to upgrade their node-triton installation? \n\nMore importantly, this points out that something on the CN is not handling the add of unsupported disk counts properly.  If some CNs in a DC supported 256 disks and some were still stuck at 8, we would need node-triton, CloudAPI, etc. to be able to pass a request for adding disk 9+ through to the CN so that it can make the call.\n\nIf instead of changing node-triton now, the change were in CloudAPI, the failure message would still come back to the node-triton user quickly.  This would mask the bug that exists on CNs.  We should also be updating something on the CN (likely somewhere in VM.js) to handle illegal add_disks requests.  Then in the aforementioned hypothetical future, when cn-agent tries to perform an invalid update the caller will get a reasonable error back in a reasonable amount of time.  This error could flow all the way up to node-triton, presuming the check in CloudAPI is removed."},{"timestamp":1560785166,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 1:\n\n\u003e Is this the right place to fix this?  It seems as though we could\n \u003e have the same problem with other callers of CloudAPI.  If we were\n \u003e to only check in CloudAPI would the cost of the call be so\n \u003e expensive that we should do client side checking to avoid it?\n \u003e \n \u003e The 8 disk limitation is imposed by implementation details on the\n \u003e CN - we could easily increase this in response to customer demand. \n \u003e If we were to do so, does it make since to require triton users to\n \u003e upgrade their node-triton installation?\n \u003e \n \u003e More importantly, this points out that something on the CN is not\n \u003e handling the add of unsupported disk counts properly.  If some CNs\n \u003e in a DC supported 256 disks and some were still stuck at 8, we\n \u003e would need node-triton, CloudAPI, etc. to be able to pass a request\n \u003e for adding disk 9+ through to the CN so that it can make the call.\n \u003e \n \u003e If instead of changing node-triton now, the change were in\n \u003e CloudAPI, the failure message would still come back to the\n \u003e node-triton user quickly.  This would mask the bug that exists on\n \u003e CNs.  We should also be updating something on the CN (likely\n \u003e somewhere in VM.js) to handle illegal add_disks requests.  Then in\n \u003e the aforementioned hypothetical future, when cn-agent tries to\n \u003e perform an invalid update the caller will get a reasonable error\n \u003e back in a reasonable amount of time.  This error could flow all the\n \u003e way up to node-triton, presuming the check in CloudAPI is removed.\n\nSounds good to me, moved to CloudAPI and abandoning this change."},{"timestamp":1560785192,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Abandoned\n\nSee https://cr.joyent.us/#/c/6450/ instead"}],"currentPatchSet":{"number":"1","revision":"ee1212ce5217b6792f5e1ed78adfa3607105155e","parents":["84234d7fea654f7318c51df51aa4f1487072c0e1"],"ref":"refs/changes/45/6445/1","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1560513564,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1560513608,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/do_instance/do_disk/do_add.js","type":"MODIFIED","insertions":8,"deletions":-2}],"sizeInsertions":8,"sizeDeletions":-2},"patchSets":[{"number":"1","revision":"ee1212ce5217b6792f5e1ed78adfa3607105155e","parents":["84234d7fea654f7318c51df51aa4f1487072c0e1"],"ref":"refs/changes/45/6445/1","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1560513564,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1560513608,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/do_instance/do_disk/do_add.js","type":"MODIFIED","insertions":8,"deletions":-2}],"sizeInsertions":8,"sizeDeletions":-2}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}]}