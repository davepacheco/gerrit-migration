{"project":"joyent/illumos-joyent","branch":"master","id":"I8452a8b5820aac5e316afc8a80b2001a84509467","number":"3713","subject":"OS-6811 viona must not spin on invalid descriptor count Reviewed by: Ryan Zezeski \u003crpz@joyent.com\u003e Reviewed by: John Levon \u003cjohn.levon@joyent.com\u003e Approved by: Bryan Cantrill \u003cbryan@joyent.com\u003e","owner":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"url":"https://cr.joyent.us/3713","commitMessage":"OS-6811 viona must not spin on invalid descriptor count\nReviewed by: Ryan Zezeski \u003crpz@joyent.com\u003e\nReviewed by: John Levon \u003cjohn.levon@joyent.com\u003e\nApproved by: Bryan Cantrill \u003cbryan@joyent.com\u003e\n","createdOn":1521833373,"lastUpdated":1522089723,"open":false,"status":"MERGED","comments":[{"timestamp":1521833373,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 1."},{"timestamp":1521833413,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1521833456,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 1:\n\nThis is based on theoretical circumstances.  I\u0027ve not actually hit this issue anywhere."},{"timestamp":1521835134,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1521836473,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1521836557,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 2."},{"timestamp":1521837923,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 2:\n\n(2 comments)"},{"timestamp":1521866556,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 3."},{"timestamp":1521867176,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 2:\n\n(2 comments)"},{"timestamp":1521890055,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1521980982,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1522088360,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 4."},{"timestamp":1522088408,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 4:\n\nThe OS-6810 wad resulted in a merge conflict which had to be addressed."},{"timestamp":1522088508,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Patch Set 4: Code-Review+1"},{"timestamp":1522088878,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 4: Code-Review+1"},{"timestamp":1522089331,"reviewer":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"message":"Patch Set 4: Integration-Approval+1"},{"timestamp":1522089689,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 5: Commit message was updated."},{"timestamp":1522089723,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Patrick Mooney"}],"currentPatchSet":{"number":"5","revision":"8452a8b5820aac5e316afc8a80b2001a84509467","parents":["360e88e03baee24ea9f43d2473d284916741590c"],"ref":"refs/changes/13/3713/5","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1522089689,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1522088508,"by":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1522088878,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1522089331,"by":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"}},{"type":"SUBM","value":"1","grantedOn":1522089723,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/uts/i86pc/io/viona/viona.c","type":"MODIFIED","insertions":22,"deletions":-8}],"sizeInsertions":22,"sizeDeletions":-8},"patchSets":[{"number":"1","revision":"3e87c96cb8d6143b9d5d8d62e4f6ea1203b2ac3f","parents":["7892cb3dceef9f2cbcd853e66fb05601a94bbba2"],"ref":"refs/changes/13/3713/1","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1521833373,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/uts/i86pc/io/viona/viona.c","line":1132,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"I don\u0027t know enough about viona to tell: could this have any weird interactions with the continue statement immediately following? E.g., could we end up in a loop where between the break and the next call to viona_vr_num_avail() there is new data and we keep bouncing back to the beginning of the for loop; never reaching ntx \u003d 0."},{"file":"usr/src/uts/i86pc/io/viona/viona.c","line":1132,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"You\u0027re right.  There is a problem with \u0027ntx\u0027 state across the loop.  I\u0027ll simplify the situation."},{"file":"usr/src/uts/i86pc/io/viona/viona.c","line":1302,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"This references the stats which are assumed to be added thanks to OS-6810"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/i86pc/io/viona/viona.c","type":"MODIFIED","insertions":15,"deletions":-5}],"sizeInsertions":15,"sizeDeletions":-5},{"number":"2","revision":"60efaa712866f49ade6da8e5438c49ae5303ce0e","parents":["7892cb3dceef9f2cbcd853e66fb05601a94bbba2"],"ref":"refs/changes/13/3713/2","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1521836557,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/uts/i86pc/io/viona/viona.c","line":1054,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Think it\u0027s worth a comment that this doesn\u0027t guarantee ndesc \u003c ring_size."},{"file":"usr/src/uts/i86pc/io/viona/viona.c","line":1054,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Done"},{"file":"usr/src/uts/i86pc/io/viona/viona.c","line":1127,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"nit: advantageous"},{"file":"usr/src/uts/i86pc/io/viona/viona.c","line":1127,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/i86pc/io/viona/viona.c","type":"MODIFIED","insertions":18,"deletions":-8}],"sizeInsertions":18,"sizeDeletions":-8},{"number":"3","revision":"11aa7f0689b4ba990b8e19dac34b1abc7083e926","parents":["7892cb3dceef9f2cbcd853e66fb05601a94bbba2"],"ref":"refs/changes/13/3713/3","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1521866556,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1521890055,"by":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1521980982,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/i86pc/io/viona/viona.c","type":"MODIFIED","insertions":22,"deletions":-8}],"sizeInsertions":22,"sizeDeletions":-8},{"number":"4","revision":"ca8bb984d46f820716569bc4938e850387d6e078","parents":["360e88e03baee24ea9f43d2473d284916741590c"],"ref":"refs/changes/13/3713/4","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1522088360,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1522089331,"by":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1522088508,"by":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1522088878,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/i86pc/io/viona/viona.c","type":"MODIFIED","insertions":22,"deletions":-8}],"sizeInsertions":22,"sizeDeletions":-8},{"number":"5","revision":"8452a8b5820aac5e316afc8a80b2001a84509467","parents":["360e88e03baee24ea9f43d2473d284916741590c"],"ref":"refs/changes/13/3713/5","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1522089689,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1522089331,"by":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"}},{"type":"SUBM","value":"1","grantedOn":1522089723,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1522088508,"by":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1522088878,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/uts/i86pc/io/viona/viona.c","type":"MODIFIED","insertions":22,"deletions":-8}],"sizeInsertions":22,"sizeDeletions":-8}],"allReviewers":[{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}]}