{"project":"joyent/node-cueball","branch":"master","id":"I7de363ee3ca21a45f039b2628200258ab5941fc9","number":"1052","subject":"joyent/node-cueball#57 insomniac resolver leads to sadness after #54 Reviewed by: David Pacheco \u003cdap@joyent.com\u003e","owner":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"url":"https://cr.joyent.us/1052","commitMessage":"joyent/node-cueball#57 insomniac resolver leads to sadness after #54\nReviewed by: David Pacheco \u003cdap@joyent.com\u003e\n","createdOn":1480718501,"lastUpdated":1480722423,"open":false,"status":"MERGED","comments":[{"timestamp":1480718501,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 1."},{"timestamp":1480718539,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 2."},{"timestamp":1480718691,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1480718764,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 3."},{"timestamp":1480718921,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1480718997,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1480720137,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 3:\n\n(1 comment)"},{"timestamp":1480720412,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 3:\n\n(1 comment)"},{"timestamp":1480720789,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 4."},{"timestamp":1480721017,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1480721311,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 4: Code-Review+1"},{"timestamp":1480722421,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 4: Integration-Approval+1"},{"timestamp":1480722423,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Alex Wilson"}],"currentPatchSet":{"number":"4","revision":"7de363ee3ca21a45f039b2628200258ab5941fc9","parents":["7b0af8d7953dbe0222685c94c791b98703a5638c"],"ref":"refs/changes/52/1052/4","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1480720789,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1480721017,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1480721311,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1480722421,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"SUBM","value":"1","grantedOn":1480722423,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"lib/resolver.js","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/dns.test.js","type":"MODIFIED","insertions":1,"deletions":-2}],"sizeInsertions":11,"sizeDeletions":-4},"patchSets":[{"number":"1","revision":"cb357e69c19ec675d58d60f492136c537e0bcce5","parents":["7b0af8d7953dbe0222685c94c791b98703a5638c"],"ref":"refs/changes/52/1052/1","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1480718501,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1480718691,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/resolver.js","type":"MODIFIED","insertions":9,"deletions":-1}],"sizeInsertions":9,"sizeDeletions":-1},{"number":"2","revision":"29e0d8dbf42b0ead5a478f817474517345d52aad","parents":["7b0af8d7953dbe0222685c94c791b98703a5638c"],"ref":"refs/changes/52/1052/2","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1480718539,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1480718921,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/resolver.js","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":10,"sizeDeletions":-2},{"number":"3","revision":"b37e9b87fc6546d51598bdfd96b7244da63ce981","parents":["7b0af8d7953dbe0222685c94c791b98703a5638c"],"ref":"refs/changes/52/1052/3","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1480718764,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1480718997,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/resolver.js","line":493,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Should this use a generation counter or something more reliable like that?\n\nIs it worth adding an automated test for this?  Maybe by allowing the test to configure the cache time, triggering two calls through this function, ensuring that the second one skips the update, then waiting for the cache to expire, then triggering another update?  I did something like that in the marlin test suite before switching to cueball, though admittedly that test was occasionally flaky."},{"file":"lib/resolver.js","line":493,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"I think some degree of unreliability here is actually fine, in reality. If we miss the update the first time, it\u0027ll just be another TTL until we start using ipv6 after you add the first ipv6 address to the system (we\u0027ll see it next time instead). Really this code should never do anything interesting on any of our systems, as we don\u0027t add NICs or addresses after boot."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/resolver.js","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/dns.test.js","type":"MODIFIED","insertions":1,"deletions":-2}],"sizeInsertions":11,"sizeDeletions":-4},{"number":"4","revision":"7de363ee3ca21a45f039b2628200258ab5941fc9","parents":["7b0af8d7953dbe0222685c94c791b98703a5638c"],"ref":"refs/changes/52/1052/4","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1480720789,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1480721311,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1480722421,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"SUBM","value":"1","grantedOn":1480722423,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1480721017,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"lib/resolver.js","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/dns.test.js","type":"MODIFIED","insertions":1,"deletions":-2}],"sizeInsertions":11,"sizeDeletions":-4}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}]}