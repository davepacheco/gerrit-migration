{"project":"joyent/sdc-hermes","branch":"master","id":"If0f735856fee2d556377512f69d0c735f8f68354","number":"3217","subject":"AGENT-1089 Hermes should have option to delete files matching a pattern and not upload them to Manta Reviewed by: Pedro Palazón Candel \u003cpedro@joyent.com\u003e Approved by: Orlando Vazquez \u003corlando@joyent.com\u003e","owner":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"url":"https://cr.joyent.us/3217","commitMessage":"AGENT-1089 Hermes should have option to delete files matching a pattern and not upload them to Manta\nReviewed by: Pedro Palazón Candel \u003cpedro@joyent.com\u003e\nApproved by: Orlando Vazquez \u003corlando@joyent.com\u003e\n","createdOn":1516036768,"lastUpdated":1559665147,"open":false,"status":"MERGED","comments":[{"timestamp":1516036768,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Uploaded patch set 1."},{"timestamp":1516036769,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit c1cab6614a917cfad1c45a04ab6e7d841c534f22\n    \n    done?"},{"timestamp":1516036832,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing-1\n\n\"make check\" exited with status 2\n\n /tmp/repo/node/bin/node node_modules/.bin/jshint hermes.js proxy.js lib/httpserver.js lib/logsets.js lib/proxy_server.js lib/scripts.js lib/servers.js lib/zones.js lib/utils.js actor/actor.js actor/lib/cmd.js actor/lib/conn.js actor/lib/findstream.js actor/lib/logsets.js actor/lib/remember.js actor/lib/worker.js\n actor/lib/worker.js: line 131, col 11, Expected \u0027]\u0027 to match \u0027[\u0027 from line 115 and instead saw \u0027;\u0027.\n actor/lib/worker.js: line 132, col 2, Expected \u0027)\u0027 and instead saw \u0027;\u0027.\n actor/lib/worker.js: line 132, col 3, Missing semicolon.\n actor/lib/worker.js: line 166, col 2, Missing semicolon.\n actor/lib/worker.js: line 101, col 1, Unmatched \u0027{\u0027.\n actor/lib/worker.js: line 588, col 1, Unrecoverable syntax error. (100% scanned).\n \n 6 errors\n Makefile:101: recipe for target \u0027check\u0027 failed\n gmake: *** [check] Error 2"},{"timestamp":1516059243,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Patch Set 1:\n\n(7 comments)\n\nThis change looks like it\u0027s still under construction, but I figured I\u0027d give a couple of quick pointers to make it easer to see the style in the repo."},{"timestamp":1516900680,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Uploaded patch set 2."},{"timestamp":1516900681,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit d4b5dab97877b8d141c8e55c296ece7f3ffcc81a\n    \n    buffer \u0027ls\u0027 results\n    \n    commit d1ce94b10339c48c5bc96bf8fb3562f502f40b46\n    \n    wip"},{"timestamp":1516900747,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1519417331,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Uploaded patch set 3."},{"timestamp":1519417333,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Patch Set 3:\n\nNew commits:\n    \n    commit 03bddc23751fc7ee3b459e52cc1ee32b02d8ffd9\n    \n    Implement \u0027no_upload\u0027 and \u0027search_pattern\u0027 directives"},{"timestamp":1519419267,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Uploaded patch set 4."},{"timestamp":1519419269,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Patch Set 4:\n\nNew commits:\n    \n    commit d16c2a0aeef62aad274b45e81bc12dfce6471dec\n    \n    Implement \u0027no_upload\u0027 and \u0027search_pattern\u0027 directives"},{"timestamp":1519420384,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Uploaded patch set 5."},{"timestamp":1519420386,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Patch Set 5:\n\nNew commits:\n    \n    commit f83679c52ec92303f7484a8b47cce3a4702b9a8e\n    \n    please make check"},{"timestamp":1519423895,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Uploaded patch set 6."},{"timestamp":1519423897,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Patch Set 6:\n\nNew commits:\n    \n    commit 1b463774020381f661c98be1dc97118d29ee7b74\n    \n    Implement \u0027no_upload\u0027, \u0027search_pattern\u0027 directives\u0027"},{"timestamp":1519424842,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Uploaded patch set 7."},{"timestamp":1519424844,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Patch Set 7:\n\nNew commits:\n    \n    commit 7bc3493ac20a592f0a67410ad6a67ff32bbd9426\n    \n    Implement \u0027no_upload\u0027, \u0027search_pattern\u0027 directives\u0027"},{"timestamp":1519424909,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Uploaded patch set 8."},{"timestamp":1519424911,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Patch Set 8:\n\nNew commits:\n    \n    commit 7cfcf6ee9633619df504223a495a00a05f6bd9a4\n    \n    bump version and dates"},{"timestamp":1519665842,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Uploaded patch set 9."},{"timestamp":1519665844,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Patch Set 9:\n\nNew commits:\n    \n    commit e73c8fa1624ff49e7e19d5aa918aaa60b6c39b19\n    \n    maxBuffer: Infinity"},{"timestamp":1519686051,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Uploaded patch set 10."},{"timestamp":1519686053,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Patch Set 10:\n\nNew commits:\n    \n    commit c5c0f01bbe32b6b187f778eb49c0aace0e06cf10\n    \n    don\u0027t quote pattern\n    \n    commit d3175d14fecd710a29c61f373209266fc39a3a0b\n    \n    filename was duplicated"},{"timestamp":1519687806,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Uploaded patch set 11."},{"timestamp":1519687808,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Patch Set 11:\n\nNew commits:\n    \n    commit dbb9e6a1270e210b11e1b9cdf6de808ab1f04e31\n    \n    lint"},{"timestamp":1519694120,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Uploaded patch set 12."},{"timestamp":1519694122,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Patch Set 12:\n\nNew commits:\n    \n    commit 7fd76a003ab8d62b29db4ab8af59d1a0ea146d71\n    \n    fix indentation"},{"timestamp":1519694169,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Uploaded patch set 13."},{"timestamp":1519694171,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Patch Set 13:\n\nNew commits:\n    \n    commit 8fd99417e06a08ef53505a02b93eb992811ccb2b\n    \n    fix indentation"},{"timestamp":1519751426,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 13: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1521067764,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Patch Set 13:\n\n(14 comments)\n\nHi Orlando,\n\nI\u0027ve done a first review pass and I have some questions."},{"timestamp":1521477658,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Uploaded patch set 14."},{"timestamp":1521477659,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Patch Set 14:\n\nNew commits:\n    \n    commit 1af8323f02b783ff92ac70b370d17d962fa49afb\n    \n    Update with jclulow\u0027s feedback"},{"timestamp":1521477728,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 14: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1521480076,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Patch Set 14:\n\n(14 comments)"},{"timestamp":1556042321,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Uploaded patch set 15."},{"timestamp":1556042322,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Patch Set 15:\n\nNew commits:\n    \n    commit 9be4a1ec449586b8247f575af3a2c282ace90f33\n    \n    Update with jclulow\u0027s feedback\n    \n    commit 3438429797b209577052ed8fa076c160a7663c44\n    \n    fix indentation\n    \n    commit 1223073ec93320790e85b0c7be3fcc7ad1e701e6\n    \n    fix indentation\n    \n    commit 07f2a3b0d8fdfbd8bf8e8fca3a46a5bf1d5eb495\n    \n    lint\n    \n    commit 3a55e2cac46e830fcc597f64ef576471b7a67f0a\n    \n    don\u0027t quote pattern\n    \n    commit 6979828c2f3f0822e3a9f18a3ec555afd42fcbbf\n    \n    filename was duplicated\n    \n    commit 75fec2665141b17a12ffa4364109550f021e0049\n    \n    maxBuffer: Infinity\n    \n    commit 81cd190bd1caa695821d2f1556fb01ddcbaab7ba\n    \n    bump version and dates\n    \n    commit 97a6592dc5480e397ce05c106be41bf276b27639\n    \n    Implement \u0027no_upload\u0027, \u0027search_pattern\u0027 directives\u0027"},{"timestamp":1556042377,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 15: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1556043573,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Uploaded patch set 16."},{"timestamp":1556043574,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Patch Set 16:\n\nNew commits:\n    \n    commit 441e6b5617c3fb7632a2ba670928d733872b57bb\n    \n    Implement \u0027no_upload\u0027, \u0027search_pattern\u0027 directives\u0027"},{"timestamp":1556043635,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 16: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1557329685,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Uploaded patch set 17."},{"timestamp":1557329686,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Patch Set 17:\n\nNew commits:\n    \n    commit 9157e0158eb76ca2b9ea882166a1e2dcf8a6dbb0\n    \n    Implement \u0027no_upload\u0027, \u0027search_pattern\u0027 directives\u0027"},{"timestamp":1557329750,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 17: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1558368587,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 17: Code-Review+1"},{"timestamp":1559665026,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Patch Set 17: Integration-Approval+1"},{"timestamp":1559665033,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Uploaded patch set 18: Commit message was updated."},{"timestamp":1559665147,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Orlando Vazquez"}],"currentPatchSet":{"number":"18","revision":"f0f735856fee2d556377512f69d0c735f8f68354","parents":["73063d9fe9399b927c621df16e473503f373e0fe"],"ref":"refs/changes/17/3217/18","uploader":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"createdOn":1559665033,"author":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1557329750,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1558368587,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1559665026,"by":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"}},{"type":"SUBM","value":"1","grantedOn":1559665147,"by":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"actor/lib/listglob.js","type":"ADDED","insertions":60,"deletions":0},{"file":"actor/lib/worker.js","type":"MODIFIED","insertions":79,"deletions":-22},{"file":"lib/logsets.js","type":"MODIFIED","insertions":9,"deletions":-4},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":149,"sizeDeletions":-27},"patchSets":[{"number":"1","revision":"0b8f555999588503db0ec65c72075061b4f684c8","parents":["80fc318b433cdf63fbd9f7317453d8300a980096"],"ref":"refs/changes/17/3217/1","uploader":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"createdOn":1516036768,"author":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1516036832,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"actor/lib/findstream.js","line":17,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Can you make this \"lib_statstream\" instead?  Other files in this repository are using the \"lib_\" prefix to distinguish in-repo modules vs dependencies pulled in from NPM."},{"file":"actor/lib/globstream.js","line":18,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"\"lib_statstream\", as per other comment."},{"file":"actor/lib/globstream.js","line":38,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"It\u0027s probably worth using the \"-U\" flag to \"ls\" as well.  This prevents \"ls\" from loading the entire directory into memory and sorting it for display."},{"file":"actor/lib/globstream.js","line":65,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Continuations like this should come out to the existing indentation level using tabs, and then an additional 4 spaces."},{"file":"actor/lib/globstream.js","line":86,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"The period, as an operator, should go on the end of the previous line."},{"file":"actor/lib/globstream.js","line":115,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"4 spaces"},{"file":"actor/lib/worker.js","line":269,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"I would remove the underscore here.  The only reason there\u0027s one on the front of \"_delete\" is because \"delete\" is a Javascript operator."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"actor/lib/findstream.js","type":"MODIFIED","insertions":5,"deletions":-45},{"file":"actor/lib/globstream.js","type":"ADDED","insertions":130,"deletions":0},{"file":"actor/lib/statstream.js","type":"ADDED","insertions":58,"deletions":0},{"file":"actor/lib/worker.js","type":"MODIFIED","insertions":44,"deletions":-20},{"file":"lib/logsets.js","type":"MODIFIED","insertions":4,"deletions":-1}],"sizeInsertions":241,"sizeDeletions":-66},{"number":"2","revision":"caef6bd5d3ddd6dbbc41d9471fe48b6e4656bd48","parents":["80fc318b433cdf63fbd9f7317453d8300a980096"],"ref":"refs/changes/17/3217/2","uploader":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"createdOn":1516900680,"author":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1516900747,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"actor/lib/findstream.js","type":"MODIFIED","insertions":5,"deletions":-45},{"file":"actor/lib/globstream.js","type":"ADDED","insertions":49,"deletions":0},{"file":"actor/lib/statstream.js","type":"ADDED","insertions":58,"deletions":0},{"file":"actor/lib/worker.js","type":"MODIFIED","insertions":61,"deletions":-19},{"file":"lib/logsets.js","type":"MODIFIED","insertions":4,"deletions":-1}],"sizeInsertions":177,"sizeDeletions":-65},{"number":"3","revision":"ac067250745c71867a02d6f4e0371abac203facf","parents":["80fc318b433cdf63fbd9f7317453d8300a980096"],"ref":"refs/changes/17/3217/3","uploader":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"createdOn":1519417331,"author":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"actor/lib/findstream.js","type":"MODIFIED","insertions":5,"deletions":-45},{"file":"actor/lib/listglob.js","type":"ADDED","insertions":53,"deletions":0},{"file":"actor/lib/statstream.js","type":"ADDED","insertions":58,"deletions":0},{"file":"actor/lib/worker.js","type":"MODIFIED","insertions":76,"deletions":-22},{"file":"lib/logsets.js","type":"MODIFIED","insertions":5,"deletions":-1}],"sizeInsertions":197,"sizeDeletions":-68},{"number":"4","revision":"350b9a44089843ce2cc1d31e8c87894667f0f17b","parents":["80fc318b433cdf63fbd9f7317453d8300a980096"],"ref":"refs/changes/17/3217/4","uploader":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"createdOn":1519419267,"author":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"actor/lib/findstream.js","type":"MODIFIED","insertions":5,"deletions":-45},{"file":"actor/lib/listglob.js","type":"ADDED","insertions":53,"deletions":0},{"file":"actor/lib/statstream.js","type":"ADDED","insertions":58,"deletions":0},{"file":"actor/lib/worker.js","type":"MODIFIED","insertions":84,"deletions":-22},{"file":"lib/logsets.js","type":"MODIFIED","insertions":5,"deletions":-1}],"sizeInsertions":205,"sizeDeletions":-68},{"number":"5","revision":"e61e45321ebd702477f0911a8dffaddf377e6ac0","parents":["80fc318b433cdf63fbd9f7317453d8300a980096"],"ref":"refs/changes/17/3217/5","uploader":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"createdOn":1519420384,"author":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"actor/lib/findstream.js","type":"MODIFIED","insertions":5,"deletions":-45},{"file":"actor/lib/listglob.js","type":"ADDED","insertions":52,"deletions":0},{"file":"actor/lib/statstream.js","type":"ADDED","insertions":58,"deletions":0},{"file":"actor/lib/worker.js","type":"MODIFIED","insertions":83,"deletions":-22},{"file":"lib/logsets.js","type":"MODIFIED","insertions":5,"deletions":-1}],"sizeInsertions":203,"sizeDeletions":-68},{"number":"6","revision":"944be2275ef4802d4d66a6c898a98ef8fc84c32b","parents":["80fc318b433cdf63fbd9f7317453d8300a980096"],"ref":"refs/changes/17/3217/6","uploader":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"createdOn":1519423895,"author":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"actor/lib/listglob.js","type":"ADDED","insertions":52,"deletions":0},{"file":"actor/lib/worker.js","type":"MODIFIED","insertions":83,"deletions":-22},{"file":"lib/logsets.js","type":"MODIFIED","insertions":5,"deletions":-1}],"sizeInsertions":140,"sizeDeletions":-23},{"number":"7","revision":"5224a84fb345165683049240a9e3eb8099783c5c","parents":["80fc318b433cdf63fbd9f7317453d8300a980096"],"ref":"refs/changes/17/3217/7","uploader":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"createdOn":1519424842,"author":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"actor/lib/listglob.js","type":"ADDED","insertions":52,"deletions":0},{"file":"actor/lib/worker.js","type":"MODIFIED","insertions":80,"deletions":-22},{"file":"lib/logsets.js","type":"MODIFIED","insertions":5,"deletions":-1}],"sizeInsertions":137,"sizeDeletions":-23},{"number":"8","revision":"e2dd6806f9fc6d606f38b30d5551758f11f71361","parents":["80fc318b433cdf63fbd9f7317453d8300a980096"],"ref":"refs/changes/17/3217/8","uploader":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"createdOn":1519424909,"author":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"actor/lib/listglob.js","type":"ADDED","insertions":52,"deletions":0},{"file":"actor/lib/worker.js","type":"MODIFIED","insertions":81,"deletions":-23},{"file":"lib/logsets.js","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":140,"sizeDeletions":-26},{"number":"9","revision":"8743bee8ad7f0ef0f014cb6017d42688470994fe","parents":["80fc318b433cdf63fbd9f7317453d8300a980096"],"ref":"refs/changes/17/3217/9","uploader":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"createdOn":1519665842,"author":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"actor/lib/listglob.js","type":"ADDED","insertions":53,"deletions":0},{"file":"actor/lib/worker.js","type":"MODIFIED","insertions":81,"deletions":-23},{"file":"lib/logsets.js","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":141,"sizeDeletions":-26},{"number":"10","revision":"a799c7cca0599e2a9b456cb23d32d3d18ddd2b2f","parents":["80fc318b433cdf63fbd9f7317453d8300a980096"],"ref":"refs/changes/17/3217/10","uploader":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"createdOn":1519686051,"author":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"actor/lib/listglob.js","type":"ADDED","insertions":55,"deletions":0},{"file":"actor/lib/worker.js","type":"MODIFIED","insertions":81,"deletions":-23},{"file":"lib/logsets.js","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":143,"sizeDeletions":-26},{"number":"11","revision":"d54da8dfeed856bb6f306dd1f8bbe45bdcf82d20","parents":["80fc318b433cdf63fbd9f7317453d8300a980096"],"ref":"refs/changes/17/3217/11","uploader":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"createdOn":1519687806,"author":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"actor/lib/listglob.js","type":"ADDED","insertions":59,"deletions":0},{"file":"actor/lib/worker.js","type":"MODIFIED","insertions":83,"deletions":-23},{"file":"lib/logsets.js","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":149,"sizeDeletions":-26},{"number":"12","revision":"bb7c331e8fde73c5fb1f014c7da85cdc5a36ab0e","parents":["80fc318b433cdf63fbd9f7317453d8300a980096"],"ref":"refs/changes/17/3217/12","uploader":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"createdOn":1519694120,"author":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"actor/lib/listglob.js","type":"ADDED","insertions":59,"deletions":0},{"file":"actor/lib/worker.js","type":"MODIFIED","insertions":83,"deletions":-23},{"file":"lib/logsets.js","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":149,"sizeDeletions":-26},{"number":"13","revision":"e1b8bb054d2cc8e6623a01f771da435f2d746e7a","parents":["80fc318b433cdf63fbd9f7317453d8300a980096"],"ref":"refs/changes/17/3217/13","uploader":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"createdOn":1519694169,"author":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1519751426,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"actor/lib/listglob.js","line":19,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"One reason I built \"FindStream\" is because Hermes used to use \"ls\" to discover log files, but in some cases there were a _lot_ of log files and storing the full list in memory before making any archival progress was an issue.  Do we know that that constraint doesn\u0027t apply here?"},{"file":"actor/lib/listglob.js","line":19,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"My first stab at this was with a streams interface, but I was put off by the resulting complexity introduced. Buffering in memory half a megabyte on a system with 10K matches doesn\u0027t seem too onerous..."},{"file":"actor/lib/listglob.js","line":21,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Can we make this \"list_glob\" for consistency with the rest of the codebase here?"},{"file":"actor/lib/listglob.js","line":21,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Done"},{"file":"actor/lib/listglob.js","line":36,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"This doesn\u0027t seem like a good idea.  Can we constrain it to some reasonable value -- perhaps 1MB?"},{"file":"actor/lib/listglob.js","line":36,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Done"},{"file":"actor/lib/listglob.js","line":39,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"What happens if \"pattern\" contains a space, or some other sequence that confuses the shell?  In the degenerate case, what if somebody specifies:\n\n    \"search_pattern\": \"/* zones/logs/*\""},{"file":"actor/lib/listglob.js","line":39,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Good call, I forgot about the funny edge cases caused by handling spaces AND globs. Done."},{"file":"actor/lib/worker.js","line":115,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"I don\u0027t think this really needs to be a pipeline?  There\u0027s only one function to call here."},{"file":"actor/lib/worker.js","line":115,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"True. But on line 121 we check if there\u0027s a search_pattern and skip if not. We always want to run the code in the final block of the vasync pipeline. I think I can get by without the pipeline but it just felt a bit more awkward but it\u0027s ok."},{"file":"actor/lib/worker.js","line":128,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"What errors are we swallowing here?"},{"file":"actor/lib/worker.js","line":128,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Good catch, I think I meant to log an error (but continue) here."},{"file":"actor/lib/worker.js","line":136,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"I think this actually ends up altering the \"search_dirs\" property on the copy stored in LOGSETS in \"actor/lib/logsets.js\"?  Perhaps we should use \"mod_jsprim.deepCopy()\" in the constructor when we assign \"lsw_logsets\", or use a copy of \"search_dirs\" within this set of functions."},{"file":"actor/lib/worker.js","line":136,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Done"},{"file":"actor/lib/worker.js","line":166,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"We should probably assert the type of this parameter.  (arrayOfString?)"},{"file":"actor/lib/worker.js","line":166,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Done"},{"file":"actor/lib/worker.js","line":168,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"tabs for indentation here"},{"file":"actor/lib/worker.js","line":168,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Done"},{"file":"actor/lib/worker.js","line":303,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Perhaps this should be a DEBUG-level log message?"},{"file":"actor/lib/worker.js","line":303,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Done"},{"file":"actor/lib/worker.js","line":542,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Indentation should be tabs here."},{"file":"actor/lib/worker.js","line":542,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Done"},{"file":"actor/lib/worker.js","line":566,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"I think it\u0027d be good to start asserting the types of these positional arguments now that they\u0027re changing and there are a bunch, with my apologies for not having done it in the original code."},{"file":"actor/lib/worker.js","line":566,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Totally agree, I\u0027m working on getting in the habit myself. Done."},{"file":"lib/logsets.js","line":31,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Should we make this \"search_dirs_pattern\", to make clear that it\u0027s for the construction of \"search_dirs\" rather than somehow replacing the search mechanism altogether?  Also, does it make sense to go straight to an _array_ of strings here, in case we need to add another pattern to this logset later? e.g.,\n\n    \"search_dirs_patterns\": [ \"/zones/*/logs\", \"/zones/*/other/special/logs\" ]"},{"file":"lib/logsets.js","line":31,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Suggestion 1: Done\n\nSuggestion 2: I went back and forth on this one for a while since initially it seemed like it might be useful to be able to support expand multiple patterns, but when I started to think about it I couldn\u0027t think of any cases where I would have wanted to be able to specify multiple search_patterns, but use a single regex match results found by the expanded globs. Am I missing a possible use-case\"?"},{"file":"package.json","line":3,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"I think this should be a minor roll (i.e., 0.3.0) because it\u0027s a new feature, not a bug fix."},{"file":"package.json","line":3,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"actor/lib/listglob.js","type":"ADDED","insertions":59,"deletions":0},{"file":"actor/lib/worker.js","type":"MODIFIED","insertions":83,"deletions":-23},{"file":"lib/logsets.js","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":149,"sizeDeletions":-26},{"number":"14","revision":"6d195da2afc3ae3019afafa5deb4c24f80787c85","parents":["80fc318b433cdf63fbd9f7317453d8300a980096"],"ref":"refs/changes/17/3217/14","uploader":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"createdOn":1521477658,"author":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1521477728,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"actor/lib/listglob.js","type":"ADDED","insertions":60,"deletions":0},{"file":"actor/lib/worker.js","type":"MODIFIED","insertions":83,"deletions":-25},{"file":"lib/logsets.js","type":"MODIFIED","insertions":9,"deletions":-4},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":153,"sizeDeletions":-30},{"number":"15","revision":"fd02ad8329771fc62d9dbbc1ae7cabbfe5d0a5c4","parents":["9e0fa93835c77400f773624ef657dd4aed6751a9"],"ref":"refs/changes/17/3217/15","uploader":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"createdOn":1556042321,"author":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1556042377,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"actor/lib/listglob.js","type":"ADDED","insertions":60,"deletions":0},{"file":"actor/lib/worker.js","type":"MODIFIED","insertions":79,"deletions":-22},{"file":"lib/logsets.js","type":"MODIFIED","insertions":9,"deletions":-4},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":149,"sizeDeletions":-27},{"number":"16","revision":"caae38733c38f111672a31f12642d5a85f950b09","parents":["9e0fa93835c77400f773624ef657dd4aed6751a9"],"ref":"refs/changes/17/3217/16","uploader":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"createdOn":1556043573,"author":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1556043635,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"actor/lib/listglob.js","type":"ADDED","insertions":60,"deletions":0},{"file":"actor/lib/worker.js","type":"MODIFIED","insertions":79,"deletions":-22},{"file":"lib/logsets.js","type":"MODIFIED","insertions":9,"deletions":-4},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":149,"sizeDeletions":-27},{"number":"17","revision":"803ec7e88b3fddf322b5f72fca74786661d73b17","parents":["73063d9fe9399b927c621df16e473503f373e0fe"],"ref":"refs/changes/17/3217/17","uploader":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"createdOn":1557329685,"author":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1557329750,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1558368587,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1559665026,"by":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"actor/lib/listglob.js","type":"ADDED","insertions":60,"deletions":0},{"file":"actor/lib/worker.js","type":"MODIFIED","insertions":79,"deletions":-22},{"file":"lib/logsets.js","type":"MODIFIED","insertions":9,"deletions":-4},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":149,"sizeDeletions":-27},{"number":"18","revision":"f0f735856fee2d556377512f69d0c735f8f68354","parents":["73063d9fe9399b927c621df16e473503f373e0fe"],"ref":"refs/changes/17/3217/18","uploader":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"createdOn":1559665033,"author":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1557329750,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1558368587,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1559665026,"by":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"}},{"type":"SUBM","value":"1","grantedOn":1559665147,"by":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"actor/lib/listglob.js","type":"ADDED","insertions":60,"deletions":0},{"file":"actor/lib/worker.js","type":"MODIFIED","insertions":79,"deletions":-22},{"file":"lib/logsets.js","type":"MODIFIED","insertions":9,"deletions":-4},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":149,"sizeDeletions":-27}],"allReviewers":[{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"}]}