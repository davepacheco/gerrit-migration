{"project":"joyent/smartos-live","branch":"master","id":"Idd0ce61847f3b4bb4d6a4d114a79ff53a17eaa14","number":"5095","subject":"OS-7351 VM.create should allow disk with image to be grown Reviewed by: Marsell Kukuljevic \u003cmarsell@joyent.com\u003e Reviewed by: Pedro Palazon Candel \u003cpedro@joyent.com\u003e Approved by: Marsell Kukuljevic \u003cmarsell@joyent.com\u003e Approved by: Pedro Palazon Candel \u003cpe","owner":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"url":"https://cr.joyent.us/5095","commitMessage":"OS-7351 VM.create should allow disk with image to be grown\nReviewed by: Marsell Kukuljevic \u003cmarsell@joyent.com\u003e\nReviewed by: Pedro Palazon Candel \u003cpedro@joyent.com\u003e\nApproved by: Marsell Kukuljevic \u003cmarsell@joyent.com\u003e\nApproved by: Pedro Palazon Candel \u003cpedro@joyent.com\u003e\n","createdOn":1542841738,"lastUpdated":1543507953,"open":false,"status":"MERGED","comments":[{"timestamp":1542841738,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Uploaded patch set 1."},{"timestamp":1542841792,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1542843579,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1543001177,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 1: Code-Review+1\n\n(3 comments)\n\nOther than some minor observation regarding when to define a variable, this LGTM"},{"timestamp":1543249049,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 1:\n\n(3 comments)"},{"timestamp":1543249063,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Uploaded patch set 2."},{"timestamp":1543249151,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1543313514,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 2:\n\n(4 comments)\n\nLGTM. I\u0027d mainly like to know what\u0027s going on at line 225 in the tests."},{"timestamp":1543419489,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 2: Code-Review+1\n\nWhat Marsell says!"},{"timestamp":1543447309,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Uploaded patch set 3."},{"timestamp":1543447321,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 2:\n\n(4 comments)"},{"timestamp":1543447364,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1543447998,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 3: Code-Review+1 Integration-Approval+1\n\n(1 comment)\n\nLGTM"},{"timestamp":1543504642,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 3: Code-Review+1 Integration-Approval+1\n\nLGTM"},{"timestamp":1543504692,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 4: Patch Set 3 was rebased"},{"timestamp":1543504752,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4:\n\n\"make check\" passed ok"},{"timestamp":1543507886,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 5: Commit message was updated."},{"timestamp":1543507897,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 6: Patch Set 5 was rebased"},{"timestamp":1543507912,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Mike Gerdts"},{"timestamp":1543507953,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 6:\n\n\"make check\" passed ok"}],"currentPatchSet":{"number":"6","revision":"466f00ae497b80384d8aaf99cef47dc358881a2a","parents":["fd4a593a9da1bad19001c2534f824e0ce089bc9e"],"ref":"refs/changes/95/5095/6","uploader":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"createdOn":1543507897,"author":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1543447364,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1543447998,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1543447998,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1543504642,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1543504642,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"SUBM","value":"1","grantedOn":1543507912,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"src/Makefile","type":"MODIFIED","insertions":1,"deletions":0},{"file":"src/vm/node_modules/VM.js","type":"MODIFIED","insertions":9,"deletions":0},{"file":"src/vm/tests/test-bhyve-disk-resize.js","type":"ADDED","insertions":298,"deletions":0}],"sizeInsertions":308,"sizeDeletions":0},"patchSets":[{"number":"1","revision":"c69db84b3c25f70b39c50b3fd508b452114e2836","parents":["8a53b52438a53d661577a290a5f786736bf7d717"],"ref":"refs/changes/95/5095/1","uploader":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"createdOn":1542841738,"author":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1542841792,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1543001177,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"comments":[{"file":"src/vm/tests/test-bhyve-disk-resize.js","line":1,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"This file is probably a little heavy for what is being tested, but it will likely get more tests as I work on OS-7352.  Some of this is just copied from OS-7353, indicating that once OS-7353 lands I can dedup some of this into a common file."},{"file":"src/vm/tests/test-bhyve-disk-resize.js","line":70,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Where is `vmobj` var first set?"},{"file":"src/vm/tests/test-bhyve-disk-resize.js","line":70,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"It is set by before().  See line 212."},{"file":"src/vm/tests/test-bhyve-disk-resize.js","line":182,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Same, where is the `vmobj` variable set the first time?"},{"file":"src/vm/tests/test-bhyve-disk-resize.js","line":182,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Same answer.  :)"},{"file":"src/vm/tests/test-bhyve-disk-resize.js","line":209,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"For the same price you can define this at the top of the file, and make linters present and future happier!"},{"file":"src/vm/tests/test-bhyve-disk-resize.js","line":209,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/Makefile","type":"MODIFIED","insertions":1,"deletions":0},{"file":"src/vm/node_modules/VM.js","type":"MODIFIED","insertions":9,"deletions":0},{"file":"src/vm/tests/test-bhyve-disk-resize.js","type":"ADDED","insertions":288,"deletions":0}],"sizeInsertions":298,"sizeDeletions":0},{"number":"2","revision":"5ade7d2738dc231678e2ce70f6a4a3709398ca8b","parents":["8a53b52438a53d661577a290a5f786736bf7d717"],"ref":"refs/changes/95/5095/2","uploader":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"createdOn":1543249063,"author":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1543249151,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1543419489,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"comments":[{"file":"src/vm/tests/test-bhyve-disk-resize.js","line":167,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"This is pure bike-shedding, but this is a good fit for haves.filter(). It\u0027d knock one level of indentation off too."},{"file":"src/vm/tests/test-bhyve-disk-resize.js","line":167,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"What I came up with didn\u0027t knock off a level of indentation, so perhaps I missed the mark.  More verbose suggestions welcome."},{"file":"src/vm/tests/test-bhyve-disk-resize.js","line":167,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Oh, you\u0027re right. I was assuming the path was unique, in which case:\n\nvar found \u003d haves.filter(function filter_disks(have) {\n    return path \u003d\u003d have.path;\n})[0];\n\nt.ok(found, \u0027disk\u0027 + path + \u0027 found\u0027);\nif (!found) {\n    errors++;\n    return;\n}\n\nObject.keys(want).forEach(function _check_prop(prop) {\n    var haveval \u003d found[prop];\n    \u003c...\u003e\n});"},{"file":"src/vm/tests/test-bhyve-disk-resize.js","line":174,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"I think this would be a tad easier to read if have[prop] and want[prop] were assigned to their own vars beforehand."},{"file":"src/vm/tests/test-bhyve-disk-resize.js","line":174,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Done"},{"file":"src/vm/tests/test-bhyve-disk-resize.js","line":214,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"This is easy to misinterpret (I did!). I suggest:\n\nThis is a stub. We load() the full object below to see if it was really created."},{"file":"src/vm/tests/test-bhyve-disk-resize.js","line":214,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Done"},{"file":"src/vm/tests/test-bhyve-disk-resize.js","line":225,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Typo?"},{"file":"src/vm/tests/test-bhyve-disk-resize.js","line":225,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/Makefile","type":"MODIFIED","insertions":1,"deletions":0},{"file":"src/vm/node_modules/VM.js","type":"MODIFIED","insertions":9,"deletions":0},{"file":"src/vm/tests/test-bhyve-disk-resize.js","type":"ADDED","insertions":297,"deletions":0}],"sizeInsertions":307,"sizeDeletions":0},{"number":"3","revision":"dd0ce61847f3b4bb4d6a4d114a79ff53a17eaa14","parents":["8a53b52438a53d661577a290a5f786736bf7d717"],"ref":"refs/changes/95/5095/3","uploader":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"createdOn":1543447309,"author":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1543447364,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1543504642,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1543504642,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1543447998,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1543447998,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/Makefile","type":"MODIFIED","insertions":1,"deletions":0},{"file":"src/vm/node_modules/VM.js","type":"MODIFIED","insertions":9,"deletions":0},{"file":"src/vm/tests/test-bhyve-disk-resize.js","type":"ADDED","insertions":298,"deletions":0}],"sizeInsertions":308,"sizeDeletions":0},{"number":"4","revision":"49b7192ef84cee26eb757ab1808ccc43b089fa9c","parents":["0601b9afe57530289229880c4898300424326554"],"ref":"refs/changes/95/5095/4","uploader":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"createdOn":1543504692,"author":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1543447364,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1543504642,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1543504642,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1543447998,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1543447998,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/Makefile","type":"MODIFIED","insertions":1,"deletions":0},{"file":"src/vm/node_modules/VM.js","type":"MODIFIED","insertions":9,"deletions":0},{"file":"src/vm/tests/test-bhyve-disk-resize.js","type":"ADDED","insertions":298,"deletions":0}],"sizeInsertions":308,"sizeDeletions":0},{"number":"5","revision":"d7100bef6c89755d8a3349556b4b1c8885db41ab","parents":["0601b9afe57530289229880c4898300424326554"],"ref":"refs/changes/95/5095/5","uploader":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"createdOn":1543507886,"author":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1543447364,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1543504642,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1543504642,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1543447998,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1543447998,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"src/Makefile","type":"MODIFIED","insertions":1,"deletions":0},{"file":"src/vm/node_modules/VM.js","type":"MODIFIED","insertions":9,"deletions":0},{"file":"src/vm/tests/test-bhyve-disk-resize.js","type":"ADDED","insertions":298,"deletions":0}],"sizeInsertions":308,"sizeDeletions":0},{"number":"6","revision":"466f00ae497b80384d8aaf99cef47dc358881a2a","parents":["fd4a593a9da1bad19001c2534f824e0ce089bc9e"],"ref":"refs/changes/95/5095/6","uploader":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"createdOn":1543507897,"author":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1543447364,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1543504642,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1543504642,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1543447998,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1543447998,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}},{"type":"SUBM","value":"1","grantedOn":1543507912,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"src/Makefile","type":"MODIFIED","insertions":1,"deletions":0},{"file":"src/vm/node_modules/VM.js","type":"MODIFIED","insertions":9,"deletions":0},{"file":"src/vm/tests/test-bhyve-disk-resize.js","type":"ADDED","insertions":298,"deletions":0}],"sizeInsertions":308,"sizeDeletions":0}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}]}