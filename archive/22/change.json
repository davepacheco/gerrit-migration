{"project":"play-node-cueball","branch":"master","id":"I2792b1f0aa473416316a22e3f30cad644f726608","number":"22","subject":"wip: new resolver fsm","owner":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"url":"https://cr.joyent.us/22","commitMessage":"wip: new resolver fsm\n","createdOn":1467240205,"lastUpdated":1467848878,"open":false,"status":"ABANDONED","comments":[{"timestamp":1467240205,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 1."},{"timestamp":1467240441,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 2."},{"timestamp":1467240483,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 2:\n\nRe-arranged the README a little so that events are always at the bottom, added doco for getLastError() method"},{"timestamp":1467312551,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 2:\n\n(6 comments)"},{"timestamp":1467326693,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 2:\n\nTest comment?"},{"timestamp":1467326935,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 2:\n\nSorry for the tests."},{"timestamp":1467327807,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 2:\n\nThis comment should generate an email."},{"timestamp":1467831582,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 3."},{"timestamp":1467832205,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 3: Cherry Picked\n\nThis patchset was cherry picked to branch master as commit 73a65dcb9d93fd3e3822fa249722886050ff1602"},{"timestamp":1467832373,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 4: Commit message was updated."},{"timestamp":1467832390,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 5: Commit message was updated."},{"timestamp":1467832562,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 6: Commit message was updated."},{"timestamp":1467837641,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 2:\n\n(6 comments)"},{"timestamp":1467847187,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 6: Code-Review+1"},{"timestamp":1467848878,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Abandoned\n\nre-cast as https://cr.joyent.us/41"}],"currentPatchSet":{"number":"6","revision":"2792b1f0aa473416316a22e3f30cad644f726608","parents":["5a355daedfbb2fd2a7eacd6cb8d448ae3589e4d8"],"ref":"refs/changes/22/22/6","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1467832562,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1467847187,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":91,"deletions":-27},{"file":"bin/cbresolve","type":"MODIFIED","insertions":12,"deletions":-5},{"file":"lib/resolver.js","type":"MODIFIED","insertions":128,"deletions":-33},{"file":"test/pool.test.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"test/resolver_for.test.js","type":"MODIFIED","insertions":7,"deletions":-5},{"file":"test/resolver_static.test.js","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":242,"sizeDeletions":-73},"patchSets":[{"number":"1","revision":"a77bcb89fd42685cf359d58474c9a65aa7eb3cf9","parents":["5a355daedfbb2fd2a7eacd6cb8d448ae3589e4d8"],"ref":"refs/changes/22/22/1","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1467240205,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":85,"deletions":-27},{"file":"bin/cbresolve","type":"MODIFIED","insertions":12,"deletions":-5},{"file":"lib/resolver.js","type":"MODIFIED","insertions":129,"deletions":-31},{"file":"test/pool.test.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"test/resolver_for.test.js","type":"MODIFIED","insertions":7,"deletions":-5},{"file":"test/resolver_static.test.js","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":237,"sizeDeletions":-71},{"number":"2","revision":"548faf31022f46cdcb4519cea6fc921154d5d7bf","parents":["5a355daedfbb2fd2a7eacd6cb8d448ae3589e4d8"],"ref":"refs/changes/22/22/2","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1467240441,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","comments":[{"file":"bin/cbresolve","line":350,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"This is fine, but I don\u0027t think it\u0027s really worthwhile.  You can set the pseudo-Joyent-standard LOG_LEVEL property to get verbose logs if you want.  (I\u0027m only thinking of the sprawl of undocumented envvars.)"},{"file":"bin/cbresolve","line":350,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"All node-cmdln things use the \"DEBUG\" env var for whether they\u0027re going to output the stack of an exception or not, so I\u0027m moving it to this pseudo-standard (works on node-smartdc, node-manta etc)"},{"file":"bin/cbresolve","line":353,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"What does the error message actually say here?"},{"file":"bin/cbresolve","line":353,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Done"},{"file":"lib/resolver.js","line":12,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Is it worth a comment explaining that some of these are around primarily for compatibility?"},{"file":"lib/resolver.js","line":12,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Done"},{"file":"lib/resolver.js","line":64,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"FYI: If you don\u0027t use the second argument in the assert-plus type functions, it throws \"undefined\" into the message.  That said, I also find it redundant, so do what you will."},{"file":"lib/resolver.js","line":64,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Done"},{"file":"lib/resolver.js","line":251,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"The pattern of returning some other object from the constructor feels a little surprising."},{"file":"lib/resolver.js","line":251,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"It is, but instanceof is broken in node.js anyway (because of npm) and .constructor.name is already different to what the user is going to give to \"new\" anyway (it has CueBall in front). I think we should encourage the use of resolverForIpOrDomain as the normal way to use cueball anyway (it\u0027s less surprising for a factory function to do this), but I don\u0027t think we\u0027re actually losing much."},{"file":"lib/resolver.js","line":647,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"You could construct the error first and then just log that."},{"file":"lib/resolver.js","line":647,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":91,"deletions":-27},{"file":"bin/cbresolve","type":"MODIFIED","insertions":12,"deletions":-5},{"file":"lib/resolver.js","type":"MODIFIED","insertions":129,"deletions":-31},{"file":"test/pool.test.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"test/resolver_for.test.js","type":"MODIFIED","insertions":7,"deletions":-5},{"file":"test/resolver_static.test.js","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":243,"sizeDeletions":-71},{"number":"3","revision":"c4e5d41c57a4813f3900e6f5b082e3b046effe6c","parents":["5a355daedfbb2fd2a7eacd6cb8d448ae3589e4d8"],"ref":"refs/changes/22/22/3","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1467831582,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":91,"deletions":-27},{"file":"bin/cbresolve","type":"MODIFIED","insertions":12,"deletions":-5},{"file":"lib/resolver.js","type":"MODIFIED","insertions":128,"deletions":-33},{"file":"test/pool.test.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"test/resolver_for.test.js","type":"MODIFIED","insertions":7,"deletions":-5},{"file":"test/resolver_static.test.js","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":242,"sizeDeletions":-73},{"number":"4","revision":"96e9d08baa22872b2fe4bf88dae5a6ae41808902","parents":["5a355daedfbb2fd2a7eacd6cb8d448ae3589e4d8"],"ref":"refs/changes/22/22/4","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1467832373,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"NO_CODE_CHANGE","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":91,"deletions":-27},{"file":"bin/cbresolve","type":"MODIFIED","insertions":12,"deletions":-5},{"file":"lib/resolver.js","type":"MODIFIED","insertions":128,"deletions":-33},{"file":"test/pool.test.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"test/resolver_for.test.js","type":"MODIFIED","insertions":7,"deletions":-5},{"file":"test/resolver_static.test.js","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":242,"sizeDeletions":-73},{"number":"5","revision":"26309c971d74fb283feaa8413079dc098874db3f","parents":["5a355daedfbb2fd2a7eacd6cb8d448ae3589e4d8"],"ref":"refs/changes/22/22/5","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1467832390,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"NO_CODE_CHANGE","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":91,"deletions":-27},{"file":"bin/cbresolve","type":"MODIFIED","insertions":12,"deletions":-5},{"file":"lib/resolver.js","type":"MODIFIED","insertions":128,"deletions":-33},{"file":"test/pool.test.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"test/resolver_for.test.js","type":"MODIFIED","insertions":7,"deletions":-5},{"file":"test/resolver_static.test.js","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":242,"sizeDeletions":-73},{"number":"6","revision":"2792b1f0aa473416316a22e3f30cad644f726608","parents":["5a355daedfbb2fd2a7eacd6cb8d448ae3589e4d8"],"ref":"refs/changes/22/22/6","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1467832562,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1467847187,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":91,"deletions":-27},{"file":"bin/cbresolve","type":"MODIFIED","insertions":12,"deletions":-5},{"file":"lib/resolver.js","type":"MODIFIED","insertions":128,"deletions":-33},{"file":"test/pool.test.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"test/resolver_for.test.js","type":"MODIFIED","insertions":7,"deletions":-5},{"file":"test/resolver_static.test.js","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":242,"sizeDeletions":-73}],"allReviewers":[{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}]}