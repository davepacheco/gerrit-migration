From f5a06195e31085ee0b4ff1656b1f179785dc41d4 Mon Sep 17 00:00:00 2001
From: John Levon <john.levon@joyent.com>
Date: Thu, 11 Jan 2018 23:54:30 +0000
Subject: [PATCH] OS-5796 ::dtrace_options causes mdb to dump core

---
 usr/src/cmd/mdb/common/modules/dtrace/dtrace.c | 11 +++++++++--
 1 file changed, 9 insertions(+), 2 deletions(-)

diff --git a/usr/src/cmd/mdb/common/modules/dtrace/dtrace.c b/usr/src/cmd/mdb/common/modules/dtrace/dtrace.c
index 10d23128aa..d2885c75a7 100644
--- a/usr/src/cmd/mdb/common/modules/dtrace/dtrace.c
+++ b/usr/src/cmd/mdb/common/modules/dtrace/dtrace.c
@@ -22,7 +22,7 @@
 /*
  * Copyright (c) 2003, 2010, Oracle and/or its affiliates. All rights reserved.
  * Copyright (c) 2013 by Delphix. All rights reserved.
- * Copyright (c) 2017, Joyent, Inc. All rights reserved.
+ * Copyright (c) 2018, Joyent, Inc. All rights reserved.
  */
 
 /*
@@ -2518,9 +2518,16 @@ static struct dtrace_options {
 	{ "aggsortkey", dtrace_options_numtostr },
 	{ "aggsortrev", dtrace_options_numtostr },
 	{ "aggsortpos", dtrace_options_numtostr },
-	{ "aggsortkeypos", dtrace_options_numtostr }
+	{ "aggsortkeypos", dtrace_options_numtostr },
+	{ "temporal", dtrace_options_numtostr },
+	{ "agghist", dtrace_options_numtostr },
+	{ "aggpack", dtrace_options_numtostr },
+	{ "aggzoom", dtrace_options_numtostr },
+	{ "zone", dtrace_options_numtostr }
 };
 
+CTASSERT(ARRAY_SIZE(_dtrace_options) == DTRACEOPT_MAX);
+
 static void
 dtrace_options_help(void)
 {
-- 
2.21.0

