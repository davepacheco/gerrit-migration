commit 6593988a4d601b09c95a19ac825d72ff35047545 (refs/changes/20/3120/2)
Author: Dave Eddy <dave@daveeddy.com>
Date:   2017-12-22T17:59:12-05:00 (1 year, 10 months ago)
    
    TRITON-24 node-triton ListNetworkIPs has unordered results

diff --git a/lib/common.js b/lib/common.js
index 9db8f30..ab6a8ad 100644
--- a/lib/common.js
+++ b/lib/common.js
@@ -1387,6 +1387,27 @@ function validateObject(input, valid, opts) {
     }
 }
 
+/*
+ * Convert an IPv4 address (as a string) to a number
+ */
+function ipv4ToLong(ip) {
+    var l = 0;
+
+    assert.string(ip, 'ip');
+    ip.split('.').forEach(function processIpOctet(octet) {
+        octet = parseInt(octet, 10);
+
+        assert.number(octet, 'octet');
+        assert(octet >= 0, 'octet >= 0');
+        assert(octet < 256, 'octet < 256');
+
+        l <<= 8;
+        l += octet;
+    });
+
+    return l;
+}
+
 //---- exports
 
 module.exports = {
@@ -1425,6 +1446,7 @@ module.exports = {
     jsonPredFromKv: jsonPredFromKv,
     monotonicTimeDiffMs: monotonicTimeDiffMs,
     readStdin: readStdin,
-    validateObject: validateObject
+    validateObject: validateObject,
+    ipv4ToLong: ipv4ToLong
 };
 // vim: set softtabstop=4 shiftwidth=4:
diff --git a/lib/do_network/do_ip/do_list.js b/lib/do_network/do_ip/do_list.js
index 854045d..9c010be 100644
--- a/lib/do_network/do_ip/do_list.js
+++ b/lib/do_network/do_ip/do_list.js
@@ -41,7 +41,21 @@ function do_list(subcmd, opts, args, callback) {
     }
     columns = columns.split(',');
 
-    var sort = opts.s.split(',');
+    var sort = opts.s.split(',').map(function mapSort(field) {
+        var obj = {
+            field: field
+        };
+
+        switch (field) {
+        case 'ip':
+            obj.keyFunc = common.ipv4ToLong;
+            break;
+        default:
+            break;
+        }
+
+        return obj;
+    });
 
     vasync.pipeline({arg: {cli: this.top}, funcs: [
         common.cliSetupTritonApi,
