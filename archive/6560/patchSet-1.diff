From 5fd3c7d6a37abb2ce9103565e3107c255c25d912 Mon Sep 17 00:00:00 2001
From: Kelly McLaughlin <kelly.mclaughlin@joyent.com>
Date: Fri, 5 Jul 2019 08:46:31 -0600
Subject: [PATCH] MANTA-4389 Buckets object deletes failing with 500 error

---
 lib/server.js | 9 ++++++---
 1 file changed, 6 insertions(+), 3 deletions(-)

diff --git a/lib/server.js b/lib/server.js
index a39ce4d..004b074 100644
--- a/lib/server.js
+++ b/lib/server.js
@@ -1082,9 +1082,10 @@ function deleteObject(options) {
                     obj: obj
                 }, 'deleteObject: returned');
 
-                // MANTA-1400: set the vnode info for debugging purposes
-                if (obj) {
-                    obj._node = location;
+                if (typeof (obj) !== 'object') {
+                    obj = {
+                        deleted_rows: obj
+                    };
                 }
 
                 log.debug({
@@ -1098,6 +1099,8 @@ function deleteObject(options) {
                 if (gErr) {
                     rpc.fail(gErr);
                 } else {
+                    obj._node = location;
+
                     rpc.write(obj);
                     rpc.end();
                 }
-- 
2.21.0

