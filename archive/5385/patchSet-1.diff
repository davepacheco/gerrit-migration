From 4e35bedb32ccad553d4935109fba983629dc47be Mon Sep 17 00:00:00 2001
From: Jerry Jelinek <jerry.jelinek@joyent.com>
Date: Fri, 18 Jan 2019 14:00:56 +0000
Subject: [PATCH] OS-7523 enable zfs-test slog tests on smartos

---
 usr/src/test/zfs-tests/runfiles/smartos.run               | 8 +++++++-
 usr/src/test/zfs-tests/tests/functional/slog/slog.cfg     | 5 +++--
 .../test/zfs-tests/tests/functional/slog/slog_014_pos.ksh | 3 ++-
 3 files changed, 12 insertions(+), 4 deletions(-)

diff --git a/usr/src/test/zfs-tests/runfiles/smartos.run b/usr/src/test/zfs-tests/runfiles/smartos.run
index 0dc0bff43f..5eac753cde 100644
--- a/usr/src/test/zfs-tests/runfiles/smartos.run
+++ b/usr/src/test/zfs-tests/runfiles/smartos.run
@@ -10,7 +10,7 @@
 #
 
 #
-# Copyright 2018 Joyent, Inc.
+# Copyright 2019 Joyent, Inc.
 #
 
 [DEFAULT]
@@ -241,6 +241,12 @@ tests = ['rsend_001_pos', 'rsend_002_pos', 'rsend_003_pos', 'rsend_006_pos',
 tests = ['scrub_mirror_001_pos', 'scrub_mirror_002_pos',
     'scrub_mirror_003_pos', 'scrub_mirror_004_pos']
 
+[/opt/zfs-tests/tests/functional/slog]
+tests = ['slog_001_pos', 'slog_002_pos', 'slog_003_pos', 'slog_004_pos',
+    'slog_005_pos', 'slog_006_pos', 'slog_007_pos', 'slog_008_neg',
+    'slog_009_neg', 'slog_010_neg', 'slog_011_neg', 'slog_012_neg',
+    'slog_013_pos', 'slog_014_pos']
+
 [/opt/zfs-tests/tests/functional/snapshot]
 tests = ['clone_001_pos', 'rollback_001_pos', 'rollback_002_pos',
     'rollback_003_pos', 'snapshot_001_pos', 'snapshot_002_pos',
diff --git a/usr/src/test/zfs-tests/tests/functional/slog/slog.cfg b/usr/src/test/zfs-tests/tests/functional/slog/slog.cfg
index 6a28880ade..17f28abaac 100644
--- a/usr/src/test/zfs-tests/tests/functional/slog/slog.cfg
+++ b/usr/src/test/zfs-tests/tests/functional/slog/slog.cfg
@@ -26,10 +26,11 @@
 
 #
 # Copyright (c) 2013, 2015 by Delphix. All rights reserved.
+# Copyright 2019 Joyent, Inc.
 #
 
-export VDIR=/disk-slog
-export VDIR2=/disk2-slog
+export VDIR=/var/tmp/disk-slog
+export VDIR2=/var/tmp/disk2-slog
 
 export VDEV="$VDIR/a $VDIR/b $VDIR/c"
 export SDEV="$VDIR/d"
diff --git a/usr/src/test/zfs-tests/tests/functional/slog/slog_014_pos.ksh b/usr/src/test/zfs-tests/tests/functional/slog/slog_014_pos.ksh
index 0190479e44..02e99fac45 100644
--- a/usr/src/test/zfs-tests/tests/functional/slog/slog_014_pos.ksh
+++ b/usr/src/test/zfs-tests/tests/functional/slog/slog_014_pos.ksh
@@ -27,6 +27,7 @@
 
 #
 # Copyright (c) 2013, 2018 by Delphix. All rights reserved.
+# Copyright 2019 Joyent, Inc.
 #
 
 . $STF_SUITE/tests/functional/slog/slog.kshlib
@@ -47,7 +48,7 @@ log_assert "log device can survive when one of the pool device get corrupted."
 
 for type in "mirror" "raidz" "raidz2"; do
 	for spare in "" "spare"; do
-		log_must $ZPOOL create $TESTPOOL $type $VDEV $spare $SDEV \
+		log_must zpool create $TESTPOOL $type $VDEV $spare $SDEV \
 			log $LDEV
 
                 # Create a file to be corrupted
-- 
2.21.0

