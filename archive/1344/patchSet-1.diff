commit 8a9b37a46d79c1aedda1213f168b0e3cf307b3a4 (refs/changes/44/1344/1)
Author: Josh Wilsdon <jwilsdon@joyent.com>
Date:   2017-01-25T19:45:32-08:00 (2 years, 8 months ago)
    
    TOOLS-1662 sdcadm add-new-agent-svcs fails with: TypeError: Cannot read property 'params' of undefined

diff --git a/lib/cli/do_add_new_agent_svcs.js b/lib/cli/do_add_new_agent_svcs.js
index 62e782c..dadffc2 100644
--- a/lib/cli/do_add_new_agent_svcs.js
+++ b/lib/cli/do_add_new_agent_svcs.js
@@ -146,8 +146,7 @@ function do_add_new_agent_svcs(subcmd, opts, args, cb) {
                         }
                         if (!svcs.length) {
                             newAgentServices.push(agent);
-                        }
-                        if (!svcs[0].params.image_uuid) {
+                        } else if (!svcs[0].params.image_uuid) {
                             agentServices[agent] = svcs[0];
                             updateAgentServices.push(agent);
                         }
