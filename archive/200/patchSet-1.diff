From 585f1c720826d262102e533c85ff5a6a73148f8b Mon Sep 17 00:00:00 2001
From: Patrick Mooney <pmooney@pfmooney.com>
Date: Wed, 3 Aug 2016 18:19:43 +0000
Subject: [PATCH] OS-5570 lxbrand blown assertion in ptrace(PTRACE_SETREGS)
 OS-5573 lxbrand ptrace(PEEKUSER) returns 0 for all registers

---
 usr/src/uts/intel/brand/lx/lx_archdep.c | 5 +----
 1 file changed, 1 insertion(+), 4 deletions(-)

diff --git a/usr/src/uts/intel/brand/lx/lx_archdep.c b/usr/src/uts/intel/brand/lx/lx_archdep.c
index b65bea42ea..5d2c33ab9f 100644
--- a/usr/src/uts/intel/brand/lx/lx_archdep.c
+++ b/usr/src/uts/intel/brand/lx/lx_archdep.c
@@ -875,8 +875,6 @@ lx_set_user_regs64(lx_lwp_data_t *lwpd, lx_user_regs64_t *lxrp)
 	struct pcb *pcb = &lwp->lwp_pcb;
 	void *ucp;
 
-	VERIFY(lwp_getdatamodel(lwp) == DATAMODEL_LP64);
-
 	switch (lx_regs_location(lwpd, &ucp, B_TRUE)) {
 	case LX_REG_LOC_UNAVAIL:
 		return (-1);
@@ -958,8 +956,7 @@ lx_peekuser64(lx_lwp_data_t *lwpd, uintptr_t offset, uintptr_t *res)
 
 	bzero(&lxu, sizeof (lxu));
 	if (offset < sizeof (lx_user_regs64_t)) {
-		lx_user_regs64_t regs;
-		if (lx_get_user_regs64(lwpd, &regs) == 0) {
+		if (lx_get_user_regs64(lwpd, &lxu.lxu_regs) == 0) {
 			valid = B_TRUE;
 		}
 	}
-- 
2.21.0

