{"project":"joyent/sdc-docker","branch":"master","id":"If7ec813af2b9e08dd1766278ffb290c5f6528573","number":"2280","subject":"DOCKER-1077 docker tests should not use invalid uuids Reviewed by: Julien Gilli \u003cjulien.gilli@joyent.com\u003e Reviewed by: Todd Whiteman \u003ctodd.whiteman@joyent.com\u003e Approved by: Julien Gilli \u003cjulien.gilli@joyent.com\u003e","owner":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"url":"https://cr.joyent.us/2280","commitMessage":"DOCKER-1077 docker tests should not use invalid uuids\nReviewed by: Julien Gilli \u003cjulien.gilli@joyent.com\u003e\nReviewed by: Todd Whiteman \u003ctodd.whiteman@joyent.com\u003e\nApproved by: Julien Gilli \u003cjulien.gilli@joyent.com\u003e\n","createdOn":1501018379,"lastUpdated":1501026193,"open":false,"status":"MERGED","comments":[{"timestamp":1501018379,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Uploaded patch set 1."},{"timestamp":1501018415,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1501018692,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1501019191,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Patch Set 1:\n\nIs there anything we can do to make the new error more user friendly - as it seems these error cases will now show \u0027Invalid parameters\u0027, but that\u0027s not as helpful as \u0027network X not found\u0027.\n\nI\u0027d really like to see which parameter is invalid (I think NAPI may include this extra info in it\u0027s errors, and sdc-docker may be losing these details)."},{"timestamp":1501019383,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Patch Set 1:\n\nSo, NAPI will tell you what specifically is wrong (i.e. invalid uuid chars, suffixes not allowed, etc). It\u0027s simply a matter of intercepting those NAPI-errors and emitting our own corresponding errors (as opposed to just passing the NAPI-errors through, which we do now). Would you guys like me to implement this as part of this ticket or a different one? (How urgent is it to get the integration tests to stop failing?)"},{"timestamp":1501020038,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Uploaded patch set 2."},{"timestamp":1501020074,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1501020097,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Patch Set 2:\n\nI\u0027d be good with a separate ticket to make better NAPI errors - then I\u0027m fine with this as is."},{"timestamp":1501023294,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Patch Set 2: Code-Review+1"},{"timestamp":1501023911,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Uploaded patch set 3."},{"timestamp":1501023940,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing-1\n\n(1 comment)\n\n\"make check\" exited with status 2"},{"timestamp":1501024056,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Patch Set 3:\n\n(1 comment)\n\nBot is wrong."},{"timestamp":1501024246,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 3:\n\n(1 comment)"},{"timestamp":1501024971,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Uploaded patch set 4."},{"timestamp":1501025008,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing-1\n\n(1 comment)\n\n\"make check\" exited with status 2"},{"timestamp":1501025232,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Uploaded patch set 5."},{"timestamp":1501025270,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1501025662,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 5: Code-Review+1 Integration-Approval+1"},{"timestamp":1501026145,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Patch Set 6: Commit message was updated."},{"timestamp":1501026193,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Nick Zivkovic"}],"currentPatchSet":{"number":"6","revision":"34e960ecef9a12c69e7b35c45830e9da038687d4","parents":["ab9fa794765779e4359347041f5eab8d07245799"],"ref":"refs/changes/80/2280/6","uploader":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"createdOn":1501026145,"author":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1501025270,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1501025662,"by":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1501025662,"by":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}},{"type":"SUBM","value":"1","grantedOn":1501026193,"by":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"test/integration/api-create.test.js","type":"MODIFIED","insertions":8,"deletions":-25}],"sizeInsertions":8,"sizeDeletions":-25},"patchSets":[{"number":"1","revision":"81da7a13a964fb8c02f2046d17902ef1c26e23b9","parents":["ab9fa794765779e4359347041f5eab8d07245799"],"ref":"refs/changes/80/2280/1","uploader":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"createdOn":1501018379,"author":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1501018415,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"test/integration/api-create.test.js","line":651,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"It seems the intention of this test could have been to create a container with a network that was valid but didn\u0027t exist.\n\nIf it\u0027s the case, maybe we should change the test to pass a valid but non-existing network instead of an invalid network, and maybe add a test entitled \"create with an invalid network\" that passes a invalid network.\n\nIf it\u0027s not the case, then we should also update the description of the test to mention \"create with an invalid network\".\n\nSame question/comments for the two other tests that were changed."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"test/integration/api-create.test.js","type":"MODIFIED","insertions":3,"deletions":-3}],"sizeInsertions":3,"sizeDeletions":-3},{"number":"2","revision":"57c19300b3f5d67d3b45124fb5c71be40c38e6ff","parents":["ab9fa794765779e4359347041f5eab8d07245799"],"ref":"refs/changes/80/2280/2","uploader":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"createdOn":1501020038,"author":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1501020074,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1501023294,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"test/integration/api-create.test.js","type":"MODIFIED","insertions":5,"deletions":-4}],"sizeInsertions":5,"sizeDeletions":-4},{"number":"3","revision":"1812c1030bb0b39273b07d266831e992b8c0f956","parents":["ab9fa794765779e4359347041f5eab8d07245799"],"ref":"refs/changes/80/2280/3","uploader":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"createdOn":1501023911,"author":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1501023940,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"test/integration/api-create.test.js","line":387,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"warning: variable is declared but never referenced: adminNetwork"},{"file":"test/integration/api-create.test.js","line":387,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"This is not true. Demerit!"},{"file":"test/integration/api-create.test.js","line":387,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Where is it referenced? It is assigned to at line 494, but it doesn\u0027t seem to be used anywhere."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"test/integration/api-create.test.js","type":"MODIFIED","insertions":7,"deletions":-21}],"sizeInsertions":7,"sizeDeletions":-21},{"number":"4","revision":"7b5cb6b82ef90c0c4ce99688fa22f30afe462d48","parents":["ab9fa794765779e4359347041f5eab8d07245799"],"ref":"refs/changes/80/2280/4","uploader":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"createdOn":1501024971,"author":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1501025008,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"test/integration/api-create.test.js","line":777,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"line \u003e 80 characters"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"test/integration/api-create.test.js","type":"MODIFIED","insertions":7,"deletions":-26}],"sizeInsertions":7,"sizeDeletions":-26},{"number":"5","revision":"f7ec813af2b9e08dd1766278ffb290c5f6528573","parents":["ab9fa794765779e4359347041f5eab8d07245799"],"ref":"refs/changes/80/2280/5","uploader":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"createdOn":1501025232,"author":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1501025270,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1501025662,"by":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1501025662,"by":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"test/integration/api-create.test.js","type":"MODIFIED","insertions":8,"deletions":-25}],"sizeInsertions":8,"sizeDeletions":-25},{"number":"6","revision":"34e960ecef9a12c69e7b35c45830e9da038687d4","parents":["ab9fa794765779e4359347041f5eab8d07245799"],"ref":"refs/changes/80/2280/6","uploader":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"createdOn":1501026145,"author":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1501025270,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"SUBM","value":"1","grantedOn":1501026193,"by":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1501025662,"by":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1501025662,"by":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"test/integration/api-create.test.js","type":"MODIFIED","insertions":8,"deletions":-25}],"sizeInsertions":8,"sizeDeletions":-25}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"}]}