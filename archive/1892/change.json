{"project":"joyent/moray","branch":"master","id":"Ida111315a105d6fa22a775f7d9dcee1702ddccc3","number":"1892","subject":"MORAY-414 findObjects documentation should mention all valid options Reviewed by: Cody Peter Mello \u003ccody.mello@joyent.com\u003e Reviewed by: David Pacheco \u003cdap@joyent.com\u003e Approved by: Cody Peter Mello \u003ccody.mello@joyent.com\u003e","owner":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"url":"https://cr.joyent.us/1892","commitMessage":"MORAY-414 findObjects documentation should mention all valid options\nReviewed by: Cody Peter Mello \u003ccody.mello@joyent.com\u003e\nReviewed by: David Pacheco \u003cdap@joyent.com\u003e\nApproved by: Cody Peter Mello \u003ccody.mello@joyent.com\u003e\n","createdOn":1493833857,"lastUpdated":1494870804,"open":false,"status":"MERGED","comments":[{"timestamp":1493833857,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 1."},{"timestamp":1493833893,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1493834892,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 1: Code-Review+1\n\n(6 comments)"},{"timestamp":1493836888,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 2."},{"timestamp":1493836919,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1493836920,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 1:\n\n(5 comments)"},{"timestamp":1493837238,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 2: Code-Review+1"},{"timestamp":1493848172,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 2:\n\n(5 comments)\n\nThanks, Julien!\n\nI\u0027ve got bunch of questions below.  Part of this is because many of these weren\u0027t documented before, so I\u0027ve never been clear on what they\u0027re supposed to do.  In other cases, I think some of these options were ill-considered, and I\u0027m worried about documenting them and encouraging various anti-patterns, at least without a suitable warning in the documentation.  In a few cases, I\u0027ve asked if we\u0027re using the options anywhere, and that\u0027s because if we\u0027re not I\u0027m tempted to either leave them out of the docs or document them as \"strongly discouraged\" (along with the reason why)."},{"timestamp":1493850206,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 2:\n\n(5 comments)"},{"timestamp":1493943674,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 2:\n\n(4 comments)"},{"timestamp":1494016327,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1494016376,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1494025289,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1494344307,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 2:\n\n(4 comments)"},{"timestamp":1494353806,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 2:\n\n(1 comment)\n\nThanks again for doing this.  It will be great to have this stuff documented."},{"timestamp":1494471610,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1494538845,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 3."},{"timestamp":1494538870,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1494538872,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 2:\n\n(5 comments)"},{"timestamp":1494539202,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 3: Code-Review+1\n\nThank you for those changes!"},{"timestamp":1494543381,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 3: Code-Review+1\n\n(2 comments)"},{"timestamp":1494859752,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 4."},{"timestamp":1494859774,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 3:\n\n(2 comments)"},{"timestamp":1494859784,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1494864706,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 4:\n\n(1 comment)"},{"timestamp":1494864856,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 5."},{"timestamp":1494864869,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 4:\n\n(1 comment)"},{"timestamp":1494864882,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1494865097,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 5: Code-Review+1"},{"timestamp":1494870626,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 5: Code-Review+1 Integration-Approval+1"},{"timestamp":1494870772,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 6: Commit message was updated."},{"timestamp":1494870804,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Julien Gilli"}],"currentPatchSet":{"number":"6","revision":"52d7669f7134d2a57c35f97891d3e166d7f1cb76","parents":["d362db4d7a72f08c0b14fa8639b3e2b1a70981b6"],"ref":"refs/changes/92/1892/6","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1494870772,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1494864882,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1494865097,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1494870626,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1494870626,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"SUBM","value":"1","grantedOn":1494870804,"by":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":83,"deletions":-1}],"sizeInsertions":83,"sizeDeletions":-1},"patchSets":[{"number":"1","revision":"41d86fab64ce4c46a3638b6c5db742608f11c1a6","parents":["d362db4d7a72f08c0b14fa8639b3e2b1a70981b6"],"ref":"refs/changes/92/1892/1","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1493833857,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1493834892,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1493833893,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"docs/index.md","line":575,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Can we say \"see below\" or \"documented below\" here instead?"},{"file":"docs/index.md","line":575,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Done"},{"file":"docs/index.md","line":586,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Capitalize \"Moray\" here and below."},{"file":"docs/index.md","line":586,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Done"},{"file":"docs/index.md","line":611,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"It can be an array of objects, or just an object. We should probably also mention that the objects should contain the \"attribute\" field, and may contain the \"order\" field, which should be set to \"ASC\" (the default) or \"DESC\"."},{"file":"docs/index.md","line":611,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Done"},{"file":"docs/index.md","line":622,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"The \"timeout\" is how long Moray will wait on a reply to a Postgres query."},{"file":"docs/index.md","line":622,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Done"},{"file":"docs/index.md","line":623,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Until MORAY-397 is integrated, the default is 30 seconds."},{"file":"docs/index.md","line":623,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Let\u0027s say \"QueryTimeoutError\" here."},{"file":"docs/index.md","line":623,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":49,"deletions":-1}],"sizeInsertions":49,"sizeDeletions":-1},{"number":"2","revision":"5ff7ccedcb906f9f1ce8cbe0cef5d15f9b80140f","parents":["d362db4d7a72f08c0b14fa8639b3e2b1a70981b6"],"ref":"refs/changes/92/1892/2","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1493836888,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1493837238,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1493836919,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"docs/index.md","line":582,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Can we reference the note I suggested adding under \"noLimit\"?"},{"file":"docs/index.md","line":582,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Absolutely, will do."},{"file":"docs/index.md","line":582,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Done"},{"file":"docs/index.md","line":587,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"This option always felt like a hack.  Does this actually work?  Do we use it anywhere?  Do we want to be?"},{"file":"docs/index.md","line":587,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"I find it useful when running tests that change bucket schemas and that want to have subsequent commands work with an up to date schema by refreshing the cache.\n\nFor instance, the test added by the MORAY-104 change in moray-test-suite uses it (see https://cr.joyent.us/#/c/1811/3/test/findobjects-requireindexes.test.js)."},{"file":"docs/index.md","line":587,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Fair enough.  How about adding a sentence indicating that the bucket cache is important for scalability and so this is primarily intended for tests?"},{"file":"docs/index.md","line":587,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Sounds good to me."},{"file":"docs/index.md","line":587,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Done"},{"file":"docs/index.md","line":591,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I think it\u0027s worth explaining why you\u0027d use this, which I believe is because it avoids having to do the expensive \"count\" query in the first place.  But again: do we use this anywhere, and do we want to be using it?"},{"file":"docs/index.md","line":591,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"It seems we use it at least in the following places:\n\n* https://github.com/joyent/sdc-adminui/blob/9898211ab69de3b70ce7986f8b0ccf4d466dd679/lib/sdc-clients.js#L79\n\n* https://github.com/joyent/sdc-ufds/blob/ba4a5b82f8f27d97c55aa7959c5fd4235bcf1347/lib/db/common.js#L157\n\n* https://github.com/joyent/sdc-ufds/blob/ba4a5b82f8f27d97c55aa7959c5fd4235bcf1347/lib/db/search.js#L126\n\n* https://github.com/joyent/sdc-ufds/blob/ba4a5b82f8f27d97c55aa7959c5fd4235bcf1347/lib/ufds.js#L345\n\n* https://github.com/joyent/manta-muskie/blob/dd5e5f2f78e8e20853b73209862ca5d629fb2351/lib/common.js#L661"},{"file":"docs/index.md","line":591,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Okay.  I think the comment still stands: it\u0027s worth explaining why you\u0027d use this, and I think the reason is that it saves a count query."},{"file":"docs/index.md","line":591,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Yes, absolutely, I was responding to your question, sorry if that was unclear."},{"file":"docs/index.md","line":591,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Done"},{"file":"docs/index.md","line":597,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Can we add a note that this is considered dangerous, that the design center is around short-lived requests, and that there are serious consequences in PostgreSQL for leaving connections open in transactions for extended periods while other transactions are making changes?\n\nAre we sure we even want to document this?"},{"file":"docs/index.md","line":597,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"That note seems like a great addition, thanks!\n\nAs for documenting it, I lean towards documenting it because it\u0027s currently used in Triton, and thus:\n\n1. it seems we already committed to it\n\n2. being able to look up this option to understand the semantics of existing code seems like it would help\n\nBut I understand the concerns, and I don\u0027t feel strongly either way."},{"file":"docs/index.md","line":597,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Okay.\n\nIt\u0027s scary that we use it in Triton, but that\u0027s separate."},{"file":"docs/index.md","line":597,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"noLimit is especially useful with deleteMany. For example, once NAPI stops creating a separate bucket for each network, deleting a network would look something like:\n\n    moray.batch([\n        {\n            operation: \u0027delete\u0027,\n            bucket: \u0027napi_networks\u0027,\n            key: uuid,\n            options: {\n                etag: etag\n            }\n        },\n        {\n            operation: \u0027deleteMany\u0027,\n            bucket: \u0027napi_ips\u0027,\n            filter: mod_util.format(\u0027(network_uuid\u003d%s)\u0027, uuid),\n            options: {\n                noLimit: true\n            }\n        }\n    ], cb);\n\nThe noLimit would be important here since a subnet could feasibly have 1000+ addresses, and specifying varying limits based on subnet size doesn\u0027t seem like the right solution."},{"file":"docs/index.md","line":597,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"(That being said, there probably isn\u0027t any good reason to use it with findObjects(). I don\u0027t think anyone is doing that though.)"},{"file":"docs/index.md","line":597,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"For background: the use of long-running queries was a major problem during the development of Marlin, and the issues are detailed under MANTA-1684.  In that case, Marlin was doing updates on tens of thousand of rows, which could take several minutes.  While that was running, other modification operations caused PostgreSQL to accumulate dead tuples that could not be cleaned up until well after the long running query completed.  This significantly increased bloat in both the indexes and the physical table, resulting in deeply pathological performance.  (In extreme cases, you can wind up with just a handful of live tuples per disk block, meaning a lot of disk reads to serve the same number of queries.  In a few cases, we manually compacted the table with \"VACUUM FULL\", and latency was reduced by 1-2 orders of magnitude.)  Just understanding what was going on in these cases was a very time-consuming process.\n\nThe Marlin case was made especially bad because the timeout on the operation was too aggressive (and indeed, it\u0027s hard to size any timeout for an unbounded-size operation), so we\u0027d do all that work and accumulate all that garbage, only to abort the transaction -- and retry the whole thing.  The solution in Marlin was to introduce an intermediate state where we indicate that we\u0027re going to start operating on a large number of objects, then we operate on them in small batches, and then we clear that state.  This ensures that the individual queries are very bounded in size.\n\nEven if one or two long-running queries wasn\u0027t a big deal (and I\u0027m not sure even that\u0027s true), it\u0027s not clear you could safely have more than one without things becoming pathological.  Besides the problems above, Moray was designed around short-running queries.  If multiple components make long-running queries with any frequency, you can wind up with very few available connections at any given time.  Given that long-running queries compose so badly, I think it\u0027s important that we avoid using it in Triton and Manta, so I think it\u0027s important that Moray not encourage it.\n\nTo phrase this another way, I think there\u0027s clearly some query time that\u0027s not acceptable: queries cannot be allowed to take multiple hours, accumulating hours\u0027 worth of changes in dead tuples.  For quantities that are under user control (like the number of VMs), which generally must scale up arbitrarily, we have to limit the sizes of those operations and do them in batches.\n\nThere\u0027s some discussion on the underlying issues here:\n\nhttps://www.citusdata.com/blog/2016/11/04/autovacuum-not-the-enemy/\n\nand a decent example here:\n\nhttps://www.compose.com/articles/postgresql-bloat-origins-monitoring-and-managing/"},{"file":"docs/index.md","line":597,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"\u003e It\u0027s scary that we use it in Triton, but that\u0027s separate.\n\nAs Cody pointed out, it\u0027s not currently used in any joyent repository with findObjects. What I meant by saying that we committed to it is that it\u0027s been available to use for a long time.\n\nTo clarify what I meant above: I\u0027m not saying that anyone should use that option, but in order to prevent users from using it, it might be more effective to document it stating that it should not be used than not documenting it."},{"file":"docs/index.md","line":597,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Done"},{"file":"docs/index.md","line":629,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I remember a lot of confusion between the client-side vs. server-side timeout.  Does this option definitely control the server-side timeout?  Do we use it anywhere?  Has that always been supported or does that depend on recent changes?"},{"file":"docs/index.md","line":629,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"It controls the timeout used by the Postgres client. it seems that was added by MANTA-1458.\n\nI don\u0027t know if we use it anywhere, grepping for \"timeout\" in the code base is a bit tedious, but I can investigate further if we need to."},{"file":"docs/index.md","line":629,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I think we\u0027ve concluded elsewhere that postgres-client-side timeouts in Moray are usually not the right thing.  Since PostgreSQL will maintain the connection anyway in that case, having such a timeout allows Moray to make more connections than it\u0027s supposed to (MORAY-294) and eliminates the backpressure effect of having the RPC request blocked.\n\nPerhaps we could explain that here?  Namely:\n\n- that using this timeout is strongly discouraged.  For identifying network failures, TCP keep-alive should be used instead.  Otherwise, if the request hasn\u0027t completed, then the database is stuck, and applications cannot generally do anything safely except to wait (or possibly raise an alarm)\n- that expiration of this timeout does not cancel the underlying PostgreSQL query\n- that the corresponding PostgreSQL resources remain in use until the query ultimately does complete"},{"file":"docs/index.md","line":629,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"That sounds great to me. There\u0027s one thing that is not clear to me though:\n\n\u003e For identifying network failures, TCP keep-alive should be used instead.\n\nI presume that one would need to have access to the underlying TCP connections of a moray client to set a TCP keep-alive. Do moray users have access to these underlying TCP connections?"},{"file":"docs/index.md","line":629,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"\u003e \u003e  For identifying network failures, TCP keep-alive should be used instead.\n\n\u003e I presume that one would need to have access to the underlying TCP connections of a moray client to set a TCP keep-alive. Do moray users have access to these underlying TCP connections?\n\nMoray users do not have access to these connections, but the Moray client enables TCP KeepAlive automatically.  For the documentation here, I would explain that TCP KeepAlive is a better way to identify network failures and that the Moray client uses that automatically, so given that, clients generally should not use an additional timeout."},{"file":"docs/index.md","line":629,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Sounds good, I will make those changes, thanks!"},{"file":"docs/index.md","line":629,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":57,"deletions":-1}],"sizeInsertions":57,"sizeDeletions":-1},{"number":"3","revision":"aa92b436f11a6f22e40653511603d5845e807578","parents":["d362db4d7a72f08c0b14fa8639b3e2b1a70981b6"],"ref":"refs/changes/92/1892/3","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1494538845,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1494539202,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1494543381,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1494538870,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"docs/index.md","line":595,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Capitalize \"Moray\" here and below."},{"file":"docs/index.md","line":595,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Done"},{"file":"docs/index.md","line":652,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Did we want this to mention that the Moray client already enables keep-alives?"},{"file":"docs/index.md","line":652,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":83,"deletions":-1}],"sizeInsertions":83,"sizeDeletions":-1},{"number":"4","revision":"97e5c86366a3c13fd9a6a42f923deebe21915c9b","parents":["d362db4d7a72f08c0b14fa8639b3e2b1a70981b6"],"ref":"refs/changes/92/1892/4","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1494859752,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1494859784,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"docs/index.md","line":652,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"This should probably be \"is\"."},{"file":"docs/index.md","line":652,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":83,"deletions":-1}],"sizeInsertions":83,"sizeDeletions":-1},{"number":"5","revision":"da111315a105d6fa22a775f7d9dcee1702ddccc3","parents":["d362db4d7a72f08c0b14fa8639b3e2b1a70981b6"],"ref":"refs/changes/92/1892/5","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1494864856,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1494865097,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1494870626,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1494870626,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1494864882,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":83,"deletions":-1}],"sizeInsertions":83,"sizeDeletions":-1},{"number":"6","revision":"52d7669f7134d2a57c35f97891d3e166d7f1cb76","parents":["d362db4d7a72f08c0b14fa8639b3e2b1a70981b6"],"ref":"refs/changes/92/1892/6","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1494870772,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1494865097,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1494870626,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1494870626,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1494864882,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"SUBM","value":"1","grantedOn":1494870804,"by":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":83,"deletions":-1}],"sizeInsertions":83,"sizeDeletions":-1}],"allReviewers":[{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},{"name":"Joyent Automation","username":"joyent-automation"},{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}]}