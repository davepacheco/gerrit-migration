From 4eb4048ea062cce20e3417f1c9bb528f2164923f Mon Sep 17 00:00:00 2001
From: dyep <dyep49@gmail.com>
Date: Tue, 22 Jan 2019 10:35:20 -0800
Subject: [PATCH] TRITON-1099 VMAPI should expose free_space for bhyve VMs

---
 lib/common/vm-common.js | 8 ++++++--
 package.json            | 2 +-
 2 files changed, 7 insertions(+), 3 deletions(-)

diff --git a/lib/common/vm-common.js b/lib/common/vm-common.js
index 32e1c98..1f0d225 100644
--- a/lib/common/vm-common.js
+++ b/lib/common/vm-common.js
@@ -5,7 +5,7 @@
  */
 
 /*
- * Copyright 2018 Joyent, Inc.
+ * Copyright 2019 Joyent, Inc.
  */
 
 var assert = require('assert-plus');
@@ -172,7 +172,8 @@ function translateVm(obj, fullObject) {
         'pid',
         'tmpfs',
         'zfs_data_compression',
-        'flexible_disk_size'
+        'flexible_disk_size',
+        'free_space'
     ];
 
     optionalFields.forEach(function (field) {
@@ -188,6 +189,9 @@ function translateVm(obj, fullObject) {
         if (obj.hostname) {
             vm.hostname = obj.hostname;
         }
+        if (obj.brand === 'bhyve') {
+            vm.free_space = obj.free_space;
+        }
     } else {
         vm.image_uuid = obj.image_uuid;
     }
diff --git a/package.json b/package.json
index a4df7f3..f803b9e 100644
--- a/package.json
+++ b/package.json
@@ -1,7 +1,7 @@
 {
   "name": "vmapi",
   "description": "VMs API",
-  "version": "9.6.6",
+  "version": "9.7.0",
   "author": "Joyent (joyent.com)",
   "private": true,
   "dependencies": {
-- 
2.21.0

