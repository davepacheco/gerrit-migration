{"project":"joyent/illumos-joyent","branch":"master","topic":"nawk-update","id":"I084c5c48f7680535f554dd406a99bf0ea8329823","number":"4985","subject":"OS-7315 Update nawk(1) field splitting behaviour to match POSIX definition Reviewed by: Robert Mustacchi \u003crm@joyent.com\u003e Approved by: Jason King \u003cjbk@joyent.com\u003e","owner":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"url":"https://cr.joyent.us/4985","commitMessage":"OS-7315 Update nawk(1) field splitting behaviour to match POSIX definition\nReviewed by: Robert Mustacchi \u003crm@joyent.com\u003e\nApproved by: Jason King \u003cjbk@joyent.com\u003e\n","createdOn":1540231045,"lastUpdated":1560451887,"open":false,"status":"MERGED","comments":[{"timestamp":1540231045,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 1."},{"timestamp":1541788475,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1541788952,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1541791375,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1542132592,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 2: Patch Set 1 was rebased."},{"timestamp":1542470827,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 2:\n\n(2 comments)"},{"timestamp":1542652846,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 2:\n\n(2 comments)"},{"timestamp":1543503627,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 2: Code-Review+1"},{"timestamp":1548269092,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 3: Patch Set 2 was rebased."},{"timestamp":1548269184,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Topic set to nawk-update"},{"timestamp":1548280960,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 3: Integration-Approval+1"},{"timestamp":1549481217,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 4: Commit message was updated."},{"timestamp":1560301516,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 5: Patch Set 4 was rebased."},{"timestamp":1560451829,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 6: Patch Set 5 was rebased."},{"timestamp":1560451887,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Cody Peter Mello"}],"currentPatchSet":{"number":"6","revision":"084c5c48f7680535f554dd406a99bf0ea8329823","parents":["b4acf023dd2b2008c601d706c1ba8f9684bca593"],"ref":"refs/changes/85/4985/6","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1560451829,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1543503627,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1548280960,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"SUBM","value":"1","grantedOn":1560451887,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/cmd/awk/awk.h","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/cmd/awk/lib.c","type":"MODIFIED","insertions":18,"deletions":-6},{"file":"usr/src/cmd/awk/tran.c","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/test/util-tests/tests/awk/bugs-fixed/fs-overflow.ok","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/test/util-tests/tests/awk/tests/T.split","type":"MODIFIED","insertions":69,"deletions":-6}],"sizeInsertions":91,"sizeDeletions":-13},"patchSets":[{"number":"1","revision":"19187d68cb470081b6e7c903d9e1b2ca9318942d","parents":["4fd96e59711ed6719fef956aa7ae00f6701bc7b6"],"ref":"refs/changes/85/4985/1","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1540231045,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/cmd/awk/lib.c","line":161,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"So in the above we\u0027re comparing the strlen that we get via fsloc, but down here we\u0027re using *FS in the strcpy. Why is that safe?"},{"file":"usr/src/cmd/awk/lib.c","line":161,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"FS is set to \u0026fsloc-\u003esval. When getsval() is called on fsloc, getsval() takes care of generating the string, and set fsloc-\u003esval. *FS fetches that value. If you want, I can rewrite this to be:\n\n    char *fs \u003d getsval(fsloc);\n    if (strlen(getsval(fsloc)) \u003e\u003d sizeof (inputFS))\n        FATAL(\"field separator %.10s... is too long\", *FS);\n    (void) strcpy(inputFS, fs);"},{"file":"usr/src/cmd/awk/lib.c","line":161,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"From looking at more code, I guess this makes sense and is the common pattern. Just threw me off initially."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/awk/awk.h","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/cmd/awk/lib.c","type":"MODIFIED","insertions":18,"deletions":-6},{"file":"usr/src/cmd/awk/tran.c","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/test/util-tests/tests/awk/bugs-fixed/fs-overflow.ok","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/test/util-tests/tests/awk/tests/T.split","type":"MODIFIED","insertions":69,"deletions":-6}],"sizeInsertions":91,"sizeDeletions":-13},{"number":"2","revision":"5d0bc79444e7d23f01afe5e43adc663be9545f7a","parents":["643695e369d9586f238a2727e7649bd1b8144c3b"],"ref":"refs/changes/85/4985/2","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1542132592,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1543503627,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}}],"comments":[{"file":"usr/src/cmd/awk/lib.c","line":245,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Can you briefly comment on what ensures that these entries are now taken care of in terms of being updated?"},{"file":"usr/src/cmd/awk/lib.c","line":245,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"This is now done on line 187 in getrec(), when we\u0027re reading a new $0 value. (Whereas before we unconditionally saved the FS value, which is incorrect when using getline with a variable name.)"},{"file":"usr/src/cmd/awk/tran.c","line":380,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"How did you know where to add the savefs? Was this just done in places that upstream had identified?"},{"file":"usr/src/cmd/awk/tran.c","line":380,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"I knew to add it here because this is where we update $0 (the isrec(vp) conditional tests for that), and is also where we take care of resetting the other relevant values, like donefld and donerec."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/awk/awk.h","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/cmd/awk/lib.c","type":"MODIFIED","insertions":18,"deletions":-6},{"file":"usr/src/cmd/awk/tran.c","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/test/util-tests/tests/awk/bugs-fixed/fs-overflow.ok","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/test/util-tests/tests/awk/tests/T.split","type":"MODIFIED","insertions":69,"deletions":-6}],"sizeInsertions":91,"sizeDeletions":-13},{"number":"3","revision":"13be0bd91a83446630c742777d5497d5c63c6450","parents":["7105711e89a284fc7fdc3a0b013f9d01534399df"],"ref":"refs/changes/85/4985/3","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1548269092,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1543503627,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1548280960,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/awk/awk.h","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/cmd/awk/lib.c","type":"MODIFIED","insertions":18,"deletions":-6},{"file":"usr/src/cmd/awk/tran.c","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/test/util-tests/tests/awk/bugs-fixed/fs-overflow.ok","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/test/util-tests/tests/awk/tests/T.split","type":"MODIFIED","insertions":69,"deletions":-6}],"sizeInsertions":91,"sizeDeletions":-13},{"number":"4","revision":"e21906880f8b138e1a6a9c0c539ae2c4974fd66a","parents":["2ba3620fd779507fc8b2c23e44d06bab27fda1c9"],"ref":"refs/changes/85/4985/4","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1549481217,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1543503627,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1548280960,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/cmd/awk/awk.h","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/cmd/awk/lib.c","type":"MODIFIED","insertions":18,"deletions":-6},{"file":"usr/src/cmd/awk/tran.c","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/test/util-tests/tests/awk/bugs-fixed/fs-overflow.ok","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/test/util-tests/tests/awk/tests/T.split","type":"MODIFIED","insertions":69,"deletions":-6}],"sizeInsertions":91,"sizeDeletions":-13},{"number":"5","revision":"b122bc754d317fa3b0bf92271552b1a42bbdacff","parents":["31128c5263d572cc4d92ca113b707b075dac9d7f"],"ref":"refs/changes/85/4985/5","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1560301516,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1543503627,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1548280960,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/cmd/awk/awk.h","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/cmd/awk/lib.c","type":"MODIFIED","insertions":18,"deletions":-6},{"file":"usr/src/cmd/awk/tran.c","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/test/util-tests/tests/awk/bugs-fixed/fs-overflow.ok","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/test/util-tests/tests/awk/tests/T.split","type":"MODIFIED","insertions":69,"deletions":-6}],"sizeInsertions":91,"sizeDeletions":-13},{"number":"6","revision":"084c5c48f7680535f554dd406a99bf0ea8329823","parents":["b4acf023dd2b2008c601d706c1ba8f9684bca593"],"ref":"refs/changes/85/4985/6","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1560451829,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1543503627,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"SUBM","value":"1","grantedOn":1560451887,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1548280960,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/cmd/awk/awk.h","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/cmd/awk/lib.c","type":"MODIFIED","insertions":18,"deletions":-6},{"file":"usr/src/cmd/awk/tran.c","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/test/util-tests/tests/awk/bugs-fixed/fs-overflow.ok","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/test/util-tests/tests/awk/tests/T.split","type":"MODIFIED","insertions":69,"deletions":-6}],"sizeInsertions":91,"sizeDeletions":-13}],"allReviewers":[{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}]}