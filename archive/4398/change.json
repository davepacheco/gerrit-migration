{"project":"joyent/illumos-joyent","branch":"vpc","id":"I37db590275a967a096f42034740562bd471d1de8","number":"4398","subject":"OS-6847 vxlan header allocation should think about mblk chains","owner":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"url":"https://cr.joyent.us/4398","commitMessage":"OS-6847 vxlan header allocation should think about mblk chains\n","createdOn":1529595692,"lastUpdated":1531796548,"open":false,"status":"MERGED","comments":[{"timestamp":1529595692,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Uploaded patch set 1."},{"timestamp":1529595761,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Uploaded patch set 2: Patch Set 1 was rebased."},{"timestamp":1529595970,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 2: Code-Review-1\n\nThis is incomplete. Notably if we end up in the duplicate case then we\u0027ll end up appending this mp to itself in overlay_m_tx(). That needs to be modified such that it the returned mblk_t is the same as the current one we don\u0027t append it to b_cont."},{"timestamp":1529596986,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Uploaded patch set 3."},{"timestamp":1529597150,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Uploaded patch set 4."},{"timestamp":1529603564,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Uploaded patch set 5: Patch Set 4 was rebased."},{"timestamp":1531790108,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 5: Code-Review+1"},{"timestamp":1531793153,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Uploaded patch set 6: Patch Set 5 was rebased."},{"timestamp":1531795302,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 6:\n\nThank you.  Pasting a DTrace script to help us measure how much work to do on reducing allocations...\n\n\ndtrace -n \u0027vxlan_o_encap:entry { self-\u003etrace \u003d 1 ; @encap \u003d count();} allocb:entry /self-\u003etrace \u003d\u003d 1/ { @allocb \u003d count(); self-\u003etrace \u003d 0; } tick-30s { printa(@encap); printa(@allocb);}\u0027"},{"timestamp":1531795457,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 6:\n\nShoot, missed a case in the script:\n\ndtrace -n \u0027vxlan_o_encap:entry { self-\u003etrace \u003d 1 ; @encap \u003d count();} allocb:entry /self-\u003etrace \u003d\u003d 1/ { @allocb \u003d count(); self-\u003etrace \u003d 0; } tick-30s { printa(@encap); printa(@allocb);} vxlan_o_encap:return /self-\u003etrace \u003d\u003d 1/ {self-\u003etrace \u003d 0;}\u0027"},{"timestamp":1531795745,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 6: Integration-Approval+1"},{"timestamp":1531795756,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 6: Code-Review+1"},{"timestamp":1531796548,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Dan McDonald"}],"currentPatchSet":{"number":"6","revision":"37db590275a967a096f42034740562bd471d1de8","parents":["56a0b7da9cab3f6b3e5d82686742f45c1bf56315"],"ref":"refs/changes/98/4398/6","uploader":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"createdOn":1531793153,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1531790108,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1531795745,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1531795756,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"SUBM","value":"1","grantedOn":1531796546,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/io/overlay/overlay.c","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/common/io/overlay/plugins/overlay_vxlan.c","type":"MODIFIED","insertions":35,"deletions":-13}],"sizeInsertions":36,"sizeDeletions":-14},"patchSets":[{"number":"1","revision":"9d4db0b014183527fb574bd7a06fe4afb0166589","parents":["521e8b7d59251665839a7e82ccc8b3d8663a0d23"],"ref":"refs/changes/98/4398/1","uploader":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"createdOn":1529595692,"author":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/io/overlay/plugins/overlay_vxlan.c","type":"MODIFIED","insertions":34,"deletions":-13}],"sizeInsertions":34,"sizeDeletions":-13},{"number":"2","revision":"eea4ff548d92fcf9174c65bbe217e46cac77c0a1","parents":["521e8b7d59251665839a7e82ccc8b3d8663a0d23"],"ref":"refs/changes/98/4398/2","uploader":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"createdOn":1529595761,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"NO_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"-1","grantedOn":1529595970,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/io/overlay/plugins/overlay_vxlan.c","type":"MODIFIED","insertions":34,"deletions":-13}],"sizeInsertions":34,"sizeDeletions":-13},{"number":"3","revision":"ed212cb03d21e251a33c061fe39e249a0c2e5feb","parents":["521e8b7d59251665839a7e82ccc8b3d8663a0d23"],"ref":"refs/changes/98/4398/3","uploader":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"createdOn":1529596986,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"-1","grantedOn":1529595970,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/io/overlay/overlay.c","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/common/io/overlay/plugins/overlay_vxlan.c","type":"MODIFIED","insertions":34,"deletions":-13}],"sizeInsertions":35,"sizeDeletions":-14},{"number":"4","revision":"e81e7baf66169974cac06b703d68386f191c02f1","parents":["521e8b7d59251665839a7e82ccc8b3d8663a0d23"],"ref":"refs/changes/98/4398/4","uploader":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"createdOn":1529597150,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"-1","grantedOn":1529595970,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/io/overlay/overlay.c","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/common/io/overlay/plugins/overlay_vxlan.c","type":"MODIFIED","insertions":35,"deletions":-13}],"sizeInsertions":36,"sizeDeletions":-14},{"number":"5","revision":"77711d4d1287c0841845d249d4dfc3add2c75f6a","parents":["dd556aabc928ff838cdb07cb0b6aa6063a2ebdf6"],"ref":"refs/changes/98/4398/5","uploader":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"createdOn":1529603564,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1531790108,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/io/overlay/overlay.c","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/common/io/overlay/plugins/overlay_vxlan.c","type":"MODIFIED","insertions":35,"deletions":-13}],"sizeInsertions":36,"sizeDeletions":-14},{"number":"6","revision":"37db590275a967a096f42034740562bd471d1de8","parents":["56a0b7da9cab3f6b3e5d82686742f45c1bf56315"],"ref":"refs/changes/98/4398/6","uploader":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"createdOn":1531793153,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1531790108,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1531795756,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1531795745,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"SUBM","value":"1","grantedOn":1531796546,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/io/overlay/overlay.c","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/common/io/overlay/plugins/overlay_vxlan.c","type":"MODIFIED","insertions":35,"deletions":-13}],"sizeInsertions":36,"sizeDeletions":-14}],"allReviewers":[{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}]}