{"project":"joyent/illumos-joyent","branch":"master","id":"Id21e83058c8edeb1becd9202380d088cb056f0c4","number":"462","subject":"OS-5637 lxbrand vdso busts golang stack budget Reviewed by: Robert Mustacchi \u003crm@joyent.com\u003e Reviewed by: Ryan Zezeski \u003crpz@joyent.com\u003e Reviewed by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e Approved by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e","owner":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"url":"https://cr.joyent.us/462","commitMessage":"OS-5637 lxbrand vdso busts golang stack budget\nReviewed by: Robert Mustacchi \u003crm@joyent.com\u003e\nReviewed by: Ryan Zezeski \u003crpz@joyent.com\u003e\nReviewed by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e\nApproved by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e\n","createdOn":1473803557,"lastUpdated":1474673243,"open":false,"status":"MERGED","comments":[{"timestamp":1473803557,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 1."},{"timestamp":1474323086,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 1:\n\n(6 comments)\n\nAs best I can see this all looks really good. I just had a few small nits or questions."},{"timestamp":1474405933,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 2."},{"timestamp":1474405959,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 2:\n\n(5 comments)"},{"timestamp":1474409171,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 1:\n\n(23 comments)"},{"timestamp":1474409376,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1474411453,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Patch Set 2:\n\n(2 comments)"},{"timestamp":1474429650,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 3."},{"timestamp":1474429659,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 2:\n\n(18 comments)"},{"timestamp":1474459093,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 3: Code-Review+1\n\nThe new comments are very helpful, thanks!"},{"timestamp":1474496661,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 3:\n\n(3 comments)"},{"timestamp":1474507997,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 4."},{"timestamp":1474508008,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 3:\n\n(3 comments)"},{"timestamp":1474518555,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 4: Code-Review+1\n\nThanks for the follow up, Patrick."},{"timestamp":1474546478,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 4: Code-Review+1 Integration-Approval+1"},{"timestamp":1474563189,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Patch Set 3:\n\n(3 comments)"},{"timestamp":1474601083,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 5."},{"timestamp":1474633024,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 5: Code-Review+1"},{"timestamp":1474652702,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 5: Code-Review+1"},{"timestamp":1474656295,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 5: Integration-Approval+1"},{"timestamp":1474656446,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 3:\n\n(2 comments)\n\nI have a fresh build of the most recent changeset running on lab hardware.  Using the stress test noted in the ticket, I\u0027m running on both native and LX (both 32-bit and 64-bit on native)."},{"timestamp":1474668226,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Patch Set 5: Code-Review+1\n\nI reviewed the majority of the ASM and C code. LGTM."},{"timestamp":1474668821,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 6: Patch Set 5 was rebased."},{"timestamp":1474668933,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 7: Commit message was updated."},{"timestamp":1474673243,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Patrick Mooney"}],"currentPatchSet":{"number":"7","revision":"d21e83058c8edeb1becd9202380d088cb056f0c4","parents":["9608e4c230925bfc3f7987c1f8d43ad6e01e8f86"],"ref":"refs/changes/62/462/7","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1474668933,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1474633024,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1474652702,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1474656295,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1474668226,"by":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"}},{"type":"SUBM","value":"1","grantedOn":1474673243,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"usr/src/lib/brand/lx/lx_vdso/Makefile.com","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"usr/src/lib/brand/lx/lx_vdso/amd64/Makefile","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/lib/brand/lx/lx_vdso/amd64/vdso_subr.s","type":"MODIFIED","insertions":64,"deletions":-1},{"file":"usr/src/lib/brand/lx/lx_vdso/common/vdso_defs.h","type":"ADDED","insertions":42,"deletions":0},{"file":"usr/src/lib/brand/lx/lx_vdso/common/vdso_main.c","type":"MODIFIED","insertions":53,"deletions":-73},{"file":"usr/src/lib/commpage/Makefile.shared.com","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"usr/src/lib/commpage/Makefile.shared.targ","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"usr/src/lib/commpage/amd64/cp_subr.s","type":"MODIFIED","insertions":345,"deletions":-79},{"file":"usr/src/lib/commpage/common/cp_defs.h","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/lib/commpage/common/cp_main.c","type":"MODIFIED","insertions":71,"deletions":-72},{"file":"usr/src/lib/commpage/common/offsets.in","type":"ADDED","insertions":35,"deletions":0},{"file":"usr/src/lib/commpage/i386/cp_subr.s","type":"MODIFIED","insertions":90,"deletions":-86},{"file":"usr/src/lib/libc/amd64/Makefile","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/lib/libc/i386/Makefile.com","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/lib/libc/i386/sys/__clock_gettime.c","type":"MODIFIED","insertions":3,"deletions":-5}],"sizeInsertions":726,"sizeDeletions":-326},"patchSets":[{"number":"1","revision":"7b22e799bc028cf67a0385ab6e95fbce6488ea33","parents":["d947f3808f053fb13e1fe4de8637c50e7e88c4c7"],"ref":"refs/changes/62/462/1","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1473803557,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/lib/brand/lx/lx_vdso/amd64/vdso_subr.s","line":26,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Can this and vdso_main.c share common header for this so we don\u0027t have to duplicate the #define\u0027s?"},{"file":"usr/src/lib/brand/lx/lx_vdso/amd64/vdso_subr.s","line":26,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Yep, moving it into vdso_defs.h along with a few other things."},{"file":"usr/src/lib/brand/lx/lx_vdso/amd64/vdso_subr.s","line":100,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"It might be helpful to add a comment in the code pointing out that you\u0027re tail calling the various __cp_clock_gettime_* functions here."},{"file":"usr/src/lib/brand/lx/lx_vdso/amd64/vdso_subr.s","line":100,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Done."},{"file":"usr/src/lib/brand/lx/lx_vdso/amd64/vdso_subr.s","line":100,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Yes please, that\u0027d be really useful."},{"file":"usr/src/lib/brand/lx/lx_vdso/common/vdso_main.c","line":30,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Add a comment telling people where to look for amd64 bits. Or alternatively move the i386 specific stuff to an i386 dir."},{"file":"usr/src/lib/brand/lx/lx_vdso/common/vdso_main.c","line":30,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"I\u0027ll add a comment.  I don\u0027t want to split the file up beyond that since everything else is shared."},{"file":"usr/src/lib/brand/lx/lx_vdso/common/vdso_main.c","line":64,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Is there a particular reason this is in the #ifndef __amd64 section"},{"file":"usr/src/lib/brand/lx/lx_vdso/common/vdso_main.c","line":64,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"It\u0027s only used in the __vdso_clock_gettime below.  I wanted to keep the defines as tightly scoped as needed.  I\u0027ll get them moved into a shared header."},{"file":"usr/src/lib/commpage/amd64/cp_subr.s","line":27,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"s/the/they\n\nIt might be worth expanding this comment to point out the location where the source definitions are originally defined so someone updating those would presumably know these should match (since there are multiple definitions for NSEC_SHIFT at least). I don\u0027t think you have to update those src locations though since this can be found with cscope"},{"file":"usr/src/lib/commpage/amd64/cp_subr.s","line":27,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Fixed the type and added a comment about the source of the constants."},{"file":"usr/src/lib/commpage/amd64/cp_subr.s","line":27,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"It would be nice to have a comment in the i86pc/os/timestamp.c nsec_shift as well."},{"file":"usr/src/lib/commpage/amd64/cp_subr.s","line":27,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"A comment in timestamp.c noting that the definitions are cloned in lib/commpage?"},{"file":"usr/src/lib/commpage/amd64/cp_subr.s","line":38,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Can these types of comments be expanded to be stack usage as I think that\u0027s what they\u0027re tracking."},{"file":"usr/src/lib/commpage/amd64/cp_subr.s","line":38,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Expanded to \u0027Stack usage\u0027 and added more detail to the notes."},{"file":"usr/src/lib/commpage/amd64/cp_subr.s","line":48,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"While I realize that you\u0027re trying to just shift this so we have the higher 32 bits in %rdx, I think a comment to that effect would be useful."},{"file":"usr/src/lib/commpage/amd64/cp_subr.s","line":48,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Added.  I\u0027m not going to repeat it for the other sites unless you believe it\u0027s absolutely necessary."},{"file":"usr/src/lib/commpage/amd64/cp_subr.s","line":54,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Could you add something to indicate that this is the more than one cpu case? I think that\u0027ll make this a bit clearer as to what happened at the jne 1f above (though it\u0027s clear to me at the moment because this code is all in my head)."},{"file":"usr/src/lib/commpage/amd64/cp_subr.s","line":54,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Done."},{"file":"usr/src/lib/commpage/amd64/cp_subr.s","line":111,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"I was confused for a minute here. It might be worth expanding the comment to note that the logic from label 2 is essentially happening again here so that we can detect yet another migration on the retry."},{"file":"usr/src/lib/commpage/amd64/cp_subr.s","line":111,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Expanded on this comment."},{"file":"usr/src/lib/commpage/amd64/cp_subr.s","line":155,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"May be useful to describe what things use this stack with a small stack layout diagram. For example, talking about how we\u0027re going to have our registers clobbered by calling __cp_tsc_read."},{"file":"usr/src/lib/commpage/amd64/cp_subr.s","line":174,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Are you sure that this is right? Don\u0027t we traditionally compare hres_lock with ~1 and then do the cmpl? The constant here has the value of ~2."},{"file":"usr/src/lib/commpage/amd64/cp_subr.s","line":174,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Fixed"},{"file":"usr/src/lib/commpage/amd64/cp_subr.s","line":206,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"isn\u0027t rax the tsc_delta here and since you are setting it to 0 would it be clearer to do the simpler setup and return instead of jumping back to label 2? Or am I mixed up on this? If you would rather jmp back maybe add a comment noting that the tsc adjustement is 0 so the first 3 instructions in block 2 will have no effect?"},{"file":"usr/src/lib/commpage/amd64/cp_subr.s","line":206,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"In this case, %rax is the delta which is applied to the hrtime base.  I\u0027ll expand on the comment which explains this logic as it\u0027s less-than-straightforward for the purpose of hot-path optimization."},{"file":"usr/src/lib/commpage/amd64/cp_subr.s","line":223,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"So, it\u0027s my reading of tsc_gethrtime() in uts/i86pc/os/timestamp.c that all of this happens in the context of checking hres_lock. Have I read it correctly that all the adjustment logic is being done outside of checking the lock?"},{"file":"usr/src/lib/commpage/amd64/cp_subr.s","line":223,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Since tsc_nsec_scale, tsc_max_delta and tsc_resume_cap are fixed after startup, the adjustments performed with them don\u0027t require hres_lock protection.  I\u0027ve ensured that the data that does require consistency under the lock (tsc_last, hrtime_base and the tsc reading) is copied properly."},{"file":"usr/src/lib/commpage/amd64/cp_subr.s","line":231,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Similar comments on stack usage."},{"file":"usr/src/lib/commpage/amd64/cp_subr.s","line":237,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"We should comment that it\u0027s explicitly the case that __cp_gethrtime will never clobber %rdi and that we\u0027re relying on it.  This should also be commented in the call to __cp_gethrtime. Otherwise, someone will not realize this implicit assumption and break it."},{"file":"usr/src/lib/commpage/amd64/cp_subr.s","line":237,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"How is it that we\u0027re relying on preservation of %rdi?  The address to the comm page isn\u0027t used later in the function.  The second parameter, the timespec_t *, is preserved on the stack."},{"file":"usr/src/lib/commpage/amd64/cp_subr.s","line":239,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Where did all of this logic come from? It\u0027d be great to have some comments on it."},{"file":"usr/src/lib/commpage/amd64/cp_subr.s","line":239,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Updated in changeset 2"},{"file":"usr/src/lib/commpage/amd64/cp_subr.s","line":243,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Here and at +245 should probably have a space after the , before the second reg."},{"file":"usr/src/lib/commpage/amd64/cp_subr.s","line":243,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Done. There were several other occurrences of this which I fixed up as well."},{"file":"usr/src/lib/commpage/amd64/cp_subr.s","line":262,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"It\u0027d be nice to have some comments on the stack bits there."},{"file":"usr/src/lib/commpage/amd64/cp_subr.s","line":286,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Can we make sure that these jumps line up with everything else?"},{"file":"usr/src/lib/commpage/amd64/cp_subr.s","line":286,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"What do you mean by that?"},{"file":"usr/src/lib/commpage/amd64/cp_subr.s","line":286,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I was referring to the fact that there\u0027s usually a tab over to the location to jump to relative to the rest. Here there\u0027s a space. See +277 for example."},{"file":"usr/src/lib/commpage/amd64/cp_subr.s","line":286,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Ah, yeah.  Fixed."},{"file":"usr/src/lib/commpage/amd64/cp_subr.s","line":312,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"The original pc_gethrestime() truncates this logic to an int. Is there a reason we\u0027re not doing that here? I\u0027m not sure it\u0027s safe to assume that we don\u0027t have to."},{"file":"usr/src/lib/commpage/amd64/cp_subr.s","line":312,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"I\u0027ve change the logic to truncate the hres_adj value down to 32-bit.  The equivalent to \u0027nslt\u0027 is still 64-bit, but proper tick occurrence should keep that constrained to a reasonable value."},{"file":"usr/src/lib/commpage/amd64/cp_subr.s","line":322,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"The original pc_gethrestime() truncates this logic to an int. Is there a reason we\u0027re not doing that here? I\u0027m not sure it\u0027s safe to assume that we don\u0027t have to."},{"file":"usr/src/lib/commpage/amd64/cp_subr.s","line":322,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Addressed above."},{"file":"usr/src/lib/commpage/common/cp_main.c","line":93,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"I\u0027m not sure why the more complex logic is no longer needed. Was that only for the amd64 case?"},{"file":"usr/src/lib/commpage/common/cp_main.c","line":93,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"The per-CPU adjustment has been rolled into the __cp_tsc_read function for both amd64 and i386."},{"file":"usr/src/lib/commpage/common/cp_main.c","line":93,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"It looks like maybe some of this logic moved into __cp_tsc_read()? Is that the case? If so, then I think the comment above needs to be amended to indicate that it\u0027s __cp_tsc_read() that handles the trickier cases of migration."},{"file":"usr/src/lib/commpage/common/cp_main.c","line":159,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Is it possible here that due to the negative adjustment that tv_nsec went negative and we need to do similar treatment here?"},{"file":"usr/src/lib/commpage/common/cp_main.c","line":184,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"I know this comment pairs with the #ifdef for amd64 but since this is the x86 block of the ifdef it seems like a possible source of confusion"},{"file":"usr/src/lib/commpage/common/cp_main.c","line":184,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Maybe a better way to deal with this is to change the #define up top to #if !defined(__amd64). That way we don\u0027t need the else case and it matches up. The comment could then be updated to explain what\u0027s going on."},{"file":"usr/src/lib/commpage/i386/cp_subr.s","line":30,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"This comment is a big vague. Is this your stack budget, stack usage, something else?"},{"file":"usr/src/lib/commpage/i386/cp_subr.s","line":54,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"So it looks like when we have the tscp version, we don\u0027t need to do the cpu determination bit to determine if we context switched. Is that right? That would be why we don\u0027t deal with the loop around labels 8/9?"},{"file":"usr/src/lib/commpage/i386/cp_subr.s","line":54,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Correct, the CPU ID is stored in IA32_TSC_AUX. I\u0027ll copy the comment over from the amd64 version to note this."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/brand/lx/lx_vdso/Makefile.com","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/lib/brand/lx/lx_vdso/amd64/Makefile","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/lib/brand/lx/lx_vdso/amd64/vdso_subr.s","type":"MODIFIED","insertions":63,"deletions":0},{"file":"usr/src/lib/brand/lx/lx_vdso/common/vdso_main.c","type":"MODIFIED","insertions":43,"deletions":-57},{"file":"usr/src/lib/commpage/Makefile.shared.com","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"usr/src/lib/commpage/Makefile.shared.targ","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"usr/src/lib/commpage/amd64/cp_subr.s","type":"MODIFIED","insertions":273,"deletions":-79},{"file":"usr/src/lib/commpage/common/cp_defs.h","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/lib/commpage/common/cp_main.c","type":"MODIFIED","insertions":71,"deletions":-72},{"file":"usr/src/lib/commpage/common/offsets.in","type":"ADDED","insertions":35,"deletions":0},{"file":"usr/src/lib/commpage/i386/cp_subr.s","type":"MODIFIED","insertions":83,"deletions":-84},{"file":"usr/src/lib/libc/amd64/Makefile","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/lib/libc/i386/Makefile.com","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/lib/libc/i386/sys/__clock_gettime.c","type":"MODIFIED","insertions":2,"deletions":-4}],"sizeInsertions":591,"sizeDeletions":-304},{"number":"2","revision":"91337f25ca5366efeaf5c5eff29e4a6ca1f0ad3d","parents":["6a41e7224f5dce21547e07eced881016dac9e18a"],"ref":"refs/changes/62/462/2","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1474405933,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/lib/commpage/i386/cp_subr.s","line":112,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"I don\u0027t understand why we have to play these eax/ecx games here (and below where we then xchg back. Why not just leave eax alone and use ecx for the CPU num?"},{"file":"usr/src/lib/commpage/i386/cp_subr.s","line":112,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Fixed"},{"file":"usr/src/lib/commpage/i386/cp_subr.s","line":120,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"When performing another reading you start with attempting the mfence/rdtsc reading instead of rdtscp. Just want to point this out and make sure it was intentional (it looks like this was also the login in the previous code)."},{"file":"usr/src/lib/commpage/i386/cp_subr.s","line":120,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"If rdtscp is available, we aren\u0027t required to do this dance at all since we can read the TSC _and_ the CPU ID simultaneously.  When it\u0027s not available (and we\u0027re falling back to the other serializing instructions prior to taking a TSC reading) this lsl-style lookup is used."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/brand/lx/lx_vdso/Makefile.com","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/lib/brand/lx/lx_vdso/amd64/Makefile","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/lib/brand/lx/lx_vdso/amd64/vdso_subr.s","type":"MODIFIED","insertions":68,"deletions":0},{"file":"usr/src/lib/brand/lx/lx_vdso/common/vdso_main.c","type":"MODIFIED","insertions":43,"deletions":-57},{"file":"usr/src/lib/commpage/Makefile.shared.com","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"usr/src/lib/commpage/Makefile.shared.targ","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"usr/src/lib/commpage/amd64/cp_subr.s","type":"MODIFIED","insertions":321,"deletions":-79},{"file":"usr/src/lib/commpage/common/cp_defs.h","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/lib/commpage/common/cp_main.c","type":"MODIFIED","insertions":71,"deletions":-72},{"file":"usr/src/lib/commpage/common/offsets.in","type":"ADDED","insertions":35,"deletions":0},{"file":"usr/src/lib/commpage/i386/cp_subr.s","type":"MODIFIED","insertions":83,"deletions":-84},{"file":"usr/src/lib/libc/amd64/Makefile","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/lib/libc/i386/Makefile.com","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/lib/libc/i386/sys/__clock_gettime.c","type":"MODIFIED","insertions":2,"deletions":-4}],"sizeInsertions":644,"sizeDeletions":-304},{"number":"3","revision":"9d96c1ff2f398f9795e71284c07372bf73ffc2a0","parents":["6a41e7224f5dce21547e07eced881016dac9e18a"],"ref":"refs/changes/62/462/3","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1474429650,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1474459093,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"comments":[{"file":"usr/src/lib/commpage/amd64/cp_subr.s","line":87,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Small nit: looks like you could avoid this mov if you read the CPU ID into r10 directly."},{"file":"usr/src/lib/commpage/amd64/cp_subr.s","line":144,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Not that I think it has to change, but again I think you could avoid a mov:\n\n\tmovl\t$GETCPU_GDT_OFFSET, %edx\n\tlsl\t%dx, %edx\n\tcmpl\t%edx, %r10d\n\tjne\t3b\n\tmovl\t%edx, %ecx\n\tmovq\t(%r9, %rcx, 8), %rdx\n\taddq\t%rdx, %rax"},{"file":"usr/src/lib/commpage/amd64/cp_subr.s","line":144,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"I\u0027ve switched this up to be simpler about register usage."},{"file":"usr/src/lib/commpage/amd64/cp_subr.s","line":387,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Are we guaranteed that the 64-bit register here is zeroed up top or extended properly? I\u0027m not sure what the expected semantics are, since we originally moved a 64-bit value into it and then did 32-bit math."},{"file":"usr/src/lib/commpage/amd64/cp_subr.s","line":387,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"The value from r11d will be truncated to 32 bits (the upper half of a long-mode register is zero filled for 32-bit operations).  Since it will be positive for this block, the truncation should work as desired."},{"file":"usr/src/lib/commpage/amd64/cp_subr.s","line":397,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"See comment at +387."},{"file":"usr/src/lib/commpage/amd64/cp_subr.s","line":397,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"This block is structured to tolerate the high-bit clearing behavior of movl.  The comparison is done against what will be a positive number after the negation.  After that, subtracting the positive value should yield the proper result."},{"file":"usr/src/lib/commpage/common/cp_main.c","line":24,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"I\u0027m not sure if I said this during the initial comm page put back, but to me the return values for this function are reversed. Since it\u0027s called \"can gettime\" I think of it was a bool function and expect 1 to mean yes and 0 to mean no. Not saying it needs to change, just FYI."},{"file":"usr/src/lib/commpage/common/cp_main.c","line":24,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"I\u0027ve changed this around.  (It was originally designed with the \u0027ret !\u003d 0 implies error\u0027 behavior in mind)"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/brand/lx/lx_vdso/Makefile.com","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"usr/src/lib/brand/lx/lx_vdso/amd64/Makefile","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/lib/brand/lx/lx_vdso/amd64/vdso_subr.s","type":"MODIFIED","insertions":64,"deletions":-1},{"file":"usr/src/lib/brand/lx/lx_vdso/common/vdso_defs.h","type":"ADDED","insertions":42,"deletions":0},{"file":"usr/src/lib/brand/lx/lx_vdso/common/vdso_main.c","type":"MODIFIED","insertions":52,"deletions":-72},{"file":"usr/src/lib/commpage/Makefile.shared.com","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"usr/src/lib/commpage/Makefile.shared.targ","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"usr/src/lib/commpage/amd64/cp_subr.s","type":"MODIFIED","insertions":346,"deletions":-79},{"file":"usr/src/lib/commpage/common/cp_defs.h","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/lib/commpage/common/cp_main.c","type":"MODIFIED","insertions":71,"deletions":-72},{"file":"usr/src/lib/commpage/common/offsets.in","type":"ADDED","insertions":35,"deletions":0},{"file":"usr/src/lib/commpage/i386/cp_subr.s","type":"MODIFIED","insertions":90,"deletions":-86},{"file":"usr/src/lib/libc/amd64/Makefile","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/lib/libc/i386/Makefile.com","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/lib/libc/i386/sys/__clock_gettime.c","type":"MODIFIED","insertions":2,"deletions":-4}],"sizeInsertions":725,"sizeDeletions":-324},{"number":"4","revision":"837f9008b265e88cf06fcd1e60992cef35db80d4","parents":["6a41e7224f5dce21547e07eced881016dac9e18a"],"ref":"refs/changes/62/462/4","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1474507997,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1474518555,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1474546478,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1474546478,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/brand/lx/lx_vdso/Makefile.com","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"usr/src/lib/brand/lx/lx_vdso/amd64/Makefile","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/lib/brand/lx/lx_vdso/amd64/vdso_subr.s","type":"MODIFIED","insertions":64,"deletions":-1},{"file":"usr/src/lib/brand/lx/lx_vdso/common/vdso_defs.h","type":"ADDED","insertions":42,"deletions":0},{"file":"usr/src/lib/brand/lx/lx_vdso/common/vdso_main.c","type":"MODIFIED","insertions":52,"deletions":-72},{"file":"usr/src/lib/commpage/Makefile.shared.com","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"usr/src/lib/commpage/Makefile.shared.targ","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"usr/src/lib/commpage/amd64/cp_subr.s","type":"MODIFIED","insertions":346,"deletions":-79},{"file":"usr/src/lib/commpage/common/cp_defs.h","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/lib/commpage/common/cp_main.c","type":"MODIFIED","insertions":71,"deletions":-72},{"file":"usr/src/lib/commpage/common/offsets.in","type":"ADDED","insertions":35,"deletions":0},{"file":"usr/src/lib/commpage/i386/cp_subr.s","type":"MODIFIED","insertions":90,"deletions":-86},{"file":"usr/src/lib/libc/amd64/Makefile","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/lib/libc/i386/Makefile.com","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/lib/libc/i386/sys/__clock_gettime.c","type":"MODIFIED","insertions":2,"deletions":-4}],"sizeInsertions":725,"sizeDeletions":-324},{"number":"5","revision":"72e9e7c793984eb25956533b5a1115c9c148519d","parents":["09b9f0e78b5878f94478446e2b0d61b0cf5a6577"],"ref":"refs/changes/62/462/5","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1474601083,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1474652702,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1474633024,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1474656295,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1474668226,"by":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/brand/lx/lx_vdso/Makefile.com","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"usr/src/lib/brand/lx/lx_vdso/amd64/Makefile","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/lib/brand/lx/lx_vdso/amd64/vdso_subr.s","type":"MODIFIED","insertions":64,"deletions":-1},{"file":"usr/src/lib/brand/lx/lx_vdso/common/vdso_defs.h","type":"ADDED","insertions":42,"deletions":0},{"file":"usr/src/lib/brand/lx/lx_vdso/common/vdso_main.c","type":"MODIFIED","insertions":53,"deletions":-73},{"file":"usr/src/lib/commpage/Makefile.shared.com","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"usr/src/lib/commpage/Makefile.shared.targ","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"usr/src/lib/commpage/amd64/cp_subr.s","type":"MODIFIED","insertions":345,"deletions":-79},{"file":"usr/src/lib/commpage/common/cp_defs.h","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/lib/commpage/common/cp_main.c","type":"MODIFIED","insertions":71,"deletions":-72},{"file":"usr/src/lib/commpage/common/offsets.in","type":"ADDED","insertions":35,"deletions":0},{"file":"usr/src/lib/commpage/i386/cp_subr.s","type":"MODIFIED","insertions":90,"deletions":-86},{"file":"usr/src/lib/libc/amd64/Makefile","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/lib/libc/i386/Makefile.com","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/lib/libc/i386/sys/__clock_gettime.c","type":"MODIFIED","insertions":3,"deletions":-5}],"sizeInsertions":726,"sizeDeletions":-326},{"number":"6","revision":"ade93357bec1ec2c23108ce64eaa40a89e5c2a6b","parents":["9608e4c230925bfc3f7987c1f8d43ad6e01e8f86"],"ref":"refs/changes/62/462/6","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1474668821,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1474652702,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1474633024,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1474656295,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1474668226,"by":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/brand/lx/lx_vdso/Makefile.com","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"usr/src/lib/brand/lx/lx_vdso/amd64/Makefile","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/lib/brand/lx/lx_vdso/amd64/vdso_subr.s","type":"MODIFIED","insertions":64,"deletions":-1},{"file":"usr/src/lib/brand/lx/lx_vdso/common/vdso_defs.h","type":"ADDED","insertions":42,"deletions":0},{"file":"usr/src/lib/brand/lx/lx_vdso/common/vdso_main.c","type":"MODIFIED","insertions":53,"deletions":-73},{"file":"usr/src/lib/commpage/Makefile.shared.com","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"usr/src/lib/commpage/Makefile.shared.targ","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"usr/src/lib/commpage/amd64/cp_subr.s","type":"MODIFIED","insertions":345,"deletions":-79},{"file":"usr/src/lib/commpage/common/cp_defs.h","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/lib/commpage/common/cp_main.c","type":"MODIFIED","insertions":71,"deletions":-72},{"file":"usr/src/lib/commpage/common/offsets.in","type":"ADDED","insertions":35,"deletions":0},{"file":"usr/src/lib/commpage/i386/cp_subr.s","type":"MODIFIED","insertions":90,"deletions":-86},{"file":"usr/src/lib/libc/amd64/Makefile","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/lib/libc/i386/Makefile.com","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/lib/libc/i386/sys/__clock_gettime.c","type":"MODIFIED","insertions":3,"deletions":-5}],"sizeInsertions":726,"sizeDeletions":-326},{"number":"7","revision":"d21e83058c8edeb1becd9202380d088cb056f0c4","parents":["9608e4c230925bfc3f7987c1f8d43ad6e01e8f86"],"ref":"refs/changes/62/462/7","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1474668933,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1474652702,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1474633024,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1474656295,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"SUBM","value":"1","grantedOn":1474673243,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1474668226,"by":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"usr/src/lib/brand/lx/lx_vdso/Makefile.com","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"usr/src/lib/brand/lx/lx_vdso/amd64/Makefile","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/lib/brand/lx/lx_vdso/amd64/vdso_subr.s","type":"MODIFIED","insertions":64,"deletions":-1},{"file":"usr/src/lib/brand/lx/lx_vdso/common/vdso_defs.h","type":"ADDED","insertions":42,"deletions":0},{"file":"usr/src/lib/brand/lx/lx_vdso/common/vdso_main.c","type":"MODIFIED","insertions":53,"deletions":-73},{"file":"usr/src/lib/commpage/Makefile.shared.com","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"usr/src/lib/commpage/Makefile.shared.targ","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"usr/src/lib/commpage/amd64/cp_subr.s","type":"MODIFIED","insertions":345,"deletions":-79},{"file":"usr/src/lib/commpage/common/cp_defs.h","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/lib/commpage/common/cp_main.c","type":"MODIFIED","insertions":71,"deletions":-72},{"file":"usr/src/lib/commpage/common/offsets.in","type":"ADDED","insertions":35,"deletions":0},{"file":"usr/src/lib/commpage/i386/cp_subr.s","type":"MODIFIED","insertions":90,"deletions":-86},{"file":"usr/src/lib/libc/amd64/Makefile","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/lib/libc/i386/Makefile.com","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/lib/libc/i386/sys/__clock_gettime.c","type":"MODIFIED","insertions":3,"deletions":-5}],"sizeInsertions":726,"sizeDeletions":-326}],"allReviewers":[{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}]}