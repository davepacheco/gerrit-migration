From 82bb5d326e59b02c75a01429776b931246b53a03 Mon Sep 17 00:00:00 2001
From: John Levon <john.levon@joyent.com>
Date: Mon, 29 Jul 2019 13:46:42 +0000
Subject: [PATCH] TOOLS-2299 bin/reflash needs to regenerate build.spec.merged
 Reviewed by: Tim Foster <tim.foster@joyent.com> Approved by: Tim Foster
 <tim.foster@joyent.com>

---
 bin/reflash | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/bin/reflash b/bin/reflash
index b05fe881..ece66249 100755
--- a/bin/reflash
+++ b/bin/reflash
@@ -179,6 +179,12 @@ check_prerequisites()
     else
         fatal "Unsupported platform ${uname}"
     fi
+
+    # make sure we're using an up to date build spec
+    (cd $ROOT && gmake --quiet build.spec.merged) || {
+        echo "failed to update $ROOT/build.spec.merged" 2>&1
+        exit 1
+    }
 }
 
 check_user_sanity()
-- 
2.21.0

