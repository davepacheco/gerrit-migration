{"project":"joyent/smartos-live","branch":"master","id":"Icc4a798dca6a7df7fe0f84e2dd74b0e38879367f","number":"5318","subject":"OS-7435 imgadm \"create\" tests fail after OS-7343","owner":{"name":"Dylan Yep","email":"dyep49@gmail.com","username":"dyep49"},"url":"https://cr.joyent.us/5318","commitMessage":"OS-7435 imgadm \"create\" tests fail after OS-7343\n","createdOn":1546812074,"lastUpdated":1547152678,"open":false,"status":"MERGED","comments":[{"timestamp":1546812074,"reviewer":{"name":"Dylan Yep","email":"dyep49@gmail.com","username":"dyep49"},"message":"Uploaded patch set 1."},{"timestamp":1546812074,"reviewer":{"name":"Dylan Yep","email":"dyep49@gmail.com","username":"dyep49"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit 09837d606a4863f19f75ba30afec70f8fcc30c02\n    \n    fix bhyve create image test"},{"timestamp":1546812131,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1546876302,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 1:\n\nAdded the following (and a bit more) to a comment in the ticket:\n\nMaybe it would be better to explicitly use the same bhyve image as the vm tests use. For now that could be hard coded to 462d1d03-8457-e134-a408-cf9ea2b9be96.  It would probably be a good idea to be sure that /usr/img/test/runtests installs that image just as /usr/vm/test/runtest does.  Comments should be added in each runtest* file to remind future developers to update the other."},{"timestamp":1546899846,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 1:\n\n(2 comments)"},{"timestamp":1546899997,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 1:\n\nAnd if it is easier, we could update the mk-custom-image and try-custom-image scripts to handle Bhyve and then just have the JS test code call those scripts (as the other create.test.js cases are doing)."},{"timestamp":1546933805,"reviewer":{"name":"Dylan Yep","email":"dyep49@gmail.com","username":"dyep49"},"message":"Uploaded patch set 2."},{"timestamp":1546933806,"reviewer":{"name":"Dylan Yep","email":"dyep49@gmail.com","username":"dyep49"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit 0418a58ff69649d6587fcdb3216f769cc4d6f676\n    \n    hardcode bhyve uuid"},{"timestamp":1546933858,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1546934446,"reviewer":{"name":"Dylan Yep","email":"dyep49@gmail.com","username":"dyep49"},"message":"Patch Set 2:\n\n(1 comment)\n\nI decided to hardcode \"ac99517a-72ac-44c0-90e6-c7ce3d944a0a\", which is the most recent bhyve compatible image available on images.joyent.com. The vm tests use \"462d1d03-8457-e134-a408-cf9ea2b9be96\", but that\u0027s only stored in Manta."},{"timestamp":1546957905,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1546973665,"reviewer":{"name":"Dylan Yep","email":"dyep49@gmail.com","username":"dyep49"},"message":"Uploaded patch set 3."},{"timestamp":1546973666,"reviewer":{"name":"Dylan Yep","email":"dyep49@gmail.com","username":"dyep49"},"message":"Patch Set 3:\n\nNew commits:\n    \n    commit 7828be505490f9d1e25ead946a556f8d54bb9c8e\n    \n    clarify ubuntu version number\n    \n    commit e1c005d900f9c1c2a6f79cdd4212dce1a749e16e\n    \n    hardcode bhyve uuid\n    \n    commit 51f73f65047ff84a5dfad0c2c151816fe02b2457\n    \n    fix bhyve create image test"},{"timestamp":1546973718,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1546973723,"reviewer":{"name":"Dylan Yep","email":"dyep49@gmail.com","username":"dyep49"},"message":"Patch Set 3:\n\n(1 comment)"},{"timestamp":1546985313,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1547151881,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 3: Code-Review+1\n\nWorked for me on nightly-2:\n\n```\n...\nâœ” create image from bhyve vm\n```"},{"timestamp":1547152094,"reviewer":{"name":"Dylan Yep","email":"dyep49@gmail.com","username":"dyep49"},"message":"Patch Set 4: Patch Set 3 was rebased"},{"timestamp":1547152147,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4:\n\n\"make check\" passed ok"},{"timestamp":1547152646,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 4: Integration-Approval+1"},{"timestamp":1547152678,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Dylan Yep"}],"currentPatchSet":{"number":"4","revision":"67b1706dd9016422b79d18e1eca653be0ca9e1f6","parents":["efb2a2b70bc3cf99eb82a1a294fc3f223bcac28a"],"ref":"refs/changes/18/5318/4","uploader":{"name":"Dylan Yep","email":"dyep49@gmail.com","username":"dyep49"},"createdOn":1547152094,"author":{"name":"Dylan Yep","email":"dyep49@gmail.com","username":"dyep49"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1546973718,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1546985313,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1547151881,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1547152646,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1547152678,"by":{"name":"Dylan Yep","email":"dyep49@gmail.com","username":"dyep49"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/img/test/create.test.js","type":"MODIFIED","insertions":8,"deletions":-6},{"file":"src/img/test/runtests","type":"MODIFIED","insertions":3,"deletions":-1}],"sizeInsertions":11,"sizeDeletions":-7},"patchSets":[{"number":"1","revision":"e78d2604d10bcca3cc800a5dc193469552b0e6c3","parents":["47c8d48c0ff4e89136990052262d3ef4f34e1e91"],"ref":"refs/changes/18/5318/1","uploader":{"name":"Dylan Yep","email":"dyep49@gmail.com","username":"dyep49"},"createdOn":1546812074,"author":{"name":"Dylan Yep","email":"dyep49@gmail.com","username":"dyep49"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1546812131,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"src/img/test/create.test.js","line":286,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"For better or worse, the behaviour of the other create tests above is to install the test image if it isn\u0027t already. I think it would be fine to do that here. Otherwise, this test will sometimes just silently skip.\n\nAnd if doing this (installing the test image), then you can go back to hardcoding the image with which to test -- which I think would be good.\n\nThoughts?"},{"file":"src/img/test/create.test.js","line":286,"reviewer":{"name":"Dylan Yep","email":"dyep49@gmail.com","username":"dyep49"},"message":"That works for me"},{"file":"src/img/test/create.test.js","line":554,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Perhaps change this to:\n\n```\nif (err \u003d\u003d\u003d true) {  // Early abort signal.\n    err \u003d null;\n}\n```\n\nThen can just fall through."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/img/test/create.test.js","type":"MODIFIED","insertions":60,"deletions":-24}],"sizeInsertions":60,"sizeDeletions":-24},{"number":"2","revision":"2159e438e06e1a7814b8a52af7e57d594abe67be","parents":["4725c580158d35fb20fcbdb3d5909b9adfde6719"],"ref":"refs/changes/18/5318/2","uploader":{"name":"Dylan Yep","email":"dyep49@gmail.com","username":"dyep49"},"createdOn":1546933805,"author":{"name":"Dylan Yep","email":"dyep49@gmail.com","username":"dyep49"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1546933858,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"src/img/test/create.test.js","line":65,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"18.04 - Ubuntu versions are always referred to (at least) as YY.MM for year and month of release.\n\nJust in case this is helpful...\n\nEvery other April there is a long term support release (e.g. 18.04) that is supported for 3 years or so.  The other releases are supported for about 9 months.\n\nYou may see YY.MM.n, as there are periodic stable release updates (SRUs).  I believe the release that came out in April 2018 may also be referred to as 18.04.0.  Around July they released 18.04.1.  It seems common to wait for the .1 release before starting to make serious use of an LTS release.\n\nUbuntu geeks often use the first word of release codenames, seemingly to frustrate people that don\u0027t use Ubuntu all the time.  Decoder ring at at https://wiki.ubuntu.com/Releases."},{"file":"src/img/test/create.test.js","line":65,"reviewer":{"name":"Dylan Yep","email":"dyep49@gmail.com","username":"dyep49"},"message":"Thanks! I verified that this image is 18.04.1 and added that to the comment."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/img/test/create.test.js","type":"MODIFIED","insertions":8,"deletions":-6},{"file":"src/img/test/runtests","type":"MODIFIED","insertions":3,"deletions":-1}],"sizeInsertions":11,"sizeDeletions":-7},{"number":"3","revision":"cc4a798dca6a7df7fe0f84e2dd74b0e38879367f","parents":["85210364423d5587edca0862b2905db0500ffc8e"],"ref":"refs/changes/18/5318/3","uploader":{"name":"Dylan Yep","email":"dyep49@gmail.com","username":"dyep49"},"createdOn":1546973665,"author":{"name":"Dylan Yep","email":"dyep49@gmail.com","username":"dyep49"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1546973718,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1547151881,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1546985313,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/img/test/create.test.js","type":"MODIFIED","insertions":8,"deletions":-6},{"file":"src/img/test/runtests","type":"MODIFIED","insertions":3,"deletions":-1}],"sizeInsertions":11,"sizeDeletions":-7},{"number":"4","revision":"67b1706dd9016422b79d18e1eca653be0ca9e1f6","parents":["efb2a2b70bc3cf99eb82a1a294fc3f223bcac28a"],"ref":"refs/changes/18/5318/4","uploader":{"name":"Dylan Yep","email":"dyep49@gmail.com","username":"dyep49"},"createdOn":1547152094,"author":{"name":"Dylan Yep","email":"dyep49@gmail.com","username":"dyep49"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1546973718,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1547151881,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1547152646,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1546985313,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}},{"type":"SUBM","value":"1","grantedOn":1547152678,"by":{"name":"Dylan Yep","email":"dyep49@gmail.com","username":"dyep49"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/img/test/create.test.js","type":"MODIFIED","insertions":8,"deletions":-6},{"file":"src/img/test/runtests","type":"MODIFIED","insertions":3,"deletions":-1}],"sizeInsertions":11,"sizeDeletions":-7}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},{"name":"Dylan Yep","email":"dyep49@gmail.com","username":"dyep49"}]}