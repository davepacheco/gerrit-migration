From f4555d0a60fa51947073c00ab8bded3046d47748 Mon Sep 17 00:00:00 2001
From: Jan Wyszynski <jan.wyszynski@joyent.com>
Date: Wed, 27 Sep 2017 19:58:39 +0000
Subject: [PATCH] MANTA-3442 Add content-type to Manta directory listing
 results

---
 lib/common.js    |  1 +
 test/dir.test.js | 34 ++++++++++++++++++++++++++++++++++
 2 files changed, 35 insertions(+)

diff --git a/lib/common.js b/lib/common.js
index fcac826..f92d2bf 100644
--- a/lib/common.js
+++ b/lib/common.js
@@ -690,6 +690,7 @@ function readdir(dir, req) {
                 etag: r.value.etag,
                 size: r.value.contentLength,
                 type: r.value.type,
+                contentType: r.value.contentType,
                 mtime: new Date(r.value.mtime).toISOString()
             };
 
diff --git a/test/dir.test.js b/test/dir.test.js
index 29b1e21..ae41e28 100644
--- a/test/dir.test.js
+++ b/test/dir.test.js
@@ -174,6 +174,40 @@ test('mkdir top', function (t) {
 });
 
 
+test('ls returns content-type for objects', function (t) {
+    var self = this;
+
+    writeObject(self.client, self.key, function (put_err) {
+        t.ifError(put_err);
+        self.client.ls(self.dir, function (err, res) {
+            t.ifError(err);
+            t.ok(res);
+
+            var objs = [];
+
+            res.on('object', function (obj) {
+                t.ok(obj, 'fail, no obj!');
+                objs.push(obj);
+            });
+
+            res.once('error', function (err2) {
+                t.ifError(err2);
+                t.end();
+            });
+
+            res.once('end', function (http_res) {
+                t.ok(http_res);
+                t.checkResponse(http_res, 200);
+                t.equal(objs.length, 1);
+                t.ok(objs[0].contentType);
+                t.equal(objs[0].contentType, 'application/octet-stream');
+                t.end();
+            });
+        });
+    });
+});
+
+
 test('ls top', function (t) {
     this.client.ls(this.top, function (err, res) {
         t.ifError(err);
-- 
2.21.0

