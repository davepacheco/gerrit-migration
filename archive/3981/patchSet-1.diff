From b79bf4a0d3d910f6f026790a7530091a77ca7a6a Mon Sep 17 00:00:00 2001
From: Pedro Palazon Candel <pedro@joyent.com>
Date: Mon, 21 May 2018 19:12:43 +0200
Subject: [PATCH] TOOLS-1517 scdcam check-config should not complain about
 missing docker/cns vars in SAPI

---
 lib/cli/do_check_config.js | 4 ++++
 test/check-config.test.js  | 6 +-----
 2 files changed, 5 insertions(+), 5 deletions(-)

diff --git a/lib/cli/do_check_config.js b/lib/cli/do_check_config.js
index 577ed3a..b1ad8b5 100644
--- a/lib/cli/do_check_config.js
+++ b/lib/cli/do_check_config.js
@@ -298,6 +298,10 @@ CheckConfig.prototype.execute = function cExecute(opts, args, cb) {
             // remove most of these variables anyway, and left a single
             // value for *_pw.
             services.forEach(function checkSvcCfgVars(s) {
+                if (s === 'cns' || s === 'portolan' || s === 'docker' ||
+                    s === 'cmon' || s === 'volapi') {
+                    return;
+                }
                 if (!sdc[s + '_root_pw'] && s !== 'manta' && s !== 'sapi') {
                     errs.push(sprintf('Missing %s_root_pw in SAPI', s));
                 }
diff --git a/test/check-config.test.js b/test/check-config.test.js
index 64bfd05..5e56c1e 100644
--- a/test/check-config.test.js
+++ b/test/check-config.test.js
@@ -25,11 +25,7 @@ test('sdcadm check-config --help', function (t) {
 });
 
 
-// Right now check-config is pretty much useless. Need to update it and take
-// a complete review of a proper test suite.
-// Need to fix https://jira.joyent.us/browse/TOOLS-1517 in order to avoid the
-// test failing.
-test.skip('sdcadm check-config', function (t) {
+test('sdcadm check-config', function (t) {
     exec('sdcadm check-config', function (err, stdout, stderr) {
         t.ifError(err);
 
-- 
2.21.0

