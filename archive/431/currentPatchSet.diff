From abd678739ef1bd66bd0bb0d636cf41d8262fb829 Mon Sep 17 00:00:00 2001
From: Alex Wilson <alex.wilson@joyent.com>
Date: Wed, 7 Sep 2016 16:32:50 -0700
Subject: [PATCH] joyent/node-cueball#16 new backends being added causes pool
 to throw out connections

---
 lib/pool.js | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/lib/pool.js b/lib/pool.js
index b40e967..22ad766 100644
--- a/lib/pool.js
+++ b/lib/pool.js
@@ -641,8 +641,8 @@ mod_util.inherits(CueBallConnectionPool, FSM);
 
 CueBallConnectionPool.prototype.on_resolver_added = function (k, backend) {
 	backend.key = k;
-	this.p_keys.push(k);
-	mod_utils.shuffle(this.p_keys);
+	var idx = Math.floor(Math.random() * this.p_keys.length);
+	this.p_keys.splice(idx, 0, k);
 	this.p_backends[k] = backend;
 	this.rebalance();
 };
-- 
2.21.0

