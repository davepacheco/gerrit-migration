{"project":"joyent/sdc-docker","branch":"master","id":"I7440ea4e9fdd0f482d19e7a5dc23d6f88e4290b0","number":"3250","subject":"TRITON-59 check that instances mounting NFS volumes are provisioned on networks on which volumes are reachable VOLAPI-100 Attempting to mount a volume in an incorrect fabric network does not give an error correctly. Reviewed by: Nick Zivkovic \u003czivkovic.ni","owner":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"url":"https://cr.joyent.us/3250","commitMessage":"TRITON-59 check that instances mounting NFS volumes are provisioned on networks on which volumes are reachable\nVOLAPI-100 Attempting to mount a volume in an incorrect fabric network does not give an error correctly.\nReviewed by: Nick Zivkovic \u003czivkovic.nick@gmail.com\u003e\nApproved by: Nick Zivkovic \u003czivkovic.nick@gmail.com\u003e\n","createdOn":1516677187,"lastUpdated":1516903053,"open":false,"status":"MERGED","comments":[{"timestamp":1516677187,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 1."},{"timestamp":1516677221,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing-1\n\n(1 comment)\n\n\"make check\" exited with status 2"},{"timestamp":1516677409,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 2."},{"timestamp":1516677444,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1516677522,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 2:\n\nI\u0027ll add testing notes shortly."},{"timestamp":1516684945,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 2:\n\nTesting notes:\n\n1. Ran the previously added api-mounts-nfs-shared-volume-networks.test.js test and made sure it passed.\n\n2. Ran the following command manually:\n\n```\n$ ~/local/bin/docker-1.12.2 --tls run -it -v test-vol-nondefault-net:/data --name test-container-mount-vol-on-nondefault-net-seven busybox /bin/sh -c touch /data/foo\n```\n\nafter creating the volume \"test-vol-nondefault-net\" on a non-default fabric network. Got the following output:\n\n```\n/Users/JulienGilli/local/bin/docker-1.12.2: Error response from daemon: (VolumesNotReachableError) Volumes not reachable from container: Volume test-vol-nondefault-net not reachable on networks 029d9fed-514f-4ccd-8d9c-ca846fd457ea (e08d58f3-7eb6-4fae-ad3d-4810a7ed3ef9).\nSee \u0027/Users/JulienGilli/local/bin/docker-1.12.2 run --help\u0027.\n```\n\n3. Ran the whole sdc-docker tests suite in my COAL, and made sure all tests passed."},{"timestamp":1516687290,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Patch Set 2: Code-Review+1 Integration-Approval+1\n\n(1 comment)\n\nEverything looks fine to me. Testing notes also look fine. I noticed that we downgraded verror. Out of sheer curiosity, is this necessary? Other than that, go ahead and ship it!"},{"timestamp":1516772173,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1516903049,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 3: Commit message was updated."},{"timestamp":1516903053,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Julien Gilli"}],"currentPatchSet":{"number":"3","revision":"a9a2db9d1d978150709f00204552e73a8f1d9f8c","parents":["438feb4b92ef5e5c5a33ab355e74e7561e1fedd1"],"ref":"refs/changes/50/3250/3","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1516903049,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1516677444,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1516687290,"by":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1516687290,"by":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"}},{"type":"SUBM","value":"1","grantedOn":1516903053,"by":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"lib/backends/sdc/containers.js","type":"MODIFIED","insertions":13,"deletions":-204},{"file":"lib/backends/sdc/networks.js","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"lib/backends/sdc/volumes.js","type":"MODIFIED","insertions":1,"deletions":-4},{"file":"lib/errors.js","type":"MODIFIED","insertions":19,"deletions":-16},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/integration/api-mounts-nfs-shared-volume-networks.test.js","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":36,"sizeDeletions":-228},"patchSets":[{"number":"1","revision":"dbb3464a3a368b0233e6d4b5eddb047469810883","parents":["438feb4b92ef5e5c5a33ab355e74e7561e1fedd1"],"ref":"refs/changes/50/3250/1","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1516677187,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1516677221,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/errors.js","line":598,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"line \u003e 80 characters"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"lib/backends/sdc/containers.js","type":"MODIFIED","insertions":13,"deletions":-204},{"file":"lib/backends/sdc/networks.js","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"lib/backends/sdc/volumes.js","type":"MODIFIED","insertions":1,"deletions":-4},{"file":"lib/errors.js","type":"MODIFIED","insertions":19,"deletions":-16},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/integration/api-mounts-nfs-shared-volume-networks.test.js","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":36,"sizeDeletions":-228},{"number":"2","revision":"7440ea4e9fdd0f482d19e7a5dc23d6f88e4290b0","parents":["438feb4b92ef5e5c5a33ab355e74e7561e1fedd1"],"ref":"refs/changes/50/3250/2","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1516677409,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1516677444,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1516687290,"by":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1516687290,"by":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"}}],"comments":[{"file":"package.json","line":33,"reviewer":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},"message":"Why are we downgrading this verror version?"},{"file":"package.json","line":33,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"It was originally upgraded when I was working on a different implementation of the previous change, and I was using the `VError.errorFromList` function, which was introduced in verror 1.10.0.\n\nHowever, I did end up *not* using that, even in the original change, so that upgrade wasn\u0027t needed."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"lib/backends/sdc/containers.js","type":"MODIFIED","insertions":13,"deletions":-204},{"file":"lib/backends/sdc/networks.js","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"lib/backends/sdc/volumes.js","type":"MODIFIED","insertions":1,"deletions":-4},{"file":"lib/errors.js","type":"MODIFIED","insertions":19,"deletions":-16},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/integration/api-mounts-nfs-shared-volume-networks.test.js","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":36,"sizeDeletions":-228},{"number":"3","revision":"a9a2db9d1d978150709f00204552e73a8f1d9f8c","parents":["438feb4b92ef5e5c5a33ab355e74e7561e1fedd1"],"ref":"refs/changes/50/3250/3","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1516903049,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1516677444,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1516687290,"by":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1516687290,"by":{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"}},{"type":"SUBM","value":"1","grantedOn":1516903053,"by":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"lib/backends/sdc/containers.js","type":"MODIFIED","insertions":13,"deletions":-204},{"file":"lib/backends/sdc/networks.js","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"lib/backends/sdc/volumes.js","type":"MODIFIED","insertions":1,"deletions":-4},{"file":"lib/errors.js","type":"MODIFIED","insertions":19,"deletions":-16},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/integration/api-mounts-nfs-shared-volume-networks.test.js","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":36,"sizeDeletions":-228}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Nick Zivkovic","email":"nick.zivkovic@joyent.com","username":"nickziv"},{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}]}