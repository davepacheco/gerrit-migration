From 0eab4f0a6d55802dc60181aad17591416b8ca86a Mon Sep 17 00:00:00 2001
From: Sean Chittenden <sean@chittenden.org>
Date: Sat, 1 Jul 2017 09:29:47 -0700
Subject: [PATCH] Increase the performance of the backup dataset.

---
 pg_dump/pg_backup_common.sh | 5 +++--
 1 file changed, 3 insertions(+), 2 deletions(-)

diff --git a/pg_dump/pg_backup_common.sh b/pg_dump/pg_backup_common.sh
index 6bfd0c9..e471947 100644
--- a/pg_dump/pg_backup_common.sh
+++ b/pg_dump/pg_backup_common.sh
@@ -97,8 +97,9 @@ function mount_data_set
 {
     # destroy the dump dataset if it already exists
     zfs destroy -R $DUMP_DATASET
-    # clone the current snapshot. Disable sync for faster performance.
-    zfs clone -o sync=disabled $ZFS_SNAPSHOT $DUMP_DATASET
+    # clone the current snapshot. Tune logbias and disable sync for faster
+    # performance.
+    zfs clone -o sync=disabled -o logbias=throughput $ZFS_SNAPSHOT $DUMP_DATASET
     [[ $? -eq 0 ]] || fatal "unable to clone snapshot"
     echo "successfully mounted dataset"
     # remove recovery.conf so this pg instance does not become a slave
-- 
2.21.0

