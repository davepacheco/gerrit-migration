From 5e4ea9d6f5896af89553ca058f95e3e6bc3111b1 Mon Sep 17 00:00:00 2001
From: Pedro Palazon Candel <pedro@joyent.com>
Date: Thu, 9 Nov 2017 16:07:43 +0100
Subject: [PATCH] SAPI-295 SAPI crashes if MASTER_MORAY_IP is a hostname
 Reviewed by: Cody Peter Mello <cody.mello@joyent.com> Approved by: Cody Peter
 Mello <cody.mello@joyent.com>

---
 lib/server/stor/moray.js | 8 +++-----
 1 file changed, 3 insertions(+), 5 deletions(-)

diff --git a/lib/server/stor/moray.js b/lib/server/stor/moray.js
index cb26743..69aa31b 100644
--- a/lib/server/stor/moray.js
+++ b/lib/server/stor/moray.js
@@ -111,13 +111,11 @@ MorayStorage.prototype.init = function init(cb) {
                 port: config.master_port
             });
         } else {
-           this.master = moray.createClient({
-                connectTimeout: config.connectTimeout,
+            assert.equal(2020, config.master_port, 'config.master_port');
+            this.master = moray.createClient({
                 log: log,
                 srvDomain: config.master_host,
-                cueballOptions: {
-                    defaultPort: config.master_port
-                }
+                connectTimeout: config.connectTimeout
             });
         }
 
-- 
2.21.0

