{"project":"joyent/sdc-sapi","branch":"master","id":"I915e80399a908a5d492ea50175f30c84edb3ba66","number":"2678","subject":"SAPI-291 Update moray-client to latest Reviewed by: Cody Peter Mello \u003ccody.mello@joyent.com\u003e Approved by: Cody Peter Mello \u003ccody.mello@joyent.com\u003e","owner":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"url":"https://cr.joyent.us/2678","commitMessage":"SAPI-291 Update moray-client to latest\nReviewed by: Cody Peter Mello \u003ccody.mello@joyent.com\u003e\nApproved by: Cody Peter Mello \u003ccody.mello@joyent.com\u003e\n","createdOn":1506615759,"lastUpdated":1508164200,"open":false,"status":"MERGED","comments":[{"timestamp":1506615759,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 1."},{"timestamp":1506615764,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit 6cffcb97ef6e84feb8b6fd53b0d52cc1aea80f4b\n    \n    SAPI-291 Update node-moray to v3"},{"timestamp":1506615796,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1506615805,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 1:\n\nNote this is the same than SAPI-289. I\u0027ll close it as dupe."},{"timestamp":1506615948,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 1:\n\nTest suite ran successfully in nightly1 against a build of this branch: https://jenkins.joyent.us/job/nightly1-120-test-sapi/1012/console"},{"timestamp":1506636405,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 1:\n\n(5 comments)"},{"timestamp":1506697575,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 1:\n\n(1 comment)\n\nAside from the things Alex mentioned, this looks good to me!"},{"timestamp":1506707179,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1506709629,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1506959915,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 2."},{"timestamp":1506959921,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit 6b40cdf8ffe3d13ae1811394fe82200160830511\n    \n    SAPI-291 Update node-moray to v3"},{"timestamp":1506959957,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1506963427,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1506965125,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 3."},{"timestamp":1506965130,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 3:\n\nNew commits:\n    \n    commit 17aa6495e7eb1c739944cfa5c81a731f957a2c40\n    \n    SAPI-291 Update node-moray to v3"},{"timestamp":1506965148,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 3:\n\n(6 comments)"},{"timestamp":1506965161,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1506971237,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 3:\n\nJust ran the tests against a SAPI VM built from latest image from SAPI-291 branch. Results added to the JIRA issue. So far, so good."},{"timestamp":1507564400,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1507564517,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 3: Integration-Approval+1"},{"timestamp":1507652948,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 4."},{"timestamp":1507652953,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 4:\n\nNew commits:\n    \n    commit ad5b512a1856ad049104166496220c9ca06d6cc3\n    \n    SAPI-291 Update node-moray to v3"},{"timestamp":1507652979,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1507653454,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 4: Code-Review+1 Integration-Approval+1"},{"timestamp":1507653680,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 4: -Code-Review -Integration-Approval"},{"timestamp":1507653755,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 4:\n\n(2 comments)"},{"timestamp":1507665305,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 5."},{"timestamp":1507665310,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 5:\n\nNew commits:\n    \n    commit cc2e7e0b5c4dd8bdd77cbb6b0f723581741d82cc\n    \n    SAPI-291 Update node-moray to v3"},{"timestamp":1507665316,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 4:\n\n(2 comments)\n\nThanks for the re-review Cody!"},{"timestamp":1507665332,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1507671748,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 5: Code-Review+1 Integration-Approval+1"},{"timestamp":1508164172,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 6: Commit message was updated."},{"timestamp":1508164200,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Pedro Palazón Candel"}],"currentPatchSet":{"number":"6","revision":"915e80399a908a5d492ea50175f30c84edb3ba66","parents":["645d52550b3f93ca13a1dc3e29eef49cbf6d27d6"],"ref":"refs/changes/78/2678/6","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1508164172,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1507665332,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1507671748,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1507671748,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"SUBM","value":"1","grantedOn":1508164200,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"etc/config.coal.json","type":"MODIFIED","insertions":13,"deletions":-5},{"file":"lib/server/attributes.js","type":"MODIFIED","insertions":19,"deletions":-14},{"file":"lib/server/endpoints/applications.js","type":"MODIFIED","insertions":25,"deletions":-20},{"file":"lib/server/endpoints/history.js","type":"MODIFIED","insertions":8,"deletions":-6},{"file":"lib/server/endpoints/instances.js","type":"MODIFIED","insertions":8,"deletions":-7},{"file":"lib/server/endpoints/manifests.js","type":"MODIFIED","insertions":8,"deletions":-6},{"file":"lib/server/endpoints/services.js","type":"MODIFIED","insertions":11,"deletions":-10},{"file":"lib/server/model.js","type":"MODIFIED","insertions":122,"deletions":-93},{"file":"lib/server/stor/moray.js","type":"MODIFIED","insertions":84,"deletions":-81},{"file":"lib/server/stor/moray_local.js","type":"MODIFIED","insertions":6,"deletions":-5},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"sapi_manifests/sapi/template","type":"MODIFIED","insertions":4,"deletions":-2}],"sizeInsertions":311,"sizeDeletions":-252},"patchSets":[{"number":"1","revision":"53ae82c911d03445b95b7b400cf556fa9cf8718b","parents":["645d52550b3f93ca13a1dc3e29eef49cbf6d27d6"],"ref":"refs/changes/78/2678/1","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1506615759,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1506615796,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"etc/config.coal.json","line":9,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Have you tested this config? This should blow up -- IP addresses are explicitly not allowed in the \"srvDomain\" property (the moray client constructor should blow an assert)"},{"file":"etc/config.coal.json","line":9,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Good call! I\u0027ve just replaced the whole thing with a real \"coal\" configuration file. Thanks!"},{"file":"lib/server/endpoints/applications.js","line":52,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"totally minor nit: these parens are kinda redundant and look pretty weird. Can we just make it \"next(err);\"?"},{"file":"lib/server/endpoints/applications.js","line":52,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Sure! I\u0027ve removed just those at the functions I needed to modify, but cleaning up makes the vim integrated ESLint waaaaay happier :-)"},{"file":"lib/server/model.js","line":1141,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Was there a reason for changing this? Or is it just because it\u0027s shorter? (Fine with leaving it as it is, just curious)"},{"file":"lib/server/model.js","line":1141,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"It\u0027s shorter, and we already had the \"vm\" variable \"handy\". Also, if we don\u0027t use it, we should remove from the function callback or ESLint would complain about \"unused\" vars. Now that I checked, I\u0027ve added a name to the cb function, just in case it might be useful for post mortem debug."},{"file":"lib/server/stor/moray.js","line":106,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Should we make this use a srvDomain + bootstrap configuration to resolve the master? This is usually a hostname that comes in here, not an IP, right?\n\nbinder has recently been updated to support proxied SRV lookups cross-DC, and I would like to gradually phase out use of the haproxy."},{"file":"lib/server/stor/moray.js","line":106,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"This is the MASTER_MORAY_IP, so I don\u0027t believe we can change this to use an srvDomain without making sure we also have a process for updating the SAPI configuration variable. Maybe in the future we can add a new SAPI variable, and handle having either one in the config."},{"file":"lib/server/stor/moray.js","line":106,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Sad!"},{"file":"lib/server/stor/moray.js","line":106,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"So, it looks like MASTER_MORAY_IP was previously always an IP, but was changed in Joyent deployments to a DNS name in CM-114.  There are some notes on the variable in SAPI-283.\n\nI realized that Pedro had actually checked that it was a DNS last week, but I\u0027d forgotten about it. JPC uses a DNS name, and so does SPC. The staging DCs use an IP address. (I have no idea what on-prem multi-DC customers use.)\n\nAlex and I talked a bit about this, and it might be best for SAPI to do something like:\n\n    config.master_port \u003d parseInt(config.master_port, 10);\n    if (mod_net.isIP(config.master_host)) {\n       this.master \u003d moray.createClient({\n            connectTimeout: config.connectTimeout,\n            log: log,\n            host: config.master_host,\n            port: config.master_port\n        });\n    } else {\n       this.master \u003d moray.createClient({\n            connectTimeout: config.connectTimeout,\n            log: log,\n            srvDomain: config.master_host,\n            cueballOptions: {\n                defaultPort: config.master_port\n            }\n        });\n    }\n\nThis would allow SAPI to fall back onto using SRV records when available, and allow us to use the HAProxy instance less."},{"file":"lib/server/stor/moray.js","line":106,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done! Thanks for the time going through this!"},{"file":"lib/server/stor/moray_local.js","line":59,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"I think this while loop should go away now that you\u0027ve changed the bit below this to do verror.hasCauseWithName() (this loop is basically what verror is doing internally)"},{"file":"lib/server/stor/moray_local.js","line":59,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Definitely! Forgot to remove with the line below. Thanks!"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"etc/config.coal.json","type":"MODIFIED","insertions":4,"deletions":-2},{"file":"lib/server/attributes.js","type":"MODIFIED","insertions":19,"deletions":-14},{"file":"lib/server/endpoints/applications.js","type":"MODIFIED","insertions":12,"deletions":-10},{"file":"lib/server/endpoints/history.js","type":"MODIFIED","insertions":8,"deletions":-6},{"file":"lib/server/endpoints/instances.js","type":"MODIFIED","insertions":8,"deletions":-7},{"file":"lib/server/endpoints/manifests.js","type":"MODIFIED","insertions":8,"deletions":-6},{"file":"lib/server/endpoints/services.js","type":"MODIFIED","insertions":11,"deletions":-10},{"file":"lib/server/model.js","type":"MODIFIED","insertions":27,"deletions":-24},{"file":"lib/server/stor/moray.js","type":"MODIFIED","insertions":59,"deletions":-46},{"file":"lib/server/stor/moray_local.js","type":"MODIFIED","insertions":7,"deletions":-2},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"sapi_manifests/sapi/template","type":"MODIFIED","insertions":4,"deletions":-2}],"sizeInsertions":170,"sizeDeletions":-132},{"number":"2","revision":"53b8f9d4be6d739ca6681551821a02479c685150","parents":["645d52550b3f93ca13a1dc3e29eef49cbf6d27d6"],"ref":"refs/changes/78/2678/2","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1506959915,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1506959957,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/server/stor/moray.js","line":176,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"It looks like we should keep the \u0027client\u0027 argument here, since it\u0027s passed via .bind() below at lines 199 and 205. (Or we should remove the call to .bind().)\n\nWe can also remove the \u0027connectAttempt\u0027 listeners and function, since the new Moray client doesn\u0027t emit the event."},{"file":"lib/server/stor/moray.js","line":176,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Thanks for the heads up Cody, forgot to drop those. I\u0027ve removed all the connection attempt and onError callback. New node-moray client is performing logging enough in case of error to just add some extra log calls."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"etc/config.coal.json","type":"MODIFIED","insertions":13,"deletions":-5},{"file":"lib/server/attributes.js","type":"MODIFIED","insertions":19,"deletions":-14},{"file":"lib/server/endpoints/applications.js","type":"MODIFIED","insertions":25,"deletions":-20},{"file":"lib/server/endpoints/history.js","type":"MODIFIED","insertions":8,"deletions":-6},{"file":"lib/server/endpoints/instances.js","type":"MODIFIED","insertions":8,"deletions":-7},{"file":"lib/server/endpoints/manifests.js","type":"MODIFIED","insertions":8,"deletions":-6},{"file":"lib/server/endpoints/services.js","type":"MODIFIED","insertions":11,"deletions":-10},{"file":"lib/server/model.js","type":"MODIFIED","insertions":122,"deletions":-93},{"file":"lib/server/stor/moray.js","type":"MODIFIED","insertions":85,"deletions":-56},{"file":"lib/server/stor/moray_local.js","type":"MODIFIED","insertions":6,"deletions":-5},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"sapi_manifests/sapi/template","type":"MODIFIED","insertions":4,"deletions":-2}],"sizeInsertions":312,"sizeDeletions":-227},{"number":"3","revision":"0d857afdcca13355f54abaf6bf05e8b473afa69f","parents":["645d52550b3f93ca13a1dc3e29eef49cbf6d27d6"],"ref":"refs/changes/78/2678/3","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1506965125,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1507564400,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1507564517,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1506965161,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"etc/config.coal.json","type":"MODIFIED","insertions":13,"deletions":-5},{"file":"lib/server/attributes.js","type":"MODIFIED","insertions":19,"deletions":-14},{"file":"lib/server/endpoints/applications.js","type":"MODIFIED","insertions":25,"deletions":-20},{"file":"lib/server/endpoints/history.js","type":"MODIFIED","insertions":8,"deletions":-6},{"file":"lib/server/endpoints/instances.js","type":"MODIFIED","insertions":8,"deletions":-7},{"file":"lib/server/endpoints/manifests.js","type":"MODIFIED","insertions":8,"deletions":-6},{"file":"lib/server/endpoints/services.js","type":"MODIFIED","insertions":11,"deletions":-10},{"file":"lib/server/model.js","type":"MODIFIED","insertions":122,"deletions":-93},{"file":"lib/server/stor/moray.js","type":"MODIFIED","insertions":84,"deletions":-81},{"file":"lib/server/stor/moray_local.js","type":"MODIFIED","insertions":6,"deletions":-5},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"sapi_manifests/sapi/template","type":"MODIFIED","insertions":4,"deletions":-2}],"sizeInsertions":311,"sizeDeletions":-252},{"number":"4","revision":"13694233e5e52a56b83b87c0cc8cfa8622bd0bd0","parents":["645d52550b3f93ca13a1dc3e29eef49cbf6d27d6"],"ref":"refs/changes/78/2678/4","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1507652948,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1507652979,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/server/stor/moray.js","line":428,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"This should be negated."},{"file":"lib/server/stor/moray.js","line":428,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/server/stor/moray.js","line":453,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"This should be negated."},{"file":"lib/server/stor/moray.js","line":453,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"etc/config.coal.json","type":"MODIFIED","insertions":13,"deletions":-5},{"file":"lib/server/attributes.js","type":"MODIFIED","insertions":19,"deletions":-14},{"file":"lib/server/endpoints/applications.js","type":"MODIFIED","insertions":25,"deletions":-20},{"file":"lib/server/endpoints/history.js","type":"MODIFIED","insertions":8,"deletions":-6},{"file":"lib/server/endpoints/instances.js","type":"MODIFIED","insertions":8,"deletions":-7},{"file":"lib/server/endpoints/manifests.js","type":"MODIFIED","insertions":8,"deletions":-6},{"file":"lib/server/endpoints/services.js","type":"MODIFIED","insertions":11,"deletions":-10},{"file":"lib/server/model.js","type":"MODIFIED","insertions":122,"deletions":-93},{"file":"lib/server/stor/moray.js","type":"MODIFIED","insertions":84,"deletions":-81},{"file":"lib/server/stor/moray_local.js","type":"MODIFIED","insertions":6,"deletions":-5},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"sapi_manifests/sapi/template","type":"MODIFIED","insertions":4,"deletions":-2}],"sizeInsertions":311,"sizeDeletions":-252},{"number":"5","revision":"ca8bca297d92fa0ef32d47b9cfed110b6b5d8c79","parents":["645d52550b3f93ca13a1dc3e29eef49cbf6d27d6"],"ref":"refs/changes/78/2678/5","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1507665305,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1507671748,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1507671748,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1507665332,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"etc/config.coal.json","type":"MODIFIED","insertions":13,"deletions":-5},{"file":"lib/server/attributes.js","type":"MODIFIED","insertions":19,"deletions":-14},{"file":"lib/server/endpoints/applications.js","type":"MODIFIED","insertions":25,"deletions":-20},{"file":"lib/server/endpoints/history.js","type":"MODIFIED","insertions":8,"deletions":-6},{"file":"lib/server/endpoints/instances.js","type":"MODIFIED","insertions":8,"deletions":-7},{"file":"lib/server/endpoints/manifests.js","type":"MODIFIED","insertions":8,"deletions":-6},{"file":"lib/server/endpoints/services.js","type":"MODIFIED","insertions":11,"deletions":-10},{"file":"lib/server/model.js","type":"MODIFIED","insertions":122,"deletions":-93},{"file":"lib/server/stor/moray.js","type":"MODIFIED","insertions":84,"deletions":-81},{"file":"lib/server/stor/moray_local.js","type":"MODIFIED","insertions":6,"deletions":-5},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"sapi_manifests/sapi/template","type":"MODIFIED","insertions":4,"deletions":-2}],"sizeInsertions":311,"sizeDeletions":-252},{"number":"6","revision":"915e80399a908a5d492ea50175f30c84edb3ba66","parents":["645d52550b3f93ca13a1dc3e29eef49cbf6d27d6"],"ref":"refs/changes/78/2678/6","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1508164172,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1507671748,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1507671748,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1507665332,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"SUBM","value":"1","grantedOn":1508164200,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"etc/config.coal.json","type":"MODIFIED","insertions":13,"deletions":-5},{"file":"lib/server/attributes.js","type":"MODIFIED","insertions":19,"deletions":-14},{"file":"lib/server/endpoints/applications.js","type":"MODIFIED","insertions":25,"deletions":-20},{"file":"lib/server/endpoints/history.js","type":"MODIFIED","insertions":8,"deletions":-6},{"file":"lib/server/endpoints/instances.js","type":"MODIFIED","insertions":8,"deletions":-7},{"file":"lib/server/endpoints/manifests.js","type":"MODIFIED","insertions":8,"deletions":-6},{"file":"lib/server/endpoints/services.js","type":"MODIFIED","insertions":11,"deletions":-10},{"file":"lib/server/model.js","type":"MODIFIED","insertions":122,"deletions":-93},{"file":"lib/server/stor/moray.js","type":"MODIFIED","insertions":84,"deletions":-81},{"file":"lib/server/stor/moray_local.js","type":"MODIFIED","insertions":6,"deletions":-5},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"sapi_manifests/sapi/template","type":"MODIFIED","insertions":4,"deletions":-2}],"sizeInsertions":311,"sizeDeletions":-252}],"allReviewers":[{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}]}