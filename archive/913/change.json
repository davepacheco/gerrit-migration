{"project":"joyent/illumos-joyent","branch":"master","id":"Ideaa69ec18c83c7757f96b6adebbcd4ff1d70411","number":"913","subject":"OS-5799 Smart Array firmware 8.00 does not work with MSI OS-5800 identify and record firmware version of Smart Array controllers Reviewed by: Robert Mustacchi \u003crm@joyent.com\u003e Approved by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e","owner":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"url":"https://cr.joyent.us/913","commitMessage":"OS-5799 Smart Array firmware 8.00 does not work with MSI\nOS-5800 identify and record firmware version of Smart Array controllers\nReviewed by: Robert Mustacchi \u003crm@joyent.com\u003e\nApproved by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e\n","createdOn":1479359595,"lastUpdated":1481939152,"open":false,"status":"MERGED","comments":[{"timestamp":1479359595,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Uploaded patch set 1."},{"timestamp":1479402902,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 1:\n\n(4 comments)"},{"timestamp":1479498985,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Uploaded patch set 2."},{"timestamp":1479505848,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Uploaded patch set 3."},{"timestamp":1479505973,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Patch Set 3:\n\n(4 comments)"},{"timestamp":1479506120,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1479849875,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Uploaded patch set 4."},{"timestamp":1479924242,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 4: Code-Review+1\n\n(2 comments)"},{"timestamp":1480985920,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Uploaded patch set 5."},{"timestamp":1480987081,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Patch Set 4:\n\n(2 comments)"},{"timestamp":1480988686,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 5: Code-Review+1"},{"timestamp":1481319590,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 5: Integration-Approval+1"},{"timestamp":1481939078,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Patch Set 6: Patch Set 5 was rebased"},{"timestamp":1481939140,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Patch Set 7: Commit message was updated."},{"timestamp":1481939152,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Joshua M. Clulow"}],"currentPatchSet":{"number":"7","revision":"f4bb6bab0dfe865ae551cc908e245bc8440a75d9","parents":["c1a28d6de9c27ed4fa1cdd15a654f3ca1fcb1e85"],"ref":"refs/changes/13/913/7","uploader":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"createdOn":1481939140,"author":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1480988686,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1481319590,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"SUBM","value":"1","grantedOn":1481939152,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt.c","type":"MODIFIED","insertions":13,"deletions":-2},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_ciss.c","type":"MODIFIED","insertions":184,"deletions":-1},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_ciss_simple.c","type":"MODIFIED","insertions":70,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_commands.c","type":"MODIFIED","insertions":57,"deletions":-21},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_interrupts.c","type":"MODIFIED","insertions":47,"deletions":-4},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_logvol.c","type":"MODIFIED","insertions":3,"deletions":-4},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt.h","type":"MODIFIED","insertions":22,"deletions":-3},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt_scsi.h","type":"MODIFIED","insertions":56,"deletions":-1}],"sizeInsertions":452,"sizeDeletions":-36},"patchSets":[{"number":"1","revision":"5cabd4312c70d21b881b6fcd49d4240f35a836b6","parents":["b103d868ed7f2b4de2da80722eeda3aaf6b95ae6"],"ref":"refs/changes/13/913/1","uploader":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"createdOn":1479359595,"author":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_ciss.c","line":923,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Can we use P2ROUNDUP from sys/sysmacros.h for this?"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_ciss.c","line":923,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Done"},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt_scsi.h","line":128,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Should this really be reserved? It seems like it may not always be considered ignored."},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt_scsi.h","line":128,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"I believe that it\u0027s always ignored for the intended target of this message -- i.e., the internal Smart Array controllers that this driver supports."},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt_scsi.h","line":143,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"These are all described as bytes. It seems like we should be keeping them here as a uint8_t and then interpreting them as appropriate. Especially given that a char may or may not be signed."},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt_scsi.h","line":143,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"I\u0027ve cleaned this up, both in the structure definition and in the handling of the version strings in \"smrt_ciss.c\"."},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt_scsi.h","line":152,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I think there are more members of this structure that are missing."},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt_scsi.h","line":152,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"There are many more, but they\u0027re not relevant to what we\u0027re doing with the driver today.  We can flesh it out more once we\u0027re actually looking for those values."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt.c","type":"MODIFIED","insertions":32,"deletions":-2},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_ciss.c","type":"MODIFIED","insertions":121,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_interrupts.c","type":"MODIFIED","insertions":19,"deletions":-4},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_logvol.c","type":"MODIFIED","insertions":3,"deletions":-4},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt.h","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt_scsi.h","type":"MODIFIED","insertions":56,"deletions":-1}],"sizeInsertions":233,"sizeDeletions":-12},{"number":"2","revision":"4b69a8ef9f82a60cbef05cee775a0e58faabdf38","parents":["382b6e66b39fa51ae68c4ba3f325923698d27235"],"ref":"refs/changes/13/913/2","uploader":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"createdOn":1479498985,"author":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt.c","type":"MODIFIED","insertions":26,"deletions":-2},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_ciss.c","type":"MODIFIED","insertions":170,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_commands.c","type":"MODIFIED","insertions":2,"deletions":-10},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_interrupts.c","type":"MODIFIED","insertions":19,"deletions":-4},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_logvol.c","type":"MODIFIED","insertions":3,"deletions":-4},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt.h","type":"MODIFIED","insertions":20,"deletions":-1},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt_scsi.h","type":"MODIFIED","insertions":56,"deletions":-1}],"sizeInsertions":296,"sizeDeletions":-22},{"number":"3","revision":"8eadcba17ee7d5b64e9648d8a85a6daaa28e0e9b","parents":["382b6e66b39fa51ae68c4ba3f325923698d27235"],"ref":"refs/changes/13/913/3","uploader":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"createdOn":1479505848,"author":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1479506120,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt.c","type":"MODIFIED","insertions":26,"deletions":-2},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_ciss.c","type":"MODIFIED","insertions":173,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_commands.c","type":"MODIFIED","insertions":2,"deletions":-10},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_interrupts.c","type":"MODIFIED","insertions":19,"deletions":-4},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_logvol.c","type":"MODIFIED","insertions":3,"deletions":-4},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt.h","type":"MODIFIED","insertions":17,"deletions":-1},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt_scsi.h","type":"MODIFIED","insertions":56,"deletions":-1}],"sizeInsertions":296,"sizeDeletions":-22},{"number":"4","revision":"7a918d264486be01357378b673797d88efb75c48","parents":["382b6e66b39fa51ae68c4ba3f325923698d27235"],"ref":"refs/changes/13/913/4","uploader":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"createdOn":1479849875,"author":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1479924242,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}}],"comments":[{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_ciss.c","line":993,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Is it worth storing this on the smrt_t somewhere so we can know and understand where this came from? Rather than it being a findleaks mystery? Actually, I guess that we can\u0027t, since we\u0027ll end up freeing the smrt_t. So I guess leaking it is all we can do."},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_ciss.c","line":993,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"As I believe we subsequently discussed: yes, leaking is the only \"good\" option for right now."},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_commands.c","line":250,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Random extra blank line?"},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_commands.c","line":250,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt.c","type":"MODIFIED","insertions":13,"deletions":-2},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_ciss.c","type":"MODIFIED","insertions":184,"deletions":-1},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_ciss_simple.c","type":"MODIFIED","insertions":70,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_commands.c","type":"MODIFIED","insertions":58,"deletions":-21},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_interrupts.c","type":"MODIFIED","insertions":47,"deletions":-4},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_logvol.c","type":"MODIFIED","insertions":3,"deletions":-4},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt.h","type":"MODIFIED","insertions":22,"deletions":-3},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt_scsi.h","type":"MODIFIED","insertions":56,"deletions":-1}],"sizeInsertions":453,"sizeDeletions":-36},{"number":"5","revision":"deaa69ec18c83c7757f96b6adebbcd4ff1d70411","parents":["382b6e66b39fa51ae68c4ba3f325923698d27235"],"ref":"refs/changes/13/913/5","uploader":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"createdOn":1480985920,"author":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1480988686,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1481319590,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt.c","type":"MODIFIED","insertions":13,"deletions":-2},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_ciss.c","type":"MODIFIED","insertions":184,"deletions":-1},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_ciss_simple.c","type":"MODIFIED","insertions":70,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_commands.c","type":"MODIFIED","insertions":57,"deletions":-21},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_interrupts.c","type":"MODIFIED","insertions":47,"deletions":-4},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_logvol.c","type":"MODIFIED","insertions":3,"deletions":-4},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt.h","type":"MODIFIED","insertions":22,"deletions":-3},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt_scsi.h","type":"MODIFIED","insertions":56,"deletions":-1}],"sizeInsertions":452,"sizeDeletions":-36},{"number":"6","revision":"04eeb04ae66ec5e44a41dd6fa7d1bc92358e2a68","parents":["c1a28d6de9c27ed4fa1cdd15a654f3ca1fcb1e85"],"ref":"refs/changes/13/913/6","uploader":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"createdOn":1481939078,"author":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1480988686,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1481319590,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt.c","type":"MODIFIED","insertions":13,"deletions":-2},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_ciss.c","type":"MODIFIED","insertions":184,"deletions":-1},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_ciss_simple.c","type":"MODIFIED","insertions":70,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_commands.c","type":"MODIFIED","insertions":57,"deletions":-21},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_interrupts.c","type":"MODIFIED","insertions":47,"deletions":-4},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_logvol.c","type":"MODIFIED","insertions":3,"deletions":-4},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt.h","type":"MODIFIED","insertions":22,"deletions":-3},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt_scsi.h","type":"MODIFIED","insertions":56,"deletions":-1}],"sizeInsertions":452,"sizeDeletions":-36},{"number":"7","revision":"f4bb6bab0dfe865ae551cc908e245bc8440a75d9","parents":["c1a28d6de9c27ed4fa1cdd15a654f3ca1fcb1e85"],"ref":"refs/changes/13/913/7","uploader":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"createdOn":1481939140,"author":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1480988686,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"SUBM","value":"1","grantedOn":1481939152,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1481319590,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt.c","type":"MODIFIED","insertions":13,"deletions":-2},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_ciss.c","type":"MODIFIED","insertions":184,"deletions":-1},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_ciss_simple.c","type":"MODIFIED","insertions":70,"deletions":0},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_commands.c","type":"MODIFIED","insertions":57,"deletions":-21},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_interrupts.c","type":"MODIFIED","insertions":47,"deletions":-4},{"file":"usr/src/uts/common/io/scsi/adapters/smrt/smrt_logvol.c","type":"MODIFIED","insertions":3,"deletions":-4},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt.h","type":"MODIFIED","insertions":22,"deletions":-3},{"file":"usr/src/uts/common/sys/scsi/adapters/smrt/smrt_scsi.h","type":"MODIFIED","insertions":56,"deletions":-1}],"sizeInsertions":452,"sizeDeletions":-36}],"allReviewers":[{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}]}