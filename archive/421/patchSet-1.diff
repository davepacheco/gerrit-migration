From 0bcbf6f0a3da55ce395871eb810f0a86c0d965aa Mon Sep 17 00:00:00 2001
From: Robert Mustacchi <rm@joyent.com>
Date: Mon, 29 Aug 2016 05:50:10 +0000
Subject: [PATCH] OS-5650 illumos tools should work with python 2.7

---
 usr/src/Makefile.master               |  5 +++--
 usr/src/test/test-runner/cmd/run.py   |  2 +-
 usr/src/tools/Makefile                | 10 +++++-----
 usr/src/tools/Makefile.python         | 20 ++++++++++----------
 usr/src/tools/scripts/cddlchk.py      |  2 +-
 usr/src/tools/scripts/copyrightchk.py |  2 +-
 usr/src/tools/scripts/git-pbchk.py    |  2 +-
 usr/src/tools/scripts/hdrchk.py       |  2 +-
 usr/src/tools/scripts/hg-active.py    |  2 +-
 usr/src/tools/scripts/mapfilechk.py   |  2 +-
 usr/src/tools/scripts/onu.sh          |  2 +-
 usr/src/tools/scripts/validate_pkg.py |  2 +-
 usr/src/tools/scripts/wsdiff.py       |  2 +-
 13 files changed, 28 insertions(+), 27 deletions(-)

diff --git a/usr/src/Makefile.master b/usr/src/Makefile.master
index 27346065da..808fcfbbee 100644
--- a/usr/src/Makefile.master
+++ b/usr/src/Makefile.master
@@ -177,7 +177,8 @@ PERL_PKGVERS=	-512
 PERL_ARCH =		i86pc-solaris-64int
 $(SPARC_BLD)PERL_ARCH =	sun4-solaris-64int
 PYTHON_26=	/usr/bin/python2.6
-PYTHON=		$(PYTHON_26)
+PYTHON_27=	/usr/bin/python2.7
+PYTHON=		$(PYTHON_27)
 SORT=		/usr/bin/sort
 TOUCH=		/usr/bin/touch
 WC=		/usr/bin/wc
@@ -1113,7 +1114,7 @@ PKGPUBLISHER_NONREDIST=	on-extra
 # 1815 hasn't been fixed and sadly we didn't back out something that broke a lot
 # of working code in favor of GNU compatibility.
 #
-SED.py=	$(SED) -e 's?^$(POUND_SIGN)!ON_PYTHON_26$$?$(POUND_SIGN)!$(PYTHON_26)?' \
+SED.py=	$(SED) -e 's?^$(POUND_SIGN)!ON_PYTHON_27$$?$(POUND_SIGN)!$(PYTHON_27)?' \
 	    -e 's?^$(POUND_SIGN)!ON_PYTHON$$?$(POUND_SIGN)!$(PYTHON)?'
 
 .py:
diff --git a/usr/src/test/test-runner/cmd/run.py b/usr/src/test/test-runner/cmd/run.py
index 32c6245956..e78ceca16b 100644
--- a/usr/src/test/test-runner/cmd/run.py
+++ b/usr/src/test/test-runner/cmd/run.py
@@ -1,4 +1,4 @@
-#!ON_PYTHON_26
+#!ON_PYTHON_27
 
 #
 # This file and its contents are supplied under the terms of the
diff --git a/usr/src/tools/Makefile b/usr/src/tools/Makefile
index 659e1da8af..cc07472d42 100644
--- a/usr/src/tools/Makefile
+++ b/usr/src/tools/Makefile
@@ -95,11 +95,11 @@ ROOTDIRS= \
 	$(ROOTONBLD)/lib/$(MACH) \
 	$(ROOTONBLD)/lib/$(MACH)/64 \
 	$(ROOTONBLD)/lib/perl \
-	$(ROOTONBLD)/lib/python2.6 \
-	$(ROOTONBLD)/lib/python2.6/onbld \
-	$(ROOTONBLD)/lib/python2.6/onbld/Checks \
-	$(ROOTONBLD)/lib/python2.6/onbld/hgext \
-	$(ROOTONBLD)/lib/python2.6/onbld/Scm \
+	$(ROOTONBLD)/lib/python2.7 \
+	$(ROOTONBLD)/lib/python2.7/onbld \
+	$(ROOTONBLD)/lib/python2.7/onbld/Checks \
+	$(ROOTONBLD)/lib/python2.7/onbld/hgext \
+	$(ROOTONBLD)/lib/python2.7/onbld/Scm \
 	$(ROOTONBLD)/env \
 	$(ROOTONBLD)/etc \
 	$(ROOTONBLD)/etc/exception_lists \
diff --git a/usr/src/tools/Makefile.python b/usr/src/tools/Makefile.python
index dcf7c06360..dc873414f2 100644
--- a/usr/src/tools/Makefile.python
+++ b/usr/src/tools/Makefile.python
@@ -63,34 +63,34 @@
 
 PYFILES = $(PYSRCS) $(PYOBJS)
 
-ROOTPYDIR_26 = $(PYTOPDIR)/python2.6/$(PYMODDIR)
-ROOTPYFILES_26	= $(PYFILES:%=$(ROOTPYDIR_26)/%)
+ROOTPYDIR_27 = $(PYTOPDIR)/python2.7/$(PYMODDIR)
+ROOTPYFILES_27	= $(PYFILES:%=$(ROOTPYDIR_27)/%)
 
-ROOTPYFILES = $(ROOTPYFILES_26)
+ROOTPYFILES = $(ROOTPYFILES_27)
 $(ROOTPYFILES) := FILEMODE = 0444
 
-PYVERSDIRS = python2.6
+PYVERSDIRS = python2.7
 
-PY26OBJS = $(PYOBJS:%=python2.6/%)
-$(PY26OBJS) := PYTHON = $(PYTHON_26)
+PY27OBJS = $(PYOBJS:%=python2.7/%)
+$(PY27OBJS) := PYTHON = $(PYTHON_27)
 
-PYVERSOBJS = $(PY26OBJS)
+PYVERSOBJS = $(PY27OBJS)
 
 CLOBBERFILES += $(PYVERSOBJS)
 CLOBBERDIRS += $(PYVERSDIRS)
 
 .KEEP_STATE:
 
-python2.6/%.pyc: %.py
+python2.7/%.pyc: %.py
 	@[ -d $(@D) ] || mkdir $(@D)
 	$(RM) $@
 	$(PYTHON) -mpy_compile $<
 	$(MV) $(*).pyc $@
 
-$(ROOTPYDIR_26)/%.pyc: python2.6/%.pyc
+$(ROOTPYDIR_27)/%.pyc: python2.7/%.pyc
 	$(INS.pyfile)
 
-$(ROOTPYDIR_26)/%.py: %.py
+$(ROOTPYDIR_27)/%.py: %.py
 	$(INS.pyfile)
 
 pyclobber:
diff --git a/usr/src/tools/scripts/cddlchk.py b/usr/src/tools/scripts/cddlchk.py
index ad6a6e6f56..ac8a092247 100644
--- a/usr/src/tools/scripts/cddlchk.py
+++ b/usr/src/tools/scripts/cddlchk.py
@@ -1,4 +1,4 @@
-#!ON_PYTHON_26
+#!ON_PYTHON_27
 #
 # CDDL HEADER START
 #
diff --git a/usr/src/tools/scripts/copyrightchk.py b/usr/src/tools/scripts/copyrightchk.py
index f778947bfc..dd2218e59a 100644
--- a/usr/src/tools/scripts/copyrightchk.py
+++ b/usr/src/tools/scripts/copyrightchk.py
@@ -1,4 +1,4 @@
-#!ON_PYTHON_26
+#!ON_PYTHON_27
 #
 # CDDL HEADER START
 #
diff --git a/usr/src/tools/scripts/git-pbchk.py b/usr/src/tools/scripts/git-pbchk.py
index dff057d6f5..5e3570986c 100644
--- a/usr/src/tools/scripts/git-pbchk.py
+++ b/usr/src/tools/scripts/git-pbchk.py
@@ -1,4 +1,4 @@
-#!ON_PYTHON_26
+#!ON_PYTHON_27
 #
 #  This program is free software; you can redistribute it and/or modify
 #  it under the terms of the GNU General Public License version 2
diff --git a/usr/src/tools/scripts/hdrchk.py b/usr/src/tools/scripts/hdrchk.py
index aa62f7b090..153e34ec05 100644
--- a/usr/src/tools/scripts/hdrchk.py
+++ b/usr/src/tools/scripts/hdrchk.py
@@ -1,4 +1,4 @@
-#!ON_PYTHON_26
+#!ON_PYTHON_27
 #
 # CDDL HEADER START
 #
diff --git a/usr/src/tools/scripts/hg-active.py b/usr/src/tools/scripts/hg-active.py
index 23f6c7cd98..727da2dc1a 100644
--- a/usr/src/tools/scripts/hg-active.py
+++ b/usr/src/tools/scripts/hg-active.py
@@ -1,4 +1,4 @@
-#!ON_PYTHON_26
+#!ON_PYTHON_27
 #
 #  This program is free software; you can redistribute it and/or modify
 #  it under the terms of the GNU General Public License version 2
diff --git a/usr/src/tools/scripts/mapfilechk.py b/usr/src/tools/scripts/mapfilechk.py
index ed90d8b426..4b2663ed54 100644
--- a/usr/src/tools/scripts/mapfilechk.py
+++ b/usr/src/tools/scripts/mapfilechk.py
@@ -1,4 +1,4 @@
-#!ON_PYTHON_26
+#!ON_PYTHON_27
 #
 # CDDL HEADER START
 #
diff --git a/usr/src/tools/scripts/onu.sh b/usr/src/tools/scripts/onu.sh
index 53b0d85ce9..0629d44f75 100644
--- a/usr/src/tools/scripts/onu.sh
+++ b/usr/src/tools/scripts/onu.sh
@@ -208,7 +208,7 @@ if [ -n "$repodir" ]; then
 	[[ ! -e $cfgfile ]] && cfgfile=$redistdir/pkg5.repository
 	# need an absolute path
 	[[ $redistdir == /* ]] || redistdir=$PWD/$redistdir
-	redistpub=$(python2.6 <<# EOF
+	redistpub=$(python2.7 <<# EOF
 		import ConfigParser
 		p = ConfigParser.SafeConfigParser()
 		p.read("$cfgfile")
diff --git a/usr/src/tools/scripts/validate_pkg.py b/usr/src/tools/scripts/validate_pkg.py
index 155df9ba25..105e670894 100644
--- a/usr/src/tools/scripts/validate_pkg.py
+++ b/usr/src/tools/scripts/validate_pkg.py
@@ -1,4 +1,4 @@
-#!ON_PYTHON_26
+#!ON_PYTHON_27
 #
 # CDDL HEADER START
 #
diff --git a/usr/src/tools/scripts/wsdiff.py b/usr/src/tools/scripts/wsdiff.py
index 4ae79e889f..8db2f2862d 100644
--- a/usr/src/tools/scripts/wsdiff.py
+++ b/usr/src/tools/scripts/wsdiff.py
@@ -1,4 +1,4 @@
-#!ON_PYTHON_26
+#!ON_PYTHON_27
 #
 # CDDL HEADER START
 #
-- 
2.21.0

