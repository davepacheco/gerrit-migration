From 4fae9c72bf38346edda27f5eb13551f5b667d1b8 Mon Sep 17 00:00:00 2001
From: Robert Mustacchi <rm@joyent.com>
Date: Fri, 30 Sep 2016 22:11:44 +0000
Subject: [PATCH] OS-5650 illumos tools should work with python 2.7 Reviewed
 by: Jerry Jelinek <jerry.jelinek@joyent.com> Reviewed by: Patrick Mooney
 <patrick.mooney@joyent.com> Approved by: Jerry Jelinek
 <jerry.jelinek@joyent.com>

---
 usr/src/Makefile.master         | 13 +++----------
 usr/src/cmd/mdb/Makefile.module |  6 ++++++
 2 files changed, 9 insertions(+), 10 deletions(-)

diff --git a/usr/src/Makefile.master b/usr/src/Makefile.master
index bb137e83f3..e63fabc84f 100644
--- a/usr/src/Makefile.master
+++ b/usr/src/Makefile.master
@@ -178,16 +178,9 @@ PERL_VERSION=	5.12
 PERL_PKGVERS=	-512
 PERL_ARCH =		i86pc-solaris-64int
 $(SPARC_BLD)PERL_ARCH =	sun4-solaris-64int
-PYTHON_VERSION=	2.6
-PYTHON_PKGVERS=	-26
-#
-# Until we cross the python flag day, we need to rely on the environment
-# variable to properly help us across. To that end, we purposefully
-# replace this PYTHON definition with the old version, which comes from
-# the environment.
-#
-#PYTHON=		/usr/bin/python$(PYTHON_VERSION)
-PYTHON=		$(PYTHON_26)
+PYTHON_VERSION=	2.7
+PYTHON_PKGVERS=	-27
+PYTHON=		/usr/bin/python$(PYTHON_VERSION)
 SORT=		/usr/bin/sort
 TOUCH=		/usr/bin/touch
 WC=		/usr/bin/wc
diff --git a/usr/src/cmd/mdb/Makefile.module b/usr/src/cmd/mdb/Makefile.module
index ed23c5c9dd..08f6e69def 100644
--- a/usr/src/cmd/mdb/Makefile.module
+++ b/usr/src/cmd/mdb/Makefile.module
@@ -110,6 +110,12 @@ PYCPPFLAGS		= -_gcc=-isystem -_gcc=$(ADJUNCT_PROTO)/usr/include/python$(PYTHON_V
 PYCPPFLAGS		+= -_cc=-I$(ADJUNCT_PROTO)/usr/include/python$(PYTHON_VERSION)
 PYLNFLAGS		= -I$(ADJUNCT_PROTO)/usr/include/python$(PYTHON_VERSION)
 
+#
+# At this time, we do not have python27 in the adjunct proto area, only
+# python26. As such, we explicitly override the python version dmod here.
+#
+PYTHON_VERSION		= 2.6
+
 kvm_TGTFLAGS		= -D_KERNEL
 proc_TGTFLAGS		= -D_USER
 
-- 
2.21.0

