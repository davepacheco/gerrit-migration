From 7fea40117c77399ddb437782d6ff01a05d57aa00 Mon Sep 17 00:00:00 2001
From: Jared Morrow <jm@joyent.com>
Date: Wed, 31 May 2017 17:15:22 -0600
Subject: [PATCH] MANTA-3287 Update manta operators guide with post-install
 steps

---
 docs/operator-guide/index.md | 77 ++++++++++++++++++++++++++++++++++++
 1 file changed, 77 insertions(+)

diff --git a/docs/operator-guide/index.md b/docs/operator-guide/index.md
index a5f1004..8f98ec2 100644
--- a/docs/operator-guide/index.md
+++ b/docs/operator-guide/index.md
@@ -824,6 +824,83 @@ anything from COAL to a multi-compute-node deployment.  The general process is:
 8. If desired, set up connectivity to the "ops", "marlin-dashboard", and
    "madtom" zones.  See "Overview of Operating Manta" below for details.
 
+## Post-Deployment Steps
+
+Once the above steps have been completed, there are a few steps you
+should consider doing to ensure a working deployment.
+
+### Prerequisites
+
+If you haven't already done so, you will need to [install the manta CLI tools](https://github.com/joyent/node-manta#installation).
+
+### Setup a Manta User
+
+To test manta with the manta CLI tools, you will need a user
+configured in manta. You can either use one of the default configured
+users or setup your own. The most common method is to test using the
+`poseidon` user which is created by the manta install.
+
+In either case, you will need access to the adminui. [See the
+instructions here](https://docs.joyent.com/private-cloud/install/headnode-installation#adding-external-access-to-adminui-and-imgapi) on how to find the IP address of the adminui from
+your headnode.
+
+Log into the Operations Portal:
+
+ * COAL users should use user `admin` and the password [you initially setup](https://github.com/joyent/triton/blob/master/docs/developer-guide/coal-setup.md#configure-the-headnode).
+ * Lab users will also use `admin`, but need to ask whoever
+   provisioned your lab account for the password.
+
+Once in, follow [these instructions](https://docs.joyent.com/private-cloud/users#portalsshkeys) to add ssh keys to the user of your choice.
+
+### Test Manta from the CLI Tools
+
+Once you have setup a user on manta or added your ssh keys added to an
+existing user, you can test your manta install with the manta CLI
+tools you installed above in "Prerequisites".
+
+There are complete instructions on how to get started with the CLI
+tools [on the apidocs page](https://apidocs.joyent.com/manta/#getting-started).
+
+Some things in apidocs guide will not be as clear for non-JPC users.
+
+1. The biggest difference will be the setting of the `MANTA_URL`
+   variable. In the case of a COAL, Lab, or any non-JPC install, you will
+   need to find the IP address of your API endpoint.  To do this from
+   your headnode:
+
+        headnode$ manta-adm show -H -o primary_ip loadbalancer
+
+    Multiple addresses will be returned, chose any one and set `MANTA_URL`
+    to that IP address.
+2. `MANTA_USER` will be the user you setup in "Setup a Manta User" section.
+3. `MANTA_KEY_ID` will be the ssh key id you added in "Setup a Manta
+   User" section.
+4. If the key you used is in an environment that has not installed a
+   certificate signed by a recognized authority you might see `Error:
+   self signed certificate` errors. To fix this, add
+   `MANTA_TLS_INSECURE=true` to your environment or shell config.
+
+A final `~/.bashrc` or `~/.bash_profile` might look something like:
+
+    export MANTA_USER=poseidon
+    export MANTA_URL=https://<your-loadbalancer-ip>
+    export MANTA_TLS_INSECURE=true
+    export MANTA_KEY_ID=`ssh-keygen -l -f ~/.ssh/id_rsa.pub | awk '{print $2}' | tr -d '\n'`
+
+Lastly test the CLI tools from your development machine:
+
+    $ echo "Hello, Manta" > /tmp/hello.txt
+    $ mput -f /tmp/hello.txt ~~/stor/hello-foo
+    .../stor/hello-foo          [=======================================================>] 100%      13B
+    $ mls ~~/stor/
+    hello-foo
+    $ mget ~~/stor/hello-foo
+    Hello, Manta
+
+
+
+
+
 
 ## Networking configuration
 
-- 
2.21.0

