From ed65a563f8873aea35f64b1b08ef689a7b8d6c50 Mon Sep 17 00:00:00 2001
From: Tim Foster <tim.foster@joyent.com>
Date: Wed, 27 Jun 2018 12:10:33 +0000
Subject: [PATCH] TRITON-551 sdcadm build fails as non-root, trying to create
 log dir

---
 lib/logging.js | 3 +--
 tools/mk-shar  | 2 +-
 2 files changed, 2 insertions(+), 3 deletions(-)

diff --git a/lib/logging.js b/lib/logging.js
index dddbd42..72ebdd6 100644
--- a/lib/logging.js
+++ b/lib/logging.js
@@ -196,6 +196,7 @@ function createLogger(opts) {
             level: 'trace',
             path: logFile
         });
+	mkdirp.sync(LOG_DIR);
     } else {
         logStreams.push({
             type: 'raw',
@@ -207,8 +208,6 @@ function createLogger(opts) {
         });
     }
 
-    mkdirp.sync(LOG_DIR);
-
     return bunyan.createLogger({
         name: opts.name,
         component: opts.component,
diff --git a/tools/mk-shar b/tools/mk-shar
index 97fa44e..5e92113 100755
--- a/tools/mk-shar
+++ b/tools/mk-shar
@@ -88,7 +88,7 @@ cp -PR \
     $TOP/build/node \
     $PROTO/node
 mkdir -p $PROTO/tools
-cp -P $TOP/tools/rotate-logs.sh $PROTO/tools/
+cp $TOP/tools/rotate-logs.sh $PROTO/tools/
 
 # Trim out cruft for smaller package.
 rm -rf $PROTO/node/bin/npm
-- 
2.21.0

