commit ced6396357f295e369708f01d714bf0d0e8304ed (refs/changes/33/4433/1)
Author: Tim Foster <tim.foster@joyent.com>
Date:   2018-06-26T13:10:29+00:00 (1 year, 3 months ago)
    
    TRITON-551 sdcadm build fails as non-root, trying to create log dir

diff --git a/lib/logging.js b/lib/logging.js
index dddbd42..72ebdd6 100644
--- a/lib/logging.js
+++ b/lib/logging.js
@@ -196,6 +196,7 @@ function createLogger(opts) {
             level: 'trace',
             path: logFile
         });
+	mkdirp.sync(LOG_DIR);
     } else {
         logStreams.push({
             type: 'raw',
@@ -207,8 +208,6 @@ function createLogger(opts) {
         });
     }
 
-    mkdirp.sync(LOG_DIR);
-
     return bunyan.createLogger({
         name: opts.name,
         component: opts.component,
diff --git a/tools/mk-shar b/tools/mk-shar
index 97fa44e..2d5c5b5 100755
--- a/tools/mk-shar
+++ b/tools/mk-shar
@@ -73,7 +73,7 @@ trap 'errexit $?' EXIT
 
 rm -rf $PROTO
 mkdir -p $PROTO
-cp -PR \
+/opt/local/bin/cp -PR \
     $TOP/bin \
     $TOP/lib \
     $TOP/etc \
@@ -84,11 +84,11 @@ cp -PR \
     $TOP/tools/install-sdcadm.sh \
     $TOP/package.json \
     $PROTO
-cp -PR \
+/opt/local/bin/cp -PR \
     $TOP/build/node \
     $PROTO/node
 mkdir -p $PROTO/tools
-cp -P $TOP/tools/rotate-logs.sh $PROTO/tools/
+/opt/local/bin/cp -P $TOP/tools/rotate-logs.sh $PROTO/tools/
 
 # Trim out cruft for smaller package.
 rm -rf $PROTO/node/bin/npm
