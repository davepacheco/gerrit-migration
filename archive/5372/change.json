{"project":"joyent/illumos-joyent","branch":"master","id":"I9570c935b1396a09fbd142d02251809038adb069","number":"5372","subject":"OS-7508 mdb: assertion tripped in libvmm when bhyve VM halts while mdb is attached OS-7519 mdb: bhyve target can attach before the first vCPU is configured","owner":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"url":"https://cr.joyent.us/5372","commitMessage":"OS-7508 mdb: assertion tripped in libvmm when bhyve VM halts while mdb is attached\nOS-7519 mdb: bhyve target can attach before the first vCPU is configured\n","createdOn":1547659311,"lastUpdated":1550100717,"open":false,"status":"MERGED","comments":[{"timestamp":1547659311,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Uploaded patch set 1."},{"timestamp":1547661672,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 1:\n\nWouldn\u0027t we just want vmm_cont/stop to handle this? If it\u0027s already running, that seems like success for vmm_cont() and vice versa."},{"timestamp":1547739415,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Uploaded patch set 2."},{"timestamp":1547824773,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 2: Code-Review+1\n\nThanks, looks good (modulo copyright)"},{"timestamp":1548416322,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Uploaded patch set 3."},{"timestamp":1548416822,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1548715016,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 3:\n\n(2 comments)"},{"timestamp":1549641499,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Uploaded patch set 4."},{"timestamp":1549641604,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Patch Set 3:\n\n(2 comments)"},{"timestamp":1549655460,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 4:\n\n(1 comment)"},{"timestamp":1549657427,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Uploaded patch set 5."},{"timestamp":1549657433,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Patch Set 4:\n\n(1 comment)"},{"timestamp":1549658634,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 5: Code-Review+1"},{"timestamp":1549658982,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 5: Code-Review+1"},{"timestamp":1550070530,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Patch Set 6: Patch Set 5 was rebased"},{"timestamp":1550072142,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 6: Integration-Approval+1"},{"timestamp":1550098640,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Uploaded patch set 7: Commit message was updated."},{"timestamp":1550100572,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Patch Set 8: Patch Set 6 was rebased"},{"timestamp":1550100717,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Hans Rosenfeld"}],"currentPatchSet":{"number":"8","revision":"2d1a8a4a97fe44c06e3fedddbb32f89fc2755a3e","parents":["0dffce43ebed3eede3daefae50319a3731a68e6d"],"ref":"refs/changes/72/5372/8","uploader":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"createdOn":1550100572,"author":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1549658634,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1549658982,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1550072142,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}},{"type":"SUBM","value":"1","grantedOn":1550100717,"by":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"usr/src/cmd/mdb/intel/mdb/mdb_bhyve.c","type":"MODIFIED","insertions":20,"deletions":-11},{"file":"usr/src/lib/libvmm/libvmm.c","type":"MODIFIED","insertions":22,"deletions":-6},{"file":"usr/src/lib/libvmm/libvmm.h","type":"MODIFIED","insertions":3,"deletions":-3}],"sizeInsertions":45,"sizeDeletions":-20},"patchSets":[{"number":"1","revision":"3b5d2bfbd55752de6c12ab95d911909242d7cafe","parents":["d65509d7c79d543d9a0679b39aa3cf44da89bc05"],"ref":"refs/changes/72/5372/1","uploader":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"createdOn":1547659311,"author":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/mdb/intel/mdb/mdb_bhyve.c","type":"MODIFIED","insertions":23,"deletions":-9}],"sizeInsertions":23,"sizeDeletions":-9},{"number":"2","revision":"133a33ab84791082a2613a230334f804eaa7134c","parents":["d65509d7c79d543d9a0679b39aa3cf44da89bc05"],"ref":"refs/changes/72/5372/2","uploader":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"createdOn":1547739415,"author":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1547824773,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"usr/src/cmd/mdb/intel/mdb/mdb_bhyve.c","type":"MODIFIED","insertions":20,"deletions":-11},{"file":"usr/src/lib/libvmm/libvmm.c","type":"MODIFIED","insertions":21,"deletions":-5},{"file":"usr/src/lib/libvmm/libvmm.h","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":43,"sizeDeletions":-18},{"number":"3","revision":"910fcba718358d98d3465ace6f38cf0ed6df5c41","parents":["d65509d7c79d543d9a0679b39aa3cf44da89bc05"],"ref":"refs/changes/72/5372/3","uploader":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"createdOn":1548416322,"author":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1548416822,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"comments":[{"file":"usr/src/cmd/mdb/intel/mdb/mdb_bhyve.c","line":1259,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"minor nit: this should be a \u0027.\u0027 and a new sentence."},{"file":"usr/src/cmd/mdb/intel/mdb/mdb_bhyve.c","line":1259,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Done"},{"file":"usr/src/lib/libvmm/libvmm.c","line":115,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"nit: maybe usleep() with a smaller value?  a second is a long time to make someone wait just because they lost a tight race."},{"file":"usr/src/lib/libvmm/libvmm.c","line":115,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"usr/src/cmd/mdb/intel/mdb/mdb_bhyve.c","type":"MODIFIED","insertions":20,"deletions":-11},{"file":"usr/src/lib/libvmm/libvmm.c","type":"MODIFIED","insertions":22,"deletions":-6},{"file":"usr/src/lib/libvmm/libvmm.h","type":"MODIFIED","insertions":3,"deletions":-3}],"sizeInsertions":45,"sizeDeletions":-20},{"number":"4","revision":"c517187e34ee4f9428215187c20f55622d633e1f","parents":["78c732d09a6085724619d692e899f913855c0b74"],"ref":"refs/changes/72/5372/4","uploader":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"createdOn":1549641499,"author":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/lib/libvmm/libvmm.c","line":115,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"please cast to void - in general might be worth smatch()ing this code."},{"file":"usr/src/lib/libvmm/libvmm.c","line":115,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Done. I\u0027ll look into smatch()ing later."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"usr/src/cmd/mdb/intel/mdb/mdb_bhyve.c","type":"MODIFIED","insertions":20,"deletions":-11},{"file":"usr/src/lib/libvmm/libvmm.c","type":"MODIFIED","insertions":22,"deletions":-6},{"file":"usr/src/lib/libvmm/libvmm.h","type":"MODIFIED","insertions":3,"deletions":-3}],"sizeInsertions":45,"sizeDeletions":-20},{"number":"5","revision":"455482de5572c145ca25236807102b5b0b4b9af0","parents":["36662629eb2ffb804c169f13b2421e9492380a8e"],"ref":"refs/changes/72/5372/5","uploader":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"createdOn":1549657427,"author":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1549658982,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1549658634,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"usr/src/cmd/mdb/intel/mdb/mdb_bhyve.c","type":"MODIFIED","insertions":20,"deletions":-11},{"file":"usr/src/lib/libvmm/libvmm.c","type":"MODIFIED","insertions":22,"deletions":-6},{"file":"usr/src/lib/libvmm/libvmm.h","type":"MODIFIED","insertions":3,"deletions":-3}],"sizeInsertions":45,"sizeDeletions":-20},{"number":"6","revision":"a3d8d55408e6e093f6d621601a82a1a9841d8952","parents":["4bd1f9eaffbdcbf64fd40c1dc6f195efb3d71a33"],"ref":"refs/changes/72/5372/6","uploader":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"createdOn":1550070530,"author":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1549658982,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1549658634,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1550072142,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"usr/src/cmd/mdb/intel/mdb/mdb_bhyve.c","type":"MODIFIED","insertions":20,"deletions":-11},{"file":"usr/src/lib/libvmm/libvmm.c","type":"MODIFIED","insertions":22,"deletions":-6},{"file":"usr/src/lib/libvmm/libvmm.h","type":"MODIFIED","insertions":3,"deletions":-3}],"sizeInsertions":45,"sizeDeletions":-20},{"number":"7","revision":"9570c935b1396a09fbd142d02251809038adb069","parents":["4bd1f9eaffbdcbf64fd40c1dc6f195efb3d71a33"],"ref":"refs/changes/72/5372/7","uploader":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"createdOn":1550098640,"author":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1549658982,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1549658634,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1550072142,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"usr/src/cmd/mdb/intel/mdb/mdb_bhyve.c","type":"MODIFIED","insertions":20,"deletions":-11},{"file":"usr/src/lib/libvmm/libvmm.c","type":"MODIFIED","insertions":22,"deletions":-6},{"file":"usr/src/lib/libvmm/libvmm.h","type":"MODIFIED","insertions":3,"deletions":-3}],"sizeInsertions":45,"sizeDeletions":-20},{"number":"8","revision":"2d1a8a4a97fe44c06e3fedddbb32f89fc2755a3e","parents":["0dffce43ebed3eede3daefae50319a3731a68e6d"],"ref":"refs/changes/72/5372/8","uploader":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"createdOn":1550100572,"author":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1549658982,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"SUBM","value":"1","grantedOn":1550100717,"by":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1549658634,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1550072142,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"usr/src/cmd/mdb/intel/mdb/mdb_bhyve.c","type":"MODIFIED","insertions":20,"deletions":-11},{"file":"usr/src/lib/libvmm/libvmm.c","type":"MODIFIED","insertions":22,"deletions":-6},{"file":"usr/src/lib/libvmm/libvmm.h","type":"MODIFIED","insertions":3,"deletions":-3}],"sizeInsertions":45,"sizeDeletions":-20}],"allReviewers":[{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"}]}