{"project":"joyent/mahi","branch":"master","id":"I7613dbfb3ee4e2d89ea288fa0e1dbcada4b9d7c4","number":"1818","subject":"MANTA-3224 authcache crashes on malformed requests Reviewed by: Jordan Hendricks \u003cjordan.hendricks@joyent.com\u003e Reviewed by: Alex Wilson \u003calex.wilson@joyent.com\u003e Approved by: Jordan Hendricks \u003cjordan.hendricks@joyent.com\u003e","owner":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"url":"https://cr.joyent.us/1818","commitMessage":"MANTA-3224 authcache crashes on malformed requests\nReviewed by: Jordan Hendricks \u003cjordan.hendricks@joyent.com\u003e\nReviewed by: Alex Wilson \u003calex.wilson@joyent.com\u003e\nApproved by: Jordan Hendricks \u003cjordan.hendricks@joyent.com\u003e\n","createdOn":1492732998,"lastUpdated":1493232418,"open":false,"status":"MERGED","comments":[{"timestamp":1492732998,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Uploaded patch set 1."},{"timestamp":1492733031,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1493075256,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 1: Code-Review+1"},{"timestamp":1493077100,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Patch Set 1:\n\n(1 comment)\n\nThe testing writeup is great!\n\nI think we should also update the mahi docuemntation with the new error codes that can be returned for these endpoints: https://github.com/joyent/mahi/blob/master/docs/index.md."},{"timestamp":1493078119,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Uploaded patch set 2."},{"timestamp":1493078144,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1493078390,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 1:\n\n(1 comment)\n\nNice catch on the documentation.  I\u0027ve updated that in patchset 2."},{"timestamp":1493081452,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Patch Set 2:\n\n(3 comments)"},{"timestamp":1493168596,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Uploaded patch set 3."},{"timestamp":1493168615,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 1:\n\n(2 comments)"},{"timestamp":1493168632,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1493229575,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Patch Set 3: Code-Review+1\n\n(1 comment)\n\nThere is one more typo in the docs that I noticed (not your change), but otherwise this looks good!"},{"timestamp":1493231075,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Uploaded patch set 4."},{"timestamp":1493231102,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 4:\n\n(1 comment)"},{"timestamp":1493231105,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1493231222,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Patch Set 4: Code-Review+1 Integration-Approval+1"},{"timestamp":1493231734,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 4: Code-Review+1"},{"timestamp":1493232395,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Uploaded patch set 5: Commit message was updated."},{"timestamp":1493232418,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by David Pacheco"}],"currentPatchSet":{"number":"5","revision":"7613dbfb3ee4e2d89ea288fa0e1dbcada4b9d7c4","parents":["3b91a33f423b35f8cb0454595b6794827c93a8ce"],"ref":"refs/changes/18/1818/5","uploader":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"createdOn":1493232395,"author":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1493231105,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1493231222,"by":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1493231222,"by":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1493231734,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"SUBM","value":"1","grantedOn":1493232418,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":15,"deletions":-8},{"file":"lib/server/server.js","type":"MODIFIED","insertions":23,"deletions":-2},{"file":"test/server.test.js","type":"MODIFIED","insertions":41,"deletions":-1}],"sizeInsertions":79,"sizeDeletions":-11},"patchSets":[{"number":"1","revision":"74c742fd6c82da5d530e7ac860bf2a00dd6c393a","parents":["3b91a33f423b35f8cb0454595b6794827c93a8ce"],"ref":"refs/changes/18/1818/1","uploader":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"createdOn":1492732998,"author":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1493075256,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1492733031,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/server/server.js","line":406,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Why is this not a similar error to a missing account?"},{"file":"lib/server/server.js","line":406,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I don\u0027t think there\u0027s a great reason.  I think I inferred (possibly speciously) that the old code intended to have this case work and produce an empty output object, since it explicitly checked for the falseness of \"uuids\" and didn\u0027t bail out.\n\nWhen I was reviewing the API docs, I was reminded that clients might specify this by translating an array into a sequence of query params with the same name (uuid\u003dx\u0026uuid\u003dy\u0026uuid\u003dz).  While I can see wanting to be strict about specifying a parameter, I could also imagine it being useful for some clients to be able to leave out the argument so that they don\u0027t have to special-case the case of an empty array.\n\nMy slight preference is to leave this as is, but I don\u0027t have a strong feeling about it."},{"file":"lib/server/server.js","line":406,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Okay, sounds good."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/server/server.js","type":"MODIFIED","insertions":23,"deletions":-2},{"file":"test/server.test.js","type":"MODIFIED","insertions":41,"deletions":-1}],"sizeInsertions":64,"sizeDeletions":-3},{"number":"2","revision":"03331581d74ae37a8878dddcd006986a60d5f669","parents":["3b91a33f423b35f8cb0454595b6794827c93a8ce"],"ref":"refs/changes/18/1818/2","uploader":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"createdOn":1493078119,"author":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1493078144,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"docs/index.md","line":328,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"While you\u0027re changing this file, could we fix these tables (NameToUuid inputs and UuidToName inputs)? They don\u0027t render properly -- there\u0027s a few things wrong: the asterisks around the top row, double vertical bars instead of single ones, and the missing second row of dashes, e.g., the first one fixed is:\n\n| Field | Type | Required? | Notes |\n| -- | --- | --- | --- |\n| account (query param) | string | Yes | account login to translate |\n| name (query param) | string | No | name of policy/user/role under the given account to translate. required if type is specified. specify multiple times for multiple translations |\n| type (query param) | string | No | type of the names to translate (policy, user, role). required if any names are specified |"},{"file":"docs/index.md","line":328,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patchset 3 addresses this.  You can see it rendered here:\nhttps://github.com/davepacheco/mahi/blob/a70428e514f8a4e462f3279d1a741c90e7efe6b8/docs/index.md\n\nI checked both the GitHub rendering and the one generated by \"make docs\" (used by mo.joyent.com)."},{"file":"docs/index.md","line":344,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"This error should also be added to UuidToName errors, right?"},{"file":"docs/index.md","line":344,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I don\u0027t think so.  That API does not accept an account parameter, and it works with no parameters at all."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"lib/server/server.js","type":"MODIFIED","insertions":23,"deletions":-2},{"file":"test/server.test.js","type":"MODIFIED","insertions":41,"deletions":-1}],"sizeInsertions":68,"sizeDeletions":-4},{"number":"3","revision":"a70428e514f8a4e462f3279d1a741c90e7efe6b8","parents":["3b91a33f423b35f8cb0454595b6794827c93a8ce"],"ref":"refs/changes/18/1818/3","uploader":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"createdOn":1493168596,"author":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1493168632,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1493229575,"by":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"}}],"comments":[{"file":"docs/index.md","line":123,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"/s/Userse/Users"},{"file":"docs/index.md","line":123,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":14,"deletions":-7},{"file":"lib/server/server.js","type":"MODIFIED","insertions":23,"deletions":-2},{"file":"test/server.test.js","type":"MODIFIED","insertions":41,"deletions":-1}],"sizeInsertions":78,"sizeDeletions":-10},{"number":"4","revision":"0f36716d6b5201d0a48410f3258a90bf33182974","parents":["3b91a33f423b35f8cb0454595b6794827c93a8ce"],"ref":"refs/changes/18/1818/4","uploader":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"createdOn":1493231075,"author":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1493231734,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1493231105,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1493231222,"by":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1493231222,"by":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":15,"deletions":-8},{"file":"lib/server/server.js","type":"MODIFIED","insertions":23,"deletions":-2},{"file":"test/server.test.js","type":"MODIFIED","insertions":41,"deletions":-1}],"sizeInsertions":79,"sizeDeletions":-11},{"number":"5","revision":"7613dbfb3ee4e2d89ea288fa0e1dbcada4b9d7c4","parents":["3b91a33f423b35f8cb0454595b6794827c93a8ce"],"ref":"refs/changes/18/1818/5","uploader":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"createdOn":1493232395,"author":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"SUBM","value":"1","grantedOn":1493232418,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1493231734,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1493231105,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1493231222,"by":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1493231222,"by":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":15,"deletions":-8},{"file":"lib/server/server.js","type":"MODIFIED","insertions":23,"deletions":-2},{"file":"test/server.test.js","type":"MODIFIED","insertions":41,"deletions":-1}],"sizeInsertions":79,"sizeDeletions":-11}],"allReviewers":[{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}]}