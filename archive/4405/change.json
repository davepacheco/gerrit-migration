{"project":"joyent/sdc-imgapi","branch":"master","id":"I7040f0e2326e230db76a9e1c788bfe41ea4f4ee8","number":"4405","subject":"TRITON-536 prepare-image script lacks cloud-init cleanup Reviewed by: Marsell Kukuljevic \u003cmarsell@joyent.com\u003e Approved by: Josh Wilsdon \u003cjwilsdon@joyent.com\u003e","owner":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"url":"https://cr.joyent.us/4405","commitMessage":"TRITON-536 prepare-image script lacks cloud-init cleanup\nReviewed by: Marsell Kukuljevic \u003cmarsell@joyent.com\u003e\nApproved by: Josh Wilsdon \u003cjwilsdon@joyent.com\u003e\n","createdOn":1529614610,"lastUpdated":1542826238,"open":false,"status":"MERGED","comments":[{"timestamp":1529614610,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Uploaded patch set 1."},{"timestamp":1529614640,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1529728845,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Uploaded patch set 2."},{"timestamp":1529728876,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1529888149,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Uploaded patch set 3."},{"timestamp":1529888179,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1529929011,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1541441323,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 3:\n\nIs this still waiting on something?"},{"timestamp":1542720990,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Uploaded patch set 4."},{"timestamp":1542721021,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4:\n\n\"make check\" passed ok"},{"timestamp":1542721085,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Uploaded patch set 5."},{"timestamp":1542721115,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1542721344,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Uploaded patch set 6."},{"timestamp":1542721373,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 6:\n\n\"make check\" passed ok"},{"timestamp":1542723729,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 6:\n\nComing back to this... I found an old workspace and check this over one more time.  I saw an obvious error, did a couple sanity checks with a manual \u0027imgadm create -s\u0027, then pushed changeset 4.  But I forget to commit the one line fix.  I then did \u0027git commit --amend\u0027, and pushed changeset 5.  Comparing 3 and 5 made me realize that I was working from a stale workspace.  I found another workspace with something that looked to be the right fix and pushed it as changeset 6.  That matches the one that Marsell reviewed, so his +1 came back.  Amazing.\n\nI re-tested the fix on the current centos 7, debian 8, and ubuntu 18.04 images.  Per test notes in the ticket, regression testing on old kvm images has already been done."},{"timestamp":1542743855,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 6: Integration-Approval+1"},{"timestamp":1542826170,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 7: Patch Set 6 was rebased"},{"timestamp":1542826201,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 7:\n\n\"make check\" passed ok"},{"timestamp":1542826232,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 8: Commit message was updated."},{"timestamp":1542826238,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Mike Gerdts"}],"currentPatchSet":{"number":"8","revision":"c360b9c2324909e3605eedf6243b394401beceb3","parents":["ea5a7007740f7f9c32a257cbaa68cba19fbbf822"],"ref":"refs/changes/05/4405/8","uploader":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"createdOn":1542826232,"author":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1529888179,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1529929011,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1542743855,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"SUBM","value":"1","grantedOn":1542826238,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"tools/prepare-image/linux-prepare-image","type":"MODIFIED","insertions":26,"deletions":-4}],"sizeInsertions":26,"sizeDeletions":-4},"patchSets":[{"number":"1","revision":"c5694a532333644fbbd03a82a2d7edc93d487500","parents":["99b4534c0c662495ab9cac2f5e574fa86f391b77"],"ref":"refs/changes/05/4405/1","uploader":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"createdOn":1529614610,"author":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1529614640,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"tools/prepare-image/linux-prepare-image","type":"MODIFIED","insertions":22,"deletions":-4}],"sizeInsertions":22,"sizeDeletions":-4},{"number":"2","revision":"0ecf1e2d3c48bebdbb24f787bcec48cfdf61319a","parents":["99b4534c0c662495ab9cac2f5e574fa86f391b77"],"ref":"refs/changes/05/4405/2","uploader":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"createdOn":1529728845,"author":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1529728876,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"tools/prepare-image/linux-prepare-image","type":"MODIFIED","insertions":25,"deletions":-4}],"sizeInsertions":25,"sizeDeletions":-4},{"number":"3","revision":"48688b032beba8f12104ef65b0b15d1be5023be9","parents":["99b4534c0c662495ab9cac2f5e574fa86f391b77"],"ref":"refs/changes/05/4405/3","uploader":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"createdOn":1529888149,"author":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1529888179,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1529929011,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"tools/prepare-image/linux-prepare-image","type":"MODIFIED","insertions":26,"deletions":-4}],"sizeInsertions":26,"sizeDeletions":-4},{"number":"4","revision":"bc08e146de4dffaf3a9a31f261915d3c6584ee16","parents":["e9ba3ee89183084cbf4b65536cb18d363cb159a1"],"ref":"refs/changes/05/4405/4","uploader":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"createdOn":1542720990,"author":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1529614640,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"tools/prepare-image/linux-prepare-image","type":"MODIFIED","insertions":22,"deletions":-4}],"sizeInsertions":22,"sizeDeletions":-4},{"number":"5","revision":"b159b9b5cd890f22a6af23dd73dbf3737c005df6","parents":["e9ba3ee89183084cbf4b65536cb18d363cb159a1"],"ref":"refs/changes/05/4405/5","uploader":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"createdOn":1542721085,"author":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1542721115,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"tools/prepare-image/linux-prepare-image","type":"MODIFIED","insertions":22,"deletions":-4}],"sizeInsertions":22,"sizeDeletions":-4},{"number":"6","revision":"7040f0e2326e230db76a9e1c788bfe41ea4f4ee8","parents":["e9ba3ee89183084cbf4b65536cb18d363cb159a1"],"ref":"refs/changes/05/4405/6","uploader":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"createdOn":1542721344,"author":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1529888179,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1542743855,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1529929011,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"tools/prepare-image/linux-prepare-image","type":"MODIFIED","insertions":26,"deletions":-4}],"sizeInsertions":26,"sizeDeletions":-4},{"number":"7","revision":"070cb414bd3308eb41d0de3b948ce15c17f023a9","parents":["ea5a7007740f7f9c32a257cbaa68cba19fbbf822"],"ref":"refs/changes/05/4405/7","uploader":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"createdOn":1542826170,"author":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1529888179,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1542743855,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1529929011,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"tools/prepare-image/linux-prepare-image","type":"MODIFIED","insertions":26,"deletions":-4}],"sizeInsertions":26,"sizeDeletions":-4},{"number":"8","revision":"c360b9c2324909e3605eedf6243b394401beceb3","parents":["ea5a7007740f7f9c32a257cbaa68cba19fbbf822"],"ref":"refs/changes/05/4405/8","uploader":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"createdOn":1542826232,"author":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1529888179,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1542743855,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1529929011,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}},{"type":"SUBM","value":"1","grantedOn":1542826238,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"tools/prepare-image/linux-prepare-image","type":"MODIFIED","insertions":26,"deletions":-4}],"sizeInsertions":26,"sizeDeletions":-4}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}]}