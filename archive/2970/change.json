{"project":"joyent/zoneinit","branch":"master","id":"Ifc40aaea14e88825b52db14006acdc2a3aed76e1","number":"2970","subject":"DATASET-1318 cleanup zoneinit and make reboot optional","owner":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"url":"https://cr.joyent.us/2970","commitMessage":"DATASET-1318 cleanup zoneinit and make reboot optional\n","createdOn":1511209451,"lastUpdated":1517851593,"open":true,"status":"NEW","comments":[{"timestamp":1511209451,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Uploaded patch set 1."},{"timestamp":1511209454,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit c957f870bd73803cf3709bb5f15f5fe10f19bbe7\n    \n    initial commit"},{"timestamp":1517851593,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 1:\n\n(6 comments)\n\nWhat testing has been done on this?\n\nIs it worth adding something to the README.md indicating what should be done in the image before reboot can be set to false? We need at least to have removed the utmp file and logs, right?\n\nWhen the system comes up, some logs will have a different hostname too initially, right since things log before we have set the hostname?\n\nMaybe it\u0027d be worth booting up a zone using the same image with this zoneinit and the existing zoneinit, and then do a diff between all the files after it completes provisioning?"}],"currentPatchSet":{"number":"1","revision":"fc40aaea14e88825b52db14006acdc2a3aed76e1","parents":["c66e3452f7d2b064749f0e7cb59710d77c218a0c"],"ref":"refs/changes/70/2970/1","uploader":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"createdOn":1511209451,"author":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"isDraft":false,"kind":"REWORK","comments":[{"file":"includes/00-mdata.sh","line":5,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"What is the min-platform that has filewait? Might be worth adding a comment here that all platforms after XXX have this?"},{"file":"includes/11-files.sh","line":15,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Again curious why we changed which egrep we might be using? Do we know that any egrep will work? Or have we set the PATH more restrictively here? If not: maybe we should?"},{"file":"zoneinit","line":1,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Why are we changing the shebang here? This seems like it might cause problems since we might end up using the zone\u0027s /usr/local/bin/bash for which we don\u0027t control the version (e.g. in the case of a custom image). Wouldn\u0027t we be better always using the version from the platform?"},{"file":"zoneinit","line":15,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"How does this end up getting set?"},{"file":"zoneinit","line":43,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"where does ${INC-zoneinit} get set?"},{"file":"zoneinit","line":44,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"If you\u0027re changing the style from ${VAR} to $VAR, you should do this one too to be consistent."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"LICENSE","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"includes/00-mdata.sh","type":"MODIFIED","insertions":4,"deletions":-16},{"file":"includes/01-reboot-file.sh","type":"MODIFIED","insertions":14,"deletions":-3},{"file":"includes/02-config.sh","type":"MODIFIED","insertions":61,"deletions":-107},{"file":"includes/04-mdata.sh","type":"MODIFIED","insertions":10,"deletions":-6},{"file":"includes/11-files.sh","type":"MODIFIED","insertions":23,"deletions":-20},{"file":"includes/12-network.sh","type":"MODIFIED","insertions":5,"deletions":-12},{"file":"includes/91-passwords.sh","type":"MODIFIED","insertions":29,"deletions":-30},{"file":"includes/92-sshd.sh","type":"MODIFIED","insertions":11,"deletions":-9},{"file":"includes/999-cleanup.sh","type":"MODIFIED","insertions":8,"deletions":-5},{"file":"zoneinit","type":"MODIFIED","insertions":39,"deletions":-33},{"file":"zoneinit.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":206,"sizeDeletions":-243},"patchSets":[{"number":"1","revision":"fc40aaea14e88825b52db14006acdc2a3aed76e1","parents":["c66e3452f7d2b064749f0e7cb59710d77c218a0c"],"ref":"refs/changes/70/2970/1","uploader":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"createdOn":1511209451,"author":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"isDraft":false,"kind":"REWORK","comments":[{"file":"includes/00-mdata.sh","line":5,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"What is the min-platform that has filewait? Might be worth adding a comment here that all platforms after XXX have this?"},{"file":"includes/11-files.sh","line":15,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Again curious why we changed which egrep we might be using? Do we know that any egrep will work? Or have we set the PATH more restrictively here? If not: maybe we should?"},{"file":"zoneinit","line":1,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Why are we changing the shebang here? This seems like it might cause problems since we might end up using the zone\u0027s /usr/local/bin/bash for which we don\u0027t control the version (e.g. in the case of a custom image). Wouldn\u0027t we be better always using the version from the platform?"},{"file":"zoneinit","line":15,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"How does this end up getting set?"},{"file":"zoneinit","line":43,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"where does ${INC-zoneinit} get set?"},{"file":"zoneinit","line":44,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"If you\u0027re changing the style from ${VAR} to $VAR, you should do this one too to be consistent."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"LICENSE","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"includes/00-mdata.sh","type":"MODIFIED","insertions":4,"deletions":-16},{"file":"includes/01-reboot-file.sh","type":"MODIFIED","insertions":14,"deletions":-3},{"file":"includes/02-config.sh","type":"MODIFIED","insertions":61,"deletions":-107},{"file":"includes/04-mdata.sh","type":"MODIFIED","insertions":10,"deletions":-6},{"file":"includes/11-files.sh","type":"MODIFIED","insertions":23,"deletions":-20},{"file":"includes/12-network.sh","type":"MODIFIED","insertions":5,"deletions":-12},{"file":"includes/91-passwords.sh","type":"MODIFIED","insertions":29,"deletions":-30},{"file":"includes/92-sshd.sh","type":"MODIFIED","insertions":11,"deletions":-9},{"file":"includes/999-cleanup.sh","type":"MODIFIED","insertions":8,"deletions":-5},{"file":"zoneinit","type":"MODIFIED","insertions":39,"deletions":-33},{"file":"zoneinit.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":206,"sizeDeletions":-243}],"allReviewers":[{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"}]}