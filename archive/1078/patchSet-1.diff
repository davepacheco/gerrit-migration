From 7386b78309e13ba96a979f8f68df7f7c08b8ad33 Mon Sep 17 00:00:00 2001
From: Suk Won Choi <sw00.choi@samsung.com>
Date: Wed, 7 Dec 2016 11:19:23 +0900
Subject: [PATCH] joyent/sdc-imgapi#11 no_proxy support;
 https://cr.joyent.us/#/c/830/ commit should be applied to package.json

---
 lib/utils.js                   | 5 +++++
 sapi_manifests/imgapi/template | 1 +
 2 files changed, 6 insertions(+)

diff --git a/lib/utils.js b/lib/utils.js
index 21f0f7a..abb9f50 100644
--- a/lib/utils.js
+++ b/lib/utils.js
@@ -414,6 +414,11 @@ function commonHttpClientOpts(clientOpts, req) {
         clientOpts.proxy = app.config.httpProxy || false;
     }
 
+    // noProxy
+    if (clientOpts.noProxy === undefined) {
+        clientOpts.noProxy = app.config.noProxy;
+    }
+
     // headers.request-id
     if (req && req.getId()) {
         var req_id = (clientOpts.headers
diff --git a/sapi_manifests/imgapi/template b/sapi_manifests/imgapi/template
index d720b38..7d6b8af 100644
--- a/sapi_manifests/imgapi/template
+++ b/sapi_manifests/imgapi/template
@@ -60,6 +60,7 @@
     },
 
     "httpProxy": "{{{http_proxy}}}",
+    "noProxy": "{{{no_proxy}}}",
     "dockerRegistryInsecure": {{^docker_registry_insecure}}false{{/docker_registry_insecure}}{{#docker_registry_insecure}}{{{docker_registry_insecure}}}{{/docker_registry_insecure}},
 
     "// imgapi-manta-setup": "The following vars used by 'imgapi-*-manta-setup'.",
-- 
2.21.0

