{"project":"joyent/sdc-manta","branch":"master","id":"I5199e9aa87b7add8f7a705ef6b1059fe079e7d6e","number":"3468","subject":"TOOLS-1983 How to avoid hard failure of most builds on Feb 22 from GitHub weak crypto removal Reviewed by: Cody Peter Mello \u003ccody.mello@joyent.com\u003e Approved by: Cody Peter Mello \u003ccody.mello@joyent.com\u003e","owner":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"url":"https://cr.joyent.us/3468","commitMessage":"TOOLS-1983 How to avoid hard failure of most builds on Feb 22 from GitHub weak crypto removal\nReviewed by: Cody Peter Mello \u003ccody.mello@joyent.com\u003e\nApproved by: Cody Peter Mello \u003ccody.mello@joyent.com\u003e\n","createdOn":1519437754,"lastUpdated":1519774131,"open":false,"status":"MERGED","comments":[{"timestamp":1519437754,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 1."},{"timestamp":1519437821,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 1:\n\nTesting notes: built an image with those changes and update the manta-deployment zone in staging-1 to that image.\n\nThen logged into that zone, made sure all services were up. Finally, ran a few manta-adm commands (including manta-adm show, manta-adm update) and made sure those worked as expected."},{"timestamp":1519692476,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 1:\n\nI ran into the following issue in staging:\n\n[root@headnode (staging-1) ~]# manta-oneach mrgroups -sv\nld.so.1: node: fatal: relocation error: file /zones/33c7aa56-92fd-403e-b16b-bff137ffc8be/root/opt/smartdc/manta-deployment/node_modules/zonename/lib/zonename_binding.node: symbol _ZNKSt8__detail20_Prime_rehash_policy11_M_next_bktEj: referenced symbol not found\nKilled\n[root@headnode (staging-1) ~]#\n\nThat node binary now depends on:\n\nThat binary add-on depends on:\n\n[root@headnode (staging-1) ~]# ldd /zones/33c7aa56-92fd-403e-b16b-bff137ffc8be/root/opt/smartdc/manta-deployment/node_modules/zonename/lib/zonename_binding.node\n        libnvpair.so.1 \u003d\u003e        /lib/libnvpair.so.1\n        libumem.so.1 \u003d\u003e  /lib/libumem.so.1\n        libstdc++.so.6 \u003d\u003e        /usr/lib/libstdc++.so.6\n        libstdc++.so.6 (GLIBCXX_3.4.18) \u003d\u003e       (version not found)\n        libstdc++.so.6 (CXXABI_1.3) \u003d\u003e   (version not found)\n        libm.so.2 \u003d\u003e     /lib/libm.so.2\n        librt.so.1 \u003d\u003e    /lib/librt.so.1\n        libc.so.1 \u003d\u003e     /lib/libc.so.1\n        libgcc_s.so.1 \u003d\u003e         /usr/lib/libgcc_s.so.1\n        libnsl.so.1 \u003d\u003e   /lib/libnsl.so.1\n        libmp.so.2 \u003d\u003e    /lib/libmp.so.2\n        libmd.so.1 \u003d\u003e    /lib/libmd.so.1\n[root@headnode (staging-1) ~]#\n\nGLIBCXX_3.4.18 corresponds to GCC 4.8\u0027s ABI version. So we\u0027ll need to bundle the C++ runtime in the node binary used by the manta-deployment zone.\n\nWe\u0027ve started new sdcnode builds to do that, and I\u0027ll update this CR with a new sdcnode build when it\u0027s done."},{"timestamp":1519751529,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1519756969,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 2."},{"timestamp":1519757017,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1519757025,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 2:\n\nPatch set 2 was tested by running various manta-* commands, including the one that used to fail with a relocation error (manta-oneach), and they all terminated successfully."},{"timestamp":1519772107,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 2: Code-Review+1 Integration-Approval+1"},{"timestamp":1519774127,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 3: Commit message was updated."},{"timestamp":1519774131,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Julien Gilli"}],"currentPatchSet":{"number":"3","revision":"7598057228c657c0e4ec961925b146c23d1c6118","parents":["7c154f813e65170722a6b1ae3b7ec8a0d4fe86ed"],"ref":"refs/changes/68/3468/3","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1519774127,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1519757017,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1519772107,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1519772107,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"SUBM","value":"1","grantedOn":1519774131,"by":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":7,"deletions":-3}],"sizeInsertions":7,"sizeDeletions":-3},"patchSets":[{"number":"1","revision":"59b5abba336c56d1f7603887fd07b9d04ce6eb53","parents":["7c154f813e65170722a6b1ae3b7ec8a0d4fe86ed"],"ref":"refs/changes/68/3468/1","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1519437754,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1519751529,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":3,"deletions":-2}],"sizeInsertions":3,"sizeDeletions":-2},{"number":"2","revision":"5199e9aa87b7add8f7a705ef6b1059fe079e7d6e","parents":["7c154f813e65170722a6b1ae3b7ec8a0d4fe86ed"],"ref":"refs/changes/68/3468/2","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1519756969,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1519772107,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1519772107,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1519757017,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":7,"deletions":-3}],"sizeInsertions":7,"sizeDeletions":-3},{"number":"3","revision":"7598057228c657c0e4ec961925b146c23d1c6118","parents":["7c154f813e65170722a6b1ae3b7ec8a0d4fe86ed"],"ref":"refs/changes/68/3468/3","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1519774127,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1519772107,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1519772107,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1519757017,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"SUBM","value":"1","grantedOn":1519774131,"by":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":7,"deletions":-3}],"sizeInsertions":7,"sizeDeletions":-3}],"allReviewers":[{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}]}