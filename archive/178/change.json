{"project":"joyent/node-triton","branch":"master","topic":"PUBAPI-1299","id":"I29fa72fa6e259ff679b12baf6188aca15322cf76","number":"178","subject":"PUBAPI-1299 want nicer API for smartdc-auth joyent/node-triton#108 triton profile create should handle private key that is passphrase-protected","owner":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"url":"https://cr.joyent.us/178","commitMessage":"PUBAPI-1299 want nicer API for smartdc-auth\njoyent/node-triton#108 triton profile create should handle private key that is passphrase-protected\n","createdOn":1469841894,"lastUpdated":1480618513,"open":false,"status":"ABANDONED","comments":[{"timestamp":1469841894,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 1."},{"timestamp":1469841903,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Topic set to PUBAPI-1299"},{"timestamp":1469841919,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing-1\n\n(5 comments)\n\n\"make check\" exited with status 2"},{"timestamp":1469842124,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 2."},{"timestamp":1469842157,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1469842251,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 3."},{"timestamp":1469842254,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing-1\n\n\"make check\" exited with status 2\n\n fatal: ref HEAD is not a symbolic ref\n version is: 5.0.0\n [[ `cat package.json | json version` \u003d\u003d `grep \u0027^## \u0027 CHANGES.md | head -1 | awk \u0027{print $2}\u0027` ]]\n Makefile:52: recipe for target \u0027versioncheck\u0027 failed\n gmake: *** [versioncheck] Error 1"},{"timestamp":1469842490,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 4."},{"timestamp":1469842524,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1471037407,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 4:\n\n(10 comments)"},{"timestamp":1480618495,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 4:\n\nAbandoning for https://cr.joyent.us/#/c/1025/\nPUBAPI-1299 already made it in separately."},{"timestamp":1480618513,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Abandoned\n\nsee previous comment. see https://cr.joyent.us/#/c/1025/"}],"currentPatchSet":{"number":"4","revision":"29fa72fa6e259ff679b12baf6188aca15322cf76","parents":["11cd220c3c0fd6ad75154b362ec8c58072905557"],"ref":"refs/changes/78/178/4","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1469842490,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1469842524,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"CHANGES.md","line":10,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Again, not a strong patter, but the brackets around the \"#NNN\" wasn\u0027t for syntax on just that, but for \"metadata about this bullet point\". I.e.:\n\n- [#108, PUBAPI-1299] Support for ...\n\nI\u0027m not married to it tho."},{"file":"CHANGES.md","line":14,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Not a strong pattern, but bullet points that introduce backward incompat lower in this CHANGES.md have a `[backwards incompat]` prefix."},{"file":"CHANGES.md","line":15,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Can we have future work to allow a filesystem path? I don\u0027t recall if this might be a blocker. I know I\u0027ve at least once wanted to use `triton` in some automated (no ssh-agent) env where the key wasn\u0027t typically in ~/.ssh."},{"file":"lib/cli.js","line":321,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"`_tritonapiErr` please"},{"file":"lib/cli.js","line":327,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Did you look at all at dropping support for the \u0027tritonapi\u0027 getter? I imagine that would potentially be a lot of code change through out Triton.\n\nI haven\u0027t played with this code yet, but ... it feels like it could cause bugs if, e.g., `Cmdln.prototype.init.apply(...)` is called *async*.\n\n... discussed in chat."},{"file":"lib/cli.js","line":337,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Could we get a scenario where getting completions can hang asking for a passphrase? Not sure the bash completion driver can cope with that."},{"file":"lib/cloudapi2.js","line":84,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"perhaps \"Either (preferred):\"\n\nand later: \"Or (backward compatible API):\""},{"file":"lib/cloudapi2.js","line":99,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"I\u0027d just repeat the \u0027roles\u0027 line in each block above. Else one reading just to the preferred block could miss it."},{"file":"lib/do_profile/profilecommon.js","line":260,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"for *use* with Docker.\n\nAs the guy on the GH ticket said: this is pretty scary. Makes me want to have some kind of link there to a discussion of the issues. Perhaps in the node-triton readme? or in the sdc-docker docs on authentication. E.g. the details that you gave about a user perhaps wanting to use a separate key without-passphrase for *docker* usage. Whether that is automatic or not, some users might not think to do that (or know it is possible to have multiple keys in play)."},{"file":"lib/do_profile/profilecommon.js","line":352,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"soooo nice to see a change dropping shelling out to openssl!\n\nDo you think this\u0027ll work on Windows now?"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":7,"deletions":-2},{"file":"lib/cli.js","type":"MODIFIED","insertions":48,"deletions":-25},{"file":"lib/cloudapi2.js","type":"MODIFIED","insertions":108,"deletions":-13},{"file":"lib/do_profile/do_create.js","type":"MODIFIED","insertions":59,"deletions":-52},{"file":"lib/do_profile/profilecommon.js","type":"MODIFIED","insertions":77,"deletions":-75},{"file":"lib/tritonapi.js","type":"MODIFIED","insertions":51,"deletions":-33},{"file":"package.json","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"test/integration/api-images.test.js","type":"MODIFIED","insertions":4,"deletions":-2},{"file":"test/integration/api-instances.test.js","type":"MODIFIED","insertions":10,"deletions":-7},{"file":"test/integration/api-networks.test.js","type":"MODIFIED","insertions":12,"deletions":-10},{"file":"test/integration/api-packages.test.js","type":"MODIFIED","insertions":9,"deletions":-7}],"sizeInsertions":389,"sizeDeletions":-229},"patchSets":[{"number":"1","revision":"53a24ecc5a85184ae94cf4465dedab94ee4b30ae","parents":["11cd220c3c0fd6ad75154b362ec8c58072905557"],"ref":"refs/changes/78/178/1","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1469841894,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1469841919,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/do_profile/do_create.js","line":238,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"warning: identifer err hides an identifier in a parent scope"},{"file":"lib/do_profile/profilecommon.js","line":272,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"warning: identifer err hides an identifier in a parent scope"},{"file":"test/integration/api-instances.test.js","line":38,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"warning: identifer err hides an identifier in a parent scope"},{"file":"test/integration/api-networks.test.js","line":41,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"warning: identifer err hides an identifier in a parent scope"},{"file":"test/integration/api-packages.test.js","line":37,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"warning: identifer err hides an identifier in a parent scope"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"lib/cli.js","type":"MODIFIED","insertions":48,"deletions":-25},{"file":"lib/cloudapi2.js","type":"MODIFIED","insertions":108,"deletions":-13},{"file":"lib/do_profile/do_create.js","type":"MODIFIED","insertions":59,"deletions":-52},{"file":"lib/do_profile/profilecommon.js","type":"MODIFIED","insertions":78,"deletions":-75},{"file":"lib/tritonapi.js","type":"MODIFIED","insertions":51,"deletions":-33},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"test/integration/api-images.test.js","type":"MODIFIED","insertions":4,"deletions":-2},{"file":"test/integration/api-instances.test.js","type":"MODIFIED","insertions":10,"deletions":-7},{"file":"test/integration/api-networks.test.js","type":"MODIFIED","insertions":12,"deletions":-10},{"file":"test/integration/api-packages.test.js","type":"MODIFIED","insertions":9,"deletions":-7}],"sizeInsertions":382,"sizeDeletions":-226},{"number":"2","revision":"2e7fd92c62f91b4e6a116dd1ad35cc63f731de43","parents":["11cd220c3c0fd6ad75154b362ec8c58072905557"],"ref":"refs/changes/78/178/2","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1469842124,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1469842157,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"lib/cli.js","type":"MODIFIED","insertions":48,"deletions":-25},{"file":"lib/cloudapi2.js","type":"MODIFIED","insertions":108,"deletions":-13},{"file":"lib/do_profile/do_create.js","type":"MODIFIED","insertions":59,"deletions":-52},{"file":"lib/do_profile/profilecommon.js","type":"MODIFIED","insertions":77,"deletions":-75},{"file":"lib/tritonapi.js","type":"MODIFIED","insertions":51,"deletions":-33},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"test/integration/api-images.test.js","type":"MODIFIED","insertions":4,"deletions":-2},{"file":"test/integration/api-instances.test.js","type":"MODIFIED","insertions":10,"deletions":-7},{"file":"test/integration/api-networks.test.js","type":"MODIFIED","insertions":12,"deletions":-10},{"file":"test/integration/api-packages.test.js","type":"MODIFIED","insertions":9,"deletions":-7}],"sizeInsertions":381,"sizeDeletions":-226},{"number":"3","revision":"08ddd2de991984b157931c95081b1d3a45954536","parents":["11cd220c3c0fd6ad75154b362ec8c58072905557"],"ref":"refs/changes/78/178/3","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1469842251,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1469842254,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"lib/cli.js","type":"MODIFIED","insertions":48,"deletions":-25},{"file":"lib/cloudapi2.js","type":"MODIFIED","insertions":108,"deletions":-13},{"file":"lib/do_profile/do_create.js","type":"MODIFIED","insertions":59,"deletions":-52},{"file":"lib/do_profile/profilecommon.js","type":"MODIFIED","insertions":77,"deletions":-75},{"file":"lib/tritonapi.js","type":"MODIFIED","insertions":51,"deletions":-33},{"file":"package.json","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"test/integration/api-images.test.js","type":"MODIFIED","insertions":4,"deletions":-2},{"file":"test/integration/api-instances.test.js","type":"MODIFIED","insertions":10,"deletions":-7},{"file":"test/integration/api-networks.test.js","type":"MODIFIED","insertions":12,"deletions":-10},{"file":"test/integration/api-packages.test.js","type":"MODIFIED","insertions":9,"deletions":-7}],"sizeInsertions":382,"sizeDeletions":-227},{"number":"4","revision":"29fa72fa6e259ff679b12baf6188aca15322cf76","parents":["11cd220c3c0fd6ad75154b362ec8c58072905557"],"ref":"refs/changes/78/178/4","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1469842490,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1469842524,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"CHANGES.md","line":10,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Again, not a strong patter, but the brackets around the \"#NNN\" wasn\u0027t for syntax on just that, but for \"metadata about this bullet point\". I.e.:\n\n- [#108, PUBAPI-1299] Support for ...\n\nI\u0027m not married to it tho."},{"file":"CHANGES.md","line":14,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Not a strong pattern, but bullet points that introduce backward incompat lower in this CHANGES.md have a `[backwards incompat]` prefix."},{"file":"CHANGES.md","line":15,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Can we have future work to allow a filesystem path? I don\u0027t recall if this might be a blocker. I know I\u0027ve at least once wanted to use `triton` in some automated (no ssh-agent) env where the key wasn\u0027t typically in ~/.ssh."},{"file":"lib/cli.js","line":321,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"`_tritonapiErr` please"},{"file":"lib/cli.js","line":327,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Did you look at all at dropping support for the \u0027tritonapi\u0027 getter? I imagine that would potentially be a lot of code change through out Triton.\n\nI haven\u0027t played with this code yet, but ... it feels like it could cause bugs if, e.g., `Cmdln.prototype.init.apply(...)` is called *async*.\n\n... discussed in chat."},{"file":"lib/cli.js","line":337,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Could we get a scenario where getting completions can hang asking for a passphrase? Not sure the bash completion driver can cope with that."},{"file":"lib/cloudapi2.js","line":84,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"perhaps \"Either (preferred):\"\n\nand later: \"Or (backward compatible API):\""},{"file":"lib/cloudapi2.js","line":99,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"I\u0027d just repeat the \u0027roles\u0027 line in each block above. Else one reading just to the preferred block could miss it."},{"file":"lib/do_profile/profilecommon.js","line":260,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"for *use* with Docker.\n\nAs the guy on the GH ticket said: this is pretty scary. Makes me want to have some kind of link there to a discussion of the issues. Perhaps in the node-triton readme? or in the sdc-docker docs on authentication. E.g. the details that you gave about a user perhaps wanting to use a separate key without-passphrase for *docker* usage. Whether that is automatic or not, some users might not think to do that (or know it is possible to have multiple keys in play)."},{"file":"lib/do_profile/profilecommon.js","line":352,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"soooo nice to see a change dropping shelling out to openssl!\n\nDo you think this\u0027ll work on Windows now?"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":7,"deletions":-2},{"file":"lib/cli.js","type":"MODIFIED","insertions":48,"deletions":-25},{"file":"lib/cloudapi2.js","type":"MODIFIED","insertions":108,"deletions":-13},{"file":"lib/do_profile/do_create.js","type":"MODIFIED","insertions":59,"deletions":-52},{"file":"lib/do_profile/profilecommon.js","type":"MODIFIED","insertions":77,"deletions":-75},{"file":"lib/tritonapi.js","type":"MODIFIED","insertions":51,"deletions":-33},{"file":"package.json","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"test/integration/api-images.test.js","type":"MODIFIED","insertions":4,"deletions":-2},{"file":"test/integration/api-instances.test.js","type":"MODIFIED","insertions":10,"deletions":-7},{"file":"test/integration/api-networks.test.js","type":"MODIFIED","insertions":12,"deletions":-10},{"file":"test/integration/api-packages.test.js","type":"MODIFIED","insertions":9,"deletions":-7}],"sizeInsertions":389,"sizeDeletions":-229}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}]}