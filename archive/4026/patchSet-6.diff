commit 627cdc3a1a573f40fe0efc0c17fabff6746479ed (refs/changes/26/4026/6)
Author: Jan Wyszynski <jan.wyszynski@joyent.com>
Date:   2018-06-07T21:13:36+00:00 (1 year, 4 months ago)
    
    joyent/pgstatsmon#13 pgstatsmon could poll pg_statio_user_tables and pg_statio_user_indexes

diff --git a/docs/overview.md b/docs/overview.md
index 61b67b2..0b26f85 100644
--- a/docs/overview.md
+++ b/docs/overview.md
@@ -126,6 +126,8 @@ backend that the stat came from (e.g. 2.moray.us-east.joyent.us-12345).
 |pg_stat_user_tables | Information about things done on a relation. This includes number of dead tuples, number of vacuum operations, table scan counts, and more | relname| |
 |pg_stat_replication | Absolute WAL positions in bytes (mostly downstream peers)| sync_state | Only works on PG 9.4+, recovering peers return little data |
 |WAL admin functions | Absolute WAL positions in bytes (local peer only) | | Data returned varies depending on whether or not the backend is in recovery |
+|pg_statio_user_tables | Information about I/O done on a table. This includes the number of buffer hits and disk block reads for the table's heap and index tuples | relname | |
+|pg_statio_user_indexes | Information about I/O done on an index. This includes the number of buffer hits and disk block reads for tuples of the index | indexrelname, relname | |
 |pg_stat_activity    | Connection counts | datname, state | |
 |pg_stat_database    | Information about given databases. This includes transaction counts, tuple counts, the time spent reading from and writing to disk, and more | datname | |
 |pg_class            | Size of relations in bytes | relname | |
diff --git a/lib/queries.js b/lib/queries.js
index 5341466..da873dd 100644
--- a/lib/queries.js
+++ b/lib/queries.js
@@ -82,6 +82,34 @@ var queries = [ {
 	{ 'attr': 'n_live_tup', 'help': 'estimated live tuples' },
 	{ 'attr': 'n_dead_tup', 'help': 'estimated dead tuples' }
     ]
+}, {
+    'name': 'pg_statio_user_tables',
+    'sql': 'SELECT * FROM pg_statio_user_tables',
+    'statkey': 'relname',
+    'metadata': [ 'relname' ],
+    'counters': [
+	{ 'attr': 'heap_blks_read',
+	    'help': 'number of disk blocks read from this table' },
+	{ 'attr': 'heap_blks_hit',
+	    'help': 'number of buffer hits in this table' },
+	{ 'attr': 'idx_blks_read',
+	    'help': 'number of disk blocks read from all indexes on this ' +
+	    'table' },
+	{ 'attr': 'idx_blks_hit',
+	    'help': 'number of disk blocks hit in all indexes on this ' +
+	    'table' }
+    ]
+}, {
+    'name': 'pg_statio_user_indexes',
+    'sql': 'SELECT * FROM pg_statio_user_indexes',
+    'statkey': 'indexrelname',
+    'metadata': [ 'indexrelname', 'relname' ],
+    'counters': [
+	{ 'attr': 'idx_blks_read',
+	    'help': 'number of disk blocks read from this index' },
+	{ 'attr': 'idx_blks_hit',
+	    'help': 'number of buffer hits in this index' }
+    ]
 }, {
     'name': 'pg_stat_replication',
     'statkey': 'application_name',
