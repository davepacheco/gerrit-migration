From d34834fe21b564cd6431cc8e539166f49c173fe9 Mon Sep 17 00:00:00 2001
From: Jan Wyszynski <jan.wyszynski@joyent.com>
Date: Wed, 30 May 2018 17:46:54 +0000
Subject: [PATCH] joyent/pgstatsmon#13 pgstatsmon could poll
 pg_statio_user_tables and pg_statio_user_indexes

---
 lib/queries.js | 43 +++++++++++++++++++++++++++++++++++++++++++
 1 file changed, 43 insertions(+)

diff --git a/lib/queries.js b/lib/queries.js
index 077978e..572acd6 100644
--- a/lib/queries.js
+++ b/lib/queries.js
@@ -82,6 +82,49 @@ var queries = [ {
 	{ 'attr': 'n_live_tup', 'help': 'estimated live tuples' },
 	{ 'attr': 'n_dead_tup', 'help': 'estimated dead tuples' }
     ]
+}, {
+    'name': 'pg_statio_user_tables',
+    'sql': [
+	'SELECT ',
+	'relname, ',
+	'heap_blks_read, ',
+	'heap_blks_hit, ',
+	'idx_blks_read, ',
+	'idx_blks_hit ',
+	'FROM pg_statio_user_tables'
+    ].join('\n'),
+    'statkey': 'relname',
+    'metadata': [ 'relname' ],
+    'counters': [
+	{ 'attr': 'heap_blks_read',
+		'help': 'number of disk blocks read from this table' },
+	{ 'attr': 'heap_blks_hit',
+		'help': 'number of buffer hits in this table' },
+	{ 'attr': 'idx_blks_read',
+		'help': 'number of disk blocks read from all indexes on this ' +
+			'table' },
+	{ 'attr': 'idx_blks_hit',
+		'help': 'number of disk blocks hit in all indexes on this ' +
+			'table' }
+    ]
+}, {
+    'name': 'pg_statio_user_indexes',
+    'sql': [
+	'SELECT ',
+	'indexrelname, ',
+	'relname, ',
+	'idx_blks_read, ',
+	'idx_blks_hit ',
+	'FROM pg_statio_user_indexes'
+    ].join('\n'),
+    'statkey': 'indexrelname',
+    'metadata': [ 'indexrelname', 'relname' ],
+    'counters': [
+	{ 'attr': 'idx_blks_read',
+		'help': 'number of disk blocks read from this index' },
+	{ 'attr': 'idx_blks_hit',
+		'help': 'number of buffer hits in this index' }
+    ]
 }, {
     'name': 'pg_stat_replication',
     'statkey': 'application_name',
-- 
2.21.0

