{"project":"joyent/sdc-headnode","branch":"master","id":"Id522372b4f1a52a59a1d33786cf2dccea07474db","number":"2741","subject":"HEAD-2368 sdc-login improvements: quoting, don\u0027t error if on target server, run command with -s Reviewed by: Julien Gilli \u003cjulien.gilli@joyent.com\u003e","owner":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"url":"https://cr.joyent.us/2741","commitMessage":"HEAD-2368 sdc-login improvements: quoting, don\u0027t error if on target server, run command with -s\nReviewed by: Julien Gilli \u003cjulien.gilli@joyent.com\u003e\n","createdOn":1507318830,"lastUpdated":1507329486,"open":false,"status":"MERGED","comments":[{"timestamp":1507318830,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Uploaded patch set 1."},{"timestamp":1507318831,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit 79348907c008e2ffa9f2a399104b1f741cbcf71d\n    \n    do it"},{"timestamp":1507318983,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1507324310,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Uploaded patch set 2."},{"timestamp":1507324312,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit 0d4c6fdfe7415a10476760e0f62b599ef29544b0\n    \n    fix quoting issues for running command on server gz when server is the current one"},{"timestamp":1507324430,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1507324985,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 2:\n\n(2 comments)"},{"timestamp":1507329428,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 2: Code-Review+1"},{"timestamp":1507329478,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Uploaded patch set 3: Commit message was updated."},{"timestamp":1507329484,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 3: Integration-Approval+1"},{"timestamp":1507329486,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Trent Mick"}],"currentPatchSet":{"number":"3","revision":"d522372b4f1a52a59a1d33786cf2dccea07474db","parents":["026f0dfd316a3631596a740b0c06435c23e419c4"],"ref":"refs/changes/41/2741/3","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1507329478,"author":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1507324430,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1507329428,"by":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1507329484,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1507329486,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"tools/bin/sdc-login","type":"MODIFIED","insertions":43,"deletions":-23}],"sizeInsertions":43,"sizeDeletions":-23},"patchSets":[{"number":"1","revision":"97b02049bb23a1861282cd416d5b04246c61f4ca","parents":["026f0dfd316a3631596a740b0c06435c23e419c4"],"ref":"refs/changes/41/2741/1","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1507318830,"author":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1507318983,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"tools/bin/sdc-login","type":"MODIFIED","insertions":34,"deletions":-23}],"sizeInsertions":34,"sizeDeletions":-23},{"number":"2","revision":"6faf940bcac670238c450ed41992f546f63396d7","parents":["026f0dfd316a3631596a740b0c06435c23e419c4"],"ref":"refs/changes/41/2741/2","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1507324310,"author":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1507324430,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1507329428,"by":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}}],"comments":[{"file":"tools/bin/sdc-login","line":227,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"This if/else block seems a bit awkward, there\u0027s a bit of duplication (especially in comments) that makes this a bit confusing.\n\nWould it be possible to write something like:\n\n# We still SSH if we are already on the target server, so that\n# `exit` consistently returns to the starting terminal session.\nssh_command\u003d\"ssh -t ${server_ip}\"\n\nif [[ -n \"$@\" ]]; then\n  # I don\u0027t know a way to `exec $*` or equivalent that handles both quoted ...\n  exec $ssh_command \"$@\"\nelse\n  exec $ssh_command\nfi\n\n?"},{"file":"tools/bin/sdc-login","line":252,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"There\u0027s no issue here with quoted/unquoted args?"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"tools/bin/sdc-login","type":"MODIFIED","insertions":43,"deletions":-23}],"sizeInsertions":43,"sizeDeletions":-23},{"number":"3","revision":"d522372b4f1a52a59a1d33786cf2dccea07474db","parents":["026f0dfd316a3631596a740b0c06435c23e419c4"],"ref":"refs/changes/41/2741/3","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1507329478,"author":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1507324430,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1507329484,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1507329486,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1507329428,"by":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"tools/bin/sdc-login","type":"MODIFIED","insertions":43,"deletions":-23}],"sizeInsertions":43,"sizeDeletions":-23}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}]}