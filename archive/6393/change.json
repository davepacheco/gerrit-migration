{"project":"joyent/sdc-headnode","branch":"master","id":"Icd0fcfe605df6efbfc51aadb19f840b4e3239bc5","number":"6393","subject":"TRITON-1651 sdc-usbkey: set-variable should enclose value in quotes Reviewed by: John Levon \u003cjohn.levon@joyent.com\u003e Reviewed by: Trent Mick \u003ctrent.mick@joyent.com\u003e Approved by: Trent Mick \u003ctrent.mick@joyent.com\u003e","owner":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"url":"https://cr.joyent.us/6393","commitMessage":"TRITON-1651 sdc-usbkey: set-variable should enclose value in quotes\nReviewed by: John Levon \u003cjohn.levon@joyent.com\u003e\nReviewed by: Trent Mick \u003ctrent.mick@joyent.com\u003e\nApproved by: Trent Mick \u003ctrent.mick@joyent.com\u003e\n","createdOn":1559687172,"lastUpdated":1559761653,"open":false,"status":"MERGED","comments":[{"timestamp":1559687172,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Uploaded patch set 1."},{"timestamp":1559687265,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1559749335,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1559751950,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Uploaded patch set 2."},{"timestamp":1559751975,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Patch Set 2:\n\n(1 comment)\n\nThanks for catching that - fixed."},{"timestamp":1559752044,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1559755630,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 2: Code-Review+1\n\nThanks for fixing this."},{"timestamp":1559757387,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1559757591,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1559758092,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1559758245,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1559759156,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Uploaded patch set 3."},{"timestamp":1559759187,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Patch Set 2:\n\nFix updated to always enclose value in quotes."},{"timestamp":1559759254,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1559759514,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 3: Code-Review+1 Integration-Approval+1"},{"timestamp":1559761233,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1559761622,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Uploaded patch set 4: Commit message was updated."},{"timestamp":1559761653,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Rob Johnston"}],"currentPatchSet":{"number":"4","revision":"cd0fcfe605df6efbfc51aadb19f840b4e3239bc5","parents":["1e0a1e095f9ba8c2376502f169fe2fcac4ca3686"],"ref":"refs/changes/93/6393/4","uploader":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"createdOn":1559761622,"author":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1559759254,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1559759514,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1559759514,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1559761233,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}},{"type":"SUBM","value":"1","grantedOn":1559761653,"by":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"tools/lib/usbkey.js","type":"MODIFIED","insertions":7,"deletions":0}],"sizeInsertions":7,"sizeDeletions":0},"patchSets":[{"number":"1","revision":"ca99e955354897ab5a72339a64ab18d26a3574dd","parents":["1e0a1e095f9ba8c2376502f169fe2fcac4ca3686"],"ref":"refs/changes/93/6393/1","uploader":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"createdOn":1559687172,"author":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1559687265,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"tools/lib/usbkey.js","line":1201,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"\"it in\""},{"file":"tools/lib/usbkey.js","line":1201,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"tools/lib/usbkey.js","type":"MODIFIED","insertions":11,"deletions":0}],"sizeInsertions":11,"sizeDeletions":0},{"number":"2","revision":"fcc3000470f6622ed05a74bcdbc0d28226c39369","parents":["1e0a1e095f9ba8c2376502f169fe2fcac4ca3686"],"ref":"refs/changes/93/6393/2","uploader":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"createdOn":1559751950,"author":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1559752044,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1559755630,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"comments":[{"file":"tools/lib/usbkey.js","line":1203,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Do we really want to quote \"only if it looks like the caller didn\u0027t already try to awkwardly quote it\"?\n\nIf someone did something like:\n\n```\nsdc-usbkey set-variable boot-args -- \"\\\"-B disable-uhci\u003dtrue\\\"\"\n```\n\nI\u0027d think the intent should be to maintain those double-quotes in the set value. ???\n\nOr if there is no good reason to have double-quotes in variable values, then perhaps error out if there is a double-quote here?\n\nBasically, the code here feels like DWIM\u0027ing (Perl-land subtle \"Do What I Mean\") that tries to guess the user\u0027s intent and handle it. I might be misunderstanding, however."},{"file":"tools/lib/usbkey.js","line":1203,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"This can be used from non-CLI contexts, where it seems much more reasonable for a consumer to have included quotes already. But I don\u0027t care too much either way."},{"file":"tools/lib/usbkey.js","line":1203,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"John,\n\nYou are saying a non-CLI consumer would call like this?\n\n```\nset_variable_loader(mountpoint, \"foo\", \u0027\"my value\"\u0027, function () { ... });\n```\n\nwith the intent that the set value be `my value` and not `\"my value\"`?   That seems weird."},{"file":"tools/lib/usbkey.js","line":1203,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"I would add that my thinking for transparently handling the \"already enclosed in quotes\" case is that in some devs have already been working around this bug by adding the quotes themselves and may continue to do so because they don\u0027t know the issue is fixed or just muscle memory.  So it seemed friendlier to just handle both cases sanely."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"tools/lib/usbkey.js","type":"MODIFIED","insertions":11,"deletions":0}],"sizeInsertions":11,"sizeDeletions":0},{"number":"3","revision":"faa8427efc55a606f38296e18bf5fb6f9043d67e","parents":["1e0a1e095f9ba8c2376502f169fe2fcac4ca3686"],"ref":"refs/changes/93/6393/3","uploader":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"createdOn":1559759156,"author":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1559759254,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1559759514,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1559759514,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1559761233,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"tools/lib/usbkey.js","type":"MODIFIED","insertions":7,"deletions":0}],"sizeInsertions":7,"sizeDeletions":0},{"number":"4","revision":"cd0fcfe605df6efbfc51aadb19f840b4e3239bc5","parents":["1e0a1e095f9ba8c2376502f169fe2fcac4ca3686"],"ref":"refs/changes/93/6393/4","uploader":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"createdOn":1559761622,"author":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1559759254,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1559759514,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1559759514,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1559761653,"by":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1559761233,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"tools/lib/usbkey.js","type":"MODIFIED","insertions":7,"deletions":0}],"sizeInsertions":7,"sizeDeletions":0}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"}]}