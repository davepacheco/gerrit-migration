{"project":"joyent/mahi","branch":"master","id":"I3ea6c9e0b9f007bb949262cf3e63f042202d252d","number":"3968","subject":"MANTA-3052 want mahi to serve allowed_dcs attributes","owner":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"url":"https://cr.joyent.us/3968","commitMessage":"MANTA-3052 want mahi to serve allowed_dcs attributes\n","createdOn":1526598241,"lastUpdated":1545087636,"open":true,"status":"NEW","comments":[{"timestamp":1526598241,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 1."},{"timestamp":1526598269,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1544838623,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 1:\n\n(3 comments)"},{"timestamp":1545086673,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 1:\n\n(3 comments)"},{"timestamp":1545087636,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 1: Code-Review+1\n\n(2 comments)"}],"currentPatchSet":{"number":"1","revision":"3ea6c9e0b9f007bb949262cf3e63f042202d252d","parents":["df99d889ba0a7593de32d1c44c1ce08ca9ae9c11"],"ref":"refs/changes/68/3968/1","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1526598241,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1526598269,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1545087636,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}}],"comments":[{"file":"lib/replicator/transforms/sdcperson.js","line":151,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"So in the case where payload[type] is undefined/NULL this makes sense. But in other cases, does it make sense for us to drive on here? What if it\u0027s a string or object?"},{"file":"lib/replicator/transforms/sdcperson.js","line":151,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"This logic (which is copy-pasted from other attributes here) is, as I understand it, important to deal with the changelog entries output by some very old versions of UFDS. Having mahi ignore these seems fine, as they\u0027re not going to be data it cares about today (practically speaking), but we need to not blow up.\n\nBasically all of this has to be pretty loosey goosey because UFDS itself is loosey goosey. If we try to be stricter than we currently are today in any one dimension on the data, I guarantee something violates it and will blow us up."},{"file":"lib/replicator/transforms/sdcperson.js","line":151,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"OK, fair enough."},{"file":"lib/replicator/transforms/sdcperson.js","line":166,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Shouldn\u0027t there be a default case that blows up or handles this gracefully?"},{"file":"lib/replicator/transforms/sdcperson.js","line":166,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"See above. Handling a default case in a way differently to how we do it today for other attributes is fraught with peril."},{"file":"lib/replicator/transforms/sdcperson.js","line":166,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"OK, fair enough."},{"file":"test/sdcperson.test.js","line":564,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"This tests the case where we\u0027re adding entries that already exist and removing ones that don\u0027t exist. Probably worth doing the case where we\u0027re adding something that doesn\u0027t exist and removing something that does?"},{"file":"test/sdcperson.test.js","line":564,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Fair, I\u0027ll add a test case."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/replicator/transforms/sdcperson.js","type":"MODIFIED","insertions":33,"deletions":-1},{"file":"test/sdcperson.test.js","type":"MODIFIED","insertions":125,"deletions":-5}],"sizeInsertions":158,"sizeDeletions":-6},"patchSets":[{"number":"1","revision":"3ea6c9e0b9f007bb949262cf3e63f042202d252d","parents":["df99d889ba0a7593de32d1c44c1ce08ca9ae9c11"],"ref":"refs/changes/68/3968/1","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1526598241,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1545087636,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1526598269,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/replicator/transforms/sdcperson.js","line":151,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"So in the case where payload[type] is undefined/NULL this makes sense. But in other cases, does it make sense for us to drive on here? What if it\u0027s a string or object?"},{"file":"lib/replicator/transforms/sdcperson.js","line":151,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"This logic (which is copy-pasted from other attributes here) is, as I understand it, important to deal with the changelog entries output by some very old versions of UFDS. Having mahi ignore these seems fine, as they\u0027re not going to be data it cares about today (practically speaking), but we need to not blow up.\n\nBasically all of this has to be pretty loosey goosey because UFDS itself is loosey goosey. If we try to be stricter than we currently are today in any one dimension on the data, I guarantee something violates it and will blow us up."},{"file":"lib/replicator/transforms/sdcperson.js","line":151,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"OK, fair enough."},{"file":"lib/replicator/transforms/sdcperson.js","line":166,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Shouldn\u0027t there be a default case that blows up or handles this gracefully?"},{"file":"lib/replicator/transforms/sdcperson.js","line":166,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"See above. Handling a default case in a way differently to how we do it today for other attributes is fraught with peril."},{"file":"lib/replicator/transforms/sdcperson.js","line":166,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"OK, fair enough."},{"file":"test/sdcperson.test.js","line":564,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"This tests the case where we\u0027re adding entries that already exist and removing ones that don\u0027t exist. Probably worth doing the case where we\u0027re adding something that doesn\u0027t exist and removing something that does?"},{"file":"test/sdcperson.test.js","line":564,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Fair, I\u0027ll add a test case."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/replicator/transforms/sdcperson.js","type":"MODIFIED","insertions":33,"deletions":-1},{"file":"test/sdcperson.test.js","type":"MODIFIED","insertions":125,"deletions":-5}],"sizeInsertions":158,"sizeDeletions":-6}],"allReviewers":[{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}]}