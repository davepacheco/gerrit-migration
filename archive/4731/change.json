{"project":"joyent/manta-muskie","branch":"master","id":"Id4fcdb93ffb465473de013b465e09f1217a89adb","number":"4731","subject":"MANTA-3875 Add metric to muskie to measure bytes deleted Reviewed by: Robert Bogart \u003crobert.bogart@joyent.com\u003e Reviewed by: Jared Morrow \u003cjm@joyent.com\u003e Approved by: Robert Bogart \u003crobert.bogart@joyent.com\u003e","owner":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"url":"https://cr.joyent.us/4731","commitMessage":"MANTA-3875 Add metric to muskie to measure bytes deleted\nReviewed by: Robert Bogart \u003crobert.bogart@joyent.com\u003e\nReviewed by: Jared Morrow \u003cjm@joyent.com\u003e\nApproved by: Robert Bogart \u003crobert.bogart@joyent.com\u003e\n","createdOn":1534893580,"lastUpdated":1534978105,"open":false,"status":"MERGED","comments":[{"timestamp":1534893580,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Uploaded patch set 1."},{"timestamp":1534897964,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Patch Set 1:\n\n(2 comments)\n\nOverall, looks pretty reasonable to me.  I just had a couple of questions."},{"timestamp":1534958658,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Patch Set 1:\n\n(2 comments)"},{"timestamp":1534960549,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Uploaded patch set 2."},{"timestamp":1534961310,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Patch Set 2: Code-Review+1 Integration-Approval+1\n\nLooks good to me.  I think that the comment that you added is really insightful and will give future readers a lot of context.  I reviewed your test notes in the ticket as well and it looks good to me."},{"timestamp":1534975349,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"Patch Set 2: Code-Review+1"},{"timestamp":1534977993,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Patch Set 3: Commit message was updated."},{"timestamp":1534978105,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Jan Wyszynski"}],"currentPatchSet":{"number":"3","revision":"5d8e5ac82348f2e607d55b5fc64cec96963b05e2","parents":["7f91509e793e429fac3c7bc5280ee5a522238b71"],"ref":"refs/changes/31/4731/3","uploader":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"createdOn":1534977993,"author":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1534961310,"by":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1534961310,"by":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1534975349,"by":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"}},{"type":"SUBM","value":"1","grantedOn":1534978105,"by":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"lib/audit.js","type":"MODIFIED","insertions":28,"deletions":0},{"file":"lib/common.js","type":"MODIFIED","insertions":3,"deletions":0},{"file":"lib/server.js","type":"MODIFIED","insertions":4,"deletions":0}],"sizeInsertions":35,"sizeDeletions":0},"patchSets":[{"number":"1","revision":"8847933e342e297ad11cdfa04eb4d01431c47fb8","parents":["7f91509e793e429fac3c7bc5280ee5a522238b71"],"ref":"refs/changes/31/4731/1","uploader":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"createdOn":1534893580,"author":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"isDraft":false,"kind":"REWORK","comments":[{"file":"lib/audit.js","line":307,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"This is more of a question than anything, but would it be worth tracking all delete operations as opposed to just those from snaplink-disabled callers and differentiating between the two with an additional label?\n\nOn the other hand, if that\u0027s really not necessary, I think it would be helpful to add a comment indicating why we are specifically tracking these kind of deletes."},{"file":"lib/audit.js","line":307,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"There isn\u0027t really a good reason other than to limit the effect of this change on requests that will be involved in the SCloud deletion. I think we\u0027d want to avoid a change that affects things like log uploads and other routine operations kicked off by the posiedon user. \n\nAnother reason is that each new metric adds memory overhead to the webapi zones (we have a lot of them in production). I think it\u0027s better to minimize the introduction of new metrics for that reason. \n\nI will add the comment!"},{"file":"lib/audit.js","line":311,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"How many different possible values could this be?"},{"file":"lib/audit.js","line":311,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"It should only be \u0027scloud.prd\u0027 in production. Though it could be any account for which snaplinks have been disabled if we decide to use it for more account in other environments."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/audit.js","type":"MODIFIED","insertions":18,"deletions":0},{"file":"lib/common.js","type":"MODIFIED","insertions":3,"deletions":0},{"file":"lib/server.js","type":"MODIFIED","insertions":4,"deletions":0}],"sizeInsertions":25,"sizeDeletions":0},{"number":"2","revision":"d4fcdb93ffb465473de013b465e09f1217a89adb","parents":["7f91509e793e429fac3c7bc5280ee5a522238b71"],"ref":"refs/changes/31/4731/2","uploader":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"createdOn":1534960549,"author":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1534975349,"by":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1534961310,"by":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1534961310,"by":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/audit.js","type":"MODIFIED","insertions":28,"deletions":0},{"file":"lib/common.js","type":"MODIFIED","insertions":3,"deletions":0},{"file":"lib/server.js","type":"MODIFIED","insertions":4,"deletions":0}],"sizeInsertions":35,"sizeDeletions":0},{"number":"3","revision":"5d8e5ac82348f2e607d55b5fc64cec96963b05e2","parents":["7f91509e793e429fac3c7bc5280ee5a522238b71"],"ref":"refs/changes/31/4731/3","uploader":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"createdOn":1534977993,"author":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1534975349,"by":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"}},{"type":"SUBM","value":"1","grantedOn":1534978105,"by":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1534961310,"by":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1534961310,"by":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"lib/audit.js","type":"MODIFIED","insertions":28,"deletions":0},{"file":"lib/common.js","type":"MODIFIED","insertions":3,"deletions":0},{"file":"lib/server.js","type":"MODIFIED","insertions":4,"deletions":0}],"sizeInsertions":35,"sizeDeletions":0}],"allReviewers":[{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"}]}