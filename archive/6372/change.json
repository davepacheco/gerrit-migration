{"project":"joyent/sdc-firewaller-agent","branch":"master","id":"I2f4fd52dd23dd219206120621fb170f574904246","number":"6372","subject":"TRITON-1320 firewaller-agent needs to rewrite ipf rules on boot Reviewed by: Cody Peter Mello \u003cmelloc@writev.io\u003e Reviewed by: Mike Gerdts \u003cmike.gerdts@joyent.com\u003e Approved by: Mike Gerdts \u003cmike.gerdts@joyent.com\u003e","owner":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"url":"https://cr.joyent.us/6372","commitMessage":"TRITON-1320 firewaller-agent needs to rewrite ipf rules on boot\nReviewed by: Cody Peter Mello \u003cmelloc@writev.io\u003e\nReviewed by: Mike Gerdts \u003cmike.gerdts@joyent.com\u003e\nApproved by: Mike Gerdts \u003cmike.gerdts@joyent.com\u003e\n","createdOn":1559227878,"lastUpdated":1560194351,"open":false,"status":"MERGED","comments":[{"timestamp":1559227878,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 1."},{"timestamp":1559227883,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit 4a3c7e5855f1665b0402e6ca2394ff7b7741cefc\n    \n    TRITON-1320 firewaller-agent needs to rewrite ipf rules on boot"},{"timestamp":1559227932,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1559228042,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 2: Patch Set 1 was rebased."},{"timestamp":1559228047,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit ce0929fce5c24e8ec042206645472a7dc40ec78b\n    \n    TRITON-1320 firewaller-agent needs to rewrite ipf rules on boot"},{"timestamp":1559228089,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2:\n\n\"make check\" passed ok"},{"timestamp":1559228309,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 2:\n\n(1 comment)\n\nLeft minor note for Mike regarding current differences between this repo\u0027s fw and smartos-live version.\n\nAnd we should definitely do something about this \"copy and paste\" modules thing ..."},{"timestamp":1559231133,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 2:\n\n(7 comments)"},{"timestamp":1559239735,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 2:\n\n(14 comments)"},{"timestamp":1559299386,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 3."},{"timestamp":1559299391,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 3:\n\nNew commits:\n    \n    commit 306ea4f9e89fc89ba87f4c10eb632b73e8492fbe\n    \n    TRITON-1320 firewaller-agent needs to rewrite ipf rules on boot"},{"timestamp":1559299432,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1559299457,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 2:\n\n(19 comments)\n\nOk, done everything but reading from ` /etc/ipf/smartos_version`. I\u0027ll follow up with Mike about this later."},{"timestamp":1559556300,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 4."},{"timestamp":1559556305,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 4:\n\nNew commits:\n    \n    commit d122f890c582b75263f6cdbcd4270e8e940e8122\n    \n    Updated SmartOS IPF version check"},{"timestamp":1559556351,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1559557989,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 5."},{"timestamp":1559557994,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 5:\n\nNew commits:\n    \n    commit a254591f3a31d8a4964b39a23e6dec649226a5f8\n    \n    Updated SmartOS IPF version check\n    \n    commit 306ea4f9e89fc89ba87f4c10eb632b73e8492fbe\n    \n    TRITON-1320 firewaller-agent needs to rewrite ipf rules on boot"},{"timestamp":1559558035,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1559570731,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 5:\n\n(1 comment)"},{"timestamp":1559583345,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 6."},{"timestamp":1559583350,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 6:\n\nNew commits:\n    \n    commit a045da5f474eb129522bf13260a1a5d06b09cec7\n    \n    Updated SmartOS IPF version check\n    \n    commit 306ea4f9e89fc89ba87f4c10eb632b73e8492fbe\n    \n    TRITON-1320 firewaller-agent needs to rewrite ipf rules on boot"},{"timestamp":1559583383,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 5:\n\n(1 comment)\n\n\u003e (1 comment)\n\nResync done, including some minor style changes."},{"timestamp":1559583394,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 6: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1559638344,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 7."},{"timestamp":1559638349,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 7:\n\nNew commits:\n    \n    commit 046f29a01a22a08190f681ca50a4c56ad06757fe\n    \n    Resync + add fs.existsSync method to fw mocks"},{"timestamp":1559638392,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 7: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1559642724,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 8."},{"timestamp":1559642729,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 8:\n\nNew commits:\n    \n    commit 7b0c2a3b786723359c5b1f6f0003bbd5c349322b\n    \n    fwrule file pending to be sync from smartos-live"},{"timestamp":1559642771,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 8: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1559648447,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 9."},{"timestamp":1559648452,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 9:\n\nNew commits:\n    \n    commit 184fc8e2be06892e0553b50305b86563c5f626eb\n    \n    Sync fwadm unit tests fixed"},{"timestamp":1559648497,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 9: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1559670031,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 9:\n\n(12 comments)"},{"timestamp":1559746107,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 10."},{"timestamp":1559746112,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 10:\n\nNew commits:\n    \n    commit 34a698315b92844e7f27505e5597fc2ca0891b12\n    \n    Sync fwadm unit tests fixed\n    \n    commit 7b0c2a3b786723359c5b1f6f0003bbd5c349322b\n    \n    fwrule file pending to be sync from smartos-live\n    \n    commit 046f29a01a22a08190f681ca50a4c56ad06757fe\n    \n    Resync + add fs.existsSync method to fw mocks\n    \n    commit a045da5f474eb129522bf13260a1a5d06b09cec7\n    \n    Updated SmartOS IPF version check\n    \n    commit 306ea4f9e89fc89ba87f4c10eb632b73e8492fbe\n    \n    TRITON-1320 firewaller-agent needs to rewrite ipf rules on boot"},{"timestamp":1559746159,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 10: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1559746493,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 9:\n\n(8 comments)\n\nDone with the suggested changes Mike (with the notable exception of modifying `deps/fw/node_modules/fwrule` before we dig further into a possible way of how to handle all this code duplication properly, even if that means checking in dependencies into our own git repo)"},{"timestamp":1559749939,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 10:\n\nThere are trivial differences in rule.js between this repo and sdc-fwrule.  The two files should be in sync now so that it is not the beginning of more significant divergence.\n\nWe can get to submodules or some other better solution in the future."},{"timestamp":1559760165,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 11."},{"timestamp":1559760170,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 11:\n\nNew commits:\n    \n    commit f942aa2e002b6af1a3fec18d5d83e30cf9fc8595\n    \n    Sync fwadm unit tests fixed\n    \n    commit 7b0c2a3b786723359c5b1f6f0003bbd5c349322b\n    \n    fwrule file pending to be sync from smartos-live\n    \n    commit 046f29a01a22a08190f681ca50a4c56ad06757fe\n    \n    Resync + add fs.existsSync method to fw mocks\n    \n    commit a045da5f474eb129522bf13260a1a5d06b09cec7\n    \n    Updated SmartOS IPF version check\n    \n    commit 306ea4f9e89fc89ba87f4c10eb632b73e8492fbe\n    \n    TRITON-1320 firewaller-agent needs to rewrite ipf rules on boot"},{"timestamp":1559760188,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 11:\n\nFile re-synced"},{"timestamp":1559760214,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 11: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1559771949,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 11: Code-Review+1"},{"timestamp":1559902448,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 12."},{"timestamp":1559902453,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 12:\n\nNew commits:\n    \n    commit dc66a5129dea0769b80e95e67208aa2c8547580b\n    \n    Synced new log test from smartos-live"},{"timestamp":1559902499,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 12: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1559902669,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 12:\n\nNew test file synced from smartos-live too."},{"timestamp":1560187738,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 12: Code-Review+1"},{"timestamp":1560187811,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 13: Commit message was updated."},{"timestamp":1560193320,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 13: Code-Review+1"},{"timestamp":1560194173,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 13: Integration-Approval+1"},{"timestamp":1560194333,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 14: Commit message was updated."},{"timestamp":1560194351,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Pedro Palazón Candel"}],"currentPatchSet":{"number":"14","revision":"2f4fd52dd23dd219206120621fb170f574904246","parents":["243a3904cfa6f473d52005d5cdf7cba0682adc5d"],"ref":"refs/changes/72/6372/14","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1560194333,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1559902499,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1560187738,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1560193320,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1560194173,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}},{"type":"SUBM","value":"1","grantedOn":1560194351,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"config-migration.js","type":"ADDED","insertions":192,"deletions":0},{"file":"deps/fw/lib/fw.js","type":"MODIFIED","insertions":41,"deletions":-17},{"file":"deps/fw/node_modules/fwrule/rule.js","type":"MODIFIED","insertions":15,"deletions":-1},{"file":"deps/fw/test/lib/mocks.js","type":"MODIFIED","insertions":9,"deletions":-14},{"file":"deps/fw/test/unit/add.test.js","type":"MODIFIED","insertions":6,"deletions":-7},{"file":"deps/fw/test/unit/fw.test.js","type":"MODIFIED","insertions":95,"deletions":-108},{"file":"deps/fw/test/unit/global.test.js","type":"MODIFIED","insertions":2,"deletions":-10},{"file":"deps/fw/test/unit/icmp.test.js","type":"MODIFIED","insertions":4,"deletions":-8},{"file":"deps/fw/test/unit/log.test.js","type":"ADDED","insertions":298,"deletions":0},{"file":"deps/fw/test/unit/owner.test.js","type":"MODIFIED","insertions":5,"deletions":-4},{"file":"deps/fw/test/unit/tags.test.js","type":"MODIFIED","insertions":5,"deletions":-3},{"file":"deps/fw/test/unit/update.test.js","type":"MODIFIED","insertions":7,"deletions":-6},{"file":"deps/fw/test/unit/wildcards.test.js","type":"MODIFIED","insertions":6,"deletions":-8},{"file":"npm/postinstall.sh","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"npm/postuninstall.sh","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"smf/manifests/firewaller-config-migration.xml.in","type":"ADDED","insertions":57,"deletions":0}],"sizeInsertions":756,"sizeDeletions":-188},"patchSets":[{"number":"1","revision":"ff8d69e0eabd81670702f03844d6192886898f75","parents":["6e0cf5dd3a36e4a36790bdf202a2a8ad6da9ef50"],"ref":"refs/changes/72/6372/1","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1559227878,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1559227932,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"config-migration.js","line":28,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"How about \"firewaller-config-migration\"?"},{"file":"config-migration.js","line":28,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"config-migration.js","line":47,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"We can construct \"ctx.vmsByVmUUID\" here and avoid the repeated calls to .filter() below by doing:\n\n    ctx.vmsByVmUUID \u003d {};\n    ctx.vms.forEach(function (vm) {\n        ctx.vmsByVmUUID[vm.uuid] \u003d vm;\n    });"},{"file":"config-migration.js","line":47,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"config-migration.js","line":87,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Can you make this an explicit comparison to 0?\n\n    if (ctx.rules.length \u003d\u003d\u003d 0) {"},{"file":"config-migration.js","line":87,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"config-migration.js","line":139,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Reuse \"vmsToCheck\" here."},{"file":"config-migration.js","line":139,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Good call. I added the log and the verification that there was something to check after and forgot to make use of it. Thanks!"},{"file":"config-migration.js","line":171,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Can you change this to:\n\n    if (!Array.isArray(ctx.vmsToRewriteIPF) || ctx.vmsToRewriteIPF.length \u003d\u003d\u003d 0) {"},{"file":"config-migration.js","line":171,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"config-migration.js","line":184,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"This and elsewhere should be \"haveDevIpfEv\""},{"file":"config-migration.js","line":184,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"config-migration.js","type":"ADDED","insertions":193,"deletions":0},{"file":"deps/fw/lib/fw.js","type":"MODIFIED","insertions":40,"deletions":-8},{"file":"npm/postinstall.sh","type":"MODIFIED","insertions":7,"deletions":0},{"file":"npm/postuninstall.sh","type":"MODIFIED","insertions":6,"deletions":0},{"file":"smf/manifests/firewaller-config-migration.xml.in","type":"ADDED","insertions":69,"deletions":0}],"sizeInsertions":315,"sizeDeletions":-8},{"number":"2","revision":"51f5d7cc51b3ef1c41196ab9dedfb298efd2b4f9","parents":["243a3904cfa6f473d52005d5cdf7cba0682adc5d"],"ref":"refs/changes/72/6372/2","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1559228042,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1559227932,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"config-migration.js","line":72,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"in"},{"file":"config-migration.js","line":72,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"config-migration.js","line":79,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"If the rule has logging enabled, it should still log even if rule.uuid is not set.  In this case, it will log the nil-uuid."},{"file":"config-migration.js","line":79,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Ok, changed"},{"file":"config-migration.js","line":83,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"don\u0027t"},{"file":"config-migration.js","line":83,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"config-migration.js","line":147,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"This shouldn\u0027t be checking for version 2, it should be checking to see if the version in this ipf*.conf file matches the version in some file that is delivered with the PI.  As we discussed in mattermost:\n\n\u003e then, in smartos-live/overlay/generic/etc/ipf/smartos_version we could specify the version as 2.  The SMF method script would read /etc/ipf/smartos_version to see which version the PI supports.  If it doesn\u0027t find that file, then it knows that it supports the version before cfw logging.\n\nIn any case where the version doesn\u0027t match (unknown version, too old, too new), we should have the fw code on the platform regenerate the file."},{"file":"config-migration.js","line":147,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done with IPF version checking using the Platform Image file. I\u0027m gonna add it to SmartOS Live repo\u0027s rfd 163 branch."},{"file":"deps/fw/lib/fw.js","line":1286,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Mike, note this is different from what we already have into smartos-live\u0027s 163 branch, and would need to re-sync there."},{"file":"deps/fw/lib/fw.js","line":1286,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"I agree."},{"file":"deps/fw/lib/fw.js","line":1291,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"I don\u0027t think that we need to assert on this here, since it\u0027s always going to be set above. We should just make sure that there are new fwadm unit tests to verify having/not having tags."},{"file":"deps/fw/lib/fw.js","line":1291,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Ok, let\u0027s make sure we have some tests there."},{"file":"npm/postinstall.sh","line":9,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"update for current format"},{"file":"npm/postinstall.sh","line":9,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"npm/postinstall.sh","line":68,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"maybe get rid of one of the newlines"},{"file":"npm/postinstall.sh","line":68,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"npm/postuninstall.sh","line":9,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"update for current format"},{"file":"npm/postuninstall.sh","line":9,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"smf/manifests/firewaller-config-migration.xml.in","line":14,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"config migration\n\nAlso, this would be a swell place to explain why this is needed."},{"file":"smf/manifests/firewaller-config-migration.xml.in","line":14,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"smf/manifests/firewaller-config-migration.xml.in","line":16,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"The indentation is inconsistent.  Maybe `xmllint --format`?"},{"file":"smf/manifests/firewaller-config-migration.xml.in","line":16,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"smf/manifests/firewaller-config-migration.xml.in","line":23,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Since grouping\u003d*all and restart_on/type match for both of these dependencies, these two lines can be deleted - both services can go in one dependency element."},{"file":"smf/manifests/firewaller-config-migration.xml.in","line":23,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"It\u0027s the first time somebody with proper knowledge of SMF manifests review my stuff. It even has sense!"},{"file":"smf/manifests/firewaller-config-migration.xml.in","line":27,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"\"dependent\" seems to be poorly understood by many developers.  Maybe add a comment to the effect of \"Make vmadmd and zones services depend on this service so that firewall rules are correct before those services cause them to be read.\""},{"file":"smf/manifests/firewaller-config-migration.xml.in","line":27,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"smf/manifests/firewaller-config-migration.xml.in","line":30,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"same as above"},{"file":"smf/manifests/firewaller-config-migration.xml.in","line":30,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"smf/manifests/firewaller-config-migration.xml.in","line":65,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Config Migration"},{"file":"smf/manifests/firewaller-config-migration.xml.in","line":65,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"config-migration.js","type":"ADDED","insertions":193,"deletions":0},{"file":"deps/fw/lib/fw.js","type":"MODIFIED","insertions":40,"deletions":-8},{"file":"npm/postinstall.sh","type":"MODIFIED","insertions":7,"deletions":0},{"file":"npm/postuninstall.sh","type":"MODIFIED","insertions":6,"deletions":0},{"file":"smf/manifests/firewaller-config-migration.xml.in","type":"ADDED","insertions":69,"deletions":0}],"sizeInsertions":315,"sizeDeletions":-8},{"number":"3","revision":"96c8126859e44153f89865121fc346f1bf815917","parents":["243a3904cfa6f473d52005d5cdf7cba0682adc5d"],"ref":"refs/changes/72/6372/3","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1559299386,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1559299432,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"config-migration.js","type":"ADDED","insertions":191,"deletions":0},{"file":"deps/fw/lib/fw.js","type":"MODIFIED","insertions":40,"deletions":-8},{"file":"npm/postinstall.sh","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"npm/postuninstall.sh","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"smf/manifests/firewaller-config-migration.xml.in","type":"ADDED","insertions":57,"deletions":0}],"sizeInsertions":302,"sizeDeletions":-10},{"number":"4","revision":"88c33d5792394cf0fd0f3cab4e64dca0874df6c7","parents":["243a3904cfa6f473d52005d5cdf7cba0682adc5d"],"ref":"refs/changes/72/6372/4","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1559556300,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1559556351,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"config-migration.js","type":"ADDED","insertions":192,"deletions":0},{"file":"deps/fw/lib/fw.js","type":"MODIFIED","insertions":40,"deletions":-8},{"file":"npm/postinstall.sh","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"npm/postuninstall.sh","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"smf/manifests/firewaller-config-migration.xml.in","type":"ADDED","insertions":57,"deletions":0}],"sizeInsertions":303,"sizeDeletions":-10},{"number":"5","revision":"60f11b60c4b48e6d93c298e91798c1d3e2e52494","parents":["243a3904cfa6f473d52005d5cdf7cba0682adc5d"],"ref":"refs/changes/72/6372/5","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1559557989,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1559558035,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"deps/fw/lib/fw.js","line":14,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"This file should be in sync with src/fw/lib/fw.js from smartos-live\u0027s rfd163 branch.\n\nMaybe now is the time to to create node-fwadm from smartos-live/src/fw and add it as a submodule to smartos-live and sdc-firewaller-agent."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"config-migration.js","type":"ADDED","insertions":192,"deletions":0},{"file":"deps/fw/lib/fw.js","type":"MODIFIED","insertions":40,"deletions":-9},{"file":"npm/postinstall.sh","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"npm/postuninstall.sh","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"smf/manifests/firewaller-config-migration.xml.in","type":"ADDED","insertions":57,"deletions":0}],"sizeInsertions":303,"sizeDeletions":-11},{"number":"6","revision":"f1425729e4bfef1ffd17639b8517fe2b1a94e845","parents":["243a3904cfa6f473d52005d5cdf7cba0682adc5d"],"ref":"refs/changes/72/6372/6","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1559583345,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1559583394,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"config-migration.js","type":"ADDED","insertions":192,"deletions":0},{"file":"deps/fw/lib/fw.js","type":"MODIFIED","insertions":86,"deletions":-62},{"file":"npm/postinstall.sh","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"npm/postuninstall.sh","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"smf/manifests/firewaller-config-migration.xml.in","type":"ADDED","insertions":57,"deletions":0}],"sizeInsertions":349,"sizeDeletions":-64},{"number":"7","revision":"38245658ff23d2628b3376ac7e341859fef689a6","parents":["243a3904cfa6f473d52005d5cdf7cba0682adc5d"],"ref":"refs/changes/72/6372/7","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1559638344,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1559638392,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"config-migration.js","type":"ADDED","insertions":192,"deletions":0},{"file":"deps/fw/lib/fw.js","type":"MODIFIED","insertions":41,"deletions":-17},{"file":"deps/fw/test/lib/mocks.js","type":"MODIFIED","insertions":13,"deletions":-2},{"file":"npm/postinstall.sh","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"npm/postuninstall.sh","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"smf/manifests/firewaller-config-migration.xml.in","type":"ADDED","insertions":57,"deletions":0}],"sizeInsertions":317,"sizeDeletions":-21},{"number":"8","revision":"2c9ee1906c0c36f01fc27b248f08be841cbd3301","parents":["243a3904cfa6f473d52005d5cdf7cba0682adc5d"],"ref":"refs/changes/72/6372/8","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1559642724,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1559642771,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"config-migration.js","type":"ADDED","insertions":192,"deletions":0},{"file":"deps/fw/lib/fw.js","type":"MODIFIED","insertions":41,"deletions":-17},{"file":"deps/fw/node_modules/fwrule/rule.js","type":"MODIFIED","insertions":16,"deletions":-3},{"file":"deps/fw/test/lib/mocks.js","type":"MODIFIED","insertions":13,"deletions":-2},{"file":"npm/postinstall.sh","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"npm/postuninstall.sh","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"smf/manifests/firewaller-config-migration.xml.in","type":"ADDED","insertions":57,"deletions":0}],"sizeInsertions":333,"sizeDeletions":-24},{"number":"9","revision":"4cec151d9b6e6e8e0cee40b0ff6e52b65465c492","parents":["243a3904cfa6f473d52005d5cdf7cba0682adc5d"],"ref":"refs/changes/72/6372/9","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1559648447,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1559648497,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"deps/fw/node_modules/fwrule/rule.js","line":1,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"This seems as though it should be the same as lib/rule.js from the sdc-fwrule repo.\n\nSubmodule would be nice..."},{"file":"deps/fw/node_modules/fwrule/rule.js","line":1,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Yeah, the problem so far is that we\u0027re trying to sync deps/fw to be exactly the contents of \"src/fw\" in smartos-live. Definitely worth giving this whole thing a pass and try to come up with something more reasonable for the future ..."},{"file":"deps/fw/test/lib/mocks.js","line":2,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Copyright 2019 Joyent, Inc."},{"file":"deps/fw/test/lib/mocks.js","line":2,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"deps/fw/test/lib/mocks.js","line":250,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"could be simplified to\n\n    return hasKey(root, p.dir) \u0026\u0026 hasKey(root[p.dir], p.file);"},{"file":"deps/fw/test/lib/mocks.js","line":250,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"deps/fw/test/unit/add.test.js","line":2,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Copyright 2019 Joyent, Inc."},{"file":"deps/fw/test/unit/add.test.js","line":2,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"deps/fw/test/unit/add.test.js","line":173,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"consistent style would be nice. FWIW, I prefer the way it\u0027s done on 87 - 88."},{"file":"deps/fw/test/unit/add.test.js","line":173,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"deps/fw/test/unit/fw.test.js","line":23,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Copyright 2019 Joyent, Inc."},{"file":"deps/fw/test/unit/fw.test.js","line":23,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"deps/fw/test/unit/global.test.js","line":2,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Copyright 2019 Joyent, Inc."},{"file":"deps/fw/test/unit/global.test.js","line":2,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"deps/fw/test/unit/icmp.test.js","line":23,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Copyright 2019 Joyent, Inc."},{"file":"deps/fw/test/unit/icmp.test.js","line":23,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"deps/fw/test/unit/owner.test.js","line":23,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Copyright 2019 Joyent, Inc."},{"file":"deps/fw/test/unit/tags.test.js","line":23,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Copyright 2019 Joyent, Inc."},{"file":"deps/fw/test/unit/update.test.js","line":23,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Copyright 2019 Joyent, Inc."},{"file":"deps/fw/test/unit/wildcards.test.js","line":23,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Copyright 2019 Joyent, Inc."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"config-migration.js","type":"ADDED","insertions":192,"deletions":0},{"file":"deps/fw/lib/fw.js","type":"MODIFIED","insertions":41,"deletions":-17},{"file":"deps/fw/node_modules/fwrule/rule.js","type":"MODIFIED","insertions":16,"deletions":-3},{"file":"deps/fw/test/lib/mocks.js","type":"MODIFIED","insertions":13,"deletions":-2},{"file":"deps/fw/test/unit/add.test.js","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"deps/fw/test/unit/fw.test.js","type":"MODIFIED","insertions":95,"deletions":-108},{"file":"deps/fw/test/unit/global.test.js","type":"MODIFIED","insertions":2,"deletions":-9},{"file":"deps/fw/test/unit/icmp.test.js","type":"MODIFIED","insertions":4,"deletions":-8},{"file":"deps/fw/test/unit/owner.test.js","type":"MODIFIED","insertions":5,"deletions":-3},{"file":"deps/fw/test/unit/tags.test.js","type":"MODIFIED","insertions":5,"deletions":-3},{"file":"deps/fw/test/unit/update.test.js","type":"MODIFIED","insertions":7,"deletions":-5},{"file":"deps/fw/test/unit/wildcards.test.js","type":"MODIFIED","insertions":6,"deletions":-7},{"file":"npm/postinstall.sh","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"npm/postuninstall.sh","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"smf/manifests/firewaller-config-migration.xml.in","type":"ADDED","insertions":57,"deletions":0}],"sizeInsertions":462,"sizeDeletions":-168},{"number":"10","revision":"7bc8a8c22d75c14e76524f92e0b5f5693c1ba3b7","parents":["243a3904cfa6f473d52005d5cdf7cba0682adc5d"],"ref":"refs/changes/72/6372/10","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1559746107,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1559746159,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"config-migration.js","type":"ADDED","insertions":192,"deletions":0},{"file":"deps/fw/lib/fw.js","type":"MODIFIED","insertions":41,"deletions":-17},{"file":"deps/fw/node_modules/fwrule/rule.js","type":"MODIFIED","insertions":16,"deletions":-3},{"file":"deps/fw/test/lib/mocks.js","type":"MODIFIED","insertions":9,"deletions":-14},{"file":"deps/fw/test/unit/add.test.js","type":"MODIFIED","insertions":6,"deletions":-7},{"file":"deps/fw/test/unit/fw.test.js","type":"MODIFIED","insertions":95,"deletions":-108},{"file":"deps/fw/test/unit/global.test.js","type":"MODIFIED","insertions":2,"deletions":-10},{"file":"deps/fw/test/unit/icmp.test.js","type":"MODIFIED","insertions":4,"deletions":-8},{"file":"deps/fw/test/unit/owner.test.js","type":"MODIFIED","insertions":5,"deletions":-4},{"file":"deps/fw/test/unit/tags.test.js","type":"MODIFIED","insertions":5,"deletions":-3},{"file":"deps/fw/test/unit/update.test.js","type":"MODIFIED","insertions":7,"deletions":-6},{"file":"deps/fw/test/unit/wildcards.test.js","type":"MODIFIED","insertions":6,"deletions":-8},{"file":"npm/postinstall.sh","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"npm/postuninstall.sh","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"smf/manifests/firewaller-config-migration.xml.in","type":"ADDED","insertions":57,"deletions":0}],"sizeInsertions":459,"sizeDeletions":-190},{"number":"11","revision":"5dcb22e90b21b7eac9e797011e3b16e76a9d9e0c","parents":["243a3904cfa6f473d52005d5cdf7cba0682adc5d"],"ref":"refs/changes/72/6372/11","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1559760165,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1559760214,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1559771949,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"config-migration.js","type":"ADDED","insertions":192,"deletions":0},{"file":"deps/fw/lib/fw.js","type":"MODIFIED","insertions":41,"deletions":-17},{"file":"deps/fw/node_modules/fwrule/rule.js","type":"MODIFIED","insertions":15,"deletions":-1},{"file":"deps/fw/test/lib/mocks.js","type":"MODIFIED","insertions":9,"deletions":-14},{"file":"deps/fw/test/unit/add.test.js","type":"MODIFIED","insertions":6,"deletions":-7},{"file":"deps/fw/test/unit/fw.test.js","type":"MODIFIED","insertions":95,"deletions":-108},{"file":"deps/fw/test/unit/global.test.js","type":"MODIFIED","insertions":2,"deletions":-10},{"file":"deps/fw/test/unit/icmp.test.js","type":"MODIFIED","insertions":4,"deletions":-8},{"file":"deps/fw/test/unit/owner.test.js","type":"MODIFIED","insertions":5,"deletions":-4},{"file":"deps/fw/test/unit/tags.test.js","type":"MODIFIED","insertions":5,"deletions":-3},{"file":"deps/fw/test/unit/update.test.js","type":"MODIFIED","insertions":7,"deletions":-6},{"file":"deps/fw/test/unit/wildcards.test.js","type":"MODIFIED","insertions":6,"deletions":-8},{"file":"npm/postinstall.sh","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"npm/postuninstall.sh","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"smf/manifests/firewaller-config-migration.xml.in","type":"ADDED","insertions":57,"deletions":0}],"sizeInsertions":458,"sizeDeletions":-188},{"number":"12","revision":"b3fac9c8032d833e17fc4603c9d9654a1401aa5b","parents":["243a3904cfa6f473d52005d5cdf7cba0682adc5d"],"ref":"refs/changes/72/6372/12","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1559902448,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1560187738,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1559902499,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"config-migration.js","type":"ADDED","insertions":192,"deletions":0},{"file":"deps/fw/lib/fw.js","type":"MODIFIED","insertions":41,"deletions":-17},{"file":"deps/fw/node_modules/fwrule/rule.js","type":"MODIFIED","insertions":15,"deletions":-1},{"file":"deps/fw/test/lib/mocks.js","type":"MODIFIED","insertions":9,"deletions":-14},{"file":"deps/fw/test/unit/add.test.js","type":"MODIFIED","insertions":6,"deletions":-7},{"file":"deps/fw/test/unit/fw.test.js","type":"MODIFIED","insertions":95,"deletions":-108},{"file":"deps/fw/test/unit/global.test.js","type":"MODIFIED","insertions":2,"deletions":-10},{"file":"deps/fw/test/unit/icmp.test.js","type":"MODIFIED","insertions":4,"deletions":-8},{"file":"deps/fw/test/unit/log.test.js","type":"ADDED","insertions":298,"deletions":0},{"file":"deps/fw/test/unit/owner.test.js","type":"MODIFIED","insertions":5,"deletions":-4},{"file":"deps/fw/test/unit/tags.test.js","type":"MODIFIED","insertions":5,"deletions":-3},{"file":"deps/fw/test/unit/update.test.js","type":"MODIFIED","insertions":7,"deletions":-6},{"file":"deps/fw/test/unit/wildcards.test.js","type":"MODIFIED","insertions":6,"deletions":-8},{"file":"npm/postinstall.sh","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"npm/postuninstall.sh","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"smf/manifests/firewaller-config-migration.xml.in","type":"ADDED","insertions":57,"deletions":0}],"sizeInsertions":756,"sizeDeletions":-188},{"number":"13","revision":"409fa94f1af97e46483779e0843844c216ae1f7c","parents":["243a3904cfa6f473d52005d5cdf7cba0682adc5d"],"ref":"refs/changes/72/6372/13","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1560187811,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1560187738,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1559902499,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1560193320,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1560194173,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"config-migration.js","type":"ADDED","insertions":192,"deletions":0},{"file":"deps/fw/lib/fw.js","type":"MODIFIED","insertions":41,"deletions":-17},{"file":"deps/fw/node_modules/fwrule/rule.js","type":"MODIFIED","insertions":15,"deletions":-1},{"file":"deps/fw/test/lib/mocks.js","type":"MODIFIED","insertions":9,"deletions":-14},{"file":"deps/fw/test/unit/add.test.js","type":"MODIFIED","insertions":6,"deletions":-7},{"file":"deps/fw/test/unit/fw.test.js","type":"MODIFIED","insertions":95,"deletions":-108},{"file":"deps/fw/test/unit/global.test.js","type":"MODIFIED","insertions":2,"deletions":-10},{"file":"deps/fw/test/unit/icmp.test.js","type":"MODIFIED","insertions":4,"deletions":-8},{"file":"deps/fw/test/unit/log.test.js","type":"ADDED","insertions":298,"deletions":0},{"file":"deps/fw/test/unit/owner.test.js","type":"MODIFIED","insertions":5,"deletions":-4},{"file":"deps/fw/test/unit/tags.test.js","type":"MODIFIED","insertions":5,"deletions":-3},{"file":"deps/fw/test/unit/update.test.js","type":"MODIFIED","insertions":7,"deletions":-6},{"file":"deps/fw/test/unit/wildcards.test.js","type":"MODIFIED","insertions":6,"deletions":-8},{"file":"npm/postinstall.sh","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"npm/postuninstall.sh","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"smf/manifests/firewaller-config-migration.xml.in","type":"ADDED","insertions":57,"deletions":0}],"sizeInsertions":756,"sizeDeletions":-188},{"number":"14","revision":"2f4fd52dd23dd219206120621fb170f574904246","parents":["243a3904cfa6f473d52005d5cdf7cba0682adc5d"],"ref":"refs/changes/72/6372/14","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1560194333,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1560187738,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1559902499,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"SUBM","value":"1","grantedOn":1560194351,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1560193320,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1560194173,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"config-migration.js","type":"ADDED","insertions":192,"deletions":0},{"file":"deps/fw/lib/fw.js","type":"MODIFIED","insertions":41,"deletions":-17},{"file":"deps/fw/node_modules/fwrule/rule.js","type":"MODIFIED","insertions":15,"deletions":-1},{"file":"deps/fw/test/lib/mocks.js","type":"MODIFIED","insertions":9,"deletions":-14},{"file":"deps/fw/test/unit/add.test.js","type":"MODIFIED","insertions":6,"deletions":-7},{"file":"deps/fw/test/unit/fw.test.js","type":"MODIFIED","insertions":95,"deletions":-108},{"file":"deps/fw/test/unit/global.test.js","type":"MODIFIED","insertions":2,"deletions":-10},{"file":"deps/fw/test/unit/icmp.test.js","type":"MODIFIED","insertions":4,"deletions":-8},{"file":"deps/fw/test/unit/log.test.js","type":"ADDED","insertions":298,"deletions":0},{"file":"deps/fw/test/unit/owner.test.js","type":"MODIFIED","insertions":5,"deletions":-4},{"file":"deps/fw/test/unit/tags.test.js","type":"MODIFIED","insertions":5,"deletions":-3},{"file":"deps/fw/test/unit/update.test.js","type":"MODIFIED","insertions":7,"deletions":-6},{"file":"deps/fw/test/unit/wildcards.test.js","type":"MODIFIED","insertions":6,"deletions":-8},{"file":"npm/postinstall.sh","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"npm/postuninstall.sh","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"smf/manifests/firewaller-config-migration.xml.in","type":"ADDED","insertions":57,"deletions":0}],"sizeInsertions":756,"sizeDeletions":-188}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}]}