{"project":"joyent/node-sshpk","branch":"master","id":"I654519957dd9fc9a931835313dd21d57cca272ff","number":"5265","subject":"joyent/node-sshpk#59 want support for SPKI fingerprint format Reviewed by: Isaac Davis \u003cisaac.davis@joyent.com\u003e Reviewed by: Cody Peter Mello \u003ccody.mello@joyent.com\u003e","owner":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"url":"https://cr.joyent.us/5265","commitMessage":"joyent/node-sshpk#59 want support for SPKI fingerprint format\nReviewed by: Isaac Davis \u003cisaac.davis@joyent.com\u003e\nReviewed by: Cody Peter Mello \u003ccody.mello@joyent.com\u003e\n","createdOn":1545172635,"lastUpdated":1545256258,"open":false,"status":"MERGED","comments":[{"timestamp":1545172635,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 1."},{"timestamp":1545172659,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing-1\n\n(1 comment)\n\n\"make check\" exited with status 2"},{"timestamp":1545172699,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 2."},{"timestamp":1545172816,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1545185408,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1545187656,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1545189281,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 2: Code-Review+1 Integration-Approval+1"},{"timestamp":1545252188,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1545255504,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 3."},{"timestamp":1545255530,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1545255567,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1545255959,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 3: Code-Review+1 Integration-Approval+1"},{"timestamp":1545256256,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 4: Commit message was updated."},{"timestamp":1545256258,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Alex Wilson"}],"currentPatchSet":{"number":"4","revision":"44aec4ad8bcf7324009c92a52e4c81487cbc24b9","parents":["385ff11efc4edd201c07f2ceee23746c13122f9c"],"ref":"refs/changes/65/5265/4","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1545256256,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1545255530,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1545255567,"by":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1545255959,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1545255959,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"SUBM","value":"1","grantedOn":1545256258,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":23,"deletions":-9},{"file":"bin/sshpk-conv","type":"MODIFIED","insertions":53,"deletions":-17},{"file":"lib/fingerprint.js","type":"MODIFIED","insertions":62,"deletions":-11},{"file":"lib/formats/pkcs8.js","type":"MODIFIED","insertions":8,"deletions":-1},{"file":"lib/key.js","type":"MODIFIED","insertions":28,"deletions":-11},{"file":"lib/private-key.js","type":"MODIFIED","insertions":8,"deletions":-3},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/fingerprint.js","type":"MODIFIED","insertions":37,"deletions":-1}],"sizeInsertions":220,"sizeDeletions":-54},"patchSets":[{"number":"1","revision":"0cae455496c4df4850416e43f2305039dc39b3e6","parents":["2ab4f2a018766559252f2c3426a3735f0860ac0d"],"ref":"refs/changes/65/5265/1","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1545172635,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1545172659,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/formats/pkcs8.js","line":415,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"warning: function writePkcs8 does not always return a value"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":23,"deletions":-9},{"file":"bin/sshpk-conv","type":"MODIFIED","insertions":53,"deletions":-17},{"file":"lib/fingerprint.js","type":"MODIFIED","insertions":62,"deletions":-11},{"file":"lib/formats/pkcs8.js","type":"MODIFIED","insertions":10,"deletions":-1},{"file":"lib/key.js","type":"MODIFIED","insertions":28,"deletions":-11},{"file":"lib/private-key.js","type":"MODIFIED","insertions":8,"deletions":-3},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/fingerprint.js","type":"MODIFIED","insertions":37,"deletions":-1}],"sizeInsertions":222,"sizeDeletions":-54},{"number":"2","revision":"3dbe197248fdf6ab2278fe303695a33b0520cb19","parents":["2ab4f2a018766559252f2c3426a3735f0860ac0d"],"ref":"refs/changes/65/5265/2","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1545172699,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1545189281,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1545189281,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1545172816,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/formats/pkcs8.js","line":421,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"You\u0027ve added this \"returnBuf\" logic because you now need to get the buffer back in key.js.\n\nI think I understand the logic - because the buffer comes from the der object, there\u0027s never a need to return the buffer if the user passed in the der object themselves.\n\nWith that said - I am uncomfortable with having the presence of a return value implicitly conditioned on whether or not the \"der\" argument is passed.\n\nThus - I\u0027d like to see a comment here explaining why we return the buffer only under certain conditions.\n\nOther options would be to _always_ return the buffer and just ignore the return value in most cases, or to add an explicit function argument so we can specify the behavior we want. In all cases, I think an explanatory comment is warranted."},{"file":"lib/private-key.js","line":61,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Previously this passed through to Key#fingerprint(), which I believe would have used the hash of the private key, and now it\u0027s converting it to a public Key first, and taking its fingerprint. This would be a breaking change right?"},{"file":"lib/private-key.js","line":61,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Until this change, the hash that we used was of the rfc4253 format, which is pubkey only (it doesn\u0027t care that this is a private key, it just takes the public part out of it). So it was identical behaviour to doing .toPublic().hash(). The pkcs8 format module though handles private keys explicitly, so if we keep giving it the PrivateKey instance with an SPKI hashType we will hash the wrong thing (fingerprints are always hashes of the public key).\n\nSo there\u0027s no breaking change here for existing users of the API (they were already just getting the hash of the public key because we only supported a format that did that)"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":23,"deletions":-9},{"file":"bin/sshpk-conv","type":"MODIFIED","insertions":53,"deletions":-17},{"file":"lib/fingerprint.js","type":"MODIFIED","insertions":62,"deletions":-11},{"file":"lib/formats/pkcs8.js","type":"MODIFIED","insertions":11,"deletions":-1},{"file":"lib/key.js","type":"MODIFIED","insertions":28,"deletions":-11},{"file":"lib/private-key.js","type":"MODIFIED","insertions":8,"deletions":-3},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/fingerprint.js","type":"MODIFIED","insertions":37,"deletions":-1}],"sizeInsertions":223,"sizeDeletions":-54},{"number":"3","revision":"654519957dd9fc9a931835313dd21d57cca272ff","parents":["385ff11efc4edd201c07f2ceee23746c13122f9c"],"ref":"refs/changes/65/5265/3","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1545255504,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1545255959,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1545255959,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1545255530,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1545255567,"by":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":23,"deletions":-9},{"file":"bin/sshpk-conv","type":"MODIFIED","insertions":53,"deletions":-17},{"file":"lib/fingerprint.js","type":"MODIFIED","insertions":62,"deletions":-11},{"file":"lib/formats/pkcs8.js","type":"MODIFIED","insertions":8,"deletions":-1},{"file":"lib/key.js","type":"MODIFIED","insertions":28,"deletions":-11},{"file":"lib/private-key.js","type":"MODIFIED","insertions":8,"deletions":-3},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/fingerprint.js","type":"MODIFIED","insertions":37,"deletions":-1}],"sizeInsertions":220,"sizeDeletions":-54},{"number":"4","revision":"44aec4ad8bcf7324009c92a52e4c81487cbc24b9","parents":["385ff11efc4edd201c07f2ceee23746c13122f9c"],"ref":"refs/changes/65/5265/4","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1545256256,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1545255959,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1545255959,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"SUBM","value":"1","grantedOn":1545256258,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1545255530,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1545255567,"by":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":23,"deletions":-9},{"file":"bin/sshpk-conv","type":"MODIFIED","insertions":53,"deletions":-17},{"file":"lib/fingerprint.js","type":"MODIFIED","insertions":62,"deletions":-11},{"file":"lib/formats/pkcs8.js","type":"MODIFIED","insertions":8,"deletions":-1},{"file":"lib/key.js","type":"MODIFIED","insertions":28,"deletions":-11},{"file":"lib/private-key.js","type":"MODIFIED","insertions":8,"deletions":-3},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/fingerprint.js","type":"MODIFIED","insertions":37,"deletions":-1}],"sizeInsertions":220,"sizeDeletions":-54}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}]}