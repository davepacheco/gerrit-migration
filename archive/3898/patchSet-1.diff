From 90ca2fa34c245f696c595ddb7c488fa5db6d0aaf Mon Sep 17 00:00:00 2001
From: Jan Wyszynski <jan.wyszynski@joyent.com>
Date: Wed, 2 May 2018 22:38:55 +0000
Subject: [PATCH] MORAY-469 moray getobject-done probe should pass req_id

---
 lib/dtrace.js      | 4 ++--
 lib/objects/get.js | 2 +-
 2 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/lib/dtrace.js b/lib/dtrace.js
index 52ae765..e401775 100644
--- a/lib/dtrace.js
+++ b/lib/dtrace.js
@@ -43,8 +43,8 @@ var PROBES = {
     // msgid, req_id, bucket, key
     'getobject-start': ['int', 'char *', 'char *', 'char *'],
 
-    // msgid, value
-    'getobject-done': ['int', 'char *'],
+    // msgid, req_id value
+    'getobject-done': ['int', 'char *', 'char *'],
 
     // msgid, req_id, bucket, key
     'delobject-start': ['int', 'char *', 'char *', 'char *'],
diff --git a/lib/objects/get.js b/lib/objects/get.js
index 985e741..47afd0a 100644
--- a/lib/objects/get.js
+++ b/lib/objects/get.js
@@ -176,7 +176,7 @@ function get(options) {
             cbOutput: function () { return req.object; },
             cbProbe: function () {
                 var val = JSON.stringify(req.object);
-                return ([req.msgid, val]);
+                return ([req.msgid, req.req_id, val]);
             }
         });
     }
-- 
2.21.0

