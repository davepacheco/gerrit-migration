{"project":"joyent/sdc-docker","branch":"master","id":"If49b31b7d89ec584f12d7c3d0de2d353976626fa","number":"1261","subject":"DOCKER-994 Docker cp failed silently on alpine when copying files out of the container Reviewed by: Julien Gilli \u003cjulien.gilli@joyent.com\u003e Approved by: Orlando Vazquez \u003corlando@joyent.com\u003e","owner":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"url":"https://cr.joyent.us/1261","commitMessage":"DOCKER-994 Docker cp failed silently on alpine when copying files out of the container\nReviewed by: Julien Gilli \u003cjulien.gilli@joyent.com\u003e\nApproved by: Orlando Vazquez \u003corlando@joyent.com\u003e\n","createdOn":1484607394,"lastUpdated":1484955287,"open":false,"status":"MERGED","comments":[{"timestamp":1484607394,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Uploaded patch set 1."},{"timestamp":1484607395,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit e062ade77fbddfdf288effe7ae13fa6d94bc3bd0\n    \n    add a test for funky filenames, refactor some arguments in tests to be more clear"},{"timestamp":1484607444,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1484678050,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 1:\n\n(5 comments)"},{"timestamp":1484946842,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1484946912,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Uploaded patch set 2."},{"timestamp":1484946913,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit 3ccfe20a931edd9e6a01e8de1676181ccb9277f2\n    \n    update to address feedback"},{"timestamp":1484946943,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1484950943,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 2: Code-Review+1"},{"timestamp":1484951494,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Uploaded patch set 3: Commit message was updated."},{"timestamp":1484951521,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Patch Set 3: Integration-Approval+1"},{"timestamp":1484951527,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Uploaded patch set 4: Commit message was updated."},{"timestamp":1484951751,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Patch Set 5: Commit message was updated."},{"timestamp":1484955287,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Orlando Vazquez"}],"currentPatchSet":{"number":"5","revision":"30d1467c01007d24d1820063714e422b4c95b67c","parents":["6661b03a65d448d42500b678d60c401c0facfd32"],"ref":"refs/changes/61/1261/5","uploader":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"createdOn":1484951751,"author":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1484946943,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1484950943,"by":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1484951521,"by":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"}},{"type":"SUBM","value":"1","grantedOn":1484955287,"by":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"test/integration/cli-copy.test.js","type":"MODIFIED","insertions":184,"deletions":-49}],"sizeInsertions":184,"sizeDeletions":-49},"patchSets":[{"number":"1","revision":"b119329330e226a7466a4b1c8fdcda2579adf8a6","parents":["6661b03a65d448d42500b678d60c401c0facfd32"],"ref":"refs/changes/61/1261/1","uploader":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"createdOn":1484607394,"author":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1484607444,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"test/integration/cli-copy.test.js","line":107,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Nit: having these variable names (\"nginxName\", etc.) in all caps could help communicate they\u0027re constants."},{"file":"test/integration/cli-copy.test.js","line":110,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Nit: same comment as above with regards to \"toCreate\" that could be all caps to convey it\u0027s a constant.\n\nAlso, instead of the items within the array being arrays themselves, they could be objects with named properties (such as \"name\", \"image\" and \"command\") to make the code that use it more self-explanatory. That would give something like:\n\nvar CONTAINERS_TO_CREATE \u003d [\n  { name: \"NGINX_NAME\", image: \"nginx\"},\n  ...\n]"},{"file":"test/integration/cli-copy.test.js","line":189,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"I\u0027m ignorant about docker cp, why do file names with a period or underscore need to be escaped? It might be useful to mention that in a comment if it\u0027s not obvious. I have the same question for file names using the snowman unicode character. Is it because its utf-8 representation is multi-bytes?"},{"file":"test/integration/cli-copy.test.js","line":189,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Basically I wanted to capture a set of \"special\" characters which could be seen as problematic, and I wanted to ensure everything continues to work after removing the escaping that was present before. There\u0027s not really anything special about underscores, I added it because basically why not."},{"file":"test/integration/cli-copy.test.js","line":202,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Nit: I think moving these variables to be parameters to the functions used in that test (\"createLocalFile\", \"copyFilesIn\" and \"copyFilesOutAndCheckContents\") would make the test easier to read. I had to constantly go back to what these variables represented when reading each of these functions\u0027 implementation, and it makes the relationships between them unclear."},{"file":"test/integration/cli-copy.test.js","line":700,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Why do we need to specify a maxBuffer value, and why specifically 1KiB + 1? I think a comment would help clarify this, but if we can avoid needing to pass that option, it seems it would make writing further \"docker cp\" tests more robust/easier."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"test/integration/cli-copy.test.js","type":"MODIFIED","insertions":162,"deletions":-39}],"sizeInsertions":162,"sizeDeletions":-39},{"number":"2","revision":"299897e841c0c7c2aeeea137de4598738151faa7","parents":["6661b03a65d448d42500b678d60c401c0facfd32"],"ref":"refs/changes/61/1261/2","uploader":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"createdOn":1484946912,"author":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1484946943,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1484950943,"by":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"test/integration/cli-copy.test.js","type":"MODIFIED","insertions":184,"deletions":-49}],"sizeInsertions":184,"sizeDeletions":-49},{"number":"3","revision":"4c88bc7fcafd854fd54c9ff8da8821179a745fa5","parents":["6661b03a65d448d42500b678d60c401c0facfd32"],"ref":"refs/changes/61/1261/3","uploader":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"createdOn":1484951494,"author":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1484946943,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1484950943,"by":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1484951521,"by":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"test/integration/cli-copy.test.js","type":"MODIFIED","insertions":184,"deletions":-49}],"sizeInsertions":184,"sizeDeletions":-49},{"number":"4","revision":"f49b31b7d89ec584f12d7c3d0de2d353976626fa","parents":["6661b03a65d448d42500b678d60c401c0facfd32"],"ref":"refs/changes/61/1261/4","uploader":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"createdOn":1484951527,"author":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1484946943,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1484950943,"by":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1484951521,"by":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"test/integration/cli-copy.test.js","type":"MODIFIED","insertions":184,"deletions":-49}],"sizeInsertions":184,"sizeDeletions":-49},{"number":"5","revision":"30d1467c01007d24d1820063714e422b4c95b67c","parents":["6661b03a65d448d42500b678d60c401c0facfd32"],"ref":"refs/changes/61/1261/5","uploader":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"createdOn":1484951751,"author":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1484946943,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1484950943,"by":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1484951521,"by":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"}},{"type":"SUBM","value":"1","grantedOn":1484955287,"by":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"test/integration/cli-copy.test.js","type":"MODIFIED","insertions":184,"deletions":-49}],"sizeInsertions":184,"sizeDeletions":-49}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"}]}