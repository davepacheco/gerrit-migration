{"project":"joyent/sdc-cnapi","branch":"master","id":"I135742185884203e72776eaa8629ca61382514e7","number":"5747","subject":"TRITON-1294 TRITON-1217 broke transitional_status being reset after a reboot Reviewed by: Orlando Vazquez \u003corlando@joyent.com\u003e Approved by: Orlando Vazquez \u003corlando@joyent.com\u003e","owner":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"url":"https://cr.joyent.us/5747","commitMessage":"TRITON-1294 TRITON-1217 broke transitional_status being reset after a reboot\nReviewed by: Orlando Vazquez \u003corlando@joyent.com\u003e\nApproved by: Orlando Vazquez \u003corlando@joyent.com\u003e\n","createdOn":1552093645,"lastUpdated":1552414269,"open":false,"status":"MERGED","comments":[{"timestamp":1552093645,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Uploaded patch set 1."},{"timestamp":1552093646,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit 6f9b6be7025890369275a0c95adca3f39c1e0213\n    \n    TRITON-1294 TRITON-1217 broke transitional_status being reset after a reboot"},{"timestamp":1552094899,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 1:\n\n(2 comments)"},{"timestamp":1552095003,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1552120463,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Uploaded patch set 2."},{"timestamp":1552120465,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit 9d6f9ec0170bb82ff68318857ba2c24baf5b343c\n    \n    wip"},{"timestamp":1552175860,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Uploaded patch set 3."},{"timestamp":1552175861,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 3:\n\nNew commits:\n    \n    commit 1835d51f1c5810ebe3e2bf9969315fff5b98ff19\n    \n    updates to fix stats"},{"timestamp":1552327078,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Uploaded patch set 4: Patch Set 3 was rebased."},{"timestamp":1552327079,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 4:\n\nNew commits:\n    \n    commit af1ff93cb5f65d6fdd505e78801f91a4a000aa5a\n    \n    updates to fix stats\n    \n    commit 39e5944dfa37ebf52a741ba32d15c8b00dad02a1\n    \n    wip\n    \n    commit 856045ebd32ace1b14a86f4dee68f2c64477d112\n    \n    TRITON-1294 TRITON-1217 broke transitional_status being reset after a reboot"},{"timestamp":1552410342,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Patch Set 4:\n\n(1 comment)"},{"timestamp":1552414046,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Uploaded patch set 5."},{"timestamp":1552414047,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 4:\n\n(1 comment)"},{"timestamp":1552414047,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 5:\n\nNew commits:\n    \n    commit af12a2fc5922716ad938ae811d63de83cc52f007\n    \n    address review comment"},{"timestamp":1552414197,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Patch Set 5: Code-Review+1 Integration-Approval+1"},{"timestamp":1552414252,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Uploaded patch set 6: Commit message was updated."},{"timestamp":1552414269,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Josh Wilsdon"}],"currentPatchSet":{"number":"6","revision":"135742185884203e72776eaa8629ca61382514e7","parents":["f496623652cd12ff964948f3fe6b9256b867287c"],"ref":"refs/changes/47/5747/6","uploader":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"createdOn":1552414252,"author":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1552414197,"by":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1552414197,"by":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"}},{"type":"SUBM","value":"1","grantedOn":1552414269,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/heartbeat_reconciler.js","type":"MODIFIED","insertions":42,"deletions":-73},{"file":"lib/models/server.js","type":"MODIFIED","insertions":111,"deletions":-12},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":154,"sizeDeletions":-86},"patchSets":[{"number":"1","revision":"874497d14139f4274c4bd64591f819e0ec4ed93f","parents":["47a1e7373962cf65c3d8a7e47c5a9a91418463c7"],"ref":"refs/changes/47/5747/1","uploader":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"createdOn":1552093645,"author":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"isDraft":false,"kind":"REWORK","comments":[{"file":"lib/models/server.js","line":2054,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"If a reboot is very fast (e.g. for a mock CN or some great new hardware... could we have a transition here away from \"rebooting\" but serverObj.status is still \"running\"?"},{"file":"lib/models/server.js","line":2054,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Yeah, I was just trying to figure out how to deal with that case. Will update when I have a solution."},{"file":"lib/models/server.js","line":2063,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Perhaps include that that value is (and perhaps the server UUID) in this assert message?"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/models/server.js","type":"MODIFIED","insertions":19,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":20,"sizeDeletions":-1},{"number":"2","revision":"082c12a8ae17d423630acc2fe4fb94f38c49defc","parents":["47a1e7373962cf65c3d8a7e47c5a9a91418463c7"],"ref":"refs/changes/47/5747/2","uploader":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"createdOn":1552120463,"author":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/heartbeat_reconciler.js","type":"MODIFIED","insertions":42,"deletions":-73},{"file":"lib/models/server.js","type":"MODIFIED","insertions":112,"deletions":-12},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":155,"sizeDeletions":-86},{"number":"3","revision":"8d032119d64841609129a78ec7e1447a9e9a036b","parents":["47a1e7373962cf65c3d8a7e47c5a9a91418463c7"],"ref":"refs/changes/47/5747/3","uploader":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"createdOn":1552175860,"author":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/heartbeat_reconciler.js","type":"MODIFIED","insertions":42,"deletions":-73},{"file":"lib/models/server.js","type":"MODIFIED","insertions":111,"deletions":-12},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":154,"sizeDeletions":-86},{"number":"4","revision":"c8ab874016c8fe6915b0ec628daf4223c68f1860","parents":["f496623652cd12ff964948f3fe6b9256b867287c"],"ref":"refs/changes/47/5747/4","uploader":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"createdOn":1552327078,"author":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"isDraft":false,"kind":"TRIVIAL_REBASE","comments":[{"file":"lib/models/server.js","line":2180,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"I noticed that in the reconciler code, we increment the putObject counter prior to invoking putObject, but it looks like we\u0027re incrementing it here when our callback is executed. Should it be popped-up to just before we call putObject?"},{"file":"lib/models/server.js","line":2180,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Sure. I don\u0027t think it\u0027ll actually make a difference to the counts, but I can do that just so it\u0027s the same as before."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/heartbeat_reconciler.js","type":"MODIFIED","insertions":42,"deletions":-73},{"file":"lib/models/server.js","type":"MODIFIED","insertions":111,"deletions":-12},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":154,"sizeDeletions":-86},{"number":"5","revision":"fde96b10bf8ff55d346c47243044f0d154f53785","parents":["f496623652cd12ff964948f3fe6b9256b867287c"],"ref":"refs/changes/47/5747/5","uploader":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"createdOn":1552414046,"author":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1552414197,"by":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1552414197,"by":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/heartbeat_reconciler.js","type":"MODIFIED","insertions":42,"deletions":-73},{"file":"lib/models/server.js","type":"MODIFIED","insertions":111,"deletions":-12},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":154,"sizeDeletions":-86},{"number":"6","revision":"135742185884203e72776eaa8629ca61382514e7","parents":["f496623652cd12ff964948f3fe6b9256b867287c"],"ref":"refs/changes/47/5747/6","uploader":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"createdOn":1552414252,"author":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"SUBM","value":"1","grantedOn":1552414269,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1552414197,"by":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1552414197,"by":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/heartbeat_reconciler.js","type":"MODIFIED","insertions":42,"deletions":-73},{"file":"lib/models/server.js","type":"MODIFIED","insertions":111,"deletions":-12},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":154,"sizeDeletions":-86}],"allReviewers":[{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}]}