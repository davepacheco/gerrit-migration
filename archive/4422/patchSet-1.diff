From 02a4427b43718fa9c5ea844cc617dd1abb51b411 Mon Sep 17 00:00:00 2001
From: Josh Wilsdon <josh@wilsdon.ca>
Date: Sun, 24 Jun 2018 12:47:04 -0700
Subject: [PATCH] TRITON-542 cn-agent should close connection after posting
 sysinfo

---
 lib/app.js   | 1 +
 package.json | 2 +-
 2 files changed, 2 insertions(+), 1 deletion(-)

diff --git a/lib/app.js b/lib/app.js
index 059c019..45d12e0 100644
--- a/lib/app.js
+++ b/lib/app.js
@@ -358,6 +358,7 @@ App.prototype.registerServer = function registerServer(callback) {
     var urlPath = path.join('/servers', self.uuid, 'sysinfo');
 
     restifyOptions = {
+        agent: false,
         connectTimeout: 5000,
         requestTimeout: 5000,
         url: url,
diff --git a/package.json b/package.json
index 4508124..c91faf1 100644
--- a/package.json
+++ b/package.json
@@ -1,7 +1,7 @@
 {
   "name": "cn-agent",
   "description": "Triton Compute Node Agent",
-  "version": "2.2.1",
+  "version": "2.2.2",
   "author": "Joyent (joyent.com)",
   "private": true,
   "dependencies": {
-- 
2.21.0

