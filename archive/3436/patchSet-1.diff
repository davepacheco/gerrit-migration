From c0c6ca3c59789ba67998b576f0f8b7652b6a0a8f Mon Sep 17 00:00:00 2001
From: Josh Wilsdon <josh@wilsdon.ca>
Date: Wed, 21 Feb 2018 12:03:53 -0800
Subject: [PATCH] TRITON-166 CloudAPI ListMachines endpoint errors with a
 JSON.parse error

---
 lib/machines.js | 16 ++++++++--------
 package.json    |  2 +-
 2 files changed, 9 insertions(+), 9 deletions(-)

diff --git a/lib/machines.js b/lib/machines.js
index 638c244..efdc628 100644
--- a/lib/machines.js
+++ b/lib/machines.js
@@ -275,16 +275,16 @@ function getListOptions(req) {
 
     switch (req.params.type) {
     case 'smartmachine':
-        opts.predicate = '{ "and" [ ' +
-            '{ "ne": [ "brand", "kvm" ] }, ' +
-            '{ "ne": [ "brand", "bhyve" ] }' +
-            ' ] }';
+        opts.predicate = JSON.stringify({ and: [
+            { ne: [ 'brand', 'kvm' ] },
+            { ne: [ 'brand', 'bhyve' ] }
+        ] });
         break;
     case 'virtualmachine':
-        opts.predicate = '{ "or": [ ' +
-                '{ "eq": [ "brand", "kvm" ] }, ' +
-                '{ "eq": [ "brand", "bhyve" ] }' +
-                ' ] }';
+        opts.predicate = JSON.stringify({ or: [
+            { eq: [ 'brand', 'kvm' ] },
+            { eq: [ 'brand', 'bhyve' ] }
+        ] });
         break;
     case undefined:
         break;
diff --git a/package.json b/package.json
index bf7ba42..3582e97 100644
--- a/package.json
+++ b/package.json
@@ -1,7 +1,7 @@
 {
     "name": "cloudapi",
     "description": "SmartDataCenter CloudAPI",
-    "version": "8.6.0",
+    "version": "8.6.1",
     "author": "Joyent (joyent.com)",
     "private": true,
     "engines": {
-- 
2.21.0

