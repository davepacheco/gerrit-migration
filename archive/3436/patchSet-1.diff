commit c0c6ca3c59789ba67998b576f0f8b7652b6a0a8f (refs/changes/36/3436/1)
Author: Josh Wilsdon <josh@wilsdon.ca>
Date:   2018-02-21T12:03:53-08:00 (1 year, 8 months ago)
    
    TRITON-166 CloudAPI ListMachines endpoint errors with a JSON.parse error

diff --git a/lib/machines.js b/lib/machines.js
index 638c244..efdc628 100644
--- a/lib/machines.js
+++ b/lib/machines.js
@@ -275,16 +275,16 @@ function getListOptions(req) {
 
     switch (req.params.type) {
     case 'smartmachine':
-        opts.predicate = '{ "and" [ ' +
-            '{ "ne": [ "brand", "kvm" ] }, ' +
-            '{ "ne": [ "brand", "bhyve" ] }' +
-            ' ] }';
+        opts.predicate = JSON.stringify({ and: [
+            { ne: [ 'brand', 'kvm' ] },
+            { ne: [ 'brand', 'bhyve' ] }
+        ] });
         break;
     case 'virtualmachine':
-        opts.predicate = '{ "or": [ ' +
-                '{ "eq": [ "brand", "kvm" ] }, ' +
-                '{ "eq": [ "brand", "bhyve" ] }' +
-                ' ] }';
+        opts.predicate = JSON.stringify({ or: [
+            { eq: [ 'brand', 'kvm' ] },
+            { eq: [ 'brand', 'bhyve' ] }
+        ] });
         break;
     case undefined:
         break;
diff --git a/package.json b/package.json
index bf7ba42..3582e97 100644
--- a/package.json
+++ b/package.json
@@ -1,7 +1,7 @@
 {
     "name": "cloudapi",
     "description": "SmartDataCenter CloudAPI",
-    "version": "8.6.0",
+    "version": "8.6.1",
     "author": "Joyent (joyent.com)",
     "private": true,
     "engines": {
