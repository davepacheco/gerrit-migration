{"project":"joyent/illumos-joyent","branch":"master","id":"Ie44341b165605a42942642ff824170ba5a736999","number":"1962","subject":"OS-6117 panic in PTE_set_all() OS-6118 IMMU_CONTIG_PADDR is broken for cookies with more than one page OS-6131 nvme causes bad free panic in IOMMU Reviewed by: Robert Mustacchi \u003crm@joyent.com\u003e Reviewed by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e Approved","owner":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"url":"https://cr.joyent.us/1962","commitMessage":"OS-6117 panic in PTE_set_all()\nOS-6118 IMMU_CONTIG_PADDR is broken for cookies with more than one page\nOS-6131 nvme causes bad free panic in IOMMU\nReviewed by: Robert Mustacchi \u003crm@joyent.com\u003e\nReviewed by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e\nApproved by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e\n","createdOn":1494948791,"lastUpdated":1496410525,"open":false,"status":"MERGED","comments":[{"timestamp":1494948791,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Uploaded patch set 1."},{"timestamp":1494953538,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 1: Code-Review+1"},{"timestamp":1495040052,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1495108939,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1496133353,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Patch Set 2: Patch Set 1 was rebased"},{"timestamp":1496342095,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 2: Code-Review+1\n\n(1 comment)"},{"timestamp":1496409025,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 2: Integration-Approval+1"},{"timestamp":1496410425,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Patch Set 3: Patch Set 2 was rebased"},{"timestamp":1496410516,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Uploaded patch set 4: Commit message was updated."},{"timestamp":1496410525,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Hans Rosenfeld"}],"currentPatchSet":{"number":"4","revision":"e44341b165605a42942642ff824170ba5a736999","parents":["6d7aaea8af5e30481216b60530543aea714ae1d5"],"ref":"refs/changes/62/1962/4","uploader":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"createdOn":1496410516,"author":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1494953538,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1496342095,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1496409025,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"SUBM","value":"1","grantedOn":1496410525,"by":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":12,"deletions":0},{"file":"usr/src/uts/i86pc/io/immu_dvma.c","type":"MODIFIED","insertions":9,"deletions":-5},{"file":"usr/src/uts/i86pc/io/rootnex.c","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":11,"sizeDeletions":-7},"patchSets":[{"number":"1","revision":"663a5ccd5b1451460e3aa199cd93044ba6794703","parents":["20bbbc2871a3fc191b4c28e03bf213a0e83166f4"],"ref":"refs/changes/62/1962/1","uploader":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"createdOn":1494948791,"author":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1494953538,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"comments":[{"file":"usr/src/uts/i86pc/io/immu_dvma.c","line":62,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Should we worry about overflow behavior in this calculation? I\u0027m not sure where exactly the cookie contents are verified to make sense and not subject to a pathological driver."},{"file":"usr/src/uts/i86pc/io/immu_dvma.c","line":62,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"I don\u0027t think we need to worry about this. This macro is only used in immu_map_dvmaseg(), and thats also the place where the cookies are created. The only way this could be an issue is if the DMA memory object to be mapped has two virtually contiguous pages located on the last and first physical pages."},{"file":"usr/src/uts/i86pc/io/immu_dvma.c","line":62,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"OK, fair enough. I just really worry about silent overflow in macros, even if it\u0027s not likely."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/uts/i86pc/io/immu_dvma.c","type":"MODIFIED","insertions":9,"deletions":-5},{"file":"usr/src/uts/i86pc/io/rootnex.c","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":11,"sizeDeletions":-7},{"number":"2","revision":"30567d197a2413d044faa97fc276d04584fdc609","parents":["eb851a777c457362e68a9c4505129bd23d595b7a"],"ref":"refs/changes/62/1962/2","uploader":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"createdOn":1496133353,"author":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1496342095,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1494953538,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1496409025,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/uts/i86pc/io/immu_dvma.c","type":"MODIFIED","insertions":9,"deletions":-5},{"file":"usr/src/uts/i86pc/io/rootnex.c","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":11,"sizeDeletions":-7},{"number":"3","revision":"fe0a6160ac955043849bbb7e83605d75fdcd07bf","parents":["6d7aaea8af5e30481216b60530543aea714ae1d5"],"ref":"refs/changes/62/1962/3","uploader":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"createdOn":1496410425,"author":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1496342095,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1494953538,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1496409025,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/uts/i86pc/io/immu_dvma.c","type":"MODIFIED","insertions":9,"deletions":-5},{"file":"usr/src/uts/i86pc/io/rootnex.c","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":11,"sizeDeletions":-7},{"number":"4","revision":"e44341b165605a42942642ff824170ba5a736999","parents":["6d7aaea8af5e30481216b60530543aea714ae1d5"],"ref":"refs/changes/62/1962/4","uploader":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"createdOn":1496410516,"author":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1496342095,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1494953538,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1496409025,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"SUBM","value":"1","grantedOn":1496410525,"by":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":12,"deletions":0},{"file":"usr/src/uts/i86pc/io/immu_dvma.c","type":"MODIFIED","insertions":9,"deletions":-5},{"file":"usr/src/uts/i86pc/io/rootnex.c","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":11,"sizeDeletions":-7}],"allReviewers":[{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"}]}