{"project":"joyent/node-sshpk","branch":"master","id":"I0c1a12335c8db627b78814f928d7b59312dbdc99","number":"1911","subject":"joyent/node-sshpk#28 remove remaining usage of jodid25519 joyent/node-sshpk#30 curve25519 keys should always have size 256 Reviewed by: Cody Peter Mello \u003ccody.mello@joyent.com\u003e","owner":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"url":"https://cr.joyent.us/1911","commitMessage":"joyent/node-sshpk#28 remove remaining usage of jodid25519\njoyent/node-sshpk#30 curve25519 keys should always have size 256\nReviewed by: Cody Peter Mello \u003ccody.mello@joyent.com\u003e\n","createdOn":1494011729,"lastUpdated":1496888071,"open":false,"status":"MERGED","comments":[{"timestamp":1494011729,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 1."},{"timestamp":1494011754,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1494029581,"reviewer":{"name":"Brittany Wald","email":"brittany.wald@joyent.com","username":"princesspretzel"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1494443979,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1494465406,"reviewer":{"name":"Brittany Wald","email":"brittany.wald@joyent.com","username":"princesspretzel"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1494548899,"reviewer":{"name":"Brittany Wald","email":"brittany.wald@joyent.com","username":"princesspretzel"},"message":"Patch Set 1:\n\n(1 comment)\n\nIs there a test plan I can look at for this change? This looks good to me besides those two small comments."},{"timestamp":1495752746,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 1:\n\n(1 comment)\n\nThe test plan has just been to run all the unit tests in node-sshpk and node-sshpk-agent. I\u0027ll add a test with a \"negative\" (high bit set) seed (there\u0027s already one with a negative public key)"},{"timestamp":1495753011,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 2."},{"timestamp":1495753036,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1495814364,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1496878519,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 2:\n\n(3 comments)"},{"timestamp":1496886246,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 3."},{"timestamp":1496886250,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 2:\n\n(3 comments)"},{"timestamp":1496886271,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1496887338,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1496887809,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 4: Patch Set 3 was rebased"},{"timestamp":1496887831,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 5: Commit message was updated."},{"timestamp":1496887833,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4:\n\n\"make check\" passed ok"},{"timestamp":1496888069,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 5: Integration-Approval+1"},{"timestamp":1496888071,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Alex Wilson"}],"currentPatchSet":{"number":"5","revision":"a17ec8861242649038dcdba8f8d7df5edf2ddb8c","parents":["78cf827bcebfb73ff1a3a6369f9c66693ec33457"],"ref":"refs/changes/11/1911/5","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1496887831,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1496886271,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1496887338,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1496888069,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"SUBM","value":"1","grantedOn":1496888071,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/dhe.js","type":"MODIFIED","insertions":17,"deletions":-16},{"file":"lib/key.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/private-key.js","type":"MODIFIED","insertions":13,"deletions":-14},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-2},{"file":"test/assets/ed25519-negative","type":"ADDED","insertions":7,"deletions":0},{"file":"test/dhe.js","type":"MODIFIED","insertions":14,"deletions":0}],"sizeInsertions":53,"sizeDeletions":-33},"patchSets":[{"number":"1","revision":"ce01f32b1155137741a5445535c36454f9dc9c23","parents":["61aa61683a0c8211641423843018aae1b3691bb7"],"ref":"refs/changes/11/1911/1","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1494011729,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1494011754,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/private-key.js","line":100,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Sorry, I misread your earlier comment. This line is *box.keyPair.fromSecretKey*, not *sign.keyPair.fromSecretKey*. The \"box\" keys take a 32-bit input in fromSecretKey (it doesn\u0027t contain the public half, it\u0027s just the seed, which is why there\u0027s no box.keyPair.fromSeed)"},{"file":"lib/private-key.js","line":111,"reviewer":{"name":"Brittany Wald","email":"brittany.wald@joyent.com","username":"princesspretzel"},"message":"It might be helpful to have a line in the test for this code that checks the sign bit for the post-conversion ed25519 private key."},{"file":"lib/private-key.js","line":120,"reviewer":{"name":"Brittany Wald","email":"brittany.wald@joyent.com","username":"princesspretzel"},"message":"Why use fromSeed here?  The documentation recommends passing a random seed into nacl.sign.keyPair().  Is that not possible from curve25519 to ed25519?"},{"file":"lib/private-key.js","line":120,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"nacl.sign.keyPair() takes no arguments. What the documentation is referring to is that if you call that function, it generates the random seed for you (rather than requiring you to figure out how to securely generate it yourself).\n\nThe nacl.sign.keyPair.fromSecretKey() takes in a 64-byte input and splits off the last 32 bits (since in tweetnacl, like djb\u0027s reference impl of EdDSA, the \"private\" key contains the public key on the end of it). We don\u0027t have the public key, we are trying to generate it, so we need to use nacl.sign.keyPair.fromSeed.\n\nSee also https://github.com/dchest/tweetnacl-js/blob/master/nacl.js#L1083"},{"file":"lib/private-key.js","line":120,"reviewer":{"name":"Brittany Wald","email":"brittany.wald@joyent.com","username":"princesspretzel"},"message":"Thank you for that explanation! I could be misreading, but it looks like `priv` will only be 32 bytes (`slice`d on line 98) when it needs to be passed into `nacl.sign.keyPair.fromSecretKey()` (on line 100) at 64 bytes."},{"file":"lib/private-key.js","line":120,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Yes. That\u0027s exactly why we\u0027re using .fromSeed(), not .fromSecretKey()"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/dhe.js","type":"MODIFIED","insertions":17,"deletions":-15},{"file":"lib/private-key.js","type":"MODIFIED","insertions":12,"deletions":-12},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-2}],"sizeInsertions":30,"sizeDeletions":-29},{"number":"2","revision":"9cf6f621887bf7206c0f536b1b80e6dcb28f45f2","parents":["61aa61683a0c8211641423843018aae1b3691bb7"],"ref":"refs/changes/11/1911/2","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1495753011,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1495753036,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/dhe.js","line":13,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"This line\u0027s now unused."},{"file":"lib/dhe.js","line":13,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Done"},{"file":"lib/private-key.js","line":86,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"What\u0027s the purpose of newSize? It doesn\u0027t look like it was used before or after, match an interface, or get used in the tests."},{"file":"lib/private-key.js","line":86,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"I... wow. Why *is* that there? I\u0027m gonna remove it."},{"file":"test/dhe.js","line":13,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"What\u0027s NG2_KEY for?"},{"file":"test/dhe.js","line":13,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Redundancy. Gotta have extra variables, in case some of the ones that are actually being used break."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"lib/dhe.js","type":"MODIFIED","insertions":17,"deletions":-15},{"file":"lib/key.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/private-key.js","type":"MODIFIED","insertions":12,"deletions":-12},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-2},{"file":"test/assets/ed25519-negative","type":"ADDED","insertions":7,"deletions":0},{"file":"test/dhe.js","type":"MODIFIED","insertions":14,"deletions":0}],"sizeInsertions":52,"sizeDeletions":-30},{"number":"3","revision":"0c1a12335c8db627b78814f928d7b59312dbdc99","parents":["61aa61683a0c8211641423843018aae1b3691bb7"],"ref":"refs/changes/11/1911/3","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1496886246,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1496887338,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1496886271,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"lib/dhe.js","type":"MODIFIED","insertions":17,"deletions":-16},{"file":"lib/key.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/private-key.js","type":"MODIFIED","insertions":13,"deletions":-14},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-2},{"file":"test/assets/ed25519-negative","type":"ADDED","insertions":7,"deletions":0},{"file":"test/dhe.js","type":"MODIFIED","insertions":14,"deletions":0}],"sizeInsertions":53,"sizeDeletions":-33},{"number":"4","revision":"9d868d99fbbb0300a8698812f4dece61291cc165","parents":["78cf827bcebfb73ff1a3a6369f9c66693ec33457"],"ref":"refs/changes/11/1911/4","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1496887809,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1496887338,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1496886271,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"lib/dhe.js","type":"MODIFIED","insertions":17,"deletions":-16},{"file":"lib/key.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/private-key.js","type":"MODIFIED","insertions":13,"deletions":-14},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-2},{"file":"test/assets/ed25519-negative","type":"ADDED","insertions":7,"deletions":0},{"file":"test/dhe.js","type":"MODIFIED","insertions":14,"deletions":0}],"sizeInsertions":53,"sizeDeletions":-33},{"number":"5","revision":"a17ec8861242649038dcdba8f8d7df5edf2ddb8c","parents":["78cf827bcebfb73ff1a3a6369f9c66693ec33457"],"ref":"refs/changes/11/1911/5","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1496887831,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1496887338,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1496888069,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"SUBM","value":"1","grantedOn":1496888071,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1496886271,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/dhe.js","type":"MODIFIED","insertions":17,"deletions":-16},{"file":"lib/key.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/private-key.js","type":"MODIFIED","insertions":13,"deletions":-14},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-2},{"file":"test/assets/ed25519-negative","type":"ADDED","insertions":7,"deletions":0},{"file":"test/dhe.js","type":"MODIFIED","insertions":14,"deletions":0}],"sizeInsertions":53,"sizeDeletions":-33}],"allReviewers":[{"name":"Brittany Wald","email":"brittany.wald@joyent.com","username":"princesspretzel"},{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}]}