{"project":"joyent/moray","branch":"master","topic":"MORAY-389","id":"I46b2c391785792e1cad779e104f296857da0863d","number":"1454","subject":"MORAY-389 Limit which modules triggers are allowed to require Reviewed by: David Pacheco \u003cdap@joyent.com\u003e Reviewed by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e Approved by: Joshua M. Clulow \u003cjmc@joyent.com\u003e","owner":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"url":"https://cr.joyent.us/1454","commitMessage":"MORAY-389 Limit which modules triggers are allowed to require\nReviewed by: David Pacheco \u003cdap@joyent.com\u003e\nReviewed by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e\nApproved by: Joshua M. Clulow \u003cjmc@joyent.com\u003e\n","createdOn":1486435370,"lastUpdated":1504655950,"open":false,"status":"MERGED","comments":[{"timestamp":1486435370,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 1."},{"timestamp":1486435516,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1486435595,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 2: Patch Set 1 was rebased."},{"timestamp":1486497665,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 3."},{"timestamp":1486497697,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1486498032,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Topic set to MORAY-389"},{"timestamp":1486502198,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 3: Code-Review+1\n\nI don\u0027t feel I have a great grasp of the consequences of using \"vm\" here instead of \"eval\" (other than performance), though all things being equal, it seems much better.\n\nIt may also be worthwhile to better document the environment in which triggers are evaluated and executed."},{"timestamp":1486587612,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 3: Code-Review+1\n\nI agree with dap about it being difficult to know the scope of the eval-\u003evm difference.  At the very least, it would be nice to get some performance testing in to ensure that we have introduced a regression of unacceptable magnitude.  Checking all of the hooks which are present in COAL/Manta would also be nice."},{"timestamp":1486590840,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 3:\n\nThe biggest consequence is instanceof will not always behave as expected for values constructed in the trigger\u0027s context and tested outside of it. For example, if a regular expression is constructed inside the trigger, then instanceof RegExp will fail outside of it. (This is why I passed in Error, so that constructed errors can be handled correctly.)\n\nAIUI, there should be no performance difference between eval and vm, but I\u0027ll collect some data on this."},{"timestamp":1486604093,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 3:\n\nI\u0027ve placed notes on the performance differences between eval() and vm.runInNewContext() in the ticket. The conclusion is that there is a difference in performance: it\u0027s about 30-80% slower in the new image."},{"timestamp":1486691355,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 3:\n\nIt would be nice if a note were made about this in the cueball internals document, but I think it\u0027d be fine if that were done in a separate commit."},{"timestamp":1486691387,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 3:\n\n(The above was meant for the CR one tab over. Ignore.)"},{"timestamp":1490218228,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 4: Patch Set 3 was rebased."},{"timestamp":1490218276,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4:\n\n\"make check\" passed ok"},{"timestamp":1494019776,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 5: Patch Set 4 was rebased."},{"timestamp":1494019801,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5:\n\n\"make check\" passed ok"},{"timestamp":1494019815,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 6: Commit message was updated."},{"timestamp":1497571264,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 7: Patch Set 6 was rebased."},{"timestamp":1497571300,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 7:\n\n\"make check\" passed ok"},{"timestamp":1501107227,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 8: Patch Set 7 was rebased."},{"timestamp":1501107268,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 8:\n\n\"make check\" passed ok"},{"timestamp":1501630719,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 9: Patch Set 8 was rebased."},{"timestamp":1501630750,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 9:\n\n\"make check\" passed ok"},{"timestamp":1504647361,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Patch Set 9: Integration-Approval+1"},{"timestamp":1504649977,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 10: Commit message was updated."},{"timestamp":1504655950,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Cody Peter Mello"}],"currentPatchSet":{"number":"10","revision":"46b2c391785792e1cad779e104f296857da0863d","parents":["a4922741eddd45567e10640c70c9868461b39e18"],"ref":"refs/changes/54/1454/10","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1504649977,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1486497697,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1486502198,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1486587612,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1504647361,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}},{"type":"SUBM","value":"1","grantedOn":1504655950,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"lib/errors.js","type":"MODIFIED","insertions":13,"deletions":0},{"file":"lib/objects/common.js","type":"MODIFIED","insertions":54,"deletions":-11}],"sizeInsertions":67,"sizeDeletions":-11},"patchSets":[{"number":"1","revision":"d53514b993f5d7eccebb479d2b62898a98fce23e","parents":["4a3e7757b234cb99ead19190bcbab7db58f7ba1f"],"ref":"refs/changes/54/1454/1","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1486435370,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1486435516,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/objects/common.js","type":"MODIFIED","insertions":53,"deletions":-11}],"sizeInsertions":53,"sizeDeletions":-11},{"number":"2","revision":"5c47e033e2efa64d90d28601d3bb948ced3cfe0a","parents":["5b17e7488c70d96b6c2daf458af4b69a0f1bfdf7"],"ref":"refs/changes/54/1454/2","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1486435595,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"NO_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1486435516,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/objects/common.js","type":"MODIFIED","insertions":53,"deletions":-11}],"sizeInsertions":53,"sizeDeletions":-11},{"number":"3","revision":"85d238e889d9fbc87861679b14700d5448beeba2","parents":["5b17e7488c70d96b6c2daf458af4b69a0f1bfdf7"],"ref":"refs/changes/54/1454/3","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1486497665,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1486502198,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1486497697,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1486587612,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/errors.js","type":"MODIFIED","insertions":13,"deletions":0},{"file":"lib/objects/common.js","type":"MODIFIED","insertions":54,"deletions":-11}],"sizeInsertions":67,"sizeDeletions":-11},{"number":"4","revision":"df1c5109770bb91e746c683565e7923ec44b81b2","parents":["ca25766c9550646c6d8c65edc0c098f7a37275ea"],"ref":"refs/changes/54/1454/4","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1490218228,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1486502198,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1486497697,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1486587612,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/errors.js","type":"MODIFIED","insertions":13,"deletions":0},{"file":"lib/objects/common.js","type":"MODIFIED","insertions":54,"deletions":-11}],"sizeInsertions":67,"sizeDeletions":-11},{"number":"5","revision":"f5923aa18ef577e770258a5ee61d200ec4d964af","parents":["a430d077084f6a2581a37c3c05785a0c2a4f868f"],"ref":"refs/changes/54/1454/5","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1494019776,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1486502198,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1486497697,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1486587612,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/errors.js","type":"MODIFIED","insertions":13,"deletions":0},{"file":"lib/objects/common.js","type":"MODIFIED","insertions":54,"deletions":-11}],"sizeInsertions":67,"sizeDeletions":-11},{"number":"6","revision":"1506cd2033a497507b29fd18975a49a3394e9d23","parents":["a430d077084f6a2581a37c3c05785a0c2a4f868f"],"ref":"refs/changes/54/1454/6","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1494019815,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1486502198,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1486497697,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1486587612,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/errors.js","type":"MODIFIED","insertions":13,"deletions":0},{"file":"lib/objects/common.js","type":"MODIFIED","insertions":54,"deletions":-11}],"sizeInsertions":67,"sizeDeletions":-11},{"number":"7","revision":"0fa60aa75ad629f71b25c5644a637de00c415038","parents":["8a031d771b65de4f90064b5a598ec799a107e043"],"ref":"refs/changes/54/1454/7","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1497571264,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1486502198,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1486497697,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1486587612,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/errors.js","type":"MODIFIED","insertions":13,"deletions":0},{"file":"lib/objects/common.js","type":"MODIFIED","insertions":54,"deletions":-11}],"sizeInsertions":67,"sizeDeletions":-11},{"number":"8","revision":"babef57ae733136084b7c72d28c365a038cb4f46","parents":["fb4bc8ff3756b150c2f3604f905189c578eac5e9"],"ref":"refs/changes/54/1454/8","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1501107227,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1486502198,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1486497697,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1486587612,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/errors.js","type":"MODIFIED","insertions":13,"deletions":0},{"file":"lib/objects/common.js","type":"MODIFIED","insertions":54,"deletions":-11}],"sizeInsertions":67,"sizeDeletions":-11},{"number":"9","revision":"ea7c40cca0d6e8df6887e87f11208fddcf9bb0e6","parents":["2814dc317b7d42e11ab041c15df63bd499bb0cc0"],"ref":"refs/changes/54/1454/9","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1501630719,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1486502198,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1504647361,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1486497697,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1486587612,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/errors.js","type":"MODIFIED","insertions":13,"deletions":0},{"file":"lib/objects/common.js","type":"MODIFIED","insertions":54,"deletions":-11}],"sizeInsertions":67,"sizeDeletions":-11},{"number":"10","revision":"46b2c391785792e1cad779e104f296857da0863d","parents":["a4922741eddd45567e10640c70c9868461b39e18"],"ref":"refs/changes/54/1454/10","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1504649977,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1486502198,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"SUBM","value":"1","grantedOn":1504655950,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1504647361,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1486497697,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1486587612,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"lib/errors.js","type":"MODIFIED","insertions":13,"deletions":0},{"file":"lib/objects/common.js","type":"MODIFIED","insertions":54,"deletions":-11}],"sizeInsertions":67,"sizeDeletions":-11}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}]}