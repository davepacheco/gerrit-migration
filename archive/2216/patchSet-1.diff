From 878b9f3ef30904958853d06bd0d25eca3dc3efd5 Mon Sep 17 00:00:00 2001
From: Hans Rosenfeld <hans.rosenfeld@joyent.com>
Date: Thu, 13 Jul 2017 17:40:13 +0200
Subject: [PATCH] OS-6233 want ddi_ffsll, ddi_flsll

---
 usr/src/uts/common/os/sunddi.c  | 16 ++++++++++++++--
 usr/src/uts/common/sys/sunddi.h |  6 ++++++
 2 files changed, 20 insertions(+), 2 deletions(-)

diff --git a/usr/src/uts/common/os/sunddi.c b/usr/src/uts/common/os/sunddi.c
index ede7da413b..31b27837e0 100644
--- a/usr/src/uts/common/os/sunddi.c
+++ b/usr/src/uts/common/os/sunddi.c
@@ -5903,6 +5903,12 @@ ddi_ffs(long mask)
 	return (ffs(mask));
 }
 
+int
+ddi_ffsll(long long mask)
+{
+	return (ffs(mask));
+}
+
 /*
  * Find last bit set. Take mask and clear
  * all but the most significant bit, and
@@ -5913,15 +5919,21 @@ ddi_ffs(long mask)
 
 int
 ddi_fls(long mask)
+{
+	return (ddi_flsll(mask));
+}
+
+int
+ddi_flsll(long long mask)
 {
 	while (mask) {
-		long nx;
+		long long nx;
 
 		if ((nx = (mask & (mask - 1))) == 0)
 			break;
 		mask = nx;
 	}
-	return (ffs(mask));
+	return (ffsll(mask));
 }
 
 /*
diff --git a/usr/src/uts/common/sys/sunddi.h b/usr/src/uts/common/sys/sunddi.h
index 1d94c8fd2c..b260971a89 100644
--- a/usr/src/uts/common/sys/sunddi.h
+++ b/usr/src/uts/common/sys/sunddi.h
@@ -1584,9 +1584,15 @@ ddi_streams_driver(dev_info_t *dip);
 int
 ddi_ffs(long mask);
 
+int
+ddi_ffsll(long long mask);
+
 int
 ddi_fls(long mask);
 
+int
+ddi_flsll(long long mask);
+
 /*
  * The ddi_soft_state* routines comprise generic storage management utilities
  * for driver soft state structures.  Two types of soft_state indexes are
-- 
2.21.0

