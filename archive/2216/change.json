{"project":"joyent/illumos-joyent","branch":"master","id":"Ied746ba045fa03d861d644c61bce66b86a734b5f","number":"2216","subject":"OS-6233 want ddi_ffsll, ddi_flsll Reviewed by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e Reviewed by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e Approved by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e","owner":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"url":"https://cr.joyent.us/2216","commitMessage":"OS-6233 want ddi_ffsll, ddi_flsll\nReviewed by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e\nReviewed by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e\nApproved by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e\n","createdOn":1500031830,"lastUpdated":1500627592,"open":false,"status":"MERGED","comments":[{"timestamp":1500031830,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Uploaded patch set 1."},{"timestamp":1500036217,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Uploaded patch set 2."},{"timestamp":1500038282,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 2:\n\nAren\u0027t these new functions going to behave incorrectly on a 32-bit kernel?\nShouldn\u0027t there be man page updates for these?"},{"timestamp":1500039067,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Patch Set 2:\n\n\u003e Aren\u0027t these new functions going to behave incorrectly on a 32-bit\n \u003e kernel?\n \u003e Shouldn\u0027t there be man page updates for these?\n\nWhat incorrect behavior would you expect on a 32-bit kernel?\n\nYes, manpage updates will be necessary. I\u0027ll include them in the next update of the patch."},{"timestamp":1500040625,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 2:\n\n\u003e What incorrect behavior would you expect on a 32-bit kernel?\n\nIt looks like ffs is defined to take arg_t as its argument type and that is in turn defined to be a uintmax_t. If I am following the chain of #defines correctly, that looks like it will be a uint32_t (if we\u0027re not using _INT64_TYPE, which I think is the case on a 32-bit kernel). So if I\u0027m following this correctly, you pass a long long in, but then call a function which takes an int argument and thus will only look at the low 32 bits of the original long long. If I haven\u0027t followed this correctly, just let me know."},{"timestamp":1500041524,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Patch Set 2:\n\n\u003e \u003e What incorrect behavior would you expect on a 32-bit kernel?\n \u003e \n \u003e It looks like ffs is defined to take arg_t as its argument type and\n \u003e that is in turn defined to be a uintmax_t. If I am following the\n \u003e chain of #defines correctly, that looks like it will be a uint32_t\n \u003e (if we\u0027re not using _INT64_TYPE, which I think is the case on a\n \u003e 32-bit kernel). So if I\u0027m following this correctly, you pass a long\n \u003e long in, but then call a function which takes an int argument and\n \u003e thus will only look at the low 32 bits of the original long long.\n \u003e If I haven\u0027t followed this correctly, just let me know.\n\nMy understanding is that even on a 32-bit kernel a uintmax_t will be a uint64_t, as long as the compiler supports it. Thats what _INT64_TYPE and _LONG_LONG_TYPE do, they check for the availability of a 64bit integer type in the compiler. I think thats always true nowadays and we depend on it in other places, and if it wasn\u0027t the compiler would choke already on the long long in sunddi.h.\n\nOn the other hand that might mean I need to wrap it in #ifdef _LONG_LONG_TYPE, but I\u0027d prefer not having to."},{"timestamp":1500041791,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 2:\n\nOK, thanks for the clarification on the _INT64_TYPE behavior. I think you just need to add the man page and I\u0027ll take another look at this."},{"timestamp":1500047020,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Uploaded patch set 3."},{"timestamp":1500073184,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1500489036,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 3:\n\nThe code changes look good.  Would it be too much to ask for a webrev in order to compare the rendered manpage changes?"},{"timestamp":1500496504,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Patch Set 3:\n\n\u003e The code changes look good.  Would it be too much to ask for a\n \u003e webrev in order to compare the rendered manpage changes?\n\nhttps://grumpf.hope-2000.org/os-6233/"},{"timestamp":1500571032,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1500571603,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 3: Integration-Approval+1"},{"timestamp":1500626233,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Patch Set 4: Patch Set 3 was rebased"},{"timestamp":1500626995,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Uploaded patch set 5: Commit message was updated."},{"timestamp":1500627592,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Hans Rosenfeld"}],"currentPatchSet":{"number":"5","revision":"ed746ba045fa03d861d644c61bce66b86a734b5f","parents":["c9254ee5521e8eeed03d6346a57472e239fce71a"],"ref":"refs/changes/16/2216/5","uploader":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"createdOn":1500626995,"author":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1500073184,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1500571032,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1500571603,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"SUBM","value":"1","grantedOn":1500627592,"by":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/man/man9f/Makefile","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/man/man9f/ddi_ffs.9f","type":"MODIFIED","insertions":89,"deletions":-68},{"file":"usr/src/pkg/manifests/system-kernel.man9f.inc","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/uts/common/os/sunddi.c","type":"MODIFIED","insertions":13,"deletions":-1},{"file":"usr/src/uts/common/sys/sunddi.h","type":"MODIFIED","insertions":6,"deletions":0}],"sizeInsertions":116,"sizeDeletions":-69},"patchSets":[{"number":"1","revision":"878b9f3ef30904958853d06bd0d25eca3dc3efd5","parents":["3402a4505415d6c3deedce572627d511ee4dbb31"],"ref":"refs/changes/16/2216/1","uploader":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"createdOn":1500031830,"author":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/os/sunddi.c","type":"MODIFIED","insertions":14,"deletions":-2},{"file":"usr/src/uts/common/sys/sunddi.h","type":"MODIFIED","insertions":6,"deletions":0}],"sizeInsertions":20,"sizeDeletions":-2},{"number":"2","revision":"29a6fa1d8afd24ab1293bfb49e1ff6d5ce3a3410","parents":["3402a4505415d6c3deedce572627d511ee4dbb31"],"ref":"refs/changes/16/2216/2","uploader":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"createdOn":1500036217,"author":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/os/sunddi.c","type":"MODIFIED","insertions":13,"deletions":-1},{"file":"usr/src/uts/common/sys/sunddi.h","type":"MODIFIED","insertions":6,"deletions":0}],"sizeInsertions":19,"sizeDeletions":-1},{"number":"3","revision":"997de573cbaceb370b2facaa0faf16f7e1163397","parents":["3402a4505415d6c3deedce572627d511ee4dbb31"],"ref":"refs/changes/16/2216/3","uploader":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"createdOn":1500047020,"author":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1500073184,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1500571603,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1500571032,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/man/man9f/Makefile","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/man/man9f/ddi_ffs.9f","type":"MODIFIED","insertions":89,"deletions":-68},{"file":"usr/src/pkg/manifests/system-kernel.man9f.inc","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/uts/common/os/sunddi.c","type":"MODIFIED","insertions":13,"deletions":-1},{"file":"usr/src/uts/common/sys/sunddi.h","type":"MODIFIED","insertions":6,"deletions":0}],"sizeInsertions":116,"sizeDeletions":-69},{"number":"4","revision":"9544a778121a1634616d12cf2c7fca38199d156f","parents":["c9254ee5521e8eeed03d6346a57472e239fce71a"],"ref":"refs/changes/16/2216/4","uploader":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"createdOn":1500626233,"author":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1500073184,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1500571603,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1500571032,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/man/man9f/Makefile","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/man/man9f/ddi_ffs.9f","type":"MODIFIED","insertions":89,"deletions":-68},{"file":"usr/src/pkg/manifests/system-kernel.man9f.inc","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/uts/common/os/sunddi.c","type":"MODIFIED","insertions":13,"deletions":-1},{"file":"usr/src/uts/common/sys/sunddi.h","type":"MODIFIED","insertions":6,"deletions":0}],"sizeInsertions":116,"sizeDeletions":-69},{"number":"5","revision":"ed746ba045fa03d861d644c61bce66b86a734b5f","parents":["c9254ee5521e8eeed03d6346a57472e239fce71a"],"ref":"refs/changes/16/2216/5","uploader":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"createdOn":1500626995,"author":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1500073184,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1500571603,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1500571032,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"SUBM","value":"1","grantedOn":1500627592,"by":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/man/man9f/Makefile","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/man/man9f/ddi_ffs.9f","type":"MODIFIED","insertions":89,"deletions":-68},{"file":"usr/src/pkg/manifests/system-kernel.man9f.inc","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/uts/common/os/sunddi.c","type":"MODIFIED","insertions":13,"deletions":-1},{"file":"usr/src/uts/common/sys/sunddi.h","type":"MODIFIED","insertions":6,"deletions":0}],"sizeInsertions":116,"sizeDeletions":-69}],"allReviewers":[{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"}]}