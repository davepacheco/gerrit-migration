commit da961d1b70ca7de3ef574593aca34d69557c61ac (refs/changes/45/2245/4)
Author: Todd Whiteman <todd.whiteman@joyent.com>
Date:   2017-10-25T16:14:40+00:00 (1 year, 11 months ago)
    
    HEAD-2363 Allow coal vm resizing on Linux

diff --git a/bin/build-coal-image b/bin/build-coal-image
index 746ee871..2134307e 100755
--- a/bin/build-coal-image
+++ b/bin/build-coal-image
@@ -345,8 +345,9 @@ function create_output
     coal_zpool_disk_size=$(build_spec coal-zpool-disk-size)
     # BEGIN BASHSTYLED
     if [[ -n ${coal_zpool_disk_size} ]]; then
-        if [[ -x "/Applications/VMware Fusion.app/Contents/Library/vmware-vdiskmanager" ]]; then
-            /Applications/VMware\ Fusion.app/Contents/Library/vmware-vdiskmanager \
+        vdiskmanager=$(which vmware-vdiskmanager || echo "/Applications/VMware Fusion.app/Contents/Library/vmware-vdiskmanager")
+        if [[ -x "${vdiskmanager}" ]]; then
+            "${vdiskmanager}" \
                 -x ${coal_zpool_disk_size}GB ${STAGE}/USB-headnode.vmwarevm/zpool.vmdk
         else
             echo " !!! WARNING !!! Cannot resize zpool disk with missing vmware-vdiskmanager!" >&2
