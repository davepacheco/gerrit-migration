commit 09e1baa79447f37cdca76c864d31ddf77734106a (refs/changes/98/998/1)
Author: Chris Burroughs <chris.burroughs@joyent.com>
Date:   2016-11-30T13:56:05-05:00 (2 years, 10 months ago)
    
    ./bin/triton image get base-32

diff --git a/lib/do_image/do_get.js b/lib/do_image/do_get.js
index 4e22268..b09075f 100644
--- a/lib/do_image/do_get.js
+++ b/lib/do_image/do_get.js
@@ -12,6 +12,7 @@
 
 var format = require('util').format;
 
+var common = require('../common');
 var errors = require('../errors');
 
 
@@ -24,17 +25,23 @@ function do_get(subcmd, opts, args, callback) {
             'incorrect number of args (%d)', args.length)));
     }
 
-    this.top.tritonapi.getImage(args[0], function onRes(err, img) {
-        if (err) {
-            return callback(err);
+    var tritonapi = this.top.tritonapi;
+    common.cliSetupTritonApi({cli: this.top}, function onSetup(setupErr) {
+        if (setupErr) {
+            callback(setupErr);
         }
+        tritonapi.getImage(args[0], function onRes(err, img) {
+            if (err) {
+                return callback(err);
+            }
 
-        if (opts.json) {
-            console.log(JSON.stringify(img));
-        } else {
-            console.log(JSON.stringify(img, null, 4));
-        }
-        callback();
+            if (opts.json) {
+                console.log(JSON.stringify(img));
+            } else {
+                console.log(JSON.stringify(img, null, 4));
+            }
+            callback();
+        });
     });
 }
 
