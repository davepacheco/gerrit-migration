{"project":"joyent/illumos-joyent","branch":"master","id":"I175e9b5e7534aad7d965dc4a8c6e9b0dd8e6f1f0","number":"6778","subject":"OS-5553 Want NVMe Hotplug Support OS-7968 x86 pci configurator should not fail device teardown if device is gone OS-7969 DDI hotplug request handler resets connection handle state before performing state change operations OS-7691 ldi_handle dcmd segfaults","owner":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"url":"https://cr.joyent.us/6778","commitMessage":"OS-5553 Want NVMe Hotplug Support\nOS-7968 x86 pci configurator should not fail device teardown if device is gone\nOS-7969 DDI hotplug request handler resets connection handle state before performing state change operations\nOS-7691 ldi_handle dcmd segfaults occasionally\nReviewed by: Robert Mustacchi \u003crm@joyent.com\u003e\nReviewed by: Rob Johnston \u003crob.johnston@joyent.com\u003e\nApproved by: Joshua M. Clulow \u003cjmc@joyent.com\u003e\n","createdOn":1565379643,"lastUpdated":1566932065,"open":false,"status":"MERGED","comments":[{"timestamp":1565379643,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Uploaded patch set 1."},{"timestamp":1565388499,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1565637376,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 1:\n\n(60 comments)\n\nThanks for putting this together. I know there\u0027s still some stuff to work through, but I\u0027ve tried to put together an initial pass of feedback. I think it might be useful to file some bugs about the other issues we hit in the PCIe hotplug state machine and the PCIe teardown path where we failed to setup pci config space. All in all, this looks like a great start."},{"timestamp":1565924589,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Uploaded patch set 2."},{"timestamp":1565925077,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Patch Set 2:\n\n(61 comments)\n\nThanks for your thorough review, Robert. I appreciate it!\n\nI responded to all of your comments, and I believe I\u0027ve addressed most of your feedback. There were a few items that I would like to chat about in person if that\u0027s okay, and a few that I had some follow up questions on. If there\u0027s anything else that it seems like I missed it, please let me know that, too."},{"timestamp":1565999469,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Uploaded patch set 3."},{"timestamp":1565999629,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Patch Set 3:\n\n(10 comments)\n\nAfter we synced up in person today, I took another pass. I am ready for you to look at it again. Thanks!"},{"timestamp":1566221774,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Uploaded patch set 4."},{"timestamp":1566221921,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Patch Set 4:\n\nIn PS 4 I added some notes to the npe block comment about NDI_EVENT_NOPASS, as I\u0027ve started to update that.\n\nI\u0027ve also started an (incomplete) big theory statement on how the hotplug framework fits together in uts/common/os/ddi_hp_impl.c. I\u0027ve been sourcing material for that from my own research of the code base and from the hotplug\u0027s PSARC case (http://us-east.manta.joyent.com/jmc/public/opensolaris/ARChive/PSARC/2008/181/inception.materials/shp-overview.pdf). You can ignore that comment until I finish fleshing it out."},{"timestamp":1566221950,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Patch Set 4:\n\n\u003e In PS 4 I added some notes to the npe block comment about NDI_EVENT_NOPASS, as I\u0027ve started to update that.\n\nWhoops, I meant: \"as I forgot to update that.\""},{"timestamp":1566227573,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Uploaded patch set 5."},{"timestamp":1566227731,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Patch Set 5:\n\n\u003e I\u0027ve also started an (incomplete) big theory statement on how the hotplug framework fits together in uts/common/os/ddi_hp_impl.c. I\u0027ve been sourcing material for that from my own research of the code base and from the hotplug\u0027s PSARC case (http://us-east.manta.joyent.com/jmc/public/opensolaris/ARChive/PSARC/2008/181/inception.materials/shp-overview.pdf). You can ignore that comment until I finish fleshing it out.\n\nI\u0027m ready for review on the block comment.\n\n\nAdditionally, I\u0027ve addressed all other feedback in PS 3 (except for adding a comment about NDI_EVENT_NOPASS, which I pushed in PS4), so all of this is ready for review. Sorry for the CR churn!"},{"timestamp":1566235065,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 5:\n\n(23 comments)\n\nThanks for all the updates and in particular all of the comments. They were all really great to have there and I can already see them answering questions that future us will have."},{"timestamp":1566428697,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Patch Set 5:\n\n(3 comments)\n\nThis looks really great.  I flagged a couple nits in ddi_hp_impl.c.  Other than that, I don\u0027t any comments beyond what rm has already noted."},{"timestamp":1566514631,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Uploaded patch set 6."},{"timestamp":1566515396,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Uploaded patch set 7."},{"timestamp":1566515512,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Patch Set 7:\n\n(22 comments)\n\nThanks to you both for your review! With PS7, I believe I\u0027ve addressed all feedback so far. Please let me know if I missed something.\n\nI also decided to take a different approach to the state change issues in ddi_hp_impl.c and ddi_hp_ndi.c. To see more details about that, see OS-7969 and the new comment in ddi_hp_ndi.c."},{"timestamp":1566584379,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 7:\n\n(2 comments)"},{"timestamp":1566592178,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Uploaded patch set 8."},{"timestamp":1566592235,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Patch Set 8:\n\n(1 comment)"},{"timestamp":1566592262,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Patch Set 8:\n\nPS 8 just has 2 changes to comments. Most of the changes since the last pass of review are in PS7."},{"timestamp":1566844792,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 8: Code-Review+1"},{"timestamp":1566851923,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Patch Set 8: Code-Review+1"},{"timestamp":1566931289,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Patch Set 8: Integration-Approval+1\n\nThank you for the extremely detailed testing plan!  This is a huge and important body of work -- thank you for sticking with it.  I approve!"},{"timestamp":1566931878,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Uploaded patch set 9: Patch Set 8 was rebased."},{"timestamp":1566931981,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Uploaded patch set 10: Commit message was updated."},{"timestamp":1566932065,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Jordan Hendricks"}],"currentPatchSet":{"number":"10","revision":"175e9b5e7534aad7d965dc4a8c6e9b0dd8e6f1f0","parents":["ba347c6543e6ff6ffba5d804e1705af24514e945"],"ref":"refs/changes/78/6778/10","uploader":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"createdOn":1566931981,"author":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1566844792,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1566851923,"by":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1566931289,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}},{"type":"SUBM","value":"1","grantedOn":1566932065,"by":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":13,"deletions":0},{"file":"usr/src/cmd/fm/modules/common/fabric-xlate/fabric-xlate.h","type":"MODIFIED","insertions":28,"deletions":-3},{"file":"usr/src/cmd/fm/modules/common/fabric-xlate/fx_fabric.c","type":"MODIFIED","insertions":54,"deletions":-1},{"file":"usr/src/cmd/fm/modules/common/fabric-xlate/fx_subr.c","type":"MODIFIED","insertions":12,"deletions":-8},{"file":"usr/src/cmd/mdb/common/modules/genunix/ldi.c","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"usr/src/uts/common/io/nvme/nvme.c","type":"MODIFIED","insertions":93,"deletions":-3},{"file":"usr/src/uts/common/io/nvme/nvme_var.h","type":"MODIFIED","insertions":18,"deletions":-7},{"file":"usr/src/uts/common/io/pciex/hotplug/pciehpc.c","type":"MODIFIED","insertions":15,"deletions":0},{"file":"usr/src/uts/common/io/pciex/pcie.c","type":"MODIFIED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/io/pciex/pcie_fault.c","type":"MODIFIED","insertions":71,"deletions":-5},{"file":"usr/src/uts/common/os/ddi_hp_impl.c","type":"MODIFIED","insertions":233,"deletions":-4},{"file":"usr/src/uts/common/os/ddi_hp_ndi.c","type":"MODIFIED","insertions":15,"deletions":-7},{"file":"usr/src/uts/common/sys/ddi_hp.h","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"usr/src/uts/common/sys/ddi_hp_impl.h","type":"MODIFIED","insertions":6,"deletions":0},{"file":"usr/src/uts/common/sys/pcie_impl.h","type":"MODIFIED","insertions":14,"deletions":0},{"file":"usr/src/uts/i86pc/io/pci/pci_common.h","type":"MODIFIED","insertions":11,"deletions":-3},{"file":"usr/src/uts/i86pc/io/pciex/npe.c","type":"MODIFIED","insertions":140,"deletions":-7},{"file":"usr/src/uts/intel/io/hotplug/pcicfg/pcicfg.c","type":"MODIFIED","insertions":30,"deletions":-23}],"sizeInsertions":758,"sizeDeletions":-75},"patchSets":[{"number":"1","revision":"664d5d0b8c901b4326488d3985d6a47cf923f031","parents":["c39031a3421e673ff9e264ef429b207fcde1896c"],"ref":"refs/changes/78/6778/1","uploader":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"createdOn":1565379643,"author":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/cmd/fm/modules/common/fabric-xlate/fabric-xlate.h","line":54,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Accidental *?"},{"file":"usr/src/cmd/fm/modules/common/fabric-xlate/fabric-xlate.h","line":54,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"usr/src/cmd/fm/modules/common/fabric-xlate/fabric-xlate.h","line":142,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"It may be useful to have the comment mention which slot this is. One might not immediately think that this refers to the slot of the parent."},{"file":"usr/src/cmd/fm/modules/common/fabric-xlate/fabric-xlate.h","line":142,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Added a comment above these declarations. Let me know what you think."},{"file":"usr/src/cmd/fm/modules/common/fabric-xlate/fx_fabric.c","line":378,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Extraneous *?"},{"file":"usr/src/cmd/fm/modules/common/fabric-xlate/fx_fabric.c","line":378,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"usr/src/cmd/fm/modules/common/fabric-xlate/fx_fabric.c","line":393,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"One thing that\u0027s not clear to me is how this works when these fields weren\u0027t passed down. In the case that we don\u0027t have any of the slot related registers, they\u0027ll be zero. This means that this may always trigger regardless if it was because it was actually not present or because we couldn\u0027t gather those registers."},{"file":"usr/src/cmd/fm/modules/common/fabric-xlate/fx_fabric.c","line":393,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Yes, I see what you mean. Could we sync up about this one in person?"},{"file":"usr/src/cmd/fm/modules/common/fabric-xlate/fx_fabric.c","line":393,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"I changed this module to have its own validity bit."},{"file":"usr/src/cmd/fm/modules/common/fabric-xlate/fx_subr.c","line":189,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Minor thing, but you want another tab here to line it up with the above."},{"file":"usr/src/cmd/fm/modules/common/fabric-xlate/fx_subr.c","line":189,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Sure -- I wasn\u0027t sure whether to be consistent with the visual lineup or the number of tabs (the above lines only have 1 afaict)."},{"file":"usr/src/cmd/fm/modules/common/fabric-xlate/fx_subr.c","line":207,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Parens aren\u0027t strictly speaking required for this, but up to you."},{"file":"usr/src/cmd/fm/modules/common/fabric-xlate/fx_subr.c","line":207,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"usr/src/uts/common/io/nvme/nvme.c","line":21,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Presumably we should update the NVMe big theory statement to discuss device removal and how it works."},{"file":"usr/src/uts/common/io/nvme/nvme.c","line":21,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Added a small section. Let me know what you think!"},{"file":"usr/src/uts/common/io/nvme/nvme.c","line":21,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Thanks for adding that. I have a few notes, but it\u0027s a good start!"},{"file":"usr/src/uts/common/io/nvme/nvme.c","line":1021,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Should we really log this to the console every time this happens? If we do want to warn about this, shouldn\u0027t we use dev_err() so that we know which NVMe device it is like the rest of the driver? Also, if we do want it, then we should probably start it with a leading ! character to indicate that it should only go to the system log."},{"file":"usr/src/uts/common/io/nvme/nvme.c","line":1021,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"These were for my own debugging. I took both of them out, but can add them back if you think they should be logged."},{"file":"usr/src/uts/common/io/nvme/nvme.c","line":3197,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Is it safe to assume that we\u0027ll actually always get a valid value from ddi_get_soft_state() in this context?"},{"file":"usr/src/uts/common/io/nvme/nvme.c","line":3197,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"I only see the softstate freed in a detach or _fini. I know this function can\u0027t be called after _fini until after _init is called again, which initializes the softstate. I guess it might be possible to fail in detach, but I\u0027m not sure. If it did fail, we couldn\u0027t set n_dead, and that would mean other things could fail in weird ways.\n\nWhat do you think?"},{"file":"usr/src/uts/common/io/nvme/nvme.c","line":3197,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"(we talked about this one in person)"},{"file":"usr/src/uts/common/io/nvme/nvme.c","line":3202,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Why do we exclude the admin queue? If we had commands outstanding in it, wouldn\u0027t those all fail as well?"},{"file":"usr/src/uts/common/io/nvme/nvme.c","line":3202,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"I suppose there is no reason beyond the fact that we had only talked about failing I/O.\n\nI changed this and retested by doing the dd test during a pull. dd still failed cleanly and it seems to be fine. The only difference is that we see some new console error messages:\n2019-08-14T19:21:11.709024+00:00 nvme nvme: [ID 557305 kern.warning] WARNING: nvme1: async event request returned failure, sct \u003d 0, sc \u003d 0, dnr \u003d 0, m \u003d 0 \n2019-08-14T19:21:11.709038+00:00 nvme nvme: [ID 557305 kern.warning] WARNING: nvme1: async event request returned failure, sct \u003d 0, sc \u003d 0, dnr \u003d 0, m \u003d 0 \n2019-08-14T19:21:11.709081+00:00 nvme nvme: [ID 557305 kern.warning] WARNING: nvme1: async event request returned failure, sct \u003d 0, sc \u003d 0, dnr \u003d 0, m \u003d 0 \n2019-08-14T19:21:11.709115+00:00 nvme nvme: [ID 557305 kern.warning] WARNING: nvme1: async event request returned failure, sct \u003d 0, sc \u003d 0, dnr \u003d 0, m \u003d 0 \n\nI think that\u0027s probably okay though, as it\u0027s not surprising there might be errors to the console when pulling a live disk."},{"file":"usr/src/uts/common/io/nvme/nvme.c","line":3203,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"n_ioq_count is an uint_t; however, i is an int. This is a signed type mismatch. i should be changed to match."},{"file":"usr/src/uts/common/io/nvme/nvme.c","line":3203,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"usr/src/uts/common/io/nvme/nvme.c","line":3207,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"What\u0027s a situation upon which this would happen?"},{"file":"usr/src/uts/common/io/nvme/nvme.c","line":3207,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"It was an extra precaution, but looking at the code that initializes it I don\u0027t think it\u0027s possible."},{"file":"usr/src/uts/common/io/nvme/nvme.c","line":3207,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"usr/src/uts/common/io/nvme/nvme.c","line":3210,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"If we\u0027re going to try and scope the variable and not declare it at the top of the scope, please move it into the the for loop.\n\nAlso, there\u0027s a type mismatch here. j is an int, but nq_entry is a size_t."},{"file":"usr/src/uts/common/io/nvme/nvme.c","line":3210,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"\u003e If we\u0027re going to try and scope the variable and not declare it at the top of the scope, please move it into the the for loop.\n\nI\u0027m not totally sure I understand what you mean. I changed this to declare the variable in the line of the for loop declaration. Please let me know if that\u0027s not what you were referring to.\n\n\u003e Also, there\u0027s a type mismatch here. j is an int, but nq_entry is a size_t.\n\nI changed j to be a size_t."},{"file":"usr/src/uts/common/io/nvme/nvme.c","line":3218,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Why are we ignoring the return value here? Should we make sure that it matches the cmd pointer that we already have?"},{"file":"usr/src/uts/common/io/nvme/nvme.c","line":3218,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"My assumption was that even if the command were different for some reason (it seems like it shouldn\u0027t be), we would still want to wake up the waiting thread from the command queue since that\u0027s the state that we have.\n\nBut I\u0027ve changed it to only call taskq_dispatch_ent if the commands matched, and my dd test still worked."},{"file":"usr/src/uts/common/io/nvme/nvme.c","line":3249,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"When would this ever not be true?"},{"file":"usr/src/uts/common/io/nvme/nvme.c","line":3249,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"I\u0027m not sure. I think I remember running into an issue where it was already set, but now I can\u0027t remember. I suppose if there were 2 concurrent attaches that could happen, but it seems like that is guaranteed not to happen?"},{"file":"usr/src/uts/common/io/nvme/nvme.c","line":3249,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"(we talked about this one in person)"},{"file":"usr/src/uts/common/io/nvme/nvme.c","line":3255,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"So, this should have just been zalloced as part of the ddi_soft_state_zalloc above. Is there some reason that we need to explicitly zero it again here?"},{"file":"usr/src/uts/common/io/nvme/nvme.c","line":3255,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"No, I suppose not. I\u0027m just used to initializing things explicitly, but you\u0027re right that it\u0027s obviously zeroed in this case."},{"file":"usr/src/uts/common/io/nvme/nvme.c","line":3257,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"FWIW, you could pass the nvme_t here as an argument. Then you wouldn\u0027t have to get it via the softstate in the dip."},{"file":"usr/src/uts/common/io/nvme/nvme.c","line":3257,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Great idea, thanks."},{"file":"usr/src/uts/common/io/nvme/nvme.c","line":3480,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Which error handling are you referring to? The failure of ddi_remove_event_handler?"},{"file":"usr/src/uts/common/io/nvme/nvme.c","line":3480,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Yes. If it failed, it seems like the right thing to me would be to continue the detach anyway since a detach requires cleaning up structures and such. But I\u0027m not totally sure if that\u0027s right."},{"file":"usr/src/uts/common/io/nvme/nvme.c","line":3481,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I would probably add a comment here that explains why we don\u0027t have to do anything with n_rm_cookie. Maybe we should explicitly NULL it out to indicate that we\u0027re done with it as part of cleaning up?"},{"file":"usr/src/uts/common/io/nvme/nvme.c","line":3481,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"I thought the explicit NULL setting (which you suggested earlier and was superfluous) would make that clear. I\u0027m pretty indifferent though -- whatever you think is most clear I can do.\n\nI added an explicit NULL out of the handler."},{"file":"usr/src/uts/common/io/nvme/nvme.c","line":3482,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Do you want to NULL out the n_ev_rm_cb_id once we\u0027re done like we do before we use it in attach?"},{"file":"usr/src/uts/common/io/nvme/nvme.c","line":3482,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"(see reply above)"},{"file":"usr/src/uts/common/io/nvme/nvme.c","line":3483,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Conventionally I try to make sure I unwind in the opposite way that I create. So if this is one of the first things we do in attach, it usually becomes one of the last things we do. However, in this case, you may be trying to make sure that the event handler can\u0027t fire, though I suspect that it would be very hard for that to happen in this context."},{"file":"usr/src/uts/common/io/nvme/nvme.c","line":3483,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Yeah, I don\u0027t think I was very conscious about it but that was the idea. I\u0027ll move it toward the end of detach then."},{"file":"usr/src/uts/common/io/nvme/nvme.c","line":3753,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Is there a reason we\u0027re not checking this for nvme-\u003en_dead and failing appropriately?"},{"file":"usr/src/uts/common/io/nvme/nvme.c","line":3753,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"No, not that I know of. I also see that it\u0027s not checked in any of the other bd_ops_t functions. Is there a reason you asked about this one in particular (or should they all be changed?)"},{"file":"usr/src/uts/common/io/nvme/nvme.c","line":3753,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"usr/src/uts/common/io/nvme/nvme.c","line":3778,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"See earlier note about the cmn_err with respect to dev_err, etc."},{"file":"usr/src/uts/common/io/nvme/nvme.c","line":3778,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"(replied to the earlier one)"},{"file":"usr/src/uts/common/io/nvme/nvme.c","line":3838,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Is there a reason that we\u0027re inconsistent about doing the error logging here with this entry point?"},{"file":"usr/src/uts/common/io/nvme/nvme.c","line":3838,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"usr/src/uts/common/io/nvme/nvme.c","line":3894,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"See other note about error logging."},{"file":"usr/src/uts/common/io/nvme/nvme.c","line":3894,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"usr/src/uts/common/io/nvme/nvme_var.h","line":79,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"If we\u0027re going to comment some of these, should we comment all of them? It\u0027s not clear why we\u0027d leave it only partially commented. Presumably you commented the ones that weren\u0027t immediately clear to you. I expect that the others will be true for other people just starting."},{"file":"usr/src/uts/common/io/nvme/nvme_var.h","line":79,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Sorry, nearly all of these comments were notes for myself. I\u0027ve deleted a bunch."},{"file":"usr/src/uts/common/io/nvme/nvme_var.h","line":111,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"// comments aren\u0027t allowed per cstyle. Did cstyle / git pbchk not complain about this?"},{"file":"usr/src/uts/common/io/nvme/nvme_var.h","line":111,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"(another note for myself - deleting)"},{"file":"usr/src/uts/common/io/nvme/nvme_var.h","line":130,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Aren\u0027t these shared and thus not really part of the completion fields? The comment kind of makes it seem like they are. It\u0027s not clear if the white space tries to make it say that the block ends or not."},{"file":"usr/src/uts/common/io/nvme/nvme_var.h","line":130,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"usr/src/uts/common/io/nvme/nvme_var.h","line":130,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"FWIW, I found the fact that we had labeled the submission and completion parts useful."},{"file":"usr/src/uts/common/io/nvme/nvme_var.h","line":130,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Okay, I added them back and a little more on the members you had asked about as well."},{"file":"usr/src/uts/common/io/nvme/nvme_var.h","line":134,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Is there a reason these were added at the top of the structure?"},{"file":"usr/src/uts/common/io/nvme/nvme_var.h","line":134,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"I moved them down and added a comment."},{"file":"usr/src/uts/common/io/nvme/nvme_var.h","line":148,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Probably want to do this TODO."},{"file":"usr/src/uts/common/io/nvme/nvme_var.h","line":148,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"I added something brief in a comment but I\u0027m not sure I stand behind it :P\n\nMind if we sync up about this one?"},{"file":"usr/src/uts/common/io/pciex/pcie_fault.c","line":594,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"This deletion was accidental. I will put it back in the next PS."},{"file":"usr/src/uts/common/io/pciex/pcie_fault.c","line":594,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"usr/src/uts/common/io/pciex/pcie_fault.c","line":568,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Why did this change? This looks incorrect. Doesn\u0027t cstyle/pbchk complain about it?"},{"file":"usr/src/uts/common/io/pciex/pcie_fault.c","line":568,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"I think it was just accidental. Fixed."},{"file":"usr/src/uts/common/io/pciex/pcie_fault.c","line":604,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Should we be making sure that we didn\u0027t get PCI_EINAVL16/PCI_EINVAL32 up above before declaring that we have valid data?"},{"file":"usr/src/uts/common/io/pciex/pcie_fault.c","line":604,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"usr/src/uts/common/io/pciex/pcie_fault.c","line":1932,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Shouldn\u0027t this comment be updated to reflect the hotplug issue?"},{"file":"usr/src/uts/common/io/pciex/pcie_fault.c","line":1932,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Added something."},{"file":"usr/src/uts/common/io/pciex/pcie_fault.c","line":1943,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"It seems this file is inconsistent about whether it uses tab indenting or space indenting for variables. Pick whichever you prefer, but please be consistent?"},{"file":"usr/src/uts/common/io/pciex/pcie_fault.c","line":1943,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"usr/src/uts/common/io/pciex/pcie_fault.c","line":1951,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Does this really need to go out to the console? If it does, we should make the warning actionable and provide more context."},{"file":"usr/src/uts/common/io/pciex/pcie_fault.c","line":1951,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"This was for my debugging. I\u0027ve removed it."},{"file":"usr/src/uts/common/io/pciex/pcie_fault.c","line":1958,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Minor thing, but we\u0027d prefer an explicit comparison."},{"file":"usr/src/uts/common/io/pciex/pcie_fault.c","line":1958,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"I\u0027ve changed it to what I think you mean, but please let me know if not."},{"file":"usr/src/uts/common/io/pciex/pcie_fault.c","line":1960,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Does this really need to go out to the console?"},{"file":"usr/src/uts/common/io/pciex/pcie_fault.c","line":1960,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"(debugging statement - will remove)"},{"file":"usr/src/uts/common/io/pciex/pcie_fault.c","line":3019,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"See the note in the fabric xlate stuff, but we may need to consider passing through the validity boolean."},{"file":"usr/src/uts/common/io/pciex/pcie_fault.c","line":3019,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"(see reply there)"},{"file":"usr/src/uts/common/os/ddi_hp_impl.c","line":598,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I guess the theory with this change is that we want to make sure that we always run it if the target state is lower. Maybe because we\u0027ve missed some event? It\u0027s not clear to me why we don\u0027t want to do it for some of the other cases. Perhaps you can add a comment that explains the logic here?"},{"file":"usr/src/uts/common/os/ddi_hp_impl.c","line":598,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"I think the comment below is still accurate -- it\u0027s just no longer true that the current state also has to be ENABLED, in addition to dropping below enabled. \n\nThe reason I made this change was that in the case of hot removal, the current state would be EMPTY, not ENABLED, and, the target state was EMPTY, which is less than ENABLED. And in that case, we still want to do all the cleanup. (This is a similar reason that I changed the check I changed in ddi_hp_ndi.c.)\n\nI don\u0027t actually understand why the check that the current state was ENABLED was there in the first place."},{"file":"usr/src/uts/common/os/ddi_hp_impl.c","line":598,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Okay, I added a comment. Please let me know what you think."},{"file":"usr/src/uts/common/os/ddi_hp_ndi.c","line":394,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"This comment explains what we\u0027re doing but not why. Why do we still want to kick off the cleanup? It\u0027s not very clear to me."},{"file":"usr/src/uts/common/os/ddi_hp_ndi.c","line":394,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"I fleshed it out a bit more. Please let me know what you think."},{"file":"usr/src/uts/common/os/ddi_hp_ndi.c","line":394,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Thanks for writing this."},{"file":"usr/src/uts/common/sys/pcie_impl.h","line":442,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Maybe here or in the pf_pcie_slot_regs it\u0027s worth describing whose slot registers this is. I could see it referring to the but_t, the root, or something else. \n\nAlso, a minor note, but all the spacing here looks inconsistent relative to the rest of the structure."},{"file":"usr/src/uts/common/sys/pcie_impl.h","line":442,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Added something about the regs structure; let me know what you think.\n\nAlso, I\u0027m not sure I fixed the spacing thing you were talking about -- let me know if not."},{"file":"usr/src/uts/i86pc/io/pci/pci_common.h","line":51,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Conventionally upper case. Probably worth pointing out where folks should look for more information about this and what it\u0027s for."},{"file":"usr/src/uts/i86pc/io/pci/pci_common.h","line":51,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Okay, I was just being consistent with the comments in the rest of the file. I\u0027ve updated them.\n\nWhich thing were you suggesting I provide references to? NDI events?"},{"file":"usr/src/uts/i86pc/io/pci/pci_common.h","line":51,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Added a reference to the npe block comment."},{"file":"usr/src/uts/i86pc/io/pciex/npe.c","line":75,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Minor nit, but it\u0027d be nice if all the new forwards were consistent in treatment with the ones before them with respect to spacing."},{"file":"usr/src/uts/i86pc/io/pciex/npe.c","line":75,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"I think I fixed this -- let me know if it still looks off."},{"file":"usr/src/uts/i86pc/io/pciex/npe.c","line":77,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Minor, but it\u0027d be nice if the tabbing was consistent with all these forward declarations."},{"file":"usr/src/uts/i86pc/io/pciex/npe.c","line":77,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"I think I fixed this -- let me know if it still looks off."},{"file":"usr/src/uts/i86pc/io/pciex/npe.c","line":83,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Any reason that these forwards have arguments when the others don\u0027t?"},{"file":"usr/src/uts/i86pc/io/pciex/npe.c","line":83,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"usr/src/uts/i86pc/io/pciex/npe.c","line":283,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Where else are you considering moving this up to?"},{"file":"usr/src/uts/i86pc/io/pciex/npe.c","line":283,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Up above the bus_ops structure, below the forward declarations."},{"file":"usr/src/uts/i86pc/io/pciex/npe.c","line":284,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"So, if we\u0027re going to have this defined as the tag, shouldn\u0027t we still have a constant that we can explain it somewhere? I\u0027m not sure why USBA\u0027s event tag is relevant here. Is it because they need to be consistent? It may be also worth explaining why we only have a removal event."},{"file":"usr/src/uts/i86pc/io/pciex/npe.c","line":284,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"That comment was just a note to myself about why I used 0. (I started by copying the USBA boilerplate and tweaking it.)\n\nI added a comment and a new constant for the tag."},{"file":"usr/src/uts/i86pc/io/pciex/npe.c","line":285,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"If we know how many elements there are going to be, let\u0027s just insert the number there so the compiler will help us enforce this."},{"file":"usr/src/uts/i86pc/io/pciex/npe.c","line":285,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"usr/src/uts/i86pc/io/pciex/npe.c","line":291,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"This is the ARRAY_SIZE macro, please use that instead of the definition there."},{"file":"usr/src/uts/i86pc/io/pciex/npe.c","line":291,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"usr/src/uts/i86pc/io/pciex/npe.c","line":294,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Putting the closing brace there looks really weird. It feels like it should be on its own line."},{"file":"usr/src/uts/i86pc/io/pciex/npe.c","line":294,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"usr/src/uts/i86pc/io/pciex/npe.c","line":302,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"tab out to match everything else?"},{"file":"usr/src/uts/i86pc/io/pciex/npe.c","line":302,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"usr/src/uts/i86pc/io/pciex/npe.c","line":344,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Shouldn\u0027t this be NDI_SUCCESS?"},{"file":"usr/src/uts/i86pc/io/pciex/npe.c","line":344,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"usr/src/uts/i86pc/io/pciex/npe.c","line":346,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Shouldn\u0027t we really compare it to !\u003d NDI_SUCCESS? uts/common/sys/sunndi.h lists a number of other possible failure values. Given that we only have a single success value, I think it\u0027s better to rely on that."},{"file":"usr/src/uts/i86pc/io/pciex/npe.c","line":346,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"usr/src/uts/i86pc/io/pciex/npe.c","line":350,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"If we\u0027re going to log the warnings, maybe we should use dev_err or something that gives us more context. If we have more than a single npe instance, we won\u0027t know what it was. Perhaps we should also include the error code?"},{"file":"usr/src/uts/i86pc/io/pciex/npe.c","line":350,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Sure, that makes sense. Do you not think we should log the warnings at all? (I\u0027ve removed them for now.)"},{"file":"usr/src/uts/i86pc/io/pciex/npe.c","line":350,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"(we talked about this one in person)"},{"file":"usr/src/uts/i86pc/io/pciex/npe.c","line":1155,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Maybe worth a comment about why we\u0027re suing NDI_EVENT_NOPASS. Maybe we should start a new big theory statement here."},{"file":"usr/src/uts/i86pc/io/pciex/npe.c","line":1155,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Sure. Could we sync up about this one in person?"},{"file":"usr/src/uts/i86pc/io/pciex/npe.c","line":1155,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Added something up top. Let me know your thoughts."},{"file":"usr/src/uts/i86pc/io/pciex/npe.c","line":1160,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Please join up all the arguments like we do for other functions. While this style has been used historically in illumos, we shouldn\u0027t any more."},{"file":"usr/src/uts/i86pc/io/pciex/npe.c","line":1160,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"usr/src/uts/i86pc/io/pciex/npe.c","line":1170,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Can you explain a bit more about what this TODO is referring to please?"},{"file":"usr/src/uts/i86pc/io/pciex/npe.c","line":1170,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"I think I was confused about something when I wrote this. I\u0027ve deleted it."},{"file":"usr/src/uts/i86pc/io/pciex/npe.c","line":1186,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Please join arguments."},{"file":"usr/src/uts/i86pc/io/pciex/npe.c","line":1186,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"usr/src/uts/intel/io/hotplug/pcicfg/pcicfg.c","line":1605,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"It may be worth a comment that explains why it\u0027s OK to drive on in the face of PCICFG_NODEVICE."},{"file":"usr/src/uts/intel/io/hotplug/pcicfg/pcicfg.c","line":1605,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"I added something. It\u0027s been awhile since I\u0027ve looked at this, so I would appreciate any feedback you have on the comment."},{"file":"usr/src/uts/intel/io/hotplug/pcicfg/pcicfg.c","line":2410,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"We can probably actually just join this to the previous line if you want. This is probably also true for some of the other places we\u0027ve modified."},{"file":"usr/src/uts/intel/io/hotplug/pcicfg/pcicfg.c","line":2410,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Okay, I tried to clean up the signatures in this file a bit."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"usr/src/cmd/fm/modules/common/fabric-xlate/fabric-xlate.h","type":"MODIFIED","insertions":19,"deletions":-3},{"file":"usr/src/cmd/fm/modules/common/fabric-xlate/fx_fabric.c","type":"MODIFIED","insertions":35,"deletions":-1},{"file":"usr/src/cmd/fm/modules/common/fabric-xlate/fx_subr.c","type":"MODIFIED","insertions":12,"deletions":-8},{"file":"usr/src/cmd/mdb/common/modules/genunix/ldi.c","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"usr/src/uts/common/io/nvme/nvme.c","type":"MODIFIED","insertions":66,"deletions":-2},{"file":"usr/src/uts/common/io/nvme/nvme_var.h","type":"MODIFIED","insertions":15,"deletions":-9},{"file":"usr/src/uts/common/io/pciex/hotplug/pciehpc.c","type":"MODIFIED","insertions":15,"deletions":0},{"file":"usr/src/uts/common/io/pciex/pcie.c","type":"MODIFIED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/io/pciex/pcie_fault.c","type":"MODIFIED","insertions":56,"deletions":-8},{"file":"usr/src/uts/common/os/ddi_hp_impl.c","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/uts/common/os/ddi_hp_ndi.c","type":"MODIFIED","insertions":10,"deletions":-1},{"file":"usr/src/uts/common/sys/pcie_impl.h","type":"MODIFIED","insertions":9,"deletions":0},{"file":"usr/src/uts/i86pc/io/pci/pci_common.h","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/uts/i86pc/io/pciex/npe.c","type":"MODIFIED","insertions":89,"deletions":-6},{"file":"usr/src/uts/intel/io/hotplug/pcicfg/pcicfg.c","type":"MODIFIED","insertions":21,"deletions":-16}],"sizeInsertions":366,"sizeDeletions":-59},{"number":"2","revision":"05ed4bd6222a29d9f45e7ceff17def17d8e950ca","parents":["c39031a3421e673ff9e264ef429b207fcde1896c"],"ref":"refs/changes/78/6778/2","uploader":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"createdOn":1565924589,"author":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/uts/common/io/nvme/nvme.c","line":3745,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Q: What is this used for?\n\nA: The only interesting uses I see are:\n1. It is passed to cmlb_attach in the blkdev driver as a required argument: https://github.com/joyent/illumos-joyent/blob/fb22979c02ec1ab84832084bea882640c366be5b/usr/src/uts/common/io/blkdev/blkdev.c#L588-L589.\n\n2. It is set as a property on blkdev device nodes if the device is hotpluggable: https://github.com/joyent/illumos-joyent/blob/fb22979c02ec1ab84832084bea882640c366be5b/usr/src/uts/common/io/blkdev/blkdev.c#L635-L638."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"usr/src/cmd/fm/modules/common/fabric-xlate/fabric-xlate.h","type":"MODIFIED","insertions":23,"deletions":-3},{"file":"usr/src/cmd/fm/modules/common/fabric-xlate/fx_fabric.c","type":"MODIFIED","insertions":35,"deletions":-1},{"file":"usr/src/cmd/fm/modules/common/fabric-xlate/fx_subr.c","type":"MODIFIED","insertions":12,"deletions":-8},{"file":"usr/src/cmd/mdb/common/modules/genunix/ldi.c","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"usr/src/uts/common/io/nvme/nvme.c","type":"MODIFIED","insertions":75,"deletions":-2},{"file":"usr/src/uts/common/io/nvme/nvme_var.h","type":"MODIFIED","insertions":11,"deletions":-3},{"file":"usr/src/uts/common/io/pciex/hotplug/pciehpc.c","type":"MODIFIED","insertions":15,"deletions":0},{"file":"usr/src/uts/common/io/pciex/pcie.c","type":"MODIFIED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/io/pciex/pcie_fault.c","type":"MODIFIED","insertions":65,"deletions":-5},{"file":"usr/src/uts/common/os/ddi_hp_impl.c","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"usr/src/uts/common/os/ddi_hp_ndi.c","type":"MODIFIED","insertions":27,"deletions":-1},{"file":"usr/src/uts/common/sys/pcie_impl.h","type":"MODIFIED","insertions":14,"deletions":0},{"file":"usr/src/uts/i86pc/io/pci/pci_common.h","type":"MODIFIED","insertions":8,"deletions":-3},{"file":"usr/src/uts/i86pc/io/pciex/npe.c","type":"MODIFIED","insertions":80,"deletions":-6},{"file":"usr/src/uts/intel/io/hotplug/pcicfg/pcicfg.c","type":"MODIFIED","insertions":28,"deletions":-23}],"sizeInsertions":408,"sizeDeletions":-61},{"number":"3","revision":"8aa3763ca36d1bcaef7cd368f82923a49856c1b1","parents":["c39031a3421e673ff9e264ef429b207fcde1896c"],"ref":"refs/changes/78/6778/3","uploader":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"createdOn":1565999469,"author":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"usr/src/cmd/fm/modules/common/fabric-xlate/fabric-xlate.h","type":"MODIFIED","insertions":28,"deletions":-3},{"file":"usr/src/cmd/fm/modules/common/fabric-xlate/fx_fabric.c","type":"MODIFIED","insertions":54,"deletions":-1},{"file":"usr/src/cmd/fm/modules/common/fabric-xlate/fx_subr.c","type":"MODIFIED","insertions":12,"deletions":-8},{"file":"usr/src/cmd/mdb/common/modules/genunix/ldi.c","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"usr/src/uts/common/io/nvme/nvme.c","type":"MODIFIED","insertions":82,"deletions":-2},{"file":"usr/src/uts/common/io/nvme/nvme_var.h","type":"MODIFIED","insertions":10,"deletions":-2},{"file":"usr/src/uts/common/io/pciex/hotplug/pciehpc.c","type":"MODIFIED","insertions":15,"deletions":0},{"file":"usr/src/uts/common/io/pciex/pcie.c","type":"MODIFIED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/io/pciex/pcie_fault.c","type":"MODIFIED","insertions":71,"deletions":-5},{"file":"usr/src/uts/common/os/ddi_hp_impl.c","type":"MODIFIED","insertions":12,"deletions":-7},{"file":"usr/src/uts/common/os/ddi_hp_ndi.c","type":"MODIFIED","insertions":27,"deletions":-1},{"file":"usr/src/uts/common/sys/pcie_impl.h","type":"MODIFIED","insertions":14,"deletions":0},{"file":"usr/src/uts/i86pc/io/pci/pci_common.h","type":"MODIFIED","insertions":11,"deletions":-3},{"file":"usr/src/uts/i86pc/io/pciex/npe.c","type":"MODIFIED","insertions":127,"deletions":-7},{"file":"usr/src/uts/intel/io/hotplug/pcicfg/pcicfg.c","type":"MODIFIED","insertions":28,"deletions":-23}],"sizeInsertions":502,"sizeDeletions":-65},{"number":"4","revision":"af5127cb0a2c8b3128b77868899742235e8ffa0e","parents":["c39031a3421e673ff9e264ef429b207fcde1896c"],"ref":"refs/changes/78/6778/4","uploader":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"createdOn":1566221774,"author":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"usr/src/cmd/fm/modules/common/fabric-xlate/fabric-xlate.h","type":"MODIFIED","insertions":28,"deletions":-3},{"file":"usr/src/cmd/fm/modules/common/fabric-xlate/fx_fabric.c","type":"MODIFIED","insertions":54,"deletions":-1},{"file":"usr/src/cmd/fm/modules/common/fabric-xlate/fx_subr.c","type":"MODIFIED","insertions":12,"deletions":-8},{"file":"usr/src/cmd/mdb/common/modules/genunix/ldi.c","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"usr/src/uts/common/io/nvme/nvme.c","type":"MODIFIED","insertions":82,"deletions":-2},{"file":"usr/src/uts/common/io/nvme/nvme_var.h","type":"MODIFIED","insertions":10,"deletions":-2},{"file":"usr/src/uts/common/io/pciex/hotplug/pciehpc.c","type":"MODIFIED","insertions":15,"deletions":0},{"file":"usr/src/uts/common/io/pciex/pcie.c","type":"MODIFIED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/io/pciex/pcie_fault.c","type":"MODIFIED","insertions":71,"deletions":-5},{"file":"usr/src/uts/common/os/ddi_hp_impl.c","type":"MODIFIED","insertions":154,"deletions":-7},{"file":"usr/src/uts/common/os/ddi_hp_ndi.c","type":"MODIFIED","insertions":27,"deletions":-1},{"file":"usr/src/uts/common/sys/pcie_impl.h","type":"MODIFIED","insertions":14,"deletions":0},{"file":"usr/src/uts/i86pc/io/pci/pci_common.h","type":"MODIFIED","insertions":11,"deletions":-3},{"file":"usr/src/uts/i86pc/io/pciex/npe.c","type":"MODIFIED","insertions":133,"deletions":-7},{"file":"usr/src/uts/intel/io/hotplug/pcicfg/pcicfg.c","type":"MODIFIED","insertions":28,"deletions":-23}],"sizeInsertions":650,"sizeDeletions":-65},{"number":"5","revision":"19a7c253a54be87165a48da90836092bf23ae6a6","parents":["c39031a3421e673ff9e264ef429b207fcde1896c"],"ref":"refs/changes/78/6778/5","uploader":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"createdOn":1566227573,"author":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/cmd/fm/modules/common/fabric-xlate/fx_fabric.c","line":409,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Minor, but cstyle says this should be joined to the previous line."},{"file":"usr/src/cmd/fm/modules/common/fabric-xlate/fx_fabric.c","line":409,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"usr/src/uts/common/io/nvme/nvme.c","line":206,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"What else would it support? We support hot insertion, but the driver doesn\u0027t need to take care of that itself."},{"file":"usr/src/uts/common/io/nvme/nvme.c","line":206,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"usr/src/uts/common/io/nvme/nvme.c","line":210,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Not sure, but maybe this should be singular?"},{"file":"usr/src/uts/common/io/nvme/nvme.c","line":210,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"usr/src/uts/common/io/nvme/nvme.c","line":213,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"So pcieb stands for PCIe bridge. Maybe \u0027when the PCIe bridge driver (pcieb) gets ...\u0027"},{"file":"usr/src/uts/common/io/nvme/nvme.c","line":213,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"usr/src/uts/common/io/nvme/nvme.c","line":215,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Maybe add a note about how the driver will stick around until the final close / the race condition we hit?"},{"file":"usr/src/uts/common/io/nvme/nvme.c","line":215,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"usr/src/uts/common/io/nvme/nvme.c","line":3224,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"So, now with this version, what should we do if it doesn\u0027t match? It seems like this means that we\u0027ve hit a case where this happens, we\u0027ll leak the ID or something else. I\u0027m not quite sure what the right action is to take here, but we should think about it a little bit more."},{"file":"usr/src/uts/common/io/nvme/nvme.c","line":3224,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"It doesn\u0027t seem like it\u0027s possible for it not to match given that this code is holding the queue look the whole time. Seems like you could ignore the retval for this case - similar to nvme_wait_cmd()"},{"file":"usr/src/uts/common/io/nvme/nvme.c","line":3224,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Hm. You both have given me conflicting advice! I agree that it shouldn\u0027t really be possible, but also that we don\u0027t want to leak a command, which was my instinct was to always unqueue regardless of return value."},{"file":"usr/src/uts/common/io/nvme/nvme.c","line":3224,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Sorry for the confusion here, Jordan. The thing I was trying to understand was why it was OK to ignore it. Given what Rob says, ignoring it can make sense. We\u0027d just want a comment to explain why."},{"file":"usr/src/uts/common/io/nvme/nvme.c","line":3224,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Okay, I added a comment here and ignored the return value!"},{"file":"usr/src/uts/common/os/ddi_hp_impl.c","line":32,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"This is great, thank you!"},{"file":"usr/src/uts/common/os/ddi_hp_impl.c","line":35,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I think I would probably just say also known as SHP as we aren\u0027t really Solaris any more."},{"file":"usr/src/uts/common/os/ddi_hp_impl.c","line":35,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Okay, I tried to make it clearer that it\u0027s no longer the case. I mostly wanted to have it written down because I had a really hard time figuring out what SHP meant, and it\u0027s used a lot of places."},{"file":"usr/src/uts/common/os/ddi_hp_impl.c","line":35,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Fair enough. It\u0027s just that we\u0027re not Solaris any more. So the Solaris part is a bit vestigial."},{"file":"usr/src/uts/common/os/ddi_hp_impl.c","line":43,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I think it\u0027d be useful to note that many things call this \u0027surprise removal\u0027."},{"file":"usr/src/uts/common/os/ddi_hp_impl.c","line":43,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"usr/src/uts/common/os/ddi_hp_impl.c","line":86,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Maybe worth a brief note here or below that things can jump around?"},{"file":"usr/src/uts/common/os/ddi_hp_impl.c","line":86,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"usr/src/uts/common/os/ddi_hp_impl.c","line":151,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Looks like an unintentional empty line."},{"file":"usr/src/uts/common/os/ddi_hp_impl.c","line":151,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"usr/src/uts/common/os/ddi_hp_impl.c","line":188,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"maybe reword to:\n\n\u0027list the current connections on th system and/or change their state\"?"},{"file":"usr/src/uts/common/os/ddi_hp_impl.c","line":188,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"usr/src/uts/common/os/ddi_hp_impl.c","line":189,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Should we also mention the hotplug command at all?"},{"file":"usr/src/uts/common/os/ddi_hp_impl.c","line":189,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Sure. I added it to the diagram and to here."},{"file":"usr/src/uts/common/os/ddi_hp_impl.c","line":220,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"So, npe is the common nexus driver on x86. SPARC actually has its own one called px. It\u0027s probably worth mentioning both or specifying that this is x86 specific."},{"file":"usr/src/uts/common/os/ddi_hp_impl.c","line":220,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Good catch. Thanks."},{"file":"usr/src/uts/common/os/ddi_hp_impl.c","line":241,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Maybe this is redundant - it seems to just restate what was said in lines 213-215?"},{"file":"usr/src/uts/common/os/ddi_hp_impl.c","line":241,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Sure. I originally thought there might be more to put in this section, but I\u0027m not sure there is. I\u0027ve removed it."},{"file":"usr/src/uts/common/os/ddi_hp_impl.c","line":816,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"In person you gave me a bit more color about this. That the actual request of the current state would have reflected a change that the hotplug framework didn\u0027t know about. Can you maybe expand this a bit and make it more explicit? The rest of this is really useful. Thanks for expanding on it."},{"file":"usr/src/uts/common/os/ddi_hp_impl.c","line":816,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"I ended up removing this comment because I think I found a better solution for it. See new comment in ddihp_cn_req_handler (ddi_hp_ndi.c) and OS-7969."},{"file":"usr/src/uts/common/os/ddi_hp_ndi.c","line":411,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I might still call this surprise removal like in the PCIe spec. Just because some folks will consider hot removal an OK thing as long as its coordinated.\n\nThanks for expanding on this!"},{"file":"usr/src/uts/common/os/ddi_hp_ndi.c","line":411,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"(I removed this comment and check because I think there might be a better solution. See new comment in ddihp_cn_req_handler (ddi_hp_ndi.c) and OS-7969.)"},{"file":"usr/src/uts/i86pc/io/pciex/npe.c","line":42,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"The only suggests some things aren\u0027t supported. What\u0027s not supported?"},{"file":"usr/src/uts/i86pc/io/pciex/npe.c","line":42,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"usr/src/uts/i86pc/io/pciex/npe.c","line":43,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"is?"},{"file":"usr/src/uts/i86pc/io/pciex/npe.c","line":43,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"},{"file":"usr/src/uts/i86pc/io/pciex/npe.c","line":310,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"So, this comment doesn\u0027t follow for me. Even if we had hot insertion, there wouldn\u0027t necessarily be something here for a driver right to listen for. The driver would just get a new attachment as though we had booted the system. There isn\u0027t really anything for child devices like nvme to do on hot insertion that\u0027s different from normal."},{"file":"usr/src/uts/i86pc/io/pciex/npe.c","line":310,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Yes, you\u0027re right. I\u0027ve just changed this comment to reference the top function instead (and removed the content here)."},{"file":"usr/src/uts/i86pc/io/pciex/npe.c","line":450,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"So, if we\u0027re failing detach at this point here, we\u0027re going to be in a weird state as the pcitool_uninit() and pcie_uninit() functions have already been called which means things like ARIs and hotplug have been disabled."},{"file":"usr/src/uts/i86pc/io/pciex/npe.c","line":450,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Okay, I have moved it up in the detach routine."},{"file":"usr/src/uts/intel/io/hotplug/pcicfg/pcicfg.c","line":1607,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I would suggest why the device no longer exists, like because it\u0027s been pulled."},{"file":"usr/src/uts/intel/io/hotplug/pcicfg/pcicfg.c","line":1607,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"usr/src/cmd/fm/modules/common/fabric-xlate/fabric-xlate.h","type":"MODIFIED","insertions":28,"deletions":-3},{"file":"usr/src/cmd/fm/modules/common/fabric-xlate/fx_fabric.c","type":"MODIFIED","insertions":54,"deletions":-1},{"file":"usr/src/cmd/fm/modules/common/fabric-xlate/fx_subr.c","type":"MODIFIED","insertions":12,"deletions":-8},{"file":"usr/src/cmd/mdb/common/modules/genunix/ldi.c","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"usr/src/uts/common/io/nvme/nvme.c","type":"MODIFIED","insertions":82,"deletions":-2},{"file":"usr/src/uts/common/io/nvme/nvme_var.h","type":"MODIFIED","insertions":10,"deletions":-2},{"file":"usr/src/uts/common/io/pciex/hotplug/pciehpc.c","type":"MODIFIED","insertions":15,"deletions":0},{"file":"usr/src/uts/common/io/pciex/pcie.c","type":"MODIFIED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/io/pciex/pcie_fault.c","type":"MODIFIED","insertions":71,"deletions":-5},{"file":"usr/src/uts/common/os/ddi_hp_impl.c","type":"MODIFIED","insertions":225,"deletions":-7},{"file":"usr/src/uts/common/os/ddi_hp_ndi.c","type":"MODIFIED","insertions":27,"deletions":-1},{"file":"usr/src/uts/common/sys/ddi_hp_impl.h","type":"MODIFIED","insertions":6,"deletions":0},{"file":"usr/src/uts/common/sys/pcie_impl.h","type":"MODIFIED","insertions":14,"deletions":0},{"file":"usr/src/uts/i86pc/io/pci/pci_common.h","type":"MODIFIED","insertions":11,"deletions":-3},{"file":"usr/src/uts/i86pc/io/pciex/npe.c","type":"MODIFIED","insertions":134,"deletions":-7},{"file":"usr/src/uts/intel/io/hotplug/pcicfg/pcicfg.c","type":"MODIFIED","insertions":28,"deletions":-23}],"sizeInsertions":728,"sizeDeletions":-65},{"number":"6","revision":"cfc7b7898e233d0325732ff610cfd119476d1aee","parents":["79a83c9704a9cf92db1f36550cc849fecedc5c7a"],"ref":"refs/changes/78/6778/6","uploader":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"createdOn":1566514631,"author":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/cmd/fm/modules/common/fabric-xlate/fabric-xlate.h","type":"MODIFIED","insertions":28,"deletions":-3},{"file":"usr/src/cmd/fm/modules/common/fabric-xlate/fx_fabric.c","type":"MODIFIED","insertions":54,"deletions":-1},{"file":"usr/src/cmd/fm/modules/common/fabric-xlate/fx_subr.c","type":"MODIFIED","insertions":12,"deletions":-8},{"file":"usr/src/cmd/mdb/common/modules/genunix/ldi.c","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"usr/src/uts/common/io/nvme/nvme.c","type":"MODIFIED","insertions":87,"deletions":-3},{"file":"usr/src/uts/common/io/nvme/nvme_var.h","type":"MODIFIED","insertions":18,"deletions":-7},{"file":"usr/src/uts/common/io/pciex/hotplug/pciehpc.c","type":"MODIFIED","insertions":15,"deletions":0},{"file":"usr/src/uts/common/io/pciex/pcie.c","type":"MODIFIED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/io/pciex/pcie_fault.c","type":"MODIFIED","insertions":71,"deletions":-5},{"file":"usr/src/uts/common/os/ddi_hp_impl.c","type":"MODIFIED","insertions":235,"deletions":-7},{"file":"usr/src/uts/common/os/ddi_hp_ndi.c","type":"MODIFIED","insertions":8,"deletions":-7},{"file":"usr/src/uts/common/sys/ddi_hp.h","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"usr/src/uts/common/sys/ddi_hp_impl.h","type":"MODIFIED","insertions":6,"deletions":0},{"file":"usr/src/uts/common/sys/pcie_impl.h","type":"MODIFIED","insertions":14,"deletions":0},{"file":"usr/src/uts/i86pc/io/pci/pci_common.h","type":"MODIFIED","insertions":11,"deletions":-3},{"file":"usr/src/uts/i86pc/io/pciex/npe.c","type":"MODIFIED","insertions":140,"deletions":-7},{"file":"usr/src/uts/intel/io/hotplug/pcicfg/pcicfg.c","type":"MODIFIED","insertions":30,"deletions":-23}],"sizeInsertions":747,"sizeDeletions":-78},{"number":"7","revision":"639158d48ffff36790483a5d32d2303e0f97d3e1","parents":["79a83c9704a9cf92db1f36550cc849fecedc5c7a"],"ref":"refs/changes/78/6778/7","uploader":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"createdOn":1566515396,"author":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/cmd/fm/modules/common/fabric-xlate/fabric-xlate.h","type":"MODIFIED","insertions":28,"deletions":-3},{"file":"usr/src/cmd/fm/modules/common/fabric-xlate/fx_fabric.c","type":"MODIFIED","insertions":54,"deletions":-1},{"file":"usr/src/cmd/fm/modules/common/fabric-xlate/fx_subr.c","type":"MODIFIED","insertions":12,"deletions":-8},{"file":"usr/src/cmd/mdb/common/modules/genunix/ldi.c","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"usr/src/uts/common/io/nvme/nvme.c","type":"MODIFIED","insertions":87,"deletions":-3},{"file":"usr/src/uts/common/io/nvme/nvme_var.h","type":"MODIFIED","insertions":18,"deletions":-7},{"file":"usr/src/uts/common/io/pciex/hotplug/pciehpc.c","type":"MODIFIED","insertions":15,"deletions":0},{"file":"usr/src/uts/common/io/pciex/pcie.c","type":"MODIFIED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/io/pciex/pcie_fault.c","type":"MODIFIED","insertions":71,"deletions":-5},{"file":"usr/src/uts/common/os/ddi_hp_impl.c","type":"MODIFIED","insertions":232,"deletions":-4},{"file":"usr/src/uts/common/os/ddi_hp_ndi.c","type":"MODIFIED","insertions":15,"deletions":-7},{"file":"usr/src/uts/common/sys/ddi_hp.h","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"usr/src/uts/common/sys/ddi_hp_impl.h","type":"MODIFIED","insertions":6,"deletions":0},{"file":"usr/src/uts/common/sys/pcie_impl.h","type":"MODIFIED","insertions":14,"deletions":0},{"file":"usr/src/uts/i86pc/io/pci/pci_common.h","type":"MODIFIED","insertions":11,"deletions":-3},{"file":"usr/src/uts/i86pc/io/pciex/npe.c","type":"MODIFIED","insertions":140,"deletions":-7},{"file":"usr/src/uts/intel/io/hotplug/pcicfg/pcicfg.c","type":"MODIFIED","insertions":30,"deletions":-23}],"sizeInsertions":751,"sizeDeletions":-75},{"number":"8","revision":"2ebbaa7b2a528af659286f0ed79dad5a46ca7385","parents":["79a83c9704a9cf92db1f36550cc849fecedc5c7a"],"ref":"refs/changes/78/6778/8","uploader":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"createdOn":1566592178,"author":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1566844792,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1566931289,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1566851923,"by":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/cmd/fm/modules/common/fabric-xlate/fabric-xlate.h","type":"MODIFIED","insertions":28,"deletions":-3},{"file":"usr/src/cmd/fm/modules/common/fabric-xlate/fx_fabric.c","type":"MODIFIED","insertions":54,"deletions":-1},{"file":"usr/src/cmd/fm/modules/common/fabric-xlate/fx_subr.c","type":"MODIFIED","insertions":12,"deletions":-8},{"file":"usr/src/cmd/mdb/common/modules/genunix/ldi.c","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"usr/src/uts/common/io/nvme/nvme.c","type":"MODIFIED","insertions":93,"deletions":-3},{"file":"usr/src/uts/common/io/nvme/nvme_var.h","type":"MODIFIED","insertions":18,"deletions":-7},{"file":"usr/src/uts/common/io/pciex/hotplug/pciehpc.c","type":"MODIFIED","insertions":15,"deletions":0},{"file":"usr/src/uts/common/io/pciex/pcie.c","type":"MODIFIED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/io/pciex/pcie_fault.c","type":"MODIFIED","insertions":71,"deletions":-5},{"file":"usr/src/uts/common/os/ddi_hp_impl.c","type":"MODIFIED","insertions":233,"deletions":-4},{"file":"usr/src/uts/common/os/ddi_hp_ndi.c","type":"MODIFIED","insertions":15,"deletions":-7},{"file":"usr/src/uts/common/sys/ddi_hp.h","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"usr/src/uts/common/sys/ddi_hp_impl.h","type":"MODIFIED","insertions":6,"deletions":0},{"file":"usr/src/uts/common/sys/pcie_impl.h","type":"MODIFIED","insertions":14,"deletions":0},{"file":"usr/src/uts/i86pc/io/pci/pci_common.h","type":"MODIFIED","insertions":11,"deletions":-3},{"file":"usr/src/uts/i86pc/io/pciex/npe.c","type":"MODIFIED","insertions":140,"deletions":-7},{"file":"usr/src/uts/intel/io/hotplug/pcicfg/pcicfg.c","type":"MODIFIED","insertions":30,"deletions":-23}],"sizeInsertions":758,"sizeDeletions":-75},{"number":"9","revision":"97a58ba7368e5db5a431a56c387ffca2d686dd66","parents":["ba347c6543e6ff6ffba5d804e1705af24514e945"],"ref":"refs/changes/78/6778/9","uploader":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"createdOn":1566931878,"author":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1566844792,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1566931289,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1566851923,"by":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/cmd/fm/modules/common/fabric-xlate/fabric-xlate.h","type":"MODIFIED","insertions":28,"deletions":-3},{"file":"usr/src/cmd/fm/modules/common/fabric-xlate/fx_fabric.c","type":"MODIFIED","insertions":54,"deletions":-1},{"file":"usr/src/cmd/fm/modules/common/fabric-xlate/fx_subr.c","type":"MODIFIED","insertions":12,"deletions":-8},{"file":"usr/src/cmd/mdb/common/modules/genunix/ldi.c","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"usr/src/uts/common/io/nvme/nvme.c","type":"MODIFIED","insertions":93,"deletions":-3},{"file":"usr/src/uts/common/io/nvme/nvme_var.h","type":"MODIFIED","insertions":18,"deletions":-7},{"file":"usr/src/uts/common/io/pciex/hotplug/pciehpc.c","type":"MODIFIED","insertions":15,"deletions":0},{"file":"usr/src/uts/common/io/pciex/pcie.c","type":"MODIFIED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/io/pciex/pcie_fault.c","type":"MODIFIED","insertions":71,"deletions":-5},{"file":"usr/src/uts/common/os/ddi_hp_impl.c","type":"MODIFIED","insertions":233,"deletions":-4},{"file":"usr/src/uts/common/os/ddi_hp_ndi.c","type":"MODIFIED","insertions":15,"deletions":-7},{"file":"usr/src/uts/common/sys/ddi_hp.h","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"usr/src/uts/common/sys/ddi_hp_impl.h","type":"MODIFIED","insertions":6,"deletions":0},{"file":"usr/src/uts/common/sys/pcie_impl.h","type":"MODIFIED","insertions":14,"deletions":0},{"file":"usr/src/uts/i86pc/io/pci/pci_common.h","type":"MODIFIED","insertions":11,"deletions":-3},{"file":"usr/src/uts/i86pc/io/pciex/npe.c","type":"MODIFIED","insertions":140,"deletions":-7},{"file":"usr/src/uts/intel/io/hotplug/pcicfg/pcicfg.c","type":"MODIFIED","insertions":30,"deletions":-23}],"sizeInsertions":758,"sizeDeletions":-75},{"number":"10","revision":"175e9b5e7534aad7d965dc4a8c6e9b0dd8e6f1f0","parents":["ba347c6543e6ff6ffba5d804e1705af24514e945"],"ref":"refs/changes/78/6778/10","uploader":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"createdOn":1566931981,"author":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1566844792,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1566931289,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}},{"type":"SUBM","value":"1","grantedOn":1566932065,"by":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1566851923,"by":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":13,"deletions":0},{"file":"usr/src/cmd/fm/modules/common/fabric-xlate/fabric-xlate.h","type":"MODIFIED","insertions":28,"deletions":-3},{"file":"usr/src/cmd/fm/modules/common/fabric-xlate/fx_fabric.c","type":"MODIFIED","insertions":54,"deletions":-1},{"file":"usr/src/cmd/fm/modules/common/fabric-xlate/fx_subr.c","type":"MODIFIED","insertions":12,"deletions":-8},{"file":"usr/src/cmd/mdb/common/modules/genunix/ldi.c","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"usr/src/uts/common/io/nvme/nvme.c","type":"MODIFIED","insertions":93,"deletions":-3},{"file":"usr/src/uts/common/io/nvme/nvme_var.h","type":"MODIFIED","insertions":18,"deletions":-7},{"file":"usr/src/uts/common/io/pciex/hotplug/pciehpc.c","type":"MODIFIED","insertions":15,"deletions":0},{"file":"usr/src/uts/common/io/pciex/pcie.c","type":"MODIFIED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/io/pciex/pcie_fault.c","type":"MODIFIED","insertions":71,"deletions":-5},{"file":"usr/src/uts/common/os/ddi_hp_impl.c","type":"MODIFIED","insertions":233,"deletions":-4},{"file":"usr/src/uts/common/os/ddi_hp_ndi.c","type":"MODIFIED","insertions":15,"deletions":-7},{"file":"usr/src/uts/common/sys/ddi_hp.h","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"usr/src/uts/common/sys/ddi_hp_impl.h","type":"MODIFIED","insertions":6,"deletions":0},{"file":"usr/src/uts/common/sys/pcie_impl.h","type":"MODIFIED","insertions":14,"deletions":0},{"file":"usr/src/uts/i86pc/io/pci/pci_common.h","type":"MODIFIED","insertions":11,"deletions":-3},{"file":"usr/src/uts/i86pc/io/pciex/npe.c","type":"MODIFIED","insertions":140,"deletions":-7},{"file":"usr/src/uts/intel/io/hotplug/pcicfg/pcicfg.c","type":"MODIFIED","insertions":30,"deletions":-23}],"sizeInsertions":758,"sizeDeletions":-75}],"allReviewers":[{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"}]}