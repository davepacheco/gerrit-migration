From fc4454d0d51809e03fb7740f4906b5bf6f03f665 Mon Sep 17 00:00:00 2001
From: Josh Wilsdon <jwilsdon@joyent.com>
Date: Mon, 22 Aug 2016 13:48:02 -0700
Subject: [PATCH] RELENG-711 builds should not use /tmp on tmpfs on ancient
 platforms Reviewed by: Trent Mick <trent.mick@joyent.com>

---
 tools/jenkins-build | 10 ++++++++++
 1 file changed, 10 insertions(+)

diff --git a/tools/jenkins-build b/tools/jenkins-build
index ac054ad..8d46b8b 100755
--- a/tools/jenkins-build
+++ b/tools/jenkins-build
@@ -31,6 +31,16 @@
 set -o errexit
 unset LD_LIBRARY_PATH   # ensure don't get Java's libs (see OS-703)
 
+#
+# Refuse to build if /tmp is tmpfs until OS-5608 is fixed.
+# Try to umount if mounted, if that fails: blow up.
+#
+if mount | grep ^/tmp; then
+    if ! umount /tmp; then
+        echo "FATAL: refusing to use mounted /tmp (See: RELENG-711)" >&2
+        exit 1
+    fi
+fi
 
 # ---- First pass:
 # 1. parse params
-- 
2.21.0

