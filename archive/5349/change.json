{"project":"joyent/sdc-papi","branch":"master","topic":"lullaby-phase-1","id":"I4606502f651b7464abcf595388e991c2f351a837","number":"5349","subject":"TRITON-1078 convert papi to engbld framework Reviewed by: Chris Burroughs \u003cchris.burroughs@joyent.com\u003e Reviewed by: Trent Mick \u003ctrentm@gmail.com\u003e Approved by: Trent Mick \u003ctrentm@gmail.com\u003e","owner":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"url":"https://cr.joyent.us/5349","commitMessage":"TRITON-1078 convert papi to engbld framework\nReviewed by: Chris Burroughs \u003cchris.burroughs@joyent.com\u003e\nReviewed by: Trent Mick \u003ctrentm@gmail.com\u003e\nApproved by: Trent Mick \u003ctrentm@gmail.com\u003e\n","createdOn":1547202913,"lastUpdated":1548201550,"open":false,"status":"MERGED","comments":[{"timestamp":1547202913,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Uploaded patch set 1."},{"timestamp":1547202920,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit bc2cfc12271a6ae386cc382f2a9058e45f745eec\n    \n    TRITON-1078 convert papi to engbld framework"},{"timestamp":1547202946,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1547207668,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Topic set to lullaby-phase-1"},{"timestamp":1547502312,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Patch Set 1:\n\n(3 comments)"},{"timestamp":1547552025,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Patch Set 1:\n\n(3 comments)"},{"timestamp":1547552084,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Uploaded patch set 2."},{"timestamp":1547552116,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Patch Set 1:\n\nPatch set 2 addresses comments Chris made about patch set 1."},{"timestamp":1547552117,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1547848009,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Patch Set 2: Code-Review+1"},{"timestamp":1548181181,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Patch Set 2: Integration-Approval+1"},{"timestamp":1548193669,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Uploaded patch set 3."},{"timestamp":1548193675,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Patch Set 3:\n\nNew commits:\n    \n    commit 619c7e1c0bc1664579706a136de19c502b471998\n    \n    TRITON-1078 convert papi to engbld framework"},{"timestamp":1548193717,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1548193766,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 3: Code-Review+1 Integration-Approval+1"},{"timestamp":1548194491,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Uploaded patch set 4: Commit message was updated."},{"timestamp":1548201550,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Tim Foster"}],"currentPatchSet":{"number":"4","revision":"4606502f651b7464abcf595388e991c2f351a837","parents":["dd56ce170823e3f882877cba289514de613b06c9"],"ref":"refs/changes/49/5349/4","uploader":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"createdOn":1548194491,"author":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1548193717,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1548193766,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1548193766,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1548201550,"by":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":3,"deletions":0},{"file":".gitmodules","type":"MODIFIED","insertions":3,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":28,"deletions":-20},{"file":"deps/eng","type":"ADDED","insertions":1,"deletions":0},{"file":"tools/mk/Makefile.defs","type":"DELETED","insertions":0,"deletions":-51},{"file":"tools/mk/Makefile.deps","type":"DELETED","insertions":0,"deletions":-54},{"file":"tools/mk/Makefile.node.defs","type":"DELETED","insertions":0,"deletions":-104},{"file":"tools/mk/Makefile.node.targ","type":"DELETED","insertions":0,"deletions":-42},{"file":"tools/mk/Makefile.node_deps.defs","type":"DELETED","insertions":0,"deletions":-43},{"file":"tools/mk/Makefile.node_deps.targ","type":"DELETED","insertions":0,"deletions":-24},{"file":"tools/mk/Makefile.node_prebuilt.defs","type":"DELETED","insertions":0,"deletions":-153},{"file":"tools/mk/Makefile.node_prebuilt.targ","type":"DELETED","insertions":0,"deletions":-42},{"file":"tools/mk/Makefile.smf.defs","type":"DELETED","insertions":0,"deletions":-40},{"file":"tools/mk/Makefile.smf.targ","type":"DELETED","insertions":0,"deletions":-29},{"file":"tools/mk/Makefile.targ","type":"DELETED","insertions":0,"deletions":-318}],"sizeInsertions":35,"sizeDeletions":-920},"patchSets":[{"number":"1","revision":"a3f161edc2f0cc56f5e1063d4bf87c5e8aabc64a","parents":["dd56ce170823e3f882877cba289514de613b06c9"],"ref":"refs/changes/49/5349/1","uploader":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"createdOn":1547202913,"author":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1547202946,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"Makefile","line":70,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"include comment with name."},{"file":"Makefile","line":70,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Yep, fixed - thanks"},{"file":"Makefile","line":72,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"As I\u0027m comparing this to what\u0027s in MG.  It\u0027s not clear to me if anything is carrying image_version forward, or if that property in MG is actually important (since it is almost always the same)."},{"file":"Makefile","line":72,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Yep, I don\u0027t believe we\u0027re actually that value from targets.json, so I dropped it here, and in all other components.\n\nThe \u0027version\u0027 string that gets used in the image manifest comes from the \u0027-v\u0027 argument to MG\u0027s prep_dataset_in_jpc.sh, which its Makefile sets via $(_\u003ccomponent\u003e_stamp)\n\nFor example, for papi, MG\u0027s Makefile has:\n\n_papi_stamp\u003d$(SDC_PAPI_BRANCH)-$(TIMESTAMP)-g$(SDC_PAPI_SHA)\n\nThat\u0027s the same as we\u0027re now getting with $(BUILDIMAGE_VERSION), which gets set to $(STAMP), passed to buildimage as part of the $(BUILDIMAGE_MF) json fragment.\n\nFor sdc-papi in the workspace I\u0027m making these changes in, this looks like:\n\n$ make print-BUILDIMAGE_VERSION\nBUILDIMAGE_VERSION\u003dgrr-TRITON-1078-20190115T112213Z-gbc2cfc1-dirty\n$ make print-BUILDIMAGE_MF\nBUILDIMAGE_MF\u003d{\"name\": \"papi\", \"description\": \"SDC PAPI\", \"version\": \"grr-TRITON-1078-20190115T112221Z-gbc2cfc1-dirty\" }\n$"},{"file":"Makefile","line":84,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Was REPO_DEPS not defined anywhere?"},{"file":"Makefile","line":84,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"This was more of the Makefile.node_deps.[defs|targ] stuff.\n\nsdc-papi used to have this declaration in its copy of one of the eng Makefiles:\n\nMakefile.node_deps.defs:REPO_DEPS    \u003d $(REPO_MODULES:src/node-%\u003dnode_modules/%)\n\nbut I believe this and the top-level Makefile for sdc-papi was just boilerplate: we never shipped sdc-papi.git/src/node-\u003canything\u003e so never needed to have this dependency on what was always only a macro set to the empty string."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":3,"deletions":0},{"file":".gitmodules","type":"MODIFIED","insertions":3,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":27,"deletions":-20},{"file":"deps/eng","type":"ADDED","insertions":1,"deletions":0},{"file":"tools/mk/Makefile.defs","type":"DELETED","insertions":0,"deletions":-51},{"file":"tools/mk/Makefile.deps","type":"DELETED","insertions":0,"deletions":-54},{"file":"tools/mk/Makefile.node.defs","type":"DELETED","insertions":0,"deletions":-104},{"file":"tools/mk/Makefile.node.targ","type":"DELETED","insertions":0,"deletions":-42},{"file":"tools/mk/Makefile.node_deps.defs","type":"DELETED","insertions":0,"deletions":-43},{"file":"tools/mk/Makefile.node_deps.targ","type":"DELETED","insertions":0,"deletions":-24},{"file":"tools/mk/Makefile.node_prebuilt.defs","type":"DELETED","insertions":0,"deletions":-153},{"file":"tools/mk/Makefile.node_prebuilt.targ","type":"DELETED","insertions":0,"deletions":-42},{"file":"tools/mk/Makefile.smf.defs","type":"DELETED","insertions":0,"deletions":-40},{"file":"tools/mk/Makefile.smf.targ","type":"DELETED","insertions":0,"deletions":-29},{"file":"tools/mk/Makefile.targ","type":"DELETED","insertions":0,"deletions":-318}],"sizeInsertions":34,"sizeDeletions":-920},{"number":"2","revision":"0d81b091842aaa8bc8753ce130d5d44d4ee5c24e","parents":["dd56ce170823e3f882877cba289514de613b06c9"],"ref":"refs/changes/49/5349/2","uploader":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"createdOn":1547552084,"author":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1547552117,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1547848009,"by":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1548181181,"by":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":3,"deletions":0},{"file":".gitmodules","type":"MODIFIED","insertions":3,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":28,"deletions":-20},{"file":"deps/eng","type":"ADDED","insertions":1,"deletions":0},{"file":"tools/mk/Makefile.defs","type":"DELETED","insertions":0,"deletions":-51},{"file":"tools/mk/Makefile.deps","type":"DELETED","insertions":0,"deletions":-54},{"file":"tools/mk/Makefile.node.defs","type":"DELETED","insertions":0,"deletions":-104},{"file":"tools/mk/Makefile.node.targ","type":"DELETED","insertions":0,"deletions":-42},{"file":"tools/mk/Makefile.node_deps.defs","type":"DELETED","insertions":0,"deletions":-43},{"file":"tools/mk/Makefile.node_deps.targ","type":"DELETED","insertions":0,"deletions":-24},{"file":"tools/mk/Makefile.node_prebuilt.defs","type":"DELETED","insertions":0,"deletions":-153},{"file":"tools/mk/Makefile.node_prebuilt.targ","type":"DELETED","insertions":0,"deletions":-42},{"file":"tools/mk/Makefile.smf.defs","type":"DELETED","insertions":0,"deletions":-40},{"file":"tools/mk/Makefile.smf.targ","type":"DELETED","insertions":0,"deletions":-29},{"file":"tools/mk/Makefile.targ","type":"DELETED","insertions":0,"deletions":-318}],"sizeInsertions":35,"sizeDeletions":-920},{"number":"3","revision":"41b12f9c6403b28ea1a1eb68fdb37c7b9cb136ff","parents":["dd56ce170823e3f882877cba289514de613b06c9"],"ref":"refs/changes/49/5349/3","uploader":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"createdOn":1548193669,"author":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1548193717,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1548193766,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1548193766,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":3,"deletions":0},{"file":".gitmodules","type":"MODIFIED","insertions":3,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":28,"deletions":-20},{"file":"deps/eng","type":"ADDED","insertions":1,"deletions":0},{"file":"tools/mk/Makefile.defs","type":"DELETED","insertions":0,"deletions":-51},{"file":"tools/mk/Makefile.deps","type":"DELETED","insertions":0,"deletions":-54},{"file":"tools/mk/Makefile.node.defs","type":"DELETED","insertions":0,"deletions":-104},{"file":"tools/mk/Makefile.node.targ","type":"DELETED","insertions":0,"deletions":-42},{"file":"tools/mk/Makefile.node_deps.defs","type":"DELETED","insertions":0,"deletions":-43},{"file":"tools/mk/Makefile.node_deps.targ","type":"DELETED","insertions":0,"deletions":-24},{"file":"tools/mk/Makefile.node_prebuilt.defs","type":"DELETED","insertions":0,"deletions":-153},{"file":"tools/mk/Makefile.node_prebuilt.targ","type":"DELETED","insertions":0,"deletions":-42},{"file":"tools/mk/Makefile.smf.defs","type":"DELETED","insertions":0,"deletions":-40},{"file":"tools/mk/Makefile.smf.targ","type":"DELETED","insertions":0,"deletions":-29},{"file":"tools/mk/Makefile.targ","type":"DELETED","insertions":0,"deletions":-318}],"sizeInsertions":35,"sizeDeletions":-920},{"number":"4","revision":"4606502f651b7464abcf595388e991c2f351a837","parents":["dd56ce170823e3f882877cba289514de613b06c9"],"ref":"refs/changes/49/5349/4","uploader":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"createdOn":1548194491,"author":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1548193717,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1548193766,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1548193766,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1548201550,"by":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":3,"deletions":0},{"file":".gitmodules","type":"MODIFIED","insertions":3,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":28,"deletions":-20},{"file":"deps/eng","type":"ADDED","insertions":1,"deletions":0},{"file":"tools/mk/Makefile.defs","type":"DELETED","insertions":0,"deletions":-51},{"file":"tools/mk/Makefile.deps","type":"DELETED","insertions":0,"deletions":-54},{"file":"tools/mk/Makefile.node.defs","type":"DELETED","insertions":0,"deletions":-104},{"file":"tools/mk/Makefile.node.targ","type":"DELETED","insertions":0,"deletions":-42},{"file":"tools/mk/Makefile.node_deps.defs","type":"DELETED","insertions":0,"deletions":-43},{"file":"tools/mk/Makefile.node_deps.targ","type":"DELETED","insertions":0,"deletions":-24},{"file":"tools/mk/Makefile.node_prebuilt.defs","type":"DELETED","insertions":0,"deletions":-153},{"file":"tools/mk/Makefile.node_prebuilt.targ","type":"DELETED","insertions":0,"deletions":-42},{"file":"tools/mk/Makefile.smf.defs","type":"DELETED","insertions":0,"deletions":-40},{"file":"tools/mk/Makefile.smf.targ","type":"DELETED","insertions":0,"deletions":-29},{"file":"tools/mk/Makefile.targ","type":"DELETED","insertions":0,"deletions":-318}],"sizeInsertions":35,"sizeDeletions":-920}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"}]}