{"project":"joyent/boray","branch":"master","id":"I8ed0a6e8012391f83e73d57669aeb1e5b64eda7c","number":"6571","subject":"MANTA-4355 Expose pagination for bucket and object listing Reviewed by: Kelly McLaughlin \u003ckelly.mclaughlin@joyent.com\u003e Approved by: Kelly McLaughlin \u003ckelly.mclaughlin@joyent.com\u003e","owner":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"url":"https://cr.joyent.us/6571","commitMessage":"MANTA-4355 Expose pagination for bucket and object listing\nReviewed by: Kelly McLaughlin \u003ckelly.mclaughlin@joyent.com\u003e\nApproved by: Kelly McLaughlin \u003ckelly.mclaughlin@joyent.com\u003e\n","createdOn":1562613946,"lastUpdated":1563922812,"open":false,"status":"MERGED","comments":[{"timestamp":1562613946,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Uploaded patch set 1."},{"timestamp":1562613949,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit 1a918dac8173979017ffba3738e7cbfdc073d5d0\n    \n    initial commit"},{"timestamp":1562614038,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1562618673,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1562689020,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1562776668,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Uploaded patch set 2."},{"timestamp":1562776671,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit 3e8a1c4b9dbb4f57e3311d49172831f956a7ddce\n    \n    changes based on kelly review"},{"timestamp":1562776762,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1562788438,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Patch Set 2:\n\n(1 comment)\n\nThis looks good. I\u0027ll finish looking over the rest of the related CRs and approve them as a group."},{"timestamp":1562788475,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Patch Set 2:\n\nOh, could you rebase it too to make sure there aren\u0027t any conflicts that need to be resolved?"},{"timestamp":1562951494,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Uploaded patch set 3."},{"timestamp":1562951499,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 3:\n\nNew commits:\n    \n    commit 22809bf1ed85d11074f99b2cbcdf7e8c4a35e967\n    \n    allow prefix and marker to be optional"},{"timestamp":1562951536,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Uploaded patch set 4: Patch Set 3 was rebased."},{"timestamp":1562951541,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 4:\n\nNew commits:\n    \n    commit c8114baf210f2e87a272b41e67de30d600a9fc59\n    \n    allow prefix and marker to be optional\n    \n    commit bddbd5f9b4c723e69d3653d53d4e48b8e36eec7a\n    \n    changes based on kelly review\n    \n    commit 0a4b2ddc1127f4bc089d1f3c01e29e2de0c17d07\n    \n    initial commit"},{"timestamp":1562951589,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1562951675,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1563222454,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Patch Set 4: Code-Review+1\n\n(1 comment)"},{"timestamp":1563290845,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 4:\n\n(1 comment)"},{"timestamp":1563292148,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Uploaded patch set 5."},{"timestamp":1563292150,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 5:\n\nNew commits:\n    \n    commit c496c8585d2f2948e948053e2d112e83b635c9ae\n    \n    changes based on kelly review"},{"timestamp":1563292250,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1563297936,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Patch Set 5: Code-Review+1"},{"timestamp":1563310794,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Patch Set 6: Patch Set 5 was rebased"},{"timestamp":1563310930,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 6:\n\n\"make check\" passed ok"},{"timestamp":1563915071,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Uploaded patch set 7: Patch Set 6 was rebased."},{"timestamp":1563915074,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 7:\n\nNew commits:\n    \n    commit 73ceca5bd09d4a760c8098f04bae28a78423cc85\n    \n    changes based on kelly review\n    \n    commit 178c92ff46607a699d18af37996f3e54b62744d1\n    \n    allow prefix and marker to be optional\n    \n    commit a99f29f91aea2233e866c2fb9c9b8bf5cdf963eb\n    \n    changes based on kelly review\n    \n    commit f053f82ed5c53153da164d6e584ecfe9a4e23bdd\n    \n    initial commit"},{"timestamp":1563915172,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 7:\n\n\"make check\" passed ok"},{"timestamp":1563915362,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Patch Set 7: Integration-Approval+1"},{"timestamp":1563922723,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Uploaded patch set 8: Commit message was updated."},{"timestamp":1563922812,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Dave Eddy"}],"currentPatchSet":{"number":"8","revision":"8ed0a6e8012391f83e73d57669aeb1e5b64eda7c","parents":["e02c21981fc1306f582a956dc8aefe3043dc6b64"],"ref":"refs/changes/71/6571/8","uploader":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"createdOn":1563922723,"author":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1563292250,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1563297936,"by":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1563915362,"by":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"}},{"type":"SUBM","value":"1","grantedOn":1563922812,"by":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"src/bucket/list.rs","type":"MODIFIED","insertions":61,"deletions":-21},{"file":"src/object/list.rs","type":"MODIFIED","insertions":68,"deletions":-21}],"sizeInsertions":129,"sizeDeletions":-42},"patchSets":[{"number":"1","revision":"94cb073a331e1c84aad0be72d5f8cf260ac178dc","parents":["b6e1a594f93e872981b2a61d32cdf065aa4c8af0"],"ref":"refs/changes/71/6571/1","uploader":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"createdOn":1562613946,"author":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1562614038,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"src/object/list.rs","line":106,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Maybe we should selectively compose this query based on if the optional parameters are provided are not and only incur the extra query complexity of `prefix` and `marker` if they are provided. The best way might be to make those two fields in the `ListObjectsPayload` into `Option` types and that should make it straightforward to selectively craft the query."},{"file":"src/object/list.rs","line":106,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Ah, that makes sense... I can take a look at programmatically building the query string."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/bucket/list.rs","type":"MODIFIED","insertions":9,"deletions":-17},{"file":"src/object/list.rs","type":"MODIFIED","insertions":9,"deletions":-16}],"sizeInsertions":18,"sizeDeletions":-33},{"number":"2","revision":"0491d875b240c64d67e35c6fcbac0242068e2a18","parents":["b6e1a594f93e872981b2a61d32cdf065aa4c8af0"],"ref":"refs/changes/71/6571/2","uploader":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"createdOn":1562776668,"author":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1562776762,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"src/bucket/list.rs","line":71,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Yeah, I\u0027d agree with this. If the marker and prefix fields are Option types then we can just match on whether or not these fields are `None` or `Some` and it\u0027ll be a bit more clear. \n\nAnother option we could do is to use the newtype pattern to create type wrappers for marker and prefix and implement a custom deserialization for those types whereby a null value for the field as well as the empty string are deserialized to `None`."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/bucket/list.rs","type":"MODIFIED","insertions":59,"deletions":-19},{"file":"src/object/list.rs","type":"MODIFIED","insertions":66,"deletions":-20}],"sizeInsertions":125,"sizeDeletions":-39},{"number":"3","revision":"d9f1b747c68a7c4ed85352340b6b2dd8abd34f8c","parents":["b6e1a594f93e872981b2a61d32cdf065aa4c8af0"],"ref":"refs/changes/71/6571/3","uploader":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"createdOn":1562951494,"author":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1562951589,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/bucket/list.rs","type":"MODIFIED","insertions":56,"deletions":-21},{"file":"src/object/list.rs","type":"MODIFIED","insertions":63,"deletions":-21}],"sizeInsertions":119,"sizeDeletions":-42},{"number":"4","revision":"b00003a14dfd722f2ea7a3029bc620a4f63334f4","parents":["57267bbb358a42f361959ff83d2c8530ef03b1f3"],"ref":"refs/changes/71/6571/4","uploader":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"createdOn":1562951536,"author":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1562951675,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1563222454,"by":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"}}],"comments":[{"file":"src/bucket/list.rs","line":71,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"This looks fine, but just for the purposes of knowledge sharing one other way to express this would be to use a `match` statement on a tuple of `(payload.marker, payload.prefix)` and then you would pattern match on the `Some(x)` or `None` values. The only real difference is the pattern match lets you avoid having to call `unwrap` to get the contained values if they are present. Sorry if that\u0027s completely obvious, but just wanted to share a different approach I\u0027ve used in other cases in case it\u0027s useful."},{"file":"src/bucket/list.rs","line":71,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"ah, that sounds much cleaner and much more idiomatic - i\u0027ll make that swap!"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/bucket/list.rs","type":"MODIFIED","insertions":56,"deletions":-21},{"file":"src/object/list.rs","type":"MODIFIED","insertions":63,"deletions":-21}],"sizeInsertions":119,"sizeDeletions":-42},{"number":"5","revision":"8b75b1388ba6984ea3c2202be818c0a43a42d087","parents":["57267bbb358a42f361959ff83d2c8530ef03b1f3"],"ref":"refs/changes/71/6571/5","uploader":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"createdOn":1563292148,"author":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1563292250,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1563297936,"by":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"src/bucket/list.rs","type":"MODIFIED","insertions":61,"deletions":-21},{"file":"src/object/list.rs","type":"MODIFIED","insertions":68,"deletions":-21}],"sizeInsertions":129,"sizeDeletions":-42},{"number":"6","revision":"be7003e075eb101627925f6b28ba6a4d4536a4da","parents":["ee9e01bf527be3c3916679b65e86ae84ffff47a0"],"ref":"refs/changes/71/6571/6","uploader":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"createdOn":1563310794,"author":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1563292250,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1563297936,"by":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"src/bucket/list.rs","type":"MODIFIED","insertions":61,"deletions":-21},{"file":"src/object/list.rs","type":"MODIFIED","insertions":68,"deletions":-21}],"sizeInsertions":129,"sizeDeletions":-42},{"number":"7","revision":"85f55b75546a7f1f171fa424d287f2b5252dff70","parents":["e02c21981fc1306f582a956dc8aefe3043dc6b64"],"ref":"refs/changes/71/6571/7","uploader":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"createdOn":1563915071,"author":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1563292250,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1563297936,"by":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1563915362,"by":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"src/bucket/list.rs","type":"MODIFIED","insertions":61,"deletions":-21},{"file":"src/object/list.rs","type":"MODIFIED","insertions":68,"deletions":-21}],"sizeInsertions":129,"sizeDeletions":-42},{"number":"8","revision":"8ed0a6e8012391f83e73d57669aeb1e5b64eda7c","parents":["e02c21981fc1306f582a956dc8aefe3043dc6b64"],"ref":"refs/changes/71/6571/8","uploader":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"createdOn":1563922723,"author":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1563292250,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"SUBM","value":"1","grantedOn":1563922812,"by":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1563297936,"by":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1563915362,"by":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"src/bucket/list.rs","type":"MODIFIED","insertions":61,"deletions":-21},{"file":"src/object/list.rs","type":"MODIFIED","insertions":68,"deletions":-21}],"sizeInsertions":129,"sizeDeletions":-42}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"}]}