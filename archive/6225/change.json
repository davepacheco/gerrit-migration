{"project":"joyent/muppet","branch":"master","topic":"haproxy-v1.8.20","id":"I009fb01b42862738388de6d5f60843c5494bf8af","number":"6225","subject":"MANTA-3525 Handle zookeeper changes without restarting haproxy MANTA-4369 use local haproxy for muppet tests Reviewed by: John Levon \u003cjohn.levon@joyent.com\u003e Approved by: John Levon \u003cjohn.levon@joyent.com\u003e","owner":{"name":"Russell Brown","email":"russell.brown@joyent.com","username":"russelldb"},"url":"https://cr.joyent.us/6225","commitMessage":"MANTA-3525 Handle zookeeper changes without restarting haproxy\nMANTA-4369 use local haproxy for muppet tests\nReviewed by: John Levon \u003cjohn.levon@joyent.com\u003e\nApproved by: John Levon \u003cjohn.levon@joyent.com\u003e\n","createdOn":1557493528,"lastUpdated":1561989030,"open":false,"status":"MERGED","comments":[{"timestamp":1557493528,"reviewer":{"name":"Russell Brown","email":"russell.brown@joyent.com","username":"russelldb"},"message":"Uploaded patch set 1."},{"timestamp":1557493533,"reviewer":{"name":"Russell Brown","email":"russell.brown@joyent.com","username":"russelldb"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit 4778a47af4569589618d6fa0ea3864177ebbcdc4\n    \n    MANTA-3525 start haproxy with a config that allows graceful reload\n    When the loadbalancer(muppet) zone starts the haproxy service it uses\n    the haproxy.cfg.default file, that file, then, must also have the\n    fd-listeners graceful config reload options enabled, or muppet will\n    not be able to refresh the service when it writes the _real_ config.\n    \n    commit 1784f0fa6d85ea7fcb549fd0549c12ff01321a29\n    \n    MANTA-3525 experience has taught me there is nothing simple about it\n    https://jameshfisher.com/2018/09/13/dont-say-simply-writethedocs-prague/\n    is a decent reference. We don\u0027t need to say simply, it doesn\u0027t help.\n    \n    commit cd0b1b36ffe936a729ccd35982e8089739289130\n    \n    MANTA-3525 WIP add worker/master mode flag to SMF for haproxy\n    And you know, add it to the haproxy.xml.in, and not the haproxy.xml\n    this time...\n    \n    commit e5e7f7725586c2cdbcfee9618c776b00990770b1\n    \n    MANTA-3525 WIP switch to haproxy-1.8\n    And use refresh, not restart for gracefully (i.e. not dropped\n    connections) reloading the haproxy config."},{"timestamp":1557493555,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1559724867,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 1:\n\n(So I don\u0027t forget) docs/index.md needs updating too."},{"timestamp":1560517954,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 1:\n\n(11 comments)"},{"timestamp":1560763304,"reviewer":{"name":"Russell Brown","email":"russell.brown@joyent.com","username":"russelldb"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1560764155,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1560764682,"reviewer":{"name":"Russell Brown","email":"russell.brown@joyent.com","username":"russelldb"},"message":"Patch Set 1:\n\n\u003e (1 comment)\n\nWill do. Thanks."},{"timestamp":1560784169,"reviewer":{"name":"Russell Brown","email":"russell.brown@joyent.com","username":"russelldb"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1560784478,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1560785084,"reviewer":{"name":"Russell Brown","email":"russell.brown@joyent.com","username":"russelldb"},"message":"Patch Set 1:\n\n\u003e (1 comment)\n\nDoes SMF refresh let the caller know it has failed?"},{"timestamp":1560785505,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 1:\n\nNot via svcadm at least (and there\u0027s no -s option). Hmm. Another motivator for the v2 API?"},{"timestamp":1560842049,"reviewer":{"name":"Russell Brown","email":"russell.brown@joyent.com","username":"russelldb"},"message":"Patch Set 1:\n\n\u003e Not via svcadm at least (and there\u0027s no -s option). Hmm. Another\n \u003e motivator for the v2 API?\n\nv2 API of haproxy? I don\u0027t follow"},{"timestamp":1560872858,"reviewer":{"name":"Russell Brown","email":"russell.brown@joyent.com","username":"russelldb"},"message":"Uploaded patch set 2."},{"timestamp":1560872889,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1560873086,"reviewer":{"name":"Russell Brown","email":"russell.brown@joyent.com","username":"russelldb"},"message":"Uploaded patch set 3: Patch Set 2 was rebased."},{"timestamp":1560885802,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 3:\n\n(2 comments)\n\nThis looks basically fine to me. Please make sure to update copyright on all your changed files.\n\nThe \"locking\" code is kind of horrible, but it probably doesn\u0027t make sense to try and do anything about that right now.\n\nCould we get a little more detail as to what the refresh method actually does in haproxy, namely -\n\n - only the master process will take the signal\n - it\u0027ll keep running, so SMF is happy\n - master will start a new worker with the new config, and pass along the listening sockets\n - old instances may hang around for already open connections"},{"timestamp":1561019403,"reviewer":{"name":"Russell Brown","email":"russell.brown@joyent.com","username":"russelldb"},"message":"Uploaded patch set 4."},{"timestamp":1561019409,"reviewer":{"name":"Russell Brown","email":"russell.brown@joyent.com","username":"russelldb"},"message":"Patch Set 4:\n\nNew commits:\n    \n    commit c7af5b313200b02d846e0b432e24324c69a243f4\n    \n    MANTA-3525 bring on haproxy process management changes"},{"timestamp":1561019433,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1561022399,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 4:\n\nI was trying a make test in muppet just now, and the haproxy exec change seems to have broken the old way of testing. Did you set up manta/haproxy by hand on your dev machine?\n\nIt\u0027s certainly not idea to use whatever pkgsrc haproxy is around, so if we\u0027re going to set up our own smf service during the test, that\u0027s great. Otherwise I think we need to go back to the previous FMRI."},{"timestamp":1561024296,"reviewer":{"name":"Russell Brown","email":"russell.brown@joyent.com","username":"russelldb"},"message":"Patch Set 4:\n\n\u003e I was trying a make test in muppet just now, and the haproxy exec\n \u003e change seems to have broken the old way of testing. Did you set up\n \u003e manta/haproxy by hand on your dev machine?\n \u003e \n \u003e It\u0027s certainly not idea to use whatever pkgsrc haproxy is around,\n \u003e so if we\u0027re going to set up our own smf service during the test,\n \u003e that\u0027s great. Otherwise I think we need to go back to the previous\n \u003e FMRI.\n\nRight! Hence my plan to update the test to setup/teardown haproxy with a realistic FMRI. I\u0027m ok to back out the change, but then the test is broken on _my_ dev setup, where there are two haproxy services"},{"timestamp":1561024369,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 4:\n\nI have a different fix for this, will push my branch shortly"},{"timestamp":1561024496,"reviewer":{"name":"Russell Brown","email":"russell.brown@joyent.com","username":"russelldb"},"message":"Patch Set 4:\n\n\u003e I have a different fix for this, will push my branch shortly\n\nso I should stop working on setting/tearing down SMF as part of the testing?"},{"timestamp":1561026465,"reviewer":{"name":"Russell Brown","email":"russell.brown@joyent.com","username":"russelldb"},"message":"Uploaded patch set 5."},{"timestamp":1561026469,"reviewer":{"name":"Russell Brown","email":"russell.brown@joyent.com","username":"russelldb"},"message":"Patch Set 5:\n\nNew commits:\n    \n    commit 0f8bf22f72e180906bb85121159b8cb411cf1056\n    \n    MANTA-3525 update haproxy submod\n    \n    commit c0abc5c2b64ba85717b28178767da0ffa417e7a2\n    \n    Merge branch \u0027jlevon/MANTA-3525-wip\u0027 into rdb/MANTA-3525-wip\n    \n    commit c5bef5a42f0bb11afa325d6d2d031e899f58c2f2\n    \n    MANTA-3525 support max-old-workers\n    \n    commit da41bcc7b17e49b912323953156a84c3585c3d36\n    \n    Use the local haproxy instead of a system one. This has the advantage of\n    using the actual version we\u0027re including, and the disadvantage of losing\n    the test where we parse svcprop.\n    \n    commit deae2c932c7c9aa1a9e63b73403d618f46f12c10\n    \n    max-old-workers\n    \n    commit f5a09e425d165f7c326760da951afcde95c2d32f\n    \n    update haproxy\n    \n    commit 40d34f257b7bb342a513b7697bca137ab7fd82c7\n    \n    MANTA-3525 more review addressing"},{"timestamp":1561026498,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1561027147,"reviewer":{"name":"Russell Brown","email":"russell.brown@joyent.com","username":"russelldb"},"message":"Uploaded patch set 6."},{"timestamp":1561027152,"reviewer":{"name":"Russell Brown","email":"russell.brown@joyent.com","username":"russelldb"},"message":"Patch Set 6:\n\nNew commits:\n    \n    commit ce9d1d66c73309893a7e17a85c7978393ec9f1a3\n    \n    MANTA-3525 repeatedly update the haproxy submod\n    \n    commit a94e13bc46c8fa4058a044889594254f441afced\n    \n    Merge branch \u0027rdb/MANTA-3525-wip\u0027 of ssh://192.168.118.15:/root/muppet into grr-MANTA-3525\n    \n    commit 975090b1fce6f0815ac412d31e4afed32f38612c\n    \n    MANTA-3525 update copyright\n    \n    commit 39a2cc779c14312208b6dd85ff89a2ea6cf0f716\n    \n    MANTA-3525 update eng"},{"timestamp":1561027178,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 6: CI-Testing-1\n\n\"make check\" exited with status 2\n\n fatal: ref HEAD is not a symbolic ref\n fatal: No tags can describe \u0027a14c91d6c286d34c814b651105afd6cd73591a3a\u0027.\n Try --always, or create some tags.\n xmllint --noout --path deps/eng/tools/ --dtdvalid deps/eng/tools/service_bundle.dtd.1 smf/manifests/muppet.xml\n xmllint --noout --path deps/eng/tools/ --dtdvalid deps/eng/tools/service_bundle.dtd.1 smf/manifests/haproxy.xml\n xmllint --noout --path deps/eng/tools/ --dtdvalid deps/eng/tools/service_bundle.dtd.1 smf/manifests/stud.xml\n deps/javascriptlint/build/install/jsl --nologo --nosummary --conf\u003dtools/jsl.node.conf muppet.js lib/index.js lib/watch.js lib/lb_manager.js lib/zk.js test/watch.test.js test/config.test.js test/helper.js\n /tmp/repo/muppet.js\n /tmp/repo/lib/index.js\n /tmp/repo/lib/watch.js\n /tmp/repo/lib/lb_manager.js\n /tmp/repo/lib/zk.js\n /tmp/repo/test/watch.test.js\n /tmp/repo/test/config.test.js\n /tmp/repo/test/helper.js\n deps/jsstyle/jsstyle -f tools/jsstyle.conf muppet.js lib/index.js lib/watch.js lib/lb_manager.js lib/zk.js test/watch.test.js test/config.test.js test/helper.js\n deps/eng/tools/check-copyright -q\n error: lib/watch.js: copyright year not updated to 2019: \u0027 * Copyright (c) 2017, Joyent, Inc.\u0027\n error: lib/zk.js: copyright year not updated to 2019: \u0027 * Copyright (c) 2017, Joyent, Inc.\u0027\n gmake: *** [deps/eng/tools/mk/Makefile.targ:292: check-copyright] Error 1"},{"timestamp":1561045937,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 6:\n\n(1 comment)\n\nLooks great to me, modulo one last nit"},{"timestamp":1561051239,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Topic set to haproxy-v1.8.20"},{"timestamp":1561102530,"reviewer":{"name":"Russell Brown","email":"russell.brown@joyent.com","username":"russelldb"},"message":"Uploaded patch set 7."},{"timestamp":1561102536,"reviewer":{"name":"Russell Brown","email":"russell.brown@joyent.com","username":"russelldb"},"message":"Patch Set 7:\n\nNew commits:\n    \n    commit 16cda7850c68501b331ae5ebfdb552dab035d11d\n    \n    MANTA-3525 drop unnecessary copyright per-review"},{"timestamp":1561102560,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 7: CI-Testing-1\n\n\"make check\" exited with status 2\n\n fatal: ref HEAD is not a symbolic ref\n fatal: No tags can describe \u002749bbbb5eed6c05cdd231b9465eb16e3e530d17a2\u0027.\n Try --always, or create some tags.\n xmllint --noout --path deps/eng/tools/ --dtdvalid deps/eng/tools/service_bundle.dtd.1 smf/manifests/muppet.xml\n xmllint --noout --path deps/eng/tools/ --dtdvalid deps/eng/tools/service_bundle.dtd.1 smf/manifests/haproxy.xml\n xmllint --noout --path deps/eng/tools/ --dtdvalid deps/eng/tools/service_bundle.dtd.1 smf/manifests/stud.xml\n deps/javascriptlint/build/install/jsl --nologo --nosummary --conf\u003dtools/jsl.node.conf muppet.js lib/zk.js lib/lb_manager.js lib/index.js lib/watch.js test/config.test.js test/watch.test.js test/helper.js\n /tmp/repo/muppet.js\n /tmp/repo/lib/zk.js\n /tmp/repo/lib/lb_manager.js\n /tmp/repo/lib/index.js\n /tmp/repo/lib/watch.js\n /tmp/repo/test/config.test.js\n /tmp/repo/test/watch.test.js\n /tmp/repo/test/helper.js\n deps/jsstyle/jsstyle -f tools/jsstyle.conf muppet.js lib/zk.js lib/lb_manager.js lib/index.js lib/watch.js test/config.test.js test/watch.test.js test/helper.js\n deps/eng/tools/check-copyright -q\n error: lib/watch.js: copyright year not updated to 2019: \u0027 * Copyright (c) 2017, Joyent, Inc.\u0027\n error: lib/zk.js: copyright year not updated to 2019: \u0027 * Copyright (c) 2017, Joyent, Inc.\u0027\n gmake: *** [deps/eng/tools/mk/Makefile.targ:292: check-copyright] Error 1"},{"timestamp":1561381601,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 7: Code-Review+1"},{"timestamp":1561390804,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 7:\n\nWhen this is rebased against MANTA-4337, make test will break. Could you also fix up for MANTA-4369 as suggested there?"},{"timestamp":1561632311,"reviewer":{"name":"Russell Brown","email":"russell.brown@joyent.com","username":"russelldb"},"message":"Uploaded patch set 8."},{"timestamp":1561632341,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 8: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1561632370,"reviewer":{"name":"Russell Brown","email":"russell.brown@joyent.com","username":"russelldb"},"message":"Patch Set 8:\n\n\u003e Uploaded patch set 8.\n\nAgain grr failed to add the comments (exited status 1) but did push the changes. Sorry for lack of explanatory comments"},{"timestamp":1561633959,"reviewer":{"name":"Russell Brown","email":"russell.brown@joyent.com","username":"russelldb"},"message":"Uploaded patch set 9."},{"timestamp":1561633963,"reviewer":{"name":"Russell Brown","email":"russell.brown@joyent.com","username":"russelldb"},"message":"Patch Set 9:\n\nNew commits:\n    \n    commit 863c97661374969cce42f838af5c7657f9fa693d\n    \n    MANTA-3525 MANTA-4369 restart-\u003ereload, again"},{"timestamp":1561633991,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 9: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1561639688,"reviewer":{"name":"Russell Brown","email":"russell.brown@joyent.com","username":"russelldb"},"message":"Uploaded patch set 10."},{"timestamp":1561639719,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 10: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1561640129,"reviewer":{"name":"Russell Brown","email":"russell.brown@joyent.com","username":"russelldb"},"message":"Uploaded patch set 11: Commit message was updated."},{"timestamp":1561640439,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 11:\n\n(2 comments)"},{"timestamp":1561640597,"reviewer":{"name":"Russell Brown","email":"russell.brown@joyent.com","username":"russelldb"},"message":"Patch Set 11:\n\n(1 comment)"},{"timestamp":1561640800,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 11:\n\n(1 comment)"},{"timestamp":1561641021,"reviewer":{"name":"Russell Brown","email":"russell.brown@joyent.com","username":"russelldb"},"message":"Patch Set 11:\n\n\u003e (1 comment)\n\nyes, it is now."},{"timestamp":1561641102,"reviewer":{"name":"Russell Brown","email":"russell.brown@joyent.com","username":"russelldb"},"message":"Uploaded patch set 12."},{"timestamp":1561641132,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 12: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1561641140,"reviewer":{"name":"Russell Brown","email":"russell.brown@joyent.com","username":"russelldb"},"message":"Patch Set 12:\n\n\u003e Uploaded patch set 12.\n\nyou know what they say, 12th time lucky!"},{"timestamp":1561641237,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 12: Code-Review+1\n\nObviously there\u0027s one more commit to update to the official haproxy when it\u0027s back, but looks good to me."},{"timestamp":1561650140,"reviewer":{"name":"Russell Brown","email":"russell.brown@joyent.com","username":"russelldb"},"message":"Uploaded patch set 13."},{"timestamp":1561650169,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 13: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1561720573,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 13: Code-Review+1"},{"timestamp":1561977582,"reviewer":{"name":"Russell Brown","email":"russell.brown@joyent.com","username":"russelldb"},"message":"Uploaded patch set 14."},{"timestamp":1561977613,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 14: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1561987989,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 14: Code-Review+1 Integration-Approval+1"},{"timestamp":1561988456,"reviewer":{"name":"Russell Brown","email":"russell.brown@joyent.com","username":"russelldb"},"message":"Uploaded patch set 15: Commit message was updated."},{"timestamp":1561988957,"reviewer":{"name":"Russell Brown","email":"russell.brown@joyent.com","username":"russelldb"},"message":"Uploaded patch set 16: Commit message was updated."},{"timestamp":1561989030,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Russell Brown"}],"currentPatchSet":{"number":"16","revision":"009fb01b42862738388de6d5f60843c5494bf8af","parents":["f38f9bbd3eb3e1c313f818381d65274846d40485"],"ref":"refs/changes/25/6225/16","uploader":{"name":"Russell Brown","email":"russell.brown@joyent.com","username":"russelldb"},"createdOn":1561988957,"author":{"name":"Russell Brown","email":"russell.brown@joyent.com","username":"russelldb"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1561977613,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1561987989,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1561987989,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}},{"type":"SUBM","value":"1","grantedOn":1561989030,"by":{"name":"Russell Brown","email":"russell.brown@joyent.com","username":"russelldb"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":".gitmodules","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"README.md","type":"MODIFIED","insertions":2,"deletions":-15},{"file":"deps/eng","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"deps/haproxy-1.5","type":"DELETED","insertions":0,"deletions":-1},{"file":"deps/haproxy-1.8","type":"ADDED","insertions":1,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":15,"deletions":-15},{"file":"etc/haproxy.cfg.default","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"etc/haproxy.cfg.in","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"lib/app.js","type":"MODIFIED","insertions":6,"deletions":-6},{"file":"lib/lb_manager.js","type":"MODIFIED","insertions":72,"deletions":-70},{"file":"lib/watch.js","type":"MODIFIED","insertions":5,"deletions":-5},{"file":"muppet.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"smf/manifests/haproxy.xml.in","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"test/config.test.js","type":"MODIFIED","insertions":32,"deletions":-27},{"file":"test/helper.js","type":"MODIFIED","insertions":2,"deletions":-30},{"file":"tools/mk/Makefile.haproxy.defs","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":160,"sizeDeletions":-180},"patchSets":[{"number":"1","revision":"45b426be8c3fcc1c0af37631b1f1eda997e7ffe6","parents":["7c5801f42e756f477b0d4a8862088e0fa2e5d600"],"ref":"refs/changes/25/6225/1","uploader":{"name":"Russell Brown","email":"russell.brown@joyent.com","username":"russelldb"},"createdOn":1557493528,"author":{"name":"Russell Brown","email":"russell.brown@joyent.com","username":"russelldb"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1557493555,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"README.md","line":8,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"drop the \u0027(c)\u0027"},{"file":"README.md","line":11,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"docs/index.md needs updating"},{"file":"README.md","line":11,"reviewer":{"name":"Russell Brown","email":"russell.brown@joyent.com","username":"russelldb"},"message":"In what way? With what?"},{"file":"README.md","line":11,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"We no longer use a \"patch from openwrt\". We could usefully link to joyent/haproxy-1.8\n\nWould also be nice to fix the name of the template file, as it sounds right now like \u0027haproxy.cfg\u0027 exists in the repo."},{"file":"etc/haproxy.cfg.default","line":8,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"ditto as other file. Should we also take the opportunity to harmonise the files? They\u0027re weirdly different right now."},{"file":"etc/haproxy.cfg.in","line":5,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Once there\u0027s some consensus we need a hard-stop-after value here."},{"file":"etc/haproxy.cfg.in","line":9,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"can we add docs for the new settings? just a brief line of why we need it."},{"file":"lib/lb_manager.js","line":36,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"rename to REFRESH?"},{"file":"lib/lb_manager.js","line":36,"reviewer":{"name":"Russell Brown","email":"russell.brown@joyent.com","username":"russelldb"},"message":"going to argue that this should be (should _always_ have been) reload, since that is what it does, restart or refresh are just how, and as we have seen, how can change."},{"file":"lib/lb_manager.js","line":36,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"agreed. I\u0027m actually wondering if refresh *does* fail on us, maybe we should fall back to restart and the old backoff stuff."},{"file":"lib/lb_manager.js","line":110,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"also needs reworking, but I\u0027d wait for the incoming MANTA-4337 anyway"},{"file":"lib/lb_manager.js","line":117,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"As a refresh is fire-and-forget, I\u0027m not sure if we really want a backoff like this here."},{"file":"lib/lb_manager.js","line":230,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"etc"},{"file":"smf/manifests/haproxy.xml.in","line":42,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"please put \"master-worker\" in the .cfg file instead of passing on the command line"},{"file":"tools/mk/Makefile.haproxy.defs","line":9,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"copyright"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".gitmodules","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"README.md","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"deps/haproxy-1.5","type":"DELETED","insertions":0,"deletions":-1},{"file":"deps/haproxy-1.8","type":"ADDED","insertions":1,"deletions":0},{"file":"etc/haproxy.cfg.default","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"etc/haproxy.cfg.in","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/lb_manager.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"smf/manifests/haproxy.xml.in","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"tools/mk/Makefile.haproxy.defs","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":15,"sizeDeletions":-13},{"number":"2","revision":"72935a818ddf223034a967b525b0a233e15d7474","parents":["7c5801f42e756f477b0d4a8862088e0fa2e5d600"],"ref":"refs/changes/25/6225/2","uploader":{"name":"Russell Brown","email":"russell.brown@joyent.com","username":"russelldb"},"createdOn":1560872858,"author":{"name":"Jenkins Agent","email":"jenkins-agent@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1560872889,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".gitmodules","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"README.md","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"deps/haproxy-1.5","type":"DELETED","insertions":0,"deletions":-1},{"file":"deps/haproxy-1.8","type":"ADDED","insertions":1,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":15,"deletions":-15},{"file":"etc/haproxy.cfg.default","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"etc/haproxy.cfg.in","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"lib/index.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/lb_manager.js","type":"MODIFIED","insertions":51,"deletions":-62},{"file":"muppet.js","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"smf/manifests/haproxy.xml.in","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/config.test.js","type":"MODIFIED","insertions":19,"deletions":-17},{"file":"tools/mk/Makefile.haproxy.defs","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":112,"sizeDeletions":-111},{"number":"3","revision":"490540f95c9547bbfa567f0008d0a468e4cfc785","parents":["7c5801f42e756f477b0d4a8862088e0fa2e5d600"],"ref":"refs/changes/25/6225/3","uploader":{"name":"Russell Brown","email":"russell.brown@joyent.com","username":"russelldb"},"createdOn":1560873086,"author":{"name":"Russell Brown","email":"russell.brown@joyent.com","username":"russelldb"},"isDraft":false,"kind":"NO_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1560872889,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/lb_manager.js","line":46,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"a missing \"restart\" mention here"},{"file":"lib/lb_manager.js","line":140,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"while here, can we correct s/svccfg/svcprop/ ?"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".gitmodules","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"README.md","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"deps/haproxy-1.5","type":"DELETED","insertions":0,"deletions":-1},{"file":"deps/haproxy-1.8","type":"ADDED","insertions":1,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":15,"deletions":-15},{"file":"etc/haproxy.cfg.default","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"etc/haproxy.cfg.in","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"lib/index.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/lb_manager.js","type":"MODIFIED","insertions":51,"deletions":-62},{"file":"muppet.js","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"smf/manifests/haproxy.xml.in","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/config.test.js","type":"MODIFIED","insertions":19,"deletions":-17},{"file":"tools/mk/Makefile.haproxy.defs","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":112,"sizeDeletions":-111},{"number":"4","revision":"069cb4a1ff9158e2dd0f6b246612b7c0c62414e7","parents":["7c5801f42e756f477b0d4a8862088e0fa2e5d600"],"ref":"refs/changes/25/6225/4","uploader":{"name":"Russell Brown","email":"russell.brown@joyent.com","username":"russelldb"},"createdOn":1561019403,"author":{"name":"Russell Brown","email":"russell.brown@joyent.com","username":"russelldb"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1561019433,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".gitmodules","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"README.md","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"deps/haproxy-1.5","type":"DELETED","insertions":0,"deletions":-1},{"file":"deps/haproxy-1.8","type":"ADDED","insertions":1,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":15,"deletions":-15},{"file":"etc/haproxy.cfg.default","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"etc/haproxy.cfg.in","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"lib/index.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/lb_manager.js","type":"MODIFIED","insertions":51,"deletions":-62},{"file":"muppet.js","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"smf/manifests/haproxy.xml.in","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/config.test.js","type":"MODIFIED","insertions":19,"deletions":-17},{"file":"tools/mk/Makefile.haproxy.defs","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":112,"sizeDeletions":-111},{"number":"5","revision":"d087c1f09425a3eaa5cb0355b2f1a03d4c4ad475","parents":["7c5801f42e756f477b0d4a8862088e0fa2e5d600"],"ref":"refs/changes/25/6225/5","uploader":{"name":"Russell Brown","email":"russell.brown@joyent.com","username":"russelldb"},"createdOn":1561026465,"author":{"name":"Russell Brown","email":"russell.brown@joyent.com","username":"russelldb"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1561026498,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".gitmodules","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"README.md","type":"MODIFIED","insertions":2,"deletions":-15},{"file":"deps/haproxy-1.5","type":"DELETED","insertions":0,"deletions":-1},{"file":"deps/haproxy-1.8","type":"ADDED","insertions":1,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":15,"deletions":-15},{"file":"etc/haproxy.cfg.default","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"etc/haproxy.cfg.in","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"lib/index.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/lb_manager.js","type":"MODIFIED","insertions":71,"deletions":-69},{"file":"muppet.js","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"smf/manifests/haproxy.xml.in","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/config.test.js","type":"MODIFIED","insertions":31,"deletions":-26},{"file":"tools/mk/Makefile.haproxy.defs","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":147,"sizeDeletions":-139},{"number":"6","revision":"a14c91d6c286d34c814b651105afd6cd73591a3a","parents":["7c5801f42e756f477b0d4a8862088e0fa2e5d600"],"ref":"refs/changes/25/6225/6","uploader":{"name":"Russell Brown","email":"russell.brown@joyent.com","username":"russelldb"},"createdOn":1561027147,"author":{"name":"Russell Brown","email":"russell.brown@joyent.com","username":"russelldb"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1561027178,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"tools/mk/Makefile.haproxy.targ","line":9,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"You can drop this copyright update."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".gitmodules","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"README.md","type":"MODIFIED","insertions":2,"deletions":-15},{"file":"deps/eng","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"deps/haproxy-1.5","type":"DELETED","insertions":0,"deletions":-1},{"file":"deps/haproxy-1.8","type":"ADDED","insertions":1,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":15,"deletions":-15},{"file":"etc/haproxy.cfg.default","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"etc/haproxy.cfg.in","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"lib/index.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/lb_manager.js","type":"MODIFIED","insertions":72,"deletions":-70},{"file":"muppet.js","type":"MODIFIED","insertions":5,"deletions":-5},{"file":"smf/manifests/haproxy.xml.in","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"test/config.test.js","type":"MODIFIED","insertions":32,"deletions":-27},{"file":"tools/mk/Makefile.haproxy.defs","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"tools/mk/Makefile.haproxy.targ","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":154,"sizeDeletions":-146},{"number":"7","revision":"49bbbb5eed6c05cdd231b9465eb16e3e530d17a2","parents":["7c5801f42e756f477b0d4a8862088e0fa2e5d600"],"ref":"refs/changes/25/6225/7","uploader":{"name":"Russell Brown","email":"russell.brown@joyent.com","username":"russelldb"},"createdOn":1561102530,"author":{"name":"Russell Brown","email":"russell.brown@joyent.com","username":"russelldb"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1561102560,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1561381601,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".gitmodules","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"README.md","type":"MODIFIED","insertions":2,"deletions":-15},{"file":"deps/eng","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"deps/haproxy-1.5","type":"DELETED","insertions":0,"deletions":-1},{"file":"deps/haproxy-1.8","type":"ADDED","insertions":1,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":15,"deletions":-15},{"file":"etc/haproxy.cfg.default","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"etc/haproxy.cfg.in","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"lib/index.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/lb_manager.js","type":"MODIFIED","insertions":72,"deletions":-70},{"file":"muppet.js","type":"MODIFIED","insertions":5,"deletions":-5},{"file":"smf/manifests/haproxy.xml.in","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"test/config.test.js","type":"MODIFIED","insertions":32,"deletions":-27},{"file":"tools/mk/Makefile.haproxy.defs","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"tools/mk/Makefile.haproxy.targ","type":"MODIFIED","insertions":0,"deletions":-4}],"sizeInsertions":153,"sizeDeletions":-149},{"number":"8","revision":"3401d76450203a0b2d63db7e783fffa7cec00002","parents":["7c5801f42e756f477b0d4a8862088e0fa2e5d600"],"ref":"refs/changes/25/6225/8","uploader":{"name":"Russell Brown","email":"russell.brown@joyent.com","username":"russelldb"},"createdOn":1561632311,"author":{"name":"Russell Brown","email":"russell.brown@joyent.com","username":"russelldb"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1561632341,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":".gitmodules","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"README.md","type":"MODIFIED","insertions":2,"deletions":-15},{"file":"deps/eng","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"deps/haproxy-1.5","type":"DELETED","insertions":0,"deletions":-1},{"file":"deps/haproxy-1.8","type":"ADDED","insertions":1,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":15,"deletions":-15},{"file":"etc/haproxy.cfg.default","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"etc/haproxy.cfg.in","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"lib/app.js","type":"ADDED","insertions":205,"deletions":0},{"file":"lib/index.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/lb_manager.js","type":"MODIFIED","insertions":72,"deletions":-70},{"file":"lib/watch.js","type":"MODIFIED","insertions":432,"deletions":-264},{"file":"lib/zk.js","type":"DELETED","insertions":0,"deletions":-44},{"file":"muppet.js","type":"MODIFIED","insertions":22,"deletions":-229},{"file":"package.json","type":"MODIFIED","insertions":31,"deletions":-30},{"file":"smf/manifests/haproxy.xml.in","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"test/config.test.js","type":"MODIFIED","insertions":32,"deletions":-27},{"file":"test/helper.js","type":"MODIFIED","insertions":2,"deletions":-30},{"file":"tools/mk/Makefile.haproxy.defs","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"tools/mk/Makefile.haproxy.targ","type":"MODIFIED","insertions":0,"deletions":-4},{"file":"tools/service_bundle.dtd.1","type":"DELETED","insertions":0,"deletions":-1091}],"sizeInsertions":840,"sizeDeletions":-1832},{"number":"9","revision":"1b7e14a39923fa70055fe60b9a5dba548f4973d6","parents":["7c5801f42e756f477b0d4a8862088e0fa2e5d600"],"ref":"refs/changes/25/6225/9","uploader":{"name":"Russell Brown","email":"russell.brown@joyent.com","username":"russelldb"},"createdOn":1561633959,"author":{"name":"Russell Brown","email":"russell.brown@joyent.com","username":"russelldb"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1561633991,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".gitmodules","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"README.md","type":"MODIFIED","insertions":2,"deletions":-15},{"file":"deps/eng","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"deps/haproxy-1.5","type":"DELETED","insertions":0,"deletions":-1},{"file":"deps/haproxy-1.8","type":"ADDED","insertions":1,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":15,"deletions":-15},{"file":"etc/haproxy.cfg.default","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"etc/haproxy.cfg.in","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"lib/app.js","type":"ADDED","insertions":205,"deletions":0},{"file":"lib/index.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/lb_manager.js","type":"MODIFIED","insertions":72,"deletions":-70},{"file":"lib/watch.js","type":"MODIFIED","insertions":432,"deletions":-264},{"file":"lib/zk.js","type":"DELETED","insertions":0,"deletions":-44},{"file":"muppet.js","type":"MODIFIED","insertions":22,"deletions":-229},{"file":"package.json","type":"MODIFIED","insertions":31,"deletions":-30},{"file":"smf/manifests/haproxy.xml.in","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"test/config.test.js","type":"MODIFIED","insertions":32,"deletions":-27},{"file":"test/helper.js","type":"MODIFIED","insertions":2,"deletions":-30},{"file":"tools/mk/Makefile.haproxy.defs","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"tools/mk/Makefile.haproxy.targ","type":"MODIFIED","insertions":0,"deletions":-4},{"file":"tools/service_bundle.dtd.1","type":"DELETED","insertions":0,"deletions":-1091}],"sizeInsertions":840,"sizeDeletions":-1832},{"number":"10","revision":"874634832e5d5b888062587d029c893ebe3cb7d6","parents":["d22c1b6de5a018ae1a8d17e1d2d79638e2167407"],"ref":"refs/changes/25/6225/10","uploader":{"name":"Russell Brown","email":"russell.brown@joyent.com","username":"russelldb"},"createdOn":1561639688,"author":{"name":"Russell Brown","email":"russell.brown@joyent.com","username":"russelldb"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1561639719,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".gitmodules","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"README.md","type":"MODIFIED","insertions":2,"deletions":-15},{"file":"docs/index.md","type":"MODIFIED","insertions":15,"deletions":-15},{"file":"etc/haproxy.cfg.default","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"etc/haproxy.cfg.in","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"lib/app.js","type":"MODIFIED","insertions":6,"deletions":-6},{"file":"lib/index.js","type":"ADDED","insertions":23,"deletions":0},{"file":"lib/lb_manager.js","type":"MODIFIED","insertions":72,"deletions":-70},{"file":"lib/watch.js","type":"MODIFIED","insertions":5,"deletions":-5},{"file":"muppet.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"smf/manifests/haproxy.xml.in","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"test/config.test.js","type":"MODIFIED","insertions":32,"deletions":-27},{"file":"test/helper.js","type":"MODIFIED","insertions":2,"deletions":-30},{"file":"tools/mk/Makefile.haproxy.defs","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"tools/mk/Makefile.haproxy.targ","type":"MODIFIED","insertions":0,"deletions":-4}],"sizeInsertions":181,"sizeDeletions":-182},{"number":"11","revision":"9a498a059115a4e7faae37790447f832315da11d","parents":["f38f9bbd3eb3e1c313f818381d65274846d40485"],"ref":"refs/changes/25/6225/11","uploader":{"name":"Russell Brown","email":"russell.brown@joyent.com","username":"russelldb"},"createdOn":1561640129,"author":{"name":"Russell Brown","email":"russell.brown@joyent.com","username":"russelldb"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1561639719,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/index.js","line":1,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"This file got accidentally resurrected"},{"file":"tools/mk/Makefile.haproxy.targ","line":8,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"copyright got deleted totally here"},{"file":"tools/mk/Makefile.haproxy.targ","line":8,"reviewer":{"name":"Russell Brown","email":"russell.brown@joyent.com","username":"russelldb"},"message":"I clearly misunderstood this https://cr.joyent.us/#/c/6225/6/tools/mk/Makefile.haproxy.targ@9\n\nas drop the copyright. The eng updates make check made me update it to 2019. Are you saying leave the file as it was originally, copyright as 2017?"},{"file":"tools/mk/Makefile.haproxy.targ","line":8,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Right, you don\u0027t have any changes in this file against master, so you shouldn\u0027t be touching this file at all. \u0027make check\u0027 should be happy if there\u0027s no commits against that file at all in your single commit against master."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":".gitmodules","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"README.md","type":"MODIFIED","insertions":2,"deletions":-15},{"file":"deps/eng","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"deps/haproxy-1.8","type":"ADDED","insertions":1,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":15,"deletions":-15},{"file":"etc/haproxy.cfg.default","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"etc/haproxy.cfg.in","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"lib/app.js","type":"MODIFIED","insertions":6,"deletions":-6},{"file":"lib/index.js","type":"ADDED","insertions":23,"deletions":0},{"file":"lib/lb_manager.js","type":"MODIFIED","insertions":72,"deletions":-70},{"file":"lib/watch.js","type":"MODIFIED","insertions":5,"deletions":-5},{"file":"muppet.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"smf/manifests/haproxy.xml.in","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"test/config.test.js","type":"MODIFIED","insertions":32,"deletions":-27},{"file":"test/helper.js","type":"MODIFIED","insertions":2,"deletions":-30},{"file":"tools/mk/Makefile.haproxy.defs","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"tools/mk/Makefile.haproxy.targ","type":"MODIFIED","insertions":0,"deletions":-4}],"sizeInsertions":183,"sizeDeletions":-183},{"number":"12","revision":"68950a334b692b7745388478b97c25b1a3b9a5a0","parents":["f38f9bbd3eb3e1c313f818381d65274846d40485"],"ref":"refs/changes/25/6225/12","uploader":{"name":"Russell Brown","email":"russell.brown@joyent.com","username":"russelldb"},"createdOn":1561641102,"author":{"name":"Russell Brown","email":"russell.brown@joyent.com","username":"russelldb"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1561641132,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1561641237,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":12,"deletions":0},{"file":".gitmodules","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"README.md","type":"MODIFIED","insertions":2,"deletions":-15},{"file":"deps/eng","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"deps/haproxy-1.8","type":"ADDED","insertions":1,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":15,"deletions":-15},{"file":"etc/haproxy.cfg.default","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"etc/haproxy.cfg.in","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"lib/app.js","type":"MODIFIED","insertions":6,"deletions":-6},{"file":"lib/lb_manager.js","type":"MODIFIED","insertions":72,"deletions":-70},{"file":"lib/watch.js","type":"MODIFIED","insertions":5,"deletions":-5},{"file":"muppet.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"smf/manifests/haproxy.xml.in","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"test/config.test.js","type":"MODIFIED","insertions":32,"deletions":-27},{"file":"test/helper.js","type":"MODIFIED","insertions":2,"deletions":-30},{"file":"tools/mk/Makefile.haproxy.defs","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":160,"sizeDeletions":-179},{"number":"13","revision":"6447b0342e187f2e718d7953c93039928249fdb3","parents":["f38f9bbd3eb3e1c313f818381d65274846d40485"],"ref":"refs/changes/25/6225/13","uploader":{"name":"Russell Brown","email":"russell.brown@joyent.com","username":"russelldb"},"createdOn":1561650140,"author":{"name":"Russell Brown","email":"russell.brown@joyent.com","username":"russelldb"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1561650169,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1561720573,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":12,"deletions":0},{"file":".gitmodules","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"README.md","type":"MODIFIED","insertions":2,"deletions":-15},{"file":"deps/eng","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"deps/haproxy-1.5","type":"DELETED","insertions":0,"deletions":-1},{"file":"deps/haproxy-1.8","type":"ADDED","insertions":1,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":15,"deletions":-15},{"file":"etc/haproxy.cfg.default","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"etc/haproxy.cfg.in","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"lib/app.js","type":"MODIFIED","insertions":6,"deletions":-6},{"file":"lib/lb_manager.js","type":"MODIFIED","insertions":72,"deletions":-70},{"file":"lib/watch.js","type":"MODIFIED","insertions":5,"deletions":-5},{"file":"muppet.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"smf/manifests/haproxy.xml.in","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"test/config.test.js","type":"MODIFIED","insertions":32,"deletions":-27},{"file":"test/helper.js","type":"MODIFIED","insertions":2,"deletions":-30},{"file":"tools/mk/Makefile.haproxy.defs","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":160,"sizeDeletions":-180},{"number":"14","revision":"8942d41f9dde6e5f710cb6dcc49305e60d95f081","parents":["f38f9bbd3eb3e1c313f818381d65274846d40485"],"ref":"refs/changes/25/6225/14","uploader":{"name":"Russell Brown","email":"russell.brown@joyent.com","username":"russelldb"},"createdOn":1561977582,"author":{"name":"Russell Brown","email":"russell.brown@joyent.com","username":"russelldb"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1561977613,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1561987989,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1561987989,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":12,"deletions":0},{"file":".gitmodules","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"README.md","type":"MODIFIED","insertions":2,"deletions":-15},{"file":"deps/eng","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"deps/haproxy-1.5","type":"DELETED","insertions":0,"deletions":-1},{"file":"deps/haproxy-1.8","type":"ADDED","insertions":1,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":15,"deletions":-15},{"file":"etc/haproxy.cfg.default","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"etc/haproxy.cfg.in","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"lib/app.js","type":"MODIFIED","insertions":6,"deletions":-6},{"file":"lib/lb_manager.js","type":"MODIFIED","insertions":72,"deletions":-70},{"file":"lib/watch.js","type":"MODIFIED","insertions":5,"deletions":-5},{"file":"muppet.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"smf/manifests/haproxy.xml.in","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"test/config.test.js","type":"MODIFIED","insertions":32,"deletions":-27},{"file":"test/helper.js","type":"MODIFIED","insertions":2,"deletions":-30},{"file":"tools/mk/Makefile.haproxy.defs","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":160,"sizeDeletions":-180},{"number":"15","revision":"1f16cc15030abf9777fc00af1656192bdc09148d","parents":["f38f9bbd3eb3e1c313f818381d65274846d40485"],"ref":"refs/changes/25/6225/15","uploader":{"name":"Russell Brown","email":"russell.brown@joyent.com","username":"russelldb"},"createdOn":1561988456,"author":{"name":"Russell Brown","email":"russell.brown@joyent.com","username":"russelldb"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1561977613,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1561987989,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1561987989,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":".gitmodules","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"README.md","type":"MODIFIED","insertions":2,"deletions":-15},{"file":"deps/eng","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"deps/haproxy-1.5","type":"DELETED","insertions":0,"deletions":-1},{"file":"deps/haproxy-1.8","type":"ADDED","insertions":1,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":15,"deletions":-15},{"file":"etc/haproxy.cfg.default","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"etc/haproxy.cfg.in","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"lib/app.js","type":"MODIFIED","insertions":6,"deletions":-6},{"file":"lib/lb_manager.js","type":"MODIFIED","insertions":72,"deletions":-70},{"file":"lib/watch.js","type":"MODIFIED","insertions":5,"deletions":-5},{"file":"muppet.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"smf/manifests/haproxy.xml.in","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"test/config.test.js","type":"MODIFIED","insertions":32,"deletions":-27},{"file":"test/helper.js","type":"MODIFIED","insertions":2,"deletions":-30},{"file":"tools/mk/Makefile.haproxy.defs","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":160,"sizeDeletions":-180},{"number":"16","revision":"009fb01b42862738388de6d5f60843c5494bf8af","parents":["f38f9bbd3eb3e1c313f818381d65274846d40485"],"ref":"refs/changes/25/6225/16","uploader":{"name":"Russell Brown","email":"russell.brown@joyent.com","username":"russelldb"},"createdOn":1561988957,"author":{"name":"Russell Brown","email":"russell.brown@joyent.com","username":"russelldb"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1561977613,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1561987989,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1561987989,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}},{"type":"SUBM","value":"1","grantedOn":1561989030,"by":{"name":"Russell Brown","email":"russell.brown@joyent.com","username":"russelldb"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":".gitmodules","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"README.md","type":"MODIFIED","insertions":2,"deletions":-15},{"file":"deps/eng","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"deps/haproxy-1.5","type":"DELETED","insertions":0,"deletions":-1},{"file":"deps/haproxy-1.8","type":"ADDED","insertions":1,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":15,"deletions":-15},{"file":"etc/haproxy.cfg.default","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"etc/haproxy.cfg.in","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"lib/app.js","type":"MODIFIED","insertions":6,"deletions":-6},{"file":"lib/lb_manager.js","type":"MODIFIED","insertions":72,"deletions":-70},{"file":"lib/watch.js","type":"MODIFIED","insertions":5,"deletions":-5},{"file":"muppet.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"smf/manifests/haproxy.xml.in","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"test/config.test.js","type":"MODIFIED","insertions":32,"deletions":-27},{"file":"test/helper.js","type":"MODIFIED","insertions":2,"deletions":-30},{"file":"tools/mk/Makefile.haproxy.defs","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":160,"sizeDeletions":-180}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},{"name":"Russell Brown","email":"russell.brown@joyent.com","username":"russelldb"}]}