{"project":"joyent/binder","branch":"master","id":"I35b36aaad4c275800d022bf854d8d6aa94db8e2a","number":"2564","subject":"MANTA-3425 want support for reverse lookups in binder MANTA-3424 binder tests should cover SRV records and rcodes MANTA-3429 binder recursion/proxy doesn\u0027t work for SRV lookups Reviewed by: Cody Peter Mello \u003ccody.mello@joyent.com\u003e Approved by: Cody Peter ","owner":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"url":"https://cr.joyent.us/2564","commitMessage":"MANTA-3425 want support for reverse lookups in binder\nMANTA-3424 binder tests should cover SRV records and rcodes\nMANTA-3429 binder recursion/proxy doesn\u0027t work for SRV lookups\nReviewed by: Cody Peter Mello \u003ccody.mello@joyent.com\u003e\nApproved by: Cody Peter Mello \u003ccody.mello@joyent.com\u003e\n","createdOn":1505342922,"lastUpdated":1505842991,"open":false,"status":"MERGED","comments":[{"timestamp":1505342922,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 1."},{"timestamp":1505342958,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1505344662,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 1:\n\nbuilt as image ca58a12c-98d3-11e7-8923-ef4b72dc71b0"},{"timestamp":1505414662,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 1: Code-Review+1\n\n(1 comment)\n\nCan you add testing notes to MANTA-3425?"},{"timestamp":1505416552,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 2."},{"timestamp":1505416588,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1505426978,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 3."},{"timestamp":1505427014,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing-1\n\n(2 comments)\n\n\"make check\" exited with status 2"},{"timestamp":1505427339,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 4."},{"timestamp":1505427366,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1505767371,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 5."},{"timestamp":1505767403,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1505767555,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 5:\n\nFurther testing notes added to JIRA bug"},{"timestamp":1505767878,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 6."},{"timestamp":1505767923,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 5:\n\nPS#6 is a small revision to deal with multi-DC setups with \u003e3 DCs."},{"timestamp":1505767924,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 6: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1505772774,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 6:\n\n(3 comments)"},{"timestamp":1505781476,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 7."},{"timestamp":1505781479,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 6:\n\n(3 comments)"},{"timestamp":1505781503,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 7: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1505782668,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 7: Code-Review+1 Integration-Approval+1\n\n(1 comment)"},{"timestamp":1505842940,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 8: Commit message was updated."},{"timestamp":1505842991,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Alex Wilson"}],"currentPatchSet":{"number":"8","revision":"6acb532d19ae359cdbc245c831c0d16b2d05646b","parents":["9b328530e6080c9e4b953ff327c4e23cfa88b245"],"ref":"refs/changes/64/2564/8","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1505842940,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1505781503,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1505782668,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1505782668,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"SUBM","value":"1","grantedOn":1505842991,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"lib/recursion.js","type":"MODIFIED","insertions":86,"deletions":-66},{"file":"lib/server.js","type":"MODIFIED","insertions":75,"deletions":-1},{"file":"lib/zk.js","type":"MODIFIED","insertions":35,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/dig.js","type":"MODIFIED","insertions":15,"deletions":-1},{"file":"test/host.test.js","type":"MODIFIED","insertions":55,"deletions":0},{"file":"test/service.test.js","type":"MODIFIED","insertions":74,"deletions":0}],"sizeInsertions":342,"sizeDeletions":-70},"patchSets":[{"number":"1","revision":"efe28f8865fbbcc1eca1bd4f31427a7b041ca817","parents":["9b328530e6080c9e4b953ff327c4e23cfa88b245"],"ref":"refs/changes/64/2564/1","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1505342922,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1505414662,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1505342958,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/server.js","line":68,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"I guess it doesn\u0027t matter if this is an invalid IP address (has too few parts, contains bad numbers, etc.)? Playing around with dig -x, it looks like I just get NXDOMAIN for bad queries (although I guess we would return REFUSED instead to force it onto the next binder/dns server). If so, can we add a note to that effect, and mention that we just let the reverseLookup() fail to find anything?"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"lib/server.js","type":"MODIFIED","insertions":69,"deletions":0},{"file":"lib/zk.js","type":"MODIFIED","insertions":35,"deletions":0},{"file":"test/dig.js","type":"MODIFIED","insertions":15,"deletions":-1},{"file":"test/host.test.js","type":"MODIFIED","insertions":55,"deletions":0},{"file":"test/service.test.js","type":"MODIFIED","insertions":74,"deletions":0}],"sizeInsertions":248,"sizeDeletions":-1},{"number":"2","revision":"a36d432425f5447f3a6d344f1a4fcb464c11cb72","parents":["9b328530e6080c9e4b953ff327c4e23cfa88b245"],"ref":"refs/changes/64/2564/2","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1505416552,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1505416588,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"lib/server.js","type":"MODIFIED","insertions":74,"deletions":0},{"file":"lib/zk.js","type":"MODIFIED","insertions":35,"deletions":0},{"file":"test/dig.js","type":"MODIFIED","insertions":15,"deletions":-1},{"file":"test/host.test.js","type":"MODIFIED","insertions":55,"deletions":0},{"file":"test/service.test.js","type":"MODIFIED","insertions":74,"deletions":0}],"sizeInsertions":253,"sizeDeletions":-1},{"number":"3","revision":"e54517be37e9c297d03720859b7af591dbd77d0b","parents":["9b328530e6080c9e4b953ff327c4e23cfa88b245"],"ref":"refs/changes/64/2564/3","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1505426978,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1505427014,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/recursion.js","line":368,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"warning: identifer dc hides an identifier in a parent scope"},{"file":"lib/recursion.js","line":418,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"warning: variable is declared but never referenced: job"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/recursion.js","type":"MODIFIED","insertions":81,"deletions":-25},{"file":"lib/server.js","type":"MODIFIED","insertions":74,"deletions":0},{"file":"lib/zk.js","type":"MODIFIED","insertions":35,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/dig.js","type":"MODIFIED","insertions":15,"deletions":-1},{"file":"test/host.test.js","type":"MODIFIED","insertions":55,"deletions":0},{"file":"test/service.test.js","type":"MODIFIED","insertions":74,"deletions":0}],"sizeInsertions":335,"sizeDeletions":-27},{"number":"4","revision":"c8fe820062021a15f04ce44b0f3a3c4564796a49","parents":["9b328530e6080c9e4b953ff327c4e23cfa88b245"],"ref":"refs/changes/64/2564/4","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1505427339,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1505427366,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/recursion.js","type":"MODIFIED","insertions":83,"deletions":-25},{"file":"lib/server.js","type":"MODIFIED","insertions":74,"deletions":0},{"file":"lib/zk.js","type":"MODIFIED","insertions":35,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/dig.js","type":"MODIFIED","insertions":15,"deletions":-1},{"file":"test/host.test.js","type":"MODIFIED","insertions":55,"deletions":0},{"file":"test/service.test.js","type":"MODIFIED","insertions":74,"deletions":0}],"sizeInsertions":337,"sizeDeletions":-27},{"number":"5","revision":"09996767720d61673003b83f97a5ddc1b9b66d7a","parents":["9b328530e6080c9e4b953ff327c4e23cfa88b245"],"ref":"refs/changes/64/2564/5","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1505767371,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1505767403,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/recursion.js","type":"MODIFIED","insertions":73,"deletions":-63},{"file":"lib/server.js","type":"MODIFIED","insertions":75,"deletions":-1},{"file":"lib/zk.js","type":"MODIFIED","insertions":35,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/dig.js","type":"MODIFIED","insertions":15,"deletions":-1},{"file":"test/host.test.js","type":"MODIFIED","insertions":55,"deletions":0},{"file":"test/service.test.js","type":"MODIFIED","insertions":74,"deletions":0}],"sizeInsertions":329,"sizeDeletions":-67},{"number":"6","revision":"9288c45225ff4ac89e9d1a359ce9b8e3d86eabf5","parents":["9b328530e6080c9e4b953ff327c4e23cfa88b245"],"ref":"refs/changes/64/2564/6","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1505767878,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1505767924,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/recursion.js","line":254,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"It looks like self is no longer needed, since the log statements are gone. This line can probably be removed now, and the lookup.calls replaced with a normal function invocation."},{"file":"lib/recursion.js","line":254,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"I can remove that, but I can\u0027t get rid of the lookup.call()s, since this still uses this.nsc/this.nscMax."},{"file":"lib/recursion.js","line":254,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Ah, you\u0027re right. I looked several times, and somehow missed that."},{"file":"lib/recursion.js","line":325,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"I think doing something like this would be better:\n\n    answer \u003d new klass(undefined, rec.target);\n    answer \u003d new klass(undefined, rec.target, rec.port, {\n        priority: rec.priority,\n        weight: rec.weight\n    });\n\nOr maybe just do new ARecord(), new AAAARecord(), etc."},{"file":"lib/recursion.js","line":325,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Done"},{"file":"package.json","line":18,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"If you\u0027re going to bump vasync, you should probably bump to v2.1.0, to avoid joyent/node-vasync#35. (Although it looks like that probably doesn\u0027t affect binder.)"},{"file":"package.json","line":18,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/recursion.js","type":"MODIFIED","insertions":89,"deletions":-63},{"file":"lib/server.js","type":"MODIFIED","insertions":75,"deletions":-1},{"file":"lib/zk.js","type":"MODIFIED","insertions":35,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/dig.js","type":"MODIFIED","insertions":15,"deletions":-1},{"file":"test/host.test.js","type":"MODIFIED","insertions":55,"deletions":0},{"file":"test/service.test.js","type":"MODIFIED","insertions":74,"deletions":0}],"sizeInsertions":345,"sizeDeletions":-67},{"number":"7","revision":"35b36aaad4c275800d022bf854d8d6aa94db8e2a","parents":["9b328530e6080c9e4b953ff327c4e23cfa88b245"],"ref":"refs/changes/64/2564/7","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1505781476,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1505782668,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1505782668,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1505781503,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/recursion.js","type":"MODIFIED","insertions":86,"deletions":-66},{"file":"lib/server.js","type":"MODIFIED","insertions":75,"deletions":-1},{"file":"lib/zk.js","type":"MODIFIED","insertions":35,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/dig.js","type":"MODIFIED","insertions":15,"deletions":-1},{"file":"test/host.test.js","type":"MODIFIED","insertions":55,"deletions":0},{"file":"test/service.test.js","type":"MODIFIED","insertions":74,"deletions":0}],"sizeInsertions":342,"sizeDeletions":-70},{"number":"8","revision":"6acb532d19ae359cdbc245c831c0d16b2d05646b","parents":["9b328530e6080c9e4b953ff327c4e23cfa88b245"],"ref":"refs/changes/64/2564/8","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1505842940,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1505782668,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1505782668,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"SUBM","value":"1","grantedOn":1505842991,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1505781503,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"lib/recursion.js","type":"MODIFIED","insertions":86,"deletions":-66},{"file":"lib/server.js","type":"MODIFIED","insertions":75,"deletions":-1},{"file":"lib/zk.js","type":"MODIFIED","insertions":35,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/dig.js","type":"MODIFIED","insertions":15,"deletions":-1},{"file":"test/host.test.js","type":"MODIFIED","insertions":55,"deletions":0},{"file":"test/service.test.js","type":"MODIFIED","insertions":74,"deletions":0}],"sizeInsertions":342,"sizeDeletions":-70}],"allReviewers":[{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}]}