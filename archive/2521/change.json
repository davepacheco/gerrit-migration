{"project":"joyent/node-sdc-clients","branch":"master","topic":"tritonnfs","id":"Id1346fbb765c8c080ba6680db6dadd99164796cd","number":"2521","subject":"DOCKER-793: First pass for NFS shared volumes DOCKER-863: Create shared volume when mounting nonexistent volume VOLAPI-9 Implement asynchronous NFS shared volume creation PUBAPI-1300 Implement CRUD volumes endpoints VOLAPI-50 Add ListVolumeSizes endpoint ","owner":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"url":"https://cr.joyent.us/2521","commitMessage":"DOCKER-793: First pass for NFS shared volumes\nDOCKER-863: Create shared volume when mounting nonexistent volume\nVOLAPI-9 Implement asynchronous NFS shared volume creation\nPUBAPI-1300 Implement CRUD volumes endpoints\nVOLAPI-50 Add ListVolumeSizes endpoint\nVOLAPI-50 Add ListVolumeSizes endpoint (disambiguate endpoint)\nDOCKER-1034 support docker volume ls -f dangling\u003dtrue\nTOOLS-1855 complete documentation about new volumes APIs\nTOOLS-1856 complete node-sdc-clients\u0027 new volume APIs\u0027 tests suite\nReviewed by: Trent Mick \u003ctrentm@gmail.com\u003e\nApproved by: Trent Mick \u003ctrentm@gmail.com\u003e\n","createdOn":1504880818,"lastUpdated":1509729467,"open":false,"status":"MERGED","comments":[{"timestamp":1504880818,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 1."},{"timestamp":1504880849,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1504881784,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Topic set to tritonnfs"},{"timestamp":1504911125,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 1:\n\n(23 comments)"},{"timestamp":1505226326,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 1:\n\n(22 comments)"},{"timestamp":1505226365,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 2."},{"timestamp":1505226397,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1505227210,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1505248883,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Abandoned"},{"timestamp":1505248910,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Restored"},{"timestamp":1505248936,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 3."},{"timestamp":1505248963,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1506630282,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 3:\n\n(12 comments)"},{"timestamp":1507066227,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 3:\n\n(12 comments)"},{"timestamp":1507069742,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 3:\n\n(1 comment)"},{"timestamp":1507070631,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 3:\n\n(1 comment)"},{"timestamp":1507074859,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 4."},{"timestamp":1507074886,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1507134044,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 4:\n\n(4 comments)"},{"timestamp":1507246493,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 5."},{"timestamp":1507246497,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 4:\n\n(3 comments)"},{"timestamp":1507246520,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1507248450,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 6."},{"timestamp":1507248482,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 6: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1507249080,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 6: Code-Review+1 Integration-Approval+1\n\n(2 comments)"},{"timestamp":1509652727,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 7."},{"timestamp":1509652736,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 6:\n\n(2 comments)"},{"timestamp":1509652752,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 7: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1509656733,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 7: Code-Review+1 Integration-Approval+1"},{"timestamp":1509726894,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 8: Commit message was updated."},{"timestamp":1509729047,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 9."},{"timestamp":1509729071,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 9: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1509729282,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 9: Code-Review+1 Integration-Approval+1"},{"timestamp":1509729458,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 10: Commit message was updated."},{"timestamp":1509729467,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Julien Gilli"}],"currentPatchSet":{"number":"10","revision":"1457c7c8cd08e11aefe4ef7142207c827e8fe967","parents":["6b5ff7af7a197397ac60afd89cf9efcaa80ef965"],"ref":"refs/changes/21/2521/10","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1509729458,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1509729071,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1509729282,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1509729282,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1509729467,"by":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":17,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"docs/index.md","type":"MODIFIED","insertions":304,"deletions":0},{"file":"lib/index.js","type":"MODIFIED","insertions":3,"deletions":0},{"file":"lib/volapi.js","type":"ADDED","insertions":535,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"test/runtests","type":"MODIFIED","insertions":8,"deletions":0},{"file":"test/volapi.test.js","type":"ADDED","insertions":264,"deletions":0}],"sizeInsertions":1119,"sizeDeletions":-2},"patchSets":[{"number":"1","revision":"766cc5692d4725ae13e1388f409f7e6a0abb8b1e","parents":["6b5ff7af7a197397ac60afd89cf9efcaa80ef965"],"ref":"refs/changes/21/2521/1","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1504880818,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1504880849,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"CHANGES.md","line":11,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Could be improved with (a) a most-relevant ticket link (if there is one) and mention \"volapi\" specifically."},{"file":"CHANGES.md","line":11,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"The work that these changes represent spans several tickets, so I wasn\u0027t sure if it made sense to pick only one of them. I thought of creating a _new_ ticket that would represent the integration of that work, but I\u0027m not sure that makes sense too.\n\nDo you have a preference for:\n\n- Integration of [RFD 26](link-to-rfd-26)\u0027s first \"master integration\" milestone. Adds support for Volume APIs provided by the new VOLAPI core service.\n\nor:\n\n- joyent/node-sdc-clients#XX Adds support for Volume APIs provided by the new VOLAPI core service.\n\n?"},{"file":"CHANGES.md","line":11,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"I prefer the first one."},{"file":"CHANGES.md","line":11,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Done"},{"file":"docs/index.md","line":345,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"No \"www.\" I don\u0027t think."},{"file":"docs/index.md","line":345,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Done"},{"file":"docs/index.md","line":355,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Not sure how picky some renderers will be about not escaping the `_`."},{"file":"docs/index.md","line":355,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Done"},{"file":"docs/index.md","line":356,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Volume name is unique for an account, right? (As \u0027alias\u0027 is unique per account for VMs.)"},{"file":"docs/index.md","line":356,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Correct, I mentioned it in the upcoming change."},{"file":"docs/index.md","line":394,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"I wonder if users of this will want to pass in a timeout for the wait. E.g. some node-triton/lib/tritonapi.js \"AndWait\" methods support this, I think."},{"file":"docs/index.md","line":394,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Yes, that is definitely a good suggestion. Will add in the next patch set."},{"file":"docs/index.md","line":451,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"\"volume\u0027s\""},{"file":"docs/index.md","line":451,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Done"},{"file":"docs/index.md","line":475,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Eventually I think links like these could/should be to API docs in the sdc-volapi repo."},{"file":"docs/index.md","line":475,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Absolutely. I\u0027m waiting for people to get a chance to give a final round of feedback on RFD 26 before making that change."},{"file":"lib/volapi.js","line":21,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"nice"},{"file":"lib/volapi.js","line":21,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"(is this thing [gerrit] on?)\n\nSo... this one is more than just a general type-check assert, which is what our top-of-function assert blocks typically are about.\n\nI think this merits being called out more. Perhaps the assert error message could give some details? Or at least a comment here why the client is making this decision to disallow \"Accept-Version: \u0027*\u0027\"."},{"file":"lib/volapi.js","line":21,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Yes, that\u0027s a good point, I\u0027ll do both (the assert description _and_ the comment_)."},{"file":"lib/volapi.js","line":35,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"I\u0027m an \"opts, cb\" kinda guy, but some of my best friends use \"options, callback\" and that\u0027s cool. :)"},{"file":"lib/volapi.js","line":35,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"I\u0027ll keep it as it is for this CR to avoid making work, but I think your thought leadering might bear fruits sooner than later ;-)"},{"file":"lib/volapi.js","line":51,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"FWIW, I think the \"|| this.log\" pattern for all users of restifyclient.js is redundant. `this.log` comes from passing in `options.log` in the constructor. The restify-clients/lib/JsonClient that gets called underneath should already be using `this.log` if no options.log is passed in.\n\nAnyway... not a big deal. Perhaps better to clean all that up for all the clients here in a separate ticket."},{"file":"lib/volapi.js","line":51,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Sounds good, thanks for the context!"},{"file":"lib/volapi.js","line":98,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Can a volume go to state \u0027failed\u0027 or something like that? It looks like yes from https://github.com/joyent/rfd/blob/master/rfd/0026/README.md#volumes-state-machine\n\nIf so, this would poll forever, right?\n\nE.g. the equiv wait function for instance creation in node-triton accepts an array of states, and the wait on creating waits for one of [\u0027running\u0027, \u0027failed\u0027]"},{"file":"lib/volapi.js","line":98,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Refactored in the upcoming patch set, please let me know if that addresses your concerns when that patch set is uploaded."},{"file":"lib/volapi.js","line":193,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"assert-plus has `assert.uuid`."},{"file":"lib/volapi.js","line":193,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Done"},{"file":"lib/volapi.js","line":196,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Perhaps assert.optionalUuid for owner_uuid?"},{"file":"lib/volapi.js","line":196,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Good catch, will fix!"},{"file":"lib/volapi.js","line":215,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"assert-plus has `assert.uuid`."},{"file":"lib/volapi.js","line":215,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Done"},{"file":"lib/volapi.js","line":266,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"don\u0027t need this \u0027return\u0027"},{"file":"lib/volapi.js","line":266,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Done"},{"file":"lib/volapi.js","line":337,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"I\u0027m curious if \u0027volume *references*\u0027 would be a more appropriate name for these things... but I think it would be easier to discuss. Also I see \"volume reference\" API methods below, so I\u0027m confused. :)"},{"file":"lib/volapi.js","line":337,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Did you get the chance to read https://github.com/joyent/rfd/blob/master/rfd/0026/README.md#volume-reservations? If so, did that clarify things?\n\nIf not let\u0027s jump on a call whenever you\u0027re available to discuss this, and then I\u0027ll do whatever needs to be done to make things easier to understand."},{"file":"lib/volapi.js","line":386,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"I don\u0027t see \u0027addreference\u0027 mentioned in RFD 26. I\u0027m not sure if it should be there. Note that I haven\u0027t read sdc-volapi.git yet."},{"file":"lib/volapi.js","line":386,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"It should be there, I\u0027ll update RFD 26 with that."},{"file":"lib/volapi.js","line":386,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"See https://github.com/joyent/rfd/blob/master/rfd/0026/README.md#volume-references and https://github.com/joyent/rfd/blob/master/rfd/0026/README.md#volume-reservations for more info on the difference between volume references and volume reservations."},{"file":"test/volapi.test.js","line":20,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Perhaps napiClient? This isn\u0027t a constant."},{"file":"test/volapi.test.js","line":20,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Done"},{"file":"test/volapi.test.js","line":22,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"FWIW, in a few other repos I\u0027ve used a smooshed token to identify the test suite. E.g.: \"nodesdcclientstest-volapi-\". Anyway, obviously a nit."},{"file":"test/volapi.test.js","line":22,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Sounds good, I\u0027ll keep that in mind if that becomes a problem."},{"file":"test/volapi.test.js","line":27,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"How did you pick .70 here? The default values in other test files here at least *used* to have some stability. They might all be wrong now that the \u0027redis\u0027 zone is no longer created. Not sure.\n\nI think perhaps it would be better to just throw if there isn\u0027t a VOLAPI_IP?"},{"file":"test/volapi.test.js","line":27,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"\u003e How did you pick .70 here?\n\nI assume that I ran \"vmadm list -o alias,nics.0.ip | grep volapi\" in my COAL environment, but today that output \"10.99.99.42\", so I\u0027m not sure what happened. It was picked a long time ago though, which might explain the difference.\n\n\u003e I think perhaps it would be better to just throw if there isn\u0027t a VOLAPI_IP?\n\nThat makes sense, will do."},{"file":"test/volapi.test.js","line":124,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"I\u0027m curious why the style of multiple-indenting to get closer to the open parens."},{"file":"test/volapi.test.js","line":124,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"That\u0027s a typo, will fix."},{"file":"test/volapi.test.js","line":160,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Don\u0027t just want a false-y test? We\u0027d expect it to be a UUID string or undefined/null."},{"file":"test/volapi.test.js","line":160,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Sometimes I try too hard to steer away from false-y (and inherently brittle) tests. I\u0027ll change it to a false-y test + an assert on optionalUuid, thoughts?"},{"file":"test/volapi.test.js","line":185,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Is this test about \u0027type\u0027 or \u0027description\u0027?"},{"file":"test/volapi.test.js","line":185,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"It\u0027s about \u0027type\u0027, that\u0027s a typo, will fix."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":15,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"docs/index.md","type":"MODIFIED","insertions":253,"deletions":0},{"file":"lib/index.js","type":"MODIFIED","insertions":3,"deletions":0},{"file":"lib/volapi.js","type":"ADDED","insertions":450,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/runtests","type":"MODIFIED","insertions":8,"deletions":0},{"file":"test/volapi.test.js","type":"ADDED","insertions":228,"deletions":0}],"sizeInsertions":944,"sizeDeletions":-2},{"number":"2","revision":"d0da3e77d8ee33fc1c3cc927b6c110abc4049af3","parents":["08e29897f076b4cd9a4808a1bf1242d066af9014"],"ref":"refs/changes/21/2521/2","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1505226365,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1505226397,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/volapi.js","type":"MODIFIED","insertions":2,"deletions":-1}],"sizeInsertions":2,"sizeDeletions":-1},{"number":"3","revision":"452da0122e26dc52e6ac2c990d13b9f82f927d94","parents":["6b5ff7af7a197397ac60afd89cf9efcaa80ef965"],"ref":"refs/changes/21/2521/3","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1505248936,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1505248963,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"docs/index.md","line":355,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Perhaps: \"Volume owner account\"?"},{"file":"docs/index.md","line":355,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Done"},{"file":"docs/index.md","line":357,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Just one type of quotes here."},{"file":"docs/index.md","line":357,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"I was going for `\u0027tritonnfs\u0027` to represent a JS string formatted as code. But I can change that to \u0027tritonnfs\u0027 if you\u0027d prefer that."},{"file":"docs/index.md","line":523,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Two naming points:\n\n- I\u0027m more inclined to call this \"${verb}VolumeReservation\" to better match \"removeVolumeReservation\".\n- Currently your verbs are \"add\" and \"remove\". More commonly, I think, for other objects in Triton APIs we use \"create\" and \"delete\". Thoughts?"},{"file":"docs/index.md","line":523,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"That makes sense, I\u0027ll change them to be createVolumeReservation and deleteVolumeReservation."},{"file":"lib/volapi.js","line":10,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"I can haz short description block comment?"},{"file":"lib/volapi.js","line":10,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Will do."},{"file":"lib/volapi.js","line":139,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Curious why this and the previous function are not methods on the VOLAPI class?"},{"file":"lib/volapi.js","line":139,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"The first obvious reason is that these functions are not exposed to the user.\n\nBut the main reason is that, in general, I try to move utility functions out of the class that has methods that use it, so that these functions do not rely on implicit state stored on instances, and instead have all their dependencies explicitly specified as function parameters."},{"file":"lib/volapi.js","line":314,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"nit: You have two different indentation styles for if this assignment doesn\u0027t fit on one line. Compare with listVolumeSizes."},{"file":"lib/volapi.js","line":314,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Done"},{"file":"lib/volapi.js","line":314,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Let me show you what I mean at the office. This is all a \"nit\" though. :)"},{"file":"lib/volapi.js","line":395,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"The RFD for this endpoint has:\n\n```\nAn [snapshot object](#snapshot-objects) with the state `\u0027creating\u0027`:\n\n```\n{\n  \"uuid\": \"1360ef7d-e831-4351-867a-ea350049a934\",\n```\n\n1. \"snapshot object\" is a cut \u0027n paste error?\n2. It isn\u0027t clear there what this is the UUID of? Does a reservation have its own UUID? Or is that the UUID of the volume?"},{"file":"lib/volapi.js","line":395,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"\u003e 1. \"snapshot object\" is a cut \u0027n paste error?\n\nYes, fixed in the RFD.\n\n\u003e 2. It isn\u0027t clear there what this is the UUID of? Does a reservation have its own UUID? Or is that the UUID of the volume?\n\nA reservation does have its own UUID. I also updated RFD 26 with that info."},{"file":"lib/volapi.js","line":436,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Is this deleting the volume by accident!?\n\nAlso the RFD has this for this endpoint:\n```\n##### RemoveVolumeReservation DELETE /volumereservations/uuid\n\n###### Input\n\n| Param         | Type         | Description                              |\n| ------------- | ------------ | ---------------------------------------- |\n| uuid          | String       | The name of the volume being reserved |\n| owner_uuid          | String       | The UUID of the owner associated to that volume reservation |\n```\n\nThat description for the \"uuid\" field seems wrong."},{"file":"lib/volapi.js","line":436,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"\u003e Is this deleting the volume by accident!?\n\nYes, and it is working by accident, since removing a volume reference from VMAPI\u0027s destroy workflow never errors on purpose, and VOLAPI eventually removes the reference anyway via a dedicated program running as a SMF service in the VOLAPI zone.\n\nWill fix.\n\n\u003e That description for the \"uuid\" field seems wrong.\n\nFixed the RFD too."},{"file":"test/volapi.test.js","line":21,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Overkill to do typeof-string check? Isn\u0027t *everything* from process.env a string?"},{"file":"test/volapi.test.js","line":21,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"It\u0027s one way to check that process.env.VOLAPI is not null or undefined. I can change that condition to:\n\nprocess.env.VOLAPI_IP !\u003d\u003d null \u0026\u0026 process.env.VOLAPI_IP !\u003d\u003d undefined \u0026\u0026 process.env.VOLAPI_IP !\u003d\u003d \u0027\u0027\n\nif that looks better to you."},{"file":"test/volapi.test.js","line":21,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"I\u0027d have just checked truthiness for a process.env field (given I know it is going to be a string if it exists at all). But yours is definitely correct. :)"},{"file":"test/volapi.test.js","line":21,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"OK, I see what you mean. I tend to not rely on truthiness tests especially for strings because I can never be 100% sure whether the empty string is truthy or not.\n\nThat\u0027s probably not very idiomatic JS, but I find it helps me (and hopefully other) when I write more explicit code."},{"file":"test/volapi.test.js","line":196,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"A quick test for adding/deleting volume refs and reservations might be good."},{"file":"test/volapi.test.js","line":196,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Definitely, will add."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":15,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"docs/index.md","type":"MODIFIED","insertions":304,"deletions":0},{"file":"lib/index.js","type":"MODIFIED","insertions":3,"deletions":0},{"file":"lib/volapi.js","type":"ADDED","insertions":528,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/runtests","type":"MODIFIED","insertions":8,"deletions":0},{"file":"test/volapi.test.js","type":"ADDED","insertions":236,"deletions":0}],"sizeInsertions":1081,"sizeDeletions":-2},{"number":"4","revision":"42e784649149d1ac75ca0501248b2b4ac99f830e","parents":["6b5ff7af7a197397ac60afd89cf9efcaa80ef965"],"ref":"refs/changes/21/2521/4","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1507074859,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1507074886,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"CHANGES.md","line":11,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Reflow at 80 columns, please."},{"file":"CHANGES.md","line":11,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Done"},{"file":"docs/index.md","line":355,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"\"Volume owner account\" here too? You\u0027d said \"Done\", but it looks like you changed the value for VMAPI.listVms. Ah, I see now where you got the \"VM Owner\" string before. :)\n\nThis is all just nits, so feel free to ignore."},{"file":"docs/index.md","line":355,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Done"},{"file":"lib/volapi.js","line":30,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"How about \"~1\"?\n\nAdmittedly they both work the same for our cases:\n```\n\u003e semver.satisfies(\u00271.0.0\u0027, \u0027~1\u0027)\ntrue\n\u003e semver.satisfies(\u00272.0.0\u0027, \u0027~1\u0027)\nfalse\n\u003e semver.satisfies(\u00271.0.0\u0027, \u0027^1\u0027)\ntrue\n\u003e semver.satisfies(\u00272.0.0\u0027, \u0027^1\u0027)\nfalse\n```\n\nBut I have two reasons:\n\n1. I find the description for tilde ranges here (https://github.com/npm/node-semver#tilde-ranges-123-12-1) more simple than the desc for caret ranges (https://github.com/npm/node-semver#caret-ranges-123-025-004). *Oh*, it took me a long time to realize that caret ranges in node-semver are about the \"0\" major version being special. I\u0027d be inclined to avoid the more complex \"^\".\n\n2. CloudAPI docs and clients (node-triton and node-smartdc) use \u0027~\u0027: https://apidocs.joyent.com/cloudapi/#api-versions"},{"file":"lib/volapi.js","line":30,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Sounds good to me!"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":15,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"docs/index.md","type":"MODIFIED","insertions":305,"deletions":-1},{"file":"lib/index.js","type":"MODIFIED","insertions":3,"deletions":0},{"file":"lib/volapi.js","type":"ADDED","insertions":536,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"test/runtests","type":"MODIFIED","insertions":8,"deletions":0},{"file":"test/volapi.test.js","type":"ADDED","insertions":262,"deletions":0}],"sizeInsertions":1117,"sizeDeletions":-3},{"number":"5","revision":"2e13f983b6454532bd89421b181afcb7e479c75f","parents":["6b5ff7af7a197397ac60afd89cf9efcaa80ef965"],"ref":"refs/changes/21/2521/5","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1507246493,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1507246520,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":15,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"docs/index.md","type":"MODIFIED","insertions":304,"deletions":0},{"file":"lib/index.js","type":"MODIFIED","insertions":3,"deletions":0},{"file":"lib/volapi.js","type":"ADDED","insertions":536,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"test/runtests","type":"MODIFIED","insertions":8,"deletions":0},{"file":"test/volapi.test.js","type":"ADDED","insertions":262,"deletions":0}],"sizeInsertions":1118,"sizeDeletions":-2},{"number":"6","revision":"aa00ed03a67e293ef65efc012049404086566550","parents":["6b5ff7af7a197397ac60afd89cf9efcaa80ef965"],"ref":"refs/changes/21/2521/6","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1507248450,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1507248482,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1507249080,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1507249080,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"comments":[{"file":"CHANGES.md","line":12,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"nit: :)  I\u0027m full of them today. I\u0027m not sure if Markdown requires it, but I customarily indent the subsequent bullet lines two spaces. E.g. see examples below in this file. Perhaps your editor doesn\u0027t do that for you?"},{"file":"CHANGES.md","line":12,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Done"},{"file":"test/volapi.test.js","line":141,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"nit: A getVolume test would be nice. Ditto updateVolume. A separate ticket is fine for this tho. Ditto add/removeVolumeReference."},{"file":"test/volapi.test.js","line":141,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Will do with https://devhub.joyent.com/jira/browse/TOOLS-1911, https://devhub.joyent.com/jira/browse/TOOLS-1912 and https://devhub.joyent.com/jira/browse/TOOLS-1913."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":15,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"docs/index.md","type":"MODIFIED","insertions":304,"deletions":0},{"file":"lib/index.js","type":"MODIFIED","insertions":3,"deletions":0},{"file":"lib/volapi.js","type":"ADDED","insertions":535,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"test/runtests","type":"MODIFIED","insertions":8,"deletions":0},{"file":"test/volapi.test.js","type":"ADDED","insertions":262,"deletions":0}],"sizeInsertions":1117,"sizeDeletions":-2},{"number":"7","revision":"db88221c2b6b438e203089967736cfdb3eb8410e","parents":["6b5ff7af7a197397ac60afd89cf9efcaa80ef965"],"ref":"refs/changes/21/2521/7","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1509652727,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1509652752,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1509656733,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1509656733,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":15,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"docs/index.md","type":"MODIFIED","insertions":304,"deletions":0},{"file":"lib/index.js","type":"MODIFIED","insertions":3,"deletions":0},{"file":"lib/volapi.js","type":"ADDED","insertions":535,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"test/runtests","type":"MODIFIED","insertions":8,"deletions":0},{"file":"test/volapi.test.js","type":"ADDED","insertions":262,"deletions":0}],"sizeInsertions":1117,"sizeDeletions":-2},{"number":"8","revision":"4673d6d79deba6ce27c50271c90689a6f0c70189","parents":["6b5ff7af7a197397ac60afd89cf9efcaa80ef965"],"ref":"refs/changes/21/2521/8","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1509726894,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1509652752,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1509656733,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1509656733,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":17,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"docs/index.md","type":"MODIFIED","insertions":304,"deletions":0},{"file":"lib/index.js","type":"MODIFIED","insertions":3,"deletions":0},{"file":"lib/volapi.js","type":"ADDED","insertions":535,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"test/runtests","type":"MODIFIED","insertions":8,"deletions":0},{"file":"test/volapi.test.js","type":"ADDED","insertions":262,"deletions":0}],"sizeInsertions":1117,"sizeDeletions":-2},{"number":"9","revision":"d1346fbb765c8c080ba6680db6dadd99164796cd","parents":["6b5ff7af7a197397ac60afd89cf9efcaa80ef965"],"ref":"refs/changes/21/2521/9","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1509729047,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1509729071,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1509729282,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1509729282,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":15,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"docs/index.md","type":"MODIFIED","insertions":304,"deletions":0},{"file":"lib/index.js","type":"MODIFIED","insertions":3,"deletions":0},{"file":"lib/volapi.js","type":"ADDED","insertions":535,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"test/runtests","type":"MODIFIED","insertions":8,"deletions":0},{"file":"test/volapi.test.js","type":"ADDED","insertions":264,"deletions":0}],"sizeInsertions":1119,"sizeDeletions":-2},{"number":"10","revision":"1457c7c8cd08e11aefe4ef7142207c827e8fe967","parents":["6b5ff7af7a197397ac60afd89cf9efcaa80ef965"],"ref":"refs/changes/21/2521/10","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1509729458,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1509729071,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1509729282,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1509729282,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1509729467,"by":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":17,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"docs/index.md","type":"MODIFIED","insertions":304,"deletions":0},{"file":"lib/index.js","type":"MODIFIED","insertions":3,"deletions":0},{"file":"lib/volapi.js","type":"ADDED","insertions":535,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"test/runtests","type":"MODIFIED","insertions":8,"deletions":0},{"file":"test/volapi.test.js","type":"ADDED","insertions":264,"deletions":0}],"sizeInsertions":1119,"sizeDeletions":-2}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}]}