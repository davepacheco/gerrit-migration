{"project":"joyent/illumos-joyent","branch":"master","id":"I1681fea05e271e6e0ec1aa68bf37b34cbcf5854e","number":"5317","subject":"OS-7483 excessive page destruction caused by 6602 Reviewed by: Toomas Soome \u003ctsoome@me.com\u003e Reviewed by: Mike Gerdts \u003cmike.gerdts@joyent.com\u003e Reviewed by: Ryan Zezeski \u003crpz@joyent.com\u003e Reviewed by: Robert Mustacchi \u003crm@joyent.com\u003e Approved by: Robert Must","owner":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"url":"https://cr.joyent.us/5317","commitMessage":"OS-7483 excessive page destruction caused by 6602\nReviewed by: Toomas Soome \u003ctsoome@me.com\u003e\nReviewed by: Mike Gerdts \u003cmike.gerdts@joyent.com\u003e\nReviewed by: Ryan Zezeski \u003crpz@joyent.com\u003e\nReviewed by: Robert Mustacchi \u003crm@joyent.com\u003e\nApproved by: Robert Mustacchi \u003crm@joyent.com\u003e\n","createdOn":1546698831,"lastUpdated":1546910770,"open":false,"status":"MERGED","comments":[{"timestamp":1546698831,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 1."},{"timestamp":1546762493,"reviewer":{"name":"Toomas Soome","email":"tsoome@me.com","username":"tsoome"},"message":"Patch Set 1: Code-Review+1"},{"timestamp":1546762654,"reviewer":{"name":"Toomas Soome","email":"tsoome@me.com","username":"tsoome"},"message":"Patch Set 1:\n\non physical host:\nroot@beastie:/tmp# sh /root/test.sh \n+ mktemp -t lofitest_XXXX\n+ testfile\u003d/tmp/lofitest_2ac8\n+ size\u003d64\n+ mkfile 64m /tmp/lofitest_2ac8\n+ pfexec lofiadm -a /tmp/lofitest_2ac8\n+ lodev\u003d/dev/lofi/1\n+ [[ -n /dev/lofi/1 ]]\n+ gdd if\u003d/dev/zero of\u003d/dev/lofi/1 bs\u003d1024k count\u003d64\n64+0 records in\n64+0 records out\n67108864 bytes (67 MB, 64 MiB) copied, 0,0356771 s, 1,9 GB/s\n+ ptime pfexec lofiadm -d /dev/lofi/1\n\nreal        0.002496988\nuser        0.000444995\nsys         0.001120622\n+ gdd if\u003d/tmp/lofitest_2ac8 of\u003d/dev/null bs\u003d1024k\n64+0 records in\n64+0 records out\n67108864 bytes (67 MB, 64 MiB) copied, 0,00925741 s, 7,2 GB/s\n+ rm /tmp/lofitest_2ac8\nroot@beastie:/tmp#"},{"timestamp":1546870258,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 1: Code-Review+1\n\nI looked at this code as well as the *_putpage() implementations that could have a rw lofi backing store.  All seems sane, but I\u0027m far from an expert in these parts."},{"timestamp":1546878058,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 1: Code-Review+1"},{"timestamp":1546887339,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Patch Set 1: Code-Review+1"},{"timestamp":1546898054,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 1:\n\nI noted the script and results from my performance testing in the ticket.  As for functional tests, I\u0027m personally content to trust that the VM system is doing what it claims on the tin."},{"timestamp":1546901175,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 1: Integration-Approval+1"},{"timestamp":1546901203,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 1:\n\nThis is approved pending a final verification / test cycle."},{"timestamp":1546909181,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 1:\n\nI added additional notes to the ticket covering the additional test cases Robert inquired about.  They were all successful."},{"timestamp":1546909379,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 2: Patch Set 1 was rebased."},{"timestamp":1546910730,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 3: Commit message was updated."},{"timestamp":1546910770,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Patrick Mooney"}],"currentPatchSet":{"number":"3","revision":"1681fea05e271e6e0ec1aa68bf37b34cbcf5854e","parents":["66b9606131b15c87650523d677d70277878480f6"],"ref":"refs/changes/17/5317/3","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1546910730,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1546762493,"by":{"name":"Toomas Soome","email":"tsoome@me.com","username":"tsoome"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1546870258,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1546878058,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1546887339,"by":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1546901175,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"SUBM","value":"1","grantedOn":1546910770,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":12,"deletions":0},{"file":"usr/src/uts/common/io/lofi.c","type":"MODIFIED","insertions":4,"deletions":-3}],"sizeInsertions":4,"sizeDeletions":-3},"patchSets":[{"number":"1","revision":"6c64fa0fb7d60ceda2595b1ed24b0f35c2949479","parents":["6fb307ce14869b1c3684d0948a7844194c69b5bd"],"ref":"refs/changes/17/5317/1","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1546698831,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1546878058,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1546901175,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1546887339,"by":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1546762493,"by":{"name":"Toomas Soome","email":"tsoome@me.com","username":"tsoome"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1546870258,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/io/lofi.c","type":"MODIFIED","insertions":4,"deletions":-3}],"sizeInsertions":4,"sizeDeletions":-3},{"number":"2","revision":"56e8e293dd433d28db313d35e71d7f9acdf47d97","parents":["66b9606131b15c87650523d677d70277878480f6"],"ref":"refs/changes/17/5317/2","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1546909379,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1546878058,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1546901175,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1546887339,"by":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1546762493,"by":{"name":"Toomas Soome","email":"tsoome@me.com","username":"tsoome"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1546870258,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/io/lofi.c","type":"MODIFIED","insertions":4,"deletions":-3}],"sizeInsertions":4,"sizeDeletions":-3},{"number":"3","revision":"1681fea05e271e6e0ec1aa68bf37b34cbcf5854e","parents":["66b9606131b15c87650523d677d70277878480f6"],"ref":"refs/changes/17/5317/3","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1546910730,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1546878058,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1546901175,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"SUBM","value":"1","grantedOn":1546910770,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1546887339,"by":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1546762493,"by":{"name":"Toomas Soome","email":"tsoome@me.com","username":"tsoome"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1546870258,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":12,"deletions":0},{"file":"usr/src/uts/common/io/lofi.c","type":"MODIFIED","insertions":4,"deletions":-3}],"sizeInsertions":4,"sizeDeletions":-3}],"allReviewers":[{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},{"name":"Toomas Soome","email":"tsoome@me.com","username":"tsoome"},{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}]}