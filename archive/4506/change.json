{"project":"joyent/sdcadm","branch":"master","id":"Ib27956596d3f82d6f2643f5f60100aadc22f8db9","number":"4506","subject":"TOOLS-1571 sdcadm should rollback post-setup ha-manatee Reviewed by: Marsell Kukuljevic \u003cmarsell@joyent.com\u003e Approved by: Marsell Kukuljevic \u003cmarsell@joyent.com\u003e","owner":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"url":"https://cr.joyent.us/4506","commitMessage":"TOOLS-1571 sdcadm should rollback post-setup ha-manatee\nReviewed by: Marsell Kukuljevic \u003cmarsell@joyent.com\u003e\nApproved by: Marsell Kukuljevic \u003cmarsell@joyent.com\u003e\n","createdOn":1531407805,"lastUpdated":1531924472,"open":false,"status":"MERGED","comments":[{"timestamp":1531407805,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 1."},{"timestamp":1531407812,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit 3071695474be7e0998f4b72cc26b0803b23054b3\n    \n    TOOLS-1571 sdcadm should rollback post-setup ha-manatee"},{"timestamp":1531407857,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1531512731,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 1:\n\n(20 comments)"},{"timestamp":1531754695,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 2."},{"timestamp":1531754701,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit 12a3db2614cac6faa725c8fc51c9e91cd4255acd\n    \n    TOOLS-1571 sdcadm should rollback post-setup ha-manatee"},{"timestamp":1531754736,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 2:\n\n(20 comments)\n\nAnd done with everything suggested. Thanks!"},{"timestamp":1531754749,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1531855735,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 2: Code-Review+1 Integration-Approval+1"},{"timestamp":1531924457,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 3: Commit message was updated."},{"timestamp":1531924472,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Pedro Palazón Candel"}],"currentPatchSet":{"number":"3","revision":"b27956596d3f82d6f2643f5f60100aadc22f8db9","parents":["288e998a415af65109a0cdbe3a8e1b3b28ab01d2"],"ref":"refs/changes/06/4506/3","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1531924457,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1531754749,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1531855735,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1531855735,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}},{"type":"SUBM","value":"1","grantedOn":1531924472,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"test/manatee.test.js","type":"MODIFIED","insertions":364,"deletions":-1}],"sizeInsertions":364,"sizeDeletions":-1},"patchSets":[{"number":"1","revision":"3502c5808339141f918a3a1d03b664d179775c09","parents":["99ee3f23319a8445584ea50e4dd44a0357232315"],"ref":"refs/changes/06/4506/1","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1531407805,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1531407857,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"test/manatee.test.js","line":82,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"name"},{"file":"test/manatee.test.js","line":82,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"test/manatee.test.js","line":103,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Can pass in next directly?"},{"file":"test/manatee.test.js","line":103,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"test/manatee.test.js","line":113,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Maybe can pass in t.end directly?"},{"file":"test/manatee.test.js","line":113,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"I\u0027d rather keep it as is so it\u0027s obvious where the t.end() call is just at first pass."},{"file":"test/manatee.test.js","line":254,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"name"},{"file":"test/manatee.test.js","line":254,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Really? None of the sdcadm test functions has a name. I\u0027d rather keep it this way even if that\u0027s just merely for consistency"},{"file":"test/manatee.test.js","line":259,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Given how often \"instances[0]\" is used, could assign it to \"instance\" here?"},{"file":"test/manatee.test.js","line":259,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"test/manatee.test.js","line":271,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"name"},{"file":"test/manatee.test.js","line":271,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"test/manatee.test.js","line":275,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Assign this to a var outside the filter()."},{"file":"test/manatee.test.js","line":275,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"test/manatee.test.js","line":282,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"ee\n\nctx.manateVmsByUuid is missing the extra \"e\" elsewhere too."},{"file":"test/manatee.test.js","line":282,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"test/manatee.test.js","line":284,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"As far as I can tell, this function is dead code. Nothing else uses ctx.manateVmsByUuid.\n\nI\u0027m guessing you replaced getManateeVms() with getManateeInstances()."},{"file":"test/manatee.test.js","line":284,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"You\u0027re guessing correctly!"},{"file":"test/manatee.test.js","line":289,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"name"},{"file":"test/manatee.test.js","line":289,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"test/manatee.test.js","line":296,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"hoist out of filter()"},{"file":"test/manatee.test.js","line":296,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"test/manatee.test.js","line":299,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"It seems like nothing is using this?"},{"file":"test/manatee.test.js","line":299,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"test/manatee.test.js","line":301,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"name"},{"file":"test/manatee.test.js","line":301,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"test/manatee.test.js","line":400,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Not really sure what using format() gains you here. :p"},{"file":"test/manatee.test.js","line":400,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"test/manatee.test.js","line":428,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Complicated enough to deserve a name."},{"file":"test/manatee.test.js","line":428,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"test/manatee.test.js","line":468,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"name"},{"file":"test/manatee.test.js","line":468,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"test/manatee.test.js","line":506,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Can replace all this with just nextInst (you do it elsewhere in this same patch too!)."},{"file":"test/manatee.test.js","line":506,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Indeed. I were doing some debug output here before so I left it unchanged. Done now."},{"file":"test/manatee.test.js","line":531,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Can pass in next directly?"},{"file":"test/manatee.test.js","line":531,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"test/manatee.test.js","line":539,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"I wonder if you can pass in t.end here; sometimes that works."},{"file":"test/manatee.test.js","line":539,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Same reasoning than above. I prefer this to be obvious to the eye"},{"file":"test/manatee.test.js","line":553,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"...maybe no space on the line, but prolly should be named."},{"file":"test/manatee.test.js","line":553,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"How so? Can get rid of the not used \"_stat\" ;-)"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"test/manatee.test.js","type":"MODIFIED","insertions":407,"deletions":-1}],"sizeInsertions":407,"sizeDeletions":-1},{"number":"2","revision":"12ed4e28478255c52b08d486883d3a079a08e318","parents":["288e998a415af65109a0cdbe3a8e1b3b28ab01d2"],"ref":"refs/changes/06/4506/2","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1531754695,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1531754749,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1531855735,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1531855735,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"test/manatee.test.js","type":"MODIFIED","insertions":364,"deletions":-1}],"sizeInsertions":364,"sizeDeletions":-1},{"number":"3","revision":"b27956596d3f82d6f2643f5f60100aadc22f8db9","parents":["288e998a415af65109a0cdbe3a8e1b3b28ab01d2"],"ref":"refs/changes/06/4506/3","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1531924457,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1531754749,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"SUBM","value":"1","grantedOn":1531924472,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1531855735,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1531855735,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"test/manatee.test.js","type":"MODIFIED","insertions":364,"deletions":-1}],"sizeInsertions":364,"sizeDeletions":-1}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}]}