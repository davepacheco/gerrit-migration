{"project":"joyent/illumos-joyent","branch":"master","id":"Ia03c8a97a38d603111e2cd1ee9b80faacbd74b2b","number":"6506","subject":"OS-7858 Allow a range of bytes to be removed from a custr","owner":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"url":"https://cr.joyent.us/6506","commitMessage":"OS-7858 Allow a range of bytes to be removed from a custr\n","createdOn":1561567713,"lastUpdated":1573153966,"open":false,"status":"ABANDONED","comments":[{"timestamp":1561567713,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Uploaded patch set 1."},{"timestamp":1561568696,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1561581149,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Uploaded patch set 2."},{"timestamp":1561581265,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Uploaded patch set 3."},{"timestamp":1565034285,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Uploaded patch set 4."},{"timestamp":1573153966,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Abandoned"}],"currentPatchSet":{"number":"4","revision":"a03c8a97a38d603111e2cd1ee9b80faacbd74b2b","parents":["31891197ecb87e2742aca4828b47451926228841"],"ref":"refs/changes/06/6506/4","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1565034285,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/libcustr/common/custr.c","type":"MODIFIED","insertions":75,"deletions":0},{"file":"usr/src/lib/libcustr/common/libcustr.h","type":"MODIFIED","insertions":47,"deletions":-1},{"file":"usr/src/lib/libcustr/common/mapfile-vers","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"usr/src/test/util-tests/runfiles/default.run","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"usr/src/test/util-tests/tests/Makefile","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/test/util-tests/tests/libcustr/Makefile","type":"ADDED","insertions":50,"deletions":0},{"file":"usr/src/test/util-tests/tests/libcustr/custr_remove.c","type":"ADDED","insertions":73,"deletions":0},{"file":"usr/src/test/util-tests/tests/libcustr/custr_trunc.c","type":"ADDED","insertions":64,"deletions":0}],"sizeInsertions":319,"sizeDeletions":-4},"patchSets":[{"number":"1","revision":"4acec817e833c7329eb0bcf23be3f7f42cce4343","parents":["356e1b4941ba70261404f9bb0255f70891042331"],"ref":"refs/changes/06/6506/1","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1561567713,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/lib/libcustr/common/libcustr.h","line":166,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"I had put this in the JIRA ticket, but just in case:\n\nI think it would be better to be a bit less overloaded here. What about:\n\n    int custr_remove(custr_t *cu, size_t idx, size_t len);\n    int custr_rremove(custr_t *cu, size_t idx, size_t len);\n    \n    int custr_trunc(custr_t *cu, size_t idx);\n    int custr_rtrunc(custr_t *cu, size_t idx);\n\nThe first, custr_remove(), would remove \"len\" bytes starting at index \"idx\", provided at least \"len\" bytes are available to remove.  It would return 0 on success.  It would return -1 and EINVAL, leaving the string unmodified, if \"idx\" is out of bounds of the string or if less than \"len\" bytes exist between \"idx\" and the end of the string.\n\nThe second, custr_rremove(), would be the same as the first â€“ except \"idx\" would be counted backwards from the end of the string (as if it were a negative value in the original suggested API).\n\nThe last two, custr_trunc() and custr_rtrunc(), would be the same as custr_remove() and custr_rremove() respectively, except that they would remove everything from \"idx\" up to the end of the string without requiring a length argument.\n\nBeing strict about the bounds checks allows us to VERIFY0() these calls to ensure we understand the string contents. Making the different indexing directions into separate symbols, and not using a magic constant for \"len\" to request truncation, avoids the challenges of inband signalling; e.g., that we might have an accidentally negative index and remove the wrong thing without noticing."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/libcustr/common/custr.c","type":"MODIFIED","insertions":45,"deletions":0},{"file":"usr/src/lib/libcustr/common/libcustr.h","type":"MODIFIED","insertions":25,"deletions":-1},{"file":"usr/src/lib/libcustr/common/mapfile-vers","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/test/util-tests/runfiles/default.run","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/test/util-tests/tests/Makefile","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/test/util-tests/tests/libcustr/Makefile","type":"ADDED","insertions":50,"deletions":0},{"file":"usr/src/test/util-tests/tests/libcustr/custr_delete.c","type":"ADDED","insertions":75,"deletions":0}],"sizeInsertions":201,"sizeDeletions":-4},{"number":"2","revision":"0d1c1c1cc7ec8da0e4bec9cb0e1f03cafe362d06","parents":["356e1b4941ba70261404f9bb0255f70891042331"],"ref":"refs/changes/06/6506/2","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1561581149,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/libcustr/common/custr.c","type":"MODIFIED","insertions":75,"deletions":0},{"file":"usr/src/lib/libcustr/common/libcustr.h","type":"MODIFIED","insertions":47,"deletions":-1},{"file":"usr/src/lib/libcustr/common/mapfile-vers","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"usr/src/test/util-tests/runfiles/default.run","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"usr/src/test/util-tests/tests/Makefile","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/test/util-tests/tests/libcustr/Makefile","type":"ADDED","insertions":50,"deletions":0},{"file":"usr/src/test/util-tests/tests/libcustr/custr_remove.c","type":"ADDED","insertions":73,"deletions":0},{"file":"usr/src/test/util-tests/tests/libcustr/custr_trunc.c","type":"ADDED","insertions":64,"deletions":0}],"sizeInsertions":319,"sizeDeletions":-4},{"number":"3","revision":"454c1fdf661d38fd143da73a0ae9cf97ab5c2d6e","parents":["356e1b4941ba70261404f9bb0255f70891042331"],"ref":"refs/changes/06/6506/3","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1561581265,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/libcustr/common/custr.c","type":"MODIFIED","insertions":75,"deletions":0},{"file":"usr/src/lib/libcustr/common/libcustr.h","type":"MODIFIED","insertions":47,"deletions":-1},{"file":"usr/src/lib/libcustr/common/mapfile-vers","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"usr/src/test/util-tests/runfiles/default.run","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"usr/src/test/util-tests/tests/Makefile","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/test/util-tests/tests/libcustr/Makefile","type":"ADDED","insertions":50,"deletions":0},{"file":"usr/src/test/util-tests/tests/libcustr/custr_remove.c","type":"ADDED","insertions":73,"deletions":0},{"file":"usr/src/test/util-tests/tests/libcustr/custr_trunc.c","type":"ADDED","insertions":64,"deletions":0}],"sizeInsertions":319,"sizeDeletions":-4},{"number":"4","revision":"a03c8a97a38d603111e2cd1ee9b80faacbd74b2b","parents":["31891197ecb87e2742aca4828b47451926228841"],"ref":"refs/changes/06/6506/4","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1565034285,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/libcustr/common/custr.c","type":"MODIFIED","insertions":75,"deletions":0},{"file":"usr/src/lib/libcustr/common/libcustr.h","type":"MODIFIED","insertions":47,"deletions":-1},{"file":"usr/src/lib/libcustr/common/mapfile-vers","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"usr/src/test/util-tests/runfiles/default.run","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"usr/src/test/util-tests/tests/Makefile","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/test/util-tests/tests/libcustr/Makefile","type":"ADDED","insertions":50,"deletions":0},{"file":"usr/src/test/util-tests/tests/libcustr/custr_remove.c","type":"ADDED","insertions":73,"deletions":0},{"file":"usr/src/test/util-tests/tests/libcustr/custr_trunc.c","type":"ADDED","insertions":64,"deletions":0}],"sizeInsertions":319,"sizeDeletions":-4}],"allReviewers":[{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}]}