{"project":"joyent/illumos-joyent","branch":"master","id":"If367310f219802eaffd224b4cdddf2133302efa6","number":"4224","subject":"OS-7023 invalidate cache before microcode update Reviewed by: John Levon \u003cjohn.levon@joyent.com\u003e Approved by: Joshua M. Clulow \u003cjmc@joyent.com\u003e","owner":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"url":"https://cr.joyent.us/4224","commitMessage":"OS-7023 invalidate cache before microcode update\nReviewed by: John Levon \u003cjohn.levon@joyent.com\u003e\nApproved by: Joshua M. Clulow \u003cjmc@joyent.com\u003e\n","createdOn":1529011132,"lastUpdated":1529443153,"open":false,"status":"MERGED","comments":[{"timestamp":1529011132,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Uploaded patch set 1."},{"timestamp":1529062842,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 1: Code-Review+1\n\nI\u0027m not privy to the specifics of Intel\u0027s recommendations, so I\u0027m presuming it\u0027s OK that other CPUs can still be actively polluting some level of the cache we just flushed, and there\u0027s no (tiny?) race condition between the wbinvd and the wrmsr. i.e. we don\u0027t need a full-on pause_cpus() bracketing."},{"timestamp":1529431490,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 1:\n\nYeah, as far as the information I\u0027ve been given, which isn\u0027t very much, this is recommended. This smells like a workaround for other issues, but since they\u0027re recommending it be done, it doesn\u0027t really hurt. I don\u0027t believe we need to pause the sibling thread in this case."},{"timestamp":1529432104,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Patch Set 1: Integration-Approval+1"},{"timestamp":1529442891,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Uploaded patch set 2: Patch Set 1 was rebased."},{"timestamp":1529443147,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Uploaded patch set 3: Commit message was updated."},{"timestamp":1529443153,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Robert Mustacchi"}],"currentPatchSet":{"number":"3","revision":"f367310f219802eaffd224b4cdddf2133302efa6","parents":["28a4d80723e5da0288e478dae17be1c0474d200e"],"ref":"refs/changes/24/4224/3","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1529443147,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1529062842,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1529432104,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}},{"type":"SUBM","value":"1","grantedOn":1529443153,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/uts/i86pc/os/microcode.c","type":"MODIFIED","insertions":15,"deletions":-1}],"sizeInsertions":15,"sizeDeletions":-1},"patchSets":[{"number":"1","revision":"3e8a676794f61d5ffc5eec10861cf7547b2a28aa","parents":["c2d375cdcb04122f97908079581dda41a08c0d07"],"ref":"refs/changes/24/4224/1","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1529011132,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1529432104,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1529062842,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/i86pc/os/microcode.c","type":"MODIFIED","insertions":15,"deletions":-1}],"sizeInsertions":15,"sizeDeletions":-1},{"number":"2","revision":"3576587e66a76032163d63aa7350ada0287340ab","parents":["28a4d80723e5da0288e478dae17be1c0474d200e"],"ref":"refs/changes/24/4224/2","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1529442891,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1529432104,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1529062842,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/i86pc/os/microcode.c","type":"MODIFIED","insertions":15,"deletions":-1}],"sizeInsertions":15,"sizeDeletions":-1},{"number":"3","revision":"f367310f219802eaffd224b4cdddf2133302efa6","parents":["28a4d80723e5da0288e478dae17be1c0474d200e"],"ref":"refs/changes/24/4224/3","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1529443147,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"SUBM","value":"1","grantedOn":1529443153,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1529432104,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1529062842,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/uts/i86pc/os/microcode.c","type":"MODIFIED","insertions":15,"deletions":-1}],"sizeInsertions":15,"sizeDeletions":-1}],"allReviewers":[{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}]}