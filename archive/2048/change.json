{"project":"joyent/sdc-vmapi","branch":"master","id":"Iabb70de01ada7f0a5b5f0d744eea8790245dc443","number":"2048","subject":"ZAPI-754 use cueball for talking to other SDC services","owner":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"url":"https://cr.joyent.us/2048","commitMessage":"ZAPI-754 use cueball for talking to other SDC services\n","createdOn":1496770439,"lastUpdated":1497278136,"open":false,"status":"MERGED","comments":[{"timestamp":1496770439,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 1."},{"timestamp":1496770444,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit 7bca1b4dcd47602d87c3e0acf1309f29161b646e\n    \n    ZAPI-754 use cueball for talking to other SDC services"},{"timestamp":1496770478,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1496854154,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 2."},{"timestamp":1496854160,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit 95c6118495eff2955d474135d7ae8d6034b752f1\n    \n    ZAPI-754 use cueball for talking to other SDC services"},{"timestamp":1496854183,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1496854459,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 2:\n\nAll tests passing so far:\n\n        # test output:\n        /var/tmp/vmapitest/vmapi.tap\n\n        # test results:\n        # Completed in 374 seconds.\n        # PASS: 1666 / 1666"},{"timestamp":1496857901,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 3."},{"timestamp":1496857908,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 3:\n\nNew commits:\n    \n    commit 3e23569bf48632d3edff46db57e9e398531ba85a\n    \n    ZAPI-754 use cueball for talking to other SDC services"},{"timestamp":1496857930,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1496871025,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 3:\n\n(3 comments)"},{"timestamp":1496900876,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 3:\n\n(1 comment)\n\nI don\u0027t really have much to add, happy to add my +1 once Julien\u0027s points are addressed."},{"timestamp":1496931036,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 4."},{"timestamp":1496931042,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 4:\n\nNew commits:\n    \n    commit 6d187d12c803ea78e0b8d375efe8112e9551561c\n    \n    ZAPI-754 use cueball for talking to other SDC services"},{"timestamp":1496931065,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1496932972,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 4:\n\n(3 comments)\n\nWaiting for you to make a call on keeping or not optional cueball usage. Other than that, suggested modification applied"},{"timestamp":1496943661,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 3:\n\n(3 comments)"},{"timestamp":1496943863,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 4: Code-Review+1"},{"timestamp":1496944713,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 4: Integration-Approval+1"},{"timestamp":1496946210,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 4: Code-Review+1"},{"timestamp":1497278107,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 5: Patch Set 4 was rebased"},{"timestamp":1497278114,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Pedro Palazón Candel"},{"timestamp":1497278136,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5:\n\n\"make check\" passed ok"}],"currentPatchSet":{"number":"5","revision":"280af75e07e2d35b71fdd50b23dc7b8d3fe6fea1","parents":["a4f4c8f63a2d8be592bd2275ee010c249e7eb48a"],"ref":"refs/changes/48/2048/5","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1497278107,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1496931065,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1496943863,"by":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1496944713,"by":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1496946210,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"SUBM","value":"1","grantedOn":1497278114,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/apis/cnapi.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/apis/imgapi.js","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"lib/apis/napi.js","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"lib/apis/papi.js","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":0},{"file":"sapi_manifests/vmapi/template","type":"MODIFIED","insertions":21,"deletions":-3},{"file":"server.js","type":"MODIFIED","insertions":11,"deletions":0}],"sizeInsertions":50,"sizeDeletions":-11},"patchSets":[{"number":"1","revision":"4a5c55d2fef94c12b423bdf67d3a6931f0d6346e","parents":["a4d0bc5d1fadf3aecc7abd3ba94ba543146d4105"],"ref":"refs/changes/48/2048/1","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1496770439,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1496770478,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/apis/cnapi.js","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"lib/apis/imgapi.js","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"lib/apis/napi.js","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"lib/apis/papi.js","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":0},{"file":"sapi_manifests/vmapi/template","type":"MODIFIED","insertions":24,"deletions":-6},{"file":"server.js","type":"MODIFIED","insertions":11,"deletions":-2}],"sizeInsertions":54,"sizeDeletions":-16},{"number":"2","revision":"f14dad65216b6592df5b85d4ee451d4d37cac63f","parents":["a4d0bc5d1fadf3aecc7abd3ba94ba543146d4105"],"ref":"refs/changes/48/2048/2","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1496854154,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1496854183,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/apis/cnapi.js","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"lib/apis/imgapi.js","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"lib/apis/napi.js","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"lib/apis/papi.js","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":0},{"file":"sapi_manifests/vmapi/template","type":"MODIFIED","insertions":21,"deletions":0},{"file":"server.js","type":"MODIFIED","insertions":11,"deletions":0}],"sizeInsertions":51,"sizeDeletions":-8},{"number":"3","revision":"5c01342b19ed169db4d101b9b3c984d571187b7c","parents":["a4d0bc5d1fadf3aecc7abd3ba94ba543146d4105"],"ref":"refs/changes/48/2048/3","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1496857901,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1496857930,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/apis/cnapi.js","line":29,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Is the retry option still relevant when using a cueball agent?"},{"file":"lib/apis/cnapi.js","line":29,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"No, good call"},{"file":"sapi_manifests/vmapi/template","line":79,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Does that mean that vmapi stops retrying connecting to any of the services above after 5 tries?"},{"file":"sapi_manifests/vmapi/template","line":79,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"I believe when the retries are reached, according to:\n\nhttps://joyent.github.io/node-cueball/#recovery_objects\n\nand:\n\nhttps://joyent.github.io/node-cueball/#state_transitions\n\nthe specific backend is marked \u0027failed\u0027 and therefore a new connection is made (potentially to a new backend)."},{"file":"sapi_manifests/vmapi/template","line":79,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"That\u0027s how I understand it too."},{"file":"sapi_manifests/vmapi/template","line":79,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Sounds good!"},{"file":"server.js","line":72,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Do we want to support not using cueball to connect to these services? In other words, should we assert on the presence of \"config.cueballHttpAgent\"?"},{"file":"server.js","line":72,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Well, I think it\u0027s not a bad idea to keep it as is for some time so, in case of network debugging, we could just take cueball out of the mix quickly, by just modifying the configuration template. Anyway, I\u0027m not married with any option. Whatever you think it\u0027s better I\u0027ll apply"},{"file":"server.js","line":72,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Sounds good to me as it is!"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/apis/cnapi.js","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"lib/apis/imgapi.js","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"lib/apis/napi.js","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"lib/apis/papi.js","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":0},{"file":"sapi_manifests/vmapi/template","type":"MODIFIED","insertions":21,"deletions":-3},{"file":"server.js","type":"MODIFIED","insertions":11,"deletions":0}],"sizeInsertions":51,"sizeDeletions":-11},{"number":"4","revision":"abb70de01ada7f0a5b5f0d744eea8790245dc443","parents":["a4d0bc5d1fadf3aecc7abd3ba94ba543146d4105"],"ref":"refs/changes/48/2048/4","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1496931036,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1496931065,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1496946210,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1496943863,"by":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1496944713,"by":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}}],"comments":[{"file":"server.js","line":85,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Can one agent be used to manage connections to different backends?"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/apis/cnapi.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/apis/imgapi.js","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"lib/apis/napi.js","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"lib/apis/papi.js","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":0},{"file":"sapi_manifests/vmapi/template","type":"MODIFIED","insertions":21,"deletions":-3},{"file":"server.js","type":"MODIFIED","insertions":11,"deletions":0}],"sizeInsertions":50,"sizeDeletions":-11},{"number":"5","revision":"280af75e07e2d35b71fdd50b23dc7b8d3fe6fea1","parents":["a4f4c8f63a2d8be592bd2275ee010c249e7eb48a"],"ref":"refs/changes/48/2048/5","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1497278107,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1496931065,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1496946210,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"SUBM","value":"1","grantedOn":1497278114,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1496943863,"by":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1496944713,"by":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/apis/cnapi.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/apis/imgapi.js","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"lib/apis/napi.js","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"lib/apis/papi.js","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":0},{"file":"sapi_manifests/vmapi/template","type":"MODIFIED","insertions":21,"deletions":-3},{"file":"server.js","type":"MODIFIED","insertions":11,"deletions":0}],"sizeInsertions":50,"sizeDeletions":-11}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}]}