{"project":"joyent/sdc-cloudapi","branch":"master","id":"Ifb7d3935d7e1dac9957a9c3d19f0fb3bba4103ee","number":"2644","subject":"PUBAPI-1428 CreateMachine: add \"affinity\" rules, deprecate \"locality\" hints Reviewed by: Josh Wilsdon \u003cjosh@wilsdon.ca\u003e Approved by: Josh Wilsdon \u003cjosh@wilsdon.ca\u003e","owner":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"url":"https://cr.joyent.us/2644","commitMessage":"PUBAPI-1428 CreateMachine: add \"affinity\" rules, deprecate \"locality\" hints\nReviewed by: Josh Wilsdon \u003cjosh@wilsdon.ca\u003e\nApproved by: Josh Wilsdon \u003cjosh@wilsdon.ca\u003e\n","createdOn":1506123831,"lastUpdated":1506448934,"open":false,"status":"MERGED","comments":[{"timestamp":1506123831,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Uploaded patch set 1."},{"timestamp":1506123832,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit 453dca9b2c9f2cd2e2f8c794c49cd29ef7fa6da9\n    \n    this should be working now\n    \n    commit c621bd5c95955df9692078332623fcf19d71299b\n    \n    fix make check\n    \n    commit 6536a9e5238235e2d426ca976ac5c8d7c2615da6\n    \n    next stab at this that fixes the near-on-two-separate-CNs problem, better tests\n    \n    commit 82ccbad7ac9532fd3a943acf1bba16320b226eb4\n    \n    PUBAPI-1428: added testsm changed version.\n    \n    commit 98e78f6f65027f2a44943eca60e75de7c87b7e7d\n    \n    PUBAPI-1428 first stab (missing docs, version update, tests)"},{"timestamp":1506123861,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1506123963,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Uploaded patch set 2: Patch Set 1 was rebased."},{"timestamp":1506123964,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit 4d1f4c82070af264c692c64dbf4d6ebc6c044ad3\n    \n    this should be working now\n    \n    commit f835087b36116d765b4194224c65ffce9610b2eb\n    \n    fix make check\n    \n    commit 65e3f51754a24fa7a288b2a6be85086b63ebda0e\n    \n    next stab at this that fixes the near-on-two-separate-CNs problem, better tests\n    \n    commit bf0d6b606c2f539e212100758ee42f0ed6e254de\n    \n    PUBAPI-1428: added testsm changed version.\n    \n    commit 50d3e6aa3fd4ff032d650260fa2064904c1c4543\n    \n    PUBAPI-1428 first stab (missing docs, version update, tests)"},{"timestamp":1506124007,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2:\n\n\"make check\" passed ok"},{"timestamp":1506124119,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 2:\n\ntesting notes: cloudapi machines.test.js and affinity tests pass:\n\n```\n#\n# TESTS COMPLETE IN 653 SECONDS, SUMMARY:\n#\n#   PASS: 1473 / 1473\n#\n```\n\nin nightly-1."},{"timestamp":1506133291,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 2: Code-Review+1\n\n(29 comments)\n\nI think overall this looks ok. There are just a bunch of nits and suggestions for improvement that you\u0027re of course free to ignore. :)"},{"timestamp":1506359543,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Uploaded patch set 3."},{"timestamp":1506359545,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 3:\n\nNew commits:\n    \n    commit 1162cd4319a64ce0a0337414015195e036d73ad0\n    \n    updates for CR comments\n    \n    commit 97b3c9a69e413a6f339a1f9f2684ce56be0cf0dd\n    \n    doc tweak\n    \n    commit 5b92eca67ec9c1118a3facaa347a3df85ca8ea5c\n    \n    this should be working now\n    \n    commit bcf195964e89b9ec68f153829da209984b358416\n    \n    fix make check\n    \n    commit 9275078439fae4ac4d27c63097893cde48b5262c\n    \n    next stab at this that fixes the near-on-two-separate-CNs problem, better tests\n    \n    commit 5e330ddeb2b94d4c156ae5618ada04bb41a59291\n    \n    PUBAPI-1428: added testsm changed version.\n    \n    commit 2e6a826f76eeb28f07ae2e83359cb5add42b4e1a\n    \n    PUBAPI-1428 first stab (missing docs, version update, tests)"},{"timestamp":1506359574,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1506359746,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1506372423,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 3: Code-Review+1 Integration-Approval+1\n\nlgtm! Thanks!"},{"timestamp":1506401786,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Uploaded patch set 4."},{"timestamp":1506401788,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 4:\n\nNew commits:\n    \n    commit 70abaa3caee964b7308e2e0983c4439644c81479\n    \n    doc updates"},{"timestamp":1506401827,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1506410145,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 4: Code-Review+1 Integration-Approval+1\n\n(5 comments)"},{"timestamp":1506437639,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Trent Mick"},{"timestamp":1506448934,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 4:\n\n(1 comment)"}],"currentPatchSet":{"number":"4","revision":"fb7d3935d7e1dac9957a9c3d19f0fb3bba4103ee","parents":["1c405e141d0362c6d805ec47b6125696c2115fc1"],"ref":"refs/changes/44/2644/4","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1506401786,"author":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1506401827,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1506410145,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1506410145,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"SUBM","value":"1","grantedOn":1506437639,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"comments":[{"file":"docs/index.md","line":4470,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Perhaps you meant \"different node *from* the instance(s) ...\""},{"file":"docs/index.md","line":4474,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"again s/as/from/ I\u0027d think"},{"file":"docs/index.md","line":4483,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"s/as/from/?"},{"file":"docs/index.md","line":4486,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"or maybe you mean to? I don\u0027t know..."},{"file":"docs/index.md","line":4517,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Might be worth mentioning that in extreme/pathological cases w/o `strict` *all* your instances might end up on the same CN."},{"file":"docs/index.md","line":4517,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Thanks for the above notes. I\u0027ll update in PUBAPI-1444.\n\nI don\u0027t want to bother with this clarification in the locality hints section. This section was just moved down, and locality hints are deprecated now anyway. As well, I\u0027m happy leaving that inference up to the user."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":137,"deletions":-30},{"file":"lib/app.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/errors.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/machines.js","type":"MODIFIED","insertions":47,"deletions":-5},{"file":"lib/triton-affinity.js","type":"ADDED","insertions":1064,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":4,"deletions":-2},{"file":"test/affinity-unit.test.js","type":"ADDED","insertions":309,"deletions":0},{"file":"test/machines.71.test.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/machines.test.js","type":"MODIFIED","insertions":10,"deletions":0},{"file":"test/machines/affinity.js","type":"ADDED","insertions":184,"deletions":0},{"file":"tools/jsl.node.conf","type":"MODIFIED","insertions":1,"deletions":0}],"sizeInsertions":1762,"sizeDeletions":-42},"patchSets":[{"number":"1","revision":"745279b081020c4f3db42dd7b63f4895a58bed28","parents":["85b34ed42d683ffc0e2f17d0a7ca32535ce4de7d"],"ref":"refs/changes/44/2644/1","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1506123831,"author":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1506123861,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/app.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/errors.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"lib/machines.js","type":"MODIFIED","insertions":47,"deletions":-5},{"file":"lib/triton-affinity.js","type":"ADDED","insertions":1047,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":4,"deletions":-2},{"file":"test/affinity-unit.test.js","type":"ADDED","insertions":303,"deletions":0},{"file":"test/machines.71.test.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/machines.test.js","type":"MODIFIED","insertions":9,"deletions":0},{"file":"test/machines/affinity.js","type":"ADDED","insertions":184,"deletions":0},{"file":"tools/jsl.node.conf","type":"MODIFIED","insertions":1,"deletions":0}],"sizeInsertions":1599,"sizeDeletions":-10},{"number":"2","revision":"de204f3654948daa5d759c28f7a027407046aca0","parents":["1c405e141d0362c6d805ec47b6125696c2115fc1"],"ref":"refs/changes/44/2644/2","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1506123963,"author":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1506123861,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1506133291,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}}],"comments":[{"file":"lib/app.js","line":357,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"nice work! :)"},{"file":"lib/errors.js","line":8,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Oh no!"},{"file":"lib/machines.js","line":564,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Thank You!"},{"file":"lib/triton-affinity.js","line":11,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"worth creating a ticket for that and referencing the ticket # here?"},{"file":"lib/triton-affinity.js","line":199,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Should there be an assert.optionalObject(opts.container.Labels, ...) here to prevent something other than an object coming in? Also: assert.optionalArray(opts.container.Env, ...)?"},{"file":"lib/triton-affinity.js","line":271,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"I agree with JSL. This is an odd construction. Especially since the bulk of the loop only runs once. Why not instead something like:\n\n    // find the first operator\n    for (i \u003d 0; i \u003c operators.length; i++) {\n        idx \u003d s.indexOf(operators[i]);\n        if (idx !\u003d\u003d -1) {\n            break;\n        }\n    }\n\n    // if we didn\u0027t find an operator, throw\n    if (idx \u003d\u003d\u003d operators.length) {\n        throw new VError({name: \u0027ValidationError\u0027}, ...\n    }\n\n    // do all the code that builds the rule\n\n    return rule;"},{"file":"lib/triton-affinity.js","line":273,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"nit: I\u0027d put `var i;` at the top of ruleFromExpr to make it clear what its scope is. Not a dealbreaker though. :)"},{"file":"lib/triton-affinity.js","line":275,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"nit: same nit as above, I\u0027d put `var idx;` at the top of its scope."},{"file":"lib/triton-affinity.js","line":316,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Is the input always trusted here, or should we add some asserts?"},{"file":"lib/triton-affinity.js","line":394,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Should we also be asserting object.string(opts.rule.key, ...); or go even further and: assert.ok([\u0027instance\u0027, \u0027container\u0027].indexOf(opts.rule.key) !\u003d\u003d -1, \u0027invalid opts.rule.key\u0027); ?"},{"file":"lib/triton-affinity.js","line":408,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"random thought: I wonder if it would make sense in the future to use this cache if we have it, for the other lookups below too that are currently doing getVm or listVms themselves? Instead of just in the fallback / regexp case.\n\nAlso: It\u0027d be nice to name this function"},{"file":"lib/triton-affinity.js","line":419,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"nit: It\u0027d be nice to name this function"},{"file":"lib/triton-affinity.js","line":446,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"nit: It\u0027d be nice to name this function."},{"file":"lib/triton-affinity.js","line":471,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"nit: It\u0027d be nice to name this function."},{"file":"lib/triton-affinity.js","line":506,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"nit: It\u0027d be nice to name this function."},{"file":"lib/triton-affinity.js","line":532,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"nit: It\u0027d be nice to name this function"},{"file":"lib/triton-affinity.js","line":575,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"nit: It\u0027d be nice to name this function"},{"file":"lib/triton-affinity.js","line":592,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"nit: It\u0027d be nice to name this function"},{"file":"lib/triton-affinity.js","line":672,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"nit: It\u0027d be nice to name this function"},{"file":"lib/triton-affinity.js","line":844,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"nit: It\u0027d be nice to name this function"},{"file":"lib/triton-affinity.js","line":849,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"nit: It\u0027d be nice to name this function"},{"file":"lib/triton-affinity.js","line":878,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"This function has a lot of variables strewn all over the place. It seems that maybe the processing into nearServerUuids and farServerUuids could be separated into separate functions which might clean it up quite a bit? Just a thought."},{"file":"lib/triton-affinity.js","line":878,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"I think I\u0027ve changed for every suggestion you\u0027ve made except for this one. I\u0027m bowing out on this one because I don\u0027t want to refactor it *right* now. There is a basic variable decl style difference that you and I have, Josh. I\u0027d love to discuss that face to face. I think your style will probably be what I switch to because yours is definitely better for checking with lint/style tooling."},{"file":"test/affinity-unit.test.js","line":18,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"alphabetically, it would seem this is out of place."},{"file":"test/affinity-unit.test.js","line":81,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"is this space intentionally left blank? I\u0027m used to seeing a blank line after the variables, not between the last and second-to-last."},{"file":"test/affinity-unit.test.js","line":127,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"nit: space after vars?"},{"file":"test/affinity-unit.test.js","line":136,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"nit: maybe put the \"var locality\" at the top of the function with other vars?"},{"file":"test/affinity-unit.test.js","line":153,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"nit: I\u0027d have expected: vars foundMatch, i, expectedLocality and locSummary at the top of their scope. But as usual: up to you. :)"},{"file":"test/machines.71.test.js","line":8,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"SO OLD!"},{"file":"test/machines.test.js","line":1327,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"some of the functions in this file have a space after their vars and others don\u0027t, so I guess: #YOLO ¯\\_(ツ)_/¯"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/app.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/errors.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"lib/machines.js","type":"MODIFIED","insertions":47,"deletions":-5},{"file":"lib/triton-affinity.js","type":"ADDED","insertions":1047,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":4,"deletions":-2},{"file":"test/affinity-unit.test.js","type":"ADDED","insertions":303,"deletions":0},{"file":"test/machines.71.test.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/machines.test.js","type":"MODIFIED","insertions":9,"deletions":0},{"file":"test/machines/affinity.js","type":"ADDED","insertions":184,"deletions":0},{"file":"tools/jsl.node.conf","type":"MODIFIED","insertions":1,"deletions":0}],"sizeInsertions":1599,"sizeDeletions":-10},{"number":"3","revision":"543e8d9ad56489ebe0c317ac1b438fe29a241dea","parents":["1c405e141d0362c6d805ec47b6125696c2115fc1"],"ref":"refs/changes/44/2644/3","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1506359543,"author":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1506359574,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1506372423,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1506372423,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"lib/app.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/errors.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/machines.js","type":"MODIFIED","insertions":47,"deletions":-5},{"file":"lib/triton-affinity.js","type":"ADDED","insertions":1064,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":4,"deletions":-2},{"file":"test/affinity-unit.test.js","type":"ADDED","insertions":309,"deletions":0},{"file":"test/machines.71.test.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/machines.test.js","type":"MODIFIED","insertions":10,"deletions":0},{"file":"test/machines/affinity.js","type":"ADDED","insertions":184,"deletions":0},{"file":"tools/jsl.node.conf","type":"MODIFIED","insertions":1,"deletions":0}],"sizeInsertions":1625,"sizeDeletions":-12},{"number":"4","revision":"fb7d3935d7e1dac9957a9c3d19f0fb3bba4103ee","parents":["1c405e141d0362c6d805ec47b6125696c2115fc1"],"ref":"refs/changes/44/2644/4","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1506401786,"author":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1506401827,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"SUBM","value":"1","grantedOn":1506437639,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1506410145,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1506410145,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}}],"comments":[{"file":"docs/index.md","line":4470,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Perhaps you meant \"different node *from* the instance(s) ...\""},{"file":"docs/index.md","line":4474,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"again s/as/from/ I\u0027d think"},{"file":"docs/index.md","line":4483,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"s/as/from/?"},{"file":"docs/index.md","line":4486,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"or maybe you mean to? I don\u0027t know..."},{"file":"docs/index.md","line":4517,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Might be worth mentioning that in extreme/pathological cases w/o `strict` *all* your instances might end up on the same CN."},{"file":"docs/index.md","line":4517,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Thanks for the above notes. I\u0027ll update in PUBAPI-1444.\n\nI don\u0027t want to bother with this clarification in the locality hints section. This section was just moved down, and locality hints are deprecated now anyway. As well, I\u0027m happy leaving that inference up to the user."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":137,"deletions":-30},{"file":"lib/app.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/errors.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/machines.js","type":"MODIFIED","insertions":47,"deletions":-5},{"file":"lib/triton-affinity.js","type":"ADDED","insertions":1064,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":4,"deletions":-2},{"file":"test/affinity-unit.test.js","type":"ADDED","insertions":309,"deletions":0},{"file":"test/machines.71.test.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/machines.test.js","type":"MODIFIED","insertions":10,"deletions":0},{"file":"test/machines/affinity.js","type":"ADDED","insertions":184,"deletions":0},{"file":"tools/jsl.node.conf","type":"MODIFIED","insertions":1,"deletions":0}],"sizeInsertions":1762,"sizeDeletions":-42}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}]}