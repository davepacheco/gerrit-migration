{"project":"joyent/sdcadm","branch":"master","id":"Ifb30abdfa3ac03f23ec268cd694b8da8dc44a17b","number":"1665","subject":"TOOLS-1715 sdcadm: reprovisionRemote can timeout too easily","owner":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"url":"https://cr.joyent.us/1665","commitMessage":"TOOLS-1715 sdcadm: reprovisionRemote can timeout too easily\n","createdOn":1489592134,"lastUpdated":1491471577,"open":false,"status":"MERGED","comments":[{"timestamp":1489592134,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 1."},{"timestamp":1489592139,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit 3e121aa391080f6238f4e65dff02861f8929c151\n    \n    TOOLS-1715 sdcadm: reprovisionRemote can timeout too easily"},{"timestamp":1489592171,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1490050374,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1490209371,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 2."},{"timestamp":1490209378,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit 57923a3fddb0621894b33cd0b29d8792fb3679df\n    \n    TOOLS-1715 sdcadm: reprovisionRemote can timeout too easily"},{"timestamp":1490209409,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1490209465,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 2:\n\n(1 comment)\n\nMade some more changes, since I plan to also add support for the JSON option to that function but, other than that, done as you suggested."},{"timestamp":1490216676,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 2:\n\n(6 comments)"},{"timestamp":1490264202,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 3."},{"timestamp":1490264209,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 3:\n\nNew commits:\n    \n    commit 1dc2a62b832d12b14df9e51fdee57d2b6e2e6012\n    \n    TOOLS-1715 sdcadm: reprovisionRemote can timeout too easily"},{"timestamp":1490264220,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 2:\n\n(6 comments)\n\nAll the suggested changes done"},{"timestamp":1490264244,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1491335236,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 3:\n\n(2 comments)"},{"timestamp":1491392269,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 4."},{"timestamp":1491392275,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 4:\n\nNew commits:\n    \n    commit 4d152df12cf22543781d55acb3ddce94257c9e46\n    \n    TOOLS-1715 sdcadm: reprovisionRemote can timeout too easily"},{"timestamp":1491392300,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1491393058,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 5."},{"timestamp":1491393089,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1491393115,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 4:\n\n(2 comments)\n\nDone with the suggested change"},{"timestamp":1491393153,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 6: Patch Set 5 was rebased"},{"timestamp":1491414797,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 6: Code-Review+1 Integration-Approval+1\n\n(1 comment)"},{"timestamp":1491471577,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Pedro Palazón Candel"}],"currentPatchSet":{"number":"6","revision":"4510d0799c004d90119b2454644382846b648064","parents":["72d490b9e92a363e0c18953d1b8b6c16eb0800fe"],"ref":"refs/changes/65/1665/6","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1491393153,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"NO_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1491393089,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1491414797,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1491414797,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1491471577,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/procedures/shared.js","type":"MODIFIED","insertions":27,"deletions":-44},{"file":"lib/ur.js","type":"MODIFIED","insertions":10,"deletions":-5}],"sizeInsertions":37,"sizeDeletions":-49},"patchSets":[{"number":"1","revision":"8419e56968ce6b6b90fa671b6527b72d0cb1e483","parents":["58d4acb4ed7381b220f11836e13ac5e883f41196"],"ref":"refs/changes/65/1665/1","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1489592134,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1489592171,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/procedures/shared.js","line":892,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"How about use `ur.exec()` from lib/ur.js?\n\nMight need to add \u0027opts.env\u0027 support to that function, but that would be fine."},{"file":"lib/procedures/shared.js","line":892,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Sure"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/procedures/shared.js","type":"MODIFIED","insertions":99,"deletions":-40}],"sizeInsertions":99,"sizeDeletions":-40},{"number":"2","revision":"0ba0221d3e9bf77e7f319c37ef36aea40405f5f8","parents":["58d4acb4ed7381b220f11836e13ac5e883f41196"],"ref":"refs/changes/65/1665/2","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1490209371,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1490209409,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/procedures/shared.js","line":811,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"\u0027Reprovisioning VM %s on server %s\u0027"},{"file":"lib/procedures/shared.js","line":811,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/procedures/shared.js","line":825,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"should be execTimeout\n\nLet\u0027s bump to 5 minutes. I don\u0027t want to go another round on the rare update."},{"file":"lib/procedures/shared.js","line":825,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/procedures/shared.js","line":839,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"change this to: `execResult: result`."},{"file":"lib/procedures/shared.js","line":839,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/ur.js","line":92,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"second arg: `, \u0027urClient\u0027)`"},{"file":"lib/ur.js","line":92,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/ur.js","line":98,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"should be \u0027env\u0027 right?"},{"file":"lib/ur.js","line":98,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Indeed!"},{"file":"lib/ur.js","line":108,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Drop this comment."},{"file":"lib/ur.js","line":108,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/procedures/shared.js","type":"MODIFIED","insertions":30,"deletions":-41},{"file":"lib/ur.js","type":"MODIFIED","insertions":12,"deletions":-5}],"sizeInsertions":42,"sizeDeletions":-46},{"number":"3","revision":"70a69c1728466d7827b8bafef2ef09e7b6d1679e","parents":["58d4acb4ed7381b220f11836e13ac5e883f41196"],"ref":"refs/changes/65/1665/3","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1490264202,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1490264244,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/procedures/shared.js","line":812,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"No point in this log.trace. It doesn\u0027t provide info, and the \u0027progress\u0027 call will result in a log record."},{"file":"lib/procedures/shared.js","line":812,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done. As you can see, it was already there. Indeed, there are a bunch of these trace calls through this file. Maybe a separate issue to remove all of them?"},{"file":"lib/ur.js","line":107,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"This change is interesting. I think it is correct. However, how did callers of \u0027ur.exec\u0027 work with this before? E.g.: https://github.com/joyent/sdcadm/blob/77117e315a7a80aed8ceb8f7376b1d4afb300e94/lib/sdcadm.js#L5686    How did that ever work?\n\nThat is the only case in sdcadm.git of using ur.exec and using the result."},{"file":"lib/ur.js","line":107,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Mostly b/c that code is calling the Native UrClient\u0027s exec method https://github.com/joyent/node-urclient/blob/master/lib/ur_client.js#L600-L601 directly and not using this function."},{"file":"lib/ur.js","line":107,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Ah, I see. Thanks."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/procedures/shared.js","type":"MODIFIED","insertions":28,"deletions":-43},{"file":"lib/ur.js","type":"MODIFIED","insertions":10,"deletions":-5}],"sizeInsertions":38,"sizeDeletions":-48},{"number":"4","revision":"46e17b0ae013b777ca05efa9bab5d210d5d8c5eb","parents":["ec79905fb214a3430f213b9e1c2725c697781477"],"ref":"refs/changes/65/1665/4","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1491392269,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1491392300,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/procedures/shared.js","type":"MODIFIED","insertions":27,"deletions":-44},{"file":"lib/ur.js","type":"MODIFIED","insertions":10,"deletions":-5}],"sizeInsertions":37,"sizeDeletions":-49},{"number":"5","revision":"fb30abdfa3ac03f23ec268cd694b8da8dc44a17b","parents":["ec79905fb214a3430f213b9e1c2725c697781477"],"ref":"refs/changes/65/1665/5","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1491393058,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1491393089,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/cli/do_create.js","type":"MODIFIED","insertions":10,"deletions":0},{"file":"lib/cli/do_update_other.js","type":"MODIFIED","insertions":10,"deletions":-7},{"file":"lib/procedures/shared.js","type":"MODIFIED","insertions":27,"deletions":-44},{"file":"lib/sdcadm.js","type":"MODIFIED","insertions":109,"deletions":-59},{"file":"lib/steps/agent-services.js","type":"MODIFIED","insertions":34,"deletions":-12},{"file":"lib/ur.js","type":"MODIFIED","insertions":10,"deletions":-5}],"sizeInsertions":200,"sizeDeletions":-127},{"number":"6","revision":"4510d0799c004d90119b2454644382846b648064","parents":["72d490b9e92a363e0c18953d1b8b6c16eb0800fe"],"ref":"refs/changes/65/1665/6","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1491393153,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"NO_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1491393089,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1491414797,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1491414797,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1491471577,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/procedures/shared.js","type":"MODIFIED","insertions":27,"deletions":-44},{"file":"lib/ur.js","type":"MODIFIED","insertions":10,"deletions":-5}],"sizeInsertions":37,"sizeDeletions":-49}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}]}