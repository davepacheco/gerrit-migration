commit d97c115bae4bd79610bc08e0538c9b96c2b30e75 (refs/changes/41/2441/3)
Author: Brittany Wald <brittany.wald@joyent.com>
Date:   2017-08-31T01:40:31+00:00 (2 years, 1 month ago)
    
    MANTA-3384 muskie docs for mpu_enable in deploys

diff --git a/README.md b/README.md
index 50d8ba6..715314c 100644
--- a/README.md
+++ b/README.md
@@ -137,9 +137,24 @@ check first before reporting problems:
    you may have an incorrect muskie configuration. Check that the `MUSKIE_ID`,
    `MUSKIE_KEY` and `MUSKIE_IV` attributes in your config.json match the environment
    variables set for the user running the tests (`$MANTA_USER`).
-5. If the "rmdir mpuRoot" and "ls top" tests fail, MPU may not be enabled. If
-   you recently upgraded from a pre-MPU muskie version, ensure the line
-   '"enableMPU": true' is present in your config.json.
+5. If the "rmdir mpuRoot" and "ls top" tests fail, MPU may not be enabled. MPU GC
+   is not supported, so if MPU is left enabled, records may accumulate in metadata
+   shards.  For this reason, *non-developers should not run this code*. However, if
+   you are a developer, and you recently upgraded from a pre-MPU muskie version,
+   go ahead and ensure the line '"enableMPU": true' is present in your config.json.
+   If you are running tests against an image whose configuration is managed by SAPI,
+   which includes any zones deployed using `manta-adm`, you will need to set this
+   variable using sapiadm:
+
+   Set the "MPU_ENABLE" property on the "manta" SAPI application:
+   		$ sapiadm update (sdc-sapi /services?name=webapi | json -Ha uuid) metadata."MPU_ENABLE"=true
+
+   Then restart your muskie instances:
+   		$ manta-oneach -s webapi 'svcadm restart "*muskie-*"' 
+
+   Wait for the muskies to come back online, or manually check the state of the
+   `/opt/smartdc/muskie/etc/config.json` (that it contains `"enableMPU": true`) in
+   each of your webapi zones.  Once that is done, you can resume normal operations.
 
 If you're changing anything about the way muskie is deployed, configured, or
 started, you should definitely test creating a muskie image and deploying that
