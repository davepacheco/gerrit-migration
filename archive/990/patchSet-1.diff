From 3b18325fcdb0eb9ad751f6e6cfe3ff03d191c837 Mon Sep 17 00:00:00 2001
From: Chris Burroughs <chris.burroughs@joyent.com>
Date: Wed, 23 Nov 2016 15:46:40 -0500
Subject: [PATCH] ./bin/triton fwrule create -D "ssh" "FROM any TO all vms
 ALLOW tcp PORT 22" Created firewall rule fc030013-ecea-4b1f-8065-086e9003408e

---
 lib/do_fwrule/do_create.js | 22 ++++++++++++++--------
 1 file changed, 14 insertions(+), 8 deletions(-)

diff --git a/lib/do_fwrule/do_create.js b/lib/do_fwrule/do_create.js
index d1ec831..2de8b87 100644
--- a/lib/do_fwrule/do_create.js
+++ b/lib/do_fwrule/do_create.js
@@ -45,15 +45,21 @@ function do_create(subcmd, opts, args, cb) {
         createOpts.description = opts.description;
     }
 
-    this.top.tritonapi.cloudapi.createFirewallRule(createOpts,
-            function (err, fwrule) {
-        if (err) {
-            cb(err);
-            return;
+    var tritonapi = this.top.tritonapi;
+    common.cliSetupTritonApi({cli: this.top}, function onSetup(setupErr) {
+        if (setupErr) {
+            cb(setupErr);
         }
-        console.log('Created firewall rule %s%s', fwrule.id,
-            (!fwrule.enabled ? ' (disabled)' : ''));
-        cb();
+        tritonapi.cloudapi.createFirewallRule(
+            createOpts, function (err, fwrule) {
+                if (err) {
+                    cb(err);
+                    return;
+                }
+                console.log('Created firewall rule %s%s', fwrule.id,
+                            (!fwrule.enabled ? ' (disabled)' : ''));
+                cb();
+            });
     });
 }
 
-- 
2.21.0

