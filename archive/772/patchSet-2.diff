From 9140c78c483bcf1349fc58012a0b9fec9aeb541a Mon Sep 17 00:00:00 2001
From: Trent Mick <trentm@gmail.com>
Date: Wed, 26 Oct 2016 10:29:10 -0700
Subject: [PATCH] DOCKER-710 Need supported setup process/script for Windows
 docker clients to connect to Triton

---
 tools/sdc-docker-setup.sh | 15 +++++++++++++--
 1 file changed, 13 insertions(+), 2 deletions(-)

diff --git a/tools/sdc-docker-setup.sh b/tools/sdc-docker-setup.sh
index 032ab69..406a557 100755
--- a/tools/sdc-docker-setup.sh
+++ b/tools/sdc-docker-setup.sh
@@ -6,7 +6,7 @@
 #
 
 #
-# Copyright (c) 2015, Joyent, Inc.
+# Copyright 2016 Joyent, Inc.
 #
 
 #
@@ -509,7 +509,18 @@ caPath=$certDir/ca.pem
 
 mkdir -p $(dirname $keyPath)
 openssl rsa -in $sshPrivKeyPath -outform pem >$keyPath 2>/dev/null
-openssl req -new -key $keyPath -out $csrPath -subj "/CN=$account" >/dev/null 2>/dev/null
+
+certSubject=
+if [[ -n "$(which uname 2>/dev/null)" && "$(uname)" == MINGW* ]]; then
+    # On the mingw32 shell on Windows we need to work around mingw32 converting
+    # args that look like Windows paths.
+    # See <http://stackoverflow.com/a/31990313> for details.
+    certSubject="//CN=$account"
+else
+    certSubject="/CN=$account"
+fi
+openssl req -new -key $keyPath -out $csrPath -subj "$certSubject" >/dev/null 2>/dev/null
+
 # TODO: expiry?
 openssl x509 -req -days 365 -in $csrPath -signkey $keyPath -out $certPath >/dev/null 2>/dev/null
 rm $csrPath    # The signing request has been used - remove it.
-- 
2.21.0

