{"project":"joyent/smartos-live","branch":"master","id":"Ia149cabe05375fbd71328c043cbd28f2402fce51","number":"471","subject":"FWAPI-257 Upgrading a CN set up before June 2013 broken by FWAPI-239 Reviewed by: Joshua M. Clulow \u003cjmc@joyent.com\u003e Approved by: Alex Wilson \u003calex.wilson@joyent.com\u003e","owner":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"url":"https://cr.joyent.us/471","commitMessage":"FWAPI-257 Upgrading a CN set up before June 2013 broken by FWAPI-239\nReviewed by: Joshua M. Clulow \u003cjmc@joyent.com\u003e\nApproved by: Alex Wilson \u003calex.wilson@joyent.com\u003e\n","createdOn":1473955520,"lastUpdated":1473972530,"open":false,"status":"MERGED","comments":[{"timestamp":1473955520,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 1."},{"timestamp":1473955745,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 2."},{"timestamp":1473958690,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1473962726,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Patch Set 2:\n\n(3 comments)"},{"timestamp":1473963201,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 3."},{"timestamp":1473963239,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1473963421,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 2:\n\n(3 comments)\n\nI retested with the new changes. I removed the /var/fw/ directory, and then tried several different fwadm commands to try acquiring a lock on the lock file."},{"timestamp":1473966118,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1473972447,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 3: Integration-Approval+1"},{"timestamp":1473972475,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 4: Commit message was updated."},{"timestamp":1473972530,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Cody Peter Mello"}],"currentPatchSet":{"number":"4","revision":"2c83e3c2223d285feedb0600d9d74519ff72a55f","parents":["4a7c365fb02ca6885609ccf1e57d22370958e8c0"],"ref":"refs/changes/71/471/4","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1473972475,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1473963239,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1473966118,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1473972447,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"SUBM","value":"1","grantedOn":1473972530,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"src/fw/lib/locker.js","type":"MODIFIED","insertions":33,"deletions":-2}],"sizeInsertions":33,"sizeDeletions":-2},"patchSets":[{"number":"1","revision":"e28f1bbf654cd0a315b027324b6799fc454ab18f","parents":["4a7c365fb02ca6885609ccf1e57d22370958e8c0"],"ref":"refs/changes/71/471/1","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1473955520,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/fw/lib/locker.js","type":"MODIFIED","insertions":31,"deletions":-1}],"sizeInsertions":31,"sizeDeletions":-1},{"number":"2","revision":"5754713d209491301bb22d1b82cd0aedd96a3a97","parents":["4a7c365fb02ca6885609ccf1e57d22370958e8c0"],"ref":"refs/changes/71/471/2","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1473955745,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1473958690,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"src/fw/lib/locker.js","line":36,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"\"FW_LOCK_FILE\" should probably be constructed from \"FW_DIR_PATH\" so that it\u0027s clear they must be in sync."},{"file":"src/fw/lib/locker.js","line":36,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Done"},{"file":"src/fw/lib/locker.js","line":39,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Make this...\n\n    var FW_MODE \u003d parseInt(\u00270755\u0027, 8);\n\n... and ditch the JSL tags.\n\nAlso, should the lockfile really be executable?"},{"file":"src/fw/lib/locker.js","line":39,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Done"},{"file":"src/fw/lib/locker.js","line":46,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Just the one asterisk, please."},{"file":"src/fw/lib/locker.js","line":46,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/fw/lib/locker.js","type":"MODIFIED","insertions":34,"deletions":-1}],"sizeInsertions":34,"sizeDeletions":-1},{"number":"3","revision":"a149cabe05375fbd71328c043cbd28f2402fce51","parents":["4a7c365fb02ca6885609ccf1e57d22370958e8c0"],"ref":"refs/changes/71/471/3","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1473963201,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1473972447,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1473966118,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1473963239,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/fw/lib/locker.js","type":"MODIFIED","insertions":33,"deletions":-2}],"sizeInsertions":33,"sizeDeletions":-2},{"number":"4","revision":"2c83e3c2223d285feedb0600d9d74519ff72a55f","parents":["4a7c365fb02ca6885609ccf1e57d22370958e8c0"],"ref":"refs/changes/71/471/4","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1473972475,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"SUBM","value":"1","grantedOn":1473972530,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1473972447,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1473966118,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1473963239,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"src/fw/lib/locker.js","type":"MODIFIED","insertions":33,"deletions":-2}],"sizeInsertions":33,"sizeDeletions":-2}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}]}