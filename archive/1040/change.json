{"project":"joyent/smartos-live","branch":"master","id":"I859a75f1950ca9d463ec87cb5e35f8a2ec6df74f","number":"1040","subject":"OS-5823 \u0027imgadm install\u0027 of a type\u003ddocker image should work Reviewed by: Todd Whiteman \u003ctodd.whiteman@joyent.com\u003e Approved by: Todd Whiteman \u003ctodd.whiteman@joyent.com\u003e","owner":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"url":"https://cr.joyent.us/1040","commitMessage":"OS-5823 \u0027imgadm install\u0027 of a type\u003ddocker image should work\nReviewed by: Todd Whiteman \u003ctodd.whiteman@joyent.com\u003e\nApproved by: Todd Whiteman \u003ctodd.whiteman@joyent.com\u003e\n","createdOn":1480633015,"lastUpdated":1480635222,"open":false,"status":"MERGED","comments":[{"timestamp":1480633015,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Uploaded patch set 1."},{"timestamp":1480633016,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit ecc4f409adb77a8a0f0ce6b81ea23313a88a59e0\n    \n    fix imgadm install for docker images"},{"timestamp":1480633058,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1480633500,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Patch Set 1: Code-Review+1 Integration-Approval+1\n\nLGTM - BTW, what\u0027s the use case for installing a docker image manually?"},{"timestamp":1480635149,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 1:\n\nFor the record, tests still pass:\n\n$ ./bin/stage-test-img nightly-2\n# Headnode is nightly-2 (172.26.2.4).\n\n--\n# Start img test suite.\n# Setup a clean output dir (/var/tmp/imgadmtest).\n\n\nbasics.test.js\n✔ imgadm\n✔ imgadm -E\n✔ imgadm --version\n✔ imgadm --help\n✔ imgadm -h\n✔ imgadm help\n✔ imgadm -v list  # bunyan trace log on stderr\n✔ IMGADM_LOG_LEVEL\u003dtrace imgadm   # bunyan \"src\" log on stderr\n✔ imgadm -E -vv   # structured error last line\n✔ imgadm help sources\n✔ `imgadm info BOGUS_UUID` ImageNotInstalled error, rv 3\n\ncreate.test.js\n✔ setup: clean WRKDIR (/var/tmp/img-test-create)\n✔ custom image (compression\u003dnone)\n✔ custom image (incremental, compression\u003dnone)\n✔ custom image (compression\u003dgzip)\n✔ custom image (incremental, compression\u003dgzip)\n✔ custom image (incremental, compression\u003dbzip2)\n✔ custom image (compression\u003dxz)\n✔ custom image (incremental, compression\u003dxz)\n\ndocker.test.js\n✔ setup: clean WRKDIR (/var/tmp/img-test-docker)\n✔ setup: ensure docker hub source\n✔ setup: get test image id\n✔ precondition1: remove image UUID-OF:busybox:1.24.0\n✔ imgadm import busybox:1.24.0\n✔ imgadm ancestry UUID-OF:busybox:1.24.0\n✔ imgadm ancestry -j UUID-OF:busybox:1.24.0\n✔ imgadm list type\u003ddocker\n✔ imgadm list --docker\n✔ cleanup: remove image UUID-OF:busybox:1.24.0\n\ndsapi.test.js\n✔ imgadm sources -d images.jo\n✔ imgadm sources -a DSAPI\n✔ imgadm avail\n✔ setup: remove image 0764d78e-3472-11e5-8949-4f31abea4e05\n✔ imgadm import 0764d78e-3472-11e5-8949-4f31abea4e05\n✔ cleanup: remove image 0764d78e-3472-11e5-8949-4f31abea4e05\n✔ imgadm sources -d DSAPI\n✔ imgadm sources -a images.jo\n\nIMG.test.js\n✔ setup: get existing UUID\n✔ require(\"/usr/img/lib/IMG\")\n✔ IMG.*\n✔ IMG.quickGetImage\n✔ IMG.quickGetImage err\n\nimport.test.js\n✔ setup: clean WRKDIR (/var/tmp/img-test-import)\n✔ setup: ensure images.joyent.com source\n✔ setup: get test image in local SDC IMGAPI (if available)\n✔ setup: CACHEDIR (/var/tmp/img-test-cache)\n✔ setup: cache test image manifest\n✔ setup: cache test image file\n✔ setup1: remove image 0764d78e-3472-11e5-8949-4f31abea4e05\n✔ imgadm import 0764d78e-3472-11e5-8949-4f31abea4e05\n✔ imgadm ancestry 0764d78e-3472-11e5-8949-4f31abea4e05\n✔ imgadm ancestry -j 0764d78e-3472-11e5-8949-4f31abea4e05\n✔ setup2: remove image 0764d78e-3472-11e5-8949-4f31abea4e05\n✔ imgadm install ... 0764d78e-3472-11e5-8949-4f31abea4e05\n✔ setup3: remove image 0764d78e-3472-11e5-8949-4f31abea4e05\n✔ concurrent: imgadm install ... 0764d78e-3472-11e5-8949-4f31abea4e05\n✔ setup4: remove image 0764d78e-3472-11e5-8949-4f31abea4e05\n✔ concurrent: imgadm import 0764d78e-3472-11e5-8949-4f31abea4e05\n✔ setup5: remove image 0764d78e-3472-11e5-8949-4f31abea4e05\n✔ pre-downloaded file; imgadm import 0764d78e-3472-11e5-8949-4f31abea4e05\n✔ setup6: remove image 0764d78e-3472-11e5-8949-4f31abea4e05\n✔ pre-downloaded file (bad size); imgadm import 0764d78e-3472-11e5-8949-4f31abea4e05\n✔ setup7: remove image 0764d78e-3472-11e5-8949-4f31abea4e05\n✔ pre-downloaded file (bad checksum); imgadm import 0764d78e-3472-11e5-8949-4f31abea4e05\n\nupdate.test.js\n✔ imgadm update\n\nOK: 164 assertions (1350550ms)\n./bin/stage-test-img finished in 1351 seconds."},{"timestamp":1480635173,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Uploaded patch set 2: Commit message was updated."},{"timestamp":1480635222,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Trent Mick"}],"currentPatchSet":{"number":"2","revision":"859a75f1950ca9d463ec87cb5e35f8a2ec6df74f","parents":["b18efbec2db5be64e27d656ea26994ce3575641d"],"ref":"refs/changes/40/1040/2","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1480635173,"author":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1480633058,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1480633500,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1480633500,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}},{"type":"SUBM","value":"1","grantedOn":1480635222,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"src/img/CHANGES.md","type":"MODIFIED","insertions":4,"deletions":0},{"file":"src/img/lib/imgadm.js","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"src/img/package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":5,"sizeDeletions":-2},"patchSets":[{"number":"1","revision":"dfa4030ef61b5d8f8978d91a7a4d8eee53628044","parents":["b18efbec2db5be64e27d656ea26994ce3575641d"],"ref":"refs/changes/40/1040/1","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1480633015,"author":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1480633058,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1480633500,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1480633500,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/img/CHANGES.md","type":"MODIFIED","insertions":4,"deletions":0},{"file":"src/img/lib/imgadm.js","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"src/img/package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":5,"sizeDeletions":-2},{"number":"2","revision":"859a75f1950ca9d463ec87cb5e35f8a2ec6df74f","parents":["b18efbec2db5be64e27d656ea26994ce3575641d"],"ref":"refs/changes/40/1040/2","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1480635173,"author":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1480633058,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"SUBM","value":"1","grantedOn":1480635222,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1480633500,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1480633500,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"src/img/CHANGES.md","type":"MODIFIED","insertions":4,"deletions":0},{"file":"src/img/lib/imgadm.js","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"src/img/package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":5,"sizeDeletions":-2}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}]}