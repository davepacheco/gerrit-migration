{"project":"joyent/illumos-joyent","branch":"master","id":"I7493a728e0445132992f3bb1bed7287f32de2ad2","number":"3542","subject":"OS-6685 bhyve ppt should facilitate PCI access Reviewed by: John Levon \u003cjohn.levon@joyent.com\u003e Reviewed by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e Approved by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e","owner":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"url":"https://cr.joyent.us/3542","commitMessage":"OS-6685 bhyve ppt should facilitate PCI access\nReviewed by: John Levon \u003cjohn.levon@joyent.com\u003e\nReviewed by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e\nApproved by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e\n","createdOn":1520287790,"lastUpdated":1520368349,"open":false,"status":"MERGED","comments":[{"timestamp":1520287790,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 1."},{"timestamp":1520288916,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1520289367,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1520290584,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 2."},{"timestamp":1520290760,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 2: Code-Review+1"},{"timestamp":1520294209,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 2:\n\n(9 comments)"},{"timestamp":1520315369,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 3."},{"timestamp":1520315532,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 3:\n\n(7 comments)\n\nI performed the restructuring of how/when the ppt file descriptor is translated into a ppt-internal resource handle.  Some additional clean-up was performed as well, including moving the glue functions into ppt.c (completing its transition to an illumos-specific implementation).\n\nIt still appears to build clean on DEBUG, but I need to retest with the rest of the bhyve patches to make sure that ppt wasn\u0027t seriously broken by this."},{"timestamp":1520316377,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 4."},{"timestamp":1520317457,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 5."},{"timestamp":1520328203,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 5:\n\n(3 comments)"},{"timestamp":1520340761,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 2:\n\nI think the latest changes look fine and I\u0027ll +1 after you fix the final two issues John found in ppt.c."},{"timestamp":1520350115,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 6."},{"timestamp":1520350379,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 5:\n\n(2 comments)"},{"timestamp":1520350504,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 6: Code-Review+1"},{"timestamp":1520351321,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 6: Code-Review+1"},{"timestamp":1520364200,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 7."},{"timestamp":1520364272,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 7:\n\nA few more dev-related fixes to make this happy in a zone."},{"timestamp":1520365088,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 7: Code-Review+1"},{"timestamp":1520365847,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 7:\n\nWith the changes, this is working happily with a ppt device painted into a zone. (Tested specifically with an ixgbe card exposed to a Linux guest)"},{"timestamp":1520366213,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 7: Integration-Approval+1"},{"timestamp":1520367409,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 7:\n\nThe full DEBUG build ran clean as well."},{"timestamp":1520367660,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 8: Patch Set 7 was rebased."},{"timestamp":1520367889,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 9: Commit message was updated."},{"timestamp":1520367928,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 9: Integration-Approval-1\n\nHeld until jlevon has a chance to sign off on it again."},{"timestamp":1520368159,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 9: Code-Review+1"},{"timestamp":1520368329,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 9: -Integration-Approval"},{"timestamp":1520368349,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Patrick Mooney"}],"currentPatchSet":{"number":"9","revision":"7493a728e0445132992f3bb1bed7287f32de2ad2","parents":["05b0c46baa0f5ab9feca1ad696eefd2a66425b04"],"ref":"refs/changes/42/3542/9","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1520367889,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1520365088,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1520366213,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1520368159,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}},{"type":"SUBM","value":"1","grantedOn":1520368349,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/cmd/bhyve/Makefile.com","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/cmd/bhyve/pci_passthru.c","type":"MODIFIED","insertions":198,"deletions":-442},{"file":"usr/src/cmd/bhyvectl/bhyvectl.c","type":"MODIFIED","insertions":8,"deletions":0},{"file":"usr/src/cmd/devfsadm/i386/misc_link_i386.c","type":"MODIFIED","insertions":6,"deletions":0},{"file":"usr/src/compat/freebsd/dev/pci/pcivar.h","type":"MODIFIED","insertions":1,"deletions":-14},{"file":"usr/src/lib/libvmmapi/common/vmmapi.c","type":"MODIFIED","insertions":79,"deletions":-1},{"file":"usr/src/lib/libvmmapi/common/vmmapi.h","type":"MODIFIED","insertions":13,"deletions":0},{"file":"usr/src/uts/i86pc/Makefile.files","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/i86pc/io/vmm/io/ppt.c","type":"MODIFIED","insertions":885,"deletions":-533},{"file":"usr/src/uts/i86pc/io/vmm/io/ppt.h","type":"MODIFIED","insertions":11,"deletions":-18},{"file":"usr/src/uts/i86pc/io/vmm/io/ppt_sol_glue.c","type":"DELETED","insertions":0,"deletions":-177},{"file":"usr/src/uts/i86pc/io/vmm/vmm.c","type":"MODIFIED","insertions":26,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/vmm_sol_dev.c","type":"MODIFIED","insertions":17,"deletions":-15},{"file":"usr/src/uts/i86pc/ppt/Makefile","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/i86pc/sys/ppt_dev.h","type":"ADDED","insertions":56,"deletions":0},{"file":"usr/src/uts/i86pc/sys/vmm.h","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/uts/i86pc/sys/vmm_dev.h","type":"MODIFIED","insertions":36,"deletions":0},{"file":"usr/src/uts/intel/ia32/ml/modstubs.s","type":"MODIFIED","insertions":0,"deletions":-1}],"sizeInsertions":1344,"sizeDeletions":-1204},"patchSets":[{"number":"1","revision":"5416e9bce5ee0ca7f8d9ceab2fd4ca342ffda828","parents":["4854aef507655bd094943da0db30a1a493c4c97a"],"ref":"refs/changes/42/3542/1","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1520287790,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/uts/i86pc/io/vmm/vmm_sol_dev.c","line":644,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"I\u0027m still trying to understand why it is ok to releasef here (and in similiar situations below) when we have an error, but not on previous errors."},{"file":"usr/src/uts/i86pc/io/vmm/vmm_sol_dev.c","line":644,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"I\u0027ll write a better comment for vmmdev_pptfd, explaining the relation here."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":13,"deletions":0},{"file":"usr/src/cmd/bhyve/Makefile.com","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/cmd/bhyve/pci_passthru.c","type":"MODIFIED","insertions":185,"deletions":-432},{"file":"usr/src/cmd/bhyvectl/bhyvectl.c","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/cmd/devfsadm/i386/misc_link_i386.c","type":"MODIFIED","insertions":6,"deletions":0},{"file":"usr/src/compat/freebsd/dev/pci/pcivar.h","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/lib/libvmmapi/common/vmmapi.c","type":"MODIFIED","insertions":79,"deletions":-1},{"file":"usr/src/lib/libvmmapi/common/vmmapi.h","type":"MODIFIED","insertions":13,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/io/ppt.c","type":"MODIFIED","insertions":599,"deletions":-438},{"file":"usr/src/uts/i86pc/io/vmm/io/ppt.h","type":"MODIFIED","insertions":11,"deletions":-18},{"file":"usr/src/uts/i86pc/io/vmm/io/ppt_sol_glue.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/i86pc/io/vmm/vmm.c","type":"MODIFIED","insertions":26,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/vmm_sol_dev.c","type":"MODIFIED","insertions":67,"deletions":-14},{"file":"usr/src/uts/i86pc/ppt/Makefile","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/i86pc/sys/ppt_dev.h","type":"ADDED","insertions":56,"deletions":0},{"file":"usr/src/uts/i86pc/sys/vmm.h","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/i86pc/sys/vmm_dev.h","type":"MODIFIED","insertions":36,"deletions":0},{"file":"usr/src/uts/intel/ia32/ml/modstubs.s","type":"MODIFIED","insertions":0,"deletions":-1}],"sizeInsertions":1087,"sizeDeletions":-911},{"number":"2","revision":"3fc365af5aeab68c17e066eb045bbec8ea2ca6ef","parents":["4854aef507655bd094943da0db30a1a493c4c97a"],"ref":"refs/changes/42/3542/2","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1520290584,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1520290760,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"comments":[{"file":"usr/src/cmd/bhyve/pci_passthru.c","line":172,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"nit: const char * ?"},{"file":"usr/src/cmd/bhyve/pci_passthru.c","line":172,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"I loves me some const.  Fixed"},{"file":"usr/src/cmd/bhyve/pci_passthru.c","line":659,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"An fd isn\u0027t really a PCI anything? Better as \"passthru fd\" or something?"},{"file":"usr/src/cmd/bhyve/pci_passthru.c","line":659,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"A fair criticism, although even with a reworded message, the fd alone isn\u0027t very useful since we\u0027ll bail immediately.  I\u0027d like to follow up on better error messages in a subsequent ticket."},{"file":"usr/src/cmd/bhyve/pci_passthru.c","line":659,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Fine by me."},{"file":"usr/src/cmd/bhyve/pci_passthru.c","line":664,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"ditto"},{"file":"usr/src/cmd/bhyve/pci_passthru.c","line":700,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"ditto. Perhaps later on a better way to given the name underlying the relevant fd?"},{"file":"usr/src/cmd/bhyvectl/bhyvectl.c","line":1906,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"We take this option but silently do nothing?"},{"file":"usr/src/cmd/bhyvectl/bhyvectl.c","line":1906,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Our ppt driver changed the model from a persistent assignment (similar to the memory segments) to active fd handles.  This makes the unassignment pointless from bhyvectl, but you\u0027re right, it shouldn\u0027t be present in the args."},{"file":"usr/src/compat/freebsd/dev/pci/pcivar.h","line":47,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Nit: seems odd to change a compat header file to use our type?"},{"file":"usr/src/compat/freebsd/dev/pci/pcivar.h","line":47,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Moved all this glue into ppt.c and cleaned up these definitions."},{"file":"usr/src/uts/i86pc/io/vmm/io/ppt.c","line":583,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"ASSERT MUTEX_HELD ?"},{"file":"usr/src/uts/i86pc/io/vmm/io/ppt.c","line":583,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Done"},{"file":"usr/src/uts/i86pc/io/vmm/io/ppt.c","line":820,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"why no matching pci_config_teardown() ?"},{"file":"usr/src/uts/i86pc/io/vmm/io/ppt.c","line":820,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Oversight.  Fixed."},{"file":"usr/src/uts/i86pc/io/vmm/vmm_sol_dev.c","line":455,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Given that all these uses immediately releasef() after doing the ppt call, isn\u0027t it simpler to pass the fd over to ppt and let *it* handle the lookup? That way the dev_t thing stays private to ppt. Or do the lifetimes get more complicated later?"},{"file":"usr/src/uts/i86pc/io/vmm/vmm_sol_dev.c","line":455,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Sound OK to me.  I\u0027ll shuffle that logic over."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":13,"deletions":0},{"file":"usr/src/cmd/bhyve/Makefile.com","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/cmd/bhyve/pci_passthru.c","type":"MODIFIED","insertions":185,"deletions":-432},{"file":"usr/src/cmd/bhyvectl/bhyvectl.c","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/cmd/devfsadm/i386/misc_link_i386.c","type":"MODIFIED","insertions":6,"deletions":0},{"file":"usr/src/compat/freebsd/dev/pci/pcivar.h","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/lib/libvmmapi/common/vmmapi.c","type":"MODIFIED","insertions":79,"deletions":-1},{"file":"usr/src/lib/libvmmapi/common/vmmapi.h","type":"MODIFIED","insertions":13,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/io/ppt.c","type":"MODIFIED","insertions":599,"deletions":-438},{"file":"usr/src/uts/i86pc/io/vmm/io/ppt.h","type":"MODIFIED","insertions":11,"deletions":-18},{"file":"usr/src/uts/i86pc/io/vmm/io/ppt_sol_glue.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/i86pc/io/vmm/vmm.c","type":"MODIFIED","insertions":26,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/vmm_sol_dev.c","type":"MODIFIED","insertions":73,"deletions":-14},{"file":"usr/src/uts/i86pc/ppt/Makefile","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/i86pc/sys/ppt_dev.h","type":"ADDED","insertions":56,"deletions":0},{"file":"usr/src/uts/i86pc/sys/vmm.h","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/i86pc/sys/vmm_dev.h","type":"MODIFIED","insertions":36,"deletions":0},{"file":"usr/src/uts/intel/ia32/ml/modstubs.s","type":"MODIFIED","insertions":0,"deletions":-1}],"sizeInsertions":1093,"sizeDeletions":-911},{"number":"3","revision":"a2ba5dd63d84c0a164a5d092dfe6cc864c380a1c","parents":["4854aef507655bd094943da0db30a1a493c4c97a"],"ref":"refs/changes/42/3542/3","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1520315369,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":13,"deletions":0},{"file":"usr/src/cmd/bhyve/Makefile.com","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/cmd/bhyve/pci_passthru.c","type":"MODIFIED","insertions":185,"deletions":-432},{"file":"usr/src/cmd/bhyvectl/bhyvectl.c","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/cmd/devfsadm/i386/misc_link_i386.c","type":"MODIFIED","insertions":6,"deletions":0},{"file":"usr/src/compat/freebsd/dev/pci/pcivar.h","type":"MODIFIED","insertions":1,"deletions":-14},{"file":"usr/src/lib/libvmmapi/common/vmmapi.c","type":"MODIFIED","insertions":79,"deletions":-1},{"file":"usr/src/lib/libvmmapi/common/vmmapi.h","type":"MODIFIED","insertions":13,"deletions":0},{"file":"usr/src/uts/i86pc/Makefile.files","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/i86pc/io/vmm/io/ppt.c","type":"MODIFIED","insertions":844,"deletions":-532},{"file":"usr/src/uts/i86pc/io/vmm/io/ppt.h","type":"MODIFIED","insertions":11,"deletions":-18},{"file":"usr/src/uts/i86pc/io/vmm/io/ppt_sol_glue.c","type":"DELETED","insertions":0,"deletions":-177},{"file":"usr/src/uts/i86pc/io/vmm/vmm.c","type":"MODIFIED","insertions":26,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/vmm_sol_dev.c","type":"MODIFIED","insertions":17,"deletions":-15},{"file":"usr/src/uts/i86pc/ppt/Makefile","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/i86pc/sys/ppt_dev.h","type":"ADDED","insertions":56,"deletions":0},{"file":"usr/src/uts/i86pc/sys/vmm.h","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/i86pc/sys/vmm_dev.h","type":"MODIFIED","insertions":36,"deletions":0},{"file":"usr/src/uts/intel/ia32/ml/modstubs.s","type":"MODIFIED","insertions":0,"deletions":-1}],"sizeInsertions":1281,"sizeDeletions":-1195},{"number":"4","revision":"4bd501d806d6903d050802e1c2808981ac97dee6","parents":["4854aef507655bd094943da0db30a1a493c4c97a"],"ref":"refs/changes/42/3542/4","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1520316377,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":13,"deletions":0},{"file":"usr/src/cmd/bhyve/Makefile.com","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/cmd/bhyve/pci_passthru.c","type":"MODIFIED","insertions":185,"deletions":-432},{"file":"usr/src/cmd/bhyvectl/bhyvectl.c","type":"MODIFIED","insertions":8,"deletions":0},{"file":"usr/src/cmd/devfsadm/i386/misc_link_i386.c","type":"MODIFIED","insertions":6,"deletions":0},{"file":"usr/src/compat/freebsd/dev/pci/pcivar.h","type":"MODIFIED","insertions":1,"deletions":-14},{"file":"usr/src/lib/libvmmapi/common/vmmapi.c","type":"MODIFIED","insertions":79,"deletions":-1},{"file":"usr/src/lib/libvmmapi/common/vmmapi.h","type":"MODIFIED","insertions":13,"deletions":0},{"file":"usr/src/uts/i86pc/Makefile.files","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/i86pc/io/vmm/io/ppt.c","type":"MODIFIED","insertions":844,"deletions":-532},{"file":"usr/src/uts/i86pc/io/vmm/io/ppt.h","type":"MODIFIED","insertions":11,"deletions":-18},{"file":"usr/src/uts/i86pc/io/vmm/io/ppt_sol_glue.c","type":"DELETED","insertions":0,"deletions":-177},{"file":"usr/src/uts/i86pc/io/vmm/vmm.c","type":"MODIFIED","insertions":26,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/vmm_sol_dev.c","type":"MODIFIED","insertions":17,"deletions":-15},{"file":"usr/src/uts/i86pc/ppt/Makefile","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/i86pc/sys/ppt_dev.h","type":"ADDED","insertions":56,"deletions":0},{"file":"usr/src/uts/i86pc/sys/vmm.h","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/i86pc/sys/vmm_dev.h","type":"MODIFIED","insertions":36,"deletions":0},{"file":"usr/src/uts/intel/ia32/ml/modstubs.s","type":"MODIFIED","insertions":0,"deletions":-1}],"sizeInsertions":1287,"sizeDeletions":-1195},{"number":"5","revision":"49f74c2243256a40cc4d7b49c59d62f3ad9dc5d3","parents":["4854aef507655bd094943da0db30a1a493c4c97a"],"ref":"refs/changes/42/3542/5","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1520317457,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/uts/i86pc/io/vmm/io/ppt.c","line":982,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"this is ENOENT, others are EBADF. Fine if intentional."},{"file":"usr/src/uts/i86pc/io/vmm/io/ppt.c","line":982,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Nope, oversight.  Fixed"},{"file":"usr/src/uts/i86pc/io/vmm/io/ppt.c","line":1278,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"oops :)"},{"file":"usr/src/uts/i86pc/io/vmm/io/ppt.c","line":1278,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"I shouldn\u0027t have been working through this so late."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":13,"deletions":0},{"file":"usr/src/cmd/bhyve/Makefile.com","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/cmd/bhyve/pci_passthru.c","type":"MODIFIED","insertions":185,"deletions":-432},{"file":"usr/src/cmd/bhyvectl/bhyvectl.c","type":"MODIFIED","insertions":8,"deletions":0},{"file":"usr/src/cmd/devfsadm/i386/misc_link_i386.c","type":"MODIFIED","insertions":6,"deletions":0},{"file":"usr/src/compat/freebsd/dev/pci/pcivar.h","type":"MODIFIED","insertions":1,"deletions":-14},{"file":"usr/src/lib/libvmmapi/common/vmmapi.c","type":"MODIFIED","insertions":79,"deletions":-1},{"file":"usr/src/lib/libvmmapi/common/vmmapi.h","type":"MODIFIED","insertions":13,"deletions":0},{"file":"usr/src/uts/i86pc/Makefile.files","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/i86pc/io/vmm/io/ppt.c","type":"MODIFIED","insertions":844,"deletions":-532},{"file":"usr/src/uts/i86pc/io/vmm/io/ppt.h","type":"MODIFIED","insertions":11,"deletions":-18},{"file":"usr/src/uts/i86pc/io/vmm/io/ppt_sol_glue.c","type":"DELETED","insertions":0,"deletions":-177},{"file":"usr/src/uts/i86pc/io/vmm/vmm.c","type":"MODIFIED","insertions":26,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/vmm_sol_dev.c","type":"MODIFIED","insertions":17,"deletions":-15},{"file":"usr/src/uts/i86pc/ppt/Makefile","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/i86pc/sys/ppt_dev.h","type":"ADDED","insertions":56,"deletions":0},{"file":"usr/src/uts/i86pc/sys/vmm.h","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/uts/i86pc/sys/vmm_dev.h","type":"MODIFIED","insertions":36,"deletions":0},{"file":"usr/src/uts/intel/ia32/ml/modstubs.s","type":"MODIFIED","insertions":0,"deletions":-1}],"sizeInsertions":1290,"sizeDeletions":-1193},{"number":"6","revision":"e11f3ceb16e89be2360fde86ebf1b42eb48d900c","parents":["4854aef507655bd094943da0db30a1a493c4c97a"],"ref":"refs/changes/42/3542/6","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1520350115,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1520350504,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1520351321,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":13,"deletions":0},{"file":"usr/src/cmd/bhyve/Makefile.com","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/cmd/bhyve/pci_passthru.c","type":"MODIFIED","insertions":185,"deletions":-432},{"file":"usr/src/cmd/bhyvectl/bhyvectl.c","type":"MODIFIED","insertions":8,"deletions":0},{"file":"usr/src/cmd/devfsadm/i386/misc_link_i386.c","type":"MODIFIED","insertions":6,"deletions":0},{"file":"usr/src/compat/freebsd/dev/pci/pcivar.h","type":"MODIFIED","insertions":1,"deletions":-14},{"file":"usr/src/lib/libvmmapi/common/vmmapi.c","type":"MODIFIED","insertions":79,"deletions":-1},{"file":"usr/src/lib/libvmmapi/common/vmmapi.h","type":"MODIFIED","insertions":13,"deletions":0},{"file":"usr/src/uts/i86pc/Makefile.files","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/i86pc/io/vmm/io/ppt.c","type":"MODIFIED","insertions":844,"deletions":-532},{"file":"usr/src/uts/i86pc/io/vmm/io/ppt.h","type":"MODIFIED","insertions":11,"deletions":-18},{"file":"usr/src/uts/i86pc/io/vmm/io/ppt_sol_glue.c","type":"DELETED","insertions":0,"deletions":-177},{"file":"usr/src/uts/i86pc/io/vmm/vmm.c","type":"MODIFIED","insertions":26,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/vmm_sol_dev.c","type":"MODIFIED","insertions":17,"deletions":-15},{"file":"usr/src/uts/i86pc/ppt/Makefile","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/i86pc/sys/ppt_dev.h","type":"ADDED","insertions":56,"deletions":0},{"file":"usr/src/uts/i86pc/sys/vmm.h","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/uts/i86pc/sys/vmm_dev.h","type":"MODIFIED","insertions":36,"deletions":0},{"file":"usr/src/uts/intel/ia32/ml/modstubs.s","type":"MODIFIED","insertions":0,"deletions":-1}],"sizeInsertions":1290,"sizeDeletions":-1193},{"number":"7","revision":"9604982bf304c6ce0db0a071bc44c226d6dea187","parents":["4854aef507655bd094943da0db30a1a493c4c97a"],"ref":"refs/changes/42/3542/7","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1520364200,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1520365088,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1520366213,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":13,"deletions":0},{"file":"usr/src/cmd/bhyve/Makefile.com","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/cmd/bhyve/pci_passthru.c","type":"MODIFIED","insertions":198,"deletions":-442},{"file":"usr/src/cmd/bhyvectl/bhyvectl.c","type":"MODIFIED","insertions":8,"deletions":0},{"file":"usr/src/cmd/devfsadm/i386/misc_link_i386.c","type":"MODIFIED","insertions":6,"deletions":0},{"file":"usr/src/compat/freebsd/dev/pci/pcivar.h","type":"MODIFIED","insertions":1,"deletions":-14},{"file":"usr/src/lib/libvmmapi/common/vmmapi.c","type":"MODIFIED","insertions":79,"deletions":-1},{"file":"usr/src/lib/libvmmapi/common/vmmapi.h","type":"MODIFIED","insertions":13,"deletions":0},{"file":"usr/src/uts/i86pc/Makefile.files","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/i86pc/io/vmm/io/ppt.c","type":"MODIFIED","insertions":885,"deletions":-533},{"file":"usr/src/uts/i86pc/io/vmm/io/ppt.h","type":"MODIFIED","insertions":11,"deletions":-18},{"file":"usr/src/uts/i86pc/io/vmm/io/ppt_sol_glue.c","type":"DELETED","insertions":0,"deletions":-177},{"file":"usr/src/uts/i86pc/io/vmm/vmm.c","type":"MODIFIED","insertions":26,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/vmm_sol_dev.c","type":"MODIFIED","insertions":17,"deletions":-15},{"file":"usr/src/uts/i86pc/ppt/Makefile","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/i86pc/sys/ppt_dev.h","type":"ADDED","insertions":56,"deletions":0},{"file":"usr/src/uts/i86pc/sys/vmm.h","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/uts/i86pc/sys/vmm_dev.h","type":"MODIFIED","insertions":36,"deletions":0},{"file":"usr/src/uts/intel/ia32/ml/modstubs.s","type":"MODIFIED","insertions":0,"deletions":-1}],"sizeInsertions":1344,"sizeDeletions":-1204},{"number":"8","revision":"55b0bc905f53494cc125b6ca929b2b0ced57f4b7","parents":["05b0c46baa0f5ab9feca1ad696eefd2a66425b04"],"ref":"refs/changes/42/3542/8","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1520367660,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1520365088,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1520366213,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":13,"deletions":0},{"file":"usr/src/cmd/bhyve/Makefile.com","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/cmd/bhyve/pci_passthru.c","type":"MODIFIED","insertions":198,"deletions":-442},{"file":"usr/src/cmd/bhyvectl/bhyvectl.c","type":"MODIFIED","insertions":8,"deletions":0},{"file":"usr/src/cmd/devfsadm/i386/misc_link_i386.c","type":"MODIFIED","insertions":6,"deletions":0},{"file":"usr/src/compat/freebsd/dev/pci/pcivar.h","type":"MODIFIED","insertions":1,"deletions":-14},{"file":"usr/src/lib/libvmmapi/common/vmmapi.c","type":"MODIFIED","insertions":79,"deletions":-1},{"file":"usr/src/lib/libvmmapi/common/vmmapi.h","type":"MODIFIED","insertions":13,"deletions":0},{"file":"usr/src/uts/i86pc/Makefile.files","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/i86pc/io/vmm/io/ppt.c","type":"MODIFIED","insertions":885,"deletions":-533},{"file":"usr/src/uts/i86pc/io/vmm/io/ppt.h","type":"MODIFIED","insertions":11,"deletions":-18},{"file":"usr/src/uts/i86pc/io/vmm/io/ppt_sol_glue.c","type":"DELETED","insertions":0,"deletions":-177},{"file":"usr/src/uts/i86pc/io/vmm/vmm.c","type":"MODIFIED","insertions":26,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/vmm_sol_dev.c","type":"MODIFIED","insertions":17,"deletions":-15},{"file":"usr/src/uts/i86pc/ppt/Makefile","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/i86pc/sys/ppt_dev.h","type":"ADDED","insertions":56,"deletions":0},{"file":"usr/src/uts/i86pc/sys/vmm.h","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/uts/i86pc/sys/vmm_dev.h","type":"MODIFIED","insertions":36,"deletions":0},{"file":"usr/src/uts/intel/ia32/ml/modstubs.s","type":"MODIFIED","insertions":0,"deletions":-1}],"sizeInsertions":1344,"sizeDeletions":-1204},{"number":"9","revision":"7493a728e0445132992f3bb1bed7287f32de2ad2","parents":["05b0c46baa0f5ab9feca1ad696eefd2a66425b04"],"ref":"refs/changes/42/3542/9","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1520367889,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1520365088,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1520366213,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"SUBM","value":"1","grantedOn":1520368349,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1520368159,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/cmd/bhyve/Makefile.com","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/cmd/bhyve/pci_passthru.c","type":"MODIFIED","insertions":198,"deletions":-442},{"file":"usr/src/cmd/bhyvectl/bhyvectl.c","type":"MODIFIED","insertions":8,"deletions":0},{"file":"usr/src/cmd/devfsadm/i386/misc_link_i386.c","type":"MODIFIED","insertions":6,"deletions":0},{"file":"usr/src/compat/freebsd/dev/pci/pcivar.h","type":"MODIFIED","insertions":1,"deletions":-14},{"file":"usr/src/lib/libvmmapi/common/vmmapi.c","type":"MODIFIED","insertions":79,"deletions":-1},{"file":"usr/src/lib/libvmmapi/common/vmmapi.h","type":"MODIFIED","insertions":13,"deletions":0},{"file":"usr/src/uts/i86pc/Makefile.files","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/i86pc/io/vmm/io/ppt.c","type":"MODIFIED","insertions":885,"deletions":-533},{"file":"usr/src/uts/i86pc/io/vmm/io/ppt.h","type":"MODIFIED","insertions":11,"deletions":-18},{"file":"usr/src/uts/i86pc/io/vmm/io/ppt_sol_glue.c","type":"DELETED","insertions":0,"deletions":-177},{"file":"usr/src/uts/i86pc/io/vmm/vmm.c","type":"MODIFIED","insertions":26,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/vmm_sol_dev.c","type":"MODIFIED","insertions":17,"deletions":-15},{"file":"usr/src/uts/i86pc/ppt/Makefile","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/i86pc/sys/ppt_dev.h","type":"ADDED","insertions":56,"deletions":0},{"file":"usr/src/uts/i86pc/sys/vmm.h","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/uts/i86pc/sys/vmm_dev.h","type":"MODIFIED","insertions":36,"deletions":0},{"file":"usr/src/uts/intel/ia32/ml/modstubs.s","type":"MODIFIED","insertions":0,"deletions":-1}],"sizeInsertions":1344,"sizeDeletions":-1204}],"allReviewers":[{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}]}