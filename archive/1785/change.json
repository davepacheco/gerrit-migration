{"project":"joyent/triton-origin-image","branch":"master","id":"Ib6345d4fb76b9cea7fc6b29f3aff66053dd86aea","number":"1785","subject":"TOOLS-1752 Create tool for creating Triton origin images","owner":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"url":"https://cr.joyent.us/1785","commitMessage":"TOOLS-1752 Create tool for creating Triton origin images\n","createdOn":1492030677,"lastUpdated":1494359739,"open":false,"status":"ABANDONED","comments":[{"timestamp":1492030677,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Uploaded patch set 1."},{"timestamp":1492644631,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 1:\n\nforgot to git add data.json and create-image.sh?"},{"timestamp":1492653029,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Uploaded patch set 2."},{"timestamp":1493403017,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 2:\n\n(10 comments)\n\nI\u0027ll follow up with a stab at some changes here in a TOOLS-1752 branch that we can iterate on."},{"timestamp":1493416579,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 2:\n\n(9 comments)"},{"timestamp":1494359739,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Abandoned\n\nObviated by https://cr.joyent.us/#/c/1922/ (which was my, Trent\u0027s, followup work on what Jason started here.)   It was my screw up that this one got commited instead of the other."}],"currentPatchSet":{"number":"2","revision":"b6345d4fb76b9cea7fc6b29f3aff66053dd86aea","parents":["34a033bad6a75a141aa2fd64abb0d5a888b9f8a9"],"ref":"refs/changes/85/1785/2","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1492653029,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"REWORK","comments":[{"file":"Makefile","line":3,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"I suppose we should get the MPL boilerplate in here."},{"file":"Makefile","line":3,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Probably"},{"file":"Makefile","line":11,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Let\u0027s feel this out in separate discussion. I have a bunch of notes on next steps."},{"file":"create-image.sh","line":15,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"This guard isn\u0027t working, FWIW."},{"file":"create-image.sh","line":15,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"I think I grabbed that from something in MG :) I\u0027ll fix it up so it actually works."},{"file":"create-image.sh","line":19,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"strongly advocate writing bash using:\n   set -o errexit\n   set -o pipefail"},{"file":"create-image.sh","line":19,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"ok"},{"file":"create-image.sh","line":36,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Why this envvar? Is that a pattern from somewhere? Perhaps a CLI opt?\n\nThere *is* a weird potential dual use case:\n1. create the image and leave it there in the DC\u0027s IMGAPI for potential usage\n2. create the image, export it to manta, and delete the image from the DC\u0027s IMGAPI"},{"file":"create-image.sh","line":36,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"MG\u0027s tools/prep_dataset_in_jpc.sh has it -- if it had the functionality, I figured this might need it to, though it perhaps might not be used and could be removed."},{"file":"create-image.sh","line":100,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Perhaps TRITON_ORIGIN_ prefix for these envvars to avoid fluke collisions with node-triton envvars.  Or... I wonder about just having CLI options for these. Or arguably there isn\u0027t a need to allow overrides at all. We want a build from what is defined in the commited source code. I\u0027d bias to removing the overrides to begin with."},{"file":"create-image.sh","line":100,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Seems reasonable to me."},{"file":"data.json","line":1,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"As discussed on mib@ we might want to make this an array of images to create."},{"file":"data.json","line":1,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Yeah -- based on that I was thinking either array or just have multiple copies of the file in the repo, though I don\u0027t feel strongly about one approach over the other."},{"file":"data.json","line":9,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Perhaps \"proto_package\" instead?"},{"file":"data.json","line":9,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"That\u0027s probably a better name.. that or maybe \u0027build_package\u0027 -- whatever seems clearer to people"},{"file":"data.json","line":10,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"I\u0027d be inclined to call this \u0027pkgsrc\u0027 for the strong name association. \"packages\" could imply PAPI packages."},{"file":"data.json","line":10,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Definitely seems clearer."},{"file":"data.json","line":14,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Let\u0027s be specific on versions of these packages for more reproducible builds and explicit upgrading. Also missed \"sudo\", which was suggested from the RFD.\n\n+        \"coreutils-8.23nb2\",\n+        \"curl-7.47.1\",\n+        \"gsed-4.2.2nb4\",\n+        \"patch-2.7.5\",\n+        \"sudo-1.8.15\""},{"file":"data.json","line":14,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Not sure how I missed sudo, but sounds good."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":2,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":21,"deletions":-2},{"file":"create-image.sh","type":"ADDED","insertions":166,"deletions":0},{"file":"data.json","type":"ADDED","insertions":16,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":206,"sizeDeletions":-3},"patchSets":[{"number":"1","revision":"a6846b42f9c7f954075af3437f637b46f650d39e","parents":["34a033bad6a75a141aa2fd64abb0d5a888b9f8a9"],"ref":"refs/changes/85/1785/1","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1492030677,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":2,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":21,"deletions":-2},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":24,"sizeDeletions":-3},{"number":"2","revision":"b6345d4fb76b9cea7fc6b29f3aff66053dd86aea","parents":["34a033bad6a75a141aa2fd64abb0d5a888b9f8a9"],"ref":"refs/changes/85/1785/2","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1492653029,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"REWORK","comments":[{"file":"Makefile","line":3,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"I suppose we should get the MPL boilerplate in here."},{"file":"Makefile","line":3,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Probably"},{"file":"Makefile","line":11,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Let\u0027s feel this out in separate discussion. I have a bunch of notes on next steps."},{"file":"create-image.sh","line":15,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"This guard isn\u0027t working, FWIW."},{"file":"create-image.sh","line":15,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"I think I grabbed that from something in MG :) I\u0027ll fix it up so it actually works."},{"file":"create-image.sh","line":19,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"strongly advocate writing bash using:\n   set -o errexit\n   set -o pipefail"},{"file":"create-image.sh","line":19,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"ok"},{"file":"create-image.sh","line":36,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Why this envvar? Is that a pattern from somewhere? Perhaps a CLI opt?\n\nThere *is* a weird potential dual use case:\n1. create the image and leave it there in the DC\u0027s IMGAPI for potential usage\n2. create the image, export it to manta, and delete the image from the DC\u0027s IMGAPI"},{"file":"create-image.sh","line":36,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"MG\u0027s tools/prep_dataset_in_jpc.sh has it -- if it had the functionality, I figured this might need it to, though it perhaps might not be used and could be removed."},{"file":"create-image.sh","line":100,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Perhaps TRITON_ORIGIN_ prefix for these envvars to avoid fluke collisions with node-triton envvars.  Or... I wonder about just having CLI options for these. Or arguably there isn\u0027t a need to allow overrides at all. We want a build from what is defined in the commited source code. I\u0027d bias to removing the overrides to begin with."},{"file":"create-image.sh","line":100,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Seems reasonable to me."},{"file":"data.json","line":1,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"As discussed on mib@ we might want to make this an array of images to create."},{"file":"data.json","line":1,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Yeah -- based on that I was thinking either array or just have multiple copies of the file in the repo, though I don\u0027t feel strongly about one approach over the other."},{"file":"data.json","line":9,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Perhaps \"proto_package\" instead?"},{"file":"data.json","line":9,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"That\u0027s probably a better name.. that or maybe \u0027build_package\u0027 -- whatever seems clearer to people"},{"file":"data.json","line":10,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"I\u0027d be inclined to call this \u0027pkgsrc\u0027 for the strong name association. \"packages\" could imply PAPI packages."},{"file":"data.json","line":10,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Definitely seems clearer."},{"file":"data.json","line":14,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Let\u0027s be specific on versions of these packages for more reproducible builds and explicit upgrading. Also missed \"sudo\", which was suggested from the RFD.\n\n+        \"coreutils-8.23nb2\",\n+        \"curl-7.47.1\",\n+        \"gsed-4.2.2nb4\",\n+        \"patch-2.7.5\",\n+        \"sudo-1.8.15\""},{"file":"data.json","line":14,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Not sure how I missed sudo, but sounds good."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".gitignore","type":"MODIFIED","insertions":2,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":21,"deletions":-2},{"file":"create-image.sh","type":"ADDED","insertions":166,"deletions":0},{"file":"data.json","type":"ADDED","insertions":16,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":206,"sizeDeletions":-3}],"allReviewers":[{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}]}