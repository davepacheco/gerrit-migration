{"project":"joyent/sdc-napi","branch":"master","id":"I7de64d4c5d79e26192b9a839905d6d25fc713012","number":"3842","subject":"TRITON-265 Allow networks to have \"linklocal\" routes TRITON-293 Validate address family of updated \"resolvers\" and \"routes\" Reviewed by: Rui Loura \u003crui@joyent.com\u003e Approved by: Rui Loura \u003crui@joyent.com\u003e","owner":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"url":"https://cr.joyent.us/3842","commitMessage":"TRITON-265 Allow networks to have \"linklocal\" routes\nTRITON-293 Validate address family of updated \"resolvers\" and \"routes\"\nReviewed by: Rui Loura \u003crui@joyent.com\u003e\nApproved by: Rui Loura \u003crui@joyent.com\u003e\n","createdOn":1524177903,"lastUpdated":1524509273,"open":false,"status":"MERGED","comments":[{"timestamp":1524177903,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 1."},{"timestamp":1524177963,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1524179014,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 2."},{"timestamp":1524179073,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1524241669,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Patch Set 2:\n\n(2 comments)"},{"timestamp":1524247702,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 3."},{"timestamp":1524247829,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1524247877,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 3:\n\n(2 comments)"},{"timestamp":1524497319,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1524497407,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Patch Set 3:\n\nProbably need to update some copyrights.  Other than that, +1."},{"timestamp":1524505039,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 4."},{"timestamp":1524505102,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1524505141,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 5."},{"timestamp":1524505203,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1524505206,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 6: Commit message was updated."},{"timestamp":1524505549,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Patch Set 6: Code-Review+1"},{"timestamp":1524509215,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Patch Set 6: Integration-Approval+1"},{"timestamp":1524509245,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 7: Commit message was updated."},{"timestamp":1524509273,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Cody Peter Mello"}],"currentPatchSet":{"number":"7","revision":"40a13a8774ba75b37acd467e688c4e5f93227c95","parents":["7642e1d74dba582ecfc08fb456dc68ca6720b895"],"ref":"refs/changes/42/3842/7","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1524509245,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1524505203,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1524505549,"by":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1524509215,"by":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"}},{"type":"SUBM","value":"1","grantedOn":1524509273,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"lib/models/network.js","type":"MODIFIED","insertions":145,"deletions":-100},{"file":"lib/models/nic/obj.js","type":"MODIFIED","insertions":12,"deletions":-2},{"file":"lib/models/nic/provision.js","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"lib/models/nic/update.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/util/constants.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"lib/util/ip.js","type":"MODIFIED","insertions":37,"deletions":-2},{"file":"lib/util/subnet.js","type":"DELETED","insertions":0,"deletions":-73},{"file":"sapi_manifests/napi/template","type":"MODIFIED","insertions":3,"deletions":0},{"file":"test/config.json","type":"MODIFIED","insertions":1,"deletions":0},{"file":"test/unit/networks.test.js","type":"MODIFIED","insertions":152,"deletions":-40}],"sizeInsertions":358,"sizeDeletions":-220},"patchSets":[{"number":"1","revision":"51d853b18e1f02f3ac2165f6dfb5691c8217e7bb","parents":["7642e1d74dba582ecfc08fb456dc68ca6720b895"],"ref":"refs/changes/42/3842/1","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1524177903,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1524177963,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"lib/models/network.js","type":"MODIFIED","insertions":140,"deletions":-99},{"file":"lib/models/nic/obj.js","type":"MODIFIED","insertions":11,"deletions":-1},{"file":"lib/models/nic/provision.js","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"lib/models/nic/update.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/util/constants.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/util/ip.js","type":"MODIFIED","insertions":31,"deletions":-1},{"file":"lib/util/subnet.js","type":"DELETED","insertions":0,"deletions":-73},{"file":"test/config.json","type":"MODIFIED","insertions":1,"deletions":0},{"file":"test/unit/networks.test.js","type":"MODIFIED","insertions":151,"deletions":-39}],"sizeInsertions":341,"sizeDeletions":-215},{"number":"2","revision":"5ab9968af63857a5be736848ed4f8b92ae541ab7","parents":["7642e1d74dba582ecfc08fb456dc68ca6720b895"],"ref":"refs/changes/42/3842/2","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1524179014,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1524179073,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/models/network.js","line":674,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Is it worth adding an \n} else {\n  //generic error\n}\n\nin case any of the above is undefined?  If that happens it looks like we\u0027d get a TypeError below."},{"file":"lib/models/network.js","line":674,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Done"},{"file":"lib/util/ip.js","line":215,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"If you\u0027re using ip6addr I dont think you need to split up the subnet string:\n\nipaddr.createCIDR(\"192.168.1.1/24\")\n\nit also automatically does the subnet length conversion for you:\n\n\u003e sub \u003d ipaddr.createCIDR(\"192.168.1.1/24\")\nCIDR {\n  _prefix: 120,\n  _mask: \n   Addr {\n     _fields: [ 65535, 65535, 65535, 65535, 65535, 65535, 65535, 65280 ],\n     _attrs: {} },\n  _addr: \n   Addr {\n     _fields: [ 0, 0, 0, 0, 0, 65535, 49320, 256 ],\n     _attrs: { ipv4Bare: true, ipv4Mapped: true } } }\n\nYou can also check the minbits against sub.prefixLength()."},{"file":"lib/util/ip.js","line":215,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Unfortunately we need to support an old representation of subnets that NAPI used to use. I\u0027ve added a comment with an example of what this looks like."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"lib/models/network.js","type":"MODIFIED","insertions":140,"deletions":-99},{"file":"lib/models/nic/obj.js","type":"MODIFIED","insertions":11,"deletions":-1},{"file":"lib/models/nic/provision.js","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"lib/models/nic/update.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/util/constants.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/util/ip.js","type":"MODIFIED","insertions":32,"deletions":-1},{"file":"lib/util/subnet.js","type":"DELETED","insertions":0,"deletions":-73},{"file":"test/config.json","type":"MODIFIED","insertions":1,"deletions":0},{"file":"test/unit/networks.test.js","type":"MODIFIED","insertions":151,"deletions":-39}],"sizeInsertions":342,"sizeDeletions":-215},{"number":"3","revision":"ee605c6db4cea5b91222e8e13b01323aa1d6cd47","parents":["7642e1d74dba582ecfc08fb456dc68ca6720b895"],"ref":"refs/changes/42/3842/3","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1524247702,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1524247829,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1524497319,"by":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"lib/models/network.js","type":"MODIFIED","insertions":144,"deletions":-99},{"file":"lib/models/nic/obj.js","type":"MODIFIED","insertions":11,"deletions":-1},{"file":"lib/models/nic/provision.js","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"lib/models/nic/update.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/util/constants.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/util/ip.js","type":"MODIFIED","insertions":36,"deletions":-1},{"file":"lib/util/subnet.js","type":"DELETED","insertions":0,"deletions":-73},{"file":"test/config.json","type":"MODIFIED","insertions":1,"deletions":0},{"file":"test/unit/networks.test.js","type":"MODIFIED","insertions":151,"deletions":-39}],"sizeInsertions":350,"sizeDeletions":-215},{"number":"4","revision":"95cc381a3ded78dfdf8d5f595b1d81c9c3b3aa98","parents":["7642e1d74dba582ecfc08fb456dc68ca6720b895"],"ref":"refs/changes/42/3842/4","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1524505039,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1524505102,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"lib/models/network.js","type":"MODIFIED","insertions":145,"deletions":-100},{"file":"lib/models/nic/obj.js","type":"MODIFIED","insertions":12,"deletions":-2},{"file":"lib/models/nic/provision.js","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"lib/models/nic/update.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/util/constants.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"lib/util/ip.js","type":"MODIFIED","insertions":37,"deletions":-2},{"file":"lib/util/subnet.js","type":"DELETED","insertions":0,"deletions":-73},{"file":"test/config.json","type":"MODIFIED","insertions":1,"deletions":0},{"file":"test/unit/networks.test.js","type":"MODIFIED","insertions":152,"deletions":-40}],"sizeInsertions":355,"sizeDeletions":-220},{"number":"5","revision":"f24592bbcd3ec7c8b6c90de5689a78ef86b62086","parents":["7642e1d74dba582ecfc08fb456dc68ca6720b895"],"ref":"refs/changes/42/3842/5","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1524505141,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1524505203,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"lib/models/network.js","type":"MODIFIED","insertions":145,"deletions":-100},{"file":"lib/models/nic/obj.js","type":"MODIFIED","insertions":12,"deletions":-2},{"file":"lib/models/nic/provision.js","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"lib/models/nic/update.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/util/constants.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"lib/util/ip.js","type":"MODIFIED","insertions":37,"deletions":-2},{"file":"lib/util/subnet.js","type":"DELETED","insertions":0,"deletions":-73},{"file":"sapi_manifests/napi/template","type":"MODIFIED","insertions":3,"deletions":0},{"file":"test/config.json","type":"MODIFIED","insertions":1,"deletions":0},{"file":"test/unit/networks.test.js","type":"MODIFIED","insertions":152,"deletions":-40}],"sizeInsertions":358,"sizeDeletions":-220},{"number":"6","revision":"7de64d4c5d79e26192b9a839905d6d25fc713012","parents":["7642e1d74dba582ecfc08fb456dc68ca6720b895"],"ref":"refs/changes/42/3842/6","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1524505206,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1524505203,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1524505549,"by":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1524509215,"by":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/models/network.js","type":"MODIFIED","insertions":145,"deletions":-100},{"file":"lib/models/nic/obj.js","type":"MODIFIED","insertions":12,"deletions":-2},{"file":"lib/models/nic/provision.js","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"lib/models/nic/update.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/util/constants.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"lib/util/ip.js","type":"MODIFIED","insertions":37,"deletions":-2},{"file":"lib/util/subnet.js","type":"DELETED","insertions":0,"deletions":-73},{"file":"sapi_manifests/napi/template","type":"MODIFIED","insertions":3,"deletions":0},{"file":"test/config.json","type":"MODIFIED","insertions":1,"deletions":0},{"file":"test/unit/networks.test.js","type":"MODIFIED","insertions":152,"deletions":-40}],"sizeInsertions":358,"sizeDeletions":-220},{"number":"7","revision":"40a13a8774ba75b37acd467e688c4e5f93227c95","parents":["7642e1d74dba582ecfc08fb456dc68ca6720b895"],"ref":"refs/changes/42/3842/7","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1524509245,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"SUBM","value":"1","grantedOn":1524509273,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1524505203,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1524505549,"by":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1524509215,"by":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"lib/models/network.js","type":"MODIFIED","insertions":145,"deletions":-100},{"file":"lib/models/nic/obj.js","type":"MODIFIED","insertions":12,"deletions":-2},{"file":"lib/models/nic/provision.js","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"lib/models/nic/update.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/util/constants.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"lib/util/ip.js","type":"MODIFIED","insertions":37,"deletions":-2},{"file":"lib/util/subnet.js","type":"DELETED","insertions":0,"deletions":-73},{"file":"sapi_manifests/napi/template","type":"MODIFIED","insertions":3,"deletions":0},{"file":"test/config.json","type":"MODIFIED","insertions":1,"deletions":0},{"file":"test/unit/networks.test.js","type":"MODIFIED","insertions":152,"deletions":-40}],"sizeInsertions":358,"sizeDeletions":-220}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}]}