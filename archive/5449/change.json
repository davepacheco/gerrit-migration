{"project":"joyent/sdc-cn-agent","branch":"master","id":"If4686cd81d5c392962383ecc270fd37a59ad44a3","number":"5449","subject":"TRITON-1173 add CNAPI/cn-agent support for uninstalling agents Reviewed by: Josh Wilsdon \u003cjosh@wilsdon.ca\u003e Approved by: Josh Wilsdon \u003cjosh@wilsdon.ca\u003e","owner":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"url":"https://cr.joyent.us/5449","commitMessage":"TRITON-1173 add CNAPI/cn-agent support for uninstalling agents\nReviewed by: Josh Wilsdon \u003cjosh@wilsdon.ca\u003e\nApproved by: Josh Wilsdon \u003cjosh@wilsdon.ca\u003e\n","createdOn":1548812339,"lastUpdated":1548958464,"open":false,"status":"MERGED","comments":[{"timestamp":1548812339,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Uploaded patch set 1."},{"timestamp":1548812340,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit de23197da6093fb4622fdc4c7fe6ea88736d9dde\n    \n    first crack"},{"timestamp":1548812370,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1548824041,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Uploaded patch set 2: Patch Set 1 was rebased."},{"timestamp":1548824043,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit eb47f46b5a46f76ca8b6b62c071207eedad5fe1c\n    \n    first crack"},{"timestamp":1548824072,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2:\n\n\"make check\" passed ok"},{"timestamp":1548832904,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1548892579,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Uploaded patch set 3."},{"timestamp":1548892581,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 3:\n\nNew commits:\n    \n    commit 0a8bacfc2a2223d26f4826fad541423c8347e8dc\n    \n    update agents_uninstall task to be idempotent"},{"timestamp":1548892612,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing-1\n\n(2 comments)\n\n\"make check\" exited with status 2"},{"timestamp":1548892679,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Uploaded patch set 4."},{"timestamp":1548892680,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 4:\n\nNew commits:\n    \n    commit 8966559030998a10f872531eab0f7f0786f20039\n    \n    fix \u0027make check\u0027"},{"timestamp":1548892714,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1548905817,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Uploaded patch set 5."},{"timestamp":1548905819,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 5:\n\nNew commits:\n    \n    commit 871e1f8555e13c51ec8492ba6a071df1e6081a4e\n    \n    fix \u0027make check\u0027\n    \n    commit 7ddf2515ca491bcbd530a78ccd5e28c14b9fdda2\n    \n    update agents_uninstall task to be idempotent\n    \n    commit 274273626a835e817c2b08a1367bc0fe0af51b5e\n    \n    first crack"},{"timestamp":1548905849,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1548912313,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 5: Code-Review+1 Integration-Approval+1\n\n(1 comment)"},{"timestamp":1548912539,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Uploaded patch set 6."},{"timestamp":1548912540,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 6:\n\nNew commits:\n    \n    commit d9aa99a3523f181bcceb80d6fb0aa450b8bcd04f\n    \n    clarify purpose of this chdir"},{"timestamp":1548912569,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 6: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1548912572,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 6: Code-Review+1 Integration-Approval+1"},{"timestamp":1548958464,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Trent Mick"}],"currentPatchSet":{"number":"6","revision":"f4686cd81d5c392962383ecc270fd37a59ad44a3","parents":["d43e5cc8f93a3fa6dd370654d72ed41d1080d1c0"],"ref":"refs/changes/49/5449/6","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1548912539,"author":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1548912569,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1548912572,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1548912572,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"SUBM","value":"1","grantedOn":1548958464,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":34,"deletions":-210},{"file":"lib/apm.js","type":"MODIFIED","insertions":179,"deletions":-123},{"file":"lib/backends/smartos/index.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"lib/backends/smartos/tasks/agents_uninstall.js","type":"ADDED","insertions":76,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":292,"sizeDeletions":-335},"patchSets":[{"number":"1","revision":"a85e1600594d574caf38769dfb5ee7a9945a5700","parents":["495ee9fd795aff0134ac6b5d99ee3f9fa0dca126"],"ref":"refs/changes/49/5449/1","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1548812339,"author":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1548812370,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":40,"deletions":-210},{"file":"lib/apm.js","type":"MODIFIED","insertions":77,"deletions":-59},{"file":"lib/backends/smartos/index.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"lib/backends/smartos/tasks/agents_uninstall.js","type":"ADDED","insertions":76,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":196,"sizeDeletions":-271},{"number":"2","revision":"bbe1f56a5465591f19e8ae1d209ac585fd2c8351","parents":["0446dfb6bd67fac91e0a745ddc07aeb6c97b15c1"],"ref":"refs/changes/49/5449/2","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1548824041,"author":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1548812370,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"docs/index.md","line":176,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Might be worth pointing out that this can fail leaving you in a state without the agent installed?"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":40,"deletions":-210},{"file":"lib/apm.js","type":"MODIFIED","insertions":77,"deletions":-59},{"file":"lib/backends/smartos/index.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"lib/backends/smartos/tasks/agents_uninstall.js","type":"ADDED","insertions":76,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":196,"sizeDeletions":-271},{"number":"3","revision":"39980a56620962f29df4a9ee92b4dd3544a43c2c","parents":["0446dfb6bd67fac91e0a745ddc07aeb6c97b15c1"],"ref":"refs/changes/49/5449/3","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1548892579,"author":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1548892612,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/apm.js","line":180,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"warning: variable is declared but never referenced: packageJson"},{"file":"lib/apm.js","line":287,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"warning: missing semicolon"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":34,"deletions":-210},{"file":"lib/apm.js","type":"MODIFIED","insertions":180,"deletions":-122},{"file":"lib/backends/smartos/index.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"lib/backends/smartos/tasks/agents_uninstall.js","type":"ADDED","insertions":76,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":293,"sizeDeletions":-334},{"number":"4","revision":"5d3633f593498afb7c18303eabec97e03ef43b8e","parents":["0446dfb6bd67fac91e0a745ddc07aeb6c97b15c1"],"ref":"refs/changes/49/5449/4","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1548892679,"author":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1548892714,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":34,"deletions":-210},{"file":"lib/apm.js","type":"MODIFIED","insertions":180,"deletions":-123},{"file":"lib/backends/smartos/index.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"lib/backends/smartos/tasks/agents_uninstall.js","type":"ADDED","insertions":76,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":293,"sizeDeletions":-335},{"number":"5","revision":"feefa8616412e605274cf04c2c6b01574c786726","parents":["d43e5cc8f93a3fa6dd370654d72ed41d1080d1c0"],"ref":"refs/changes/49/5449/5","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1548905817,"author":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1548905849,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1548912313,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1548912313,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}}],"comments":[{"file":"lib/apm.js","line":278,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"I think the goal here is to *not* be in the path that we\u0027re deleting."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":34,"deletions":-210},{"file":"lib/apm.js","type":"MODIFIED","insertions":180,"deletions":-123},{"file":"lib/backends/smartos/index.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"lib/backends/smartos/tasks/agents_uninstall.js","type":"ADDED","insertions":76,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":293,"sizeDeletions":-335},{"number":"6","revision":"f4686cd81d5c392962383ecc270fd37a59ad44a3","parents":["d43e5cc8f93a3fa6dd370654d72ed41d1080d1c0"],"ref":"refs/changes/49/5449/6","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1548912539,"author":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1548912569,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"SUBM","value":"1","grantedOn":1548958464,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1548912572,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1548912572,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":34,"deletions":-210},{"file":"lib/apm.js","type":"MODIFIED","insertions":179,"deletions":-123},{"file":"lib/backends/smartos/index.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"lib/backends/smartos/tasks/agents_uninstall.js","type":"ADDED","insertions":76,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":292,"sizeDeletions":-335}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}]}