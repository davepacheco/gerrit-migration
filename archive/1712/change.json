{"project":"joyent/sdc-papi","branch":"master","id":"Ia901658edbafbd348398504363bbce7843a9b2cb","number":"1712","subject":"PAPI-138: Tests should clean up before running, in case there is stale data","owner":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"url":"https://cr.joyent.us/1712","commitMessage":"PAPI-138: Tests should clean up before running, in case there is stale data\n","createdOn":1490350246,"lastUpdated":1491212376,"open":false,"status":"MERGED","comments":[{"timestamp":1490350246,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Uploaded patch set 1."},{"timestamp":1490350288,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1490368122,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 1:\n\nNot sure if you want a review of this. Anyway, the changes you just made have a lot of sense for whoever having to understand what\u0027s the desired intention of each test package. Ping me if you need a CR of this one."},{"timestamp":1490387360,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 1:\n\nYes please. :)"},{"timestamp":1490801946,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 1:\n\n(2 comments)\n\nI like the idea of the new names being given to packages. Meaningful!\n\nCouple comments regarding naming, specially b/c I can\u0027t see the need for the hostname call."},{"timestamp":1490952221,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 2: Patch Set 1 was rebased"},{"timestamp":1490953306,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1490953442,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1490973238,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 2: Code-Review+1 Integration-Approval+1\n\n\u003e (1 comment)\n\n\"Right, so all of these things are really unlikely!\"\n\nThat\u0027s what I mean ;-). Anyway, I don\u0027t think this is gonna be an issue for the PAPI\u0027s test suite to complete in reasonable time, given it\u0027s small enough. I\u0027d say go for it, yeah."},{"timestamp":1490973323,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 2:\n\n\u003e (1 comment)\n\nYeah, I\u0027m using javascriptlint inside vim and my plan is to try to move that to JSHint, which provides a clue of mistakes as you made them ;-).\n\nRegarding this concrete thing, I don\u0027t mean to change it now, that\u0027s not worth modifying the issue. But in the future, it could be a good idea to define what you\u0027re about to use before you use it, when possible."},{"timestamp":1491212376,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Marsell Kukuljevic"}],"currentPatchSet":{"number":"2","revision":"df48edba6acf9402e9e56220f9297836761d4ff4","parents":["fffab588a4c3edb7081e916b4c5653263d7cf7cb"],"ref":"refs/changes/12/1712/2","uploader":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"createdOn":1490952221,"author":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"isDraft":false,"kind":"NO_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1490350288,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1490973238,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1490973238,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"SUBM","value":"1","grantedOn":1491212376,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"test/api.test.js","type":"MODIFIED","insertions":80,"deletions":-59}],"sizeInsertions":80,"sizeDeletions":-59},"patchSets":[{"number":"1","revision":"a901658edbafbd348398504363bbce7843a9b2cb","parents":["8aaf141d160e239b32642f9671b504935e85018e"],"ref":"refs/changes/12/1712/1","uploader":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"createdOn":1490350246,"author":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1490350288,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"test/api.test.js","line":42,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Why is pkgNamePrefix a global instead of being defined within pkgName function body? Just to avoid calls to os.hostname()? Wouldn\u0027t then be better to just create a closure which will return the function you want with exactly the prefix you like?\n\nAlso, why is needed to have \"os.hostname()\" into package names? Maybe I\u0027m missing something obvious, but would like to have a reason for such \"os\" call."},{"file":"test/api.test.js","line":42,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"The prefix + os.hostname() pattern comes from node-triton. While it\u0027s more useful in node-triton\u0027s context (it helps prevent two different users on the same account stomping each other during tests, and helps figure out where a stale test package came from) colour me one for consistency.\n\nIf you\u0027d prefer I switch to using a random number instead of os.hostname(), I\u0027m fine with that. I don\u0027t think os.hostname() hurts though, and can even help.\n\nWhich raises the global issue: if I move pkgNamePrefix into pkgName(), and the host\u0027s name changes during the tests, it\u0027ll cause errors and leave stale packages behind.\n\nRight, so all of these things are really unlikely! But it can\u0027t hurt to avoid them either since it costs only one line of code.\n\nLemme know if you feel strongly about this, otherwise I\u0027m inclined to leave it alone."},{"file":"test/api.test.js","line":1124,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Wouldn\u0027t have sense to define these functions at the top of the file, instead of doing it at the bottom of the file so most linters will not complain about \"you should define your functions before you use them ...\"?"},{"file":"test/api.test.js","line":1124,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"I guess I could? The only linter I use is the one invoked by \"make check\".\n\nAre you using a linter inside your editor?\n\nIf you\u0027d prefer this, then let me know and I\u0027ll create a new commit to move the helper functions to the top."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"test/api.test.js","type":"MODIFIED","insertions":80,"deletions":-59}],"sizeInsertions":80,"sizeDeletions":-59},{"number":"2","revision":"df48edba6acf9402e9e56220f9297836761d4ff4","parents":["fffab588a4c3edb7081e916b4c5653263d7cf7cb"],"ref":"refs/changes/12/1712/2","uploader":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"createdOn":1490952221,"author":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"isDraft":false,"kind":"NO_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1490350288,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1490973238,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1490973238,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"SUBM","value":"1","grantedOn":1491212376,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"test/api.test.js","type":"MODIFIED","insertions":80,"deletions":-59}],"sizeInsertions":80,"sizeDeletions":-59}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}]}