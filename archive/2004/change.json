{"project":"joyent/sdcadm","branch":"master","id":"Iacc485287c24c1e84c7989151fe6b2568e45bc2b","number":"2004","subject":"TOOLS-1770 Add multi server support to `sdcadm create AGENT_INSTANCE` Reviewed by: Trent Mick \u003ctrentm@gmail.com\u003e Approved by: Trent Mick \u003ctrentm@gmail.com\u003e","owner":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"url":"https://cr.joyent.us/2004","commitMessage":"TOOLS-1770 Add multi server support to `sdcadm create AGENT_INSTANCE`\nReviewed by: Trent Mick \u003ctrentm@gmail.com\u003e\nApproved by: Trent Mick \u003ctrentm@gmail.com\u003e\n","createdOn":1495725238,"lastUpdated":1502292452,"open":false,"status":"MERGED","comments":[{"timestamp":1495725238,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 1."},{"timestamp":1495725245,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit 303e70a306aeea816dbc2c136bcbb533f3cd289d\n    \n    TOOLS-1770 Add multi server support to `sdcadm create AGENT_INSTANCE`\n    \n    commit 1fef83708b266a3e5b340587478069ca859e26b6\n    \n    TOOLS-1784 sdcadm up moray in a setup with non-HA moray fails to bring moray up\n    Reviewed by: Pedro Palazón Candel \u003cpedro@joyent.com\u003e\n    Approved by: Pedro Palazón Candel \u003cpedro@joyent.com\u003e"},{"timestamp":1495725281,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1495726961,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 1:\n\n## Create single VM instance:\n\n    [root@headnode (coal) ~]# sdcadm create mahi -s batman\n    Using channel dev\n\n    This command will make the following changes:\n        create \"mahi\" service instance using image 65d9eefc-fd17-11e6-a5ea-9f4a59e2467e (manta-authcache@master-20170227T180012Z-g3b91a33) on server 564d5dfe-cebb-1a83-5246-6a43db477850\n\n    Would you like to continue? [y/N] y\n\n    Create work dir: /var/sdcadm/updates/20170524T151904Z\n    Getting SDC\u0027s mahi instances from SAPI\n    Updating image for SAPI service \"mahi\"\n        service uuid: 398ea939-11d7-4f79-9ba7-cec531d5a727\n    Installing image 65d9eefc-fd17-11e6-a5ea-9f4a59e2467e\n        (manta-authcache@master-20170227T180012Z-g3b91a33)\n    Creating \"mahi1\" instance\n    Instance \"f56e8eeb-13b3-4b7f-a9b3-9974a3737436\" (mahi1) created\n    Waiting for mahi instance f56e8eeb-13b3-4b7f-a9b3-9974a3737436 to come up\n    Created successfully (elapsed 62s).\n\n\n### Create multiple VM instances:\n\n    [root@headnode (coal) ~]# sdcadm create papi -s batman,robin\n    Using channel dev\n\n    This command will make the following changes:\n        create \"papi\" service instance using image 4d7ab77a-9263-11e6-8fa7-2f4e8f72ad3c (papi@master-20161014T230608Z-gdaaf689) on servers 564d5dfe-cebb-1a83-5246-6a43db477850,564d2112-6f0b-eccc-62e5-058f46c1a5df\n\n    Would you like to continue? [y/N] y\n\n    Create work dir: /var/sdcadm/updates/20170524T115652Z\n    Getting SDC\u0027s papi instances from SAPI\n    Updating image for SAPI service \"papi\"\n        service uuid: 3c988937-3ca2-46b7-8a3c-d6d6a2118c22\n    Installing image 4d7ab77a-9263-11e6-8fa7-2f4e8f72ad3c\n        (papi@master-20161014T230608Z-gdaaf689)\n    Creating \"papi1\" instance\n    Instance \"6d15818c-08be-4389-bfe6-baa3a1c114c4\" (papi1) created\n    Waiting for papi instance 6d15818c-08be-4389-bfe6-baa3a1c114c4 to come up\n    Installing image 4d7ab77a-9263-11e6-8fa7-2f4e8f72ad3c\n        (papi@master-20161014T230608Z-gdaaf689)\n    Creating \"papi2\" instance\n    Instance \"c905ea7e-1439-4870-a562-c621fe27da7c\" (papi2) created\n    Waiting for papi instance c905ea7e-1439-4870-a562-c621fe27da7c to come up\n    Created successfully (elapsed 112s).\n\n## Attempt to create existing dockerlogger instance fails:\n\n    [root@headnode (coal) ~]# sdcadm create dockerlogger -s headnode\n    Using channel dev\n    sdcadm create: error (MultiError): multiple (1) errors\n        error (Usage): Agent \"dockerlogger\" instance already exists on server \"564d94e2-c09d-32e8-55ad-1a61e8473d44\".\n\n## Attempt to create multiple existing instances fail:\n\n    [root@headnode (coal) ~]# sdcadm create cmon-agent -s batman,robin\n    Using channel dev\n    sdcadm create: error (MultiError): multiple (2) errors\n        error (Usage): Agent \"cmon-agent\" instance already exists on server \"564d5dfe-cebb-1a83-5246-6a43db477850\".\n        error (Usage): Agent \"cmon-agent\" instance already exists on server \"564d2112-6f0b-eccc-62e5-058f46c1a5df\".\n\n## Create multiple dockerlogger instances:\n\n    Using channel dev\n\n    This command will make the following changes:\n        create new instances of \"dockerlogger\" service\n            on servers 564d5dfe-cebb-1a83-5246-6a43db477850 (batman), 564d2112-6f0b-eccc-62e5-058f46c1a5df (robin)\n            using image f610604e-2e42-4543-b00b-b81412d297fe (dockerlogger@1.0.0-master-20170506T203908Z-g2926f3c)\n\n    Would you like to continue? [y/N] y\n\n    Create work dir: /var/sdcadm/updates/20170524T154110Z\n    Validating servers\n    Checking servers availability\n    Getting image file from local imgapi\n    Copying dockerlogger to assets dir: /usbkey/extra/dockerlogger\n    Starting dockerlogger instance creation\n    Downloading dockerlogger    [\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003e] 100%        2\n    Installing dockerlogger     [\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003e] 100%        2\n    Deleting temporary /var/tmp/dockerlogger-f610604e-2e42-4543-b00b-b81412d297fe.sh\n    Created successfully (elapsed 9s).\n\n## Create multiple instances:\n\n    [root@headnode (coal) ~]# sdcadm create cmon-agent -s batman,robin\n    Using channel dev\n\n    This command will make the following changes:\n        download 1 image (15 MiB):\n            image 1400258d-837d-44be-8a29-005a48cd4849\n                (cmon-agent@1.1.0)\n        create new instances of \"cmon-agent\" service\n            on servers 564d5dfe-cebb-1a83-5246-6a43db477850 (batman), 564d2112-6f0b-eccc-62e5-058f46c1a5df (robin)\n            using image 1400258d-837d-44be-8a29-005a48cd4849 (cmon-agent@1.1.0)\n\n    Would you like to continue? [y/N] y\n\n    Create work dir: /var/sdcadm/updates/20170524T155810Z\n    Downloading image 1400258d-837d-44be-8a29-005a48cd4849\n        (cmon-agent@1.1.0)\n    Imported image 1400258d-837d-44be-8a29-005a48cd4849\n        (cmon-agent@1.1.0)\n    Verifying that CNAPI is able to run agent updates\n    ...ng instance of cmon-agent [\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003e] 100%        2\n    successfully created instance of agent cmon-agent.\n    Created successfully (elapsed 129s).\n\n\n## Create single dockerlogger instance\n\n    [root@headnode (coal) ~]# sdcadm create dockerlogger -s flash\n    Using channel dev\n\n    This command will make the following changes:\n        create a new instance of \"dockerlogger\" service\n            on server 564de0ac-76a2-ffb7-b519-76609ce1d29c (flash)\n            using image f610604e-2e42-4543-b00b-b81412d297fe (dockerlogger@1.0.0-master-20170506T203908Z-g2926f3c)\n\n    Would you like to continue? [y/N] y\n\n    Create work dir: /var/sdcadm/updates/20170524T164113Z\n    Validating servers\n    Checking servers availability\n    Getting image file from local imgapi\n    Copying dockerlogger to assets dir: /usbkey/extra/dockerlogger\n    Starting dockerlogger instance creation\n    Downloading dockerlogger     [\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003e] 100%        1\n    Installing dockerlogger      [\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003e] 100%        1\n    Deleting temporary /var/tmp/dockerlogger-f610604e-2e42-4543-b00b-b81412d297fe.sh\n    Created successfully (elapsed 8s).\n\n\n## Create single agent instance:\n\n    [root@headnode (coal) ~]# sdcadm create cmon-agent -s flash\n    Using channel dev\n\n    This command will make the following changes:\n        create a new instance of \"cmon-agent\" service\n            on server 564de0ac-76a2-ffb7-b519-76609ce1d29c (flash)\n            using image 1400258d-837d-44be-8a29-005a48cd4849 (cmon-agent@1.1.0)\n\n    Would you like to continue? [y/N] y\n\n    Create work dir: /var/sdcadm/updates/20170524T170135Z\n    Verifying that CNAPI is able to run agent updates\n    ...ng instance of cmon-agent [\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003e] 100%        1\n    successfully created instance of agent cmon-agent.\n    Created successfully (elapsed 20s)."},{"timestamp":1495727004,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 1:\n\nTrent, I\u0027ve also made the suggested modification into summarize function for both docker logger/agents."},{"timestamp":1496249698,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 2."},{"timestamp":1496249703,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit 89c7e579e9df4fc592e2c37a160915327c62f78d\n    \n    TOOLS-1770 Add multi server support to `sdcadm create AGENT_INSTANCE`\n    \n    commit 1fef83708b266a3e5b340587478069ca859e26b6\n    \n    TOOLS-1784 sdcadm up moray in a setup with non-HA moray fails to bring moray up\n    Reviewed by: Pedro Palazón Candel \u003cpedro@joyent.com\u003e\n    Approved by: Pedro Palazón Candel \u003cpedro@joyent.com\u003e"},{"timestamp":1497639187,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1497794460,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1497886618,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 3."},{"timestamp":1497886624,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 3:\n\nNew commits:\n    \n    commit 93af8c1bb536fb5b98573dd843e6a9e7e9a96638\n    \n    TOOLS-1770 Add multi server support to `sdcadm create AGENT_INSTANCE`"},{"timestamp":1497886755,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 3:\n\n\u003e (1 comment)\n\nDone + fixed couple sprintf  minor issues I just hit while testing"},{"timestamp":1497896465,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1497900658,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 3:\n\n(14 comments)"},{"timestamp":1498670904,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 4."},{"timestamp":1498670910,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 4:\n\nNew commits:\n    \n    commit 67c719094b6c3b1d5132f25e3a69e30d73132ab4\n    \n    TOOLS-1770 Add multi server support to `sdcadm create AGENT_INSTANCE`"},{"timestamp":1498670942,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1500335005,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 4:\n\n(7 comments)\n\nAfter manually removing amon-agent from my COAL headnode I did this:\n\n```\n[root@headnode (coal) ~]# sdcadm create -s headnode,headnode amon-agent\nUsing channel dev\n\nThis command will make the following changes:\n    download 1 image (6 MiB):\n        image 36505259-39fd-4710-ba6d-9143987730d9\n            (amon-agent@1.0.1)\n    create new instances of \"amon-agent\" service\n        using image 36505259-39fd-4710-ba6d-9143987730d9 (amon-agent@1.0.1)\n        on 2 servers:\n            564df2b2-10d4-1266-5ec7-c0de3bcecd08 (headnode)\n            564df2b2-10d4-1266-5ec7-c0de3bcecd08 (headnode)\n\nWould you like to continue? [y/N] y\n\nCreate work dir: /var/sdcadm/updates/20170717T234123Z\nDownloading image 36505259-39fd-4710-ba6d-9143987730d9\n    (amon-agent@1.0.1)\nImported image 36505259-39fd-4710-ba6d-9143987730d9\n    (amon-agent@1.0.1)\nVerifying that CNAPI is able to run agent updates\n...ing instance of amon-agent [\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003e] 100%        2\nsuccessfully created instance of agent amon-agent.\nCreated successfully (elapsed 41s).\n```\n\nI wonder if this should warn/error out earlier when attempting to install twice to the same server.\n\nWhen attempting this with a *vm* instance, I got two instances on the same server, which seems fine.\n\nThoughts?"},{"timestamp":1500479139,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 5."},{"timestamp":1500479145,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 5:\n\nNew commits:\n    \n    commit 2b49182e9e3f7d83f4ef79cdd78fe50fa2982449\n    \n    TOOLS-1770 Add multi server support to `sdcadm create AGENT_INSTANCE`"},{"timestamp":1500479176,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1500483613,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 5:\n\n(16 comments)\n\nDone Trent, including errors when there\u0027s an attempt to create two instances of the same service into the same server. \n\n\u003e (7 comments)\n \u003e \n \u003e After manually removing amon-agent from my COAL headnode I did\n \u003e this:\n \u003e \n \u003e ```\n \u003e [root@headnode (coal) ~]# sdcadm create -s headnode,headnode\n \u003e amon-agent\n \u003e Using channel dev\n \u003e \n \u003e This command will make the following changes:\n \u003e download 1 image (6 MiB):\n \u003e image 36505259-39fd-4710-ba6d-9143987730d9\n \u003e (amon-agent@1.0.1)\n \u003e create new instances of \"amon-agent\" service\n \u003e using image 36505259-39fd-4710-ba6d-9143987730d9 (amon-agent@1.0.1)\n \u003e on 2 servers:\n \u003e 564df2b2-10d4-1266-5ec7-c0de3bcecd08 (headnode)\n \u003e 564df2b2-10d4-1266-5ec7-c0de3bcecd08 (headnode)\n \u003e \n \u003e Would you like to continue? [y/N] y\n \u003e \n \u003e Create work dir: /var/sdcadm/updates/20170717T234123Z\n \u003e Downloading image 36505259-39fd-4710-ba6d-9143987730d9\n \u003e (amon-agent@1.0.1)\n \u003e Imported image 36505259-39fd-4710-ba6d-9143987730d9\n \u003e (amon-agent@1.0.1)\n \u003e Verifying that CNAPI is able to run agent updates\n \u003e ...ing instance of amon-agent [\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003e]\n \u003e 100%        2\n \u003e successfully created instance of agent amon-agent.\n \u003e Created successfully (elapsed 41s).\n \u003e ```\n \u003e \n \u003e I wonder if this should warn/error out earlier when attempting to\n \u003e install twice to the same server.\n \u003e \n \u003e When attempting this with a *vm* instance, I got two instances on\n \u003e the same server, which seems fine.\n \u003e \n \u003e Thoughts?"},{"timestamp":1501542019,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 5:\n\n(4 comments)"},{"timestamp":1501565430,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 6."},{"timestamp":1501565437,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 6:\n\nNew commits:\n    \n    commit 301c22b066a7369e9d3f67b148ea49fa9c2e3b86\n    \n    TOOLS-1770 Add multi server support to `sdcadm create AGENT_INSTANCE`"},{"timestamp":1501565463,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 6: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1501565489,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 6:\n\n(4 comments)\n\nThanks again for the CR Trent. All the suggested changes applied."},{"timestamp":1501610735,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 6:\n\n(1 comment)"},{"timestamp":1502100001,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 7."},{"timestamp":1502100007,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 7:\n\nNew commits:\n    \n    commit c31f919d64383ef6b5064ac4b99ef8dd087ce08d\n    \n    TOOLS-1770 Add multi server support to `sdcadm create AGENT_INSTANCE`"},{"timestamp":1502100039,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 7: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1502100444,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 7:\n\n(1 comment)\n\nDone in time for you to be back from vacation!"},{"timestamp":1502291679,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 8: Patch Set 7 was rebased"},{"timestamp":1502291710,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 8:\n\n\"make check\" passed ok"},{"timestamp":1502292285,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 8: Code-Review+1 Integration-Approval+1"},{"timestamp":1502292422,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 9: Commit message was updated."},{"timestamp":1502292452,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Pedro Palazón Candel"}],"currentPatchSet":{"number":"9","revision":"acc485287c24c1e84c7989151fe6b2568e45bc2b","parents":["107f9c78be7e929f3036451b4e3828a2ce0fcb72"],"ref":"refs/changes/04/2004/9","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1502292422,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1502100039,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1502292285,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1502292285,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1502292452,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/cli/do_create.js","type":"MODIFIED","insertions":60,"deletions":-39},{"file":"lib/common.js","type":"MODIFIED","insertions":18,"deletions":-11},{"file":"lib/post-setup/ha-manatee.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/procedures/create-service-instance-v1.js","type":"MODIFIED","insertions":58,"deletions":-9},{"file":"lib/procedures/index.js","type":"MODIFIED","insertions":161,"deletions":-124},{"file":"lib/procedures/update-agent-v1.js","type":"MODIFIED","insertions":24,"deletions":-10},{"file":"lib/procedures/update-dockerlogger.js","type":"MODIFIED","insertions":22,"deletions":-8},{"file":"lib/sdcadm.js","type":"MODIFIED","insertions":87,"deletions":-49},{"file":"lib/steps/index.js","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"lib/steps/servers.js","type":"ADDED","insertions":180,"deletions":0},{"file":"man/man1/sdcadm.1.ronn","type":"MODIFIED","insertions":4,"deletions":-3}],"sizeInsertions":618,"sizeDeletions":-256},"patchSets":[{"number":"1","revision":"d627b347f0dc348b898411bfc46dc07b30bba1d3","parents":["e23ab05382a68b98693cc9a288610455c480925e"],"ref":"refs/changes/04/2004/1","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1495725238,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1495725281,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/cli/do_create.js","type":"MODIFIED","insertions":70,"deletions":-31},{"file":"lib/procedures/create-service-instance-v1.js","type":"MODIFIED","insertions":48,"deletions":-8},{"file":"lib/procedures/index.js","type":"MODIFIED","insertions":154,"deletions":-122},{"file":"lib/procedures/update-agent-v1.js","type":"MODIFIED","insertions":19,"deletions":-6},{"file":"lib/procedures/update-dockerlogger.js","type":"MODIFIED","insertions":20,"deletions":-6},{"file":"lib/sdcadm.js","type":"MODIFIED","insertions":79,"deletions":-28},{"file":"lib/steps/index.js","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"lib/steps/servers.js","type":"ADDED","insertions":100,"deletions":0},{"file":"man/man1/sdcadm.1.ronn","type":"MODIFIED","insertions":4,"deletions":-3}],"sizeInsertions":497,"sizeDeletions":-206},{"number":"2","revision":"d6e5335e62a2ed6bfecbfe99c1bd9d5cffc522b0","parents":["e23ab05382a68b98693cc9a288610455c480925e"],"ref":"refs/changes/04/2004/2","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1496249698,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1497794460,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/procedures/index.js","line":42,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"This change is from the commited change for TOOLS-1784. I guess this CR just needs to be rebased. I\u0027m sorry I\u0027m so slow on these CRs. COuld you rebase this one, and then I promise I\u0027ll CR it on Monday?"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/cli/do_create.js","type":"MODIFIED","insertions":72,"deletions":-32},{"file":"lib/procedures/create-service-instance-v1.js","type":"MODIFIED","insertions":48,"deletions":-8},{"file":"lib/procedures/index.js","type":"MODIFIED","insertions":154,"deletions":-122},{"file":"lib/procedures/update-agent-v1.js","type":"MODIFIED","insertions":19,"deletions":-6},{"file":"lib/procedures/update-dockerlogger.js","type":"MODIFIED","insertions":20,"deletions":-6},{"file":"lib/sdcadm.js","type":"MODIFIED","insertions":79,"deletions":-28},{"file":"lib/steps/index.js","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"lib/steps/servers.js","type":"ADDED","insertions":100,"deletions":0},{"file":"man/man1/sdcadm.1.ronn","type":"MODIFIED","insertions":4,"deletions":-3}],"sizeInsertions":499,"sizeDeletions":-207},{"number":"3","revision":"3327b4552decb2dc70c3f3eb9a37271b94cb0b9c","parents":["c951a1f94244e55d4cb8eadc70577b3e19590a3b"],"ref":"refs/changes/04/2004/3","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1497886618,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1497896465,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/cli/do_create.js","line":56,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Call this arg `serverNames`."},{"file":"lib/cli/do_create.js","line":56,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/cli/do_create.js","line":85,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Change this message to:\n\nMust specify at least one server via \u0027-s, --servers\u0027 option"},{"file":"lib/cli/do_create.js","line":85,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/cli/do_create.js","line":301,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Add a comment that this is deprecated in favour of `-s,--servers`."},{"file":"lib/cli/do_create.js","line":301,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/cli/do_create.js","line":303,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Can drop the help string."},{"file":"lib/cli/do_create.js","line":303,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/cli/do_create.js","line":310,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"add: `helpArg: \u0027SERVERS\u0027` here and then update the man page"},{"file":"lib/cli/do_create.js","line":310,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/procedures/create-service-instance-v1.js","line":33,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Similar to update-agent-v1.js, this\u0027ll get to be a really long line if there are more than 1 or 2 servers involved."},{"file":"lib/procedures/create-service-instance-v1.js","line":33,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Moved to one line per server now."},{"file":"lib/procedures/index.js","line":870,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"duplicate if-block?"},{"file":"lib/procedures/index.js","line":870,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Definitely, fancy alt-shift-v combo here. Thanks!"},{"file":"lib/procedures/update-agent-v1.js","line":68,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"This\u0027ll get long-winded, won\u0027t it? I don\u0027t recall if we discussed having each server here on its own line."},{"file":"lib/procedures/update-agent-v1.js","line":68,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Yeah. Let\u0027s make them take the whole line"},{"file":"lib/sdcadm.js","line":2309,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"This needs to be updated to \u0027servers\u0027 (plural)."},{"file":"lib/sdcadm.js","line":2309,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"I think this should be updated to \u0027create-instances\u0027 (plural), here and everywhere it is used."},{"file":"lib/sdcadm.js","line":2309,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/sdcadm.js","line":2309,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/sdcadm.js","line":2350,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"I don\u0027t want to add this arg. Proposed patch to not do that, and for other changes to lib/steps/servers.js based on work I\u0027d had in progress for RFD 67:\n\nhttps://github.com/joyent/sdcadm/commit/61c692a501edf9464bd44336c2013df63300b4d3\n\nThoughts? I realize that *not* passing \u0027serverFromUuidOrHostname\u0027 through means some duplicate work calling CNAPI, but I think it is a cleaner separation. Also, eventually, I think \u0027sdcadm up\u0027 code paths could be updated to not need to list *all* CNAPI servers."},{"file":"lib/sdcadm.js","line":2350,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Looks like we can take advantage of the work you already made. Let\u0027s give it a try, yeah."},{"file":"lib/sdcadm.js","line":2658,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"I don\u0027t believe that is doing what you expect."},{"file":"lib/sdcadm.js","line":2658,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Are we even gonna have \"change.server\" defined now that we\u0027ve moved everything to \"change.servers\"? Otherwise, this was working fine previously, since ch.server is just a string containing server uuid at this point."},{"file":"lib/sdcadm.js","line":3607,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"What are these style changes driven by again? Not a big deal, but it would be nice to have separate changes for style changes in unrelated sections, if possible."},{"file":"lib/sdcadm.js","line":3607,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Every linter complains about line breaks before the \"+\" and not after them. I can roll this back, since there are a million pending fixes like these."},{"file":"man/man1/sdcadm.1.ronn","line":280,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Would prefer \"SERVERS\""}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/cli/do_create.js","type":"MODIFIED","insertions":72,"deletions":-32},{"file":"lib/common.js","type":"MODIFIED","insertions":18,"deletions":-11},{"file":"lib/procedures/create-service-instance-v1.js","type":"MODIFIED","insertions":48,"deletions":-8},{"file":"lib/procedures/index.js","type":"MODIFIED","insertions":143,"deletions":-118},{"file":"lib/procedures/update-agent-v1.js","type":"MODIFIED","insertions":19,"deletions":-6},{"file":"lib/procedures/update-dockerlogger.js","type":"MODIFIED","insertions":20,"deletions":-6},{"file":"lib/sdcadm.js","type":"MODIFIED","insertions":79,"deletions":-28},{"file":"lib/steps/index.js","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"lib/steps/servers.js","type":"ADDED","insertions":100,"deletions":0},{"file":"man/man1/sdcadm.1.ronn","type":"MODIFIED","insertions":4,"deletions":-3}],"sizeInsertions":506,"sizeDeletions":-214},{"number":"4","revision":"dfa966af5a91b07a271945011a84ec8424dce6ba","parents":["c951a1f94244e55d4cb8eadc70577b3e19590a3b"],"ref":"refs/changes/04/2004/4","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1498670904,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1498670942,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/cli/do_create.js","line":65,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"That was my bad in my patch: That should be \"-s, --servers\"."},{"file":"lib/cli/do_create.js","line":65,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/cli/do_create.js","line":139,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"No longer need this guard. The steps above will catch an empty list of servers to work with."},{"file":"lib/cli/do_create.js","line":139,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"True. Done"},{"file":"lib/procedures/create-service-instance-v1.js","line":46,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"How about this:\n\n\n```\nCreateServiceInstanceV1.prototype.summarize \u003d function csiv1Summarize() {\n    return this.changes.map(function (ch) {\n        var out \u003d sprintf(\u0027create \"%s\" service instance\\n\u0027 +\n            \u0027    using image %s (%s@%s)\\n\u0027,\n            ch.service.name, ch.image.uuid, ch.image.name, ch.image.version);\n\n        if (ch.servers.length \u003d\u003d\u003d 1) {\n            out +\u003d sprintf(\u0027    on server %s\u0027, ch.servers[0]);\n        } else {\n            out +\u003d util.format(\u0027    on %d servers:\u0027, ch.servers.length);\n            out \u003d [out].concat(\n                ch.servers.map(function (serv) {\n                    return common.indent(serv, 8);\n            })).join(\u0027\\n\u0027);\n        }\n        return out;\n    }).join(\u0027\\n\u0027);\n};\n```\n\nNotes:\n- meh on the image line going \u003e80 chars if the version is huge\n- \"on *server\" line starts on a separate line for both cases"},{"file":"lib/procedures/create-service-instance-v1.js","line":46,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Sold!"},{"file":"lib/sdcadm.js","line":2384,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"This option was dropped. This block should be removed."},{"file":"lib/sdcadm.js","line":2520,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"The option was dropped, so this will never have a value yet. This if-block shold be removed (per  the patch I had earlier: https://github.com/joyent/sdcadm/commit/61c692a501edf9464bd44336c2013df63300b4d3)"},{"file":"lib/sdcadm.js","line":2656,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Still an issue here, I think. serverFromUuidOrHostname isn\u0027t an array for integer-indexing."},{"file":"lib/sdcadm.js","line":2812,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Not sure I love this change. It means that an accidental \u0027typeTarg\u0027 value other than \u0027service\u0027 or \u0027instance\u0027 could slip through. There should be the assert or a final `else`-block that asserts if it gets there."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/cli/do_create.js","type":"MODIFIED","insertions":64,"deletions":-38},{"file":"lib/common.js","type":"MODIFIED","insertions":18,"deletions":-11},{"file":"lib/post-setup/ha-manatee.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/procedures/create-service-instance-v1.js","type":"MODIFIED","insertions":59,"deletions":-8},{"file":"lib/procedures/index.js","type":"MODIFIED","insertions":142,"deletions":-123},{"file":"lib/procedures/update-agent-v1.js","type":"MODIFIED","insertions":24,"deletions":-10},{"file":"lib/procedures/update-dockerlogger.js","type":"MODIFIED","insertions":22,"deletions":-8},{"file":"lib/sdcadm.js","type":"MODIFIED","insertions":86,"deletions":-38},{"file":"lib/steps/index.js","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"lib/steps/servers.js","type":"ADDED","insertions":180,"deletions":0},{"file":"man/man1/sdcadm.1.ronn","type":"MODIFIED","insertions":4,"deletions":-3}],"sizeInsertions":603,"sizeDeletions":-242},{"number":"5","revision":"b98f2f7f0c409e9e0781535abca5f93dd0af9019","parents":["8052f141388fd94a608f719f2205c031d7c94361"],"ref":"refs/changes/04/2004/5","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1500479139,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1500479176,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/sdcadm.js","line":2384,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"earlier comment: \"This option was dropped. This block should be removed.\""},{"file":"lib/sdcadm.js","line":2384,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/sdcadm.js","line":2520,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"comment from earlier: The option was dropped, so this will never have a value yet. This if-block shold be removed (per the patch I had earlier: https://github.com/joyent/sdcadm/commit/61c692a501edf9464bd44336c2013df63300b4d3)"},{"file":"lib/sdcadm.js","line":2520,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/sdcadm.js","line":2659,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"From a couple previous comments: \n\n1. It looks like with change.type\u003d\u003d\u003d\u0027delete\u0027 there can be a case with `ch.server`.\n2. Before this change `servers` was an array of server objects. *Now* `serverFromUuidOrHostname` is indexed by *uuid* or *hostname*. However this new code is attempting to lookup in that mapping by index number. That\u0027s never going to match.  With this change I\u0027d expect a case of change.type\u003d\u003d\u003d\u0027delete\u0027 to be broken. Granted there isn\u0027t a \u0027sdcadm ...\u0027 command that passes change.type\u003d\u003d\u003d\u0027delete\u0027 yet."},{"file":"lib/sdcadm.js","line":2659,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"lib/sdcadm.js","line":2812,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Comment from before:\n\"Not sure I love this change. It means that an accidental \u0027typeTarg\u0027 value other than \u0027service\u0027 or \u0027instance\u0027 could slip through. There should be the assert or a final `else`-block that asserts if it gets there.\""},{"file":"lib/sdcadm.js","line":2812,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/cli/do_create.js","type":"MODIFIED","insertions":60,"deletions":-39},{"file":"lib/common.js","type":"MODIFIED","insertions":18,"deletions":-11},{"file":"lib/post-setup/ha-manatee.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/procedures/create-service-instance-v1.js","type":"MODIFIED","insertions":58,"deletions":-9},{"file":"lib/procedures/index.js","type":"MODIFIED","insertions":161,"deletions":-124},{"file":"lib/procedures/update-agent-v1.js","type":"MODIFIED","insertions":24,"deletions":-10},{"file":"lib/procedures/update-dockerlogger.js","type":"MODIFIED","insertions":22,"deletions":-8},{"file":"lib/sdcadm.js","type":"MODIFIED","insertions":86,"deletions":-38},{"file":"lib/steps/index.js","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"lib/steps/servers.js","type":"ADDED","insertions":180,"deletions":0},{"file":"man/man1/sdcadm.1.ronn","type":"MODIFIED","insertions":4,"deletions":-3}],"sizeInsertions":617,"sizeDeletions":-245},{"number":"6","revision":"5d9852ede0f0bc7a49f908b61854d2bc467833e8","parents":["8052f141388fd94a608f719f2205c031d7c94361"],"ref":"refs/changes/04/2004/6","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1501565430,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1501565463,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/sdcadm.js","line":2646,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"That isn\u0027t right, is it? \n- `ch.servers` won\u0027t be defined for a change object that is type\u003d\u0027delete\u0027 and just sets `ch.server`\n- Also, `ch.servers` would be an array of server objects? or perhaps an array of server names (hostname or uuid). Not sure.\n\nWouldn\u0027t you want to lookup serverFromUuidOrHostname[ch.server]?  I\u0027m not positive though."},{"file":"lib/sdcadm.js","line":2646,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Indeed, that\u0027s what I was pretending todo. Fixed now."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/cli/do_create.js","type":"MODIFIED","insertions":60,"deletions":-39},{"file":"lib/common.js","type":"MODIFIED","insertions":18,"deletions":-11},{"file":"lib/post-setup/ha-manatee.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/procedures/create-service-instance-v1.js","type":"MODIFIED","insertions":58,"deletions":-9},{"file":"lib/procedures/index.js","type":"MODIFIED","insertions":161,"deletions":-124},{"file":"lib/procedures/update-agent-v1.js","type":"MODIFIED","insertions":24,"deletions":-10},{"file":"lib/procedures/update-dockerlogger.js","type":"MODIFIED","insertions":22,"deletions":-8},{"file":"lib/sdcadm.js","type":"MODIFIED","insertions":87,"deletions":-49},{"file":"lib/steps/index.js","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"lib/steps/servers.js","type":"ADDED","insertions":180,"deletions":0},{"file":"man/man1/sdcadm.1.ronn","type":"MODIFIED","insertions":4,"deletions":-3}],"sizeInsertions":618,"sizeDeletions":-256},{"number":"7","revision":"64538d54fb4f91fee6e97602fa3dd224677118f4","parents":["8052f141388fd94a608f719f2205c031d7c94361"],"ref":"refs/changes/04/2004/7","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1502100001,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1502100039,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/cli/do_create.js","type":"MODIFIED","insertions":60,"deletions":-39},{"file":"lib/common.js","type":"MODIFIED","insertions":18,"deletions":-11},{"file":"lib/post-setup/ha-manatee.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/procedures/create-service-instance-v1.js","type":"MODIFIED","insertions":58,"deletions":-9},{"file":"lib/procedures/index.js","type":"MODIFIED","insertions":161,"deletions":-124},{"file":"lib/procedures/update-agent-v1.js","type":"MODIFIED","insertions":24,"deletions":-10},{"file":"lib/procedures/update-dockerlogger.js","type":"MODIFIED","insertions":22,"deletions":-8},{"file":"lib/sdcadm.js","type":"MODIFIED","insertions":87,"deletions":-49},{"file":"lib/steps/index.js","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"lib/steps/servers.js","type":"ADDED","insertions":180,"deletions":0},{"file":"man/man1/sdcadm.1.ronn","type":"MODIFIED","insertions":4,"deletions":-3}],"sizeInsertions":618,"sizeDeletions":-256},{"number":"8","revision":"fecb4526e6e622aa3faf38f0e81ec11a7ca1c4f0","parents":["107f9c78be7e929f3036451b4e3828a2ce0fcb72"],"ref":"refs/changes/04/2004/8","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1502291679,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1502100039,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1502292285,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1502292285,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/cli/do_create.js","type":"MODIFIED","insertions":60,"deletions":-39},{"file":"lib/common.js","type":"MODIFIED","insertions":18,"deletions":-11},{"file":"lib/post-setup/ha-manatee.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/procedures/create-service-instance-v1.js","type":"MODIFIED","insertions":58,"deletions":-9},{"file":"lib/procedures/index.js","type":"MODIFIED","insertions":161,"deletions":-124},{"file":"lib/procedures/update-agent-v1.js","type":"MODIFIED","insertions":24,"deletions":-10},{"file":"lib/procedures/update-dockerlogger.js","type":"MODIFIED","insertions":22,"deletions":-8},{"file":"lib/sdcadm.js","type":"MODIFIED","insertions":87,"deletions":-49},{"file":"lib/steps/index.js","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"lib/steps/servers.js","type":"ADDED","insertions":180,"deletions":0},{"file":"man/man1/sdcadm.1.ronn","type":"MODIFIED","insertions":4,"deletions":-3}],"sizeInsertions":618,"sizeDeletions":-256},{"number":"9","revision":"acc485287c24c1e84c7989151fe6b2568e45bc2b","parents":["107f9c78be7e929f3036451b4e3828a2ce0fcb72"],"ref":"refs/changes/04/2004/9","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1502292422,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1502100039,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1502292285,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1502292285,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1502292452,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/cli/do_create.js","type":"MODIFIED","insertions":60,"deletions":-39},{"file":"lib/common.js","type":"MODIFIED","insertions":18,"deletions":-11},{"file":"lib/post-setup/ha-manatee.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/procedures/create-service-instance-v1.js","type":"MODIFIED","insertions":58,"deletions":-9},{"file":"lib/procedures/index.js","type":"MODIFIED","insertions":161,"deletions":-124},{"file":"lib/procedures/update-agent-v1.js","type":"MODIFIED","insertions":24,"deletions":-10},{"file":"lib/procedures/update-dockerlogger.js","type":"MODIFIED","insertions":22,"deletions":-8},{"file":"lib/sdcadm.js","type":"MODIFIED","insertions":87,"deletions":-49},{"file":"lib/steps/index.js","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"lib/steps/servers.js","type":"ADDED","insertions":180,"deletions":0},{"file":"man/man1/sdcadm.1.ronn","type":"MODIFIED","insertions":4,"deletions":-3}],"sizeInsertions":618,"sizeDeletions":-256}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}]}