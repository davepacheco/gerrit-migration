{"project":"joyent/illumos-joyent","branch":"master","id":"Ib9038e595a38d5dc6b5956c16340845eaa3210a1","number":"1978","subject":"OS-6065 add support for xsaveopt or xsavec for improved context switching","owner":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"url":"https://cr.joyent.us/1978","commitMessage":"OS-6065 add support for xsaveopt or xsavec for improved context switching\n","createdOn":1495203279,"lastUpdated":1495476146,"open":false,"status":"ABANDONED","comments":[{"timestamp":1495203279,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 1."},{"timestamp":1495213777,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 1: Code-Review+1"},{"timestamp":1495219026,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 1: Code-Review+1\n\n(1 comment)"},{"timestamp":1495220465,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 1:\n\nI\u0027ve tested this by running in my VM where I\u0027ve used mdb to confirm that fpsave_ctxt is still set to the old xsave_ctxt function. I\u0027ve run on the skylake and used mdb to confirm that fpsave_ctxt is set to the new xsaveopt_ctxt. I\u0027ve run some FP code and an lx-branded zone on the skylake without any problems."},{"timestamp":1495226613,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 1:\n\nPatrick and I spent some time looking at the AMD docs and it is not completely clear that the \"Error Zero\" feature won\u0027t co-exist with xsaveopt. So, to be safe, I added the handling for that into the xsaveopt_ctxt code for now. I will be redoing all of the \"Error Zero\" handling next."},{"timestamp":1495226635,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 2."},{"timestamp":1495229656,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 3."},{"timestamp":1495229703,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 3:\n\nPatrick caught another bug from the previous commit with the wrong register usage in xsave_ctxt which I just rolled in here."},{"timestamp":1495460500,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 4."},{"timestamp":1495476146,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Abandoned"}],"currentPatchSet":{"number":"4","revision":"b9038e595a38d5dc6b5956c16340845eaa3210a1","parents":["66f992fb40fa29149392c5c81e1ae091ddf84dbd"],"ref":"refs/changes/78/1978/4","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1495460500,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/i86pc/os/fpu_subr.c","type":"MODIFIED","insertions":12,"deletions":-2},{"file":"usr/src/uts/i86pc/sys/asm_misc.h","type":"MODIFIED","insertions":1,"deletions":-19},{"file":"usr/src/uts/intel/ia32/ml/exception.s","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/intel/ia32/ml/float.s","type":"MODIFIED","insertions":65,"deletions":-10},{"file":"usr/src/uts/intel/ia32/os/fpu.c","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/intel/sys/fp.h","type":"MODIFIED","insertions":38,"deletions":-14}],"sizeInsertions":119,"sizeDeletions":-48},"patchSets":[{"number":"1","revision":"4f711a3d686fc05f7cb823a867598c6ef008e858","parents":["66f992fb40fa29149392c5c81e1ae091ddf84dbd"],"ref":"refs/changes/78/1978/1","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1495203279,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1495213777,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1495219026,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"comments":[{"file":"usr/src/uts/intel/sys/fp.h","line":259,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Including the table was a nice touch"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/i86pc/os/fpu_subr.c","type":"MODIFIED","insertions":12,"deletions":-2},{"file":"usr/src/uts/i86pc/sys/asm_misc.h","type":"MODIFIED","insertions":1,"deletions":-19},{"file":"usr/src/uts/intel/ia32/ml/float.s","type":"MODIFIED","insertions":42,"deletions":-7},{"file":"usr/src/uts/intel/ia32/os/fpu.c","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/intel/sys/fp.h","type":"MODIFIED","insertions":38,"deletions":-14}],"sizeInsertions":94,"sizeDeletions":-43},{"number":"2","revision":"01127c295070b8e3a07c33f49f38a8bf340685dc","parents":["66f992fb40fa29149392c5c81e1ae091ddf84dbd"],"ref":"refs/changes/78/1978/2","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1495226635,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/i86pc/os/fpu_subr.c","type":"MODIFIED","insertions":12,"deletions":-2},{"file":"usr/src/uts/i86pc/sys/asm_misc.h","type":"MODIFIED","insertions":1,"deletions":-19},{"file":"usr/src/uts/intel/ia32/ml/float.s","type":"MODIFIED","insertions":64,"deletions":-9},{"file":"usr/src/uts/intel/ia32/os/fpu.c","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/intel/sys/fp.h","type":"MODIFIED","insertions":38,"deletions":-14}],"sizeInsertions":116,"sizeDeletions":-45},{"number":"3","revision":"78946bd2c75ff687a0a0ec61cb0613e12ab6b4a3","parents":["66f992fb40fa29149392c5c81e1ae091ddf84dbd"],"ref":"refs/changes/78/1978/3","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1495229656,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/i86pc/os/fpu_subr.c","type":"MODIFIED","insertions":12,"deletions":-2},{"file":"usr/src/uts/i86pc/sys/asm_misc.h","type":"MODIFIED","insertions":1,"deletions":-19},{"file":"usr/src/uts/intel/ia32/ml/float.s","type":"MODIFIED","insertions":65,"deletions":-10},{"file":"usr/src/uts/intel/ia32/os/fpu.c","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/intel/sys/fp.h","type":"MODIFIED","insertions":38,"deletions":-14}],"sizeInsertions":117,"sizeDeletions":-46},{"number":"4","revision":"b9038e595a38d5dc6b5956c16340845eaa3210a1","parents":["66f992fb40fa29149392c5c81e1ae091ddf84dbd"],"ref":"refs/changes/78/1978/4","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1495460500,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/i86pc/os/fpu_subr.c","type":"MODIFIED","insertions":12,"deletions":-2},{"file":"usr/src/uts/i86pc/sys/asm_misc.h","type":"MODIFIED","insertions":1,"deletions":-19},{"file":"usr/src/uts/intel/ia32/ml/exception.s","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/intel/ia32/ml/float.s","type":"MODIFIED","insertions":65,"deletions":-10},{"file":"usr/src/uts/intel/ia32/os/fpu.c","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/intel/sys/fp.h","type":"MODIFIED","insertions":38,"deletions":-14}],"sizeInsertions":119,"sizeDeletions":-48}],"allReviewers":[{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}]}