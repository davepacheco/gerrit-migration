{"project":"joyent/sdc-config-agent","branch":"master","id":"Ia1ae27747f1950e71922563ad3371a5bc74665c7","number":"4167","subject":"TRITON-478 agent builds fail as non-root when postinstall.sh writes to / Reviewed by: Trent Mick \u003ctrentm@gmail.com\u003e Approved by: Trent Mick \u003ctrentm@gmail.com\u003e","owner":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"url":"https://cr.joyent.us/4167","commitMessage":"TRITON-478 agent builds fail as non-root when postinstall.sh writes to /\nReviewed by: Trent Mick \u003ctrentm@gmail.com\u003e\nApproved by: Trent Mick \u003ctrentm@gmail.com\u003e\n","createdOn":1528458117,"lastUpdated":1528993223,"open":false,"status":"MERGED","comments":[{"timestamp":1528458117,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Uploaded patch set 1."},{"timestamp":1528482378,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1528491099,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1528739616,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Uploaded patch set 2."},{"timestamp":1528739642,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1528755899,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1528785844,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Uploaded patch set 3: Commit message was updated."},{"timestamp":1528786333,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Patch Set 3:\n\nRemoved the commit message that describes the change.\n\nI couldn\u0027t see how else to describe a gerrit patch set, and thought that seemed like the obvious way, expecting that we\u0027d have hooks to detect incorrect push messages for actual commits?\n\nPerhaps adding a \"0\" code review from the author like this is the way to describe what\u0027s changed?"},{"timestamp":1528913402,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 3:\n\n\u003e I couldn\u0027t see how else to describe a gerrit patch set\n\nTwo ways that I see.\n\n1. If you are using `grr` (or the process that it encourages), you just make another commit on your feature branch and describe your incremental change in that commit message. Then when `grr` updates the CR, it also adds a comment on the CR providing the commit message. You can see an example for the \"Patch set 2\" comment for https://cr.joyent.us/#/c/3236/\n\n2. You could manually add a comment on the CR after pushing your new patch set.\n\n\n\u003e expecting that we\u0027d have hooks to detect incorrect push messages for actual commits?\n\nNope. There has been talk of having the commit message for merge be handled by a Gerrit bot or process, but nothing implemented.\n\n\n\n\u003e Perhaps adding a \"0\" code review from the author like this is the way to describe what\u0027s changed?\n\nAh, if that is what you mean by my \"2.\" above, then yes... adding a review that doesn\u0027t update the Code-Review or Integration-Approval flags is what I mean by \"add a comment\"."},{"timestamp":1528913643,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 3: Code-Review+1 Integration-Approval+1"},{"timestamp":1528968117,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Uploaded patch set 4: Commit message was updated."},{"timestamp":1528993223,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Tim Foster"}],"currentPatchSet":{"number":"4","revision":"a1ae27747f1950e71922563ad3371a5bc74665c7","parents":["1575b94a47ac6492e8f6aed8669377ce478cc3f3"],"ref":"refs/changes/67/4167/4","uploader":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"createdOn":1528968117,"author":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1528739642,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1528913643,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1528913643,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1528993223,"by":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"npm/postinstall.sh","type":"MODIFIED","insertions":6,"deletions":-1}],"sizeInsertions":6,"sizeDeletions":-1},"patchSets":[{"number":"1","revision":"5270f30130c033de15d1104d94c441877bd72496","parents":["1575b94a47ac6492e8f6aed8669377ce478cc3f3"],"ref":"refs/changes/67/4167/1","uploader":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"createdOn":1528458117,"author":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1528482378,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"npm/postinstall.sh","line":23,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Can we move the \"Skipping ...\" block down here after the `set -o` calls that are used for trace logging and error handling?"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"npm/postinstall.sh","type":"MODIFIED","insertions":6,"deletions":-1}],"sizeInsertions":6,"sizeDeletions":-1},{"number":"2","revision":"a332ef60bb1fe50d9bc8615c514658f8006191b8","parents":["1575b94a47ac6492e8f6aed8669377ce478cc3f3"],"ref":"refs/changes/67/4167/2","uploader":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"createdOn":1528739616,"author":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1528739642,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"/COMMIT_MSG","line":8,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"FWIW the suggested/proscribed rule for commit messages (https://github.com/joyent/eng/blob/master/docs/index.md#commit-comments) is to include no more than the issue id and title, and the reviewed-by/approved-by lines. IOW, the \"move check to after trace setup\" shouldn\u0027t appear here."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"npm/postinstall.sh","type":"MODIFIED","insertions":6,"deletions":-1}],"sizeInsertions":6,"sizeDeletions":-1},{"number":"3","revision":"4219b62aa9d1157d2c0250ac20091ba39b34ed48","parents":["1575b94a47ac6492e8f6aed8669377ce478cc3f3"],"ref":"refs/changes/67/4167/3","uploader":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"createdOn":1528785844,"author":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1528739642,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1528913643,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1528913643,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"npm/postinstall.sh","type":"MODIFIED","insertions":6,"deletions":-1}],"sizeInsertions":6,"sizeDeletions":-1},{"number":"4","revision":"a1ae27747f1950e71922563ad3371a5bc74665c7","parents":["1575b94a47ac6492e8f6aed8669377ce478cc3f3"],"ref":"refs/changes/67/4167/4","uploader":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"createdOn":1528968117,"author":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1528739642,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1528913643,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1528913643,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1528993223,"by":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"npm/postinstall.sh","type":"MODIFIED","insertions":6,"deletions":-1}],"sizeInsertions":6,"sizeDeletions":-1}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"}]}