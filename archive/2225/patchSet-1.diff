commit f00244fcf8e906c3f6fcc470e0840f5b07ec5ae5 (refs/changes/25/2225/1)
Author: Cody Peter Mello <cody.mello@joyent.com>
Date:   2017-07-18T01:04:25+00:00 (2 years, 3 months ago)
    
    DOCKER-1070 Don't recreate "sdc_docker" rule when it's been disabled

diff --git a/lib/backends/sdc/containers.js b/lib/backends/sdc/containers.js
index b0ac7b5..c891155 100644
--- a/lib/backends/sdc/containers.js
+++ b/lib/backends/sdc/containers.js
@@ -264,10 +264,6 @@ function addExposeFirewallRules(opts, payload, callback) {
                 continue;
             }
 
-            if (!rules[r].enabled) {
-                continue;
-            }
-
             if (parsed.action !== 'allow') {
                 continue;
             }
@@ -285,14 +281,20 @@ function addExposeFirewallRules(opts, payload, callback) {
                 tcpRuleFound = true;
                 opts.log.debug({ rule: rules[r] },
                     'TCP docker expose rule found: not adding');
-                addRulesToPayload(payload, rules[r]);
+
+                if (parsed.enabled) {
+                    addRulesToPayload(payload, rules[r]);
+                }
             }
 
             if (parsed.protocol === 'udp' && !udpRuleFound) {
                 udpRuleFound = true;
                 opts.log.debug({ rule: rules[r] },
                     'UDP docker expose rule found: not adding');
-                addRulesToPayload(payload, rules[r]);
+
+                if (parsed.enabled) {
+                    addRulesToPayload(payload, rules[r]);
+                }
             }
         }
 
