{"project":"joyent/node-mname","branch":"master","id":"I0a9088405101b35853ecd3103e4d4fa3ccb2a248","number":"2341","subject":"joyent/node-mname#21 support for sig0 signatures in addition to tsig ?","owner":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"url":"https://cr.joyent.us/2341","commitMessage":"joyent/node-mname#21 support for sig0 signatures in addition to tsig ?\n","createdOn":1502123595,"lastUpdated":1525110601,"open":true,"status":"NEW","comments":[{"timestamp":1502123595,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Uploaded patch set 1."},{"timestamp":1502123617,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing-1\n\n(4 comments)\n\n\"make check\" exited with status 2"},{"timestamp":1502124154,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Uploaded patch set 2."},{"timestamp":1502124176,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing-1\n\n(1 comment)\n\n\"make check\" exited with status 2"},{"timestamp":1502128071,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Uploaded patch set 3."},{"timestamp":1502128095,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1502132758,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 3:\n\n(15 comments)\n\nSome preliminary comments in-line. I also wonder if we should consider support for async signature generation (i.e. instead of providing the actual data of a key to sign with, provide a callback function that takes a callback argument and can go do i/o to get the payload signed -- this would make it possible to use keys in an SSH agent to sign things). Any thoughts?"},{"timestamp":1502144730,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Uploaded patch set 4."},{"timestamp":1502144766,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1502145035,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Uploaded patch set 5."},{"timestamp":1502145074,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1502323412,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Uploaded patch set 6: Commit message was updated."},{"timestamp":1505254640,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Uploaded patch set 7."},{"timestamp":1505254668,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 7: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1525110574,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Uploaded patch set 8."},{"timestamp":1525110601,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 8: CI-Testing+1\n\n\"make check\" passed ok"}],"currentPatchSet":{"number":"8","revision":"0a9088405101b35853ecd3103e4d4fa3ccb2a248","parents":["3412a7178a1bfe5130714b8cbc8cf466862ebfd2"],"ref":"refs/changes/41/2341/8","uploader":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"createdOn":1525110574,"author":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1525110601,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":25,"deletions":0},{"file":"lib/protocol.js","type":"MODIFIED","insertions":75,"deletions":0},{"file":"lib/query.js","type":"MODIFIED","insertions":54,"deletions":-18},{"file":"lib/server.js","type":"MODIFIED","insertions":25,"deletions":-2},{"file":"lib/sig0.js","type":"ADDED","insertions":230,"deletions":0},{"file":"lib/tsig.js","type":"MODIFIED","insertions":5,"deletions":0},{"file":"test/sig0.test.js","type":"ADDED","insertions":318,"deletions":0}],"sizeInsertions":732,"sizeDeletions":-20},"patchSets":[{"number":"1","revision":"60634951ee36e328997791f32af0e49624d975f7","parents":["b900b1562e47b0bc0406f83337aacd945b9424f3"],"ref":"refs/changes/41/2341/1","uploader":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"createdOn":1502123595,"author":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1502123617,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/query.js","line":206,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"warning: redeclaration of result"},{"file":"lib/sig0.js","line":144,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"warning: missing semicolon"},{"file":"lib/sig0.js","line":195,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"warning: missing semicolon"},{"file":"lib/sig0.js","line":207,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"warning: missing semicolon"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":25,"deletions":0},{"file":"lib/protocol.js","type":"MODIFIED","insertions":73,"deletions":0},{"file":"lib/query.js","type":"MODIFIED","insertions":49,"deletions":-16},{"file":"lib/sig0.js","type":"ADDED","insertions":220,"deletions":0},{"file":"lib/tsig.js","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"test/sig0.test.js","type":"ADDED","insertions":324,"deletions":0}],"sizeInsertions":693,"sizeDeletions":-19},{"number":"2","revision":"72d31d8cadf75e38ebad89183dfa2b24f689568d","parents":["b900b1562e47b0bc0406f83337aacd945b9424f3"],"ref":"refs/changes/41/2341/2","uploader":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"createdOn":1502124154,"author":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1502124176,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/sig0.js","line":144,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"warning: missing semicolon"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":25,"deletions":0},{"file":"lib/protocol.js","type":"MODIFIED","insertions":73,"deletions":0},{"file":"lib/query.js","type":"MODIFIED","insertions":49,"deletions":-16},{"file":"lib/sig0.js","type":"ADDED","insertions":220,"deletions":0},{"file":"lib/tsig.js","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"test/sig0.test.js","type":"ADDED","insertions":324,"deletions":0}],"sizeInsertions":693,"sizeDeletions":-19},{"number":"3","revision":"9ab088a845cbdf7f8fc3f5ff537063f2e65402ed","parents":["b900b1562e47b0bc0406f83337aacd945b9424f3"],"ref":"refs/changes/41/2341/3","uploader":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"createdOn":1502128071,"author":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1502128095,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"/COMMIT_MSG","line":7,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Please make a bug on the github issues for this repo and make the commit msg the ticket id + desc."},{"file":"README.md","line":87,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Usually best to capitalise HMAC in documentation"},{"file":"lib/query.js","line":184,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Other continuations in this repo aren\u0027t bracket-aligned that I can see (the style has been to just indent 4 spaces for the continuation). I\u0027m not hugely opinionated about style, but unless you want to go around and change all the others in the repo... ;)"},{"file":"lib/query.js","line":218,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"console.log in libraries is generally frowned upon -- if we\u0027re going to log something it should just be via a logger that the application gave us (which you\u0027re already doing below, so we should probably just drop this line I think?)"},{"file":"lib/query.js","line":326,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"I don\u0027t know this change is really relevant/necessary. :)"},{"file":"lib/sig0.js","line":102,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"The RFC does specify how to do these, so we should probably support it. It\u0027s very useful for AXFR/IXFR and friends. If we don\u0027t do it here we should open a separate bug for adding it later, I think"},{"file":"lib/sig0.js","line":159,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Just for consistency it\u0027d be nice to bracket the return value here."},{"file":"lib/tsig.js","line":136,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Would you mind explaining why this change is needed? Is the old code broken in some particular way? Because it\u0027s not modifying the original message either (by making a new object here with its prototype set to the old one, which is more efficient than doing a re-de-serialize like this)\n\nIf it is broken, a separate bug might be nice to put in the commit msg."},{"file":"test/sig0.test.js","line":39,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"I\u0027m not really a fan of abbreviating \"private key\" as \"prikey\" -- it\u0027s not an abbreviation used in the RFC or really that I\u0027ve seen anywhere outside a few small Java libraries? \"privateKey\" and \"publlicKey\" are more commonly used in node. I think we should stick to conventional naming unless there\u0027s a really good reason to do something different here."},{"file":"test/sig0.test.js","line":114,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"I think we should add some API to Query to sign responses that isn\u0027t just setting a property like this. It feels too much like getting up in the guts of the Query class (which already has a terrible interface), and seems potentially annoying to keep compatibility with later.\n\nWe probably want an interface to ask for responses to be HMAC signed with TSIG regardless of whether the client used TSIG or not, too. It\u0027s not strictly RFC-compliant to do that, but other servers support it so we probably should as well.\n\nSo we should make a new function to handle both, I think."},{"file":"test/sig0.test.js","line":134,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Is this necessary? Also, it\u0027s indented differently to the rest of the file."},{"file":"test/sig0.test.js","line":237,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Needs a semi-colon here. I\u0027m kinda surprised the linter didn\u0027t pick it up."},{"file":"test/sig0.test.js","line":238,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Trailing whitespace"},{"file":"test/sig0.test.js","line":253,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Continuations are generally 4 spaces (half a tabstop), not 5."},{"file":"test/sig0.test.js","line":285,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"s/out/our/?"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":25,"deletions":0},{"file":"lib/protocol.js","type":"MODIFIED","insertions":75,"deletions":0},{"file":"lib/query.js","type":"MODIFIED","insertions":55,"deletions":-18},{"file":"lib/sig0.js","type":"ADDED","insertions":224,"deletions":0},{"file":"lib/tsig.js","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"test/sig0.test.js","type":"ADDED","insertions":324,"deletions":0}],"sizeInsertions":706,"sizeDeletions":-21},{"number":"4","revision":"1181959207cdb8decaf1e25a43397e63b651c913","parents":["b900b1562e47b0bc0406f83337aacd945b9424f3"],"ref":"refs/changes/41/2341/4","uploader":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"createdOn":1502144730,"author":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1502144766,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":25,"deletions":0},{"file":"lib/protocol.js","type":"MODIFIED","insertions":75,"deletions":0},{"file":"lib/query.js","type":"MODIFIED","insertions":54,"deletions":-18},{"file":"lib/sig0.js","type":"ADDED","insertions":224,"deletions":0},{"file":"test/sig0.test.js","type":"ADDED","insertions":320,"deletions":0}],"sizeInsertions":698,"sizeDeletions":-18},{"number":"5","revision":"fb79b022d4465a4e603ce3df6a3c8abd57014602","parents":["b900b1562e47b0bc0406f83337aacd945b9424f3"],"ref":"refs/changes/41/2341/5","uploader":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"createdOn":1502145035,"author":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1502145074,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":25,"deletions":0},{"file":"lib/protocol.js","type":"MODIFIED","insertions":75,"deletions":0},{"file":"lib/query.js","type":"MODIFIED","insertions":54,"deletions":-18},{"file":"lib/sig0.js","type":"ADDED","insertions":224,"deletions":0},{"file":"test/sig0.test.js","type":"ADDED","insertions":320,"deletions":0}],"sizeInsertions":698,"sizeDeletions":-18},{"number":"6","revision":"2011228e6579a355b35d4aa4f0e4b5ed4a37fbc4","parents":["b900b1562e47b0bc0406f83337aacd945b9424f3"],"ref":"refs/changes/41/2341/6","uploader":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"createdOn":1502323412,"author":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1502145074,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":25,"deletions":0},{"file":"lib/protocol.js","type":"MODIFIED","insertions":75,"deletions":0},{"file":"lib/query.js","type":"MODIFIED","insertions":54,"deletions":-18},{"file":"lib/sig0.js","type":"ADDED","insertions":224,"deletions":0},{"file":"test/sig0.test.js","type":"ADDED","insertions":320,"deletions":0}],"sizeInsertions":698,"sizeDeletions":-18},{"number":"7","revision":"9672ea5953e3356750806a2cfdbf8b60c10804af","parents":["b900b1562e47b0bc0406f83337aacd945b9424f3"],"ref":"refs/changes/41/2341/7","uploader":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"createdOn":1505254640,"author":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1505254668,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":25,"deletions":0},{"file":"lib/protocol.js","type":"MODIFIED","insertions":75,"deletions":0},{"file":"lib/query.js","type":"MODIFIED","insertions":54,"deletions":-18},{"file":"lib/server.js","type":"MODIFIED","insertions":26,"deletions":-3},{"file":"lib/sig0.js","type":"ADDED","insertions":230,"deletions":0},{"file":"lib/tsig.js","type":"MODIFIED","insertions":5,"deletions":0},{"file":"test/sig0.test.js","type":"ADDED","insertions":318,"deletions":0}],"sizeInsertions":733,"sizeDeletions":-21},{"number":"8","revision":"0a9088405101b35853ecd3103e4d4fa3ccb2a248","parents":["3412a7178a1bfe5130714b8cbc8cf466862ebfd2"],"ref":"refs/changes/41/2341/8","uploader":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"createdOn":1525110574,"author":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1525110601,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":25,"deletions":0},{"file":"lib/protocol.js","type":"MODIFIED","insertions":75,"deletions":0},{"file":"lib/query.js","type":"MODIFIED","insertions":54,"deletions":-18},{"file":"lib/server.js","type":"MODIFIED","insertions":25,"deletions":-2},{"file":"lib/sig0.js","type":"ADDED","insertions":230,"deletions":0},{"file":"lib/tsig.js","type":"MODIFIED","insertions":5,"deletions":0},{"file":"test/sig0.test.js","type":"ADDED","insertions":318,"deletions":0}],"sizeInsertions":732,"sizeDeletions":-20}],"allReviewers":[{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},{"name":"Joyent Automation","username":"joyent-automation"}]}