{"project":"joyent/illumos-joyent","branch":"master","id":"I0e6327fe751d6561213f4f74e96310100d43130f","number":"1951","subject":"OS-6057 dladm show-link segfaults if you specify too many fields Reviewed by: Robert Mustacchi \u003crm@joyent.com\u003e Reviewed by: Ryan Zezeski \u003cryan.zeseski@joyent.com\u003e Approved by: Ryan Zezeski \u003cryan.zeseski@joyent.com\u003e","owner":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"url":"https://cr.joyent.us/1951","commitMessage":"OS-6057 dladm show-link segfaults if you specify too many fields\nReviewed by: Robert Mustacchi \u003crm@joyent.com\u003e\nReviewed by: Ryan Zezeski \u003cryan.zeseski@joyent.com\u003e\nApproved by: Ryan Zezeski \u003cryan.zeseski@joyent.com\u003e\n","createdOn":1494622418,"lastUpdated":1494892343,"open":false,"status":"MERGED","comments":[{"timestamp":1494622418,"reviewer":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"message":"Uploaded patch set 1."},{"timestamp":1494626070,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 1: Code-Review+1\n\n(2 comments)"},{"timestamp":1494863443,"reviewer":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"message":"Patch Set 1:\n\n(2 comments)"},{"timestamp":1494864201,"reviewer":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"message":"Uploaded patch set 2."},{"timestamp":1494865197,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Patch Set 2: Code-Review+1\n\n(1 comment)\n\nLGTM modulo Robert\u0027s comments. Which it seems you have addressed while I was reviewing."},{"timestamp":1494865328,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 2: Code-Review+1\n\nThanks for the clean up."},{"timestamp":1494875693,"reviewer":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"message":"Uploaded patch set 3."},{"timestamp":1494876047,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1494877479,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1494885558,"reviewer":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"message":"Patch Set 4: Commit message was updated."},{"timestamp":1494886092,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Patch Set 4: Integration-Approval+1"},{"timestamp":1494891562,"reviewer":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"message":"Patch Set 5: Commit message was updated."},{"timestamp":1494891731,"reviewer":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"message":"Patch Set 6: Patch Set 5 was rebased"},{"timestamp":1494892343,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Bryan Cantrill"}],"currentPatchSet":{"number":"6","revision":"c5bf6dbcaf952d0108897703c878c1c0eb4be27f","parents":["d7b3c0f0f9f6c7bd9fbafc475db0d96a54372712"],"ref":"refs/changes/51/1951/6","uploader":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"createdOn":1494891731,"author":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1494876047,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1494877479,"by":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1494886092,"by":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"}},{"type":"SUBM","value":"1","grantedOn":1494892343,"by":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.sbin/ipadm/ipadm.c","type":"MODIFIED","insertions":9,"deletions":-29},{"file":"usr/src/cmd/dladm/dladm.c","type":"MODIFIED","insertions":18,"deletions":-42},{"file":"usr/src/cmd/dlstat/dlstat.c","type":"MODIFIED","insertions":12,"deletions":-32},{"file":"usr/src/cmd/flowadm/flowadm.c","type":"MODIFIED","insertions":6,"deletions":-27},{"file":"usr/src/cmd/flowstat/flowstat.c","type":"MODIFIED","insertions":6,"deletions":-27},{"file":"usr/src/lib/libinetutil/common/mapfile-vers","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/lib/libinetutil/common/ofmt.c","type":"MODIFIED","insertions":70,"deletions":-24},{"file":"usr/src/lib/libinetutil/common/ofmt.h","type":"MODIFIED","insertions":8,"deletions":0}],"sizeInsertions":131,"sizeDeletions":-181},"patchSets":[{"number":"1","revision":"e3d3cb6621dbe195f5eebc9fcd12727a622c256a","parents":["764983058a4a6952f904cebcafb9d29c54615f7e"],"ref":"refs/changes/51/1951/1","uploader":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"createdOn":1494622418,"author":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1494626070,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}}],"comments":[{"file":"usr/src/lib/libinetutil/common/ofmt.c","line":132,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Mind adding punctuation here? It also may be worth clarifying how fields_str makes it way to this function, as it seems like it\u0027s been transformed into something else and that variable name is a bit different. I\u0027m trying to figure out what field of template may be NULL that it\u0027s referring to, but it\u0027s not clear."},{"file":"usr/src/lib/libinetutil/common/ofmt.c","line":132,"reviewer":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"message":"Don\u0027t mind at all!  I was leaving it somewhat intact out of reverence for the original code -- which of course makes no sense whatsoever. ;)"},{"file":"usr/src/lib/libinetutil/common/ofmt.c","line":132,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"It looks like this is referring to the \u0027str\u0027 arg to ofmt_open(). Consumers of which, use the variable \u0027fields_str\u0027 to represent the user\u0027s specified field list. split_max() is called if that argument is NULL or \"all\". Otherwise, split_str() is used. Honestly, I\u0027m not sure I find that last sentence helpful. If I want to know where it\u0027s invoked I\u0027ll read the code. But if we do keep it, it could probably be made a bit more clear."},{"file":"usr/src/lib/libinetutil/common/ofmt.c","line":649,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Should we consider aborting if die or warn are NULL?"},{"file":"usr/src/lib/libinetutil/common/ofmt.c","line":649,"reviewer":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"message":"Will add an assert() here."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.sbin/ipadm/ipadm.c","type":"MODIFIED","insertions":9,"deletions":-29},{"file":"usr/src/cmd/dladm/dladm.c","type":"MODIFIED","insertions":18,"deletions":-42},{"file":"usr/src/cmd/dlstat/dlstat.c","type":"MODIFIED","insertions":12,"deletions":-32},{"file":"usr/src/cmd/flowadm/flowadm.c","type":"MODIFIED","insertions":6,"deletions":-27},{"file":"usr/src/cmd/flowstat/flowstat.c","type":"MODIFIED","insertions":6,"deletions":-27},{"file":"usr/src/lib/libinetutil/common/mapfile-vers","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/lib/libinetutil/common/ofmt.c","type":"MODIFIED","insertions":64,"deletions":-24},{"file":"usr/src/lib/libinetutil/common/ofmt.h","type":"MODIFIED","insertions":8,"deletions":0}],"sizeInsertions":125,"sizeDeletions":-181},{"number":"2","revision":"58990485bf7386a97cea9722fa0053d2a2bcc2fe","parents":["764983058a4a6952f904cebcafb9d29c54615f7e"],"ref":"refs/changes/51/1951/2","uploader":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"createdOn":1494864201,"author":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1494865328,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1494865197,"by":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.sbin/ipadm/ipadm.c","type":"MODIFIED","insertions":9,"deletions":-29},{"file":"usr/src/cmd/dladm/dladm.c","type":"MODIFIED","insertions":18,"deletions":-42},{"file":"usr/src/cmd/dlstat/dlstat.c","type":"MODIFIED","insertions":12,"deletions":-32},{"file":"usr/src/cmd/flowadm/flowadm.c","type":"MODIFIED","insertions":6,"deletions":-27},{"file":"usr/src/cmd/flowstat/flowstat.c","type":"MODIFIED","insertions":6,"deletions":-27},{"file":"usr/src/lib/libinetutil/common/mapfile-vers","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/lib/libinetutil/common/ofmt.c","type":"MODIFIED","insertions":68,"deletions":-24},{"file":"usr/src/lib/libinetutil/common/ofmt.h","type":"MODIFIED","insertions":8,"deletions":0}],"sizeInsertions":129,"sizeDeletions":-181},{"number":"3","revision":"0e6327fe751d6561213f4f74e96310100d43130f","parents":["764983058a4a6952f904cebcafb9d29c54615f7e"],"ref":"refs/changes/51/1951/3","uploader":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"createdOn":1494875693,"author":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1494876047,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1494877479,"by":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.sbin/ipadm/ipadm.c","type":"MODIFIED","insertions":9,"deletions":-29},{"file":"usr/src/cmd/dladm/dladm.c","type":"MODIFIED","insertions":18,"deletions":-42},{"file":"usr/src/cmd/dlstat/dlstat.c","type":"MODIFIED","insertions":12,"deletions":-32},{"file":"usr/src/cmd/flowadm/flowadm.c","type":"MODIFIED","insertions":6,"deletions":-27},{"file":"usr/src/cmd/flowstat/flowstat.c","type":"MODIFIED","insertions":6,"deletions":-27},{"file":"usr/src/lib/libinetutil/common/mapfile-vers","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/lib/libinetutil/common/ofmt.c","type":"MODIFIED","insertions":70,"deletions":-24},{"file":"usr/src/lib/libinetutil/common/ofmt.h","type":"MODIFIED","insertions":8,"deletions":0}],"sizeInsertions":131,"sizeDeletions":-181},{"number":"4","revision":"9059384ded7ec0a347c92645c9a54847b75bc1e6","parents":["764983058a4a6952f904cebcafb9d29c54615f7e"],"ref":"refs/changes/51/1951/4","uploader":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"createdOn":1494885558,"author":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1494876047,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1494877479,"by":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1494886092,"by":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.sbin/ipadm/ipadm.c","type":"MODIFIED","insertions":9,"deletions":-29},{"file":"usr/src/cmd/dladm/dladm.c","type":"MODIFIED","insertions":18,"deletions":-42},{"file":"usr/src/cmd/dlstat/dlstat.c","type":"MODIFIED","insertions":12,"deletions":-32},{"file":"usr/src/cmd/flowadm/flowadm.c","type":"MODIFIED","insertions":6,"deletions":-27},{"file":"usr/src/cmd/flowstat/flowstat.c","type":"MODIFIED","insertions":6,"deletions":-27},{"file":"usr/src/lib/libinetutil/common/mapfile-vers","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/lib/libinetutil/common/ofmt.c","type":"MODIFIED","insertions":70,"deletions":-24},{"file":"usr/src/lib/libinetutil/common/ofmt.h","type":"MODIFIED","insertions":8,"deletions":0}],"sizeInsertions":131,"sizeDeletions":-181},{"number":"5","revision":"c975d9cdc04218145bb54cff6819a4f893577786","parents":["764983058a4a6952f904cebcafb9d29c54615f7e"],"ref":"refs/changes/51/1951/5","uploader":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"createdOn":1494891562,"author":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1494876047,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1494877479,"by":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1494886092,"by":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.sbin/ipadm/ipadm.c","type":"MODIFIED","insertions":9,"deletions":-29},{"file":"usr/src/cmd/dladm/dladm.c","type":"MODIFIED","insertions":18,"deletions":-42},{"file":"usr/src/cmd/dlstat/dlstat.c","type":"MODIFIED","insertions":12,"deletions":-32},{"file":"usr/src/cmd/flowadm/flowadm.c","type":"MODIFIED","insertions":6,"deletions":-27},{"file":"usr/src/cmd/flowstat/flowstat.c","type":"MODIFIED","insertions":6,"deletions":-27},{"file":"usr/src/lib/libinetutil/common/mapfile-vers","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/lib/libinetutil/common/ofmt.c","type":"MODIFIED","insertions":70,"deletions":-24},{"file":"usr/src/lib/libinetutil/common/ofmt.h","type":"MODIFIED","insertions":8,"deletions":0}],"sizeInsertions":131,"sizeDeletions":-181},{"number":"6","revision":"c5bf6dbcaf952d0108897703c878c1c0eb4be27f","parents":["d7b3c0f0f9f6c7bd9fbafc475db0d96a54372712"],"ref":"refs/changes/51/1951/6","uploader":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"createdOn":1494891731,"author":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1494876047,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"SUBM","value":"1","grantedOn":1494892343,"by":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1494877479,"by":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1494886092,"by":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/cmd/cmd-inet/usr.sbin/ipadm/ipadm.c","type":"MODIFIED","insertions":9,"deletions":-29},{"file":"usr/src/cmd/dladm/dladm.c","type":"MODIFIED","insertions":18,"deletions":-42},{"file":"usr/src/cmd/dlstat/dlstat.c","type":"MODIFIED","insertions":12,"deletions":-32},{"file":"usr/src/cmd/flowadm/flowadm.c","type":"MODIFIED","insertions":6,"deletions":-27},{"file":"usr/src/cmd/flowstat/flowstat.c","type":"MODIFIED","insertions":6,"deletions":-27},{"file":"usr/src/lib/libinetutil/common/mapfile-vers","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/lib/libinetutil/common/ofmt.c","type":"MODIFIED","insertions":70,"deletions":-24},{"file":"usr/src/lib/libinetutil/common/ofmt.h","type":"MODIFIED","insertions":8,"deletions":0}],"sizeInsertions":131,"sizeDeletions":-181}],"allReviewers":[{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"}]}