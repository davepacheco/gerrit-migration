{"project":"joyent/illumos-joyent","branch":"master","id":"I1654b59b2cdec01eb420f2dce3fed00ce5f6e022","number":"3482","subject":"OS-6547 Implement KPTI","owner":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"url":"https://cr.joyent.us/3482","commitMessage":"OS-6547 Implement KPTI\n","createdOn":1519668631,"lastUpdated":1520878917,"open":false,"status":"ABANDONED","comments":[{"timestamp":1519668631,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Uploaded patch set 1."},{"timestamp":1519668862,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1519674501,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 1:\n\n(14 comments)"},{"timestamp":1519674942,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 1:\n\n(2 comments)"},{"timestamp":1520421850,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Uploaded patch set 2."},{"timestamp":1520457818,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 2:\n\n(5 comments)\n\nThis all looks really great. It\u0027s more than I can completely wrap my head around within the context of a code review, but I went through everything to see if each piece looks ok. I just saw a few small things. The bigger issue around the mix of not supporting and supporting 32-bit kernels can be left for later cleanup."},{"timestamp":1520459650,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 2:\n\n(5 comments)"},{"timestamp":1520460637,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1520460755,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1520461049,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Uploaded patch set 3."},{"timestamp":1520461578,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 3: Code-Review+1\n\nReally a nice job on this, all of my comments have been addressed."},{"timestamp":1520505073,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Uploaded patch set 4: Patch Set 3 was rebased."},{"timestamp":1520521971,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 4:\n\nAside from Jerry\u0027s review it\u0027s also worth noting that much of this was also reviewed in between me, rm, and alex."},{"timestamp":1520878917,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Abandoned\n\nAbandoned in favour of https://cr.joyent.us/3587"}],"currentPatchSet":{"number":"4","revision":"1654b59b2cdec01eb420f2dce3fed00ce5f6e022","parents":["5367c10ccf59c25a48d868138bd4e511e70b0dcf"],"ref":"refs/changes/82/3482/4","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1520505073,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1520461578,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/mdb/i86pc/modules/unix/i86mmu.c","type":"MODIFIED","insertions":164,"deletions":-75},{"file":"usr/src/cmd/mdb/i86pc/modules/unix/i86mmu.h","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/cmd/mdb/i86pc/modules/unix/unix.c","type":"MODIFIED","insertions":21,"deletions":-5},{"file":"usr/src/cmd/mdb/i86pc/modules/unix/unix_sup.s","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/cmd/mdb/intel/kmdb/kaif.c","type":"MODIFIED","insertions":37,"deletions":0},{"file":"usr/src/cmd/mdb/intel/mdb/mdb_amd64util.c","type":"MODIFIED","insertions":11,"deletions":-8},{"file":"usr/src/cmd/mdb/intel/mdb/mdb_kreg.h","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"usr/src/uts/common/sys/sysmacros.h","type":"MODIFIED","insertions":4,"deletions":-5},{"file":"usr/src/uts/i86pc/Makefile.files","type":"MODIFIED","insertions":3,"deletions":-4},{"file":"usr/src/uts/i86pc/ml/genassym.c","type":"MODIFIED","insertions":2,"deletions":-21},{"file":"usr/src/uts/i86pc/ml/kdi_subr.s","type":"DELETED","insertions":0,"deletions":-160},{"file":"usr/src/uts/i86pc/ml/kpti_trampolines.s","type":"ADDED","insertions":713,"deletions":0},{"file":"usr/src/uts/i86pc/ml/locore.s","type":"MODIFIED","insertions":5,"deletions":-5},{"file":"usr/src/uts/i86pc/ml/offsets.in","type":"MODIFIED","insertions":39,"deletions":-1},{"file":"usr/src/uts/i86pc/ml/syscall_asm_amd64.s","type":"MODIFIED","insertions":76,"deletions":-29},{"file":"usr/src/uts/i86pc/os/intr.c","type":"MODIFIED","insertions":31,"deletions":-1},{"file":"usr/src/uts/i86pc/os/mlsetup.c","type":"MODIFIED","insertions":15,"deletions":-1},{"file":"usr/src/uts/i86pc/os/mp_pc.c","type":"MODIFIED","insertions":52,"deletions":-4},{"file":"usr/src/uts/i86pc/os/mp_startup.c","type":"MODIFIED","insertions":48,"deletions":-37},{"file":"usr/src/uts/i86pc/os/startup.c","type":"MODIFIED","insertions":25,"deletions":-31},{"file":"usr/src/uts/i86pc/os/trap.c","type":"MODIFIED","insertions":41,"deletions":-51},{"file":"usr/src/uts/i86pc/sys/machcpuvar.h","type":"MODIFIED","insertions":85,"deletions":-2},{"file":"usr/src/uts/i86pc/sys/machparam.h","type":"MODIFIED","insertions":5,"deletions":-3},{"file":"usr/src/uts/i86pc/sys/machprivregs.h","type":"MODIFIED","insertions":5,"deletions":-5},{"file":"usr/src/uts/i86pc/sys/rm_platter.h","type":"MODIFIED","insertions":7,"deletions":-2},{"file":"usr/src/uts/i86pc/vm/hat_i86.c","type":"MODIFIED","insertions":718,"deletions":-116},{"file":"usr/src/uts/i86pc/vm/hat_i86.h","type":"MODIFIED","insertions":52,"deletions":-21},{"file":"usr/src/uts/i86pc/vm/hat_pte.h","type":"MODIFIED","insertions":12,"deletions":-4},{"file":"usr/src/uts/i86pc/vm/htable.c","type":"MODIFIED","insertions":44,"deletions":-37},{"file":"usr/src/uts/i86pc/vm/htable.h","type":"MODIFIED","insertions":15,"deletions":-7},{"file":"usr/src/uts/i86xpv/Makefile.files","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"usr/src/uts/intel/Makefile.rules","type":"MODIFIED","insertions":0,"deletions":-6},{"file":"usr/src/uts/intel/amd64/sys/kdi_regs.h","type":"MODIFIED","insertions":14,"deletions":-13},{"file":"usr/src/uts/intel/ia32/ml/exception.s","type":"MODIFIED","insertions":43,"deletions":-24},{"file":"usr/src/uts/intel/ia32/ml/swtch.s","type":"MODIFIED","insertions":40,"deletions":-21},{"file":"usr/src/uts/intel/ia32/os/desctbls.c","type":"MODIFIED","insertions":239,"deletions":-179},{"file":"usr/src/uts/intel/ia32/os/sysi86.c","type":"MODIFIED","insertions":22,"deletions":-3},{"file":"usr/src/uts/intel/ia32/sys/trap.h","type":"MODIFIED","insertions":20,"deletions":0},{"file":"usr/src/uts/intel/kdi/ia32/kdi_asm.s","type":"DELETED","insertions":0,"deletions":-662},{"file":"usr/src/uts/intel/kdi/kdi_asm.s","fileOld":"usr/src/uts/intel/kdi/amd64/kdi_asm.s","type":"RENAMED","insertions":75,"deletions":-59},{"file":"usr/src/uts/intel/kdi/kdi_idt.c","type":"MODIFIED","insertions":20,"deletions":-6},{"file":"usr/src/uts/intel/kdi/kdi_idthdl.s","type":"MODIFIED","insertions":161,"deletions":-36},{"file":"usr/src/uts/intel/kdi/kdi_offsets.in","type":"MODIFIED","insertions":0,"deletions":-9},{"file":"usr/src/uts/intel/sys/archsystm.h","type":"MODIFIED","insertions":10,"deletions":-6},{"file":"usr/src/uts/intel/sys/segments.h","type":"MODIFIED","insertions":38,"deletions":-12}],"sizeInsertions":2930,"sizeDeletions":-1677},"patchSets":[{"number":"1","revision":"e54506af511d25c23e7497fe7a76927b4a9a8995","parents":["4f5bbb4c37e2dca7b0722f89c8dfe13be1fbc131"],"ref":"refs/changes/82/3482/1","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1519668631,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/uts/i86pc/io/pcplusmp/apic_common.c","line":219,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Need to revert this debugging change."},{"file":"usr/src/uts/i86pc/os/startup.c","line":972,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"no need for ifdef"},{"file":"usr/src/uts/i86pc/vm/hat_i86.c","line":626,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"don\u0027t need ifdef __amd64"},{"file":"usr/src/uts/i86xpv/os/xpv_panic.c","line":507,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"totally drop this file\u0027s changes"},{"file":"usr/src/uts/i86xpv/sys/machprivregs.h","line":444,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"can totally drop this file\u0027s changes?"},{"file":"usr/src/uts/intel/ia32/os/desctbls.c","line":1262,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"can remove all three of these lines I think."},{"file":"usr/src/uts/intel/ia32/os/desctbls.c","line":1329,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"no need for ifdef"},{"file":"usr/src/uts/intel/ia32/os/desctbls.c","line":1405,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"no need for ifdef"},{"file":"usr/src/uts/intel/ia32/os/desctbls.c","line":1465,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"no need for ifdef"},{"file":"usr/src/uts/intel/ia32/os/sysi86.c","line":351,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"don\u0027t need to introduce __amd64 check"},{"file":"usr/src/uts/intel/ia32/os/sysi86.c","line":357,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Still could do with big comment on LDT handling."},{"file":"usr/src/uts/intel/ia32/os/sysi86.c","line":385,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"don\u0027t need to introduce __amd64 check"},{"file":"usr/src/uts/intel/ia32/os/sysi86.c","line":741,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"XXX"},{"file":"usr/src/uts/intel/ia32/os/sysi86.c","line":861,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"XXX"},{"file":"usr/src/uts/intel/kdi/kdi_idt.c","line":157,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Reintroduces an unneeded __amd64 check."},{"file":"usr/src/uts/intel/kdi/kdi_idt.c","line":158,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"This doesn\u0027t seem  to be updated when !kpti_enable"},{"file":"usr/src/uts/intel/kdi/kdi_idthdl.s","line":201,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"resolve FIXME"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/mdb/i86pc/modules/unix/i86mmu.c","type":"MODIFIED","insertions":164,"deletions":-75},{"file":"usr/src/cmd/mdb/i86pc/modules/unix/i86mmu.h","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/cmd/mdb/i86pc/modules/unix/unix.c","type":"MODIFIED","insertions":21,"deletions":-5},{"file":"usr/src/cmd/mdb/i86pc/modules/unix/unix_sup.s","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/cmd/mdb/intel/kmdb/kaif.c","type":"MODIFIED","insertions":37,"deletions":0},{"file":"usr/src/cmd/mdb/intel/mdb/mdb_amd64util.c","type":"MODIFIED","insertions":11,"deletions":-8},{"file":"usr/src/cmd/mdb/intel/mdb/mdb_kreg.h","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"usr/src/uts/common/sys/sysmacros.h","type":"MODIFIED","insertions":4,"deletions":-5},{"file":"usr/src/uts/i86pc/Makefile.files","type":"MODIFIED","insertions":3,"deletions":-4},{"file":"usr/src/uts/i86pc/io/pcplusmp/apic_common.c","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/i86pc/ml/genassym.c","type":"MODIFIED","insertions":2,"deletions":-21},{"file":"usr/src/uts/i86pc/ml/kdi_subr.s","type":"DELETED","insertions":0,"deletions":-160},{"file":"usr/src/uts/i86pc/ml/kpti_trampolines.s","type":"ADDED","insertions":714,"deletions":0},{"file":"usr/src/uts/i86pc/ml/locore.s","type":"MODIFIED","insertions":5,"deletions":-5},{"file":"usr/src/uts/i86pc/ml/offsets.in","type":"MODIFIED","insertions":39,"deletions":-1},{"file":"usr/src/uts/i86pc/ml/syscall_asm_amd64.s","type":"MODIFIED","insertions":73,"deletions":-29},{"file":"usr/src/uts/i86pc/os/intr.c","type":"MODIFIED","insertions":31,"deletions":-1},{"file":"usr/src/uts/i86pc/os/mlsetup.c","type":"MODIFIED","insertions":15,"deletions":-1},{"file":"usr/src/uts/i86pc/os/mp_pc.c","type":"MODIFIED","insertions":52,"deletions":-4},{"file":"usr/src/uts/i86pc/os/mp_startup.c","type":"MODIFIED","insertions":48,"deletions":-37},{"file":"usr/src/uts/i86pc/os/startup.c","type":"MODIFIED","insertions":27,"deletions":-31},{"file":"usr/src/uts/i86pc/os/trap.c","type":"MODIFIED","insertions":41,"deletions":-51},{"file":"usr/src/uts/i86pc/sys/machcpuvar.h","type":"MODIFIED","insertions":85,"deletions":-2},{"file":"usr/src/uts/i86pc/sys/machparam.h","type":"MODIFIED","insertions":5,"deletions":-3},{"file":"usr/src/uts/i86pc/sys/machprivregs.h","type":"MODIFIED","insertions":5,"deletions":-5},{"file":"usr/src/uts/i86pc/sys/rm_platter.h","type":"MODIFIED","insertions":7,"deletions":-2},{"file":"usr/src/uts/i86pc/vm/hat_i86.c","type":"MODIFIED","insertions":722,"deletions":-107},{"file":"usr/src/uts/i86pc/vm/hat_i86.h","type":"MODIFIED","insertions":52,"deletions":-21},{"file":"usr/src/uts/i86pc/vm/hat_pte.h","type":"MODIFIED","insertions":12,"deletions":-4},{"file":"usr/src/uts/i86pc/vm/htable.c","type":"MODIFIED","insertions":44,"deletions":-37},{"file":"usr/src/uts/i86pc/vm/htable.h","type":"MODIFIED","insertions":15,"deletions":-7},{"file":"usr/src/uts/i86xpv/Makefile.files","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"usr/src/uts/i86xpv/os/xpv_panic.c","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"usr/src/uts/i86xpv/sys/machprivregs.h","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"usr/src/uts/intel/Makefile.rules","type":"MODIFIED","insertions":0,"deletions":-6},{"file":"usr/src/uts/intel/amd64/sys/kdi_regs.h","type":"MODIFIED","insertions":14,"deletions":-13},{"file":"usr/src/uts/intel/ia32/ml/exception.s","type":"MODIFIED","insertions":43,"deletions":-24},{"file":"usr/src/uts/intel/ia32/ml/swtch.s","type":"MODIFIED","insertions":40,"deletions":-21},{"file":"usr/src/uts/intel/ia32/os/desctbls.c","type":"MODIFIED","insertions":247,"deletions":-175},{"file":"usr/src/uts/intel/ia32/os/sysi86.c","type":"MODIFIED","insertions":29,"deletions":-2},{"file":"usr/src/uts/intel/ia32/sys/trap.h","type":"MODIFIED","insertions":20,"deletions":0},{"file":"usr/src/uts/intel/kdi/ia32/kdi_asm.s","type":"DELETED","insertions":0,"deletions":-662},{"file":"usr/src/uts/intel/kdi/kdi_asm.s","fileOld":"usr/src/uts/intel/kdi/amd64/kdi_asm.s","type":"RENAMED","insertions":75,"deletions":-59},{"file":"usr/src/uts/intel/kdi/kdi_idt.c","type":"MODIFIED","insertions":18,"deletions":-7},{"file":"usr/src/uts/intel/kdi/kdi_idthdl.s","type":"MODIFIED","insertions":157,"deletions":-36},{"file":"usr/src/uts/intel/kdi/kdi_offsets.in","type":"MODIFIED","insertions":0,"deletions":-9},{"file":"usr/src/uts/intel/sys/archsystm.h","type":"MODIFIED","insertions":10,"deletions":-6},{"file":"usr/src/uts/intel/sys/segments.h","type":"MODIFIED","insertions":38,"deletions":-12}],"sizeInsertions":2955,"sizeDeletions":-1667},{"number":"2","revision":"eb2758b80378dc1b4afa2fdbc60fa16a3659d3bf","parents":["51f29e2c09129e0dca7117c7c190df5a556fd5d1"],"ref":"refs/changes/82/3482/2","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1520421850,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/uts/i86pc/ml/kpti_trampolines.s","line":517,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"elsewhere"},{"file":"usr/src/uts/i86pc/ml/kpti_trampolines.s","line":517,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"will fix"},{"file":"usr/src/uts/i86pc/ml/syscall_asm_amd64.s","line":1401,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Should this be removed? It looks like it is handled in the trampoline"},{"file":"usr/src/uts/i86pc/ml/syscall_asm_amd64.s","line":1401,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"On a quick look it seems wrong, looks like it would potentially break s10/sn1 even further."},{"file":"usr/src/uts/i86pc/ml/syscall_asm_amd64.s","line":1401,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Actually, I think this is right. This swaps us over to the user gsbase. So if !kpti_enable in tr_iret_user, we do a straight iretq.\n\nIf we\u0027re KPTI, we do *two* swapgs in tr_iret_user: one so we can access the cpu_t again, then one back again to user gsbase.\n\nThis is not ideal but our abortive attempts to reduce the amount of swapgs\u0027s we do got complicated quickly."},{"file":"usr/src/uts/i86pc/ml/syscall_asm_amd64.s","line":1401,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"I think adding a comment here about this will help with any future confusion."},{"file":"usr/src/uts/i86pc/sys/machcpuvar.h","line":120,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"why is this a greg_t? is the assumption that everything except the redzones is a greg_t?"},{"file":"usr/src/uts/i86pc/sys/machcpuvar.h","line":120,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Could easily be a uint64_t. Would prefer to keep 64-bit sized just for convenience though."},{"file":"usr/src/uts/i86pc/vm/hat_i86.h","line":88,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"It looks like some 32-bit kernel stuff has been cleaned up and some left with this KPTI work. I\u0027m not sure how much I should comment about this. I\u0027m fine just leaving the 32-bit stuff alone for now and doing that cleanup later."},{"file":"usr/src/uts/i86pc/vm/hat_i86.h","line":88,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"In general where we\u0027ve significantly changed code that involves the 32-bit kernel we\u0027ve cleaned up the 32-bit path, but we didn\u0027t want to pull out huge amounts of cleanup code as part of these already pretty substantial changes. Would much prefer to do 32-bit cleanup as follow on - and ideally upstream."},{"file":"usr/src/uts/intel/ia32/os/desctbls.c","line":1262,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"since the usage below is not inside a (no longer needed) guard, we should probably just remove the guard here as well"},{"file":"usr/src/uts/intel/ia32/os/desctbls.c","line":1262,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"This hunk will be removed altogether by PCID."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/mdb/i86pc/modules/unix/i86mmu.c","type":"MODIFIED","insertions":164,"deletions":-75},{"file":"usr/src/cmd/mdb/i86pc/modules/unix/i86mmu.h","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/cmd/mdb/i86pc/modules/unix/unix.c","type":"MODIFIED","insertions":21,"deletions":-5},{"file":"usr/src/cmd/mdb/i86pc/modules/unix/unix_sup.s","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/cmd/mdb/intel/kmdb/kaif.c","type":"MODIFIED","insertions":37,"deletions":0},{"file":"usr/src/cmd/mdb/intel/mdb/mdb_amd64util.c","type":"MODIFIED","insertions":11,"deletions":-8},{"file":"usr/src/cmd/mdb/intel/mdb/mdb_kreg.h","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"usr/src/uts/common/sys/sysmacros.h","type":"MODIFIED","insertions":4,"deletions":-5},{"file":"usr/src/uts/i86pc/Makefile.files","type":"MODIFIED","insertions":3,"deletions":-4},{"file":"usr/src/uts/i86pc/ml/genassym.c","type":"MODIFIED","insertions":2,"deletions":-21},{"file":"usr/src/uts/i86pc/ml/kdi_subr.s","type":"DELETED","insertions":0,"deletions":-160},{"file":"usr/src/uts/i86pc/ml/kpti_trampolines.s","type":"ADDED","insertions":714,"deletions":0},{"file":"usr/src/uts/i86pc/ml/locore.s","type":"MODIFIED","insertions":5,"deletions":-5},{"file":"usr/src/uts/i86pc/ml/offsets.in","type":"MODIFIED","insertions":39,"deletions":-1},{"file":"usr/src/uts/i86pc/ml/syscall_asm_amd64.s","type":"MODIFIED","insertions":73,"deletions":-29},{"file":"usr/src/uts/i86pc/os/intr.c","type":"MODIFIED","insertions":31,"deletions":-1},{"file":"usr/src/uts/i86pc/os/mlsetup.c","type":"MODIFIED","insertions":15,"deletions":-1},{"file":"usr/src/uts/i86pc/os/mp_pc.c","type":"MODIFIED","insertions":52,"deletions":-4},{"file":"usr/src/uts/i86pc/os/mp_startup.c","type":"MODIFIED","insertions":48,"deletions":-37},{"file":"usr/src/uts/i86pc/os/startup.c","type":"MODIFIED","insertions":25,"deletions":-31},{"file":"usr/src/uts/i86pc/os/trap.c","type":"MODIFIED","insertions":41,"deletions":-51},{"file":"usr/src/uts/i86pc/sys/machcpuvar.h","type":"MODIFIED","insertions":85,"deletions":-2},{"file":"usr/src/uts/i86pc/sys/machparam.h","type":"MODIFIED","insertions":5,"deletions":-3},{"file":"usr/src/uts/i86pc/sys/machprivregs.h","type":"MODIFIED","insertions":5,"deletions":-5},{"file":"usr/src/uts/i86pc/sys/rm_platter.h","type":"MODIFIED","insertions":7,"deletions":-2},{"file":"usr/src/uts/i86pc/vm/hat_i86.c","type":"MODIFIED","insertions":718,"deletions":-116},{"file":"usr/src/uts/i86pc/vm/hat_i86.h","type":"MODIFIED","insertions":52,"deletions":-21},{"file":"usr/src/uts/i86pc/vm/hat_pte.h","type":"MODIFIED","insertions":12,"deletions":-4},{"file":"usr/src/uts/i86pc/vm/htable.c","type":"MODIFIED","insertions":44,"deletions":-37},{"file":"usr/src/uts/i86pc/vm/htable.h","type":"MODIFIED","insertions":15,"deletions":-7},{"file":"usr/src/uts/i86xpv/Makefile.files","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"usr/src/uts/intel/Makefile.rules","type":"MODIFIED","insertions":0,"deletions":-6},{"file":"usr/src/uts/intel/amd64/sys/kdi_regs.h","type":"MODIFIED","insertions":14,"deletions":-13},{"file":"usr/src/uts/intel/ia32/ml/exception.s","type":"MODIFIED","insertions":43,"deletions":-24},{"file":"usr/src/uts/intel/ia32/ml/swtch.s","type":"MODIFIED","insertions":40,"deletions":-21},{"file":"usr/src/uts/intel/ia32/os/desctbls.c","type":"MODIFIED","insertions":239,"deletions":-179},{"file":"usr/src/uts/intel/ia32/os/sysi86.c","type":"MODIFIED","insertions":22,"deletions":-3},{"file":"usr/src/uts/intel/ia32/sys/trap.h","type":"MODIFIED","insertions":20,"deletions":0},{"file":"usr/src/uts/intel/kdi/ia32/kdi_asm.s","type":"DELETED","insertions":0,"deletions":-662},{"file":"usr/src/uts/intel/kdi/kdi_asm.s","fileOld":"usr/src/uts/intel/kdi/amd64/kdi_asm.s","type":"RENAMED","insertions":75,"deletions":-59},{"file":"usr/src/uts/intel/kdi/kdi_idt.c","type":"MODIFIED","insertions":20,"deletions":-6},{"file":"usr/src/uts/intel/kdi/kdi_idthdl.s","type":"MODIFIED","insertions":161,"deletions":-36},{"file":"usr/src/uts/intel/kdi/kdi_offsets.in","type":"MODIFIED","insertions":0,"deletions":-9},{"file":"usr/src/uts/intel/sys/archsystm.h","type":"MODIFIED","insertions":10,"deletions":-6},{"file":"usr/src/uts/intel/sys/segments.h","type":"MODIFIED","insertions":38,"deletions":-12}],"sizeInsertions":2928,"sizeDeletions":-1677},{"number":"3","revision":"c431da19501feb8ab4d8903dc62fa77138b959d4","parents":["51f29e2c09129e0dca7117c7c190df5a556fd5d1"],"ref":"refs/changes/82/3482/3","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1520461049,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1520461578,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/mdb/i86pc/modules/unix/i86mmu.c","type":"MODIFIED","insertions":164,"deletions":-75},{"file":"usr/src/cmd/mdb/i86pc/modules/unix/i86mmu.h","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/cmd/mdb/i86pc/modules/unix/unix.c","type":"MODIFIED","insertions":21,"deletions":-5},{"file":"usr/src/cmd/mdb/i86pc/modules/unix/unix_sup.s","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/cmd/mdb/intel/kmdb/kaif.c","type":"MODIFIED","insertions":37,"deletions":0},{"file":"usr/src/cmd/mdb/intel/mdb/mdb_amd64util.c","type":"MODIFIED","insertions":11,"deletions":-8},{"file":"usr/src/cmd/mdb/intel/mdb/mdb_kreg.h","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"usr/src/uts/common/sys/sysmacros.h","type":"MODIFIED","insertions":4,"deletions":-5},{"file":"usr/src/uts/i86pc/Makefile.files","type":"MODIFIED","insertions":3,"deletions":-4},{"file":"usr/src/uts/i86pc/ml/genassym.c","type":"MODIFIED","insertions":2,"deletions":-21},{"file":"usr/src/uts/i86pc/ml/kdi_subr.s","type":"DELETED","insertions":0,"deletions":-160},{"file":"usr/src/uts/i86pc/ml/kpti_trampolines.s","type":"ADDED","insertions":713,"deletions":0},{"file":"usr/src/uts/i86pc/ml/locore.s","type":"MODIFIED","insertions":5,"deletions":-5},{"file":"usr/src/uts/i86pc/ml/offsets.in","type":"MODIFIED","insertions":39,"deletions":-1},{"file":"usr/src/uts/i86pc/ml/syscall_asm_amd64.s","type":"MODIFIED","insertions":76,"deletions":-29},{"file":"usr/src/uts/i86pc/os/intr.c","type":"MODIFIED","insertions":31,"deletions":-1},{"file":"usr/src/uts/i86pc/os/mlsetup.c","type":"MODIFIED","insertions":15,"deletions":-1},{"file":"usr/src/uts/i86pc/os/mp_pc.c","type":"MODIFIED","insertions":52,"deletions":-4},{"file":"usr/src/uts/i86pc/os/mp_startup.c","type":"MODIFIED","insertions":48,"deletions":-37},{"file":"usr/src/uts/i86pc/os/startup.c","type":"MODIFIED","insertions":25,"deletions":-31},{"file":"usr/src/uts/i86pc/os/trap.c","type":"MODIFIED","insertions":41,"deletions":-51},{"file":"usr/src/uts/i86pc/sys/machcpuvar.h","type":"MODIFIED","insertions":85,"deletions":-2},{"file":"usr/src/uts/i86pc/sys/machparam.h","type":"MODIFIED","insertions":5,"deletions":-3},{"file":"usr/src/uts/i86pc/sys/machprivregs.h","type":"MODIFIED","insertions":5,"deletions":-5},{"file":"usr/src/uts/i86pc/sys/rm_platter.h","type":"MODIFIED","insertions":7,"deletions":-2},{"file":"usr/src/uts/i86pc/vm/hat_i86.c","type":"MODIFIED","insertions":718,"deletions":-116},{"file":"usr/src/uts/i86pc/vm/hat_i86.h","type":"MODIFIED","insertions":52,"deletions":-21},{"file":"usr/src/uts/i86pc/vm/hat_pte.h","type":"MODIFIED","insertions":12,"deletions":-4},{"file":"usr/src/uts/i86pc/vm/htable.c","type":"MODIFIED","insertions":44,"deletions":-37},{"file":"usr/src/uts/i86pc/vm/htable.h","type":"MODIFIED","insertions":15,"deletions":-7},{"file":"usr/src/uts/i86xpv/Makefile.files","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"usr/src/uts/intel/Makefile.rules","type":"MODIFIED","insertions":0,"deletions":-6},{"file":"usr/src/uts/intel/amd64/sys/kdi_regs.h","type":"MODIFIED","insertions":14,"deletions":-13},{"file":"usr/src/uts/intel/ia32/ml/exception.s","type":"MODIFIED","insertions":43,"deletions":-24},{"file":"usr/src/uts/intel/ia32/ml/swtch.s","type":"MODIFIED","insertions":40,"deletions":-21},{"file":"usr/src/uts/intel/ia32/os/desctbls.c","type":"MODIFIED","insertions":239,"deletions":-179},{"file":"usr/src/uts/intel/ia32/os/sysi86.c","type":"MODIFIED","insertions":22,"deletions":-3},{"file":"usr/src/uts/intel/ia32/sys/trap.h","type":"MODIFIED","insertions":20,"deletions":0},{"file":"usr/src/uts/intel/kdi/ia32/kdi_asm.s","type":"DELETED","insertions":0,"deletions":-662},{"file":"usr/src/uts/intel/kdi/kdi_asm.s","fileOld":"usr/src/uts/intel/kdi/amd64/kdi_asm.s","type":"RENAMED","insertions":75,"deletions":-59},{"file":"usr/src/uts/intel/kdi/kdi_idt.c","type":"MODIFIED","insertions":20,"deletions":-6},{"file":"usr/src/uts/intel/kdi/kdi_idthdl.s","type":"MODIFIED","insertions":161,"deletions":-36},{"file":"usr/src/uts/intel/kdi/kdi_offsets.in","type":"MODIFIED","insertions":0,"deletions":-9},{"file":"usr/src/uts/intel/sys/archsystm.h","type":"MODIFIED","insertions":10,"deletions":-6},{"file":"usr/src/uts/intel/sys/segments.h","type":"MODIFIED","insertions":38,"deletions":-12}],"sizeInsertions":2930,"sizeDeletions":-1677},{"number":"4","revision":"1654b59b2cdec01eb420f2dce3fed00ce5f6e022","parents":["5367c10ccf59c25a48d868138bd4e511e70b0dcf"],"ref":"refs/changes/82/3482/4","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1520505073,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1520461578,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/mdb/i86pc/modules/unix/i86mmu.c","type":"MODIFIED","insertions":164,"deletions":-75},{"file":"usr/src/cmd/mdb/i86pc/modules/unix/i86mmu.h","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/cmd/mdb/i86pc/modules/unix/unix.c","type":"MODIFIED","insertions":21,"deletions":-5},{"file":"usr/src/cmd/mdb/i86pc/modules/unix/unix_sup.s","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/cmd/mdb/intel/kmdb/kaif.c","type":"MODIFIED","insertions":37,"deletions":0},{"file":"usr/src/cmd/mdb/intel/mdb/mdb_amd64util.c","type":"MODIFIED","insertions":11,"deletions":-8},{"file":"usr/src/cmd/mdb/intel/mdb/mdb_kreg.h","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"usr/src/uts/common/sys/sysmacros.h","type":"MODIFIED","insertions":4,"deletions":-5},{"file":"usr/src/uts/i86pc/Makefile.files","type":"MODIFIED","insertions":3,"deletions":-4},{"file":"usr/src/uts/i86pc/ml/genassym.c","type":"MODIFIED","insertions":2,"deletions":-21},{"file":"usr/src/uts/i86pc/ml/kdi_subr.s","type":"DELETED","insertions":0,"deletions":-160},{"file":"usr/src/uts/i86pc/ml/kpti_trampolines.s","type":"ADDED","insertions":713,"deletions":0},{"file":"usr/src/uts/i86pc/ml/locore.s","type":"MODIFIED","insertions":5,"deletions":-5},{"file":"usr/src/uts/i86pc/ml/offsets.in","type":"MODIFIED","insertions":39,"deletions":-1},{"file":"usr/src/uts/i86pc/ml/syscall_asm_amd64.s","type":"MODIFIED","insertions":76,"deletions":-29},{"file":"usr/src/uts/i86pc/os/intr.c","type":"MODIFIED","insertions":31,"deletions":-1},{"file":"usr/src/uts/i86pc/os/mlsetup.c","type":"MODIFIED","insertions":15,"deletions":-1},{"file":"usr/src/uts/i86pc/os/mp_pc.c","type":"MODIFIED","insertions":52,"deletions":-4},{"file":"usr/src/uts/i86pc/os/mp_startup.c","type":"MODIFIED","insertions":48,"deletions":-37},{"file":"usr/src/uts/i86pc/os/startup.c","type":"MODIFIED","insertions":25,"deletions":-31},{"file":"usr/src/uts/i86pc/os/trap.c","type":"MODIFIED","insertions":41,"deletions":-51},{"file":"usr/src/uts/i86pc/sys/machcpuvar.h","type":"MODIFIED","insertions":85,"deletions":-2},{"file":"usr/src/uts/i86pc/sys/machparam.h","type":"MODIFIED","insertions":5,"deletions":-3},{"file":"usr/src/uts/i86pc/sys/machprivregs.h","type":"MODIFIED","insertions":5,"deletions":-5},{"file":"usr/src/uts/i86pc/sys/rm_platter.h","type":"MODIFIED","insertions":7,"deletions":-2},{"file":"usr/src/uts/i86pc/vm/hat_i86.c","type":"MODIFIED","insertions":718,"deletions":-116},{"file":"usr/src/uts/i86pc/vm/hat_i86.h","type":"MODIFIED","insertions":52,"deletions":-21},{"file":"usr/src/uts/i86pc/vm/hat_pte.h","type":"MODIFIED","insertions":12,"deletions":-4},{"file":"usr/src/uts/i86pc/vm/htable.c","type":"MODIFIED","insertions":44,"deletions":-37},{"file":"usr/src/uts/i86pc/vm/htable.h","type":"MODIFIED","insertions":15,"deletions":-7},{"file":"usr/src/uts/i86xpv/Makefile.files","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"usr/src/uts/intel/Makefile.rules","type":"MODIFIED","insertions":0,"deletions":-6},{"file":"usr/src/uts/intel/amd64/sys/kdi_regs.h","type":"MODIFIED","insertions":14,"deletions":-13},{"file":"usr/src/uts/intel/ia32/ml/exception.s","type":"MODIFIED","insertions":43,"deletions":-24},{"file":"usr/src/uts/intel/ia32/ml/swtch.s","type":"MODIFIED","insertions":40,"deletions":-21},{"file":"usr/src/uts/intel/ia32/os/desctbls.c","type":"MODIFIED","insertions":239,"deletions":-179},{"file":"usr/src/uts/intel/ia32/os/sysi86.c","type":"MODIFIED","insertions":22,"deletions":-3},{"file":"usr/src/uts/intel/ia32/sys/trap.h","type":"MODIFIED","insertions":20,"deletions":0},{"file":"usr/src/uts/intel/kdi/ia32/kdi_asm.s","type":"DELETED","insertions":0,"deletions":-662},{"file":"usr/src/uts/intel/kdi/kdi_asm.s","fileOld":"usr/src/uts/intel/kdi/amd64/kdi_asm.s","type":"RENAMED","insertions":75,"deletions":-59},{"file":"usr/src/uts/intel/kdi/kdi_idt.c","type":"MODIFIED","insertions":20,"deletions":-6},{"file":"usr/src/uts/intel/kdi/kdi_idthdl.s","type":"MODIFIED","insertions":161,"deletions":-36},{"file":"usr/src/uts/intel/kdi/kdi_offsets.in","type":"MODIFIED","insertions":0,"deletions":-9},{"file":"usr/src/uts/intel/sys/archsystm.h","type":"MODIFIED","insertions":10,"deletions":-6},{"file":"usr/src/uts/intel/sys/segments.h","type":"MODIFIED","insertions":38,"deletions":-12}],"sizeInsertions":2930,"sizeDeletions":-1677}],"allReviewers":[{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}]}