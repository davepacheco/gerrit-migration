From 281ee153915907cbddba8ccde3a1df535df36585 Mon Sep 17 00:00:00 2001
From: Jerry Jelinek <jerry.jelinek@joyent.com>
Date: Thu, 1 Feb 2018 18:34:54 +0000
Subject: [PATCH] OS-6582 libfakekernel changes break SmartOS platform build

---
 usr/src/lib/libzpool/Makefile.com | 8 +++++++-
 1 file changed, 7 insertions(+), 1 deletion(-)

diff --git a/usr/src/lib/libzpool/Makefile.com b/usr/src/lib/libzpool/Makefile.com
index e4511dc50a..a0d9871a74 100644
--- a/usr/src/lib/libzpool/Makefile.com
+++ b/usr/src/lib/libzpool/Makefile.com
@@ -21,7 +21,7 @@
 #
 # Copyright (c) 2005, 2010, Oracle and/or its affiliates. All rights reserved.
 # Copyright (c) 2013, 2016 by Delphix. All rights reserved.
-# Copyright 2017 Joyent, Inc.
+# Copyright 2018 Joyent, Inc.
 #
 
 LIBRARY= libzpool.a
@@ -55,6 +55,7 @@ INCS += -I../../../uts/common/fs/zfs
 INCS += -I../../../uts/common/fs/zfs/lua
 INCS += -I../../../common/zfs
 INCS += -I../../../common
+# install := INCS += -isystem /home/jerry/illumos-live/proto.strap/usr/include
 
 CLEANFILES += ../common/zfs.h
 CLEANFILES += $(EXTPICS)
@@ -75,6 +76,11 @@ CPPFLAGS +=	$(INCS)	-DDEBUG -D_FAKE_KERNEL
 LINTFLAGS +=	-erroff=E_STATIC_UNUSED $(INCS)
 LINTFLAGS64 +=	-erroff=E_STATIC_UNUSED $(INCS)
 
+# The following is needed to fix the SmartOS build; see OS-6582. We cannot do
+# a conditional appendage to INCS, since that breaks the lint build.
+CFLAGS += -isystem $(ROOT)/usr/include
+CFLAGS64 += -isystem $(ROOT)/usr/include
+
 CERRWARN +=	-_gcc=-Wno-parentheses
 CERRWARN +=	-_gcc=-Wno-switch
 CERRWARN +=	-_gcc=-Wno-type-limits
-- 
2.21.0

