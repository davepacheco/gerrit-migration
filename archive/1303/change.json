{"project":"joyent/sdc-fwrule","branch":"master","topic":"FWAPI-271","id":"I3513c377f353f4281e4e07045971ed20a2981d34","number":"1303","subject":"FWAPI-271 Invalid subnets in firewall rules should be rejected Reviewed by: Alex Wilson \u003calex.wilson@joyent.com\u003e Approved by: Alex Wilson \u003calex.wilson@joyent.com\u003e","owner":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"url":"https://cr.joyent.us/1303","commitMessage":"FWAPI-271 Invalid subnets in firewall rules should be rejected\nReviewed by: Alex Wilson \u003calex.wilson@joyent.com\u003e\nApproved by: Alex Wilson \u003calex.wilson@joyent.com\u003e\n","createdOn":1484950555,"lastUpdated":1485559861,"open":false,"status":"MERGED","comments":[{"timestamp":1484950555,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 1."},{"timestamp":1484950641,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Topic set to FWAPI-271"},{"timestamp":1484950783,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1484951021,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 2: Patch Set 1 was rebased."},{"timestamp":1484951310,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2:\n\n\"make check\" passed ok"},{"timestamp":1485555163,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 2:\n\n(3 comments)"},{"timestamp":1485555718,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 2:\n\n(3 comments)"},{"timestamp":1485555744,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 3: Patch Set 2 was rebased."},{"timestamp":1485556073,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 4."},{"timestamp":1485556085,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 5: Commit message was updated."},{"timestamp":1485556138,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1485556187,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 5:\n\n(1 comment)"},{"timestamp":1485556783,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 5: Code-Review+1\n\n(1 comment)"},{"timestamp":1485556921,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 5: Integration-Approval+1"},{"timestamp":1485559847,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 6: Commit message was updated."},{"timestamp":1485559861,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Cody Peter Mello"}],"currentPatchSet":{"number":"6","revision":"3513c377f353f4281e4e07045971ed20a2981d34","parents":["e9be7de7f367fc00b90dd6c2be59b8352df97b42"],"ref":"refs/changes/03/1303/6","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1485559847,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1485556138,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1485556783,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1485556921,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"SUBM","value":"1","grantedOn":1485559861,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/index.js","type":"MODIFIED","insertions":6,"deletions":-14},{"file":"lib/parser.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/validators.js","type":"MODIFIED","insertions":31,"deletions":-19},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"src/fwrule.jison","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/invalid.test.js","type":"MODIFIED","insertions":17,"deletions":-7},{"file":"test/parser.test.js","type":"MODIFIED","insertions":60,"deletions":0}],"sizeInsertions":120,"sizeDeletions":-45},"patchSets":[{"number":"1","revision":"8423f16d6bde46524eabb9c83be2a1e3246a62ad","parents":["c363e931adaf0b325909c6a75c3608ed1d7dbf3e"],"ref":"refs/changes/03/1303/1","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1484950555,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1484950783,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/index.js","type":"MODIFIED","insertions":26,"deletions":-12},{"file":"lib/parser.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/validators.js","type":"MODIFIED","insertions":0,"deletions":-19},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"src/fwrule.jison","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/invalid.test.js","type":"MODIFIED","insertions":17,"deletions":-7},{"file":"test/parser.test.js","type":"MODIFIED","insertions":60,"deletions":0}],"sizeInsertions":109,"sizeDeletions":-43},{"number":"2","revision":"21d51fa42e10ad3191ecc53787c31c53bbe13255","parents":["852e0943f3880f9a5a4100abb6546e8ab19faf47"],"ref":"refs/changes/03/1303/2","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1484951021,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1484950783,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/index.js","line":105,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Should all of this be under a validators.validateSubnet() instead of in parser.yy.*?"},{"file":"lib/index.js","line":105,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"I\u0027d initially thought that here would make more sense since it throws, but there are things that throw in that file, too. I\u0027ll move it there."},{"file":"lib/index.js","line":105,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Done"},{"file":"lib/index.js","line":106,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"I kinda feel like ip6addr should have a parseCIDR function that does this split and validation for you, but it\u0027s not a very strong feeling :P"},{"file":"lib/index.js","line":106,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"It does, but it clears bits to the right of the mask, which is part of what I want to check here."},{"file":"lib/index.js","line":106,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"That\u0027s sort of unfortunate."},{"file":"lib/validators.js","line":81,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Are we still using this?"},{"file":"lib/validators.js","line":81,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"FWAPI is still currently using this, but that\u0027s going to change at some point once its validation code gets reworked. Once that happens this can be removed."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/index.js","type":"MODIFIED","insertions":26,"deletions":-12},{"file":"lib/parser.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/validators.js","type":"MODIFIED","insertions":0,"deletions":-19},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"src/fwrule.jison","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/invalid.test.js","type":"MODIFIED","insertions":17,"deletions":-7},{"file":"test/parser.test.js","type":"MODIFIED","insertions":60,"deletions":0}],"sizeInsertions":109,"sizeDeletions":-43},{"number":"3","revision":"7c39ae6f005187e1e5a6e2906f720749a3db8f1e","parents":["e9be7de7f367fc00b90dd6c2be59b8352df97b42"],"ref":"refs/changes/03/1303/3","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1485555744,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"NO_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1484950783,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/index.js","type":"MODIFIED","insertions":26,"deletions":-12},{"file":"lib/parser.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/validators.js","type":"MODIFIED","insertions":0,"deletions":-19},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"src/fwrule.jison","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/invalid.test.js","type":"MODIFIED","insertions":17,"deletions":-7},{"file":"test/parser.test.js","type":"MODIFIED","insertions":60,"deletions":0}],"sizeInsertions":109,"sizeDeletions":-43},{"number":"4","revision":"7d2c3279e248457f0096dd49164196488d4d0254","parents":["e9be7de7f367fc00b90dd6c2be59b8352df97b42"],"ref":"refs/changes/03/1303/4","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1485556073,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1485556138,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/index.js","type":"MODIFIED","insertions":6,"deletions":-14},{"file":"lib/parser.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/validators.js","type":"MODIFIED","insertions":31,"deletions":-19},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"src/fwrule.jison","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/invalid.test.js","type":"MODIFIED","insertions":17,"deletions":-7},{"file":"test/parser.test.js","type":"MODIFIED","insertions":60,"deletions":0}],"sizeInsertions":120,"sizeDeletions":-45},{"number":"5","revision":"ebd671d827c07774df691d56f6b61b7ab9e7945b","parents":["e9be7de7f367fc00b90dd6c2be59b8352df97b42"],"ref":"refs/changes/03/1303/5","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1485556085,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1485556783,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1485556921,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"lib/index.js","type":"MODIFIED","insertions":6,"deletions":-14},{"file":"lib/parser.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/validators.js","type":"MODIFIED","insertions":31,"deletions":-19},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"src/fwrule.jison","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/invalid.test.js","type":"MODIFIED","insertions":17,"deletions":-7},{"file":"test/parser.test.js","type":"MODIFIED","insertions":60,"deletions":0}],"sizeInsertions":120,"sizeDeletions":-45},{"number":"6","revision":"3513c377f353f4281e4e07045971ed20a2981d34","parents":["e9be7de7f367fc00b90dd6c2be59b8352df97b42"],"ref":"refs/changes/03/1303/6","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1485559847,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"SUBM","value":"1","grantedOn":1485559861,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1485556783,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1485556921,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1485556138,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/index.js","type":"MODIFIED","insertions":6,"deletions":-14},{"file":"lib/parser.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/validators.js","type":"MODIFIED","insertions":31,"deletions":-19},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"src/fwrule.jison","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"test/invalid.test.js","type":"MODIFIED","insertions":17,"deletions":-7},{"file":"test/parser.test.js","type":"MODIFIED","insertions":60,"deletions":0}],"sizeInsertions":120,"sizeDeletions":-45}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}]}