{"project":"joyent/manta-garbage-collector","branch":"master","topic":"manta-metricports","id":"I521ac7bfedf73ecfed5db848f1e8ab488501b5d0","number":"5697","subject":"MANTA-4145 Add metricPorts mdata variable to manta-garbage-collector Reviewed by: Josh Wilsdon \u003cjosh@wilsdon.ca\u003e Approved by: Josh Wilsdon \u003cjosh@wilsdon.ca\u003e","owner":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"url":"https://cr.joyent.us/5697","commitMessage":"MANTA-4145 Add metricPorts mdata variable to manta-garbage-collector\nReviewed by: Josh Wilsdon \u003cjosh@wilsdon.ca\u003e\nApproved by: Josh Wilsdon \u003cjosh@wilsdon.ca\u003e\n","createdOn":1551490296,"lastUpdated":1557420609,"open":false,"status":"MERGED","comments":[{"timestamp":1551490296,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Uploaded patch set 1."},{"timestamp":1551490322,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1557189282,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Uploaded patch set 2."},{"timestamp":1557189320,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1557191965,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Patch Set 2:\n\nSee ticket for latest testing notes."},{"timestamp":1557194593,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Topic set to manta-metricports"},{"timestamp":1557248336,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 2:\n\nThe port is not actually configurable here. It\u0027s a hardcoded value in the sapi template. As such it seems to me that we\u0027d be better off not creating this additional smf service or all this additional complexity and just add:\n\n    mdata-put metricPorts 3020\n\nto the setup.sh (in this repo named firstboot.sh)."},{"timestamp":1557253792,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Uploaded patch set 3."},{"timestamp":1557253825,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1557253917,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Patch Set 3:\n\n\u003e The port is not actually configurable here. It\u0027s a hardcoded value\n \u003e in the sapi template. As such it seems to me that we\u0027d be better\n \u003e off not creating this additional smf service or all this additional\n \u003e complexity and just add:\n \u003e \n \u003e mdata-put metricPorts 3020\n \u003e \n \u003e to the setup.sh (in this repo named firstboot.sh).\n\nDone. I pulled the port value from the SAPI config rather than hardcoding the 3020 here, so we don\u0027t have to remember to update it in two places, should it ever need updating."},{"timestamp":1557416693,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 3: Code-Review+1\n\nAre we guaranteed config-agent has completed by this point? I assume you\u0027ve tested  an image with patchset 3? If so, I can give IA as well once this gets  rebased."},{"timestamp":1557419223,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 3: Integration-Approval+1\n\nI guess manta_common_setup ensures that config-agent is at least started through manta_enable_config_agent. So I guess we should be fine."},{"timestamp":1557420470,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Patch Set 4: Patch Set 3 was rebased"},{"timestamp":1557420500,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4:\n\n\"make check\" passed ok"},{"timestamp":1557420581,"reviewer":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"message":"Patch Set 5: Commit message was updated."},{"timestamp":1557420609,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Isaac Davis"}],"currentPatchSet":{"number":"5","revision":"7d8ae919efaf62fcc247f56df32ed865ae83122c","parents":["d9384f0fdc5ffc1f32939c2915c2cd080b929b7c"],"ref":"refs/changes/97/5697/5","uploader":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"createdOn":1557420581,"author":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1557253825,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1557416693,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1557419223,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"SUBM","value":"1","grantedOn":1557420608,"by":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"boot/firstboot.sh","type":"MODIFIED","insertions":15,"deletions":0}],"sizeInsertions":15,"sizeDeletions":0},"patchSets":[{"number":"1","revision":"9c79b785700e497552bd4a21f3782d60d956149a","parents":["3ada5d58789712a0a2fc79c399e26a54c7e54d4f"],"ref":"refs/changes/97/5697/1","uploader":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"createdOn":1551490296,"author":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1551490322,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"boot/firstboot.sh","type":"MODIFIED","insertions":13,"deletions":0}],"sizeInsertions":13,"sizeDeletions":0},{"number":"2","revision":"c6549a78249a36341a8efdcccdf0428ada20d511","parents":["30fef8826452a28d4bcdaff529c3570b13ab280d"],"ref":"refs/changes/97/5697/2","uploader":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"createdOn":1557189282,"author":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1557189320,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"boot/firstboot.sh","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"smf/manifests/metric-ports-updater.xml","type":"ADDED","insertions":54,"deletions":0},{"file":"smf/methods/metric-ports-updater.sh","type":"ADDED","insertions":44,"deletions":0}],"sizeInsertions":116,"sizeDeletions":-2},{"number":"3","revision":"521ac7bfedf73ecfed5db848f1e8ab488501b5d0","parents":["30fef8826452a28d4bcdaff529c3570b13ab280d"],"ref":"refs/changes/97/5697/3","uploader":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"createdOn":1557253792,"author":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1557253825,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1557416693,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1557419223,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"boot/firstboot.sh","type":"MODIFIED","insertions":15,"deletions":0}],"sizeInsertions":15,"sizeDeletions":0},{"number":"4","revision":"8f91b4c38f775423fd5b461eec7e709fc4cb337e","parents":["d9384f0fdc5ffc1f32939c2915c2cd080b929b7c"],"ref":"refs/changes/97/5697/4","uploader":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"createdOn":1557420470,"author":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1557253825,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1557416693,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1557419223,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"boot/firstboot.sh","type":"MODIFIED","insertions":15,"deletions":0}],"sizeInsertions":15,"sizeDeletions":0},{"number":"5","revision":"7d8ae919efaf62fcc247f56df32ed865ae83122c","parents":["d9384f0fdc5ffc1f32939c2915c2cd080b929b7c"],"ref":"refs/changes/97/5697/5","uploader":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"createdOn":1557420581,"author":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1557253825,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1557416693,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1557419223,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"SUBM","value":"1","grantedOn":1557420608,"by":{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"boot/firstboot.sh","type":"MODIFIED","insertions":15,"deletions":0}],"sizeInsertions":15,"sizeDeletions":0}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},{"name":"Isaac Davis","email":"isaac.davis@joyent.com","username":"isaacdavis"}]}