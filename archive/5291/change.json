{"project":"joyent/sdc-cloudapi","branch":"master","id":"I6b83c49a03251e3ae19575b74ea0d3d1e6292228","number":"5291","subject":"TRITON-966 Add `CreateMachineDisk`, `ResizeMachineDisk` and `DeleteMachineDisk` end-points to CloudAPI Reviewed by: Mike Gerdts \u003cmike.gerdts@joyent.com\u003e Reviewed by: Pedro Palazón Candel \u003cpedro@joyent.com\u003e Approved by: Pedro Palazón Candel \u003cpedro@joyent.c","owner":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"url":"https://cr.joyent.us/5291","commitMessage":"TRITON-966 Add `CreateMachineDisk`, `ResizeMachineDisk` and `DeleteMachineDisk` end-points to CloudAPI\nReviewed by: Mike Gerdts \u003cmike.gerdts@joyent.com\u003e\nReviewed by: Pedro Palazón Candel \u003cpedro@joyent.com\u003e\nApproved by: Pedro Palazón Candel \u003cpedro@joyent.com\u003e\n","createdOn":1545903530,"lastUpdated":1551379744,"open":false,"status":"MERGED","comments":[{"timestamp":1545903530,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Uploaded patch set 1."},{"timestamp":1545903567,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1545928798,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 1:\n\n(2 comments)\n\nI\u0027m not sure that \"slot\" is the right key.  I\u0027ve sent email to start a discussion on this."},{"timestamp":1545943987,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1545952268,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1546597022,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Uploaded patch set 2."},{"timestamp":1546597059,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1546597115,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 2:\n\nsdcadm up cloudapi@b3b0ee06-1006-11e9-a17e-07f259de0594 --channel\u003dexperimental"},{"timestamp":1546597390,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 2:\n\n\u003e It seems that the most likely cause of a slow disk resize or delete operation is going to be some network or service problem.  The related ZFS operations should be pretty quick.\n\nI concur that the ZFS part will be quick, but the jobs queue. For most (all?) async operations in cloudapi we provide a faux state field to aid tracking what\u0027s going on.\n\nBut perhaps I\u0027m overdoing things here. I\u0027m open to tossing the whole facade out -- it\u0027s less code and less vmapi calls."},{"timestamp":1546604427,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 2:\n\n(3 comments)\n\nLet\u0027s see what Pedro has to say about which calls should be listing disks and if/when we should worry about setting and reporting state.\n\nThanks for switching to identifying disks by pci slot rather than path. I think now more than ever it makes sense to identify the disk by \"slot\" or \"pci_slot\"."},{"timestamp":1546825206,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 2:\n\n(2 comments)"},{"timestamp":1546903799,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 2:\n\nThe arguments you make are well taken.  I was somewhat surprised to pci_slot become a required parameter during create when path wasn\u0027t previously required.  \n\nI struggle a bit with the notion that we may force API users into implementation details of bhyve.  I wonder if we would be better off figuring out how to send something a bit more generic - perhaps a generic id that doesn\u0027t really mean anything to bhyve or a value that is set as the serial number for the drive.  Setting the serial number would require some bhyve work."},{"timestamp":1546962986,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 2:\n\n(1 comment)\n\nI\u0027d say that trying to use the serial disk number would enter another unnecessary level of complexity here. What we need is just a unique identifier that can be used to univocally point to a given disk. My take would be to go for a unique UUID either randomly generated at runtime by vmadm when not provided or, eventually, provided by VMAPI when we want to avoid having to wait for the vmadm call to return from the API request, so we can return a location header with the right uuid.\n\nI assume that it would be possible to store such uuid information into the vmadm disks section of the VM object, associated with the disk we\u0027re referring to, right?\n\n\n\u003e The arguments you make are well taken.  I was somewhat surprised to\n \u003e pci_slot become a required parameter during create when path wasn\u0027t\n \u003e previously required.\n \u003e \n \u003e I struggle a bit with the notion that we may force API users into\n \u003e implementation details of bhyve.  I wonder if we would be better\n \u003e off figuring out how to send something a bit more generic - perhaps\n \u003e a generic id that doesn\u0027t really mean anything to bhyve or a value\n \u003e that is set as the serial number for the drive.  Setting the serial\n \u003e number would require some bhyve work."},{"timestamp":1547363167,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Uploaded patch set 3."},{"timestamp":1547363205,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1547658924,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 3: Code-Review+1\n\nLGTM Marsell. Note we\u0027re 2019 now, though ;-)"},{"timestamp":1547658963,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 3:\n\n\u003e LGTM Marsell. Note we\u0027re 2019 now, though ;-)\n\nAlso, shall I assume we\u0027re gonna try to do some testing when possible?"},{"timestamp":1547664671,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 3:\n\n(9 comments)"},{"timestamp":1547664959,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 3:\n\nOops, forgot to ask about tests."},{"timestamp":1548093445,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 3:\n\n(3 comments)"},{"timestamp":1548093501,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Uploaded patch set 4."},{"timestamp":1548093538,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1548093553,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 4:\n\nI\u0027m waiting for us to be happy with the API before putting up tests. They\u0027ll go up before integration."},{"timestamp":1548165236,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 4:\n\nI\u0027m happy with these changes and justification for lack of change.  Just waiting on tests and final thoughts on https://cr.joyent.us/#/c/5396/."},{"timestamp":1548186864,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 4: Code-Review+1\n\nCode looks correct. I like https://cr.joyent.us/#/c/5396/ though"},{"timestamp":1548259659,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 4: Code-Review+1"},{"timestamp":1551290275,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Uploaded patch set 5."},{"timestamp":1551290312,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing-1\n\n(8 comments)\n\n\"make check\" exited with status 2"},{"timestamp":1551290641,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Uploaded patch set 6."},{"timestamp":1551290682,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 6: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1551377926,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 6: Code-Review+1 Integration-Approval+1"},{"timestamp":1551378199,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Uploaded patch set 7."},{"timestamp":1551378238,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 7: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1551378674,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 7: Code-Review+1 Integration-Approval+1"},{"timestamp":1551379109,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 7: Code-Review+1"},{"timestamp":1551379738,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 8: Commit message was updated."},{"timestamp":1551379744,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Marsell Kukuljevic"}],"currentPatchSet":{"number":"8","revision":"6c9376379b2a71984846b85746acc6dcfc53f266","parents":["e6ea96d12d8f18348b6fd102dbe83e062f999d45"],"ref":"refs/changes/91/5291/8","uploader":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"createdOn":1551379738,"author":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1551378238,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1551378674,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1551378674,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1551379109,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}},{"type":"SUBM","value":"1","grantedOn":1551379744,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":376,"deletions":-3},{"file":"lib/app.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/endpoints/disks.js","type":"ADDED","insertions":612,"deletions":0},{"file":"lib/machines.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"test/machines.94.test.js","type":"MODIFIED","insertions":424,"deletions":-2}],"sizeInsertions":1417,"sizeDeletions":-7},"patchSets":[{"number":"1","revision":"b9f1ae69578657dccebaa41904c1dd04f8b37431","parents":["362d4c355649de8d00a014b1f59be4478159e71b"],"ref":"refs/changes/91/5291/1","uploader":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"createdOn":1545903530,"author":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1545903567,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"docs/index.md","line":931,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"ListMacineDisks (plural)"},{"file":"lib/endpoints/disks.js","line":484,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"While this is consistent with an earlier draft, this is no longer consistent with the current draft.  Now, the list if disks is obtained via GetMachine.\n\nhttps://github.com/joyent/rfd/blob/master/rfd/0154/README.md#getmachine-disks"},{"file":"lib/endpoints/disks.js","line":484,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"I don\u0027t think this will work well in practice. Two issues:\n\nWe\u0027ll be POSTing to /:account/machines/:machine/disks and DELETEing /:account/machines/:machine/disks/:pci_slot, but GET /:account/machines/:machine/disks (and presumable GET /:account/machines/:machine/disks/:pci_slot too) won\u0027t work. This is surprising and inconsistent with all our other endpoints.\n\nOkay, we could do both! But problem two:\n\nI\u0027m digging into queued and running jobs here to fake a \"state\" attribute on disk objects -- see loadDiskJobs() above. These calls are quite expensive, and we can\u0027t have them in an endpoint as common as GetMachine or ListMachines. GetMachineDisk and GetMachineDisks are at least off the beaten path. If we go with disks listed in GetMachine, we\u0027ll have to abandon the \"state\" attribute. This will make the lives of consumers more difficult.\n\nIdeally we\u0027d have disk lists in GetMachine, but due to how lower layers currently work I think pragmatically we should leave it split out."},{"file":"lib/endpoints/disks.js","line":484,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"The discussion that led to this change is at\n\nhttps://chatlogs.joyent.us/logs/triton-commercial/2018/11/13\n\nI really don\u0027t have a strong opinion one way or another.\n\nTo be clear, ListMachines does not return an array of disks.  It does have a \"disk\" field, but that is just an integer that has historically been related to quota.  I\u0027m not sure how common it is to call GetMachine and I appreciate your concern about adding a bunch of overhead for data that will likely be ignored.\n\nThat being said, I\u0027m not sure how important tracking the state is.  It seems that the most likely cause of a slow disk resize or delete operation is going to be some network or service problem.  The related ZFS operations should be pretty quick.\n\n- Resizing to a larger size should be pretty much instantaneous because this is just a couple metadata updates.\n- Resizing to a smaller size should be just about as quick because there shouldn\u0027t be a significant amount of data written to the space that is being chopped off.  (And if there is, it\u0027s still not clear that this will take a non-trivial amount of time.)\n- Deleting a disk (and possibly resizing smaller) should be quite quick too due to async destroy. https://www.delphix.com/blog/delphix-engineering/performance-zfs-destroy\n\nAnother way to look at it:\n\n- To ZFS, growing a zvol is not terribly different amount of work than adjusting reservation or refreservation.  If we don\u0027t need a \"resizing\" state on VMs that are being resized, we probably don\u0027t need it on disks.\n- To ZFS, Deleting a volume is pretty much the same work as deleting a snapshot.  If we don\u0027t need an explicit \"deleting\" state on snapshots, we probably don\u0027t need it on disks.\n\nMaybe states like those being proposed here are more prevalent, but my quick code inspection didn\u0027t turn them up.  If they are really important, maybe there\u0027s still a way to satisfy Pedro\u0027s \"everything you need to know regarding a machine should come with a single getMachinecall\" by retaining GetMachineDisks as you have implemented it and having GetMachine return a list of disks but without the expensive state field."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":333,"deletions":0},{"file":"lib/app.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/endpoints/disks.js","type":"ADDED","insertions":542,"deletions":0},{"file":"lib/machines.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":880,"sizeDeletions":-2},{"number":"2","revision":"92b0f825ba1a12d1d7cf34859dedf4a453b7d5c5","parents":["362d4c355649de8d00a014b1f59be4478159e71b"],"ref":"refs/changes/91/5291/2","uploader":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"createdOn":1546597022,"author":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1546597059,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"docs/index.md","line":5983,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"I find it confusing when we call the same thing by different names in different places.  Is there a reason for not calling it \"pci_slot\" like is used in the VM.js payload?"},{"file":"docs/index.md","line":5983,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"I did this because ids are typically used for customer-facing unique identifiers in cloudapi. However, MACs don\u0027t follow this pattern, so there\u0027s precedent.\n\nI\u0027ll change it to pci_slot."},{"file":"docs/index.md","line":5983,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Thanks, I agree pci_slot would be clearer on this case."},{"file":"lib/endpoints/disks.js","line":75,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"If VM.update()\u0027s update_disk payload does not have a slot, it will automatically assign one.  It would generally be preferable to not specify slot and have VM.js assign one, as this simplifies API use.\n\nI do like the idea of being able to specify the slot so that disks can be put into deterministic locations."},{"file":"lib/endpoints/disks.js","line":75,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"It\u0027s definitely easier to let vmadm make the choice, so I\u0027d go with that except for:\n\n* if a request is unintentionally repeated, the VM may end up with two new disks instead of one. Requiring pci_slot up front provides a primitive form of idempotency -- only one disk will be created.\n\n* if we leave the slot choice to vmadm, then cloudapi has no sane way of finding out what that new unique identifier is. Without that we can\u0027t return a disk object upon POST, and we can\u0027t provide a Location in the header. This is a definite deviation from other cloudapi behaviour, and if you\u0027re into the whole RESTful thing it\u0027s unexpected.\n\nI think the latter is a more compelling problem.\n\nAs you suggest, let\u0027s defer to Pedro."},{"file":"lib/endpoints/disks.js","line":379,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"matchSlot"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":348,"deletions":0},{"file":"lib/app.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/endpoints/disks.js","type":"ADDED","insertions":588,"deletions":0},{"file":"lib/machines.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":941,"sizeDeletions":-2},{"number":"3","revision":"f46a55a7129e10e6c9ca30bd2237fdbe748e1446","parents":["362d4c355649de8d00a014b1f59be4478159e71b"],"ref":"refs/changes/91/5291/3","uploader":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"createdOn":1547363167,"author":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1547363205,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1547658924,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"comments":[{"file":"docs/index.md","line":15,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"2019"},{"file":"docs/index.md","line":931,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"As mentioned in round 1, ListMachineDisks (plural)."},{"file":"docs/index.md","line":5923,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"or `pci_slot`"},{"file":"docs/index.md","line":6007,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":", `pci_slot`,"},{"file":"lib/endpoints/disks.js","line":8,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"2019"},{"file":"lib/endpoints/disks.js","line":72,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"\u0026\u0026 !PCI_SLOT_RE.test(pciSlot)"},{"file":"lib/endpoints/disks.js","line":96,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"PCI_SLOT_RE.test()"},{"file":"lib/endpoints/disks.js","line":96,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"If the previous suggestion is used, this won\u0027t be necessary."},{"file":"lib/endpoints/disks.js","line":163,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"validate with PCI_SLOT_RE.test() before passing it along"},{"file":"lib/endpoints/disks.js","line":163,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"It\u0027s validated by getMachineDisk(), which is called before resizeDisk()"},{"file":"lib/endpoints/disks.js","line":537,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"I probably misunderstand the relevance of these version strings.  According to index.md, this is added in 9.4.0."},{"file":"lib/endpoints/disks.js","line":537,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Indeed, but I don\u0027t see how it can hurt if it\u0027s made available to older versions. Version numbers are only important when an existing API endpoint\u0027s behaviour changes somehow.\n\nThis is how we\u0027ve operated for a few years now. I\u0027m open to the possibility this is a bad idea, but making new endpoints available to old versions seems like a net win over a more strict interpretation."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":366,"deletions":0},{"file":"lib/app.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/endpoints/disks.js","type":"ADDED","insertions":590,"deletions":0},{"file":"lib/machines.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":961,"sizeDeletions":-2},{"number":"4","revision":"18c7a64ef4678e41d712bcc305829228d9031b38","parents":["362d4c355649de8d00a014b1f59be4478159e71b"],"ref":"refs/changes/91/5291/4","uploader":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"createdOn":1548093501,"author":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1548093538,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1548186864,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1548259659,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":367,"deletions":-1},{"file":"lib/app.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/endpoints/disks.js","type":"ADDED","insertions":590,"deletions":0},{"file":"lib/machines.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":962,"sizeDeletions":-3},{"number":"5","revision":"dd5c42e8fb56ea61c002e4289c339db28c59fcf0","parents":["e6ea96d12d8f18348b6fd102dbe83e062f999d45"],"ref":"refs/changes/91/5291/5","uploader":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"createdOn":1551290275,"author":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1551290312,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"test/machines.94.test.js","line":399,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"warning: redeclaration of listMachineDisksTest"},{"file":"test/machines.94.test.js","line":422,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"warning: variable is declared but never referenced: expectedDisks"},{"file":"test/machines.94.test.js","line":770,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"warning: redeclaration of resizeMachineDiskTest"},{"file":"test/machines.94.test.js","line":790,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"warning: redeclaration of resizeMachineDiskTest"},{"file":"test/machines.94.test.js","line":812,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"warning: redeclaration of resizeMachineDiskTest"},{"file":"test/machines.94.test.js","line":889,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"warning: redeclaration of deleteMachineDisk"},{"file":"test/machines.94.test.js","line":935,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"warning: redeclaration of createMachineDiskTest"},{"file":"test/machines.94.test.js","line":954,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"warning: redeclaration of createMachineDiskTest"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":376,"deletions":-3},{"file":"lib/app.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/endpoints/disks.js","type":"ADDED","insertions":612,"deletions":0},{"file":"lib/machines.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"test/machines.94.test.js","type":"MODIFIED","insertions":439,"deletions":-2}],"sizeInsertions":1432,"sizeDeletions":-7},{"number":"6","revision":"87b0a8aea159d1de43e5167de0c762b40cd800c1","parents":["e6ea96d12d8f18348b6fd102dbe83e062f999d45"],"ref":"refs/changes/91/5291/6","uploader":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"createdOn":1551290641,"author":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1551290682,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1551377926,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1551377926,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":376,"deletions":-3},{"file":"lib/app.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/endpoints/disks.js","type":"ADDED","insertions":612,"deletions":0},{"file":"lib/machines.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"test/machines.94.test.js","type":"MODIFIED","insertions":424,"deletions":-2}],"sizeInsertions":1417,"sizeDeletions":-7},{"number":"7","revision":"6b83c49a03251e3ae19575b74ea0d3d1e6292228","parents":["e6ea96d12d8f18348b6fd102dbe83e062f999d45"],"ref":"refs/changes/91/5291/7","uploader":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"createdOn":1551378199,"author":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1551378238,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1551378674,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1551378674,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1551379109,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":376,"deletions":-3},{"file":"lib/app.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/endpoints/disks.js","type":"ADDED","insertions":612,"deletions":0},{"file":"lib/machines.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"test/machines.94.test.js","type":"MODIFIED","insertions":424,"deletions":-2}],"sizeInsertions":1417,"sizeDeletions":-7},{"number":"8","revision":"6c9376379b2a71984846b85746acc6dcfc53f266","parents":["e6ea96d12d8f18348b6fd102dbe83e062f999d45"],"ref":"refs/changes/91/5291/8","uploader":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"createdOn":1551379738,"author":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1551378238,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1551378674,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1551378674,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"SUBM","value":"1","grantedOn":1551379744,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1551379109,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":376,"deletions":-3},{"file":"lib/app.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"lib/endpoints/disks.js","type":"ADDED","insertions":612,"deletions":0},{"file":"lib/machines.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"test/machines.94.test.js","type":"MODIFIED","insertions":424,"deletions":-2}],"sizeInsertions":1417,"sizeDeletions":-7}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}]}