commit 88db337efbfec6fcf812ce8c84dac29869e77a7d (refs/changes/59/2159/1)
Author: David Pacheco <dap@joyent.com>
Date:   2017-06-27T16:09:14-07:00 (2 years, 3 months ago)
    
    MANTA-3333 postgres long-running query probe should exclude autovacuum

diff --git a/alarm_metadata/probe_templates/postgres.yaml b/alarm_metadata/probe_templates/postgres.yaml
index 04659cd..b661696 100644
--- a/alarm_metadata/probe_templates/postgres.yaml
+++ b/alarm_metadata/probe_templates/postgres.yaml
@@ -235,7 +235,7 @@
         -
             type: cmd
             config:
-                cmd: "/opt/local/bin/psql -U postgres -c \"SELECT *, NOW() - query_start AS elapsed FROM pg_stat_activity WHERE state != 'idle' AND NOW() - query_start > interval '120 seconds'\""
+                cmd: "/opt/local/bin/psql -U postgres -c \"SELECT *, NOW() - query_start AS elapsed FROM pg_stat_activity WHERE state != 'idle' AND query NOT LIKE 'autovacuum: %' AND NOW() - query_start > interval '120 seconds'\""
                 interval: 60
                 timeout: 30
                 stdoutMatch:
