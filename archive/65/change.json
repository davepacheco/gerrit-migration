{"project":"joyent/manatee","branch":"master","topic":"MANATEE-310","id":"I3771c6fbd979ad41e7a71b19f9e2b7ff99542134","number":"65","subject":"MANATEE-310 manatee should not use pfexec (no-op) for zfs commands Reviewed by: Dave Pacheco \u003cdap@joyent.com\u003e","owner":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"url":"https://cr.joyent.us/65","commitMessage":"MANATEE-310 manatee should not use pfexec (no-op) for zfs commands\nReviewed by: Dave Pacheco \u003cdap@joyent.com\u003e\n","createdOn":1468378332,"lastUpdated":1468623819,"open":false,"status":"MERGED","comments":[{"timestamp":1468378332,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Uploaded patch set 1."},{"timestamp":1468391065,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Uploaded patch set 2."},{"timestamp":1468420278,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 2:\n\n(5 comments)"},{"timestamp":1468432252,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Patch Set 2:\n\n(5 comments)\n\nThanks for the feedback, Dave.  I\u0027ll go for another lap."},{"timestamp":1468437046,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 2:\n\n(3 comments)"},{"timestamp":1468437575,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1468564836,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Patch Set 2:\n\n(2 comments)"},{"timestamp":1468564851,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Uploaded patch set 3."},{"timestamp":1468590836,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 3: Code-Review+2"},{"timestamp":1468622805,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Joshua M. Clulow"},{"timestamp":1468623819,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Topic set to MANATEE-310"}],"currentPatchSet":{"number":"3","revision":"3771c6fbd979ad41e7a71b19f9e2b7ff99542134","parents":["86157360654ab6cde0810be7de0ea5d352b6f8ab"],"ref":"refs/changes/65/65/3","uploader":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"createdOn":1468564851,"author":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"2","grantedOn":1468590836,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"SUBM","value":"1","grantedOn":1468622805,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"lib/postgresMgr.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/snapShotter.js","type":"MODIFIED","insertions":193,"deletions":-60},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":196,"sizeDeletions":-63},"patchSets":[{"number":"1","revision":"3ebf68d33116401f9ea75cadd53dd30ba64f0c95","parents":["86157360654ab6cde0810be7de0ea5d352b6f8ab"],"ref":"refs/changes/65/65/1","uploader":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"createdOn":1468378332,"author":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"isDraft":true,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/snapShotter.js","type":"MODIFIED","insertions":175,"deletions":-68}],"sizeInsertions":175,"sizeDeletions":-68},{"number":"2","revision":"a662cccfb617b7a186236a95cdd9c23825d42d86","parents":["86157360654ab6cde0810be7de0ea5d352b6f8ab"],"ref":"refs/changes/65/65/2","uploader":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"createdOn":1468391065,"author":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"isDraft":false,"kind":"REWORK","comments":[{"file":"lib/snapShotter.js","line":23,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"It seems like we\u0027re half-changing the style here.  Presumably the rest of the repo still uses no \"mod_\" prefix, and even this file uses no prefix for several modules?"},{"file":"lib/snapShotter.js","line":23,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"It\u0027s a work in progress.  I mostly (apart from, I guess, \"assert\") just changed lines I was otherwise touching, rather than everything in the file.  I can do everything in the file if you\u0027d prefer."},{"file":"lib/snapShotter.js","line":23,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I think it would be best to be consistent across the repo.  If we change everything in the file or repo, it would seem far better to do that in a separate change."},{"file":"lib/snapShotter.js","line":23,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"OK, I\u0027ll file a follow-up to do some spring-cleaning then."},{"file":"lib/snapShotter.js","line":205,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"This could just be: \"return (t \u0026\u0026 t[2].match(/^\\d{13}$/));\""},{"file":"lib/snapShotter.js","line":205,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"It could.  I suppose the fact that that would return \"undefined\" under some conditions doesn\u0027t really matter, because \"filter()\" doesn\u0027t use the result strictly as a boolean.  I\u0027ll make this change."},{"file":"lib/snapShotter.js","line":205,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Good point.  I would probably do something like I initially suggested, but add a \"!\u003d\u003d undefined\" to make sure that it\u0027s a boolean.  This is no big deal either way."},{"file":"lib/snapShotter.js","line":205,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Done"},{"file":"lib/snapShotter.js","line":334,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Did you mean to drop the wrapper object here the way you did in createSnapshot?"},{"file":"lib/snapShotter.js","line":334,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"No, because I don\u0027t think bunyan does what I want if \"err\" is \"undefined\" or \"null\" here."},{"file":"lib/snapShotter.js","line":334,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Ah, got it.  Thanks."},{"file":"lib/snapShotter.js","line":366,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Did you mean to drop the wrapper object here the way you did in createSnapshot?"},{"file":"lib/snapShotter.js","line":366,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"No, because I don\u0027t think bunyan does what I want if \"err\" is \"undefined\" or \"null\" here."},{"file":"lib/snapShotter.js","line":413,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"It would be nice to use node-forkexec here (e.g., https://github.com/joyent/node-forkexec#interpretchildprocessresult), which produces a message about either the signal or the exit status.  We could still add the stdout or stderr here (or add that to node-forkexec)."},{"file":"lib/snapShotter.js","line":413,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"OK, I will rework it to use that library."},{"file":"lib/snapShotter.js","line":413,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/postgresMgr.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/snapShotter.js","type":"MODIFIED","insertions":176,"deletions":-69}],"sizeInsertions":178,"sizeDeletions":-71},{"number":"3","revision":"3771c6fbd979ad41e7a71b19f9e2b7ff99542134","parents":["86157360654ab6cde0810be7de0ea5d352b6f8ab"],"ref":"refs/changes/65/65/3","uploader":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"createdOn":1468564851,"author":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"2","grantedOn":1468590836,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"SUBM","value":"1","grantedOn":1468622805,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"lib/postgresMgr.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/snapShotter.js","type":"MODIFIED","insertions":193,"deletions":-60},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":196,"sizeDeletions":-63}],"allReviewers":[{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}]}