{"project":"joyent/sdc-headnode","branch":"master","id":"I026f0dfd316a3631596a740b0c06435c23e419c4","number":"2734","subject":"HEAD-2367 sdc-login should not consider remote VMs that are not running Reviewed by: Robert Mustacchi \u003crm@joyent.com\u003e","owner":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"url":"https://cr.joyent.us/2734","commitMessage":"HEAD-2367 sdc-login should not consider remote VMs that are not running\nReviewed by: Robert Mustacchi \u003crm@joyent.com\u003e\n","createdOn":1507244515,"lastUpdated":1507247098,"open":false,"status":"MERGED","comments":[{"timestamp":1507244515,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Uploaded patch set 1."},{"timestamp":1507244517,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit 320ec1c07ab38a9db7a71be4e688f8b21abdcc06\n    \n    do it"},{"timestamp":1507244667,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1507244793,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1507245642,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Uploaded patch set 2."},{"timestamp":1507245643,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit 8cfee16aa098fbb7217554db349121ae1d240f22\n    \n    update from rm\u0027s CR"},{"timestamp":1507245665,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 1:\n\n(1 comment)\n\nTesting that it works:\n\n```\n[root@headnode0 (coal hn) ~]# sdc-oneachnode -a \u0027vmadm list | grep vmapi\u0027\nHOSTNAME              STATUS\ncn2                   2f612f25-792d-4d13-9360-44a862cd1cb0  OS    1024     running           vmapi1\nheadnode0             eea6b276-d79c-4ddb-9f11-4c00c84dc463  OS    1024     stopped           vmapi0\n[root@headnode0 (coal hn) ~]# sdc-login -l vmapi\nRequested unique lookup but found 0 results.\n/opt/smartdc/bin/sdc-login: fatal error: did not find exactly 1 zone matching: vmapi\n[root@headnode0 (coal hn) ~]# sdc-login vmapi hostname\n2f612f25-792d-4d13-9360-44a862cd1cb0\nConnection to 10.99.99.45 closed.\n[root@headnode0 (coal hn) ~]# sdc-login -s vmapi\nNUMBER   VM_UUID                              ALIAS\n0        eea6b276-d79c-4ddb-9f11-4c00c84dc463 vmapi0 (headnode0)\n1        2f612f25-792d-4d13-9360-44a862cd1cb0 vmapi1 (cn2)\nChoose a number [0-1]: 1\n- SmartOS (build: 20170828T221743Z)\nYou have new mail.\n[root@cn2 (coal hn) ~]# logout\n```"},{"timestamp":1507245716,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 2:\n\nunmangled test log ^^^ is here: https://gist.github.com/trentm/92d48ad82d0c58647c5d64713cf0594a"},{"timestamp":1507245791,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1507245886,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 2: Code-Review+1"},{"timestamp":1507247085,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Uploaded patch set 3: Commit message was updated."},{"timestamp":1507247096,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 3: Integration-Approval+1"},{"timestamp":1507247098,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Trent Mick"}],"currentPatchSet":{"number":"3","revision":"026f0dfd316a3631596a740b0c06435c23e419c4","parents":["a714493080a9a691eafa4ba8b42de59e3e4a2ec4"],"ref":"refs/changes/34/2734/3","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1507247085,"author":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1507245791,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1507245886,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1507247096,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1507247098,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"tools/bin/sdc-login","type":"MODIFIED","insertions":9,"deletions":-6}],"sizeInsertions":9,"sizeDeletions":-6},"patchSets":[{"number":"1","revision":"0459dfef6198d9a9730abdf40ddbad9e9085f205","parents":["a714493080a9a691eafa4ba8b42de59e3e4a2ec4"],"ref":"refs/changes/34/2734/1","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1507244515,"author":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1507244667,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"tools/bin/sdc-login","line":157,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Does this end up causing someone not being able to log into the server of a stopped zone? Maybe it shouldn\u0027t filter out if the -s option is specified?"},{"file":"tools/bin/sdc-login","line":157,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Ah good point. Thanks!  Updated."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"tools/bin/sdc-login","type":"MODIFIED","insertions":2,"deletions":-1}],"sizeInsertions":2,"sizeDeletions":-1},{"number":"2","revision":"d9b2aa07b1049ad82576934782cf8086339671f8","parents":["a714493080a9a691eafa4ba8b42de59e3e4a2ec4"],"ref":"refs/changes/34/2734/2","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1507245642,"author":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1507245886,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1507245791,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"tools/bin/sdc-login","type":"MODIFIED","insertions":9,"deletions":-6}],"sizeInsertions":9,"sizeDeletions":-6},{"number":"3","revision":"026f0dfd316a3631596a740b0c06435c23e419c4","parents":["a714493080a9a691eafa4ba8b42de59e3e4a2ec4"],"ref":"refs/changes/34/2734/3","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1507247085,"author":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1507245886,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1507245791,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1507247096,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1507247098,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"tools/bin/sdc-login","type":"MODIFIED","insertions":9,"deletions":-6}],"sizeInsertions":9,"sizeDeletions":-6}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}]}