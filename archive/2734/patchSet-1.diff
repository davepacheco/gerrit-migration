From 0459dfef6198d9a9730abdf40ddbad9e9085f205 Mon Sep 17 00:00:00 2001
From: Trent Mick <trentm@gmail.com>
Date: Thu, 5 Oct 2017 16:01:55 -0700
Subject: [PATCH] HEAD-2367 sdc-login should not consider remote VMs that are
 not running

---
 tools/bin/sdc-login | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/tools/bin/sdc-login b/tools/bin/sdc-login
index cdeccd7a..63546116 100755
--- a/tools/bin/sdc-login
+++ b/tools/bin/sdc-login
@@ -154,7 +154,8 @@ query="this.instance === '${zone}' \
 
 IFS=$'\n'
 results=$(sdcadm insts -H -s alias -j type=vm \
-    | json -c 'this.server_ip !== null' -c "${query}")
+    | json -c 'this.server_ip !== null && this.state === "running"' \
+        -c "${query}")
 length=$(json length <<< "${results}")
 if [[ ${length} -eq 0 ]]; then
     if [[ ${to_server} -eq 1 && \
-- 
2.21.0

