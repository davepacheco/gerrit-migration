{"project":"joyent/node-sshpk","branch":"master","id":"Ia3835dbd3014be44bce904321d794e3412a5735b","number":"2390","subject":"joyent/node-sshpk#32 support dnssec format","owner":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"url":"https://cr.joyent.us/2390","commitMessage":"joyent/node-sshpk#32 support dnssec format\n","createdOn":1502747398,"lastUpdated":1503093476,"open":false,"status":"MERGED","comments":[{"timestamp":1502747398,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Uploaded patch set 1."},{"timestamp":1502747422,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1502752510,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Uploaded patch set 2."},{"timestamp":1502752544,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1502755152,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Uploaded patch set 3."},{"timestamp":1502755181,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1502817479,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Uploaded patch set 4."},{"timestamp":1502817508,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1502924940,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 4:\n\n(16 comments)"},{"timestamp":1502992542,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Uploaded patch set 5."},{"timestamp":1502992551,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Patch Set 4:\n\n(16 comments)"},{"timestamp":1502992571,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1503004995,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 5: Code-Review+1"},{"timestamp":1503078755,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 5: Integration-Approval+1"},{"timestamp":1503093476,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Tim Kordas"}],"currentPatchSet":{"number":"5","revision":"a3835dbd3014be44bce904321d794e3412a5735b","parents":["a17ec8861242649038dcdba8f8d7df5edf2ddb8c"],"ref":"refs/changes/90/2390/5","uploader":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"createdOn":1502992542,"author":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1502992571,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1503004995,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1503078755,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"SUBM","value":"1","grantedOn":1503093476,"by":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"bin/sshpk-conv","type":"MODIFIED","insertions":7,"deletions":-6},{"file":"lib/dhe.js","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"lib/formats/auto.js","type":"MODIFIED","insertions":33,"deletions":0},{"file":"lib/formats/dnssec.js","type":"ADDED","insertions":286,"deletions":0},{"file":"lib/key.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/private-key.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"lib/utils.js","type":"MODIFIED","insertions":40,"deletions":-1},{"file":"test/assets/Kecdsatest.+013+43896.key","type":"ADDED","insertions":1,"deletions":0},{"file":"test/assets/Kecdsatest.+013+43896.pem","type":"ADDED","insertions":5,"deletions":0},{"file":"test/assets/Kecdsatest.+013+43896.private","type":"ADDED","insertions":6,"deletions":0},{"file":"test/assets/Kecdsatest.+013+43896_pub.pem","type":"ADDED","insertions":4,"deletions":0},{"file":"test/assets/Krsatest.+005+57206.key","type":"ADDED","insertions":1,"deletions":0},{"file":"test/assets/Krsatest.+005+57206.pem","type":"ADDED","insertions":15,"deletions":0},{"file":"test/assets/Krsatest.+005+57206.private","type":"ADDED","insertions":13,"deletions":0},{"file":"test/assets/Krsatest.+005+57206_pub.pem","type":"ADDED","insertions":6,"deletions":0},{"file":"test/dnssec.js","type":"ADDED","insertions":134,"deletions":0}],"sizeInsertions":553,"sizeDeletions":-9},"patchSets":[{"number":"1","revision":"98403e9caa12e31782d88908eafe429e593c7bcc","parents":["a17ec8861242649038dcdba8f8d7df5edf2ddb8c"],"ref":"refs/changes/90/2390/1","uploader":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"createdOn":1502747398,"author":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1502747422,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"bin/sshpk-conv","type":"MODIFIED","insertions":7,"deletions":-6},{"file":"lib/dhe.js","type":"MODIFIED","insertions":25,"deletions":-2},{"file":"lib/formats/auto.js","type":"MODIFIED","insertions":30,"deletions":0},{"file":"lib/formats/dnssec.js","type":"ADDED","insertions":264,"deletions":0},{"file":"lib/key.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/private-key.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"lib/utils.js","type":"MODIFIED","insertions":8,"deletions":0}],"sizeInsertions":336,"sizeDeletions":-9},{"number":"2","revision":"d0e3c2796e1743b351c12cd5c0cf61a61a4bf6e0","parents":["a17ec8861242649038dcdba8f8d7df5edf2ddb8c"],"ref":"refs/changes/90/2390/2","uploader":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"createdOn":1502752510,"author":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1502752544,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"bin/sshpk-conv","type":"MODIFIED","insertions":7,"deletions":-6},{"file":"lib/dhe.js","type":"MODIFIED","insertions":25,"deletions":-2},{"file":"lib/formats/auto.js","type":"MODIFIED","insertions":30,"deletions":0},{"file":"lib/formats/dnssec.js","type":"ADDED","insertions":263,"deletions":0},{"file":"lib/key.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/private-key.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"lib/utils.js","type":"MODIFIED","insertions":8,"deletions":0}],"sizeInsertions":335,"sizeDeletions":-9},{"number":"3","revision":"70a0fce034e5d987f311caf0da704336e59bf677","parents":["a17ec8861242649038dcdba8f8d7df5edf2ddb8c"],"ref":"refs/changes/90/2390/3","uploader":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"createdOn":1502755152,"author":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1502755181,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"bin/sshpk-conv","type":"MODIFIED","insertions":7,"deletions":-6},{"file":"lib/dhe.js","type":"MODIFIED","insertions":25,"deletions":-2},{"file":"lib/formats/auto.js","type":"MODIFIED","insertions":32,"deletions":0},{"file":"lib/formats/dnssec.js","type":"ADDED","insertions":263,"deletions":0},{"file":"lib/key.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/private-key.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"lib/utils.js","type":"MODIFIED","insertions":8,"deletions":0},{"file":"test/dnssec.js","type":"ADDED","insertions":135,"deletions":0}],"sizeInsertions":472,"sizeDeletions":-9},{"number":"4","revision":"3cf6962432e7d36dacff45cd725cc4fb2c96c121","parents":["a17ec8861242649038dcdba8f8d7df5edf2ddb8c"],"ref":"refs/changes/90/2390/4","uploader":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"createdOn":1502817479,"author":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1502817508,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/dhe.js","line":413,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"I think this would fit better in utils.js, along with addRSAMissing and the other things to fill in bits of keys that aren\u0027t present in all formats.\n\nThis module is about diffie-hellmann computations rather than key operations like that."},{"file":"lib/dhe.js","line":413,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Done"},{"file":"lib/formats/auto.js","line":78,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"If this is a constant it should probably be lifted out into a file-level var like  DNSSEC_PRIVKEY_HDR or something. It\u0027s a good general rule to keep string constants out of functions, as the char length of the code in the function is used by V8 to make optimization decisions, and long string constants can trick it into not bothering to optimize a function that it would otherwise."},{"file":"lib/formats/auto.js","line":78,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Done"},{"file":"lib/formats/auto.js","line":81,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Condition continuations should have the operator on the first line and break after it, not before (this is because of the automatic semicolon generator, which can make some such conditions incorrect otherwise -- not this particular one, but it\u0027s a good rule to follow)"},{"file":"lib/formats/auto.js","line":81,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Done"},{"file":"lib/formats/dnssec.js","line":56,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Can we validate here that this is the last line of the file? I\u0027d rather reject inputs that contain multiple keys than just parse the first one and drop the rest silently."},{"file":"lib/formats/dnssec.js","line":56,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Done"},{"file":"lib/formats/dnssec.js","line":78,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"I guess there\u0027s no other strategy to figure out the length of the modulus we can use here? I\u0027m only concerned because the node.js Buffer base64 parser is extremely forgiving -- it will merrily skip over invalid characters or anything else and keep interpreting any valid base64 chars it sees later. It\u0027s always nice to detect and reject trailing garbage that\u0027s been added to things if we can."},{"file":"lib/formats/dnssec.js","line":78,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"the file format is basically \"the rest is modulus,\" so I think we\u0027re stuck."},{"file":"lib/formats/dnssec.js","line":114,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"I think we should be validating that these lines all actually contain \"Modulus:\", \"Prime1:\" etc in their first field before using them."},{"file":"lib/formats/dnssec.js","line":114,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Done"},{"file":"lib/formats/dnssec.js","line":140,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Should probably make this /^RSA-/, I reckon. Not that it really matters at the moment, but RSAPSS might one day be a thing"},{"file":"lib/formats/dnssec.js","line":140,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Done"},{"file":"lib/formats/dnssec.js","line":143,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Do these really need to be regex matches? We don\u0027t seem to support alternative hash functions with them at the moment? Also we would just discard that data anyway. I feel like these should either be matching on /^ECDSA-P384-/ or else be exact string comparisons."},{"file":"lib/formats/dnssec.js","line":143,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Done"},{"file":"lib/formats/dnssec.js","line":180,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"I think we should take this branch in the case where \"options\" was an object that just didn\u0027t have a \"hashAlgo\" property set on it, as well."},{"file":"lib/formats/dnssec.js","line":180,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Done"},{"file":"lib/formats/dnssec.js","line":258,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"I think this would be more helpful to a user if phrased as \u0027Format \"dnssec\" only supports writing private keys\u0027 or something to that effect. \"without key info\" makes it sound like the user just has to supply some extra info and then it\u0027ll work (when actually the code to write RFC3110 keys isn\u0027t done yet)"},{"file":"lib/formats/dnssec.js","line":258,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Done"},{"file":"lib/utils.js","line":195,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Should make an extra bug to go around and change all the existing instances of this loop into this. (And also to eliminate our use of this on ASN.1 BitStrings, where the first byte is actually the BER unused-bits indicator and not a padding byte at all, because node-asn1 is awesome.)"},{"file":"lib/utils.js","line":195,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Done"},{"file":"test/dnssec.js","line":14,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"I think we should put these in files in tests/assets/ rather than in the code. I\u0027ve been doing that with most new tests (though the older existing ones I haven\u0027t upgraded yet).\n\nIt\u0027s pretty hard to run tools on them and modify them when they\u0027re embedded in the js file like this."},{"file":"test/dnssec.js","line":14,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Looks like I based this on the oldest style test here, instead of the newest."},{"file":"test/dnssec.js","line":94,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Minor style nit: I\u0027d prefer to not have the /// or //// thing going on."},{"file":"test/dnssec.js","line":94,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Done"},{"file":"test/dnssec.js","line":147,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"You can use \"return;\" here instead of a comment. I feel like that\u0027s slightly more idiomatic."},{"file":"test/dnssec.js","line":147,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Done"},{"file":"test/dnssec.js","line":160,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Can we drop the console.log here, please?"},{"file":"test/dnssec.js","line":160,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Done"},{"file":"test/dnssec.js","line":161,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"I think these should be t.strictEqual, so they don\u0027t undergo type coercion."},{"file":"test/dnssec.js","line":161,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"bin/sshpk-conv","type":"MODIFIED","insertions":7,"deletions":-6},{"file":"lib/dhe.js","type":"MODIFIED","insertions":25,"deletions":-2},{"file":"lib/formats/auto.js","type":"MODIFIED","insertions":32,"deletions":0},{"file":"lib/formats/dnssec.js","type":"ADDED","insertions":262,"deletions":0},{"file":"lib/key.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/private-key.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"lib/utils.js","type":"MODIFIED","insertions":8,"deletions":0},{"file":"test/dnssec.js","type":"ADDED","insertions":184,"deletions":0}],"sizeInsertions":520,"sizeDeletions":-9},{"number":"5","revision":"a3835dbd3014be44bce904321d794e3412a5735b","parents":["a17ec8861242649038dcdba8f8d7df5edf2ddb8c"],"ref":"refs/changes/90/2390/5","uploader":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"createdOn":1502992542,"author":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1503004995,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1503078755,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1502992571,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"SUBM","value":"1","grantedOn":1503093476,"by":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"bin/sshpk-conv","type":"MODIFIED","insertions":7,"deletions":-6},{"file":"lib/dhe.js","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"lib/formats/auto.js","type":"MODIFIED","insertions":33,"deletions":0},{"file":"lib/formats/dnssec.js","type":"ADDED","insertions":286,"deletions":0},{"file":"lib/key.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/private-key.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"lib/utils.js","type":"MODIFIED","insertions":40,"deletions":-1},{"file":"test/assets/Kecdsatest.+013+43896.key","type":"ADDED","insertions":1,"deletions":0},{"file":"test/assets/Kecdsatest.+013+43896.pem","type":"ADDED","insertions":5,"deletions":0},{"file":"test/assets/Kecdsatest.+013+43896.private","type":"ADDED","insertions":6,"deletions":0},{"file":"test/assets/Kecdsatest.+013+43896_pub.pem","type":"ADDED","insertions":4,"deletions":0},{"file":"test/assets/Krsatest.+005+57206.key","type":"ADDED","insertions":1,"deletions":0},{"file":"test/assets/Krsatest.+005+57206.pem","type":"ADDED","insertions":15,"deletions":0},{"file":"test/assets/Krsatest.+005+57206.private","type":"ADDED","insertions":13,"deletions":0},{"file":"test/assets/Krsatest.+005+57206_pub.pem","type":"ADDED","insertions":6,"deletions":0},{"file":"test/dnssec.js","type":"ADDED","insertions":134,"deletions":0}],"sizeInsertions":553,"sizeDeletions":-9}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},{"name":"Brittany Wald","email":"brittany.wald@joyent.com","username":"princesspretzel"}]}