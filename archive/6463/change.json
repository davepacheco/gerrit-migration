{"project":"joyent/firewall-logger-agent","branch":"master","id":"I13092413b2e92c1ae9d1b95cedec7f0ed729ab38","number":"6463","subject":"TRITON-1318 need cfwlogd Reviewed by: Mike Gerdts \u003cmike.gerdts@joyent.com\u003e Reviewed by: John Levon \u003cjohn.levon@joyent.com\u003e Reviewed by: Dave Eddy \u003cdave.eddy@joyent.com\u003e Reviewed by: Tim Foster \u003ctim.foster@joyent.com\u003e Reviewed by: Pedro Palazón Candel \u003cped","owner":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"url":"https://cr.joyent.us/6463","commitMessage":"TRITON-1318 need cfwlogd\nReviewed by: Mike Gerdts \u003cmike.gerdts@joyent.com\u003e\nReviewed by: John Levon \u003cjohn.levon@joyent.com\u003e\nReviewed by: Dave Eddy \u003cdave.eddy@joyent.com\u003e\nReviewed by: Tim Foster \u003ctim.foster@joyent.com\u003e\nReviewed by: Pedro Palazón Candel \u003cpedro@joyent.com\u003e\nApproved by: Kelly McLaughlin \u003ckelly.mclaughlin@joyent.com\u003e\n","createdOn":1560892057,"lastUpdated":1562079612,"open":false,"status":"MERGED","comments":[{"timestamp":1560892057,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Uploaded patch set 1."},{"timestamp":1560892061,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1560982578,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Uploaded patch set 2."},{"timestamp":1560982662,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing-1\n\n\"make check\" exited with status 2\n\n fatal: ref HEAD is not a symbolic ref\n json --validate -f package.json\n cargo check\n     Checking vminfod v0.1.0 (/tmp/repo/vminfod)\n error[E0658]: imports can only refer to extern crate names passed with `--extern` on stable channel (see issue #53130)\n   --\u003e vminfod/src/lib.rs:15:5\n    |\n 7  | pub mod client;\n    | --------------- not an extern crate passed with `--extern`\n ...\n 15 | use client::Client;\n    |     ^^^^^^\n    |\n note: this import refers to the module defined here\n   --\u003e vminfod/src/lib.rs:7:1\n    |\n 7  | pub mod client;\n    | ^^^^^^^^^^^^^^^\n \n error: aborting due to previous error\n \n For more information about this error, try `rustc --explain E0658`.\n error: Could not compile `vminfod`.\n \n To learn more, run the command again with --verbose.\n gmake: *** [deps/eng/tools/mk/Makefile.targ:287: check-rust] Error 101"},{"timestamp":1560984146,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Uploaded patch set 3."},{"timestamp":1560984231,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing-1\n\n\"make check\" exited with status 2\n\n fatal: ref HEAD is not a symbolic ref\n json --validate -f package.json\n cargo check\n     Checking vminfod v0.1.0 (/tmp/repo/vminfod)\n error[E0658]: imports can only refer to extern crate names passed with `--extern` on stable channel (see issue #53130)\n   --\u003e vminfod/src/lib.rs:15:5\n    |\n 7  | pub mod client;\n    | --------------- not an extern crate passed with `--extern`\n ...\n 15 | use client::Client;\n    |     ^^^^^^\n    |\n note: this import refers to the module defined here\n   --\u003e vminfod/src/lib.rs:7:1\n    |\n 7  | pub mod client;\n    | ^^^^^^^^^^^^^^^\n \n error: aborting due to previous error\n \n For more information about this error, try `rustc --explain E0658`.\n error: Could not compile `vminfod`.\n \n To learn more, run the command again with --verbose.\n gmake: *** [deps/eng/tools/mk/Makefile.targ:287: check-rust] Error 101"},{"timestamp":1560984640,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Uploaded patch set 4."},{"timestamp":1560984724,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1561384113,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 4:\n\n(15 comments)\n\nI\u0027ve not done a proper review on *.rs - leaving that to those that are more qualified."},{"timestamp":1561466167,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 4:\n\n(1 comment)"},{"timestamp":1561500105,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Uploaded patch set 5."},{"timestamp":1561500187,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1561531484,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Uploaded patch set 6."},{"timestamp":1561531563,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 6: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1561569905,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 6:\n\n(9 comments)"},{"timestamp":1561579006,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Patch Set 6:\n\n(5 comments)\n\nTook a first pass.  Very nice.  All nits and questions."},{"timestamp":1561592510,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 6:\n\n(74 comments)\n\nI have a bunch of probably rather basic \"I don\u0027t understand Rust\" questions here, which you\u0027re free to ignore!"},{"timestamp":1561630801,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Patch Set 6:\n\n(17 comments)\n\nI\u0027m not sufficiently rust-savvy to be able to do a good review of the rust changes, but I had a look all the same. Thanks!"},{"timestamp":1561659596,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Patch Set 6:\n\n(4 comments)"},{"timestamp":1561709993,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 6:\n\n(10 comments)\n\nI\u0027ve already replied to some of Mike Gerdts questions. Let me know if you want me making the suggested changes or if it\u0027s fine to take those yourself as you go with the other stuff."},{"timestamp":1561741187,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Uploaded patch set 7."},{"timestamp":1561741268,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 7: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1561741395,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Patch Set 7:\n\n(92 comments)"},{"timestamp":1561745125,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Uploaded patch set 8."},{"timestamp":1561745128,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Patch Set 6:\n\n(7 comments)"},{"timestamp":1561745200,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 8: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1561752181,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Uploaded patch set 9."},{"timestamp":1561752187,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Patch Set 6:\n\n(13 comments)"},{"timestamp":1561752257,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 9: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1561753313,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Uploaded patch set 10."},{"timestamp":1561753388,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 10: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1561754067,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 4:\n\n(3 comments)"},{"timestamp":1561754780,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Uploaded patch set 11."},{"timestamp":1561754803,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Patch Set 10:\n\n(2 comments)"},{"timestamp":1561754854,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 11: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1561757386,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Uploaded patch set 12."},{"timestamp":1561757468,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 12: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1561758702,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 12: Code-Review+1"},{"timestamp":1561759859,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 12: Code-Review+1"},{"timestamp":1561759912,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 12:\n\nTo be clear, I have not reviewed *.rs, my +1 covers the other files."},{"timestamp":1561802546,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 12: Code-Review+1\n\n(5 comments)\n\nDon\u0027t expect any changes on my follow-ups here, looks good to me."},{"timestamp":1561953479,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Patch Set 12: Code-Review+1\n\n(2 comments)"},{"timestamp":1561996037,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Patch Set 6:\n\n(1 comment)"},{"timestamp":1561998777,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Uploaded patch set 13."},{"timestamp":1561998857,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 13: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1561999193,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 13: Code-Review+1\n\nrefreshing my +1 on non-rust files"},{"timestamp":1562002257,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 13: Code-Review+1"},{"timestamp":1562002591,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 13: Code-Review+1"},{"timestamp":1562076321,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Patch Set 13: Code-Review+1"},{"timestamp":1562076679,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 13: Code-Review+1"},{"timestamp":1562077337,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Patch Set 13: Integration-Approval+1"},{"timestamp":1562078457,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Uploaded patch set 14: Commit message was updated."},{"timestamp":1562078486,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Michael Zeller"}],"currentPatchSet":{"number":"14","revision":"13092413b2e92c1ae9d1b95cedec7f0ed729ab38","parents":["2917fa2b11591c184f34de9edd5efabe3a18cc7f"],"ref":"refs/changes/63/6463/14","uploader":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"createdOn":1562078457,"author":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1561998857,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1561999193,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1562002257,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1562002591,"by":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1562076321,"by":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1562076679,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1562077337,"by":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"}},{"type":"SUBM","value":"1","grantedOn":1562078486,"by":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":13,"deletions":0},{"file":".cargo/config","type":"ADDED","insertions":1,"deletions":0},{"file":".gitignore","type":"ADDED","insertions":27,"deletions":0},{"file":".gitmodules","type":"ADDED","insertions":3,"deletions":0},{"file":"Cargo.lock","type":"ADDED","insertions":1299,"deletions":0},{"file":"Cargo.toml","type":"ADDED","insertions":15,"deletions":0},{"file":"LICENSE","type":"ADDED","insertions":373,"deletions":0},{"file":"Makefile","type":"ADDED","insertions":102,"deletions":0},{"file":"README.md","type":"ADDED","insertions":81,"deletions":0},{"file":"cfwlogd/Cargo.toml","type":"ADDED","insertions":24,"deletions":0},{"file":"cfwlogd/src/events.rs","type":"ADDED","insertions":427,"deletions":0},{"file":"cfwlogd/src/fileutils.rs","type":"ADDED","insertions":155,"deletions":0},{"file":"cfwlogd/src/ipf.rs","type":"ADDED","insertions":68,"deletions":0},{"file":"cfwlogd/src/logger.rs","type":"ADDED","insertions":324,"deletions":0},{"file":"cfwlogd/src/main.rs","type":"ADDED","insertions":359,"deletions":0},{"file":"cfwlogd/src/parser.rs","type":"ADDED","insertions":328,"deletions":0},{"file":"cfwlogd/src/signal.rs","type":"ADDED","insertions":44,"deletions":0},{"file":"cfwlogd/src/zones.rs","type":"ADDED","insertions":90,"deletions":0},{"file":"deps/eng","type":"ADDED","insertions":1,"deletions":0},{"file":"manifest.tmpl","type":"ADDED","insertions":27,"deletions":0},{"file":"npm/lib/error_handler.sh","type":"ADDED","insertions":73,"deletions":0},{"file":"npm/lib/trace_logger.sh","type":"ADDED","insertions":36,"deletions":0},{"file":"npm/postinstall.sh","type":"ADDED","insertions":272,"deletions":0},{"file":"npm/postuninstall.sh","type":"ADDED","insertions":35,"deletions":0},{"file":"package.json","type":"ADDED","insertions":16,"deletions":0},{"file":"smf/manifests/firewall-logger-agent-setup.xml.in","type":"ADDED","insertions":55,"deletions":0},{"file":"smf/manifests/firewall-logger-agent.xml.in","type":"ADDED","insertions":74,"deletions":0},{"file":"smf/method/firewall-logger-agent-setup","type":"ADDED","insertions":56,"deletions":0},{"file":"testutils/Cargo.toml","type":"ADDED","insertions":11,"deletions":0},{"file":"testutils/src/lib.rs","type":"ADDED","insertions":123,"deletions":0},{"file":"vminfod-client/Cargo.toml","type":"ADDED","insertions":14,"deletions":0},{"file":"vminfod-client/examples/print-events.rs","type":"ADDED","insertions":16,"deletions":0},{"file":"vminfod-client/src/client.rs","type":"ADDED","insertions":82,"deletions":0},{"file":"vminfod-client/src/lib.rs","type":"ADDED","insertions":92,"deletions":0},{"file":"vminfod-client/src/linefeed.rs","type":"ADDED","insertions":131,"deletions":0}],"sizeInsertions":4834,"sizeDeletions":0},"patchSets":[{"number":"1","revision":"d5354a05bc1389312ecb430867a0b962b1cae840","parents":["2917fa2b11591c184f34de9edd5efabe3a18cc7f"],"ref":"refs/changes/63/6463/1","uploader":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"createdOn":1560892057,"author":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1560892061,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".cargo/config","type":"ADDED","insertions":1,"deletions":0},{"file":".gitignore","type":"ADDED","insertions":27,"deletions":0},{"file":".gitmodules","type":"ADDED","insertions":3,"deletions":0},{"file":"Cargo.lock","type":"ADDED","insertions":1383,"deletions":0},{"file":"Cargo.toml","type":"ADDED","insertions":19,"deletions":0},{"file":"LICENSE","type":"ADDED","insertions":373,"deletions":0},{"file":"Makefile","type":"ADDED","insertions":117,"deletions":0},{"file":"README.md","type":"ADDED","insertions":50,"deletions":0},{"file":"cfwlogd/Cargo.toml","type":"ADDED","insertions":23,"deletions":0},{"file":"cfwlogd/src/events.rs","type":"ADDED","insertions":380,"deletions":0},{"file":"cfwlogd/src/fileutils.rs","type":"ADDED","insertions":134,"deletions":0},{"file":"cfwlogd/src/ipf.rs","type":"ADDED","insertions":66,"deletions":0},{"file":"cfwlogd/src/logger.rs","type":"ADDED","insertions":300,"deletions":0},{"file":"cfwlogd/src/main.rs","type":"ADDED","insertions":246,"deletions":0},{"file":"cfwlogd/src/parser.rs","type":"ADDED","insertions":203,"deletions":0},{"file":"cfwlogd/src/signal.rs","type":"ADDED","insertions":34,"deletions":0},{"file":"cfwlogd/src/zones.rs","type":"ADDED","insertions":95,"deletions":0},{"file":"deps/eng","type":"ADDED","insertions":1,"deletions":0},{"file":"docs/index.md","type":"ADDED","insertions":1531,"deletions":0},{"file":"manifest.tmpl","type":"ADDED","insertions":27,"deletions":0},{"file":"npm/lib/error_handler.sh","type":"ADDED","insertions":73,"deletions":0},{"file":"npm/lib/trace_logger.sh","type":"ADDED","insertions":36,"deletions":0},{"file":"npm/postinstall.sh","type":"ADDED","insertions":273,"deletions":0},{"file":"npm/postuninstall.sh","type":"ADDED","insertions":33,"deletions":0},{"file":"package.json","type":"ADDED","insertions":16,"deletions":0},{"file":"smf/manifests/firewall-logger-agent-setup.xml.in","type":"ADDED","insertions":55,"deletions":0},{"file":"smf/manifests/firewall-logger-agent.xml.in","type":"ADDED","insertions":79,"deletions":0},{"file":"smf/method/firewall-logger-agent-setup","type":"ADDED","insertions":52,"deletions":0},{"file":"testutils/Cargo.toml","type":"ADDED","insertions":11,"deletions":0},{"file":"testutils/src/lib.rs","type":"ADDED","insertions":87,"deletions":0},{"file":"tools/agent-prebuilt.sh","type":"ADDED","insertions":460,"deletions":0},{"file":"tools/bashstyle","type":"ADDED","insertions":175,"deletions":0},{"file":"tools/bits-upload.sh","type":"ADDED","insertions":494,"deletions":0},{"file":"tools/buildimage-extract-pkg.sh","type":"ADDED","insertions":35,"deletions":0},{"file":"tools/download_ctftools","type":"ADDED","insertions":90,"deletions":0},{"file":"tools/download_go","type":"ADDED","insertions":126,"deletions":0},{"file":"tools/jsl.node.conf","type":"ADDED","insertions":139,"deletions":0},{"file":"tools/jsl.web.conf","type":"ADDED","insertions":137,"deletions":0},{"file":"tools/jsstyle.conf","type":"ADDED","insertions":14,"deletions":0},{"file":"tools/mkrepo","type":"ADDED","insertions":121,"deletions":0},{"file":"tools/runtests.in","type":"ADDED","insertions":136,"deletions":0},{"file":"tools/service_bundle.dtd.1","type":"ADDED","insertions":1091,"deletions":0},{"file":"tools/validate-buildenv.sh","type":"ADDED","insertions":727,"deletions":0},{"file":"vminfod/Cargo.toml","type":"ADDED","insertions":14,"deletions":0},{"file":"vminfod/examples/print-events.rs","type":"ADDED","insertions":9,"deletions":0},{"file":"vminfod/src/client.rs","type":"ADDED","insertions":77,"deletions":0},{"file":"vminfod/src/lib.rs","type":"ADDED","insertions":88,"deletions":0},{"file":"vminfod/src/linefeed.rs","type":"ADDED","insertions":131,"deletions":0}],"sizeInsertions":9792,"sizeDeletions":0},{"number":"2","revision":"c374a19215c339d1f847bc158efce780b734c116","parents":["2917fa2b11591c184f34de9edd5efabe3a18cc7f"],"ref":"refs/changes/63/6463/2","uploader":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"createdOn":1560982578,"author":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1560982662,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".cargo/config","type":"ADDED","insertions":1,"deletions":0},{"file":".gitignore","type":"ADDED","insertions":27,"deletions":0},{"file":".gitmodules","type":"ADDED","insertions":3,"deletions":0},{"file":"Cargo.lock","type":"ADDED","insertions":1299,"deletions":0},{"file":"Cargo.toml","type":"ADDED","insertions":19,"deletions":0},{"file":"LICENSE","type":"ADDED","insertions":373,"deletions":0},{"file":"Makefile","type":"ADDED","insertions":117,"deletions":0},{"file":"README.md","type":"ADDED","insertions":50,"deletions":0},{"file":"cfwlogd/Cargo.toml","type":"ADDED","insertions":23,"deletions":0},{"file":"cfwlogd/src/events.rs","type":"ADDED","insertions":380,"deletions":0},{"file":"cfwlogd/src/fileutils.rs","type":"ADDED","insertions":134,"deletions":0},{"file":"cfwlogd/src/ipf.rs","type":"ADDED","insertions":66,"deletions":0},{"file":"cfwlogd/src/logger.rs","type":"ADDED","insertions":300,"deletions":0},{"file":"cfwlogd/src/main.rs","type":"ADDED","insertions":246,"deletions":0},{"file":"cfwlogd/src/parser.rs","type":"ADDED","insertions":203,"deletions":0},{"file":"cfwlogd/src/signal.rs","type":"ADDED","insertions":34,"deletions":0},{"file":"cfwlogd/src/zones.rs","type":"ADDED","insertions":95,"deletions":0},{"file":"deps/eng","type":"ADDED","insertions":1,"deletions":0},{"file":"docs/index.md","type":"ADDED","insertions":1531,"deletions":0},{"file":"manifest.tmpl","type":"ADDED","insertions":27,"deletions":0},{"file":"npm/lib/error_handler.sh","type":"ADDED","insertions":73,"deletions":0},{"file":"npm/lib/trace_logger.sh","type":"ADDED","insertions":36,"deletions":0},{"file":"npm/postinstall.sh","type":"ADDED","insertions":273,"deletions":0},{"file":"npm/postuninstall.sh","type":"ADDED","insertions":33,"deletions":0},{"file":"package.json","type":"ADDED","insertions":16,"deletions":0},{"file":"smf/manifests/firewall-logger-agent-setup.xml.in","type":"ADDED","insertions":55,"deletions":0},{"file":"smf/manifests/firewall-logger-agent.xml","type":"ADDED","insertions":79,"deletions":0},{"file":"smf/manifests/firewall-logger-agent.xml.in","type":"ADDED","insertions":79,"deletions":0},{"file":"smf/method/firewall-logger-agent-setup","type":"ADDED","insertions":52,"deletions":0},{"file":"testutils/Cargo.toml","type":"ADDED","insertions":11,"deletions":0},{"file":"testutils/src/lib.rs","type":"ADDED","insertions":87,"deletions":0},{"file":"tools/agent-prebuilt.sh","type":"ADDED","insertions":460,"deletions":0},{"file":"tools/bashstyle","type":"ADDED","insertions":175,"deletions":0},{"file":"tools/bits-upload.sh","type":"ADDED","insertions":494,"deletions":0},{"file":"tools/buildimage-extract-pkg.sh","type":"ADDED","insertions":35,"deletions":0},{"file":"tools/download_ctftools","type":"ADDED","insertions":90,"deletions":0},{"file":"tools/download_go","type":"ADDED","insertions":126,"deletions":0},{"file":"tools/jsl.node.conf","type":"ADDED","insertions":139,"deletions":0},{"file":"tools/jsl.web.conf","type":"ADDED","insertions":137,"deletions":0},{"file":"tools/jsstyle.conf","type":"ADDED","insertions":14,"deletions":0},{"file":"tools/mkrepo","type":"ADDED","insertions":121,"deletions":0},{"file":"tools/runtests.in","type":"ADDED","insertions":136,"deletions":0},{"file":"tools/service_bundle.dtd.1","type":"ADDED","insertions":1091,"deletions":0},{"file":"tools/validate-buildenv.sh","type":"ADDED","insertions":727,"deletions":0},{"file":"vminfod/Cargo.toml","type":"ADDED","insertions":14,"deletions":0},{"file":"vminfod/examples/print-events.rs","type":"ADDED","insertions":9,"deletions":0},{"file":"vminfod/src/client.rs","type":"ADDED","insertions":77,"deletions":0},{"file":"vminfod/src/lib.rs","type":"ADDED","insertions":88,"deletions":0},{"file":"vminfod/src/linefeed.rs","type":"ADDED","insertions":131,"deletions":0}],"sizeInsertions":9787,"sizeDeletions":0},{"number":"3","revision":"fd17ee93f8a91b3904ceb5344352e45b688d2893","parents":["2917fa2b11591c184f34de9edd5efabe3a18cc7f"],"ref":"refs/changes/63/6463/3","uploader":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"createdOn":1560984146,"author":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1560984231,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".cargo/config","type":"ADDED","insertions":1,"deletions":0},{"file":".gitignore","type":"ADDED","insertions":27,"deletions":0},{"file":".gitmodules","type":"ADDED","insertions":3,"deletions":0},{"file":"Cargo.lock","type":"ADDED","insertions":1299,"deletions":0},{"file":"Cargo.toml","type":"ADDED","insertions":19,"deletions":0},{"file":"LICENSE","type":"ADDED","insertions":373,"deletions":0},{"file":"Makefile","type":"ADDED","insertions":117,"deletions":0},{"file":"README.md","type":"ADDED","insertions":50,"deletions":0},{"file":"cfwlogd/Cargo.toml","type":"ADDED","insertions":23,"deletions":0},{"file":"cfwlogd/src/events.rs","type":"ADDED","insertions":380,"deletions":0},{"file":"cfwlogd/src/fileutils.rs","type":"ADDED","insertions":134,"deletions":0},{"file":"cfwlogd/src/ipf.rs","type":"ADDED","insertions":66,"deletions":0},{"file":"cfwlogd/src/logger.rs","type":"ADDED","insertions":300,"deletions":0},{"file":"cfwlogd/src/main.rs","type":"ADDED","insertions":246,"deletions":0},{"file":"cfwlogd/src/parser.rs","type":"ADDED","insertions":203,"deletions":0},{"file":"cfwlogd/src/signal.rs","type":"ADDED","insertions":34,"deletions":0},{"file":"cfwlogd/src/zones.rs","type":"ADDED","insertions":95,"deletions":0},{"file":"deps/eng","type":"ADDED","insertions":1,"deletions":0},{"file":"manifest.tmpl","type":"ADDED","insertions":27,"deletions":0},{"file":"npm/lib/error_handler.sh","type":"ADDED","insertions":73,"deletions":0},{"file":"npm/lib/trace_logger.sh","type":"ADDED","insertions":36,"deletions":0},{"file":"npm/postinstall.sh","type":"ADDED","insertions":273,"deletions":0},{"file":"npm/postuninstall.sh","type":"ADDED","insertions":33,"deletions":0},{"file":"package.json","type":"ADDED","insertions":16,"deletions":0},{"file":"smf/manifests/firewall-logger-agent-setup.xml.in","type":"ADDED","insertions":55,"deletions":0},{"file":"smf/manifests/firewall-logger-agent.xml.in","type":"ADDED","insertions":79,"deletions":0},{"file":"smf/method/firewall-logger-agent-setup","type":"ADDED","insertions":52,"deletions":0},{"file":"testutils/Cargo.toml","type":"ADDED","insertions":11,"deletions":0},{"file":"testutils/src/lib.rs","type":"ADDED","insertions":87,"deletions":0},{"file":"vminfod/Cargo.toml","type":"ADDED","insertions":14,"deletions":0},{"file":"vminfod/examples/print-events.rs","type":"ADDED","insertions":9,"deletions":0},{"file":"vminfod/src/client.rs","type":"ADDED","insertions":77,"deletions":0},{"file":"vminfod/src/lib.rs","type":"ADDED","insertions":88,"deletions":0},{"file":"vminfod/src/linefeed.rs","type":"ADDED","insertions":131,"deletions":0}],"sizeInsertions":4432,"sizeDeletions":0},{"number":"4","revision":"1da183a8b8f193368d95d95a75f2ac2154dfaf0f","parents":["2917fa2b11591c184f34de9edd5efabe3a18cc7f"],"ref":"refs/changes/63/6463/4","uploader":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"createdOn":1560984640,"author":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1560984724,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"/COMMIT_MSG","line":7,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"TRITON-1318 new cfwlogd"},{"file":"Cargo.toml","line":11,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"is this obsolete now?"},{"file":"README.md","line":43,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"delete?"},{"file":"README.md","line":43,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Definitely, this is mostly a placeholder file."},{"file":"npm/postinstall.sh","line":40,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Why define these rather than just using the commands directly?  Why are these not consistent with how sed, curl, svccfg, and perhaps others  are used?\n\nFWIW, I\u0027m a big fan if setting PATH and then just using the commands without providing the absolute path to every command."},{"file":"npm/postinstall.sh","line":40,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"As I\u0027ve previously commented, we could - should definitely apply the changes you suggest here, but not only to firewall-logger-agent, but to every one of our agents, since this code is pretty much shared across all of them.\n\nMy take here would be to left the code unchanged for this commit and modify all the agents using a different issue since, IMO, we should also move some of this code to another shared library file, since there\u0027s a lot of duplication across all our repos."},{"file":"npm/postinstall.sh","line":54,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Curly brackets serve no purpose here and are inconsistently used throughout the file.  Rather than noting all of the curlies are are not needed, I\u0027ll note the ones that should stay."},{"file":"npm/postinstall.sh","line":120,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Above \u0027sed\u0027 (not \u0027/usr/bin/sed\u0027) is used.  What\u0027s special here?"},{"file":"npm/postinstall.sh","line":202,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"this a rare case in this script where curlies serve a purpose."},{"file":"npm/postuninstall.sh","line":17,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"The nice thing about $( ) compared to ` ` is that it nests.  This would be better as:\n\nROOT\u003d\"$(cd \"$(dirname \"$0\")/.. \u0026\u0026 pwd)\""},{"file":"npm/postuninstall.sh","line":17,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"What error could be printed that we would want to ignore?"},{"file":"npm/postuninstall.sh","line":17,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Who knows!? This code is older than I\u0027m able to remember!"},{"file":"npm/postuninstall.sh","line":17,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Same reasoning than for post-install.sh Let\u0027s make a global agents issue and modify all of them, not only this one."},{"file":"package.json","line":4,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Should we keep this and the version in cargo.toml in sync?"},{"file":"package.json","line":4,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"I don\u0027t think the other stuff here provides any functionality at all so, I\u0027d vote yes."},{"file":"smf/manifests/firewall-logger-agent.xml.in","line":19,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Shouldn\u0027t this also depend on firewall-logger-setup?"},{"file":"smf/manifests/firewall-logger-agent.xml.in","line":19,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"I think so, yes."},{"file":"smf/manifests/firewall-logger-agent.xml.in","line":19,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Done"},{"file":"smf/manifests/firewall-logger-agent.xml.in","line":19,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Done"},{"file":"smf/manifests/firewall-logger-agent.xml.in","line":31,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"If vminfod got into a bad state and cfwlogd was unable to get information it needed from it, wouldn\u0027t cfwlogd want to know when vminfod was restarted?  Maybe `restart_on\u003d\"error\"`?"},{"file":"smf/manifests/firewall-logger-agent.xml.in","line":31,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"+1"},{"file":"smf/manifests/firewall-logger-agent.xml.in","line":31,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"TRITON-1754 is a follow up ticket for cfwlogd to survive vminfod going away.  It eventually wants to keep retrying its connection to vminfod so that zones are able to continue logging even if vminfod is down for an extended period of time."},{"file":"smf/manifests/firewall-logger-agent.xml.in","line":31,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"See above comment."},{"file":"smf/manifests/firewall-logger-agent.xml.in","line":38,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"I\u0027ve never seen a need for that in a start method before.   Maybe it\u0027s changing with the upcoming daemonization code."},{"file":"smf/manifests/firewall-logger-agent.xml.in","line":38,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Pretty much every Agent and anything using node is taking that approach for SMF manifests. Like https://github.com/joyent/sdc-hermes/blob/master/smf/manifests/hermes.xml.in#L40. I would be happy of removing all those extra ampersands if they\u0027re not needed, though."},{"file":"smf/manifests/firewall-logger-agent.xml.in","line":38,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Removed from cfwlogd because the daemon is now able to daemonize itself which is something smf is expecting."},{"file":"smf/manifests/firewall-logger-agent.xml.in","line":55,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"svc.startd(1M) does not have a \"restart\" method.  `svcadm restart` triggers the stop method followed by the start method."},{"file":"smf/manifests/firewall-logger-agent.xml.in","line":55,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Drop then, please"},{"file":"smf/manifests/firewall-logger-agent.xml.in","line":55,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Done"},{"file":"smf/manifests/firewall-logger-agent.xml.in","line":55,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Done"},{"file":"smf/manifests/firewall-logger-agent.xml.in","line":68,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"does this serve a purpose?"},{"file":"smf/manifests/firewall-logger-agent.xml.in","line":68,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"That\u0027s a good question which would also deserve a global purpose issue:\n- https://github.com/joyent/sdc-cn-agent/blob/master/smf/manifests/cn-agent.xml.in#L57-L58\n- https://github.com/joyent/sdc-vmapi/blob/master/smf/manifests/vmapi.xml#L53-L55\n- ..."},{"file":"smf/manifests/firewall-logger-agent.xml.in","line":68,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Done"},{"file":"smf/manifests/firewall-logger-agent.xml.in","line":68,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Done"},{"file":"vminfod/Cargo.toml","line":5,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Maybe split vminfod support off into its own repo.  Since this is implementing the client side, it should probably be vminfo rather than vminfod.  We should register \"vminfo\" (or \"triton-vminfo\") in crates.io."},{"file":"vminfod/Cargo.toml","line":5,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Per discussion in project meeting on Monday, this will not happen now.  We\u0027ll wait until it matures here a little bit then likely spin it off later."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".cargo/config","type":"ADDED","insertions":1,"deletions":0},{"file":".gitignore","type":"ADDED","insertions":27,"deletions":0},{"file":".gitmodules","type":"ADDED","insertions":3,"deletions":0},{"file":"Cargo.lock","type":"ADDED","insertions":1299,"deletions":0},{"file":"Cargo.toml","type":"ADDED","insertions":19,"deletions":0},{"file":"LICENSE","type":"ADDED","insertions":373,"deletions":0},{"file":"Makefile","type":"ADDED","insertions":117,"deletions":0},{"file":"README.md","type":"ADDED","insertions":50,"deletions":0},{"file":"cfwlogd/Cargo.toml","type":"ADDED","insertions":23,"deletions":0},{"file":"cfwlogd/src/events.rs","type":"ADDED","insertions":380,"deletions":0},{"file":"cfwlogd/src/fileutils.rs","type":"ADDED","insertions":134,"deletions":0},{"file":"cfwlogd/src/ipf.rs","type":"ADDED","insertions":66,"deletions":0},{"file":"cfwlogd/src/logger.rs","type":"ADDED","insertions":300,"deletions":0},{"file":"cfwlogd/src/main.rs","type":"ADDED","insertions":247,"deletions":0},{"file":"cfwlogd/src/parser.rs","type":"ADDED","insertions":203,"deletions":0},{"file":"cfwlogd/src/signal.rs","type":"ADDED","insertions":34,"deletions":0},{"file":"cfwlogd/src/zones.rs","type":"ADDED","insertions":95,"deletions":0},{"file":"deps/eng","type":"ADDED","insertions":1,"deletions":0},{"file":"manifest.tmpl","type":"ADDED","insertions":27,"deletions":0},{"file":"npm/lib/error_handler.sh","type":"ADDED","insertions":73,"deletions":0},{"file":"npm/lib/trace_logger.sh","type":"ADDED","insertions":36,"deletions":0},{"file":"npm/postinstall.sh","type":"ADDED","insertions":273,"deletions":0},{"file":"npm/postuninstall.sh","type":"ADDED","insertions":33,"deletions":0},{"file":"package.json","type":"ADDED","insertions":16,"deletions":0},{"file":"smf/manifests/firewall-logger-agent-setup.xml.in","type":"ADDED","insertions":55,"deletions":0},{"file":"smf/manifests/firewall-logger-agent.xml.in","type":"ADDED","insertions":79,"deletions":0},{"file":"smf/method/firewall-logger-agent-setup","type":"ADDED","insertions":52,"deletions":0},{"file":"testutils/Cargo.toml","type":"ADDED","insertions":11,"deletions":0},{"file":"testutils/src/lib.rs","type":"ADDED","insertions":87,"deletions":0},{"file":"vminfod/Cargo.toml","type":"ADDED","insertions":14,"deletions":0},{"file":"vminfod/examples/print-events.rs","type":"ADDED","insertions":9,"deletions":0},{"file":"vminfod/src/client.rs","type":"ADDED","insertions":77,"deletions":0},{"file":"vminfod/src/lib.rs","type":"ADDED","insertions":89,"deletions":0},{"file":"vminfod/src/linefeed.rs","type":"ADDED","insertions":131,"deletions":0}],"sizeInsertions":4434,"sizeDeletions":0},{"number":"5","revision":"97631ea4d3707697e04f4c9720c7b05451bacb82","parents":["2917fa2b11591c184f34de9edd5efabe3a18cc7f"],"ref":"refs/changes/63/6463/5","uploader":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"createdOn":1561500105,"author":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1561500187,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".cargo/config","type":"ADDED","insertions":1,"deletions":0},{"file":".gitignore","type":"ADDED","insertions":27,"deletions":0},{"file":".gitmodules","type":"ADDED","insertions":3,"deletions":0},{"file":"Cargo.lock","type":"ADDED","insertions":1369,"deletions":0},{"file":"Cargo.toml","type":"ADDED","insertions":19,"deletions":0},{"file":"LICENSE","type":"ADDED","insertions":373,"deletions":0},{"file":"Makefile","type":"ADDED","insertions":117,"deletions":0},{"file":"README.md","type":"ADDED","insertions":50,"deletions":0},{"file":"cfwlogd/Cargo.toml","type":"ADDED","insertions":25,"deletions":0},{"file":"cfwlogd/src/events.rs","type":"ADDED","insertions":408,"deletions":0},{"file":"cfwlogd/src/fileutils.rs","type":"ADDED","insertions":134,"deletions":0},{"file":"cfwlogd/src/ipf.rs","type":"ADDED","insertions":66,"deletions":0},{"file":"cfwlogd/src/logger.rs","type":"ADDED","insertions":309,"deletions":0},{"file":"cfwlogd/src/main.rs","type":"ADDED","insertions":370,"deletions":0},{"file":"cfwlogd/src/parser.rs","type":"ADDED","insertions":313,"deletions":0},{"file":"cfwlogd/src/signal.rs","type":"ADDED","insertions":44,"deletions":0},{"file":"cfwlogd/src/zones.rs","type":"ADDED","insertions":93,"deletions":0},{"file":"deps/eng","type":"ADDED","insertions":1,"deletions":0},{"file":"manifest.tmpl","type":"ADDED","insertions":27,"deletions":0},{"file":"npm/lib/error_handler.sh","type":"ADDED","insertions":73,"deletions":0},{"file":"npm/lib/trace_logger.sh","type":"ADDED","insertions":36,"deletions":0},{"file":"npm/postinstall.sh","type":"ADDED","insertions":273,"deletions":0},{"file":"npm/postuninstall.sh","type":"ADDED","insertions":33,"deletions":0},{"file":"package.json","type":"ADDED","insertions":16,"deletions":0},{"file":"smf/manifests/firewall-logger-agent-setup.xml.in","type":"ADDED","insertions":55,"deletions":0},{"file":"smf/manifests/firewall-logger-agent.xml.in","type":"ADDED","insertions":79,"deletions":0},{"file":"smf/method/firewall-logger-agent-setup","type":"ADDED","insertions":52,"deletions":0},{"file":"testutils/Cargo.toml","type":"ADDED","insertions":11,"deletions":0},{"file":"testutils/src/lib.rs","type":"ADDED","insertions":117,"deletions":0},{"file":"vminfod/Cargo.toml","type":"ADDED","insertions":14,"deletions":0},{"file":"vminfod/examples/print-events.rs","type":"ADDED","insertions":9,"deletions":0},{"file":"vminfod/src/client.rs","type":"ADDED","insertions":77,"deletions":0},{"file":"vminfod/src/lib.rs","type":"ADDED","insertions":89,"deletions":0},{"file":"vminfod/src/linefeed.rs","type":"ADDED","insertions":131,"deletions":0}],"sizeInsertions":4814,"sizeDeletions":0},{"number":"6","revision":"a4dbdddb0307acf67c7afd0804340970503f60ab","parents":["2917fa2b11591c184f34de9edd5efabe3a18cc7f"],"ref":"refs/changes/63/6463/6","uploader":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"createdOn":1561531484,"author":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1561531563,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"Cargo.toml","line":9,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"\"updated\"?"},{"file":"Cargo.toml","line":9,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Done"},{"file":"Cargo.toml","line":11,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"AFAICT this is commented out... should this still be here?"},{"file":"Cargo.toml","line":11,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Removed"},{"file":"Makefile","line":47,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"we should set SMF_MANIFESTS to point to our manifests so that the check:: target will validate them."},{"file":"Makefile","line":47,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Looks like it doesn\u0027t like checking these files because they use @@VALUE@@ which get replaced at build time."},{"file":"Makefile","line":49,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Can we remove this now that we\u0027re out of initial development mode and that we\u0027ve got proper jenkins agent images that deliver a compatible rust version.\n\nGenerally, it\u0027s bad form for a build to modify the build machine directly (and indeed here, this command would fail when run as non-root)"},{"file":"Makefile","line":49,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Done"},{"file":"Makefile","line":55,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"(here and elsewhere) Can we avoid prefixing recipes with \u0027@\u0027 - that ends up hiding the command we\u0027re running, and makes debugging build failures a little harder because it\u0027s not always obvious what command was running when we blew up."},{"file":"Makefile","line":55,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Done"},{"file":"Makefile","line":58,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Just a nit really, but should we call this \u0027build\u0027 rather than \u0027target\u0027, or is that a \"rustism\"?"},{"file":"Makefile","line":58,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"yeah rust sticks things in target/debug and target/release"},{"file":"Makefile","line":95,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Don\u0027t we get print-FOO from eng.git\u0027s Makefile.targ now?"},{"file":"Makefile","line":95,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"yep :-) No need for this target."},{"file":"Makefile","line":95,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Done"},{"file":"README.md","line":22,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Is this placeholder text that should be removed?"},{"file":"README.md","line":22,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Done"},{"file":"README.md","line":29,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Same question as above"},{"file":"README.md","line":29,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Done"},{"file":"README.md","line":31,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Perhaps echoing Dave\u0027s question, but I\u0027d note we don\u0027t have a \u0027test\u0027 target in the Makefile though we are delivering what appears to be test code, so it\u0027d be nice to document how to run that.\n\nI\u0027ve love it if we could add more to README, or even just point to RFD 163 if that\u0027s still current?"},{"file":"README.md","line":31,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Done"},{"file":"README.md","line":40,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"remove or update?"},{"file":"README.md","line":40,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Done"},{"file":"cfwlogd/src/events.rs","line":20,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"EventSource*"},{"file":"cfwlogd/src/events.rs","line":20,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"\"EventSource\""},{"file":"cfwlogd/src/events.rs","line":20,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Done"},{"file":"cfwlogd/src/events.rs","line":20,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Done"},{"file":"cfwlogd/src/events.rs","line":23,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"minor style/grammar nit - \"in hopes of coalescing\" or \".. wait a small amount of time, hoping to coalesce multiple events..\""},{"file":"cfwlogd/src/events.rs","line":23,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Done"},{"file":"cfwlogd/src/events.rs","line":68,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"initial"},{"file":"cfwlogd/src/events.rs","line":68,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Done"},{"file":"cfwlogd/src/events.rs","line":70,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"it\u0027s"},{"file":"cfwlogd/src/events.rs","line":70,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Done"},{"file":"cfwlogd/src/events.rs","line":71,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"endlessly"},{"file":"cfwlogd/src/events.rs","line":71,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Done"},{"file":"cfwlogd/src/events.rs","line":74,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"guess you didn\u0027t want to pull in num::clamp() ?"},{"file":"cfwlogd/src/events.rs","line":74,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Didn\u0027t know about that, but I will gladly pull this out into a similar function."},{"file":"cfwlogd/src/events.rs","line":75,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"needlessly"},{"file":"cfwlogd/src/events.rs","line":75,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Done"},{"file":"cfwlogd/src/events.rs","line":83,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Basic rust question, will this actually allocate sizeof (CfwEvent) * 512 * 2048 at max?"},{"file":"cfwlogd/src/events.rs","line":83,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Yep.  The advantage of doing a bounded crossbeam channel is that you pick up some amount speed boost because you are not dynamically allocating more memory behind the scenes.\n\nhttps://github.com/crossbeam-rs/crossbeam/blob/master/crossbeam-channel/src/flavors/array.rs#L116-L121"},{"file":"cfwlogd/src/events.rs","line":96,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"\"let\u0027s\""},{"file":"cfwlogd/src/events.rs","line":96,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Done"},{"file":"cfwlogd/src/events.rs","line":109,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"this is more generic than just ipf right?"},{"file":"cfwlogd/src/events.rs","line":109,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Done"},{"file":"cfwlogd/src/events.rs","line":125,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"is this a TODO comment to add cmon here?"},{"file":"cfwlogd/src/events.rs","line":125,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Yep, added the ticket to these lines as well"},{"file":"cfwlogd/src/events.rs","line":127,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"we don\u0027t want to log anything about the event, not even zonedid?"},{"file":"cfwlogd/src/events.rs","line":127,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"I added the zonedid.  The downside is that at this point we don\u0027t have access to vminfod data and the zonedid is only unique until the compute node reboots, but it\u0027s better than nothing. This is also marked for CMON support so we will be able to see which zones are losing events."},{"file":"cfwlogd/src/events.rs","line":201,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"\"manner\""},{"file":"cfwlogd/src/events.rs","line":201,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Done"},{"file":"cfwlogd/src/events.rs","line":203,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"I don\u0027t understand what \"take(lengthofiterable)\" means."},{"file":"cfwlogd/src/events.rs","line":203,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"I explain it in the comment above, but maybe I can do something to make it more clear? Since crossbeam_channel currently lack an api function such as \"close_and_consume()\", we can be in a situation where the event reading thread is trying to fill this channel up as quickly as possible and we are attempting to shutdown so I wanted to at least take what\u0027s currently queued up before we drop.  Hopefully that window is small enough that we don\u0027t really drop too much on the floor."},{"file":"cfwlogd/src/events.rs","line":203,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Oh, you\u0027re using events.len() so that we don\u0027t take *more* than the current length of the iterator if more are being added? That makes sense I think!"},{"file":"cfwlogd/src/events.rs","line":236,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Shouldn\u0027t this be a \"continue\" ?"},{"file":"cfwlogd/src/events.rs","line":236,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Good catch! (This used to process a single event and I swapped it to handle batches of events)"},{"file":"cfwlogd/src/events.rs","line":398,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"\"it\u0027s\""},{"file":"cfwlogd/src/events.rs","line":398,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Done"},{"file":"cfwlogd/src/fileutils.rs","line":1,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Copyright at top of file"},{"file":"cfwlogd/src/fileutils.rs","line":1,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Done"},{"file":"cfwlogd/src/fileutils.rs","line":11,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"\"process\"\n\"if it\u0027s\""},{"file":"cfwlogd/src/fileutils.rs","line":11,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Done"},{"file":"cfwlogd/src/fileutils.rs","line":13,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Why are we exposing \u0027chunk\u0027 at all as part of this interface?"},{"file":"cfwlogd/src/fileutils.rs","line":13,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Originally was writing this with it being a library in mind. Would you rather I hard code it to the value cfwlogd intends on using since it\u0027s the only consumer?"},{"file":"cfwlogd/src/fileutils.rs","line":13,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Don\u0027t care much, just wondering."},{"file":"cfwlogd/src/fileutils.rs","line":27,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"\"chunk\u0027s\""},{"file":"cfwlogd/src/fileutils.rs","line":27,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Done"},{"file":"cfwlogd/src/ipf.rs","line":18,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Just checking - do we have similar comments or build-time messaging that warns developers of Ipfcwfcfg to update this file if they make changes there?"},{"file":"cfwlogd/src/ipf.rs","line":18,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"We don\u0027t.  We might be able to use a build.rs file to populate this field, however it would still be tied to whatever is present on the build machine.  Which also assumes the platform is new enough to have the cfw bits."},{"file":"cfwlogd/src/ipf.rs","line":33,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Why is this called \u0027fd\u0027 when it\u0027s a File?"},{"file":"cfwlogd/src/ipf.rs","line":33,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Done"},{"file":"cfwlogd/src/ipf.rs","line":49,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"I guess the driver ensures we\u0027ll always get reads on record (event) boundaries?"},{"file":"cfwlogd/src/ipf.rs","line":49,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Yep, the driver is a ring buffer made up of cfwev_t slots.  The kernel code as it is today will always return full events."},{"file":"cfwlogd/src/ipf.rs","line":58,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Maybe it\u0027s worth a comment here about the reasoning for using `unsafe`  to make it readily apparent to anyone reading through the code."},{"file":"cfwlogd/src/ipf.rs","line":58,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Done"},{"file":"cfwlogd/src/ipf.rs","line":59,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Why this form instead of:\n\nlet cfg_ptr: *mut Ipfcfwcfg \u003d \u0026mut cfg;"},{"file":"cfwlogd/src/ipf.rs","line":59,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"That would also be valid.  However all of the examples in the rust book seem to prefer this syntax.  Probably because its clear that you are taking a mutable reference and casting it as a raw mutable pointer."},{"file":"cfwlogd/src/logger.rs","line":8,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"\"perform\""},{"file":"cfwlogd/src/logger.rs","line":8,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Done"},{"file":"cfwlogd/src/logger.rs","line":26,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"\"/var/log/firewall\" ?"},{"file":"cfwlogd/src/logger.rs","line":26,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Done"},{"file":"cfwlogd/src/logger.rs","line":30,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"This constant gets hardcoded in src/events.rs too. Can we share the constant across these files somehow?"},{"file":"cfwlogd/src/logger.rs","line":30,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Done"},{"file":"cfwlogd/src/logger.rs","line":45,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"why pub?"},{"file":"cfwlogd/src/logger.rs","line":45,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"This is because the SendError messages return the value back in the error.  I could map them to () or something if we think its not worth sending them back in an error."},{"file":"cfwlogd/src/logger.rs","line":54,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"\"our\" maybe? Or perhaps \"persisting logs of CfwEvents to disk.\""},{"file":"cfwlogd/src/logger.rs","line":54,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Done"},{"file":"cfwlogd/src/logger.rs","line":63,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"\"perform\""},{"file":"cfwlogd/src/logger.rs","line":63,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Done"},{"file":"cfwlogd/src/logger.rs","line":68,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"oh right :-)"},{"file":"cfwlogd/src/logger.rs","line":73,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"logger\u0027s\n\n(And below)"},{"file":"cfwlogd/src/logger.rs","line":73,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"I guess the loggers do own their buffers :)"},{"file":"cfwlogd/src/logger.rs","line":121,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"remaining TODO?"},{"file":"cfwlogd/src/logger.rs","line":121,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Had a short call with Mike, Dan, and Pedro.  We decided to force unwrap this and abort on error. Since no loggers will probably be making any forward progress due to something like ENOSPC."},{"file":"cfwlogd/src/logger.rs","line":138,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"would it be valuable to add the first 8chars of the VM UUID to the thread name?"},{"file":"cfwlogd/src/logger.rs","line":138,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Great idea.  Just going to set it to the full vm name, even though I think only the first 16 characters will be used. Note that on solaris/illumos rust setting this is a noop. Linux looks to truncate to the first 16 characters, so hopefully we can do the same."},{"file":"cfwlogd/src/logger.rs","line":145,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"log which log file?"},{"file":"cfwlogd/src/logger.rs","line":145,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Done"},{"file":"cfwlogd/src/logger.rs","line":154,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"curious why not select! macro?"},{"file":"cfwlogd/src/logger.rs","line":154,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"No real reason that I can remember."},{"file":"cfwlogd/src/logger.rs","line":156,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Why sleep here?"},{"file":"cfwlogd/src/logger.rs","line":156,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Comment added:\n\n// Wait a small amount of time in hopes of coalescing events coming down\n// the channel, which helps reduce the number of calls to yield(2) and\n// reduces lock contention on the vmobjs rw lock."},{"file":"cfwlogd/src/logger.rs","line":163,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"There\u0027s a good bit of nesting here that makes it a bit hard to follow. It certainly doesn\u0027t affect the functionality, but it might make the logic a bit easier to follow if you broke the signal handling out into a separate function."},{"file":"cfwlogd/src/logger.rs","line":163,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Done"},{"file":"cfwlogd/src/logger.rs","line":164,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"remaining TODO?"},{"file":"cfwlogd/src/logger.rs","line":164,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Done"},{"file":"cfwlogd/src/logger.rs","line":182,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"and above? But what would you do if flush failed?"},{"file":"cfwlogd/src/logger.rs","line":182,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Abort like above."},{"file":"cfwlogd/src/logger.rs","line":201,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"\"Logger thread\" ?"},{"file":"cfwlogd/src/logger.rs","line":201,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Done"},{"file":"cfwlogd/src/logger.rs","line":206,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Does using the unbounded channel here open up the risk of noisy producers generating events faster than they can be processed potentially consuming all memory and crashing the program? Would it be better to limit the maximum and throttle the noisy producers instead?"},{"file":"cfwlogd/src/logger.rs","line":206,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Bounded channels are faster, but we have to pay for the cost of memory up front.  I expect the loggers to be slower than the producing thread simply because they are serializing json data and writing to disk.\n\nTesting showed that we are able to do 4.5M events and we see a small percentage of drops on the kernel side because we simply can\u0027t call read(2) fast enough.  Memory usage usually stays under 150M during these tests and usually sits closer to 70MB. I am inclined to leave this unbounded until we have some more real world data.  Does that sound reasonable?"},{"file":"cfwlogd/src/logger.rs","line":206,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Yeah, this seems reasonable to me. Thanks for the extra info!"},{"file":"cfwlogd/src/logger.rs","line":206,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"I did further testing on Friday with Mike Gerdts and it will be an issue for sure if the throughput is high enough.  So I have filed TRITON-1787 as a follow up."},{"file":"cfwlogd/src/logger.rs","line":244,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"nit, space before \u0027current.log\u0027 ?"},{"file":"cfwlogd/src/logger.rs","line":244,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Done"},{"file":"cfwlogd/src/logger.rs","line":260,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"is this how rustfmt wants it??"},{"file":"cfwlogd/src/logger.rs","line":260,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"yeah, I run rustfmt on save in vim."},{"file":"cfwlogd/src/main.rs","line":8,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Since this comment is about this *specific* daemon I think it makes sense to state this as fact:\n\n\u003e It does so by attaching to the kernel device `/dev/ipfev` ..."},{"file":"cfwlogd/src/main.rs","line":8,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Done"},{"file":"cfwlogd/src/main.rs","line":49,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"extra space \"vm  alias\""},{"file":"cfwlogd/src/main.rs","line":49,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"appropriate"},{"file":"cfwlogd/src/main.rs","line":49,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Done"},{"file":"cfwlogd/src/main.rs","line":49,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Done"},{"file":"cfwlogd/src/main.rs","line":53,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"\"because\""},{"file":"cfwlogd/src/main.rs","line":53,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Done"},{"file":"cfwlogd/src/main.rs","line":55,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"\"if it\u0027s\""},{"file":"cfwlogd/src/main.rs","line":55,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Done"},{"file":"cfwlogd/src/main.rs","line":56,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"serializes"},{"file":"cfwlogd/src/main.rs","line":56,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"\"serializes\""},{"file":"cfwlogd/src/main.rs","line":56,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Done"},{"file":"cfwlogd/src/main.rs","line":56,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Done"},{"file":"cfwlogd/src/main.rs","line":94,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Should we explain that 94 is the magic exit code SMF uses? Perhaps something like \"..as if it had a transient service model, which libscf.h and smf_include.sh define as \u002794\u0027.\""},{"file":"cfwlogd/src/main.rs","line":94,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Made a note that it comes from smf_method(5)"},{"file":"cfwlogd/src/main.rs","line":97,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"rust question: why does this have to be another macro instead of inside dup_file, and why a macro at all instead of something generic on AsRawFd traits?"},{"file":"cfwlogd/src/main.rs","line":97,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"I pulled them out into separate macros just so it was easier to look at.\n\nShould I make it a function that returns a Result\u003cFile, Error\u003e?"},{"file":"cfwlogd/src/main.rs","line":97,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"It seems to me like when possible it makes sense to avoid macros, just because non-macro code is simpler to understand, but then I\u0027m a Rust neophyte."},{"file":"cfwlogd/src/main.rs","line":101,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Should we log errno?"},{"file":"cfwlogd/src/main.rs","line":101,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Done"},{"file":"cfwlogd/src/main.rs","line":102,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"-1 is an unusual exit code?"},{"file":"cfwlogd/src/main.rs","line":102,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Should we define a const for this? For now I will swap them to \"1\".  Tempted to use SMF_EXIT_ERR_FATAL, but the man page description makes it sound like it will be put into maintenance mode immediately."},{"file":"cfwlogd/src/main.rs","line":132,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"You don\u0027t need to set Effective once you\u0027ve set Permitted."},{"file":"cfwlogd/src/main.rs","line":132,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Done"},{"file":"cfwlogd/src/main.rs","line":145,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"ditto"},{"file":"cfwlogd/src/main.rs","line":145,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Done"},{"file":"cfwlogd/src/main.rs","line":151,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Did you check if \"/dev/stdout\" does the right thing as an alternative?"},{"file":"cfwlogd/src/main.rs","line":151,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"I didn\u0027t check yet."},{"file":"cfwlogd/src/main.rs","line":151,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Maybe worth a follow-up if you\u0027re in this code again."},{"file":"cfwlogd/src/main.rs","line":158,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"drop all groups"},{"file":"cfwlogd/src/main.rs","line":158,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"log errno?"},{"file":"cfwlogd/src/main.rs","line":158,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Done"},{"file":"cfwlogd/src/main.rs","line":158,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Done"},{"file":"cfwlogd/src/main.rs","line":159,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"ditto (and elsewhere)"},{"file":"cfwlogd/src/main.rs","line":159,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Done"},{"file":"cfwlogd/src/main.rs","line":186,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"I\u0027m curious why not .for_each() ?"},{"file":"cfwlogd/src/main.rs","line":186,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"No real reason, I think its more common to see \"for _ in _\".  Although since we are not using break or continue here I will swap them out."},{"file":"cfwlogd/src/main.rs","line":223,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"signals"},{"file":"cfwlogd/src/main.rs","line":223,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Done"},{"file":"cfwlogd/src/main.rs","line":243,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Doesn\u0027t this risk losing information? Do we maybe want to log what we cut off in the main cfwlogd log?"},{"file":"cfwlogd/src/main.rs","line":243,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"I don\u0027t think the info would really be useful because we have no way to act upon it. This likely results from a partial write of a json log due to something like a crash."},{"file":"cfwlogd/src/main.rs","line":261,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Seems like this bit could also be part of fileutils as it\u0027s doing something fairly generic?"},{"file":"cfwlogd/src/main.rs","line":261,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"I think it makes the most sense if rseek_and_scan returns you the index of the character you are searching for."},{"file":"cfwlogd/src/main.rs","line":267,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"\"truncated\", but as mentioned I\u0027m not sure the index value is that useful?"},{"file":"cfwlogd/src/main.rs","line":267,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"I modified this so that we only log when a file has been truncated, and by how much."},{"file":"cfwlogd/src/main.rs","line":292,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"\"privileges\""},{"file":"cfwlogd/src/main.rs","line":292,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Done"},{"file":"cfwlogd/src/main.rs","line":297,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Curious, why unwrap first instead of matching directly\nOk, Err(io::ErrorKind::NotFound), Err(_) ?"},{"file":"cfwlogd/src/main.rs","line":297,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"I did this because I knew the if we had an error we would exit with some value instead of continuing.  Swift has this as \"guard let\" which is something I hope rust gets eventually."},{"file":"cfwlogd/src/main.rs","line":305,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"trailing space?"},{"file":"cfwlogd/src/main.rs","line":305,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Done"},{"file":"cfwlogd/src/main.rs","line":335,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"\"privileges\""},{"file":"cfwlogd/src/main.rs","line":335,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Done"},{"file":"cfwlogd/src/parser.rs","line":140,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Does this imply that we\u0027re potentially dropping data?\n\nIs there anywhere else in the agent that logs the fact that we may have a misconfigured VM, in that the kernel/userland implementations don\u0027t match? (as per the catch-all comment on line 22?)"},{"file":"cfwlogd/src/parser.rs","line":140,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"This is us being mostly defensive the best we can.  Originally we were going to keep the userland and kernel pieces in sync by shipping the daemon as a part of the platform.  We ended up deciding during various meetings that it would be best to uncouple the two which would allow us to update the agent for bugs/perf reasons without needing to force a reboot of an entire CN.  So today the protocol mapping matches only the things fwapi supports in its current state, and we map all of the known types defined in the kernel today.  We discussed possibly adding something like a \"firewall rules updated\" type.  So in the event a new platform is rolled out before a new version of the agent we wont crash but instead just drop unknown event types.  The decision was made that the \"header\" aka the type field, length, and zonedid would be flexible enough to allow us to expand to future needs."},{"file":"cfwlogd/src/parser.rs","line":231,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"is this really the only way to get the length of the byte slice?"},{"file":"cfwlogd/src/parser.rs","line":231,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"It seems like you could just use `assert!` and call `cfw_event.0.is_empty()` rather than needing to use the vector for comparison."},{"file":"cfwlogd/src/parser.rs","line":231,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"See Kelly\u0027s suggestion, it\u0027s the right thing to do."},{"file":"cfwlogd/src/parser.rs","line":231,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Done"},{"file":"cfwlogd/src/parser.rs","line":313,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Do we want to verify that total garbage fails parsing correctly without panicking? and e.g. if the size is too small?"},{"file":"cfwlogd/src/parser.rs","line":313,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Done"},{"file":"cfwlogd/src/zones.rs","line":23,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"\"a part\""},{"file":"cfwlogd/src/zones.rs","line":23,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Done"},{"file":"cfwlogd/src/zones.rs","line":25,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Can\u0027t this use iter().any() ?"},{"file":"cfwlogd/src/zones.rs","line":25,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Done"},{"file":"cfwlogd/src/zones.rs","line":56,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"What if we (mistakenly?) get another Ready after we already did init? And if so, should we *replace* all of vmobjs??"},{"file":"cfwlogd/src/zones.rs","line":56,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"I used to assert that we didn\u0027t see another Ready event here, but I removed it before pushing the patchset since we will see a new ready event once the vminfod client is able to retry its connection on failure.  I think its fine to replace/update all vmobjs when that happens."},{"file":"cfwlogd/src/zones.rs","line":69,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"I\u0027m sure it\u0027s my Rust naivety, but I don\u0027t understand why we need to bump a refcount here to call this function? Why isn\u0027t it just a mut ref to VmObjs?"},{"file":"cfwlogd/src/zones.rs","line":69,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"You\u0027re right, and since the lock only needs \u0026self when calling write() we can even drop the mut."},{"file":"cfwlogd/src/zones.rs","line":71,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"The old alias entry is left around in the hashmap, is that right? Is that theoretically unbounded? I can\u0027t recall offhand if did\u0027s get recycled?"},{"file":"cfwlogd/src/zones.rs","line":71,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Insert will replace the item in the hashmap if the key already exists.  In this case we are keying off zonedid. \n\nI don\u0027t know what happens if you create/destroy zones on a box filling up an entire zoneid_t. Not sure how those are kept unique."},{"file":"deps/eng","line":1,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"This is just fine, but here\u0027s a reminder to check that deps/eng is current before integrating. That should be just a case of doing:\n\ngit submodule update --remote deps/eng; git add deps/eng; git commit"},{"file":"package.json","line":4,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Do we really have a 1.0 release built up of 0.1. etc components?"},{"file":"package.json","line":4,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Not sure what we do for other agents?  Maybe Pedro could answer that one."},{"file":"smf/manifests/firewall-logger-agent.xml.in","line":34,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"I\u0027m surprised that we don\u0027t depend on the -setup service ?"},{"file":"smf/manifests/firewall-logger-agent.xml.in","line":51,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Is this necessary?"},{"file":"smf/manifests/firewall-logger-agent.xml.in","line":51,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Done"},{"file":"smf/method/firewall-logger-agent-setup","line":28,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"This is a little bit of a hack, is there something we could do for logadm to obviate the need to do this?"},{"file":"testutils/Cargo.toml","line":1,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"I suppose we\u0027d just never try to publish this, so it doesn\u0027t matter that the name is very generic?"},{"file":"testutils/Cargo.toml","line":1,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Yeah this is just a \"crate\" that lives as apart of the cargo workspace.  Something we plan to never publish."},{"file":"testutils/src/lib.rs","line":1,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Is there a reason this is missing a license and copyright?"},{"file":"testutils/src/lib.rs","line":1,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Done"},{"file":"testutils/src/lib.rs","line":7,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"this could usefully mention the exact C struct name?"},{"file":"testutils/src/lib.rs","line":7,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Done"},{"file":"vminfod/Cargo.toml","line":2,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"is the right name for a client of the daemon?"},{"file":"vminfod/Cargo.toml","line":2,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Done"},{"file":"vminfod/examples/print-events.rs","line":1,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"missing copyright/license?"},{"file":"vminfod/examples/print-events.rs","line":1,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Done"},{"file":"vminfod/examples/print-events.rs","line":6,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"nice! i love how simple it is to interface with vminfod events with this interface"},{"file":"vminfod/src/client.rs","line":49,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Can we put the client version in the header?"},{"file":"vminfod/src/client.rs","line":49,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Added cfwlogd\u0027s version number.\n\nThese show up in `vminfo status` btw"},{"file":"vminfod/src/client.rs","line":52,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Body::empty() ?"},{"file":"vminfod/src/client.rs","line":52,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Done"},{"file":"vminfod/src/client.rs","line":55,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"I had a comment here asking about what happens if the event stream closes, then I found TRITON-1754. But won\u0027t the same thing happen if we can\u0027t connect for whatever reason? Especially a transitory one?"},{"file":"vminfod/src/client.rs","line":55,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"This is true.  We will currently log an error that it couldn\u0027t connect and then the tx half of the channel will close causing the calling code in cfwlogd to panic.\n\nSince there is no way to a value from spawn:\nF: Future\u003cItem \u003d (), Error \u003d ()\u003e + Send + \u0027static\n\nThis likely needs to be rethought.  We can wait for TRITON-1754, or would you prefer this is addressed in the initial commit?"},{"file":"vminfod/src/client.rs","line":66,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Won\u0027t this panic if we get a SendError? Is it really that unlikely the receiver is still connected?"},{"file":"vminfod/src/client.rs","line":66,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"This module exposes \"start_vminfod_stream\" which gives back the rx half of the channel back to the caller.  In the case of cfwlogd, this should never be closed and if it is that\u0027s definitely a runtime error.  I will update the unwrap to an expect.\n\nI do want to make a more generic vminfod client that doesn\u0027t make these kinds of assumptions and can live in crates.io, but we decided that should be a follow up ticket."},{"file":"vminfod/src/lib.rs","line":13,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"where does this get used?"},{"file":"vminfod/src/lib.rs","line":13,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Its used in the client.rs file.  I will updated the smf manifest to set vminfod\u003derror for logging level."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".cargo/config","type":"ADDED","insertions":1,"deletions":0},{"file":".gitignore","type":"ADDED","insertions":27,"deletions":0},{"file":".gitmodules","type":"ADDED","insertions":3,"deletions":0},{"file":"Cargo.lock","type":"ADDED","insertions":1368,"deletions":0},{"file":"Cargo.toml","type":"ADDED","insertions":19,"deletions":0},{"file":"LICENSE","type":"ADDED","insertions":373,"deletions":0},{"file":"Makefile","type":"ADDED","insertions":117,"deletions":0},{"file":"README.md","type":"ADDED","insertions":50,"deletions":0},{"file":"cfwlogd/Cargo.toml","type":"ADDED","insertions":24,"deletions":0},{"file":"cfwlogd/src/events.rs","type":"ADDED","insertions":408,"deletions":0},{"file":"cfwlogd/src/fileutils.rs","type":"ADDED","insertions":134,"deletions":0},{"file":"cfwlogd/src/ipf.rs","type":"ADDED","insertions":66,"deletions":0},{"file":"cfwlogd/src/logger.rs","type":"ADDED","insertions":309,"deletions":0},{"file":"cfwlogd/src/main.rs","type":"ADDED","insertions":370,"deletions":0},{"file":"cfwlogd/src/parser.rs","type":"ADDED","insertions":313,"deletions":0},{"file":"cfwlogd/src/signal.rs","type":"ADDED","insertions":44,"deletions":0},{"file":"cfwlogd/src/zones.rs","type":"ADDED","insertions":93,"deletions":0},{"file":"deps/eng","type":"ADDED","insertions":1,"deletions":0},{"file":"manifest.tmpl","type":"ADDED","insertions":27,"deletions":0},{"file":"npm/lib/error_handler.sh","type":"ADDED","insertions":73,"deletions":0},{"file":"npm/lib/trace_logger.sh","type":"ADDED","insertions":36,"deletions":0},{"file":"npm/postinstall.sh","type":"ADDED","insertions":273,"deletions":0},{"file":"npm/postuninstall.sh","type":"ADDED","insertions":33,"deletions":0},{"file":"package.json","type":"ADDED","insertions":16,"deletions":0},{"file":"smf/manifests/firewall-logger-agent-setup.xml.in","type":"ADDED","insertions":55,"deletions":0},{"file":"smf/manifests/firewall-logger-agent.xml.in","type":"ADDED","insertions":79,"deletions":0},{"file":"smf/method/firewall-logger-agent-setup","type":"ADDED","insertions":52,"deletions":0},{"file":"testutils/Cargo.toml","type":"ADDED","insertions":11,"deletions":0},{"file":"testutils/src/lib.rs","type":"ADDED","insertions":117,"deletions":0},{"file":"vminfod/Cargo.toml","type":"ADDED","insertions":14,"deletions":0},{"file":"vminfod/examples/print-events.rs","type":"ADDED","insertions":9,"deletions":0},{"file":"vminfod/src/client.rs","type":"ADDED","insertions":77,"deletions":0},{"file":"vminfod/src/lib.rs","type":"ADDED","insertions":89,"deletions":0},{"file":"vminfod/src/linefeed.rs","type":"ADDED","insertions":131,"deletions":0}],"sizeInsertions":4812,"sizeDeletions":0},{"number":"7","revision":"d67fe263d88f0405f50ee3310d3d4c5a07781078","parents":["2917fa2b11591c184f34de9edd5efabe3a18cc7f"],"ref":"refs/changes/63/6463/7","uploader":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"createdOn":1561741187,"author":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1561741268,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".cargo/config","type":"ADDED","insertions":1,"deletions":0},{"file":".gitignore","type":"ADDED","insertions":27,"deletions":0},{"file":".gitmodules","type":"ADDED","insertions":3,"deletions":0},{"file":"Cargo.lock","type":"ADDED","insertions":1299,"deletions":0},{"file":"Cargo.toml","type":"ADDED","insertions":15,"deletions":0},{"file":"LICENSE","type":"ADDED","insertions":373,"deletions":0},{"file":"Makefile","type":"ADDED","insertions":117,"deletions":0},{"file":"README.md","type":"ADDED","insertions":50,"deletions":0},{"file":"cfwlogd/Cargo.toml","type":"ADDED","insertions":24,"deletions":0},{"file":"cfwlogd/src/events.rs","type":"ADDED","insertions":427,"deletions":0},{"file":"cfwlogd/src/fileutils.rs","type":"ADDED","insertions":155,"deletions":0},{"file":"cfwlogd/src/ipf.rs","type":"ADDED","insertions":68,"deletions":0},{"file":"cfwlogd/src/logger.rs","type":"ADDED","insertions":323,"deletions":0},{"file":"cfwlogd/src/main.rs","type":"ADDED","insertions":376,"deletions":0},{"file":"cfwlogd/src/parser.rs","type":"ADDED","insertions":328,"deletions":0},{"file":"cfwlogd/src/signal.rs","type":"ADDED","insertions":44,"deletions":0},{"file":"cfwlogd/src/zones.rs","type":"ADDED","insertions":90,"deletions":0},{"file":"deps/eng","type":"ADDED","insertions":1,"deletions":0},{"file":"manifest.tmpl","type":"ADDED","insertions":27,"deletions":0},{"file":"npm/lib/error_handler.sh","type":"ADDED","insertions":73,"deletions":0},{"file":"npm/lib/trace_logger.sh","type":"ADDED","insertions":36,"deletions":0},{"file":"npm/postinstall.sh","type":"ADDED","insertions":273,"deletions":0},{"file":"npm/postuninstall.sh","type":"ADDED","insertions":33,"deletions":0},{"file":"package.json","type":"ADDED","insertions":16,"deletions":0},{"file":"smf/manifests/firewall-logger-agent-setup.xml.in","type":"ADDED","insertions":55,"deletions":0},{"file":"smf/manifests/firewall-logger-agent.xml.in","type":"ADDED","insertions":79,"deletions":0},{"file":"smf/method/firewall-logger-agent-setup","type":"ADDED","insertions":52,"deletions":0},{"file":"testutils/Cargo.toml","type":"ADDED","insertions":11,"deletions":0},{"file":"testutils/src/lib.rs","type":"ADDED","insertions":123,"deletions":0},{"file":"vminfod-client/Cargo.toml","type":"ADDED","insertions":14,"deletions":0},{"file":"vminfod-client/examples/print-events.rs","type":"ADDED","insertions":16,"deletions":0},{"file":"vminfod-client/src/client.rs","type":"ADDED","insertions":82,"deletions":0},{"file":"vminfod-client/src/lib.rs","type":"ADDED","insertions":92,"deletions":0},{"file":"vminfod-client/src/linefeed.rs","type":"ADDED","insertions":131,"deletions":0}],"sizeInsertions":4834,"sizeDeletions":0},{"number":"8","revision":"5e9814cc7ed118980849692248777b6dc4eff5c0","parents":["2917fa2b11591c184f34de9edd5efabe3a18cc7f"],"ref":"refs/changes/63/6463/8","uploader":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"createdOn":1561745125,"author":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1561745200,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".cargo/config","type":"ADDED","insertions":1,"deletions":0},{"file":".gitignore","type":"ADDED","insertions":27,"deletions":0},{"file":".gitmodules","type":"ADDED","insertions":3,"deletions":0},{"file":"Cargo.lock","type":"ADDED","insertions":1299,"deletions":0},{"file":"Cargo.toml","type":"ADDED","insertions":15,"deletions":0},{"file":"LICENSE","type":"ADDED","insertions":373,"deletions":0},{"file":"Makefile","type":"ADDED","insertions":102,"deletions":0},{"file":"README.md","type":"ADDED","insertions":50,"deletions":0},{"file":"cfwlogd/Cargo.toml","type":"ADDED","insertions":24,"deletions":0},{"file":"cfwlogd/src/events.rs","type":"ADDED","insertions":427,"deletions":0},{"file":"cfwlogd/src/fileutils.rs","type":"ADDED","insertions":155,"deletions":0},{"file":"cfwlogd/src/ipf.rs","type":"ADDED","insertions":68,"deletions":0},{"file":"cfwlogd/src/logger.rs","type":"ADDED","insertions":323,"deletions":0},{"file":"cfwlogd/src/main.rs","type":"ADDED","insertions":376,"deletions":0},{"file":"cfwlogd/src/parser.rs","type":"ADDED","insertions":328,"deletions":0},{"file":"cfwlogd/src/signal.rs","type":"ADDED","insertions":44,"deletions":0},{"file":"cfwlogd/src/zones.rs","type":"ADDED","insertions":90,"deletions":0},{"file":"deps/eng","type":"ADDED","insertions":1,"deletions":0},{"file":"manifest.tmpl","type":"ADDED","insertions":27,"deletions":0},{"file":"npm/lib/error_handler.sh","type":"ADDED","insertions":73,"deletions":0},{"file":"npm/lib/trace_logger.sh","type":"ADDED","insertions":36,"deletions":0},{"file":"npm/postinstall.sh","type":"ADDED","insertions":273,"deletions":0},{"file":"npm/postuninstall.sh","type":"ADDED","insertions":33,"deletions":0},{"file":"package.json","type":"ADDED","insertions":16,"deletions":0},{"file":"smf/manifests/firewall-logger-agent-setup.xml.in","type":"ADDED","insertions":55,"deletions":0},{"file":"smf/manifests/firewall-logger-agent.xml.in","type":"ADDED","insertions":73,"deletions":0},{"file":"smf/method/firewall-logger-agent-setup","type":"ADDED","insertions":52,"deletions":0},{"file":"testutils/Cargo.toml","type":"ADDED","insertions":11,"deletions":0},{"file":"testutils/src/lib.rs","type":"ADDED","insertions":123,"deletions":0},{"file":"vminfod-client/Cargo.toml","type":"ADDED","insertions":14,"deletions":0},{"file":"vminfod-client/examples/print-events.rs","type":"ADDED","insertions":16,"deletions":0},{"file":"vminfod-client/src/client.rs","type":"ADDED","insertions":82,"deletions":0},{"file":"vminfod-client/src/lib.rs","type":"ADDED","insertions":92,"deletions":0},{"file":"vminfod-client/src/linefeed.rs","type":"ADDED","insertions":131,"deletions":0}],"sizeInsertions":4813,"sizeDeletions":0},{"number":"9","revision":"be6bf301a0053cb571b2c4d03d934d2d898e633f","parents":["2917fa2b11591c184f34de9edd5efabe3a18cc7f"],"ref":"refs/changes/63/6463/9","uploader":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"createdOn":1561752181,"author":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1561752257,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".cargo/config","type":"ADDED","insertions":1,"deletions":0},{"file":".gitignore","type":"ADDED","insertions":27,"deletions":0},{"file":".gitmodules","type":"ADDED","insertions":3,"deletions":0},{"file":"Cargo.lock","type":"ADDED","insertions":1299,"deletions":0},{"file":"Cargo.toml","type":"ADDED","insertions":15,"deletions":0},{"file":"LICENSE","type":"ADDED","insertions":373,"deletions":0},{"file":"Makefile","type":"ADDED","insertions":102,"deletions":0},{"file":"README.md","type":"ADDED","insertions":81,"deletions":0},{"file":"cfwlogd/Cargo.toml","type":"ADDED","insertions":24,"deletions":0},{"file":"cfwlogd/src/events.rs","type":"ADDED","insertions":427,"deletions":0},{"file":"cfwlogd/src/fileutils.rs","type":"ADDED","insertions":155,"deletions":0},{"file":"cfwlogd/src/ipf.rs","type":"ADDED","insertions":68,"deletions":0},{"file":"cfwlogd/src/logger.rs","type":"ADDED","insertions":323,"deletions":0},{"file":"cfwlogd/src/main.rs","type":"ADDED","insertions":376,"deletions":0},{"file":"cfwlogd/src/parser.rs","type":"ADDED","insertions":328,"deletions":0},{"file":"cfwlogd/src/signal.rs","type":"ADDED","insertions":44,"deletions":0},{"file":"cfwlogd/src/zones.rs","type":"ADDED","insertions":90,"deletions":0},{"file":"deps/eng","type":"ADDED","insertions":1,"deletions":0},{"file":"manifest.tmpl","type":"ADDED","insertions":27,"deletions":0},{"file":"npm/lib/error_handler.sh","type":"ADDED","insertions":73,"deletions":0},{"file":"npm/lib/trace_logger.sh","type":"ADDED","insertions":36,"deletions":0},{"file":"npm/postinstall.sh","type":"ADDED","insertions":295,"deletions":0},{"file":"npm/postuninstall.sh","type":"ADDED","insertions":35,"deletions":0},{"file":"package.json","type":"ADDED","insertions":16,"deletions":0},{"file":"smf/manifests/firewall-logger-agent-setup.xml.in","type":"ADDED","insertions":55,"deletions":0},{"file":"smf/manifests/firewall-logger-agent.xml.in","type":"ADDED","insertions":74,"deletions":0},{"file":"smf/method/firewall-logger-agent-setup","type":"ADDED","insertions":52,"deletions":0},{"file":"testutils/Cargo.toml","type":"ADDED","insertions":11,"deletions":0},{"file":"testutils/src/lib.rs","type":"ADDED","insertions":123,"deletions":0},{"file":"vminfod-client/Cargo.toml","type":"ADDED","insertions":14,"deletions":0},{"file":"vminfod-client/examples/print-events.rs","type":"ADDED","insertions":16,"deletions":0},{"file":"vminfod-client/src/client.rs","type":"ADDED","insertions":82,"deletions":0},{"file":"vminfod-client/src/lib.rs","type":"ADDED","insertions":92,"deletions":0},{"file":"vminfod-client/src/linefeed.rs","type":"ADDED","insertions":131,"deletions":0}],"sizeInsertions":4869,"sizeDeletions":0},{"number":"10","revision":"a41b6136921ac4c922fce11123bf10b318c95fe5","parents":["2917fa2b11591c184f34de9edd5efabe3a18cc7f"],"ref":"refs/changes/63/6463/10","uploader":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"createdOn":1561753313,"author":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1561753388,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"npm/postinstall.sh","line":272,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"This will make changes to the ramdisk which will not persist across reboot.  There are similar lines in the setup service\u0027s method script - these should replace those."},{"file":"npm/postinstall.sh","line":272,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Done"},{"file":"npm/postinstall.sh","line":293,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"delete"},{"file":"npm/postinstall.sh","line":293,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".cargo/config","type":"ADDED","insertions":1,"deletions":0},{"file":".gitignore","type":"ADDED","insertions":27,"deletions":0},{"file":".gitmodules","type":"ADDED","insertions":3,"deletions":0},{"file":"Cargo.lock","type":"ADDED","insertions":1299,"deletions":0},{"file":"Cargo.toml","type":"ADDED","insertions":15,"deletions":0},{"file":"LICENSE","type":"ADDED","insertions":373,"deletions":0},{"file":"Makefile","type":"ADDED","insertions":102,"deletions":0},{"file":"README.md","type":"ADDED","insertions":81,"deletions":0},{"file":"cfwlogd/Cargo.toml","type":"ADDED","insertions":24,"deletions":0},{"file":"cfwlogd/src/events.rs","type":"ADDED","insertions":427,"deletions":0},{"file":"cfwlogd/src/fileutils.rs","type":"ADDED","insertions":155,"deletions":0},{"file":"cfwlogd/src/ipf.rs","type":"ADDED","insertions":68,"deletions":0},{"file":"cfwlogd/src/logger.rs","type":"ADDED","insertions":323,"deletions":0},{"file":"cfwlogd/src/main.rs","type":"ADDED","insertions":376,"deletions":0},{"file":"cfwlogd/src/parser.rs","type":"ADDED","insertions":328,"deletions":0},{"file":"cfwlogd/src/signal.rs","type":"ADDED","insertions":44,"deletions":0},{"file":"cfwlogd/src/zones.rs","type":"ADDED","insertions":90,"deletions":0},{"file":"deps/eng","type":"ADDED","insertions":1,"deletions":0},{"file":"manifest.tmpl","type":"ADDED","insertions":27,"deletions":0},{"file":"npm/lib/error_handler.sh","type":"ADDED","insertions":73,"deletions":0},{"file":"npm/lib/trace_logger.sh","type":"ADDED","insertions":36,"deletions":0},{"file":"npm/postinstall.sh","type":"ADDED","insertions":295,"deletions":0},{"file":"npm/postuninstall.sh","type":"ADDED","insertions":35,"deletions":0},{"file":"package.json","type":"ADDED","insertions":16,"deletions":0},{"file":"smf/manifests/firewall-logger-agent-setup.xml.in","type":"ADDED","insertions":55,"deletions":0},{"file":"smf/manifests/firewall-logger-agent.xml.in","type":"ADDED","insertions":74,"deletions":0},{"file":"smf/method/firewall-logger-agent-setup","type":"ADDED","insertions":52,"deletions":0},{"file":"testutils/Cargo.toml","type":"ADDED","insertions":11,"deletions":0},{"file":"testutils/src/lib.rs","type":"ADDED","insertions":123,"deletions":0},{"file":"vminfod-client/Cargo.toml","type":"ADDED","insertions":14,"deletions":0},{"file":"vminfod-client/examples/print-events.rs","type":"ADDED","insertions":16,"deletions":0},{"file":"vminfod-client/src/client.rs","type":"ADDED","insertions":82,"deletions":0},{"file":"vminfod-client/src/lib.rs","type":"ADDED","insertions":92,"deletions":0},{"file":"vminfod-client/src/linefeed.rs","type":"ADDED","insertions":131,"deletions":0}],"sizeInsertions":4869,"sizeDeletions":0},{"number":"11","revision":"df0816eb75a649f67332ff5a498b38a3a9ac07ef","parents":["2917fa2b11591c184f34de9edd5efabe3a18cc7f"],"ref":"refs/changes/63/6463/11","uploader":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"createdOn":1561754780,"author":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1561754854,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"Makefile","line":93,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"doesn\u0027t really matter much, but echo is the one time you *do* want the \"@\", since all it does is echo its arguments."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".cargo/config","type":"ADDED","insertions":1,"deletions":0},{"file":".gitignore","type":"ADDED","insertions":27,"deletions":0},{"file":".gitmodules","type":"ADDED","insertions":3,"deletions":0},{"file":"Cargo.lock","type":"ADDED","insertions":1299,"deletions":0},{"file":"Cargo.toml","type":"ADDED","insertions":15,"deletions":0},{"file":"LICENSE","type":"ADDED","insertions":373,"deletions":0},{"file":"Makefile","type":"ADDED","insertions":102,"deletions":0},{"file":"README.md","type":"ADDED","insertions":81,"deletions":0},{"file":"cfwlogd/Cargo.toml","type":"ADDED","insertions":24,"deletions":0},{"file":"cfwlogd/src/events.rs","type":"ADDED","insertions":427,"deletions":0},{"file":"cfwlogd/src/fileutils.rs","type":"ADDED","insertions":155,"deletions":0},{"file":"cfwlogd/src/ipf.rs","type":"ADDED","insertions":68,"deletions":0},{"file":"cfwlogd/src/logger.rs","type":"ADDED","insertions":323,"deletions":0},{"file":"cfwlogd/src/main.rs","type":"ADDED","insertions":376,"deletions":0},{"file":"cfwlogd/src/parser.rs","type":"ADDED","insertions":328,"deletions":0},{"file":"cfwlogd/src/signal.rs","type":"ADDED","insertions":44,"deletions":0},{"file":"cfwlogd/src/zones.rs","type":"ADDED","insertions":90,"deletions":0},{"file":"deps/eng","type":"ADDED","insertions":1,"deletions":0},{"file":"manifest.tmpl","type":"ADDED","insertions":27,"deletions":0},{"file":"npm/lib/error_handler.sh","type":"ADDED","insertions":73,"deletions":0},{"file":"npm/lib/trace_logger.sh","type":"ADDED","insertions":36,"deletions":0},{"file":"npm/postinstall.sh","type":"ADDED","insertions":272,"deletions":0},{"file":"npm/postuninstall.sh","type":"ADDED","insertions":35,"deletions":0},{"file":"package.json","type":"ADDED","insertions":16,"deletions":0},{"file":"smf/manifests/firewall-logger-agent-setup.xml.in","type":"ADDED","insertions":55,"deletions":0},{"file":"smf/manifests/firewall-logger-agent.xml.in","type":"ADDED","insertions":74,"deletions":0},{"file":"smf/method/firewall-logger-agent-setup","type":"ADDED","insertions":56,"deletions":0},{"file":"testutils/Cargo.toml","type":"ADDED","insertions":11,"deletions":0},{"file":"testutils/src/lib.rs","type":"ADDED","insertions":123,"deletions":0},{"file":"vminfod-client/Cargo.toml","type":"ADDED","insertions":14,"deletions":0},{"file":"vminfod-client/examples/print-events.rs","type":"ADDED","insertions":16,"deletions":0},{"file":"vminfod-client/src/client.rs","type":"ADDED","insertions":82,"deletions":0},{"file":"vminfod-client/src/lib.rs","type":"ADDED","insertions":92,"deletions":0},{"file":"vminfod-client/src/linefeed.rs","type":"ADDED","insertions":131,"deletions":0}],"sizeInsertions":4850,"sizeDeletions":0},{"number":"12","revision":"f6e3d01dbf3d6cd14be57b3e206bb277ffb8a629","parents":["2917fa2b11591c184f34de9edd5efabe3a18cc7f"],"ref":"refs/changes/63/6463/12","uploader":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"createdOn":1561757386,"author":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1561757468,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1561758702,"by":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1561953479,"by":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1561759859,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1561802546,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"comments":[{"file":"cfwlogd/src/ipf.rs","line":58,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Spelling nit: because"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".cargo/config","type":"ADDED","insertions":1,"deletions":0},{"file":".gitignore","type":"ADDED","insertions":27,"deletions":0},{"file":".gitmodules","type":"ADDED","insertions":3,"deletions":0},{"file":"Cargo.lock","type":"ADDED","insertions":1299,"deletions":0},{"file":"Cargo.toml","type":"ADDED","insertions":15,"deletions":0},{"file":"LICENSE","type":"ADDED","insertions":373,"deletions":0},{"file":"Makefile","type":"ADDED","insertions":102,"deletions":0},{"file":"README.md","type":"ADDED","insertions":81,"deletions":0},{"file":"cfwlogd/Cargo.toml","type":"ADDED","insertions":24,"deletions":0},{"file":"cfwlogd/src/events.rs","type":"ADDED","insertions":427,"deletions":0},{"file":"cfwlogd/src/fileutils.rs","type":"ADDED","insertions":155,"deletions":0},{"file":"cfwlogd/src/ipf.rs","type":"ADDED","insertions":68,"deletions":0},{"file":"cfwlogd/src/logger.rs","type":"ADDED","insertions":323,"deletions":0},{"file":"cfwlogd/src/main.rs","type":"ADDED","insertions":376,"deletions":0},{"file":"cfwlogd/src/parser.rs","type":"ADDED","insertions":328,"deletions":0},{"file":"cfwlogd/src/signal.rs","type":"ADDED","insertions":44,"deletions":0},{"file":"cfwlogd/src/zones.rs","type":"ADDED","insertions":90,"deletions":0},{"file":"deps/eng","type":"ADDED","insertions":1,"deletions":0},{"file":"manifest.tmpl","type":"ADDED","insertions":27,"deletions":0},{"file":"npm/lib/error_handler.sh","type":"ADDED","insertions":73,"deletions":0},{"file":"npm/lib/trace_logger.sh","type":"ADDED","insertions":36,"deletions":0},{"file":"npm/postinstall.sh","type":"ADDED","insertions":272,"deletions":0},{"file":"npm/postuninstall.sh","type":"ADDED","insertions":35,"deletions":0},{"file":"package.json","type":"ADDED","insertions":16,"deletions":0},{"file":"smf/manifests/firewall-logger-agent-setup.xml.in","type":"ADDED","insertions":55,"deletions":0},{"file":"smf/manifests/firewall-logger-agent.xml.in","type":"ADDED","insertions":74,"deletions":0},{"file":"smf/method/firewall-logger-agent-setup","type":"ADDED","insertions":56,"deletions":0},{"file":"testutils/Cargo.toml","type":"ADDED","insertions":11,"deletions":0},{"file":"testutils/src/lib.rs","type":"ADDED","insertions":123,"deletions":0},{"file":"vminfod-client/Cargo.toml","type":"ADDED","insertions":14,"deletions":0},{"file":"vminfod-client/examples/print-events.rs","type":"ADDED","insertions":16,"deletions":0},{"file":"vminfod-client/src/client.rs","type":"ADDED","insertions":82,"deletions":0},{"file":"vminfod-client/src/lib.rs","type":"ADDED","insertions":92,"deletions":0},{"file":"vminfod-client/src/linefeed.rs","type":"ADDED","insertions":131,"deletions":0}],"sizeInsertions":4850,"sizeDeletions":0},{"number":"13","revision":"2cfd5ed86bc50a90f0fcdd3cbfe8a31ff1c2f6fe","parents":["2917fa2b11591c184f34de9edd5efabe3a18cc7f"],"ref":"refs/changes/63/6463/13","uploader":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"createdOn":1561998777,"author":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1561998857,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1562076679,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1562002591,"by":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1562077337,"by":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1561999193,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1562002257,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1562076321,"by":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":".cargo/config","type":"ADDED","insertions":1,"deletions":0},{"file":".gitignore","type":"ADDED","insertions":27,"deletions":0},{"file":".gitmodules","type":"ADDED","insertions":3,"deletions":0},{"file":"Cargo.lock","type":"ADDED","insertions":1299,"deletions":0},{"file":"Cargo.toml","type":"ADDED","insertions":15,"deletions":0},{"file":"LICENSE","type":"ADDED","insertions":373,"deletions":0},{"file":"Makefile","type":"ADDED","insertions":102,"deletions":0},{"file":"README.md","type":"ADDED","insertions":81,"deletions":0},{"file":"cfwlogd/Cargo.toml","type":"ADDED","insertions":24,"deletions":0},{"file":"cfwlogd/src/events.rs","type":"ADDED","insertions":427,"deletions":0},{"file":"cfwlogd/src/fileutils.rs","type":"ADDED","insertions":155,"deletions":0},{"file":"cfwlogd/src/ipf.rs","type":"ADDED","insertions":68,"deletions":0},{"file":"cfwlogd/src/logger.rs","type":"ADDED","insertions":324,"deletions":0},{"file":"cfwlogd/src/main.rs","type":"ADDED","insertions":359,"deletions":0},{"file":"cfwlogd/src/parser.rs","type":"ADDED","insertions":328,"deletions":0},{"file":"cfwlogd/src/signal.rs","type":"ADDED","insertions":44,"deletions":0},{"file":"cfwlogd/src/zones.rs","type":"ADDED","insertions":90,"deletions":0},{"file":"deps/eng","type":"ADDED","insertions":1,"deletions":0},{"file":"manifest.tmpl","type":"ADDED","insertions":27,"deletions":0},{"file":"npm/lib/error_handler.sh","type":"ADDED","insertions":73,"deletions":0},{"file":"npm/lib/trace_logger.sh","type":"ADDED","insertions":36,"deletions":0},{"file":"npm/postinstall.sh","type":"ADDED","insertions":272,"deletions":0},{"file":"npm/postuninstall.sh","type":"ADDED","insertions":35,"deletions":0},{"file":"package.json","type":"ADDED","insertions":16,"deletions":0},{"file":"smf/manifests/firewall-logger-agent-setup.xml.in","type":"ADDED","insertions":55,"deletions":0},{"file":"smf/manifests/firewall-logger-agent.xml.in","type":"ADDED","insertions":74,"deletions":0},{"file":"smf/method/firewall-logger-agent-setup","type":"ADDED","insertions":56,"deletions":0},{"file":"testutils/Cargo.toml","type":"ADDED","insertions":11,"deletions":0},{"file":"testutils/src/lib.rs","type":"ADDED","insertions":123,"deletions":0},{"file":"vminfod-client/Cargo.toml","type":"ADDED","insertions":14,"deletions":0},{"file":"vminfod-client/examples/print-events.rs","type":"ADDED","insertions":16,"deletions":0},{"file":"vminfod-client/src/client.rs","type":"ADDED","insertions":82,"deletions":0},{"file":"vminfod-client/src/lib.rs","type":"ADDED","insertions":92,"deletions":0},{"file":"vminfod-client/src/linefeed.rs","type":"ADDED","insertions":131,"deletions":0}],"sizeInsertions":4834,"sizeDeletions":0},{"number":"14","revision":"13092413b2e92c1ae9d1b95cedec7f0ed729ab38","parents":["2917fa2b11591c184f34de9edd5efabe3a18cc7f"],"ref":"refs/changes/63/6463/14","uploader":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"createdOn":1562078457,"author":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1561998857,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1562076679,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1562002591,"by":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"}},{"type":"SUBM","value":"1","grantedOn":1562078486,"by":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1562077337,"by":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1561999193,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1562002257,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1562076321,"by":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":13,"deletions":0},{"file":".cargo/config","type":"ADDED","insertions":1,"deletions":0},{"file":".gitignore","type":"ADDED","insertions":27,"deletions":0},{"file":".gitmodules","type":"ADDED","insertions":3,"deletions":0},{"file":"Cargo.lock","type":"ADDED","insertions":1299,"deletions":0},{"file":"Cargo.toml","type":"ADDED","insertions":15,"deletions":0},{"file":"LICENSE","type":"ADDED","insertions":373,"deletions":0},{"file":"Makefile","type":"ADDED","insertions":102,"deletions":0},{"file":"README.md","type":"ADDED","insertions":81,"deletions":0},{"file":"cfwlogd/Cargo.toml","type":"ADDED","insertions":24,"deletions":0},{"file":"cfwlogd/src/events.rs","type":"ADDED","insertions":427,"deletions":0},{"file":"cfwlogd/src/fileutils.rs","type":"ADDED","insertions":155,"deletions":0},{"file":"cfwlogd/src/ipf.rs","type":"ADDED","insertions":68,"deletions":0},{"file":"cfwlogd/src/logger.rs","type":"ADDED","insertions":324,"deletions":0},{"file":"cfwlogd/src/main.rs","type":"ADDED","insertions":359,"deletions":0},{"file":"cfwlogd/src/parser.rs","type":"ADDED","insertions":328,"deletions":0},{"file":"cfwlogd/src/signal.rs","type":"ADDED","insertions":44,"deletions":0},{"file":"cfwlogd/src/zones.rs","type":"ADDED","insertions":90,"deletions":0},{"file":"deps/eng","type":"ADDED","insertions":1,"deletions":0},{"file":"manifest.tmpl","type":"ADDED","insertions":27,"deletions":0},{"file":"npm/lib/error_handler.sh","type":"ADDED","insertions":73,"deletions":0},{"file":"npm/lib/trace_logger.sh","type":"ADDED","insertions":36,"deletions":0},{"file":"npm/postinstall.sh","type":"ADDED","insertions":272,"deletions":0},{"file":"npm/postuninstall.sh","type":"ADDED","insertions":35,"deletions":0},{"file":"package.json","type":"ADDED","insertions":16,"deletions":0},{"file":"smf/manifests/firewall-logger-agent-setup.xml.in","type":"ADDED","insertions":55,"deletions":0},{"file":"smf/manifests/firewall-logger-agent.xml.in","type":"ADDED","insertions":74,"deletions":0},{"file":"smf/method/firewall-logger-agent-setup","type":"ADDED","insertions":56,"deletions":0},{"file":"testutils/Cargo.toml","type":"ADDED","insertions":11,"deletions":0},{"file":"testutils/src/lib.rs","type":"ADDED","insertions":123,"deletions":0},{"file":"vminfod-client/Cargo.toml","type":"ADDED","insertions":14,"deletions":0},{"file":"vminfod-client/examples/print-events.rs","type":"ADDED","insertions":16,"deletions":0},{"file":"vminfod-client/src/client.rs","type":"ADDED","insertions":82,"deletions":0},{"file":"vminfod-client/src/lib.rs","type":"ADDED","insertions":92,"deletions":0},{"file":"vminfod-client/src/linefeed.rs","type":"ADDED","insertions":131,"deletions":0}],"sizeInsertions":4834,"sizeDeletions":0}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"}]}