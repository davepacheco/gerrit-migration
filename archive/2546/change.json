{"project":"joyent/moray","branch":"master","topic":"MORAY-431","id":"Ib6704b51d110458033fc10e3d273ae05267b286b","number":"2546","subject":"MORAY-431 Errors after query has timed out are emitted when there are no \"error\" listeners Reviewed by: Jan Wyszynski \u003cjan.wyszynski@joyent.com\u003e Reviewed by: David Pacheco \u003cdap@joyent.com\u003e Approved by: David Pacheco \u003cdap@joyent.com\u003e","owner":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"url":"https://cr.joyent.us/2546","commitMessage":"MORAY-431 Errors after query has timed out are emitted when there are no \"error\" listeners\nReviewed by: Jan Wyszynski \u003cjan.wyszynski@joyent.com\u003e\nReviewed by: David Pacheco \u003cdap@joyent.com\u003e\nApproved by: David Pacheco \u003cdap@joyent.com\u003e\n","createdOn":1505228299,"lastUpdated":1505843574,"open":false,"status":"MERGED","comments":[{"timestamp":1505228299,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 1."},{"timestamp":1505228326,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1505254944,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 2."},{"timestamp":1505254976,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1505256726,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 3."},{"timestamp":1505256753,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1505258526,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Topic set to MORAY-431"},{"timestamp":1505261813,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Patch Set 3:\n\n(1 comment)"},{"timestamp":1505349046,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 4."},{"timestamp":1505349059,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 4:\n\n(1 comment)"},{"timestamp":1505349095,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1505435182,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Patch Set 4: Code-Review+1"},{"timestamp":1505843070,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 4: Integration-Approval+1"},{"timestamp":1505843267,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 5: Commit message was updated."},{"timestamp":1505843502,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 6: Patch Set 5 was rebased"},{"timestamp":1505843529,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 6:\n\n\"make check\" passed ok"},{"timestamp":1505843574,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Cody Peter Mello"}],"currentPatchSet":{"number":"6","revision":"26b5659c9b1f887ba12e5c1108218d068fd0b07c","parents":["fde1ad580573bbcd40d8a2148ebeaa3589f639bf"],"ref":"refs/changes/46/2546/6","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1505843502,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1505349095,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1505435182,"by":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1505843070,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"SUBM","value":"1","grantedOn":1505843574,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"lib/dtrace.js","type":"MODIFIED","insertions":3,"deletions":0},{"file":"lib/pg.js","type":"MODIFIED","insertions":51,"deletions":-23}],"sizeInsertions":54,"sizeDeletions":-23},"patchSets":[{"number":"1","revision":"1279a3dcfa02af6521e0011523ba4db32de3c876","parents":["6d70a28bacfbe14f108420644dc4e04f7d9059a3"],"ref":"refs/changes/46/2546/1","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1505228299,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1505228326,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/pg.js","type":"MODIFIED","insertions":31,"deletions":-5}],"sizeInsertions":31,"sizeDeletions":-5},{"number":"2","revision":"f57cc670f111d3b585babcc84a74c1940fc22735","parents":["6d70a28bacfbe14f108420644dc4e04f7d9059a3"],"ref":"refs/changes/46/2546/2","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1505254944,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1505254976,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/dtrace.js","type":"MODIFIED","insertions":3,"deletions":0},{"file":"lib/pg.js","type":"MODIFIED","insertions":39,"deletions":-7}],"sizeInsertions":42,"sizeDeletions":-7},{"number":"3","revision":"f13da8b2b2e336c5db8ad4b6dd08fec432332c82","parents":["6d70a28bacfbe14f108420644dc4e04f7d9059a3"],"ref":"refs/changes/46/2546/3","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1505256726,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1505256753,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/pg.js","line":330,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Is it possible that a transaction that we begin in transactionBegin invokes the callback for the \"end\" event and then the \"error\" callback?Such a failure would result in a transaction that now can\u0027t be rolled back, but could have been rolled back be in the previous version of this function.\n\nI guess what I\u0027m really getting at is whether this could possibly prevent rollback of any transactions that the previous version allowed rollback for."},{"file":"lib/pg.js","line":330,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Closing a connection to Postgres that has open transactions will cause Postgres to ROLLBACK the transaction itself, so this should have the same behaviour as before.\n\nI\u0027ve added a comment above here to explain why we skip the ROLLBACK."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/dtrace.js","type":"MODIFIED","insertions":3,"deletions":0},{"file":"lib/pg.js","type":"MODIFIED","insertions":39,"deletions":-22}],"sizeInsertions":42,"sizeDeletions":-22},{"number":"4","revision":"b6704b51d110458033fc10e3d273ae05267b286b","parents":["6d70a28bacfbe14f108420644dc4e04f7d9059a3"],"ref":"refs/changes/46/2546/4","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1505349046,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1505843070,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1505349095,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1505435182,"by":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/dtrace.js","type":"MODIFIED","insertions":3,"deletions":0},{"file":"lib/pg.js","type":"MODIFIED","insertions":51,"deletions":-23}],"sizeInsertions":54,"sizeDeletions":-23},{"number":"5","revision":"546c04e3e0aecfc88198fb28f4ee80e14b3fa10b","parents":["6d70a28bacfbe14f108420644dc4e04f7d9059a3"],"ref":"refs/changes/46/2546/5","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1505843267,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1505843070,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1505349095,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1505435182,"by":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"lib/dtrace.js","type":"MODIFIED","insertions":3,"deletions":0},{"file":"lib/pg.js","type":"MODIFIED","insertions":51,"deletions":-23}],"sizeInsertions":54,"sizeDeletions":-23},{"number":"6","revision":"26b5659c9b1f887ba12e5c1108218d068fd0b07c","parents":["fde1ad580573bbcd40d8a2148ebeaa3589f639bf"],"ref":"refs/changes/46/2546/6","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1505843502,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1505843070,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"SUBM","value":"1","grantedOn":1505843574,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1505349095,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1505435182,"by":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"lib/dtrace.js","type":"MODIFIED","insertions":3,"deletions":0},{"file":"lib/pg.js","type":"MODIFIED","insertions":51,"deletions":-23}],"sizeInsertions":54,"sizeDeletions":-23}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}]}