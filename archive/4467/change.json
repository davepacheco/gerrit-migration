{"project":"joyent/smartos-live","branch":"master","id":"I2c9bc5ae0592a56cc85331b7f279aa035d65581f","number":"4467","subject":"OS-6818 Have vmadm(1M) utilize route -z for lx zones","owner":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"url":"https://cr.joyent.us/4467","commitMessage":"OS-6818 Have vmadm(1M) utilize route -z for lx zones\n","createdOn":1530563939,"lastUpdated":1548257779,"open":false,"status":"ABANDONED","comments":[{"timestamp":1530563939,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Uploaded patch set 1."},{"timestamp":1530565349,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1530565488,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1530608627,"reviewer":{"name":"Jorge Schrauwen","email":"sjorge@blackdot.be","username":"sjorge"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1530627447,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1531499944,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1534272629,"reviewer":{"name":"Jorge Schrauwen","email":"sjorge@blackdot.be","username":"sjorge"},"message":"Patch Set 1: Code-Review+1\n\nI added this to one of my PI builds... my LX zones did not break.\nLGTM"},{"timestamp":1548257779,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Abandoned"}],"currentPatchSet":{"number":"1","revision":"2c9bc5ae0592a56cc85331b7f279aa035d65581f","parents":["6d232f498952cf009c7dbd046d99cf65acf6ef08"],"ref":"refs/changes/67/4467/1","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1530563939,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1531499944,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1534272629,"by":{"name":"Jorge Schrauwen","email":"sjorge@blackdot.be","username":"sjorge"}}],"comments":[{"file":"src/vm/node_modules/VM.js","line":3129,"reviewer":{"name":"Jorge Schrauwen","email":"sjorge@blackdot.be","username":"sjorge"},"message":"How will this handle 2x a default gateway when one for IPv4 and one for IPv6?\n\nEdit: looks like IPv6 not working at all anymore! So disregard this I guess?\nOr add a check when routes are pushed and add -inet6 if it\u0027s an IPv6 route."},{"file":"src/vm/node_modules/VM.js","line":3129,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"The destinations won\u0027t be the same -- at minimum you\u0027ll have \u0027a.b.c.d\u0027 and \u0027::ffff:a.b.c.d\u0027.  The check is done as strings (yay js), so they won\u0027t match.  Routes are stored as a hash with the destination as a key (both in the JSON in \u003czoneroot\u003e/config/routes.json and in memory when vmadm is running).  Changing the next hop changes the route.  This change doesn\u0027t alter that, it just points it out to explain the need for adding a \u0027route delete\u0027 and \u0027route add\u0027 command."},{"file":"src/vm/tests/test-routes-lx.js","line":24,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Will this work for LX zones?  I mean, it might, but it might also produce slightly-off-from-illumos output."},{"file":"src/vm/tests/test-routes-lx.js","line":24,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"It\u0027s taken from line 88 of the existing code (I just wrapped the test in a function instead of having it inline), and appears to work from what I can tell."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/Makefile","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"src/vm/node_modules/VM.js","type":"MODIFIED","insertions":267,"deletions":-11},{"file":"src/vm/node_modules/proptable.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"src/vm/tests/test-routes-lx.js","type":"MODIFIED","insertions":70,"deletions":-31}],"sizeInsertions":341,"sizeDeletions":-43},"patchSets":[{"number":"1","revision":"2c9bc5ae0592a56cc85331b7f279aa035d65581f","parents":["6d232f498952cf009c7dbd046d99cf65acf6ef08"],"ref":"refs/changes/67/4467/1","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1530563939,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1531499944,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1534272629,"by":{"name":"Jorge Schrauwen","email":"sjorge@blackdot.be","username":"sjorge"}}],"comments":[{"file":"src/vm/node_modules/VM.js","line":3129,"reviewer":{"name":"Jorge Schrauwen","email":"sjorge@blackdot.be","username":"sjorge"},"message":"How will this handle 2x a default gateway when one for IPv4 and one for IPv6?\n\nEdit: looks like IPv6 not working at all anymore! So disregard this I guess?\nOr add a check when routes are pushed and add -inet6 if it\u0027s an IPv6 route."},{"file":"src/vm/node_modules/VM.js","line":3129,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"The destinations won\u0027t be the same -- at minimum you\u0027ll have \u0027a.b.c.d\u0027 and \u0027::ffff:a.b.c.d\u0027.  The check is done as strings (yay js), so they won\u0027t match.  Routes are stored as a hash with the destination as a key (both in the JSON in \u003czoneroot\u003e/config/routes.json and in memory when vmadm is running).  Changing the next hop changes the route.  This change doesn\u0027t alter that, it just points it out to explain the need for adding a \u0027route delete\u0027 and \u0027route add\u0027 command."},{"file":"src/vm/tests/test-routes-lx.js","line":24,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Will this work for LX zones?  I mean, it might, but it might also produce slightly-off-from-illumos output."},{"file":"src/vm/tests/test-routes-lx.js","line":24,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"It\u0027s taken from line 88 of the existing code (I just wrapped the test in a function instead of having it inline), and appears to work from what I can tell."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/Makefile","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"src/vm/node_modules/VM.js","type":"MODIFIED","insertions":267,"deletions":-11},{"file":"src/vm/node_modules/proptable.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"src/vm/tests/test-routes-lx.js","type":"MODIFIED","insertions":70,"deletions":-31}],"sizeInsertions":341,"sizeDeletions":-43}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Jorge Schrauwen","email":"sjorge@blackdot.be","username":"sjorge"},{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}]}