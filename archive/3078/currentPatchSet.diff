From 1de2a5e7d0789216fa8d05e4189eaea45d60fa18 Mon Sep 17 00:00:00 2001
From: Rui Loura <rui@joyent.com>
Date: Fri, 8 Dec 2017 19:08:44 +0000
Subject: [PATCH] HEAD-2381 fix params.networks formatting of SDC services

---
 config/sapi/services/adminui/service.json   | 13 +++++----
 config/sapi/services/amon/service.json      | 16 +++++++----
 config/sapi/services/amonredis/service.json | 13 +++++----
 config/sapi/services/binder/service.json    | 13 +++++----
 config/sapi/services/ca/service.json        | 13 +++++----
 config/sapi/services/cnapi/service.json     | 13 +++++----
 config/sapi/services/dhcpd/service.json     | 31 +++++++++++----------
 config/sapi/services/fwapi/service.json     | 13 +++++----
 config/sapi/services/imgapi/service.json    | 13 +++++----
 config/sapi/services/mahi/service.json      | 14 ++++++----
 config/sapi/services/manatee/service.json   | 13 +++++----
 config/sapi/services/manta/service.json     | 23 ++++++++++-----
 config/sapi/services/moray/service.json     | 15 ++++++----
 config/sapi/services/napi/service.json      | 13 +++++----
 config/sapi/services/papi/service.json      | 13 +++++----
 config/sapi/services/rabbitmq/service.json  | 13 +++++----
 config/sapi/services/sapi/service.json      | 13 +++++----
 config/sapi/services/sdc/service.json       | 13 +++++----
 config/sapi/services/ufds/service.json      | 13 +++++----
 config/sapi/services/vmapi/service.json     | 13 +++++----
 config/sapi/services/workflow/service.json  | 13 +++++----
 21 files changed, 189 insertions(+), 118 deletions(-)

diff --git a/config/sapi/services/adminui/service.json b/config/sapi/services/adminui/service.json
index 2a1dbe1c..c662013f 100644
--- a/config/sapi/services/adminui/service.json
+++ b/config/sapi/services/adminui/service.json
@@ -5,15 +5,18 @@
         "package_name": "sdc_2048",
         "image_uuid": "IMAGE_UUID",
         "maintain_resolvers": true,
-        "networks": [ "admin" ],
         "tags": {
             "smartdc_role": "adminui",
             "smartdc_type": "core"
-        }
+        },
+        "networks": [
+            {
+                "name": "admin"
+            }
+        ]
     },
     "metadata": {
         "SERVICE_NAME": "adminui"
     },
-    "manifests": {
-    }
-}
+    "manifests": {}
+}
\ No newline at end of file
diff --git a/config/sapi/services/amon/service.json b/config/sapi/services/amon/service.json
index b837b574..d6abd0cf 100644
--- a/config/sapi/services/amon/service.json
+++ b/config/sapi/services/amon/service.json
@@ -5,16 +5,22 @@
         "package_name": "sdc_1024",
         "image_uuid": "IMAGE_UUID",
         "maintain_resolvers": true,
-        "networks": [ "admin", "external" ],
         "firewall_enabled": true,
         "tags": {
             "smartdc_role": "amon",
             "smartdc_type": "core"
-        }
+        },
+        "networks": [
+            {
+                "name": "admin"
+            },
+            {
+                "name": "external"
+            }
+        ]
     },
     "metadata": {
         "SERVICE_NAME": "amon"
     },
-    "manifests": {
-    }
-}
+    "manifests": {}
+}
\ No newline at end of file
diff --git a/config/sapi/services/amonredis/service.json b/config/sapi/services/amonredis/service.json
index 8c1be4e7..210ba4c6 100644
--- a/config/sapi/services/amonredis/service.json
+++ b/config/sapi/services/amonredis/service.json
@@ -6,15 +6,18 @@
         "package_name": "sdc_1024",
         "image_uuid": "IMAGE_UUID",
         "maintain_resolvers": true,
-        "networks": [ "admin" ],
         "tags": {
             "smartdc_role": "amonredis",
             "smartdc_type": "core"
-        }
+        },
+        "networks": [
+            {
+                "name": "admin"
+            }
+        ]
     },
     "metadata": {
         "SERVICE_NAME": "amonredis"
     },
-    "manifests": {
-    }
-}
+    "manifests": {}
+}
\ No newline at end of file
diff --git a/config/sapi/services/binder/service.json b/config/sapi/services/binder/service.json
index 6639f992..f4d37016 100644
--- a/config/sapi/services/binder/service.json
+++ b/config/sapi/services/binder/service.json
@@ -5,7 +5,6 @@
         "package_name": "sdc_1024",
         "image_uuid": "IMAGE_UUID",
         "maintain_resolvers": true,
-        "networks": [ "admin" ],
         "tags": {
             "smartdc_role": "binder",
             "smartdc_type": "core"
@@ -14,11 +13,15 @@
         "resolvers": [],
         "internal_metadata": {
             "set_resolvers": false
-        }
+        },
+        "networks": [
+            {
+                "name": "admin"
+            }
+        ]
     },
     "metadata": {
         "SERVICE_NAME": "binder"
     },
-    "manifests": {
-    }
-}
+    "manifests": {}
+}
\ No newline at end of file
diff --git a/config/sapi/services/ca/service.json b/config/sapi/services/ca/service.json
index 50ae51f4..88765f1e 100644
--- a/config/sapi/services/ca/service.json
+++ b/config/sapi/services/ca/service.json
@@ -6,15 +6,18 @@
         "delegate_dataset": true,
         "image_uuid": "IMAGE_UUID",
         "maintain_resolvers": true,
-        "networks": [ "admin" ],
         "tags": {
             "smartdc_role": "ca",
             "smartdc_type": "core"
-        }
+        },
+        "networks": [
+            {
+                "name": "admin"
+            }
+        ]
     },
     "metadata": {
         "SERVICE_NAME": "ca"
     },
-    "manifests": {
-    }
-}
+    "manifests": {}
+}
\ No newline at end of file
diff --git a/config/sapi/services/cnapi/service.json b/config/sapi/services/cnapi/service.json
index 122e0d9d..051745d8 100644
--- a/config/sapi/services/cnapi/service.json
+++ b/config/sapi/services/cnapi/service.json
@@ -5,15 +5,18 @@
         "package_name": "sdc_1024",
         "image_uuid": "IMAGE_UUID",
         "maintain_resolvers": true,
-        "networks": [ "admin" ],
         "tags": {
             "smartdc_role": "cnapi",
             "smartdc_type": "core"
-        }
+        },
+        "networks": [
+            {
+                "name": "admin"
+            }
+        ]
     },
     "metadata": {
         "SERVICE_NAME": "cnapi"
     },
-    "manifests": {
-    }
-}
+    "manifests": {}
+}
\ No newline at end of file
diff --git a/config/sapi/services/dhcpd/service.json b/config/sapi/services/dhcpd/service.json
index 0e9a300b..d7efc5c7 100644
--- a/config/sapi/services/dhcpd/service.json
+++ b/config/sapi/services/dhcpd/service.json
@@ -5,26 +5,29 @@
         "package_name": "sdc_512",
         "image_uuid": "IMAGE_UUID",
         "maintain_resolvers": true,
-        "networks": [ "admin" ],
         "filesystems": [
-          {
-            "source": "/usbkey/os",
-            "target": "/tftpboot/os",
-            "type": "lofs",
-            "options": [
-              "ro",
-              "nodevices"
-            ]
-          }
+            {
+                "source": "/usbkey/os",
+                "target": "/tftpboot/os",
+                "type": "lofs",
+                "options": [
+                    "ro",
+                    "nodevices"
+                ]
+            }
         ],
         "tags": {
             "smartdc_role": "dhcpd",
             "smartdc_type": "core"
-        }
+        },
+        "networks": [
+            {
+                "name": "admin"
+            }
+        ]
     },
     "metadata": {
         "SERVICE_NAME": "dhcpd"
     },
-    "manifests": {
-    }
-}
+    "manifests": {}
+}
\ No newline at end of file
diff --git a/config/sapi/services/fwapi/service.json b/config/sapi/services/fwapi/service.json
index eb68b483..cf220ff1 100644
--- a/config/sapi/services/fwapi/service.json
+++ b/config/sapi/services/fwapi/service.json
@@ -6,17 +6,20 @@
         "package_name": "sdc_1024",
         "image_uuid": "IMAGE_UUID",
         "maintain_resolvers": true,
-        "networks": [ "admin" ],
         "tags": {
             "smartdc_role": "fwapi",
             "smartdc_type": "core"
-        }
+        },
+        "networks": [
+            {
+                "name": "admin"
+            }
+        ]
     },
     "metadata": {
         "FWRULE_VERSION": 3,
         "SERVICE_NAME": "fwapi",
         "FWAPI_LOG_LEVEL": "info"
     },
-    "manifests": {
-    }
-}
+    "manifests": {}
+}
\ No newline at end of file
diff --git a/config/sapi/services/imgapi/service.json b/config/sapi/services/imgapi/service.json
index 62d0d344..7353abd8 100644
--- a/config/sapi/services/imgapi/service.json
+++ b/config/sapi/services/imgapi/service.json
@@ -6,17 +6,20 @@
         "package_name": "sdc_imgapi",
         "image_uuid": "IMAGE_UUID",
         "maintain_resolvers": true,
-        "networks": [ "admin" ],
         "firewall_enabled": true,
         "tags": {
             "smartdc_role": "imgapi",
             "smartdc_type": "core"
-        }
+        },
+        "networks": [
+            {
+                "name": "admin"
+            }
+        ]
     },
     "metadata": {
         "SERVICE_NAME": "imgapi",
         "STORAGE_MANTA_BASEDIR": "imgapi"
     },
-    "manifests": {
-    }
-}
+    "manifests": {}
+}
\ No newline at end of file
diff --git a/config/sapi/services/mahi/service.json b/config/sapi/services/mahi/service.json
index be88b282..d2f6eadb 100644
--- a/config/sapi/services/mahi/service.json
+++ b/config/sapi/services/mahi/service.json
@@ -6,16 +6,18 @@
         "package_name": "sdc_1024",
         "image_uuid": "IMAGE_UUID",
         "maintain_resolvers": true,
-        "networks": [ "admin" ],
         "tags": {
             "smartdc_role": "mahi",
             "smartdc_type": "core"
-        }
+        },
+        "networks": [
+            {
+                "name": "admin"
+            }
+        ]
     },
     "metadata": {
         "SERVICE_NAME": "mahi"
     },
-    "manifests": {
-    }
-}
-
+    "manifests": {}
+}
\ No newline at end of file
diff --git a/config/sapi/services/manatee/service.json b/config/sapi/services/manatee/service.json
index 11f3c015..56924d90 100644
--- a/config/sapi/services/manatee/service.json
+++ b/config/sapi/services/manatee/service.json
@@ -5,16 +5,19 @@
         "package_name": "sdc_db",
         "image_uuid": "IMAGE_UUID",
         "maintain_resolvers": true,
-        "networks": [ "admin" ],
         "tags": {
             "smartdc_role": "manatee",
             "smartdc_type": "core"
         },
-        "delegate_dataset": true
+        "delegate_dataset": true,
+        "networks": [
+            {
+                "name": "admin"
+            }
+        ]
     },
     "metadata": {
         "SERVICE_NAME": "manatee"
     },
-    "manifests": {
-    }
-}
+    "manifests": {}
+}
\ No newline at end of file
diff --git a/config/sapi/services/manta/service.json b/config/sapi/services/manta/service.json
index 2b7d7e60..ad4e3498 100644
--- a/config/sapi/services/manta/service.json
+++ b/config/sapi/services/manta/service.json
@@ -5,21 +5,30 @@
         "package_name": "sdc_1024",
         "image_uuid": "IMAGE_UUID",
         "maintain_resolvers": true,
-        "networks": [ "admin" ],
         "tags": {
             "smartdc_role": "manta",
             "smartdc_type": "core"
-        }
+        },
+        "networks": [
+            {
+                "name": "admin"
+            }
+        ]
     },
     "metadata": {
         "SERVICE_NAME": "manta",
         "MANTAMON_ALERT": [
-            { "contact": "email", "last": true }
+            {
+                "contact": "email",
+                "last": true
+            }
         ],
         "MANTAMON_INFO": [
-            { "contact": "email", "last": true }
+            {
+                "contact": "email",
+                "last": true
+            }
         ]
     },
-    "manifests": {
-    }
-}
+    "manifests": {}
+}
\ No newline at end of file
diff --git a/config/sapi/services/moray/service.json b/config/sapi/services/moray/service.json
index 62400831..11526db6 100644
--- a/config/sapi/services/moray/service.json
+++ b/config/sapi/services/moray/service.json
@@ -5,17 +5,20 @@
         "package_name": "sdc_8192",
         "image_uuid": "IMAGE_UUID",
         "maintain_resolvers": true,
-        "networks": [ "admin" ],
         "tags": {
             "smartdc_role": "moray",
             "smartdc_type": "core"
         },
-        "delegate_dataset": true
+        "delegate_dataset": true,
+        "networks": [
+            {
+                "name": "admin"
+            }
+        ]
     },
     "metadata": {
-        "SERVICE_NAME" : "moray",
+        "SERVICE_NAME": "moray",
         "MORAY_MAX_PG_CONNS": 15
     },
-    "manifests": {
-    }
-}
+    "manifests": {}
+}
\ No newline at end of file
diff --git a/config/sapi/services/napi/service.json b/config/sapi/services/napi/service.json
index 3ab8225b..db4c5571 100644
--- a/config/sapi/services/napi/service.json
+++ b/config/sapi/services/napi/service.json
@@ -5,16 +5,19 @@
         "package_name": "sdc_256",
         "image_uuid": "IMAGE_UUID",
         "maintain_resolvers": true,
-        "networks": [ "admin" ],
         "tags": {
             "smartdc_role": "napi",
             "smartdc_type": "core"
-        }
+        },
+        "networks": [
+            {
+                "name": "admin"
+            }
+        ]
     },
     "metadata": {
         "SERVICE_NAME": "napi",
         "NAPI_LOG_LEVEL": "info"
     },
-    "manifests": {
-    }
-}
+    "manifests": {}
+}
\ No newline at end of file
diff --git a/config/sapi/services/papi/service.json b/config/sapi/services/papi/service.json
index 7d8600a4..ad3540a6 100644
--- a/config/sapi/services/papi/service.json
+++ b/config/sapi/services/papi/service.json
@@ -5,16 +5,19 @@
         "package_name": "sdc_1024",
         "image_uuid": "IMAGE_UUID",
         "maintain_resolvers": true,
-        "networks": [ "admin" ],
         "tags": {
             "smartdc_role": "papi",
             "smartdc_type": "core"
-        }
+        },
+        "networks": [
+            {
+                "name": "admin"
+            }
+        ]
     },
     "metadata": {
         "SERVICE_NAME": "papi",
         "SERVICE_IS_FIRST_BOOT": true
     },
-    "manifests": {
-    }
-}
+    "manifests": {}
+}
\ No newline at end of file
diff --git a/config/sapi/services/rabbitmq/service.json b/config/sapi/services/rabbitmq/service.json
index 697bad61..fca01a97 100644
--- a/config/sapi/services/rabbitmq/service.json
+++ b/config/sapi/services/rabbitmq/service.json
@@ -5,17 +5,20 @@
         "package_name": "sdc_rabbitmq",
         "image_uuid": "IMAGE_UUID",
         "maintain_resolvers": true,
-        "networks": [ "admin" ],
         "tags": {
             "smartdc_role": "rabbitmq",
             "smartdc_type": "core"
-        }
+        },
+        "networks": [
+            {
+                "name": "admin"
+            }
+        ]
     },
     "metadata": {
         "SERVICE_NAME": "rabbitmq",
         "amqp_user": "guest",
         "amqp_pass": "guest"
     },
-    "manifests": {
-    }
-}
+    "manifests": {}
+}
\ No newline at end of file
diff --git a/config/sapi/services/sapi/service.json b/config/sapi/services/sapi/service.json
index 8d2632c2..83b94074 100644
--- a/config/sapi/services/sapi/service.json
+++ b/config/sapi/services/sapi/service.json
@@ -5,17 +5,20 @@
         "package_name": "sdc_512",
         "image_uuid": "IMAGE_UUID",
         "maintain_resolvers": true,
-        "networks": [ "admin" ],
         "firewall_enabled": true,
         "tags": {
             "smartdc_role": "sapi",
             "smartdc_type": "core"
         },
-        "delegate_dataset": true
+        "delegate_dataset": true,
+        "networks": [
+            {
+                "name": "admin"
+            }
+        ]
     },
     "metadata": {
         "SERVICE_NAME": "sapi"
     },
-    "manifests": {
-    }
-}
+    "manifests": {}
+}
\ No newline at end of file
diff --git a/config/sapi/services/sdc/service.json b/config/sapi/services/sdc/service.json
index 82d11e02..06e878c4 100644
--- a/config/sapi/services/sdc/service.json
+++ b/config/sapi/services/sdc/service.json
@@ -5,16 +5,19 @@
         "package_name": "sdc_1024",
         "image_uuid": "IMAGE_UUID",
         "maintain_resolvers": true,
-        "networks": [ "admin" ],
         "firewall_enabled": true,
         "tags": {
             "smartdc_role": "sdc",
             "smartdc_type": "core"
-        }
+        },
+        "networks": [
+            {
+                "name": "admin"
+            }
+        ]
     },
     "metadata": {
         "SERVICE_NAME": "sdc"
     },
-    "manifests": {
-    }
-}
+    "manifests": {}
+}
\ No newline at end of file
diff --git a/config/sapi/services/ufds/service.json b/config/sapi/services/ufds/service.json
index 4da46a7d..16abf343 100644
--- a/config/sapi/services/ufds/service.json
+++ b/config/sapi/services/ufds/service.json
@@ -5,15 +5,18 @@
         "package_name": "sdc_8192",
         "image_uuid": "IMAGE_UUID",
         "maintain_resolvers": true,
-        "networks": [ "admin" ],
         "tags": {
             "smartdc_role": "ufds",
             "smartdc_type": "core"
-        }
+        },
+        "networks": [
+            {
+                "name": "admin"
+            }
+        ]
     },
     "metadata": {
         "SERVICE_NAME": "ufds"
     },
-    "manifests": {
-    }
-}
+    "manifests": {}
+}
\ No newline at end of file
diff --git a/config/sapi/services/vmapi/service.json b/config/sapi/services/vmapi/service.json
index 9d044cfd..f31459f0 100644
--- a/config/sapi/services/vmapi/service.json
+++ b/config/sapi/services/vmapi/service.json
@@ -5,15 +5,18 @@
         "package_name": "sdc_1024",
         "image_uuid": "IMAGE_UUID",
         "maintain_resolvers": true,
-        "networks": [ "admin" ],
         "tags": {
             "smartdc_role": "vmapi",
             "smartdc_type": "core"
-        }
+        },
+        "networks": [
+            {
+                "name": "admin"
+            }
+        ]
     },
     "metadata": {
         "SERVICE_NAME": "vmapi"
     },
-    "manifests": {
-    }
-}
+    "manifests": {}
+}
\ No newline at end of file
diff --git a/config/sapi/services/workflow/service.json b/config/sapi/services/workflow/service.json
index ebb42889..46a62dfa 100644
--- a/config/sapi/services/workflow/service.json
+++ b/config/sapi/services/workflow/service.json
@@ -5,17 +5,20 @@
         "package_name": "sdc_8192",
         "image_uuid": "IMAGE_UUID",
         "maintain_resolvers": true,
-        "networks": [ "admin" ],
         "tags": {
             "smartdc_role": "workflow",
             "smartdc_type": "core"
-        }
+        },
+        "networks": [
+            {
+                "name": "admin"
+            }
+        ]
     },
     "metadata": {
         "SERVICE_NAME": "workflow",
         "WORKFLOW_NUM_FORKS": 16,
         "WORKFLOW_RUN_INTERVAL": 1000
     },
-    "manifests": {
-    }
-}
+    "manifests": {}
+}
\ No newline at end of file
-- 
2.21.0

