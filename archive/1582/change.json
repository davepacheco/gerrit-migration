{"project":"joyent/illumos-joyent","branch":"master","id":"I063d109defb67c6ac44d3d10be780fb363def7ea","number":"1582","subject":"OS-5973 simplify lx user-level nfs mount library usage Reviewed by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e Reviewed by: Ryan Zezeski \u003cryan.zeseski@joyent.com\u003e Approved by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e","owner":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"url":"https://cr.joyent.us/1582","commitMessage":"OS-5973 simplify lx user-level nfs mount library usage\nReviewed by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e\nReviewed by: Ryan Zezeski \u003cryan.zeseski@joyent.com\u003e\nApproved by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e\n","createdOn":1488228558,"lastUpdated":1489161489,"open":false,"status":"MERGED","comments":[{"timestamp":1488228558,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 1."},{"timestamp":1489016327,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Patch Set 1:\n\n(4 comments)"},{"timestamp":1489064394,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 2."},{"timestamp":1489064445,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1489089163,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 2:\n\n(3 comments)"},{"timestamp":1489090981,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 1:\n\n(3 comments)"},{"timestamp":1489090993,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 3."},{"timestamp":1489092966,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1489099496,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1489161166,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 3: Integration-Approval+1"},{"timestamp":1489161360,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 4: Patch Set 3 was rebased."},{"timestamp":1489161421,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 5: Commit message was updated."},{"timestamp":1489161489,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Jerry Jelinek"}],"currentPatchSet":{"number":"5","revision":"063d109defb67c6ac44d3d10be780fb363def7ea","parents":["499124bb17089766132b0ec75cc3988292cd9388"],"ref":"refs/changes/82/1582/5","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1489161421,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1489092966,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1489099496,"by":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1489161166,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"SUBM","value":"1","grantedOn":1489161489,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/lib/brand/lx/lx_brand/common/mount_nfs.c","type":"MODIFIED","insertions":225,"deletions":-1284},{"file":"usr/src/lib/libnsl/common/mapfile-vers","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"usr/src/lib/libnsl/netselect/netselect.c","type":"MODIFIED","insertions":26,"deletions":-54},{"file":"usr/src/uts/common/sys/netconfig.h","type":"MODIFIED","insertions":0,"deletions":-2}],"sizeInsertions":251,"sizeDeletions":-1341},"patchSets":[{"number":"1","revision":"bc132474dd68eb69c30b692714316c4ec262894e","parents":["f7b7abfa6104a9c74789db9692c2fc269644b2eb"],"ref":"refs/changes/82/1582/1","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1488228558,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/lib/brand/lx/lx_brand/common/mount_nfs.c","line":37,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"s/in/on/"},{"file":"usr/src/lib/brand/lx/lx_brand/common/mount_nfs.c","line":578,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Since we now also ignore fg and bg I would add a comment like you did for OPT_RETRY. Or perhaps we should even remove all three cases since these options should never make it to this point."},{"file":"usr/src/lib/brand/lx/lx_brand/common/mount_nfs.c","line":775,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Should this be -ENOMEM?"},{"file":"usr/src/lib/brand/lx/lx_brand/common/mount_nfs.c","line":961,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"In the previous code is authsys_create_default() returned NULL then we call get_fh_cleanup() with positive EAGAIN -- here we call it with negative. Just want to verify you meant to make this change."},{"file":"usr/src/lib/brand/lx/lx_brand/common/mount_nfs.c","line":961,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Yes, since we want to always return an error on the syscall and not retry internally."},{"file":"usr/src/lib/libnsl/netselect/netselect.c","line":317,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Nix the tabs from this comment while we\u0027re in here?"},{"file":"usr/src/lib/libnsl/netselect/netselect.c","line":317,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"This seems to be the standard comment style throughout this file. Since I didn\u0027t format that comment to begin with (just indented), now that I am reverting the old changes I made here, I think it is cleaner to just leave this as it was before I touched the file."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/brand/lx/lx_brand/common/mount_nfs.c","type":"MODIFIED","insertions":224,"deletions":-1280},{"file":"usr/src/lib/libnsl/common/mapfile-vers","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"usr/src/lib/libnsl/netselect/netselect.c","type":"MODIFIED","insertions":26,"deletions":-54},{"file":"usr/src/uts/common/sys/netconfig.h","type":"MODIFIED","insertions":0,"deletions":-2}],"sizeInsertions":250,"sizeDeletions":-1337},{"number":"2","revision":"0a35d6c89accd41e47f61c52514f8e21e61c02e7","parents":["809a8d4f611808acb08179b48aac390aa77a9390"],"ref":"refs/changes/82/1582/2","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1489064394,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/lib/brand/lx/lx_brand/common/mount_nfs.c","line":854,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Why even emit the outvers if it\u0027s a straight assignment from nmd_mnt_vers?  The later assertions don\u0027t seem to make a lot of sense in that context."},{"file":"usr/src/lib/brand/lx/lx_brand/common/mount_nfs.c","line":854,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Good point, that is more legacy stuff that is really unnecessary now but that I missed removing. I cleaned that up."},{"file":"usr/src/lib/brand/lx/lx_brand/common/mount_nfs.c","line":957,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Useful when outvers is a direct assignment from nmd_mnt_vers?"},{"file":"usr/src/lib/brand/lx/lx_brand/common/mount_nfs.c","line":957,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"removed as per previous comment"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/brand/lx/lx_brand/common/mount_nfs.c","type":"MODIFIED","insertions":226,"deletions":-1283},{"file":"usr/src/lib/libnsl/common/mapfile-vers","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"usr/src/lib/libnsl/netselect/netselect.c","type":"MODIFIED","insertions":26,"deletions":-54},{"file":"usr/src/uts/common/sys/netconfig.h","type":"MODIFIED","insertions":0,"deletions":-2}],"sizeInsertions":252,"sizeDeletions":-1340},{"number":"3","revision":"caea9f8b39e39eec32a56cac43585329fa2eea28","parents":["809a8d4f611808acb08179b48aac390aa77a9390"],"ref":"refs/changes/82/1582/3","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1489090993,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1489092966,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1489161166,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1489099496,"by":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/brand/lx/lx_brand/common/mount_nfs.c","type":"MODIFIED","insertions":225,"deletions":-1284},{"file":"usr/src/lib/libnsl/common/mapfile-vers","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"usr/src/lib/libnsl/netselect/netselect.c","type":"MODIFIED","insertions":26,"deletions":-54},{"file":"usr/src/uts/common/sys/netconfig.h","type":"MODIFIED","insertions":0,"deletions":-2}],"sizeInsertions":251,"sizeDeletions":-1341},{"number":"4","revision":"cc76c623d9d6bc8b79982b2fd14901d563626332","parents":["499124bb17089766132b0ec75cc3988292cd9388"],"ref":"refs/changes/82/1582/4","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1489161360,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1489092966,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1489161166,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1489099496,"by":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/brand/lx/lx_brand/common/mount_nfs.c","type":"MODIFIED","insertions":225,"deletions":-1284},{"file":"usr/src/lib/libnsl/common/mapfile-vers","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"usr/src/lib/libnsl/netselect/netselect.c","type":"MODIFIED","insertions":26,"deletions":-54},{"file":"usr/src/uts/common/sys/netconfig.h","type":"MODIFIED","insertions":0,"deletions":-2}],"sizeInsertions":251,"sizeDeletions":-1341},{"number":"5","revision":"063d109defb67c6ac44d3d10be780fb363def7ea","parents":["499124bb17089766132b0ec75cc3988292cd9388"],"ref":"refs/changes/82/1582/5","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1489161421,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"SUBM","value":"1","grantedOn":1489161489,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1489092966,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1489161166,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1489099496,"by":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/lib/brand/lx/lx_brand/common/mount_nfs.c","type":"MODIFIED","insertions":225,"deletions":-1284},{"file":"usr/src/lib/libnsl/common/mapfile-vers","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"usr/src/lib/libnsl/netselect/netselect.c","type":"MODIFIED","insertions":26,"deletions":-54},{"file":"usr/src/uts/common/sys/netconfig.h","type":"MODIFIED","insertions":0,"deletions":-2}],"sizeInsertions":251,"sizeDeletions":-1341}],"allReviewers":[{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}]}