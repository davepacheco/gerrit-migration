{"project":"joyent/sdc-docker","branch":"master","id":"If7c6e29c3ea474007f6c9b54967017156a1d05c4","number":"1600","subject":"DOCKER-1005 want separate keys for docker and cloudapi (signed certificates) Reviewed by: Trent Mick \u003ctrent.mick@joyent.com\u003e Approved by: Cody Peter Mello \u003ccody.mello@joyent.com\u003e","owner":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"url":"https://cr.joyent.us/1600","commitMessage":"DOCKER-1005 want separate keys for docker and cloudapi (signed certificates)\nReviewed by: Trent Mick \u003ctrent.mick@joyent.com\u003e\nApproved by: Cody Peter Mello \u003ccody.mello@joyent.com\u003e\n","createdOn":1488423896,"lastUpdated":1489101206,"open":false,"status":"MERGED","comments":[{"timestamp":1488423896,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 1."},{"timestamp":1488423926,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1488501928,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 1:\n\n(3 comments)\n\nAlex,\n\nDid you also have starter node-triton changes so I\u0027d be able to test sdc-docker with a `triton`-generated cert?\n\nI assume we\u0027ll want to sit on the `triton` change until we have this change in sdc-docker deployed."},{"timestamp":1488504153,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 1:\n\n(3 comments)\n\nI\u0027ve been testing just by generating the cert by hand (see https://gist.github.com/arekinath/d09653a7d035a026427245300f532710 for an example of how to do it), but yes, this will have to be added to node-triton, and we\u0027ll probably want to sit on it until it\u0027s been in sdc-docker for a while."},{"timestamp":1488584773,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 2."},{"timestamp":1488584814,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing-1\n\n(3 comments)\n\n\"make check\" exited with status 2"},{"timestamp":1488827931,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 3."},{"timestamp":1488827966,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1488847730,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 3: Code-Review+1\n\n(1 comment)"},{"timestamp":1489100757,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 3: Integration-Approval+1"},{"timestamp":1489101044,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 4: Patch Set 3 was rebased"},{"timestamp":1489101066,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 5: Commit message was updated."},{"timestamp":1489101129,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Alex Wilson"},{"timestamp":1489101206,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4:\n\n\"make check\" passed ok"}],"currentPatchSet":{"number":"5","revision":"6f2621b5a9d01a3fc4f11f9ab459e1b3d1c625f3","parents":["f65c8db0a1b251b3c4bff37e14c9d90a4ffa77de"],"ref":"refs/changes/00/1600/5","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1489101066,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1488827966,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1488847730,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1489100757,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"SUBM","value":"1","grantedOn":1489101129,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/auth.js","type":"MODIFIED","insertions":50,"deletions":-5},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":51,"sizeDeletions":-6},"patchSets":[{"number":"1","revision":"14b3277d21c50ceffd798d2344b79bbd7cb5a969","parents":["b63d4199f88e2b66896a053d6e1ac0b6442551bc"],"ref":"refs/changes/00/1600/1","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1488423896,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1488423926,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/auth.js","line":76,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Probably would prefer \u0027tritonDocker\u0027 now."},{"file":"lib/auth.js","line":76,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"This name is already committed in sshpk and the Joyent OID repository, sorry. I guess we can probably rename it, but it\u0027s a bit messy. It\u0027s 1.3.6.1.4.1.38678.1.4.1 { iso(1) identified-organization(3) dod(6) internet(1) private(4) enterprise(1) joyent(38678) ldap-x509(1) keyPurposes(4) joyentDocker(1) }"},{"file":"lib/auth.js","line":76,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Ah, that\u0027s cool. Not worth changing, given the OID is commited."},{"file":"lib/auth.js","line":79,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Would it be possible to include an error message here that the cert is expired? *Assuming* that error message makes it back through the docker CLI, that would be very useful to the end user."},{"file":"lib/auth.js","line":79,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Yeah I don\u0027t think there\u0027s any problem with passing this fact back to the user explicitly. I\u0027ll adjust this."},{"file":"lib/auth.js","line":86,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"if the alg is not md5... should we still be using the lookupFp from above? or should we `next(new-err)`?"},{"file":"lib/auth.js","line":86,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"I thought about this... and I guess it\u0027s probably better to fail here. The cert isn\u0027t self-signed, and we failed to understand the issuer, so we\u0027re not going to be able to find the key..."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/auth.js","type":"MODIFIED","insertions":34,"deletions":-5},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":35,"sizeDeletions":-6},{"number":"2","revision":"a17e1fbf81469215f7205f4eed7d18b65bc76adb","parents":["b63d4199f88e2b66896a053d6e1ac0b6442551bc"],"ref":"refs/changes/00/1600/2","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1488584773,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1488584814,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/auth.js","line":77,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"improper continuation"},{"file":"lib/auth.js","line":104,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"improper continuation"},{"file":"lib/auth.js","line":105,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"improper continuation"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/auth.js","type":"MODIFIED","insertions":51,"deletions":-5},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":52,"sizeDeletions":-6},{"number":"3","revision":"f7c6e29c3ea474007f6c9b54967017156a1d05c4","parents":["b63d4199f88e2b66896a053d6e1ac0b6442551bc"],"ref":"refs/changes/00/1600/3","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1488827931,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1489100757,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1488827966,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1488847730,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/auth.js","type":"MODIFIED","insertions":50,"deletions":-5},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":51,"sizeDeletions":-6},{"number":"4","revision":"4a745d02620ee7100123f50b9ca684bc6add6cd3","parents":["f65c8db0a1b251b3c4bff37e14c9d90a4ffa77de"],"ref":"refs/changes/00/1600/4","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1489101044,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1489100757,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1488827966,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1488847730,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/auth.js","type":"MODIFIED","insertions":50,"deletions":-5},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":51,"sizeDeletions":-6},{"number":"5","revision":"6f2621b5a9d01a3fc4f11f9ab459e1b3d1c625f3","parents":["f65c8db0a1b251b3c4bff37e14c9d90a4ffa77de"],"ref":"refs/changes/00/1600/5","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1489101066,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1489100757,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"SUBM","value":"1","grantedOn":1489101129,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1488827966,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1488847730,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/auth.js","type":"MODIFIED","insertions":50,"deletions":-5},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":51,"sizeDeletions":-6}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}]}