From 9f6a5eadcd9c6625f78ce676bda723763923f7fa Mon Sep 17 00:00:00 2001
From: Andrey Yatskov <andrey.yatskov@silvertreesystems.com>
Date: Wed, 13 Sep 2017 18:44:18 +0300
Subject: [PATCH] ADMINUI-2367 AdminUI has trouble talking to UFDS master after
 network partition

---
 lib/ufds.js | 7 ++++++-
 1 file changed, 6 insertions(+), 1 deletion(-)

diff --git a/lib/ufds.js b/lib/ufds.js
index 9c20ba4b..62f2a754 100644
--- a/lib/ufds.js
+++ b/lib/ufds.js
@@ -39,10 +39,15 @@ module.exports = {
 
         ufds.on('timeout', function (msg) {
             log.warn({message: msg}, 'UFDS client timeout (recycling)');
-            ufds.close();
         });
 
+        var connectTimout = setTimeout(function () {
+            log.error('Connecting to UFDS failed ', config.url);
+            reconnect();
+        }, config.connectTimeout);
+
         ufds.once('connect', function () {
+            clearTimeout(connectTimout);
             log.info('Connected to UFDS: ', config.url);
             ufds.removeAllListeners('error');
 
-- 
2.21.0

