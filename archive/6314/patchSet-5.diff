From ef79c2b2a11b539c4d46a1a0a54c4f31a887cfad Mon Sep 17 00:00:00 2001
From: Pedro Palazon Candel <pedro@joyent.com>
Date: Tue, 28 May 2019 17:57:47 +0200
Subject: [PATCH] TRITON-1326 adminui needs support for cloud firewall logging
 Reviewed by: Mike Gerdts <mike.gerdts@joyent.com> Approved by: Mike Gerdts
 <mike.gerdts@joyent.com>

---
 www/js/components/pages/vm/fwrules-form.hbs | 14 +++++++++++++-
 www/js/components/pages/vm/fwrules-form.js  |  9 +++++----
 2 files changed, 18 insertions(+), 5 deletions(-)

diff --git a/www/js/components/pages/vm/fwrules-form.hbs b/www/js/components/pages/vm/fwrules-form.hbs
index 05ab7b3a..2d935c31 100644
--- a/www/js/components/pages/vm/fwrules-form.hbs
+++ b/www/js/components/pages/vm/fwrules-form.hbs
@@ -5,7 +5,7 @@
 -->
 
 <!--
-    Copyright (c) 2014, Joyent, Inc.
+    Copyright 2019 Joyent, Inc.
 -->
 
 {{#if uuid}}
@@ -66,6 +66,18 @@
             </div>
         </div>
     </div>
+
+
+    <div class="form-group">
+        <div class="col-sm-12">
+            <div class="checkbox">
+                <label>
+                    <input type="checkbox" name="log" value="true"> Log connections matching this rule
+                </label>
+            </div>
+        </div>
+    </div>
+
     <div class="form-group">
         <div class="col-sm-12">
             <button type="submit" class="btn btn-info"><i class="fa fa-floppy-o"></i> Save</i></button>
diff --git a/www/js/components/pages/vm/fwrules-form.js b/www/js/components/pages/vm/fwrules-form.js
index 73fa7a05..c3a1476c 100644
--- a/www/js/components/pages/vm/fwrules-form.js
+++ b/www/js/components/pages/vm/fwrules-form.js
@@ -5,7 +5,7 @@
  */
 
 /*
- * Copyright (c) 2016, Joyent, Inc.
+ * Copyright 2019 Joyent, Inc.
  */
 
 var Backbone = require('backbone');
@@ -46,7 +46,7 @@ var FWRulesForm = Backbone.Marionette.ItemView.extend({
         }
         if (this.model.isNew()) {
             if (options.vm) {
-                this.model.set({rule: 'FROM any TO vm '+options.vm.get('uuid') + ' ALLOW '});
+                this.model.set({rule: 'FROM any TO vm ' + options.vm.get('uuid') + ' ALLOW '});
             } else if (options.user) {
                 this.model.set({rule: 'FROM any TO all vms ALLOW '});
             }
@@ -66,7 +66,7 @@ var FWRulesForm = Backbone.Marionette.ItemView.extend({
         var errors = xhr.responseData.errors;
         if (xhr.responseData.errors) {
             var messages = _.pluck(errors, 'message');
-            window.alert("Error Saving Firewall Rule \n" + messages.join("\n"));
+            window.alert('Error Saving Firewall Rule \n' + messages.join('\n'));
         }
     },
 
@@ -106,7 +106,7 @@ var FWRulesForm = Backbone.Marionette.ItemView.extend({
     onSync: function () {
         adminui.vent.trigger('notification', {
             level: 'success',
-            message: "Firewall rule saved successfully."
+            message: 'Firewall rule saved successfully.'
         });
 
         this.trigger('rule:saved');
@@ -127,6 +127,7 @@ var FWRulesForm = Backbone.Marionette.ItemView.extend({
         this.model.set({
             global: data.global,
             enabled: data.enabled,
+            log: data.log,
             rule: rule,
             owner_uuid: data.owner_uuid
         });
-- 
2.21.0

