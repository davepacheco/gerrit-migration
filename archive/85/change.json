{"project":"joyent/sdcadm","branch":"master","id":"Ib6a75087b6602152fc900399e87153eba79995b0","number":"85","subject":"TOOLS-1429 sdcadm update-gz-tools /path/to/file does not work Reviewed by: Joshua M. Clulow \u003cjmc@joyent.com\u003e","owner":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"url":"https://cr.joyent.us/85","commitMessage":"TOOLS-1429 sdcadm update-gz-tools /path/to/file does not work\nReviewed by: Joshua M. Clulow \u003cjmc@joyent.com\u003e\n","createdOn":1468573588,"lastUpdated":1469100866,"open":false,"status":"MERGED","comments":[{"timestamp":1468573588,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 1."},{"timestamp":1468573996,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 1:\n\nI already tested this change while testing TOOLS-1336, anyway, apart of the obvious fix to the sdcadm code itself, I added some test improvements.\n\nNote that so far, we\u0027re relying into stderr to be empty on most test cases, given I don\u0027t think it\u0027s a good idea to make tests rely into whatever the wording we\u0027ve selected for stdout, since that can easily change and break them. Anyway, having no stderr is a good starting point. I\u0027m making tests printing stdout so we can have that available for later inspection."},{"timestamp":1468622762,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Patch Set 1:\n\n(7 comments)"},{"timestamp":1468840445,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 2."},{"timestamp":1469001621,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 1:\n\n(7 comments)"},{"timestamp":1469086577,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Patch Set 2: Code-Review+1 Integration-Approval+1\n\n(1 comment)\n\nAlright, I think this one is ready to put back.  Thanks."},{"timestamp":1469100866,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Pedro Palazón Candel"}],"currentPatchSet":{"number":"2","revision":"b6a75087b6602152fc900399e87153eba79995b0","parents":["0b6367a90e59810500faa0352f44d28f9f9fb6fb"],"ref":"refs/changes/85/85/2","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1468840445,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1469086577,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1469086577,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}},{"type":"SUBM","value":"1","grantedOn":1469100866,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"lib/sdcadm.js","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"test/update-gz-tools.test.js","type":"MODIFIED","insertions":38,"deletions":-7}],"sizeInsertions":43,"sizeDeletions":-9},"patchSets":[{"number":"1","revision":"e06f27a7958be7ac0fc0a3980c1d0020bff12682","parents":["0b6367a90e59810500faa0352f44d28f9f9fb6fb"],"ref":"refs/changes/85/85/1","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1468573588,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","comments":[{"file":"lib/sdcadm.js","line":2412,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Should \"forceReinstall\" really override the image name check?  It feels like that\u0027s never the right thing to do.\n\nIf it _is_ sometimes the right thing to do, this should probably just be \"forceReinstall\", given that we lift it out into a variable on L1994."},{"file":"lib/sdcadm.js","line":2412,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done. Well, you\u0027re right: given it never worked b/c of the wrong \"force\" option, I don\u0027t think we\u0027re breaking compatibility with anything by completely disallowing the usage of an image with a name not being \"gz-tools\". Removing that. Thanks!"},{"file":"test/update-gz-tools.test.js","line":19,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"What happens when your system already _has_ the latest \"gz-tools\" package installed?  Does this test still work correctly?  Or should we be asserting that the current and the latest are not the same?"},{"file":"test/update-gz-tools.test.js","line":19,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Yes, the tests would still work correctly. The main idea behind this test suite is to be able to test as much as possible trying to left the system as close as possible to its initial state (indeed, the goal for TOOLS-1469 is to try to move toward that goal). The only thing which will happen if we have both versions being the same is that we\u0027re being redundant in what we install on each test and, now that you mention, that we could probably skip the test where we\u0027re reinstalling original image to left the system as we found it."},{"file":"test/update-gz-tools.test.js","line":27,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Superfluous \"return\"."},{"file":"test/update-gz-tools.test.js","line":27,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"test/update-gz-tools.test.js","line":33,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"You should either do something with the \"err\" parameter here, or remove it from \"getGzToolsVersion()\"."},{"file":"test/update-gz-tools.test.js","line":33,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"test/update-gz-tools.test.js","line":54,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Handle the elided \"err\".  A few more of these down below, too."},{"file":"test/update-gz-tools.test.js","line":54,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"test/update-gz-tools.test.js","line":55,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"These should probably be t.strictEqual(), i.e. the equivalent of \"\u003d\u003d\u003d\" rather than \"\u003d\u003d\"."},{"file":"test/update-gz-tools.test.js","line":55,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"In the case of tape, t.equal() means strict equality: https://github.com/substack/tape#tequalactual-expected-msg"},{"file":"test/update-gz-tools.test.js","line":55,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Ah!  Well, that\u0027s somewhat confusing.  Thanks for pointing it out."},{"file":"test/update-gz-tools.test.js","line":106,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Comparisons to the empty string should _definitely_ be strictEquals.  See, for example:\n\n  \u003e stderr \u003d \u0027\u0027\n  \u0027\u0027\n  \u003e stderr \u003d\u003d false\n  true\n  \u003e stderr \u003d\u003d 0\n  true"},{"file":"test/update-gz-tools.test.js","line":106,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"As mentioned above, tape only knows about strict equality, always using \"\u003d\u003d\u003d\""}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/sdcadm.js","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"test/update-gz-tools.test.js","type":"MODIFIED","insertions":35,"deletions":-6}],"sizeInsertions":40,"sizeDeletions":-8},{"number":"2","revision":"b6a75087b6602152fc900399e87153eba79995b0","parents":["0b6367a90e59810500faa0352f44d28f9f9fb6fb"],"ref":"refs/changes/85/85/2","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1468840445,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1469086577,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1469086577,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}},{"type":"SUBM","value":"1","grantedOn":1469100866,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"lib/sdcadm.js","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"test/update-gz-tools.test.js","type":"MODIFIED","insertions":38,"deletions":-7}],"sizeInsertions":43,"sizeDeletions":-9}],"allReviewers":[{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}]}