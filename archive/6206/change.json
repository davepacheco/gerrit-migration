{"project":"joyent/manta-garbage-collector","branch":"master","id":"Id9384f0fdc5ffc1f32939c2915c2cd080b929b7c","number":"6206","subject":"MANTA-4252 Accelerated garbage collection should index manta_fastdelete_queue offset by shard Reviewed by: Josh Wilsdon \u003cjosh@wilsdon.ca\u003e Approved by: Richard Kiene \u003crichard.kiene@joyent.com\u003e Approved by: Josh Wilsdon \u003cjosh@wilsdon.ca\u003e","owner":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"url":"https://cr.joyent.us/6206","commitMessage":"MANTA-4252 Accelerated garbage collection should index manta_fastdelete_queue offset by shard\nReviewed by: Josh Wilsdon \u003cjosh@wilsdon.ca\u003e\nApproved by: Richard Kiene \u003crichard.kiene@joyent.com\u003e\nApproved by: Josh Wilsdon \u003cjosh@wilsdon.ca\u003e\n","createdOn":1557259172,"lastUpdated":1557278427,"open":false,"status":"MERGED","comments":[{"timestamp":1557259172,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Uploaded patch set 1."},{"timestamp":1557259201,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1557259684,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Uploaded patch set 2."},{"timestamp":1557259713,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1557259937,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Uploaded patch set 3."},{"timestamp":1557259966,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing-1\n\n(1 comment)\n\n\"make check\" exited with status 2"},{"timestamp":1557260108,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Uploaded patch set 4."},{"timestamp":1557260143,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing-1\n\n(1 comment)\n\n\"make check\" exited with status 2"},{"timestamp":1557260180,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Uploaded patch set 5."},{"timestamp":1557260209,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1557264393,"reviewer":{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"},"message":"Patch Set 5: Code-Review+1\n\n(1 comment)"},{"timestamp":1557266904,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Uploaded patch set 6."},{"timestamp":1557266938,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 6: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1557267858,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 5:\n\n(2 comments)"},{"timestamp":1557268613,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Patch Set 6:\n\n(1 comment)"},{"timestamp":1557270846,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Uploaded patch set 7."},{"timestamp":1557270892,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 7: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1557273126,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 7: Code-Review+1 Integration-Approval+1\n\nlgtm!"},{"timestamp":1557273398,"reviewer":{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"},"message":"Patch Set 7: Integration-Approval+1"},{"timestamp":1557278392,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Uploaded patch set 8: Commit message was updated."},{"timestamp":1557278427,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Robert Bogart"}],"currentPatchSet":{"number":"8","revision":"d9384f0fdc5ffc1f32939c2915c2cd080b929b7c","parents":["30fef8826452a28d4bcdaff529c3570b13ab280d"],"ref":"refs/changes/06/6206/8","uploader":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"createdOn":1557278392,"author":{"name":"Robert Bogart","email":"robert.bogart@joyent.com","username":""},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1557270892,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1557273126,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1557273126,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1557273398,"by":{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"}},{"type":"SUBM","value":"1","grantedOn":1557278426,"by":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"lib/moray_delete_record_cleaner.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/moray_delete_record_reader.js","type":"MODIFIED","insertions":42,"deletions":-28}],"sizeInsertions":43,"sizeDeletions":-29},"patchSets":[{"number":"1","revision":"196cb64c0a2ed6dadfd9b151f53bccf2e82bad49","parents":["30fef8826452a28d4bcdaff529c3570b13ab280d"],"ref":"refs/changes/06/6206/1","uploader":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"createdOn":1557259172,"author":{"name":"Robert Bogart","email":"robert.bogart@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1557259201,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/moray_delete_record_cleaner.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/moray_delete_record_reader.js","type":"MODIFIED","insertions":49,"deletions":-23}],"sizeInsertions":50,"sizeDeletions":-24},{"number":"2","revision":"9c6cc58fdc9c3af31769c8d6ba8e987081483653","parents":["30fef8826452a28d4bcdaff529c3570b13ab280d"],"ref":"refs/changes/06/6206/2","uploader":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"createdOn":1557259684,"author":{"name":"Robert Bogart","email":"robert.bogart@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1557259713,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/moray_delete_record_cleaner.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/moray_delete_record_reader.js","type":"MODIFIED","insertions":49,"deletions":-22}],"sizeInsertions":50,"sizeDeletions":-23},{"number":"3","revision":"108a251a39b04804b5a1a887abbf73a3626c7e4c","parents":["30fef8826452a28d4bcdaff529c3570b13ab280d"],"ref":"refs/changes/06/6206/3","uploader":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"createdOn":1557259937,"author":{"name":"Robert Bogart","email":"robert.bogart@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1557259966,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/moray_delete_record_reader.js","line":161,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"space or tab at end of line"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/moray_delete_record_cleaner.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/moray_delete_record_reader.js","type":"MODIFIED","insertions":48,"deletions":-22}],"sizeInsertions":49,"sizeDeletions":-23},{"number":"4","revision":"9e6a106bd5dc7a8b2f2b37937dbe46a82ba36a4d","parents":["30fef8826452a28d4bcdaff529c3570b13ab280d"],"ref":"refs/changes/06/6206/4","uploader":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"createdOn":1557260108,"author":{"name":"Robert Bogart","email":"robert.bogart@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1557260143,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/moray_delete_record_reader.js","line":162,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"space or tab at end of line"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/moray_delete_record_cleaner.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/moray_delete_record_reader.js","type":"MODIFIED","insertions":49,"deletions":-22}],"sizeInsertions":50,"sizeDeletions":-23},{"number":"5","revision":"69a7e94497cc313852a1020d572e1dcb79c4b7e8","parents":["30fef8826452a28d4bcdaff529c3570b13ab280d"],"ref":"refs/changes/06/6206/5","uploader":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"createdOn":1557260180,"author":{"name":"Robert Bogart","email":"robert.bogart@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1557260209,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1557264393,"by":{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"}}],"comments":[{"file":"lib/moray_delete_record_reader.js","line":132,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"I think this function name is confusing now. We\u0027re not really talking about a bucket at all. It\u0027s really just about the shard\u0027s read offset. If we\u0027re going to return an object at all, perhaps something like \u0027get_shard_state()\u0027?"},{"file":"lib/moray_delete_record_reader.js","line":138,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Since we\u0027re only ever looking at the moray_fastdelete_queue bucket, I wonder if it makes sense to loop through this config at all?\n\nI\u0027d almost replace all of the stuff from 134-150 with an assert that buckets[0].name \u003d\u003d\u003d self.mr_bucket."},{"file":"lib/moray_delete_record_reader.js","line":138,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"If we do that, then it seems like `buckets\u0027  shouldn\u0027t really be an array...?"},{"file":"lib/moray_delete_record_reader.js","line":154,"reviewer":{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"},"message":"several?"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/moray_delete_record_cleaner.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/moray_delete_record_reader.js","type":"MODIFIED","insertions":49,"deletions":-22}],"sizeInsertions":50,"sizeDeletions":-23},{"number":"6","revision":"67de225f3eda45349ebf3272fce8e0c94830adbf","parents":["30fef8826452a28d4bcdaff529c3570b13ab280d"],"ref":"refs/changes/06/6206/6","uploader":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"createdOn":1557266904,"author":{"name":"Robert Bogart","email":"robert.bogart@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1557266938,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/moray_delete_record_cleaner.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/moray_delete_record_reader.js","type":"MODIFIED","insertions":49,"deletions":-22}],"sizeInsertions":50,"sizeDeletions":-23},{"number":"7","revision":"6663a84826cf6c0496134e7895dff98b98000304","parents":["30fef8826452a28d4bcdaff529c3570b13ab280d"],"ref":"refs/changes/06/6206/7","uploader":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"createdOn":1557270846,"author":{"name":"Robert Bogart","email":"robert.bogart@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1557270892,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1557273398,"by":{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1557273126,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1557273126,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/moray_delete_record_cleaner.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/moray_delete_record_reader.js","type":"MODIFIED","insertions":42,"deletions":-28}],"sizeInsertions":43,"sizeDeletions":-29},{"number":"8","revision":"d9384f0fdc5ffc1f32939c2915c2cd080b929b7c","parents":["30fef8826452a28d4bcdaff529c3570b13ab280d"],"ref":"refs/changes/06/6206/8","uploader":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"createdOn":1557278392,"author":{"name":"Robert Bogart","email":"robert.bogart@joyent.com","username":""},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1557270892,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1557273398,"by":{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1557273126,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1557273126,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"SUBM","value":"1","grantedOn":1557278426,"by":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"lib/moray_delete_record_cleaner.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/moray_delete_record_reader.js","type":"MODIFIED","insertions":42,"deletions":-28}],"sizeInsertions":43,"sizeDeletions":-29}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"},{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"}]}