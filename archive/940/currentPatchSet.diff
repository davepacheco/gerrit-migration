From fd05b77b28753e1f466e0649a3fd271ceba2e17c Mon Sep 17 00:00:00 2001
From: David Pacheco <dap@joyent.com>
Date: Tue, 22 Nov 2016 14:56:57 -0800
Subject: [PATCH] joyent/node-manta#288 mfind of file blows assertion: "ent
 (object) is required"

---
 CHANGES.md         | 2 +-
 lib/client.js      | 2 +-
 test/mfind.test.js | 9 +++++++++
 3 files changed, 11 insertions(+), 2 deletions(-)

diff --git a/CHANGES.md b/CHANGES.md
index 49c0e2b..7ad48c6 100644
--- a/CHANGES.md
+++ b/CHANGES.md
@@ -2,7 +2,7 @@
 
 ## not yet released
 
-(nothing yet)
+- joyent/node-manta#288 mfind of file blows assertion: "ent (object) is required"
 
 ## 4.0.0
 
diff --git a/lib/client.js b/lib/client.js
index 4fe45e2..c13be29 100644
--- a/lib/client.js
+++ b/lib/client.js
@@ -88,7 +88,7 @@ function InvalidDirectoryError(dir, ent) {
     Error.call(this);
 
     assert.string(dir, 'dir');
-    assert.object(ent, 'ent');
+    assert.optionalObject(ent, 'ent');
 
     this.name = 'InvalidDirectoryError';
     this.message = dir + ' is an invalid manta directory';
diff --git a/test/mfind.test.js b/test/mfind.test.js
index c54fbb9..f5e2f4c 100644
--- a/test/mfind.test.js
+++ b/test/mfind.test.js
@@ -135,6 +135,15 @@ test('mfind -j TESTDIR', function (t) {
     });
 });
 
+test('mfind TESTDIR/afile.txt', function (t) {
+    forkExecWait({
+        argv: [MFIND, TESTDIR + '/afile.txt']
+    }, function (err, info) {
+        t.ifError(err, err);
+        t.ok(/afile.txt$/m.test(info.stdout), 'afile.txt in stdout');
+        t.done();
+    });
+});
 
 test('cleanup: rm test tree ' + TESTDIR, function (t) {
     // Sanity checks that we don't `mrm -r` a non-test dir.
-- 
2.21.0

