{"project":"joyent/sdc-napi","branch":"master","id":"I1b70cdddcdb9ef32ae1014098351964ee6b62cda","number":"1856","subject":"NAPI-375 Multiple filter use on IP search endpoint seems to only heed first filter","owner":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"url":"https://cr.joyent.us/1856","commitMessage":"NAPI-375 Multiple filter use on IP search endpoint seems to only heed first filter\n","createdOn":1493253576,"lastUpdated":1493922342,"open":false,"status":"MERGED","comments":[{"timestamp":1493253576,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Uploaded patch set 1."},{"timestamp":1493253802,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1493253993,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 2: Patch Set 1 was rebased"},{"timestamp":1493254108,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2:\n\n\"make check\" passed ok"},{"timestamp":1493423173,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 2: Code-Review+1\n\n(4 comments)"},{"timestamp":1493685228,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 2:\n\n(3 comments)"},{"timestamp":1493685238,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Uploaded patch set 3."},{"timestamp":1493685307,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1493685771,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Uploaded patch set 4: Commit message was updated."},{"timestamp":1493685880,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 5: Patch Set 4 was rebased"},{"timestamp":1493685944,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5:\n\n\"make check\" passed ok"},{"timestamp":1493688252,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 5: Code-Review+1 Integration-Approval+1"},{"timestamp":1493918737,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 6: Patch Set 5 was rebased"},{"timestamp":1493918843,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 6:\n\n\"make check\" passed ok"},{"timestamp":1493922342,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Jason King"}],"currentPatchSet":{"number":"6","revision":"880445c8c33e7e6f84af0a99a4e4f1db37083622","parents":["6a1344da0b31e9fc66ec1eabe0e99c9c8346d52d"],"ref":"refs/changes/56/1856/6","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1493918737,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1493685307,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1493688252,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1493688252,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"SUBM","value":"1","grantedOn":1493922342,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/endpoints/search.js","type":"MODIFIED","insertions":22,"deletions":-7},{"file":"lib/util/constants.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/lib/ip.js","type":"MODIFIED","insertions":16,"deletions":0},{"file":"test/unit/search-ips.test.js","type":"MODIFIED","insertions":60,"deletions":0}],"sizeInsertions":99,"sizeDeletions":-8},"patchSets":[{"number":"1","revision":"03481022a2210b824fae958fea1d68fb1331ad44","parents":["6dcd7540d5171e71260f54150ac6b5e43cf75acc"],"ref":"refs/changes/56/1856/1","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1493253576,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1493253802,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/endpoints/search.js","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"lib/util/constants.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/lib/ip.js","type":"MODIFIED","insertions":16,"deletions":0},{"file":"test/unit/search-ips.test.js","type":"MODIFIED","insertions":61,"deletions":0}],"sizeInsertions":87,"sizeDeletions":-2},{"number":"2","revision":"63c2bc51051e5593749f146bdd2fd30221982f2a","parents":["d0f3e734eecd6a9d90a31f3585bb05943bee59b3"],"ref":"refs/changes/56/1856/2","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1493253993,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1493423173,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1493253802,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/endpoints/search.js","line":66,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"I\u0027d rephrase this slightly so that it\u0027s clearer why it\u0027s guaranteed:\n\n    /*\n     * We skip \"ip\" since we only ever fetch matching IPs from Moray. Additionally,\n     * beyond being superfluous, the saved IP in the stream (sipn_ip) is an object,\n     * while the passed in value will be a string, so the comparison will fail.\n     */"},{"file":"lib/endpoints/search.js","line":66,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Done"},{"file":"lib/endpoints/search.js","line":106,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"While we\u0027re editing this function, can we move all of the \"return\" statements onto their own line? I\u0027ve been trying to update NAPI to do this when calling a callback, so that we can turn on further lint checks to catch functions that are actually supposed to return things. So, for example:\n\n    if (...) {\n        done();\n        return;\n    }\n\nIf the \"return\" would become the last line in the function, it can be omitted."},{"file":"lib/endpoints/search.js","line":106,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Done"},{"file":"test/unit/search-ips.test.js","line":236,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"I would use h.nextProvisionableIP(NETS[2]) here instead, or just provision without specifying an IP, and assign this variable to res.ip after provisioning. That\u0027ll prevent this from breaking if additional networks are created in this test."},{"file":"test/unit/search-ips.test.js","line":236,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Since the existing tests don\u0027t use that function, I will opt to not specify an IP and use the result."},{"file":"test/unit/search-ips.test.js","line":259,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"You can skip \"return\" here. I\u0027ve been trying to move NAPI away from doing the \"return callback()\" style."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/endpoints/search.js","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"lib/util/constants.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/lib/ip.js","type":"MODIFIED","insertions":16,"deletions":0},{"file":"test/unit/search-ips.test.js","type":"MODIFIED","insertions":61,"deletions":0}],"sizeInsertions":87,"sizeDeletions":-2},{"number":"3","revision":"b56b23588d68923b8c0445c9a5ae180e5b4f26dc","parents":["04ac48ce4eea5a67c4080f951c8b2e200b3af913"],"ref":"refs/changes/56/1856/3","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1493685238,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1493685307,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/models/nic/del.js","type":"MODIFIED","insertions":19,"deletions":-1},{"file":"test/unit/nics.test.js","type":"MODIFIED","insertions":70,"deletions":0}],"sizeInsertions":89,"sizeDeletions":-1},{"number":"4","revision":"1b70cdddcdb9ef32ae1014098351964ee6b62cda","parents":["b359b57f248a0847f3f65d54b15e40d11e09dfef"],"ref":"refs/changes/56/1856/4","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1493685771,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1493685307,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/endpoints/search.js","type":"MODIFIED","insertions":22,"deletions":-7},{"file":"lib/util/constants.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/lib/ip.js","type":"MODIFIED","insertions":16,"deletions":0},{"file":"test/unit/search-ips.test.js","type":"MODIFIED","insertions":60,"deletions":0}],"sizeInsertions":99,"sizeDeletions":-8},{"number":"5","revision":"351ff617de7638f7f94b13f78b29272f76ed06d0","parents":["db188c8f27d295bb03d4d2786ffaf3dd3a8b5827"],"ref":"refs/changes/56/1856/5","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1493685880,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1493688252,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1493688252,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1493685307,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/endpoints/search.js","type":"MODIFIED","insertions":22,"deletions":-7},{"file":"lib/util/constants.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/lib/ip.js","type":"MODIFIED","insertions":16,"deletions":0},{"file":"test/unit/search-ips.test.js","type":"MODIFIED","insertions":60,"deletions":0}],"sizeInsertions":99,"sizeDeletions":-8},{"number":"6","revision":"880445c8c33e7e6f84af0a99a4e4f1db37083622","parents":["6a1344da0b31e9fc66ec1eabe0e99c9c8346d52d"],"ref":"refs/changes/56/1856/6","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1493918737,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1493688252,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1493688252,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1493685307,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"SUBM","value":"1","grantedOn":1493922342,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/endpoints/search.js","type":"MODIFIED","insertions":22,"deletions":-7},{"file":"lib/util/constants.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/lib/ip.js","type":"MODIFIED","insertions":16,"deletions":0},{"file":"test/unit/search-ips.test.js","type":"MODIFIED","insertions":60,"deletions":0}],"sizeInsertions":99,"sizeDeletions":-8}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}]}