From 0f5613684beb0309501454cc2488c3b1de175754 Mon Sep 17 00:00:00 2001
From: Pedro Palazon Candel <pedro@joyent.com>
Date: Fri, 15 Jun 2018 20:46:53 +0200
Subject: [PATCH] joyent/node-zkstream#33 `Client#isConnected()` throws
 TypeError

---
 lib/client.js      | 4 ++--
 test/basic.test.js | 2 ++
 2 files changed, 4 insertions(+), 2 deletions(-)

diff --git a/lib/client.js b/lib/client.js
index bbf0a9d..bb76ef7 100644
--- a/lib/client.js
+++ b/lib/client.js
@@ -3,7 +3,7 @@
  * License, v. 2.0. If a copy of the MPL was not distributed with this
  * file, You can obtain one at http://mozilla.org/MPL/2.0/.
  *
- * Copyright (c) 2016, Joyent, Inc.
+ * Copyright (c) 2018, Joyent, Inc.
  */
 
 module.exports = { Client: ZKClient };
@@ -213,7 +213,7 @@ ZKClient.prototype._newSession = function () {
 };
 
 ZKClient.prototype.isConnected = function () {
-	var conn = this.getConnection();
+	var conn = this.currentConnection();
 	return (conn !== undefined && conn.isInState('connected'));
 };
 
diff --git a/test/basic.test.js b/test/basic.test.js
index af4fad0..9b1a265 100644
--- a/test/basic.test.js
+++ b/test/basic.test.js
@@ -102,6 +102,7 @@ mod_tape.test('simple connect and ping', function (t) {
 	});
 
 	zkc.on('connect', function () {
+		t.ok(zkc.isConnected());
 		zkc.ping(function (err) {
 			t.error(err);
 			pinged = true;
@@ -121,6 +122,7 @@ mod_tape.test('double ping', function (t) {
 
 	zkc.on('close', function () {
 		t.strictEqual(pinged, 2);
+		t.notOk(zkc.isConnected());
 		t.end();
 	});
 
-- 
2.21.0

