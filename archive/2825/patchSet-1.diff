commit 796b347b91500478397528f9a25027379fbe1ae2 (refs/changes/25/2825/1)
Author: Trent Mick <trentm@gmail.com>
Date:   2017-10-19T15:31:15-07:00 (2 years ago)
    
    TOOLS-1899 sdcadm doesn't build with node v4.x

diff --git a/Makefile b/Makefile
index 2dc9162..bf6d5db 100644
--- a/Makefile
+++ b/Makefile
@@ -27,11 +27,11 @@ JSSTYLE_FLAGS	 = -f tools/jsstyle.conf
 CLEAN_FILES += ./node_modules ./build/sdcadm-*.sh ./build/sdcadm-*.imgmanifest ./build/shar-image ./man/man1/sdcadm.1 ./etc/sdcadm.completion
 
 
-NODE_PREBUILT_VERSION=v0.10.26
+NODE_PREBUILT_VERSION=v4.8.4
 ifeq ($(shell uname -s),SunOS)
 	NODE_PREBUILT_TAG=gz
-	# sdc-smartos/1.6.3
-	NODE_PREBUILT_IMAGE=fd2cc906-8938-11e3-beab-4359c665ac99
+	# sdc-minimal-multiarch-lts 15.4.1
+	NODE_PREBUILT_IMAGE=18b094b0-eb01-11e5-80c1-175dac7ddf02
 endif
 
 
diff --git a/lib/sdcadm.js b/lib/sdcadm.js
index 79a50ca..b362b7e 100644
--- a/lib/sdcadm.js
+++ b/lib/sdcadm.js
@@ -29,6 +29,7 @@ var sprintf = require('extsprintf').sprintf;
 var urclient = require('urclient');
 var vasync = require('vasync');
 var WfClient = require('wf-client');
+var UFDS = require('ufds');
 var uuid = require('node-uuid');
 var ProgressBar = require('progbar').ProgressBar;
 var cueball = require('cueball');
@@ -322,7 +323,7 @@ function SdcAdm(options) {
     Object.defineProperty(this, 'ufds', {
         get: function () {
             if (self._ufds === undefined) {
-                self._ufds = new sdcClients.UFDS({
+                self._ufds = new UFDS({
                     url: self.config.ufds.url,
                     bindDN: self.config.ufds.bindDN,
                     bindPassword: self.config.ufds.bindPassword,
diff --git a/package.json b/package.json
index 957a050..4708817 100644
--- a/package.json
+++ b/package.json
@@ -8,28 +8,29 @@
     "async": "0.2.9",
     "assert-plus": "^1.0.0",
     "backoff": "2.5.0",
-    "bunyan": "0.23.1",
+    "bunyan": "1.8.12",
     "cmdln": "4.2.1",
     "cueball": "2.4.0",
     "extsprintf": "^1.3.0",
     "kthxbai": "~0.4.0",
     "joyent-schemas": "git+https://github.com/joyent/schemas.git#385e6eb",
     "jsprim": "1.2.2",
-    "lockfd": "1.0.1",
+    "lockfd": "1.2.1",
     "mkdirp": "0.3.5",
     "node-uuid": "1.4.1",
     "once": "1.3.0",
     "progbar": "1.1.0",
     "read": "1.0.5",
-    "sdc-clients": "9.0.2",
+    "sdc-clients": "10.3.0",
     "semver": "2.2.1",
     "strsplit": "1.0.0",
-    "tabula": "1.2.2",
+    "tabula": "1.9.0",
     "tape": "3.5.0",
-    "urclient": "^1.1.0",
+    "ufds": "1.3.0",
+    "urclient": "git+https://github.com/joyent/node-urclient.git#5f46ee41ed7d813018f8f84593fa8bf47120d4f7",
     "vasync": "^1.6.4",
     "verror": "^1.10.0",
-    "wf-client": "git+https://github.com/joyent/sdc-wf-client.git#9bcb3a0ebec7cd5b4052acaacde8fd6e3e2dfcf9"
+    "wf-client": "0.2.1"
   },
   "devDependencies": {
     "marked-man": "0.1.4"
