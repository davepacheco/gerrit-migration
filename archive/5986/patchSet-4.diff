From 84da0dd598d2299909bb6f250446466e8062ef64 Mon Sep 17 00:00:00 2001
From: Josh Wilsdon <jwilsdon@joyent.com>
Date: Wed, 20 Mar 2019 17:15:24 -0700
Subject: [PATCH] TRITON-1314 sdc-agents-core does not need sdcnode

---
 Makefile     | 24 ++++++------------------
 package.json |  2 +-
 2 files changed, 7 insertions(+), 19 deletions(-)

diff --git a/Makefile b/Makefile
index fdd4711..13e3f79 100644
--- a/Makefile
+++ b/Makefile
@@ -23,23 +23,16 @@ JSL_FILES_NODE   = $(JS_FILES)
 JSSTYLE_FILES	 = $(JS_FILES)
 JSSTYLE_FLAGS    = -o indent=4,doxygen,unparenthesized-return=0
 
-# Should be the same version as the platform's /usr/node/bin/node.
-NODE_PREBUILT_VERSION=v0.12.14
-NODE_PREBUILT_TAG=gz
-ifeq ($(shell uname -s),SunOS)
-    NODE_PREBUILT_IMAGE=fd2cc906-8938-11e3-beab-4359c665ac99
-endif
+# NPM here is set to the default npm in the path. This is because we're not
+# shipping a node, and we just need *an* npm to install the non-addon
+# package.json dependencies for us.
+NPM := npm
 
+BASE_IMAGE_UUID := fd2cc906-8938-11e3-beab-4359c665ac99
 ENGBLD_REQUIRE := $(shell git submodule update --init deps/eng)
 include ./deps/eng/tools/mk/Makefile.defs
 TOP ?= $(error Unable to access eng.git submodule Makefiles.)
 
-ifeq ($(shell uname -s),SunOS)
-    include ./deps/eng/tools/mk/Makefile.node_prebuilt.defs
-else
-    include ./deps/eng/tools/mk/Makefile.node.defs
-endif
-
 include ./deps/eng/tools/mk/Makefile.smf.defs
 
 NAME		:= agents_core
@@ -52,7 +45,7 @@ NODEUNIT	= $(TOP)/node_modules/.bin/nodeunit
 # Repo-specific targets
 #
 .PHONY: all
-all: $(SMF_MANIFESTS) | $(NPM_EXEC) $(REPO_DEPS)
+all: $(SMF_MANIFESTS) | $(REPO_DEPS)
 	$(NPM) install && $(NPM) update
 
 CLEAN_FILES += $(TAP) ./node_modules/tap
@@ -106,10 +99,5 @@ dumpvar:
 
 
 include ./deps/eng/tools/mk/Makefile.deps
-ifeq ($(shell uname -s),SunOS)
-    include ./deps/eng/tools/mk/Makefile.node_prebuilt.targ
-else
-    include ./deps/eng/tools/mk/Makefile.node.targ
-endif
 include ./deps/eng/tools/mk/Makefile.smf.targ
 include ./deps/eng/tools/mk/Makefile.targ
diff --git a/package.json b/package.json
index f648766..c8be70a 100644
--- a/package.json
+++ b/package.json
@@ -1,7 +1,7 @@
 {
   "name": "agents_core",
   "description": "Joyent SmartDC Agent Core",
-  "version": "2.2.1",
+  "version": "2.2.2",
   "author": "Joyent (joyent.com)",
   "private": true,
   "dependencies": {
-- 
2.21.0

