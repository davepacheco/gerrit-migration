{"project":"joyent/electric-moray","branch":"master","id":"If88800a13a4787fd2d8134607123047f949f407b","number":"1354","subject":"MANTA-3128 update electric-moray to Moray v3 Reviewed by: Robert Mustacchi \u003crm@joyent.com\u003e Approved by: Richard Kiene \u003crichard.kiene@joyent.com\u003e","owner":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"url":"https://cr.joyent.us/1354","commitMessage":"MANTA-3128 update electric-moray to Moray v3\nReviewed by: Robert Mustacchi \u003crm@joyent.com\u003e\nApproved by: Richard Kiene \u003crichard.kiene@joyent.com\u003e\n","createdOn":1485479042,"lastUpdated":1485900316,"open":false,"status":"MERGED","comments":[{"timestamp":1485479042,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Uploaded patch set 1."},{"timestamp":1485479073,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1485559905,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1485816445,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1485883169,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 1: Code-Review+1\n\n(1 comment)"},{"timestamp":1485889887,"reviewer":{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1485891042,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1485893542,"reviewer":{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"},"message":"Patch Set 1: Integration-Approval+1"},{"timestamp":1485900258,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Uploaded patch set 2: Commit message was updated."},{"timestamp":1485900316,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by David Pacheco"}],"currentPatchSet":{"number":"2","revision":"f88800a13a4787fd2d8134607123047f949f407b","parents":["880a41968f9ba22c24060feb3d09864380e1fee3"],"ref":"refs/changes/54/1354/2","uploader":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"createdOn":1485900258,"author":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1485479073,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1485883169,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1485893542,"by":{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"}},{"type":"SUBM","value":"1","grantedOn":1485900316,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/server.js","type":"MODIFIED","insertions":5,"deletions":-3},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":6,"sizeDeletions":-4},"patchSets":[{"number":"1","revision":"78524e47a13dd68a6db1201859023f16338c3995","parents":["880a41968f9ba22c24060feb3d09864380e1fee3"],"ref":"refs/changes/54/1354/1","uploader":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"createdOn":1485479042,"author":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1485883169,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1485479073,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1485893542,"by":{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"}}],"comments":[{"file":"lib/server.js","line":748,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"When reading RFD 73, I feel like it discourages this, though I think because this is only srvDomain based, that\u0027s fine. That right?"},{"file":"lib/server.js","line":748,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Yes, RFD 73 discourages this pattern because it doesn\u0027t allow administrators or developers to point a service at a particular instance of a dependency (e.g., by IP address or port number).  RFD 73 recommends that configuration files specify an arbitrary blob that we use for Moray configuration so that administrators can override it as desired.\n\nBut in electric-moray, the hostname and port number do not come from a configuration file.  They come from the consistent hash ring that was generated at Manta setup time.  That would be a major pain to change for existing deployments, and for little to no gain.  The only thing we lose by hardcoding srvDomain here is that administrators can\u0027t point electric-moray at specific moray instances by IP address or port, but they couldn\u0027t do that before anyway, so I think this is fine.  If we want to do this in the future, we could provide a separate piece of configuration that maps physical shard names to a blob of Moray config for that shard."},{"file":"lib/server.js","line":748,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"OK, thanks for the explanation."},{"file":"package.json","line":21,"reviewer":{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"},"message":"Any reason not to lock this at 3.0.0?"},{"file":"package.json","line":21,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"The long answer is in the discussion at https://cr.joyent.us/#/c/1350/1/package.json@18\n\nGiven that both options currently suck for different reasons, until we can make one of them work better, I don\u0027t have a preference for what we use in the short term."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/server.js","type":"MODIFIED","insertions":5,"deletions":-3},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":6,"sizeDeletions":-4},{"number":"2","revision":"f88800a13a4787fd2d8134607123047f949f407b","parents":["880a41968f9ba22c24060feb3d09864380e1fee3"],"ref":"refs/changes/54/1354/2","uploader":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"createdOn":1485900258,"author":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"SUBM","value":"1","grantedOn":1485900316,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1485883169,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1485479073,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1485893542,"by":{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/server.js","type":"MODIFIED","insertions":5,"deletions":-3},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":6,"sizeDeletions":-4}],"allReviewers":[{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"},{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}]}