{"project":"joyent/smartos-live","branch":"master","topic":"OS-7356","id":"I9083bf02614909a0f055168bdaa71fb2c4d5d401","number":"5089","subject":"OS-7356 bhyve metadata timeouts during guest-initiated reboots Reviewed by: Pedro Palazón Candel \u003cpedro@joyent.com\u003e Reviewed by: Dave Eddy \u003cdave.eddy@joyent.com\u003e Approved by: Pedro Palazón Candel \u003cpedro@joyent.com\u003e","owner":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"url":"https://cr.joyent.us/5089","commitMessage":"OS-7356 bhyve metadata timeouts during guest-initiated reboots\nReviewed by: Pedro Palazón Candel \u003cpedro@joyent.com\u003e\nReviewed by: Dave Eddy \u003cdave.eddy@joyent.com\u003e\nApproved by: Pedro Palazón Candel \u003cpedro@joyent.com\u003e\n","createdOn":1542823579,"lastUpdated":1543507621,"open":false,"status":"MERGED","comments":[{"timestamp":1542823579,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Uploaded patch set 1."},{"timestamp":1542823625,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 1:\n\nDepends on: https://cr.joyent.us/#/c/5088/"},{"timestamp":1542823631,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1542824255,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Uploaded patch set 2."},{"timestamp":1542824311,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1542830279,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1543248073,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Uploaded patch set 3."},{"timestamp":1543248131,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1543419370,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 3: Code-Review+1\n\nLooks good to me but, given my ignorance regarding how vminfo works (better said, regarding vminfo code), I\u0027d rather wait to Dave for approval"},{"timestamp":1543427608,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 3: Code-Review+1\n\nThe code itself looks good and I see the testing notes in the ticket but have you run the full smartos-live test suite against this change with:\n\n /usr/vm/test/runtests\n\nIt should all pass, but I\u0027m particularly interested in test-vminfod-zonewatcher and test-vminfod-zonewatcher-overflow."},{"timestamp":1543447033,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 4: Patch Set 3 was rebased"},{"timestamp":1543447086,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4:\n\n\"make check\" passed ok"},{"timestamp":1543459825,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 4:\n\nAfter a resync of this and OS-7389, I performed a full build and re-tested.  Results are recorded in a comment in OS-7356."},{"timestamp":1543490529,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Topic set to OS-7356"},{"timestamp":1543506158,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 4: Integration-Approval+1\n\nGiven all the tests are passing fine, let\u0027s move ahead!"},{"timestamp":1543507610,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 5: Commit message was updated."},{"timestamp":1543507621,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Mike Gerdts"}],"currentPatchSet":{"number":"5","revision":"fd4a593a9da1bad19001c2534f824e0ce089bc9e","parents":["0601b9afe57530289229880c4898300424326554"],"ref":"refs/changes/89/5089/5","uploader":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"createdOn":1543507610,"author":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1543248131,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1543419370,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1543427608,"by":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1543506158,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"SUBM","value":"1","grantedOn":1543507621,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"src/vm/lib/metadata/agent.js","type":"MODIFIED","insertions":22,"deletions":-5},{"file":"src/vm/node_modules/proptable.js","type":"MODIFIED","insertions":3,"deletions":0},{"file":"src/vm/node_modules/vminfod/zonewatcher.js","type":"MODIFIED","insertions":8,"deletions":-2},{"file":"src/vm/node_modules/vmload/vmload-zoneinfo.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"src/vm/tests/test-defaults.js","type":"MODIFIED","insertions":1,"deletions":0}],"sizeInsertions":36,"sizeDeletions":-8},"patchSets":[{"number":"1","revision":"34da004a8dda0f0b3c410f0355e3d8df9f9e8739","parents":["3c1aa42777928dc08c97839aefbb5fbbad7f0228"],"ref":"refs/changes/89/5089/1","uploader":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"createdOn":1542823579,"author":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1542823631,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/vm/lib/metadata/agent.js","type":"MODIFIED","insertions":23,"deletions":-5},{"file":"src/vm/node_modules/proptable.js","type":"MODIFIED","insertions":3,"deletions":0},{"file":"src/vm/node_modules/vminfod/vminfod.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"src/vm/node_modules/vminfod/zonewatcher.js","type":"MODIFIED","insertions":8,"deletions":-2},{"file":"src/vm/node_modules/vmload/vmload-zoneinfo.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"src/vm/tests/test-defaults.js","type":"MODIFIED","insertions":1,"deletions":0}],"sizeInsertions":39,"sizeDeletions":-8},{"number":"2","revision":"78fb015dab109f7dd4ac84ebebcc79eb91474920","parents":["3c1aa42777928dc08c97839aefbb5fbbad7f0228"],"ref":"refs/changes/89/5089/2","uploader":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"createdOn":1542824255,"author":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1542824311,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"src/vm/node_modules/vminfod/vminfod.js","line":2432,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"oops, left over from an earlier pass.  will revert."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/vm/lib/metadata/agent.js","type":"MODIFIED","insertions":22,"deletions":-5},{"file":"src/vm/node_modules/proptable.js","type":"MODIFIED","insertions":3,"deletions":0},{"file":"src/vm/node_modules/vminfod/vminfod.js","type":"MODIFIED","insertions":1,"deletions":0},{"file":"src/vm/node_modules/vminfod/zonewatcher.js","type":"MODIFIED","insertions":8,"deletions":-2},{"file":"src/vm/node_modules/vmload/vmload-zoneinfo.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"src/vm/tests/test-defaults.js","type":"MODIFIED","insertions":1,"deletions":0}],"sizeInsertions":37,"sizeDeletions":-8},{"number":"3","revision":"9083bf02614909a0f055168bdaa71fb2c4d5d401","parents":["3c1aa42777928dc08c97839aefbb5fbbad7f0228"],"ref":"refs/changes/89/5089/3","uploader":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"createdOn":1543248073,"author":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1543248131,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1543419370,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1543427608,"by":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/vm/lib/metadata/agent.js","type":"MODIFIED","insertions":22,"deletions":-5},{"file":"src/vm/node_modules/proptable.js","type":"MODIFIED","insertions":3,"deletions":0},{"file":"src/vm/node_modules/vminfod/zonewatcher.js","type":"MODIFIED","insertions":8,"deletions":-2},{"file":"src/vm/node_modules/vmload/vmload-zoneinfo.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"src/vm/tests/test-defaults.js","type":"MODIFIED","insertions":1,"deletions":0}],"sizeInsertions":36,"sizeDeletions":-8},{"number":"4","revision":"91d4708764a999f5a37e755bc0f34509434a0385","parents":["0601b9afe57530289229880c4898300424326554"],"ref":"refs/changes/89/5089/4","uploader":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"createdOn":1543447033,"author":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1543248131,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1543419370,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1543506158,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1543427608,"by":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/vm/lib/metadata/agent.js","type":"MODIFIED","insertions":22,"deletions":-5},{"file":"src/vm/node_modules/proptable.js","type":"MODIFIED","insertions":3,"deletions":0},{"file":"src/vm/node_modules/vminfod/zonewatcher.js","type":"MODIFIED","insertions":8,"deletions":-2},{"file":"src/vm/node_modules/vmload/vmload-zoneinfo.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"src/vm/tests/test-defaults.js","type":"MODIFIED","insertions":1,"deletions":0}],"sizeInsertions":36,"sizeDeletions":-8},{"number":"5","revision":"fd4a593a9da1bad19001c2534f824e0ce089bc9e","parents":["0601b9afe57530289229880c4898300424326554"],"ref":"refs/changes/89/5089/5","uploader":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"createdOn":1543507610,"author":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1543248131,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1543419370,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1543506158,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1543427608,"by":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"}},{"type":"SUBM","value":"1","grantedOn":1543507621,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"src/vm/lib/metadata/agent.js","type":"MODIFIED","insertions":22,"deletions":-5},{"file":"src/vm/node_modules/proptable.js","type":"MODIFIED","insertions":3,"deletions":0},{"file":"src/vm/node_modules/vminfod/zonewatcher.js","type":"MODIFIED","insertions":8,"deletions":-2},{"file":"src/vm/node_modules/vmload/vmload-zoneinfo.js","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"src/vm/tests/test-defaults.js","type":"MODIFIED","insertions":1,"deletions":0}],"sizeInsertions":36,"sizeDeletions":-8}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}]}