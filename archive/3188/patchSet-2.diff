From 26197df0a967016980569c6d42fa3664999df5bf Mon Sep 17 00:00:00 2001
From: Jared Morrow <jm@joyent.com>
Date: Wed, 10 Jan 2018 12:37:33 -0700
Subject: [PATCH] MANTA-3553 Muppet should recover when Zookeeper returns after
 being down

---
 muppet.js | 5 +++--
 1 file changed, 3 insertions(+), 2 deletions(-)

diff --git a/muppet.js b/muppet.js
index 6ab8d19..f7f8290 100644
--- a/muppet.js
+++ b/muppet.js
@@ -284,10 +284,11 @@ function zookeeper(cfg) {
     /*
      * zkstream attempts to retry the connection to zookeeper. On retry
      * exhaustion it will emit a `failed` event.
+     * For this we only log an error, because when ZK comes back up, zkstream
+     * will automatically reconnect and re-arm the watchers (if they existed)
      */
     zk_client.on('failed', function onFailed(err) {
-        cfg.log.fatal(err, 'ZooKeeper: received failed event');
-        process.exit(1);
+        cfg.log.error(err, 'ZooKeeper: received failed event');
     });
 }
 
-- 
2.21.0

