{"project":"joyent/sdc-cloudapi","branch":"master","id":"Icba939bdd68c88c80018c83b2ea5d2af2f8d5ef0","number":"4970","subject":"TRITON-853 cloudapi should allow creation of instances with delegated datasets","owner":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"url":"https://cr.joyent.us/4970","commitMessage":"TRITON-853 cloudapi should allow creation of instances with delegated datasets\n","createdOn":1539792688,"lastUpdated":1552574497,"open":false,"status":"ABANDONED","comments":[{"timestamp":1539792688,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Uploaded patch set 1."},{"timestamp":1539792693,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit a6b0d45cb0bb1112253ec7f11fc4f814f861cffa\n    \n    TRITON-853 cloudapi should allow creation of instances with delegated datasets"},{"timestamp":1539792787,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1539942259,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 1:\n\n(3 comments)\n\nSome bikeshedding, but mainly we should have a test covering this if experimental_cloudapi_delegate_datase is true."},{"timestamp":1539957273,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Uploaded patch set 2."},{"timestamp":1539957278,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit b51da1ec49605f66d1b12c1a6de8ec09a1c0d728\n    \n    TRITON-853 cloudapi should allow creation of instances with delegated datasets"},{"timestamp":1539957312,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1539957622,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Patch Set 1:\n\n(3 comments)\n\nI\u0027ve made these changes in patch set 2. I agree with needing automated tests, and am working on those."},{"timestamp":1539986306,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 2: Code-Review+1\n\nLGTM.\n\nI\u0027ll give IA once there\u0027s a test."},{"timestamp":1540232247,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 2:\n\n(2 comments)\n\nEventually this should also get doc updates (doc the new option in CreateMachine, doc the implications for MachineSnapshot endpoints as discussed in RFD 44).\n\nThere should be a minor version bump in package.json for this."},{"timestamp":1552574497,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Abandoned\n\nAbandoning this code review, justification recorded in TRITON-853."}],"currentPatchSet":{"number":"2","revision":"cba939bdd68c88c80018c83b2ea5d2af2f8d5ef0","parents":["43f8ad622c6aee821b6456d50091434513d6b4da"],"ref":"refs/changes/70/4970/2","uploader":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"createdOn":1539957273,"author":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1539957312,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1539986306,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}}],"comments":[{"file":"lib/machines.js","line":467,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"I don\u0027t think the internal SAPI var name should leak out to cloudapi users."},{"file":"lib/machines.js","line":481,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Yes, I think we should discuss also setting those vars before including this work in cloudapi. RFD 44 suggests that allowing a delegate dataset without these limits is unsafe, in that it allows for some DoS\u0027ing."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/machines.js","type":"MODIFIED","insertions":27,"deletions":0},{"file":"sapi_manifests/cloudapi/template","type":"MODIFIED","insertions":6,"deletions":0}],"sizeInsertions":33,"sizeDeletions":0},"patchSets":[{"number":"1","revision":"b6666043f1628526f3fda5ab9e4cc969cc62a23b","parents":["43f8ad622c6aee821b6456d50091434513d6b4da"],"ref":"refs/changes/70/4970/1","uploader":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"createdOn":1539792688,"author":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1539792787,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/machines.js","line":153,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"I don\u0027t recall if restify removes undefined attr. If it doesn\u0027t, then consider following the existing pattern in this function of assigning only if defined."},{"file":"lib/machines.js","line":153,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Done"},{"file":"lib/machines.js","line":460,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Since this is used several times, I suggest assigning it to a \u0027delegatedDataset\u0027 var first."},{"file":"lib/machines.js","line":460,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Done"},{"file":"lib/machines.js","line":468,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"I\u0027m not sure what to think about mixing types -- allowing boolean or string. I\u0027d also prefer if \u0027safe\u0027 were more defaultish than unrestricted.\n\nMaybe change to: \u0027safe\u0027 or \u0027unrestricted\u0027 strings? Or something along those lines?"},{"file":"lib/machines.js","line":468,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Wrt mixing types, that seems reasonable.\n\nI went instead with \u0027on\u0027, \u0027off\u0027 and \u0027safe\u0027. I considered \u0027off\u0027, \u0027safe\u0027 and \u0027unsafe\u0027, but then felt that sounded a bit weird, but I\u0027m happy to go with something else if you prefer?\n\nI made complementary changes in node-triton to account for this change."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/machines.js","type":"MODIFIED","insertions":20,"deletions":0},{"file":"sapi_manifests/cloudapi/template","type":"MODIFIED","insertions":6,"deletions":0}],"sizeInsertions":26,"sizeDeletions":0},{"number":"2","revision":"cba939bdd68c88c80018c83b2ea5d2af2f8d5ef0","parents":["43f8ad622c6aee821b6456d50091434513d6b4da"],"ref":"refs/changes/70/4970/2","uploader":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"createdOn":1539957273,"author":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1539957312,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1539986306,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}}],"comments":[{"file":"lib/machines.js","line":467,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"I don\u0027t think the internal SAPI var name should leak out to cloudapi users."},{"file":"lib/machines.js","line":481,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Yes, I think we should discuss also setting those vars before including this work in cloudapi. RFD 44 suggests that allowing a delegate dataset without these limits is unsafe, in that it allows for some DoS\u0027ing."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/machines.js","type":"MODIFIED","insertions":27,"deletions":0},{"file":"sapi_manifests/cloudapi/template","type":"MODIFIED","insertions":6,"deletions":0}],"sizeInsertions":33,"sizeDeletions":0}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}]}