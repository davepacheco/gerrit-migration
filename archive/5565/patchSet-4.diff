commit 029c8faa1b4eb74969330ee28e04e3113b989e55 (refs/changes/65/5565/4)
Author: Marsell Kukuljevic <marsell@joyent.com>
Date:   2019-02-15T15:40:08+00:00 (8 months ago)
    
    TRITON-1213 VM resize fails when tmpfs is 0 and no tmpfs set in package

diff --git a/src/vm/node_modules/VM.js b/src/vm/node_modules/VM.js
index 7758ace9..71d40392 100644
--- a/src/vm/node_modules/VM.js
+++ b/src/vm/node_modules/VM.js
@@ -4606,7 +4606,7 @@ function fixPayloadMemory(payload, vmobj, log)
             // change tmpfs to be the same ratio of ram as before
             payload.tmpfs = ((vmobj.tmpfs / vmobj.max_physical_memory)
                 * payload.max_physical_memory);
-            payload.tmpfs = Number(payload.tmpfs).toFixed();
+            payload.tmpfs = Number(payload.tmpfs);
         } else {
             // tmpfs must be < max_physical_memory, if not: pretend it was
             payload.tmpfs = payload.max_physical_memory;
@@ -16605,6 +16605,11 @@ exports.update = function (uuid, payload, options, callback)
                                 return;
                             }
 
+                            var tmpfs = Number(vmobj.tmpfs);
+                            if (newkey === 'tmpfs' && tmpfs === 0) {
+                                return;
+                            }
+
                             switch (vmobj.brand) {
                             case 'kvm':
                                 v += KVM_MEM_OVERHEAD;
