{"project":"joyent/smartos-live","branch":"master","id":"If9f567c0fe1f11be64834b6baeb5789c1a9d4d56","number":"5565","subject":"TRITON-1213 VM resize fails when tmpfs is 0 and no tmpfs set in package","owner":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"url":"https://cr.joyent.us/5565","commitMessage":"TRITON-1213 VM resize fails when tmpfs is 0 and no tmpfs set in package\n","createdOn":1549918971,"lastUpdated":1551107177,"open":true,"status":"NEW","comments":[{"timestamp":1549918971,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Uploaded patch set 1."},{"timestamp":1550000964,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 1: Code-Review+1\n\nI see this has been tested with various test suites, but have you run it against the platform test suite? via:\n\n /usr/vm/test/runtests"},{"timestamp":1550055454,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 2: Patch Set 1 was rebased"},{"timestamp":1550062831,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 2:\n\nNo, I didn\u0027t run the /usr/vm/test tests -- thanks for pointing that out! I have now, and all tests pass."},{"timestamp":1550075227,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 2: Code-Review+1 Integration-Approval+1"},{"timestamp":1550090969,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing-1\n\n\"make check\" exited with status 2\n\n /tmp/repo/src/vm/tests/test-vrrp-nics.js\n /tmp/repo/src/vm/tests/test-vminfod.js\n /tmp/repo/src/vm/tests/test-vminfod-zonewatcher.js\n /tmp/repo/src/vm/tests/test-vminfod-zonewatcher-overflow.js\n /tmp/repo/src/vm/tests/test-vminfod-zpoolwatcher.js\n /tmp/repo/src/vm/lib/metadata/agent.js\n /tmp/repo/src/vm/lib/metadata/common.js\n /tmp/repo/src/vm/lib/metadata/crc32.js\n /tmp/repo/src/disklayout.js\n /tmp/repo/src/mkzpool.js\n /tmp/repo/src/ntp_config.js\n /tmp/repo/src/node_modules/disklayout.js\n \n 0 error(s), 0 warnings(s)\n \n \u003d\u003d\u003e Running jsstyle...\n (for file in filewait.js node_modules/{system,onlyif,net-boot-config}.js net-boot-config vm/sbin/*.js vm/node_modules/diff.js vm/node_modules/dladm.js vm/node_modules/expander.js vm/node_modules/fswatcher.js vm/node_modules/hrtime.js vm/node_modules/ip.js vm/node_modules/nic.js vm/node_modules/proptable.js vm/node_modules/utils.js vm/node_modules/VM.js vm/node_modules/qmp.js vm/node_modules/queue.js vm/node_modules/openonerrlogger.js vm/node_modules/vmload/*.js vm/node_modules/vminfod/*.js vm/node_modules/sysevent-stream.js vm/node_modules/zonecfg.js vm/node_modules/zoneevent.js img/lib/*.js img/sbin/imgadm vm/common/nictag.js vm/tests/common.js vm/tests/test-alias.js vm/tests/test-cleanup-on-failure.js vm/tests/test-create-filesystems.js vm/tests/test-create.js vm/tests/test-defaults.js vm/tests/test-docker.js vm/tests/test-firewall.js vm/tests/test-fswatcher.js vm/tests/test-hrtime.js vm/tests/test-indestructible.js vm/tests/test-internal_metadata_namespaces.js vm/tests/test-lastexited.js vm/tests/test-openonerrlogger.js vm/tests/test-queue.js vm/tests/test-quota.js vm/tests/test-reboot.js vm/tests/test-reprovision.js vm/tests/test-send-recv.js vm/tests/test-snapshots.js vm/tests/test-spoof-opts.js vm/tests/test-sysinfo.js vm/tests/test-tmpfs.js vm/tests/test-update.js vm/tests/test-vrrp-nics.js vm/tests/test-vminfod.js vm/tests/test-vminfod-zonewatcher.js vm/tests/test-vminfod-zonewatcher-overflow.js vm/tests/test-vminfod-zpoolwatcher.js vm/lib/metadata/*.js; do \\\n \techo /tmp/repo/src/$file; \\\n \t/tmp/repo/src/../tools/jsstyle/jsstyle -o indent\u003d4,strict-indent\u003d1,doxygen,unparenthesized-return\u003d0,continuation-at-front\u003d1,leading-right-paren-ok\u003d1 $file; \\\n \t[[ $? \u003d\u003d \"0\" ]] || exit 1; \\\n done)\n /tmp/repo/src/filewait.js\n /tmp/repo/src/node_modules/system.js\n /tmp/repo/src/node_modules/onlyif.js\n /tmp/repo/src/node_modules/net-boot-config.js\n /tmp/repo/src/net-boot-config\n /tmp/repo/src/vm/sbin/add-userscript.js\n /tmp/repo/src/vm/sbin/metadata.js\n /tmp/repo/src/vm/sbin/vmadm.js\n /tmp/repo/src/vm/sbin/vmadmd.js\n /tmp/repo/src/vm/sbin/vmdf.js\n /tmp/repo/src/vm/sbin/vminfo.js\n /tmp/repo/src/vm/sbin/vminfod.js\n /tmp/repo/src/vm/node_modules/diff.js\n /tmp/repo/src/vm/node_modules/dladm.js\n /tmp/repo/src/vm/node_modules/expander.js\n /tmp/repo/src/vm/node_modules/fswatcher.js\n /tmp/repo/src/vm/node_modules/hrtime.js\n /tmp/repo/src/vm/node_modules/ip.js\n /tmp/repo/src/vm/node_modules/nic.js\n /tmp/repo/src/vm/node_modules/proptable.js\n /tmp/repo/src/vm/node_modules/utils.js\n /tmp/repo/src/vm/node_modules/VM.js\n vm/node_modules/VM.js: 15746: improper continuation\n Makefile:460: recipe for target \u0027check\u0027 failed\n make[1]: *** [check] Error 1\n make[1]: Leaving directory \u0027/tmp/repo/src\u0027\n Makefile:379: recipe for target \u0027check\u0027 failed\n gmake: *** [check] Error 2"},{"timestamp":1550092818,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Uploaded patch set 3."},{"timestamp":1550094291,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing-1\n\n\"make check\" exited with status 2\n\n /tmp/repo/src/vm/tests/test-vrrp-nics.js\n /tmp/repo/src/vm/tests/test-vminfod.js\n /tmp/repo/src/vm/tests/test-vminfod-zonewatcher.js\n /tmp/repo/src/vm/tests/test-vminfod-zonewatcher-overflow.js\n /tmp/repo/src/vm/tests/test-vminfod-zpoolwatcher.js\n /tmp/repo/src/vm/lib/metadata/agent.js\n /tmp/repo/src/vm/lib/metadata/common.js\n /tmp/repo/src/vm/lib/metadata/crc32.js\n /tmp/repo/src/disklayout.js\n /tmp/repo/src/mkzpool.js\n /tmp/repo/src/ntp_config.js\n /tmp/repo/src/node_modules/disklayout.js\n \n 0 error(s), 0 warnings(s)\n \n \u003d\u003d\u003e Running jsstyle...\n (for file in filewait.js node_modules/{system,onlyif,net-boot-config}.js net-boot-config vm/sbin/*.js vm/node_modules/diff.js vm/node_modules/dladm.js vm/node_modules/expander.js vm/node_modules/fswatcher.js vm/node_modules/hrtime.js vm/node_modules/ip.js vm/node_modules/nic.js vm/node_modules/proptable.js vm/node_modules/utils.js vm/node_modules/VM.js vm/node_modules/qmp.js vm/node_modules/queue.js vm/node_modules/openonerrlogger.js vm/node_modules/vmload/*.js vm/node_modules/vminfod/*.js vm/node_modules/sysevent-stream.js vm/node_modules/zonecfg.js vm/node_modules/zoneevent.js img/lib/*.js img/sbin/imgadm vm/common/nictag.js vm/tests/common.js vm/tests/test-alias.js vm/tests/test-bhyve-disk-resize.js vm/tests/test-bhyve-pci.js vm/tests/test-bhyve-pci_slot.js vm/tests/test-cleanup-on-failure.js vm/tests/test-create-filesystems.js vm/tests/test-create.js vm/tests/test-defaults.js vm/tests/test-disk-uuid.js vm/tests/test-docker.js vm/tests/test-firewall.js vm/tests/test-fswatcher.js vm/tests/test-hrtime.js vm/tests/test-indestructible.js vm/tests/test-internal_metadata_namespaces.js vm/tests/test-info.js vm/tests/test-lastexited.js vm/tests/test-openonerrlogger.js vm/tests/test-queue.js vm/tests/test-quota.js vm/tests/test-reboot.js vm/tests/test-reprovision.js vm/tests/test-send-recv.js vm/tests/test-snapshots.js vm/tests/test-spoof-opts.js vm/tests/test-sysinfo.js vm/tests/test-tmpfs.js vm/tests/test-update.js vm/tests/test-vrrp-nics.js vm/tests/test-vminfod.js vm/tests/test-vminfod-zonewatcher.js vm/tests/test-vminfod-zonewatcher-overflow.js vm/tests/test-vminfod-zpoolwatcher.js vm/lib/metadata/*.js; do \\\n \techo /tmp/repo/src/$file; \\\n \t/tmp/repo/src/../tools/jsstyle/jsstyle -o indent\u003d4,strict-indent\u003d1,doxygen,unparenthesized-return\u003d0,continuation-at-front\u003d1,leading-right-paren-ok\u003d1 $file; \\\n \t[[ $? \u003d\u003d \"0\" ]] || exit 1; \\\n done)\n /tmp/repo/src/filewait.js\n /tmp/repo/src/node_modules/system.js\n /tmp/repo/src/node_modules/onlyif.js\n /tmp/repo/src/node_modules/net-boot-config.js\n /tmp/repo/src/net-boot-config\n /tmp/repo/src/vm/sbin/add-userscript.js\n /tmp/repo/src/vm/sbin/metadata.js\n /tmp/repo/src/vm/sbin/vmadm.js\n /tmp/repo/src/vm/sbin/vmadmd.js\n /tmp/repo/src/vm/sbin/vmdf.js\n /tmp/repo/src/vm/sbin/vminfo.js\n /tmp/repo/src/vm/sbin/vminfod.js\n /tmp/repo/src/vm/node_modules/diff.js\n /tmp/repo/src/vm/node_modules/dladm.js\n /tmp/repo/src/vm/node_modules/expander.js\n /tmp/repo/src/vm/node_modules/fswatcher.js\n /tmp/repo/src/vm/node_modules/hrtime.js\n /tmp/repo/src/vm/node_modules/ip.js\n /tmp/repo/src/vm/node_modules/nic.js\n /tmp/repo/src/vm/node_modules/proptable.js\n /tmp/repo/src/vm/node_modules/utils.js\n /tmp/repo/src/vm/node_modules/VM.js\n vm/node_modules/VM.js: 16608: improper continuation\n Makefile:465: recipe for target \u0027check\u0027 failed\n make[1]: *** [check] Error 1\n make[1]: Leaving directory \u0027/tmp/repo/src\u0027\n Makefile:387: recipe for target \u0027check\u0027 failed\n gmake: *** [check] Error 2"},{"timestamp":1550096901,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1550245129,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 3: Code-Review+1\n\nLooks fine, probably sightly more clear now."},{"timestamp":1550245208,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 4: Patch Set 3 was rebased"},{"timestamp":1550245260,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4:\n\n\"make check\" passed ok"},{"timestamp":1550248451,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 4:\n\n(2 comments)"},{"timestamp":1550270564,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 4:\n\n(2 comments)"},{"timestamp":1550468594,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 4:\n\n(1 comment)"},{"timestamp":1550598542,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 4:\n\n(1 comment)"},{"timestamp":1550598716,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 4:\n\n(1 comment)"},{"timestamp":1551103652,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Uploaded patch set 5."},{"timestamp":1551103711,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1551106906,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 5: Code-Review+1\n\nIs there a test that can be written for this specifically?  I assume, since this a bug but tests currently pass just fine on the latest master branch that there is not.  Could a test be added to `test-update.js` for instance to resize a VM to trigger this bug, and ensure that this change fixes it?\n\nI ask because I have a change planned soon that may touch logic around `tmpfs` and I don\u0027t want to accidentally reintroduce this bug."},{"timestamp":1551107177,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 5:\n\nLooks good, but could use a test as Dave suggests."}],"currentPatchSet":{"number":"5","revision":"f9f567c0fe1f11be64834b6baeb5789c1a9d4d56","parents":["1633dfcadffd609293a38d9aac697db2fa6e7f90"],"ref":"refs/changes/65/5565/5","uploader":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"createdOn":1551103652,"author":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1551103711,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1551106906,"by":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/vm/node_modules/VM.js","type":"MODIFIED","insertions":5,"deletions":0}],"sizeInsertions":5,"sizeDeletions":0},"patchSets":[{"number":"1","revision":"7e7d1c527585fac9a131fa3e03217f54029df485","parents":["3c1aa42777928dc08c97839aefbb5fbbad7f0228"],"ref":"refs/changes/65/5565/1","uploader":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"createdOn":1549918971,"author":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1550090969,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1550000964,"by":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/vm/node_modules/VM.js","type":"MODIFIED","insertions":7,"deletions":-1}],"sizeInsertions":7,"sizeDeletions":-1},{"number":"2","revision":"ba388d2e3fe4ebe71fe22738213d338f97d68fe9","parents":["c4230b8db6c9877fc3102e87a40bc24bb9e860c6"],"ref":"refs/changes/65/5565/2","uploader":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"createdOn":1550055454,"author":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1550094291,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1550075227,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1550075227,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1550000964,"by":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/vm/node_modules/VM.js","type":"MODIFIED","insertions":7,"deletions":-1}],"sizeInsertions":7,"sizeDeletions":-1},{"number":"3","revision":"22ef838515c8971d4bd5f2a4f6a7e50aebd15514","parents":["c4230b8db6c9877fc3102e87a40bc24bb9e860c6"],"ref":"refs/changes/65/5565/3","uploader":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"createdOn":1550092818,"author":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1550096901,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1550245129,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/vm/node_modules/VM.js","type":"MODIFIED","insertions":6,"deletions":-1}],"sizeInsertions":6,"sizeDeletions":-1},{"number":"4","revision":"029c8faa1b4eb74969330ee28e04e3113b989e55","parents":["10f94f74af8aab34527fae645bbf25b962e10f7f"],"ref":"refs/changes/65/5565/4","uploader":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"createdOn":1550245208,"author":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1550096901,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1550245129,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"comments":[{"file":"src/vm/node_modules/VM.js","line":4609,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"It seems the initial intent was to get an integer, but it would get a string.  Now we are potentially getting a float.\n\nShould the intent be preserved, but ensure we get an integer?  Otherwise I worry that we could end up setting tmpfs to a float value that eventually translates into `mount -F tmpfs -o size\u003d512.5m - /tmp`.  This will fail because `size` must be an integer.\n\n\u003e t \u003d \"4\" / \"3\"\n1.3333333333333333\n\u003e Number(t)\n1.3333333333333333\n\u003e Number(t).toFixed()\n\u00271\u0027\n\u003e Number(t.toFixed())\n1"},{"file":"src/vm/node_modules/VM.js","line":4609,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"This was the only instance of toFixed() in the file.\n\nI can certainly switch this to something more rigorous, but then we have a bigger problem on our hands -- the rest of the file. I\u0027d argue this deserves a separate ticket."},{"file":"src/vm/node_modules/VM.js","line":4609,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"With this fix:\n\n[root@buglets ~]# vmadm get c8d2b761-b0fd-ce85-d7a6-837061e94cce | json max_physical_memory tmpfs\n1024\n1024\n[root@buglets ~]# vmadm update c8d2b761-b0fd-ce85-d7a6-837061e94cce max_physical_memory\u003d1500\nSuccessfully updated VM c8d2b761-b0fd-ce85-d7a6-837061e94cce\n[root@buglets ~]# vmadm get c8d2b761-b0fd-ce85-d7a6-837061e94cce | json max_physical_memory tmpfs\n1500\n1500\n[root@buglets ~]# vmadm update c8d2b761-b0fd-ce85-d7a6-837061e94cce tmpfs\u003d500\nSuccessfully updated VM c8d2b761-b0fd-ce85-d7a6-837061e94cce\n[root@buglets ~]# vmadm get c8d2b761-b0fd-ce85-d7a6-837061e94cce | json max_physical_memory tmpfs\n1500\n500\n[root@buglets ~]# vmadm update c8d2b761-b0fd-ce85-d7a6-837061e94cce max_physical_memory\u003d1000\nInvalid value(s) for: tmpfs\n\n\nIf the fix is not present:\n\n[root@buglets ~]# umount /tmp/VM.js\n[root@buglets ~]# vmadm update c8d2b761-b0fd-ce85-d7a6-837061e94cce max_physical_memory\u003d1000\nSuccessfully updated VM c8d2b761-b0fd-ce85-d7a6-837061e94cce\n[root@buglets ~]# vmadm get c8d2b761-b0fd-ce85-d7a6-837061e94cce | json max_physical_memory tmpfs\n1000\n333"},{"file":"src/vm/node_modules/VM.js","line":4609,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"I don\u0027t think the whole file needs to be taken into account here, it seems like this line is simply a bug (in current `master`)... currently it results in a strinng, when it should result in an integer."},{"file":"src/vm/node_modules/VM.js","line":16611,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"vmadm(1M) says:\n\n       tmpfs:\n\n           This property specifies how much of the VM´s memory will be available\n           for the /tmp filesystem. This is only available for OS VMs, and doesn´t\n           make any sense for HVM VMs.\n\n           If set to 0 this indicates that you would like to not have /tmp mounted\n           as tmpfs at all. When changing to/from a \"0\" value, the VM must be\n           rebooted in order for the change to take effect.\n\nThis code seems to ignore setting tmpfs to 0 rather than removing the tmpfs property (`remove attr name\u003dtmpfs`)."},{"file":"src/vm/node_modules/VM.js","line":16611,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"var tmpfs is taken from the existing VM, not the new changes.\n\nThe code is currently changing an existing VM\u0027s tmpfs from 0 to the payload\u0027s ram value, which I don\u0027t think we want to be doing here. And if we do, vmadm isn\u0027t actually applying that change (the VM\u0027s tmpfs remains 0)."},{"file":"src/vm/node_modules/VM.js","line":16611,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"This code here doesn\u0027t control what properties set, but instead what properties get waited on to be changed by vminfod."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/vm/node_modules/VM.js","type":"MODIFIED","insertions":6,"deletions":-1}],"sizeInsertions":6,"sizeDeletions":-1},{"number":"5","revision":"f9f567c0fe1f11be64834b6baeb5789c1a9d4d56","parents":["1633dfcadffd609293a38d9aac697db2fa6e7f90"],"ref":"refs/changes/65/5565/5","uploader":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"createdOn":1551103652,"author":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1551103711,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1551106906,"by":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/vm/node_modules/VM.js","type":"MODIFIED","insertions":5,"deletions":0}],"sizeInsertions":5,"sizeDeletions":0}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}]}