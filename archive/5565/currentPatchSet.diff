From f9f567c0fe1f11be64834b6baeb5789c1a9d4d56 Mon Sep 17 00:00:00 2001
From: Marsell Kukuljevic <marsell@joyent.com>
Date: Mon, 11 Feb 2019 22:02:20 +0100
Subject: [PATCH] TRITON-1213 VM resize fails when tmpfs is 0 and no tmpfs set
 in package

---
 src/vm/node_modules/VM.js | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/src/vm/node_modules/VM.js b/src/vm/node_modules/VM.js
index 683fa2fe..bbda875b 100644
--- a/src/vm/node_modules/VM.js
+++ b/src/vm/node_modules/VM.js
@@ -16604,6 +16604,11 @@ exports.update = function (uuid, payload, options, callback)
                                 return;
                             }
 
+                            var tmpfs = Number(vmobj.tmpfs);
+                            if (newkey === 'tmpfs' && tmpfs === 0) {
+                                return;
+                            }
+
                             switch (vmobj.brand) {
                             case 'kvm':
                                 v += KVM_MEM_OVERHEAD;
-- 
2.21.0

