commit ba388d2e3fe4ebe71fe22738213d338f97d68fe9 (refs/changes/65/5565/2)
Author: Marsell Kukuljevic <marsell@joyent.com>
Date:   2019-02-13T10:57:34+00:00 (8 months ago)
    
    TRITON-1213 VM resize fails when tmpfs is 0 and no tmpfs set in package

diff --git a/src/vm/node_modules/VM.js b/src/vm/node_modules/VM.js
index 7758ace9..282d2afc 100644
--- a/src/vm/node_modules/VM.js
+++ b/src/vm/node_modules/VM.js
@@ -4606,7 +4606,7 @@ function fixPayloadMemory(payload, vmobj, log)
             // change tmpfs to be the same ratio of ram as before
             payload.tmpfs = ((vmobj.tmpfs / vmobj.max_physical_memory)
                 * payload.max_physical_memory);
-            payload.tmpfs = Number(payload.tmpfs).toFixed();
+            payload.tmpfs = Number(payload.tmpfs);
         } else {
             // tmpfs must be < max_physical_memory, if not: pretend it was
             payload.tmpfs = payload.max_physical_memory;
@@ -16605,6 +16605,12 @@ exports.update = function (uuid, payload, options, callback)
                                 return;
                             }
 
+                            if (newkey === 'tmpfs' &&
+                                Number(vmobj.tmpfs) === 0) {
+
+                                return;
+                            }
+
                             switch (vmobj.brand) {
                             case 'kvm':
                                 v += KVM_MEM_OVERHEAD;
