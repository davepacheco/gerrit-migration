{"project":"joyent/illumos-joyent","branch":"master","id":"I894bc9d4bf2c420c0979780058e5ada957871bc9","number":"4815","subject":"OS-7229 libtopo XML parser doesn\u0027t handle prop type double Reviewed by: Robert Mustacchi \u003crm@joyent.com\u003e Approved by: Jason King \u003cjbk@joyent.com\u003e","owner":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"url":"https://cr.joyent.us/4815","commitMessage":"OS-7229 libtopo XML parser doesn\u0027t handle prop type double\nReviewed by: Robert Mustacchi \u003crm@joyent.com\u003e\nApproved by: Jason King \u003cjbk@joyent.com\u003e\n","createdOn":1536622962,"lastUpdated":1536704772,"open":false,"status":"MERGED","comments":[{"timestamp":1536622962,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Uploaded patch set 1."},{"timestamp":1536623848,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 1:\n\n(2 comments)"},{"timestamp":1536626218,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Uploaded patch set 2."},{"timestamp":1536626282,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Patch Set 2:\n\n(2 comments)"},{"timestamp":1536635900,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 2: Code-Review+1"},{"timestamp":1536693636,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 2: Integration-Approval+1"},{"timestamp":1536694108,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Uploaded patch set 3: Patch Set 2 was rebased."},{"timestamp":1536694261,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Uploaded patch set 4: Commit message was updated."},{"timestamp":1536704713,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Uploaded patch set 5: Patch Set 4 was rebased."},{"timestamp":1536704772,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Rob Johnston"}],"currentPatchSet":{"number":"5","revision":"894bc9d4bf2c420c0979780058e5ada957871bc9","parents":["a1c95bbb7c9625aab345559b448cd77dad78b4b3"],"ref":"refs/changes/15/4815/5","uploader":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"createdOn":1536704713,"author":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1536635900,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1536693636,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"SUBM","value":"1","grantedOn":1536704771,"by":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_parse.h","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_xml.c","type":"MODIFIED","insertions":38,"deletions":-2}],"sizeInsertions":42,"sizeDeletions":-2},"patchSets":[{"number":"1","revision":"85fe1cd555d006d4cceb98d621bffe93c01016a5","parents":["e639e7fb5bc8e8f25f3c1ea960c37baf9fcd5f3f"],"ref":"refs/changes/15/4815/1","uploader":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"createdOn":1536622962,"author":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/lib/fm/topo/libtopo/common/topo_xml.c","line":142,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"strtold is going to return a long double which means that there is implicit truncation going on here. Did you mean to use strtod?"},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_xml.c","line":142,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Doh - yes, I meant to use strtod there.  Fixed"},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_xml.c","line":143,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Do we care about the possibility that we don\u0027t use the entire string in the conversion? It\u0027s not immediately clear to me that strtod isn\u0027t like a strtol where you want to check the end pointer and see that it ended up on a \u0027\\0\u0027 or similar."},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_xml.c","line":143,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Certainly in this context the expectation is that the entire string is the number.  \nThat said, if someone does something like:\n\n\u003cpropval name\u003d\u0027test-double2\u0027 type\u003d\u0027double\u0027 value\u003d\u00271.2345 blah\u0027 /\u003e\n\nthen it will not report a parsing error, as it\u0027s currently written.   I went ahead an added a check that we did indeed use the entire string."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_parse.h","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_xml.c","type":"MODIFIED","insertions":38,"deletions":-2}],"sizeInsertions":42,"sizeDeletions":-2},{"number":"2","revision":"4a46391c85ca8e8f6591791cf606b823cec2c74f","parents":["e639e7fb5bc8e8f25f3c1ea960c37baf9fcd5f3f"],"ref":"refs/changes/15/4815/2","uploader":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"createdOn":1536626218,"author":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1536635900,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1536693636,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_parse.h","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_xml.c","type":"MODIFIED","insertions":38,"deletions":-2}],"sizeInsertions":42,"sizeDeletions":-2},{"number":"3","revision":"4de43eb516da5c74d1edd89209aa3beeadcfc2c3","parents":["6816448c8b777064c5a9cf6729bcfa0efeb29e4f"],"ref":"refs/changes/15/4815/3","uploader":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"createdOn":1536694108,"author":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1536635900,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1536693636,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_parse.h","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_xml.c","type":"MODIFIED","insertions":38,"deletions":-2}],"sizeInsertions":42,"sizeDeletions":-2},{"number":"4","revision":"6ab9e5b9f681724cdd3fc47e2e995419f67e8a40","parents":["6816448c8b777064c5a9cf6729bcfa0efeb29e4f"],"ref":"refs/changes/15/4815/4","uploader":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"createdOn":1536694261,"author":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1536635900,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1536693636,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_parse.h","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_xml.c","type":"MODIFIED","insertions":38,"deletions":-2}],"sizeInsertions":42,"sizeDeletions":-2},{"number":"5","revision":"894bc9d4bf2c420c0979780058e5ada957871bc9","parents":["a1c95bbb7c9625aab345559b448cd77dad78b4b3"],"ref":"refs/changes/15/4815/5","uploader":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"createdOn":1536704713,"author":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1536635900,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1536693636,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"SUBM","value":"1","grantedOn":1536704771,"by":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_parse.h","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_xml.c","type":"MODIFIED","insertions":38,"deletions":-2}],"sizeInsertions":42,"sizeDeletions":-2}],"allReviewers":[{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"}]}