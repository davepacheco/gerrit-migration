{"project":"joyent/illumos-joyent","branch":"vpc","id":"If4173d4e2595097e981aafa08a7dce11e323ce01","number":"4190","subject":"Change svp_vl3_lookup_cb() to cope with portolan that can only be manually hacked so much...","owner":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"url":"https://cr.joyent.us/4190","commitMessage":"Change svp_vl3_lookup_cb() to cope with portolan that can only be manually\nhacked so much...\n","createdOn":1528840730,"lastUpdated":1528847525,"open":false,"status":"MERGED","comments":[{"timestamp":1528840730,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Uploaded patch set 1."},{"timestamp":1528841142,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 1:\n\n(3 comments)"},{"timestamp":1528841517,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 1:\n\n(3 comments)"},{"timestamp":1528841631,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 1: Code-Review+1"},{"timestamp":1528847520,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 1: Integration-Approval+1"},{"timestamp":1528847525,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Dan McDonald"}],"currentPatchSet":{"number":"1","revision":"f4173d4e2595097e981aafa08a7dce11e323ce01","parents":["f3a5dab5a98442a2835cd35f7e46dc50a73630d6"],"ref":"refs/changes/90/4190/1","uploader":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"createdOn":1528840730,"author":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1528841631,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1528847520,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"SUBM","value":"1","grantedOn":1528847524,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}}],"comments":[{"file":"usr/src/lib/varpd/svp/common/libvarpd_svp.c","line":454,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Why is this an arp reply vs. a query reply?"},{"file":"usr/src/lib/varpd/svp/common/libvarpd_svp.c","line":454,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"It was like this prior to the VPC project.  I think it does ARP resolution (VL3 -\u003e VL2) AND VL2 -\u003e UL3.  The svp_vl3_ack message confirms this."},{"file":"usr/src/lib/varpd/svp/common/libvarpd_svp.c","line":472,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"As I mentioned online, we shouldn\u0027t need any special casing for a VL3 lookup -- it\u0027s the VL2 entry that determines whether we switch to routing or not, so it\u0027s the VL2 reply that needs to indicate if the answer is a router or not (and it looks like libvarpd_inject_varp() needs to account for routers)."},{"file":"usr/src/lib/varpd/svp/common/libvarpd_svp.c","line":472,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Excellent.  This whole function may revert to pre-VPC status, and then we instead fix svp_vl2_lookup_cb(), since I *believe* it gets called anyway.  Some userlevel dtracing can confirm/deny my suspicion."},{"file":"usr/src/lib/varpd/svp/common/libvarpd_svp.c","line":505,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Same question here."},{"file":"usr/src/lib/varpd/svp/common/libvarpd_svp.c","line":505,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Same answer:  It was always this way."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"usr/src/lib/varpd/svp/common/libvarpd_svp.c","type":"MODIFIED","insertions":18,"deletions":-5}],"sizeInsertions":18,"sizeDeletions":-5},"patchSets":[{"number":"1","revision":"f4173d4e2595097e981aafa08a7dce11e323ce01","parents":["f3a5dab5a98442a2835cd35f7e46dc50a73630d6"],"ref":"refs/changes/90/4190/1","uploader":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"createdOn":1528840730,"author":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1528841631,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1528847520,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"SUBM","value":"1","grantedOn":1528847524,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}}],"comments":[{"file":"usr/src/lib/varpd/svp/common/libvarpd_svp.c","line":454,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Why is this an arp reply vs. a query reply?"},{"file":"usr/src/lib/varpd/svp/common/libvarpd_svp.c","line":454,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"It was like this prior to the VPC project.  I think it does ARP resolution (VL3 -\u003e VL2) AND VL2 -\u003e UL3.  The svp_vl3_ack message confirms this."},{"file":"usr/src/lib/varpd/svp/common/libvarpd_svp.c","line":472,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"As I mentioned online, we shouldn\u0027t need any special casing for a VL3 lookup -- it\u0027s the VL2 entry that determines whether we switch to routing or not, so it\u0027s the VL2 reply that needs to indicate if the answer is a router or not (and it looks like libvarpd_inject_varp() needs to account for routers)."},{"file":"usr/src/lib/varpd/svp/common/libvarpd_svp.c","line":472,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Excellent.  This whole function may revert to pre-VPC status, and then we instead fix svp_vl2_lookup_cb(), since I *believe* it gets called anyway.  Some userlevel dtracing can confirm/deny my suspicion."},{"file":"usr/src/lib/varpd/svp/common/libvarpd_svp.c","line":505,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Same question here."},{"file":"usr/src/lib/varpd/svp/common/libvarpd_svp.c","line":505,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Same answer:  It was always this way."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"usr/src/lib/varpd/svp/common/libvarpd_svp.c","type":"MODIFIED","insertions":18,"deletions":-5}],"sizeInsertions":18,"sizeDeletions":-5}],"allReviewers":[{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}]}