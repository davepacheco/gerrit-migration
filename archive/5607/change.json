{"project":"joyent/illumos-joyent","branch":"master","id":"If2b29c149057da13a23c7c86492e7baf539e4b7f","number":"5607","subject":"OS-7560 libtopo\u0027s XML serialization code is broken and incomplete OS-7609 fmtopo is missing code to handle properties of type TOPO_TYPE_FMRI_ARRAY Reviewed by: Robert Mustacchi \u003crm@joyent.com\u003e Approved by: Jordan Hendricks \u003cjordan.hendricks@joyent.com\u003e","owner":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"url":"https://cr.joyent.us/5607","commitMessage":"OS-7560 libtopo\u0027s XML serialization code is broken and incomplete\nOS-7609 fmtopo is missing code to handle properties of type TOPO_TYPE_FMRI_ARRAY\nReviewed by: Robert Mustacchi \u003crm@joyent.com\u003e\nApproved by: Jordan Hendricks \u003cjordan.hendricks@joyent.com\u003e\n","createdOn":1550605691,"lastUpdated":1551326200,"open":false,"status":"MERGED","comments":[{"timestamp":1550605691,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Uploaded patch set 1."},{"timestamp":1550615011,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 1:\n\n(17 comments)"},{"timestamp":1550619198,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Uploaded patch set 2."},{"timestamp":1550620451,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Uploaded patch set 3."},{"timestamp":1550620573,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Patch Set 3:\n\n(15 comments)"},{"timestamp":1550622051,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 3: Code-Review+1\n\n(1 comment)"},{"timestamp":1550693323,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Uploaded patch set 4."},{"timestamp":1550693548,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 4:\n\n(1 comment)"},{"timestamp":1550699656,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Uploaded patch set 5."},{"timestamp":1550699672,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Patch Set 5:\n\n(1 comment)"},{"timestamp":1550717014,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 5:\n\n(1 comment)"},{"timestamp":1550780368,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Patch Set 5:\n\n(1 comment)"},{"timestamp":1550785278,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 5:\n\n(1 comment)"},{"timestamp":1550804465,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Uploaded patch set 6."},{"timestamp":1550804498,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Patch Set 5:\n\n(1 comment)"},{"timestamp":1550813627,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Uploaded patch set 7."},{"timestamp":1550813723,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Patch Set 7:\n\nOne last change to topo_2xml.c. See my latest comment in OS-7560 for the rationale here."},{"timestamp":1550851893,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 7:\n\n(1 comment)"},{"timestamp":1550866732,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Uploaded patch set 8."},{"timestamp":1550866833,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Patch Set 7:\n\n(1 comment)"},{"timestamp":1550872070,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 8: Code-Review+1"},{"timestamp":1551215878,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Patch Set 8:\n\nI\u0027m updating this CR with the changes for OS-7609.  I also modified the changes to topo_xml.c to reduce code duplication with dealing with the numeric array types.  Finally I updated the the ticket for OS-7560 to include additional testing details."},{"timestamp":1551215890,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Uploaded patch set 9."},{"timestamp":1551220831,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 9:\n\n(3 comments)"},{"timestamp":1551226706,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Patch Set 9:\n\n(2 comments)"},{"timestamp":1551233727,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 9: Code-Review+1\n\n(1 comment)"},{"timestamp":1551306413,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Patch Set 9: Integration-Approval+1"},{"timestamp":1551312934,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Uploaded patch set 10: Commit message was updated."},{"timestamp":1551312974,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Uploaded patch set 11: Patch Set 10 was rebased."},{"timestamp":1551326200,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Rob Johnston"}],"currentPatchSet":{"number":"11","revision":"f2b29c149057da13a23c7c86492e7baf539e4b7f","parents":["7895a719812f7049054cb9b3fb04d28893f0af16"],"ref":"refs/changes/07/5607/11","uploader":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"createdOn":1551312974,"author":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1551233727,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1551306413,"by":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"}},{"type":"SUBM","value":"1","grantedOn":1551326200,"by":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/cmd/fm/fmtopo/common/fmtopo.c","type":"MODIFIED","insertions":30,"deletions":-24},{"file":"usr/src/lib/fm/topo/libtopo/Makefile.com","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_2xml.c","type":"MODIFIED","insertions":206,"deletions":-76},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_xml.c","type":"MODIFIED","insertions":18,"deletions":-30}],"sizeInsertions":255,"sizeDeletions":-130},"patchSets":[{"number":"1","revision":"657eb212b19cb2a02a1bfe8369699418bbb70287","parents":["9ecb333d56db4baf68b07887f9fbd5eae0698d89"],"ref":"refs/changes/07/5607/1","uploader":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"createdOn":1550605691,"author":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/lib/fm/topo/libtopo/common/topo_2xml.c","line":141,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Is the convention that unsigned integers are in hex to distinguish them from signed ones?"},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_2xml.c","line":141,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"TBH, I\u0027m not sure what the original intention was here, but I suspect it was indeed to make it easier to distinguish negative values.  I\u0027ve gone ahead and changed the code so that signed ints are always printed with %d or PRId64 and unsigned ints are printed with %x or PRIx64."},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_2xml.c","line":154,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"What is the expectation around the formatting of integers? Why are some in hex and some decimal? Part of my confusion here is the cast to a longlong_t, but then printing it in a way that ignores the signedness. Should be also be using the PRId64/PRIx64 macros?"},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_2xml.c","line":154,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"see previous comment"},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_2xml.c","line":167,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Seems like we should use PRIx64 and avoid the cast."},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_2xml.c","line":167,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_2xml.c","line":229,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"nelem is a uint_t."},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_2xml.c","line":229,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_2xml.c","line":230,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"snprintf?"},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_2xml.c","line":230,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_2xml.c","line":249,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"nelem is a uint_t."},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_2xml.c","line":249,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_2xml.c","line":250,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"snprintf"},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_2xml.c","line":250,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_2xml.c","line":269,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"nelem is a uint_t."},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_2xml.c","line":269,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_2xml.c","line":270,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"If you\u0027re going to use llx, shouldn\u0027t the int64_t be case to a longlong_t? Though see the other comments around this. Also snprintf?"},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_2xml.c","line":270,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Changed to PRId64"},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_2xml.c","line":289,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"nelem is a uint_t."},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_2xml.c","line":289,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_2xml.c","line":290,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"See +270."},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_2xml.c","line":309,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"nelem is a uint_t."},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_2xml.c","line":309,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_2xml.c","line":313,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"nelem is a uint_t"},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_2xml.c","line":313,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_2xml.c","line":316,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Maybe we should make strarr_free from topo_xml.c usable for this?"},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_2xml.c","line":316,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"I\u0027ve actually got another change in the pipe that will address this and other similar bits of code scattered in libtopo:\n\nOS-6707 Add topo module and hdl api for freeing string array"},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_2xml.c","line":316,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"OK, great. That seems even better."},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_2xml.c","line":333,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Why do we begin at one for this and not zero?"},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_2xml.c","line":333,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"nelem is a uint_t"},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_2xml.c","line":333,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_2xml.c","line":341,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"nelem is a uint_t"},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_2xml.c","line":341,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/Makefile.com","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_2xml.c","type":"MODIFIED","insertions":183,"deletions":-73}],"sizeInsertions":184,"sizeDeletions":-73},{"number":"2","revision":"720ad44ee60f1d54a7779bd6d8701ebc0749b8b3","parents":["9ecb333d56db4baf68b07887f9fbd5eae0698d89"],"ref":"refs/changes/07/5607/2","uploader":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"createdOn":1550619198,"author":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/Makefile.com","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_2xml.c","type":"MODIFIED","insertions":182,"deletions":-73}],"sizeInsertions":183,"sizeDeletions":-73},{"number":"3","revision":"039001b5a0231a70cfee653e6cd33c1b95523d62","parents":["9ecb333d56db4baf68b07887f9fbd5eae0698d89"],"ref":"refs/changes/07/5607/3","uploader":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"createdOn":1550620451,"author":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1550622051,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/Makefile.com","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_2xml.c","type":"MODIFIED","insertions":193,"deletions":-75}],"sizeInsertions":194,"sizeDeletions":-75},{"number":"4","revision":"744eb9e3a0dd7d74c50eaa7d2e515a3705fb4219","parents":["9ecb333d56db4baf68b07887f9fbd5eae0698d89"],"ref":"refs/changes/07/5607/4","uploader":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"createdOn":1550693323,"author":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/lib/fm/topo/libtopo/common/topo_xml.c","line":121,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Don\u0027t we need to properly zero and check errno to make sure that this is OK? I\u0027m not sure that the check below this between str and estr is correct. I know this wasn\u0027t introduced by your change, but feels like we may want to clean it up."},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_xml.c","line":121,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Yeah, I think you\u0027re right.  The handing of the endptr param is bit hard to figure out from the man page.  But when I look at how other places in ON check for errors, the most common pattern is something like:\n\nerrno\u003d0;\nval \u003d strtoull(str, \u0026estr, base);\nif (errno !\u003d 0 || *estr !\u003d \u0027\\0\u0027)\n    /* error */\n\nChecking that estr points to a NUL char is presumably to check if the entire string was converted as opposed to a partial conversion.  Looks like checking if str \u003d estr only works in the case of a total conversion failure.\n\nAnyways, I\u0027ve cleaned up all the various places in topo_xml.c that were doing str to num conversions to be consistent."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/Makefile.com","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_2xml.c","type":"MODIFIED","insertions":193,"deletions":-75},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_xml.c","type":"MODIFIED","insertions":17,"deletions":-5}],"sizeInsertions":211,"sizeDeletions":-80},{"number":"5","revision":"4b8f0cc2baf582c6eababf3579eaa2c00463f716","parents":["9ecb333d56db4baf68b07887f9fbd5eae0698d89"],"ref":"refs/changes/07/5607/5","uploader":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"createdOn":1550699656,"author":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/lib/fm/topo/libtopo/common/topo_2xml.c","line":189,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Apologies for not noticing this originally, but I was rereading the manual page and I believe that %a includes the leading 0x on it. Can you confirm whether or not it does and make sure double serialization and reconstitution are part of the test plan?"},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_2xml.c","line":189,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Yeah, upon testing I found that it does automatically add the \"0x\". On the parsing side, I had to change xmlattr_to_double() to use strold() instead of strtod().  With that change it\u0027s able to parse values in both PI notation and standard decimal notation.\n\nTo test this change I\u0027ve built a custom topo map that exercises all of the prop types and then I verify that I can parse it, serialize it and then parse the serialized output."},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_xml.c","line":315,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Was it intentional that this should not parse in any arbitrary base beyond base 10?"},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_xml.c","line":315,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"No, I think it was just an oversight made long ago by former self."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/Makefile.com","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_2xml.c","type":"MODIFIED","insertions":193,"deletions":-75},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_xml.c","type":"MODIFIED","insertions":41,"deletions":-9}],"sizeInsertions":235,"sizeDeletions":-84},{"number":"6","revision":"f1b682a382a98e2b66aad6ca612d78d661186bc6","parents":["9ecb333d56db4baf68b07887f9fbd5eae0698d89"],"ref":"refs/changes/07/5607/6","uploader":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"createdOn":1550804465,"author":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/Makefile.com","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_2xml.c","type":"MODIFIED","insertions":193,"deletions":-75},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_xml.c","type":"MODIFIED","insertions":42,"deletions":-10}],"sizeInsertions":236,"sizeDeletions":-85},{"number":"7","revision":"fb3f9818da3f1de118243882d983ceab1bcffbe9","parents":["9ecb333d56db4baf68b07887f9fbd5eae0698d89"],"ref":"refs/changes/07/5607/7","uploader":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"createdOn":1550813627,"author":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/lib/fm/topo/libtopo/common/topo_2xml.c","line":398,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Would you mind adding a bit of the comment you put in the ticket explaining why it should not be static here? I think that\u0027ll make sure it\u0027s easy to find that in the future."},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_2xml.c","line":398,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/Makefile.com","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_2xml.c","type":"MODIFIED","insertions":194,"deletions":-76},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_xml.c","type":"MODIFIED","insertions":42,"deletions":-10}],"sizeInsertions":237,"sizeDeletions":-86},{"number":"8","revision":"e851454aa6edf254f204b7e8b1bb73a5a086d1f5","parents":["9ecb333d56db4baf68b07887f9fbd5eae0698d89"],"ref":"refs/changes/07/5607/8","uploader":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"createdOn":1550866732,"author":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1550872070,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/Makefile.com","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_2xml.c","type":"MODIFIED","insertions":206,"deletions":-76},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_xml.c","type":"MODIFIED","insertions":42,"deletions":-10}],"sizeInsertions":249,"sizeDeletions":-86},{"number":"9","revision":"899d651709b26850c7e1c7fba465ff8794fbaed3","parents":["9ecb333d56db4baf68b07887f9fbd5eae0698d89"],"ref":"refs/changes/07/5607/9","uploader":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"createdOn":1551215890,"author":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1551233727,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1551306413,"by":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"}}],"comments":[{"file":"usr/src/cmd/fm/fmtopo/common/fmtopo.c","line":473,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I guess dumping the nvlist that makes the most sense here?"},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_xml.c","line":123,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Does strtoull properly handle the case where we have negative values? If so, what does it translate it to?"},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_xml.c","line":123,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"It performs a unary negation of the value.  And if the result would overflow, it sets errno to ERANGE.  I did test with negative numbers and it appears to work correctly."},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_xml.c","line":310,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"With this and all the other cases that are now using xmlattr_to_int, do we care about the fact that they\u0027re potentially truncating a larger value into the current one?"},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_xml.c","line":310,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"We were already doing this for the non-array uint32/int32, so it\u0027s not exactly a new thing per se\n\nI could add code to compare ui to INT32_MAX or UINT32_MAX before casting it and then return an error if it\u0027s greater?\n\nIt would be nice if the topo XML schema would leverage XML\u0027s support for numeric types - I don\u0027t know why they made everything strings."},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_xml.c","line":310,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"OK, if we\u0027re already doing it, then probably not worth changing things here. Thanks for the clarification."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"usr/src/cmd/fm/fmtopo/common/fmtopo.c","type":"MODIFIED","insertions":30,"deletions":-24},{"file":"usr/src/lib/fm/topo/libtopo/Makefile.com","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_2xml.c","type":"MODIFIED","insertions":206,"deletions":-76},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_xml.c","type":"MODIFIED","insertions":18,"deletions":-30}],"sizeInsertions":255,"sizeDeletions":-130},{"number":"10","revision":"039b678d50c1eeecb1b39866ed59d7a98d9f71ab","parents":["9ecb333d56db4baf68b07887f9fbd5eae0698d89"],"ref":"refs/changes/07/5607/10","uploader":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"createdOn":1551312934,"author":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1551233727,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1551306413,"by":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/cmd/fm/fmtopo/common/fmtopo.c","type":"MODIFIED","insertions":30,"deletions":-24},{"file":"usr/src/lib/fm/topo/libtopo/Makefile.com","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_2xml.c","type":"MODIFIED","insertions":206,"deletions":-76},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_xml.c","type":"MODIFIED","insertions":18,"deletions":-30}],"sizeInsertions":255,"sizeDeletions":-130},{"number":"11","revision":"f2b29c149057da13a23c7c86492e7baf539e4b7f","parents":["7895a719812f7049054cb9b3fb04d28893f0af16"],"ref":"refs/changes/07/5607/11","uploader":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"createdOn":1551312974,"author":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1551233727,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1551306413,"by":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"}},{"type":"SUBM","value":"1","grantedOn":1551326200,"by":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/cmd/fm/fmtopo/common/fmtopo.c","type":"MODIFIED","insertions":30,"deletions":-24},{"file":"usr/src/lib/fm/topo/libtopo/Makefile.com","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_2xml.c","type":"MODIFIED","insertions":206,"deletions":-76},{"file":"usr/src/lib/fm/topo/libtopo/common/topo_xml.c","type":"MODIFIED","insertions":18,"deletions":-30}],"sizeInsertions":255,"sizeDeletions":-130}],"allReviewers":[{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"}]}