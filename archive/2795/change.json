{"project":"joyent/illumos-joyent","branch":"master","id":"I3942697fd5a28d8766c93571074d5704d56fc016","number":"2795","subject":"OS-6402 SMB ioctl fixes incomplete Reviewed by: Alex Wilson \u003calex.wilson@joyent.com\u003e Reviewed by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e Reviewed by: Rui Loura \u003crui.loura@joyent.com\u003e Approved by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e","owner":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"url":"https://cr.joyent.us/2795","commitMessage":"OS-6402 SMB ioctl fixes incomplete\nReviewed by: Alex Wilson \u003calex.wilson@joyent.com\u003e\nReviewed by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e\nReviewed by: Rui Loura \u003crui.loura@joyent.com\u003e\nApproved by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e\n","createdOn":1508198530,"lastUpdated":1509635926,"open":false,"status":"MERGED","comments":[{"timestamp":1508198530,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Uploaded patch set 1."},{"timestamp":1508198585,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 1:\n\nReview with an eye toward missing length checks.  I think I got the ones that matter, but I could be wrong."},{"timestamp":1508245966,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 1: Code-Review+1\n\nI\u0027m not familiar with SMB, but from what I see, this looks good."},{"timestamp":1508261762,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Patch Set 1:\n\n(2 comments)"},{"timestamp":1508285103,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Uploaded patch set 2."},{"timestamp":1508285179,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 1:\n\n(2 comments)"},{"timestamp":1508285598,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"Patch Set 2: Code-Review+1"},{"timestamp":1508352259,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 2: Code-Review+1"},{"timestamp":1508355426,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 2:\n\nI will need to test these, and according to Gordon, I will need to hack my own fake libsmbsrv-like callers (which use the ioctls in question) directly.  I may include them in usr/src/test afterwards.\n\nThanks for your reviews."},{"timestamp":1508457565,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Uploaded patch set 3."},{"timestamp":1508458417,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 3:\n\nPer Alex Wilson and Ben Murphy, additional uint32_t overflow checks."},{"timestamp":1508506893,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1509025042,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Patch Set 3: Code-Review+1\n\n(1 comment)\n\nI am not familiar with SMB, but I don\u0027t see any obvious issues here."},{"timestamp":1509044023,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 3:\n\n(1 comment)\n\nWill refactor bits of kshare per Rui\u0027s suggestion."},{"timestamp":1509073274,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Uploaded patch set 4."},{"timestamp":1509073326,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 4:\n\n\u003e Uploaded patch set 4.\n\nRefactored per Rui\u0027s suggestion.  More LoC, but more readable too."},{"timestamp":1509110444,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 4: Code-Review+1\n\nThis is a nice improvement."},{"timestamp":1509110683,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Patch Set 4: Integration-Approval+1"},{"timestamp":1509110699,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Patch Set 4: Code-Review+1 -Integration-Approval"},{"timestamp":1509110726,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Patch Set 4:\n\nLGTM"},{"timestamp":1509475055,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 4:\n\nTesting this is turning into a nightmare.  FYI."},{"timestamp":1509481302,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Patch Set 4:\n\nLooks good"},{"timestamp":1509599116,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 4: Code-Review+1"},{"timestamp":1509630010,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Uploaded patch set 5: Patch Set 4 was rebased."},{"timestamp":1509630185,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Uploaded patch set 6: Commit message was updated."},{"timestamp":1509630205,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 6:\n\nUpdated testing notes in the bug report."},{"timestamp":1509630945,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 6: Integration-Approval+1"},{"timestamp":1509635917,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Uploaded patch set 7: Commit message was updated."},{"timestamp":1509635926,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Dan McDonald"}],"currentPatchSet":{"number":"7","revision":"3942697fd5a28d8766c93571074d5704d56fc016","parents":["5f694814304876e7d02ac81701220b11cf7fc897"],"ref":"refs/changes/95/2795/7","uploader":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"createdOn":1509635917,"author":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1509110444,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1509110699,"by":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1509599116,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1509630945,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"SUBM","value":"1","grantedOn":1509635926,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"usr/src/uts/common/fs/smbsrv/smb_kshare.c","type":"MODIFIED","insertions":44,"deletions":0},{"file":"usr/src/uts/common/fs/smbsrv/smb_server.c","type":"MODIFIED","insertions":22,"deletions":0},{"file":"usr/src/uts/common/smbsrv/smb_ioctl.h","type":"MODIFIED","insertions":1,"deletions":0}],"sizeInsertions":67,"sizeDeletions":0},"patchSets":[{"number":"1","revision":"e2a50442eae8bb553cf913b9cbd8ef450b75ffde","parents":["15f634b506331928cba41f373c773cea1abd271d"],"ref":"refs/changes/95/2795/1","uploader":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"createdOn":1508198530,"author":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1508245966,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"comments":[{"file":"usr/src/uts/common/fs/smbsrv/smb_kshare.c","line":480,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"extra space."},{"file":"usr/src/uts/common/fs/smbsrv/smb_kshare.c","line":480,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Done"},{"file":"usr/src/uts/common/fs/smbsrv/smb_server.c","line":857,"reviewer":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},"message":"extra space ?"},{"file":"usr/src/uts/common/fs/smbsrv/smb_server.c","line":857,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/fs/smbsrv/smb_kshare.c","type":"MODIFIED","insertions":18,"deletions":0},{"file":"usr/src/uts/common/fs/smbsrv/smb_server.c","type":"MODIFIED","insertions":17,"deletions":0},{"file":"usr/src/uts/common/smbsrv/smb_ioctl.h","type":"MODIFIED","insertions":1,"deletions":0}],"sizeInsertions":36,"sizeDeletions":0},{"number":"2","revision":"343e1f6ca0ac09d71ccd8a8c8ea1646956479e06","parents":["8359acfb8fd4655b7437bff72bed36033caf5420"],"ref":"refs/changes/95/2795/2","uploader":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"createdOn":1508285103,"author":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1508352259,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1508285598,"by":{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/fs/smbsrv/smb_kshare.c","type":"MODIFIED","insertions":19,"deletions":0},{"file":"usr/src/uts/common/fs/smbsrv/smb_server.c","type":"MODIFIED","insertions":17,"deletions":0},{"file":"usr/src/uts/common/smbsrv/smb_ioctl.h","type":"MODIFIED","insertions":1,"deletions":0}],"sizeInsertions":37,"sizeDeletions":0},{"number":"3","revision":"c0765b952da23cae8e029610bb71e2b4a68e4ecb","parents":["1a3f7c04071d710e1e98c08e641aaf54a3f14842"],"ref":"refs/changes/95/2795/3","uploader":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"createdOn":1508457565,"author":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1508506893,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1509025042,"by":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"}}],"comments":[{"file":"usr/src/uts/common/fs/smbsrv/smb_kshare.c","line":492,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Would it make sense to factor these hunks out?"},{"file":"usr/src/uts/common/fs/smbsrv/smb_kshare.c","line":492,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Yeah, it might."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/fs/smbsrv/smb_kshare.c","type":"MODIFIED","insertions":27,"deletions":0},{"file":"usr/src/uts/common/fs/smbsrv/smb_server.c","type":"MODIFIED","insertions":22,"deletions":0},{"file":"usr/src/uts/common/smbsrv/smb_ioctl.h","type":"MODIFIED","insertions":1,"deletions":0}],"sizeInsertions":50,"sizeDeletions":0},{"number":"4","revision":"2c52359a33c8e028be7a6e0171d4b15891b6a023","parents":["daa3911f02365820bf2df2a1cdf96602eda66912"],"ref":"refs/changes/95/2795/4","uploader":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"createdOn":1509073274,"author":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1509599116,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1509110444,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1509110699,"by":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/fs/smbsrv/smb_kshare.c","type":"MODIFIED","insertions":44,"deletions":0},{"file":"usr/src/uts/common/fs/smbsrv/smb_server.c","type":"MODIFIED","insertions":22,"deletions":0},{"file":"usr/src/uts/common/smbsrv/smb_ioctl.h","type":"MODIFIED","insertions":1,"deletions":0}],"sizeInsertions":67,"sizeDeletions":0},{"number":"5","revision":"2395023f43a63f47f464b940bf0f1bbc4a5bbbc2","parents":["5f694814304876e7d02ac81701220b11cf7fc897"],"ref":"refs/changes/95/2795/5","uploader":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"createdOn":1509630010,"author":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1509599116,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1509110444,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1509110699,"by":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/fs/smbsrv/smb_kshare.c","type":"MODIFIED","insertions":44,"deletions":0},{"file":"usr/src/uts/common/fs/smbsrv/smb_server.c","type":"MODIFIED","insertions":22,"deletions":0},{"file":"usr/src/uts/common/smbsrv/smb_ioctl.h","type":"MODIFIED","insertions":1,"deletions":0}],"sizeInsertions":67,"sizeDeletions":0},{"number":"6","revision":"5551d41048000dcc76f1fb613d10a39380c595d6","parents":["5f694814304876e7d02ac81701220b11cf7fc897"],"ref":"refs/changes/95/2795/6","uploader":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"createdOn":1509630185,"author":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1509599116,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1509110444,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1509630945,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1509110699,"by":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/uts/common/fs/smbsrv/smb_kshare.c","type":"MODIFIED","insertions":44,"deletions":0},{"file":"usr/src/uts/common/fs/smbsrv/smb_server.c","type":"MODIFIED","insertions":22,"deletions":0},{"file":"usr/src/uts/common/smbsrv/smb_ioctl.h","type":"MODIFIED","insertions":1,"deletions":0}],"sizeInsertions":67,"sizeDeletions":0},{"number":"7","revision":"3942697fd5a28d8766c93571074d5704d56fc016","parents":["5f694814304876e7d02ac81701220b11cf7fc897"],"ref":"refs/changes/95/2795/7","uploader":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"createdOn":1509635917,"author":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1509599116,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1509110444,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1509630945,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"SUBM","value":"1","grantedOn":1509635926,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1509110699,"by":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"usr/src/uts/common/fs/smbsrv/smb_kshare.c","type":"MODIFIED","insertions":44,"deletions":0},{"file":"usr/src/uts/common/fs/smbsrv/smb_server.c","type":"MODIFIED","insertions":22,"deletions":0},{"file":"usr/src/uts/common/smbsrv/smb_ioctl.h","type":"MODIFIED","insertions":1,"deletions":0}],"sizeInsertions":67,"sizeDeletions":0}],"allReviewers":[{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},{"name":"Tim Kordas","email":"tim.kordas@joyent.com","username":"timkordas"},{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}]}