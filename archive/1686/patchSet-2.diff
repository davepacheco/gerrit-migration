From da1a9150b3d4c2ab3afb20f36295707ff64ad8dc Mon Sep 17 00:00:00 2001
From: Alex Wilson <alex.wilson@joyent.com>
Date: Fri, 17 Mar 2017 13:29:20 -0700
Subject: [PATCH] CNS-198 Peer version failure neglects to call callback; leaks
 redis handle Reviewed by: Richard Kiene <richard.kiene@joyent.com>

---
 lib/dns-server.js | 1 +
 1 file changed, 1 insertion(+)

diff --git a/lib/dns-server.js b/lib/dns-server.js
index 03510b1..5cc3451 100644
--- a/lib/dns-server.js
+++ b/lib/dns-server.js
@@ -1083,6 +1083,7 @@ DNSServer.prototype.handleTransfer = function (q, z, cb) {
 						log.debug(perr,
 						    'unable to detect peer ' +
 						    'version');
+						ccb(perr);
 						return;
 					}
 					_.redis.set('peer:' +
-- 
2.21.0

