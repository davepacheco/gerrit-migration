commit da1a9150b3d4c2ab3afb20f36295707ff64ad8dc (refs/changes/86/1686/2)
Author: Alex Wilson <alex.wilson@joyent.com>
Date:   2017-03-17T20:59:40+00:00 (2 years, 7 months ago)
    
    CNS-198 Peer version failure neglects to call callback; leaks redis handle
    Reviewed by: Richard Kiene <richard.kiene@joyent.com>

diff --git a/lib/dns-server.js b/lib/dns-server.js
index 03510b1..5cc3451 100644
--- a/lib/dns-server.js
+++ b/lib/dns-server.js
@@ -1083,6 +1083,7 @@ DNSServer.prototype.handleTransfer = function (q, z, cb) {
 						log.debug(perr,
 						    'unable to detect peer ' +
 						    'version');
+						ccb(perr);
 						return;
 					}
 					_.redis.set('peer:' +
