{"project":"joyent/sdcadm","branch":"master","id":"Ic5dc2e08d928afffbe5e1ef35f9e948a061e6a87","number":"4909","subject":"TRITON-818 etc/sample-packages.json update for bhyve Reviewed by: Mike Gerdts \u003cmike.gerdts@joyent.com\u003e Reviewed by: Trent Mick \u003ctrentm@gmail.com\u003e Approved by: Trent Mick \u003ctrentm@gmail.com\u003e","owner":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"url":"https://cr.joyent.us/4909","commitMessage":"TRITON-818 etc/sample-packages.json update for bhyve\nReviewed by: Mike Gerdts \u003cmike.gerdts@joyent.com\u003e\nReviewed by: Trent Mick \u003ctrentm@gmail.com\u003e\nApproved by: Trent Mick \u003ctrentm@gmail.com\u003e\n","createdOn":1538491933,"lastUpdated":1539619578,"open":false,"status":"MERGED","comments":[{"timestamp":1538491933,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 1."},{"timestamp":1538491938,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit f6a1d5a7604af909aeaafad4490295d19f2242dc\n    \n    TRITON-818 etc/sample-packages.json update for bhyve"},{"timestamp":1538491992,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1538492107,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 1:\n\nApart of adding new sample packages for Bhyve, I\u0027ve added the brand attribute to both, bhyve and KVM packages after a conversation with Mike. Quoting literally:\n\n\"I think that TRITON-780, IMAGE-1135, and TRITON-190 were leading us down the path to having distinct packages for kvm and bhyve (brand set in each).  Otherwise, we need TRITON-190 reversed to enable the triton cli to provision each brand.\"\n\nSounds correct?"},{"timestamp":1538603512,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 1:\n\nHow about just dropping the \"sample-kvm-*\" packages (basically undoing most of TOOLS-1798, which didn\u0027t really provide justification) and add vcpus\u003d1 values on all the non-KVM sample packages?  I.e. we don\u0027t have brand-specific packages at all in the default set. There is no current usage of \"sample-kvm-*\" in any of our repos (at least that I found). AFAICT there is no diff in params in the kvm vs non-kvm sample packages."},{"timestamp":1538607201,"reviewer":{"name":"Angela Fong","email":"angela.fong@joyent.com","username":"askfongjojo"},"message":"Patch Set 1:\n\nTwo things:\n1) We probably want to keep the kvm packages without a brand attribute in it. Cloudapi will interpret that as \"not brand specific\". This will mimic what we have in the public cloud. This way we can catch any brand conflict that may happen in prod.\n2) The kvm/bhyve packages actually should have the \"vcpus\" value set. It\u0027s strange that we never had that for the kvm packages."},{"timestamp":1538607576,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 1:\n\nAngela,\n\n\u003e 1) We probably want to keep the kvm packages without a brand attribute in it. Cloudapi will interpret that as \"not brand specific\". This will mimic what we have in the public cloud. This way we can catch any brand conflict that may happen in prod.\n\nWe can do that same with sample packages that just don\u0027t have \"kvm\" in the name. I\u0027m saying just have packages like this:\n\n    {\n      \"name\": \"sample-1G\",\n      \"version\": \"1.0.0\",\n      \"active\": true,\n      \"max_lwps\": 4000,\n      \"max_physical_memory\": 1024,\n      \"max_swap\": 4096,\n      \"quota\": 25600,\n      \"zfs_io_priority\": 64,\n      \"fss\": 64,\n      \"cpu_cap\": 100,\n      \"vcpus\": 1,\n      \"billing_tag\": \"sample-1G\",\n      \"default\": true,\n      \"v\": 1\n    },\n\nwhich can be used for any brand.\n\n\n\u003e 2) The kvm/bhyve packages actually should have the \"vcpus\" value set. It\u0027s strange that we never had that for the kvm packages.\n\nWe do. E.g. current sample package: https://github.com/joyent/sdcadm/blob/master/etc/sample-packages.json#L164"},{"timestamp":1538607766,"reviewer":{"name":"Angela Fong","email":"angela.fong@joyent.com","username":"askfongjojo"},"message":"Patch Set 1:\n\nSorry I\u0027ve somehow looked at the wrong thing. Yes you are right, we can just keep to one set of non-bhyve sample-* packages once we\u0027ve added vcpus to it."},{"timestamp":1538663630,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 2."},{"timestamp":1538663635,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit f31647abfcf4493d7721a08ab96fdc576aa88211\n    \n    TRITON-818 etc/sample-packages.json update for bhyve"},{"timestamp":1538663682,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1538663694,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 2:\n\nDone as suggested, single set of sample packages, including `vcpus\u003d1` starting with sample-1G"},{"timestamp":1538698312,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 2:\n\n(1 comment)\n\nIt might be confusing to have KVM prov fail on the smaller packages because vcpus isn\u0027t defined."},{"timestamp":1538753371,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 3."},{"timestamp":1538753375,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 3:\n\nNew commits:\n    \n    commit 51fdb2042ad0c6c81d30310afee6b7eab4e5e019\n    \n    TRITON-818 etc/sample-packages.json update for bhyve"},{"timestamp":1538753423,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1538753468,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 3:\n\n(1 comment)\n\nAdded also for the small packages"},{"timestamp":1538759310,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1539181711,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 3:\n\n/me waves! Can I get IA+1 here?"},{"timestamp":1539195958,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 3: Code-Review+1 Integration-Approval+1"},{"timestamp":1539619560,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 4: Commit message was updated."},{"timestamp":1539619578,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Pedro Palazón Candel"}],"currentPatchSet":{"number":"4","revision":"c5dc2e08d928afffbe5e1ef35f9e948a061e6a87","parents":["fb29c87545fca89f9d003dff675060ce6c4fae56"],"ref":"refs/changes/09/4909/4","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1539619560,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1538753423,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1538759310,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1539195958,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1539195958,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1539619578,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"etc/sample-packages.json","type":"MODIFIED","insertions":23,"deletions":-59}],"sizeInsertions":23,"sizeDeletions":-59},"patchSets":[{"number":"1","revision":"48087b20d122b67555ef43e6b6ae9812d297487f","parents":["fb29c87545fca89f9d003dff675060ce6c4fae56"],"ref":"refs/changes/09/4909/1","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1538491933,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1538491992,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"etc/sample-packages.json","type":"MODIFIED","insertions":58,"deletions":-3}],"sizeInsertions":58,"sizeDeletions":-3},{"number":"2","revision":"8fc2c53075f38258c30a54235157ecf255b380f8","parents":["fb29c87545fca89f9d003dff675060ce6c4fae56"],"ref":"refs/changes/09/4909/2","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1538663630,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1538663682,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"etc/sample-packages.json","line":15,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"not on these smaller sample packages?"},{"file":"etc/sample-packages.json","line":15,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Not sure we want to create a KVM with these but, still, added"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"etc/sample-packages.json","type":"MODIFIED","insertions":14,"deletions":-56}],"sizeInsertions":14,"sizeDeletions":-56},{"number":"3","revision":"f2de7a74bec7a6c27e6ee2635bc12ef145f93f5c","parents":["fb29c87545fca89f9d003dff675060ce6c4fae56"],"ref":"refs/changes/09/4909/3","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1538753371,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1538753423,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1539195958,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1539195958,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1538759310,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"etc/sample-packages.json","type":"MODIFIED","insertions":23,"deletions":-59}],"sizeInsertions":23,"sizeDeletions":-59},{"number":"4","revision":"c5dc2e08d928afffbe5e1ef35f9e948a061e6a87","parents":["fb29c87545fca89f9d003dff675060ce6c4fae56"],"ref":"refs/changes/09/4909/4","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1539619560,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1538753423,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1539195958,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1539195958,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1539619578,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1538759310,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"etc/sample-packages.json","type":"MODIFIED","insertions":23,"deletions":-59}],"sizeInsertions":23,"sizeDeletions":-59}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},{"name":"Angela Fong","email":"angela.fong@joyent.com","username":"askfongjojo"}]}