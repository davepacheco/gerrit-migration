{"project":"joyent/node-triton","branch":"master","id":"I4921fd2e360ff0ad6204affdf1e7ebcd0460a7eb","number":"5020","subject":"joyent/node-triton#259 \"triton ssh\" could support proxying through a bastion host Reviewed by: Tim Foster \u003ctim.foster@joyent.com\u003e Approved by: Brian Bennett \u003cbrian.bennett@joyent.com\u003e","owner":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"url":"https://cr.joyent.us/5020","commitMessage":"joyent/node-triton#259 \"triton ssh\" could support proxying through a bastion host\nReviewed by: Tim Foster \u003ctim.foster@joyent.com\u003e\nApproved by: Brian Bennett \u003cbrian.bennett@joyent.com\u003e\n","createdOn":1541111793,"lastUpdated":1545093659,"open":false,"status":"MERGED","comments":[{"timestamp":1541111793,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Uploaded patch set 1."},{"timestamp":1541111822,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1541113098,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Uploaded patch set 2."},{"timestamp":1541113127,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1541113197,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Uploaded patch set 3."},{"timestamp":1541113225,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1542218078,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1542300747,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Patch Set 3:\n\n(2 comments)"},{"timestamp":1543522752,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Uploaded patch set 4."},{"timestamp":1543522785,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1543522974,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Patch Set 4:\n\n(2 comments)\n\nI have provided an updated rendered copy of the new help message in the github issue; i.e., https://github.com/joyent/node-triton/issues/259"},{"timestamp":1543601212,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Patch Set 4:\n\n(1 comment)"},{"timestamp":1543604699,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Patch Set 4:\n\n(1 comment)"},{"timestamp":1544194380,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Patch Set 4: Code-Review+1\n\nThat looks much better - thanks for making those changes."},{"timestamp":1544638305,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Patch Set 4: Integration-Approval+1\n\n(1 comment)"},{"timestamp":1545093642,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Uploaded patch set 5: Commit message was updated."},{"timestamp":1545093659,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Joshua M. Clulow"}],"currentPatchSet":{"number":"5","revision":"4921fd2e360ff0ad6204affdf1e7ebcd0460a7eb","parents":["05f1bae869a2761315d6a9bb69d474bfdb94fbe9"],"ref":"refs/changes/20/5020/5","uploader":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"createdOn":1545093642,"author":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1543522785,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1544194380,"by":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1544638305,"by":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"}},{"type":"SUBM","value":"1","grantedOn":1545093659,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":9,"deletions":0},{"file":"lib/do_instance/do_ssh.js","type":"MODIFIED","insertions":208,"deletions":-6},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":218,"sizeDeletions":-7},"patchSets":[{"number":"1","revision":"3673e654d99a846be3869a8bb88b5ef9a1c40851","parents":["05f1bae869a2761315d6a9bb69d474bfdb94fbe9"],"ref":"refs/changes/20/5020/1","uploader":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"createdOn":1541111793,"author":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1541111822,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":9,"deletions":0},{"file":"lib/do_instance/do_ssh.js","type":"MODIFIED","insertions":94,"deletions":-3},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":104,"sizeDeletions":-4},{"number":"2","revision":"5c6b3f859b42eaa4ec1d2e39ed9da02e0e12e628","parents":["05f1bae869a2761315d6a9bb69d474bfdb94fbe9"],"ref":"refs/changes/20/5020/2","uploader":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"createdOn":1541113098,"author":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1541113127,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":9,"deletions":0},{"file":"lib/do_instance/do_ssh.js","type":"MODIFIED","insertions":94,"deletions":-3},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":104,"sizeDeletions":-4},{"number":"3","revision":"64c05b90d6bdb89bcffbdd6982d6fb07b205edfc","parents":["05f1bae869a2761315d6a9bb69d474bfdb94fbe9"],"ref":"refs/changes/20/5020/3","uploader":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"createdOn":1541113197,"author":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1541113225,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1542218078,"by":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"}}],"comments":[{"file":"lib/do_instance/do_ssh.js","line":159,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"Do we really want to hardcode \u0027root\u0027 here rather than propagating the \u0027user\u0027 option we\u0027re using elsewhere?\n\nIt\u0027s probably overkill to add more configuration for \u0027bastionUser\u0027, and although \u0027root\u0027 might be the correct user most of the time, it feels weird to hardcode it."},{"file":"lib/do_instance/do_ssh.js","line":159,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"You\u0027re right, this is definitely not great.  I have expanded the logic a little, and added a new tag.  I\u0027ve also added a comment that tries to cover all the different ways I think this could usefully work now!"},{"file":"lib/do_instance/do_ssh.js","line":234,"reviewer":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},"message":"but regardless of whether we do choose to hardcode root or not, we ought to talk about which user gets chosen in the help here."},{"file":"lib/do_instance/do_ssh.js","line":234,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":9,"deletions":0},{"file":"lib/do_instance/do_ssh.js","type":"MODIFIED","insertions":93,"deletions":-3},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":103,"sizeDeletions":-4},{"number":"4","revision":"6144468d19a7236e392bb389886f44fe28351740","parents":["05f1bae869a2761315d6a9bb69d474bfdb94fbe9"],"ref":"refs/changes/20/5020/4","uploader":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"createdOn":1543522752,"author":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1543522785,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1544638305,"by":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1544194380,"by":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"}}],"comments":[{"file":"lib/do_instance/do_ssh.js","line":252,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Should we use admin for joyent brand zones?"},{"file":"lib/do_instance/do_ssh.js","line":252,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"I\u0027m using the same logic that regular SSH into the zone uses, which is currently \"root\" when there\u0027s no image tag.  I think that\u0027s probably the most likely to work for most people -- they won\u0027t be able to remove the \"root\" account, but they can easily remove \"admin\"."},{"file":"lib/do_instance/do_ssh.js","line":252,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Works for me."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":9,"deletions":0},{"file":"lib/do_instance/do_ssh.js","type":"MODIFIED","insertions":208,"deletions":-6},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":218,"sizeDeletions":-7},{"number":"5","revision":"4921fd2e360ff0ad6204affdf1e7ebcd0460a7eb","parents":["05f1bae869a2761315d6a9bb69d474bfdb94fbe9"],"ref":"refs/changes/20/5020/5","uploader":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"createdOn":1545093642,"author":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"SUBM","value":"1","grantedOn":1545093659,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1543522785,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1544638305,"by":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1544194380,"by":{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":9,"deletions":0},{"file":"lib/do_instance/do_ssh.js","type":"MODIFIED","insertions":208,"deletions":-6},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":218,"sizeDeletions":-7}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},{"name":"Tim Foster","email":"tim.foster@joyent.com","username":"timfoster"},{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}]}