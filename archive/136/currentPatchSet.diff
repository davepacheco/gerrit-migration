From 450b1cf9d89fd0c946b8efc673e2beb4cfdaca89 Mon Sep 17 00:00:00 2001
From: Johanan Lai <lai.johanan@gmail.com>
Date: Tue, 26 Jul 2016 15:50:19 -0700
Subject: [PATCH] ADMINUI-2323 UUID should be validated similar to searching
 with IP and MAC address parameters

---
 lib/vms.js | 17 +++++++++++++++--
 1 file changed, 15 insertions(+), 2 deletions(-)

diff --git a/lib/vms.js b/lib/vms.js
index 9600f103..4c9ff4d2 100644
--- a/lib/vms.js
+++ b/lib/vms.js
@@ -109,13 +109,26 @@ var IPV4_REGEX =
     (/^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$/);
 var MAC_REGEX =
     (/^([0-9A-Fa-f]{2}:){5}([0-9A-Fa-f]{2})$/);
+var UUID_REGEX =
+    (/^[a-f0-9]{8}-([a-f0-9]{4}-){3}[a-f0-9]{12}$/);
 
 function list(req, res, next) {
     var params = req.params;
     var ip = params.ip;
     var mac = params.mac;
+
+    if (params.uuid) {
+        if (!UUID_REGEX.test(params.uuid)) {
+            return next(
+                new errors.InvalidParameterError('Invalid UUID', [ {
+                    field: 'uuid',
+                    code: 'invalid',
+                    message: sprintf('UUID %s is not a valid UUID', params.uuid)
+                } ]));
+        }
+    }
     if (ip) {
-        if (false === IPV4_REGEX.test(ip)) {
+        if (!IPV4_REGEX.test(ip)) {
             return next(
                 new errors.InvalidParameterError('Invalid IP Address', [ {
                     field: 'ip',
@@ -125,7 +138,7 @@ function list(req, res, next) {
         }
         return listVmsWithIP(ip);
     } else if (mac) {
-        if (false === MAC_REGEX.test(mac)) {
+        if (!MAC_REGEX.test(mac)) {
             return next(
                 new errors.InvalidParameterError('Invalid MAC Address', [ {
                     field: 'mac',
-- 
2.21.0

