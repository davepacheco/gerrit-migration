commit ab23085efa6be175db18420903229f1c2cb7e88f (refs/changes/36/136/2)
Author: Johanan Lai <lai.johanan@gmail.com>
Date:   2016-07-25T17:13:49-07:00 (3 years, 2 months ago)
    
    ADMINUI-2323 UUID should be validated similar to searching with IP and MAC address parameters

diff --git a/lib/vms.js b/lib/vms.js
index 9600f103..052eac1e 100644
--- a/lib/vms.js
+++ b/lib/vms.js
@@ -109,6 +109,8 @@ var IPV4_REGEX =
     (/^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$/);
 var MAC_REGEX =
     (/^([0-9A-Fa-f]{2}:){5}([0-9A-Fa-f]{2})$/);
+var UUID_REGEX =
+    (/^[a-f0-9]{8}-([a-f0-9]{4}-){3}[a-f0-9]{12}$/);
 
 function list(req, res, next) {
     var params = req.params;
@@ -234,7 +236,16 @@ function list(req, res, next) {
             {headers: getRequestHeaders(req)},
             function listMachinesCb(err, vms, _req, _res)
         {
-            if (err) {
+            if (params.uuid) {
+                if (false === UUID_REGEX.test(params.uuid)) {
+                    return next(
+                        new errors.InvalidParameterError('Invalid UUID', [ {
+                            field: 'uuid',
+                            code: 'invalid',
+                            message: sprintf('UUID %s is not a valid UUID', params.uuid)
+                        } ]));
+                }
+            } else if (err) {
                 req.log.error(err, 'Error retrieving Virtual Machines');
                 return next(err);
             }
