{"project":"joyent/sdc-cloudapi","branch":"master","id":"I03830f8ea379758c13afc9267c8545b4efb59ae3","number":"3412","subject":"TRITON-125 add cloudapi support for bhyve Reviewed by: Marsell Kukuljevic \u003cmarsell@joyent.com\u003e Reviewed by: Trent Mick \u003ctrentm@gmail.com\u003e Approved by: Trent Mick \u003ctrentm@gmail.com\u003e","owner":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"url":"https://cr.joyent.us/3412","commitMessage":"TRITON-125 add cloudapi support for bhyve\nReviewed by: Marsell Kukuljevic \u003cmarsell@joyent.com\u003e\nReviewed by: Trent Mick \u003ctrentm@gmail.com\u003e\nApproved by: Trent Mick \u003ctrentm@gmail.com\u003e\n","createdOn":1518848686,"lastUpdated":1519164383,"open":false,"status":"MERGED","comments":[{"timestamp":1518848686,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Uploaded patch set 1."},{"timestamp":1518848687,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit 8412044226c50997cc99454208c29694a889af41\n    \n    initial support for bhyve brand"},{"timestamp":1518848730,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Uploaded patch set 2: Patch Set 1 was rebased."},{"timestamp":1518848731,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit ab234692140bce70a4920fb514338c46589ffe9a\n    \n    initial support for bhyve brand"},{"timestamp":1518856130,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 2: Code-Review+1\n\n(4 comments)\n\nThis needs a test provisioning and a test listing a bhyve instance. Maybe a test attempting to resize a bhyve instance too."},{"timestamp":1518899346,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Uploaded patch set 3."},{"timestamp":1518899347,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 3:\n\nNew commits:\n    \n    commit fbbadd70a8ce22ed0a5c527b40330b6f01a21126\n    \n    address CR feedback"},{"timestamp":1518899357,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 3:\n\n(4 comments)"},{"timestamp":1518928275,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1519077162,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 3: Code-Review+1 Integration-Approval+1\n\nMarsell,\n\nRegarding tests: Josh and I discussed it for this and the other related tickets --\nTRITON-124 (node-triton), TRITON-126 (vmapi), and TRITON-128 (cnapi). We decided\nit was overkill to add a test bhyve provision at all 4 levels, at least with the\ncurrent state that (almost) all tests are integration tests, i.e. actual\nprovisions rather than just functionality tests talking to mocks. Therefore\nI\u0027d like to let these go through review with just an actual bhyve provision\ntest in one of the repos (we chose node-triton).\n\nLonger term and more general, Josh and I discussed an idea to bias away from\nintegration tests at all levels to having *functional tests* of API interfaces\nin each repo that talk (typically) to mocks. Then we would have a fewer set\nof test suites that do full *integration tests* of Triton -- e.g. perhaps\none test suite for customer facing API tests (i.e. whatever you can do\nas a customer via cloudapi, sdc-docker, cmon, et al), plus a test suite for\nthe promised interface for an operator (adminui, sapi, etc.)\n\nWe haven\u0027t formalized or written anything down here yet though, so apologies for\nthat."},{"timestamp":1519084805,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1519084813,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1519084931,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2:\n\n\"make check\" passed ok"},{"timestamp":1519085261,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1519164378,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Uploaded patch set 4: Commit message was updated."},{"timestamp":1519164383,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Josh Wilsdon"}],"currentPatchSet":{"number":"4","revision":"03830f8ea379758c13afc9267c8545b4efb59ae3","parents":["db71da4d670af7db1ccbb86ae505cf970d179413"],"ref":"refs/changes/12/3412/4","uploader":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"createdOn":1519164378,"author":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1518928275,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1519077162,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1519077162,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1519085261,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"SUBM","value":"1","grantedOn":1519164383,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":26,"deletions":-19},{"file":"lib/machines.js","type":"MODIFIED","insertions":47,"deletions":-20},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"plugins/provision_limits.js","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":76,"sizeDeletions":-42},"patchSets":[{"number":"1","revision":"5b3363cd90b9c57144a2e10760f66075a4c2b3db","parents":["0373d31f8ca1b71f302c335c34d5d17a409784aa"],"ref":"refs/changes/12/3412/1","uploader":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"createdOn":1518848686,"author":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1519084805,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":26,"deletions":-19},{"file":"lib/machines.js","type":"MODIFIED","insertions":33,"deletions":-10},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"plugins/provision_limits.js","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":62,"sizeDeletions":-32},{"number":"2","revision":"80354a58ffb8f6b69fb9d47240f08becfbfd880b","parents":["db71da4d670af7db1ccbb86ae505cf970d179413"],"ref":"refs/changes/12/3412/2","uploader":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"createdOn":1518848730,"author":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1519084813,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1518856130,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}}],"comments":[{"file":"docs/index.md","line":358,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"instances"},{"file":"docs/index.md","line":358,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Done"},{"file":"docs/index.md","line":4356,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"I\u0027d indicated somewhere what the set of acceptable brands are (kvm, bhyve, joyent)."},{"file":"docs/index.md","line":4356,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Done"},{"file":"lib/machines.js","line":916,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"This logic was too tangled to begin with. I suggest getting rid of at least one of the ternary operators."},{"file":"lib/machines.js","line":916,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Done"},{"file":"lib/machines.js","line":1298,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"KVM or bhyve"},{"file":"lib/machines.js","line":1298,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":26,"deletions":-19},{"file":"lib/machines.js","type":"MODIFIED","insertions":33,"deletions":-10},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"plugins/provision_limits.js","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":62,"sizeDeletions":-32},{"number":"3","revision":"45e39e9a6680c75873ae751cadb892550499ff26","parents":["db71da4d670af7db1ccbb86ae505cf970d179413"],"ref":"refs/changes/12/3412/3","uploader":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"createdOn":1518899346,"author":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1519085261,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1519077162,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1519077162,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1518928275,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":26,"deletions":-19},{"file":"lib/machines.js","type":"MODIFIED","insertions":47,"deletions":-20},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"plugins/provision_limits.js","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":76,"sizeDeletions":-42},{"number":"4","revision":"03830f8ea379758c13afc9267c8545b4efb59ae3","parents":["db71da4d670af7db1ccbb86ae505cf970d179413"],"ref":"refs/changes/12/3412/4","uploader":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"createdOn":1519164378,"author":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1519085261,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1519077162,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1519077162,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1519164383,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1518928275,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":26,"deletions":-19},{"file":"lib/machines.js","type":"MODIFIED","insertions":47,"deletions":-20},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"plugins/provision_limits.js","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":76,"sizeDeletions":-42}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}]}