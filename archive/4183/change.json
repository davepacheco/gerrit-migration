{"project":"joyent/illumos-joyent","branch":"master","id":"I0e23d370e331acbebe8ad55ddb59eb475b05405a","number":"4183","subject":"OS-7010 update sys/elf.h for recent processors like aarch64/risc-v Reviewed by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e Reviewed by: Richard Lowe \u003crichlowe@richlowe.net\u003e Reviewed by: Jake Saferstein \u003cjake.saferstein@joyent.com\u003e Approved by: Jerry Jelinek","owner":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"url":"https://cr.joyent.us/4183","commitMessage":"OS-7010 update sys/elf.h for recent processors like aarch64/risc-v\nReviewed by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e\nReviewed by: Richard Lowe \u003crichlowe@richlowe.net\u003e\nReviewed by: Jake Saferstein \u003cjake.saferstein@joyent.com\u003e\nApproved by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e\n","createdOn":1528752205,"lastUpdated":1530197967,"open":false,"status":"MERGED","comments":[{"timestamp":1528752205,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Uploaded patch set 1."},{"timestamp":1528754405,"reviewer":{"name":"Jake Saferstein","email":"jake.saferstein@joyent.com","username":"TheSafo"},"message":"Patch Set 1: Code-Review+1"},{"timestamp":1528754415,"reviewer":{"name":"Jake Saferstein","email":"jake.saferstein@joyent.com","username":"TheSafo"},"message":"Patch Set 1: -Code-Review"},{"timestamp":1528755105,"reviewer":{"name":"Rich Lowe","email":"richlowe@richlowe.net","username":"richlowe"},"message":"Patch Set 1: Code-Review+1"},{"timestamp":1528763422,"reviewer":{"name":"Jake Saferstein","email":"jake.saferstein@joyent.com","username":"TheSafo"},"message":"Patch Set 1: Code-Review+1"},{"timestamp":1528804546,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 1: Code-Review+1"},{"timestamp":1528844346,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Uploaded patch set 2."},{"timestamp":1528844707,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 2:\n\nWhat is the reason for the new changes? Is this something we should have caught in our previous review?"},{"timestamp":1528845279,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 2:\n\nThere were a few issues. But basically there was a gap in the entries that I didn\u0027t account for. Particularly there is no entry 182 or 184, those that surround AARCH64. This causes the elf message logic to therefore treat everything after that point as two less. There were also one or two other bugs with using the properly named table. Most of this was discovered by testing."},{"timestamp":1528889882,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 2:\n\n(3 comments)"},{"timestamp":1528908269,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Uploaded patch set 3."},{"timestamp":1528908270,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 2:\n\n(3 comments)"},{"timestamp":1528910829,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1528914852,"reviewer":{"name":"Jake Saferstein","email":"jake.saferstein@joyent.com","username":"TheSafo"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1529012294,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 3: Integration-Approval+1"},{"timestamp":1529013597,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Uploaded patch set 4."},{"timestamp":1529013622,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 3:\n\nApologies for the additional update, I double checked pbchk and realized I had forgotten to clean up a few of the entries in file."},{"timestamp":1529018841,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 4: Code-Review+1 Integration-Approval+1"},{"timestamp":1529432458,"reviewer":{"name":"Jake Saferstein","email":"jake.saferstein@joyent.com","username":"TheSafo"},"message":"Patch Set 4:\n\n(1 comment)"},{"timestamp":1529435627,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 4:\n\n(1 comment)"},{"timestamp":1529436927,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Uploaded patch set 5."},{"timestamp":1529439951,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 5: Code-Review+1"},{"timestamp":1529447299,"reviewer":{"name":"Jake Saferstein","email":"jake.saferstein@joyent.com","username":"TheSafo"},"message":"Patch Set 5: Code-Review+1"},{"timestamp":1530196908,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Uploaded patch set 6: Patch Set 5 was rebased."},{"timestamp":1530197118,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 6: Integration-Approval+1"},{"timestamp":1530197967,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Robert Mustacchi"}],"currentPatchSet":{"number":"6","revision":"0e23d370e331acbebe8ad55ddb59eb475b05405a","parents":["9d61057f7fe1fe7aa75aaff08c48fe66778261c6"],"ref":"refs/changes/83/4183/6","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1530196908,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1529439951,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1529447299,"by":{"name":"Jake Saferstein","email":"jake.saferstein@joyent.com","username":"TheSafo"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1530197118,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"SUBM","value":"1","grantedOn":1530197967,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"usr/src/cmd/file/file.c","type":"MODIFIED","insertions":181,"deletions":-96},{"file":"usr/src/cmd/sgs/libconv/common/elf.c","type":"MODIFIED","insertions":297,"deletions":-36},{"file":"usr/src/cmd/sgs/libconv/common/elf.msg","type":"MODIFIED","insertions":220,"deletions":0},{"file":"usr/src/uts/common/sys/elf.h","type":"MODIFIED","insertions":241,"deletions":-89}],"sizeInsertions":939,"sizeDeletions":-221},"patchSets":[{"number":"1","revision":"a751d84f5d7a8675a6cbf0243bf396cc3a809501","parents":["e2369459ab12f803d44f6b49c6f48b06f28c7f9f"],"ref":"refs/changes/83/4183/1","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1528752205,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1528804546,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1528755105,"by":{"name":"Rich Lowe","email":"richlowe@richlowe.net","username":"richlowe"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1528763422,"by":{"name":"Jake Saferstein","email":"jake.saferstein@joyent.com","username":"TheSafo"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/file/file.c","type":"MODIFIED","insertions":194,"deletions":-96},{"file":"usr/src/cmd/sgs/libconv/common/elf.c","type":"MODIFIED","insertions":265,"deletions":-36},{"file":"usr/src/cmd/sgs/libconv/common/elf.msg","type":"MODIFIED","insertions":220,"deletions":0},{"file":"usr/src/uts/common/sys/elf.h","type":"MODIFIED","insertions":241,"deletions":-89}],"sizeInsertions":920,"sizeDeletions":-221},{"number":"2","revision":"018ec65ae9d848fec929dfab880bf1eca43a51c0","parents":["e2369459ab12f803d44f6b49c6f48b06f28c7f9f"],"ref":"refs/changes/83/4183/2","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1528844346,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/cmd/sgs/libconv/common/elf.c","line":407,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"As best I can see, this array is now exactly the same as the mach_160_181_dmp array on line 433? Is this correct and if so, do you need to have two copies?"},{"file":"usr/src/cmd/sgs/libconv/common/elf.c","line":407,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"So this kind of varies and is a bit inconsistent. We basically sometimes have this variant name for a handful of architectures that we actually support. Based on my understanding here I think it\u0027s worth keeping them separate for now so if we want to come back and modify individual ones, we can."},{"file":"usr/src/cmd/sgs/libconv/common/elf.c","line":469,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"I have the same question about this array and the dmp array at line 512."},{"file":"usr/src/cmd/sgs/libconv/common/elf.c","line":469,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"See above."},{"file":"usr/src/cmd/sgs/libconv/common/elf.c","line":470,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"trailing whitespace here and at 492 and 514"},{"file":"usr/src/cmd/sgs/libconv/common/elf.c","line":470,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/file/file.c","type":"MODIFIED","insertions":194,"deletions":-96},{"file":"usr/src/cmd/sgs/libconv/common/elf.c","type":"MODIFIED","insertions":297,"deletions":-36},{"file":"usr/src/cmd/sgs/libconv/common/elf.msg","type":"MODIFIED","insertions":220,"deletions":0},{"file":"usr/src/uts/common/sys/elf.h","type":"MODIFIED","insertions":241,"deletions":-89}],"sizeInsertions":952,"sizeDeletions":-221},{"number":"3","revision":"743818205ade777906dcb35e3ced4d61993d9be6","parents":["e2369459ab12f803d44f6b49c6f48b06f28c7f9f"],"ref":"refs/changes/83/4183/3","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1528908269,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1528910829,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1529012294,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1528914852,"by":{"name":"Jake Saferstein","email":"jake.saferstein@joyent.com","username":"TheSafo"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/file/file.c","type":"MODIFIED","insertions":194,"deletions":-96},{"file":"usr/src/cmd/sgs/libconv/common/elf.c","type":"MODIFIED","insertions":297,"deletions":-36},{"file":"usr/src/cmd/sgs/libconv/common/elf.msg","type":"MODIFIED","insertions":220,"deletions":0},{"file":"usr/src/uts/common/sys/elf.h","type":"MODIFIED","insertions":241,"deletions":-89}],"sizeInsertions":952,"sizeDeletions":-221},{"number":"4","revision":"c7f1e285d00dcc74effb688f09116e60a2f00fb2","parents":["a5f014c173362ac2af00648d1184575a91522acd"],"ref":"refs/changes/83/4183/4","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1529013597,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1529018841,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1529018841,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"comments":[{"file":"usr/src/cmd/sgs/libconv/common/elf.c","line":431,"reviewer":{"name":"Jake Saferstein","email":"jake.saferstein@joyent.com","username":"TheSafo"},"message":"Is there a reason the right half are CF while left half are NF here?"},{"file":"usr/src/cmd/sgs/libconv/common/elf.c","line":431,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"No, they should all be _NF. Just missed a /g on the vi replace. Thanks for catching that."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"usr/src/cmd/file/file.c","type":"MODIFIED","insertions":181,"deletions":-96},{"file":"usr/src/cmd/sgs/libconv/common/elf.c","type":"MODIFIED","insertions":297,"deletions":-36},{"file":"usr/src/cmd/sgs/libconv/common/elf.msg","type":"MODIFIED","insertions":220,"deletions":0},{"file":"usr/src/uts/common/sys/elf.h","type":"MODIFIED","insertions":241,"deletions":-89}],"sizeInsertions":939,"sizeDeletions":-221},{"number":"5","revision":"bb8966adfc56dba052f8a763a4421bfac3d68b4b","parents":["a5f014c173362ac2af00648d1184575a91522acd"],"ref":"refs/changes/83/4183/5","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1529436927,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1529439951,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1529447299,"by":{"name":"Jake Saferstein","email":"jake.saferstein@joyent.com","username":"TheSafo"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"usr/src/cmd/file/file.c","type":"MODIFIED","insertions":181,"deletions":-96},{"file":"usr/src/cmd/sgs/libconv/common/elf.c","type":"MODIFIED","insertions":297,"deletions":-36},{"file":"usr/src/cmd/sgs/libconv/common/elf.msg","type":"MODIFIED","insertions":220,"deletions":0},{"file":"usr/src/uts/common/sys/elf.h","type":"MODIFIED","insertions":241,"deletions":-89}],"sizeInsertions":939,"sizeDeletions":-221},{"number":"6","revision":"0e23d370e331acbebe8ad55ddb59eb475b05405a","parents":["9d61057f7fe1fe7aa75aaff08c48fe66778261c6"],"ref":"refs/changes/83/4183/6","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1530196908,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"SUBM","value":"1","grantedOn":1530197967,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1529439951,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1530197118,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1529447299,"by":{"name":"Jake Saferstein","email":"jake.saferstein@joyent.com","username":"TheSafo"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"usr/src/cmd/file/file.c","type":"MODIFIED","insertions":181,"deletions":-96},{"file":"usr/src/cmd/sgs/libconv/common/elf.c","type":"MODIFIED","insertions":297,"deletions":-36},{"file":"usr/src/cmd/sgs/libconv/common/elf.msg","type":"MODIFIED","insertions":220,"deletions":0},{"file":"usr/src/uts/common/sys/elf.h","type":"MODIFIED","insertions":241,"deletions":-89}],"sizeInsertions":939,"sizeDeletions":-221}],"allReviewers":[{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},{"name":"Rich Lowe","email":"richlowe@richlowe.net","username":"richlowe"},{"name":"Jake Saferstein","email":"jake.saferstein@joyent.com","username":"TheSafo"},{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}]}