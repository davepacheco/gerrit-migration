{"project":"joyent/firewall-logger-agent","branch":"master","id":"Icc77145a564a256cf0d3575f96eb5d42deeaf00f","number":"6617","subject":"TRITON-1820 cfwlogd tries to change into non existent directory","owner":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"url":"https://cr.joyent.us/6617","commitMessage":"TRITON-1820 cfwlogd tries to change into non existent directory\n","createdOn":1563391911,"lastUpdated":1563393750,"open":false,"status":"MERGED","comments":[{"timestamp":1563391911,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Uploaded patch set 1."},{"timestamp":1563391987,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1563392784,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1563392933,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1563393354,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 1: Code-Review+1\n\n(1 comment)"},{"timestamp":1563393721,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 1: Integration-Approval+1"},{"timestamp":1563393750,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Michael Zeller"}],"currentPatchSet":{"number":"1","revision":"cc77145a564a256cf0d3575f96eb5d42deeaf00f","parents":["13092413b2e92c1ae9d1b95cedec7f0ed729ab38"],"ref":"refs/changes/17/6617/1","uploader":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"createdOn":1563391911,"author":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1563391987,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1563393354,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1563393721,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"SUBM","value":"1","grantedOn":1563393750,"by":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"}}],"comments":[{"file":"cfwlogd/src/main.rs","line":214,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"This is effectively doing a chroot(LOG_DIR).  Based on the ticket description, the problem is that the directory doesn\u0027t exist when the program starts, so it cannot chdir into it.  The change appears to just change when the chdir occurs (from the demonize step, to immediately prior to calling chroot(2)).  That suggests that somehow the directory is getting created between the old location of the chdir call and the new one, but I cannot find where that\u0027s being done."},{"file":"cfwlogd/src/main.rs","line":214,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"It\u0027s already being done on line 213."},{"file":"cfwlogd/src/main.rs","line":214,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Doh. right in front of my face!"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"cfwlogd/src/main.rs","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":1,"sizeDeletions":-1},"patchSets":[{"number":"1","revision":"cc77145a564a256cf0d3575f96eb5d42deeaf00f","parents":["13092413b2e92c1ae9d1b95cedec7f0ed729ab38"],"ref":"refs/changes/17/6617/1","uploader":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"createdOn":1563391911,"author":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1563391987,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"SUBM","value":"1","grantedOn":1563393750,"by":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1563393354,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1563393721,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}}],"comments":[{"file":"cfwlogd/src/main.rs","line":214,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"This is effectively doing a chroot(LOG_DIR).  Based on the ticket description, the problem is that the directory doesn\u0027t exist when the program starts, so it cannot chdir into it.  The change appears to just change when the chdir occurs (from the demonize step, to immediately prior to calling chroot(2)).  That suggests that somehow the directory is getting created between the old location of the chdir call and the new one, but I cannot find where that\u0027s being done."},{"file":"cfwlogd/src/main.rs","line":214,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"It\u0027s already being done on line 213."},{"file":"cfwlogd/src/main.rs","line":214,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Doh. right in front of my face!"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"cfwlogd/src/main.rs","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":1,"sizeDeletions":-1}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}]}