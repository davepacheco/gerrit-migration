{"project":"joyent/sdc-imgapi","branch":"master","id":"I323b6c520cc841c947d34cf2aa1ebce0f5765c18","number":"5685","subject":"TRITON-1275 imgapi runtests colorization induces spurious failures Reviewed by: Trent Mick \u003ctrentm@gmail.com\u003e Reviewed by: Todd Whiteman \u003ctodd.whiteman@joyent.com\u003e Approved by: Trent Mick \u003ctrentm@gmail.com\u003e Approved by: Todd Whiteman \u003ctodd.whiteman@joyent","owner":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"url":"https://cr.joyent.us/5685","commitMessage":"TRITON-1275 imgapi runtests colorization induces spurious failures\nReviewed by: Trent Mick \u003ctrentm@gmail.com\u003e\nReviewed by: Todd Whiteman \u003ctodd.whiteman@joyent.com\u003e\nApproved by: Trent Mick \u003ctrentm@gmail.com\u003e\nApproved by: Todd Whiteman \u003ctodd.whiteman@joyent.com\u003e\n","createdOn":1551472614,"lastUpdated":1551803284,"open":false,"status":"MERGED","comments":[{"timestamp":1551472614,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Uploaded patch set 1."},{"timestamp":1551472647,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1551475064,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Patch Set 1: Code-Review+1 Integration-Approval+1"},{"timestamp":1551717441,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 1: Integration-Approval-1\n\n(1 comment)"},{"timestamp":1551727522,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1551744331,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 1: Code-Review+1 Integration-Approval+1\n\n(1 comment)"},{"timestamp":1551803280,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"Patch Set 2: Commit message was updated."},{"timestamp":1551803284,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Chris Burroughs"}],"currentPatchSet":{"number":"2","revision":"f6ae03bf838f5ce281999aeb5fe3d4ab83662bf0","parents":["376367045cc9072ea7eebc0a18549b5d486f34e1"],"ref":"refs/changes/85/5685/2","uploader":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"createdOn":1551803280,"author":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1551472647,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1551475064,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1551475064,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1551744331,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1551744331,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1551803284,"by":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"test/runtests","type":"MODIFIED","insertions":2,"deletions":-32}],"sizeInsertions":2,"sizeDeletions":-32},"patchSets":[{"number":"1","revision":"323b6c520cc841c947d34cf2aa1ebce0f5765c18","parents":["376367045cc9072ea7eebc0a18549b5d486f34e1"],"ref":"refs/changes/85/5685/1","uploader":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"createdOn":1551472614,"author":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1551472647,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1551744331,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1551744331,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1551475064,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1551475064,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}}],"comments":[{"file":"test/runtests","line":308,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Does that work with the pipe through `| tee ...`?\n\n```\n[11:22:05 trentm@bluesteel:~/joy/sdc-imgapi (master)]\n$ python -c \u0027import sys; sys.exit(4)\u0027\n[08:36:50 trentm@bluesteel:~/joy/sdc-imgapi (master)]\n$ echo $?\n4\n[08:36:51 trentm@bluesteel:~/joy/sdc-imgapi (master)]\n$ python -c \u0027import sys; sys.exit(4)\u0027 | tee foo.out\n[08:36:59 trentm@bluesteel:~/joy/sdc-imgapi (master)]\n$ echo $?\n0\n```"},{"file":"test/runtests","line":308,"reviewer":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"message":"It should work because the script sets pipefail\n\n[root@e21c8f57-ec56-4423-90ee-71442eb563eb (nightly-3:imgapi0) /tmp]# $(exit 4) | tee\n[root@e21c8f57-ec56-4423-90ee-71442eb563eb (nightly-3:imgapi0) /tmp]# echo $?\n0\n[root@e21c8f57-ec56-4423-90ee-71442eb563eb (nightly-3:imgapi0) /tmp]# set -o pipefail\n[root@e21c8f57-ec56-4423-90ee-71442eb563eb (nightly-3:imgapi0) /tmp]# $(exit 4) | tee\n[root@e21c8f57-ec56-4423-90ee-71442eb563eb (nightly-3:imgapi0) /tmp]# echo $?\n4"},{"file":"test/runtests","line":308,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Ah, good point. Thanks."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"test/runtests","type":"MODIFIED","insertions":2,"deletions":-32}],"sizeInsertions":2,"sizeDeletions":-32},{"number":"2","revision":"f6ae03bf838f5ce281999aeb5fe3d4ab83662bf0","parents":["376367045cc9072ea7eebc0a18549b5d486f34e1"],"ref":"refs/changes/85/5685/2","uploader":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"createdOn":1551803280,"author":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1551472647,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1551744331,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1551744331,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1551475064,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1551475064,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}},{"type":"SUBM","value":"1","grantedOn":1551803284,"by":{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"test/runtests","type":"MODIFIED","insertions":2,"deletions":-32}],"sizeInsertions":2,"sizeDeletions":-32}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},{"name":"Chris Burroughs","email":"chris.burroughs@joyent.com","username":"cburroughs"}]}