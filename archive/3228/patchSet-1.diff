From e21e9b51edf42c86bad90e061b7be7150cfeb932 Mon Sep 17 00:00:00 2001
From: Julien Gilli <julien.gilli@joyent.com>
Date: Wed, 17 Jan 2018 10:43:15 -0800
Subject: [PATCH] VOLAPI-101 docker test assertion failure when NFS support is
 disabled

---
 test/integration/api-create-invalid-names.test.js | 8 ++++++--
 test/lib/volumes-api.js                           | 2 --
 2 files changed, 6 insertions(+), 4 deletions(-)

diff --git a/test/integration/api-create-invalid-names.test.js b/test/integration/api-create-invalid-names.test.js
index 1dbe23f..7b00708 100644
--- a/test/integration/api-create-invalid-names.test.js
+++ b/test/integration/api-create-invalid-names.test.js
@@ -8,9 +8,9 @@
  * Copyright 2018, Joyent, Inc.
  */
 
-var test = require('tape');
 var vasync = require('vasync');
 
+var mod_testVolumes = require('../lib/volumes');
 var testHelpers = require('./helpers');
 var volumesApi = require('../lib/volumes-api');
 
@@ -20,6 +20,10 @@ var STATE = {
     log: require('../lib/log')
 };
 
+var test = mod_testVolumes.createTestFunc({
+    checkTritonSupportsNfsVols: true
+});
+
 test('setup', function (tt) {
 
     tt.test('docker env', function (t) {
@@ -52,7 +56,7 @@ test('api: create volumes with invalid name', function (tt) {
          * 'x'.repeat(257) generates a volume name that is one character too
          * long, as the max length for volume names is 256 characters.
          */
-        var INVALID_VOLUME_NAMES = ['', '-foo', '.foo', 'x'.repeat(257)];
+        var INVALID_VOLUME_NAMES = ['-foo', '.foo', 'x'.repeat(257)];
 
         vasync.forEachParallel({
             func: function createVolume(volumeName, done) {
diff --git a/test/lib/volumes-api.js b/test/lib/volumes-api.js
index 94083e7..a74516c 100644
--- a/test/lib/volumes-api.js
+++ b/test/lib/volumes-api.js
@@ -39,8 +39,6 @@ function createDockerVolume(opts, callback) {
     assert.optionalString(opts.name, 'opts.name');
     assert.func(callback, 'callback');
 
-    assert.ok(testVolumes.nfsSharedVolumesSupported());
-
     var dockerClient = opts.dockerClient;
     var dockerApiVersion = opts.apiVersion || ('v' + constants.API_VERSION);
 
-- 
2.21.0

