{"project":"joyent/sdc-docker","branch":"master","id":"Ie21e9b51edf42c86bad90e061b7be7150cfeb932","number":"3228","subject":"VOLAPI-101 docker test assertion failure when NFS support is disabled Reviewed by: Dave Eddy \u003cdave.eddy@joyent.com\u003e Approved by: Dave Eddy \u003cdave.eddy@joyent.com\u003e","owner":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"url":"https://cr.joyent.us/3228","commitMessage":"VOLAPI-101 docker test assertion failure when NFS support is disabled\nReviewed by: Dave Eddy \u003cdave.eddy@joyent.com\u003e\nApproved by: Dave Eddy \u003cdave.eddy@joyent.com\u003e\n","createdOn":1516214637,"lastUpdated":1516223006,"open":false,"status":"MERGED","comments":[{"timestamp":1516214637,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 1."},{"timestamp":1516214672,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1516215023,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 1: Code-Review+1\n\n(2 comments)\n\nCode LGTM, just a couple of questions."},{"timestamp":1516215788,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 1:\n\n(2 comments)"},{"timestamp":1516216051,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 1:\n\n(2 comments)"},{"timestamp":1516216119,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1516216355,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 1: Integration-Approval+1\n\n(1 comment)\n\nLGTM.  Tested this change on emy-12 (volumes disabled) and it works as expected."},{"timestamp":1516223000,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 2: Commit message was updated."},{"timestamp":1516223006,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Julien Gilli"}],"currentPatchSet":{"number":"2","revision":"62668a22194bcf816384a4ffd003ee3b52d592fa","parents":["fa211d210bb4ac263f8ea7faabdc870d7cf16702"],"ref":"refs/changes/28/3228/2","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1516223000,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1516214672,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1516215023,"by":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1516216355,"by":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"}},{"type":"SUBM","value":"1","grantedOn":1516223006,"by":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"test/integration/api-create-invalid-names.test.js","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"test/lib/volumes-api.js","type":"MODIFIED","insertions":0,"deletions":-2}],"sizeInsertions":6,"sizeDeletions":-4},"patchSets":[{"number":"1","revision":"e21e9b51edf42c86bad90e061b7be7150cfeb932","parents":["fa211d210bb4ac263f8ea7faabdc870d7cf16702"],"ref":"refs/changes/28/3228/1","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1516214637,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1516214672,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1516215023,"by":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1516216355,"by":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"}}],"comments":[{"file":"test/integration/api-create-invalid-names.test.js","line":59,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Is an empty string considered invalid?"},{"file":"test/integration/api-create-invalid-names.test.js","line":59,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"It is, see https://github.com/joyent/sdc-docker/blob/fa211d210bb4ac263f8ea7faabdc870d7cf16702/lib/validate.js#L632-L642 for more info."},{"file":"test/integration/api-create-invalid-names.test.js","line":59,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Then should it be removed from this array? I guess, why was it removed?"},{"file":"test/integration/api-create-invalid-names.test.js","line":59,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Sorry, I made a typo, \"it is NOT invalid\" :)"},{"file":"test/integration/api-create-invalid-names.test.js","line":59,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"ah, that makes more sense then!"},{"file":"test/lib/volumes-api.js","line":42,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"This assert statement is what helped me catch this bug in the first place - should it be removed?"},{"file":"test/lib/volumes-api.js","line":42,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"The problem with this assert is that:\n\n1. it aborts the whole tests suite, so any mismatch between the docker service configuration and any test that\u0027d use this function would prevent any subsequent test from running\n\n2. It is conceivable that we\u0027d want to call that function to send a create volume API request when the support for NFS volumes is disabled, just to make sure we get the proper error response\n\n3. without that assert, that function would call its callback with an error that any tests suite using it could check to fail the test that called it"},{"file":"test/lib/volumes-api.js","line":42,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Ah, makes sense. sounds good to me!"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"test/integration/api-create-invalid-names.test.js","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"test/lib/volumes-api.js","type":"MODIFIED","insertions":0,"deletions":-2}],"sizeInsertions":6,"sizeDeletions":-4},{"number":"2","revision":"62668a22194bcf816384a4ffd003ee3b52d592fa","parents":["fa211d210bb4ac263f8ea7faabdc870d7cf16702"],"ref":"refs/changes/28/3228/2","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1516223000,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1516214672,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"SUBM","value":"1","grantedOn":1516223006,"by":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1516215023,"by":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1516216355,"by":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"test/integration/api-create-invalid-names.test.js","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"test/lib/volumes-api.js","type":"MODIFIED","insertions":0,"deletions":-2}],"sizeInsertions":6,"sizeDeletions":-4}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}]}