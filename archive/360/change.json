{"project":"joyent/sdc-cn-agent","branch":"master","id":"I37d779e66bc0358d91dfed5f7ed9deeb0996cc41","number":"360","subject":"DOCKER-920 Docker build shouldn\u0027t need to use chown after copying files Reviewed by: Joshua M. Clulow \u003cjmc@joyent.com\u003e Reviewed by: Josh Wilsdon \u003cjwilsdon@joyent.com\u003e Reviewed by: Trent Mick \u003ctrentm@gmail.com\u003e","owner":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"url":"https://cr.joyent.us/360","commitMessage":"DOCKER-920 Docker build shouldn\u0027t need to use chown after copying files\nReviewed by: Joshua M. Clulow \u003cjmc@joyent.com\u003e\nReviewed by: Josh Wilsdon \u003cjwilsdon@joyent.com\u003e\nReviewed by: Trent Mick \u003ctrentm@gmail.com\u003e\n","createdOn":1472247912,"lastUpdated":1472496532,"open":false,"status":"MERGED","comments":[{"timestamp":1472247912,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Uploaded patch set 1."},{"timestamp":1472247963,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1472249288,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1472249608,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1472249997,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1472251185,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Uploaded patch set 2."},{"timestamp":1472251233,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1472251387,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1472251581,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Patch Set 2: Code-Review+1"},{"timestamp":1472256046,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Uploaded patch set 3."},{"timestamp":1472256161,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1472256225,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1472495226,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 3: Code-Review+1 Integration-Approval+1"},{"timestamp":1472496532,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Todd Whiteman"}],"currentPatchSet":{"number":"3","revision":"37d779e66bc0358d91dfed5f7ed9deeb0996cc41","parents":["ed5e9c64725aa25b5bf3997b350574ab3872abc5"],"ref":"refs/changes/60/360/3","uploader":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"createdOn":1472256046,"author":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1472256161,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1472256225,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1472495226,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1472495226,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"SUBM","value":"1","grantedOn":1472496532,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"bin/docker-build.js","type":"MODIFIED","insertions":12,"deletions":-1}],"sizeInsertions":12,"sizeDeletions":-1},"patchSets":[{"number":"1","revision":"381d7f13f84646183a86eec7b36165df9e390d9b","parents":["ed5e9c64725aa25b5bf3997b350574ab3872abc5"],"ref":"refs/changes/60/360/1","uploader":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"createdOn":1472247912,"author":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1472247963,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"bin/docker-build.js","line":279,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"If you want the program to run as a different uid/gid, why not just change the \"method_credential\" being used in the SMF manifest?"},{"file":"bin/docker-build.js","line":279,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"You mean for all cn-agent processes? I figured this is a smaller fish, thus less impact (as it just impacts the docker build child process)."},{"file":"bin/docker-build.js","line":279,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Ah, right.  I missed the fact that this is a child process.  This makes sense now.\n\nIn case we ever get around to running this process as a reduced privilege user, I think it would make sense to assert that the _uid_ is also what you want it to be; i.e., 0."},{"file":"bin/docker-build.js","line":279,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"I ended up going with \u0027process.setuid(0)\u0027 - as it was simpler/cleaner code then what I ended up when using the assert - it has the same affect in the case of a failure."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"bin/docker-build.js","type":"MODIFIED","insertions":6,"deletions":-1}],"sizeInsertions":6,"sizeDeletions":-1},{"number":"2","revision":"3b2990810bdb5742787b73cd7c7cbde67cbaf59a","parents":["ed5e9c64725aa25b5bf3997b350574ab3872abc5"],"ref":"refs/changes/60/360/2","uploader":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"createdOn":1472251185,"author":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1472251581,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1472251233,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"bin/docker-build.js","type":"MODIFIED","insertions":7,"deletions":-1}],"sizeInsertions":7,"sizeDeletions":-1},{"number":"3","revision":"37d779e66bc0358d91dfed5f7ed9deeb0996cc41","parents":["ed5e9c64725aa25b5bf3997b350574ab3872abc5"],"ref":"refs/changes/60/360/3","uploader":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"createdOn":1472256046,"author":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1472256225,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1472256161,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1472495226,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1472495226,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"SUBM","value":"1","grantedOn":1472496532,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"bin/docker-build.js","type":"MODIFIED","insertions":12,"deletions":-1}],"sizeInsertions":12,"sizeDeletions":-1}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}]}