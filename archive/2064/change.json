{"project":"joyent/sdc-napi","branch":"master","id":"Iaa25ae05bf674c566d9ed0ebf3bad6346eef2428","number":"2064","subject":"NAPI-404 napi_nics needs more indexes for searching NAPI-304 NAPI happily moves past failed migrations, causing itself much misery Reviewed by: Jason King \u003cjason.king@joyent.com\u003e Approved by: Alex Wilson \u003calex.wilson@joyent.com\u003e","owner":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"url":"https://cr.joyent.us/2064","commitMessage":"NAPI-404 napi_nics needs more indexes for searching\nNAPI-304 NAPI happily moves past failed migrations, causing itself much misery\nReviewed by: Jason King \u003cjason.king@joyent.com\u003e\nApproved by: Alex Wilson \u003calex.wilson@joyent.com\u003e\n","createdOn":1496963883,"lastUpdated":1497560642,"open":false,"status":"MERGED","comments":[{"timestamp":1496963883,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 1."},{"timestamp":1496963995,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1496965113,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 2."},{"timestamp":1496965197,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1496969916,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 2:\n\n(2 comments)"},{"timestamp":1497300758,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 2:\n\n(2 comments)"},{"timestamp":1497301655,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 2: Code-Review+1"},{"timestamp":1497486476,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 3."},{"timestamp":1497486538,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing-1\n\n(1 comment)\n\n\"make check\" exited with status 2"},{"timestamp":1497486737,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 4."},{"timestamp":1497486827,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1497494624,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 4: Code-Review+1"},{"timestamp":1497560484,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 4: Integration-Approval+1"},{"timestamp":1497560607,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 5: Commit message was updated."},{"timestamp":1497560642,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Cody Peter Mello"}],"currentPatchSet":{"number":"5","revision":"392178ed2d1de72d814cfd9fea0b728b8dbd84d9","parents":["1787041a591aa84fa5e4001200b843fef4cf36cc"],"ref":"refs/changes/64/2064/5","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1497560607,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1497486827,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1497494624,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1497560484,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"SUBM","value":"1","grantedOn":1497560642,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":23,"deletions":-15},{"file":"lib/apis/moray.js","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"lib/models/network.js","type":"MODIFIED","insertions":7,"deletions":-4},{"file":"lib/models/nic/bucket.js","type":"MODIFIED","insertions":12,"deletions":-2},{"file":"lib/models/nic/list.js","type":"MODIFIED","insertions":10,"deletions":-2},{"file":"lib/models/nic/obj.js","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"server.js","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"test/unit/nics-list.test.js","type":"ADDED","insertions":571,"deletions":0}],"sizeInsertions":638,"sizeDeletions":-30},"patchSets":[{"number":"1","revision":"1e1c6b75ea3c167a29068a4bed25577d32accd73","parents":["1787041a591aa84fa5e4001200b843fef4cf36cc"],"ref":"refs/changes/64/2064/1","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1496963883,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1496963995,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":23,"deletions":-15},{"file":"lib/apis/moray.js","type":"MODIFIED","insertions":6,"deletions":0},{"file":"lib/models/nic/bucket.js","type":"MODIFIED","insertions":12,"deletions":-2},{"file":"lib/models/nic/list.js","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"test/unit/nics-list.test.js","type":"ADDED","insertions":554,"deletions":0}],"sizeInsertions":604,"sizeDeletions":-18},{"number":"2","revision":"aaa17e7d0957b7bf5ac2b5e29dbcd9080752711b","parents":["1787041a591aa84fa5e4001200b843fef4cf36cc"],"ref":"refs/changes/64/2064/2","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1496965113,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1496965197,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1497301655,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}}],"comments":[{"file":"lib/apis/moray.js","line":111,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"I\u0027m almost scared to ask, but is there any reason while \u0027(%s\u003dfalse)\u0027 won\u0027t work here?"},{"file":"lib/apis/moray.js","line":111,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"This is because the possible values are true, false, and null. We store null when someone hasn\u0027t specified anything for the field. Since everything that\u0027s a boolean defaults to false, we can search using \u0027(!(%s\u003dtrue))\u0027 to find the things that are false.\n\nIf this ever changes, and we have something default to true, we\u0027ll want to make sure we either store that value in Moray, or improve the logic here to have different behaviour for some fields."},{"file":"lib/models/nic/list.js","line":49,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"If indexes for {created,modified}_timestamp are being created, should they also be here as well?"},{"file":"lib/models/nic/list.js","line":49,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"I didn\u0027t add them here since I imagine we\u0027ll want a slightly different way to search them, where we have a create_{before,after} and modified_{before,after} filter, that takes some kind of date specification. I figured that that work can be done separately."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":23,"deletions":-15},{"file":"lib/apis/moray.js","type":"MODIFIED","insertions":6,"deletions":0},{"file":"lib/models/nic/bucket.js","type":"MODIFIED","insertions":12,"deletions":-2},{"file":"lib/models/nic/list.js","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"test/unit/nics-list.test.js","type":"ADDED","insertions":571,"deletions":0}],"sizeInsertions":621,"sizeDeletions":-18},{"number":"3","revision":"607ef8493dec2069254c51e36666f58b06974bda","parents":["1787041a591aa84fa5e4001200b843fef4cf36cc"],"ref":"refs/changes/64/2064/3","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1497486476,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1497486538,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/models/network.js","line":1177,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"\u0027opts\u0027 is defined but never used"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":23,"deletions":-15},{"file":"lib/apis/moray.js","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"lib/models/network.js","type":"MODIFIED","insertions":6,"deletions":-3},{"file":"lib/models/nic/bucket.js","type":"MODIFIED","insertions":12,"deletions":-2},{"file":"lib/models/nic/list.js","type":"MODIFIED","insertions":10,"deletions":-2},{"file":"lib/models/nic/obj.js","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"server.js","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"test/unit/nics-list.test.js","type":"ADDED","insertions":571,"deletions":0}],"sizeInsertions":637,"sizeDeletions":-29},{"number":"4","revision":"aa25ae05bf674c566d9ed0ebf3bad6346eef2428","parents":["1787041a591aa84fa5e4001200b843fef4cf36cc"],"ref":"refs/changes/64/2064/4","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1497486737,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1497560484,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1497486827,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1497494624,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":23,"deletions":-15},{"file":"lib/apis/moray.js","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"lib/models/network.js","type":"MODIFIED","insertions":7,"deletions":-4},{"file":"lib/models/nic/bucket.js","type":"MODIFIED","insertions":12,"deletions":-2},{"file":"lib/models/nic/list.js","type":"MODIFIED","insertions":10,"deletions":-2},{"file":"lib/models/nic/obj.js","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"server.js","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"test/unit/nics-list.test.js","type":"ADDED","insertions":571,"deletions":0}],"sizeInsertions":638,"sizeDeletions":-30},{"number":"5","revision":"392178ed2d1de72d814cfd9fea0b728b8dbd84d9","parents":["1787041a591aa84fa5e4001200b843fef4cf36cc"],"ref":"refs/changes/64/2064/5","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1497560607,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"SUBM","value":"1","grantedOn":1497560642,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1497560484,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1497486827,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1497494624,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"docs/index.md","type":"MODIFIED","insertions":23,"deletions":-15},{"file":"lib/apis/moray.js","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"lib/models/network.js","type":"MODIFIED","insertions":7,"deletions":-4},{"file":"lib/models/nic/bucket.js","type":"MODIFIED","insertions":12,"deletions":-2},{"file":"lib/models/nic/list.js","type":"MODIFIED","insertions":10,"deletions":-2},{"file":"lib/models/nic/obj.js","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"server.js","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"test/unit/nics-list.test.js","type":"ADDED","insertions":571,"deletions":0}],"sizeInsertions":638,"sizeDeletions":-30}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}]}