{"project":"joyent/illumos-joyent","branch":"master","id":"Iac6ff0374b4a733b77dd6d1963c950dd8f420903","number":"6083","subject":"OS-7708 nss_ldap needs to cache netgroups Reviewed by: Robert Mustacchi \u003crm@joyent.com\u003e Reviewed by: Jason King \u003cjason.king@joyent.com\u003e","owner":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"url":"https://cr.joyent.us/6083","commitMessage":"OS-7708 nss_ldap needs to cache netgroups\nReviewed by: Robert Mustacchi \u003crm@joyent.com\u003e\nReviewed by: Jason King \u003cjason.king@joyent.com\u003e\n","createdOn":1554927050,"lastUpdated":1556117070,"open":true,"status":"NEW","comments":[{"timestamp":1554927050,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Uploaded patch set 1."},{"timestamp":1554931083,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 1:\n\nThe ticket has test notes (including attachments) that demonstrate how this all works.\n\nThe dtrace probes (especially the quantity of them) are probably overkill.  I\u0027m quite open to significant trimming but would like to save that until code review is winding down."},{"timestamp":1554931449,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 1:\n\n(7 comments)\n\nPass 1.  I\u0027m going to come back in a bit for getnetgrent.c"},{"timestamp":1554959468,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 1:\n\n(8 comments)"},{"timestamp":1554959496,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 1:\n\nOverall, I think the design is fine.  Mostly just some questions and a few nits."},{"timestamp":1555018446,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Uploaded patch set 2."},{"timestamp":1555018459,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 1:\n\n(15 comments)"},{"timestamp":1555033166,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 2:\n\n(40 comments)"},{"timestamp":1555532876,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Uploaded patch set 3."},{"timestamp":1555533103,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 2:\n\n(40 comments)"},{"timestamp":1555550488,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 3:\n\n(35 comments)"},{"timestamp":1555617733,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Uploaded patch set 4."},{"timestamp":1555617981,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Uploaded patch set 5."},{"timestamp":1555618003,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 3:\n\n(28 comments)"},{"timestamp":1555966186,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 2:\n\n(7 comments)"},{"timestamp":1556037088,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Uploaded patch set 6."},{"timestamp":1556037105,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 5:\n\n(6 comments)"},{"timestamp":1556040078,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 2:\n\n(3 comments)"},{"timestamp":1556047375,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Uploaded patch set 7."},{"timestamp":1556047450,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 5:\n\n(2 comments)"},{"timestamp":1556054430,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Uploaded patch set 8."},{"timestamp":1556054815,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 8: Code-Review+1"},{"timestamp":1556054824,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 8:\n\nRetested and found a couple issues that have since been corrected.  Test notes and associated scripts, ldif files, etc. updated in ticket."},{"timestamp":1556057060,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 8: Code-Review+1"},{"timestamp":1556116940,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 9: Patch Set 8 was rebased"},{"timestamp":1556117070,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 10: Commit message was updated."}],"currentPatchSet":{"number":"10","revision":"f15a024390e91ab5ead76690a0454d6f2ce7c189","parents":["486e689913103fa372f7e2c3e054b2bd602546c4"],"ref":"refs/changes/83/6083/10","uploader":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"createdOn":1556117070,"author":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1556054815,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1556057060,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/cmd/initpkg/nscd.conf","type":"MODIFIED","insertions":6,"deletions":-3},{"file":"usr/src/lib/nsswitch/Makefile.com","type":"MODIFIED","insertions":1,"deletions":-7},{"file":"usr/src/lib/nsswitch/Makefile.targ","type":"MODIFIED","insertions":3,"deletions":-4},{"file":"usr/src/lib/nsswitch/compat/Makefile.com","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/lib/nsswitch/dns/Makefile.com","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/lib/nsswitch/files/Makefile.com","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/lib/nsswitch/ldap/Makefile","type":"MODIFIED","insertions":1,"deletions":-3},{"file":"usr/src/lib/nsswitch/ldap/Makefile.com","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"usr/src/lib/nsswitch/ldap/Makefile.targ","type":"ADDED","insertions":20,"deletions":0},{"file":"usr/src/lib/nsswitch/ldap/amd64/Makefile","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"usr/src/lib/nsswitch/ldap/common/getexecattr.c","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/lib/nsswitch/ldap/common/getgrent.c","type":"MODIFIED","insertions":4,"deletions":-2},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","type":"MODIFIED","insertions":1663,"deletions":-363},{"file":"usr/src/lib/nsswitch/ldap/common/getspent.c","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"usr/src/lib/nsswitch/ldap/common/ldap_common.h","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/lib/nsswitch/ldap/common/provider.d","type":"ADDED","insertions":50,"deletions":0},{"file":"usr/src/lib/nsswitch/ldap/i386/Makefile","type":"MODIFIED","insertions":2,"deletions":-4},{"file":"usr/src/lib/nsswitch/ldap/sparc/Makefile","type":"MODIFIED","insertions":2,"deletions":-4},{"file":"usr/src/lib/nsswitch/ldap/sparcv9/Makefile","type":"MODIFIED","insertions":2,"deletions":-4},{"file":"usr/src/lib/nsswitch/nis/Makefile.com","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/man/man4/nscd.conf.4","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"usr/src/test/Makefile","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/test/nsswitch-tests/Makefile","type":"ADDED","insertions":20,"deletions":0},{"file":"usr/src/test/nsswitch-tests/runfiles/Makefile","type":"ADDED","insertions":41,"deletions":0},{"file":"usr/src/test/nsswitch-tests/runfiles/default.run","type":"ADDED","insertions":26,"deletions":0},{"file":"usr/src/test/nsswitch-tests/tests/Makefile","type":"ADDED","insertions":20,"deletions":0},{"file":"usr/src/test/nsswitch-tests/tests/ldap/Makefile","type":"ADDED","insertions":75,"deletions":0},{"file":"usr/src/test/nsswitch-tests/tests/ldap/generalized_time.c","type":"ADDED","insertions":241,"deletions":0}],"sizeInsertions":2217,"sizeDeletions":-410},"patchSets":[{"number":"1","revision":"1afe912d1cf29e1c41b9c28abf15281468028dd8","parents":["26dd5a91c086ec5f65eaaa39f0651013e22d28e9"],"ref":"refs/changes/83/6083/1","uploader":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"createdOn":1554927050,"author":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/lib/nsswitch/ldap/Makefile.com","line":62,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"I\u0027m a little weary of linking cmdutils in since it seems to wreak havoc where it isn\u0027t intentionally used.  It _might_ be preferred to just build + link list.o from usr/src/common, esp. given this can sometimes make it\u0027s way into an aribitrary process."},{"file":"usr/src/lib/nsswitch/ldap/Makefile.com","line":62,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Done"},{"file":"usr/src/lib/nsswitch/ldap/common/getexecattr.c","line":425,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Is this just to fix compiler warnings?"},{"file":"usr/src/lib/nsswitch/ldap/common/getexecattr.c","line":425,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Yep"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":327,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Maybe ERRORCHECKMUTEX instead?"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":327,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Done"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":451,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"The wording here feels a bit awkward.  Do you mean \u0027we need to be able to assign a value to ng_name when using avl_find() without doing a heap allocation\u0027 or something like that?"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":451,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Done"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":458,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Might `ng-\u003eng_name \u003d (const char *)ng + sizeof (*ng)` be a bit clearer to emphasize that it\u0027s pointing to the first byte past the end of the struct?"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":458,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Done"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":603,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"nit: if `i` and `entries` can never be negative, consider using an unsigned type."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":603,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Done"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":698,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"nit: parenthesis around return value."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":698,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Done"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":927,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"probably should annotate data as __unused"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":927,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Done"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":943,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"I think we\u0027re still doing (void) to discard the return value.."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":943,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"oops, forgot to cstyle. Fixed this and others."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":983,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"That\u0027s probably the safer approach -- I would think that netgroups aren\u0027t going to be updated so frequently that the potential extra work would amount to much."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":983,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Done"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":1620,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Consider making leftp size_t"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":1620,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Done"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":1874,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"The error semantics of atoi() are undefined, might it be better to use strtol() instead?"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":1874,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"strtol is awful to, but better.  done."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":1891,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"rF for the mode?"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":1891,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"TIL, thanks!"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":1943,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"If someone puts in a non-numeric value, you\u0027ll end up with an error message \"netgroup attribute \u0027xxxx\u0027 value out of range\" which seems a bit odd.  Would it be worth splitting the two cases (out of range and not a number) out."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":1943,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Done"},{"file":"usr/src/man/man4/nscd.conf.4","line":7,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Date should probably be updated"},{"file":"usr/src/man/man4/nscd.conf.4","line":7,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/initpkg/nscd.conf","type":"MODIFIED","insertions":6,"deletions":-3},{"file":"usr/src/lib/nsswitch/Makefile.com","type":"MODIFIED","insertions":1,"deletions":-7},{"file":"usr/src/lib/nsswitch/Makefile.targ","type":"MODIFIED","insertions":3,"deletions":-4},{"file":"usr/src/lib/nsswitch/compat/Makefile.com","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/lib/nsswitch/dns/Makefile.com","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/lib/nsswitch/files/Makefile.com","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/lib/nsswitch/ldap/Makefile.com","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"usr/src/lib/nsswitch/ldap/common/getexecattr.c","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/lib/nsswitch/ldap/common/getgrent.c","type":"MODIFIED","insertions":4,"deletions":-2},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","type":"MODIFIED","insertions":1362,"deletions":-331},{"file":"usr/src/lib/nsswitch/ldap/common/getspent.c","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"usr/src/lib/nsswitch/ldap/common/ldap_common.h","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/lib/nsswitch/ldap/common/provider.d","type":"ADDED","insertions":51,"deletions":0},{"file":"usr/src/lib/nsswitch/nis/Makefile.com","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/man/man4/nscd.conf.4","type":"MODIFIED","insertions":3,"deletions":-2}],"sizeInsertions":1461,"sizeDeletions":-359},{"number":"2","revision":"dd224b51b27d54da65d203304920ca2bc095a6eb","parents":["26dd5a91c086ec5f65eaaa39f0651013e22d28e9"],"ref":"refs/changes/83/6083/2","uploader":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"createdOn":1555018446,"author":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":41,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"What cleans up the non-static data in those cases? Reading this suggests that if we weren\u0027t using nscd we wouldn\u0027t end up freeing the data that was in the various lists and we\u0027d slowly leak. Can you expand the comment to point how all the internal data is cleaned up? I think most of this is covered based on how ngc_enable is handled, but we\u0027d like to avoid another occurrence of something like OS-6449.\n\nI\u0027m not sure we want to design something such that it\u0027s only ever cleaned by forcing the parent process to restart. I haven\u0027t managed to convince myself that the several dlclose() vectors in nscd can\u0027t trigger this, but at least form a general library design perspective, it does feel a little unsporting."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":41,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"I\u0027d previously had cleanup code and realized that I was only triggering it when nscd restarted itself.  Added it back and will come up with a test program to exercise it outside of nscd."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":90,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"This section should probably explain why there are atomics that are being used to track parts of the data structures and why they can\u0027t be used to protect the atomic."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":90,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"By taking the lock for a short while in the unhappy path I can get rid of atomics."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":92,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I would suggest adding something that talks about how you\u0027re using time that\u0027s subject to ntp drift / sudden jumps and why that\u0027s OK/intentional."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":92,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"I think that what you are really saying is that I should be using gethrtime() instead."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":92,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"You don\u0027t have to use hrtime\u0027s, it should just be explained that the drift or sudden time skips are OK and how that impacts the caching. Originally I had thought it was being done that way because you\u0027re talking to ntp servers and looking at modified times."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":92,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"If we were guaranteed to be using some other protocol (e.g. kerberos) that made the system broken due to clock skew, it would be easier to wave my hands at that.\n\nI think the new implementation where I have monotonic seconds since start rather than seconds since the epoch is a more robust solution and no hands need to be waved."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":212,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"It\u0027d be nice to mention the unit the constant is in."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":212,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Done"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":237,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Is there any reason these can\u0027t be const? It may be that we need to change split_triple to be able to handle that, but it appears that once these have gone through split_triple(), we shouldn\u0027t need to modify the actual contents of what they point to ever again and in fact doing so incorrectly, could lead the various items that point into the same underlying string to have bad things happen. That\u0027s not happening here, but mostly suggesting as a bit of defense in depth."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":237,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Done"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":272,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Is there a reason this is a signed type? It appears that the value can\u0027t go negative."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":272,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Done"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":303,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Missing structure prefixes."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":303,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"I avoided changing this in the spirit of not making changes unrelated to the bug I\u0027m trying to fix.  I\u0027ve changed most of the rest of the file, so why not?"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":310,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"This deserves structure prefixes."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":310,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Done"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":314,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"This should be the same type as netgroup ng_triplecnt. It also should probably be unsigned (as should ng_triplecnt) as we should never have a negative index into an array."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":314,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Done"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":314,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I think this was missed as now ng_triplecnt is an int32_t, but this is still an int."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":314,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"everything related to ngc_triplecnt should now be uint32_t."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":343,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Any reason these aren\u0027t static like everything else?"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":343,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Done"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":344,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Is there a reason that ngc_reap_interval would ever need to be negative and thus need to be signed?"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":344,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Done"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":355,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"The surrounding code is treating this as a boolean_t, perhaps it should be."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":355,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Done"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":357,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Any reason these aren\u0027t static like everything else?"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":357,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Done"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":361,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"If we need this bit of the implementation of the list_t, perhaps it should be in sys/list_impl.h instead of us duplicating it here? I mostly worry because this does feel like we\u0027re encoding the implementaiton details of what should be opaque-like."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":361,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Maybe it would be better to have -DDEBUG on list.c make similar assertions about the list_node_t during insert operations.  That (combined with avoidance of libcmdutils) would have caught the bug that inspired me to add the LIST_*() functions."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":361,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I had thought about suggesting that; however, you explicitly are asserting things related to the lock state that you\u0027d lose. I had assumed that having the lock assert would be useful."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":361,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"I\u0027m just going to rip out the debug code.  It has served its purpose and is now just a maintenance burden.\n\nI have also had second thoughts about asserting that list_next and list_prev are null on debug. I have little confidence that list_link_init() or calloc() are used widely enough to prevent this laying a minefield for debug kernels."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":374,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"abort has a noreturn keywords associated with it. Does the compiler not recognize that the return (NULL) will be unreached?"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":374,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Done"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":504,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"FYI, we added mutex_enter / mutex_exit to user land. They require an error checking mutex (which you\u0027re using), but behave like their kernel counterparts and therefore don\u0027t require VERIFY0 wrapping them."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":504,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Nice, thanks!"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":577,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"It\u0027s probably worth a comment reminding readers where the \u003e\u003e 2 comes from. I\u0027m assuming it\u0027s related to the 25% activity markers, but it\u0027s not clear."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":577,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Comment added. I\u0027ve also made this \"/ 4\" rather than \"\u003e\u003e 2\" to make it more clear.  Even if the compiler doesn\u0027t optimize out the division, it doesn\u0027t really matter.  Code clarity should trump cleverness here."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":597,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Since this is only returning success/failure, maybe use a boolean_t?"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":597,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Leaving as-is, per MM discussion"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":617,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"i and entries are unsigned, not signed. Need to use %u, not %d."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":617,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Done"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":658,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Is this the right RFC? I can\u0027t find this section in it at https://tools.ietf.org/html/rfc4512#section-3.3. I found it instead in 3.4.4."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":658,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Done"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":662,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"It would really help to explain why this is the case in the comment. I\u0027m trying to convince myself that this is true, but having trouble."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":662,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Reworked to fully parse the spec, fractional hours/minutes/seconds, and all.  FWIW, strptime() is useless by design or implementation."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":678,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"The strptime(3C) manual page says it returns a value that indicates the last non-processed character. Do we not need to check and make sure that we don\u0027t have garbage following this that we don\u0027t understand or that it\u0027s at least a time zone indicator and something that we expect rather than not?"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":678,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Sadly, I\u0027ve found that strptime() is not as flexible as it should be.  With some formats, trailing characters allow the string to be parsed and the trailing characters do not cause an error.  With other formats, trailing characters (such as a fraction or offset) cause problems.  After spending way too many hours trying to coax strptime into doing most of the lifting, I found that I ended up with no workaround code and less overall code by just parsing the string without strptime().  106 tests added to verify correctness.\n\nThat being said, there are still some gaps.  timegm() should notice things like illegal leap years and 31 days in April.  If that or deficiencies in strptime() need to be addressed, that should be follow-on work."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":681,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"mktime(3C) is sensitive to the time zone that the process is in. Particularly in a libc vectored call case, it seems like this\u0027ll end up causing issues if the program has set a time zone as you\u0027re otherwise using time(2) which I don\u0027t believe takes the time zone into account. Maybe you want to use timegm(3C) instead?"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":681,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"oops, yeah...  I thought I had already made that change."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":716,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"When we\u0027re coming in via libc, will libc try again?"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":716,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"This replicates pre-existing behavior. I added a comment after considering why we didn\u0027t just try again here."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":716,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"OK, that\u0027s fine. I was just asking what the libc behavior would be since you called out the nscd case. If we\u0027re clarifying it for nscd, we should also clarify it for the libc case."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":774,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Explicit comparison for non-boolean_t?"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":774,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Done"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":943,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Unchecked return value."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":943,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Done"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":1282,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"The type of trip should probably match exactly (and not through typedefs) that of ng_triplecnt which its being compared to."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":1282,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Done"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":1437,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Were these blanks added on purpose?"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":1437,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Nope, shuffled code around that had been added here and left some blanks behind.  Deleted."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":1603,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"This appears to really be a boolean, I\u0027d suggest using a boolean_t to make success/failure clearer."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":1603,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Leaving as-is for consistency with rest of this file and related files in same directory."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":1604,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Might be worth a brief comment affirming the intended semantics of this function."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":1604,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Done"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":1607,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Why is a size_t being cast to an int?"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":1607,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Done"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":1614,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"strlcpy returns a size_t, but is being cast to an int."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":1614,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Done"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":1620,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Maybe worth an ASSERT that left \u003e\u003d len before doing the subtraction?"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":1620,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Does the if statement at 1615 not suffice?"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":1620,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Should be fine, apologies for missing that."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":1839,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Should this use a strcasecmp?"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":1839,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Sigh.  Not according to nscd.conf(4), but nscd_config.c says otherwise.  Sigh."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":1839,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"This is another case where now we\u0027re in terribly locale territory, fwiw."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":1839,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"I don\u0027t think config files are ever localized, so we should be ok, right?"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":1839,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"The concern was that we were in a locale where the case comparison didn\u0027t operate as expected for ASCII. But I\u0027m not sure if that actually exists for our current locales or not. It probably isn\u0027t worth the trouble."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":1839,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"While looking into the newlocale() / isdigit() issue, I stumbled across this:\n\nhttps://grok.elemental.org/source/xref/illumos-joyent/usr/src/lib/libc/port/locale/isdigit.c?r\u003d4f9d8ec0#31\n\n* As far as we know, *every* encoding we support is a strict superset of ASCII\n\nNothing more to be done here."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":1839,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"For the record, while the implementation can assume that, we should never assume that fact when using these interfaces. That said, it\u0027s fine to not do anything else here."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":1862,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"This looks like strtonum(3C)."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":1862,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Indeed it does.  TIL\n\nI\u0027m not so sure that using strtonum() would end up with less code or code that is more easily understood.  In order to not have a series of \"if\" statements in the loop in read_nscd_conf, I need to have *toi functions with the same signature.  Changing the signature of yntoi() to match strtonum() will not be a lot of help, as strtonum() does not produce an error message that is terribly helpful on its own.\n\nSwapping out the existing call to strtol() with a call to strtonum() will not be very helpful either, as I would still need to handle error cases and form a useful error message."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":1862,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"OK, fair enough."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":1889,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I\u0027d suggest i and line be unsigned, as they really shouldn\u0027t ever be negative."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":1889,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Done"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":1889,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"i is still signed, fwiw."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":1889,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Done"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":1904,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"We may want to run this parsing code through a fuzzer given that this could be running now for a large number of processes, particularly if nscd disabled. Maybe we should drop privileges while doing this?"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":1904,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Pointers to any existing tools that we\u0027ve found helpful are welcome.\n\nSince we reading /etc/nscd.conf, how much do we really need to worry about a malicious actor here?  If the attacker can modify nscd.conf or interpose in a way that something else is being read, buffer overflows or similar triggered by malicious content in the file being read are the least of our worries."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":1904,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"My understanding is that folks have used things like afl, etc. You\u0027re right that it may not be worth the effort. I just wanted to suggest it and put the idea out there."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":1996,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"If this is for testing, perhaps it should only be under ifdef DEBUG?"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":1996,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"The tests that make use of this are documented in the ticket.  There is some automation but I don\u0027t think it is automated enough to warrant inclusion in the new tests directory.\n\nThis is not in a performance-sensitive path and can only be triggered by someone that has administrative access to the name-service-cache service.  The risk of having this code in place seems quite low while the usefulness of being able to tune the timeout while investigating problems seems rather high.\n\nFWIW, I had initially explored adding this as a tunable via nscd.conf.  The existing nscd parser does not like random configuration options being added, so I backed off that plan."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":1996,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"It\u0027s fine, you don\u0027t have to remove it. It was only a suggestion given the comment above that it was for testing and there was already a lot of ifdef DEBUG logic in the module."},{"file":"usr/src/lib/nsswitch/ldap/common/ldap_common.h","line":74,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Was there any particular reason this part of the check was removed?"},{"file":"usr/src/lib/nsswitch/ldap/common/ldap_common.h","line":74,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"It led to gcc warnings-\u003eerrors after I got rid of the CFLAGS that caused various warnings to be ignored.\n\n../common/gethostent6.c:116: error: the address of \u0027hostname\u0027 will never be NULL [-Waddress]\n../common/gethostent.c:297: error: the address of \u0027hostname\u0027 will never be NULL [-Waddress]\n\nThere are two other places where this macro is called and they both handle NULL.\n\ngethostent.c\n192 if (be-\u003etoglue \u003d\u003d NULL || DOTTEDSUBDOMAIN(cname)) in _nss_ldap_hosts2str_int()\n212 if (be-\u003etoglue \u003d\u003d NULL || DOTTEDSUBDOMAIN(name)) in _nss_ldap_hosts2str_int()"},{"file":"usr/src/lib/nsswitch/ldap/common/ldap_common.h","line":74,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"OK, makes sense. Thanks for clarifying."},{"file":"usr/src/lib/nsswitch/ldap/common/provider.d","line":2,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Minor nit, but modern prototypes don\u0027t have a CDDL HEADER START/END."},{"file":"usr/src/lib/nsswitch/ldap/common/provider.d","line":2,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/initpkg/nscd.conf","type":"MODIFIED","insertions":6,"deletions":-3},{"file":"usr/src/lib/nsswitch/Makefile.com","type":"MODIFIED","insertions":1,"deletions":-7},{"file":"usr/src/lib/nsswitch/Makefile.targ","type":"MODIFIED","insertions":3,"deletions":-4},{"file":"usr/src/lib/nsswitch/compat/Makefile.com","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/lib/nsswitch/dns/Makefile.com","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/lib/nsswitch/files/Makefile.com","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/lib/nsswitch/ldap/Makefile.com","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"usr/src/lib/nsswitch/ldap/Makefile.targ","type":"ADDED","insertions":24,"deletions":0},{"file":"usr/src/lib/nsswitch/ldap/amd64/Makefile","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"usr/src/lib/nsswitch/ldap/common/getexecattr.c","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/lib/nsswitch/ldap/common/getgrent.c","type":"MODIFIED","insertions":4,"deletions":-2},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","type":"MODIFIED","insertions":1368,"deletions":-331},{"file":"usr/src/lib/nsswitch/ldap/common/getspent.c","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"usr/src/lib/nsswitch/ldap/common/ldap_common.h","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/lib/nsswitch/ldap/common/provider.d","type":"ADDED","insertions":51,"deletions":0},{"file":"usr/src/lib/nsswitch/ldap/i386/Makefile","type":"MODIFIED","insertions":2,"deletions":-4},{"file":"usr/src/lib/nsswitch/ldap/sparc/Makefile","type":"MODIFIED","insertions":2,"deletions":-4},{"file":"usr/src/lib/nsswitch/ldap/sparcv9/Makefile","type":"MODIFIED","insertions":2,"deletions":-4},{"file":"usr/src/lib/nsswitch/nis/Makefile.com","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/man/man4/nscd.conf.4","type":"MODIFIED","insertions":4,"deletions":-3}],"sizeInsertions":1501,"sizeDeletions":-375},{"number":"3","revision":"5859b3dc9eefdbf7cf72333cf10b6e0eba941e0b","parents":["26dd5a91c086ec5f65eaaa39f0651013e22d28e9"],"ref":"refs/changes/83/6083/3","uploader":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"createdOn":1555532876,"author":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/lib/nsswitch/ldap/Makefile","line":31,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"It\u0027s great to see unit tests. Can they live in usr/src/test so we can make sure it\u0027s always run as part of the build and general test infrastructure? Otherwise these unit tests will be missed."},{"file":"usr/src/lib/nsswitch/ldap/Makefile","line":31,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"thanks for the pointer.\n\nI\u0027m not sure if anything else is needed to cause the new /opt/nsswitch-tests tests to be executed."},{"file":"usr/src/lib/nsswitch/ldap/Makefile","line":31,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Today, the tests basically are all packaged up to run on the target system. It\u0027s a little less convenient, but hopefully by being part of the broader framework there, it\u0027ll be easier to make sure folks are running it regularly. Getting that more automated at our end is on a bit of my long-term TODO list."},{"file":"usr/src/lib/nsswitch/ldap/Makefile","line":31,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Done"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":141,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Was the spacing switch intentional?"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":141,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Done"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":449,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"ngc_last_tick is a uint32_t, shouldn\u0027t this return a uint32_t? Especially as several of the other values we assign are uint32_t values."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":449,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"oops, initially switched over to hrtime_t and it turned into a bit of needless pain while updating the dtrace script.   Since we really only care about seconds, I switched almost everything away from hrtime_t."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":451,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Maybe worth an ASSERT(MUTEX_HELD())?"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":451,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"The lock isn\u0027t necessarily held, nor does it need to be.\n\nI\u0027ve changed the code a bit to make it so that if the compiler treats ngc_last_tick as volatile that the probe value and the return value are consistent.  Updated comments should clarify the rest."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":680,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Why is the value being tracked as a signed quantity, but hte min and max being treated as an unsigned quantity? It this is parsing and returning an int, then the min and max should be of type int."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":680,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Done"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":687,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I suspect you need to really use isdigint_l and specify the C locale explicitly or verify that it\u0027s an ascii digit instead through another way and add a comment explaining why isdigit isn\u0027t necessarily what you want. Unfortunately, this isdigit leaves you at the mercy of the current locale, which can happen when you\u0027re mapped into a libc process. That could lead to unexpected failure."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":687,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Done"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":694,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"This seems like it\u0027s missing overflow detection. The concern around that is someone else will come around and nor realize that\u0027s a concern and adopt this incorrectly in the future. You could check for that by using a temporary value for the result of the multiplication and then checking if the resulting value is less than the current one. However, that will only be defined behavior if operating on unsigned data."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":694,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Done"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":703,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"next and gtime are pointers. The act of all this arithmetic is still a pointer. This will cause a type and size mismatch when not in an ILP32 environment because it will be a 64-bit quantity. I suspect you want to take all that and cast it to a uintptr_t or some other fixed size."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":703,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Done"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":723,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Can you please make sure a bug is filed for these issues?"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":723,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"While attempting to do this, I\u0027ve been unable to reproduce those that were clearly bugs.   I still find strptime() to be more trouble than its worth for the reasons stated in the updated comment."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":723,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"OK, the choice not to use it makes sense."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":728,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Should we take a pass and make sure that gtime is all ascii before proceeding through and parsing it? As there\u0027s no guarantee that the LDAP server is giving us ascii, though we\u0027re assuming it\u0027s in it."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":728,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Sure, though probably not necessary now that isdigit_l() is being used."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":734,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"This appears unused."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":734,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Done"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":764,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"It\u0027s not clear exactly what you\u0027re trying to convey with this. Are you basically worried about behavior when things wrap around and it produces a negative time when cast to a time_t?"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":764,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"yep, reworded."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":795,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"It\u0027s not clear to me why we don\u0027t care about the return value here."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":795,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Per RFC4517 3.3.13, offset (g-differential) is:\n\ng-differential  \u003d ( MINUS / PLUS ) hour [ minute ]"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":987,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"See note earlier, but if hrtime_t is kept here, there are numerous uint32_t / hrtime_t (int64_t) comparisons."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":987,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Done"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":1111,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"If we\u0027re interrupted do we care that we may reap sooner than the default ngc_reap_interval?"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":1111,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"I don\u0027t see any harm in it.  If we didn\u0027t just go ahead and reap, then we would need to keep track of how much of the time was left over and only sleep for that amount of time to avoid being starved by signal delivery."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":1786,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"the?"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":1786,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Done"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":2072,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Extra space?"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":2072,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"cstyle failed me!"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":2240,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Shouldn\u0027t this explicitly mention libc also doing it? nscd isn\u0027t the only consumer of this library."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":2240,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"yep, forgot to update the comment after resurrecting some code written before I learned a thing or two."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":2257,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Shouldn\u0027t the check for ngc_initialized be done before assigning to it?"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":2257,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"uh, yeah.  :shame:"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":2261,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Shouldn\u0027t the ngc_warmer_thread actually check this value? Right now this\u0027ll never actually join."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":2261,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"more resurrection problems, fixed."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":2282,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"How do the links on this list get removed? ngc_free() doesn\u0027t clean them up. I suspect this\u0027ll blow the asserts in list.c."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":2282,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"should have called ngc_dispose_locked() instead of ngc_free()."},{"file":"usr/src/lib/nsswitch/ldap/test/generalized_time.c","line":42,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"was generated?"},{"file":"usr/src/lib/nsswitch/ldap/test/generalized_time.c","line":184,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Since you don\u0027t use argc or argv, just make this void?"},{"file":"usr/src/lib/nsswitch/ldap/test/generalized_time.c","line":184,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Done"},{"file":"usr/src/lib/nsswitch/ldap/test/generalized_time.c","line":190,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"You don\u0027t have to change this, but in the future, I\u0027d just keep these unsigned for things that can never actually be negative."},{"file":"usr/src/lib/nsswitch/ldap/test/generalized_time.c","line":190,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/initpkg/nscd.conf","type":"MODIFIED","insertions":6,"deletions":-3},{"file":"usr/src/lib/nsswitch/Makefile.com","type":"MODIFIED","insertions":1,"deletions":-7},{"file":"usr/src/lib/nsswitch/Makefile.targ","type":"MODIFIED","insertions":3,"deletions":-4},{"file":"usr/src/lib/nsswitch/compat/Makefile.com","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/lib/nsswitch/dns/Makefile.com","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/lib/nsswitch/files/Makefile.com","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/lib/nsswitch/ldap/Makefile","type":"MODIFIED","insertions":3,"deletions":-5},{"file":"usr/src/lib/nsswitch/ldap/Makefile.com","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"usr/src/lib/nsswitch/ldap/Makefile.targ","type":"ADDED","insertions":20,"deletions":0},{"file":"usr/src/lib/nsswitch/ldap/amd64/Makefile","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"usr/src/lib/nsswitch/ldap/common/getexecattr.c","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/lib/nsswitch/ldap/common/getgrent.c","type":"MODIFIED","insertions":4,"deletions":-2},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","type":"MODIFIED","insertions":1666,"deletions":-363},{"file":"usr/src/lib/nsswitch/ldap/common/getspent.c","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"usr/src/lib/nsswitch/ldap/common/ldap_common.h","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/lib/nsswitch/ldap/common/provider.d","type":"ADDED","insertions":50,"deletions":0},{"file":"usr/src/lib/nsswitch/ldap/i386/Makefile","type":"MODIFIED","insertions":2,"deletions":-4},{"file":"usr/src/lib/nsswitch/ldap/sparc/Makefile","type":"MODIFIED","insertions":2,"deletions":-4},{"file":"usr/src/lib/nsswitch/ldap/sparcv9/Makefile","type":"MODIFIED","insertions":2,"deletions":-4},{"file":"usr/src/lib/nsswitch/ldap/test/Makefile","type":"ADDED","insertions":61,"deletions":0},{"file":"usr/src/lib/nsswitch/ldap/test/generalized_time.c","type":"ADDED","insertions":241,"deletions":0},{"file":"usr/src/lib/nsswitch/nis/Makefile.com","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/man/man4/nscd.conf.4","type":"MODIFIED","insertions":4,"deletions":-3}],"sizeInsertions":2099,"sizeDeletions":-412},{"number":"4","revision":"404a3702a22ae516a7b424dc30d9486e99da2c93","parents":["26dd5a91c086ec5f65eaaa39f0651013e22d28e9"],"ref":"refs/changes/83/6083/4","uploader":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"createdOn":1555617733,"author":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/initpkg/nscd.conf","type":"MODIFIED","insertions":6,"deletions":-3},{"file":"usr/src/lib/nsswitch/Makefile.com","type":"MODIFIED","insertions":1,"deletions":-7},{"file":"usr/src/lib/nsswitch/Makefile.targ","type":"MODIFIED","insertions":3,"deletions":-4},{"file":"usr/src/lib/nsswitch/compat/Makefile.com","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/lib/nsswitch/dns/Makefile.com","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/lib/nsswitch/files/Makefile.com","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/lib/nsswitch/ldap/Makefile","type":"MODIFIED","insertions":1,"deletions":-3},{"file":"usr/src/lib/nsswitch/ldap/Makefile.com","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"usr/src/lib/nsswitch/ldap/Makefile.targ","type":"ADDED","insertions":20,"deletions":0},{"file":"usr/src/lib/nsswitch/ldap/amd64/Makefile","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"usr/src/lib/nsswitch/ldap/common/getexecattr.c","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/lib/nsswitch/ldap/common/getgrent.c","type":"MODIFIED","insertions":4,"deletions":-2},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","type":"MODIFIED","insertions":1641,"deletions":-363},{"file":"usr/src/lib/nsswitch/ldap/common/getspent.c","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"usr/src/lib/nsswitch/ldap/common/ldap_common.h","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/lib/nsswitch/ldap/common/provider.d","type":"ADDED","insertions":50,"deletions":0},{"file":"usr/src/lib/nsswitch/ldap/i386/Makefile","type":"MODIFIED","insertions":2,"deletions":-4},{"file":"usr/src/lib/nsswitch/ldap/sparc/Makefile","type":"MODIFIED","insertions":2,"deletions":-4},{"file":"usr/src/lib/nsswitch/ldap/sparcv9/Makefile","type":"MODIFIED","insertions":2,"deletions":-4},{"file":"usr/src/lib/nsswitch/nis/Makefile.com","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/man/man4/nscd.conf.4","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"usr/src/test/Makefile","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/test/nsswitch-tests/Makefile","type":"ADDED","insertions":20,"deletions":0},{"file":"usr/src/test/nsswitch-tests/runfiles/Makefile","type":"ADDED","insertions":41,"deletions":0},{"file":"usr/src/test/nsswitch-tests/runfiles/default.run","type":"ADDED","insertions":26,"deletions":0},{"file":"usr/src/test/nsswitch-tests/tests/Makefile","type":"ADDED","insertions":20,"deletions":0},{"file":"usr/src/test/nsswitch-tests/tests/ldap/Makefile","type":"ADDED","insertions":75,"deletions":0},{"file":"usr/src/test/nsswitch-tests/tests/ldap/generalized_time.c","type":"ADDED","insertions":246,"deletions":0}],"sizeInsertions":2200,"sizeDeletions":-410},{"number":"5","revision":"d3bd2399b44457a03fcabf05d057785d7a062b78","parents":["26dd5a91c086ec5f65eaaa39f0651013e22d28e9"],"ref":"refs/changes/83/6083/5","uploader":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"createdOn":1555617981,"author":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":385,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"cstyle?"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":385,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"`cstyle(1)` didn\u0027t catch this either. Sigh."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":758,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Is it worth trying to distinguish between being not-present and having an invalid fractional value? For example, if we had a 99 here as opposed to a missing value, should we still consider it a valid timestamp?"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":758,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"I don\u0027t see why we would consider any timestamp that doesn\u0027t conform to the RFC as valid.  The current code rightly rejects any such timestamp.  This is verified with this test:\n\n+       { \"20190416013457+0160\", \"Offset minutes too large\" },"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":758,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"OK, that wasn\u0027t clear to me based on the cast to void and the prior comments. I\u0027d suggest adding something like the following to the comment: \u0027If there was an invalid offset, it will cause us not to advance the pointer next, so we will fail the check for a nul character and can ignore the return value here.\u0027\n\nThe reason I suggest that is that it wasn\u0027t clear that we were relying on the side effect of not advancing next initially to be used as a way to indicate that this succeeded or failed, which is why I asked about the invalid offsets."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":758,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Done"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":2152,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Missing check for failure?"},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":2152,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"There\u0027s no way to return an error and VERIFY() seems rather severe.  The only thing that will be affected is isdigit_l().  Even if this were to fail, so long as the LDAP server returns ascii characters in the timestamp isdigit_l() never considers the locale.\n\nClearly what we want is the same outcome as this.\n\n#define\tisdigit(c)\t((c) \u003e\u003d \u00270\u0027 \u0026\u0026 c \u003c\u003d \u00279\u0027) \n\nISTM that we are only making life more difficult by trying to use any form of libc\u0027s isdigit()."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":2152,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"OK, well, since we already verify that the response isascii(), if you want to just check that it\u0027s an isdigit manually that seems reasonable. I would just add a comment above it as to why we\u0027re not using locales."},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","line":2152,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Done"},{"file":"usr/src/test/nsswitch-tests/runfiles/Makefile","line":16,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Did everyone here write these or was this just here because you copied it from somewhere else?"},{"file":"usr/src/test/nsswitch-tests/runfiles/Makefile","line":16,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"I copied a file and made minor edits."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/initpkg/nscd.conf","type":"MODIFIED","insertions":6,"deletions":-3},{"file":"usr/src/lib/nsswitch/Makefile.com","type":"MODIFIED","insertions":1,"deletions":-7},{"file":"usr/src/lib/nsswitch/Makefile.targ","type":"MODIFIED","insertions":3,"deletions":-4},{"file":"usr/src/lib/nsswitch/compat/Makefile.com","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/lib/nsswitch/dns/Makefile.com","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/lib/nsswitch/files/Makefile.com","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/lib/nsswitch/ldap/Makefile","type":"MODIFIED","insertions":1,"deletions":-3},{"file":"usr/src/lib/nsswitch/ldap/Makefile.com","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"usr/src/lib/nsswitch/ldap/Makefile.targ","type":"ADDED","insertions":20,"deletions":0},{"file":"usr/src/lib/nsswitch/ldap/amd64/Makefile","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"usr/src/lib/nsswitch/ldap/common/getexecattr.c","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/lib/nsswitch/ldap/common/getgrent.c","type":"MODIFIED","insertions":4,"deletions":-2},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","type":"MODIFIED","insertions":1641,"deletions":-363},{"file":"usr/src/lib/nsswitch/ldap/common/getspent.c","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"usr/src/lib/nsswitch/ldap/common/ldap_common.h","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/lib/nsswitch/ldap/common/provider.d","type":"ADDED","insertions":50,"deletions":0},{"file":"usr/src/lib/nsswitch/ldap/i386/Makefile","type":"MODIFIED","insertions":2,"deletions":-4},{"file":"usr/src/lib/nsswitch/ldap/sparc/Makefile","type":"MODIFIED","insertions":2,"deletions":-4},{"file":"usr/src/lib/nsswitch/ldap/sparcv9/Makefile","type":"MODIFIED","insertions":2,"deletions":-4},{"file":"usr/src/lib/nsswitch/nis/Makefile.com","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/man/man4/nscd.conf.4","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"usr/src/test/Makefile","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/test/nsswitch-tests/Makefile","type":"ADDED","insertions":20,"deletions":0},{"file":"usr/src/test/nsswitch-tests/runfiles/Makefile","type":"ADDED","insertions":41,"deletions":0},{"file":"usr/src/test/nsswitch-tests/runfiles/default.run","type":"ADDED","insertions":26,"deletions":0},{"file":"usr/src/test/nsswitch-tests/tests/Makefile","type":"ADDED","insertions":20,"deletions":0},{"file":"usr/src/test/nsswitch-tests/tests/ldap/Makefile","type":"ADDED","insertions":75,"deletions":0},{"file":"usr/src/test/nsswitch-tests/tests/ldap/generalized_time.c","type":"ADDED","insertions":246,"deletions":0}],"sizeInsertions":2200,"sizeDeletions":-410},{"number":"6","revision":"f51fb45279c3118729f1f2971733998158471160","parents":["26dd5a91c086ec5f65eaaa39f0651013e22d28e9"],"ref":"refs/changes/83/6083/6","uploader":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"createdOn":1556037088,"author":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/initpkg/nscd.conf","type":"MODIFIED","insertions":6,"deletions":-3},{"file":"usr/src/lib/nsswitch/Makefile.com","type":"MODIFIED","insertions":1,"deletions":-7},{"file":"usr/src/lib/nsswitch/Makefile.targ","type":"MODIFIED","insertions":3,"deletions":-4},{"file":"usr/src/lib/nsswitch/compat/Makefile.com","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/lib/nsswitch/dns/Makefile.com","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/lib/nsswitch/files/Makefile.com","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/lib/nsswitch/ldap/Makefile","type":"MODIFIED","insertions":1,"deletions":-3},{"file":"usr/src/lib/nsswitch/ldap/Makefile.com","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"usr/src/lib/nsswitch/ldap/Makefile.targ","type":"ADDED","insertions":20,"deletions":0},{"file":"usr/src/lib/nsswitch/ldap/amd64/Makefile","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"usr/src/lib/nsswitch/ldap/common/getexecattr.c","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/lib/nsswitch/ldap/common/getgrent.c","type":"MODIFIED","insertions":4,"deletions":-2},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","type":"MODIFIED","insertions":1642,"deletions":-363},{"file":"usr/src/lib/nsswitch/ldap/common/getspent.c","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"usr/src/lib/nsswitch/ldap/common/ldap_common.h","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/lib/nsswitch/ldap/common/provider.d","type":"ADDED","insertions":50,"deletions":0},{"file":"usr/src/lib/nsswitch/ldap/i386/Makefile","type":"MODIFIED","insertions":2,"deletions":-4},{"file":"usr/src/lib/nsswitch/ldap/sparc/Makefile","type":"MODIFIED","insertions":2,"deletions":-4},{"file":"usr/src/lib/nsswitch/ldap/sparcv9/Makefile","type":"MODIFIED","insertions":2,"deletions":-4},{"file":"usr/src/lib/nsswitch/nis/Makefile.com","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/man/man4/nscd.conf.4","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"usr/src/test/Makefile","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/test/nsswitch-tests/Makefile","type":"ADDED","insertions":20,"deletions":0},{"file":"usr/src/test/nsswitch-tests/runfiles/Makefile","type":"ADDED","insertions":41,"deletions":0},{"file":"usr/src/test/nsswitch-tests/runfiles/default.run","type":"ADDED","insertions":26,"deletions":0},{"file":"usr/src/test/nsswitch-tests/tests/Makefile","type":"ADDED","insertions":20,"deletions":0},{"file":"usr/src/test/nsswitch-tests/tests/ldap/Makefile","type":"ADDED","insertions":75,"deletions":0},{"file":"usr/src/test/nsswitch-tests/tests/ldap/generalized_time.c","type":"ADDED","insertions":246,"deletions":0}],"sizeInsertions":2201,"sizeDeletions":-410},{"number":"7","revision":"7b5c4a259d8a0737f1dec956183d012a90e11424","parents":["26dd5a91c086ec5f65eaaa39f0651013e22d28e9"],"ref":"refs/changes/83/6083/7","uploader":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"createdOn":1556047375,"author":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/initpkg/nscd.conf","type":"MODIFIED","insertions":6,"deletions":-3},{"file":"usr/src/lib/nsswitch/Makefile.com","type":"MODIFIED","insertions":1,"deletions":-7},{"file":"usr/src/lib/nsswitch/Makefile.targ","type":"MODIFIED","insertions":3,"deletions":-4},{"file":"usr/src/lib/nsswitch/compat/Makefile.com","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/lib/nsswitch/dns/Makefile.com","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/lib/nsswitch/files/Makefile.com","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/lib/nsswitch/ldap/Makefile","type":"MODIFIED","insertions":1,"deletions":-3},{"file":"usr/src/lib/nsswitch/ldap/Makefile.com","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"usr/src/lib/nsswitch/ldap/Makefile.targ","type":"ADDED","insertions":20,"deletions":0},{"file":"usr/src/lib/nsswitch/ldap/amd64/Makefile","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"usr/src/lib/nsswitch/ldap/common/getexecattr.c","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/lib/nsswitch/ldap/common/getgrent.c","type":"MODIFIED","insertions":4,"deletions":-2},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","type":"MODIFIED","insertions":1660,"deletions":-363},{"file":"usr/src/lib/nsswitch/ldap/common/getspent.c","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"usr/src/lib/nsswitch/ldap/common/ldap_common.h","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/lib/nsswitch/ldap/common/provider.d","type":"ADDED","insertions":50,"deletions":0},{"file":"usr/src/lib/nsswitch/ldap/i386/Makefile","type":"MODIFIED","insertions":2,"deletions":-4},{"file":"usr/src/lib/nsswitch/ldap/sparc/Makefile","type":"MODIFIED","insertions":2,"deletions":-4},{"file":"usr/src/lib/nsswitch/ldap/sparcv9/Makefile","type":"MODIFIED","insertions":2,"deletions":-4},{"file":"usr/src/lib/nsswitch/nis/Makefile.com","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/man/man4/nscd.conf.4","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"usr/src/test/Makefile","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/test/nsswitch-tests/Makefile","type":"ADDED","insertions":20,"deletions":0},{"file":"usr/src/test/nsswitch-tests/runfiles/Makefile","type":"ADDED","insertions":41,"deletions":0},{"file":"usr/src/test/nsswitch-tests/runfiles/default.run","type":"ADDED","insertions":26,"deletions":0},{"file":"usr/src/test/nsswitch-tests/tests/Makefile","type":"ADDED","insertions":20,"deletions":0},{"file":"usr/src/test/nsswitch-tests/tests/ldap/Makefile","type":"ADDED","insertions":75,"deletions":0},{"file":"usr/src/test/nsswitch-tests/tests/ldap/generalized_time.c","type":"ADDED","insertions":241,"deletions":0}],"sizeInsertions":2214,"sizeDeletions":-410},{"number":"8","revision":"ac6ff0374b4a733b77dd6d1963c950dd8f420903","parents":["26dd5a91c086ec5f65eaaa39f0651013e22d28e9"],"ref":"refs/changes/83/6083/8","uploader":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"createdOn":1556054430,"author":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1556054815,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1556057060,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/initpkg/nscd.conf","type":"MODIFIED","insertions":6,"deletions":-3},{"file":"usr/src/lib/nsswitch/Makefile.com","type":"MODIFIED","insertions":1,"deletions":-7},{"file":"usr/src/lib/nsswitch/Makefile.targ","type":"MODIFIED","insertions":3,"deletions":-4},{"file":"usr/src/lib/nsswitch/compat/Makefile.com","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/lib/nsswitch/dns/Makefile.com","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/lib/nsswitch/files/Makefile.com","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/lib/nsswitch/ldap/Makefile","type":"MODIFIED","insertions":1,"deletions":-3},{"file":"usr/src/lib/nsswitch/ldap/Makefile.com","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"usr/src/lib/nsswitch/ldap/Makefile.targ","type":"ADDED","insertions":20,"deletions":0},{"file":"usr/src/lib/nsswitch/ldap/amd64/Makefile","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"usr/src/lib/nsswitch/ldap/common/getexecattr.c","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/lib/nsswitch/ldap/common/getgrent.c","type":"MODIFIED","insertions":4,"deletions":-2},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","type":"MODIFIED","insertions":1663,"deletions":-363},{"file":"usr/src/lib/nsswitch/ldap/common/getspent.c","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"usr/src/lib/nsswitch/ldap/common/ldap_common.h","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/lib/nsswitch/ldap/common/provider.d","type":"ADDED","insertions":50,"deletions":0},{"file":"usr/src/lib/nsswitch/ldap/i386/Makefile","type":"MODIFIED","insertions":2,"deletions":-4},{"file":"usr/src/lib/nsswitch/ldap/sparc/Makefile","type":"MODIFIED","insertions":2,"deletions":-4},{"file":"usr/src/lib/nsswitch/ldap/sparcv9/Makefile","type":"MODIFIED","insertions":2,"deletions":-4},{"file":"usr/src/lib/nsswitch/nis/Makefile.com","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/man/man4/nscd.conf.4","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"usr/src/test/Makefile","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/test/nsswitch-tests/Makefile","type":"ADDED","insertions":20,"deletions":0},{"file":"usr/src/test/nsswitch-tests/runfiles/Makefile","type":"ADDED","insertions":41,"deletions":0},{"file":"usr/src/test/nsswitch-tests/runfiles/default.run","type":"ADDED","insertions":26,"deletions":0},{"file":"usr/src/test/nsswitch-tests/tests/Makefile","type":"ADDED","insertions":20,"deletions":0},{"file":"usr/src/test/nsswitch-tests/tests/ldap/Makefile","type":"ADDED","insertions":75,"deletions":0},{"file":"usr/src/test/nsswitch-tests/tests/ldap/generalized_time.c","type":"ADDED","insertions":241,"deletions":0}],"sizeInsertions":2217,"sizeDeletions":-410},{"number":"9","revision":"473f8961a1d44cfa6f374060d8d0c69a30b9dea5","parents":["486e689913103fa372f7e2c3e054b2bd602546c4"],"ref":"refs/changes/83/6083/9","uploader":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"createdOn":1556116940,"author":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1556054815,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1556057060,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/initpkg/nscd.conf","type":"MODIFIED","insertions":6,"deletions":-3},{"file":"usr/src/lib/nsswitch/Makefile.com","type":"MODIFIED","insertions":1,"deletions":-7},{"file":"usr/src/lib/nsswitch/Makefile.targ","type":"MODIFIED","insertions":3,"deletions":-4},{"file":"usr/src/lib/nsswitch/compat/Makefile.com","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/lib/nsswitch/dns/Makefile.com","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/lib/nsswitch/files/Makefile.com","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/lib/nsswitch/ldap/Makefile","type":"MODIFIED","insertions":1,"deletions":-3},{"file":"usr/src/lib/nsswitch/ldap/Makefile.com","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"usr/src/lib/nsswitch/ldap/Makefile.targ","type":"ADDED","insertions":20,"deletions":0},{"file":"usr/src/lib/nsswitch/ldap/amd64/Makefile","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"usr/src/lib/nsswitch/ldap/common/getexecattr.c","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/lib/nsswitch/ldap/common/getgrent.c","type":"MODIFIED","insertions":4,"deletions":-2},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","type":"MODIFIED","insertions":1663,"deletions":-363},{"file":"usr/src/lib/nsswitch/ldap/common/getspent.c","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"usr/src/lib/nsswitch/ldap/common/ldap_common.h","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/lib/nsswitch/ldap/common/provider.d","type":"ADDED","insertions":50,"deletions":0},{"file":"usr/src/lib/nsswitch/ldap/i386/Makefile","type":"MODIFIED","insertions":2,"deletions":-4},{"file":"usr/src/lib/nsswitch/ldap/sparc/Makefile","type":"MODIFIED","insertions":2,"deletions":-4},{"file":"usr/src/lib/nsswitch/ldap/sparcv9/Makefile","type":"MODIFIED","insertions":2,"deletions":-4},{"file":"usr/src/lib/nsswitch/nis/Makefile.com","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/man/man4/nscd.conf.4","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"usr/src/test/Makefile","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/test/nsswitch-tests/Makefile","type":"ADDED","insertions":20,"deletions":0},{"file":"usr/src/test/nsswitch-tests/runfiles/Makefile","type":"ADDED","insertions":41,"deletions":0},{"file":"usr/src/test/nsswitch-tests/runfiles/default.run","type":"ADDED","insertions":26,"deletions":0},{"file":"usr/src/test/nsswitch-tests/tests/Makefile","type":"ADDED","insertions":20,"deletions":0},{"file":"usr/src/test/nsswitch-tests/tests/ldap/Makefile","type":"ADDED","insertions":75,"deletions":0},{"file":"usr/src/test/nsswitch-tests/tests/ldap/generalized_time.c","type":"ADDED","insertions":241,"deletions":0}],"sizeInsertions":2217,"sizeDeletions":-410},{"number":"10","revision":"f15a024390e91ab5ead76690a0454d6f2ce7c189","parents":["486e689913103fa372f7e2c3e054b2bd602546c4"],"ref":"refs/changes/83/6083/10","uploader":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"createdOn":1556117070,"author":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1556054815,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1556057060,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/cmd/initpkg/nscd.conf","type":"MODIFIED","insertions":6,"deletions":-3},{"file":"usr/src/lib/nsswitch/Makefile.com","type":"MODIFIED","insertions":1,"deletions":-7},{"file":"usr/src/lib/nsswitch/Makefile.targ","type":"MODIFIED","insertions":3,"deletions":-4},{"file":"usr/src/lib/nsswitch/compat/Makefile.com","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/lib/nsswitch/dns/Makefile.com","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/lib/nsswitch/files/Makefile.com","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/lib/nsswitch/ldap/Makefile","type":"MODIFIED","insertions":1,"deletions":-3},{"file":"usr/src/lib/nsswitch/ldap/Makefile.com","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"usr/src/lib/nsswitch/ldap/Makefile.targ","type":"ADDED","insertions":20,"deletions":0},{"file":"usr/src/lib/nsswitch/ldap/amd64/Makefile","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"usr/src/lib/nsswitch/ldap/common/getexecattr.c","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/lib/nsswitch/ldap/common/getgrent.c","type":"MODIFIED","insertions":4,"deletions":-2},{"file":"usr/src/lib/nsswitch/ldap/common/getnetgrent.c","type":"MODIFIED","insertions":1663,"deletions":-363},{"file":"usr/src/lib/nsswitch/ldap/common/getspent.c","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"usr/src/lib/nsswitch/ldap/common/ldap_common.h","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/lib/nsswitch/ldap/common/provider.d","type":"ADDED","insertions":50,"deletions":0},{"file":"usr/src/lib/nsswitch/ldap/i386/Makefile","type":"MODIFIED","insertions":2,"deletions":-4},{"file":"usr/src/lib/nsswitch/ldap/sparc/Makefile","type":"MODIFIED","insertions":2,"deletions":-4},{"file":"usr/src/lib/nsswitch/ldap/sparcv9/Makefile","type":"MODIFIED","insertions":2,"deletions":-4},{"file":"usr/src/lib/nsswitch/nis/Makefile.com","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/man/man4/nscd.conf.4","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"usr/src/test/Makefile","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/test/nsswitch-tests/Makefile","type":"ADDED","insertions":20,"deletions":0},{"file":"usr/src/test/nsswitch-tests/runfiles/Makefile","type":"ADDED","insertions":41,"deletions":0},{"file":"usr/src/test/nsswitch-tests/runfiles/default.run","type":"ADDED","insertions":26,"deletions":0},{"file":"usr/src/test/nsswitch-tests/tests/Makefile","type":"ADDED","insertions":20,"deletions":0},{"file":"usr/src/test/nsswitch-tests/tests/ldap/Makefile","type":"ADDED","insertions":75,"deletions":0},{"file":"usr/src/test/nsswitch-tests/tests/ldap/generalized_time.c","type":"ADDED","insertions":241,"deletions":0}],"sizeInsertions":2217,"sizeDeletions":-410}],"allReviewers":[{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}]}