From a81cad53ebd7e9d2a3442242d42f863d6a1186ab Mon Sep 17 00:00:00 2001
From: Todd Whiteman <todd.whiteman@joyent.com>
Date: Tue, 13 Jun 2017 11:57:18 -0700
Subject: [PATCH] OS-6177 drop md5 hashing from imgadm import

---
 src/img/lib/imgadm.js | 8 +++++---
 1 file changed, 5 insertions(+), 3 deletions(-)

diff --git a/src/img/lib/imgadm.js b/src/img/lib/imgadm.js
index 8b733c31..607ba051 100644
--- a/src/img/lib/imgadm.js
+++ b/src/img/lib/imgadm.js
@@ -20,7 +20,7 @@
  *
  * CDDL HEADER END
  *
- * Copyright (c) 2015, Joyent, Inc. All rights reserved.
+ * Copyright (c) 2017, Joyent, Inc. All rights reserved.
  *
  * * *
  * The main imgadm functionality. The CLI is a light wrapper around this tool.
@@ -1424,10 +1424,12 @@ IMGADM.prototype._downloadImageFile = function _downloadImageFile(opts, cb) {
             if (!zstream && opts.imgMeta.checksum) {
                 ctx.checksum = opts.imgMeta.checksum.split(':');
                 ctx.checksumHash = crypto.createHash(ctx.checksum[0]);
-            }
-            if (ctx.stream.headers['content-md5']) {
+                log.debug({uuid: uuid}, 'creating %s checksum hash',
+                    ctx.checksum[0]);
+            } else if (ctx.stream.headers['content-md5']) {
                 ctx.contentMd5 = ctx.stream.headers['content-md5'];
                 ctx.md5sumHash = crypto.createHash('md5');
+                log.debug({uuid: uuid}, 'creating md5 checksum hash');
             }
             ctx.stream.on('data', function (chunk) {
                 if (opts.bar)
-- 
2.21.0

