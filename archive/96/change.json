{"project":"joyent/illumos-joyent","branch":"master","id":"I1436d54580f1c4a257c82c438ba282a9a149b732","number":"96","subject":"OS-5518 devpoll write feigns success in the face of EINTR OS-5520 epoll_ctl not allowed to emit EINTR Reviewed by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e Reviewed by: Bryan Cantrill \u003cbryan@joyent.com\u003e","owner":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"url":"https://cr.joyent.us/96","commitMessage":"OS-5518 devpoll write feigns success in the face of EINTR\nOS-5520 epoll_ctl not allowed to emit EINTR\nReviewed by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e\nReviewed by: Bryan Cantrill \u003cbryan@joyent.com\u003e\n","createdOn":1468874870,"lastUpdated":1468893813,"open":false,"status":"MERGED","comments":[{"timestamp":1468874870,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 1."},{"timestamp":1468875736,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 1: Code-Review+1"},{"timestamp":1468880343,"reviewer":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"message":"Patch Set 1:\n\n(2 comments)\n\nOne total nit and one comment that only rises slightly above nit to make the code slightly more readable. Otherwise, looks great -- nasty bug!"},{"timestamp":1468882321,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 2."},{"timestamp":1468882340,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 1:\n\n(2 comments)"},{"timestamp":1468883168,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 2: Code-Review+1\n\nStill fine with this."},{"timestamp":1468885876,"reviewer":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1468886018,"reviewer":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"message":"Patch Set 2: Code-Review+1\n\nLooks good to me -- thanks!"},{"timestamp":1468893508,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 2: Code-Review+2"},{"timestamp":1468893813,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Patrick Mooney"}],"currentPatchSet":{"number":"2","revision":"1436d54580f1c4a257c82c438ba282a9a149b732","parents":["dda35189e97fb97cbc0cdf00dbd4b1dda1d2b840"],"ref":"refs/changes/96/96/2","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1468882321,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1468883168,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1468886018,"by":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"}},{"type":"Code-Review","description":"Code-Review","value":"2","grantedOn":1468893508,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"SUBM","value":"1","grantedOn":1468893813,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/lib/libc/port/sys/epoll.c","type":"MODIFIED","insertions":9,"deletions":0},{"file":"usr/src/uts/common/io/devpoll.c","type":"MODIFIED","insertions":18,"deletions":-2}],"sizeInsertions":27,"sizeDeletions":-2},"patchSets":[{"number":"1","revision":"bc42c1bebb193bb154f606263f6e645d8ead4885","parents":["bc29f52cff4e655c5a4ea04db3574fdbe367fcde"],"ref":"refs/changes/96/96/1","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1468874870,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1468875736,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"comments":[{"file":"usr/src/lib/libc/port/sys/epoll.c","line":168,"reviewer":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"message":"Worth turning this into a \"do { } while (res \u003d\u003d -1 \u0026\u0026 errno \u003d\u003d INTR);\" loop with the EINTR block comment above the \"while\"?"},{"file":"usr/src/lib/libc/port/sys/epoll.c","line":168,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"I coded it up this way but it didn\u0027t seem to add clarity to the situation.  I prefer to have the errno handling consolidated to one block."},{"file":"usr/src/lib/libc/port/sys/epoll.c","line":168,"reviewer":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"message":"Sounds good -- thanks for taking a look!"},{"file":"usr/src/uts/common/io/devpoll.c","line":712,"reviewer":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},"message":"Total nit, but worth adding a \"When copying in the pollfd array, we \" to make it a more complete sentence? Like I said, total nit; feel free to ignore if it\u0027s already sufficiently explicit."},{"file":"usr/src/uts/common/io/devpoll.c","line":712,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"usr/src/lib/libc/port/sys/epoll.c","type":"MODIFIED","insertions":9,"deletions":0},{"file":"usr/src/uts/common/io/devpoll.c","type":"MODIFIED","insertions":18,"deletions":-2}],"sizeInsertions":27,"sizeDeletions":-2},{"number":"2","revision":"1436d54580f1c4a257c82c438ba282a9a149b732","parents":["dda35189e97fb97cbc0cdf00dbd4b1dda1d2b840"],"ref":"refs/changes/96/96/2","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1468882321,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1468886018,"by":{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1468883168,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"2","grantedOn":1468893508,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"SUBM","value":"1","grantedOn":1468893813,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/lib/libc/port/sys/epoll.c","type":"MODIFIED","insertions":9,"deletions":0},{"file":"usr/src/uts/common/io/devpoll.c","type":"MODIFIED","insertions":18,"deletions":-2}],"sizeInsertions":27,"sizeDeletions":-2}],"allReviewers":[{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}]}