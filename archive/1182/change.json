{"project":"joyent/sdc-wf-client","branch":"master","id":"I4a673514f96ccf4a37f059c8dc82205c3e59ce2f","number":"1182","subject":"WORKFLOW-216 Cleanup wf-client.createJob method Reviewed by: Trent Mick \u003ctrent.mick@joyent.com\u003e","owner":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"url":"https://cr.joyent.us/1182","commitMessage":"WORKFLOW-216 Cleanup wf-client.createJob method\nReviewed by: Trent Mick \u003ctrent.mick@joyent.com\u003e\n","createdOn":1482519403,"lastUpdated":1487776570,"open":false,"status":"MERGED","comments":[{"timestamp":1482519403,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 1."},{"timestamp":1482519446,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1483735275,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 1:\n\n(1 comment)\n\nOther than the one thing below, it LGTM."},{"timestamp":1483959231,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 2."},{"timestamp":1483959250,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 1:\n\n(1 comment)\n\nApplied the change you suggested here, Trent"},{"timestamp":1483959269,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1486168446,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1487677971,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 3."},{"timestamp":1487678003,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1487678187,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 3:\n\n(1 comment)\n\nTrent, made some minor changes to address your concerns about versioning and possible APIs using any of the deprecated method signatures."},{"timestamp":1487697360,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 3: Code-Review+1 Integration-Approval+1"},{"timestamp":1487776570,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Pedro Palazón Candel"}],"currentPatchSet":{"number":"3","revision":"4a673514f96ccf4a37f059c8dc82205c3e59ce2f","parents":["109b303f5617b5ac2cbc55c7862b4226c8ba0882"],"ref":"refs/changes/82/1182/3","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1487677971,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1487678003,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1487697360,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1487697360,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1487776570,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":18,"deletions":-1},{"file":"lib/wf-client.js","type":"MODIFIED","insertions":22,"deletions":-59},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/wf-client.test.js","type":"MODIFIED","insertions":2,"deletions":-21}],"sizeInsertions":43,"sizeDeletions":-82},"patchSets":[{"number":"1","revision":"d705d237e1e38ca88d4a361bc0c82080f30f6338","parents":["109b303f5617b5ac2cbc55c7862b4226c8ba0882"],"ref":"refs/changes/82/1182/1","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1482519403,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1482519446,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/wf-client.js","line":406,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"This is changing the passed in \"options\" object, which *could* surprise the caller. I think it should do a shallow copy of the object.\n\nIt is also changing behaviour such that the caller can pass restify client.post options other than options.headers. Do you want that? If it isn\u0027t necessary, I\u0027d lean towards NOT adding functionality like this. I.e. perhaps go back to:\n\n```\nvar postOpts \u003d {path: \u0027/jobs\u0027};\nif (options.headers) {\n    postOpts.headers \u003d options.headers;\n}\n```"},{"file":"lib/wf-client.js","line":406,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"No special need for adding restify options so moving back to what you suggest here"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":3,"deletions":0},{"file":"lib/wf-client.js","type":"MODIFIED","insertions":19,"deletions":-58},{"file":"test/wf-client.test.js","type":"MODIFIED","insertions":2,"deletions":-21}],"sizeInsertions":24,"sizeDeletions":-79},{"number":"2","revision":"cdfa2fa6442a7c176752b08efbdef192ac06d2ff","parents":["109b303f5617b5ac2cbc55c7862b4226c8ba0882"],"ref":"refs/changes/82/1182/2","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1483959231,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1483959269,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"CHANGES.md","line":7,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"This should mention this is backward incompatible and give an example of the API change. Then this should be a major ver bump. There are cases in code using the calling form that is being dropped. E.g.:\n\nsdc-cnapi/lib/models/server.js:    ModelServer.getWorkflow().getClient().createJob(\nsdc-cnapi/lib/models/server.js-        \u0027server-sysinfo\u0027,\nsdc-cnapi/lib/models/server.js-        params,\nsdc-cnapi/lib/models/server.js-        function (error, job) {\n--\nsdc-cnapi/lib/models/server.js:        ModelServer.getWorkflow().getClient().createJob(\nsdc-cnapi/lib/models/server.js-            \u0027server-reboot\u0027,\nsdc-cnapi/lib/models/server.js-            wfParams,\nsdc-cnapi/lib/models/server.js-            function (error, job) {\n\nand others, e.g.:\n\nsdc-cnapi/test/lib/mock.js\n135:MockWorkflow.prototype.createJob \u003d function (workflowName, params, callback) {\n\nsdc-napi/test/lib/mock-wf.js\n42:FakeWFclient.prototype.createJob \u003d function createJob(name, params, callback) {"},{"file":"CHANGES.md","line":7,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Trent, I\u0027ve added some extra explanation of what it\u0027s dropped to this file, mostly b/c this comments makes clear that it\u0027s confusing. Anyway, these examples you mention are still supported, since are calling the function using one of the two supported ways:\n\n      createJob(wf, params, options, cb)\n      createJob(wf, params, cb)\n\nI\u0027ve also bumped version to 0.3.0, mostly to note that it\u0027s a relevant change but, before to push anything, I checked all our repos for anything using the dropped method signatures and nothing at all was using it."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":3,"deletions":0},{"file":"lib/wf-client.js","type":"MODIFIED","insertions":21,"deletions":-58},{"file":"test/wf-client.test.js","type":"MODIFIED","insertions":2,"deletions":-21}],"sizeInsertions":26,"sizeDeletions":-79},{"number":"3","revision":"4a673514f96ccf4a37f059c8dc82205c3e59ce2f","parents":["109b303f5617b5ac2cbc55c7862b4226c8ba0882"],"ref":"refs/changes/82/1182/3","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1487677971,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1487678003,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1487697360,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1487697360,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1487776570,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":18,"deletions":-1},{"file":"lib/wf-client.js","type":"MODIFIED","insertions":22,"deletions":-59},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/wf-client.test.js","type":"MODIFIED","insertions":2,"deletions":-21}],"sizeInsertions":43,"sizeDeletions":-82}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"}]}