From ea39aeca8a39b78bfecea2864c9e2a4cd8502249 Mon Sep 17 00:00:00 2001
From: Trent Mick <trentm@gmail.com>
Date: Fri, 22 Jun 2018 09:24:50 -0700
Subject: [PATCH] =?UTF-8?q?TRITON-531=20sdcadm=20checkIfTmpVMHasErrors=20c?=
 =?UTF-8?q?alls=20back=20with=20a=20string=20instead=20of=20an=20Error=20i?=
 =?UTF-8?q?nstance=20Reviewed=20by:=20Pedro=20Palaz=C3=B3n=20Candel=20<ped?=
 =?UTF-8?q?ro@joyent.com>=20Approved=20by:=20Pedro=20Palaz=C3=B3n=20Candel?=
 =?UTF-8?q?=20<pedro@joyent.com>?=
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

---
 lib/procedures/shared.js | 8 +++++---
 1 file changed, 5 insertions(+), 3 deletions(-)

diff --git a/lib/procedures/shared.js b/lib/procedures/shared.js
index f20c70b..3d1dc85 100644
--- a/lib/procedures/shared.js
+++ b/lib/procedures/shared.js
@@ -614,15 +614,17 @@ function checkIfTmpVMHasErrors(arg, next) {
                 next(err);
                 return;
             }
-            var errs = stdout.trim();
-            if (errs) {
+            var errOutput = stdout.trim();
+            if (errOutput) {
                 if (counter < limit) {
                     setTimeout(_checkIfItHasErrors, 5000);
                     return;
                 } else {
                     progress('Timeout (5m) waiting for %s to be up',
                             arg.tmpUUID);
-                    next(errs);
+                    next(new errors.InternalError({
+                        message: errOutput
+                    }));
                     return;
                 }
             }
-- 
2.21.0

