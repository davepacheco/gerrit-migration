{"project":"joyent/illumos-joyent","branch":"master","topic":"TRITON-885","id":"If8e2fffbe197c9ab755a401bb4d86208b99a2c77","number":"5009","subject":"OS-7325 Want configurable output field separator for libofmt Portions contributed by: Cody Peter Mello \u003ccody.mello@joyent.com\u003e Reviewed by: Jason King \u003cjason.king@joyent.com\u003e Reviewed by: Robert Mustacchi \u003crm@joyent.com\u003e Approved by: Dan McDonald \u003cdanmcd@","owner":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"url":"https://cr.joyent.us/5009","commitMessage":"OS-7325 Want configurable output field separator for libofmt\nPortions contributed by: Cody Peter Mello \u003ccody.mello@joyent.com\u003e\nReviewed by: Jason King \u003cjason.king@joyent.com\u003e\nReviewed by: Robert Mustacchi \u003crm@joyent.com\u003e\nApproved by: Dan McDonald \u003cdanmcd@joyent.com\u003e\n","createdOn":1540918280,"lastUpdated":1553893013,"open":false,"status":"MERGED","comments":[{"timestamp":1540918280,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 1."},{"timestamp":1540918306,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Topic set to TRITON-885"},{"timestamp":1544038574,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 2."},{"timestamp":1545078570,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1549926761,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 2:\n\n(2 comments)"},{"timestamp":1549929290,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 3."},{"timestamp":1550008023,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 4: Patch Set 3 was rebased."},{"timestamp":1550022397,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 4:\n\n(4 comments)"},{"timestamp":1550091504,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 5."},{"timestamp":1550091531,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 5:\n\n(4 comments)"},{"timestamp":1550160096,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 4:\n\n(1 comment)"},{"timestamp":1550250253,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 4:\n\n(1 comment)"},{"timestamp":1550605561,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 5:\n\n(1 comment)"},{"timestamp":1550613382,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 5: Code-Review+1\n\n(1 comment)"},{"timestamp":1550614100,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 5: Code-Review+1"},{"timestamp":1553645157,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 6: Patch Set 5 was rebased."},{"timestamp":1553645674,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 6: Integration-Approval+1\n\nThanks for the regression reality-check."},{"timestamp":1553711426,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 7: Commit message was updated."},{"timestamp":1553892931,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 8: Patch Set 7 was rebased."},{"timestamp":1553893013,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Cody Peter Mello"}],"currentPatchSet":{"number":"8","revision":"f8e2fffbe197c9ab755a401bb4d86208b99a2c77","parents":["e6c7580c6215121cdb3e00cf18843f8010beda6c"],"ref":"refs/changes/09/5009/8","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1553892931,"author":{"name":"Sebastien Roy","email":"seb@delphix.com","username":""},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1550613382,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1550614100,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1553645674,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"SUBM","value":"1","grantedOn":1553893013,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"usr/src/lib/libofmt/common/mapfile-vers","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/lib/libofmt/common/ofmt.c","type":"MODIFIED","insertions":45,"deletions":-44},{"file":"usr/src/lib/libofmt/common/ofmt.h","type":"MODIFIED","insertions":15,"deletions":-2},{"file":"usr/src/man/man3ofmt/Makefile","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/man/man3ofmt/ofmt.3ofmt","type":"MODIFIED","insertions":28,"deletions":-1}],"sizeInsertions":93,"sizeDeletions":-48},"patchSets":[{"number":"1","revision":"f162d09b7810d47a66f0f4f796b9cc53ea2a8d3e","parents":["7a70cf1aae9b2e74d5a5f7a0ef7cc6f4b2c6e4c5"],"ref":"refs/changes/09/5009/1","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1540918280,"author":{"name":"Sebastien Roy","email":"seb@delphix.com","username":""},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/lib/libofmt/common/ofmt.c","line":459,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"I\u0027m suspicious of this line; should this actually be incremented if we haven\u0027t printed a header?"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/libinetutil/common/mapfile-vers","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/lib/libofmt/common/mapfile-vers","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/lib/libofmt/common/ofmt.c","type":"MODIFIED","insertions":45,"deletions":-44},{"file":"usr/src/lib/libofmt/common/ofmt.h","type":"MODIFIED","insertions":15,"deletions":-2},{"file":"usr/src/man/man3ofmt/Makefile","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/man/man3ofmt/ofmt.3ofmt","type":"MODIFIED","insertions":26,"deletions":0}],"sizeInsertions":93,"sizeDeletions":-47},{"number":"2","revision":"0423423ccdcaeed96e2ba087d12f12ffdedd8b42","parents":["7a70cf1aae9b2e74d5a5f7a0ef7cc6f4b2c6e4c5"],"ref":"refs/changes/09/5009/2","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1544038574,"author":{"name":"Sebastien Roy","email":"seb@delphix.com","username":""},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/lib/libinetutil/common/mapfile-vers","line":70,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Since these are new functions, do we need to provide the compatibility filters in libinetutil?  In other words, shouldn\u0027t we expect that anything using these new functions should also expect to link against libofmt?"},{"file":"usr/src/lib/libinetutil/common/mapfile-vers","line":70,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"That\u0027s fair. I\u0027ll remove this part of the change."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/libinetutil/common/mapfile-vers","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/lib/libofmt/common/mapfile-vers","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/lib/libofmt/common/ofmt.c","type":"MODIFIED","insertions":45,"deletions":-44},{"file":"usr/src/lib/libofmt/common/ofmt.h","type":"MODIFIED","insertions":15,"deletions":-2},{"file":"usr/src/man/man3ofmt/Makefile","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/man/man3ofmt/ofmt.3ofmt","type":"MODIFIED","insertions":28,"deletions":0}],"sizeInsertions":95,"sizeDeletions":-47},{"number":"3","revision":"79cd94c9b0c2d04291d5ed17b4048ea0f346a4f0","parents":["7a70cf1aae9b2e74d5a5f7a0ef7cc6f4b2c6e4c5"],"ref":"refs/changes/09/5009/3","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1549929290,"author":{"name":"Sebastien Roy","email":"seb@delphix.com","username":""},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/libofmt/common/mapfile-vers","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/lib/libofmt/common/ofmt.c","type":"MODIFIED","insertions":45,"deletions":-44},{"file":"usr/src/lib/libofmt/common/ofmt.h","type":"MODIFIED","insertions":15,"deletions":-2},{"file":"usr/src/man/man3ofmt/Makefile","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/man/man3ofmt/ofmt.3ofmt","type":"MODIFIED","insertions":28,"deletions":0}],"sizeInsertions":93,"sizeDeletions":-47},{"number":"4","revision":"ab64fbca1733e9ad3c1937c5fab0495186af1a45","parents":["59cb9bcae7f90cd6723ee6d475129288d4c36629"],"ref":"refs/changes/09/5009/4","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1550008023,"author":{"name":"Sebastien Roy","email":"seb@delphix.com","username":""},"isDraft":false,"kind":"TRIVIAL_REBASE","comments":[{"file":"usr/src/lib/libofmt/common/ofmt.c","line":196,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"This should be unsigned, especially as split_fields uses an unsigned value. The loop iterator, j, already is as well."},{"file":"usr/src/lib/libofmt/common/ofmt.c","line":196,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Done"},{"file":"usr/src/lib/libofmt/common/ofmt.c","line":651,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Probably shouldn\u0027t be a tab character."},{"file":"usr/src/lib/libofmt/common/ofmt.c","line":651,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Fixed"},{"file":"usr/src/lib/libofmt/common/ofmt.h","line":202,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"So a pretty fundamental question I have is should this really be a char or not? I guess this is private so we can change it; however, it seems like this would basically stop our ability to ever support wide characters properly here, which is unfortunate. I guess we can punt on this for now, but it doesn\u0027t seem great."},{"file":"usr/src/lib/libofmt/common/ofmt.h","line":202,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"I can change this to a wchar_t if you want. I don\u0027t know if that\u0027s easier for consumers or not, since they\u0027d then have to use mbtowc when accepting a separator from the command-line. This could also be made a \"const char *\" that gets copied into the ofmt_state_t, and this function returns OFMT_ELONGSEP or similar when it\u0027s too big to fit."},{"file":"usr/src/lib/libofmt/common/ofmt.h","line":202,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Thinking on it more, since this is still private, it\u0027s probably not worth it. We can change it when the time comes and we actually have someone who wants to consume it."},{"file":"usr/src/man/man3ofmt/ofmt.3ofmt","line":16,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Date needs to be updated."},{"file":"usr/src/man/man3ofmt/ofmt.3ofmt","line":16,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Done"},{"file":"usr/src/man/man3ofmt/ofmt.3ofmt","line":16,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Doesn\u0027t seem done in the latest version?"},{"file":"usr/src/man/man3ofmt/ofmt.3ofmt","line":16,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"It\u0027s in patchset 5:\n\nhttps://cr.joyent.us/#/c/5009/4..5/usr/src/man/man3ofmt/ofmt.3ofmt@16"},{"file":"usr/src/man/man3ofmt/ofmt.3ofmt","line":16,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Thanks, not sure why I missed it."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/libofmt/common/mapfile-vers","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/lib/libofmt/common/ofmt.c","type":"MODIFIED","insertions":45,"deletions":-44},{"file":"usr/src/lib/libofmt/common/ofmt.h","type":"MODIFIED","insertions":15,"deletions":-2},{"file":"usr/src/man/man3ofmt/Makefile","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/man/man3ofmt/ofmt.3ofmt","type":"MODIFIED","insertions":27,"deletions":0}],"sizeInsertions":92,"sizeDeletions":-47},{"number":"5","revision":"996f677df45233a6b7ddb84ee68cd46bcf036fe6","parents":["6f70878428a80e83775ad270d9b856d4a4fe3f54"],"ref":"refs/changes/09/5009/5","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1550091504,"author":{"name":"Sebastien Roy","email":"seb@delphix.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1550613382,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1550614100,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/libofmt/common/mapfile-vers","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/lib/libofmt/common/ofmt.c","type":"MODIFIED","insertions":45,"deletions":-44},{"file":"usr/src/lib/libofmt/common/ofmt.h","type":"MODIFIED","insertions":15,"deletions":-2},{"file":"usr/src/man/man3ofmt/Makefile","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/man/man3ofmt/ofmt.3ofmt","type":"MODIFIED","insertions":28,"deletions":-1}],"sizeInsertions":93,"sizeDeletions":-48},{"number":"6","revision":"f7d20445a806f04686b89d40664554045c9322ba","parents":["5ffb784f5a3c76e1a0dfe2349748d3a9a8f33082"],"ref":"refs/changes/09/5009/6","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1553645157,"author":{"name":"Sebastien Roy","email":"seb@delphix.com","username":""},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1550613382,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1550614100,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1553645674,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/libofmt/common/mapfile-vers","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/lib/libofmt/common/ofmt.c","type":"MODIFIED","insertions":45,"deletions":-44},{"file":"usr/src/lib/libofmt/common/ofmt.h","type":"MODIFIED","insertions":15,"deletions":-2},{"file":"usr/src/man/man3ofmt/Makefile","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/man/man3ofmt/ofmt.3ofmt","type":"MODIFIED","insertions":28,"deletions":-1}],"sizeInsertions":93,"sizeDeletions":-48},{"number":"7","revision":"a91347bc1ab722a6c775831e26be9785738c4ead","parents":["5ffb784f5a3c76e1a0dfe2349748d3a9a8f33082"],"ref":"refs/changes/09/5009/7","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1553711426,"author":{"name":"Sebastien Roy","email":"seb@delphix.com","username":""},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1550613382,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1550614100,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1553645674,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"usr/src/lib/libofmt/common/mapfile-vers","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/lib/libofmt/common/ofmt.c","type":"MODIFIED","insertions":45,"deletions":-44},{"file":"usr/src/lib/libofmt/common/ofmt.h","type":"MODIFIED","insertions":15,"deletions":-2},{"file":"usr/src/man/man3ofmt/Makefile","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/man/man3ofmt/ofmt.3ofmt","type":"MODIFIED","insertions":28,"deletions":-1}],"sizeInsertions":93,"sizeDeletions":-48},{"number":"8","revision":"f8e2fffbe197c9ab755a401bb4d86208b99a2c77","parents":["e6c7580c6215121cdb3e00cf18843f8010beda6c"],"ref":"refs/changes/09/5009/8","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1553892931,"author":{"name":"Sebastien Roy","email":"seb@delphix.com","username":""},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1550613382,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"SUBM","value":"1","grantedOn":1553893013,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1550614100,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1553645674,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"usr/src/lib/libofmt/common/mapfile-vers","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/lib/libofmt/common/ofmt.c","type":"MODIFIED","insertions":45,"deletions":-44},{"file":"usr/src/lib/libofmt/common/ofmt.h","type":"MODIFIED","insertions":15,"deletions":-2},{"file":"usr/src/man/man3ofmt/Makefile","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/man/man3ofmt/ofmt.3ofmt","type":"MODIFIED","insertions":28,"deletions":-1}],"sizeInsertions":93,"sizeDeletions":-48}],"allReviewers":[{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}]}