From 7f6b7d6d12873886bcc4c7b8957a19c08b3c2ded Mon Sep 17 00:00:00 2001
From: Ante Vojvodic <ante@atcorner.hr>
Date: Wed, 19 Jun 2019 09:32:36 +0200
Subject: [PATCH] OS-7848 configure should import configure-build if it exists
 Reviewed by: John Levon <john.levon@joyent.com> Reviewed by: Tim Foster
 <tim.foster@joyent.com> Approved by: Tim Foster <tim.foster@joyent.com>

---
 configure | 14 +++-----------
 1 file changed, 3 insertions(+), 11 deletions(-)

diff --git a/configure b/configure
index cb46dc5e..02ac4dcd 100755
--- a/configure
+++ b/configure
@@ -31,8 +31,9 @@ conf_pkgsrcurl="https://download.joyent.com/pub/build/pkgsrc"
 # Build defaults which are unlikely to change, but may be overridden by
 # configure-build.
 #
-if [[ ! -f configure-build ]]; then
-	source default.configure-build
+source default.configure-build
+if [[ -f configure-build ]]; then
+	source configure-build || fatal "failed to source configure-build"
 fi
 
 #
@@ -58,13 +59,6 @@ function fatal
 	exit 1
 }
 
-function source_vars
-{
-	if [[ -f "configure-build" ]]; then
-		source "$file" || fatal "failed to source configure-build"
-	fi
-}
-
 function check_loc
 {
 	[[ "$(readlink -f "$PWD")" != "$(readlink -f "$conf_arg0_dir")" ]] && \
@@ -478,8 +472,6 @@ read -r -d '' usage <<EOF
 		shadow compilers, comma delimited (gcc7,gcc#) [default: none]
 EOF
 
-source_vars
-
 while getopts "cdhp:rs:" arg; do
 	case $arg in
 	c)
-- 
2.21.0

