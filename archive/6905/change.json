{"project":"joyent/sdc-firewaller-agent","branch":"master","id":"Ie6c02fc40a01f43e15b44e279c75757dd2b15b65","number":"6905","subject":"TRITON-1894 svc:/smartdc/agent/firewaller-config-migration:default goes into maint Reviewed by: Trent Mick \u003ctrentm@gmail.com\u003e Reviewed by: Josh Wilsdon \u003cjosh@wilsdon.ca\u003e Approved by: Trent Mick \u003ctrentm@gmail.com\u003e","owner":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"url":"https://cr.joyent.us/6905","commitMessage":"TRITON-1894 svc:/smartdc/agent/firewaller-config-migration:default goes into maint\nReviewed by: Trent Mick \u003ctrentm@gmail.com\u003e\nReviewed by: Josh Wilsdon \u003cjosh@wilsdon.ca\u003e\nApproved by: Trent Mick \u003ctrentm@gmail.com\u003e\n","createdOn":1568384973,"lastUpdated":1568644095,"open":false,"status":"MERGED","comments":[{"timestamp":1568384973,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 1."},{"timestamp":1568384978,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit 4dde4da173ec3a71cc1dc36d8d1b1c6ca7f81187\n    \n    TRITON-1894 Lack of VM IPFv4 file causes fw-config-migration mainteinance"},{"timestamp":1568385033,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1568394782,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 1: Code-Review-1\n\n(1 comment)"},{"timestamp":1568396508,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 1: Code-Review-1\n\n(1 comment)"},{"timestamp":1568398915,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 2."},{"timestamp":1568398920,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit a6358b6861309d5c33c669612e5b1802bea4bd8b\n    \n    TRITON-1894 Lack of VM IPFv4 file causes fw-config-migration mainteinance"},{"timestamp":1568398978,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1568399275,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 2:\n\n(2 comments)\n\nThanks folks. I\u0027ve just put the file into my local COAL copy and the service boots fine. Anyway, I don\u0027t have any broken docker VM so I just tested by manually removing the ipfv4 file from a \"normal\" zone."},{"timestamp":1568405787,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 2: Code-Review+1 Integration-Approval+1"},{"timestamp":1568408047,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 2: Code-Review+1"},{"timestamp":1568644080,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 3: Commit message was updated."},{"timestamp":1568644095,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Pedro Palazón Candel"}],"currentPatchSet":{"number":"3","revision":"e6c02fc40a01f43e15b44e279c75757dd2b15b65","parents":["8aab18014eceb29fd5986cf1ebb35c1d01af7b5a"],"ref":"refs/changes/05/6905/3","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1568644080,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1568398978,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1568405787,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1568405787,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1568408047,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"SUBM","value":"1","grantedOn":1568644095,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"config-migration.js","type":"MODIFIED","insertions":11,"deletions":-1}],"sizeInsertions":11,"sizeDeletions":-1},"patchSets":[{"number":"1","revision":"b1e97f5b26a1c2c0980191f8c68b4e6c0bcff4f6","parents":["8aab18014eceb29fd5986cf1ebb35c1d01af7b5a"],"ref":"refs/changes/05/6905/1","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1568384973,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1568385033,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"-1","grantedOn":1568396508,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Code-Review","description":"Code-Review","value":"-1","grantedOn":1568394782,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}}],"comments":[{"file":"config-migration.js","line":80,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"I think you mean existsSync.\n\nAlso, do we really want to be using a synchronous check here?\n\nAlso, it\u0027d be good to test this at least manually. :)"},{"file":"config-migration.js","line":80,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Indeed, I was meaning that. Trent\u0027s suggestion below is definitely better than what I was doing."},{"file":"config-migration.js","line":84,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"While it seems unlikely there would be race on this, doing \"exists? read it\" is a pattern that allows for it. Perhaps handle the errno.ENOENT exception from `fs.readFileSync`?"},{"file":"config-migration.js","line":84,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"You\u0027re right, modified as suggested."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"config-migration.js","type":"MODIFIED","insertions":4,"deletions":0}],"sizeInsertions":4,"sizeDeletions":0},{"number":"2","revision":"51033baa533c248dff7ea37525d1e2455acc96b3","parents":["8aab18014eceb29fd5986cf1ebb35c1d01af7b5a"],"ref":"refs/changes/05/6905/2","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1568398915,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1568398978,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1568405787,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1568405787,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1568408047,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"config-migration.js","type":"MODIFIED","insertions":11,"deletions":-1}],"sizeInsertions":11,"sizeDeletions":-1},{"number":"3","revision":"e6c02fc40a01f43e15b44e279c75757dd2b15b65","parents":["8aab18014eceb29fd5986cf1ebb35c1d01af7b5a"],"ref":"refs/changes/05/6905/3","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1568644080,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1568398978,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1568405787,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1568405787,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1568408047,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"SUBM","value":"1","grantedOn":1568644095,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"config-migration.js","type":"MODIFIED","insertions":11,"deletions":-1}],"sizeInsertions":11,"sizeDeletions":-1}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}]}