{"project":"joyent/moray","branch":"master","id":"I441bce641d6ce2a72369c12827fc6a2c7d4b747d","number":"4468","subject":"MORAY-483 Prevent new queries when Postgres client has emitted an error Reviewed by: Jan Wyszynski \u003cjan.wyszynski@joyent.com\u003e Approved by: Jan Wyszynski \u003cjan.wyszynski@joyent.com\u003e","owner":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"url":"https://cr.joyent.us/4468","commitMessage":"MORAY-483 Prevent new queries when Postgres client has emitted an error\nReviewed by: Jan Wyszynski \u003cjan.wyszynski@joyent.com\u003e\nApproved by: Jan Wyszynski \u003cjan.wyszynski@joyent.com\u003e\n","createdOn":1530572526,"lastUpdated":1532387581,"open":false,"status":"MERGED","comments":[{"timestamp":1530572526,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 1."},{"timestamp":1530572576,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1531246235,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 2."},{"timestamp":1531246290,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1531247387,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Patch Set 2: Code-Review+1\n\nAfter talking about this in chat I think this looks good, I might be in favor of a comment above this function explaining why setImmediate is used in some of the done callbacks (that aren\u0027t blocked on IO) and not others (which are blocked on IO, like the \u0027req\u0027 end and error events) since we\u0027re doing it in multiple places now -- but it\u0027s definitely not necessary and maybe the comments already there are enough."},{"timestamp":1532386433,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 3: Commit message was updated."},{"timestamp":1532386472,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 4: Commit message was updated."},{"timestamp":1532386653,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 5: Patch Set 4 was rebased"},{"timestamp":1532386702,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5:\n\n\"make check\" passed ok"},{"timestamp":1532387573,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Patch Set 5: Integration-Approval+1"},{"timestamp":1532387581,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Cody Peter Mello"}],"currentPatchSet":{"number":"5","revision":"c7bfe5adb88f274bb79d94999fc710c259600cf8","parents":["db014de5cd1ede1d0570a987781748e32bbb01ca"],"ref":"refs/changes/68/4468/5","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1532386653,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1531246290,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1531247387,"by":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1532387573,"by":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"}},{"type":"SUBM","value":"1","grantedOn":1532387581,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/pg.js","type":"MODIFIED","insertions":14,"deletions":-2}],"sizeInsertions":14,"sizeDeletions":-2},"patchSets":[{"number":"1","revision":"f576bb4c9f5214b890bcc6c78052259e9427a756","parents":["f48867686146b6e707d2e5c2828f1a2f0c2dbe9b"],"ref":"refs/changes/68/4468/1","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1530572526,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1530572576,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/pg.js","type":"MODIFIED","insertions":13,"deletions":-1}],"sizeInsertions":13,"sizeDeletions":-1},{"number":"2","revision":"441bce641d6ce2a72369c12827fc6a2c7d4b747d","parents":["f48867686146b6e707d2e5c2828f1a2f0c2dbe9b"],"ref":"refs/changes/68/4468/2","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1531246235,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1531246290,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1531247387,"by":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/pg.js","type":"MODIFIED","insertions":14,"deletions":-2}],"sizeInsertions":14,"sizeDeletions":-2},{"number":"3","revision":"15c052b9fe72c33518615a69ccdd7a71779730a5","parents":["f48867686146b6e707d2e5c2828f1a2f0c2dbe9b"],"ref":"refs/changes/68/4468/3","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1532386433,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1531246290,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1531247387,"by":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/pg.js","type":"MODIFIED","insertions":14,"deletions":-2}],"sizeInsertions":14,"sizeDeletions":-2},{"number":"4","revision":"37fd0e4047a2772652a892a4ef36a12a4b223874","parents":["f48867686146b6e707d2e5c2828f1a2f0c2dbe9b"],"ref":"refs/changes/68/4468/4","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1532386472,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1531246290,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1531247387,"by":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/pg.js","type":"MODIFIED","insertions":14,"deletions":-2}],"sizeInsertions":14,"sizeDeletions":-2},{"number":"5","revision":"c7bfe5adb88f274bb79d94999fc710c259600cf8","parents":["db014de5cd1ede1d0570a987781748e32bbb01ca"],"ref":"refs/changes/68/4468/5","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1532386653,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"SUBM","value":"1","grantedOn":1532387581,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1531246290,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1531247387,"by":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1532387573,"by":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/pg.js","type":"MODIFIED","insertions":14,"deletions":-2}],"sizeInsertions":14,"sizeDeletions":-2}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}]}