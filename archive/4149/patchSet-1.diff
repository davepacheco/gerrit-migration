From e46876b6005ee90d2fcb2e8316bc3552a61df6c7 Mon Sep 17 00:00:00 2001
From: Brian Bennett <brian.bennett@joyent.com>
Date: Wed, 6 Jun 2018 04:12:31 -0700
Subject: [PATCH] MANATEE-397 `manatee-adm history` fails with `TypeError:
 Cannot read property 'zoneId' of null` (again)

---
 lib/adm.js | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/lib/adm.js b/lib/adm.js
index 92b2636..28206e2 100644
--- a/lib/adm.js
+++ b/lib/adm.js
@@ -1927,6 +1927,11 @@ function annotateHistoryNode(evt, last)
     }
 
     if (nst.generation > lst.generation) {
+        if (lst.sync === null && nst.generation == 1 &&
+            typeof (lst.freeze) == 'object') {
+            return (sprintf('upgrade to 2.0, sync "%s" added',
+                nst.sync.zoneId.substr(0, 8)));
+        }
         if (nst.sync.zoneId == lst.sync.zoneId) {
             return ('error: gen number changed, but ' +
                 'primary and sync did not');
-- 
2.21.0

