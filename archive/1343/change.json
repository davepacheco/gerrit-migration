{"project":"joyent/illumos-joyent","branch":"master","id":"I3faf4468a1bc33565a3d6692131a0ba97b3f0466","number":"1343","subject":"OS-5716 avoid unnecessary sudo calls in test-runner Reviewed by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e Approved by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e","owner":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"url":"https://cr.joyent.us/1343","commitMessage":"OS-5716 avoid unnecessary sudo calls in test-runner\nReviewed by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e\nApproved by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e\n","createdOn":1485401431,"lastUpdated":1486484553,"open":false,"status":"MERGED","comments":[{"timestamp":1485401431,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Uploaded patch set 1."},{"timestamp":1486434225,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Uploaded patch set 2."},{"timestamp":1486437874,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Uploaded patch set 3."},{"timestamp":1486437945,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Uploaded patch set 4: Patch Set 3 was rebased."},{"timestamp":1486438628,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Patch Set 4:\n\nWhen a test runs there are two users involved: the parent process owner which runs the test harness loop, and the child process owner which executes the individual tests. With this change we want to verify 6 scenarios work:\n\n1. root/-\n2. root/root\n3. root/bob\n4. bob/-\n5. bob/bob\n6. bob/alice\n\nWhere the first user is the parent and second is child (a hyphen means no user was specified in the runfile; meaning it will use the same user as parent, e.g. bob/bob is equivalent to bob/- at runtime).\n\nI tested all these combinations with the sdevfs test using nobody as bob and nobody4 as alice. I then also tested each of these scenarios for the kill_cmd (run a test that takes some time and interrupt it before it finishes) using the poll and file-locking tests. In scenarios 1-5 my patch successfully avoided using sudo (or used su in its place). In scenario 6 it detected that sudo would be required but doesn\u0027t exist and then skips the test and logs a warning -- like so:\n\n Warning: this test requires sudo but it doesn\u0027t exist.\n Not adding TestGroup \u0027/opt/os-tests/tests/sdevfs\u0027 to this run."},{"timestamp":1486473791,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 4: Code-Review+1 Integration-Approval+1"},{"timestamp":1486484439,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Uploaded patch set 5: Patch Set 4 was rebased."},{"timestamp":1486484514,"reviewer":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"message":"Uploaded patch set 6: Commit message was updated."},{"timestamp":1486484553,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Ryan Zezeski"}],"currentPatchSet":{"number":"6","revision":"3faf4468a1bc33565a3d6692131a0ba97b3f0466","parents":["fee98a3b8f015b17a4769a5be463eb01425da23a"],"ref":"refs/changes/43/1343/6","uploader":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"createdOn":1486484514,"author":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1486473791,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1486473791,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"SUBM","value":"1","grantedOn":1486484553,"by":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/test/test-runner/cmd/run","type":"MODIFIED","insertions":47,"deletions":-9}],"sizeInsertions":47,"sizeDeletions":-9},"patchSets":[{"number":"1","revision":"074fb4a79696900dd184374c9011706d6b49ae6d","parents":["1920b70c619829b92093182e77620558506a12d1"],"ref":"refs/changes/43/1343/1","uploader":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"createdOn":1485401431,"author":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/test/test-runner/cmd/run","type":"MODIFIED","insertions":37,"deletions":-7}],"sizeInsertions":37,"sizeDeletions":-7},{"number":"2","revision":"887c64d400e656e4956e3e1186dc6a5522cf7ac3","parents":["1920b70c619829b92093182e77620558506a12d1"],"ref":"refs/changes/43/1343/2","uploader":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"createdOn":1486434225,"author":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/test/test-runner/cmd/run","type":"MODIFIED","insertions":47,"deletions":-9}],"sizeInsertions":47,"sizeDeletions":-9},{"number":"3","revision":"43e92fd865a680e1f9c888a9ecd006d2961f8978","parents":["1920b70c619829b92093182e77620558506a12d1"],"ref":"refs/changes/43/1343/3","uploader":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"createdOn":1486437874,"author":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/test/test-runner/cmd/run","type":"MODIFIED","insertions":47,"deletions":-9}],"sizeInsertions":47,"sizeDeletions":-9},{"number":"4","revision":"d3603177cfd28deb4cac17cdbe1d598dd6322466","parents":["d03efe1ba0e33c3e83d41bf66c9fd4703bea79f6"],"ref":"refs/changes/43/1343/4","uploader":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"createdOn":1486437945,"author":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1486473791,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1486473791,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/test/test-runner/cmd/run","type":"MODIFIED","insertions":47,"deletions":-9}],"sizeInsertions":47,"sizeDeletions":-9},{"number":"5","revision":"6cfb752154a5802cd22e4b171977806d1df9599e","parents":["fee98a3b8f015b17a4769a5be463eb01425da23a"],"ref":"refs/changes/43/1343/5","uploader":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"createdOn":1486484439,"author":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1486473791,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1486473791,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/test/test-runner/cmd/run","type":"MODIFIED","insertions":47,"deletions":-9}],"sizeInsertions":47,"sizeDeletions":-9},{"number":"6","revision":"3faf4468a1bc33565a3d6692131a0ba97b3f0466","parents":["fee98a3b8f015b17a4769a5be463eb01425da23a"],"ref":"refs/changes/43/1343/6","uploader":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"createdOn":1486484514,"author":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1486473791,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1486473791,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"SUBM","value":"1","grantedOn":1486484553,"by":{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/test/test-runner/cmd/run","type":"MODIFIED","insertions":47,"deletions":-9}],"sizeInsertions":47,"sizeDeletions":-9}],"allReviewers":[{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},{"name":"Ryan Zezeski","email":"rpz@joyent.com","username":"rzezeski"}]}