{"project":"joyent/node-docker-registry-client","branch":"master","id":"I7e52e341dce76f5f305735470d50c80e03c774e0","number":"442","subject":"DOCKER-929 Support the docker v2.2 manifest format Reviewed by: Trent Mick \u003ctrentm@gmail.com\u003e","owner":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"url":"https://cr.joyent.us/442","commitMessage":"DOCKER-929 Support the docker v2.2 manifest format\nReviewed by: Trent Mick \u003ctrentm@gmail.com\u003e\n","createdOn":1473444852,"lastUpdated":1474474859,"open":false,"status":"MERGED","comments":[{"timestamp":1473444852,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Uploaded patch set 1."},{"timestamp":1473444914,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1473787383,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 1:\n\nWill want a version update. Are we dropping v1 support here?\n\nWill want a CHANGES.md update for this."},{"timestamp":1473788086,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 1:\n\n(3 comments)\n\nElse looks fine."},{"timestamp":1473788645,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Patch Set 1:\n\n(3 comments)"},{"timestamp":1473798331,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Uploaded patch set 2."},{"timestamp":1473798366,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing-1\n\n(18 comments)\n\n\"make check\" exited with status 2"},{"timestamp":1473798463,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Uploaded patch set 3."},{"timestamp":1473798524,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1473868091,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 3:\n\nTodd,\n\n1. didn\u0027t want to do change \"allowV2Schemas\" to \"maxSchemaVersion\" that you had mentioned?\n\n2. And about that boolean. It is a bit cumbersome that callers that want the latest and greatest have to use this extra field. What about a major ver bump (4.x) of this lib and just always allow getting v2.2 schema? Then if there are users that need to stay in the past there can (theoretically) be a 3.x maintenance stream.\n\nOr if not that, I wonder if it would be nicer for usage to have the \"yes, I\u0027d like to allow v2.2 schemas\" field be on the `createClient()` options.  Thoughts?"},{"timestamp":1473880105,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Uploaded patch set 4."},{"timestamp":1473880135,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1474311823,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 4:\n\n(1 comment)\n\nWould be nice to have a way to set maxSchemaVersion on the \u0027createClient\u0027 call. I.e. so don\u0027t have to remember to add it to every \u0027getManifest\u0027 call."},{"timestamp":1474392415,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 4:\n\nMeant to add \"Thoughts?\" at the end of last comment. If you just want to move on, that\u0027s cool too."},{"timestamp":1474396747,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Patch Set 4:\n\nYes, setting maxSchemaVersion on the client object makes good sense, will update soon."},{"timestamp":1474399235,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Uploaded patch set 5."},{"timestamp":1474405810,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1474473127,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 5: Code-Review+1\n\n(1 comment)"},{"timestamp":1474474317,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Uploaded patch set 6."},{"timestamp":1474474369,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 6: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1474474481,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 6: Code-Review+1 Integration-Approval+1"},{"timestamp":1474474791,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Uploaded patch set 7: Commit message was updated."},{"timestamp":1474474859,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Todd Whiteman"}],"currentPatchSet":{"number":"7","revision":"7e52e341dce76f5f305735470d50c80e03c774e0","parents":["459727cb2018b4e0a15f0827369197f18722497e"],"ref":"refs/changes/42/442/7","uploader":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"createdOn":1474474791,"author":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1474474369,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1474474481,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1474474481,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1474474859,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"examples/mainline.js","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"examples/v2/getManifest.js","type":"MODIFIED","insertions":13,"deletions":-3},{"file":"lib/registry-client-v2.js","type":"MODIFIED","insertions":33,"deletions":-13},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/v1.dockerio.test.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"test/v2.dockerio.test.js","type":"MODIFIED","insertions":66,"deletions":-20}],"sizeInsertions":129,"sizeDeletions":-40},"patchSets":[{"number":"1","revision":"0c6124800cf1f9179cc4e941d72390f8091e5662","parents":["459727cb2018b4e0a15f0827369197f18722497e"],"ref":"refs/changes/42/442/1","uploader":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"createdOn":1473444852,"author":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1473444914,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/registry-client-v2.js","line":1188,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"What\u0027s the purpose for having this? Are there callers that won\u0027t want to allow v2.2 schemas?"},{"file":"lib/registry-client-v2.js","line":1188,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"This was to maintain backwards compat, the manifest returned has a vastly different structure for v2 - so I didn\u0027t want to break anything depending on a v1 schema format (i.e. I\u0027m not exactly sure how many external modules use this function)."},{"file":"test/v2.dockerio.test.js","line":114,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Update this comment example to a v2.2 manifest."},{"file":"test/v2.dockerio.test.js","line":114,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Good catch."},{"file":"test/v2.dockerio.test.js","line":264,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"nit: can helper functiosn go in a block after globals, but before the tests section?"},{"file":"test/v2.dockerio.test.js","line":264,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Will do."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/registry-client-v2.js","type":"MODIFIED","insertions":32,"deletions":-13},{"file":"test/v1.dockerio.test.js","type":"DELETED","insertions":0,"deletions":-142},{"file":"test/v2.dockerio.test.js","type":"MODIFIED","insertions":65,"deletions":-20}],"sizeInsertions":97,"sizeDeletions":-175},{"number":"2","revision":"296b807a3b977a51f10d03aa386d1cf2e3272136","parents":["459727cb2018b4e0a15f0827369197f18722497e"],"ref":"refs/changes/42/442/2","uploader":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"createdOn":1473798331,"author":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1473798366,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"test/v1.dockerio.test.js","line":145,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"last line in file is blank"},{"file":"test/v2.dockerio.test.js","line":111,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"improper block comment"},{"file":"test/v2.dockerio.test.js","line":112,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"improper block comment"},{"file":"test/v2.dockerio.test.js","line":113,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"improper block comment"},{"file":"test/v2.dockerio.test.js","line":114,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"improper block comment"},{"file":"test/v2.dockerio.test.js","line":115,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"improper block comment"},{"file":"test/v2.dockerio.test.js","line":116,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"improper block comment"},{"file":"test/v2.dockerio.test.js","line":117,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"improper block comment"},{"file":"test/v2.dockerio.test.js","line":118,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"improper block comment"},{"file":"test/v2.dockerio.test.js","line":119,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"improper block comment"},{"file":"test/v2.dockerio.test.js","line":120,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"improper block comment"},{"file":"test/v2.dockerio.test.js","line":121,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"improper block comment"},{"file":"test/v2.dockerio.test.js","line":122,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"improper block comment"},{"file":"test/v2.dockerio.test.js","line":123,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"improper block comment"},{"file":"test/v2.dockerio.test.js","line":124,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"improper block comment"},{"file":"test/v2.dockerio.test.js","line":125,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"improper block comment"},{"file":"test/v2.dockerio.test.js","line":126,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"improper block comment"},{"file":"test/v2.dockerio.test.js","line":127,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"improper block comment close"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":12,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"lib/registry-client-v2.js","type":"MODIFIED","insertions":32,"deletions":-13},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/v1.dockerio.test.js","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"test/v2.dockerio.test.js","type":"MODIFIED","insertions":66,"deletions":-20}],"sizeInsertions":110,"sizeDeletions":-36},{"number":"3","revision":"0b078b221c5b11ecfb7835f881ec6f027086c3a6","parents":["459727cb2018b4e0a15f0827369197f18722497e"],"ref":"refs/changes/42/442/3","uploader":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"createdOn":1473798463,"author":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1473798524,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":12,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"lib/registry-client-v2.js","type":"MODIFIED","insertions":32,"deletions":-13},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/v1.dockerio.test.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"test/v2.dockerio.test.js","type":"MODIFIED","insertions":66,"deletions":-20}],"sizeInsertions":109,"sizeDeletions":-36},{"number":"4","revision":"f7b771edefada525bd7bcb074667e6191571d2bb","parents":["459727cb2018b4e0a15f0827369197f18722497e"],"ref":"refs/changes/42/442/4","uploader":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"createdOn":1473880105,"author":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1473880135,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"package.json","line":3,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"minor ver bump, I think. This is a new feature."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"examples/mainline.js","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"examples/v2/getManifest.js","type":"MODIFIED","insertions":13,"deletions":-3},{"file":"lib/registry-client-v2.js","type":"MODIFIED","insertions":31,"deletions":-13},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/v1.dockerio.test.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"test/v2.dockerio.test.js","type":"MODIFIED","insertions":66,"deletions":-20}],"sizeInsertions":128,"sizeDeletions":-40},{"number":"5","revision":"4b66b48be1e3dd4a4a1d164dfaf231706d5d1ffe","parents":["459727cb2018b4e0a15f0827369197f18722497e"],"ref":"refs/changes/42/442/5","uploader":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"createdOn":1474399235,"author":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1474405810,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1474473127,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"comments":[{"file":"CHANGES.md","line":6,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"update the changelog entry for the new field name, and that it can be on the createClient."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"examples/mainline.js","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"examples/v2/getManifest.js","type":"MODIFIED","insertions":13,"deletions":-3},{"file":"lib/registry-client-v2.js","type":"MODIFIED","insertions":33,"deletions":-13},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/v1.dockerio.test.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"test/v2.dockerio.test.js","type":"MODIFIED","insertions":66,"deletions":-20}],"sizeInsertions":127,"sizeDeletions":-40},{"number":"6","revision":"f71c98b43ef0377153beaf4f20dfc4e56bd38f26","parents":["459727cb2018b4e0a15f0827369197f18722497e"],"ref":"refs/changes/42/442/6","uploader":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"createdOn":1474474317,"author":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1474474369,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1474474481,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1474474481,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"examples/mainline.js","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"examples/v2/getManifest.js","type":"MODIFIED","insertions":13,"deletions":-3},{"file":"lib/registry-client-v2.js","type":"MODIFIED","insertions":33,"deletions":-13},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/v1.dockerio.test.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"test/v2.dockerio.test.js","type":"MODIFIED","insertions":66,"deletions":-20}],"sizeInsertions":129,"sizeDeletions":-40},{"number":"7","revision":"7e52e341dce76f5f305735470d50c80e03c774e0","parents":["459727cb2018b4e0a15f0827369197f18722497e"],"ref":"refs/changes/42/442/7","uploader":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"createdOn":1474474791,"author":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1474474369,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1474474481,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1474474481,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1474474859,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"examples/mainline.js","type":"MODIFIED","insertions":7,"deletions":-1},{"file":"examples/v2/getManifest.js","type":"MODIFIED","insertions":13,"deletions":-3},{"file":"lib/registry-client-v2.js","type":"MODIFIED","insertions":33,"deletions":-13},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/v1.dockerio.test.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"test/v2.dockerio.test.js","type":"MODIFIED","insertions":66,"deletions":-20}],"sizeInsertions":129,"sizeDeletions":-40}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}]}