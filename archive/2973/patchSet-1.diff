commit ee21eff1d226df4463bb3117f25c9125549e89d6 (refs/changes/73/2973/1)
Author: Julien Gilli <julien.gilli@joyent.com>
Date:   2017-11-20T15:05:43-08:00 (1 year, 11 months ago)
    
    VOLAPI-92 nightly2-020-test-system failing in node-sdc-clients volapi tests

diff --git a/lib/cli/do_nfs_volumes.js b/lib/cli/do_nfs_volumes.js
index 4bd8bd0..a73a523 100644
--- a/lib/cli/do_nfs_volumes.js
+++ b/lib/cli/do_nfs_volumes.js
@@ -297,6 +297,30 @@ function do_nfs_volumes(subcmd, opts, args, cb) {
     }
 
     vasync.pipeline({arg: context, funcs: [
+        function checkFabricsEnabled(ctx, next) {
+            var err;
+
+            assert.object(self.sdcadm.sdc.metadata, 'self.sdcadm.sdc.metadata');
+
+            /*
+             * Disabling any NFS volumes feature flag does have any requirement,
+             * let alone on support for fabric networks.
+             */
+            if (opts.disable) {
+                next();
+                return;
+            }
+
+            self.progress('Checking support for fabric networks');
+
+            if (!self.sdcadm.sdc.metadata.fabric_cfg) {
+                err = new Error('Support for fabric networks is required and ' +
+                    'missing');
+            }
+
+            next(err);
+        },
+
         function checkFeatureDeps(ctx, next) {
             var err;
             var missingFeatureDeps;
