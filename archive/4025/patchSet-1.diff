From a992b2b70fd4fccdc22e992d05015c4bdecdaafe Mon Sep 17 00:00:00 2001
From: Cody Peter Mello <cody.mello@joyent.com>
Date: Wed, 30 May 2018 18:32:19 +0000
Subject: [PATCH] MANTA-3741 Set up "haproxy-1.8" repository

---
 README => README.md | 83 +++++++++++++++++++++++++++++++--------------
 1 file changed, 57 insertions(+), 26 deletions(-)
 rename README => README.md (85%)

diff --git a/README b/README.md
similarity index 85%
rename from README
rename to README.md
index 8036a154..94ed97d6 100644
--- a/README
+++ b/README.md
@@ -1,13 +1,51 @@
-                         ----------------------
-                             HAProxy how-to
-                         ----------------------
-                              version 1.8
-                             willy tarreau
-                               2018/04/19
-
-
-1) How to build it
-------------------
+# HAProxy
+
+This repository represents the version of [haproxy](https://www.haproxy.org/)
+that is used as part of the [Manta project](https://github.com/joyent/manta).
+
+The changes specific to this repo are:
+
+- none currently
+
+## 0) Repository Management
+
+To better understand and maintain our differences from HAProxy, we try to
+manage branches and tags in a specific fashion. First and foremost, all
+branches and tags from the upstream HAProxy repository are mirrored here.
+Anything that is Joyent-specific begins with a `joyent/` prefix.
+
+Branches with Joyent modifications are named `joyent/<version>`, such as
+`joyent/v1.8.8`. This is a branch that starts from the HAProxy
+`v1.8.8` tag. These branches will have all of our patches
+rebased on top of them. Currently, this repository is consumed by
+`muppet`, which contains a git submodule for this repository. That
+submodule will point to a tag in this repository that uses the form
+`joyent/v<version>j<branch release num>`. The first release as described
+above would be: `joyent/v1.8.8j1`. If we need to cut another release
+from this branch, we would tag it `joyent/v1.8.8j2` and continue to
+increment the number after the `j`. Note we use the `j` instead of `r`
+which would more traditionally be used to indicate a revision.  We use
+`j` in case HAProxy for some reason wants to use it in its version strings
+for whatever reason.
+
+When it comes time to update to a newer version of HAProxy, we would take
+the following steps:
+
+* Ensure that we have pushed all changes from the upstream repository and
+  synced all of our branches and tags.
+* Identify the release tag that corresponds to the point release. For
+  this example, we'll say that's `v1.12.3`.
+* Create a new branch named `joyent/<version>` from the tag. In this
+  case we would name the branch `joyent/v1.12.3`.
+* Rebase all of our patches on to that new branch, removing any patches
+  that are no longer necessary.
+* Test the new HAProxy binary.
+* Review and Commit all relevant changes.
+* Create a new tag `joyent/v1.12.3j1`.
+* Update the [muppet](https://github.com/joyent/muppet)
+  submodule to point to the new tag.
+
+## 1) How to build it
 
 This version is a stable version, which means that it belongs to a branch which
 will get some fixes for bugs as they are discovered. Versions which include the
@@ -18,9 +56,7 @@ software vendor or Linux distribution. Most of them are taking this task
 seriously and are doing a good job at backporting important fixes. If for any
 reason you'd prefer a different version than the one packaged for your system,
 you want to be certain to have all the fixes or to get some commercial support,
-other choices are available at :
-
-                        http://www.haproxy.com/
+other choices are available at [www.haproxy.com](https://www.haproxy.com/).
 
 To build haproxy, you will need :
   - GNU make. Neither Solaris nor OpenBSD's make work with the GNU Makefile.
@@ -33,7 +69,7 @@ Also, you might want to build with libpcre support, which will provide a very
 efficient regex implementation and will also fix some badness on Solaris' one.
 
 To build haproxy, you have to choose your target OS amongst the following ones
-and assign it to the TARGET variable :
+and assign it to the TARGET variable:
 
   - linux22     for Linux 2.2
   - linux24     for Linux 2.4 and above (default)
@@ -173,7 +209,7 @@ The SSL stack supports session cache synchronization between all running
 processes. This involves some atomic operations and synchronization operations
 which come in multiple flavors depending on the system and architecture :
 
-  Atomic operations :
+  - Atomic operations :
     - internal assembler versions for x86/x86_64 architectures
 
     - gcc builtins for other architectures. Some architectures might not
@@ -189,7 +225,7 @@ which come in multiple flavors depending on the system and architecture :
       and reports an error at runtime, while certain older versions might
       silently fail. Pthreads are enabled using USE_PTHREAD_PSHARED=1.
 
-  Synchronization operations :
+  - Synchronization operations :
     - internal spinlock : this mode is OS-independant, light but will not
       scale well to many processes. However, accesses to the session cache
       are rare enough that this mode could certainly always be used. This
@@ -225,8 +261,7 @@ disabled by setting USE_POLL="". For example :
     $ gmake TARGET=tiny USE_POLL="" TARGET_CFLAGS=-fomit-frame-pointer
 
 
-1.1) Device Detection
----------------------
+### 1.1) Device Detection
 
 HAProxy supports several device detection modules relying on third party
 products. Some of them may provide free code, others free libs, others free
@@ -238,8 +273,7 @@ following files :
     doc/WURFL-device-detection.txt         for Scientiamobile WURFL
 
 
-2) How to install it
---------------------
+## 2) How to install it
 
 To install haproxy, you can either copy the single resulting binary to the
 place you want, or run :
@@ -250,8 +284,7 @@ If you're packaging it for another system, you can specify its root directory
 in the usual DESTDIR variable.
 
 
-3) How to set it up
--------------------
+## 3) How to set it up
 
 There is some documentation in the doc/ directory :
 
@@ -287,8 +320,7 @@ directory as well as on several sites and articles on the net which are linked
 to from the haproxy web site.
 
 
-4) How to report a bug
-----------------------
+## 4) How to report a bug
 
 It is possible that from time to time you'll find a bug. A bug is a case where
 what you see is not what is documented. Otherwise it can be a misdesign. If you
@@ -320,8 +352,7 @@ instructions on how to collect a usable core file, and will probably ask for
 other captures that you'll not want to share with the list.
 
 
-5) How to contribute
---------------------
+## 5) How to contribute
 
 Please carefully read the CONTRIBUTING file that comes with the sources. It is
 mandatory.
-- 
2.21.0

