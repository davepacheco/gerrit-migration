{"project":"joyent/manta","branch":"master","topic":"MANTA-2587","id":"Ibe15db1cc789e38414113d129e343b918fa39fb9","number":"865","subject":"MANTA-2587 manta-net.sh Needs to Support Adding tags to Aggregations MANTA-3014 Only distribute manta-nic and xdc-routes SMF services if required Reviewed by: Brian Bennett \u003cbrian.bennett@joyent.com\u003e Reviewed by: David Pacheco \u003cdap@joyent.com\u003e Approved by","owner":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"url":"https://cr.joyent.us/865","commitMessage":"MANTA-2587 manta-net.sh Needs to Support Adding tags to Aggregations\nMANTA-3014 Only distribute manta-nic and xdc-routes SMF services if required\nReviewed by: Brian Bennett \u003cbrian.bennett@joyent.com\u003e\nReviewed by: David Pacheco \u003cdap@joyent.com\u003e\nApproved by: David Pacheco \u003cdap@joyent.com\u003e\n","createdOn":1478710618,"lastUpdated":1501006156,"open":false,"status":"MERGED","comments":[{"timestamp":1478710618,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"Uploaded patch set 1."},{"timestamp":1478710620,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1478710641,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"Topic set to MANTA-2587"},{"timestamp":1478711336,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"Patch Set 1:\n\nFor an example of this rendered as markdown, see here: https://github.com/chudley/manta/blob/dev-MANTA-2587/docs/operator-guide/index.md#networking-configuration"},{"timestamp":1491985478,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"Uploaded patch set 2."},{"timestamp":1491985480,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1491985664,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"Patch Set 2:\n\nNow including MANTA-3014 documentation changes.\n\nFor a rendered version of this documentation, see here: https://github.com/chudley/manta/blob/dev-MANTA-2587/docs/operator-guide/index.md#networking-configuration"},{"timestamp":1494961205,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1495011700,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"Patch Set 2:\n\n(1 comment)\n\nThanks for taking a look!"},{"timestamp":1495162029,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1496224786,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"Uploaded patch set 3."},{"timestamp":1496224793,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1496224940,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"Patch Set 3:\n\n(1 comment)"},{"timestamp":1496271647,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1499707473,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 3:\n\n(4 comments)"},{"timestamp":1499789851,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"Uploaded patch set 4."},{"timestamp":1499789853,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1499789905,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"Patch Set 4:\n\n(4 comments)"},{"timestamp":1499791526,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 4: Code-Review+1\n\nThanks!  Is the change `make prepush` clean and rendering as you expect?"},{"timestamp":1499792724,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"Patch Set 4:\n\n`make prepush` looks clean, and I\u0027ve dropped the markdown into a gist here to see it rendered: https://gist.github.com/chudley/7fefbc2dc225871f00a2d0942fffbf7c#networking-configuration\n\nIt looks sane to me, but I welcome more eyes on the rendered version.\n\nIt looks like operator\u0027s guide has been moved since this CR was opened. I don\u0027t know what the rebase would look like in this case. Would you like me to rebase before IA?"},{"timestamp":1499792879,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 4:\n\nSure.  I\u0027m happy to IA at this point, but it may be clobbered by the rebase anyway.\n\nAlso remember that the doc has to be updated in the gh-pages branch and published there as well.  Let me know if you need any help with that."},{"timestamp":1499793282,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"Uploaded patch set 5."},{"timestamp":1499793284,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1499793577,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"Patch Set 5:\n\nI\u0027ve rebased and pushed, but I don\u0027t think I did the right thing as it\u0027s showing as a patch set instead of a rebase.\n\nI\u0027ve not pushed to gh-pages before, so I can look into that. I understand Gerrit will only push to master, so do I push to gh-pages outside of this CR? I can reach out to you directly if that\u0027s the case."},{"timestamp":1500489497,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 5:\n\n\u003e I\u0027ve rebased and pushed, but I don\u0027t think I did the right thing as\n \u003e it\u0027s showing as a patch set instead of a rebase.\n \u003e \n \u003e I\u0027ve not pushed to gh-pages before, so I can look into that. I\n \u003e understand Gerrit will only push to master, so do I push to\n \u003e gh-pages outside of this CR? I can reach out to you directly if\n \u003e that\u0027s the case.\n\nThere\u0027s some documentation on this here:\nhttps://github.com/joyent/rfd/blob/master/rfd/0023/README.md#how-to-update-the-manta-operator-guide\n\nFWIW, I don\u0027t use the target because I don\u0027t like to automate `git push`, but I run those steps by hand.  We do not manage \"gh-pages\" via Gerrit today, although we could.  I don\u0027t think Gerrit cares what branch it\u0027s managing."},{"timestamp":1500651837,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Patch Set 5: Code-Review+1"},{"timestamp":1500914361,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 5: Code-Review+1 Integration-Approval+1"},{"timestamp":1500980137,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"Uploaded patch set 6: Commit message was updated."},{"timestamp":1500990214,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Richard Bradley"},{"timestamp":1501006156,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"Patch Set 6:\n\nThese changes (including the ones from MANTA-3287) have been pushed to the gh-pages branch.\n\nhttps://github.com/joyent/manta/commit/274fb2ef8b21bd1af7d5ac61261a9a8561f02dd1"}],"currentPatchSet":{"number":"6","revision":"be15db1cc789e38414113d129e343b918fa39fb9","parents":["14f53ca0a3b47f5584172d2ac46630e3517e05f1"],"ref":"refs/changes/65/865/6","uploader":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"createdOn":1500980137,"author":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1499793284,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1500651837,"by":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1500914361,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1500914361,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"SUBM","value":"1","grantedOn":1500990214,"by":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"docs/operator-guide.md","type":"MODIFIED","insertions":47,"deletions":-15}],"sizeInsertions":47,"sizeDeletions":-15},"patchSets":[{"number":"1","revision":"e185b99c87a899af32d5b6ac5a75e0655102926b","parents":["588c40580da736ed0951e8ac71abefdcfa6d98e8"],"ref":"refs/changes/65/865/1","uploader":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"createdOn":1478710618,"author":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1478710620,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"docs/operator-guide/index.md","type":"MODIFIED","insertions":56,"deletions":-17}],"sizeInsertions":56,"sizeDeletions":-17},{"number":"2","revision":"618fd7e2de9571c8bcab6c95c671662d9e45e6a3","parents":["588c40580da736ed0951e8ac71abefdcfa6d98e8"],"ref":"refs/changes/65/865/2","uploader":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"createdOn":1491985478,"author":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1491985480,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"docs/operator-guide/index.md","line":993,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"I\u0027m confused about the purpose of mac_mappings vs nic_mappings. It\u0027s not clear what the distinction between them is, or when I should be using one vs the other.\nAlso, the configuration table above only lists nic_mappings. Should it have both?"},{"file":"docs/operator-guide/index.md","line":993,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"nic_mappings supersedes mac_mappings, where nic_mappings can support tagging both aggrs or mac addresses, while mac_mappings can only tag macs.\n\nThe reason it\u0027s still available is for backwards compatibility, where some of our tooling (particularly in the lab) still generates config for mac_mappings. This is also why I have removed it from the table above. \n\nWould a note along the lines of the above help clear this up? Perhaps it would also be useful in the table, so long as it has some kind of deprecation notice?"},{"file":"docs/operator-guide/index.md","line":993,"reviewer":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},"message":"Yeah, that would help. I think the example should show nic_mappings, but the prose can mention that mac_mappings is also supported, but deprecated."},{"file":"docs/operator-guide/index.md","line":993,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"I\u0027ve removed the extra example mac_mappings config and worded it out a little instead. I\u0027ve also added mac_mappings back to the table above to fully document all available properties."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"docs/operator-guide/index.md","type":"MODIFIED","insertions":52,"deletions":-14}],"sizeInsertions":52,"sizeDeletions":-14},{"number":"3","revision":"4bc923094ef70bd211b37e2a355aa96036443ad4","parents":["588c40580da736ed0951e8ac71abefdcfa6d98e8"],"ref":"refs/changes/65/865/3","uploader":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"createdOn":1496224786,"author":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1496224793,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1496271647,"by":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"}}],"comments":[{"file":"docs/operator-guide/index.md","line":870,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"If I recall correctly, \"marlin_nodes\" are a subset of \"manta_nodes\".  Is this redundant?"},{"file":"docs/operator-guide/index.md","line":870,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"They are indeed a subset, and removing \"marlin_nodes\" reads better (thanks!). I\u0027ve made this change to the table above, also."},{"file":"docs/operator-guide/index.md","line":874,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Maybe \"If aggregations are used, they\"?  I wouldn\u0027t want somebody reading this to think that aggregations must always exist in NAPI already."},{"file":"docs/operator-guide/index.md","line":874,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"Done"},{"file":"docs/operator-guide/index.md","line":877,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Should this be mentioned in the table above?"},{"file":"docs/operator-guide/index.md","line":877,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"I originally omitted it because it\u0027s optional and described here, but for completeness I\u0027ve added it to the table."},{"file":"docs/operator-guide/index.md","line":886,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I think a comma here would help.  Is there documentation somewhere about the GZ network changes that are handled by boot-time networking?  I\u0027m not sure a Manta operator would know what this means."},{"file":"docs/operator-guide/index.md","line":886,"reviewer":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"message":"https://docs.joyent.com/private-cloud/networks/sdn/architecture#bootstrapping-networking-state-in-the-global-zone seems like our best bet, so I\u0027ve added a link to this document."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"docs/operator-guide/index.md","type":"MODIFIED","insertions":44,"deletions":-15}],"sizeInsertions":44,"sizeDeletions":-15},{"number":"4","revision":"6aac4da720635d2b278ba1cce06afb29c2f78d38","parents":["588c40580da736ed0951e8ac71abefdcfa6d98e8"],"ref":"refs/changes/65/865/4","uploader":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"createdOn":1499789851,"author":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1499791526,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1499789853,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"docs/operator-guide/index.md","type":"MODIFIED","insertions":47,"deletions":-15}],"sizeInsertions":47,"sizeDeletions":-15},{"number":"5","revision":"ddde529897049492ebad2975632872f842a582f5","parents":["14f53ca0a3b47f5584172d2ac46630e3517e05f1"],"ref":"refs/changes/65/865/5","uploader":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"createdOn":1499793282,"author":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1500914361,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1500914361,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1499793284,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1500651837,"by":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"docs/operator-guide.md","type":"MODIFIED","insertions":47,"deletions":-15}],"sizeInsertions":47,"sizeDeletions":-15},{"number":"6","revision":"be15db1cc789e38414113d129e343b918fa39fb9","parents":["14f53ca0a3b47f5584172d2ac46630e3517e05f1"],"ref":"refs/changes/65/865/6","uploader":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"createdOn":1500980137,"author":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1500914361,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1500914361,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1499793284,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1500651837,"by":{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"}},{"type":"SUBM","value":"1","grantedOn":1500990214,"by":{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"docs/operator-guide.md","type":"MODIFIED","insertions":47,"deletions":-15}],"sizeInsertions":47,"sizeDeletions":-15}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Brian Bennett","email":"brian.bennett@joyent.com","username":"bahamat"},{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},{"name":"Richard Bradley","email":"richard.bradley@joyent.com","username":"chudley"}]}