{"project":"joyent/sdc-ufds","branch":"master","id":"Ia0dbdc70ba543b79c093ab3fe9bca6d7844d286a","number":"2604","subject":"CAPI-535 runtests is incorrectly reporting success when test suite exits with non zero value Reviewed by: Trent Mick \u003ctrentm@gmail.com\u003e Approved by: Trent Mick \u003ctrentm@gmail.com\u003e","owner":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"url":"https://cr.joyent.us/2604","commitMessage":"CAPI-535 runtests is incorrectly reporting success when test suite exits with non zero value\nReviewed by: Trent Mick \u003ctrentm@gmail.com\u003e\nApproved by: Trent Mick \u003ctrentm@gmail.com\u003e\n","createdOn":1505841105,"lastUpdated":1505918773,"open":false,"status":"MERGED","comments":[{"timestamp":1505841105,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 1."},{"timestamp":1505841110,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit 5cc6ca0f785f4d7557ca35f3df83a0862e0e269d\n    \n    CAPI-535 runtests is incorrectly reporting success when test suite exits with non zero value"},{"timestamp":1505841132,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1505841345,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 1:\n\n(2 comments)"},{"timestamp":1505841745,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 1:\n\n(2 comments)\n\nDone with the comment removal. I\u0027d keep it as is and exit 1 in case $test_files is empty"},{"timestamp":1505845350,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 2."},{"timestamp":1505845355,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit dbecc8f90cd0b2e553913500f9b4d92fa59c9744\n    \n    CAPI-535 runtests is incorrectly reporting success when test suite exits with non zero value"},{"timestamp":1505845384,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1505845467,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 2: Code-Review+1 Integration-Approval+1"},{"timestamp":1505918575,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 3: Commit message was updated."},{"timestamp":1505918656,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 4."},{"timestamp":1505918661,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 4:\n\nNew commits:\n    \n    commit 1087026311b78e092add383767dfc0ff954102e2\n    \n    CAPI-535 runtests is incorrectly reporting success when test suite exits with non zero value\n    \n    commit 983755eb0a9666e5c1d4dae3fbc8c0fc028c02dd\n    \n    CAPI-534 ufds-master incorrectly checking moray for existence of pwdPolicy with empty string as key\n    Reviewed by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e\n    Approved by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e"},{"timestamp":1505918689,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1505918767,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 5: Patch Set 4 was rebased"},{"timestamp":1505918773,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Pedro Palazón Candel"}],"currentPatchSet":{"number":"5","revision":"8e8c4d4ae794b96a332c2f0203417b4e32385a64","parents":["983755eb0a9666e5c1d4dae3fbc8c0fc028c02dd"],"ref":"refs/changes/04/2604/5","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1505918767,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"NO_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1505845467,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1505845467,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1505918689,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"SUBM","value":"1","grantedOn":1505918773,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"test/runtests","type":"MODIFIED","insertions":7,"deletions":-4}],"sizeInsertions":7,"sizeDeletions":-4},"patchSets":[{"number":"1","revision":"59e3953ce578ed82369aa6eb4f9d60c137157564","parents":["3ff5a93f43de6c2222545cbcbf971d49a8c372ac"],"ref":"refs/changes/04/2604/1","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1505841105,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1505841132,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"test/runtests","line":22,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"drop these"},{"file":"test/runtests","line":22,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Done"},{"file":"test/runtests","line":120,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"I\u0027m not sure what happens if the if-test fails (i.e. if $test_files is empty). I think rv\u003d1 in that case, which is fine. Might be better to have the \"test_files\" code above, assert that \"test_files\" isn\u0027t empty?"},{"file":"test/runtests","line":120,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"I think it would be fine to just exit a failure if $test_files is empty. Wondering about the reason for such thing I just can think of a bogus file pattern, which is definitely not desired?"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"test/runtests","type":"MODIFIED","insertions":6,"deletions":-2}],"sizeInsertions":6,"sizeDeletions":-2},{"number":"2","revision":"8a7aa5c2c0998c07391009572f926cfc19aebd67","parents":["3ff5a93f43de6c2222545cbcbf971d49a8c372ac"],"ref":"refs/changes/04/2604/2","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1505845350,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1505845384,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1505845467,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1505845467,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"test/runtests","type":"MODIFIED","insertions":7,"deletions":-4}],"sizeInsertions":7,"sizeDeletions":-4},{"number":"3","revision":"6bbaf3b43011b1e42ab48b5f3877cd8bf1d0e6cd","parents":["3ff5a93f43de6c2222545cbcbf971d49a8c372ac"],"ref":"refs/changes/04/2604/3","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1505918575,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1505845384,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1505845467,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1505845467,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"test/runtests","type":"MODIFIED","insertions":7,"deletions":-4}],"sizeInsertions":7,"sizeDeletions":-4},{"number":"4","revision":"a0dbdc70ba543b79c093ab3fe9bca6d7844d286a","parents":["3ff5a93f43de6c2222545cbcbf971d49a8c372ac"],"ref":"refs/changes/04/2604/4","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1505918656,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1505918689,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/salt.js","type":"MODIFIED","insertions":92,"deletions":-50},{"file":"test/runtests","type":"MODIFIED","insertions":7,"deletions":-4}],"sizeInsertions":99,"sizeDeletions":-54},{"number":"5","revision":"8e8c4d4ae794b96a332c2f0203417b4e32385a64","parents":["983755eb0a9666e5c1d4dae3fbc8c0fc028c02dd"],"ref":"refs/changes/04/2604/5","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1505918767,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"NO_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1505918689,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1505845467,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1505845467,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1505918773,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"test/runtests","type":"MODIFIED","insertions":7,"deletions":-4}],"sizeInsertions":7,"sizeDeletions":-4}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}]}