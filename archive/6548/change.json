{"project":"joyent/smartos-live","branch":"master","id":"Ifda7cc9cc465fb314033c356fef3be955bb572f0","number":"6548","subject":"OS-7666 vminfod times out while starting with thousands of snapshots","owner":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"url":"https://cr.joyent.us/6548","commitMessage":"OS-7666 vminfod times out while starting with thousands of snapshots\n","createdOn":1562169144,"lastUpdated":1563297783,"open":false,"status":"MERGED","comments":[{"timestamp":1562169144,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Uploaded patch set 1."},{"timestamp":1562169145,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit 6e35c6b7ba7600e4cd4ca4bf2f2f7a8353bcea7b\n    \n    Vary depth depending on whether dataset was passed in"},{"timestamp":1562169237,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1562856849,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 1: Code-Review+1"},{"timestamp":1562862928,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Patch Set 1:\n\nI don\u0027t immediately see how this fixes the issue - is there an example of what this limits in the case of snapshots. From what I read in the bug report - it will limit dataset snapshots, but is that the actual problem people are running into?"},{"timestamp":1562863938,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Patch Set 2: Patch Set 1 was rebased"},{"timestamp":1562864033,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2:\n\n\"make check\" passed ok"},{"timestamp":1562885800,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Patch Set 2:\n\n\u003e I don\u0027t immediately see how this fixes the issue - is there an\n \u003e example of what this limits in the case of snapshots. From what I\n \u003e read in the bug report - it will limit dataset snapshots, but is\n \u003e that the actual problem people are running into?\n\nI was thinking of it as alongs the lines of the principle of least privilege, we use data from snapshots nested within the zone dataset, and they are expensive to look up. If we can avoid doing so, thats a win right? Unless I\u0027m misunderstanding."},{"timestamp":1562885856,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Patch Set 2:\n\n\u003e privilege, we use data from snapshots nested within the zone\n\nwe *do not* use"},{"timestamp":1562887233,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Patch Set 2:\n\nWhat I wonder is if the user(s) in question were using snapshots on a delegated dataset (or nested dataset)."},{"timestamp":1562953637,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Patch Set 2: Code-Review+1 Integration-Approval+1\n\nApproving, as at least ignoring delegated dataset snapshots should help in some cases."},{"timestamp":1563212814,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Patch Set 3: Patch Set 2 was rebased"},{"timestamp":1563212909,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3:\n\n\"make check\" passed ok"},{"timestamp":1563297692,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Patch Set 4: Patch Set 3 was rebased"},{"timestamp":1563297699,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Orlando Vazquez"},{"timestamp":1563297783,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4:\n\n\"make check\" passed ok"}],"currentPatchSet":{"number":"4","revision":"07cfb885e779efe5444b802b675c27f72607e0fa","parents":["e4e52c68acb669ca32e05d826b22e01a3a342622"],"ref":"refs/changes/48/6548/4","uploader":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"createdOn":1563297692,"author":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1562169237,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1562856849,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1562953637,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1562953637,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}},{"type":"SUBM","value":"1","grantedOn":1563297699,"by":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/vm/node_modules/vmload/vmload-datasets.js","type":"MODIFIED","insertions":2,"deletions":-1}],"sizeInsertions":2,"sizeDeletions":-1},"patchSets":[{"number":"1","revision":"fda7cc9cc465fb314033c356fef3be955bb572f0","parents":["c4169c5afac261214a81f61e38ab03b667626ccd"],"ref":"refs/changes/48/6548/1","uploader":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"createdOn":1562169144,"author":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1562169237,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1562856849,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/vm/node_modules/vmload/vmload-datasets.js","type":"MODIFIED","insertions":2,"deletions":-1}],"sizeInsertions":2,"sizeDeletions":-1},{"number":"2","revision":"826e7b6991428dbf7f35c526392cd5e33c485742","parents":["16a8c21077ea1b6414868726972887fd35e2a82b"],"ref":"refs/changes/48/6548/2","uploader":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"createdOn":1562863938,"author":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1562169237,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1562953637,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1562953637,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1562856849,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/vm/node_modules/vmload/vmload-datasets.js","type":"MODIFIED","insertions":2,"deletions":-1}],"sizeInsertions":2,"sizeDeletions":-1},{"number":"3","revision":"008cf76f8c3780132261d6b2943a52ff09e9a646","parents":["a6673b11756193f6f6f2653d2d6c47ed1299c8fe"],"ref":"refs/changes/48/6548/3","uploader":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"createdOn":1563212814,"author":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1562169237,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1562953637,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1562953637,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1562856849,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/vm/node_modules/vmload/vmload-datasets.js","type":"MODIFIED","insertions":2,"deletions":-1}],"sizeInsertions":2,"sizeDeletions":-1},{"number":"4","revision":"07cfb885e779efe5444b802b675c27f72607e0fa","parents":["e4e52c68acb669ca32e05d826b22e01a3a342622"],"ref":"refs/changes/48/6548/4","uploader":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"createdOn":1563297692,"author":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1562169237,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"SUBM","value":"1","grantedOn":1563297699,"by":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1562953637,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1562953637,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1562856849,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/vm/node_modules/vmload/vmload-datasets.js","type":"MODIFIED","insertions":2,"deletions":-1}],"sizeInsertions":2,"sizeDeletions":-1}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"}]}