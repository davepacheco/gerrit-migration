From 008cf76f8c3780132261d6b2943a52ff09e9a646 Mon Sep 17 00:00:00 2001
From: Orlando Vazquez <ovazquez@gmail.com>
Date: Wed, 3 Jul 2019 08:52:23 -0700
Subject: [PATCH] OS-7666 vminfod times out while starting with thousands of
 snapshots

---
 src/vm/node_modules/vmload/vmload-datasets.js | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/src/vm/node_modules/vmload/vmload-datasets.js b/src/vm/node_modules/vmload/vmload-datasets.js
index 05505eeb..cfe6b320 100644
--- a/src/vm/node_modules/vmload/vmload-datasets.js
+++ b/src/vm/node_modules/vmload/vmload-datasets.js
@@ -298,13 +298,14 @@ function getDatasets(obj, options, callback)
     if (obj.zonepath) {
         assert.strictEqual(obj.zonepath[0], '/');
         parents.push(obj.zonepath.slice(1));
-
+        _options.depth = 1;
     } else {
         /*
          * If we don't have one we're listing all VMs and need to fetch
          * everything anyway.
          */
         listEverything = true;
+        _options.depth = 2;
     }
 
     if (obj.datasets) {
-- 
2.21.0

