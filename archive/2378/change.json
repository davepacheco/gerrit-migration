{"project":"joyent/manta-muskie","branch":"master","topic":"MANTA-2500","id":"Icecdfce62528af5535e29640b414287860afaf25","number":"2378","subject":"MANTA-2500 muskie default content length is not one size fits all Reviewed by: Jordan Hendricks \u003cjordan.hendricks@joyent.com\u003e Approved by: Jordan Hendricks \u003cjordan.hendricks@joyent.com\u003e","owner":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"url":"https://cr.joyent.us/2378","commitMessage":"MANTA-2500 muskie default content length is not one size fits all\nReviewed by: Jordan Hendricks \u003cjordan.hendricks@joyent.com\u003e\nApproved by: Jordan Hendricks \u003cjordan.hendricks@joyent.com\u003e\n","createdOn":1502412252,"lastUpdated":1503100847,"open":false,"status":"MERGED","comments":[{"timestamp":1502412252,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Uploaded patch set 1."},{"timestamp":1502412284,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1502416300,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Uploaded patch set 2."},{"timestamp":1502416337,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1502737163,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Topic set to MANTA-2500"},{"timestamp":1502815951,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Patch Set 2:\n\n(2 comments)\n\nThanks for fixing this! It seems like this problem has caused a lot of friction in muskie tests, both past and present."},{"timestamp":1502846112,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1502986271,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Uploaded patch set 3: Patch Set 2 was rebased."},{"timestamp":1502986305,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Uploaded patch set 4."},{"timestamp":1502986313,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3:\n\n\"make check\" passed ok"},{"timestamp":1502986333,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1502986350,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Patch Set 2:\n\n(2 comments)"},{"timestamp":1502987566,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Uploaded patch set 5."},{"timestamp":1502987599,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1502990520,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Patch Set 5: Code-Review+1\n\n(1 comment)"},{"timestamp":1503030485,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Patch Set 4:\n\n(1 comment)"},{"timestamp":1503088178,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Patch Set 5:\n\n(1 comment)"},{"timestamp":1503100623,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Patch Set 5: Integration-Approval+1"},{"timestamp":1503100818,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Patch Set 6: Patch Set 5 was rebased"},{"timestamp":1503100827,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Uploaded patch set 7: Commit message was updated."},{"timestamp":1503100843,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Joshua M. Clulow"},{"timestamp":1503100847,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 6:\n\n\"make check\" passed ok"}],"currentPatchSet":{"number":"7","revision":"cecdfce62528af5535e29640b414287860afaf25","parents":["c69a24c82305739298e3d41cfcd73fafd0b4be66"],"ref":"refs/changes/78/2378/7","uploader":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"createdOn":1503100827,"author":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1502987599,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1502990520,"by":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1503100623,"by":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"}},{"type":"SUBM","value":"1","grantedOn":1503100843,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"etc/config.coal.json","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/common.js","type":"MODIFIED","insertions":7,"deletions":0},{"file":"lib/obj.js","type":"MODIFIED","insertions":3,"deletions":-8},{"file":"lib/picker.js","type":"MODIFIED","insertions":5,"deletions":-11},{"file":"lib/uploads/common.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/uploads/create.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"main.js","type":"MODIFIED","insertions":30,"deletions":-1},{"file":"sapi_manifests/muskie/template","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":54,"sizeDeletions":-26},"patchSets":[{"number":"1","revision":"46fc2e372797eab8c861186ee7673bb6a4509860","parents":["af4520cc26aaed16d4e4024f8088c4a2d6eed8b0"],"ref":"refs/changes/78/2378/1","uploader":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"createdOn":1502412252,"author":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1502412284,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/common.js","type":"MODIFIED","insertions":5,"deletions":0},{"file":"lib/obj.js","type":"MODIFIED","insertions":3,"deletions":-8},{"file":"lib/picker.js","type":"MODIFIED","insertions":5,"deletions":-11},{"file":"lib/uploads/common.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/uploads/create.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"main.js","type":"MODIFIED","insertions":35,"deletions":-1},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"sapi_manifests/muskie/template","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":56,"sizeDeletions":-26},{"number":"2","revision":"807224ac26c80df5f9fb3cb9af7203571f502293","parents":["af4520cc26aaed16d4e4024f8088c4a2d6eed8b0"],"ref":"refs/changes/78/2378/2","uploader":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"createdOn":1502416300,"author":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1502416337,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/common.js","line":918,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"I think this should be stored in a different namespace on the request object -- for instance, under \"req.defValues.maxStreamingSize\".\n\nThis would be useful because: (1) the top-level attributes on the request object are already quite cluttered from both restify and muskie both hanging off values as top-level attritubes on the request object and (2) I\u0027ve thought it would be useful to be able to tune more of the defaults in muskie as an operator, such as the max number of copies of an object stored. Similar to the tests failing in muskie from a one-size-fits-all default content length, I ran into an issue with the tests assuming a default value that I had tuned in my config (https://github.com/joyent/manta-muskie/blame/af4520cc26aaed16d4e4024f8088c4a2d6eed8b0/test/obj.test.js#L272). There are probably other instances of this type of thing, too.\n\nWhat do you think?"},{"file":"lib/common.js","line":918,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"That seems reasonable to me.  I will restructure it thus!"},{"file":"lib/common.js","line":918,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Done"},{"file":"sapi_manifests/muskie/template","line":176,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"We should also update etc/config.coal.json to have a sane default for this config value."},{"file":"sapi_manifests/muskie/template","line":176,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/common.js","type":"MODIFIED","insertions":5,"deletions":0},{"file":"lib/obj.js","type":"MODIFIED","insertions":3,"deletions":-8},{"file":"lib/picker.js","type":"MODIFIED","insertions":5,"deletions":-11},{"file":"lib/uploads/common.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/uploads/create.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"main.js","type":"MODIFIED","insertions":30,"deletions":-1},{"file":"sapi_manifests/muskie/template","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":50,"sizeDeletions":-25},{"number":"3","revision":"7a377f1e51e211337dc3d57b38cf70db5d03c6d9","parents":["0aca7a4f972564a594e24622a1299b902c09326e"],"ref":"refs/changes/78/2378/3","uploader":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"createdOn":1502986271,"author":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1502416337,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/common.js","type":"MODIFIED","insertions":5,"deletions":0},{"file":"lib/obj.js","type":"MODIFIED","insertions":3,"deletions":-8},{"file":"lib/picker.js","type":"MODIFIED","insertions":5,"deletions":-11},{"file":"lib/uploads/common.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/uploads/create.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"main.js","type":"MODIFIED","insertions":30,"deletions":-1},{"file":"sapi_manifests/muskie/template","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":50,"sizeDeletions":-25},{"number":"4","revision":"93f998c9395bf77d5357bad6053e85f391fb3e6f","parents":["0aca7a4f972564a594e24622a1299b902c09326e"],"ref":"refs/changes/78/2378/4","uploader":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"createdOn":1502986305,"author":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1502986333,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/common.js","line":918,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"nit: Why the mix of case styles here? (msk_defaults vs maxStreamingSize)"},{"file":"lib/common.js","line":918,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"I think we should prefix all new properties on \"req\" with a common prefix unlikely to conflict with any base restify properties; in this case, \"msk_\" -- for \"muskie\".\n\nIn a follow-up change, I could go back and prefix other properties for consistency (e.g., \"req.msk_sharkConfig\", etc), but I\u0027d rather not tie that to this change right now."},{"file":"lib/common.js","line":918,"reviewer":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},"message":"Okay, sounds good."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"etc/config.coal.json","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/common.js","type":"MODIFIED","insertions":7,"deletions":0},{"file":"lib/obj.js","type":"MODIFIED","insertions":3,"deletions":-8},{"file":"lib/picker.js","type":"MODIFIED","insertions":5,"deletions":-11},{"file":"lib/uploads/common.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/uploads/create.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"main.js","type":"MODIFIED","insertions":30,"deletions":-1},{"file":"sapi_manifests/muskie/template","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":54,"sizeDeletions":-26},{"number":"5","revision":"723539d9846bbb014e185345e55a41c7ac990d22","parents":["0aca7a4f972564a594e24622a1299b902c09326e"],"ref":"refs/changes/78/2378/5","uploader":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"createdOn":1502987566,"author":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1502987599,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1502990520,"by":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1503100623,"by":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"etc/config.coal.json","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/common.js","type":"MODIFIED","insertions":7,"deletions":0},{"file":"lib/obj.js","type":"MODIFIED","insertions":3,"deletions":-8},{"file":"lib/picker.js","type":"MODIFIED","insertions":5,"deletions":-11},{"file":"lib/uploads/common.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/uploads/create.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"main.js","type":"MODIFIED","insertions":30,"deletions":-1},{"file":"sapi_manifests/muskie/template","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":54,"sizeDeletions":-26},{"number":"6","revision":"676908af0341d68df491ea3c2b760cf9279ed00d","parents":["c69a24c82305739298e3d41cfcd73fafd0b4be66"],"ref":"refs/changes/78/2378/6","uploader":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"createdOn":1503100818,"author":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1502987599,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1502990520,"by":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1503100623,"by":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"etc/config.coal.json","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/common.js","type":"MODIFIED","insertions":7,"deletions":0},{"file":"lib/obj.js","type":"MODIFIED","insertions":3,"deletions":-8},{"file":"lib/picker.js","type":"MODIFIED","insertions":5,"deletions":-11},{"file":"lib/uploads/common.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/uploads/create.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"main.js","type":"MODIFIED","insertions":30,"deletions":-1},{"file":"sapi_manifests/muskie/template","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":54,"sizeDeletions":-26},{"number":"7","revision":"cecdfce62528af5535e29640b414287860afaf25","parents":["c69a24c82305739298e3d41cfcd73fafd0b4be66"],"ref":"refs/changes/78/2378/7","uploader":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"createdOn":1503100827,"author":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"SUBM","value":"1","grantedOn":1503100843,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1502987599,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1502990520,"by":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1503100623,"by":{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"etc/config.coal.json","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"lib/common.js","type":"MODIFIED","insertions":7,"deletions":0},{"file":"lib/obj.js","type":"MODIFIED","insertions":3,"deletions":-8},{"file":"lib/picker.js","type":"MODIFIED","insertions":5,"deletions":-11},{"file":"lib/uploads/common.js","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"lib/uploads/create.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"main.js","type":"MODIFIED","insertions":30,"deletions":-1},{"file":"sapi_manifests/muskie/template","type":"MODIFIED","insertions":2,"deletions":-2}],"sizeInsertions":54,"sizeDeletions":-26}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Jordan Hendricks","email":"jordan.hendricks@joyent.com","username":"jordanhendricks"},{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}]}