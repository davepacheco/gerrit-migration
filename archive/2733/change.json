{"project":"joyent/node-libmanta","branch":"master","id":"I215395a3a10bb392711d4a535bc0ce4bba14e1a9","number":"2733","subject":"MANTA-3450 Address concurrency errors when creating postgres functions Reviewed by: David Pacheco \u003cdap@joyent.com\u003e","owner":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"url":"https://cr.joyent.us/2733","commitMessage":"MANTA-3450 Address concurrency errors when creating postgres functions\nReviewed by: David Pacheco \u003cdap@joyent.com\u003e\n","createdOn":1507242591,"lastUpdated":1509986404,"open":false,"status":"MERGED","comments":[{"timestamp":1507242591,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Uploaded patch set 1."},{"timestamp":1507242593,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit b67f947c701331b946382ef3430879b205be3cd5\n    \n    MANTA-3450 Address concurrency errors when creating postgres functions\n    Use postgres transactional advisory locks to avoid concurrent execution of\n    CREATE FUNCTION statements for the same function that result in \u0027tuple\n    concurrently updated\u0027 errors."},{"timestamp":1507242621,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1507312002,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Uploaded patch set 2."},{"timestamp":1507312003,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit de9079900a1249fa26c9db1b4d24458dde5b8c24\n    \n    Use two keys for the advisory locks to decrease chances of key conflict"},{"timestamp":1507312027,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1508859653,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Uploaded patch set 3: Patch Set 2 was rebased."},{"timestamp":1508859655,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Patch Set 3:\n\nNew commits:\n    \n    commit f7e80d05d2689b827666d8213cd0c996351c3476\n    \n    Use two keys for the advisory locks to decrease chances of key conflict\n    \n    commit b9aff938306c95d53a56fe96f935c8072d5e2938\n    \n    MANTA-3450 Address concurrency errors when creating postgres functions\n    Use postgres transactional advisory locks to avoid concurrent execution of\n    CREATE FUNCTION statements for the same function that result in \u0027tuple\n    concurrently updated\u0027 errors."},{"timestamp":1508859677,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3:\n\n\"make check\" passed ok"},{"timestamp":1508965716,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 3: Code-Review+1\n\n(2 comments)"},{"timestamp":1508989778,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Uploaded patch set 4."},{"timestamp":1508989780,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Patch Set 4:\n\nNew commits:\n    \n    commit 9a79ddd45cc6c2b1cbf6b9fdcace0b027ee4a213\n    \n    Minor formatting changes"},{"timestamp":1508989806,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1509124043,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 4: Code-Review+1"},{"timestamp":1509726905,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 4: Integration-Approval+1"},{"timestamp":1509986404,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Kelly McLaughlin"}],"currentPatchSet":{"number":"4","revision":"215395a3a10bb392711d4a535bc0ce4bba14e1a9","parents":["ecd91bbc582bafad3a1a999d60265c5f97a98c00"],"ref":"refs/changes/33/2733/4","uploader":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"createdOn":1508989778,"author":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1508989806,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1509124043,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1509726905,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"SUBM","value":"1","grantedOn":1509986404,"by":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"lib/trigger_dircount.plpgsql","type":"MODIFIED","insertions":33,"deletions":-17},{"file":"lib/trigger_update.plpgsql","type":"MODIFIED","insertions":86,"deletions":-58}],"sizeInsertions":119,"sizeDeletions":-75},"patchSets":[{"number":"1","revision":"390f3fe0beaac1d7b70af735774a47673754341f","parents":["f9d436c6978c30d48372784f2fe973cc565df24d"],"ref":"refs/changes/33/2733/1","uploader":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"createdOn":1507242591,"author":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1507242621,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/trigger_dircount.plpgsql","type":"MODIFIED","insertions":22,"deletions":-17},{"file":"lib/trigger_update.plpgsql","type":"MODIFIED","insertions":76,"deletions":-58}],"sizeInsertions":98,"sizeDeletions":-75},{"number":"2","revision":"a626475bea052c0a247f8a5ab0872c71139e52a9","parents":["f9d436c6978c30d48372784f2fe973cc565df24d"],"ref":"refs/changes/33/2733/2","uploader":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"createdOn":1507312002,"author":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1507312027,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/trigger_dircount.plpgsql","type":"MODIFIED","insertions":31,"deletions":-17},{"file":"lib/trigger_update.plpgsql","type":"MODIFIED","insertions":84,"deletions":-58}],"sizeInsertions":115,"sizeDeletions":-75},{"number":"3","revision":"d21c0f84c373d1f81ea8565d072e9eeb39057a68","parents":["ecd91bbc582bafad3a1a999d60265c5f97a98c00"],"ref":"refs/changes/33/2733/3","uploader":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"createdOn":1508859653,"author":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1508965716,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1507312027,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/trigger_dircount.plpgsql","line":34,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"The wrapping here seems a little odd."},{"file":"lib/trigger_dircount.plpgsql","line":53,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Can we wrap this to 80 columns?"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/trigger_dircount.plpgsql","type":"MODIFIED","insertions":31,"deletions":-17},{"file":"lib/trigger_update.plpgsql","type":"MODIFIED","insertions":84,"deletions":-58}],"sizeInsertions":115,"sizeDeletions":-75},{"number":"4","revision":"215395a3a10bb392711d4a535bc0ce4bba14e1a9","parents":["ecd91bbc582bafad3a1a999d60265c5f97a98c00"],"ref":"refs/changes/33/2733/4","uploader":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"createdOn":1508989778,"author":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1509124043,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1509726905,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1508989806,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"SUBM","value":"1","grantedOn":1509986404,"by":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"lib/trigger_dircount.plpgsql","type":"MODIFIED","insertions":33,"deletions":-17},{"file":"lib/trigger_update.plpgsql","type":"MODIFIED","insertions":86,"deletions":-58}],"sizeInsertions":119,"sizeDeletions":-75}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"}]}