{"project":"joyent/illumos-joyent","branch":"master","id":"Ic0834af5f903a2f16c6ad3a4a8946d7f40edda4b","number":"6344","subject":"OS-7667 IPFilter needs to keep and report state for cloud firewall logging Portions contributed by: Mike Gerdts \u003cmike.gerdts@joyent.com\u003e Reviewed by: Mike Gerdts \u003cmike.gerdts@joyent.com\u003e Reviewed by: Cody Peter Mello \u003ccody.mello@joyent.com\u003e Reviewed by: M","owner":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"url":"https://cr.joyent.us/6344","commitMessage":"OS-7667 IPFilter needs to keep and report state for cloud firewall logging\nPortions contributed by: Mike Gerdts \u003cmike.gerdts@joyent.com\u003e\nReviewed by: Mike Gerdts \u003cmike.gerdts@joyent.com\u003e\nReviewed by: Cody Peter Mello \u003ccody.mello@joyent.com\u003e\nReviewed by: Michael Zeller \u003cmike.zeller@joyent.com\u003e\nApproved by: Michael Zeller \u003cmike.zeller@joyent.com\u003e\n","createdOn":1558484089,"lastUpdated":1561667082,"open":false,"status":"MERGED","comments":[{"timestamp":1558484089,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Uploaded patch set 1."},{"timestamp":1558717764,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 1:\n\n(45 comments)"},{"timestamp":1558732966,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 1:\n\n(41 comments)\n\nPutting stakes in the ground for the next update.  The next update may be just the low-hanging fruit, with the understanding there\u0027s more to come.  There\u0027s a good suggestion for a rewhack of the read-many-events routine, which shouldn\u0027t stop the obvious fixes from showing up here."},{"timestamp":1560361111,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Uploaded patch set 2."},{"timestamp":1560361214,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Uploaded patch set 3: Commit message was updated."},{"timestamp":1560449549,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Uploaded patch set 4."},{"timestamp":1560451141,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 1:\n\n(10 comments)"},{"timestamp":1560524814,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Uploaded patch set 5."},{"timestamp":1560815675,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 5:\n\n(1 comment)"},{"timestamp":1560873919,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 5:\n\n(2 comments)"},{"timestamp":1560899593,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 5:\n\n(2 comments)"},{"timestamp":1560902106,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Uploaded patch set 6."},{"timestamp":1560902546,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Uploaded patch set 7."},{"timestamp":1560902805,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 6:\n\nPatch 6 was what I thought a simple rebase, but upon review I remembered I had to fix the event-reporting ring-advance code.\n\nPatch 7 addresses the comments from patch 5."},{"timestamp":1560911097,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 7: Code-Review+1"},{"timestamp":1561054069,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 7:\n\nTesting notes updated."},{"timestamp":1561421441,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 7:\n\n(9 comments)"},{"timestamp":1561484538,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 7:\n\n(8 comments)\n\nWill upload a patch addressing these once I test with it built."},{"timestamp":1561486903,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Uploaded patch set 8."},{"timestamp":1561487037,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 8:\n\n(1 comment)"},{"timestamp":1561497009,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 8:\n\nRetested with both UDP spray (drops) and netperf (connection-logging) concurrently."},{"timestamp":1561498281,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 8: Code-Review+1"},{"timestamp":1561549990,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 8: Code-Review+1"},{"timestamp":1561578022,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Uploaded patch set 9: Patch Set 8 was rebased."},{"timestamp":1561578157,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 9:\n\nAdding reviewers in, re-tested, possibly ready for IA."},{"timestamp":1561578167,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Uploaded patch set 10: Commit message was updated."},{"timestamp":1561661236,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Patch Set 7:\n\n(1 comment)"},{"timestamp":1561664415,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Uploaded patch set 11."},{"timestamp":1561664456,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 11:\n\nUpdated whitespace nit, and put test-ipfev.c into the bug report."},{"timestamp":1561664635,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 11: Code-Review+1"},{"timestamp":1561664931,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 11: Code-Review+1"},{"timestamp":1561665641,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Patch Set 11: Integration-Approval+1"},{"timestamp":1561665655,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"Patch Set 11: Code-Review+1"},{"timestamp":1561665905,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Uploaded patch set 12: Commit message was updated."},{"timestamp":1561667082,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Dan McDonald"}],"currentPatchSet":{"number":"12","revision":"c0834af5f903a2f16c6ad3a4a8946d7f40edda4b","parents":["d52326b14627b369debbeb1c820b08a811328317"],"ref":"refs/changes/44/6344/12","uploader":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"createdOn":1561665905,"author":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1561664635,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1561664931,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1561665641,"by":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1561665655,"by":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"}},{"type":"SUBM","value":"1","grantedOn":1561667082,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":12,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/cmd/devfsadm/misc_link.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/cmd/ipf/lib/common/printfr.c","type":"MODIFIED","insertions":16,"deletions":-2},{"file":"usr/src/cmd/ipf/tools/Makefile.tools","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"usr/src/cmd/ipf/tools/ipf_y.y","type":"MODIFIED","insertions":17,"deletions":0},{"file":"usr/src/cmd/ipf/tools/ipmon_y.y","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/cmd/ipf/tools/ipnat_y.y","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/cmd/ipf/tools/ippool_y.y","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/cmd/ipf/tools/lexer.c","type":"MODIFIED","insertions":37,"deletions":0},{"file":"usr/src/cmd/ipf/tools/lexer.h","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"usr/src/uts/common/Makefile.files","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/common/inet/ipf/cfw.c","type":"ADDED","insertions":659,"deletions":0},{"file":"usr/src/uts/common/inet/ipf/fil.c","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"usr/src/uts/common/inet/ipf/ip_fil_solaris.c","type":"MODIFIED","insertions":44,"deletions":-1},{"file":"usr/src/uts/common/inet/ipf/ip_log.c","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/inet/ipf/ip_state.c","type":"MODIFIED","insertions":17,"deletions":-2},{"file":"usr/src/uts/common/inet/ipf/netinet/Makefile","type":"MODIFIED","insertions":3,"deletions":-4},{"file":"usr/src/uts/common/inet/ipf/netinet/ip_fil.h","type":"MODIFIED","insertions":43,"deletions":-3},{"file":"usr/src/uts/common/inet/ipf/netinet/ip_state.h","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/uts/common/inet/ipf/netinet/ipf_cfw.h","type":"ADDED","insertions":69,"deletions":0},{"file":"usr/src/uts/common/inet/ipf/netinet/ipf_stack.h","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/common/inet/ipf/solaris.c","type":"MODIFIED","insertions":7,"deletions":-2},{"file":"usr/src/uts/intel/ipf/ipf.global-objs.debug64","type":"MODIFIED","insertions":14,"deletions":-1},{"file":"usr/src/uts/sparc/ipf/ipf.global-objs.debug64","type":"MODIFIED","insertions":14,"deletions":-1}],"sizeInsertions":978,"sizeDeletions":-27},"patchSets":[{"number":"1","revision":"f65387d42de08a2f1d0de99446f9ef4f896a7c4f","parents":["3a1da6de2a216503918b00b0a4524e613a8134d8"],"ref":"refs/changes/44/6344/1","uploader":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"createdOn":1558484089,"author":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/cmd/ipf/tools/ipnat_y.y","line":103,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"The others that are \"%token \u003cfoo\u003e bar\" do not use tabs, we should follow suit."},{"file":"usr/src/cmd/ipf/tools/ipnat_y.y","line":103,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"But we should not follow suit and remove a space between # and define in other places?  I don\u0027t mind following \"new code new style\" or \"new code old style\", but I\u0027m getting conflicting answers here and in the header files."},{"file":"usr/src/cmd/ipf/tools/ippool_y.y","line":80,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"spaces instead of tab?"},{"file":"usr/src/cmd/ipf/tools/ippool_y.y","line":80,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"See the other .y response."},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":176,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Is there value in keeping this here for reference?\n\nIf it stays, s/Superceded/Superseded/"},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":176,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Uncertain, but if I do keep it, I will fix the spelling."},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":176,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Losing this section, and modifying language below."},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":190,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"and must not be released"},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":190,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Fixed."},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":192,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"\u003c num_avail"},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":192,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Maybe \"contig_size\"."},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":209,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"unsigned?  I\u0027ve been getting dinged on this lately."},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":209,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Good point, and consume_many will have to get changes as well."},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":211,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"static"},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":211,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Damn, thought I\u0027d caught all of those.  Thanks, will fix."},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":212,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"As I was organizing my thoughts on this function, I hacked up something that I think is clearer and more consistent with the comment above the function.  It\u0027s also 27 lines shorter.  I\u0027ve not compiled it.\n\nhttps://gist.github.com/mgerdts/db9e0e55b9b09c2a2082f18ef6bbd435"},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":212,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"I have a small test-program where I tried out the logic here initially.  I can port yours into it."},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":212,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"I tried a rewrite and it seems to work as well as it did before."},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":222,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"It seems we should be doing these (or at least the first one) each time we monkey with cfw_ringstart."},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":222,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Good point."},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":229,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"If you used for (;;) { }, you would no longer need goto (either label).  Increased indentation would increase line count by 3."},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":229,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"If your sample replacement works, this won\u0027t be an issue.  If it doesn\u0027t, I\u0027ll look into fixing this."},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":229,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Rewrote."},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":250,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"ASSERT3U"},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":250,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Doh!  Will fix."},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":255,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Callback\n\nBut per the comment above the function:  \"The function must return how many events got consumed, which MUST be \u003c\u003d the number available.\"  This isn\u0027t an error, just a sign that the consumer on the other side of the callback is full."},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":255,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"It also can indicate uio failure."},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":256,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"better as the following after line 251.\n\nASSERT3U(cfw_ringstart, \u003c\u003d, cfw_ringmask)"},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":256,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Will fix."},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":256,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"NOTE: If you read to the end of the buffer, you get (ringmask + 1). So your suggestion needs to be (cfw_ringmask + 1)."},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":259,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Again, comment above says callback may return fewer than requested."},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":259,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Will need to fix, yes."},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":260,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Why can\u0027t this be done just after 251?"},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":260,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"I don\u0027t know.  Good point."},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":261,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"cb_consumed"},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":261,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Oh, yes."},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":263,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Seems unnecessary.  If num_requested \u003e 0, cfw_ringstart was greater than cfw_ringend at line 230."},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":263,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Okay."},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":263,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Rewhacked as part of rewrite."},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":284,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"this could all be handled in another pass of the code above."},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":284,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Your proposed replacement may do just that.  Stay tuned."},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":284,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Rewhacked as part of rewrite."},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":286,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"ASSERT3U().  This gets tripped if ipf_cfwev_consume_many(0, ...) was called - should probably have earlier validation of num_requested."},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":286,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Gotcha."},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":323,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"\"debug id (did)\" may help those not steeped in SmartOSisms"},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":323,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Will fix."},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":333,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"We can\u0027t ..."},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":333,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Will fix."},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":337,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"ASSERT3U"},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":337,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Will fix."},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":370,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"though"},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":370,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Will fix."},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":398,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"ASSERT3U"},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":398,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"See note on similar comment below."},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":398,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Will fix."},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":400,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"uuidcopy()"},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":400,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Will fix."},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":429,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"remove"},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":429,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Will fix (probably fold-into-comment per another response...)."},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":442,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"though"},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":442,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Will fix."},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":447,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"ASSERT3P"},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":447,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Do we need that? It only fails if is_rule \u003d\u003d NULL, pretty obvious and not in need of a 3P-level check."},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":480,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Unless I\u0027m mistaken, this comes from this 32-bit integer that can be specified on the command line.  What if someone used cloudapi to set a rule with a large tag?  See ipf(4).\n\n       tag tagid\n              indicates that, if this rule causes the packet to be logged or\n              entered in the state table, the tagid will be logged as part of\n              the log entry.  This can be used to quickly match \"similar\"\n              rules in scripts that post process the log files for e.g.\n              generation of security reports or accounting purposes. The tagid\n              is a 32 bit unsigned integer."},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":480,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"ASSERT3U"},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":480,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"It is a uint32_t. Shit. I put the ruleid at 16bits in the event structure because I forgot it\u0027s monotonically increasing.  Some asshole could run fwadm a bunch of times or other things to make this change.  I guess we\u0027re bumping from 80 to 88 bytes..."},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":517,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"ensure"},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":517,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Will fix"},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":521,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"This at least deserves a note saying that everything in the current ring will be lost when this is called.\n\nIf it is expected that the ring will be resized at all frequently, we should copy entries from the old ring into the new ring."},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":521,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"It does.  Will fix."},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":638,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"I don\u0027t see a need. It will get what is available.  There are no unbounded allocations based on resid, so it seems ok."},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":638,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Okay, that\u0027s the only KEBE comment in this code, and this is the sort of answer I needed to here.  Will strike it."},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":642,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"ASSERT3U(), but I wonder if we should just return EINVAL instead."},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":642,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"We already do at line 636.  This is probably vestigal."},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":662,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"is there a reason to hold the lock for this probe?"},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":662,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"No there is not.  Will fix."},{"file":"usr/src/uts/common/inet/ipf/ip_fil_solaris.c","line":1263,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"atomic_cas_uint(\u0026ipf_cfwlog_enabled, 0, 1)?"},{"file":"usr/src/uts/common/inet/ipf/ip_fil_solaris.c","line":1263,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Would eliminate the reversion upon failure, wouldn\u0027t it?  Good catch."},{"file":"usr/src/uts/common/inet/ipf/ip_fil_solaris.c","line":1309,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Smarter people than me always tell me that I use membar() inappropriately on my first try.   Please have one of them review this."},{"file":"usr/src/uts/common/inet/ipf/ip_fil_solaris.c","line":1309,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"I stole this from the long-in-practice IRE_REF* and IPSA_REF* macros.  Happy to have someone look at this, but the prior art has been there for some time.\n\nAlso, though, there should be membar in failure modes of iplopen as well. Again, will check the aforementioned reference-macros."},{"file":"usr/src/uts/common/inet/ipf/ip_fil_solaris.c","line":1309,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"See ip_ire.c:ire_refrele() for why. Fixed comments here."},{"file":"usr/src/uts/common/inet/ipf/ip_log.c","line":383,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"uuidcopy()"},{"file":"usr/src/uts/common/inet/ipf/ip_log.c","line":383,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Will fix."},{"file":"usr/src/uts/common/inet/ipf/ip_log.c","line":383,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Actually, won\u0027t fix.  uuid_copy() does not exist in-kernel."},{"file":"usr/src/uts/common/inet/ipf/ip_state.c","line":1449,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"uuidcopy"},{"file":"usr/src/uts/common/inet/ipf/ip_state.c","line":1449,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Oh, that\u0027s in-kernel too.  Will fix."},{"file":"usr/src/uts/common/inet/ipf/ip_state.c","line":1449,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Oops, it\u0027s not in-kernel."},{"file":"usr/src/uts/common/inet/ipf/ip_state.c","line":3414,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"comment is fine, but I don\u0027t think it needs supporting dead code."},{"file":"usr/src/uts/common/inet/ipf/ip_state.c","line":3414,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Will remove if-0 and embed the sample code in the comment instead.  (I think it\u0027s important to leave that as a reminder for future-someone.)"},{"file":"usr/src/uts/common/inet/ipf/netinet/ip_fil.h","line":11,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"no comma"},{"file":"usr/src/uts/common/inet/ipf/netinet/ip_fil.h","line":11,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Will delete."},{"file":"usr/src/uts/common/inet/ipf/netinet/ip_fil.h","line":120,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"These seem as though they should not have a space between # and define.  They are not in the #if block"},{"file":"usr/src/uts/common/inet/ipf/netinet/ip_fil.h","line":120,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Copied from previously-pushed ZONESET.  Can fix all three if you wish..."},{"file":"usr/src/uts/common/inet/ipf/netinet/ipf_cfw.h","line":13,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"delete comma"},{"file":"usr/src/uts/common/inet/ipf/netinet/ipf_cfw.h","line":13,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Will do."},{"file":"usr/src/uts/common/inet/ipf/netinet/ipf_stack.h","line":9,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"delete comma"},{"file":"usr/src/uts/common/inet/ipf/netinet/ipf_stack.h","line":9,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Will do."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/cmd/devfsadm/misc_link.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/cmd/ipf/lib/common/printfr.c","type":"MODIFIED","insertions":16,"deletions":-2},{"file":"usr/src/cmd/ipf/tools/Makefile.tools","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"usr/src/cmd/ipf/tools/ipf_y.y","type":"MODIFIED","insertions":17,"deletions":0},{"file":"usr/src/cmd/ipf/tools/ipmon_y.y","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/cmd/ipf/tools/ipnat_y.y","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/cmd/ipf/tools/ippool_y.y","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/cmd/ipf/tools/lexer.c","type":"MODIFIED","insertions":36,"deletions":0},{"file":"usr/src/cmd/ipf/tools/lexer.h","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"usr/src/uts/common/Makefile.files","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/common/inet/ipf/cfw.c","type":"ADDED","insertions":689,"deletions":0},{"file":"usr/src/uts/common/inet/ipf/fil.c","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"usr/src/uts/common/inet/ipf/ip_fil_solaris.c","type":"MODIFIED","insertions":36,"deletions":-1},{"file":"usr/src/uts/common/inet/ipf/ip_log.c","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/inet/ipf/ip_state.c","type":"MODIFIED","insertions":17,"deletions":-3},{"file":"usr/src/uts/common/inet/ipf/netinet/Makefile","type":"MODIFIED","insertions":3,"deletions":-4},{"file":"usr/src/uts/common/inet/ipf/netinet/ip_fil.h","type":"MODIFIED","insertions":45,"deletions":-3},{"file":"usr/src/uts/common/inet/ipf/netinet/ip_state.h","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/uts/common/inet/ipf/netinet/ipf_cfw.h","type":"ADDED","insertions":66,"deletions":0},{"file":"usr/src/uts/common/inet/ipf/netinet/ipf_stack.h","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/common/inet/ipf/solaris.c","type":"MODIFIED","insertions":7,"deletions":-2},{"file":"usr/src/uts/intel/ipf/ipf.global-objs.debug64","type":"MODIFIED","insertions":14,"deletions":-1},{"file":"usr/src/uts/sparc/ipf/ipf.global-objs.debug64","type":"MODIFIED","insertions":14,"deletions":-1}],"sizeInsertions":998,"sizeDeletions":-28},{"number":"2","revision":"02599ec86207f80a41d7a69f03f17ccb3db71232","parents":["e6de8afafa8b73b0636044f094ba810178b0a271"],"ref":"refs/changes/44/6344/2","uploader":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"createdOn":1560361111,"author":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/cmd/devfsadm/misc_link.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/cmd/ipf/lib/common/printfr.c","type":"MODIFIED","insertions":16,"deletions":-2},{"file":"usr/src/cmd/ipf/tools/Makefile.tools","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"usr/src/cmd/ipf/tools/ipf_y.y","type":"MODIFIED","insertions":17,"deletions":0},{"file":"usr/src/cmd/ipf/tools/ipmon_y.y","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/cmd/ipf/tools/ipnat_y.y","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/cmd/ipf/tools/ippool_y.y","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/cmd/ipf/tools/lexer.c","type":"MODIFIED","insertions":36,"deletions":0},{"file":"usr/src/cmd/ipf/tools/lexer.h","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"usr/src/uts/common/Makefile.files","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/common/inet/ipf/cfw.c","type":"ADDED","insertions":689,"deletions":0},{"file":"usr/src/uts/common/inet/ipf/fil.c","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"usr/src/uts/common/inet/ipf/ip_fil_solaris.c","type":"MODIFIED","insertions":36,"deletions":-1},{"file":"usr/src/uts/common/inet/ipf/ip_log.c","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/inet/ipf/ip_state.c","type":"MODIFIED","insertions":17,"deletions":-3},{"file":"usr/src/uts/common/inet/ipf/netinet/Makefile","type":"MODIFIED","insertions":3,"deletions":-4},{"file":"usr/src/uts/common/inet/ipf/netinet/ip_fil.h","type":"MODIFIED","insertions":45,"deletions":-3},{"file":"usr/src/uts/common/inet/ipf/netinet/ip_state.h","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/uts/common/inet/ipf/netinet/ipf_cfw.h","type":"ADDED","insertions":66,"deletions":0},{"file":"usr/src/uts/common/inet/ipf/netinet/ipf_stack.h","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/common/inet/ipf/solaris.c","type":"MODIFIED","insertions":7,"deletions":-2},{"file":"usr/src/uts/intel/ipf/ipf.global-objs.debug64","type":"MODIFIED","insertions":14,"deletions":-1},{"file":"usr/src/uts/sparc/ipf/ipf.global-objs.debug64","type":"MODIFIED","insertions":14,"deletions":-1}],"sizeInsertions":998,"sizeDeletions":-28},{"number":"3","revision":"2d307f68d07fa66479fa8c711981090d35602767","parents":["e6de8afafa8b73b0636044f094ba810178b0a271"],"ref":"refs/changes/44/6344/3","uploader":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"createdOn":1560361214,"author":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"isDraft":false,"kind":"NO_CODE_CHANGE","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/cmd/devfsadm/misc_link.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/cmd/ipf/lib/common/printfr.c","type":"MODIFIED","insertions":16,"deletions":-2},{"file":"usr/src/cmd/ipf/tools/Makefile.tools","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"usr/src/cmd/ipf/tools/ipf_y.y","type":"MODIFIED","insertions":17,"deletions":0},{"file":"usr/src/cmd/ipf/tools/ipmon_y.y","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/cmd/ipf/tools/ipnat_y.y","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/cmd/ipf/tools/ippool_y.y","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/cmd/ipf/tools/lexer.c","type":"MODIFIED","insertions":36,"deletions":0},{"file":"usr/src/cmd/ipf/tools/lexer.h","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"usr/src/uts/common/Makefile.files","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/common/inet/ipf/cfw.c","type":"ADDED","insertions":689,"deletions":0},{"file":"usr/src/uts/common/inet/ipf/fil.c","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"usr/src/uts/common/inet/ipf/ip_fil_solaris.c","type":"MODIFIED","insertions":36,"deletions":-1},{"file":"usr/src/uts/common/inet/ipf/ip_log.c","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/inet/ipf/ip_state.c","type":"MODIFIED","insertions":17,"deletions":-3},{"file":"usr/src/uts/common/inet/ipf/netinet/Makefile","type":"MODIFIED","insertions":3,"deletions":-4},{"file":"usr/src/uts/common/inet/ipf/netinet/ip_fil.h","type":"MODIFIED","insertions":45,"deletions":-3},{"file":"usr/src/uts/common/inet/ipf/netinet/ip_state.h","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/uts/common/inet/ipf/netinet/ipf_cfw.h","type":"ADDED","insertions":66,"deletions":0},{"file":"usr/src/uts/common/inet/ipf/netinet/ipf_stack.h","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/common/inet/ipf/solaris.c","type":"MODIFIED","insertions":7,"deletions":-2},{"file":"usr/src/uts/intel/ipf/ipf.global-objs.debug64","type":"MODIFIED","insertions":14,"deletions":-1},{"file":"usr/src/uts/sparc/ipf/ipf.global-objs.debug64","type":"MODIFIED","insertions":14,"deletions":-1}],"sizeInsertions":998,"sizeDeletions":-28},{"number":"4","revision":"87959b817275750ba9b01a94e71f9638866ad137","parents":["1f79f23316512a7271211767a997ac719da76e1e"],"ref":"refs/changes/44/6344/4","uploader":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"createdOn":1560449549,"author":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/cmd/devfsadm/misc_link.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/cmd/ipf/lib/common/printfr.c","type":"MODIFIED","insertions":16,"deletions":-2},{"file":"usr/src/cmd/ipf/tools/Makefile.tools","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"usr/src/cmd/ipf/tools/ipf_y.y","type":"MODIFIED","insertions":17,"deletions":0},{"file":"usr/src/cmd/ipf/tools/ipmon_y.y","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/cmd/ipf/tools/ipnat_y.y","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/cmd/ipf/tools/ippool_y.y","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/cmd/ipf/tools/lexer.c","type":"MODIFIED","insertions":36,"deletions":0},{"file":"usr/src/cmd/ipf/tools/lexer.h","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"usr/src/uts/common/Makefile.files","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/common/inet/ipf/cfw.c","type":"ADDED","insertions":642,"deletions":0},{"file":"usr/src/uts/common/inet/ipf/fil.c","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"usr/src/uts/common/inet/ipf/ip_fil_solaris.c","type":"MODIFIED","insertions":44,"deletions":-1},{"file":"usr/src/uts/common/inet/ipf/ip_log.c","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/inet/ipf/ip_state.c","type":"MODIFIED","insertions":17,"deletions":-2},{"file":"usr/src/uts/common/inet/ipf/netinet/Makefile","type":"MODIFIED","insertions":3,"deletions":-4},{"file":"usr/src/uts/common/inet/ipf/netinet/ip_fil.h","type":"MODIFIED","insertions":43,"deletions":-3},{"file":"usr/src/uts/common/inet/ipf/netinet/ip_state.h","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/uts/common/inet/ipf/netinet/ipf_cfw.h","type":"ADDED","insertions":69,"deletions":0},{"file":"usr/src/uts/common/inet/ipf/netinet/ipf_stack.h","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/common/inet/ipf/solaris.c","type":"MODIFIED","insertions":7,"deletions":-2},{"file":"usr/src/uts/intel/ipf/ipf.global-objs.debug64","type":"MODIFIED","insertions":14,"deletions":-1},{"file":"usr/src/uts/sparc/ipf/ipf.global-objs.debug64","type":"MODIFIED","insertions":14,"deletions":-1}],"sizeInsertions":960,"sizeDeletions":-27},{"number":"5","revision":"38f7b1929f7dc3fc0733b5b3a1cad749db4a6b3d","parents":["3812225f415409fb9a9021dfb89e3e794b0a1e52"],"ref":"refs/changes/44/6344/5","uploader":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"createdOn":1560524814,"author":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":258,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Why throw them out?  I would have expected behavior like read(2)."},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":258,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Ahh, I see.  read(2) says:\n\n       If a read() is interrupted by a signal after it has successfully read\n       some data, it will return the number of bytes read.\n\nOkay, will fix."},{"file":"usr/src/uts/common/inet/ipf/netinet/ipf_cfw.h","line":53,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Ensures"},{"file":"usr/src/uts/common/inet/ipf/netinet/ipf_cfw.h","line":53,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Will fix."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/cmd/devfsadm/misc_link.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/cmd/ipf/lib/common/printfr.c","type":"MODIFIED","insertions":16,"deletions":-2},{"file":"usr/src/cmd/ipf/tools/Makefile.tools","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"usr/src/cmd/ipf/tools/ipf_y.y","type":"MODIFIED","insertions":17,"deletions":0},{"file":"usr/src/cmd/ipf/tools/ipmon_y.y","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/cmd/ipf/tools/ipnat_y.y","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/cmd/ipf/tools/ippool_y.y","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/cmd/ipf/tools/lexer.c","type":"MODIFIED","insertions":36,"deletions":0},{"file":"usr/src/cmd/ipf/tools/lexer.h","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"usr/src/uts/common/Makefile.files","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/common/inet/ipf/cfw.c","type":"ADDED","insertions":640,"deletions":0},{"file":"usr/src/uts/common/inet/ipf/fil.c","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"usr/src/uts/common/inet/ipf/ip_fil_solaris.c","type":"MODIFIED","insertions":44,"deletions":-1},{"file":"usr/src/uts/common/inet/ipf/ip_log.c","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/inet/ipf/ip_state.c","type":"MODIFIED","insertions":17,"deletions":-2},{"file":"usr/src/uts/common/inet/ipf/netinet/Makefile","type":"MODIFIED","insertions":3,"deletions":-4},{"file":"usr/src/uts/common/inet/ipf/netinet/ip_fil.h","type":"MODIFIED","insertions":43,"deletions":-3},{"file":"usr/src/uts/common/inet/ipf/netinet/ip_state.h","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/uts/common/inet/ipf/netinet/ipf_cfw.h","type":"ADDED","insertions":69,"deletions":0},{"file":"usr/src/uts/common/inet/ipf/netinet/ipf_stack.h","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/common/inet/ipf/solaris.c","type":"MODIFIED","insertions":7,"deletions":-2},{"file":"usr/src/uts/intel/ipf/ipf.global-objs.debug64","type":"MODIFIED","insertions":14,"deletions":-1},{"file":"usr/src/uts/sparc/ipf/ipf.global-objs.debug64","type":"MODIFIED","insertions":14,"deletions":-1}],"sizeInsertions":958,"sizeDeletions":-27},{"number":"6","revision":"d86c496e279c385b8d172779bab9627b38f07d57","parents":["4227bcffd4e1abf8a3987dbe0f649d7cc7ea4940"],"ref":"refs/changes/44/6344/6","uploader":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"createdOn":1560902106,"author":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/cmd/devfsadm/misc_link.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/cmd/ipf/lib/common/printfr.c","type":"MODIFIED","insertions":16,"deletions":-2},{"file":"usr/src/cmd/ipf/tools/Makefile.tools","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"usr/src/cmd/ipf/tools/ipf_y.y","type":"MODIFIED","insertions":17,"deletions":0},{"file":"usr/src/cmd/ipf/tools/ipmon_y.y","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/cmd/ipf/tools/ipnat_y.y","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/cmd/ipf/tools/ippool_y.y","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/cmd/ipf/tools/lexer.c","type":"MODIFIED","insertions":36,"deletions":0},{"file":"usr/src/cmd/ipf/tools/lexer.h","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"usr/src/uts/common/Makefile.files","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/common/inet/ipf/cfw.c","type":"ADDED","insertions":642,"deletions":0},{"file":"usr/src/uts/common/inet/ipf/fil.c","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"usr/src/uts/common/inet/ipf/ip_fil_solaris.c","type":"MODIFIED","insertions":44,"deletions":-1},{"file":"usr/src/uts/common/inet/ipf/ip_log.c","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/inet/ipf/ip_state.c","type":"MODIFIED","insertions":17,"deletions":-2},{"file":"usr/src/uts/common/inet/ipf/netinet/Makefile","type":"MODIFIED","insertions":3,"deletions":-4},{"file":"usr/src/uts/common/inet/ipf/netinet/ip_fil.h","type":"MODIFIED","insertions":43,"deletions":-3},{"file":"usr/src/uts/common/inet/ipf/netinet/ip_state.h","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/uts/common/inet/ipf/netinet/ipf_cfw.h","type":"ADDED","insertions":69,"deletions":0},{"file":"usr/src/uts/common/inet/ipf/netinet/ipf_stack.h","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/common/inet/ipf/solaris.c","type":"MODIFIED","insertions":7,"deletions":-2},{"file":"usr/src/uts/intel/ipf/ipf.global-objs.debug64","type":"MODIFIED","insertions":14,"deletions":-1},{"file":"usr/src/uts/sparc/ipf/ipf.global-objs.debug64","type":"MODIFIED","insertions":14,"deletions":-1}],"sizeInsertions":960,"sizeDeletions":-27},{"number":"7","revision":"32538e83a04994115506c79ea8ff33eff587138b","parents":["4227bcffd4e1abf8a3987dbe0f649d7cc7ea4940"],"ref":"refs/changes/44/6344/7","uploader":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"createdOn":1560902546,"author":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1560911097,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}}],"comments":[{"file":"usr/src/cmd/ipf/tools/lexer.c","line":462,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Can we make this say something like:\n\n    * UUID: e.g., \"2426e38c-9f63-c0b8-cfd5-9aaeaf992d42\" or its uppercase variant."},{"file":"usr/src/cmd/ipf/tools/lexer.c","line":462,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"We can, but it\u0027ll have to take more lines.  :)"},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":74,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Instead of calling it \"new\", which will eventaully be outdated, maybe just say:\n\n    * The variable below is tied into the GZ-only ipf device /dev/ipfev,"},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":74,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Doh!  Fixed."},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":305,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Should this be converted to a VERIFY3U to be safe?"},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":305,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"There\u0027s no reason not to, because this never gets called unless IFS_CFWLOG() passes on the rule, which can only happen on a gz_controlled ipf state."},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":351,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Maybe write this as a switch on fin-\u003efin_v, and return in the default case, so that this code fails more gracefully whenever another value is added?"},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":351,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Along with this, yes:\n\n\tdefault:\n\t\t/* We should never reach here, but mark it if we do. */\n\t\tDTRACE_PROBE1(ipf__cfw__frinfo__badipversion, frinfo_t *, fin);\n\t\treturn;"},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":424,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Add a default case that returns."},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":424,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Why return? There are other protocols that might happen.  We should account for them in the log.  Adding a comment though."},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":427,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Replace with a switch whose default returns."},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":427,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"THIS makes sense like the one I fixed earlier in the block case, and this will have a similar DTrace-probe fix."},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":544,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Do we also need to check user permissions here? Maybe we could require one of the privileges, like PRIV_SYS_IP_CONFIG (or some other one, if there\u0027s one more fitting)."},{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":544,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"The existing iplioctl (which calls this function) does no such thing currently, so I followed suit.  Also in /etc/security/device_policy, ipf:* is covered.\n\n/etc/security/device_policy:ipf:*\t\tread_priv_set\u003dsys_ip_config\twrite_priv_set\u003dsys_ip_config\n\nAnd the new ipfev is covered by that."},{"file":"usr/src/uts/common/inet/ipf/ip_fil_solaris.c","line":1264,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"ensure"},{"file":"usr/src/uts/common/inet/ipf/ip_fil_solaris.c","line":1264,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Fixed."},{"file":"usr/src/uts/common/inet/ipf/netinet/ipf_cfw.h","line":61,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Do we enforce this somewhere?"},{"file":"usr/src/uts/common/inet/ipf/netinet/ipf_cfw.h","line":61,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"We do not, because it\u0027s a private (Triton-only at that, this won\u0027t be getting upstreamed) interface."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/cmd/devfsadm/misc_link.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/cmd/ipf/lib/common/printfr.c","type":"MODIFIED","insertions":16,"deletions":-2},{"file":"usr/src/cmd/ipf/tools/Makefile.tools","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"usr/src/cmd/ipf/tools/ipf_y.y","type":"MODIFIED","insertions":17,"deletions":0},{"file":"usr/src/cmd/ipf/tools/ipmon_y.y","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/cmd/ipf/tools/ipnat_y.y","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/cmd/ipf/tools/ippool_y.y","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/cmd/ipf/tools/lexer.c","type":"MODIFIED","insertions":36,"deletions":0},{"file":"usr/src/cmd/ipf/tools/lexer.h","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"usr/src/uts/common/Makefile.files","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/common/inet/ipf/cfw.c","type":"ADDED","insertions":645,"deletions":0},{"file":"usr/src/uts/common/inet/ipf/fil.c","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"usr/src/uts/common/inet/ipf/ip_fil_solaris.c","type":"MODIFIED","insertions":44,"deletions":-1},{"file":"usr/src/uts/common/inet/ipf/ip_log.c","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/inet/ipf/ip_state.c","type":"MODIFIED","insertions":17,"deletions":-2},{"file":"usr/src/uts/common/inet/ipf/netinet/Makefile","type":"MODIFIED","insertions":3,"deletions":-4},{"file":"usr/src/uts/common/inet/ipf/netinet/ip_fil.h","type":"MODIFIED","insertions":43,"deletions":-3},{"file":"usr/src/uts/common/inet/ipf/netinet/ip_state.h","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/uts/common/inet/ipf/netinet/ipf_cfw.h","type":"ADDED","insertions":69,"deletions":0},{"file":"usr/src/uts/common/inet/ipf/netinet/ipf_stack.h","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/common/inet/ipf/solaris.c","type":"MODIFIED","insertions":7,"deletions":-2},{"file":"usr/src/uts/intel/ipf/ipf.global-objs.debug64","type":"MODIFIED","insertions":14,"deletions":-1},{"file":"usr/src/uts/sparc/ipf/ipf.global-objs.debug64","type":"MODIFIED","insertions":14,"deletions":-1}],"sizeInsertions":963,"sizeDeletions":-27},{"number":"8","revision":"4741ea77bf22aae36918683d59d9a930d1a0f90c","parents":["d152c784e9ec5ececac97129ea92fe6afc57078c"],"ref":"refs/changes/44/6344/8","uploader":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"createdOn":1561486903,"author":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1561498281,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1561549990,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/cmd/devfsadm/misc_link.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/cmd/ipf/lib/common/printfr.c","type":"MODIFIED","insertions":16,"deletions":-2},{"file":"usr/src/cmd/ipf/tools/Makefile.tools","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"usr/src/cmd/ipf/tools/ipf_y.y","type":"MODIFIED","insertions":17,"deletions":0},{"file":"usr/src/cmd/ipf/tools/ipmon_y.y","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/cmd/ipf/tools/ipnat_y.y","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/cmd/ipf/tools/ippool_y.y","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/cmd/ipf/tools/lexer.c","type":"MODIFIED","insertions":37,"deletions":0},{"file":"usr/src/cmd/ipf/tools/lexer.h","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"usr/src/uts/common/Makefile.files","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/common/inet/ipf/cfw.c","type":"ADDED","insertions":660,"deletions":0},{"file":"usr/src/uts/common/inet/ipf/fil.c","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"usr/src/uts/common/inet/ipf/ip_fil_solaris.c","type":"MODIFIED","insertions":44,"deletions":-1},{"file":"usr/src/uts/common/inet/ipf/ip_log.c","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/inet/ipf/ip_state.c","type":"MODIFIED","insertions":17,"deletions":-2},{"file":"usr/src/uts/common/inet/ipf/netinet/Makefile","type":"MODIFIED","insertions":3,"deletions":-4},{"file":"usr/src/uts/common/inet/ipf/netinet/ip_fil.h","type":"MODIFIED","insertions":43,"deletions":-3},{"file":"usr/src/uts/common/inet/ipf/netinet/ip_state.h","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/uts/common/inet/ipf/netinet/ipf_cfw.h","type":"ADDED","insertions":69,"deletions":0},{"file":"usr/src/uts/common/inet/ipf/netinet/ipf_stack.h","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/common/inet/ipf/solaris.c","type":"MODIFIED","insertions":7,"deletions":-2},{"file":"usr/src/uts/intel/ipf/ipf.global-objs.debug64","type":"MODIFIED","insertions":14,"deletions":-1},{"file":"usr/src/uts/sparc/ipf/ipf.global-objs.debug64","type":"MODIFIED","insertions":14,"deletions":-1}],"sizeInsertions":979,"sizeDeletions":-27},{"number":"9","revision":"314adb539cda0dd992e9f1a170d3205862edcd61","parents":["356e1b4941ba70261404f9bb0255f70891042331"],"ref":"refs/changes/44/6344/9","uploader":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"createdOn":1561578022,"author":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1561498281,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1561549990,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/cmd/devfsadm/misc_link.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/cmd/ipf/lib/common/printfr.c","type":"MODIFIED","insertions":16,"deletions":-2},{"file":"usr/src/cmd/ipf/tools/Makefile.tools","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"usr/src/cmd/ipf/tools/ipf_y.y","type":"MODIFIED","insertions":17,"deletions":0},{"file":"usr/src/cmd/ipf/tools/ipmon_y.y","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/cmd/ipf/tools/ipnat_y.y","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/cmd/ipf/tools/ippool_y.y","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/cmd/ipf/tools/lexer.c","type":"MODIFIED","insertions":37,"deletions":0},{"file":"usr/src/cmd/ipf/tools/lexer.h","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"usr/src/uts/common/Makefile.files","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/common/inet/ipf/cfw.c","type":"ADDED","insertions":660,"deletions":0},{"file":"usr/src/uts/common/inet/ipf/fil.c","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"usr/src/uts/common/inet/ipf/ip_fil_solaris.c","type":"MODIFIED","insertions":44,"deletions":-1},{"file":"usr/src/uts/common/inet/ipf/ip_log.c","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/inet/ipf/ip_state.c","type":"MODIFIED","insertions":17,"deletions":-2},{"file":"usr/src/uts/common/inet/ipf/netinet/Makefile","type":"MODIFIED","insertions":3,"deletions":-4},{"file":"usr/src/uts/common/inet/ipf/netinet/ip_fil.h","type":"MODIFIED","insertions":43,"deletions":-3},{"file":"usr/src/uts/common/inet/ipf/netinet/ip_state.h","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/uts/common/inet/ipf/netinet/ipf_cfw.h","type":"ADDED","insertions":69,"deletions":0},{"file":"usr/src/uts/common/inet/ipf/netinet/ipf_stack.h","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/common/inet/ipf/solaris.c","type":"MODIFIED","insertions":7,"deletions":-2},{"file":"usr/src/uts/intel/ipf/ipf.global-objs.debug64","type":"MODIFIED","insertions":14,"deletions":-1},{"file":"usr/src/uts/sparc/ipf/ipf.global-objs.debug64","type":"MODIFIED","insertions":14,"deletions":-1}],"sizeInsertions":979,"sizeDeletions":-27},{"number":"10","revision":"f5e034aca53cefe75e2a50c73fbc0c56bf0e3bf4","parents":["356e1b4941ba70261404f9bb0255f70891042331"],"ref":"refs/changes/44/6344/10","uploader":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"createdOn":1561578167,"author":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1561498281,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1561549990,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}}],"comments":[{"file":"usr/src/uts/common/inet/ipf/cfw.c","line":434,"reviewer":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},"message":"nit: remove extra white space"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/cmd/devfsadm/misc_link.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/cmd/ipf/lib/common/printfr.c","type":"MODIFIED","insertions":16,"deletions":-2},{"file":"usr/src/cmd/ipf/tools/Makefile.tools","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"usr/src/cmd/ipf/tools/ipf_y.y","type":"MODIFIED","insertions":17,"deletions":0},{"file":"usr/src/cmd/ipf/tools/ipmon_y.y","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/cmd/ipf/tools/ipnat_y.y","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/cmd/ipf/tools/ippool_y.y","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/cmd/ipf/tools/lexer.c","type":"MODIFIED","insertions":37,"deletions":0},{"file":"usr/src/cmd/ipf/tools/lexer.h","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"usr/src/uts/common/Makefile.files","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/common/inet/ipf/cfw.c","type":"ADDED","insertions":660,"deletions":0},{"file":"usr/src/uts/common/inet/ipf/fil.c","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"usr/src/uts/common/inet/ipf/ip_fil_solaris.c","type":"MODIFIED","insertions":44,"deletions":-1},{"file":"usr/src/uts/common/inet/ipf/ip_log.c","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/inet/ipf/ip_state.c","type":"MODIFIED","insertions":17,"deletions":-2},{"file":"usr/src/uts/common/inet/ipf/netinet/Makefile","type":"MODIFIED","insertions":3,"deletions":-4},{"file":"usr/src/uts/common/inet/ipf/netinet/ip_fil.h","type":"MODIFIED","insertions":43,"deletions":-3},{"file":"usr/src/uts/common/inet/ipf/netinet/ip_state.h","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/uts/common/inet/ipf/netinet/ipf_cfw.h","type":"ADDED","insertions":69,"deletions":0},{"file":"usr/src/uts/common/inet/ipf/netinet/ipf_stack.h","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/common/inet/ipf/solaris.c","type":"MODIFIED","insertions":7,"deletions":-2},{"file":"usr/src/uts/intel/ipf/ipf.global-objs.debug64","type":"MODIFIED","insertions":14,"deletions":-1},{"file":"usr/src/uts/sparc/ipf/ipf.global-objs.debug64","type":"MODIFIED","insertions":14,"deletions":-1}],"sizeInsertions":979,"sizeDeletions":-27},{"number":"11","revision":"8f0b36a4a93f47820063b8268067adf02813a1fb","parents":["d52326b14627b369debbeb1c820b08a811328317"],"ref":"refs/changes/44/6344/11","uploader":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"createdOn":1561664415,"author":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1561664931,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1561665655,"by":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1561665641,"by":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1561664635,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/cmd/devfsadm/misc_link.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/cmd/ipf/lib/common/printfr.c","type":"MODIFIED","insertions":16,"deletions":-2},{"file":"usr/src/cmd/ipf/tools/Makefile.tools","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"usr/src/cmd/ipf/tools/ipf_y.y","type":"MODIFIED","insertions":17,"deletions":0},{"file":"usr/src/cmd/ipf/tools/ipmon_y.y","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/cmd/ipf/tools/ipnat_y.y","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/cmd/ipf/tools/ippool_y.y","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/cmd/ipf/tools/lexer.c","type":"MODIFIED","insertions":37,"deletions":0},{"file":"usr/src/cmd/ipf/tools/lexer.h","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"usr/src/uts/common/Makefile.files","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/common/inet/ipf/cfw.c","type":"ADDED","insertions":659,"deletions":0},{"file":"usr/src/uts/common/inet/ipf/fil.c","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"usr/src/uts/common/inet/ipf/ip_fil_solaris.c","type":"MODIFIED","insertions":44,"deletions":-1},{"file":"usr/src/uts/common/inet/ipf/ip_log.c","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/inet/ipf/ip_state.c","type":"MODIFIED","insertions":17,"deletions":-2},{"file":"usr/src/uts/common/inet/ipf/netinet/Makefile","type":"MODIFIED","insertions":3,"deletions":-4},{"file":"usr/src/uts/common/inet/ipf/netinet/ip_fil.h","type":"MODIFIED","insertions":43,"deletions":-3},{"file":"usr/src/uts/common/inet/ipf/netinet/ip_state.h","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/uts/common/inet/ipf/netinet/ipf_cfw.h","type":"ADDED","insertions":69,"deletions":0},{"file":"usr/src/uts/common/inet/ipf/netinet/ipf_stack.h","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/common/inet/ipf/solaris.c","type":"MODIFIED","insertions":7,"deletions":-2},{"file":"usr/src/uts/intel/ipf/ipf.global-objs.debug64","type":"MODIFIED","insertions":14,"deletions":-1},{"file":"usr/src/uts/sparc/ipf/ipf.global-objs.debug64","type":"MODIFIED","insertions":14,"deletions":-1}],"sizeInsertions":978,"sizeDeletions":-27},{"number":"12","revision":"c0834af5f903a2f16c6ad3a4a8946d7f40edda4b","parents":["d52326b14627b369debbeb1c820b08a811328317"],"ref":"refs/changes/44/6344/12","uploader":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"createdOn":1561665905,"author":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1561664931,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1561665655,"by":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1561665641,"by":{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"}},{"type":"SUBM","value":"1","grantedOn":1561667082,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1561664635,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":12,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/cmd/devfsadm/misc_link.c","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/cmd/ipf/lib/common/printfr.c","type":"MODIFIED","insertions":16,"deletions":-2},{"file":"usr/src/cmd/ipf/tools/Makefile.tools","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"usr/src/cmd/ipf/tools/ipf_y.y","type":"MODIFIED","insertions":17,"deletions":0},{"file":"usr/src/cmd/ipf/tools/ipmon_y.y","type":"MODIFIED","insertions":5,"deletions":0},{"file":"usr/src/cmd/ipf/tools/ipnat_y.y","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/cmd/ipf/tools/ippool_y.y","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/cmd/ipf/tools/lexer.c","type":"MODIFIED","insertions":37,"deletions":0},{"file":"usr/src/cmd/ipf/tools/lexer.h","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"usr/src/uts/common/Makefile.files","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/common/inet/ipf/cfw.c","type":"ADDED","insertions":659,"deletions":0},{"file":"usr/src/uts/common/inet/ipf/fil.c","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"usr/src/uts/common/inet/ipf/ip_fil_solaris.c","type":"MODIFIED","insertions":44,"deletions":-1},{"file":"usr/src/uts/common/inet/ipf/ip_log.c","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/inet/ipf/ip_state.c","type":"MODIFIED","insertions":17,"deletions":-2},{"file":"usr/src/uts/common/inet/ipf/netinet/Makefile","type":"MODIFIED","insertions":3,"deletions":-4},{"file":"usr/src/uts/common/inet/ipf/netinet/ip_fil.h","type":"MODIFIED","insertions":43,"deletions":-3},{"file":"usr/src/uts/common/inet/ipf/netinet/ip_state.h","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/uts/common/inet/ipf/netinet/ipf_cfw.h","type":"ADDED","insertions":69,"deletions":0},{"file":"usr/src/uts/common/inet/ipf/netinet/ipf_stack.h","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/common/inet/ipf/solaris.c","type":"MODIFIED","insertions":7,"deletions":-2},{"file":"usr/src/uts/intel/ipf/ipf.global-objs.debug64","type":"MODIFIED","insertions":14,"deletions":-1},{"file":"usr/src/uts/sparc/ipf/ipf.global-objs.debug64","type":"MODIFIED","insertions":14,"deletions":-1}],"sizeInsertions":978,"sizeDeletions":-27}],"allReviewers":[{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},{"name":"Michael Zeller","email":"mike.zeller@joyent.com","username":"papertigers"},{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}]}