From 72d490b9e92a363e0c18953d1b8b6c16eb0800fe Mon Sep 17 00:00:00 2001
From: Pedro Palazon Candel <pedro@joyent.com>
Date: Tue, 14 Mar 2017 12:18:02 +0100
Subject: [PATCH] TOOLS-1719 sdcadm create should fail gracefully if a service
 hasn't got image uuid

---
 lib/cli/do_create.js | 10 ++++++++++
 1 file changed, 10 insertions(+)

diff --git a/lib/cli/do_create.js b/lib/cli/do_create.js
index 00e6a54..6f3e3de 100644
--- a/lib/cli/do_create.js
+++ b/lib/cli/do_create.js
@@ -111,6 +111,16 @@ Create.prototype.execute = function cExecute(opts, args, cb) {
                 change.image = svcFromName[service].params.image_uuid;
             }
 
+            /*
+             * TOOLS-1719: Fail graceful if service doesn't have an associated
+             * image, instead of downloading the latest available image for
+             * service
+             */
+            if (!change.image) {
+                return next(new errors.ValidationError(util.format(
+                    'Missing image_uuid for service %s in SAPI.', service)));
+            }
+
             if (!opts.server) {
                 return next(new errors.UsageError(
                     'Must specify server uuid or hostname'));
-- 
2.21.0

