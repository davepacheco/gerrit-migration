{"project":"joyent/smartos-live","branch":"master","id":"I996204040323c47d17fb010b9535bacc4f4f78e8","number":"5025","subject":"OS-7338 vmadm support for flexible disk space Reviewed by: Pedro Palazón Candel \u003cpedro@joyent.com\u003e Reviewed by: Dylan Yep \u003cdylan.yep@joyent.com\u003e Approved by: Dylan Yep \u003cdylan.yep@joyent.com\u003e","owner":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"url":"https://cr.joyent.us/5025","commitMessage":"OS-7338 vmadm support for flexible disk space\nReviewed by: Pedro Palazón Candel \u003cpedro@joyent.com\u003e\nReviewed by: Dylan Yep \u003cdylan.yep@joyent.com\u003e\nApproved by: Dylan Yep \u003cdylan.yep@joyent.com\u003e\n","createdOn":1541204483,"lastUpdated":1541613685,"open":false,"status":"MERGED","comments":[{"timestamp":1541204483,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Uploaded patch set 1."},{"timestamp":1541204530,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1541306401,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Uploaded patch set 2."},{"timestamp":1541306452,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1541306722,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 2:\n\nIn the first round I forgot to update the man page.  That led me to reconsider specifying flexible_disk_size in GiB. It is more important that it aligns with disks.*.size (MiB) than quota (GiB), so I\u0027ve changed it to MiB.\n\nAlso, added tests to verify that flexible_disk_size is ignored by other brands.  This is what inspired changes to the test_cases array structure and addition of checkProps.  Now test cases are more flexible in that they can check arbitrary properties after each create and update."},{"timestamp":1541432941,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 2:\n\n(1 comment)\n\nLooks fine but for a callback that I think it\u0027s being called outside the scope it should."},{"timestamp":1541435042,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1541440914,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Uploaded patch set 3."},{"timestamp":1541440961,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1541447476,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1541461549,"reviewer":{"name":"Dylan Yep","email":"dyep49@gmail.com","username":"dyep49"},"message":"Patch Set 3:\n\n(2 comments)"},{"timestamp":1541536959,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Uploaded patch set 4."},{"timestamp":1541536968,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 3:\n\n(2 comments)"},{"timestamp":1541537008,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1541594780,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 4: Code-Review+1"},{"timestamp":1541611469,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 4:\n\nticket updated with test note"},{"timestamp":1541611616,"reviewer":{"name":"Dylan Yep","email":"dyep49@gmail.com","username":"dyep49"},"message":"Patch Set 4: Code-Review+1"},{"timestamp":1541612226,"reviewer":{"name":"Dylan Yep","email":"dyep49@gmail.com","username":"dyep49"},"message":"Patch Set 4: Integration-Approval+1"},{"timestamp":1541612284,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 5: Patch Set 4 was rebased"},{"timestamp":1541612334,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5:\n\n\"make check\" passed ok"},{"timestamp":1541612782,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 6: Commit message was updated."},{"timestamp":1541613685,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Mike Gerdts"}],"currentPatchSet":{"number":"6","revision":"6927a12fec8a30bb041d5c79906d884d282c0dfe","parents":["b3de0c4aaad4016b8a1366b87111f540ff9488d9"],"ref":"refs/changes/25/5025/6","uploader":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"createdOn":1541612782,"author":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1541537008,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1541594780,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1541611616,"by":{"name":"Dylan Yep","email":"dyep49@gmail.com","username":"dyep49"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1541612226,"by":{"name":"Dylan Yep","email":"dyep49@gmail.com","username":"dyep49"}},{"type":"SUBM","value":"1","grantedOn":1541613685,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"src/vm/man/vmadm.1m.md","type":"MODIFIED","insertions":15,"deletions":0},{"file":"src/vm/node_modules/VM.js","type":"MODIFIED","insertions":63,"deletions":-22},{"file":"src/vm/node_modules/proptable.js","type":"MODIFIED","insertions":10,"deletions":0},{"file":"src/vm/tests/test-quota.js","type":"MODIFIED","insertions":164,"deletions":-86}],"sizeInsertions":252,"sizeDeletions":-108},"patchSets":[{"number":"1","revision":"57b0302f96229fa30e670d2e06757bdd4658dee1","parents":["e352e7a16607cd868650f7593022e99509998f22"],"ref":"refs/changes/25/5025/1","uploader":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"createdOn":1541204483,"author":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1541204530,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/vm/node_modules/VM.js","type":"MODIFIED","insertions":57,"deletions":-21},{"file":"src/vm/node_modules/proptable.js","type":"MODIFIED","insertions":10,"deletions":0},{"file":"src/vm/tests/test-quota.js","type":"MODIFIED","insertions":38,"deletions":-10}],"sizeInsertions":105,"sizeDeletions":-31},{"number":"2","revision":"8da4b65ad48bd399e84397810b50a0a02d85385b","parents":["e352e7a16607cd868650f7593022e99509998f22"],"ref":"refs/changes/25/5025/2","uploader":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"createdOn":1541306401,"author":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1541306452,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"src/vm/tests/test-quota.js","line":328,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Shouldn\u0027t this callback call be within the VM.load block?"},{"file":"src/vm/tests/test-quota.js","line":328,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Oops, yeah.  Will fix."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/vm/man/vmadm.1m.md","type":"MODIFIED","insertions":15,"deletions":0},{"file":"src/vm/node_modules/VM.js","type":"MODIFIED","insertions":62,"deletions":-22},{"file":"src/vm/node_modules/proptable.js","type":"MODIFIED","insertions":10,"deletions":0},{"file":"src/vm/tests/test-quota.js","type":"MODIFIED","insertions":164,"deletions":-86}],"sizeInsertions":251,"sizeDeletions":-108},{"number":"3","revision":"2c51a7b192204ea553d4311aa02c8ee6ddebbafe","parents":["e352e7a16607cd868650f7593022e99509998f22"],"ref":"refs/changes/25/5025/3","uploader":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"createdOn":1541440914,"author":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1541440961,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1541447476,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"comments":[{"file":"src/vm/node_modules/VM.js","line":1470,"reviewer":{"name":"Dylan Yep","email":"dyep49@gmail.com","username":"dyep49"},"message":"Assert that opts.flexible_disk_size is an optionalNumber?"},{"file":"src/vm/node_modules/VM.js","line":1470,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Done"},{"file":"src/vm/node_modules/VM.js","line":1566,"reviewer":{"name":"Dylan Yep","email":"dyep49@gmail.com","username":"dyep49"},"message":"Maybe !\u003d\u003d just to be safe"},{"file":"src/vm/node_modules/VM.js","line":1566,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"These fingers are so hard to retrain!"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/vm/man/vmadm.1m.md","type":"MODIFIED","insertions":15,"deletions":0},{"file":"src/vm/node_modules/VM.js","type":"MODIFIED","insertions":62,"deletions":-22},{"file":"src/vm/node_modules/proptable.js","type":"MODIFIED","insertions":10,"deletions":0},{"file":"src/vm/tests/test-quota.js","type":"MODIFIED","insertions":164,"deletions":-86}],"sizeInsertions":251,"sizeDeletions":-108},{"number":"4","revision":"996204040323c47d17fb010b9535bacc4f4f78e8","parents":["e352e7a16607cd868650f7593022e99509998f22"],"ref":"refs/changes/25/5025/4","uploader":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"createdOn":1541536959,"author":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1541537008,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1541594780,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1541611616,"by":{"name":"Dylan Yep","email":"dyep49@gmail.com","username":"dyep49"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1541612226,"by":{"name":"Dylan Yep","email":"dyep49@gmail.com","username":"dyep49"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/vm/man/vmadm.1m.md","type":"MODIFIED","insertions":15,"deletions":0},{"file":"src/vm/node_modules/VM.js","type":"MODIFIED","insertions":63,"deletions":-22},{"file":"src/vm/node_modules/proptable.js","type":"MODIFIED","insertions":10,"deletions":0},{"file":"src/vm/tests/test-quota.js","type":"MODIFIED","insertions":164,"deletions":-86}],"sizeInsertions":252,"sizeDeletions":-108},{"number":"5","revision":"7b16d41f1e41adc6bb05fb3751d6dedbbc664fb3","parents":["b3de0c4aaad4016b8a1366b87111f540ff9488d9"],"ref":"refs/changes/25/5025/5","uploader":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"createdOn":1541612284,"author":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1541537008,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1541594780,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1541611616,"by":{"name":"Dylan Yep","email":"dyep49@gmail.com","username":"dyep49"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1541612226,"by":{"name":"Dylan Yep","email":"dyep49@gmail.com","username":"dyep49"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/vm/man/vmadm.1m.md","type":"MODIFIED","insertions":15,"deletions":0},{"file":"src/vm/node_modules/VM.js","type":"MODIFIED","insertions":63,"deletions":-22},{"file":"src/vm/node_modules/proptable.js","type":"MODIFIED","insertions":10,"deletions":0},{"file":"src/vm/tests/test-quota.js","type":"MODIFIED","insertions":164,"deletions":-86}],"sizeInsertions":252,"sizeDeletions":-108},{"number":"6","revision":"6927a12fec8a30bb041d5c79906d884d282c0dfe","parents":["b3de0c4aaad4016b8a1366b87111f540ff9488d9"],"ref":"refs/changes/25/5025/6","uploader":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"createdOn":1541612782,"author":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1541537008,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1541594780,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"SUBM","value":"1","grantedOn":1541613685,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1541611616,"by":{"name":"Dylan Yep","email":"dyep49@gmail.com","username":"dyep49"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1541612226,"by":{"name":"Dylan Yep","email":"dyep49@gmail.com","username":"dyep49"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"src/vm/man/vmadm.1m.md","type":"MODIFIED","insertions":15,"deletions":0},{"file":"src/vm/node_modules/VM.js","type":"MODIFIED","insertions":63,"deletions":-22},{"file":"src/vm/node_modules/proptable.js","type":"MODIFIED","insertions":10,"deletions":0},{"file":"src/vm/tests/test-quota.js","type":"MODIFIED","insertions":164,"deletions":-86}],"sizeInsertions":252,"sizeDeletions":-108}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},{"name":"Dylan Yep","email":"dyep49@gmail.com","username":"dyep49"},{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"}]}