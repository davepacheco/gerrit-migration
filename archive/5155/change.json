{"project":"joyent/illumos-joyent","branch":"master","id":"I4cd287abcc9b56a05a2b0747c4321cede4163227","number":"5155","subject":"OS-7408 want native libvmm Reviewed by: John Levon \u003cjohn.levon@joyent.com\u003e Reviewed by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e Approved by: John Levon \u003cjohn.levon@joyent.com\u003e","owner":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"url":"https://cr.joyent.us/5155","commitMessage":"OS-7408 want native libvmm\nReviewed by: John Levon \u003cjohn.levon@joyent.com\u003e\nReviewed by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e\nApproved by: John Levon \u003cjohn.levon@joyent.com\u003e\n","createdOn":1543423476,"lastUpdated":1545309617,"open":false,"status":"MERGED","comments":[{"timestamp":1543423476,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Uploaded patch set 1."},{"timestamp":1543424001,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Uploaded patch set 2."},{"timestamp":1543512455,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 2:\n\n(17 comments)"},{"timestamp":1543590283,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Patch Set 3: Patch Set 2 was rebased"},{"timestamp":1543837397,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Patch Set 4: Patch Set 3 was rebased"},{"timestamp":1543849101,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Uploaded patch set 5."},{"timestamp":1543849138,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Patch Set 5:\n\n(16 comments)"},{"timestamp":1543849201,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Uploaded patch set 6."},{"timestamp":1543849210,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1543850238,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 6:\n\n(5 comments)"},{"timestamp":1544023621,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Uploaded patch set 7."},{"timestamp":1544023646,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Patch Set 7:\n\n(3 comments)"},{"timestamp":1544024473,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 7: Code-Review+1"},{"timestamp":1544024494,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Uploaded patch set 8."},{"timestamp":1544024560,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 8: Code-Review+1"},{"timestamp":1544030324,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Patch Set 9: Patch Set 8 was rebased"},{"timestamp":1544096128,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Patch Set 10: Patch Set 9 was rebased"},{"timestamp":1544108014,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Uploaded patch set 11."},{"timestamp":1544108093,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Patch Set 12: Patch Set 11 was rebased"},{"timestamp":1544618971,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 12:\n\n(1 comment)"},{"timestamp":1544619047,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Uploaded patch set 13."},{"timestamp":1544627432,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Uploaded patch set 14."},{"timestamp":1544627635,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 14: Code-Review+1"},{"timestamp":1544713216,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 14:\n\n(6 comments)"},{"timestamp":1544714511,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 14:\n\n(1 comment)"},{"timestamp":1544808824,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Uploaded patch set 15."},{"timestamp":1544808973,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Patch Set 15:\n\n(5 comments)"},{"timestamp":1544811019,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 15:\n\n(1 comment)"},{"timestamp":1545046185,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Uploaded patch set 16."},{"timestamp":1545053631,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Patch Set 14:\n\n(1 comment)"},{"timestamp":1545056150,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 16: Code-Review+1"},{"timestamp":1545058592,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 16: Code-Review+1"},{"timestamp":1545148663,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 16: Integration-Approval+1"},{"timestamp":1545303913,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Uploaded patch set 17: Commit message was updated."},{"timestamp":1545304207,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Patch Set 18: Patch Set 17 was rebased"},{"timestamp":1545309617,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Hans Rosenfeld"}],"currentPatchSet":{"number":"18","revision":"7acaa8e37be75212e7823e35fc1b9a4cc61f601b","parents":["2319d4707150167d5bc9a32748d310d0c5e7a022"],"ref":"refs/changes/55/5155/18","uploader":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"createdOn":1545304207,"author":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1545056150,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1545058592,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1545148663,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}},{"type":"SUBM","value":"1","grantedOn":1545309617,"by":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/lib/Makefile","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/lib/libvmm/Makefile","type":"ADDED","insertions":57,"deletions":0},{"file":"usr/src/lib/libvmm/libvmm.c","type":"ADDED","insertions":841,"deletions":0},{"file":"usr/src/lib/libvmm/libvmm.h","type":"ADDED","insertions":122,"deletions":0},{"file":"usr/src/lib/libvmm/mapfile-vers","type":"ADDED","insertions":60,"deletions":0}],"sizeInsertions":1085,"sizeDeletions":-1},"patchSets":[{"number":"1","revision":"d9166692e67d0fc7077a48a66254ee3ba2e9242a","parents":["bf5c6ea730f6fbfa7294ce41d6289e44c36be059"],"ref":"refs/changes/55/5155/1","uploader":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"createdOn":1543423476,"author":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/lib/Makefile","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/lib/libvmm/Makefile","type":"ADDED","insertions":42,"deletions":0},{"file":"usr/src/lib/libvmm/Makefile.com","type":"ADDED","insertions":50,"deletions":0},{"file":"usr/src/lib/libvmm/amd64/Makefile","type":"ADDED","insertions":21,"deletions":0},{"file":"usr/src/lib/libvmm/common/libvmm.c","type":"ADDED","insertions":813,"deletions":0},{"file":"usr/src/lib/libvmm/common/libvmm.h","type":"ADDED","insertions":120,"deletions":0},{"file":"usr/src/lib/libvmm/common/llib-lvmm","type":"ADDED","insertions":2,"deletions":0},{"file":"usr/src/lib/libvmm/common/mapfile-vers","type":"ADDED","insertions":60,"deletions":0}],"sizeInsertions":1113,"sizeDeletions":-1},{"number":"2","revision":"73f261f501a8af4a4aac632290ac20b77b2903e0","parents":["bf5c6ea730f6fbfa7294ce41d6289e44c36be059"],"ref":"refs/changes/55/5155/2","uploader":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"createdOn":1543424001,"author":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/lib/libvmm/Makefile.com","line":30,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"If this is really a \"common\" file, it shouldn\u0027t include /i86pc, that should be in amd64/Makefile.\n\nAlso, why isn\u0027t this using +\u003d instead of setting CPPFLAGS directly?"},{"file":"usr/src/lib/libvmm/Makefile.com","line":30,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"I plan to get rid of common/ and amd64/ and put all of it directly in usr/src/lib/libvmm. It\u0027s amd64-only, and if it\u0027s ever going to be ported to a different platform it can be moved again.\n\nI\u0027ll do that as a separate patch after we\u0027re done with actual code review as I\u0027m not sure how well gerrit will handle the rename."},{"file":"usr/src/lib/libvmm/Makefile.com","line":30,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"OK sure. Please fix up the +\u003d thing though."},{"file":"usr/src/lib/libvmm/Makefile.com","line":30,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"There is an issue with ordering the various include paths.\n\nJust using +\u003d will result in a -I order that won\u0027t built correctly as for this library we\u0027ll have to include the freebsd compat/contrib headers first. Thats why I use a direct assignment and pull in CPPFLAGS.master at the appropriate place.\n\nI\u0027ll add a comment to the Makefile to explain it."},{"file":"usr/src/lib/libvmm/amd64/Makefile","line":21,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"I don\u0027t think we should be installing compilation symlinks (not that it matters for smartos of course)"},{"file":"usr/src/lib/libvmm/amd64/Makefile","line":21,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Done"},{"file":"usr/src/lib/libvmm/common/libvmm.c","line":85,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Why are we ignoring this error ?\nAlso, what if we happen to use this library while certain VCPUs aren\u0027t active? Shouldn\u0027t we be asking for all CPUs?"},{"file":"usr/src/lib/libvmm/common/libvmm.c","line":85,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"I thought it can\u0027t really fail (vmmapi should ensure that), but I\u0027ve changed it to check it. It\u0027s cheap and defensive.\n\nRegarding \"active\", if I read the code right all vCPUs configured by the userspace process are always in the active set, even when they are also in the suspended set, debug set, or any of the other set. They are never removed from the set."},{"file":"usr/src/lib/libvmm/common/libvmm.c","line":103,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"The implication being, if the user of the library keels over, the VM stays suspended?"},{"file":"usr/src/lib/libvmm/common/libvmm.c","line":103,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Is your question related to the ignoring of the vm_resume_cpu() result?\n\nIn general, if the user of the library (say, mdb) has the VM suspended and then receives a SIGKILL, the VM will stay suspended.\n\nThinking about this code it occured to me that it pretty much prevents two processes controlling the same VM at the same time. If one had the VM suspended and the other closes its handle on the VM, it would resume the VM without the other knowing. So I have removed this call to vm_resume_cpu(), any user of this library will now always have to make sure it resumes all vCPUs if it suspended any."},{"file":"usr/src/lib/libvmm/common/libvmm.c","line":103,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"My point was really more that if a library user crashes, we don\u0027t \"clean up\". Ultimately the only way to fix that is kernel-side, so I think not automatically resuming is the best thing we can do for now."},{"file":"usr/src/lib/libvmm/common/libvmm.c","line":103,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Done"},{"file":"usr/src/lib/libvmm/common/libvmm.c","line":110,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"We\u0027re losing error handling here; I think this should pass back the error code to the caller, and let it decide to handle ENOENT as needed."},{"file":"usr/src/lib/libvmm/common/libvmm.c","line":110,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"We can still do that as the actual error is in errno, set by vm_mmap_getnext(), vm_get_memseg(), or malloc()."},{"file":"usr/src/lib/libvmm/common/libvmm.c","line":110,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Yep, I misread the underlying code."},{"file":"usr/src/lib/libvmm/common/libvmm.c","line":128,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"worth a comment maybe?"},{"file":"usr/src/lib/libvmm/common/libvmm.c","line":128,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Done"},{"file":"usr/src/lib/libvmm/common/libvmm.c","line":145,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"When can only one of these be true??"},{"file":"usr/src/lib/libvmm/common/libvmm.c","line":145,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Never. Perhaps I should check just one and assert the other?"},{"file":"usr/src/lib/libvmm/common/libvmm.c","line":145,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Please."},{"file":"usr/src/lib/libvmm/common/libvmm.c","line":145,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Done"},{"file":"usr/src/lib/libvmm/common/libvmm.c","line":148,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"if it\u0027s just an integer, why not return the err directly?\nMore generally true below. If we want to mimic ioctl/libvmm, might be useful to have a comment on error value expectations."},{"file":"usr/src/lib/libvmm/common/libvmm.c","line":148,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Just a matter of taste, I guess. I think it\u0027s sane for a library to stick to the scheme of indicating errno through 0, -1, or NULL depending on what the returned value means, and returning the actual error code in errno."},{"file":"usr/src/lib/libvmm/common/libvmm.c","line":148,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"That\u0027s fine, I guess, as long as it\u0027s consistent."},{"file":"usr/src/lib/libvmm/common/libvmm.c","line":340,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Thanks for this comment; can we have the same in kdi_regs.h please?"},{"file":"usr/src/lib/libvmm/common/libvmm.c","line":340,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Done"},{"file":"usr/src/lib/libvmm/common/libvmm.c","line":381,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"ditto?"},{"file":"usr/src/lib/libvmm/common/libvmm.c","line":381,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Done"},{"file":"usr/src/lib/libvmm/common/libvmm.c","line":405,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"ditto"},{"file":"usr/src/lib/libvmm/common/libvmm.c","line":405,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Done"},{"file":"usr/src/lib/libvmm/common/libvmm.c","line":420,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"the callers are expecting this routine to have set errno"},{"file":"usr/src/lib/libvmm/common/libvmm.c","line":420,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Done"},{"file":"usr/src/lib/libvmm/common/libvmm.c","line":433,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"why even have this goto"},{"file":"usr/src/lib/libvmm/common/libvmm.c","line":433,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Does it make more sense now that I set errno there, too?"},{"file":"usr/src/lib/libvmm/common/libvmm.c","line":437,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"ditto re errno"},{"file":"usr/src/lib/libvmm/common/libvmm.c","line":437,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Done"},{"file":"usr/src/lib/libvmm/common/libvmm.c","line":710,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"\"guest physical\" ?"},{"file":"usr/src/lib/libvmm/common/libvmm.c","line":710,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Done"},{"file":"usr/src/lib/libvmm/common/libvmm.h","line":19,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Can remove this comment"},{"file":"usr/src/lib/libvmm/common/libvmm.h","line":19,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Done"},{"file":"usr/src/lib/libvmm/common/llib-lvmm","line":1,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"We shouldn\u0027t be introducing new lint libraries I think."},{"file":"usr/src/lib/libvmm/common/llib-lvmm","line":1,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Done. Went even further and removed all traces of lint."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/lib/Makefile","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/lib/libvmm/Makefile","type":"ADDED","insertions":42,"deletions":0},{"file":"usr/src/lib/libvmm/Makefile.com","type":"ADDED","insertions":50,"deletions":0},{"file":"usr/src/lib/libvmm/amd64/Makefile","type":"ADDED","insertions":21,"deletions":0},{"file":"usr/src/lib/libvmm/common/libvmm.c","type":"ADDED","insertions":813,"deletions":0},{"file":"usr/src/lib/libvmm/common/libvmm.h","type":"ADDED","insertions":120,"deletions":0},{"file":"usr/src/lib/libvmm/common/llib-lvmm","type":"ADDED","insertions":2,"deletions":0},{"file":"usr/src/lib/libvmm/common/mapfile-vers","type":"ADDED","insertions":60,"deletions":0}],"sizeInsertions":1113,"sizeDeletions":-1},{"number":"3","revision":"87481880cd401bc26dbd0e61ddccabfc19c4734a","parents":["dcffc8b9fb60f3cc83c347d1dfcffbaeb2c7c891"],"ref":"refs/changes/55/5155/3","uploader":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"createdOn":1543590283,"author":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"isDraft":false,"kind":"TRIVIAL_REBASE","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/lib/Makefile","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/lib/libvmm/Makefile","type":"ADDED","insertions":42,"deletions":0},{"file":"usr/src/lib/libvmm/Makefile.com","type":"ADDED","insertions":50,"deletions":0},{"file":"usr/src/lib/libvmm/amd64/Makefile","type":"ADDED","insertions":21,"deletions":0},{"file":"usr/src/lib/libvmm/common/libvmm.c","type":"ADDED","insertions":813,"deletions":0},{"file":"usr/src/lib/libvmm/common/libvmm.h","type":"ADDED","insertions":120,"deletions":0},{"file":"usr/src/lib/libvmm/common/llib-lvmm","type":"ADDED","insertions":2,"deletions":0},{"file":"usr/src/lib/libvmm/common/mapfile-vers","type":"ADDED","insertions":60,"deletions":0}],"sizeInsertions":1113,"sizeDeletions":-1},{"number":"4","revision":"c6cd43be452b53b566ddcb7b81907f621a7988cb","parents":["a1f232dd615191ebaffb0079e46586326b61b23e"],"ref":"refs/changes/55/5155/4","uploader":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"createdOn":1543837397,"author":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"isDraft":false,"kind":"TRIVIAL_REBASE","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/lib/Makefile","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/lib/libvmm/Makefile","type":"ADDED","insertions":42,"deletions":0},{"file":"usr/src/lib/libvmm/Makefile.com","type":"ADDED","insertions":50,"deletions":0},{"file":"usr/src/lib/libvmm/amd64/Makefile","type":"ADDED","insertions":21,"deletions":0},{"file":"usr/src/lib/libvmm/common/libvmm.c","type":"ADDED","insertions":813,"deletions":0},{"file":"usr/src/lib/libvmm/common/libvmm.h","type":"ADDED","insertions":120,"deletions":0},{"file":"usr/src/lib/libvmm/common/llib-lvmm","type":"ADDED","insertions":2,"deletions":0},{"file":"usr/src/lib/libvmm/common/mapfile-vers","type":"ADDED","insertions":60,"deletions":0}],"sizeInsertions":1113,"sizeDeletions":-1},{"number":"5","revision":"c7160cfce3aa66f1d3b0c80ad723a817f4728499","parents":["a1f232dd615191ebaffb0079e46586326b61b23e"],"ref":"refs/changes/55/5155/5","uploader":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"createdOn":1543849101,"author":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/lib/Makefile","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/lib/libvmm/Makefile","type":"ADDED","insertions":41,"deletions":0},{"file":"usr/src/lib/libvmm/Makefile.com","type":"ADDED","insertions":46,"deletions":0},{"file":"usr/src/lib/libvmm/amd64/Makefile","type":"ADDED","insertions":21,"deletions":0},{"file":"usr/src/lib/libvmm/common/libvmm.c","type":"ADDED","insertions":824,"deletions":0},{"file":"usr/src/lib/libvmm/common/libvmm.h","type":"ADDED","insertions":122,"deletions":0},{"file":"usr/src/lib/libvmm/common/llib-lvmm","type":"ADDED","insertions":2,"deletions":0},{"file":"usr/src/lib/libvmm/common/mapfile-vers","type":"ADDED","insertions":60,"deletions":0},{"file":"usr/src/uts/intel/amd64/sys/kdi_regs.h","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/intel/ia32/sys/kdi_regs.h","type":"MODIFIED","insertions":2,"deletions":0}],"sizeInsertions":1124,"sizeDeletions":-1},{"number":"6","revision":"9ee078d47fd0fcd75e774208e7b24a059d3c6b30","parents":["a1f232dd615191ebaffb0079e46586326b61b23e"],"ref":"refs/changes/55/5155/6","uploader":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"createdOn":1543849201,"author":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/lib/Makefile","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/lib/libvmm/Makefile","type":"ADDED","insertions":41,"deletions":0},{"file":"usr/src/lib/libvmm/Makefile.com","type":"ADDED","insertions":46,"deletions":0},{"file":"usr/src/lib/libvmm/amd64/Makefile","type":"ADDED","insertions":21,"deletions":0},{"file":"usr/src/lib/libvmm/common/libvmm.c","type":"ADDED","insertions":824,"deletions":0},{"file":"usr/src/lib/libvmm/common/libvmm.h","type":"ADDED","insertions":122,"deletions":0},{"file":"usr/src/lib/libvmm/common/llib-lvmm","type":"ADDED","insertions":2,"deletions":0},{"file":"usr/src/lib/libvmm/common/mapfile-vers","type":"ADDED","insertions":60,"deletions":0},{"file":"usr/src/uts/intel/amd64/sys/kdi_regs.h","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/intel/ia32/sys/kdi_regs.h","type":"MODIFIED","insertions":2,"deletions":0}],"sizeInsertions":1124,"sizeDeletions":-1},{"number":"7","revision":"48b79a0bb4cc3122304a353abf7844bd2ff94ec1","parents":["e8bf6715a7db11ac8a5df80c1e5f0ec50728ec2e"],"ref":"refs/changes/55/5155/7","uploader":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"createdOn":1544023621,"author":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1544024473,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/lib/Makefile","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/lib/libvmm/Makefile","type":"ADDED","insertions":41,"deletions":0},{"file":"usr/src/lib/libvmm/Makefile.com","type":"ADDED","insertions":49,"deletions":0},{"file":"usr/src/lib/libvmm/amd64/Makefile","type":"ADDED","insertions":21,"deletions":0},{"file":"usr/src/lib/libvmm/common/libvmm.c","type":"ADDED","insertions":825,"deletions":0},{"file":"usr/src/lib/libvmm/common/libvmm.h","type":"ADDED","insertions":122,"deletions":0},{"file":"usr/src/lib/libvmm/common/llib-lvmm","type":"ADDED","insertions":2,"deletions":0},{"file":"usr/src/lib/libvmm/common/mapfile-vers","type":"ADDED","insertions":60,"deletions":0},{"file":"usr/src/uts/intel/amd64/sys/kdi_regs.h","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/intel/ia32/sys/kdi_regs.h","type":"MODIFIED","insertions":2,"deletions":0}],"sizeInsertions":1128,"sizeDeletions":-1},{"number":"8","revision":"519867caf20a3356967ddc451bb317b06041cd26","parents":["e8bf6715a7db11ac8a5df80c1e5f0ec50728ec2e"],"ref":"refs/changes/55/5155/8","uploader":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"createdOn":1544024494,"author":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1544024560,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/lib/Makefile","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/lib/libvmm/Makefile","type":"ADDED","insertions":41,"deletions":0},{"file":"usr/src/lib/libvmm/Makefile.com","type":"ADDED","insertions":49,"deletions":0},{"file":"usr/src/lib/libvmm/amd64/Makefile","type":"ADDED","insertions":21,"deletions":0},{"file":"usr/src/lib/libvmm/common/libvmm.c","type":"ADDED","insertions":826,"deletions":0},{"file":"usr/src/lib/libvmm/common/libvmm.h","type":"ADDED","insertions":122,"deletions":0},{"file":"usr/src/lib/libvmm/common/llib-lvmm","type":"ADDED","insertions":2,"deletions":0},{"file":"usr/src/lib/libvmm/common/mapfile-vers","type":"ADDED","insertions":60,"deletions":0},{"file":"usr/src/uts/intel/amd64/sys/kdi_regs.h","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/intel/ia32/sys/kdi_regs.h","type":"MODIFIED","insertions":2,"deletions":0}],"sizeInsertions":1129,"sizeDeletions":-1},{"number":"9","revision":"2da64d8663320d63a86f0d9b245c974962b41543","parents":["cc69c3e0f6e57c4937ddca74ad7d968867d73322"],"ref":"refs/changes/55/5155/9","uploader":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"createdOn":1544030324,"author":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1544024560,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/lib/Makefile","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/lib/libvmm/Makefile","type":"ADDED","insertions":41,"deletions":0},{"file":"usr/src/lib/libvmm/Makefile.com","type":"ADDED","insertions":49,"deletions":0},{"file":"usr/src/lib/libvmm/amd64/Makefile","type":"ADDED","insertions":21,"deletions":0},{"file":"usr/src/lib/libvmm/common/libvmm.c","type":"ADDED","insertions":826,"deletions":0},{"file":"usr/src/lib/libvmm/common/libvmm.h","type":"ADDED","insertions":122,"deletions":0},{"file":"usr/src/lib/libvmm/common/llib-lvmm","type":"ADDED","insertions":2,"deletions":0},{"file":"usr/src/lib/libvmm/common/mapfile-vers","type":"ADDED","insertions":60,"deletions":0},{"file":"usr/src/uts/intel/amd64/sys/kdi_regs.h","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/intel/ia32/sys/kdi_regs.h","type":"MODIFIED","insertions":2,"deletions":0}],"sizeInsertions":1129,"sizeDeletions":-1},{"number":"10","revision":"ec75f2057fcb18681319abf3c9aadf980cd9cd98","parents":["e43323d054607c1a92bb89b4fbc9dc64f253b12c"],"ref":"refs/changes/55/5155/10","uploader":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"createdOn":1544096128,"author":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1544024560,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/lib/Makefile","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/lib/libvmm/Makefile","type":"ADDED","insertions":41,"deletions":0},{"file":"usr/src/lib/libvmm/Makefile.com","type":"ADDED","insertions":49,"deletions":0},{"file":"usr/src/lib/libvmm/amd64/Makefile","type":"ADDED","insertions":21,"deletions":0},{"file":"usr/src/lib/libvmm/common/libvmm.c","type":"ADDED","insertions":826,"deletions":0},{"file":"usr/src/lib/libvmm/common/libvmm.h","type":"ADDED","insertions":122,"deletions":0},{"file":"usr/src/lib/libvmm/common/llib-lvmm","type":"ADDED","insertions":2,"deletions":0},{"file":"usr/src/lib/libvmm/common/mapfile-vers","type":"ADDED","insertions":60,"deletions":0},{"file":"usr/src/uts/intel/amd64/sys/kdi_regs.h","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/intel/ia32/sys/kdi_regs.h","type":"MODIFIED","insertions":2,"deletions":0}],"sizeInsertions":1129,"sizeDeletions":-1},{"number":"11","revision":"8486f354baafe14ee730d399235097091d236b49","parents":["e43323d054607c1a92bb89b4fbc9dc64f253b12c"],"ref":"refs/changes/55/5155/11","uploader":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"createdOn":1544108014,"author":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/lib/Makefile","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/lib/libvmm/Makefile","type":"ADDED","insertions":56,"deletions":0},{"file":"usr/src/lib/libvmm/libvmm.c","type":"ADDED","insertions":826,"deletions":0},{"file":"usr/src/lib/libvmm/libvmm.h","type":"ADDED","insertions":122,"deletions":0},{"file":"usr/src/lib/libvmm/mapfile-vers","type":"ADDED","insertions":60,"deletions":0},{"file":"usr/src/uts/intel/amd64/sys/kdi_regs.h","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/intel/ia32/sys/kdi_regs.h","type":"MODIFIED","insertions":2,"deletions":0}],"sizeInsertions":1072,"sizeDeletions":-1},{"number":"12","revision":"2b3abe111e3e41981c0d26b0a3ed6da370b6dfc5","parents":["aee094fb58670e677f4b30224180896ffde7581d"],"ref":"refs/changes/55/5155/12","uploader":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"createdOn":1544108093,"author":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"isDraft":false,"kind":"TRIVIAL_REBASE","comments":[{"file":"usr/src/lib/libvmm/Makefile","line":54,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Nit: install should depend on install_h"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/lib/Makefile","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/lib/libvmm/Makefile","type":"ADDED","insertions":56,"deletions":0},{"file":"usr/src/lib/libvmm/libvmm.c","type":"ADDED","insertions":826,"deletions":0},{"file":"usr/src/lib/libvmm/libvmm.h","type":"ADDED","insertions":122,"deletions":0},{"file":"usr/src/lib/libvmm/mapfile-vers","type":"ADDED","insertions":60,"deletions":0},{"file":"usr/src/uts/intel/amd64/sys/kdi_regs.h","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/intel/ia32/sys/kdi_regs.h","type":"MODIFIED","insertions":2,"deletions":0}],"sizeInsertions":1072,"sizeDeletions":-1},{"number":"13","revision":"4699866363b3d269918146f04674994e720249af","parents":["aee094fb58670e677f4b30224180896ffde7581d"],"ref":"refs/changes/55/5155/13","uploader":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"createdOn":1544619047,"author":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/lib/Makefile","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/lib/libvmm/Makefile","type":"ADDED","insertions":57,"deletions":0},{"file":"usr/src/lib/libvmm/libvmm.c","type":"ADDED","insertions":820,"deletions":0},{"file":"usr/src/lib/libvmm/libvmm.h","type":"ADDED","insertions":122,"deletions":0},{"file":"usr/src/lib/libvmm/mapfile-vers","type":"ADDED","insertions":60,"deletions":0},{"file":"usr/src/uts/intel/amd64/sys/kdi_regs.h","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/intel/ia32/sys/kdi_regs.h","type":"MODIFIED","insertions":2,"deletions":0}],"sizeInsertions":1067,"sizeDeletions":-1},{"number":"14","revision":"a8f8fa60b5c77a7cf48d1e93ae5b0635a1b4f572","parents":["aee094fb58670e677f4b30224180896ffde7581d"],"ref":"refs/changes/55/5155/14","uploader":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"createdOn":1544627432,"author":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1544627635,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"comments":[{"file":"usr/src/lib/libvmm/libvmm.c","line":91,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Is there anything that guarantees that active CPUs will be continuous from 0 to ncpu?  (If the OS decided to suspend one, for example?)\n\nIf that condition is possible, but you don\u0027t wish to handle it at this time, that seems fine.  Just note so in a comment."},{"file":"usr/src/lib/libvmm/libvmm.c","line":91,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"There is currently no way to really suspend a vCPU, as in removing it from active_cpus. They are only added to that set when spun up and always remain there.\n\nI\u0027m not sure there is anything preventing us from having gaps in our vCPU numbering. My understanding is that the numbering comes from bhyve and never has any gaps, not even when using a weird CPU topology. But I can comment the restriction anyway. And while at it, I moved this code to its own function."},{"file":"usr/src/lib/libvmm/libvmm.c","line":131,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"nit: Make this an explicit comparison?"},{"file":"usr/src/lib/libvmm/libvmm.c","line":131,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Done"},{"file":"usr/src/lib/libvmm/libvmm.c","line":184,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Should we be mapping this read/write all the time?  Would it make sense to offer a \u0027prot\u0027 argument and only map it writable if mdb_bhyve was loaded with the \u0027-w\u0027 flag?\n\nOne reason I bring this up: Whenever we start, in earnest, on live migration, I imagine we\u0027ll want to minimize the different vectors by which actors can write to guest memory."},{"file":"usr/src/lib/libvmm/libvmm.c","line":184,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Done"},{"file":"usr/src/lib/libvmm/libvmm.c","line":660,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Should these be defines somewhere?"},{"file":"usr/src/lib/libvmm/libvmm.c","line":660,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Done"},{"file":"usr/src/uts/intel/amd64/sys/kdi_regs.h","line":40,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"I hold the opposite opinion of jlevon: That we shouldn\u0027t bother to reference bhyve/vmm here."},{"file":"usr/src/uts/intel/amd64/sys/kdi_regs.h","line":40,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"It sounds like jlevon and I agree on the compromise of CTASSERTs on the libvmm side acting as the sync protection, rather than a comment here."},{"file":"usr/src/uts/intel/amd64/sys/kdi_regs.h","line":40,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"I removed the comments, but I have trouble coming up with an idea for a CTASSERT to check this."},{"file":"usr/src/uts/intel/amd64/sys/kdi_regs.h","line":40,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Check that the array size in libvmm matches KDIREG_GREG?"},{"file":"usr/src/uts/intel/amd64/sys/kdi_regs.h","line":40,"reviewer":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"message":"Done"},{"file":"usr/src/uts/intel/ia32/sys/kdi_regs.h","line":42,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"I hold the opposite opinion of jlevon: That we shouldn\u0027t bother to reference bhyve/vmm here."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/lib/Makefile","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/lib/libvmm/Makefile","type":"ADDED","insertions":57,"deletions":0},{"file":"usr/src/lib/libvmm/libvmm.c","type":"ADDED","insertions":820,"deletions":0},{"file":"usr/src/lib/libvmm/libvmm.h","type":"ADDED","insertions":122,"deletions":0},{"file":"usr/src/lib/libvmm/mapfile-vers","type":"ADDED","insertions":60,"deletions":0},{"file":"usr/src/uts/intel/amd64/sys/kdi_regs.h","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/intel/ia32/sys/kdi_regs.h","type":"MODIFIED","insertions":2,"deletions":0}],"sizeInsertions":1067,"sizeDeletions":-1},{"number":"15","revision":"972b60ec74d007992e622fc38cd1f32df7b0c53a","parents":["aee094fb58670e677f4b30224180896ffde7581d"],"ref":"refs/changes/55/5155/15","uploader":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"createdOn":1544808824,"author":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/lib/Makefile","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/lib/libvmm/Makefile","type":"ADDED","insertions":57,"deletions":0},{"file":"usr/src/lib/libvmm/libvmm.c","type":"ADDED","insertions":839,"deletions":0},{"file":"usr/src/lib/libvmm/libvmm.h","type":"ADDED","insertions":122,"deletions":0},{"file":"usr/src/lib/libvmm/mapfile-vers","type":"ADDED","insertions":60,"deletions":0}],"sizeInsertions":1083,"sizeDeletions":-1},{"number":"16","revision":"5d1c14eed82bf12860e8860f7f6130ba17ab17b6","parents":["aee094fb58670e677f4b30224180896ffde7581d"],"ref":"refs/changes/55/5155/16","uploader":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"createdOn":1545046185,"author":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1545058592,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1545056150,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1545148663,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/lib/Makefile","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/lib/libvmm/Makefile","type":"ADDED","insertions":57,"deletions":0},{"file":"usr/src/lib/libvmm/libvmm.c","type":"ADDED","insertions":841,"deletions":0},{"file":"usr/src/lib/libvmm/libvmm.h","type":"ADDED","insertions":122,"deletions":0},{"file":"usr/src/lib/libvmm/mapfile-vers","type":"ADDED","insertions":60,"deletions":0}],"sizeInsertions":1085,"sizeDeletions":-1},{"number":"17","revision":"4cd287abcc9b56a05a2b0747c4321cede4163227","parents":["aee094fb58670e677f4b30224180896ffde7581d"],"ref":"refs/changes/55/5155/17","uploader":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"createdOn":1545303913,"author":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1545058592,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1545056150,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1545148663,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/lib/Makefile","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/lib/libvmm/Makefile","type":"ADDED","insertions":57,"deletions":0},{"file":"usr/src/lib/libvmm/libvmm.c","type":"ADDED","insertions":841,"deletions":0},{"file":"usr/src/lib/libvmm/libvmm.h","type":"ADDED","insertions":122,"deletions":0},{"file":"usr/src/lib/libvmm/mapfile-vers","type":"ADDED","insertions":60,"deletions":0}],"sizeInsertions":1085,"sizeDeletions":-1},{"number":"18","revision":"7acaa8e37be75212e7823e35fc1b9a4cc61f601b","parents":["2319d4707150167d5bc9a32748d310d0c5e7a022"],"ref":"refs/changes/55/5155/18","uploader":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"createdOn":1545304207,"author":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1545058592,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"SUBM","value":"1","grantedOn":1545309617,"by":{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1545056150,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1545148663,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"manifest","type":"MODIFIED","insertions":2,"deletions":0},{"file":"usr/src/lib/Makefile","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/lib/libvmm/Makefile","type":"ADDED","insertions":57,"deletions":0},{"file":"usr/src/lib/libvmm/libvmm.c","type":"ADDED","insertions":841,"deletions":0},{"file":"usr/src/lib/libvmm/libvmm.h","type":"ADDED","insertions":122,"deletions":0},{"file":"usr/src/lib/libvmm/mapfile-vers","type":"ADDED","insertions":60,"deletions":0}],"sizeInsertions":1085,"sizeDeletions":-1}],"allReviewers":[{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},{"name":"Hans Rosenfeld","email":"hans.rosenfeld@joyent.com","username":"hrosenfeld"}]}