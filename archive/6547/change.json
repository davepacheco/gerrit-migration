{"project":"joyent/smartos-live","branch":"master","id":"I37ba61c8e0b24f03fcfaa4d56d54d52e22718791","number":"6547","subject":"OS-7864 test-vm bhyve quota checks failing on \"zvol refreseration matches expected\" Reviewed by: Pedro Palazón Candel \u003cpedro@joyent.com\u003e Reviewed by: Todd Whiteman \u003ctodd.whiteman@joyent.com\u003e Approved by: Todd Whiteman \u003ctodd.whiteman@joyent.com\u003e","owner":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"url":"https://cr.joyent.us/6547","commitMessage":"OS-7864 test-vm bhyve quota checks failing on \"zvol refreseration matches expected\"\nReviewed by: Pedro Palazón Candel \u003cpedro@joyent.com\u003e\nReviewed by: Todd Whiteman \u003ctodd.whiteman@joyent.com\u003e\nApproved by: Todd Whiteman \u003ctodd.whiteman@joyent.com\u003e\n","createdOn":1562169049,"lastUpdated":1562589436,"open":false,"status":"MERGED","comments":[{"timestamp":1562169049,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Uploaded patch set 1."},{"timestamp":1562169138,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1562194167,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Patch Set 1:\n\n(2 comments)"},{"timestamp":1562211703,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 1:\n\n(2 comments)"},{"timestamp":1562211719,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Uploaded patch set 2."},{"timestamp":1562211810,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1562215712,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Patch Set 2: Code-Review+1 Integration-Approval+1"},{"timestamp":1562250302,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 2: Code-Review+1"},{"timestamp":1562589407,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 3: Patch Set 2 was rebased"},{"timestamp":1562589430,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 4: Commit message was updated."},{"timestamp":1562589436,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Mike Gerdts"}],"currentPatchSet":{"number":"4","revision":"3da6e76f1536cf7908d643776127accd3e9e5477","parents":["4f183103e54d7f3d158ea1abe1fbbaa0af41a676"],"ref":"refs/changes/47/6547/4","uploader":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"createdOn":1562589430,"author":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1562211810,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1562215712,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1562215712,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1562250302,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"SUBM","value":"1","grantedOn":1562589436,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"src/vm/common/vmtest.js","type":"MODIFIED","insertions":1,"deletions":-27},{"file":"src/vm/node_modules/VM.js","type":"MODIFIED","insertions":6,"deletions":-5},{"file":"src/vm/tests/test-quota.js","type":"MODIFIED","insertions":38,"deletions":-33}],"sizeInsertions":45,"sizeDeletions":-65},"patchSets":[{"number":"1","revision":"b2eebe4a043aa252362bed5a1674a817270d6dd9","parents":["e3bf583c55d274864d3ca9b722578e8c27f44e20"],"ref":"refs/changes/47/6547/1","uploader":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"createdOn":1562169049,"author":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1562169138,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"src/vm/tests/test-quota.js","line":400,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Need to fire \"callback(err2)\" before the return call."},{"file":"src/vm/tests/test-quota.js","line":400,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Done"},{"file":"src/vm/tests/test-quota.js","line":433,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"You changed to async here - so you need to add a callback and return, e.g.:\n    callback();\n    return;\n  });\n  break;\n\nOtherwise the callback will fire (below) and then your tests run above (becoming out of context)."},{"file":"src/vm/tests/test-quota.js","line":433,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Yeah, and it looks like I need to move the other callback() into the default case so that it doesn\u0027t get called multiple times."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/vm/common/vmtest.js","type":"MODIFIED","insertions":1,"deletions":-27},{"file":"src/vm/node_modules/VM.js","type":"MODIFIED","insertions":6,"deletions":-5},{"file":"src/vm/tests/test-quota.js","type":"MODIFIED","insertions":35,"deletions":-32}],"sizeInsertions":42,"sizeDeletions":-64},{"number":"2","revision":"37ba61c8e0b24f03fcfaa4d56d54d52e22718791","parents":["10be2eeff258e02e15c615f64f3e2c1cc49c8c5c"],"ref":"refs/changes/47/6547/2","uploader":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"createdOn":1562211719,"author":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1562211810,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1562250302,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1562215712,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1562215712,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/vm/common/vmtest.js","type":"MODIFIED","insertions":1,"deletions":-27},{"file":"src/vm/node_modules/VM.js","type":"MODIFIED","insertions":6,"deletions":-5},{"file":"src/vm/tests/test-quota.js","type":"MODIFIED","insertions":38,"deletions":-33}],"sizeInsertions":45,"sizeDeletions":-65},{"number":"3","revision":"70ff2e79f9ce8b364ff45614a56d1c10804e5bed","parents":["4f183103e54d7f3d158ea1abe1fbbaa0af41a676"],"ref":"refs/changes/47/6547/3","uploader":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"createdOn":1562589407,"author":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"isDraft":false,"kind":"NO_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1562211810,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1562250302,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1562215712,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1562215712,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/vm/common/vmtest.js","type":"MODIFIED","insertions":1,"deletions":-27},{"file":"src/vm/node_modules/VM.js","type":"MODIFIED","insertions":6,"deletions":-5},{"file":"src/vm/tests/test-quota.js","type":"MODIFIED","insertions":38,"deletions":-33}],"sizeInsertions":45,"sizeDeletions":-65},{"number":"4","revision":"3da6e76f1536cf7908d643776127accd3e9e5477","parents":["4f183103e54d7f3d158ea1abe1fbbaa0af41a676"],"ref":"refs/changes/47/6547/4","uploader":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"createdOn":1562589430,"author":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1562211810,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1562250302,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1562215712,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1562215712,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}},{"type":"SUBM","value":"1","grantedOn":1562589436,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"src/vm/common/vmtest.js","type":"MODIFIED","insertions":1,"deletions":-27},{"file":"src/vm/node_modules/VM.js","type":"MODIFIED","insertions":6,"deletions":-5},{"file":"src/vm/tests/test-quota.js","type":"MODIFIED","insertions":38,"deletions":-33}],"sizeInsertions":45,"sizeDeletions":-65}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}]}