{"project":"joyent/sdc-headnode","branch":"master","topic":"TRITON-1353","id":"Ifcc8f59a5d89830ffa4e4a496cb43725a5f45cca","number":"6162","subject":"TRITON-1353 Triton systems should be able to disable SMT Reviewed by: Trent Mick \u003ctrentm@gmail.com\u003e Approved by: Trent Mick \u003ctrentm@gmail.com\u003e","owner":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"url":"https://cr.joyent.us/6162","commitMessage":"TRITON-1353 Triton systems should be able to disable SMT\nReviewed by: Trent Mick \u003ctrentm@gmail.com\u003e\nApproved by: Trent Mick \u003ctrentm@gmail.com\u003e\n","createdOn":1556210541,"lastUpdated":1557940550,"open":false,"status":"MERGED","comments":[{"timestamp":1556210541,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Uploaded patch set 1."},{"timestamp":1556210542,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit 79914173eabf8902f43f2f3ff91f332b07f87093\n    \n    m\n    \n    commit 241675b2a32c41133d1997212d27e008e578d062\n    \n    m"},{"timestamp":1556210578,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Topic set to TRITON-1353"},{"timestamp":1556210635,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1556619476,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Uploaded patch set 2."},{"timestamp":1556619479,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit 3d45b6ec7f06696f885e5e7132571b7c623ceaeb\n    \n    m\n    \n    commit 3a014dbab400f645e5aa71b4384cd6902fa6f26b\n    \n    m\n    \n    commit 5c99abe38d99ea227bc23d5a01e04350053cdd9e\n    \n    m"},{"timestamp":1556619558,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1556622006,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Uploaded patch set 3."},{"timestamp":1556622008,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 3:\n\nNew commits:\n    \n    commit a8603c05beeec8cbe457f688cfbe5cad4f9f4091\n    \n    m"},{"timestamp":1556622092,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1556643030,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Uploaded patch set 4."},{"timestamp":1556643033,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 4:\n\nNew commits:\n    \n    commit 3ac2743fce3203ca91a73d0d652b33e37ac3ff11\n    \n    m\n    \n    commit dbc7db9ca65eefd5b541f3a4c22826f3bd192e4d\n    \n    m"},{"timestamp":1556643110,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1556664237,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Uploaded patch set 5."},{"timestamp":1556664239,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 5:\n\nNew commits:\n    \n    commit c54f9d0b112adc7542a2da747004a3b0c306a28a\n    \n    m"},{"timestamp":1556664331,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1557247100,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Uploaded patch set 6."},{"timestamp":1557247102,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 6:\n\nNew commits:\n    \n    commit a3222a0dd44139a90c535d71f3b83b7e12eb8e1d\n    \n    m\n    \n    commit 268141796537fd1c8c63df77e89f5d7a6b4b33b2\n    \n    m"},{"timestamp":1557247189,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 6: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1557320506,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Uploaded patch set 7."},{"timestamp":1557320509,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 7:\n\nNew commits:\n    \n    commit 4dd89f7294dc5bcbd6cc7096d99422cca18594fc\n    \n    m"},{"timestamp":1557320590,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 7: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1557336376,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Patch Set 7:\n\n(1 comment)\n\nOne minor comment.  Otherwise, looks reasonable to me."},{"timestamp":1557393553,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Uploaded patch set 8."},{"timestamp":1557393555,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 8:\n\nNew commits:\n    \n    commit f8683d34ff05154e719d46f45c60a28003394cfd\n    \n    m"},{"timestamp":1557393643,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 8: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1557393724,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 7:\n\n(1 comment)"},{"timestamp":1557772062,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Patch Set 8: Code-Review+1"},{"timestamp":1557791436,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 8:\n\n(19 comments)\n\nSorry for delay in reviewing. Please note that \"nits\" from me are just that. I try to never hold up a change just for nits -- i.e. if you disagree, then feel free to ignore them."},{"timestamp":1557836402,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 8:\n\n(19 comments)"},{"timestamp":1557836423,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Uploaded patch set 9."},{"timestamp":1557836425,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 9:\n\nNew commits:\n    \n    commit 6264747e592c1d71ea5c9d722f538994e89ca91b\n    \n    trent code review"},{"timestamp":1557836526,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 9: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1557847601,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Uploaded patch set 10."},{"timestamp":1557847603,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 10:\n\nNew commits:\n    \n    commit 7ce34f14fa507fa5b0e6b37c6103a894464505a2\n    \n    trent code review\n    \n    commit 711fd6ddb3e3560282bf3affaabae53bbd21559e\n    \n    m\n    \n    commit 385302ba8e24a44eb46e716b4b9fd6f0e934d568\n    \n    m\n    \n    commit 464ec5a6f33d2447159d0c572053d4db3c71c4e0\n    \n    m\n    \n    commit 68e0af99b991d570452c8f86fb7266987d3b555d\n    \n    m\n    \n    commit 8288583d13982aabde75a6f83725e89ed4b5613d\n    \n    m\n    \n    commit 3e3898ec64b0b4c4413a486f37e8f5ec4dcffcb5\n    \n    m\n    \n    commit 989b265343dc64fd0bdbc10655abe0d44b0ea794\n    \n    m\n    \n    commit d204c143e60a48ff9cf7979a539f43100866a892\n    \n    m\n    \n    commit 5e4aa3dfa4382e238d7df7369699960b63e89479\n    \n    m\n    \n    commit 9df92d661d2f66813afc92678d3eb56ae0e20532\n    \n    m\n    \n    commit e25a90226450cdbfa943d84e59e7c09569566ce9\n    \n    m\n    \n    commit 8e867bcb212acef4d54b20ce345e6d25b7a96a2a\n    \n    m\n    \n    commit beb9b06a5e6f06a0db93ca258375d84a5bd461fd\n    \n    m"},{"timestamp":1557847686,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 10: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1557855070,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 10: Code-Review+1\n\n(1 comment)"},{"timestamp":1557857723,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Uploaded patch set 11."},{"timestamp":1557857724,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 11:\n\nNew commits:\n    \n    commit 5d2fc39e2744228fc51ad37701420c49e3cc7cbd\n    \n    more trent"},{"timestamp":1557857806,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 11: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1557861333,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 11: Code-Review+1 Integration-Approval+1"},{"timestamp":1557862816,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Uploaded patch set 12: Commit message was updated."},{"timestamp":1557940550,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by John Levon"}],"currentPatchSet":{"number":"12","revision":"fcc8f59a5d89830ffa4e4a496cb43725a5f45cca","parents":["2ecd142490fd42247fa86f6ee1c6e301248045ce"],"ref":"refs/changes/62/6162/12","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1557862816,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1557857806,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1557861333,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1557861333,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1557940550,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"bin/build-tar-image","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"build.spec","type":"MODIFIED","insertions":1,"deletions":0},{"file":"tools/bin/sdc-server","type":"MODIFIED","insertions":393,"deletions":-1},{"file":"tools/cmd/sdc-usbkey.js","type":"MODIFIED","insertions":50,"deletions":0},{"file":"tools/lib/usbkey.js","type":"MODIFIED","insertions":102,"deletions":-18}],"sizeInsertions":550,"sizeDeletions":-20},"patchSets":[{"number":"1","revision":"7b9c18cacdfbdc2be2f8ab160177fa67b766cf96","parents":["59e7a0018c597b91c15eadaaf61ebe99140adff1"],"ref":"refs/changes/62/6162/1","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1556210541,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1556210635,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"bin/build-tar-image","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"build.spec","type":"MODIFIED","insertions":1,"deletions":0},{"file":"tools/bin/sdc-server","type":"MODIFIED","insertions":162,"deletions":0}],"sizeInsertions":167,"sizeDeletions":-1},{"number":"2","revision":"b3ffdf842055631bf3339cf977c33bfe4ea4bc5c","parents":["59e7a0018c597b91c15eadaaf61ebe99140adff1"],"ref":"refs/changes/62/6162/2","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1556619476,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1556619558,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"bin/build-tar-image","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"build.spec","type":"MODIFIED","insertions":1,"deletions":0},{"file":"tools/bin/sdc-server","type":"MODIFIED","insertions":365,"deletions":-1},{"file":"tools/cmd/sdc-usbkey.js","type":"MODIFIED","insertions":50,"deletions":0},{"file":"tools/lib/usbkey.js","type":"MODIFIED","insertions":97,"deletions":-9}],"sizeInsertions":517,"sizeDeletions":-11},{"number":"3","revision":"d67fb098e2f4b43ba5ca5353bc509e97179f5992","parents":["59e7a0018c597b91c15eadaaf61ebe99140adff1"],"ref":"refs/changes/62/6162/3","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1556622006,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1556622092,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"bin/build-tar-image","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"build.spec","type":"MODIFIED","insertions":1,"deletions":0},{"file":"tools/bin/sdc-server","type":"MODIFIED","insertions":365,"deletions":-1},{"file":"tools/cmd/sdc-usbkey.js","type":"MODIFIED","insertions":50,"deletions":0},{"file":"tools/lib/usbkey.js","type":"MODIFIED","insertions":97,"deletions":-9}],"sizeInsertions":517,"sizeDeletions":-11},{"number":"4","revision":"4ebca41777f507aded388672ea5c1bc2cac85d2d","parents":["59e7a0018c597b91c15eadaaf61ebe99140adff1"],"ref":"refs/changes/62/6162/4","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1556643030,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1556643110,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"bin/build-tar-image","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"build.spec","type":"MODIFIED","insertions":1,"deletions":0},{"file":"tools/bin/sdc-server","type":"MODIFIED","insertions":363,"deletions":-1},{"file":"tools/cmd/sdc-usbkey.js","type":"MODIFIED","insertions":50,"deletions":0},{"file":"tools/lib/usbkey.js","type":"MODIFIED","insertions":99,"deletions":-18}],"sizeInsertions":517,"sizeDeletions":-20},{"number":"5","revision":"250d26fa88764ecac4a4dcf5f0a47a2a42b73d5e","parents":["59e7a0018c597b91c15eadaaf61ebe99140adff1"],"ref":"refs/changes/62/6162/5","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1556664237,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1556664331,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"bin/build-tar-image","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"build.spec","type":"MODIFIED","insertions":1,"deletions":0},{"file":"tools/bin/sdc-server","type":"MODIFIED","insertions":363,"deletions":-1},{"file":"tools/cmd/sdc-usbkey.js","type":"MODIFIED","insertions":50,"deletions":0},{"file":"tools/lib/usbkey.js","type":"MODIFIED","insertions":99,"deletions":-18}],"sizeInsertions":517,"sizeDeletions":-20},{"number":"6","revision":"fd002ebebec9171aa7dec584700a85ff34ec0a95","parents":["59e7a0018c597b91c15eadaaf61ebe99140adff1"],"ref":"refs/changes/62/6162/6","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1557247100,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1557247189,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"bin/build-tar-image","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"build.spec","type":"MODIFIED","insertions":1,"deletions":0},{"file":"tools/bin/sdc-server","type":"MODIFIED","insertions":363,"deletions":-1},{"file":"tools/cmd/sdc-usbkey.js","type":"MODIFIED","insertions":50,"deletions":0},{"file":"tools/lib/usbkey.js","type":"MODIFIED","insertions":99,"deletions":-18}],"sizeInsertions":517,"sizeDeletions":-20},{"number":"7","revision":"22b2a3b0ac25a0222f1e8e1f6cd2d84a511ac448","parents":["59e7a0018c597b91c15eadaaf61ebe99140adff1"],"ref":"refs/changes/62/6162/7","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1557320506,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1557320590,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"tools/lib/usbkey.js","line":1024,"reviewer":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},"message":"Wondering if returning here would be a problem is a given loader.conf variable was set with some system default value in loader.conf, but then overridden with a user customization in loader.conf.local?"},{"file":"tools/lib/usbkey.js","line":1024,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Done, I checked that this happens as expected, and all combinations of a variable being set in these files now correctly reports what ends up as bootparams"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"bin/build-tar-image","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"build.spec","type":"MODIFIED","insertions":1,"deletions":0},{"file":"tools/bin/sdc-server","type":"MODIFIED","insertions":363,"deletions":-1},{"file":"tools/cmd/sdc-usbkey.js","type":"MODIFIED","insertions":50,"deletions":0},{"file":"tools/lib/usbkey.js","type":"MODIFIED","insertions":99,"deletions":-18}],"sizeInsertions":517,"sizeDeletions":-20},{"number":"8","revision":"b9420e2f590a1d504f0af4978e7a438ecd0d47b2","parents":["59e7a0018c597b91c15eadaaf61ebe99140adff1"],"ref":"refs/changes/62/6162/8","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1557393553,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1557393643,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1557772062,"by":{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"}}],"comments":[{"file":"tools/bin/sdc-server","line":29,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"nit: import as `bunyan` please"},{"file":"tools/bin/sdc-server","line":29,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Done"},{"file":"tools/bin/sdc-server","line":55,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"nit: `\u003cparam\u003e \u003cvalue\u003e`\nGranted the existing code here isn\u0027t consistent either."},{"file":"tools/bin/sdc-server","line":55,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Done"},{"file":"tools/bin/sdc-server","line":100,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"I think I would have made separate `sdc-server get-default \u003cparam\u003e` and `sdc-server set-default \u003cparam\u003e \u003cvalue\u003e` commands to avoid the slightly odd inter-arg optional `\u003cuuid\u003e`.  Not a biggie, however."},{"file":"tools/bin/sdc-server","line":100,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Nit: `\u003cparam\u003e`"},{"file":"tools/bin/sdc-server","line":100,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"This is like zfs get/set, except that in the same verb,object,params order used by the rest of sdc-server. I think I\u0027ll leave it like it is."},{"file":"tools/bin/sdc-server","line":100,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Done"},{"file":"tools/bin/sdc-server","line":116,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Do we care to provide a mechanism to *unset* the value on either SAPI or on a server?"},{"file":"tools/bin/sdc-server","line":116,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"nit: `\u003cparam\u003e \u003cvalue\u003e`"},{"file":"tools/bin/sdc-server","line":116,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"I\u0027ll revisit this if we decide its useful."},{"file":"tools/bin/sdc-server","line":116,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Done"},{"file":"tools/bin/sdc-server","line":187,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"nit: Use `bunyan.createLogger`."},{"file":"tools/bin/sdc-server","line":187,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Done"},{"file":"tools/bin/sdc-server","line":1118,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Perhaps use `cnapi.getServer(server_uuid` ?"},{"file":"tools/bin/sdc-server","line":1118,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Done"},{"file":"tools/bin/sdc-server","line":1132,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"If in a future world we finish RFD 67, there can be multiple headnodes. That means that `server_uuid` might not be the local headnode.\n\nIn general the answer for updating the headnode\u0027s USB key would then be a CNAPI endpoint that calls cn-agent on that server.  However, I don\u0027t think you need go there yet for this. Perhaps instead just add a guard and error out if\n`server.headnode` and `server_uuid !\u003d\u003d this_server_uuid`. The error message could say \"You must re-run this \u0027sdc-server set ...\u0027 command on that headnode.\"\n\nYou might want a pipeline method before this to load the local sysinfo if `server.headnode`, from which you can get `this_server_uuid`."},{"file":"tools/bin/sdc-server","line":1132,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Good spot, thanks."},{"file":"tools/bin/sdc-server","line":1255,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"You can skip this SAPI GetService call. The full service object is already on `svc` from the SAPI ListServices call above."},{"file":"tools/bin/sdc-server","line":1255,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Done"},{"file":"tools/bin/sdc-server","line":1260,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"tip: This can also be `value !\u003d\u003d undefined`."},{"file":"tools/bin/sdc-server","line":1260,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Done"},{"file":"tools/bin/sdc-server","line":1292,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Again, this could use `cnapi.getServer(server_uuid`. It would obviate the need for the `if (servers.length !\u003d\u003d 1)` checking below."},{"file":"tools/bin/sdc-server","line":1292,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Done"},{"file":"tools/bin/sdc-server","line":1306,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"See note above about guarding if we are attempting to operate on a headnode that isn\u0027t the current server on which sdc-server is being run."},{"file":"tools/bin/sdc-server","line":1306,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Done"},{"file":"tools/bin/sdc-server","line":1307,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"FWIW, I think it would be clearer to handle async steps\nas a separate function in the top-level vasync.pipeline.\nSomething like:\n\n```\nvasync.pipeline({arg: {}, funcs: [\n    // ...\n    function getServer(ctx, cb) {\n        ctx.cnapi.getServer(server_uuid, function (err, server) {\n            ctx.server \u003d server;\n            cb(err);\n        });\n    },\n    function getHeadnodeKernelArg(ctx, cb) {\n        if (!server.headnode) {\n            cb();\n            return;\n        }\n        \n        // TODO: guard against server.uuid not being the server on\n        //  which we are running\n        \n        usbkey.get_variable(...);\n    },\n    function getNonHeadnodeKernelArg(ctx, cb) {\n        if (server.headnode) {\n            cb();\n            return;\n        }\n        \n        ctx.cnapi.getBootParams(ctx.server.uuid, ...);\n    }\n```"},{"file":"tools/bin/sdc-server","line":1307,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"I\u0027m not sure that\u0027s clearer to me to be honest...\n\nAs it\u0027s already written, I\u0027m going to leave things as they are."},{"file":"tools/bin/sdc-server","line":1312,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"nit: Similar comment as made on sdc-usbkey.js about differentiating \"unset\" as a literal value and actually unset."},{"file":"tools/bin/sdc-server","line":1312,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Done"},{"file":"tools/bin/sdc-server","line":1355,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"From the ticket you say \"sdc-server get ht_enabled with nothing set in SAPI, should return false\"\n\nShould this value be `false` here?"},{"file":"tools/bin/sdc-server","line":1355,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Not any more, now we are defaulting to true. I need to update the testing notes."},{"file":"tools/cmd/sdc-usbkey.js","line":574,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"nit: `!\u003d\u003d`"},{"file":"tools/cmd/sdc-usbkey.js","line":574,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Done"},{"file":"tools/cmd/sdc-usbkey.js","line":588,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Is it desirable to not be able to distinguish \"unset\" as a literal value and the value not being set?  I don\u0027t have a feel for real usage to know if that is a real concern or me just being pedantic. :)\n\nE.g. could have it error on a get of a var that isn\u0027t set... and have an option (\u0027-f\u0027 or whatever) return empty string if not set. Not sure. I don\u0027t know of good prior art."},{"file":"tools/cmd/sdc-usbkey.js","line":588,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"I\u0027ll return an error, but leave the possibility of an option to later."},{"file":"tools/lib/usbkey.js","line":1032,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"*Could* be more crisp on only pass here if the err.code is \u0027ENOENT\u0027, but meh."},{"file":"tools/lib/usbkey.js","line":1032,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"bin/build-tar-image","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"build.spec","type":"MODIFIED","insertions":1,"deletions":0},{"file":"tools/bin/sdc-server","type":"MODIFIED","insertions":363,"deletions":-1},{"file":"tools/cmd/sdc-usbkey.js","type":"MODIFIED","insertions":50,"deletions":0},{"file":"tools/lib/usbkey.js","type":"MODIFIED","insertions":98,"deletions":-18}],"sizeInsertions":516,"sizeDeletions":-20},{"number":"9","revision":"a9d7e4d1b9d9cdfe1cd065128abe5be08aabf539","parents":["59e7a0018c597b91c15eadaaf61ebe99140adff1"],"ref":"refs/changes/62/6162/9","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1557836423,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1557836526,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"bin/build-tar-image","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"build.spec","type":"MODIFIED","insertions":1,"deletions":0},{"file":"tools/bin/sdc-server","type":"MODIFIED","insertions":388,"deletions":-1},{"file":"tools/cmd/sdc-usbkey.js","type":"MODIFIED","insertions":50,"deletions":0},{"file":"tools/lib/usbkey.js","type":"MODIFIED","insertions":102,"deletions":-18}],"sizeInsertions":545,"sizeDeletions":-20},{"number":"10","revision":"a227c290ba512e3dcd6579385d523e95471a0259","parents":["2ecd142490fd42247fa86f6ee1c6e301248045ce"],"ref":"refs/changes/62/6162/10","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1557847601,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1557847686,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1557855070,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"comments":[{"file":"tools/bin/sdc-server","line":174,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"The callback should not be inside the try-catch. If the code to which we callback *itself* throws, then this will catch it, and we\u0027ll callback twice here. I\u0027ve seen that result in a ticket once.\n\nPerhaps this (which I mostly cribbed from sdcadm which does a similar thing on startup).\n\n```\n// Already have this module from dap in headnode/tools/node_modules.\n// It provides some saner child process semantics and good error details.\nvar forkexec \u003d require(\u0027forkexec\u0027);\n\nfunction getHeadnodeSysinfo(callback) {\n    mod_forkexec.forkExecWait({\n        argv: [\u0027/usr/bin/sysinfo\u0027],\n        includeStderr: true\n    }, function (err, info) {\n        if (err) {\n           callback(err);\n           return;\n        }\n\n        var sysinfo;\n        try {\n            sysinfo \u003d JSON.parse(info.stdout);\n        } catch (parseErr) {\n            callback(parseErr);\n            return;\n        }\n        \n        callback(null, sysinfo);\n    });\n}\n```"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"bin/build-tar-image","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"build.spec","type":"MODIFIED","insertions":1,"deletions":0},{"file":"tools/bin/sdc-server","type":"MODIFIED","insertions":388,"deletions":-1},{"file":"tools/cmd/sdc-usbkey.js","type":"MODIFIED","insertions":50,"deletions":0},{"file":"tools/lib/usbkey.js","type":"MODIFIED","insertions":102,"deletions":-18}],"sizeInsertions":545,"sizeDeletions":-20},{"number":"11","revision":"d7592bfb922e759faf85444bad021e4c7bd01b9f","parents":["2ecd142490fd42247fa86f6ee1c6e301248045ce"],"ref":"refs/changes/62/6162/11","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1557857723,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1557857806,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1557861333,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1557861333,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"bin/build-tar-image","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"build.spec","type":"MODIFIED","insertions":1,"deletions":0},{"file":"tools/bin/sdc-server","type":"MODIFIED","insertions":393,"deletions":-1},{"file":"tools/cmd/sdc-usbkey.js","type":"MODIFIED","insertions":50,"deletions":0},{"file":"tools/lib/usbkey.js","type":"MODIFIED","insertions":102,"deletions":-18}],"sizeInsertions":550,"sizeDeletions":-20},{"number":"12","revision":"fcc8f59a5d89830ffa4e4a496cb43725a5f45cca","parents":["2ecd142490fd42247fa86f6ee1c6e301248045ce"],"ref":"refs/changes/62/6162/12","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1557862816,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1557857806,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1557861333,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1557861333,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"SUBM","value":"1","grantedOn":1557940550,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"bin/build-tar-image","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"build.spec","type":"MODIFIED","insertions":1,"deletions":0},{"file":"tools/bin/sdc-server","type":"MODIFIED","insertions":393,"deletions":-1},{"file":"tools/cmd/sdc-usbkey.js","type":"MODIFIED","insertions":50,"deletions":0},{"file":"tools/lib/usbkey.js","type":"MODIFIED","insertions":102,"deletions":-18}],"sizeInsertions":550,"sizeDeletions":-20}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Rob Johnston","email":"rob.johnston@joyent.com","username":"rejohnst"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}]}