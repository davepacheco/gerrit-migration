{"project":"joyent/manta-muskie","branch":"master","id":"If1c3d50e813b0db8efacd0f93102d422eb13d100","number":"1233","subject":"MANTA-3078 muskie -\u003e mako connection retries should be less aggressive Reviewed by: David Pacheco \u003cdap@joyent.com\u003e","owner":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"url":"https://cr.joyent.us/1233","commitMessage":"MANTA-3078 muskie -\u003e mako connection retries should be less aggressive\nReviewed by: David Pacheco \u003cdap@joyent.com\u003e\n","createdOn":1484086035,"lastUpdated":1484170290,"open":false,"status":"MERGED","comments":[{"timestamp":1484086035,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Uploaded patch set 1."},{"timestamp":1484086072,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1484095973,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 1: Code-Review+1\n\nAs I understand this, before the change, if a mako was totally down (i.e., not sending any packets), we\u0027d have this:\n\nT\u003d 0 attempt 1 starts (timeout\u003d2s)\nT\u003d 2 attempt 1 fails  (delay\u003d10s)\nT\u003d12 attempt 2 starts (timeout\u003d4s)\nT\u003d16 attempt 2 fails\n\nMonitor retries every 4s after that with a 10s timeout.\n\nAfter the change, we have:\n\nT\u003d 0   attempt 1 starts (timeout\u003d2s)\nT\u003d 2   attempt 1 fails  (delay\u003d0.5s)\nT\u003d 2.5 attempt 2 starts (timeout\u003d4s)\nT\u003d 6.5 attempt 2 fails  (delay\u003d1s)\nT\u003d 7.5 attempt 3 starts (timeout\u003d8s)\nT\u003d15.5 attempt 3 fails  (delay\u003d2s)\nT\u003d17.5 attempt 4 starts (timeout\u003d16s)\nT\u003d33.5 attempt 4 fails  (delay\u003d4s)\nT\u003d37.5 attempt 5 starts (timeout\u003d30s -- clamped by maxTimeout)\nT\u003d67.5 attempt 5 fails\n\nThe monitor retries with a 30s timeout and a 4s delay."},{"timestamp":1484170141,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 1: Integration-Approval+1"},{"timestamp":1484170192,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 2: Commit message was updated."},{"timestamp":1484170234,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 3: Patch Set 2 was rebased"},{"timestamp":1484170250,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Alex Wilson"},{"timestamp":1484170290,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3:\n\n\"make check\" passed ok"}],"currentPatchSet":{"number":"3","revision":"c9f13a526195ef6cda586063ef2ad061e6349e97","parents":["39c1abd0d4e6ea54560d4de38d0d058e3bebefc7"],"ref":"refs/changes/33/1233/3","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1484170234,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1484086072,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1484095973,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1484170141,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"SUBM","value":"1","grantedOn":1484170250,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"main.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"sapi_manifests/muskie/template","type":"MODIFIED","insertions":3,"deletions":-3}],"sizeInsertions":4,"sizeDeletions":-4},"patchSets":[{"number":"1","revision":"f1c3d50e813b0db8efacd0f93102d422eb13d100","parents":["45066b87374d005fa25865bee24a8342b564397a"],"ref":"refs/changes/33/1233/1","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1484086035,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1484095973,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1484170141,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1484086072,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"main.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"sapi_manifests/muskie/template","type":"MODIFIED","insertions":3,"deletions":-3}],"sizeInsertions":4,"sizeDeletions":-4},{"number":"2","revision":"41ed0738cc902c87629e6aefad1e40852508d5f8","parents":["45066b87374d005fa25865bee24a8342b564397a"],"ref":"refs/changes/33/1233/2","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1484170192,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1484095973,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1484170141,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1484086072,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"main.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"sapi_manifests/muskie/template","type":"MODIFIED","insertions":3,"deletions":-3}],"sizeInsertions":4,"sizeDeletions":-4},{"number":"3","revision":"c9f13a526195ef6cda586063ef2ad061e6349e97","parents":["39c1abd0d4e6ea54560d4de38d0d058e3bebefc7"],"ref":"refs/changes/33/1233/3","uploader":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"createdOn":1484170234,"author":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1484095973,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1484170141,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"SUBM","value":"1","grantedOn":1484170250,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1484086072,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"main.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"sapi_manifests/muskie/template","type":"MODIFIED","insertions":3,"deletions":-3}],"sizeInsertions":4,"sizeDeletions":-4}],"allReviewers":[{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},{"name":"Joyent Automation","username":"joyent-automation"}]}