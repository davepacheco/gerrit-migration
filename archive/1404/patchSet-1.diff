commit 4b1ce7f40d1003c10119b72fed124722697e88cf (refs/changes/04/1404/1)
Author: Pedro Palazon Candel <pedro@joyent.com>
Date:   2017-02-02T18:06:28+01:00 (2 years, 8 months ago)
    
    TOOLS-1673 sdcadm getAgentImages not working due to missing name attribute

diff --git a/lib/steps/agent-services.js b/lib/steps/agent-services.js
index 38e8c70..ae69da9 100644
--- a/lib/steps/agent-services.js
+++ b/lib/steps/agent-services.js
@@ -97,7 +97,7 @@ function agentServicesEnsureCreated(arg, cb) {
     function getAgentImages(callback) {
         vasync.forEachPipeline({
             func: function (agent, next) {
-                var name = agent.name;
+                var name = agent.metadata.SERVICE_NAME;
                 var imgUUIDPath = util.format(
                     '/opt/smartdc/agents/lib/node_modules/%s/image_uuid',
                     name);
