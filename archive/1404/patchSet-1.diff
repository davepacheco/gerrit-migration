From 4b1ce7f40d1003c10119b72fed124722697e88cf Mon Sep 17 00:00:00 2001
From: Pedro Palazon Candel <pedro@joyent.com>
Date: Thu, 2 Feb 2017 18:06:28 +0100
Subject: [PATCH] TOOLS-1673 sdcadm getAgentImages not working due to missing
 name attribute

---
 lib/steps/agent-services.js | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/lib/steps/agent-services.js b/lib/steps/agent-services.js
index 38e8c70..ae69da9 100644
--- a/lib/steps/agent-services.js
+++ b/lib/steps/agent-services.js
@@ -97,7 +97,7 @@ function agentServicesEnsureCreated(arg, cb) {
     function getAgentImages(callback) {
         vasync.forEachPipeline({
             func: function (agent, next) {
-                var name = agent.name;
+                var name = agent.metadata.SERVICE_NAME;
                 var imgUUIDPath = util.format(
                     '/opt/smartdc/agents/lib/node_modules/%s/image_uuid',
                     name);
-- 
2.21.0

