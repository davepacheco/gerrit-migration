{"project":"joyent/smartos-live","branch":"master","topic":"FWAPI-240","id":"Ib6844e4fc2256f13a8e8250a91adee1730726795","number":"366","subject":"FWAPI-240 fwadm(1M) should avoid conflicting with concurrent runs Reviewed by: Alex Wilson \u003calex.wilson@joyent.com\u003e Approved by: Joshua M. Clulow \u003cjmc@joyent.com\u003e","owner":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"url":"https://cr.joyent.us/366","commitMessage":"FWAPI-240 fwadm(1M) should avoid conflicting with concurrent runs\nReviewed by: Alex Wilson \u003calex.wilson@joyent.com\u003e\nApproved by: Joshua M. Clulow \u003cjmc@joyent.com\u003e\n","createdOn":1472254082,"lastUpdated":1473456525,"open":false,"status":"MERGED","comments":[{"timestamp":1472254082,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 1."},{"timestamp":1472254120,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1472254159,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Topic set to FWAPI-240"},{"timestamp":1472761562,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 2."},{"timestamp":1472761605,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1472761805,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 3: Patch Set 2 was rebased."},{"timestamp":1472761848,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3:\n\n\"make check\" passed ok"},{"timestamp":1472762464,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1472762631,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 4."},{"timestamp":1472762669,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1472762673,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 5: Commit message was updated."},{"timestamp":1472762677,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 5: Code-Review+1"},{"timestamp":1473360004,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 6: Patch Set 5 was rebased."},{"timestamp":1473360068,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 6:\n\n\"make check\" passed ok"},{"timestamp":1473456099,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Patch Set 6: Integration-Approval+1\n\nI spoke with Cody, and am satisfied that this has been tested.  (See testing notes in the bug.)"},{"timestamp":1473456123,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Patch Set 7: Commit message was updated."},{"timestamp":1473456525,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Cody Peter Mello"}],"currentPatchSet":{"number":"7","revision":"e2fe70e9ac0660b2c939a501d4fbcc8ae15e734d","parents":["f592eaaa4d630b4a508c29940bf5f89ba4efcb95"],"ref":"refs/changes/66/366/7","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1473456123,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1472762669,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1472762677,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1473456099,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}},{"type":"SUBM","value":"1","grantedOn":1473456525,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"src/fw/lib/fw.js","type":"MODIFIED","insertions":192,"deletions":-94},{"file":"src/fw/lib/locker.js","type":"ADDED","insertions":85,"deletions":0},{"file":"src/fw/test/lib/mocks.js","type":"MODIFIED","insertions":29,"deletions":-1},{"file":"src/fw/tools/jsl.node.conf","type":"MODIFIED","insertions":1,"deletions":0},{"file":"src/manifest","type":"MODIFIED","insertions":3,"deletions":0}],"sizeInsertions":310,"sizeDeletions":-95},"patchSets":[{"number":"1","revision":"8690bf605ffb042404358f7ce09059baf9a64063","parents":["bcaed7298fdeff4f511b8570d80825ce2365197f"],"ref":"refs/changes/66/366/1","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1472254082,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1472254120,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/fw/lib/fw.js","type":"MODIFIED","insertions":192,"deletions":-94},{"file":"src/fw/lib/locker.js","type":"ADDED","insertions":85,"deletions":0},{"file":"src/fw/test/lib/mocks.js","type":"MODIFIED","insertions":28,"deletions":-1},{"file":"src/manifest","type":"MODIFIED","insertions":3,"deletions":0}],"sizeInsertions":308,"sizeDeletions":-95},{"number":"2","revision":"97e08d29416522cd549f50a930aa20b13fe3ae13","parents":["41b2c7a6c88b5ade301b3383418262e7e3f5a309"],"ref":"refs/changes/66/366/2","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1472761562,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1472761605,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"src/fw/lib/locker.js","line":74,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Maybe make this if (fd \u003d\u003d\u003d undefined) { to clarify that we\u0027re not really intending to test the fd number, but rather handle being given undefined (because acquireLock errored out and pipeline() wrote the undefined down in res.state)"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/fw/lib/fw.js","type":"MODIFIED","insertions":192,"deletions":-94},{"file":"src/fw/lib/locker.js","type":"ADDED","insertions":85,"deletions":0},{"file":"src/fw/test/lib/mocks.js","type":"MODIFIED","insertions":29,"deletions":-1},{"file":"src/fw/tools/jsl.node.conf","type":"MODIFIED","insertions":1,"deletions":0},{"file":"src/manifest","type":"MODIFIED","insertions":3,"deletions":0}],"sizeInsertions":310,"sizeDeletions":-95},{"number":"3","revision":"2a3fad7380598ea8b771b44098dab04301fd662d","parents":["dbc42bbebebc4bb92cc47aaaa6db3d5ef6eec211"],"ref":"refs/changes/66/366/3","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1472761805,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1472761605,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/fw/lib/fw.js","type":"MODIFIED","insertions":192,"deletions":-94},{"file":"src/fw/lib/locker.js","type":"ADDED","insertions":85,"deletions":0},{"file":"src/fw/test/lib/mocks.js","type":"MODIFIED","insertions":29,"deletions":-1},{"file":"src/fw/tools/jsl.node.conf","type":"MODIFIED","insertions":1,"deletions":0},{"file":"src/manifest","type":"MODIFIED","insertions":3,"deletions":0}],"sizeInsertions":310,"sizeDeletions":-95},{"number":"4","revision":"2d0e1874777bd7930dcbd83d13d2ce0eb37b5365","parents":["cf8cdfbe143d44a5176cddce59f8b0c181bd771d"],"ref":"refs/changes/66/366/4","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1472762631,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1472762669,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/fw/lib/fw.js","type":"MODIFIED","insertions":192,"deletions":-94},{"file":"src/fw/lib/locker.js","type":"ADDED","insertions":85,"deletions":0},{"file":"src/fw/test/lib/mocks.js","type":"MODIFIED","insertions":29,"deletions":-1},{"file":"src/fw/tools/jsl.node.conf","type":"MODIFIED","insertions":1,"deletions":0},{"file":"src/manifest","type":"MODIFIED","insertions":3,"deletions":0}],"sizeInsertions":310,"sizeDeletions":-95},{"number":"5","revision":"f2f29899cd53947ba7e98436f2008a287e5eb608","parents":["cf8cdfbe143d44a5176cddce59f8b0c181bd771d"],"ref":"refs/changes/66/366/5","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1472762673,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1472762677,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1472762669,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"src/fw/lib/fw.js","type":"MODIFIED","insertions":192,"deletions":-94},{"file":"src/fw/lib/locker.js","type":"ADDED","insertions":85,"deletions":0},{"file":"src/fw/test/lib/mocks.js","type":"MODIFIED","insertions":29,"deletions":-1},{"file":"src/fw/tools/jsl.node.conf","type":"MODIFIED","insertions":1,"deletions":0},{"file":"src/manifest","type":"MODIFIED","insertions":3,"deletions":0}],"sizeInsertions":310,"sizeDeletions":-95},{"number":"6","revision":"b6844e4fc2256f13a8e8250a91adee1730726795","parents":["f592eaaa4d630b4a508c29940bf5f89ba4efcb95"],"ref":"refs/changes/66/366/6","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1473360004,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1472762677,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1473456099,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1472762669,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"src/fw/lib/fw.js","type":"MODIFIED","insertions":192,"deletions":-94},{"file":"src/fw/lib/locker.js","type":"ADDED","insertions":85,"deletions":0},{"file":"src/fw/test/lib/mocks.js","type":"MODIFIED","insertions":29,"deletions":-1},{"file":"src/fw/tools/jsl.node.conf","type":"MODIFIED","insertions":1,"deletions":0},{"file":"src/manifest","type":"MODIFIED","insertions":3,"deletions":0}],"sizeInsertions":310,"sizeDeletions":-95},{"number":"7","revision":"e2fe70e9ac0660b2c939a501d4fbcc8ae15e734d","parents":["f592eaaa4d630b4a508c29940bf5f89ba4efcb95"],"ref":"refs/changes/66/366/7","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1473456123,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"SUBM","value":"1","grantedOn":1473456525,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1472762677,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1473456099,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1472762669,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"src/fw/lib/fw.js","type":"MODIFIED","insertions":192,"deletions":-94},{"file":"src/fw/lib/locker.js","type":"ADDED","insertions":85,"deletions":0},{"file":"src/fw/test/lib/mocks.js","type":"MODIFIED","insertions":29,"deletions":-1},{"file":"src/fw/tools/jsl.node.conf","type":"MODIFIED","insertions":1,"deletions":0},{"file":"src/manifest","type":"MODIFIED","insertions":3,"deletions":0}],"sizeInsertions":310,"sizeDeletions":-95}],"allReviewers":[{"name":"Matthew Smillie","email":"matt.smillie@joyent.com","username":"notmatt"},{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}]}