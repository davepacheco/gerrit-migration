From 997f73de81c97d2dd624c4512d2bfd77e5403b72 Mon Sep 17 00:00:00 2001
From: Todd Whiteman <todd.whiteman@joyent.com>
Date: Tue, 13 Mar 2018 13:29:32 -0700
Subject: [PATCH] TRITON-53 x-account image clone

---
 CHANGES.md   | 4 ++++
 lib/index.js | 9 +++++++++
 package.json | 2 +-
 3 files changed, 14 insertions(+), 1 deletion(-)

diff --git a/CHANGES.md b/CHANGES.md
index 961fab5..9faee9d 100644
--- a/CHANGES.md
+++ b/CHANGES.md
@@ -4,6 +4,10 @@
 
 (nothing yet)
 
+## 1.1.5
+
+- TRITON-53: Add 'triton.provision.allow_shared_images' tag
+
 ## 1.1.4
 
 - DOCKER-1020: Add 'triton.network.public' tag
diff --git a/lib/index.js b/lib/index.js
index 7be9f55..1e2a0bc 100644
--- a/lib/index.js
+++ b/lib/index.js
@@ -23,6 +23,9 @@
  *   by the CNS service.
  * - `triton.network.public` (string): Set on a VM, used to specify the external
  *   network name a VM will use.
+ * - `triton.provision.allow_shared_images` (boolean): Set on a VM, used to
+ *   allow provisioning of a VM from a shared image (otherwise disabled by
+ *   default).
  */
 
 var assert = require('assert-plus');
@@ -42,6 +45,7 @@ var typeFromKey = {
     'triton.cns.disable': 'boolean',
     'triton.cns.reverse_ptr': 'string',
     'triton.network.public': 'string',
+    'triton.provision.allow_shared_images': 'boolean',
 
     // Internal testing Triton tags
     'triton._test.string': 'string',
@@ -144,6 +148,11 @@ var validatorFromKey = {
         return null;
     },
 
+    'triton.provision.allow_shared_images': function valTritonSharedImage(val) {
+        assert.bool(val, 'val');
+        return null;
+    },
+
     /*
      * Triton tags used for internal testing.
      */
diff --git a/package.json b/package.json
index b24211c..3ffda32 100644
--- a/package.json
+++ b/package.json
@@ -1,7 +1,7 @@
 {
   "name": "triton-tags",
   "description": "Triton tags parsing and validation",
-  "version": "1.1.4",
+  "version": "1.1.5",
   "author": "Joyent (joyent.com)",
   "dependencies": {
     "assert-plus": "^1.0.0"
-- 
2.21.0

