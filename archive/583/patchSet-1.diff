From 59ad9ffcbd0909d9fb968fd20325977affb14098 Mon Sep 17 00:00:00 2001
From: Trent Mick <trentm@gmail.com>
Date: Mon, 3 Oct 2016 15:21:41 -0700
Subject: [PATCH] DOCKER-605 agree on, and then decommission "hostvolume"
 support

---
 Makefile              | 40 ----------------------------------------
 targets.json.in       | 16 ----------------
 tools/purge-mg-builds |  1 -
 3 files changed, 57 deletions(-)

diff --git a/Makefile b/Makefile
index cf45106..1005464 100644
--- a/Makefile
+++ b/Makefile
@@ -633,46 +633,6 @@ clean_nat:
 	(cd build/sdc-nat && gmake clean)
 
 
-#---- HOSTVOLUME
-
-_hostvolume_stamp=$(SDC_HOSTVOLUME_BRANCH)-$(TIMESTAMP)-g$(SDC_HOSTVOLUME_SHA)
-HOSTVOLUME_BITS=$(BITS_DIR)/hostvolume/hostvolume-pkg-$(_hostvolume_stamp).tar.bz2
-HOSTVOLUME_IMAGE_BIT=$(BITS_DIR)/hostvolume/hostvolume-zfs-$(_hostvolume_stamp).zfs.gz
-HOSTVOLUME_MANIFEST_BIT=$(BITS_DIR)/hostvolume/hostvolume-zfs-$(_hostvolume_stamp).imgmanifest
-
-.PHONY: hostvolume
-hostvolume: $(HOSTVOLUME_BITS) hostvolume_image
-
-$(HOSTVOLUME_BITS): build/sdc-hostvolume
-	@echo "# Build hostvolume: branch $(SDC_HOSTVOLUME_BRANCH), sha $(SDC_HOSTVOLUME_SHA), time `date -u +%Y%m%dT%H%M%SZ`"
-	mkdir -p $(BITS_DIR)
-	(cd build/sdc-hostvolume && NPM_CONFIG_CACHE=$(MG_CACHE_DIR)/npm TIMESTAMP=$(TIMESTAMP) BITS_DIR=$(BITS_DIR) gmake release test publish)
-	@echo "# Created hostvolume bits (time `date -u +%Y%m%dT%H%M%SZ`):"
-	@ls -l $(HOSTVOLUME_BITS)
-	@echo ""
-
-.PHONY: hostvolume_image
-hostvolume_image: $(HOSTVOLUME_IMAGE_BIT)
-
-$(HOSTVOLUME_IMAGE_BIT): $(HOSTVOLUME_BITS)
-	@echo "# Build hostvolume_image: branch $(SDC_HOSTVOLUME_BRANCH), sha $(SDC_HOSTVOLUME_SHA), time `date -u +%Y%m%dT%H%M%SZ`"
-	./tools/prep_dataset_in_jpc.sh -i "$(HOSTVOLUME_IMAGE_UUID)" -t $(HOSTVOLUME_BITS) \
-		-o "$(HOSTVOLUME_IMAGE_BIT)" -p $(HOSTVOLUME_PKGSRC) -O "$(MG_OUT_PATH)" \
-		-t $(HOSTVOLUME_EXTRA_TARBALLS) -n $(HOSTVOLUME_IMAGE_NAME) \
-		-v $(_hostvolume_stamp) -d $(HOSTVOLUME_IMAGE_DESCRIPTION)
-	@echo "# Created hostvolume image (time `date -u +%Y%m%dT%H%M%SZ`):"
-	@ls -l $$(dirname $(HOSTVOLUME_IMAGE_BIT))
-	@echo ""
-
-hostvolume_publish_image: $(HOSTVOLUME_IMAGE_BIT)
-	@echo "# Publish hostvolume image to SDC Updates repo."
-	$(UPDATES_IMGADM) import -ddd -m $(HOSTVOLUME_MANIFEST_BIT) -f $(HOSTVOLUME_IMAGE_BIT)
-
-clean_hostvolume:
-	$(RM) -rf $(BITS_DIR)/hostvolume
-	(cd build/sdc-hostvolume && gmake clean)
-
-
 #---- DOCKER
 
 _docker_stamp=$(SDC_DOCKER_BRANCH)-$(TIMESTAMP)-g$(SDC_DOCKER_SHA)
diff --git a/targets.json.in b/targets.json.in
index 4939bda..33eeabb 100644
--- a/targets.json.in
+++ b/targets.json.in
@@ -394,22 +394,6 @@ cat <<EOF
     "pkgsrc": [],
     "tarballs": []
   },
-  "hostvolume": {
-    "appliance": "true",
-    "image_name": "hostvolume",
-    "image_description": "SDC Docker host volume support zone",
-    "image_version": "1.1.0",
-    "image_uuid": "1e81e08c-d406-11e4-aac9-6feb515aeb81",
-    "repos": [
-      {"url": "git@github.com:joyent/sdc-hostvolume.git"}
-    ],
-    "public": true,
-    "deps": [],
-    "pkgsrc": [
-        "openssl-1.0.1p"
-    ],
-    "tarballs": []
-  },
   "docker": {
     "appliance": "true",
     "image_name": "docker",
diff --git a/tools/purge-mg-builds b/tools/purge-mg-builds
index 0271476..b8f334c 100755
--- a/tools/purge-mg-builds
+++ b/tools/purge-mg-builds
@@ -113,7 +113,6 @@ TTL_DAYS_FROM_NAME='{
     "gz-tools": 365,
     "hagfish-watcher": 365,
     "heartbeater": 365,
-    "hostvolume": 365,
     "imgapi": 365,
     "mackerel": 365,
     "madtom": 365,
-- 
2.21.0

