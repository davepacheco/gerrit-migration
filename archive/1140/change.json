{"project":"joyent/illumos-joyent","branch":"master","id":"Ide15e5b3cf5cbe29cd88bc9618e0514ecadfac5a","number":"1140","subject":"OS-1629 PCI addresses with physaddr \u003e 0xffffffff can\u0027t be mapped in OS-5860 pci/npe DDI_CTLOPS_REGSIZE should be 64-bit aware OS-5861 want OFF_MAX in the kernel OS-5859 unsupported 64-bit prefetch memory on pci-pci bridge Reviewed by: Patrick Mooney \u003cpatr","owner":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"url":"https://cr.joyent.us/1140","commitMessage":"OS-1629 PCI addresses with physaddr \u003e 0xffffffff can\u0027t be mapped in\nOS-5860 pci/npe DDI_CTLOPS_REGSIZE should be 64-bit aware\nOS-5861 want OFF_MAX in the kernel\nOS-5859 unsupported 64-bit prefetch memory on pci-pci bridge\nReviewed by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e\nReviewed by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e\nApproved by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e\n","createdOn":1481933000,"lastUpdated":1482520839,"open":false,"status":"MERGED","comments":[{"timestamp":1481933000,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Uploaded patch set 1."},{"timestamp":1482155881,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 1:\n\n(3 comments)"},{"timestamp":1482251106,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 1:\n\n(3 comments)\n\nHey Jerry, I had a few questions here which if you could answer, I\u0027d appreciate. I ended up also combining this with some of the PCI bridge work, so I\u0027ll post a single update that has all of that."},{"timestamp":1482299362,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Uploaded patch set 2."},{"timestamp":1482326756,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1482329209,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1482346982,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Uploaded patch set 3."},{"timestamp":1482347704,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1482355532,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 3:\n\n(15 comments)"},{"timestamp":1482436189,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Uploaded patch set 4."},{"timestamp":1482436197,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 3:\n\n(15 comments)"},{"timestamp":1482436646,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 4: Code-Review+1"},{"timestamp":1482440352,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 4:\n\n(1 comment)\n\nOne clarification question."},{"timestamp":1482440431,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 4:\n\n(1 comment)"},{"timestamp":1482440479,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 4: Code-Review+1"},{"timestamp":1482445035,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 4:\n\nTo test this, I went through and set up a couple different systems:\n\n1) A system in KVM that uses the \u0027pci\u0027 driver as its primary device driver\n2) An Ivy Bridge and Haswell based uniprocessor system that doesn\u0027t have anything about 64-bits\n3) A 2 socket Broadwell system that is loaded with lots of 10 GbE devices which has devices which end up having PCIe devices and PCI bridges that end up getting addresses assigned 64-bits.\n\nI did basic testing of the different controllers that were plugged in on both debug and non-debug builds. I verified that everything enumerated properly and that the NICs, for example, appeared to have all the data reported from its registers as accurate.\n\nI stress tested a few devices, an i40e, nvme, etc. and the devices seemed to be working as expected."},{"timestamp":1482445254,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 4: Integration-Approval+1"},{"timestamp":1482450348,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Uploaded patch set 5: Patch Set 4 was rebased."},{"timestamp":1482520427,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Uploaded patch set 6: Commit message was updated."},{"timestamp":1482520471,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Uploaded patch set 7: Patch Set 6 was rebased."},{"timestamp":1482520839,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Robert Mustacchi"}],"currentPatchSet":{"number":"7","revision":"de15e5b3cf5cbe29cd88bc9618e0514ecadfac5a","parents":["696b52570287ab2055ae727bddf6657c667fedbf"],"ref":"refs/changes/40/1140/7","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1482520471,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1482436646,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1482440479,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1482445254,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"SUBM","value":"1","grantedOn":1482520839,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":13,"deletions":0},{"file":"usr/src/uts/common/sys/ddi_impldefs.h","type":"MODIFIED","insertions":12,"deletions":0},{"file":"usr/src/uts/common/sys/ddimapreq.h","type":"MODIFIED","insertions":15,"deletions":-3},{"file":"usr/src/uts/common/sys/pci.h","type":"MODIFIED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/sys/types.h","type":"MODIFIED","insertions":9,"deletions":0},{"file":"usr/src/uts/i86pc/io/pci/pci.c","type":"MODIFIED","insertions":64,"deletions":-54},{"file":"usr/src/uts/i86pc/io/pciex/npe.c","type":"MODIFIED","insertions":56,"deletions":-46},{"file":"usr/src/uts/i86pc/io/rootnex.c","type":"MODIFIED","insertions":64,"deletions":-61},{"file":"usr/src/uts/intel/io/pci/pci_boot.c","type":"MODIFIED","insertions":60,"deletions":-39},{"file":"usr/src/uts/intel/io/pci/pci_resource.c","type":"MODIFIED","insertions":7,"deletions":-9}],"sizeInsertions":294,"sizeDeletions":-212},"patchSets":[{"number":"1","revision":"c4f3145f9b2426af0faf54345f0d7ce9c13f2b3f","parents":["6dec4b8146b2d4a9b4bc5b69d92611009b363154"],"ref":"refs/changes/40/1140/1","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1481933000,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/uts/common/sys/ddimapreq.h","line":105,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Is this \"map_flags\"? If so, it might be clearer to use the actual variable name."},{"file":"usr/src/uts/common/sys/ddimapreq.h","line":105,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I changed that to map_flags."},{"file":"usr/src/uts/common/sys/ddimapreq.h","line":114,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Is there a reason you\u0027re starting with the highest bit? Usually with bit flags we would start with the lowest bit in the range (i.e. 0x1000000 in this case) and add more bit flags as time goes on."},{"file":"usr/src/uts/common/sys/ddimapreq.h","line":114,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I\u0027ve changed the comment to just say we\u0027re starting from the top and then working down. There\u0027s no need for us to specify an explicit number of bits. Basically the idea here is to make sure that common bits can expand from the bottom up and platform-specific bits from top down, so we minimize the chance of overlapping them."},{"file":"usr/src/uts/i86pc/io/rootnex.c","line":897,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"I see that you\u0027re checking for the new flag here, then setting the new flag into map_flags, but I don\u0027t see anyplace else where you check map_flags again for DDI_MF_EXT_REGSPEC. Are you just setting the bit here for completeness or is there some other place in the code that needs to check this flag further along?"},{"file":"usr/src/uts/i86pc/io/rootnex.c","line":897,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I\u0027m setting this for completeness at the moment, so that way other callers can assume it\u0027s there. Perhaps I should modify rootnex_map_regspec() and co. to ASSERT that it\u0027s there? What do you think?"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/uts/common/sys/ddi_impldefs.h","type":"MODIFIED","insertions":12,"deletions":0},{"file":"usr/src/uts/common/sys/ddimapreq.h","type":"MODIFIED","insertions":14,"deletions":-3},{"file":"usr/src/uts/common/sys/types.h","type":"MODIFIED","insertions":9,"deletions":0},{"file":"usr/src/uts/i86pc/io/pci/pci.c","type":"MODIFIED","insertions":57,"deletions":-56},{"file":"usr/src/uts/i86pc/io/pciex/npe.c","type":"MODIFIED","insertions":51,"deletions":-44},{"file":"usr/src/uts/i86pc/io/rootnex.c","type":"MODIFIED","insertions":63,"deletions":-49}],"sizeInsertions":206,"sizeDeletions":-152},{"number":"2","revision":"8fd823eeb0bf26ffc6cc892e97630eb5d424ec16","parents":["8572b2205bd02bfe3a6fe609833f8450b8c263d7"],"ref":"refs/changes/40/1140/2","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1482299362,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/uts/common/sys/pci.h","line":121,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Shouldn\u0027t this have an explicit value?"},{"file":"usr/src/uts/common/sys/pci.h","line":121,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"It looks like this was a draft version of this that\u0027s no longer used that I forgot to remove. I\u0027m just going to delete those lines."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/uts/common/sys/ddi_impldefs.h","type":"MODIFIED","insertions":12,"deletions":0},{"file":"usr/src/uts/common/sys/ddimapreq.h","type":"MODIFIED","insertions":15,"deletions":-3},{"file":"usr/src/uts/common/sys/pci.h","type":"MODIFIED","insertions":13,"deletions":0},{"file":"usr/src/uts/common/sys/types.h","type":"MODIFIED","insertions":9,"deletions":0},{"file":"usr/src/uts/i86pc/io/pci/pci.c","type":"MODIFIED","insertions":57,"deletions":-56},{"file":"usr/src/uts/i86pc/io/pciex/npe.c","type":"MODIFIED","insertions":51,"deletions":-44},{"file":"usr/src/uts/i86pc/io/rootnex.c","type":"MODIFIED","insertions":65,"deletions":-49},{"file":"usr/src/uts/intel/io/pci/pci_boot.c","type":"MODIFIED","insertions":60,"deletions":-39},{"file":"usr/src/uts/intel/io/pci/pci_resource.c","type":"MODIFIED","insertions":7,"deletions":-9}],"sizeInsertions":289,"sizeDeletions":-200},{"number":"3","revision":"db6e82f7fc0d9117abc2dccc570d54c9ee2101db","parents":["8572b2205bd02bfe3a6fe609833f8450b8c263d7"],"ref":"refs/changes/40/1140/3","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1482346982,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1482347704,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"comments":[{"file":"usr/src/uts/i86pc/io/pci/pci.c","line":442,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Minor nit: These two-line \u0027\u003d\u0027-followed-by-\u0027|\u003d\u0027 assignments differ from all of the other 64-bit or-and-shift calculations in the wad.  Consistency would be good."},{"file":"usr/src/uts/i86pc/io/pci/pci.c","line":442,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"},{"file":"usr/src/uts/i86pc/io/pci/pci.c","line":448,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Is there any reason to suspect that overflow is possible here?"},{"file":"usr/src/uts/i86pc/io/pci/pci.c","line":448,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"It\u0027s always theoretically possible. So I guess we might as well check just in case. The previous code just blindly did the math."},{"file":"usr/src/uts/i86pc/io/pci/pci.c","line":488,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Thoughts on choosing a more descriptive name for \u0027length\u0027 to differentiate it from \u0027len\u0027."},{"file":"usr/src/uts/i86pc/io/pci/pci.c","line":488,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"},{"file":"usr/src/uts/i86pc/io/pci/pci.c","line":536,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Dubious usage below.  If it is needed for that, perhaps scope it inside the block?"},{"file":"usr/src/uts/i86pc/io/pci/pci.c","line":536,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"This was due to missing deletions. I\u0027ve moved it into the lower scope."},{"file":"usr/src/uts/i86pc/io/pci/pci.c","line":579,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Using uninitialized \u0027rn\u0027 value"},{"file":"usr/src/uts/i86pc/io/pci/pci.c","line":579,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I restored the part that got accidentally deleted. Thanks for catching that."},{"file":"usr/src/uts/i86pc/io/pciex/npe.c","line":748,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Perhaps move the \u0027rn\u0027 definition to this scope?"},{"file":"usr/src/uts/i86pc/io/pciex/npe.c","line":748,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"},{"file":"usr/src/uts/i86pc/io/rootnex.c","line":871,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"This would probably be clearer with underscores, since we aren\u0027t doing the rnumber-\u003eregspec comparison below."},{"file":"usr/src/uts/i86pc/io/rootnex.c","line":871,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"},{"file":"usr/src/uts/i86pc/io/rootnex.c","line":959,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"The wording here is rather awkward."},{"file":"usr/src/uts/i86pc/io/rootnex.c","line":959,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"},{"file":"usr/src/uts/i86pc/io/rootnex.c","line":1229,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Nuke the comment like above?"},{"file":"usr/src/uts/i86pc/io/rootnex.c","line":1229,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"},{"file":"usr/src/uts/i86pc/io/rootnex.c","line":1286,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Nuke the comment like above?"},{"file":"usr/src/uts/i86pc/io/rootnex.c","line":1286,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"},{"file":"usr/src/uts/intel/io/pci/pci_boot.c","line":1087,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Would it make sense to add a comment about why the new conditional is here?  I haven\u0027t read enough of the PCI spec to grok this."},{"file":"usr/src/uts/intel/io/pci/pci_boot.c","line":1087,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"},{"file":"usr/src/uts/intel/io/pci/pci_boot.c","line":2868,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"lowercase this to match above code."},{"file":"usr/src/uts/intel/io/pci/pci_boot.c","line":2868,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"},{"file":"usr/src/uts/intel/io/pci/pci_boot.c","line":2908,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Ditto about lowercase"},{"file":"usr/src/uts/intel/io/pci/pci_boot.c","line":2908,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"},{"file":"usr/src/uts/intel/io/pci/pci_boot.c","line":2932,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Ditto about lowercase"},{"file":"usr/src/uts/intel/io/pci/pci_boot.c","line":2932,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Done"},{"file":"usr/src/uts/intel/io/pci/pci_boot.c","line":3117,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Should this check \u0027(address + size) \u003e\u003d UINT32_MAX\u0027 too?"},{"file":"usr/src/uts/intel/io/pci/pci_boot.c","line":3117,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"So, I don\u0027t think we should. Though I\u0027ll admit the PCI specification is a bit vague on which of these it ends up falling into. It seems it\u0027s possible to have a BAR that\u0027s in that; however, it\u0027s also a bit confusing for how we convert that to a PCI range, when it was never in that form to begin with."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/uts/common/sys/ddi_impldefs.h","type":"MODIFIED","insertions":12,"deletions":0},{"file":"usr/src/uts/common/sys/ddimapreq.h","type":"MODIFIED","insertions":15,"deletions":-3},{"file":"usr/src/uts/common/sys/pci.h","type":"MODIFIED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/sys/types.h","type":"MODIFIED","insertions":9,"deletions":0},{"file":"usr/src/uts/i86pc/io/pci/pci.c","type":"MODIFIED","insertions":57,"deletions":-56},{"file":"usr/src/uts/i86pc/io/pciex/npe.c","type":"MODIFIED","insertions":51,"deletions":-44},{"file":"usr/src/uts/i86pc/io/rootnex.c","type":"MODIFIED","insertions":65,"deletions":-49},{"file":"usr/src/uts/intel/io/pci/pci_boot.c","type":"MODIFIED","insertions":60,"deletions":-39},{"file":"usr/src/uts/intel/io/pci/pci_resource.c","type":"MODIFIED","insertions":7,"deletions":-9}],"sizeInsertions":283,"sizeDeletions":-200},{"number":"4","revision":"aa9a504cbade47971f9d94b5cbd6bcd28659847d","parents":["826aed25de4c9b911d0fd07fa6236d199eaff2a6"],"ref":"refs/changes/40/1140/4","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1482436189,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1482440479,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1482445254,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1482436646,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"comments":[{"file":"usr/src/uts/i86pc/io/pci/pci.c","line":491,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"the previous diff was using \u0027pci_phys_mid\u0027 and \u0027pci_phys_low\u0027. Did you mean to change these variables as part of changing \u0027length\u0027 to \u0027pci_rlength\u0027? It looks like this now matches npe.c where you get the length, but I\u0027d like to be sure."},{"file":"usr/src/uts/i86pc/io/pci/pci.c","line":491,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Yes, that was intentional. In fact the PCI driver was pretty broken with that. As we were using the address when we meant a length! I\u0027ve also gone back and found a way to get a system without a PCI express root complex and just a PCI one to test this with."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/uts/common/sys/ddi_impldefs.h","type":"MODIFIED","insertions":12,"deletions":0},{"file":"usr/src/uts/common/sys/ddimapreq.h","type":"MODIFIED","insertions":15,"deletions":-3},{"file":"usr/src/uts/common/sys/pci.h","type":"MODIFIED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/sys/types.h","type":"MODIFIED","insertions":9,"deletions":0},{"file":"usr/src/uts/i86pc/io/pci/pci.c","type":"MODIFIED","insertions":64,"deletions":-54},{"file":"usr/src/uts/i86pc/io/pciex/npe.c","type":"MODIFIED","insertions":56,"deletions":-46},{"file":"usr/src/uts/i86pc/io/rootnex.c","type":"MODIFIED","insertions":64,"deletions":-61},{"file":"usr/src/uts/intel/io/pci/pci_boot.c","type":"MODIFIED","insertions":60,"deletions":-39},{"file":"usr/src/uts/intel/io/pci/pci_resource.c","type":"MODIFIED","insertions":7,"deletions":-9}],"sizeInsertions":294,"sizeDeletions":-212},{"number":"5","revision":"533bc55be7154f10431725c049782afceef93bf8","parents":["5a859e8d1c090b10cf82408f7c51c78f93dd543f"],"ref":"refs/changes/40/1140/5","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1482450348,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1482440479,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1482445254,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1482436646,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/uts/common/sys/ddi_impldefs.h","type":"MODIFIED","insertions":12,"deletions":0},{"file":"usr/src/uts/common/sys/ddimapreq.h","type":"MODIFIED","insertions":15,"deletions":-3},{"file":"usr/src/uts/common/sys/pci.h","type":"MODIFIED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/sys/types.h","type":"MODIFIED","insertions":9,"deletions":0},{"file":"usr/src/uts/i86pc/io/pci/pci.c","type":"MODIFIED","insertions":64,"deletions":-54},{"file":"usr/src/uts/i86pc/io/pciex/npe.c","type":"MODIFIED","insertions":56,"deletions":-46},{"file":"usr/src/uts/i86pc/io/rootnex.c","type":"MODIFIED","insertions":64,"deletions":-61},{"file":"usr/src/uts/intel/io/pci/pci_boot.c","type":"MODIFIED","insertions":60,"deletions":-39},{"file":"usr/src/uts/intel/io/pci/pci_resource.c","type":"MODIFIED","insertions":7,"deletions":-9}],"sizeInsertions":294,"sizeDeletions":-212},{"number":"6","revision":"4b5701026898057e435bf6049e2f58456141cd37","parents":["5a859e8d1c090b10cf82408f7c51c78f93dd543f"],"ref":"refs/changes/40/1140/6","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1482520427,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1482440479,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1482445254,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1482436646,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":13,"deletions":0},{"file":"usr/src/uts/common/sys/ddi_impldefs.h","type":"MODIFIED","insertions":12,"deletions":0},{"file":"usr/src/uts/common/sys/ddimapreq.h","type":"MODIFIED","insertions":15,"deletions":-3},{"file":"usr/src/uts/common/sys/pci.h","type":"MODIFIED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/sys/types.h","type":"MODIFIED","insertions":9,"deletions":0},{"file":"usr/src/uts/i86pc/io/pci/pci.c","type":"MODIFIED","insertions":64,"deletions":-54},{"file":"usr/src/uts/i86pc/io/pciex/npe.c","type":"MODIFIED","insertions":56,"deletions":-46},{"file":"usr/src/uts/i86pc/io/rootnex.c","type":"MODIFIED","insertions":64,"deletions":-61},{"file":"usr/src/uts/intel/io/pci/pci_boot.c","type":"MODIFIED","insertions":60,"deletions":-39},{"file":"usr/src/uts/intel/io/pci/pci_resource.c","type":"MODIFIED","insertions":7,"deletions":-9}],"sizeInsertions":294,"sizeDeletions":-212},{"number":"7","revision":"de15e5b3cf5cbe29cd88bc9618e0514ecadfac5a","parents":["696b52570287ab2055ae727bddf6657c667fedbf"],"ref":"refs/changes/40/1140/7","uploader":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"createdOn":1482520471,"author":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"SUBM","value":"1","grantedOn":1482520839,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1482440479,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1482445254,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1482436646,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":13,"deletions":0},{"file":"usr/src/uts/common/sys/ddi_impldefs.h","type":"MODIFIED","insertions":12,"deletions":0},{"file":"usr/src/uts/common/sys/ddimapreq.h","type":"MODIFIED","insertions":15,"deletions":-3},{"file":"usr/src/uts/common/sys/pci.h","type":"MODIFIED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/sys/types.h","type":"MODIFIED","insertions":9,"deletions":0},{"file":"usr/src/uts/i86pc/io/pci/pci.c","type":"MODIFIED","insertions":64,"deletions":-54},{"file":"usr/src/uts/i86pc/io/pciex/npe.c","type":"MODIFIED","insertions":56,"deletions":-46},{"file":"usr/src/uts/i86pc/io/rootnex.c","type":"MODIFIED","insertions":64,"deletions":-61},{"file":"usr/src/uts/intel/io/pci/pci_boot.c","type":"MODIFIED","insertions":60,"deletions":-39},{"file":"usr/src/uts/intel/io/pci/pci_resource.c","type":"MODIFIED","insertions":7,"deletions":-9}],"sizeInsertions":294,"sizeDeletions":-212}],"allReviewers":[{"name":"Bryan Cantrill","email":"bryan@joyent.com","username":"bcantrill"},{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}]}