{"project":"joyent/illumos-joyent","branch":"master","id":"I0e957fcabecc0abb13226b12f474359f4ea711ea","number":"3597","subject":"OS-6759 want CPU localization for vmm callouts Reviewed by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e Reviewed by: John Levon \u003cjohn.levon@joyent.com\u003e Approved by: Mike Gerdts \u003cmike.gerdts@joyent.com\u003e","owner":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"url":"https://cr.joyent.us/3597","commitMessage":"OS-6759 want CPU localization for vmm callouts\nReviewed by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e\nReviewed by: John Levon \u003cjohn.levon@joyent.com\u003e\nApproved by: Mike Gerdts \u003cmike.gerdts@joyent.com\u003e\n","createdOn":1520890535,"lastUpdated":1520972827,"open":false,"status":"MERGED","comments":[{"timestamp":1520890535,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 1."},{"timestamp":1520890731,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 1:\n\nI tested this on both non-DEBUG and DEBUG.  Specifically, the msgctl11 workload from LTP was used as a convenient means of inducing the Linux guest to pound on its APICs for scheduling.  Without the patch, the crosscall volume is extremely high as all the callouts were allocated on a single CPU at the time of initialization.  With the patch, the crosscall and mutex-spin counts are way down as localization keeps most of the work on the CPU."},{"timestamp":1520893720,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1520895773,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 1: Code-Review+1"},{"timestamp":1520953909,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 1: Code-Review+1"},{"timestamp":1520957897,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 1: Integration-Approval+1"},{"timestamp":1520972670,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 2: Patch Set 1 was rebased."},{"timestamp":1520972808,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 3: Commit message was updated."},{"timestamp":1520972827,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Patrick Mooney"}],"currentPatchSet":{"number":"3","revision":"0e957fcabecc0abb13226b12f474359f4ea711ea","parents":["b13e485c93c36fd37d5470756bc0f7d7bd44d018"],"ref":"refs/changes/97/3597/3","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1520972808,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1520895773,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1520953909,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1520957897,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}},{"type":"SUBM","value":"1","grantedOn":1520972827,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/compat/freebsd/sys/callout.h","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/io/vhpet.c","type":"MODIFIED","insertions":13,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/io/vhpet.h","type":"MODIFIED","insertions":8,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic.c","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic.h","type":"MODIFIED","insertions":9,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/io/vrtc.c","type":"MODIFIED","insertions":12,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/io/vrtc.h","type":"MODIFIED","insertions":8,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/vmm.c","type":"MODIFIED","insertions":36,"deletions":-1},{"file":"usr/src/uts/i86pc/io/vmm/vmm_sol_glue.c","type":"MODIFIED","insertions":24,"deletions":-1}],"sizeInsertions":123,"sizeDeletions":-3},"patchSets":[{"number":"1","revision":"62f54038a5667d1edc6871712fbfa488fb00bf09","parents":["b4d3cc05ba69320101da4e02e8d10f11063f2ff7"],"ref":"refs/changes/97/3597/1","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1520890535,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1520895773,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1520957897,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1520953909,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"comments":[{"file":"usr/src/uts/i86pc/io/vmm/vmm_sol_glue.c","line":428,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Is this new function supposed to be called by some other code in the current CR or is it just here for future use?"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/compat/freebsd/sys/callout.h","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/io/vhpet.c","type":"MODIFIED","insertions":13,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/io/vhpet.h","type":"MODIFIED","insertions":8,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic.c","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic.h","type":"MODIFIED","insertions":9,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/io/vrtc.c","type":"MODIFIED","insertions":12,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/io/vrtc.h","type":"MODIFIED","insertions":8,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/vmm.c","type":"MODIFIED","insertions":36,"deletions":-1},{"file":"usr/src/uts/i86pc/io/vmm/vmm_sol_glue.c","type":"MODIFIED","insertions":24,"deletions":-1}],"sizeInsertions":123,"sizeDeletions":-3},{"number":"2","revision":"988f7f4524482fb635d80e759af46986971ee38b","parents":["b13e485c93c36fd37d5470756bc0f7d7bd44d018"],"ref":"refs/changes/97/3597/2","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1520972670,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1520895773,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1520957897,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1520953909,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/compat/freebsd/sys/callout.h","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/io/vhpet.c","type":"MODIFIED","insertions":13,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/io/vhpet.h","type":"MODIFIED","insertions":8,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic.c","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic.h","type":"MODIFIED","insertions":9,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/io/vrtc.c","type":"MODIFIED","insertions":12,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/io/vrtc.h","type":"MODIFIED","insertions":8,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/vmm.c","type":"MODIFIED","insertions":36,"deletions":-1},{"file":"usr/src/uts/i86pc/io/vmm/vmm_sol_glue.c","type":"MODIFIED","insertions":24,"deletions":-1}],"sizeInsertions":123,"sizeDeletions":-3},{"number":"3","revision":"0e957fcabecc0abb13226b12f474359f4ea711ea","parents":["b13e485c93c36fd37d5470756bc0f7d7bd44d018"],"ref":"refs/changes/97/3597/3","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1520972808,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1520895773,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"SUBM","value":"1","grantedOn":1520972827,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1520957897,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1520953909,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/compat/freebsd/sys/callout.h","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/io/vhpet.c","type":"MODIFIED","insertions":13,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/io/vhpet.h","type":"MODIFIED","insertions":8,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic.c","type":"MODIFIED","insertions":9,"deletions":-1},{"file":"usr/src/uts/i86pc/io/vmm/io/vlapic.h","type":"MODIFIED","insertions":9,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/io/vrtc.c","type":"MODIFIED","insertions":12,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/io/vrtc.h","type":"MODIFIED","insertions":8,"deletions":0},{"file":"usr/src/uts/i86pc/io/vmm/vmm.c","type":"MODIFIED","insertions":36,"deletions":-1},{"file":"usr/src/uts/i86pc/io/vmm/vmm_sol_glue.c","type":"MODIFIED","insertions":24,"deletions":-1}],"sizeInsertions":123,"sizeDeletions":-3}],"allReviewers":[{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}]}