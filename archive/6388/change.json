{"project":"joyent/sdc-cloudapi","branch":"master","id":"Idb48a87b50d152ad0e2834661fa56be7f0725704","number":"6388","subject":"TRITON-1708 CloudAPI should validate package.brand value against image.type before setting machines brand Reviewed by: Mike Gerdts \u003cmike.gerdts@joyent.com\u003e Reviewed by: Todd Whiteman \u003ctodd.whiteman@joyent.com\u003e Approved by: Todd Whiteman \u003ctodd.whiteman@joy","owner":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"url":"https://cr.joyent.us/6388","commitMessage":"TRITON-1708 CloudAPI should validate package.brand value against image.type before setting machines brand\nReviewed by: Mike Gerdts \u003cmike.gerdts@joyent.com\u003e\nReviewed by: Todd Whiteman \u003ctodd.whiteman@joyent.com\u003e\nApproved by: Todd Whiteman \u003ctodd.whiteman@joyent.com\u003e\n","createdOn":1559660680,"lastUpdated":1559749844,"open":false,"status":"MERGED","comments":[{"timestamp":1559660680,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 1."},{"timestamp":1559660685,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit 755f61e618b301863c036cfd8f1da12f7027d9f3\n    \n    TRITON-1708 CloudAPI should validate package.brand value against image.type before setting machines brand"},{"timestamp":1559660721,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing-1\n\n(1 comment)\n\n\"make check\" exited with status 2"},{"timestamp":1559661606,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 2."},{"timestamp":1559661611,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit 3a05c011f54b5bd5a1d4e11136191d99695a8a41\n    \n    TRITON-1708 CloudAPI should validate package.brand value against image.type before setting machines brand"},{"timestamp":1559661656,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1559663804,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Patch Set 2: Code-Review+1 Integration-Approval+1\n\n(2 comments)"},{"timestamp":1559664794,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 3."},{"timestamp":1559664799,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 3:\n\nNew commits:\n    \n    commit f0af2c714ab397b69b94adc00f8e3cd1b41b6ba6\n    \n    TRITON-1708 CloudAPI should validate package.brand value against image.type before setting machines brand"},{"timestamp":1559664820,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 2:\n\n(2 comments)\n\nRe-based and applied the suggestion to drop the variable. Mind to re-check Todd?"},{"timestamp":1559664841,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1559665819,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Patch Set 3:\n\n(1 comment)"},{"timestamp":1559670222,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 3:\n\nLooks good, aside from the small change suggested by Todd."},{"timestamp":1559743850,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 4."},{"timestamp":1559743856,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 4:\n\nNew commits:\n    \n    commit 7d8ac635d6fc2b8f57002be528d676c5c1156fc5\n    \n    TRITON-1708 CloudAPI should validate package.brand value against image.type before setting machines brand"},{"timestamp":1559743868,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 3:\n\n(1 comment)\n\nDone with the suggested change!"},{"timestamp":1559743907,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1559746346,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 4: Code-Review+1"},{"timestamp":1559749226,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Patch Set 4: Code-Review+1 Integration-Approval+1"},{"timestamp":1559749826,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Uploaded patch set 5: Commit message was updated."},{"timestamp":1559749844,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Pedro Palazón Candel"}],"currentPatchSet":{"number":"5","revision":"db48a87b50d152ad0e2834661fa56be7f0725704","parents":["721e7252763e14bbe0e5f888aa9630500793a7cb"],"ref":"refs/changes/88/6388/5","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1559749826,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1559743907,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1559746346,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1559749226,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1559749226,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}},{"type":"SUBM","value":"1","grantedOn":1559749844,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"lib/machines.js","type":"MODIFIED","insertions":16,"deletions":0},{"file":"test/getCreateOptions.test.js","type":"MODIFIED","insertions":38,"deletions":-1}],"sizeInsertions":54,"sizeDeletions":-1},"patchSets":[{"number":"1","revision":"b4626962d243e8e90a660a4f63347cd5c2efe4b4","parents":["b0d7bf4e39cae5af2b81d42d454e3a949814f196"],"ref":"refs/changes/88/6388/1","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1559660680,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1559660721,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"test/getCreateOptions.test.js","line":342,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"warning: redeclaration of _getPayload"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/machines.js","type":"MODIFIED","insertions":24,"deletions":-1},{"file":"test/getCreateOptions.test.js","type":"MODIFIED","insertions":37,"deletions":-1}],"sizeInsertions":61,"sizeDeletions":-2},{"number":"2","revision":"0227cb2734ec762e37941efbcab0e3af41c0a522","parents":["b0d7bf4e39cae5af2b81d42d454e3a949814f196"],"ref":"refs/changes/88/6388/2","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1559661606,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1559661656,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1559663804,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1559663804,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}}],"comments":[{"file":"lib/machines.js","line":429,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Was this meant to be VALID_BRANDS ? Otherwise it seems it\u0027s a repeat of the previous if statement."},{"file":"lib/machines.js","line":429,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"No, it means to be \"not in valid hvm brands\", i.e. just \"lx\", \"joyent\", \"Joyent-minimal\""},{"file":"lib/machines.js","line":439,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"You don\u0027t need this \u0027validPkgBrand\u0027 variable (you can drop all usage of it) - if you reach this point then the package brand must be valid, right?"},{"file":"lib/machines.js","line":439,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Good call"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/machines.js","type":"MODIFIED","insertions":24,"deletions":-1},{"file":"test/getCreateOptions.test.js","type":"MODIFIED","insertions":38,"deletions":-1}],"sizeInsertions":62,"sizeDeletions":-2},{"number":"3","revision":"d4258e9a4b0a294f25ab0d26eac0f0fa7725df12","parents":["721e7252763e14bbe0e5f888aa9630500793a7cb"],"ref":"refs/changes/88/6388/3","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1559664794,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1559664841,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/machines.js","line":426,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"In that case this can just be \u0027} else {\u0027"},{"file":"lib/machines.js","line":426,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Indeed"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"lib/machines.js","type":"MODIFIED","insertions":16,"deletions":0},{"file":"test/getCreateOptions.test.js","type":"MODIFIED","insertions":38,"deletions":-1}],"sizeInsertions":54,"sizeDeletions":-1},{"number":"4","revision":"186647387197b677099bc0982b59e58cdbb70b4b","parents":["721e7252763e14bbe0e5f888aa9630500793a7cb"],"ref":"refs/changes/88/6388/4","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1559743850,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1559743907,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1559749226,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1559749226,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1559746346,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/machines.js","type":"MODIFIED","insertions":16,"deletions":0},{"file":"test/getCreateOptions.test.js","type":"MODIFIED","insertions":38,"deletions":-1}],"sizeInsertions":54,"sizeDeletions":-1},{"number":"5","revision":"db48a87b50d152ad0e2834661fa56be7f0725704","parents":["721e7252763e14bbe0e5f888aa9630500793a7cb"],"ref":"refs/changes/88/6388/5","uploader":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"createdOn":1559749826,"author":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1559743907,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"SUBM","value":"1","grantedOn":1559749844,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1559749226,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1559749226,"by":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1559746346,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"lib/machines.js","type":"MODIFIED","insertions":16,"deletions":0},{"file":"test/getCreateOptions.test.js","type":"MODIFIED","insertions":38,"deletions":-1}],"sizeInsertions":54,"sizeDeletions":-1}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}]}