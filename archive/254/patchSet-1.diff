From 3b73a3d68bfd98e8d7a5adbdbc462202f63e1339 Mon Sep 17 00:00:00 2001
From: Patrick Mooney <pmooney@pfmooney.com>
Date: Fri, 5 Aug 2016 18:59:05 +0000
Subject: [PATCH] OS-5579 lint errors in ACPI

---
 usr/src/uts/i86pc/cpudrv/Makefile               |  2 --
 usr/src/uts/i86pc/unix/Makefile                 | 11 -----------
 usr/src/uts/i86xpv/unix/Makefile                |  3 ---
 usr/src/uts/intel/acpica/Makefile               |  3 +--
 usr/src/uts/intel/sys/acpi/acpixf.h             |  4 ++++
 usr/src/uts/intel/sys/acpi/platform/acsolaris.h |  7 +++++++
 6 files changed, 12 insertions(+), 18 deletions(-)

diff --git a/usr/src/uts/i86pc/cpudrv/Makefile b/usr/src/uts/i86pc/cpudrv/Makefile
index 61a77839ab..73f67a9971 100644
--- a/usr/src/uts/i86pc/cpudrv/Makefile
+++ b/usr/src/uts/i86pc/cpudrv/Makefile
@@ -60,8 +60,6 @@ CERRWARN	+= -_gcc=-Wno-uninitialized
 CERRWARN	+= -_gcc=-Wno-parentheses
 CERRWARN	+= -_gcc=-Wno-unused-function
 
-EXTRA_OPTIONS	= -DACPI_USE_SYSTEM_CLIBRARY
-
 #
 # Link to acpica for ACPI services
 #
diff --git a/usr/src/uts/i86pc/unix/Makefile b/usr/src/uts/i86pc/unix/Makefile
index 2d024c5fb9..6fcd879327 100644
--- a/usr/src/uts/i86pc/unix/Makefile
+++ b/usr/src/uts/i86pc/unix/Makefile
@@ -126,17 +126,6 @@ CLEANLINTFILES	+= $(LINT_LIB) $(DBOOT_LINT_LIB) $(DBOOT_LINTS)
 $(OBJS_DIR)/instr_size.o :=	EXTRA_OPTIONS	= -I$(SRC)/common/dis/i386
 $(OBJS_DIR)/instr_size.ln :=	EXTRA_OPTIONS	= -I$(SRC)/common/dis/i386
 
-# Additional definition for files including ACPI headers
-$(OBJS_DIR)/cpu_acpi.o :=	EXTRA_OPTIONS	= -DACPI_USE_SYSTEM_CLIBRARY
-$(OBJS_DIR)/cpu_idle.o :=	EXTRA_OPTIONS	= -DACPI_USE_SYSTEM_CLIBRARY
-$(OBJS_DIR)/cpupm_amd.o :=	EXTRA_OPTIONS	= -DACPI_USE_SYSTEM_CLIBRARY
-$(OBJS_DIR)/cpupm_intel.o :=	EXTRA_OPTIONS	= -DACPI_USE_SYSTEM_CLIBRARY
-$(OBJS_DIR)/cpupm_mach.o :=	EXTRA_OPTIONS	= -DACPI_USE_SYSTEM_CLIBRARY
-$(OBJS_DIR)/cpupm_throttle.o :=	EXTRA_OPTIONS	= -DACPI_USE_SYSTEM_CLIBRARY
-$(OBJS_DIR)/pwrnow.o :=		EXTRA_OPTIONS	= -DACPI_USE_SYSTEM_CLIBRARY
-$(OBJS_DIR)/speedstep.o :=	EXTRA_OPTIONS	= -DACPI_USE_SYSTEM_CLIBRARY
-$(OBJS_DIR)/turbo.o :=		EXTRA_OPTIONS	= -DACPI_USE_SYSTEM_CLIBRARY
-
 CFLAGS += -DDIS_MEM
 
 #
diff --git a/usr/src/uts/i86xpv/unix/Makefile b/usr/src/uts/i86xpv/unix/Makefile
index e55eed347f..e9ce16af05 100644
--- a/usr/src/uts/i86xpv/unix/Makefile
+++ b/usr/src/uts/i86xpv/unix/Makefile
@@ -121,9 +121,6 @@ CLEANLINTFILES	+= $(LINT_LIB) $(DBOOT_LINT_LIB) $(DBOOT_LINTS)
 $(OBJS_DIR)/instr_size.o :=	EXTRA_OPTIONS	= -I$(SRC)/common/dis/i386
 $(OBJS_DIR)/instr_size.ln :=	EXTRA_OPTIONS	= -I$(SRC)/common/dis/i386
 
-# Additional definition for files including ACPI headers
-$(OBJS_DIR)/cpupm_mach.o :=	EXTRA_OPTIONS	= -DACPI_USE_SYSTEM_CLIBRARY
-
 CFLAGS += -DDIS_MEM
 
 #
diff --git a/usr/src/uts/intel/acpica/Makefile b/usr/src/uts/intel/acpica/Makefile
index d7742eec50..a72d55bacb 100644
--- a/usr/src/uts/intel/acpica/Makefile
+++ b/usr/src/uts/intel/acpica/Makefile
@@ -47,8 +47,7 @@ DEBUG_DEFS	+= $(DEBUG_FLGS)
 #
 # lint pass one non-enforcement
 #
-CFLAGS += $(CCVERBOSE) -DPWRDMN -DACPI_USE_LOCAL_CACHE -DACPI_DEBUG_OUTPUT \
-	-DACPI_USE_SYSTEM_CLIBRARY
+CFLAGS += $(CCVERBOSE) -DPWRDMN -DACPI_USE_LOCAL_CACHE -DACPI_DEBUG_OUTPUT
 
 #
 # 3rd party code is not lint clean
diff --git a/usr/src/uts/intel/sys/acpi/acpixf.h b/usr/src/uts/intel/sys/acpi/acpixf.h
index 10eeb11041..b35e48997a 100644
--- a/usr/src/uts/intel/sys/acpi/acpixf.h
+++ b/usr/src/uts/intel/sys/acpi/acpixf.h
@@ -1200,6 +1200,7 @@ AcpiBiosWarning (
 /*
  * Debug output
  */
+/* ARGSUSED */
 ACPI_DBG_DEPENDENT_RETURN_VOID (
 ACPI_PRINTF_LIKE(6)
 void ACPI_INTERNAL_VAR_XFACE
@@ -1212,6 +1213,7 @@ AcpiDebugPrint (
     const char              *Format,
     ...))
 
+/* ARGSUSED */
 ACPI_DBG_DEPENDENT_RETURN_VOID (
 ACPI_PRINTF_LIKE(6)
 void ACPI_INTERNAL_VAR_XFACE
@@ -1224,6 +1226,7 @@ AcpiDebugPrintRaw (
     const char              *Format,
     ...))
 
+/* ARGSUSED */
 ACPI_DBG_DEPENDENT_RETURN_VOID (
 void
 AcpiTracePoint (
@@ -1232,6 +1235,7 @@ AcpiTracePoint (
     UINT8                   *Aml,
     char                    *Pathname))
 
+/* ARGSUSED */
 ACPI_APP_DEPENDENT_RETURN_VOID (
 ACPI_PRINTF_LIKE(1)
 void ACPI_INTERNAL_VAR_XFACE
diff --git a/usr/src/uts/intel/sys/acpi/platform/acsolaris.h b/usr/src/uts/intel/sys/acpi/platform/acsolaris.h
index d5b8b34193..b702976fb3 100644
--- a/usr/src/uts/intel/sys/acpi/platform/acsolaris.h
+++ b/usr/src/uts/intel/sys/acpi/platform/acsolaris.h
@@ -90,6 +90,13 @@ uint32_t acpi_strtoul(const char *, char **, int);
 #define	strtoul(s, r, b)	acpi_strtoul(s, r, b)
 #define	toupper(x)		(islower(x) ? (x) - 'a' + 'A' : (x))
 #define	tolower(x)		(isupper(x) ? (x) - 'A' + 'a' : (x))
+
+/*
+ * The ACPI headers shipped from Intel defines a bunch of functions which are
+ * already provided by the kernel.  The variable below prevents those from
+ * being loaded as part of accommon.h.
+ */
+#define	ACPI_USE_SYSTEM_CLIBRARY
 #endif
 
 #define	ACPI_ASM_MACROS
-- 
2.21.0

