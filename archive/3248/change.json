{"project":"joyent/illumos-joyent","branch":"master","id":"Ib8fef42ed91e3b916b058421d1783c5cba2a73bf","number":"3248","subject":"OS-6564 segvn concatenation causes use-after-free Reviewed by: Mike Gerdts \u003cmike.gerdts@joyent.com\u003e Reviewed by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e Approved by: Dan McDonald \u003cdanmcd@joyent.com\u003e","owner":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"url":"https://cr.joyent.us/3248","commitMessage":"OS-6564 segvn concatenation causes use-after-free\nReviewed by: Mike Gerdts \u003cmike.gerdts@joyent.com\u003e\nReviewed by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e\nApproved by: Dan McDonald \u003cdanmcd@joyent.com\u003e\n","createdOn":1516666458,"lastUpdated":1516990173,"open":false,"status":"MERGED","comments":[{"timestamp":1516666458,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 1."},{"timestamp":1516741350,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 1:\n\n(2 comments)"},{"timestamp":1516745337,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 2."},{"timestamp":1516746613,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Patch Set 2: Code-Review+1"},{"timestamp":1516749095,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 2:\n\n(2 comments)\n\nTesting comments added to the Jira ticket."},{"timestamp":1516802032,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 2: Code-Review+1"},{"timestamp":1516911726,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 2: Integration-Approval+1"},{"timestamp":1516983286,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 3: Patch Set 2 was rebased."},{"timestamp":1516983392,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Uploaded patch set 4: Commit message was updated."},{"timestamp":1516990173,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Patrick Mooney"}],"currentPatchSet":{"number":"4","revision":"b8fef42ed91e3b916b058421d1783c5cba2a73bf","parents":["65ca2e35d394f5308fbe6b2b05c65e86e9ca098b"],"ref":"refs/changes/48/3248/4","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1516983392,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1516746613,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1516802032,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1516911726,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"SUBM","value":"1","grantedOn":1516990173,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/uts/common/fs/ufs/ufs_vnops.c","type":"MODIFIED","insertions":1,"deletions":-2},{"file":"usr/src/uts/common/vm/as.h","type":"MODIFIED","insertions":7,"deletions":-3},{"file":"usr/src/uts/common/vm/seg_dev.c","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/common/vm/seg_dev.h","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/vm/seg_hole.c","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/uts/common/vm/seg_hole.h","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"usr/src/uts/common/vm/seg_spt.c","type":"MODIFIED","insertions":6,"deletions":-4},{"file":"usr/src/uts/common/vm/seg_spt.h","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"usr/src/uts/common/vm/seg_umap.c","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/uts/common/vm/seg_umap.h","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/common/vm/seg_vn.c","type":"MODIFIED","insertions":23,"deletions":-20},{"file":"usr/src/uts/common/vm/seg_vn.h","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"usr/src/uts/common/vm/vm_as.c","type":"MODIFIED","insertions":68,"deletions":-39},{"file":"usr/src/uts/i86xpv/vm/seg_mf.c","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/i86xpv/vm/seg_mf.h","type":"MODIFIED","insertions":2,"deletions":-1}],"sizeInsertions":132,"sizeDeletions":-88},"patchSets":[{"number":"1","revision":"fa11971b18dc2f8fa673f437826572455424edbc","parents":["88305497abe82aa90b20abf6c4c7924c43a27e9f"],"ref":"refs/changes/48/3248/1","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1516666458,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/uts/common/vm/vm_as.c","line":82,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"This is now declared in \u003cvm/as.h\u003e so shouldn\u0027t need to be declared here too."},{"file":"usr/src/uts/common/vm/vm_as.c","line":82,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Good catch.  Not only is it unnecessary, but it\u0027s using the wrong type info.  Removed."},{"file":"usr/src/uts/common/vm/vm_as.c","line":1442,"reviewer":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},"message":"Section 8.1 of the latest c style document I can find (25 years old) states that the weak consensus is that one declaration per line is preferred.  That\u0027s what I prefer, but probably because that\u0027s what I\u0027m used to because it was a strong consensus at $job-1.\n\nNow that I got that off my chest, do whatever you want with this."},{"file":"usr/src/uts/common/vm/vm_as.c","line":1442,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"If I\u0027m doing declaration-time assignments, I\u0027ll often split them up on separate lines, but for other things I favor the more terse notation."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/fs/ufs/ufs_vnops.c","type":"MODIFIED","insertions":1,"deletions":-2},{"file":"usr/src/uts/common/vm/as.h","type":"MODIFIED","insertions":7,"deletions":-3},{"file":"usr/src/uts/common/vm/seg_dev.c","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/common/vm/seg_dev.h","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/vm/seg_hole.c","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/uts/common/vm/seg_hole.h","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"usr/src/uts/common/vm/seg_spt.c","type":"MODIFIED","insertions":6,"deletions":-4},{"file":"usr/src/uts/common/vm/seg_spt.h","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"usr/src/uts/common/vm/seg_umap.c","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/uts/common/vm/seg_umap.h","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/common/vm/seg_vn.c","type":"MODIFIED","insertions":23,"deletions":-20},{"file":"usr/src/uts/common/vm/seg_vn.h","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"usr/src/uts/common/vm/vm_as.c","type":"MODIFIED","insertions":68,"deletions":-38},{"file":"usr/src/uts/i86xpv/vm/seg_mf.c","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/i86xpv/vm/seg_mf.h","type":"MODIFIED","insertions":2,"deletions":-1}],"sizeInsertions":132,"sizeDeletions":-87},{"number":"2","revision":"067d27ac2ed1fd1fc9a2c15443e510fd600d27b8","parents":["88305497abe82aa90b20abf6c4c7924c43a27e9f"],"ref":"refs/changes/48/3248/2","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1516745337,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1516802032,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1516911726,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1516746613,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/fs/ufs/ufs_vnops.c","type":"MODIFIED","insertions":1,"deletions":-2},{"file":"usr/src/uts/common/vm/as.h","type":"MODIFIED","insertions":7,"deletions":-3},{"file":"usr/src/uts/common/vm/seg_dev.c","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/common/vm/seg_dev.h","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/vm/seg_hole.c","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/uts/common/vm/seg_hole.h","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"usr/src/uts/common/vm/seg_spt.c","type":"MODIFIED","insertions":6,"deletions":-4},{"file":"usr/src/uts/common/vm/seg_spt.h","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"usr/src/uts/common/vm/seg_umap.c","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/uts/common/vm/seg_umap.h","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/common/vm/seg_vn.c","type":"MODIFIED","insertions":23,"deletions":-20},{"file":"usr/src/uts/common/vm/seg_vn.h","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"usr/src/uts/common/vm/vm_as.c","type":"MODIFIED","insertions":68,"deletions":-39},{"file":"usr/src/uts/i86xpv/vm/seg_mf.c","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/i86xpv/vm/seg_mf.h","type":"MODIFIED","insertions":2,"deletions":-1}],"sizeInsertions":132,"sizeDeletions":-88},{"number":"3","revision":"caf0535e69cf397ed3091612626f0a16031caa0f","parents":["65ca2e35d394f5308fbe6b2b05c65e86e9ca098b"],"ref":"refs/changes/48/3248/3","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1516983286,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1516802032,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1516911726,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1516746613,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/fs/ufs/ufs_vnops.c","type":"MODIFIED","insertions":1,"deletions":-2},{"file":"usr/src/uts/common/vm/as.h","type":"MODIFIED","insertions":7,"deletions":-3},{"file":"usr/src/uts/common/vm/seg_dev.c","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/common/vm/seg_dev.h","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/vm/seg_hole.c","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/uts/common/vm/seg_hole.h","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"usr/src/uts/common/vm/seg_spt.c","type":"MODIFIED","insertions":6,"deletions":-4},{"file":"usr/src/uts/common/vm/seg_spt.h","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"usr/src/uts/common/vm/seg_umap.c","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/uts/common/vm/seg_umap.h","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/common/vm/seg_vn.c","type":"MODIFIED","insertions":23,"deletions":-20},{"file":"usr/src/uts/common/vm/seg_vn.h","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"usr/src/uts/common/vm/vm_as.c","type":"MODIFIED","insertions":68,"deletions":-39},{"file":"usr/src/uts/i86xpv/vm/seg_mf.c","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/i86xpv/vm/seg_mf.h","type":"MODIFIED","insertions":2,"deletions":-1}],"sizeInsertions":132,"sizeDeletions":-88},{"number":"4","revision":"b8fef42ed91e3b916b058421d1783c5cba2a73bf","parents":["65ca2e35d394f5308fbe6b2b05c65e86e9ca098b"],"ref":"refs/changes/48/3248/4","uploader":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"createdOn":1516983392,"author":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1516802032,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"SUBM","value":"1","grantedOn":1516990173,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1516911726,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1516746613,"by":{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/uts/common/fs/ufs/ufs_vnops.c","type":"MODIFIED","insertions":1,"deletions":-2},{"file":"usr/src/uts/common/vm/as.h","type":"MODIFIED","insertions":7,"deletions":-3},{"file":"usr/src/uts/common/vm/seg_dev.c","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/common/vm/seg_dev.h","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/vm/seg_hole.c","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/uts/common/vm/seg_hole.h","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"usr/src/uts/common/vm/seg_spt.c","type":"MODIFIED","insertions":6,"deletions":-4},{"file":"usr/src/uts/common/vm/seg_spt.h","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"usr/src/uts/common/vm/seg_umap.c","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"usr/src/uts/common/vm/seg_umap.h","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"usr/src/uts/common/vm/seg_vn.c","type":"MODIFIED","insertions":23,"deletions":-20},{"file":"usr/src/uts/common/vm/seg_vn.h","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"usr/src/uts/common/vm/vm_as.c","type":"MODIFIED","insertions":68,"deletions":-39},{"file":"usr/src/uts/i86xpv/vm/seg_mf.c","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/i86xpv/vm/seg_mf.h","type":"MODIFIED","insertions":2,"deletions":-1}],"sizeInsertions":132,"sizeDeletions":-88}],"allReviewers":[{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},{"name":"Mike Gerdts","email":"mike.gerdts@joyent.com","username":"mgerdts"},{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}]}