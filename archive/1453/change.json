{"project":"joyent/moray","branch":"master","topic":"MORAY-390","id":"Ia4922741eddd45567e10640c70c9868461b39e18","number":"1453","subject":"MORAY-390 Upgrade Moray to node-fast v2 MORAY-273 Moray should dump core on uncaught exceptions MORAY-335 Moray crashes on bad fast CRC MORAY-336 Moray hangs on bad RPC method name MORAY-360 Moray throwing TypeErrors, AssertionErrors for some bad input MO","owner":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"url":"https://cr.joyent.us/1453","commitMessage":"MORAY-390 Upgrade Moray to node-fast v2\nMORAY-273 Moray should dump core on uncaught exceptions\nMORAY-335 Moray crashes on bad fast CRC\nMORAY-336 Moray hangs on bad RPC method name\nMORAY-360 Moray throwing TypeErrors, AssertionErrors for some bad input\nMORAY-404 Moray server needs to validate its RPC arguments\nReviewed by: David Pacheco \u003cdap@joyent.com\u003e\nReviewed by: Kody Kantor \u003ckody.kantor@joyent.com\u003e\nReviewed by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e\nApproved by: Joshua M. Clulow \u003cjmc@joyent.com\u003e\n","createdOn":1486435370,"lastUpdated":1504655933,"open":false,"status":"MERGED","comments":[{"timestamp":1486435370,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 1."},{"timestamp":1486435396,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1486435584,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 2: Patch Set 1 was rebased."},{"timestamp":1486435612,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Topic set to MORAY-390"},{"timestamp":1487025333,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 2:\n\n(17 comments)\n\nThis looks great!  Thanks for doing this.  This fixes a bunch of issues and puts us on a foundation for a much more robust (and debuggable) Moray."},{"timestamp":1487025388,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 2:\n\nI forgot to mention two other things: a lot of internal interfaces changed here (manatee.pg, manatee.start, use of \"res\", handlerPipeline, and so on).  I didn\u0027t review that all references were updated, but I can if you want.\n\nAlso, what\u0027s the test plan?"},{"timestamp":1487029985,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 3."},{"timestamp":1487030016,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1487030108,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 4: Commit message was updated."},{"timestamp":1487793900,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 5: Patch Set 4 was rebased"},{"timestamp":1487793928,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 6."},{"timestamp":1487793931,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5:\n\n\"make check\" passed ok"},{"timestamp":1487793958,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 6: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1487794697,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 6:\n\n(12 comments)\n\nThanks for taking a look! I forgot about those XXX\u0027s. Thanks for pointing them out, I\u0027ll push another patchset once I\u0027ve resolved them."},{"timestamp":1487795079,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 6:\n\nAs for testing: I ran the integration tests against this, and have had it deployed in emy-7 without issue. I also ran it through istanbul to see what is covered by the test suite, and to make sure that at least the new code is covered. (I have a list of things that we should probably make sure have tests, and will file some separate tickets for those.)"},{"timestamp":1487888888,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 6:\n\n(3 comments)"},{"timestamp":1487902051,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 7: Commit message was updated."},{"timestamp":1487902100,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 8."},{"timestamp":1487902135,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 8: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1490216061,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 9."},{"timestamp":1490216117,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 9: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1490216750,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 9:\n\n(2 comments)\n\nAfter playing around with JSON schemas for a bit, I figured they\u0027d be useful for doing better validation of the options, batch() requests array, and buckets. I took a look at several different implementations and selected \"ajv\" since it seems to have fewer issues than the others I tried. I\u0027ll update MORAY-404 to mention this."},{"timestamp":1490638369,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 9:\n\n(4 comments)"},{"timestamp":1490639994,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 6:\n\n(1 comment)"},{"timestamp":1490653326,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 10."},{"timestamp":1490653330,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 9:\n\n(5 comments)"},{"timestamp":1490653362,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 10: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1490653923,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 10: Code-Review+1\n\n(3 comments)\n\nThanks for the updated comments."},{"timestamp":1493337466,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 11."},{"timestamp":1493337496,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 11: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1493337546,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 12: Patch Set 11 was rebased."},{"timestamp":1493337580,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 12:\n\n\"make check\" passed ok"},{"timestamp":1493337644,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 12:\n\nI\u0027ve updated the CR to show allowed values in error messages, and I\u0027ve also removed the required \"attribute\" field for sorting, since it turns out that at least the old \"findobjects\" tool would send an empty object for \"sort\"."},{"timestamp":1493682606,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 12:\n\n(2 comments)"},{"timestamp":1493825453,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 12:\n\n(1 comment)\n\nLooks good! This will be very helpful for when we move electric-moray to fast-v2 as well."},{"timestamp":1493827913,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 13."},{"timestamp":1493827936,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 13:\n\n(3 comments)"},{"timestamp":1493827940,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 13: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1493833959,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 13: Code-Review+1"},{"timestamp":1493848511,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 13: Code-Review+1"},{"timestamp":1493913330,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 13: Code-Review+1"},{"timestamp":1494019560,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 14: Patch Set 13 was rebased."},{"timestamp":1494019586,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 14:\n\n\"make check\" passed ok"},{"timestamp":1494019646,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 15: Commit message was updated."},{"timestamp":1497571202,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 16."},{"timestamp":1497571229,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 16: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1497572171,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 16:\n\nI rebased the changes onto Moray\u0027s HEAD. The lib/objects/find.js file rebase was non-trivial, so Gerrit doesn\u0027t recognize it as a rebase. Nothing\u0027s changed here beyond that."},{"timestamp":1497622877,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 16: Code-Review+1"},{"timestamp":1497648823,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 16: Code-Review+1"},{"timestamp":1500427945,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 17."},{"timestamp":1500427976,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 17: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1501107211,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 18."},{"timestamp":1501107247,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 18: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1501266776,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 18: Code-Review+1"},{"timestamp":1501625038,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 19: Patch Set 18 was rebased"},{"timestamp":1501625069,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 19:\n\n\"make check\" passed ok"},{"timestamp":1501626133,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 20."},{"timestamp":1501626158,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 20: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1501781834,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 20: Code-Review+1"},{"timestamp":1504647092,"reviewer":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},"message":"Patch Set 20: Integration-Approval+1"},{"timestamp":1504649927,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 21: Commit message was updated."},{"timestamp":1504655933,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Cody Peter Mello"}],"currentPatchSet":{"number":"21","revision":"a4922741eddd45567e10640c70c9868461b39e18","parents":["4808aed525594032bed1588fac9e03da025e3eac"],"ref":"refs/changes/53/1453/21","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1504649927,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1501626158,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1501781834,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1504647092,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}},{"type":"SUBM","value":"1","grantedOn":1504655933,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":16,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"README.md","type":"MODIFIED","insertions":1,"deletions":0},{"file":"boot/setup.sh","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"docs/index.md","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"etc/config.coal.json","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"etc/config.coal.manta.json","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"etc/config.lab.json","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"etc/config.local.json","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"etc/config.standalone.json","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"lib/buckets/common.js","type":"MODIFIED","insertions":20,"deletions":-71},{"file":"lib/buckets/creat.js","type":"MODIFIED","insertions":33,"deletions":-15},{"file":"lib/buckets/del.js","type":"MODIFIED","insertions":33,"deletions":-17},{"file":"lib/buckets/get.js","type":"MODIFIED","insertions":29,"deletions":-9},{"file":"lib/buckets/list.js","type":"MODIFIED","insertions":27,"deletions":-11},{"file":"lib/buckets/update.js","type":"MODIFIED","insertions":37,"deletions":-20},{"file":"lib/control.js","type":"MODIFIED","insertions":160,"deletions":-54},{"file":"lib/errors.js","type":"MODIFIED","insertions":11,"deletions":-25},{"file":"lib/manatee.js","type":"MODIFIED","insertions":8,"deletions":-19},{"file":"lib/objects/batch.js","type":"MODIFIED","insertions":37,"deletions":-17},{"file":"lib/objects/common.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/objects/del.js","type":"MODIFIED","insertions":25,"deletions":-11},{"file":"lib/objects/del_many.js","type":"MODIFIED","insertions":27,"deletions":-14},{"file":"lib/objects/find.js","type":"MODIFIED","insertions":50,"deletions":-35},{"file":"lib/objects/get.js","type":"MODIFIED","insertions":44,"deletions":-27},{"file":"lib/objects/put.js","type":"MODIFIED","insertions":30,"deletions":-17},{"file":"lib/objects/reindex.js","type":"MODIFIED","insertions":31,"deletions":-16},{"file":"lib/objects/update.js","type":"MODIFIED","insertions":32,"deletions":-17},{"file":"lib/pg.js","type":"MODIFIED","insertions":2,"deletions":-10},{"file":"lib/ping.js","type":"MODIFIED","insertions":29,"deletions":-9},{"file":"lib/schema.js","type":"ADDED","insertions":331,"deletions":0},{"file":"lib/server.js","type":"MODIFIED","insertions":151,"deletions":-61},{"file":"lib/sql.js","type":"MODIFIED","insertions":29,"deletions":-11},{"file":"lib/standalone.js","type":"MODIFIED","insertions":13,"deletions":-16},{"file":"main.js","type":"MODIFIED","insertions":11,"deletions":-8},{"file":"package.json","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"sapi_manifests/moray/template","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"sdc/sapi_manifests/moray/template","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"smf/manifests/moray.xml.in","type":"MODIFIED","insertions":3,"deletions":-2}],"sizeInsertions":1217,"sizeDeletions":-527},"patchSets":[{"number":"1","revision":"4a3e7757b234cb99ead19190bcbab7db58f7ba1f","parents":["130bcdee3359db727c2e3c60e2212432d71a3d85"],"ref":"refs/changes/53/1453/1","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1486435370,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1486435396,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"README.md","type":"MODIFIED","insertions":1,"deletions":0},{"file":"boot/setup.sh","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"docs/index.md","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/buckets/creat.js","type":"MODIFIED","insertions":32,"deletions":-14},{"file":"lib/buckets/del.js","type":"MODIFIED","insertions":31,"deletions":-15},{"file":"lib/buckets/get.js","type":"MODIFIED","insertions":28,"deletions":-8},{"file":"lib/buckets/list.js","type":"MODIFIED","insertions":26,"deletions":-10},{"file":"lib/buckets/update.js","type":"MODIFIED","insertions":36,"deletions":-19},{"file":"lib/control.js","type":"MODIFIED","insertions":145,"deletions":-41},{"file":"lib/errors.js","type":"MODIFIED","insertions":8,"deletions":-2},{"file":"lib/manatee.js","type":"MODIFIED","insertions":7,"deletions":-18},{"file":"lib/objects/batch.js","type":"MODIFIED","insertions":37,"deletions":-16},{"file":"lib/objects/common.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/objects/del.js","type":"MODIFIED","insertions":24,"deletions":-10},{"file":"lib/objects/del_many.js","type":"MODIFIED","insertions":26,"deletions":-13},{"file":"lib/objects/find.js","type":"MODIFIED","insertions":46,"deletions":-32},{"file":"lib/objects/get.js","type":"MODIFIED","insertions":43,"deletions":-26},{"file":"lib/objects/put.js","type":"MODIFIED","insertions":29,"deletions":-16},{"file":"lib/objects/reindex.js","type":"MODIFIED","insertions":30,"deletions":-15},{"file":"lib/objects/update.js","type":"MODIFIED","insertions":31,"deletions":-16},{"file":"lib/pg.js","type":"MODIFIED","insertions":5,"deletions":-6},{"file":"lib/ping.js","type":"MODIFIED","insertions":28,"deletions":-8},{"file":"lib/server.js","type":"MODIFIED","insertions":106,"deletions":-51},{"file":"lib/sql.js","type":"MODIFIED","insertions":28,"deletions":-10},{"file":"lib/standalone.js","type":"MODIFIED","insertions":4,"deletions":-15},{"file":"main.js","type":"MODIFIED","insertions":10,"deletions":-7},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"smf/manifests/moray.xml.in","type":"MODIFIED","insertions":2,"deletions":-1}],"sizeInsertions":773,"sizeDeletions":-375},{"number":"2","revision":"5b17e7488c70d96b6c2daf458af4b69a0f1bfdf7","parents":["11424aae3646d59601509b16cd3c120af3f03321"],"ref":"refs/changes/53/1453/2","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1486435584,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"NO_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1486435396,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"/COMMIT_MSG","line":7,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I think you want to add tickets here: MORAY-360, MORAY-336, MORAY-335, and MORAY-273.  I think you\u0027ll want to test these (let me know if I can help), but I think they should all be fixed.\n\nI\u0027d also add a separate ticket for argument validation.  It\u0027s great to do that here, but it wouldn\u0027t be obvious from the synopsis \"Upgrade Moray to node-fast v2\"."},{"file":"/COMMIT_MSG","line":7,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Thanks for adding those.  What did you think about the suggestion about having one for argument validation?"},{"file":"/COMMIT_MSG","line":7,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Sorry, meant to add one, but had forgotten. It\u0027s there now."},{"file":"README.md","line":182,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Does this only apply to standalone instances, or is it just that we don\u0027t have config file documentation for non-standalone instances?\n\nIt seems like we mostly use camel case for config properties."},{"file":"README.md","line":182,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"It applies to both, we just don\u0027t have documentation for the configuration file for non-standalone instances."},{"file":"lib/buckets/list.js","line":72,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"What do you think about moving the log entry into the implementation of handlerPipeline?  It seems to be duplicated everywhere."},{"file":"lib/buckets/list.js","line":72,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"I thought about doing that, but a lot of them log with a set of fields that are specific to the endpoint."},{"file":"lib/control.js","line":8,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"This file (and a bunch of others) needs a copyright update."},{"file":"lib/control.js","line":36,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"How about wrapping this in a VError that adds \"route \"%s\": no DB handle\"?  Then you can just log that and pass that whole error up.\n\nI\u0027m not sure if that has any compatibility implications."},{"file":"lib/control.js","line":36,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"I think that this would break anything using older Moray clients where they don\u0027t check the chain and they want to check for the NoDatabasePeersError. It looks like this would affect CNAPIs before CNAPI-679, since it checks for NoDatabasePeersErrors to determine if it should wait before continuing initializing its buckets."},{"file":"lib/control.js","line":36,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"We could create one with the same \u0027name\u0027, but fair enough."},{"file":"lib/control.js","line":159,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Did you think about changing consumers of \"req\" to using the corresponding methods on rpc instead?  I feel that \"rpc.methodName()\" is a lot clearer than \"req.route\", for example, and it also lets us more easily find references and change them if we need.\n\nThis wouldn\u0027t work for moray-level state, like req_id.  But speaking of that, it\u0027s pretty confusing that fast provides a requestId that\u0027s different than req_id/req.req_id.  I understand why, and it probably makes sense, but I think we might want to explain that here.  Ideally, we\u0027d rename one of these to consumerReqId (or something brief).\n\nIt could be that this is a lot more work and just isn\u0027t worth it right now (though I would at least add the req_id comment)."},{"file":"lib/control.js","line":159,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"I\u0027ve added a comment about req_id and common fields that get added to this object to this function.\n\nconnId and msgid don\u0027t get used much in Moray except in DTrace probes. I mostly added them to the logger and the req object to make getting relevant information out of fast and moray logs easier, and to make it easier to identify related objects in a dump."},{"file":"lib/control.js","line":175,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Did you consider using JSON schema?  jsprim provides an interface for validating using JSON schema version 3 (which is a little old but I think much saner than version 4), and we use that in a number of places (like marlin: https://github.com/joyent/manta-marlin/blob/master/common/lib/schema.js)"},{"file":"lib/control.js","line":175,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"I hadn\u0027t considered it before, but taking a look at it, it looks like it can validate objects, but not an array with different types. It seems that I\u0027d have to do something similar to what I\u0027m doing here to map each element onto JSV, so I feel like using it wouldn\u0027t improve these checks much. It might be useful for validating the options object, though."},{"file":"lib/manatee.js","line":132,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Do I understand correctly that some things used to pass some options (like \"read\"), but they weren\u0027t used in this function, so we just dropped it?"},{"file":"lib/manatee.js","line":132,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Yeah. The \"read\" and \"async\" options used to be used to determine transaction isolation levels and which manatee peer to use, but those got removed in MANTA-734 and MORAY-78. I felt that they were misleading since they have no effect anymore, so I cleaned this up while I was reworking the handlerPipeline() calls."},{"file":"lib/objects/put.js","line":188,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I think it would be great to document the list of fields that are tacked on the \"req\" object in various places.  I\u0027d suggest mentioning them in a block comment in buildReq.  So far, I\u0027ve noticed _etag and _count."},{"file":"lib/objects/put.js","line":188,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Done"},{"file":"lib/pg.js","line":458,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Why this change?  Why not `arguments.slice(1)`?"},{"file":"lib/pg.js","line":458,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"I made this change since the code from before didn\u0027t work and always created an empty array.\n\narguments.slice() wouldn\u0027t work, since it isn\u0027t a method on arguments. Array.prototype.slice.call(arguments, 1) would, but that would result in this function getting deoptimized (which maybe doesn\u0027t matter much here).\n\nI decided to remove the args array entirely, because I noticed while running the test suite against this while logging at debug level that it results in trying to JSON.stringify() a cyclical object, and crashes. Instead, I just log the event name now. (If you think that we should be trying to log the arguments here, let me know.)"},{"file":"lib/server.js","line":34,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"While we\u0027re elevating this, can we add a big warning about changing this?  For all the reasons described in RFD 33, I don\u0027t want people to just bump this without having thought through the rollout plan (almost certainly with an RFD)."},{"file":"lib/server.js","line":34,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Done"},{"file":"lib/server.js","line":99,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Presumably this needs to be updated?"},{"file":"lib/server.js","line":122,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I don\u0027t think this is the most useful version to export.  Better would be the version in the image itself, but short of that, maybe leaving this out would be better?"},{"file":"lib/server.js","line":122,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"I initially wanted to use that version, but it doesn\u0027t seem to be available from inside the zone. I can just omit it for now."},{"file":"lib/server.js","line":150,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"We should resolve or remove the XXX here."},{"file":"lib/server.js","line":152,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"It might be nice to report the raw address (e.g., this.fast_socket.address()) so that we get the IP as well."},{"file":"lib/server.js","line":152,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Done"},{"file":"lib/server.js","line":161,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I think it might be clearer to use a vasync barrier here.  For example, you could do:\n\n    // create vasync barrier and start operations for the \u0027close\u0027 events\n    // that you\u0027re expecting\n    self.fast_socket.close();\n    self.db_conn.close();\n    self.kang_server.close();\n    // when the barrier drains, emit \u0027close\u0027"},{"file":"lib/server.js","line":161,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"I\u0027ll take a look into what this might look like with barriers."},{"file":"package.json","line":18,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Obviously this will have to change for the final integration."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"README.md","type":"MODIFIED","insertions":1,"deletions":0},{"file":"boot/setup.sh","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"docs/index.md","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/buckets/creat.js","type":"MODIFIED","insertions":32,"deletions":-14},{"file":"lib/buckets/del.js","type":"MODIFIED","insertions":31,"deletions":-15},{"file":"lib/buckets/get.js","type":"MODIFIED","insertions":28,"deletions":-8},{"file":"lib/buckets/list.js","type":"MODIFIED","insertions":26,"deletions":-10},{"file":"lib/buckets/update.js","type":"MODIFIED","insertions":36,"deletions":-19},{"file":"lib/control.js","type":"MODIFIED","insertions":145,"deletions":-41},{"file":"lib/errors.js","type":"MODIFIED","insertions":8,"deletions":-2},{"file":"lib/manatee.js","type":"MODIFIED","insertions":7,"deletions":-18},{"file":"lib/objects/batch.js","type":"MODIFIED","insertions":37,"deletions":-16},{"file":"lib/objects/common.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/objects/del.js","type":"MODIFIED","insertions":24,"deletions":-10},{"file":"lib/objects/del_many.js","type":"MODIFIED","insertions":26,"deletions":-13},{"file":"lib/objects/find.js","type":"MODIFIED","insertions":46,"deletions":-32},{"file":"lib/objects/get.js","type":"MODIFIED","insertions":43,"deletions":-26},{"file":"lib/objects/put.js","type":"MODIFIED","insertions":29,"deletions":-16},{"file":"lib/objects/reindex.js","type":"MODIFIED","insertions":30,"deletions":-15},{"file":"lib/objects/update.js","type":"MODIFIED","insertions":31,"deletions":-16},{"file":"lib/pg.js","type":"MODIFIED","insertions":4,"deletions":-5},{"file":"lib/ping.js","type":"MODIFIED","insertions":28,"deletions":-8},{"file":"lib/server.js","type":"MODIFIED","insertions":106,"deletions":-51},{"file":"lib/sql.js","type":"MODIFIED","insertions":28,"deletions":-10},{"file":"lib/standalone.js","type":"MODIFIED","insertions":4,"deletions":-15},{"file":"main.js","type":"MODIFIED","insertions":10,"deletions":-7},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"smf/manifests/moray.xml.in","type":"MODIFIED","insertions":2,"deletions":-1}],"sizeInsertions":772,"sizeDeletions":-374},{"number":"3","revision":"2f9a6154270e8000e5a17b1fbffc3a0301ffb738","parents":["11424aae3646d59601509b16cd3c120af3f03321"],"ref":"refs/changes/53/1453/3","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1487029985,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1487030016,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"README.md","type":"MODIFIED","insertions":1,"deletions":0},{"file":"boot/setup.sh","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"docs/index.md","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/buckets/creat.js","type":"MODIFIED","insertions":33,"deletions":-15},{"file":"lib/buckets/del.js","type":"MODIFIED","insertions":32,"deletions":-16},{"file":"lib/buckets/get.js","type":"MODIFIED","insertions":29,"deletions":-9},{"file":"lib/buckets/list.js","type":"MODIFIED","insertions":27,"deletions":-11},{"file":"lib/buckets/update.js","type":"MODIFIED","insertions":37,"deletions":-20},{"file":"lib/control.js","type":"MODIFIED","insertions":146,"deletions":-42},{"file":"lib/errors.js","type":"MODIFIED","insertions":9,"deletions":-3},{"file":"lib/manatee.js","type":"MODIFIED","insertions":8,"deletions":-19},{"file":"lib/objects/batch.js","type":"MODIFIED","insertions":38,"deletions":-17},{"file":"lib/objects/common.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/objects/del.js","type":"MODIFIED","insertions":25,"deletions":-11},{"file":"lib/objects/del_many.js","type":"MODIFIED","insertions":27,"deletions":-14},{"file":"lib/objects/find.js","type":"MODIFIED","insertions":47,"deletions":-33},{"file":"lib/objects/get.js","type":"MODIFIED","insertions":44,"deletions":-27},{"file":"lib/objects/put.js","type":"MODIFIED","insertions":30,"deletions":-17},{"file":"lib/objects/reindex.js","type":"MODIFIED","insertions":31,"deletions":-16},{"file":"lib/objects/update.js","type":"MODIFIED","insertions":32,"deletions":-17},{"file":"lib/pg.js","type":"MODIFIED","insertions":5,"deletions":-6},{"file":"lib/ping.js","type":"MODIFIED","insertions":29,"deletions":-9},{"file":"lib/server.js","type":"MODIFIED","insertions":107,"deletions":-52},{"file":"lib/sql.js","type":"MODIFIED","insertions":29,"deletions":-11},{"file":"lib/standalone.js","type":"MODIFIED","insertions":13,"deletions":-16},{"file":"main.js","type":"MODIFIED","insertions":11,"deletions":-8},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"smf/manifests/moray.xml.in","type":"MODIFIED","insertions":3,"deletions":-2}],"sizeInsertions":805,"sizeDeletions":-399},{"number":"4","revision":"e0fd5e39e57bc158abf5c93af67102af12b39a3d","parents":["11424aae3646d59601509b16cd3c120af3f03321"],"ref":"refs/changes/53/1453/4","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1487030108,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1487030016,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"README.md","type":"MODIFIED","insertions":1,"deletions":0},{"file":"boot/setup.sh","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"docs/index.md","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/buckets/creat.js","type":"MODIFIED","insertions":33,"deletions":-15},{"file":"lib/buckets/del.js","type":"MODIFIED","insertions":32,"deletions":-16},{"file":"lib/buckets/get.js","type":"MODIFIED","insertions":29,"deletions":-9},{"file":"lib/buckets/list.js","type":"MODIFIED","insertions":27,"deletions":-11},{"file":"lib/buckets/update.js","type":"MODIFIED","insertions":37,"deletions":-20},{"file":"lib/control.js","type":"MODIFIED","insertions":146,"deletions":-42},{"file":"lib/errors.js","type":"MODIFIED","insertions":9,"deletions":-3},{"file":"lib/manatee.js","type":"MODIFIED","insertions":8,"deletions":-19},{"file":"lib/objects/batch.js","type":"MODIFIED","insertions":38,"deletions":-17},{"file":"lib/objects/common.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/objects/del.js","type":"MODIFIED","insertions":25,"deletions":-11},{"file":"lib/objects/del_many.js","type":"MODIFIED","insertions":27,"deletions":-14},{"file":"lib/objects/find.js","type":"MODIFIED","insertions":47,"deletions":-33},{"file":"lib/objects/get.js","type":"MODIFIED","insertions":44,"deletions":-27},{"file":"lib/objects/put.js","type":"MODIFIED","insertions":30,"deletions":-17},{"file":"lib/objects/reindex.js","type":"MODIFIED","insertions":31,"deletions":-16},{"file":"lib/objects/update.js","type":"MODIFIED","insertions":32,"deletions":-17},{"file":"lib/pg.js","type":"MODIFIED","insertions":5,"deletions":-6},{"file":"lib/ping.js","type":"MODIFIED","insertions":29,"deletions":-9},{"file":"lib/server.js","type":"MODIFIED","insertions":107,"deletions":-52},{"file":"lib/sql.js","type":"MODIFIED","insertions":29,"deletions":-11},{"file":"lib/standalone.js","type":"MODIFIED","insertions":13,"deletions":-16},{"file":"main.js","type":"MODIFIED","insertions":11,"deletions":-8},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"smf/manifests/moray.xml.in","type":"MODIFIED","insertions":3,"deletions":-2}],"sizeInsertions":805,"sizeDeletions":-399},{"number":"5","revision":"fc08a5af0ac659e88d7ab582e7331749e33128a4","parents":["d23510d05c04a7f4da5e061965c4c351d3246e77"],"ref":"refs/changes/53/1453/5","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1487793900,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1487030016,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"README.md","type":"MODIFIED","insertions":1,"deletions":0},{"file":"boot/setup.sh","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"docs/index.md","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/buckets/creat.js","type":"MODIFIED","insertions":33,"deletions":-15},{"file":"lib/buckets/del.js","type":"MODIFIED","insertions":32,"deletions":-16},{"file":"lib/buckets/get.js","type":"MODIFIED","insertions":29,"deletions":-9},{"file":"lib/buckets/list.js","type":"MODIFIED","insertions":27,"deletions":-11},{"file":"lib/buckets/update.js","type":"MODIFIED","insertions":37,"deletions":-20},{"file":"lib/control.js","type":"MODIFIED","insertions":146,"deletions":-42},{"file":"lib/errors.js","type":"MODIFIED","insertions":9,"deletions":-3},{"file":"lib/manatee.js","type":"MODIFIED","insertions":8,"deletions":-19},{"file":"lib/objects/batch.js","type":"MODIFIED","insertions":38,"deletions":-17},{"file":"lib/objects/common.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/objects/del.js","type":"MODIFIED","insertions":25,"deletions":-11},{"file":"lib/objects/del_many.js","type":"MODIFIED","insertions":27,"deletions":-14},{"file":"lib/objects/find.js","type":"MODIFIED","insertions":47,"deletions":-33},{"file":"lib/objects/get.js","type":"MODIFIED","insertions":44,"deletions":-27},{"file":"lib/objects/put.js","type":"MODIFIED","insertions":30,"deletions":-17},{"file":"lib/objects/reindex.js","type":"MODIFIED","insertions":31,"deletions":-16},{"file":"lib/objects/update.js","type":"MODIFIED","insertions":32,"deletions":-17},{"file":"lib/pg.js","type":"MODIFIED","insertions":5,"deletions":-6},{"file":"lib/ping.js","type":"MODIFIED","insertions":29,"deletions":-9},{"file":"lib/server.js","type":"MODIFIED","insertions":107,"deletions":-52},{"file":"lib/sql.js","type":"MODIFIED","insertions":29,"deletions":-11},{"file":"lib/standalone.js","type":"MODIFIED","insertions":13,"deletions":-16},{"file":"main.js","type":"MODIFIED","insertions":11,"deletions":-8},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"smf/manifests/moray.xml.in","type":"MODIFIED","insertions":3,"deletions":-2}],"sizeInsertions":805,"sizeDeletions":-399},{"number":"6","revision":"ba03edc67ef7e442e55d2053cb3ea8ef30cb3e70","parents":["d23510d05c04a7f4da5e061965c4c351d3246e77"],"ref":"refs/changes/53/1453/6","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1487793928,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1487793958,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/pg.js","line":103,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Did this come in with the rebase?"},{"file":"lib/pg.js","line":103,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Yes."},{"file":"lib/pg.js","line":103,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"In general, this makes things much harder to review incrementally.  We should probably add to the Gerrit docs that rebases should be pushed as a separate patchset.  That causes Gerrit to mark the change as a rebase most of the time, and at the very least separates out changes pulled in from changes that are intended to be under review."},{"file":"lib/pg.js","line":103,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"I did do the rebase separately, as patchset 5. Gerrit even marked it as a rebase, so I\u0027m uncertain why it\u0027s showing up when diffing against earlier patchsets. Maybe I\u0027ll just hold off on rebases until the end of reviews going forward."},{"file":"lib/pg.js","line":103,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Oh!  Sorry that I missed that.  This is probably entirely my fault for not having reviewed the 3-\u003e4 and then 5 -\u003e 6 separately.  (It\u0027s definitely annoying that that\u0027s necessary, but when we tested this early on, it seemed like it generally worked.)  Sorry about that."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":11,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"README.md","type":"MODIFIED","insertions":1,"deletions":0},{"file":"boot/setup.sh","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"docs/index.md","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/buckets/creat.js","type":"MODIFIED","insertions":33,"deletions":-15},{"file":"lib/buckets/del.js","type":"MODIFIED","insertions":32,"deletions":-16},{"file":"lib/buckets/get.js","type":"MODIFIED","insertions":29,"deletions":-9},{"file":"lib/buckets/list.js","type":"MODIFIED","insertions":27,"deletions":-11},{"file":"lib/buckets/update.js","type":"MODIFIED","insertions":37,"deletions":-20},{"file":"lib/control.js","type":"MODIFIED","insertions":176,"deletions":-51},{"file":"lib/errors.js","type":"MODIFIED","insertions":9,"deletions":-24},{"file":"lib/manatee.js","type":"MODIFIED","insertions":8,"deletions":-19},{"file":"lib/objects/batch.js","type":"MODIFIED","insertions":38,"deletions":-17},{"file":"lib/objects/common.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/objects/del.js","type":"MODIFIED","insertions":25,"deletions":-11},{"file":"lib/objects/del_many.js","type":"MODIFIED","insertions":27,"deletions":-14},{"file":"lib/objects/find.js","type":"MODIFIED","insertions":47,"deletions":-33},{"file":"lib/objects/get.js","type":"MODIFIED","insertions":44,"deletions":-27},{"file":"lib/objects/put.js","type":"MODIFIED","insertions":30,"deletions":-17},{"file":"lib/objects/reindex.js","type":"MODIFIED","insertions":31,"deletions":-16},{"file":"lib/objects/update.js","type":"MODIFIED","insertions":32,"deletions":-17},{"file":"lib/pg.js","type":"MODIFIED","insertions":2,"deletions":-10},{"file":"lib/ping.js","type":"MODIFIED","insertions":29,"deletions":-9},{"file":"lib/server.js","type":"MODIFIED","insertions":114,"deletions":-52},{"file":"lib/sql.js","type":"MODIFIED","insertions":29,"deletions":-11},{"file":"lib/standalone.js","type":"MODIFIED","insertions":13,"deletions":-16},{"file":"main.js","type":"MODIFIED","insertions":11,"deletions":-8},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"smf/manifests/moray.xml.in","type":"MODIFIED","insertions":3,"deletions":-2}],"sizeInsertions":839,"sizeDeletions":-433},{"number":"7","revision":"df8829d2c6fcb20b112c35f49af94579db8642ca","parents":["d23510d05c04a7f4da5e061965c4c351d3246e77"],"ref":"refs/changes/53/1453/7","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1487902051,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1487793958,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":12,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"README.md","type":"MODIFIED","insertions":1,"deletions":0},{"file":"boot/setup.sh","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"docs/index.md","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/buckets/creat.js","type":"MODIFIED","insertions":33,"deletions":-15},{"file":"lib/buckets/del.js","type":"MODIFIED","insertions":32,"deletions":-16},{"file":"lib/buckets/get.js","type":"MODIFIED","insertions":29,"deletions":-9},{"file":"lib/buckets/list.js","type":"MODIFIED","insertions":27,"deletions":-11},{"file":"lib/buckets/update.js","type":"MODIFIED","insertions":37,"deletions":-20},{"file":"lib/control.js","type":"MODIFIED","insertions":176,"deletions":-51},{"file":"lib/errors.js","type":"MODIFIED","insertions":9,"deletions":-24},{"file":"lib/manatee.js","type":"MODIFIED","insertions":8,"deletions":-19},{"file":"lib/objects/batch.js","type":"MODIFIED","insertions":38,"deletions":-17},{"file":"lib/objects/common.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/objects/del.js","type":"MODIFIED","insertions":25,"deletions":-11},{"file":"lib/objects/del_many.js","type":"MODIFIED","insertions":27,"deletions":-14},{"file":"lib/objects/find.js","type":"MODIFIED","insertions":47,"deletions":-33},{"file":"lib/objects/get.js","type":"MODIFIED","insertions":44,"deletions":-27},{"file":"lib/objects/put.js","type":"MODIFIED","insertions":30,"deletions":-17},{"file":"lib/objects/reindex.js","type":"MODIFIED","insertions":31,"deletions":-16},{"file":"lib/objects/update.js","type":"MODIFIED","insertions":32,"deletions":-17},{"file":"lib/pg.js","type":"MODIFIED","insertions":2,"deletions":-10},{"file":"lib/ping.js","type":"MODIFIED","insertions":29,"deletions":-9},{"file":"lib/server.js","type":"MODIFIED","insertions":114,"deletions":-52},{"file":"lib/sql.js","type":"MODIFIED","insertions":29,"deletions":-11},{"file":"lib/standalone.js","type":"MODIFIED","insertions":13,"deletions":-16},{"file":"main.js","type":"MODIFIED","insertions":11,"deletions":-8},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"smf/manifests/moray.xml.in","type":"MODIFIED","insertions":3,"deletions":-2}],"sizeInsertions":839,"sizeDeletions":-433},{"number":"8","revision":"5255460632fbc4465919f7e0b8a5ff7f188d8467","parents":["d23510d05c04a7f4da5e061965c4c351d3246e77"],"ref":"refs/changes/53/1453/8","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1487902100,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1487902135,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":12,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"README.md","type":"MODIFIED","insertions":1,"deletions":0},{"file":"boot/setup.sh","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"docs/index.md","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/buckets/creat.js","type":"MODIFIED","insertions":33,"deletions":-15},{"file":"lib/buckets/del.js","type":"MODIFIED","insertions":32,"deletions":-16},{"file":"lib/buckets/get.js","type":"MODIFIED","insertions":29,"deletions":-9},{"file":"lib/buckets/list.js","type":"MODIFIED","insertions":27,"deletions":-11},{"file":"lib/buckets/update.js","type":"MODIFIED","insertions":37,"deletions":-20},{"file":"lib/control.js","type":"MODIFIED","insertions":176,"deletions":-51},{"file":"lib/errors.js","type":"MODIFIED","insertions":9,"deletions":-24},{"file":"lib/manatee.js","type":"MODIFIED","insertions":8,"deletions":-19},{"file":"lib/objects/batch.js","type":"MODIFIED","insertions":38,"deletions":-17},{"file":"lib/objects/common.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/objects/del.js","type":"MODIFIED","insertions":25,"deletions":-11},{"file":"lib/objects/del_many.js","type":"MODIFIED","insertions":27,"deletions":-14},{"file":"lib/objects/find.js","type":"MODIFIED","insertions":47,"deletions":-33},{"file":"lib/objects/get.js","type":"MODIFIED","insertions":44,"deletions":-27},{"file":"lib/objects/put.js","type":"MODIFIED","insertions":30,"deletions":-17},{"file":"lib/objects/reindex.js","type":"MODIFIED","insertions":31,"deletions":-16},{"file":"lib/objects/update.js","type":"MODIFIED","insertions":32,"deletions":-17},{"file":"lib/pg.js","type":"MODIFIED","insertions":2,"deletions":-10},{"file":"lib/ping.js","type":"MODIFIED","insertions":29,"deletions":-9},{"file":"lib/server.js","type":"MODIFIED","insertions":115,"deletions":-52},{"file":"lib/sql.js","type":"MODIFIED","insertions":29,"deletions":-11},{"file":"lib/standalone.js","type":"MODIFIED","insertions":13,"deletions":-16},{"file":"main.js","type":"MODIFIED","insertions":11,"deletions":-8},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"smf/manifests/moray.xml.in","type":"MODIFIED","insertions":3,"deletions":-2}],"sizeInsertions":840,"sizeDeletions":-433},{"number":"9","revision":"ca25766c9550646c6d8c65edc0c098f7a37275ea","parents":["d23510d05c04a7f4da5e061965c4c351d3246e77"],"ref":"refs/changes/53/1453/9","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1490216061,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1490216117,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/schema.js","line":0,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"This file could use a comment explaining the contents.\n\nIs the expectation that these schemas accept exactly the input that was accepted before (at least for inputs that didn\u0027t generate an uncaughtException before)?  Is it any more restrictive?"},{"file":"lib/schema.js","line":0,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"I\u0027ve added a comment just before the requires. Let me know if there\u0027s anything else that you think should be added to it.\n\nBeyond catching things that were previously uncaughtException errors, the following things are now stricter:\n\n- req_id must be a UUID\n- timeout must be a number\n- unknown batch \"operation\" values are now rejected (the client already enforced this)\n- hasOwnProperty isn\u0027t allowed as a field on objects\n\nI plan on doing a full nightly run against this moray build to make sure nothing is tripped up by these changes."},{"file":"lib/schema.js","line":0,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"That sounds great.  I think it would be worth running the Marlin test suite as well, since that exercises a number of cases that Triton and Manta setup and Triton tests likely don\u0027t.  I can probably help with that."},{"file":"lib/schema.js","line":30,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Are these JSON schema v3 or something later?  It might be useful to document that.  I wasn\u0027t sure what the default is for AJV.  (I\u0027m realizing I should document the analogous functions in jsprim as well, though JSV is clearer that the default is v3.)"},{"file":"lib/schema.js","line":30,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"They\u0027re JSON schema v4. I\u0027ve added this to the comment above."},{"file":"lib/server.js","line":156,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Was the capitalization change here and at line 160 intentional?  While the vast majority of log messages seem to start with proper nouns (mostly function names), and we haven\u0027t been totally consistent on the others, the more common style here seems to be to start with lowercase, which I think is typical at least in Manta."},{"file":"lib/server.js","line":156,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"I changed line 1ine 160 to capitalize \"Moray\" since it\u0027s a proper noun, and it seemed that it should be capitalized in the logs.\n\nI\u0027m removing the line 155 in the latest patchset since I misunderstood the API of the callback to .listen(). I\u0027ll make the new log line I\u0027m adding for Kang log lowercase, though."},{"file":"package.json","line":10,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Did you verify that nothing is broken by the breaking change in assert-plus 0.2.0?"},{"file":"package.json","line":10,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"I took a look at all of the current assert.object() calls, and they\u0027re all on things that should be a valid object today, and are usually followed by asserting fields inside the object.\n\nThe only places where it looks like the behaviour would change with the newer assert-plus is at what point doing a PutObject() w/ null instead of an object w/ fields fails. It looks like it would currently blow up on an Object.keys(), but changing to the newer assert-plus would fail earlier.\n\nAll of the other assert.object() calls look like they would have crashed before being reached, or are only passed objects constructed by Moray itself, which should never be null."},{"file":"package.json","line":10,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Sounds good. Thanks for doing all that."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":12,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"README.md","type":"MODIFIED","insertions":1,"deletions":0},{"file":"boot/setup.sh","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"docs/index.md","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/buckets/common.js","type":"MODIFIED","insertions":20,"deletions":-71},{"file":"lib/buckets/creat.js","type":"MODIFIED","insertions":33,"deletions":-15},{"file":"lib/buckets/del.js","type":"MODIFIED","insertions":33,"deletions":-17},{"file":"lib/buckets/get.js","type":"MODIFIED","insertions":29,"deletions":-9},{"file":"lib/buckets/list.js","type":"MODIFIED","insertions":27,"deletions":-11},{"file":"lib/buckets/update.js","type":"MODIFIED","insertions":37,"deletions":-20},{"file":"lib/control.js","type":"MODIFIED","insertions":156,"deletions":-52},{"file":"lib/errors.js","type":"MODIFIED","insertions":10,"deletions":-24},{"file":"lib/manatee.js","type":"MODIFIED","insertions":8,"deletions":-19},{"file":"lib/objects/batch.js","type":"MODIFIED","insertions":37,"deletions":-17},{"file":"lib/objects/common.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/objects/del.js","type":"MODIFIED","insertions":25,"deletions":-11},{"file":"lib/objects/del_many.js","type":"MODIFIED","insertions":27,"deletions":-14},{"file":"lib/objects/find.js","type":"MODIFIED","insertions":47,"deletions":-33},{"file":"lib/objects/get.js","type":"MODIFIED","insertions":44,"deletions":-27},{"file":"lib/objects/put.js","type":"MODIFIED","insertions":30,"deletions":-17},{"file":"lib/objects/reindex.js","type":"MODIFIED","insertions":31,"deletions":-16},{"file":"lib/objects/update.js","type":"MODIFIED","insertions":32,"deletions":-17},{"file":"lib/pg.js","type":"MODIFIED","insertions":2,"deletions":-10},{"file":"lib/ping.js","type":"MODIFIED","insertions":29,"deletions":-9},{"file":"lib/schema.js","type":"ADDED","insertions":286,"deletions":0},{"file":"lib/server.js","type":"MODIFIED","insertions":115,"deletions":-52},{"file":"lib/sql.js","type":"MODIFIED","insertions":29,"deletions":-11},{"file":"lib/standalone.js","type":"MODIFIED","insertions":13,"deletions":-16},{"file":"main.js","type":"MODIFIED","insertions":11,"deletions":-8},{"file":"package.json","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"smf/manifests/moray.xml.in","type":"MODIFIED","insertions":3,"deletions":-2}],"sizeInsertions":1129,"sizeDeletions":-507},{"number":"10","revision":"8f765d7d255fcfb38c6ce89f9cd5008776d4369a","parents":["d23510d05c04a7f4da5e061965c4c351d3246e77"],"ref":"refs/changes/53/1453/10","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1490653326,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1490653923,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1490653362,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":12,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"README.md","type":"MODIFIED","insertions":1,"deletions":0},{"file":"boot/setup.sh","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"docs/index.md","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/buckets/common.js","type":"MODIFIED","insertions":20,"deletions":-71},{"file":"lib/buckets/creat.js","type":"MODIFIED","insertions":33,"deletions":-15},{"file":"lib/buckets/del.js","type":"MODIFIED","insertions":33,"deletions":-17},{"file":"lib/buckets/get.js","type":"MODIFIED","insertions":29,"deletions":-9},{"file":"lib/buckets/list.js","type":"MODIFIED","insertions":27,"deletions":-11},{"file":"lib/buckets/update.js","type":"MODIFIED","insertions":37,"deletions":-20},{"file":"lib/control.js","type":"MODIFIED","insertions":156,"deletions":-52},{"file":"lib/errors.js","type":"MODIFIED","insertions":10,"deletions":-24},{"file":"lib/manatee.js","type":"MODIFIED","insertions":8,"deletions":-19},{"file":"lib/objects/batch.js","type":"MODIFIED","insertions":37,"deletions":-17},{"file":"lib/objects/common.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/objects/del.js","type":"MODIFIED","insertions":25,"deletions":-11},{"file":"lib/objects/del_many.js","type":"MODIFIED","insertions":27,"deletions":-14},{"file":"lib/objects/find.js","type":"MODIFIED","insertions":47,"deletions":-33},{"file":"lib/objects/get.js","type":"MODIFIED","insertions":44,"deletions":-27},{"file":"lib/objects/put.js","type":"MODIFIED","insertions":30,"deletions":-17},{"file":"lib/objects/reindex.js","type":"MODIFIED","insertions":31,"deletions":-16},{"file":"lib/objects/update.js","type":"MODIFIED","insertions":32,"deletions":-17},{"file":"lib/pg.js","type":"MODIFIED","insertions":2,"deletions":-10},{"file":"lib/ping.js","type":"MODIFIED","insertions":29,"deletions":-9},{"file":"lib/schema.js","type":"ADDED","insertions":293,"deletions":0},{"file":"lib/server.js","type":"MODIFIED","insertions":153,"deletions":-58},{"file":"lib/sql.js","type":"MODIFIED","insertions":29,"deletions":-11},{"file":"lib/standalone.js","type":"MODIFIED","insertions":13,"deletions":-16},{"file":"main.js","type":"MODIFIED","insertions":11,"deletions":-8},{"file":"package.json","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"smf/manifests/moray.xml.in","type":"MODIFIED","insertions":3,"deletions":-2}],"sizeInsertions":1174,"sizeDeletions":-513},{"number":"11","revision":"158a662c8bb1a1bbf6f4d763d9dfb895a55b31cd","parents":["d23510d05c04a7f4da5e061965c4c351d3246e77"],"ref":"refs/changes/53/1453/11","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1493337466,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1493337496,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":12,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"README.md","type":"MODIFIED","insertions":1,"deletions":0},{"file":"boot/setup.sh","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"docs/index.md","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/buckets/common.js","type":"MODIFIED","insertions":20,"deletions":-71},{"file":"lib/buckets/creat.js","type":"MODIFIED","insertions":33,"deletions":-15},{"file":"lib/buckets/del.js","type":"MODIFIED","insertions":33,"deletions":-17},{"file":"lib/buckets/get.js","type":"MODIFIED","insertions":29,"deletions":-9},{"file":"lib/buckets/list.js","type":"MODIFIED","insertions":27,"deletions":-11},{"file":"lib/buckets/update.js","type":"MODIFIED","insertions":37,"deletions":-20},{"file":"lib/control.js","type":"MODIFIED","insertions":156,"deletions":-52},{"file":"lib/errors.js","type":"MODIFIED","insertions":11,"deletions":-25},{"file":"lib/manatee.js","type":"MODIFIED","insertions":8,"deletions":-19},{"file":"lib/objects/batch.js","type":"MODIFIED","insertions":37,"deletions":-17},{"file":"lib/objects/common.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/objects/del.js","type":"MODIFIED","insertions":25,"deletions":-11},{"file":"lib/objects/del_many.js","type":"MODIFIED","insertions":27,"deletions":-14},{"file":"lib/objects/find.js","type":"MODIFIED","insertions":47,"deletions":-33},{"file":"lib/objects/get.js","type":"MODIFIED","insertions":44,"deletions":-27},{"file":"lib/objects/put.js","type":"MODIFIED","insertions":30,"deletions":-17},{"file":"lib/objects/reindex.js","type":"MODIFIED","insertions":31,"deletions":-16},{"file":"lib/objects/update.js","type":"MODIFIED","insertions":32,"deletions":-17},{"file":"lib/pg.js","type":"MODIFIED","insertions":2,"deletions":-10},{"file":"lib/ping.js","type":"MODIFIED","insertions":29,"deletions":-9},{"file":"lib/schema.js","type":"ADDED","insertions":330,"deletions":0},{"file":"lib/server.js","type":"MODIFIED","insertions":153,"deletions":-58},{"file":"lib/sql.js","type":"MODIFIED","insertions":29,"deletions":-11},{"file":"lib/standalone.js","type":"MODIFIED","insertions":13,"deletions":-16},{"file":"main.js","type":"MODIFIED","insertions":11,"deletions":-8},{"file":"package.json","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"smf/manifests/moray.xml.in","type":"MODIFIED","insertions":3,"deletions":-2}],"sizeInsertions":1212,"sizeDeletions":-514},{"number":"12","revision":"398580b808d08a346e19455fea5ad4e754a6c866","parents":["a6b6280c04078e12eb77351f8e818cb0bc9dfd80"],"ref":"refs/changes/53/1453/12","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1493337546,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1493337496,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/control.js","line":166,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"For these variables, would it be unreasonable to ask for a consistent \u003cthing\u003e\u003cid\u003e format?  I understand that their sources are all differ in nomenclature, but when all placed together it\u0027s a little maddening.  Is that unreasonable?"},{"file":"lib/control.js","line":166,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"That seems fine. It\u0027s the names of the fields below that are specifically named; these can be changed to match each other."},{"file":"lib/server.js","line":115,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Was this intended to be left as a panic stub?"},{"file":"lib/server.js","line":115,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"I stubbed this out while I tried to determine its usefulness, and whether we should implement it. I talked to Dave, and we don\u0027t think that it\u0027s too important to keep it, since it\u0027s disabled in Triton and Manta, and the information that it provides can be gathered by adjusting the log level or using the DTrace probes. I\u0027ve updated MORAY-390 to mention its removal."},{"file":"lib/server.js","line":196,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Is this prototype invoked somewhere? I don\u0027t see it being called from main.js or this file. Is this a node-ism that I\u0027m not aware of?"},{"file":"lib/server.js","line":196,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"This isn\u0027t invoked anywhere in this repo, but is used by node-moray-sandbox when shutting down the server."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":12,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"README.md","type":"MODIFIED","insertions":1,"deletions":0},{"file":"boot/setup.sh","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"docs/index.md","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/buckets/common.js","type":"MODIFIED","insertions":20,"deletions":-71},{"file":"lib/buckets/creat.js","type":"MODIFIED","insertions":33,"deletions":-15},{"file":"lib/buckets/del.js","type":"MODIFIED","insertions":33,"deletions":-17},{"file":"lib/buckets/get.js","type":"MODIFIED","insertions":29,"deletions":-9},{"file":"lib/buckets/list.js","type":"MODIFIED","insertions":27,"deletions":-11},{"file":"lib/buckets/update.js","type":"MODIFIED","insertions":37,"deletions":-20},{"file":"lib/control.js","type":"MODIFIED","insertions":156,"deletions":-52},{"file":"lib/errors.js","type":"MODIFIED","insertions":11,"deletions":-25},{"file":"lib/manatee.js","type":"MODIFIED","insertions":8,"deletions":-19},{"file":"lib/objects/batch.js","type":"MODIFIED","insertions":37,"deletions":-17},{"file":"lib/objects/common.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/objects/del.js","type":"MODIFIED","insertions":25,"deletions":-11},{"file":"lib/objects/del_many.js","type":"MODIFIED","insertions":27,"deletions":-14},{"file":"lib/objects/find.js","type":"MODIFIED","insertions":47,"deletions":-33},{"file":"lib/objects/get.js","type":"MODIFIED","insertions":44,"deletions":-27},{"file":"lib/objects/put.js","type":"MODIFIED","insertions":30,"deletions":-17},{"file":"lib/objects/reindex.js","type":"MODIFIED","insertions":31,"deletions":-16},{"file":"lib/objects/update.js","type":"MODIFIED","insertions":32,"deletions":-17},{"file":"lib/pg.js","type":"MODIFIED","insertions":2,"deletions":-10},{"file":"lib/ping.js","type":"MODIFIED","insertions":29,"deletions":-9},{"file":"lib/schema.js","type":"ADDED","insertions":330,"deletions":0},{"file":"lib/server.js","type":"MODIFIED","insertions":153,"deletions":-58},{"file":"lib/sql.js","type":"MODIFIED","insertions":29,"deletions":-11},{"file":"lib/standalone.js","type":"MODIFIED","insertions":13,"deletions":-16},{"file":"main.js","type":"MODIFIED","insertions":11,"deletions":-8},{"file":"package.json","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"smf/manifests/moray.xml.in","type":"MODIFIED","insertions":3,"deletions":-2}],"sizeInsertions":1212,"sizeDeletions":-514},{"number":"13","revision":"5e8630a46cab3cf3a90dc0ccffa774904cbc51bb","parents":["a6b6280c04078e12eb77351f8e818cb0bc9dfd80"],"ref":"refs/changes/53/1453/13","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1493827913,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1493848511,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1493827940,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1493833959,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1493913330,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":12,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"README.md","type":"MODIFIED","insertions":1,"deletions":0},{"file":"boot/setup.sh","type":"MODIFIED","insertions":6,"deletions":-2},{"file":"docs/index.md","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"etc/config.coal.json","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"etc/config.coal.manta.json","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"etc/config.lab.json","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"etc/config.local.json","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"etc/config.standalone.json","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"lib/buckets/common.js","type":"MODIFIED","insertions":20,"deletions":-71},{"file":"lib/buckets/creat.js","type":"MODIFIED","insertions":33,"deletions":-15},{"file":"lib/buckets/del.js","type":"MODIFIED","insertions":33,"deletions":-17},{"file":"lib/buckets/get.js","type":"MODIFIED","insertions":29,"deletions":-9},{"file":"lib/buckets/list.js","type":"MODIFIED","insertions":27,"deletions":-11},{"file":"lib/buckets/update.js","type":"MODIFIED","insertions":37,"deletions":-20},{"file":"lib/control.js","type":"MODIFIED","insertions":157,"deletions":-52},{"file":"lib/errors.js","type":"MODIFIED","insertions":11,"deletions":-25},{"file":"lib/manatee.js","type":"MODIFIED","insertions":8,"deletions":-19},{"file":"lib/objects/batch.js","type":"MODIFIED","insertions":37,"deletions":-17},{"file":"lib/objects/common.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/objects/del.js","type":"MODIFIED","insertions":25,"deletions":-11},{"file":"lib/objects/del_many.js","type":"MODIFIED","insertions":27,"deletions":-14},{"file":"lib/objects/find.js","type":"MODIFIED","insertions":47,"deletions":-33},{"file":"lib/objects/get.js","type":"MODIFIED","insertions":44,"deletions":-27},{"file":"lib/objects/put.js","type":"MODIFIED","insertions":30,"deletions":-17},{"file":"lib/objects/reindex.js","type":"MODIFIED","insertions":31,"deletions":-16},{"file":"lib/objects/update.js","type":"MODIFIED","insertions":32,"deletions":-17},{"file":"lib/pg.js","type":"MODIFIED","insertions":2,"deletions":-10},{"file":"lib/ping.js","type":"MODIFIED","insertions":29,"deletions":-9},{"file":"lib/schema.js","type":"ADDED","insertions":330,"deletions":0},{"file":"lib/server.js","type":"MODIFIED","insertions":151,"deletions":-61},{"file":"lib/sql.js","type":"MODIFIED","insertions":29,"deletions":-11},{"file":"lib/standalone.js","type":"MODIFIED","insertions":13,"deletions":-16},{"file":"main.js","type":"MODIFIED","insertions":11,"deletions":-8},{"file":"package.json","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"sapi_manifests/moray/template","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"sdc/sapi_manifests/moray/template","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"smf/manifests/moray.xml.in","type":"MODIFIED","insertions":3,"deletions":-2}],"sizeInsertions":1211,"sizeDeletions":-524},{"number":"14","revision":"20fa1080cd90b7c4ab2faebc117ea3d69e355e39","parents":["d362db4d7a72f08c0b14fa8639b3e2b1a70981b6"],"ref":"refs/changes/53/1453/14","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1494019560,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1493848511,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1493827940,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1493833959,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1493913330,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":12,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"README.md","type":"MODIFIED","insertions":1,"deletions":0},{"file":"boot/setup.sh","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"docs/index.md","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"etc/config.coal.json","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"etc/config.coal.manta.json","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"etc/config.lab.json","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"etc/config.local.json","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"etc/config.standalone.json","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"lib/buckets/common.js","type":"MODIFIED","insertions":20,"deletions":-71},{"file":"lib/buckets/creat.js","type":"MODIFIED","insertions":33,"deletions":-15},{"file":"lib/buckets/del.js","type":"MODIFIED","insertions":33,"deletions":-17},{"file":"lib/buckets/get.js","type":"MODIFIED","insertions":29,"deletions":-9},{"file":"lib/buckets/list.js","type":"MODIFIED","insertions":27,"deletions":-11},{"file":"lib/buckets/update.js","type":"MODIFIED","insertions":37,"deletions":-20},{"file":"lib/control.js","type":"MODIFIED","insertions":157,"deletions":-52},{"file":"lib/errors.js","type":"MODIFIED","insertions":11,"deletions":-25},{"file":"lib/manatee.js","type":"MODIFIED","insertions":8,"deletions":-19},{"file":"lib/objects/batch.js","type":"MODIFIED","insertions":37,"deletions":-17},{"file":"lib/objects/common.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/objects/del.js","type":"MODIFIED","insertions":25,"deletions":-11},{"file":"lib/objects/del_many.js","type":"MODIFIED","insertions":27,"deletions":-14},{"file":"lib/objects/find.js","type":"MODIFIED","insertions":47,"deletions":-33},{"file":"lib/objects/get.js","type":"MODIFIED","insertions":44,"deletions":-27},{"file":"lib/objects/put.js","type":"MODIFIED","insertions":30,"deletions":-17},{"file":"lib/objects/reindex.js","type":"MODIFIED","insertions":31,"deletions":-16},{"file":"lib/objects/update.js","type":"MODIFIED","insertions":32,"deletions":-17},{"file":"lib/pg.js","type":"MODIFIED","insertions":2,"deletions":-10},{"file":"lib/ping.js","type":"MODIFIED","insertions":29,"deletions":-9},{"file":"lib/schema.js","type":"ADDED","insertions":330,"deletions":0},{"file":"lib/server.js","type":"MODIFIED","insertions":151,"deletions":-61},{"file":"lib/sql.js","type":"MODIFIED","insertions":29,"deletions":-11},{"file":"lib/standalone.js","type":"MODIFIED","insertions":13,"deletions":-16},{"file":"main.js","type":"MODIFIED","insertions":11,"deletions":-8},{"file":"package.json","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"sapi_manifests/moray/template","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"sdc/sapi_manifests/moray/template","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"smf/manifests/moray.xml.in","type":"MODIFIED","insertions":3,"deletions":-2}],"sizeInsertions":1210,"sizeDeletions":-523},{"number":"15","revision":"a430d077084f6a2581a37c3c05785a0c2a4f868f","parents":["d362db4d7a72f08c0b14fa8639b3e2b1a70981b6"],"ref":"refs/changes/53/1453/15","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1494019646,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1493848511,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1493827940,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1493833959,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1493913330,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":15,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"README.md","type":"MODIFIED","insertions":1,"deletions":0},{"file":"boot/setup.sh","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"docs/index.md","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"etc/config.coal.json","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"etc/config.coal.manta.json","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"etc/config.lab.json","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"etc/config.local.json","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"etc/config.standalone.json","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"lib/buckets/common.js","type":"MODIFIED","insertions":20,"deletions":-71},{"file":"lib/buckets/creat.js","type":"MODIFIED","insertions":33,"deletions":-15},{"file":"lib/buckets/del.js","type":"MODIFIED","insertions":33,"deletions":-17},{"file":"lib/buckets/get.js","type":"MODIFIED","insertions":29,"deletions":-9},{"file":"lib/buckets/list.js","type":"MODIFIED","insertions":27,"deletions":-11},{"file":"lib/buckets/update.js","type":"MODIFIED","insertions":37,"deletions":-20},{"file":"lib/control.js","type":"MODIFIED","insertions":157,"deletions":-52},{"file":"lib/errors.js","type":"MODIFIED","insertions":11,"deletions":-25},{"file":"lib/manatee.js","type":"MODIFIED","insertions":8,"deletions":-19},{"file":"lib/objects/batch.js","type":"MODIFIED","insertions":37,"deletions":-17},{"file":"lib/objects/common.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/objects/del.js","type":"MODIFIED","insertions":25,"deletions":-11},{"file":"lib/objects/del_many.js","type":"MODIFIED","insertions":27,"deletions":-14},{"file":"lib/objects/find.js","type":"MODIFIED","insertions":47,"deletions":-33},{"file":"lib/objects/get.js","type":"MODIFIED","insertions":44,"deletions":-27},{"file":"lib/objects/put.js","type":"MODIFIED","insertions":30,"deletions":-17},{"file":"lib/objects/reindex.js","type":"MODIFIED","insertions":31,"deletions":-16},{"file":"lib/objects/update.js","type":"MODIFIED","insertions":32,"deletions":-17},{"file":"lib/pg.js","type":"MODIFIED","insertions":2,"deletions":-10},{"file":"lib/ping.js","type":"MODIFIED","insertions":29,"deletions":-9},{"file":"lib/schema.js","type":"ADDED","insertions":330,"deletions":0},{"file":"lib/server.js","type":"MODIFIED","insertions":151,"deletions":-61},{"file":"lib/sql.js","type":"MODIFIED","insertions":29,"deletions":-11},{"file":"lib/standalone.js","type":"MODIFIED","insertions":13,"deletions":-16},{"file":"main.js","type":"MODIFIED","insertions":11,"deletions":-8},{"file":"package.json","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"sapi_manifests/moray/template","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"sdc/sapi_manifests/moray/template","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"smf/manifests/moray.xml.in","type":"MODIFIED","insertions":3,"deletions":-2}],"sizeInsertions":1210,"sizeDeletions":-523},{"number":"16","revision":"8a031d771b65de4f90064b5a598ec799a107e043","parents":["18fe21a66d6cc937179d62ac2995e8a8c9e33226"],"ref":"refs/changes/53/1453/16","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1497571202,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1497648823,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1497571229,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1497622877,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":15,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"README.md","type":"MODIFIED","insertions":1,"deletions":0},{"file":"boot/setup.sh","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"docs/index.md","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"etc/config.coal.json","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"etc/config.coal.manta.json","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"etc/config.lab.json","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"etc/config.local.json","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"etc/config.standalone.json","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"lib/buckets/common.js","type":"MODIFIED","insertions":20,"deletions":-71},{"file":"lib/buckets/creat.js","type":"MODIFIED","insertions":33,"deletions":-15},{"file":"lib/buckets/del.js","type":"MODIFIED","insertions":33,"deletions":-17},{"file":"lib/buckets/get.js","type":"MODIFIED","insertions":29,"deletions":-9},{"file":"lib/buckets/list.js","type":"MODIFIED","insertions":27,"deletions":-11},{"file":"lib/buckets/update.js","type":"MODIFIED","insertions":37,"deletions":-20},{"file":"lib/control.js","type":"MODIFIED","insertions":157,"deletions":-52},{"file":"lib/errors.js","type":"MODIFIED","insertions":11,"deletions":-25},{"file":"lib/manatee.js","type":"MODIFIED","insertions":8,"deletions":-19},{"file":"lib/objects/batch.js","type":"MODIFIED","insertions":37,"deletions":-17},{"file":"lib/objects/common.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/objects/del.js","type":"MODIFIED","insertions":25,"deletions":-11},{"file":"lib/objects/del_many.js","type":"MODIFIED","insertions":27,"deletions":-14},{"file":"lib/objects/find.js","type":"MODIFIED","insertions":49,"deletions":-34},{"file":"lib/objects/get.js","type":"MODIFIED","insertions":44,"deletions":-27},{"file":"lib/objects/put.js","type":"MODIFIED","insertions":30,"deletions":-17},{"file":"lib/objects/reindex.js","type":"MODIFIED","insertions":31,"deletions":-16},{"file":"lib/objects/update.js","type":"MODIFIED","insertions":32,"deletions":-17},{"file":"lib/pg.js","type":"MODIFIED","insertions":2,"deletions":-10},{"file":"lib/ping.js","type":"MODIFIED","insertions":29,"deletions":-9},{"file":"lib/schema.js","type":"ADDED","insertions":330,"deletions":0},{"file":"lib/server.js","type":"MODIFIED","insertions":151,"deletions":-61},{"file":"lib/sql.js","type":"MODIFIED","insertions":29,"deletions":-11},{"file":"lib/standalone.js","type":"MODIFIED","insertions":13,"deletions":-16},{"file":"main.js","type":"MODIFIED","insertions":11,"deletions":-8},{"file":"package.json","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"sapi_manifests/moray/template","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"sdc/sapi_manifests/moray/template","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"smf/manifests/moray.xml.in","type":"MODIFIED","insertions":3,"deletions":-2}],"sizeInsertions":1212,"sizeDeletions":-524},{"number":"17","revision":"ebb9807437885c5e55251774128c6ea6434b4287","parents":["18fe21a66d6cc937179d62ac2995e8a8c9e33226"],"ref":"refs/changes/53/1453/17","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1500427945,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1500427976,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":15,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"README.md","type":"MODIFIED","insertions":1,"deletions":0},{"file":"boot/setup.sh","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"docs/index.md","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"etc/config.coal.json","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"etc/config.coal.manta.json","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"etc/config.lab.json","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"etc/config.local.json","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"etc/config.standalone.json","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"lib/buckets/common.js","type":"MODIFIED","insertions":20,"deletions":-71},{"file":"lib/buckets/creat.js","type":"MODIFIED","insertions":33,"deletions":-15},{"file":"lib/buckets/del.js","type":"MODIFIED","insertions":33,"deletions":-17},{"file":"lib/buckets/get.js","type":"MODIFIED","insertions":29,"deletions":-9},{"file":"lib/buckets/list.js","type":"MODIFIED","insertions":27,"deletions":-11},{"file":"lib/buckets/update.js","type":"MODIFIED","insertions":37,"deletions":-20},{"file":"lib/control.js","type":"MODIFIED","insertions":157,"deletions":-52},{"file":"lib/errors.js","type":"MODIFIED","insertions":11,"deletions":-25},{"file":"lib/manatee.js","type":"MODIFIED","insertions":8,"deletions":-19},{"file":"lib/objects/batch.js","type":"MODIFIED","insertions":37,"deletions":-17},{"file":"lib/objects/common.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/objects/del.js","type":"MODIFIED","insertions":25,"deletions":-11},{"file":"lib/objects/del_many.js","type":"MODIFIED","insertions":27,"deletions":-14},{"file":"lib/objects/find.js","type":"MODIFIED","insertions":49,"deletions":-34},{"file":"lib/objects/get.js","type":"MODIFIED","insertions":44,"deletions":-27},{"file":"lib/objects/put.js","type":"MODIFIED","insertions":30,"deletions":-17},{"file":"lib/objects/reindex.js","type":"MODIFIED","insertions":31,"deletions":-16},{"file":"lib/objects/update.js","type":"MODIFIED","insertions":32,"deletions":-17},{"file":"lib/pg.js","type":"MODIFIED","insertions":2,"deletions":-10},{"file":"lib/ping.js","type":"MODIFIED","insertions":29,"deletions":-9},{"file":"lib/schema.js","type":"ADDED","insertions":331,"deletions":0},{"file":"lib/server.js","type":"MODIFIED","insertions":151,"deletions":-61},{"file":"lib/sql.js","type":"MODIFIED","insertions":29,"deletions":-11},{"file":"lib/standalone.js","type":"MODIFIED","insertions":13,"deletions":-16},{"file":"main.js","type":"MODIFIED","insertions":11,"deletions":-8},{"file":"package.json","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"sapi_manifests/moray/template","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"sdc/sapi_manifests/moray/template","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"smf/manifests/moray.xml.in","type":"MODIFIED","insertions":3,"deletions":-2}],"sizeInsertions":1213,"sizeDeletions":-524},{"number":"18","revision":"fb4bc8ff3756b150c2f3604f905189c578eac5e9","parents":["18fe21a66d6cc937179d62ac2995e8a8c9e33226"],"ref":"refs/changes/53/1453/18","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1501107211,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1501266776,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1501107247,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":15,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"README.md","type":"MODIFIED","insertions":1,"deletions":0},{"file":"boot/setup.sh","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"docs/index.md","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"etc/config.coal.json","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"etc/config.coal.manta.json","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"etc/config.lab.json","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"etc/config.local.json","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"etc/config.standalone.json","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"lib/buckets/common.js","type":"MODIFIED","insertions":20,"deletions":-71},{"file":"lib/buckets/creat.js","type":"MODIFIED","insertions":33,"deletions":-15},{"file":"lib/buckets/del.js","type":"MODIFIED","insertions":33,"deletions":-17},{"file":"lib/buckets/get.js","type":"MODIFIED","insertions":29,"deletions":-9},{"file":"lib/buckets/list.js","type":"MODIFIED","insertions":27,"deletions":-11},{"file":"lib/buckets/update.js","type":"MODIFIED","insertions":37,"deletions":-20},{"file":"lib/control.js","type":"MODIFIED","insertions":160,"deletions":-54},{"file":"lib/errors.js","type":"MODIFIED","insertions":11,"deletions":-25},{"file":"lib/manatee.js","type":"MODIFIED","insertions":8,"deletions":-19},{"file":"lib/objects/batch.js","type":"MODIFIED","insertions":37,"deletions":-17},{"file":"lib/objects/common.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/objects/del.js","type":"MODIFIED","insertions":25,"deletions":-11},{"file":"lib/objects/del_many.js","type":"MODIFIED","insertions":27,"deletions":-14},{"file":"lib/objects/find.js","type":"MODIFIED","insertions":49,"deletions":-34},{"file":"lib/objects/get.js","type":"MODIFIED","insertions":44,"deletions":-27},{"file":"lib/objects/put.js","type":"MODIFIED","insertions":30,"deletions":-17},{"file":"lib/objects/reindex.js","type":"MODIFIED","insertions":31,"deletions":-16},{"file":"lib/objects/update.js","type":"MODIFIED","insertions":32,"deletions":-17},{"file":"lib/pg.js","type":"MODIFIED","insertions":2,"deletions":-10},{"file":"lib/ping.js","type":"MODIFIED","insertions":29,"deletions":-9},{"file":"lib/schema.js","type":"ADDED","insertions":331,"deletions":0},{"file":"lib/server.js","type":"MODIFIED","insertions":151,"deletions":-61},{"file":"lib/sql.js","type":"MODIFIED","insertions":29,"deletions":-11},{"file":"lib/standalone.js","type":"MODIFIED","insertions":13,"deletions":-16},{"file":"main.js","type":"MODIFIED","insertions":11,"deletions":-8},{"file":"package.json","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"sapi_manifests/moray/template","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"sdc/sapi_manifests/moray/template","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"smf/manifests/moray.xml.in","type":"MODIFIED","insertions":3,"deletions":-2}],"sizeInsertions":1216,"sizeDeletions":-526},{"number":"19","revision":"74f4d096b0c30d6db143097dd86773a72dae5580","parents":["4808aed525594032bed1588fac9e03da025e3eac"],"ref":"refs/changes/53/1453/19","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1501625038,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1501266776,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1501107247,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":15,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"README.md","type":"MODIFIED","insertions":1,"deletions":0},{"file":"boot/setup.sh","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"docs/index.md","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"etc/config.coal.json","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"etc/config.coal.manta.json","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"etc/config.lab.json","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"etc/config.local.json","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"etc/config.standalone.json","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"lib/buckets/common.js","type":"MODIFIED","insertions":20,"deletions":-71},{"file":"lib/buckets/creat.js","type":"MODIFIED","insertions":33,"deletions":-15},{"file":"lib/buckets/del.js","type":"MODIFIED","insertions":33,"deletions":-17},{"file":"lib/buckets/get.js","type":"MODIFIED","insertions":29,"deletions":-9},{"file":"lib/buckets/list.js","type":"MODIFIED","insertions":27,"deletions":-11},{"file":"lib/buckets/update.js","type":"MODIFIED","insertions":37,"deletions":-20},{"file":"lib/control.js","type":"MODIFIED","insertions":160,"deletions":-54},{"file":"lib/errors.js","type":"MODIFIED","insertions":11,"deletions":-25},{"file":"lib/manatee.js","type":"MODIFIED","insertions":8,"deletions":-19},{"file":"lib/objects/batch.js","type":"MODIFIED","insertions":37,"deletions":-17},{"file":"lib/objects/common.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/objects/del.js","type":"MODIFIED","insertions":25,"deletions":-11},{"file":"lib/objects/del_many.js","type":"MODIFIED","insertions":27,"deletions":-14},{"file":"lib/objects/find.js","type":"MODIFIED","insertions":49,"deletions":-34},{"file":"lib/objects/get.js","type":"MODIFIED","insertions":44,"deletions":-27},{"file":"lib/objects/put.js","type":"MODIFIED","insertions":30,"deletions":-17},{"file":"lib/objects/reindex.js","type":"MODIFIED","insertions":31,"deletions":-16},{"file":"lib/objects/update.js","type":"MODIFIED","insertions":32,"deletions":-17},{"file":"lib/pg.js","type":"MODIFIED","insertions":2,"deletions":-10},{"file":"lib/ping.js","type":"MODIFIED","insertions":29,"deletions":-9},{"file":"lib/schema.js","type":"ADDED","insertions":331,"deletions":0},{"file":"lib/server.js","type":"MODIFIED","insertions":151,"deletions":-61},{"file":"lib/sql.js","type":"MODIFIED","insertions":29,"deletions":-11},{"file":"lib/standalone.js","type":"MODIFIED","insertions":13,"deletions":-16},{"file":"main.js","type":"MODIFIED","insertions":11,"deletions":-8},{"file":"package.json","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"sapi_manifests/moray/template","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"sdc/sapi_manifests/moray/template","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"smf/manifests/moray.xml.in","type":"MODIFIED","insertions":3,"deletions":-2}],"sizeInsertions":1216,"sizeDeletions":-526},{"number":"20","revision":"2814dc317b7d42e11ab041c15df63bd499bb0cc0","parents":["4808aed525594032bed1588fac9e03da025e3eac"],"ref":"refs/changes/53/1453/20","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1501626133,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1501781834,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1504647092,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1501626158,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":15,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"README.md","type":"MODIFIED","insertions":1,"deletions":0},{"file":"boot/setup.sh","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"docs/index.md","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"etc/config.coal.json","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"etc/config.coal.manta.json","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"etc/config.lab.json","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"etc/config.local.json","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"etc/config.standalone.json","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"lib/buckets/common.js","type":"MODIFIED","insertions":20,"deletions":-71},{"file":"lib/buckets/creat.js","type":"MODIFIED","insertions":33,"deletions":-15},{"file":"lib/buckets/del.js","type":"MODIFIED","insertions":33,"deletions":-17},{"file":"lib/buckets/get.js","type":"MODIFIED","insertions":29,"deletions":-9},{"file":"lib/buckets/list.js","type":"MODIFIED","insertions":27,"deletions":-11},{"file":"lib/buckets/update.js","type":"MODIFIED","insertions":37,"deletions":-20},{"file":"lib/control.js","type":"MODIFIED","insertions":160,"deletions":-54},{"file":"lib/errors.js","type":"MODIFIED","insertions":11,"deletions":-25},{"file":"lib/manatee.js","type":"MODIFIED","insertions":8,"deletions":-19},{"file":"lib/objects/batch.js","type":"MODIFIED","insertions":37,"deletions":-17},{"file":"lib/objects/common.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/objects/del.js","type":"MODIFIED","insertions":25,"deletions":-11},{"file":"lib/objects/del_many.js","type":"MODIFIED","insertions":27,"deletions":-14},{"file":"lib/objects/find.js","type":"MODIFIED","insertions":50,"deletions":-35},{"file":"lib/objects/get.js","type":"MODIFIED","insertions":44,"deletions":-27},{"file":"lib/objects/put.js","type":"MODIFIED","insertions":30,"deletions":-17},{"file":"lib/objects/reindex.js","type":"MODIFIED","insertions":31,"deletions":-16},{"file":"lib/objects/update.js","type":"MODIFIED","insertions":32,"deletions":-17},{"file":"lib/pg.js","type":"MODIFIED","insertions":2,"deletions":-10},{"file":"lib/ping.js","type":"MODIFIED","insertions":29,"deletions":-9},{"file":"lib/schema.js","type":"ADDED","insertions":331,"deletions":0},{"file":"lib/server.js","type":"MODIFIED","insertions":151,"deletions":-61},{"file":"lib/sql.js","type":"MODIFIED","insertions":29,"deletions":-11},{"file":"lib/standalone.js","type":"MODIFIED","insertions":13,"deletions":-16},{"file":"main.js","type":"MODIFIED","insertions":11,"deletions":-8},{"file":"package.json","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"sapi_manifests/moray/template","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"sdc/sapi_manifests/moray/template","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"smf/manifests/moray.xml.in","type":"MODIFIED","insertions":3,"deletions":-2}],"sizeInsertions":1217,"sizeDeletions":-527},{"number":"21","revision":"a4922741eddd45567e10640c70c9868461b39e18","parents":["4808aed525594032bed1588fac9e03da025e3eac"],"ref":"refs/changes/53/1453/21","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1504649927,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1501781834,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"SUBM","value":"1","grantedOn":1504655933,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1504647092,"by":{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1501626158,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":16,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"README.md","type":"MODIFIED","insertions":1,"deletions":0},{"file":"boot/setup.sh","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"docs/index.md","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"etc/config.coal.json","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"etc/config.coal.manta.json","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"etc/config.lab.json","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"etc/config.local.json","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"etc/config.standalone.json","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"lib/buckets/common.js","type":"MODIFIED","insertions":20,"deletions":-71},{"file":"lib/buckets/creat.js","type":"MODIFIED","insertions":33,"deletions":-15},{"file":"lib/buckets/del.js","type":"MODIFIED","insertions":33,"deletions":-17},{"file":"lib/buckets/get.js","type":"MODIFIED","insertions":29,"deletions":-9},{"file":"lib/buckets/list.js","type":"MODIFIED","insertions":27,"deletions":-11},{"file":"lib/buckets/update.js","type":"MODIFIED","insertions":37,"deletions":-20},{"file":"lib/control.js","type":"MODIFIED","insertions":160,"deletions":-54},{"file":"lib/errors.js","type":"MODIFIED","insertions":11,"deletions":-25},{"file":"lib/manatee.js","type":"MODIFIED","insertions":8,"deletions":-19},{"file":"lib/objects/batch.js","type":"MODIFIED","insertions":37,"deletions":-17},{"file":"lib/objects/common.js","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"lib/objects/del.js","type":"MODIFIED","insertions":25,"deletions":-11},{"file":"lib/objects/del_many.js","type":"MODIFIED","insertions":27,"deletions":-14},{"file":"lib/objects/find.js","type":"MODIFIED","insertions":50,"deletions":-35},{"file":"lib/objects/get.js","type":"MODIFIED","insertions":44,"deletions":-27},{"file":"lib/objects/put.js","type":"MODIFIED","insertions":30,"deletions":-17},{"file":"lib/objects/reindex.js","type":"MODIFIED","insertions":31,"deletions":-16},{"file":"lib/objects/update.js","type":"MODIFIED","insertions":32,"deletions":-17},{"file":"lib/pg.js","type":"MODIFIED","insertions":2,"deletions":-10},{"file":"lib/ping.js","type":"MODIFIED","insertions":29,"deletions":-9},{"file":"lib/schema.js","type":"ADDED","insertions":331,"deletions":0},{"file":"lib/server.js","type":"MODIFIED","insertions":151,"deletions":-61},{"file":"lib/sql.js","type":"MODIFIED","insertions":29,"deletions":-11},{"file":"lib/standalone.js","type":"MODIFIED","insertions":13,"deletions":-16},{"file":"main.js","type":"MODIFIED","insertions":11,"deletions":-8},{"file":"package.json","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"sapi_manifests/moray/template","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"sdc/sapi_manifests/moray/template","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"smf/manifests/moray.xml.in","type":"MODIFIED","insertions":3,"deletions":-2}],"sizeInsertions":1217,"sizeDeletions":-527}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}]}