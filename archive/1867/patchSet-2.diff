From 6ddad1a810092ba55cf550d17beeb4f7b5ebc1bb Mon Sep 17 00:00:00 2001
From: Ryan Zezeski <rpz@joyent.com>
Date: Fri, 28 Apr 2017 07:33:09 -0600
Subject: [PATCH] OS-6084 logic error in i_dls_devnet_setzid()

---
 usr/src/uts/common/io/dls/dls_mgmt.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/usr/src/uts/common/io/dls/dls_mgmt.c b/usr/src/uts/common/io/dls/dls_mgmt.c
index 14efe2de95..775d142549 100644
--- a/usr/src/uts/common/io/dls/dls_mgmt.c
+++ b/usr/src/uts/common/io/dls/dls_mgmt.c
@@ -1618,9 +1618,9 @@ i_dls_devnet_setzid(dls_devnet_t *ddp, zoneid_t new_zoneid, boolean_t setprop,
 		setzid.ld_zoneid = new_zoneid;
 		err = i_dls_mgmt_upcall(&setzid, sizeof (setzid), &retval,
 		    sizeof (retval));
+		upcall_done = B_TRUE;
 		if (err != 0)
 			goto done;
-		upcall_done = B_TRUE;
 	}
 	if ((err = dls_link_setzid(ddp->dd_mac, new_zoneid)) == 0) {
 		ddp->dd_zid = new_zoneid;
-- 
2.21.0

