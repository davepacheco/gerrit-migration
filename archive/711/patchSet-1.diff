commit dfa970ed929228871075bd3ff429968929869b4f (refs/changes/11/711/1)
Author: David Pacheco <dap@joyent.com>
Date:   2016-10-17T10:14:08-07:00 (3 years ago)
    
    MANTA-3005 muskie should adopt moray v2

diff --git a/lib/medusa/connector.js b/lib/medusa/connector.js
index 546cd69..bc71d6b 100644
--- a/lib/medusa/connector.js
+++ b/lib/medusa/connector.js
@@ -51,13 +51,9 @@ function MedusaConnector(options) {
     self.inactivityTimeout = options.inactivityTimeout || 30000;
     self.watershed = new Watershed();
     self.moray = moray.createClient({
+        unwrapErrors: true,
         log: options.log,
         connectTimeout: self.connectTimeout,
-        reconnect: true,
-        retry: { // try to reconnect forever
-            maxTimeout: 30000,
-            retries: Infinity
-        },
         host: options.moray.host,
         port: options.moray.port
     });
diff --git a/lib/picker.js b/lib/picker.js
index 1965fc7..cb982a1 100644
--- a/lib/picker.js
+++ b/lib/picker.js
@@ -314,13 +314,9 @@ function Picker(opts) {
     var self = this;
 
     this.client = moray.createClient({
+        unwrapErrors: true,
         log: opts.log,
         connectTimeout: opts.connectTimeout,
-        reconnect: true,
-        retry: {
-            maxTimeout: 30000,
-            retries: Infinity
-        },
         url: opts.url
     });
     this.connectTimeout = opts.connectTimeout || 1000;
diff --git a/package.json b/package.json
index eea57a9..8738a6d 100644
--- a/package.json
+++ b/package.json
@@ -27,7 +27,7 @@
         "mahi": "git+ssh://git@github.com:joyent/node-mahi.git#master",
         "marlin": "git+ssh://git@github.com:joyent/manta-marlin.git#master",
         "mime": "1.2.11",
-        "moray": "git+ssh://git@github.com:joyent/node-moray.git#fd5781bc25a9bfe2ba82167664639753fb9f0ca5",
+        "moray": "^2.0.0",
         "once": "1.3.0",
         "restify": "2.6.3",
         "vasync": "1.4.3",
