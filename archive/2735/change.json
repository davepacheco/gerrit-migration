{"project":"joyent/manatee","branch":"master","id":"I04521ed5f795695185a0e9bbed3b91d2e47ba540","number":"2735","subject":"MANATEE-323 manatee misguidedly convinced that if it calls watch() on a dead ZK client enough, it will come back to life","owner":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"url":"https://cr.joyent.us/2735","commitMessage":"MANATEE-323 manatee misguidedly convinced that if it calls watch() on a dead ZK client enough, it will come back to life\n","createdOn":1507303517,"lastUpdated":1531933482,"open":true,"status":"NEW","comments":[{"timestamp":1507303517,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Uploaded patch set 1."},{"timestamp":1507303519,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit 90a8a60ba45a468bb84a8a1d375b0d9d5f125e86\n    \n    MANATEE-323 manatee misguidedly convinced that if it calls watch() on a dead ZK client enough, it will come back to life\n    Dead zookeeper connections perpetually log error messages about the\n    connection loss because the watch function in the zookeeperMgr module\n    continues to re-register a watch for each dead connection even if\n    another connection is established by the manager. Change the watch\n    function to only set a timeout to re-register the watch if the error\n    code is not the code for a zookeeper connection loss."},{"timestamp":1507303557,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1509645201,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1510006541,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1510009125,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"Patch Set 1: Code-Review+1"},{"timestamp":1515102774,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"Patch Set 1: Integration-Approval+1"},{"timestamp":1531933451,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Patch Set 2: Patch Set 1 was rebased"},{"timestamp":1531933482,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2:\n\n\"make check\" passed ok"}],"currentPatchSet":{"number":"2","revision":"52cff04e7dc4b4c24540cb1039d42f7794a081bf","parents":["58d2c51af324f21d08e27bfb723554924bc152d9"],"ref":"refs/changes/35/2735/2","uploader":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"createdOn":1531933451,"author":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1507303557,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1510009125,"by":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1515102774,"by":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/zookeeperMgr.js","type":"MODIFIED","insertions":3,"deletions":-1}],"sizeInsertions":3,"sizeDeletions":-1},"patchSets":[{"number":"1","revision":"04521ed5f795695185a0e9bbed3b91d2e47ba540","parents":["7f808daeb347b1b40c39e7c83e0eec2389f29403"],"ref":"refs/changes/35/2735/1","uploader":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"createdOn":1507303517,"author":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1507303557,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1510009125,"by":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1515102774,"by":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"}}],"comments":[{"file":"lib/zookeeperMgr.js","line":251,"reviewer":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},"message":"So this now just exits out of the watch, doing nothing, correct?"},{"file":"lib/zookeeperMgr.js","line":251,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Correct, the error message on the previous line will output a single time and then that\u0027s it rather than continuing to output the error message every 5 seconds for the remaining life of the process."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/zookeeperMgr.js","type":"MODIFIED","insertions":3,"deletions":-1}],"sizeInsertions":3,"sizeDeletions":-1},{"number":"2","revision":"52cff04e7dc4b4c24540cb1039d42f7794a081bf","parents":["58d2c51af324f21d08e27bfb723554924bc152d9"],"ref":"refs/changes/35/2735/2","uploader":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"createdOn":1531933451,"author":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1507303557,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1510009125,"by":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1515102774,"by":{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/zookeeperMgr.js","type":"MODIFIED","insertions":3,"deletions":-1}],"sizeInsertions":3,"sizeDeletions":-1}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Jared Morrow","email":"jm@joyent.com","username":"jaredmorrow"},{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"}]}