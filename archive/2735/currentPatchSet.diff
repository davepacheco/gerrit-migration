commit 52cff04e7dc4b4c24540cb1039d42f7794a081bf (refs/changes/35/2735/2)
Author: Kelly McLaughlin <kelly.mclaughlin@joyent.com>
Date:   2018-07-18T17:04:11+00:00 (1 year, 3 months ago)
    
    MANATEE-323 manatee misguidedly convinced that if it calls watch() on a dead ZK client enough, it will come back to life

diff --git a/lib/zookeeperMgr.js b/lib/zookeeperMgr.js
index 7fcfba5..55ef126 100644
--- a/lib/zookeeperMgr.js
+++ b/lib/zookeeperMgr.js
@@ -247,7 +247,9 @@ function watch(zk, getFunc, path, wat, cb) {
                 path: path,
                 err: err
             }, 'zk: error fetching zk data or children');
-            setTimeout(registerWatch, 5000);
+            if (err.code !== zkClient.Exception.CONNECTION_LOSS) {
+                setTimeout(registerWatch, 5000);
+            }
         } else {
             wat.call(self, watRes);
         }
