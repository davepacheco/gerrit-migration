{"project":"joyent/illumos-joyent","branch":"master","id":"I98736fd78488647d470fdf8f813ff5a069bade56","number":"4721","subject":"OS-7149 HT exclusion needs cleanup Reviewed by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e Reviewed by: Robert Mustacchi \u003crm@joyent.com\u003e Approved by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e","owner":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"url":"https://cr.joyent.us/4721","commitMessage":"OS-7149 HT exclusion needs cleanup\nReviewed by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e\nReviewed by: Robert Mustacchi \u003crm@joyent.com\u003e\nApproved by: Jerry Jelinek \u003cjerry.jelinek@joyent.com\u003e\n","createdOn":1534778617,"lastUpdated":1535045803,"open":false,"status":"MERGED","comments":[{"timestamp":1534778617,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Uploaded patch set 1."},{"timestamp":1534778619,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit 8edd82b1f2e8724d37e55fe1f0414b056fcd6bf5\n    \n    ht fixes"},{"timestamp":1534778646,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 1: Code-Review-1"},{"timestamp":1534846784,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Uploaded patch set 2."},{"timestamp":1534846794,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit 30fbb43d3b2ff7452515eb5bd1aef3b8720ab1b7\n    \n    m\n    \n    commit 49d9f855990de1eaffe40ae4679f58eab3efd3e5\n    \n    ht fixes"},{"timestamp":1534847087,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 2: -Code-Review"},{"timestamp":1534857278,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1534861828,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1534862874,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 2:\n\n\u003e I was unsure on this. There are lots of headers not in the manifest, including pretty much all the surrounding ones. If there\u0027s some rule for when to put it in the manifest, I couldn\u0027t discern it.\n\nOur general rule is if it is in a pkg then that means it could be installed, so that is also when we add files to the manifest. If it is just a file that is used by the build, but never installed on a target machine, then it wouldn\u0027t be in a pkg and we would also then not normally put it in the manifest. We probably don\u0027t follow this rule perfectly. Just last week the build broke because we had a bunch of files in the manifest which were not in a pkg. Also, there are some pkgs which we never care about (e.g. the test pkg) so not every file in a pkg is in our manifest, but I think we do try to ship all of the system header files from that pkg."},{"timestamp":1534863725,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 2:\n\n\u003e Our general rule is if it is in a pkg then that means it could be\n \u003e installed, so that is also when we add files to the manifest. If it\n\nOK, but:\n\nf905ddb5-9113-c52a-d3ce-d0db83321d72:manifests $ grep usr/platform/i86pc/include /root/smartos-live/projects/illumos/manifest \nf905ddb5-9113-c52a-d3ce-d0db83321d72:manifests $ \n\nThis seems intentional?"},{"timestamp":1534866257,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 2: Code-Review+1\n\nThat\u0027s a fair point. Whatever the reason we\u0027re not shipping the system headers in /usr/platform/i86pc/include, that is separate from your changes here."},{"timestamp":1534961631,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 2:\n\n(1 comment)\n\nDo we need to do to UPPC what we did to pcplusmp?"},{"timestamp":1534961893,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 2:\n\n(1 comment)\n\nI had uppc down like xpv_psm: we don\u0027t care, but I can add it if you like?"},{"timestamp":1534963234,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 2:\n\n(1 comment)\n\n\u003e (1 comment)\n \u003e \n \u003e I had uppc down like xpv_psm: we don\u0027t care, but I can add it if\n \u003e you like?\n\nThat probably is fine. Just wasn\u0027t clear to me from here. Probably worth making that clear in the ticket."},{"timestamp":1534963238,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 2: Code-Review+1"},{"timestamp":1535045355,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 2: Integration-Approval+1"},{"timestamp":1535045387,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Uploaded patch set 3."},{"timestamp":1535045422,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 4: Patch Set 3 was rebased"},{"timestamp":1535045609,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 4: Code-Review+1 Integration-Approval+1"},{"timestamp":1535045713,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 4: Code-Review+1"},{"timestamp":1535045803,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by John Levon"}],"currentPatchSet":{"number":"4","revision":"e79c50557fdcaf68635086f55afd817419c78661","parents":["14623ce3614a9ee961adb4294066fe377022d419"],"ref":"refs/changes/21/4721/4","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1535045422,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1535045609,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1535045609,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1535045713,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"SUBM","value":"1","grantedOn":1535045803,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/pkg/manifests/system-header.mf","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/uts/i86pc/io/apix/apix_utils.c","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"usr/src/uts/i86pc/io/pcplusmp/apic.c","type":"MODIFIED","insertions":6,"deletions":0},{"file":"usr/src/uts/i86pc/os/ht.c","type":"MODIFIED","insertions":38,"deletions":-24},{"file":"usr/src/uts/i86pc/sys/ht.h","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/sun4/sys/ht.h","type":"MODIFIED","insertions":3,"deletions":-2}],"sizeInsertions":57,"sizeDeletions":-27},"patchSets":[{"number":"1","revision":"404779cee64942a4435ed6ca577a754965007a09","parents":["005d090d5d39829784302a3c8574b81b88fc69d0"],"ref":"refs/changes/21/4721/1","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1534778617,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"-1","grantedOn":1534778646,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/pkg/manifests/system-header.mf","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/uts/i86pc/io/apix/apix_utils.c","type":"MODIFIED","insertions":4,"deletions":0},{"file":"usr/src/uts/i86pc/io/pcplusmp/apic.c","type":"MODIFIED","insertions":6,"deletions":0},{"file":"usr/src/uts/i86pc/os/ht.c","type":"MODIFIED","insertions":38,"deletions":-24},{"file":"usr/src/uts/i86pc/sys/ht.h","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/sun4/sys/ht.h","type":"MODIFIED","insertions":3,"deletions":-2}],"sizeInsertions":55,"sizeDeletions":-26},{"number":"2","revision":"a384aa0103ab3d03586b96ff636061007fd4622d","parents":["2a62096fbdbe65bc486f0bb4d2a0b0c5dc85b423"],"ref":"refs/changes/21/4721/2","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1534846784,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1534963238,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1534866257,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1535045355,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"comments":[{"file":"usr/src/pkg/manifests/system-header.mf","line":1678,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"It looks like you need to add this header to the manifest file as well."},{"file":"usr/src/pkg/manifests/system-header.mf","line":1678,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"I was unsure on this. There are lots of headers not in the manifest, including pretty much all the surrounding ones. If there\u0027s some rule for when to put it in the manifest, I couldn\u0027t discern it."},{"file":"usr/src/uts/i86pc/os/ht.c","line":398,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Out of curiosity, why did we move this out of the for loop?"},{"file":"usr/src/uts/i86pc/os/ht.c","line":398,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"It\u0027s not obvious from the diff, but there\u0027s no functional change here. There was an outer for () loop, but newer GCC noticed that we\u0027d never exit the inner for () loop. So this change is really just deleting that meaningless outer for () loop."},{"file":"usr/src/uts/i86pc/os/ht.c","line":398,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Ah, I see now. Gotcha. That makes sense."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/pkg/manifests/system-header.mf","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/uts/i86pc/io/apix/apix_utils.c","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"usr/src/uts/i86pc/io/pcplusmp/apic.c","type":"MODIFIED","insertions":6,"deletions":0},{"file":"usr/src/uts/i86pc/os/ht.c","type":"MODIFIED","insertions":38,"deletions":-24},{"file":"usr/src/uts/i86pc/sys/ht.h","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/sun4/sys/ht.h","type":"MODIFIED","insertions":3,"deletions":-2}],"sizeInsertions":57,"sizeDeletions":-27},{"number":"3","revision":"98736fd78488647d470fdf8f813ff5a069bade56","parents":["103b229de957139cb321fefcbee9fa8ae3b0fbba"],"ref":"refs/changes/21/4721/3","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1535045387,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"REWORK","files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/pkg/manifests/system-header.mf","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/uts/i86pc/io/apix/apix_utils.c","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"usr/src/uts/i86pc/io/pcplusmp/apic.c","type":"MODIFIED","insertions":6,"deletions":0},{"file":"usr/src/uts/i86pc/os/ht.c","type":"MODIFIED","insertions":38,"deletions":-24},{"file":"usr/src/uts/i86pc/sys/ht.h","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/sun4/sys/ht.h","type":"MODIFIED","insertions":3,"deletions":-2}],"sizeInsertions":57,"sizeDeletions":-27},{"number":"4","revision":"e79c50557fdcaf68635086f55afd817419c78661","parents":["14623ce3614a9ee961adb4294066fe377022d419"],"ref":"refs/changes/21/4721/4","uploader":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"createdOn":1535045422,"author":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1535045713,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1535045609,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1535045609,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"SUBM","value":"1","grantedOn":1535045803,"by":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":10,"deletions":0},{"file":"usr/src/pkg/manifests/system-header.mf","type":"MODIFIED","insertions":3,"deletions":0},{"file":"usr/src/uts/i86pc/io/apix/apix_utils.c","type":"MODIFIED","insertions":6,"deletions":-1},{"file":"usr/src/uts/i86pc/io/pcplusmp/apic.c","type":"MODIFIED","insertions":6,"deletions":0},{"file":"usr/src/uts/i86pc/os/ht.c","type":"MODIFIED","insertions":38,"deletions":-24},{"file":"usr/src/uts/i86pc/sys/ht.h","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/uts/sun4/sys/ht.h","type":"MODIFIED","insertions":3,"deletions":-2}],"sizeInsertions":57,"sizeDeletions":-27}],"allReviewers":[{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}]}