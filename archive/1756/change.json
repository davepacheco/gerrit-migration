{"project":"joyent/node-fast","branch":"master","id":"Ib1358c23ef1d1b3e9c38bfc5639f65b238bd12a0","number":"1756","subject":"joyent/node-fast#5 Server shutdown crashes when a connection had a socket error Reviewed by: David Pacheco \u003cdap@joyent.com\u003e Approved by: David Pacheco \u003cdap@joyent.com\u003e","owner":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"url":"https://cr.joyent.us/1756","commitMessage":"joyent/node-fast#5 Server shutdown crashes when a connection had a socket error\nReviewed by: David Pacheco \u003cdap@joyent.com\u003e\nApproved by: David Pacheco \u003cdap@joyent.com\u003e\n","createdOn":1491432784,"lastUpdated":1491518174,"open":false,"status":"MERGED","comments":[{"timestamp":1491432784,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 1."},{"timestamp":1491432787,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1491433277,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 2."},{"timestamp":1491433281,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1491437803,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 2:\n\n(5 comments)\n\nThanks!  The only important note here is the one in CHANGES.md."},{"timestamp":1491438939,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 3."},{"timestamp":1491438945,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 2:\n\n(5 comments)"},{"timestamp":1491438947,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1491439110,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 4."},{"timestamp":1491439114,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1491439386,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 4: Code-Review+1\n\nThanks!"},{"timestamp":1491491701,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 4:\n\nIn terms of testing: I think it would be worthwhile to run \"make prepush\" on at least Node 0.10 and v4 and run the automated compat tests as well."},{"timestamp":1491509500,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Patch Set 4:\n\nI\u0027ve run `make prepush\u0027 and `make test-compat\u0027 with both node v0.10.46 and node v4.7.3, and with FAST_COMPAT_NODEDIR pointing at v0.10.47."},{"timestamp":1491517774,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 4: Integration-Approval+1"},{"timestamp":1491517778,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 4:\n\nThanks!"},{"timestamp":1491518159,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Uploaded patch set 5: Commit message was updated."},{"timestamp":1491518174,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Cody Peter Mello"}],"currentPatchSet":{"number":"5","revision":"b1358c23ef1d1b3e9c38bfc5639f65b238bd12a0","parents":["48a6bdaf973c80426c5c7378c8953abf3f5e1962"],"ref":"refs/changes/56/1756/5","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1491518159,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1491439114,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1491439386,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1491517774,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"SUBM","value":"1","grantedOn":1491518174,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":4,"deletions":0},{"file":"lib/fast_server.js","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/tst.server.js","type":"MODIFIED","insertions":62,"deletions":-1}],"sizeInsertions":71,"sizeDeletions":-6},"patchSets":[{"number":"1","revision":"3e5ad198a3a67d26a0bd192d10347d388f0687d1","parents":["48a6bdaf973c80426c5c7378c8953abf3f5e1962"],"ref":"refs/changes/56/1756/1","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1491432784,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1491432787,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/fast_server.js","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/tst.server.js","type":"MODIFIED","insertions":61,"deletions":0}],"sizeInsertions":65,"sizeDeletions":-4},{"number":"2","revision":"fef69c82fbe023f7d89761f616d21412404527f4","parents":["48a6bdaf973c80426c5c7378c8953abf3f5e1962"],"ref":"refs/changes/56/1756/2","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1491433277,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1491433281,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"CHANGES.md","line":9,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Thanks for updating this file.  Can you make this entry match the synopsis for the ticket (either by changing this or changing the synopsis)?"},{"file":"CHANGES.md","line":9,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Done"},{"file":"test/tst.server.js","line":669,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Is it important to modify ts_clients here?  If the test failed, it would be useful to have the complete state -- including all clients -- in a core file."},{"file":"test/tst.server.js","line":669,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"It had been in the first iteration of writing these tests, but isn\u0027t now, so I\u0027ll just make it grab element 0."},{"file":"test/tst.server.js","line":674,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"This is really not a big deal, but there\u0027s a general convention in this repo to name the implementation functions \"fastRpc$rpcname\" (e.g., fastRpcBlock and fastRpcRecordAndReturn in this file, and a bunch in lib/demo_server.js)."},{"file":"test/tst.server.js","line":674,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Done"},{"file":"test/tst.server.js","line":680,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"FWIW, I\u0027ve been following the convention of quoting property names in object literals in this repo."},{"file":"test/tst.server.js","line":680,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Done"},{"file":"test/tst.server.js","line":692,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I think bunyan records (or bunyan(1) reports) this a lot more cleanly if the error itself is the first argument."},{"file":"test/tst.server.js","line":692,"reviewer":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":4,"deletions":0},{"file":"lib/fast_server.js","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/tst.server.js","type":"MODIFIED","insertions":61,"deletions":0}],"sizeInsertions":69,"sizeDeletions":-4},{"number":"3","revision":"d596e48771db2355d94b253d0b2633d48a49c9e1","parents":["48a6bdaf973c80426c5c7378c8953abf3f5e1962"],"ref":"refs/changes/56/1756/3","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1491438939,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1491438947,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":4,"deletions":0},{"file":"lib/fast_server.js","type":"MODIFIED","insertions":3,"deletions":-3},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/tst.server.js","type":"MODIFIED","insertions":61,"deletions":0}],"sizeInsertions":69,"sizeDeletions":-4},{"number":"4","revision":"cc4ff8745fcb1124b2c092f42355233a316a14d3","parents":["48a6bdaf973c80426c5c7378c8953abf3f5e1962"],"ref":"refs/changes/56/1756/4","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1491439110,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1491439386,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1491517774,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1491439114,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":4,"deletions":0},{"file":"lib/fast_server.js","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/tst.server.js","type":"MODIFIED","insertions":62,"deletions":-1}],"sizeInsertions":71,"sizeDeletions":-6},{"number":"5","revision":"b1358c23ef1d1b3e9c38bfc5639f65b238bd12a0","parents":["48a6bdaf973c80426c5c7378c8953abf3f5e1962"],"ref":"refs/changes/56/1756/5","uploader":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"createdOn":1491518159,"author":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1491439386,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1491517774,"by":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"}},{"type":"SUBM","value":"1","grantedOn":1491518174,"by":{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1491439114,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":4,"deletions":0},{"file":"lib/fast_server.js","type":"MODIFIED","insertions":4,"deletions":-4},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"test/tst.server.js","type":"MODIFIED","insertions":62,"deletions":-1}],"sizeInsertions":71,"sizeDeletions":-6}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},{"name":"Cody Peter Mello","email":"melloc@writev.io","username":"melloc"}]}