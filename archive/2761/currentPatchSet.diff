From a5cebbf42eaafd8433860694e039c1f91d1db347 Mon Sep 17 00:00:00 2001
From: Trent Mick <trentm@gmail.com>
Date: Tue, 10 Oct 2017 14:20:17 -0700
Subject: [PATCH] TOOLS-1883 sdcadm shouldn't hardcode path to psql Reviewed
 by: Cody Peter Mello <cody.mello@joyent.com> Approved by: Cody Peter Mello
 <cody.mello@joyent.com>

---
 CHANGES.md    | 5 +++++
 lib/common.js | 7 +++++--
 package.json  | 2 +-
 3 files changed, 11 insertions(+), 3 deletions(-)

diff --git a/CHANGES.md b/CHANGES.md
index aac37c5..1dccc17 100644
--- a/CHANGES.md
+++ b/CHANGES.md
@@ -10,6 +10,11 @@
 
 # sdcadm Changelog
 
+## 1.16.2
+
+- TOOLS-1883 Allow 'sdcadm up manatee' to work correctly with newer MANATEE-346
+  changes which include multiple postgres versions.
+
 ## 1.16.1
 
 - TOOLS-1842 Fix 'sdcadm create SERVICE-NAME -s SERVER' which was failing
diff --git a/lib/common.js b/lib/common.js
index 71180e6..cce8d49 100644
--- a/lib/common.js
+++ b/lib/common.js
@@ -5,7 +5,7 @@
  */
 
 /*
- * Copyright 2017 Joyent, Inc.
+ * Copyright (c) 2017, Joyent, Inc.
  */
 
 var assert = require('assert-plus');
@@ -996,7 +996,10 @@ function waitForPostgresUp(opts, cb) {
             '-n',
             opts.server,
             /* JSSTYLED */
-            format('/usr/sbin/zlogin %s "/opt/local/bin/psql -U postgres -t -A -c \'SELECT NOW() AS when;\'"', opts.vm)
+            format('/usr/sbin/zlogin %s '
+                + '\'PATH=/opt/postgresql/current/bin:/opt/local/bin:$PATH '
+                + 'psql -U postgres -t -A -c "SELECT NOW() AS when;"\'',
+                opts.vm)
         ];
 
         execFilePlus({
diff --git a/package.json b/package.json
index 3436bc0..940683d 100644
--- a/package.json
+++ b/package.json
@@ -1,7 +1,7 @@
 {
   "name": "sdcadm",
   "description": "Administer a SmartDataCenter (SDC) standup",
-  "version": "1.16.1",
+  "version": "1.16.2",
   "author": "Joyent (joyent.com)",
   "private": true,
   "dependencies": {
-- 
2.21.0

