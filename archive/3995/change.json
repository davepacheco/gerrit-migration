{"project":"joyent/node-zkstream","branch":"master","id":"I1510f0d99d47e4ea1fd929f493a6c079c1c0449a","number":"3995","subject":"MANTA-3596 binder could export metrics via artedi","owner":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"url":"https://cr.joyent.us/3995","commitMessage":"MANTA-3596 binder could export metrics via artedi\n","createdOn":1527115144,"lastUpdated":1528497822,"open":false,"status":"MERGED","comments":[{"timestamp":1527115144,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Uploaded patch set 1."},{"timestamp":1527115197,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1527115468,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Uploaded patch set 2."},{"timestamp":1527115522,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1527182321,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 2:\n\n(3 comments)\n\nLooks good!"},{"timestamp":1527186562,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Patch Set 2:\n\n(2 comments)"},{"timestamp":1527200453,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Uploaded patch set 3."},{"timestamp":1527200513,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1527259771,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 3: Code-Review+1\n\nGreat! If tracking the \u0027attached\u0027 state is what we need here then this looks good!"},{"timestamp":1527289627,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Patch Set 3:\n\n(1 comment)"},{"timestamp":1527303807,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Patch Set 3:\n\n(1 comment)"},{"timestamp":1527714407,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 3:\n\nYeah I really don\u0027t like calling this metric \"zookeeper_session_count\" when it\u0027s actually zookeeper_connection_count. \"session\" has a very specific meaning in the context of the ZK protocol and we should not be using it like that.\n\nFWIW all of this is kinda pointless with binder today anyway since it only ever connects to 127.0.0.1 and nothing else. But if these metrics are to be useful in other parts of manta where we actually connect to multiple ZKs properly, then we should think about how to look at them.\n\nIt is definitely useful to know how many ZK *sessions* have ever been established (that\u0027s the \u0027session\u0027 event, the creation of a new ZKSession object). I think it is also useful to track how many error-based reconnects there have been. I do not think it\u0027s as useful to know how many rebalancing re-connects there have been (but if we are going to track these it should *definitely* be separate to errors)"},{"timestamp":1527792431,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Uploaded patch set 4."},{"timestamp":1527792488,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1527792969,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Uploaded patch set 5."},{"timestamp":1527793031,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1527882373,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 5:\n\n(1 comment)"},{"timestamp":1527888172,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Uploaded patch set 6."},{"timestamp":1527888231,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 6: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1528320663,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"Patch Set 6: Code-Review+1"},{"timestamp":1528383323,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 6:\n\n(1 comment)\n\nLooks good! Let me know your thoughts about metric naming."},{"timestamp":1528384636,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Patch Set 6:\n\n(1 comment)"},{"timestamp":1528385007,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Uploaded patch set 7."},{"timestamp":1528385066,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 7: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1528386628,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 7: Code-Review+1"},{"timestamp":1528386814,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 7:\n\n(1 comment)"},{"timestamp":1528397624,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Uploaded patch set 8."},{"timestamp":1528397689,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 8: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1528397876,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Patch Set 8:\n\n(1 comment)"},{"timestamp":1528397955,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Patch Set 8:\n\n(1 comment)"},{"timestamp":1528399660,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 8:\n\n(1 comment)"},{"timestamp":1528400198,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Uploaded patch set 9."},{"timestamp":1528400254,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 9: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1528400354,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Uploaded patch set 10."},{"timestamp":1528400413,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 10: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1528405845,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Patch Set 10: Code-Review+1"},{"timestamp":1528485042,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Uploaded patch set 11."},{"timestamp":1528485109,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 11: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1528485321,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Patch Set 11: Code-Review+1\n\nWith the README update, this looks good. Happy to IA once we get some testing notes - ideally showing counters being bumped in prometheus output so that we know things are fine when it we establish and new sessions."},{"timestamp":1528497689,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"Patch Set 11: Integration-Approval+1"},{"timestamp":1528497822,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Robert Bogart"}],"currentPatchSet":{"number":"11","revision":"1510f0d99d47e4ea1fd929f493a6c079c1c0449a","parents":["2ba3e031847702049ecd99138a4ae7c2040ea5be"],"ref":"refs/changes/95/3995/11","uploader":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"createdOn":1528485042,"author":{"name":"Robert Bogart","email":"robert.bogart@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1528485109,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1528485321,"by":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1528497689,"by":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"}},{"type":"SUBM","value":"1","grantedOn":1528497821,"by":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":1,"deletions":0},{"file":"lib/client.js","type":"MODIFIED","insertions":40,"deletions":-1},{"file":"lib/zk-session.js","type":"MODIFIED","insertions":16,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-1}],"sizeInsertions":59,"sizeDeletions":-2},"patchSets":[{"number":"1","revision":"fd6d4ee391c9cbdb128daa33ab6486fc00c9cefb","parents":["2ba3e031847702049ecd99138a4ae7c2040ea5be"],"ref":"refs/changes/95/3995/1","uploader":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"createdOn":1527115144,"author":{"name":"Robert Bogart","email":"robert.bogart@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1527115197,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/client.js","type":"MODIFIED","insertions":16,"deletions":-1},{"file":"lib/zk-session.js","type":"MODIFIED","insertions":41,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":0}],"sizeInsertions":58,"sizeDeletions":-1},{"number":"2","revision":"c851c63cb0f56d03ec46b6e89c30417556906da2","parents":["2ba3e031847702049ecd99138a4ae7c2040ea5be"],"ref":"refs/changes/95/3995/2","uploader":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"createdOn":1527115468,"author":{"name":"Robert Bogart","email":"robert.bogart@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1527115522,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/zk-session.js","line":54,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"FWIW the .counter(), .gauge(), .histogram() artedi functions were meant to be idempotent. So it\u0027s safe to remove the call to .getCollector() and directly call .counter() directly."},{"file":"lib/zk-session.js","line":54,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Since we will create the counter either way, that makes sense to me."},{"file":"lib/zk-session.js","line":196,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Maybe we could store this counter as an instance variable so we don\u0027t need to call getCollector. e.g. this.zs_session_counter.increment(). If you want to go down that route we could follow a similar pattern for the other counter too.\n\nAlso, it looks like we\u0027re only counting \u0027attached\u0027 connections and not created/resumed/expired connections. Is that fine? I don\u0027t really know what\u0027s most valuable for debugging/monitoring binder."},{"file":"lib/zk-session.js","line":196,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"For the first item, I originally had that -- I just didn\u0027t think it was worth adding members to the ZKSession object when technically, the information can be obtained on the fly.\n\nFor the second item (and this is part of why I also added Alex, because my understanding of that state machine could be wrong), it looked (to me) like Binder does not do anything with a connection to ZooKeeper unless the session finally reached a state of \u0027attached\u0027.  It looked to me like after that, ZKClient will emit the \u0027session\u0027 event which is what triggers the cache rebuild.  My understanding was that this must happen whenever we establish (or re-establish) the connection to ZooKeeper regardless of previous circumstances (first time connect, recovery from time out, connection closed, etc).  My thought was that by tracking this, we do implicitly track the number of times that a connection has ended.  Going to back to your question about whether or not it\u0027s enough though, I did originally think that it was sufficient for providing the data that Josh asked for, but if not, I\u0027m willing to track timeouts and other such events too.\n\nDisclaimer: The long winded explanation above was not intended to tell you anything that you don\u0027t already know -- consider this to be me just trying to show my work so that you know how I arrived at my answer (whether correct or not)."},{"file":"lib/zk-session.js","line":196,"reviewer":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},"message":"I think it is true that a ZKClient will emit both \u0027session\u0027 and \u0027connect\u0027 events for the first time it attaches a given ZKSession to a backend, but I think cueball can also decide to move an existing ZKSession to a different ZKConnectionSlotFSM (see ZKSession#state_reattaching). In this case, because the ZKSession\u0027s \u0027initialHandler\u0027 is removed after it\u0027s first attachment (see ZKClient#_newSession), I would not expect it to emit a \u0027session\u0027 event when it is moved to a different backend and so I would not expect a re-attachment (session migration) to trigger a Binder cache rebuild.\n\nI haven\u0027t thought too much about how difficult it would be to track re-connections to the same backend and session migration separately, and I\u0027m not sure that either occur frequently enough to merit doing so. However, if I understand correctly, these are the two notable events that this counter would track, and they may have somewhat different implications. \n\n1) A session migration is triggered by cueball, and it can reflect the fact that some backend has been historically more reliant than another and this should not trigger a rebuild.\n\n2) A re-connect that triggers a non-reattaching connection could indicate that the backend is down for whatever reason or is being flaky and will trigger a cache rebuild in Binder.\n\nIf everything I\u0027ve said above is correct (and that is a significant if), repeated occurrences of (2) would carry a more significant performance penalty that repeated occurrences of (1). \n\nPersonally, I\u0027d be in favor of more fine-grained metrics here. It\u0027d be nice if we find ourselves in the position of needing to reason about why attachments are happening. However I do think it might take more time and I\u0027m not sure if it\u0027s worth it. I think it\u0027s fine if you want to ignore this, just my 2 cents."},{"file":"lib/zk-session.js","line":196,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Thanks for the detailed explanation.  If I\u0027m understanding what you said correctly -- and the code in the areas that you described does corroborate it -- then I think the fact that we do a cache rebuild (or not) is orthogonal to the basis on which we establish (or reestablish, or migrate) a connection to a ZooKeeper server.  That is, I agree that we should track more than just the transitions to an attached state that induce a cache rebuild.  We should track all transitions to that state regardless of what happens at the Binder layer.\n\nAfter thinking about this, I agree that more fine-grained metrics are in order.  One thought that I had was of creating a wrapper in zk-session.js for S.gotoState(). From within that routine, update any metrics needed depending on the value of the state supplied by the caller.  I *think* we should be able to manage all of this by watching the state machine, but if that\u0027s not true, let me know.\n\nWhile we\u0027re at it, in your opinion, are there are important things that you think we should track?  Perhaps the best place to have that part of the conversation is in the Jira ticket itself."},{"file":"package.json","line":11,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"The latest artedi version (1.3.0) includes some nice changes like DTrace probes."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/client.js","type":"MODIFIED","insertions":15,"deletions":-1},{"file":"lib/zk-session.js","type":"MODIFIED","insertions":41,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":0}],"sizeInsertions":57,"sizeDeletions":-1},{"number":"3","revision":"ae7af7a1c9cdcfef46e6331e04c55d8284db1b9e","parents":["2ba3e031847702049ecd99138a4ae7c2040ea5be"],"ref":"refs/changes/95/3995/3","uploader":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"createdOn":1527200453,"author":{"name":"Robert Bogart","email":"robert.bogart@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1527200513,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1527259771,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/client.js","type":"MODIFIED","insertions":15,"deletions":-1},{"file":"lib/zk-session.js","type":"MODIFIED","insertions":32,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":0}],"sizeInsertions":48,"sizeDeletions":-1},{"number":"4","revision":"bb8ff1bf2a4fd29df95ca5ee97066f89781f5e96","parents":["2ba3e031847702049ecd99138a4ae7c2040ea5be"],"ref":"refs/changes/95/3995/4","uploader":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"createdOn":1527792431,"author":{"name":"Robert Bogart","email":"robert.bogart@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1527792488,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/client.js","type":"MODIFIED","insertions":43,"deletions":-3},{"file":"lib/zk-session.js","type":"MODIFIED","insertions":16,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":0}],"sizeInsertions":60,"sizeDeletions":-3},{"number":"5","revision":"158a98a469e30601a05e1935ddbac9d0737047d6","parents":["2ba3e031847702049ecd99138a4ae7c2040ea5be"],"ref":"refs/changes/95/3995/5","uploader":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"createdOn":1527792969,"author":{"name":"Robert Bogart","email":"robert.bogart@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1527793031,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/client.js","line":230,"reviewer":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},"message":"When I said you should rename the counter to \u0027zookeeper_connection_count\u0027, that was on the assumption that you were going to keep counting connections and not sessions.\n\nThe \u0027session\u0027 event counts actual sessions (it\u0027s not emitted when we re-connect and resume an old session cleanly).\n\nI think we should have 3 metrics -- \u0027zookeeper_session_count\u0027, which counts \u0027session\u0027 events, \u0027zookeeper_failed_count\u0027 which counts \u0027failed\u0027 events, and \u0027zookeeper_connection_count\u0027 which counts \u0027connect\u0027 events. Match them 1:1 with the event names, so you can just look at the zkstream docs and code easily to figure out precisely what they mean."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/client.js","type":"MODIFIED","insertions":43,"deletions":-3},{"file":"lib/zk-session.js","type":"MODIFIED","insertions":16,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":0}],"sizeInsertions":60,"sizeDeletions":-3},{"number":"6","revision":"92e4f3ae5b74e3a7ac923f8b63b3d97383523539","parents":["2ba3e031847702049ecd99138a4ae7c2040ea5be"],"ref":"refs/changes/95/3995/6","uploader":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"createdOn":1527888172,"author":{"name":"Robert Bogart","email":"robert.bogart@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1528320663,"by":{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1527888231,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/client.js","line":29,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"I don\u0027t mean to start a naming argument here, but do we need the _count suffix on these? Since they\u0027re \u0027counter\u0027 types, it\u0027s sort of implicit that they represent a count of something.\n\nI\u0027d suggest names like \u0027zookeeper_connection_events\u0027"},{"file":"lib/client.js","line":29,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"I could not agree with you more.  Now that you\u0027ve mentioned it, it seems obvious.  I think it\u0027s the right thing to do."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/client.js","type":"MODIFIED","insertions":60,"deletions":-1},{"file":"lib/zk-session.js","type":"MODIFIED","insertions":16,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":0}],"sizeInsertions":77,"sizeDeletions":-1},{"number":"7","revision":"77b25e8d27d84afc8cda3b2991448344f73fd85a","parents":["2ba3e031847702049ecd99138a4ae7c2040ea5be"],"ref":"refs/changes/95/3995/7","uploader":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"createdOn":1528385007,"author":{"name":"Robert Bogart","email":"robert.bogart@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1528385066,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1528386628,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}}],"comments":[{"file":"lib/client.js","line":31,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"Now that I think about this a little more, I wonder if we could consolidate these into a single counter, and have a metadata label for the event type. Like:\n\nMETRIC_ZK_EVENT_COUNTER.increment({\u0027event\u0027: evt}) where evt is failed|session|connect\n\nThat\u0027s sort of what\u0027s done in lib/zksession.js too."},{"file":"lib/client.js","line":31,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Another cogent point.  This should clean things up significantly."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/client.js","type":"MODIFIED","insertions":60,"deletions":-1},{"file":"lib/zk-session.js","type":"MODIFIED","insertions":16,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":0}],"sizeInsertions":77,"sizeDeletions":-1},{"number":"8","revision":"afda8082bd9d7b0ce62b819d777a77fe3ecc73a8","parents":["2ba3e031847702049ecd99138a4ae7c2040ea5be"],"ref":"refs/changes/95/3995/8","uploader":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"createdOn":1528397624,"author":{"name":"Robert Bogart","email":"robert.bogart@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1528397689,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"package.json","line":3,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"I bumped the minor number from 10-\u003e11.  I (perhaps wrongly) assumed that when we do this with node modules, that the patch number is reset.  Does this versioning look correct?"},{"file":"package.json","line":3,"reviewer":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},"message":"This looks good to me"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/client.js","type":"MODIFIED","insertions":60,"deletions":-1},{"file":"lib/zk-session.js","type":"MODIFIED","insertions":16,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-1}],"sizeInsertions":78,"sizeDeletions":-2},{"number":"9","revision":"89f41401d7517e5e636b991dce472e329c719c47","parents":["2ba3e031847702049ecd99138a4ae7c2040ea5be"],"ref":"refs/changes/95/3995/9","uploader":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"createdOn":1528400198,"author":{"name":"Robert Bogart","email":"robert.bogart@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1528400254,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/client.js","type":"MODIFIED","insertions":43,"deletions":-1},{"file":"lib/zk-session.js","type":"MODIFIED","insertions":16,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-1}],"sizeInsertions":61,"sizeDeletions":-2},{"number":"10","revision":"1ea6b88be013e2ab103d469bb9d9d00d63fd4a56","parents":["2ba3e031847702049ecd99138a4ae7c2040ea5be"],"ref":"refs/changes/95/3995/10","uploader":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"createdOn":1528400354,"author":{"name":"Robert Bogart","email":"robert.bogart@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1528400413,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1528405845,"by":{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/client.js","type":"MODIFIED","insertions":40,"deletions":-1},{"file":"lib/zk-session.js","type":"MODIFIED","insertions":16,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-1}],"sizeInsertions":58,"sizeDeletions":-2},{"number":"11","revision":"1510f0d99d47e4ea1fd929f493a6c079c1c0449a","parents":["2ba3e031847702049ecd99138a4ae7c2040ea5be"],"ref":"refs/changes/95/3995/11","uploader":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"createdOn":1528485042,"author":{"name":"Robert Bogart","email":"robert.bogart@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1528485109,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1528485321,"by":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1528497689,"by":{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"}},{"type":"SUBM","value":"1","grantedOn":1528497821,"by":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"README.md","type":"MODIFIED","insertions":1,"deletions":0},{"file":"lib/client.js","type":"MODIFIED","insertions":40,"deletions":-1},{"file":"lib/zk-session.js","type":"MODIFIED","insertions":16,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":2,"deletions":-1}],"sizeInsertions":59,"sizeDeletions":-2}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Kody A Kantor","email":"kody.kantor@joyent.com","username":"KodyKantor"},{"name":"Alex Wilson","email":"alex@cooperi.net","username":"arekinath"},{"name":"Jan Wyszynski","email":"jan.wyszynski@joyent.com","username":"IanWyszynski"},{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"}]}