{"project":"joyent/illumos-joyent","branch":"vpc","id":"I8ed28d212b35ed20adf00805818e6cc034da200c","number":"4547","subject":"Goodbye sarc, hello 2Q","owner":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"url":"https://cr.joyent.us/4547","commitMessage":"Goodbye sarc, hello 2Q\n","createdOn":1532042921,"lastUpdated":1532976508,"open":false,"status":"MERGED","comments":[{"timestamp":1532042921,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Uploaded patch set 1."},{"timestamp":1532045555,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 1:\n\n(4 comments)\n\nPass 0 comments."},{"timestamp":1532059077,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 1:\n\n(4 comments)"},{"timestamp":1532100867,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Uploaded patch set 2."},{"timestamp":1532104274,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 2:\n\n(3 comments)\n\nOne last readability nit."},{"timestamp":1532106361,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Uploaded patch set 3."},{"timestamp":1532106517,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 3:\n\n(1 comment)\n\nDammit, I missed something earlier.  Sorry."},{"timestamp":1532106747,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 3:\n\n(1 comment)"},{"timestamp":1532106831,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 3: Code-Review+1\n\n(1 comment)\n\nLet\u0027s get this tested on kebecloud."},{"timestamp":1532639425,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 3: Integration-Approval+1"},{"timestamp":1532639435,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 3:\n\nTested last week."},{"timestamp":1532976449,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 4: Patch Set 3 was rebased"},{"timestamp":1532976508,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Jason King"}],"currentPatchSet":{"number":"4","revision":"329bde5f2374bfcb301ef484c3466742a74e8a7b","parents":["d9a92a393b8b7fc21abed0700a709342d3ad2fb1"],"ref":"refs/changes/47/4547/4","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1532976449,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1532106831,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1532639425,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"SUBM","value":"1","grantedOn":1532976508,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/mdb/common/modules/genunix/Makefile.files","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/cmd/mdb/common/modules/genunix/genunix.c","type":"MODIFIED","insertions":8,"deletions":-1},{"file":"usr/src/cmd/mdb/common/modules/genunix/qqcache.c","type":"ADDED","insertions":117,"deletions":0},{"file":"usr/src/cmd/mdb/common/modules/genunix/qqcache.h","type":"ADDED","insertions":40,"deletions":0},{"file":"usr/src/uts/common/Makefile.files","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/Makefile.rules","type":"MODIFIED","insertions":8,"deletions":-1},{"file":"usr/src/uts/common/io/overlay/overlay.c","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/common/io/overlay/overlay_target.c","type":"MODIFIED","insertions":57,"deletions":-63},{"file":"usr/src/uts/common/io/overlay/sarc.c","type":"DELETED","insertions":0,"deletions":-676},{"file":"usr/src/uts/common/io/overlay/sarc_impl.h","type":"DELETED","insertions":0,"deletions":-67},{"file":"usr/src/uts/common/qqcache/qqcache.c","type":"ADDED","insertions":431,"deletions":0},{"file":"usr/src/uts/common/sys/Makefile","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/common/sys/overlay_impl.h","type":"MODIFIED","insertions":4,"deletions":-5},{"file":"usr/src/uts/common/sys/qqcache.h","type":"ADDED","insertions":176,"deletions":0},{"file":"usr/src/uts/common/sys/qqcache_impl.h","type":"ADDED","insertions":72,"deletions":0},{"file":"usr/src/uts/common/sys/sarc.h","type":"DELETED","insertions":0,"deletions":-179}],"sizeInsertions":921,"sizeDeletions":-996},"patchSets":[{"number":"1","revision":"f73be90d2f985ea65d2c89fc976d39a7fbfa180c","parents":["37db590275a967a096f42034740562bd471d1de8"],"ref":"refs/changes/47/4547/1","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1532042921,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/uts/common/io/overlay/overlay_target.c","line":64,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Kernel global instead of #define?"},{"file":"usr/src/uts/common/io/overlay/overlay_target.c","line":64,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"One of the things in progress before this detour was adding dladm properties to manage the size (in that case the sarc_t size).  My plan was to adapt that work to this, so they would have default values, but can be changed on the fly via dladm."},{"file":"usr/src/uts/common/io/overlay/overlay_target.c","line":64,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"So \"coming as part of future work\", gotcha."},{"file":"usr/src/uts/common/io/overlay/overlay_target.c","line":70,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Same here?  This way one COULD use /etc/system to overwrite on reboot, or use mdb -kw IFF you can unplumb the overlay instance and replumb it."},{"file":"usr/src/uts/common/io/overlay/overlay_target.c","line":70,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Same with this."},{"file":"usr/src/uts/common/io/overlay/sarc.c","line":3,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Make sure you save this somewhere for patent-expiration-day."},{"file":"usr/src/uts/common/io/overlay/sarc.c","line":3,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Yeah, I have a copy of this saved off for future use."},{"file":"usr/src/uts/common/qqcache/qqcache.c","line":32,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Why the ifdef if you\u0027re in usr/src/uts ?"},{"file":"usr/src/uts/common/qqcache/qqcache.c","line":32,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"It originally was user land for faster iteration while testing/debugging."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/mdb/common/modules/genunix/Makefile.files","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/cmd/mdb/common/modules/genunix/genunix.c","type":"MODIFIED","insertions":8,"deletions":-1},{"file":"usr/src/cmd/mdb/common/modules/genunix/qqcache.c","type":"ADDED","insertions":117,"deletions":0},{"file":"usr/src/cmd/mdb/common/modules/genunix/qqcache.h","type":"ADDED","insertions":40,"deletions":0},{"file":"usr/src/uts/common/Makefile.files","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/Makefile.rules","type":"MODIFIED","insertions":8,"deletions":-1},{"file":"usr/src/uts/common/io/overlay/overlay.c","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/common/io/overlay/overlay_target.c","type":"MODIFIED","insertions":57,"deletions":-63},{"file":"usr/src/uts/common/io/overlay/sarc.c","type":"DELETED","insertions":0,"deletions":-676},{"file":"usr/src/uts/common/io/overlay/sarc_impl.h","type":"DELETED","insertions":0,"deletions":-67},{"file":"usr/src/uts/common/qqcache/qqcache.c","type":"ADDED","insertions":439,"deletions":0},{"file":"usr/src/uts/common/sys/Makefile","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/common/sys/overlay_impl.h","type":"MODIFIED","insertions":4,"deletions":-5},{"file":"usr/src/uts/common/sys/qqcache.h","type":"ADDED","insertions":176,"deletions":0},{"file":"usr/src/uts/common/sys/qqcache_impl.h","type":"ADDED","insertions":72,"deletions":0},{"file":"usr/src/uts/common/sys/sarc.h","type":"DELETED","insertions":0,"deletions":-179}],"sizeInsertions":929,"sizeDeletions":-996},{"number":"2","revision":"28e3a60310dcecc0204e9648972ed3cd484644c0","parents":["37db590275a967a096f42034740562bd471d1de8"],"ref":"refs/changes/47/4547/2","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1532100867,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/uts/common/qqcache/qqcache.c","line":278,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"For readability, might you instead have two locals:  \"ql\" and \"qlnext\"?  The [0] and [1] confuses me slightly as I read below.  Instead of ql[0].\u003cfoo\u003e you can have ql-\u003efoo and instead of ql[1].\u003cfoo\u003e you have qlnext-\u003efoo ?"},{"file":"usr/src/uts/common/qqcache/qqcache.c","line":314,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"unused?"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/mdb/common/modules/genunix/Makefile.files","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/cmd/mdb/common/modules/genunix/genunix.c","type":"MODIFIED","insertions":8,"deletions":-1},{"file":"usr/src/cmd/mdb/common/modules/genunix/qqcache.c","type":"ADDED","insertions":117,"deletions":0},{"file":"usr/src/cmd/mdb/common/modules/genunix/qqcache.h","type":"ADDED","insertions":40,"deletions":0},{"file":"usr/src/uts/common/Makefile.files","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/Makefile.rules","type":"MODIFIED","insertions":8,"deletions":-1},{"file":"usr/src/uts/common/io/overlay/overlay.c","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/common/io/overlay/overlay_target.c","type":"MODIFIED","insertions":57,"deletions":-63},{"file":"usr/src/uts/common/io/overlay/sarc.c","type":"DELETED","insertions":0,"deletions":-676},{"file":"usr/src/uts/common/io/overlay/sarc_impl.h","type":"DELETED","insertions":0,"deletions":-67},{"file":"usr/src/uts/common/qqcache/qqcache.c","type":"ADDED","insertions":430,"deletions":0},{"file":"usr/src/uts/common/sys/Makefile","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/common/sys/overlay_impl.h","type":"MODIFIED","insertions":4,"deletions":-5},{"file":"usr/src/uts/common/sys/qqcache.h","type":"ADDED","insertions":176,"deletions":0},{"file":"usr/src/uts/common/sys/qqcache_impl.h","type":"ADDED","insertions":72,"deletions":0},{"file":"usr/src/uts/common/sys/sarc.h","type":"DELETED","insertions":0,"deletions":-179}],"sizeInsertions":920,"sizeDeletions":-996},{"number":"3","revision":"8ed28d212b35ed20adf00805818e6cc034da200c","parents":["37db590275a967a096f42034740562bd471d1de8"],"ref":"refs/changes/47/4547/3","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1532106361,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1532106831,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1532639425,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}}],"comments":[{"file":"usr/src/uts/common/qqcache/qqcache.c","line":277,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"What if i is (QQCACHE_NUM_LISTS - 1)?  Will qlnext be off in hyperspace outside the allocated qqc_lists?"},{"file":"usr/src/uts/common/qqcache/qqcache.c","line":277,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Yes, but it\u0027s never used in that case -- see lines 295-306"},{"file":"usr/src/uts/common/qqcache/qqcache.c","line":277,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Oops, my bad."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/mdb/common/modules/genunix/Makefile.files","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/cmd/mdb/common/modules/genunix/genunix.c","type":"MODIFIED","insertions":8,"deletions":-1},{"file":"usr/src/cmd/mdb/common/modules/genunix/qqcache.c","type":"ADDED","insertions":117,"deletions":0},{"file":"usr/src/cmd/mdb/common/modules/genunix/qqcache.h","type":"ADDED","insertions":40,"deletions":0},{"file":"usr/src/uts/common/Makefile.files","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/Makefile.rules","type":"MODIFIED","insertions":8,"deletions":-1},{"file":"usr/src/uts/common/io/overlay/overlay.c","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/common/io/overlay/overlay_target.c","type":"MODIFIED","insertions":57,"deletions":-63},{"file":"usr/src/uts/common/io/overlay/sarc.c","type":"DELETED","insertions":0,"deletions":-676},{"file":"usr/src/uts/common/io/overlay/sarc_impl.h","type":"DELETED","insertions":0,"deletions":-67},{"file":"usr/src/uts/common/qqcache/qqcache.c","type":"ADDED","insertions":431,"deletions":0},{"file":"usr/src/uts/common/sys/Makefile","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/common/sys/overlay_impl.h","type":"MODIFIED","insertions":4,"deletions":-5},{"file":"usr/src/uts/common/sys/qqcache.h","type":"ADDED","insertions":176,"deletions":0},{"file":"usr/src/uts/common/sys/qqcache_impl.h","type":"ADDED","insertions":72,"deletions":0},{"file":"usr/src/uts/common/sys/sarc.h","type":"DELETED","insertions":0,"deletions":-179}],"sizeInsertions":921,"sizeDeletions":-996},{"number":"4","revision":"329bde5f2374bfcb301ef484c3466742a74e8a7b","parents":["d9a92a393b8b7fc21abed0700a709342d3ad2fb1"],"ref":"refs/changes/47/4547/4","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1532976449,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"SUBM","value":"1","grantedOn":1532976508,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1532106831,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1532639425,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/mdb/common/modules/genunix/Makefile.files","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/cmd/mdb/common/modules/genunix/genunix.c","type":"MODIFIED","insertions":8,"deletions":-1},{"file":"usr/src/cmd/mdb/common/modules/genunix/qqcache.c","type":"ADDED","insertions":117,"deletions":0},{"file":"usr/src/cmd/mdb/common/modules/genunix/qqcache.h","type":"ADDED","insertions":40,"deletions":0},{"file":"usr/src/uts/common/Makefile.files","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"usr/src/uts/common/Makefile.rules","type":"MODIFIED","insertions":8,"deletions":-1},{"file":"usr/src/uts/common/io/overlay/overlay.c","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"usr/src/uts/common/io/overlay/overlay_target.c","type":"MODIFIED","insertions":57,"deletions":-63},{"file":"usr/src/uts/common/io/overlay/sarc.c","type":"DELETED","insertions":0,"deletions":-676},{"file":"usr/src/uts/common/io/overlay/sarc_impl.h","type":"DELETED","insertions":0,"deletions":-67},{"file":"usr/src/uts/common/qqcache/qqcache.c","type":"ADDED","insertions":431,"deletions":0},{"file":"usr/src/uts/common/sys/Makefile","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/common/sys/overlay_impl.h","type":"MODIFIED","insertions":4,"deletions":-5},{"file":"usr/src/uts/common/sys/qqcache.h","type":"ADDED","insertions":176,"deletions":0},{"file":"usr/src/uts/common/sys/qqcache_impl.h","type":"ADDED","insertions":72,"deletions":0},{"file":"usr/src/uts/common/sys/sarc.h","type":"DELETED","insertions":0,"deletions":-179}],"sizeInsertions":921,"sizeDeletions":-996}],"allReviewers":[{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}]}