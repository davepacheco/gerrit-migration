{"project":"joyent/illumos-joyent","branch":"master","id":"I7d2b0a193bc03bcd23db86240ed95e751f237152","number":"6917","subject":"OS-7990 ip_cksum() is a mess","owner":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"url":"https://cr.joyent.us/6917","commitMessage":"OS-7990 ip_cksum() is a mess\n","createdOn":1568778168,"lastUpdated":1571740515,"open":true,"status":"NEW","comments":[{"timestamp":1568778168,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Uploaded patch set 1."},{"timestamp":1569005157,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 1:\n\nBefore I forget, please file a low-priority illumos bug to lose STRUIO_IP after this goes back upstream?  It\u0027s a bigger can of worms than at first glance, because there are dblk_t fields associated with it. Still, it\u0027s worth losing, even it to keep the dblk_t fields around for future trouble."},{"timestamp":1569005818,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 1:\n\n(2 comments)"},{"timestamp":1569006466,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 1:\n\n(2 comments)"},{"timestamp":1569006484,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Uploaded patch set 2."},{"timestamp":1569011203,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 2: Code-Review+1\n\nMuch better.  CR is good. Please test this beyond the iperf testing you showed me.  netperf TCP_RR/TCP_CRR/UDP_RR should show something good.  Also, if possible rig bad mblks against this (userspace test rig?)."},{"timestamp":1569019261,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Uploaded patch set 3: Patch Set 2 was rebased."},{"timestamp":1570738371,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 3: Integration-Approval+1\n\nGet this out to illumos sooner rather than later."},{"timestamp":1571740515,"reviewer":{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},"message":"Patch Set 3:\n\nAs this is getting reviewed upstream now, can this one be abandoned?"}],"currentPatchSet":{"number":"3","revision":"7d2b0a193bc03bcd23db86240ed95e751f237152","parents":["0702468eedf9b4641b4359df530337857b0b65c1"],"ref":"refs/changes/17/6917/3","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1569019261,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1569011203,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1570738371,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/os/ip_cksum.c","type":"MODIFIED","insertions":96,"deletions":-314}],"sizeInsertions":96,"sizeDeletions":-314},"patchSets":[{"number":"1","revision":"53824ce4b43a1b194f29c756529a0f6230e2c9af","parents":["4e7ed5ff5aed7830c00a00fde7205951f49b4f05"],"ref":"refs/changes/17/6917/1","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1568778168,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/uts/common/os/ip_cksum.c","line":109,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Won\u0027t this cause a double-mblk skip? You advance mp, then goto next which will advance mp AGAIN.  If I read this correctly, just \"goto next\" should DTRT, no?"},{"file":"usr/src/uts/common/os/ip_cksum.c","line":109,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Yeah. I\u0027ll fix."},{"file":"usr/src/uts/common/os/ip_cksum.c","line":142,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"I take it ip_ocsum() if it gets an odd mlen will ignore that last byte?"},{"file":"usr/src/uts/common/os/ip_cksum.c","line":142,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Oops.. it actually takes the length as \u0027half words\u0027, so that needs to be `mlen / 2`."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/os/ip_cksum.c","type":"MODIFIED","insertions":91,"deletions":-314}],"sizeInsertions":91,"sizeDeletions":-314},{"number":"2","revision":"d0dba9f5a4c4aa5b518f99f4687e2fa58e499b07","parents":["4e7ed5ff5aed7830c00a00fde7205951f49b4f05"],"ref":"refs/changes/17/6917/2","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1569006484,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1569011203,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/os/ip_cksum.c","type":"MODIFIED","insertions":96,"deletions":-314}],"sizeInsertions":96,"sizeDeletions":-314},{"number":"3","revision":"7d2b0a193bc03bcd23db86240ed95e751f237152","parents":["0702468eedf9b4641b4359df530337857b0b65c1"],"ref":"refs/changes/17/6917/3","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1569019261,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1569011203,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1570738371,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/uts/common/os/ip_cksum.c","type":"MODIFIED","insertions":96,"deletions":-314}],"sizeInsertions":96,"sizeDeletions":-314}],"allReviewers":[{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},{"name":"John Levon","email":"john.levon@joyent.com","username":"johnlevon"},{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}]}