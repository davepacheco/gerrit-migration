{"project":"joyent/sdcadm","branch":"master","id":"Ic49d4befc538b2367826f01934bf25469a420f00","number":"6361","subject":"TRITON-1706 \u0027sdcadm post-setup dev-sample-data\u0027 should ensure sample images are public\u003dtrue Reviewed by: Josh Wilsdon \u003cjosh@wilsdon.ca\u003e Approved by: Josh Wilsdon \u003cjosh@wilsdon.ca\u003e","owner":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"url":"https://cr.joyent.us/6361","commitMessage":"TRITON-1706 \u0027sdcadm post-setup dev-sample-data\u0027 should ensure sample images are public\u003dtrue\nReviewed by: Josh Wilsdon \u003cjosh@wilsdon.ca\u003e\nApproved by: Josh Wilsdon \u003cjosh@wilsdon.ca\u003e\n","createdOn":1558980878,"lastUpdated":1558983063,"open":false,"status":"MERGED","comments":[{"timestamp":1558980878,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Uploaded patch set 1."},{"timestamp":1558980880,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit 0718020161e1389d903a67ffa047f0b9046aec26\n    \n    fix it"},{"timestamp":1558980917,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1558981712,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 1: Code-Review+1\n\n(3 comments)"},{"timestamp":1558982024,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 1:\n\n(3 comments)"},{"timestamp":1558982344,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Uploaded patch set 2."},{"timestamp":1558982345,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit 0de9a0c09c6a19f977e6fce9c18a5e10d4ea8fa8\n    \n    better name/comments"},{"timestamp":1558982380,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1558982922,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1558982932,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Patch Set 2: Code-Review+1 Integration-Approval+1"},{"timestamp":1558982943,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Uploaded patch set 3: Commit message was updated."},{"timestamp":1558983059,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1558983063,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Trent Mick"}],"currentPatchSet":{"number":"3","revision":"c49d4befc538b2367826f01934bf25469a420f00","parents":["44b43162473d801eaeaf8810e13c514f83408218"],"ref":"refs/changes/61/6361/3","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1558982943,"author":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1558982380,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1558982932,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1558982932,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"SUBM","value":"1","grantedOn":1558983063,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":5,"deletions":0},{"file":"lib/post-setup/dev-sample-data.js","type":"MODIFIED","insertions":34,"deletions":-5},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":40,"sizeDeletions":-6},"patchSets":[{"number":"1","revision":"8d21cd5188179d13c01c76adac5d8766ddd71bcc","parents":["44b43162473d801eaeaf8810e13c514f83408218"],"ref":"refs/changes/61/6361/1","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1558980878,"author":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1558980917,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1558981712,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}}],"comments":[{"file":"lib/post-setup/dev-sample-data.js","line":123,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Was this name a placeholder? What about something like findImgsToMakePublic?"},{"file":"lib/post-setup/dev-sample-data.js","line":123,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"It was not a placeholder name. The intent was to show that this function is gathering the \"todo\"s, which includes *both* the images to make public and the images to download/import.\n\nPerhaps using \"todo\" is too overloaded with common usage of \"TODO\" in comments to suggest \"this is something we should come back to\".\n\nDoes \"gatherWork\" sound better? \"gatherImgsToMakePublicAndImgsToDownload\" feels a bit Java Spring overkill."},{"file":"lib/post-setup/dev-sample-data.js","line":123,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"I\u0027m not sure gatherWork is much more obvious what it does. But it doesn\u0027t really matter that much I guess.\n\nPerhaps the cleanest way would be to have 1 function that gets the metadata for all images in the list, and then 1 function that populates the array for images to make public, and another function that generates the array of images that need to be made public.\n\nBut... maybe that is overkill?"},{"file":"lib/post-setup/dev-sample-data.js","line":123,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Yes, I think that is overkill.\nThanks for the review."},{"file":"lib/post-setup/dev-sample-data.js","line":165,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"Is it always safe to mark all images public? Or is there some case where the public\u003dfalse setting was intended to prevent it from being visible to others?"},{"file":"lib/post-setup/dev-sample-data.js","line":165,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Fair question. This is a \"dev-\"-prefixed sdcadm command. I think onus is on the operator to cope with that. The command\u0027s help summary already has `Add sample data suitable for *development and testing*.`."},{"file":"lib/post-setup/dev-sample-data.js","line":168,"reviewer":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},"message":"I guess we\u0027re fine not limiting the number of concurrent requests here because we have a limited number of images in the sample data?"},{"file":"lib/post-setup/dev-sample-data.js","line":168,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Yes, that\u0027s why I didn\u0027t bother. I can\u0027t imagine we\u0027ll ever have so many *sample* images that we can overload IMGAPI here."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":5,"deletions":0},{"file":"lib/post-setup/dev-sample-data.js","type":"MODIFIED","insertions":33,"deletions":-5},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":39,"sizeDeletions":-6},{"number":"2","revision":"fefd50966a380e9eb656622a485d18a8826f454b","parents":["44b43162473d801eaeaf8810e13c514f83408218"],"ref":"refs/changes/61/6361/2","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1558982344,"author":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1558982380,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1558982932,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1558982932,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":5,"deletions":0},{"file":"lib/post-setup/dev-sample-data.js","type":"MODIFIED","insertions":34,"deletions":-5},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":40,"sizeDeletions":-6},{"number":"3","revision":"c49d4befc538b2367826f01934bf25469a420f00","parents":["44b43162473d801eaeaf8810e13c514f83408218"],"ref":"refs/changes/61/6361/3","uploader":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"createdOn":1558982943,"author":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1558982380,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"SUBM","value":"1","grantedOn":1558983063,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1558982932,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1558982932,"by":{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":5,"deletions":0},{"file":"lib/post-setup/dev-sample-data.js","type":"MODIFIED","insertions":34,"deletions":-5},{"file":"package.json","type":"MODIFIED","insertions":1,"deletions":-1}],"sizeInsertions":40,"sizeDeletions":-6}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Josh Wilsdon","email":"josh@wilsdon.ca","username":"joshwilsdon"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}]}