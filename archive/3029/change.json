{"project":"joyent/illumos-joyent","branch":"master","id":"I9ba45b30b3b7aaeb1b63f85670403e6ea3a550eb","number":"3029","subject":"OS-6480 Allow IKEV2 pf_key(7P) key management cookies to be updated after set Reviewed by: Dan McDonald \u003cdanmcd@joyent.com\u003e Approved by: Dan McDonald \u003cdanmcd@joyent.com\u003e","owner":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"url":"https://cr.joyent.us/3029","commitMessage":"OS-6480 Allow IKEV2 pf_key(7P) key management cookies to be updated after set\nReviewed by: Dan McDonald \u003cdanmcd@joyent.com\u003e\nApproved by: Dan McDonald \u003cdanmcd@joyent.com\u003e\n","createdOn":1512407587,"lastUpdated":1512489140,"open":false,"status":"MERGED","comments":[{"timestamp":1512407587,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Uploaded patch set 1."},{"timestamp":1512414095,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 1:\n\n(2 comments)"},{"timestamp":1512418308,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Patch Set 1:\n\n(2 comments)"},{"timestamp":1512420274,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 1:\n\n(1 comment)"},{"timestamp":1512423065,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Uploaded patch set 2."},{"timestamp":1512423118,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 2: Code-Review+1"},{"timestamp":1512435280,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Uploaded patch set 3: Commit message was updated."},{"timestamp":1512435398,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Uploaded patch set 4: Patch Set 3 was rebased."},{"timestamp":1512486002,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Patch Set 4: Integration-Approval+1"},{"timestamp":1512488924,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Uploaded patch set 5: Commit message was updated."},{"timestamp":1512489016,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Uploaded patch set 6: Patch Set 5 was rebased."},{"timestamp":1512489140,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Jason King"}],"currentPatchSet":{"number":"6","revision":"9ba45b30b3b7aaeb1b63f85670403e6ea3a550eb","parents":["afa571e5c76063af71af626415191589b53d042f"],"ref":"refs/changes/29/3029/6","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1512489016,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1512423118,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1512486002,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"SUBM","value":"1","grantedOn":1512489140,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/lib/libipsecutil/common/ipsec_util.c","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/test/os-tests/tests/pf_key/Makefile","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/test/os-tests/tests/pf_key/kmc-update.sh","type":"MODIFIED","insertions":72,"deletions":-1},{"file":"usr/src/test/os-tests/tests/pf_key/kmc-updater.c","type":"MODIFIED","insertions":98,"deletions":-28},{"file":"usr/src/uts/common/inet/ip/sadb.c","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/common/net/pfkeyv2.h","type":"MODIFIED","insertions":2,"deletions":-1}],"sizeInsertions":179,"sizeDeletions":-32},"patchSets":[{"number":"1","revision":"8d83bdadb34db918c747f44111c867c32398c5c2","parents":["0d5719a2f0864296378787c96d12da889970c4e4"],"ref":"refs/changes/29/3029/1","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1512407587,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/test/os-tests/tests/pf_key/kmc-update.sh","line":116,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Can you test that you can change an IKEv2 KMC twice?  I see that the first test will update one after a fresh SA got added (zero \u003d\u003d\u003e non-zero).  Can you updated it a second time (nonzero \u003d\u003d\u003e other-non-zero)?"},{"file":"usr/src/test/os-tests/tests/pf_key/kmc-update.sh","line":116,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"The line at 106 will set the cookie (to the default value -- 0xc0ffee4afee01deaULL) and then line 111 will change it from the default value (0xc0ffee4afee01deaULL) to $COOKIE_IKEV2.  \n\nAre you wanting a third update to some other value?"},{"file":"usr/src/test/os-tests/tests/pf_key/kmc-update.sh","line":116,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Doh!  That\u0027s right.  kmc-updater the app does that."},{"file":"usr/src/uts/common/inet/ip/sadb.c","line":4471,"reviewer":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},"message":"Your change (middle-insertion inside parens) makes the situation appear more complicated than it actually is.\n\n   if ((kmp !\u003d SADB_X_KMP_IKEV2) \u0026\u0026 (kmc !\u003d 0) \u0026\u0026 (sa-\u003eipsa_kmc !\u003d 0) \u0026\u0026 (sa-\u003eipsa_kmc !\u003d kmc)) {\n\nThat\u0027s easier to read, and is equivalent to your change."},{"file":"usr/src/uts/common/inet/ip/sadb.c","line":4471,"reviewer":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/libipsecutil/common/ipsec_util.c","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/test/os-tests/tests/pf_key/Makefile","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/test/os-tests/tests/pf_key/kmc-update.sh","type":"MODIFIED","insertions":72,"deletions":-1},{"file":"usr/src/test/os-tests/tests/pf_key/kmc-updater.c","type":"MODIFIED","insertions":98,"deletions":-28},{"file":"usr/src/uts/common/inet/ip/sadb.c","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/common/net/pfkeyv2.h","type":"MODIFIED","insertions":2,"deletions":-1}],"sizeInsertions":179,"sizeDeletions":-32},{"number":"2","revision":"031f28be3c6ac4816159361e8cd33673550a431a","parents":["0d5719a2f0864296378787c96d12da889970c4e4"],"ref":"refs/changes/29/3029/2","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1512423065,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1512423118,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/lib/libipsecutil/common/ipsec_util.c","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/test/os-tests/tests/pf_key/Makefile","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/test/os-tests/tests/pf_key/kmc-update.sh","type":"MODIFIED","insertions":72,"deletions":-1},{"file":"usr/src/test/os-tests/tests/pf_key/kmc-updater.c","type":"MODIFIED","insertions":98,"deletions":-28},{"file":"usr/src/uts/common/inet/ip/sadb.c","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/common/net/pfkeyv2.h","type":"MODIFIED","insertions":2,"deletions":-1}],"sizeInsertions":179,"sizeDeletions":-32},{"number":"3","revision":"637f851703dbd2b7de5ab0baed0dc8f14f3ff039","parents":["0d5719a2f0864296378787c96d12da889970c4e4"],"ref":"refs/changes/29/3029/3","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1512435280,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1512423118,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"usr/src/lib/libipsecutil/common/ipsec_util.c","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/test/os-tests/tests/pf_key/Makefile","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/test/os-tests/tests/pf_key/kmc-update.sh","type":"MODIFIED","insertions":72,"deletions":-1},{"file":"usr/src/test/os-tests/tests/pf_key/kmc-updater.c","type":"MODIFIED","insertions":98,"deletions":-28},{"file":"usr/src/uts/common/inet/ip/sadb.c","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/common/net/pfkeyv2.h","type":"MODIFIED","insertions":2,"deletions":-1}],"sizeInsertions":179,"sizeDeletions":-32},{"number":"4","revision":"19b41d3bbd3ae1f9e5d112a38fe92773343b7f69","parents":["758ae53701bec2fed98db901e5af051af2ac0c6d"],"ref":"refs/changes/29/3029/4","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1512435398,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1512423118,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1512486002,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"usr/src/lib/libipsecutil/common/ipsec_util.c","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/test/os-tests/tests/pf_key/Makefile","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/test/os-tests/tests/pf_key/kmc-update.sh","type":"MODIFIED","insertions":72,"deletions":-1},{"file":"usr/src/test/os-tests/tests/pf_key/kmc-updater.c","type":"MODIFIED","insertions":98,"deletions":-28},{"file":"usr/src/uts/common/inet/ip/sadb.c","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/common/net/pfkeyv2.h","type":"MODIFIED","insertions":2,"deletions":-1}],"sizeInsertions":179,"sizeDeletions":-32},{"number":"5","revision":"a405f4060d454494be8486059a4f937c82912326","parents":["758ae53701bec2fed98db901e5af051af2ac0c6d"],"ref":"refs/changes/29/3029/5","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1512488924,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1512423118,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1512486002,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/lib/libipsecutil/common/ipsec_util.c","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/test/os-tests/tests/pf_key/Makefile","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/test/os-tests/tests/pf_key/kmc-update.sh","type":"MODIFIED","insertions":72,"deletions":-1},{"file":"usr/src/test/os-tests/tests/pf_key/kmc-updater.c","type":"MODIFIED","insertions":98,"deletions":-28},{"file":"usr/src/uts/common/inet/ip/sadb.c","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/common/net/pfkeyv2.h","type":"MODIFIED","insertions":2,"deletions":-1}],"sizeInsertions":179,"sizeDeletions":-32},{"number":"6","revision":"9ba45b30b3b7aaeb1b63f85670403e6ea3a550eb","parents":["afa571e5c76063af71af626415191589b53d042f"],"ref":"refs/changes/29/3029/6","uploader":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"createdOn":1512489016,"author":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"SUBM","value":"1","grantedOn":1512489140,"by":{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1512423118,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1512486002,"by":{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/lib/libipsecutil/common/ipsec_util.c","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/test/os-tests/tests/pf_key/Makefile","type":"MODIFIED","insertions":1,"deletions":0},{"file":"usr/src/test/os-tests/tests/pf_key/kmc-update.sh","type":"MODIFIED","insertions":72,"deletions":-1},{"file":"usr/src/test/os-tests/tests/pf_key/kmc-updater.c","type":"MODIFIED","insertions":98,"deletions":-28},{"file":"usr/src/uts/common/inet/ip/sadb.c","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"usr/src/uts/common/net/pfkeyv2.h","type":"MODIFIED","insertions":2,"deletions":-1}],"sizeInsertions":179,"sizeDeletions":-32}],"allReviewers":[{"name":"Dan McDonald","email":"danmcd@joyent.com","username":"danmcd"},{"name":"Jason King","email":"jason.king@joyent.com","username":"jasonbking"}]}