{"project":"joyent/smartos-live","branch":"master","id":"Ie9021be03f34cb72b83b9f6756e91d231aec32bf","number":"2127","subject":"OS-6185 use pigz (parallel gunzip uncompression) to speed up imgadm import Reviewed by: Trent Mick \u003ctrentm@gmail.com\u003e","owner":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"url":"https://cr.joyent.us/2127","commitMessage":"OS-6185 use pigz (parallel gunzip uncompression) to speed up imgadm import\nReviewed by: Trent Mick \u003ctrentm@gmail.com\u003e\n","createdOn":1497911552,"lastUpdated":1501786169,"open":true,"status":"NEW","comments":[{"timestamp":1497911552,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Uploaded patch set 1."},{"timestamp":1497911554,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit a91cd39157c531eba555a616f3c287441bea13e2\n    \n    OS-6185 use pigz (parallel gunzip uncompression) to speed up imgadm import"},{"timestamp":1497911592,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1497911956,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Uploaded patch set 2."},{"timestamp":1497911957,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit cb6e5929641a20126d96d471d5a31e6af9706b98\n    \n    OS-6185 use pigz (parallel gunzip uncompression) to speed up imgadm import"},{"timestamp":1497911996,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1498601949,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 2:\n\n(2 comments)"},{"timestamp":1498692389,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Patch Set 2:\n\n(1 comment)"},{"timestamp":1500328482,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Uploaded patch set 3."},{"timestamp":1500328483,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Patch Set 3:\n\nNew commits:\n    \n    commit ec833de7eb635e9ddcad7843ff884a5d97ce44f8\n    \n    OS-6185 `pigz` (parallel gzip) support in the platform\n    * don\u0027t remove /usr/img directory, as pigz is already installed there\n    \n    commit 25394ba4ab49afd2cbb61a948875f3636ba00540\n    \n    OS-6185 use pigz (parallel gunzip uncompression) to speed up imgadm import"},{"timestamp":1500328520,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1500329484,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 3: Code-Review+1\n\n(1 comment)\n\nWhat kind of testing have you done so far here?"},{"timestamp":1500401972,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Uploaded patch set 4."},{"timestamp":1500401973,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Patch Set 4:\n\nNew commits:\n    \n    commit 9a7013d889a907689fff5658499a4a523bd41c27\n    \n    add imgadm \u0027usePigz\u0027 config option, so that pigz decompression can be disabled"},{"timestamp":1500402019,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1500402280,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Patch Set 3:\n\n(1 comment)\n\n\u003e What kind of testing have you done so far here?\n\nManual testing of common docker images (and on some large docker images).\n\nI\u0027ve tested the new \u0027usePigz\u0027 config option, using dtrace to snoop on the executed processes, to ensure the imgadm config setting matches the expected result."},{"timestamp":1500586089,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 4: Code-Review+1\n\nCan we a note on \u0027usePigz\u0027 in the top-comment in src/img/lib/configuration.js please?"},{"timestamp":1500587951,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Uploaded patch set 5."},{"timestamp":1500587952,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Patch Set 5:\n\nNew commits:\n    \n    commit cfc71e04c43bee236c7e069d064522502ae3fbb4\n    \n    add comment for usePigz configuration"},{"timestamp":1500587994,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1500589035,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Patch Set 5: Code-Review+1 Integration-Approval+1"},{"timestamp":1501786129,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Patch Set 6: Patch Set 5 was rebased"},{"timestamp":1501786169,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 6:\n\n\"make check\" passed ok"}],"currentPatchSet":{"number":"6","revision":"9b9454cdeda6baabdb2c82764b2a1d486e64f799","parents":["77195c1816fbcb90ba4c2cbe0d039b437a819f51"],"ref":"refs/changes/27/2127/6","uploader":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"createdOn":1501786129,"author":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1500587994,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1500589035,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1500589035,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"src/Makefile","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"src/img/CHANGES.md","type":"MODIFIED","insertions":4,"deletions":0},{"file":"src/img/lib/configuration.js","type":"MODIFIED","insertions":3,"deletions":0},{"file":"src/img/lib/imgadm.js","type":"MODIFIED","insertions":9,"deletions":0},{"file":"src/img/package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"src/img/sbin/chroot-gtar","type":"MODIFIED","insertions":12,"deletions":0},{"file":"src/img/sbin/gtar-unlink-dir","type":"MODIFIED","insertions":10,"deletions":-5}],"sizeInsertions":39,"sizeDeletions":-7},"patchSets":[{"number":"1","revision":"7e67d8705e690f20e97e8ed90b0d19c2aa69f6df","parents":["4565251a97d2bd9913b0a0264f49964fd975fa7a"],"ref":"refs/changes/27/2127/1","uploader":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"createdOn":1497911552,"author":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1497911592,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/img/sbin/chroot-gtar","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"src/img/sbin/gtar-unlink-dir","type":"MODIFIED","insertions":8,"deletions":-6}],"sizeInsertions":10,"sizeDeletions":-8},{"number":"2","revision":"4ced2f50b579ecf88b827f2daa886f46874f5d77","parents":["4565251a97d2bd9913b0a0264f49964fd975fa7a"],"ref":"refs/changes/27/2127/2","uploader":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"createdOn":1497911956,"author":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1497911996,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"src/img/sbin/chroot-gtar","line":108,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"Where does pigz come from? Are there missing plat changes to add that?"},{"file":"src/img/sbin/chroot-gtar","line":108,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Yeah, it\u0027s waiting on https://cr.joyent.us/#/c/2126/"},{"file":"src/img/sbin/gtar-unlink-dir","line":77,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"*Could* (I\u0027m not fussed) just use `uncompresscat\u003d\"pigz -dc -p 2\"` and not bother with a separate \u0027uncompresscatopts\u0027 var."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/img/CHANGES.md","type":"MODIFIED","insertions":4,"deletions":0},{"file":"src/img/package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"src/img/sbin/chroot-gtar","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"src/img/sbin/gtar-unlink-dir","type":"MODIFIED","insertions":8,"deletions":-6}],"sizeInsertions":15,"sizeDeletions":-9},{"number":"3","revision":"ce14c8de3fe3970d24a0928e001a6dc962a79c55","parents":["619da21b72a9d97f52128546889ba4c9beb27305"],"ref":"refs/changes/27/2127/3","uploader":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"createdOn":1500328482,"author":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1500328520,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1500329484,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"comments":[{"file":"src/img/package.json","line":4,"reviewer":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},"message":"I don\u0027t care strongly, but I\u0027d classify this as a feature rather than a bug fix, hence \"3.8.0\" instead. But really it isn\u0027t a biggie."},{"file":"src/img/package.json","line":4,"reviewer":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"src/Makefile","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"src/img/CHANGES.md","type":"MODIFIED","insertions":4,"deletions":0},{"file":"src/img/package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"src/img/sbin/chroot-gtar","type":"MODIFIED","insertions":2,"deletions":-2},{"file":"src/img/sbin/gtar-unlink-dir","type":"MODIFIED","insertions":8,"deletions":-6}],"sizeInsertions":15,"sizeDeletions":-10},{"number":"4","revision":"d348c7d04e52f8e400669ae1a523690d92a217a4","parents":["619da21b72a9d97f52128546889ba4c9beb27305"],"ref":"refs/changes/27/2127/4","uploader":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"createdOn":1500401972,"author":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1500402019,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1500586089,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"src/Makefile","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"src/img/CHANGES.md","type":"MODIFIED","insertions":4,"deletions":0},{"file":"src/img/lib/imgadm.js","type":"MODIFIED","insertions":9,"deletions":0},{"file":"src/img/package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"src/img/sbin/chroot-gtar","type":"MODIFIED","insertions":12,"deletions":0},{"file":"src/img/sbin/gtar-unlink-dir","type":"MODIFIED","insertions":10,"deletions":-5}],"sizeInsertions":36,"sizeDeletions":-7},{"number":"5","revision":"e9021be03f34cb72b83b9f6756e91d231aec32bf","parents":["619da21b72a9d97f52128546889ba4c9beb27305"],"ref":"refs/changes/27/2127/5","uploader":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"createdOn":1500587951,"author":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1500587994,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1500589035,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1500589035,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"src/Makefile","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"src/img/CHANGES.md","type":"MODIFIED","insertions":4,"deletions":0},{"file":"src/img/lib/configuration.js","type":"MODIFIED","insertions":3,"deletions":0},{"file":"src/img/lib/imgadm.js","type":"MODIFIED","insertions":9,"deletions":0},{"file":"src/img/package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"src/img/sbin/chroot-gtar","type":"MODIFIED","insertions":12,"deletions":0},{"file":"src/img/sbin/gtar-unlink-dir","type":"MODIFIED","insertions":10,"deletions":-5}],"sizeInsertions":39,"sizeDeletions":-7},{"number":"6","revision":"9b9454cdeda6baabdb2c82764b2a1d486e64f799","parents":["77195c1816fbcb90ba4c2cbe0d039b437a819f51"],"ref":"refs/changes/27/2127/6","uploader":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"createdOn":1501786129,"author":{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1500587994,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1500589035,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1500589035,"by":{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":8,"deletions":0},{"file":"src/Makefile","type":"MODIFIED","insertions":0,"deletions":-1},{"file":"src/img/CHANGES.md","type":"MODIFIED","insertions":4,"deletions":0},{"file":"src/img/lib/configuration.js","type":"MODIFIED","insertions":3,"deletions":0},{"file":"src/img/lib/imgadm.js","type":"MODIFIED","insertions":9,"deletions":0},{"file":"src/img/package.json","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"src/img/sbin/chroot-gtar","type":"MODIFIED","insertions":12,"deletions":0},{"file":"src/img/sbin/gtar-unlink-dir","type":"MODIFIED","insertions":10,"deletions":-5}],"sizeInsertions":39,"sizeDeletions":-7}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Trent Mick","email":"trentm@gmail.com","username":"trentm"},{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}]}