{"project":"joyent/sdc-cloudapi","branch":"master","topic":"tritonnfs","id":"I644ad3ef3665b4826b75d217af7f5122c724e1ce","number":"2528","subject":"PUBAPI-1300 Implement CRUD volumes endpoints PUBAPI-1366 Volume objects should use the name \"id\" for the property that stores their ID, not \"uuid\" PUBAPI-1373 Add support for passing a JSON predicate to the ListVolumes endpoint PUBAPI-1369 GET volume shou","owner":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"url":"https://cr.joyent.us/2528","commitMessage":"PUBAPI-1300 Implement CRUD volumes endpoints\nPUBAPI-1366 Volume objects should use the name \"id\" for the property that stores their ID, not \"uuid\"\nPUBAPI-1373 Add support for passing a JSON predicate to the ListVolumes endpoint\nPUBAPI-1369 GET volume should return 404 for a non-existing volume name/uuid\nPUBAPI-1377 vm_uuid property should not be present in responses for endpoints rendering NFS shared volumes\nPUBAPI-1374 Want user-friendly timestamp for volume details\nPUBAPI-1379 CreateVolume endpoint should accept size as number, not as string with complex format rules\nPUBAPI-1384 Machines endpoint should not expose NFS volumes\u0027 storage VMs\nPUBAPI-1376 Create volume errors out when the network parameter is passed\nPUBAPI-1372 CreateVolume endpoint should generate volume name if not provided in input parameters\nPUBAPI-1371 List volumes should not return deleted or failed instances\nVOLAPI-49 DELETE should delete\nPUBAPI-1387 Add ListVolumeSizes endpoint to list available volume sizes\nPUBAPI-1408 ListVolumes endpoint should validate the \"predicate\" parameter\nPUBAPI-1407 Error message should be clearer when provisioning a NFS volume in a DC without fabric networks enabled\nVOLAPI-54 Custom errors\u0027 rest codes should follow engineering guide\u0027s guidelines\nPUBAPI-1416 cloudapi ListVolumes validation should match volapi\nVOLAPI-62 Remove all references to state `rolling_back` in current implementation\nTOOLS-1824 sdcadm update-other should not do anything for VOLAPI\nVOLAPI-64 rename smartdc_role nfsserver to nfsvolumestorage\nTOOLS-1830 replace sdcadm experimental nfs-volumes with cloudapi-nfs-volumes/docker-nfs-volumes subcommands\nVOLAPI-72 creating volume with unsupported size should result in error, not in volume being created with closest matching size\nPUBAPI-1420 Add ability to mount NFS volumes with CreateMachine endpoint\nVOLAPI-85 replace smartdc_role\u003dnfsvolumestorage with triton.system_role\u003dnfsvolumestorage\nReviewed by: Marsell Kukuljevic \u003cmarsell@joyent.com\u003e\nApproved by: Julien Gilli \u003cjulien.gilli@joyent.com\u003e\n","createdOn":1504883355,"lastUpdated":1510341218,"open":false,"status":"MERGED","comments":[{"timestamp":1504883355,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 1."},{"timestamp":1504883381,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Topic set to tritonnfs"},{"timestamp":1504883385,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1505230415,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 2."},{"timestamp":1505230451,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1505252277,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 3."},{"timestamp":1505252312,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1505252452,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 4: Patch Set 3 was rebased."},{"timestamp":1505252483,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4:\n\n\"make check\" passed ok"},{"timestamp":1506384286,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 5."},{"timestamp":1506384324,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1506537143,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 6."},{"timestamp":1506537180,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 6: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1506983624,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 7."},{"timestamp":1506983655,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 7: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1506983833,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 8."},{"timestamp":1506983869,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 8: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1507164129,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Abandoned\n\nAbandoning it until https://cr.joyent.us/#/c/2723/ gets merged, so that this CR is smaller and easier to review."},{"timestamp":1507312063,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Restored\n\nRestoring now that https://cr.joyent.us/#/c/2723/ was merged."},{"timestamp":1507312089,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 9."},{"timestamp":1507312124,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 9: CI-Testing-1\n\n\"make check\" exited with status 2\n\n /tmp/repo/test/fabrics.test.js\n /tmp/repo/test/machines/stop.js\n /tmp/repo/test/machines/resize.js\n /tmp/repo/test/machines/delete.js\n /tmp/repo/test/machines/firewall.js\n /tmp/repo/test/machines/reboot.js\n /tmp/repo/test/machines/rename.js\n /tmp/repo/test/machines/affinity.js\n /tmp/repo/test/machines/common.js\n /tmp/repo/test/machines/tags.js\n /tmp/repo/test/machines/snapshots.js\n /tmp/repo/test/machines/firewall-rules.js\n /tmp/repo/test/machines/start.js\n /tmp/repo/test/machines/metadata.js\n /tmp/repo/test/users.test.js\n /tmp/repo/test/machines.test.js\n /tmp/repo/test/volumes-create-name.test.js\n /tmp/repo/test/affinity-unit.test.js\n /tmp/repo/test/images.test.js\n /tmp/repo/test/keys.test.js\n /tmp/repo/test/images.80.test.js\n /tmp/repo/test/images.70.test.js\n /tmp/repo/test/machines.72.test.js\n /tmp/repo/test/analytics.test.js\n /tmp/repo/test/populate_network.test.js\n /tmp/repo/test/volumes.unavailable-size.test.js\n /tmp/repo/test/common.js\n /tmp/repo/test/volumes-list-sizes.test.js\n /tmp/repo/test/plugins/filter_owner_networks.test.js\n /tmp/repo/test/volumes-get.test.js\n /tmp/repo/test/volumes-automount.test.js\n /tmp/repo/test/packages.test.js\n /tmp/repo/test/lib/volumes.js\n /tmp/repo/test/lib/networks.js\n /tmp/repo/test/lib/config.js\n /tmp/repo/test/volumes-list-predicate-validation.test.js\n /tmp/repo/test/auth.test.js\n /tmp/repo/test/machines.73.test.js\n /tmp/repo/test/volumes-basic.test.js\n /tmp/repo/bench/bench.js\n /tmp/repo/bench/child.js\n /tmp/repo/bench/common.js\n /tmp/repo/plugins/filter_owner_networks.js\n /tmp/repo/plugins/provision_limits.js\n /tmp/repo/plugins/capi_limits.js\n /tmp/repo/plugins/machine_email.js\n /tmp/repo/plugins/jpc_free_tier.js\n tools/mk/Makefile.targ:196: recipe for target \u0027check-jsl-node\u0027 failed\n gmake: *** [check-jsl-node] Error 1"},{"timestamp":1507312190,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 10."},{"timestamp":1507312227,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 10: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1507331677,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 11."},{"timestamp":1507331721,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 11: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1507735130,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 11: Code-Review+1\n\n(5 comments)\n\nLooks good to me Julien; just some minor comments"},{"timestamp":1507832541,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 11:\n\n(5 comments)"},{"timestamp":1507832630,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 12."},{"timestamp":1507832672,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 12: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1508085618,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Patch Set 12: Code-Review+1\n\n(2 comments)"},{"timestamp":1508157222,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 12:\n\n(44 comments)"},{"timestamp":1508195461,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 12:\n\n(45 comments)"},{"timestamp":1508203103,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 13."},{"timestamp":1508203141,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 13: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1508225870,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 12:\n\n(8 comments)"},{"timestamp":1508277338,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 12:\n\n(5 comments)"},{"timestamp":1508278712,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 14."},{"timestamp":1508278759,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 14: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1508282482,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 15."},{"timestamp":1508282513,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 15: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1508282687,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 12:\n\n(1 comment)"},{"timestamp":1508284398,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 12:\n\n(2 comments)"},{"timestamp":1508284575,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 12:\n\n(1 comment)"},{"timestamp":1508285622,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 15:\n\n(1 comment)"},{"timestamp":1508298981,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 12:\n\n(1 comment)"},{"timestamp":1508299639,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 16."},{"timestamp":1508299684,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 16: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1509035294,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Patch Set 12:\n\n(7 comments)"},{"timestamp":1509388272,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 12:\n\n(4 comments)"},{"timestamp":1509388293,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 12:\n\n(1 comment)"},{"timestamp":1509388547,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Patch Set 12:\n\nUnderstood, no concerns from me."},{"timestamp":1509395422,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 17."},{"timestamp":1509395452,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 17: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1509395457,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 18: Patch Set 17 was rebased."},{"timestamp":1509395488,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 18:\n\n\"make check\" passed ok"},{"timestamp":1509586871,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 19."},{"timestamp":1509586902,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 19: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1509587002,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 19:\n\nThe latest patch set in this CR added the changes at https://gist.github.com/misterdjules/095d9fc324a1e606c841482db7270bf9  so that during the data migration that generates all the data needed to provide support for searching on internal_metadata, CloudAPI can fall back to outputting all machines when listing them, including NFS volume storage VMs.\n\nThis is related to ZAPI-805 and VOLAPI-86."},{"timestamp":1509590750,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 20."},{"timestamp":1509590780,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 20: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1509668022,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 21."},{"timestamp":1509668053,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 21: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1509963002,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 21:\n\n(15 comments)\n\nAlmost all the stuff is trivial, so if you skip them all that\u0027s fine. I only worry a bit about validVolumeMountpoint() in machines.js; if you\u0027re checking to the detail of \\0, then methinks a whilelist approach is better.\n\nAlso, I assume the docs are left out until this feature is no longer optional and experimental?"},{"timestamp":1509993829,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 22: Patch Set 21 was rebased."},{"timestamp":1509993859,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 22: CI-Testing-1\n\n(1 comment)\n\n\"make check\" exited with status 2"},{"timestamp":1510002375,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 23."},{"timestamp":1510002380,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 22:\n\n(12 comments)"},{"timestamp":1510002406,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 23: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1510005920,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 21:\n\n(3 comments)"},{"timestamp":1510008596,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 24."},{"timestamp":1510008600,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 21:\n\n(3 comments)"},{"timestamp":1510008627,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 24: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1510012112,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 24: Code-Review+1"},{"timestamp":1510013407,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 25."},{"timestamp":1510013413,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 21:\n\n(3 comments)"},{"timestamp":1510013438,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 25: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1510014837,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 25: Code-Review+1"},{"timestamp":1510192166,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 26."},{"timestamp":1510192197,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 26: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1510195960,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 26: Code-Review+1\n\n(1 comment)"},{"timestamp":1510259526,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Uploaded patch set 27."},{"timestamp":1510259561,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 27: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1510262745,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Patch Set 27: Code-Review+1"},{"timestamp":1510341128,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 27: Integration-Approval+1"},{"timestamp":1510341167,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 27:\n\nTesting notes:\n\n1. Ran the CloudAPI volumes tests suite in my COAL and all tests passed.\n\n2. Ran the full CloudAPI tests suite in nightly-1 with NFS volumes support disabled and all tests passed."},{"timestamp":1510341205,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Patch Set 28: Commit message was updated."},{"timestamp":1510341218,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Julien Gilli"}],"currentPatchSet":{"number":"28","revision":"788a08f881b5063d2924aa1ce6a2c4282392d883","parents":["945d2921b9d3d4a91fec80c08cd339c8d0312af0"],"ref":"refs/changes/28/2528/28","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1510341205,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1510259561,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1510262745,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1510341128,"by":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}},{"type":"SUBM","value":"1","grantedOn":1510341218,"by":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":32,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"etc/cloudapi.coal.cfg","type":"DELETED","insertions":0,"deletions":-184},{"file":"lib/app.js","type":"MODIFIED","insertions":33,"deletions":-9},{"file":"lib/endpoints/networks.js","type":"MODIFIED","insertions":3,"deletions":-4},{"file":"lib/endpoints/volumes.js","type":"ADDED","insertions":663,"deletions":0},{"file":"lib/errors.js","type":"MODIFIED","insertions":58,"deletions":-1},{"file":"lib/machines.js","type":"MODIFIED","insertions":214,"deletions":-31},{"file":"lib/middleware/networks.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"lib/units.js","type":"ADDED","insertions":13,"deletions":0},{"file":"lib/validation/predicate.js","type":"ADDED","insertions":82,"deletions":0},{"file":"lib/validation/volumes.js","type":"ADDED","insertions":165,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"sapi_manifests/cloudapi/template","type":"MODIFIED","insertions":16,"deletions":-2},{"file":"test/auth.test.js","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"test/common.js","type":"MODIFIED","insertions":19,"deletions":-2},{"file":"test/fabrics.test.js","type":"MODIFIED","insertions":5,"deletions":-36},{"file":"test/keys.test.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"test/lib/config.js","type":"ADDED","insertions":47,"deletions":0},{"file":"test/lib/networks.js","type":"ADDED","insertions":43,"deletions":0},{"file":"test/lib/volumes.js","type":"ADDED","insertions":85,"deletions":0},{"file":"test/nics.test.js","type":"MODIFIED","insertions":50,"deletions":0},{"file":"test/volumes-automount.test.js","type":"ADDED","insertions":695,"deletions":0},{"file":"test/volumes-basic.test.js","type":"ADDED","insertions":396,"deletions":0},{"file":"test/volumes-create-name.test.js","type":"ADDED","insertions":147,"deletions":0},{"file":"test/volumes-create-validation.test.js","type":"ADDED","insertions":172,"deletions":0},{"file":"test/volumes-get.test.js","type":"ADDED","insertions":59,"deletions":0},{"file":"test/volumes-list-params-validation.test.js","type":"ADDED","insertions":533,"deletions":0},{"file":"test/volumes-list-predicate-validation.test.js","type":"ADDED","insertions":210,"deletions":0},{"file":"test/volumes-list-sizes.test.js","type":"ADDED","insertions":112,"deletions":0},{"file":"test/volumes-no-fabric-network.test.js","type":"ADDED","insertions":110,"deletions":0},{"file":"test/volumes-size.test.js","type":"ADDED","insertions":227,"deletions":0},{"file":"test/volumes-update-name.test.js","type":"ADDED","insertions":165,"deletions":0},{"file":"test/volumes.unavailable-size.test.js","type":"ADDED","insertions":121,"deletions":0}],"sizeInsertions":4462,"sizeDeletions":-276},"patchSets":[{"number":"1","revision":"fdc78c990b91604145dd28bb9e511db6c213dc2d","parents":["85b34ed42d683ffc0e2f17d0a7ca32535ce4de7d"],"ref":"refs/changes/28/2528/1","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1504883355,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1504883385,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":28,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"etc/cloudapi.coal.cfg","type":"DELETED","insertions":0,"deletions":-184},{"file":"lib/app.js","type":"MODIFIED","insertions":34,"deletions":-13},{"file":"lib/config.js","type":"MODIFIED","insertions":80,"deletions":-140},{"file":"lib/endpoints/config.js","type":"ADDED","insertions":165,"deletions":0},{"file":"lib/endpoints/networks.js","type":"ADDED","insertions":605,"deletions":0},{"file":"lib/endpoints/volumes.js","type":"ADDED","insertions":737,"deletions":0},{"file":"lib/errors.js","type":"MODIFIED","insertions":49,"deletions":-2},{"file":"lib/machines.js","type":"MODIFIED","insertions":35,"deletions":-2},{"file":"lib/middlewares/networks.js","type":"ADDED","insertions":131,"deletions":0},{"file":"lib/networks.js","type":"MODIFIED","insertions":79,"deletions":-655},{"file":"lib/units.js","type":"ADDED","insertions":13,"deletions":0},{"file":"lib/validation/predicate.js","type":"ADDED","insertions":87,"deletions":0},{"file":"lib/validation/volumes.js","type":"ADDED","insertions":197,"deletions":0},{"file":"main.js","type":"MODIFIED","insertions":6,"deletions":-57},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"sapi_manifests/cloudapi/template","type":"MODIFIED","insertions":13,"deletions":-2},{"file":"test/auth.test.js","type":"MODIFIED","insertions":4,"deletions":0},{"file":"test/common.js","type":"MODIFIED","insertions":27,"deletions":-2},{"file":"test/fabrics.test.js","type":"MODIFIED","insertions":5,"deletions":-36},{"file":"test/keys.test.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/lib/config.js","type":"ADDED","insertions":46,"deletions":0},{"file":"test/lib/networks.js","type":"ADDED","insertions":43,"deletions":0},{"file":"test/lib/volumes.js","type":"ADDED","insertions":84,"deletions":0},{"file":"test/nics.test.js","type":"MODIFIED","insertions":50,"deletions":0},{"file":"test/volumes-basic.test.js","type":"ADDED","insertions":334,"deletions":0},{"file":"test/volumes-create-name.test.js","type":"ADDED","insertions":147,"deletions":0},{"file":"test/volumes-create-validation.test.js","type":"ADDED","insertions":176,"deletions":0},{"file":"test/volumes-get.test.js","type":"ADDED","insertions":59,"deletions":0},{"file":"test/volumes-list-params-validation.test.js","type":"ADDED","insertions":533,"deletions":0},{"file":"test/volumes-list-predicate-validation.test.js","type":"ADDED","insertions":210,"deletions":0},{"file":"test/volumes-list-sizes.test.js","type":"ADDED","insertions":116,"deletions":0},{"file":"test/volumes-no-fabric-network.test.js","type":"ADDED","insertions":113,"deletions":0},{"file":"test/volumes-size.test.js","type":"ADDED","insertions":229,"deletions":0},{"file":"test/volumes-update-name.test.js","type":"ADDED","insertions":166,"deletions":0},{"file":"test/volumes.unavailable-size.test.js","type":"ADDED","insertions":122,"deletions":0}],"sizeInsertions":4704,"sizeDeletions":-1096},{"number":"2","revision":"60865678dcc4dfe8095bca530fd4086dfa107827","parents":["85b34ed42d683ffc0e2f17d0a7ca32535ce4de7d"],"ref":"refs/changes/28/2528/2","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1505230415,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1505230451,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":28,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"etc/cloudapi.coal.cfg","type":"DELETED","insertions":0,"deletions":-184},{"file":"lib/app.js","type":"MODIFIED","insertions":34,"deletions":-13},{"file":"lib/config.js","type":"MODIFIED","insertions":80,"deletions":-140},{"file":"lib/endpoints/config.js","type":"ADDED","insertions":165,"deletions":0},{"file":"lib/endpoints/networks.js","type":"ADDED","insertions":605,"deletions":0},{"file":"lib/endpoints/volumes.js","type":"ADDED","insertions":737,"deletions":0},{"file":"lib/errors.js","type":"MODIFIED","insertions":49,"deletions":-2},{"file":"lib/machines.js","type":"MODIFIED","insertions":35,"deletions":-2},{"file":"lib/middlewares/networks.js","type":"ADDED","insertions":131,"deletions":0},{"file":"lib/networks.js","type":"MODIFIED","insertions":79,"deletions":-655},{"file":"lib/units.js","type":"ADDED","insertions":13,"deletions":0},{"file":"lib/validation/predicate.js","type":"ADDED","insertions":87,"deletions":0},{"file":"lib/validation/volumes.js","type":"ADDED","insertions":197,"deletions":0},{"file":"main.js","type":"MODIFIED","insertions":6,"deletions":-57},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"sapi_manifests/cloudapi/template","type":"MODIFIED","insertions":13,"deletions":-2},{"file":"test/auth.test.js","type":"MODIFIED","insertions":4,"deletions":0},{"file":"test/common.js","type":"MODIFIED","insertions":27,"deletions":-2},{"file":"test/fabrics.test.js","type":"MODIFIED","insertions":5,"deletions":-36},{"file":"test/keys.test.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/lib/config.js","type":"ADDED","insertions":46,"deletions":0},{"file":"test/lib/networks.js","type":"ADDED","insertions":43,"deletions":0},{"file":"test/lib/volumes.js","type":"ADDED","insertions":84,"deletions":0},{"file":"test/nics.test.js","type":"MODIFIED","insertions":50,"deletions":0},{"file":"test/volumes-basic.test.js","type":"ADDED","insertions":334,"deletions":0},{"file":"test/volumes-create-name.test.js","type":"ADDED","insertions":147,"deletions":0},{"file":"test/volumes-create-validation.test.js","type":"ADDED","insertions":176,"deletions":0},{"file":"test/volumes-get.test.js","type":"ADDED","insertions":59,"deletions":0},{"file":"test/volumes-list-params-validation.test.js","type":"ADDED","insertions":533,"deletions":0},{"file":"test/volumes-list-predicate-validation.test.js","type":"ADDED","insertions":210,"deletions":0},{"file":"test/volumes-list-sizes.test.js","type":"ADDED","insertions":116,"deletions":0},{"file":"test/volumes-no-fabric-network.test.js","type":"ADDED","insertions":113,"deletions":0},{"file":"test/volumes-size.test.js","type":"ADDED","insertions":229,"deletions":0},{"file":"test/volumes-update-name.test.js","type":"ADDED","insertions":166,"deletions":0},{"file":"test/volumes.unavailable-size.test.js","type":"ADDED","insertions":122,"deletions":0}],"sizeInsertions":4704,"sizeDeletions":-1096},{"number":"3","revision":"dd069c1df76b73e0d2f4edef5391f7bdc41904d2","parents":["58a6b8c801f3626fb958acdd0f8c7e586ca0d741"],"ref":"refs/changes/28/2528/3","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1505252277,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1505252312,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":28,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"etc/cloudapi.coal.cfg","type":"DELETED","insertions":0,"deletions":-184},{"file":"lib/app.js","type":"MODIFIED","insertions":34,"deletions":-13},{"file":"lib/config.js","type":"MODIFIED","insertions":80,"deletions":-140},{"file":"lib/endpoints/config.js","type":"ADDED","insertions":165,"deletions":0},{"file":"lib/endpoints/networks.js","type":"ADDED","insertions":605,"deletions":0},{"file":"lib/endpoints/volumes.js","type":"ADDED","insertions":737,"deletions":0},{"file":"lib/errors.js","type":"MODIFIED","insertions":49,"deletions":-2},{"file":"lib/machines.js","type":"MODIFIED","insertions":35,"deletions":-2},{"file":"lib/middlewares/networks.js","type":"ADDED","insertions":131,"deletions":0},{"file":"lib/networks.js","type":"MODIFIED","insertions":79,"deletions":-655},{"file":"lib/units.js","type":"ADDED","insertions":13,"deletions":0},{"file":"lib/validation/predicate.js","type":"ADDED","insertions":87,"deletions":0},{"file":"lib/validation/volumes.js","type":"ADDED","insertions":197,"deletions":0},{"file":"main.js","type":"MODIFIED","insertions":6,"deletions":-57},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"sapi_manifests/cloudapi/template","type":"MODIFIED","insertions":13,"deletions":-2},{"file":"test/auth.test.js","type":"MODIFIED","insertions":4,"deletions":0},{"file":"test/common.js","type":"MODIFIED","insertions":32,"deletions":-2},{"file":"test/fabrics.test.js","type":"MODIFIED","insertions":5,"deletions":-36},{"file":"test/keys.test.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/lib/config.js","type":"ADDED","insertions":46,"deletions":0},{"file":"test/lib/networks.js","type":"ADDED","insertions":43,"deletions":0},{"file":"test/lib/volumes.js","type":"ADDED","insertions":84,"deletions":0},{"file":"test/nics.test.js","type":"MODIFIED","insertions":50,"deletions":0},{"file":"test/volumes-basic.test.js","type":"ADDED","insertions":334,"deletions":0},{"file":"test/volumes-create-name.test.js","type":"ADDED","insertions":147,"deletions":0},{"file":"test/volumes-create-validation.test.js","type":"ADDED","insertions":176,"deletions":0},{"file":"test/volumes-get.test.js","type":"ADDED","insertions":59,"deletions":0},{"file":"test/volumes-list-params-validation.test.js","type":"ADDED","insertions":533,"deletions":0},{"file":"test/volumes-list-predicate-validation.test.js","type":"ADDED","insertions":210,"deletions":0},{"file":"test/volumes-list-sizes.test.js","type":"ADDED","insertions":116,"deletions":0},{"file":"test/volumes-no-fabric-network.test.js","type":"ADDED","insertions":113,"deletions":0},{"file":"test/volumes-size.test.js","type":"ADDED","insertions":229,"deletions":0},{"file":"test/volumes-update-name.test.js","type":"ADDED","insertions":166,"deletions":0},{"file":"test/volumes.unavailable-size.test.js","type":"ADDED","insertions":122,"deletions":0}],"sizeInsertions":4709,"sizeDeletions":-1096},{"number":"4","revision":"278d074edaf94094125070d9735d7a8974d7428f","parents":["1c405e141d0362c6d805ec47b6125696c2115fc1"],"ref":"refs/changes/28/2528/4","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1505252452,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1505252312,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":28,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"etc/cloudapi.coal.cfg","type":"DELETED","insertions":0,"deletions":-184},{"file":"lib/app.js","type":"MODIFIED","insertions":34,"deletions":-13},{"file":"lib/config.js","type":"MODIFIED","insertions":80,"deletions":-140},{"file":"lib/endpoints/config.js","type":"ADDED","insertions":165,"deletions":0},{"file":"lib/endpoints/networks.js","type":"ADDED","insertions":605,"deletions":0},{"file":"lib/endpoints/volumes.js","type":"ADDED","insertions":737,"deletions":0},{"file":"lib/errors.js","type":"MODIFIED","insertions":49,"deletions":-2},{"file":"lib/machines.js","type":"MODIFIED","insertions":35,"deletions":-2},{"file":"lib/middlewares/networks.js","type":"ADDED","insertions":131,"deletions":0},{"file":"lib/networks.js","type":"MODIFIED","insertions":79,"deletions":-655},{"file":"lib/units.js","type":"ADDED","insertions":13,"deletions":0},{"file":"lib/validation/predicate.js","type":"ADDED","insertions":87,"deletions":0},{"file":"lib/validation/volumes.js","type":"ADDED","insertions":197,"deletions":0},{"file":"main.js","type":"MODIFIED","insertions":6,"deletions":-57},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"sapi_manifests/cloudapi/template","type":"MODIFIED","insertions":13,"deletions":-2},{"file":"test/auth.test.js","type":"MODIFIED","insertions":4,"deletions":0},{"file":"test/common.js","type":"MODIFIED","insertions":32,"deletions":-2},{"file":"test/fabrics.test.js","type":"MODIFIED","insertions":5,"deletions":-36},{"file":"test/keys.test.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/lib/config.js","type":"ADDED","insertions":46,"deletions":0},{"file":"test/lib/networks.js","type":"ADDED","insertions":43,"deletions":0},{"file":"test/lib/volumes.js","type":"ADDED","insertions":84,"deletions":0},{"file":"test/nics.test.js","type":"MODIFIED","insertions":50,"deletions":0},{"file":"test/volumes-basic.test.js","type":"ADDED","insertions":334,"deletions":0},{"file":"test/volumes-create-name.test.js","type":"ADDED","insertions":147,"deletions":0},{"file":"test/volumes-create-validation.test.js","type":"ADDED","insertions":176,"deletions":0},{"file":"test/volumes-get.test.js","type":"ADDED","insertions":59,"deletions":0},{"file":"test/volumes-list-params-validation.test.js","type":"ADDED","insertions":533,"deletions":0},{"file":"test/volumes-list-predicate-validation.test.js","type":"ADDED","insertions":210,"deletions":0},{"file":"test/volumes-list-sizes.test.js","type":"ADDED","insertions":116,"deletions":0},{"file":"test/volumes-no-fabric-network.test.js","type":"ADDED","insertions":113,"deletions":0},{"file":"test/volumes-size.test.js","type":"ADDED","insertions":229,"deletions":0},{"file":"test/volumes-update-name.test.js","type":"ADDED","insertions":166,"deletions":0},{"file":"test/volumes.unavailable-size.test.js","type":"ADDED","insertions":122,"deletions":0}],"sizeInsertions":4709,"sizeDeletions":-1096},{"number":"5","revision":"469f8639ed449a9973069bf9dcebfa4ffeafe70a","parents":["1c405e141d0362c6d805ec47b6125696c2115fc1"],"ref":"refs/changes/28/2528/5","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1506384286,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1506384324,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":29,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"etc/cloudapi.coal.cfg","type":"DELETED","insertions":0,"deletions":-184},{"file":"lib/app.js","type":"MODIFIED","insertions":34,"deletions":-13},{"file":"lib/config.js","type":"MODIFIED","insertions":80,"deletions":-140},{"file":"lib/endpoints/config.js","type":"ADDED","insertions":165,"deletions":0},{"file":"lib/endpoints/networks.js","type":"ADDED","insertions":605,"deletions":0},{"file":"lib/endpoints/volumes.js","type":"ADDED","insertions":737,"deletions":0},{"file":"lib/errors.js","type":"MODIFIED","insertions":49,"deletions":-2},{"file":"lib/machines.js","type":"MODIFIED","insertions":148,"deletions":-2},{"file":"lib/middlewares/networks.js","type":"ADDED","insertions":131,"deletions":0},{"file":"lib/networks.js","type":"MODIFIED","insertions":79,"deletions":-655},{"file":"lib/units.js","type":"ADDED","insertions":13,"deletions":0},{"file":"lib/validation/predicate.js","type":"ADDED","insertions":87,"deletions":0},{"file":"lib/validation/volumes.js","type":"ADDED","insertions":197,"deletions":0},{"file":"main.js","type":"MODIFIED","insertions":6,"deletions":-57},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"sapi_manifests/cloudapi/template","type":"MODIFIED","insertions":16,"deletions":-2},{"file":"test/auth.test.js","type":"MODIFIED","insertions":4,"deletions":0},{"file":"test/common.js","type":"MODIFIED","insertions":32,"deletions":-2},{"file":"test/fabrics.test.js","type":"MODIFIED","insertions":5,"deletions":-36},{"file":"test/keys.test.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/lib/config.js","type":"ADDED","insertions":46,"deletions":0},{"file":"test/lib/networks.js","type":"ADDED","insertions":43,"deletions":0},{"file":"test/lib/volumes.js","type":"ADDED","insertions":84,"deletions":0},{"file":"test/nics.test.js","type":"MODIFIED","insertions":50,"deletions":0},{"file":"test/volumes-automount.test.js","type":"ADDED","insertions":670,"deletions":0},{"file":"test/volumes-basic.test.js","type":"ADDED","insertions":334,"deletions":0},{"file":"test/volumes-create-name.test.js","type":"ADDED","insertions":147,"deletions":0},{"file":"test/volumes-create-validation.test.js","type":"ADDED","insertions":176,"deletions":0},{"file":"test/volumes-get.test.js","type":"ADDED","insertions":59,"deletions":0},{"file":"test/volumes-list-params-validation.test.js","type":"ADDED","insertions":533,"deletions":0},{"file":"test/volumes-list-predicate-validation.test.js","type":"ADDED","insertions":210,"deletions":0},{"file":"test/volumes-list-sizes.test.js","type":"ADDED","insertions":116,"deletions":0},{"file":"test/volumes-no-fabric-network.test.js","type":"ADDED","insertions":113,"deletions":0},{"file":"test/volumes-size.test.js","type":"ADDED","insertions":229,"deletions":0},{"file":"test/volumes-update-name.test.js","type":"ADDED","insertions":166,"deletions":0},{"file":"test/volumes.unavailable-size.test.js","type":"ADDED","insertions":122,"deletions":0}],"sizeInsertions":5495,"sizeDeletions":-1096},{"number":"6","revision":"9836cbfd64c4c212792220ff782b97629190b285","parents":["b74c919c43dc7504e3031340728eb2cac9c94d58"],"ref":"refs/changes/28/2528/6","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1506537143,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1506537180,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":29,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"etc/cloudapi.coal.cfg","type":"DELETED","insertions":0,"deletions":-184},{"file":"lib/app.js","type":"MODIFIED","insertions":33,"deletions":-12},{"file":"lib/config.js","type":"MODIFIED","insertions":80,"deletions":-140},{"file":"lib/endpoints/config.js","type":"ADDED","insertions":165,"deletions":0},{"file":"lib/endpoints/networks.js","type":"ADDED","insertions":605,"deletions":0},{"file":"lib/endpoints/volumes.js","type":"ADDED","insertions":737,"deletions":0},{"file":"lib/errors.js","type":"MODIFIED","insertions":48,"deletions":-1},{"file":"lib/machines.js","type":"MODIFIED","insertions":148,"deletions":-2},{"file":"lib/middlewares/networks.js","type":"ADDED","insertions":131,"deletions":0},{"file":"lib/networks.js","type":"MODIFIED","insertions":79,"deletions":-655},{"file":"lib/units.js","type":"ADDED","insertions":13,"deletions":0},{"file":"lib/validation/predicate.js","type":"ADDED","insertions":87,"deletions":0},{"file":"lib/validation/volumes.js","type":"ADDED","insertions":197,"deletions":0},{"file":"main.js","type":"MODIFIED","insertions":6,"deletions":-57},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"sapi_manifests/cloudapi/template","type":"MODIFIED","insertions":16,"deletions":-2},{"file":"test/auth.test.js","type":"MODIFIED","insertions":4,"deletions":0},{"file":"test/common.js","type":"MODIFIED","insertions":32,"deletions":-2},{"file":"test/fabrics.test.js","type":"MODIFIED","insertions":5,"deletions":-36},{"file":"test/keys.test.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/lib/config.js","type":"ADDED","insertions":46,"deletions":0},{"file":"test/lib/networks.js","type":"ADDED","insertions":43,"deletions":0},{"file":"test/lib/volumes.js","type":"ADDED","insertions":84,"deletions":0},{"file":"test/nics.test.js","type":"MODIFIED","insertions":50,"deletions":0},{"file":"test/volumes-automount.test.js","type":"ADDED","insertions":670,"deletions":0},{"file":"test/volumes-basic.test.js","type":"ADDED","insertions":334,"deletions":0},{"file":"test/volumes-create-name.test.js","type":"ADDED","insertions":147,"deletions":0},{"file":"test/volumes-create-validation.test.js","type":"ADDED","insertions":176,"deletions":0},{"file":"test/volumes-get.test.js","type":"ADDED","insertions":59,"deletions":0},{"file":"test/volumes-list-params-validation.test.js","type":"ADDED","insertions":533,"deletions":0},{"file":"test/volumes-list-predicate-validation.test.js","type":"ADDED","insertions":210,"deletions":0},{"file":"test/volumes-list-sizes.test.js","type":"ADDED","insertions":116,"deletions":0},{"file":"test/volumes-no-fabric-network.test.js","type":"ADDED","insertions":113,"deletions":0},{"file":"test/volumes-size.test.js","type":"ADDED","insertions":229,"deletions":0},{"file":"test/volumes-update-name.test.js","type":"ADDED","insertions":166,"deletions":0},{"file":"test/volumes.unavailable-size.test.js","type":"ADDED","insertions":122,"deletions":0}],"sizeInsertions":5493,"sizeDeletions":-1094},{"number":"7","revision":"b4e2e160f5553a2f1cefd0a361cd8b74ec20c685","parents":["5aeaa78c0204df410b3bd33ce3811da9a7cc8c0f"],"ref":"refs/changes/28/2528/7","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1506983624,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1506983655,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":29,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"etc/cloudapi.coal.cfg","type":"DELETED","insertions":0,"deletions":-184},{"file":"lib/app.js","type":"MODIFIED","insertions":32,"deletions":-12},{"file":"lib/config.js","type":"MODIFIED","insertions":80,"deletions":-140},{"file":"lib/endpoints/config.js","type":"ADDED","insertions":165,"deletions":0},{"file":"lib/endpoints/networks.js","type":"ADDED","insertions":606,"deletions":0},{"file":"lib/endpoints/volumes.js","type":"ADDED","insertions":737,"deletions":0},{"file":"lib/errors.js","type":"MODIFIED","insertions":48,"deletions":-1},{"file":"lib/machines.js","type":"MODIFIED","insertions":148,"deletions":-2},{"file":"lib/middlewares/networks.js","type":"ADDED","insertions":134,"deletions":0},{"file":"lib/networks.js","type":"MODIFIED","insertions":78,"deletions":-655},{"file":"lib/units.js","type":"ADDED","insertions":13,"deletions":0},{"file":"lib/validation/predicate.js","type":"ADDED","insertions":87,"deletions":0},{"file":"lib/validation/volumes.js","type":"ADDED","insertions":197,"deletions":0},{"file":"main.js","type":"MODIFIED","insertions":6,"deletions":-57},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"sapi_manifests/cloudapi/template","type":"MODIFIED","insertions":16,"deletions":-2},{"file":"test/auth.test.js","type":"MODIFIED","insertions":4,"deletions":0},{"file":"test/common.js","type":"MODIFIED","insertions":32,"deletions":-2},{"file":"test/fabrics.test.js","type":"MODIFIED","insertions":5,"deletions":-36},{"file":"test/keys.test.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/lib/config.js","type":"ADDED","insertions":46,"deletions":0},{"file":"test/lib/networks.js","type":"ADDED","insertions":43,"deletions":0},{"file":"test/lib/volumes.js","type":"ADDED","insertions":84,"deletions":0},{"file":"test/nics.test.js","type":"MODIFIED","insertions":50,"deletions":0},{"file":"test/volumes-automount.test.js","type":"ADDED","insertions":670,"deletions":0},{"file":"test/volumes-basic.test.js","type":"ADDED","insertions":334,"deletions":0},{"file":"test/volumes-create-name.test.js","type":"ADDED","insertions":147,"deletions":0},{"file":"test/volumes-create-validation.test.js","type":"ADDED","insertions":176,"deletions":0},{"file":"test/volumes-get.test.js","type":"ADDED","insertions":59,"deletions":0},{"file":"test/volumes-list-params-validation.test.js","type":"ADDED","insertions":533,"deletions":0},{"file":"test/volumes-list-predicate-validation.test.js","type":"ADDED","insertions":210,"deletions":0},{"file":"test/volumes-list-sizes.test.js","type":"ADDED","insertions":116,"deletions":0},{"file":"test/volumes-no-fabric-network.test.js","type":"ADDED","insertions":113,"deletions":0},{"file":"test/volumes-size.test.js","type":"ADDED","insertions":229,"deletions":0},{"file":"test/volumes-update-name.test.js","type":"ADDED","insertions":166,"deletions":0},{"file":"test/volumes.unavailable-size.test.js","type":"ADDED","insertions":122,"deletions":0}],"sizeInsertions":5495,"sizeDeletions":-1094},{"number":"8","revision":"8c261d805d1be483cd83d25269f6027a3a5ed814","parents":["5aeaa78c0204df410b3bd33ce3811da9a7cc8c0f"],"ref":"refs/changes/28/2528/8","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1506983833,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1506983869,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":29,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"etc/cloudapi.coal.cfg","type":"DELETED","insertions":0,"deletions":-184},{"file":"lib/app.js","type":"MODIFIED","insertions":32,"deletions":-12},{"file":"lib/config.js","type":"MODIFIED","insertions":80,"deletions":-140},{"file":"lib/endpoints/config.js","type":"ADDED","insertions":165,"deletions":0},{"file":"lib/endpoints/networks.js","type":"ADDED","insertions":606,"deletions":0},{"file":"lib/endpoints/volumes.js","type":"ADDED","insertions":737,"deletions":0},{"file":"lib/errors.js","type":"MODIFIED","insertions":48,"deletions":-1},{"file":"lib/machines.js","type":"MODIFIED","insertions":148,"deletions":-2},{"file":"lib/middlewares/networks.js","type":"ADDED","insertions":134,"deletions":0},{"file":"lib/networks.js","type":"MODIFIED","insertions":78,"deletions":-655},{"file":"lib/units.js","type":"ADDED","insertions":13,"deletions":0},{"file":"lib/validation/predicate.js","type":"ADDED","insertions":87,"deletions":0},{"file":"lib/validation/volumes.js","type":"ADDED","insertions":197,"deletions":0},{"file":"main.js","type":"MODIFIED","insertions":6,"deletions":-57},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"sapi_manifests/cloudapi/template","type":"MODIFIED","insertions":16,"deletions":-2},{"file":"test/auth.test.js","type":"MODIFIED","insertions":4,"deletions":0},{"file":"test/common.js","type":"MODIFIED","insertions":32,"deletions":-2},{"file":"test/fabrics.test.js","type":"MODIFIED","insertions":5,"deletions":-36},{"file":"test/keys.test.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/lib/config.js","type":"ADDED","insertions":46,"deletions":0},{"file":"test/lib/networks.js","type":"ADDED","insertions":43,"deletions":0},{"file":"test/lib/volumes.js","type":"ADDED","insertions":84,"deletions":0},{"file":"test/nics.test.js","type":"MODIFIED","insertions":50,"deletions":0},{"file":"test/volumes-automount.test.js","type":"ADDED","insertions":695,"deletions":0},{"file":"test/volumes-basic.test.js","type":"ADDED","insertions":334,"deletions":0},{"file":"test/volumes-create-name.test.js","type":"ADDED","insertions":147,"deletions":0},{"file":"test/volumes-create-validation.test.js","type":"ADDED","insertions":176,"deletions":0},{"file":"test/volumes-get.test.js","type":"ADDED","insertions":59,"deletions":0},{"file":"test/volumes-list-params-validation.test.js","type":"ADDED","insertions":533,"deletions":0},{"file":"test/volumes-list-predicate-validation.test.js","type":"ADDED","insertions":210,"deletions":0},{"file":"test/volumes-list-sizes.test.js","type":"ADDED","insertions":116,"deletions":0},{"file":"test/volumes-no-fabric-network.test.js","type":"ADDED","insertions":113,"deletions":0},{"file":"test/volumes-size.test.js","type":"ADDED","insertions":229,"deletions":0},{"file":"test/volumes-update-name.test.js","type":"ADDED","insertions":166,"deletions":0},{"file":"test/volumes.unavailable-size.test.js","type":"ADDED","insertions":122,"deletions":0}],"sizeInsertions":5520,"sizeDeletions":-1094},{"number":"9","revision":"34280ea517e6611798986ee361a78501024424fd","parents":["f22cf71e89d96ba40f57eb08d7fef718b0c969fc"],"ref":"refs/changes/28/2528/9","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1507312089,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1507312124,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":29,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"etc/cloudapi.coal.cfg","type":"DELETED","insertions":0,"deletions":-184},{"file":"lib/app.js","type":"MODIFIED","insertions":26,"deletions":-8},{"file":"lib/endpoints/volumes.js","type":"ADDED","insertions":737,"deletions":0},{"file":"lib/errors.js","type":"MODIFIED","insertions":48,"deletions":-1},{"file":"lib/machines.js","type":"MODIFIED","insertions":148,"deletions":-2},{"file":"lib/middlewares/networks.js","type":"ADDED","insertions":134,"deletions":0},{"file":"lib/units.js","type":"ADDED","insertions":13,"deletions":0},{"file":"lib/validation/predicate.js","type":"ADDED","insertions":87,"deletions":0},{"file":"lib/validation/volumes.js","type":"ADDED","insertions":197,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"sapi_manifests/cloudapi/template","type":"MODIFIED","insertions":16,"deletions":-2},{"file":"test/auth.test.js","type":"MODIFIED","insertions":4,"deletions":0},{"file":"test/common.js","type":"MODIFIED","insertions":32,"deletions":-2},{"file":"test/fabrics.test.js","type":"MODIFIED","insertions":5,"deletions":-36},{"file":"test/keys.test.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/lib/config.js","type":"ADDED","insertions":46,"deletions":0},{"file":"test/lib/networks.js","type":"ADDED","insertions":43,"deletions":0},{"file":"test/lib/volumes.js","type":"ADDED","insertions":84,"deletions":0},{"file":"test/nics.test.js","type":"MODIFIED","insertions":50,"deletions":0},{"file":"test/volumes-automount.test.js","type":"ADDED","insertions":695,"deletions":0},{"file":"test/volumes-basic.test.js","type":"ADDED","insertions":334,"deletions":0},{"file":"test/volumes-create-name.test.js","type":"ADDED","insertions":147,"deletions":0},{"file":"test/volumes-create-validation.test.js","type":"ADDED","insertions":176,"deletions":0},{"file":"test/volumes-get.test.js","type":"ADDED","insertions":59,"deletions":0},{"file":"test/volumes-list-params-validation.test.js","type":"ADDED","insertions":533,"deletions":0},{"file":"test/volumes-list-predicate-validation.test.js","type":"ADDED","insertions":210,"deletions":0},{"file":"test/volumes-list-sizes.test.js","type":"ADDED","insertions":116,"deletions":0},{"file":"test/volumes-no-fabric-network.test.js","type":"ADDED","insertions":113,"deletions":0},{"file":"test/volumes-size.test.js","type":"ADDED","insertions":229,"deletions":0},{"file":"test/volumes-update-name.test.js","type":"ADDED","insertions":166,"deletions":0},{"file":"test/volumes.unavailable-size.test.js","type":"ADDED","insertions":122,"deletions":0}],"sizeInsertions":4579,"sizeDeletions":-238},{"number":"10","revision":"6908d2d0b932e92851d4a01784714300bda3c64e","parents":["f22cf71e89d96ba40f57eb08d7fef718b0c969fc"],"ref":"refs/changes/28/2528/10","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1507312190,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1507312227,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":29,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"etc/cloudapi.coal.cfg","type":"DELETED","insertions":0,"deletions":-184},{"file":"lib/app.js","type":"MODIFIED","insertions":26,"deletions":-8},{"file":"lib/endpoints/networks.js","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"lib/endpoints/volumes.js","type":"ADDED","insertions":737,"deletions":0},{"file":"lib/errors.js","type":"MODIFIED","insertions":48,"deletions":-1},{"file":"lib/machines.js","type":"MODIFIED","insertions":148,"deletions":-2},{"file":"lib/middlewares/networks.js","type":"ADDED","insertions":134,"deletions":0},{"file":"lib/units.js","type":"ADDED","insertions":13,"deletions":0},{"file":"lib/validation/predicate.js","type":"ADDED","insertions":87,"deletions":0},{"file":"lib/validation/volumes.js","type":"ADDED","insertions":197,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"sapi_manifests/cloudapi/template","type":"MODIFIED","insertions":16,"deletions":-2},{"file":"test/auth.test.js","type":"MODIFIED","insertions":4,"deletions":0},{"file":"test/common.js","type":"MODIFIED","insertions":32,"deletions":-2},{"file":"test/fabrics.test.js","type":"MODIFIED","insertions":5,"deletions":-36},{"file":"test/keys.test.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/lib/config.js","type":"ADDED","insertions":46,"deletions":0},{"file":"test/lib/networks.js","type":"ADDED","insertions":43,"deletions":0},{"file":"test/lib/volumes.js","type":"ADDED","insertions":84,"deletions":0},{"file":"test/nics.test.js","type":"MODIFIED","insertions":50,"deletions":0},{"file":"test/volumes-automount.test.js","type":"ADDED","insertions":695,"deletions":0},{"file":"test/volumes-basic.test.js","type":"ADDED","insertions":334,"deletions":0},{"file":"test/volumes-create-name.test.js","type":"ADDED","insertions":147,"deletions":0},{"file":"test/volumes-create-validation.test.js","type":"ADDED","insertions":176,"deletions":0},{"file":"test/volumes-get.test.js","type":"ADDED","insertions":59,"deletions":0},{"file":"test/volumes-list-params-validation.test.js","type":"ADDED","insertions":533,"deletions":0},{"file":"test/volumes-list-predicate-validation.test.js","type":"ADDED","insertions":210,"deletions":0},{"file":"test/volumes-list-sizes.test.js","type":"ADDED","insertions":116,"deletions":0},{"file":"test/volumes-no-fabric-network.test.js","type":"ADDED","insertions":113,"deletions":0},{"file":"test/volumes-size.test.js","type":"ADDED","insertions":229,"deletions":0},{"file":"test/volumes-update-name.test.js","type":"ADDED","insertions":166,"deletions":0},{"file":"test/volumes.unavailable-size.test.js","type":"ADDED","insertions":122,"deletions":0}],"sizeInsertions":4581,"sizeDeletions":-241},{"number":"11","revision":"1fba68ea060be2a43ad5f8e800bcdd6785a2df7d","parents":["f22cf71e89d96ba40f57eb08d7fef718b0c969fc"],"ref":"refs/changes/28/2528/11","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1507331677,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1507331721,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1507735130,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"comments":[{"file":"lib/endpoints/networks.js","line":473,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"How bad would be the alternate approach? i.e. modify the function to just call return after the callbacks invocation?"},{"file":"lib/endpoints/networks.js","line":473,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"The problem is that for some reason, what\u0027s in master wasn\u0027t and isn\u0027t flagged as an error by the linter, but is when I run make check on this CR.\n\nThe error is that this function \"does not always return a value\", which is true.\n\nSo I\u0027ll leave it as it is in this CR for now, and then we can refactor that later when we agree on a style."},{"file":"lib/endpoints/networks.js","line":473,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Sounds good."},{"file":"lib/endpoints/volumes.js","line":157,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Maybe it has sense to loop over these properties and avoid duplication?"},{"file":"lib/endpoints/volumes.js","line":157,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"It would definitely be worth exploring but:\n\n1. it would require changing all validations functions in this file\n\n2. the changes are not necessarily trivial\n\nAt this point of the integration process, I\u0027d like to keep changes made to this CR to a minimum, and make changes only for design issues.\n\nDo you mind if we tackle that in another ticket?"},{"file":"lib/endpoints/volumes.js","line":157,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Definitely!"},{"file":"lib/endpoints/volumes.js","line":157,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"FWIW, filed https://devhub.joyent.com/jira/browse/PUBAPI-1449."},{"file":"lib/endpoints/volumes.js","line":290,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Not sure I follow the name of this function. Isn\u0027t it validating volume type and not size?"},{"file":"lib/endpoints/volumes.js","line":290,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"It is validating the input sent to the \"ListVolumeSizes\" endpoint. The only input parameter accepted by that endpoint is currently a \"type\" parameter."},{"file":"lib/endpoints/volumes.js","line":501,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"I think a single call to `exposedErr` at the end of this function would be enough"},{"file":"lib/endpoints/volumes.js","line":501,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Absolutely, will fix!"},{"file":"lib/endpoints/volumes.js","line":574,"reviewer":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},"message":"Ditto, I think the `next + return` lines at the end of the `if` block can be safely removed"},{"file":"lib/endpoints/volumes.js","line":574,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Will fix too!"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":30,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"etc/cloudapi.coal.cfg","type":"DELETED","insertions":0,"deletions":-184},{"file":"lib/app.js","type":"MODIFIED","insertions":26,"deletions":-8},{"file":"lib/endpoints/networks.js","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"lib/endpoints/volumes.js","type":"ADDED","insertions":737,"deletions":0},{"file":"lib/errors.js","type":"MODIFIED","insertions":48,"deletions":-1},{"file":"lib/machines.js","type":"MODIFIED","insertions":148,"deletions":-2},{"file":"lib/middlewares/networks.js","type":"ADDED","insertions":134,"deletions":0},{"file":"lib/units.js","type":"ADDED","insertions":13,"deletions":0},{"file":"lib/validation/predicate.js","type":"ADDED","insertions":87,"deletions":0},{"file":"lib/validation/volumes.js","type":"ADDED","insertions":197,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"sapi_manifests/cloudapi/template","type":"MODIFIED","insertions":16,"deletions":-2},{"file":"test/auth.test.js","type":"MODIFIED","insertions":4,"deletions":0},{"file":"test/common.js","type":"MODIFIED","insertions":32,"deletions":-2},{"file":"test/fabrics.test.js","type":"MODIFIED","insertions":5,"deletions":-36},{"file":"test/keys.test.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/lib/config.js","type":"ADDED","insertions":46,"deletions":0},{"file":"test/lib/networks.js","type":"ADDED","insertions":43,"deletions":0},{"file":"test/lib/volumes.js","type":"ADDED","insertions":84,"deletions":0},{"file":"test/nics.test.js","type":"MODIFIED","insertions":50,"deletions":0},{"file":"test/volumes-automount.test.js","type":"ADDED","insertions":695,"deletions":0},{"file":"test/volumes-basic.test.js","type":"ADDED","insertions":338,"deletions":0},{"file":"test/volumes-create-name.test.js","type":"ADDED","insertions":147,"deletions":0},{"file":"test/volumes-create-validation.test.js","type":"ADDED","insertions":176,"deletions":0},{"file":"test/volumes-get.test.js","type":"ADDED","insertions":59,"deletions":0},{"file":"test/volumes-list-params-validation.test.js","type":"ADDED","insertions":533,"deletions":0},{"file":"test/volumes-list-predicate-validation.test.js","type":"ADDED","insertions":210,"deletions":0},{"file":"test/volumes-list-sizes.test.js","type":"ADDED","insertions":116,"deletions":0},{"file":"test/volumes-no-fabric-network.test.js","type":"ADDED","insertions":113,"deletions":0},{"file":"test/volumes-size.test.js","type":"ADDED","insertions":229,"deletions":0},{"file":"test/volumes-update-name.test.js","type":"ADDED","insertions":166,"deletions":0},{"file":"test/volumes.unavailable-size.test.js","type":"ADDED","insertions":122,"deletions":0}],"sizeInsertions":4585,"sizeDeletions":-241},{"number":"12","revision":"667440771068e118af23c70dc52a259e8186c176","parents":["f22cf71e89d96ba40f57eb08d7fef718b0c969fc"],"ref":"refs/changes/28/2528/12","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1507832630,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1507832672,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1508085618,"by":{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"}}],"comments":[{"file":"Makefile","line":8,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"2017"},{"file":"lib/app.js","line":189,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"I think this would be more robust by checking whether there is a options.volapi; there seems to be a bit of conflation of concerns here."},{"file":"lib/app.js","line":189,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"That makes sense, will fix! I was thinking of moving the \"if (options.volapi) {}\" check to the \"createClients\" function instead of the \"createHTTPClients\" function, would that work for you?"},{"file":"lib/app.js","line":671,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"I think this is fine, but it could also be replaced with an options.volapi check."},{"file":"lib/app.js","line":671,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"I agree that this would be equivalent, at least for now, but I prefer this check to be explicitly about a feature flag that conveys whether support for NFS volumes is enabled.\n\nSo if you don\u0027t have a strong opinion about it I\u0027ll leave it as is."},{"file":"lib/endpoints/volumes.js","line":10,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"We don\u0027t have enough big-theory statements and the like in cloudapi. I think having a paragraph or two here about volumes and volapi might be nice.\n\nEntirely optional."},{"file":"lib/endpoints/volumes.js","line":10,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Done"},{"file":"lib/endpoints/volumes.js","line":42,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"This for() block seems like it\u0027d be a better fit for map/filter. E.g.\n\nvar errs \u003d Object.keys(params).filter(function ignoreValid(paramName) {\n    return validParamNames.indexOf(paramName) \u003d\u003d\u003d -1;\n}.map(function makeError(paramName) {\n    return new Error(\u0027invalid parameter: \u0027 + paramName);\n});\n\n...although that looks ugly. Huh.\n\nUnrelatedly, Javascript could use an identity function."},{"file":"lib/endpoints/volumes.js","line":42,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"If you don\u0027t a have strong opinion about either one of these styles, I\u0027ll just keep it as is."},{"file":"lib/endpoints/volumes.js","line":54,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"The whole dance with validationErrs seems unnecessary.\n\nif latestErr, then return next([latestErr])"},{"file":"lib/endpoints/volumes.js","line":54,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Done"},{"file":"lib/endpoints/volumes.js","line":90,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"I\u0027d move the var here."},{"file":"lib/endpoints/volumes.js","line":90,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"I tend to declare variables at the top of functions scopes, since that\u0027s really what their scope is.\n\nI find declaring them where they\u0027re first used leads to errors and confusion, because what\u0027s written does not reflect what happens at run time. \n\nHowever, if you feel strongly about it I\u0027m fine declaring that variable here."},{"file":"lib/endpoints/volumes.js","line":122,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Hoist out?"},{"file":"lib/endpoints/volumes.js","line":122,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"This array is specific to validating the input parameters of the ListVolumes endpoint, so it seems logical to define it here. It\u0027s also not used anywhere else."},{"file":"lib/endpoints/volumes.js","line":122,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Maybe I\u0027m old-skool in thinking these things should be at the top. It adds unnecessary extra work for every function invocation... not that cloudapi is performance software.\n\nIn any case, I can\u0027t think of a strong argument."},{"file":"lib/endpoints/volumes.js","line":262,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"You could save several lines of code by eliminating the conditionals and always pushing latestErr, then filtering before returning. While it\u0027s an atypical approach, it\u0027d make the code a less noisy.\n\nThis would work with validateListVolumesInput() too."},{"file":"lib/endpoints/volumes.js","line":262,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"I agree with that. Pedro posted the same concerns. I\u0027d like to take care of this in a follow-up ticket if you don\u0027t mind, which I filed at https://devhub.joyent.com/jira/browse/PUBAPI-1449."},{"file":"lib/endpoints/volumes.js","line":359,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Maybe define this outside the vasync.pipeline(). You\u0027re really fighting for indentation here, so one extra one will really help."},{"file":"lib/endpoints/volumes.js","line":359,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"I agree that this makes the space a bit tight, but I like to be able to read a vasync pipeline from top to bottom, instead of jumping from a list of functions passed to vasync.pipeline and the respective functions\u0027 code.\n\nSo if you don\u0027t feel too strongly about this I\u0027d like to keep it this way for now. I\u0027d definitely use the approach you\u0027re suggesting if the cost outweighs the benefits though."},{"file":"lib/endpoints/volumes.js","line":359,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Functions in a higher scope can still be in order.\n\nBut no, I don\u0027t feel strongly about it."},{"file":"lib/endpoints/volumes.js","line":376,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"There\u0027s a lot of indentation here. This isn\u0027t helping.\n\nI think you should add a return to the above done(), toss the \"else\" and reduce one level of indentation."},{"file":"lib/endpoints/volumes.js","line":376,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Good point, done!"},{"file":"lib/endpoints/volumes.js","line":449,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"Is this value guaranteed to always be set? Does it make sense to test for the length of operations/existence of this value?"},{"file":"lib/endpoints/volumes.js","line":449,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Good point, it is definitely not clear. I changed that code a bit to make it easier to read, and to assert the presence of the data we\u0027re sending."},{"file":"lib/endpoints/volumes.js","line":512,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"extra space"},{"file":"lib/endpoints/volumes.js","line":512,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Done"},{"file":"lib/endpoints/volumes.js","line":614,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"The separation between get/list/create and render and makeSendResponseHandler is interesting, but at this point I think it\u0027s becoming too ravioli.\n\nrenderVolume() has exactly one non-boilerplate line, and makeSendResponseHandler() likewise. All of this, plus the two extra lines in mountVolumesEndpoints() to replace a single res.send(200, translateVolumeFromVolApi(volume));\n\nI\u0027m dislike this approach. It\u0027s interesting, but I don\u0027t think it worked out.\n\nI like the separation of validation from get/list/etc into a previous callback. If it keeps working out, that\u0027s worth spreading to the rest of cloudapi."},{"file":"lib/endpoints/volumes.js","line":614,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Agreed, I changed all of the endpoints to do what you suggested."},{"file":"lib/errors.js","line":318,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"I am confused here. What passes assert.object() but evaluates as false?"},{"file":"lib/errors.js","line":318,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Good catch, fixed!"},{"file":"lib/errors.js","line":320,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Is this necessary given the default case in the switch clause?"},{"file":"lib/errors.js","line":320,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Done"},{"file":"lib/errors.js","line":341,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"\"not yet configured\" perhaps? In case of replication delay?"},{"file":"lib/errors.js","line":341,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Thus describes the *current* status, which is that no default network is configured.\n\nAdding \"yet\" would imply that it will be configured, and I\u0027d rather no imply anything in that error message."},{"file":"lib/machines.js","line":861,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Superfluous."},{"file":"lib/machines.js","line":861,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Done"},{"file":"lib/machines.js","line":1130,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Wait, I saw this in validation/volumes.js. Why is this check here too?\n\nFor that matter, why isn\u0027t all this new validation stuff in that file?"},{"file":"lib/machines.js","line":1130,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Removed this function and instead used the \"validateVolumeName\" function from the validation/volumes.js module."},{"file":"lib/machines.js","line":1170,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"It does?"},{"file":"lib/machines.js","line":1170,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"It does not! Fixed."},{"file":"lib/machines.js","line":1173,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"This could be hoisted out."},{"file":"lib/machines.js","line":1173,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"This array is only used here, what would be the benefit of declaring it at the top-level scope?"},{"file":"lib/machines.js","line":1173,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"A trivial improvement in performance, but since this is a cold path, eh."},{"file":"lib/machines.js","line":1211,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"I think this would be better represented as a map()."},{"file":"lib/machines.js","line":1211,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"With map, we\u0027d have to filter \"undefined\" values. I refactored it a bit to remove the use of \"concat\", which I agree doesn\u0027t seem appropriate. Let me know what you think!"},{"file":"lib/machines.js","line":1268,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Given how often req.params is used in this new section, maybe do a \"var params \u003d req.params;\" first?"},{"file":"lib/machines.js","line":1268,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"What I like about \"req.params\" is that, in a function that has a significant number of lines of code, it makes it explicit what \"params\" we\u0027re talking about.\n\nBut I don\u0027t feel too strongly about this, so I\u0027m fine with your suggestion if you still think we should do that."},{"file":"lib/machines.js","line":1268,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"In that case call it reqParams.\n\nI actually do have a good reason for this particular preference, and that\u0027s because we\u0027re using a dynamically-typed language. You only need to get the definition of \"var reqParams \u003d ...\" right once, and from then on the compiler will catch typos. Not so if req.params is used repeatedly instead."},{"file":"lib/machines.js","line":1268,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"That\u0027s a good reason, I like it! Will fix."},{"file":"lib/machines.js","line":1279,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"disabled?"},{"file":"lib/machines.js","line":1279,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"The reason why it says \"not enabled\" here is that it is disabled *by default*, not enabled by default. One has to enable this feature flag in order to have the \"volumes\" input parameter of this endpoint to be processed.\n\nI don\u0027t feel to strongly about it though, so if you think your suggestion is more correct, I\u0027ll change it to that."},{"file":"lib/machines.js","line":1582,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"It\u0027s complex enough that perhaps both instances of this string should be replaced with a single constant."},{"file":"lib/machines.js","line":1582,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"This is going to change to use \"internal_metadata\" to look like this:\n\n{ne: [\u0027internal_metadata\u0027, \u0027sdc:system_role\u003dnfsvolumestorage\u0027]}\n\nSince it\u0027s not used anywhere else, I don\u0027t see a benefit in replacing that with a single constant."},{"file":"lib/machines.js","line":1582,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Benefit: same reason as for replacing req.params with reqParams. I urge you to do it."},{"file":"lib/machines.js","line":1582,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"I had missed that you mentioned *both strings*, and so it actually *is* used somewhere else, so I\u0027ll do that, thanks!"},{"file":"lib/middlewares/networks.js","line":1,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Well, this looks familiar. No license!\n\nWasn\u0027t the other CR\u0027d patch merged into this one?"},{"file":"lib/middlewares/networks.js","line":1,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"This file should have been deleted, it\u0027s the result of a bad  conflict resolution after rebasing these changes on top of latest master.\n\nI\u0027ll remove this file."},{"file":"lib/units.js","line":12,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"If we\u0027re doing this, then \"GIB\"?"},{"file":"lib/units.js","line":12,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Absolutely, will fix!"},{"file":"lib/validation/predicate.js","line":42,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"This definition can be moved outside this scope."},{"file":"lib/validation/predicate.js","line":42,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"This function is the only one using this array. What would be the benefit of moving this declaration to the top-level scope?"},{"file":"lib/validation/predicate.js","line":67,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Maybe move this directly under \"var validationFunc \u003d ...\"?"},{"file":"lib/validation/predicate.js","line":67,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"I tend to try to move all variable declarations to the top of their function scope, to reflect their actual scope. Since we\u0027re iterating on \"predicateFieldsAndValues\", \"predicateFieldsAndValues[predicateField]\" will not throw and thus it\u0027s safe to assert the value of \"validationFunc\" after that."},{"file":"lib/validation/predicate.js","line":82,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"I argue that you\u0027re making the logic in this function unnecessarily more complicated because of single exit. Two conditionals could be eliminated entirely, and there\u0027s less confusion when dealing with the branch directly above this comment.\n\nHaving a single exit can makes sense in C, given that cleanup logic is typically at the end and sometimes a goto is the cleanest way to put that together. But here?\n\nNot seeing it, yo. The opposite, actually. :|"},{"file":"lib/validation/predicate.js","line":82,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Agreed, will fix!"},{"file":"lib/validation/volumes.js","line":22,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"This is probably being too magic, but don\u0027t actually need to check it\u0027s a string before doing a regex test. Regex tests on non-strings return false (well, unless you\u0027re doing a number regex on a number... Javascript and its insane implicit conversions, man)."},{"file":"lib/validation/volumes.js","line":22,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Done"},{"file":"lib/validation/volumes.js","line":33,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"assert.optionalObject() mayhap?"},{"file":"lib/validation/volumes.js","line":33,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Done"},{"file":"lib/validation/volumes.js","line":41,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"This conditional is confusing. Please break it down or somehow simplify it."},{"file":"lib/validation/volumes.js","line":41,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"I think I simplified it, let me know what you think."},{"file":"lib/validation/volumes.js","line":58,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"See https://github.com/joyent/schemas\n\nI have mixed feelings about the thing, but it exists."},{"file":"lib/validation/volumes.js","line":58,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Right, I\u0027m aware of joyent/schemas, I filed https://devhub.joyent.com/jira/browse/PUBAPI-1450 to take care of this."},{"file":"lib/validation/volumes.js","line":90,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"It is pitch black. You might get eaten by an off-by-one!\n\nI think this could be replaced with a:\n\nvar names \u003d name.split(\u0027*\u0027).filter(function getCodeName(x) { return x.length });\nif (names.length \u003e 1 || !VALID_VOLUME_NAME_CHARS_REGEXP.test(names[0])) {\n        err \u003d new Error(\u0027invalid value for name search parameter\u0027);\n    }"},{"file":"lib/validation/volumes.js","line":90,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"\u003e You might get eaten by an off-by-one!\n\nDo you think there\u0027s an off-by-one error here? If so where is it?\n\nI find your suggestion much more concise, but I also find it harder to understand. It is subjective, but I\u0027ll keep this as it is now unless you feel strongly about this."},{"file":"lib/validation/volumes.js","line":90,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"This piece of code I feel a bit more strongly about.\n\nDoes it contain an off-by-one? I don\u0027t know, and that\u0027s kinda the point: it\u0027s not immediately obvious this is correct without mental gymnastics. This is very much off-by-one territory.\n\nThe code I posted is much easier to prove, with the only trick being aware of how split() works across all cases. But I don\u0027t particularly care what the current code is replaced with, so long as there isn\u0027t much arithmetic going on.\n\nThere are no obvious bugs versus there are obviously no bugs, etc, etc."},{"file":"lib/validation/volumes.js","line":90,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Sounds good, I think I\u0027m convinced, however I realize now that this could actually replaced with:\n\nif (!/^\\*?[a-zA-Z0-9_\\.\\-]+\\*?$/.test(name)) {\n  err \u003d ...\n}\n\nreturn err;\n\nThoughts on your preferred solution?\n\nI\u0027ll update the code for now to use the new regexp only, but if you prefer the solution you suggested I\u0027ll change it to that (with a bug fix, it should be \"names.length !\u003d\u003d 1\"m not \"names.length \u003e 1\" in the condition)."},{"file":"lib/validation/volumes.js","line":90,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"https://catmacros.files.wordpress.com/2009/06/its_beautiful.jpg\n\nLove it."},{"file":"lib/validation/volumes.js","line":125,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Just curious why it must be a string?"},{"file":"lib/validation/volumes.js","line":125,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Because in this case it validates what comes from a query string parameter, and so all values are strings."},{"file":"lib/validation/volumes.js","line":125,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"I\u0027m not seeing how checking whether it\u0027s a string or number will affect anything? The check is fine, it just seems to be semantically pointless."},{"file":"lib/validation/volumes.js","line":125,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"The idea was that, if an endpoint uses this function to validate a POST request\u0027s parameter that is a number primitive (typeof (param) \u003d\u003d\u003d \u0027number\u0027)), then this errors.\n\nIn other words, the goal is to avoid misusing this function. However I realize now that in this case it\u0027d make more sense to assert on \"size\" being an optional string rather than returning an error to the client.\n\nThoughts?"},{"file":"lib/validation/volumes.js","line":177,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"This could be hoisted out."},{"file":"lib/validation/volumes.js","line":177,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"This is the only function using this array, what would be the benefit of declaring it at the top-level scope?"},{"file":"sapi_manifests/cloudapi/template","line":193,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"As far as I can tell, this is only used in app.js? But if it determines whether a config.volapi is available to app.js, I don\u0027t think we need to import this variable into cloudapi itself."},{"file":"sapi_manifests/cloudapi/template","line":193,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"As I mentioned at https://cr.joyent.us/#/c/2528/12/lib/app.js@671, in my opinion this helps make things more explicit.\n\nRequiring a \"volapi\" client to be instantiated doesn\u0027t necessarily always imply that the \"experimental_cloudapi_nfs_shared_volumes\" feature flag is enabled, and vice versa.\n\nWhat do you think?"},{"file":"sapi_manifests/cloudapi/template","line":193,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"In what future use-cases would we have a volapi client, but this flag is false?"},{"file":"sapi_manifests/cloudapi/template","line":193,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"E.g if we add another type of volumes while we still support enabling/disabling NFS shared volumes with a flag.\n\nIt is highly unlikely, but it just seems that code would be less clear if we were conflating the presence of a volapi client and the value of the experimental nfs shared volumes flag."},{"file":"test/common.js","line":278,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Where is this err coming from? I\u0027m guessing this is some stale change left over after a merge, since I vaguely recall yanking this stuff out recently."},{"file":"test/common.js","line":278,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Yes, will remove."},{"file":"test/common.js","line":1033,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Not particularly a fan of bringing randomness into the tests. Makes debugging failures harder."},{"file":"test/common.js","line":1033,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"In this case there\u0027s a constant part (\"prefix\"), which makes it easy to debug, but the random part prevents duplicate resource names from making tests fail when they shouldn\u0027t.\n\nIf you feel strongly about removing the random part of resource names, I\u0027ll remove it."},{"file":"test/common.js","line":1033,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Oh, I forgot this. Sorry.\n\nWe need randomness in our tests, in the form of a fuzzer. Sadly that\u0027s a project for another time.\n\nIf you\u0027d like to generate a sequence of resource names, I\u0027d prefer them to always be the same sequence -- in other words, keeping tests as deterministic as possible. How you do that sequence is up to you.\n\nI used to do something ugly like this:\n\nvar cRNCounter \u003d {};\nfunction createResourceName(prefix) {\n    var count \u003d cRNCounter[prefix] \u003d (cRNCounter[prefix] || 0) + 1;\n    return prefix + \u0027-\u0027 + os.hostname() + \u0027-\u0027 + count;\n}\n\nIt\u0027s a hack. :/"},{"file":"test/common.js","line":1033,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"No problem. I removed the random UUIDs from the \"resource names\". Names of all volumes and VMs created should not have any random part now."},{"file":"test/lib/config.js","line":17,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"\"num\" is far more common than \"nb\". Given that \"nb\" was only used once in this codebase (in common.js), methinks replacing the \"nb\"s in this patch with \"num\" is worth it."},{"file":"test/lib/config.js","line":17,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Will fix!"},{"file":"test/lib/config.js","line":29,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"I think this fragment would be better off as a guard right after the ++nbTries"},{"file":"test/lib/config.js","line":29,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Done"},{"file":"test/lib/networks.js","line":29,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"I realize this is a moved fragment, but since we\u0027re here:\n\ns/found/find/\n\nAnd do we really want to pass() here?"},{"file":"test/lib/networks.js","line":29,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Fixed the typo, thanks!\n\n\u003e And do we really want to pass() here?\n\nI think this is really used to wait with a timeout, and then in the only test that uses this function if the default VLAN  does not exist, a subsequent test fails. So it looks fine to me."},{"file":"test/lib/volumes.js","line":28,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"I realize you\u0027re a single-exit kinda guy, but it\u0027d be clearer if this was a guard with a return, and the indentation (and else) was removed from the other branch. It\u0027s not like anything is gained with single-exit when there are multiple callback points..."},{"file":"test/lib/volumes.js","line":28,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Done"},{"file":"test/volumes-automount.test.js","line":52,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Oh, come on... ;_;"},{"file":"test/volumes-automount.test.js","line":52,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"The problem is that we can\u0027t really use process.exit() without risking to lose the output that was sent to stdout with console.log."},{"file":"test/volumes-automount.test.js","line":93,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"I strongly recommend using \"OTHER \u003d clients.other\" here, and add a bunch of tests for every single endpoint where OTHER tries to access CLIENT\u0027s stuff.\n\nIf you do a \"grep -R OTHER test/\" you\u0027ll see we have a bunch of these. All the new tests in this wad should do similar.\n\nI\u0027m loathe to add more to your plate, but I feel quite uncomfortable with an IA until this happens. We\u0027ve had a couple, uh, \"problems\" in the past because we didn\u0027t have checks like these.\n\nThis is something that HAS to happen. Sorry! :("},{"file":"test/volumes-automount.test.js","line":93,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Yes, that makes a lot of sense, I\u0027ll do that!"},{"file":"test/volumes-automount.test.js","line":93,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"So I\u0027ve added that to volumes-basic.test.js, but you mentioned:\n\n\u003e All the new tests in this wad should do similar.\n\nI\u0027m not sure I see the benefit in adding this to _all_ tests. Can you elaborate on that? I\u0027m willing to be convinced though :)"},{"file":"test/volumes-automount.test.js","line":93,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Not every test, but every (method, path) endpoint that\u0027s added. It doesn\u0027t matter if there\u0027s a dozen or a hundred CLIENT GET /my/volumes tests, as long as there\u0027s at least one OTHER GET /my/volumes too."},{"file":"test/volumes-automount.test.js","line":93,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Sounds good. If I understand correctly, I think the current state of this CR should have that in test/volumes-basic.test.js. Please let me know if you see something missing."},{"file":"test/volumes-basic.test.js","line":33,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Hiss! Hissssss!"},{"file":"test/volumes-basic.test.js","line":33,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Same response as https://cr.joyent.us/#/c/2528/12/test/volumes-automount.test.js@52."},{"file":"test/volumes.unavailable-size.test.js","line":28,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"could we process.exit() rather than having a big \u0027else\u0027 block here?"},{"file":"test/volumes.unavailable-size.test.js","line":28,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"The rationale for doing this is that calling process.exit() drops in-flight I/O like the console.log message above. I don\u0027t want to have that message dropped, otherwise we\u0027d sometimes not understand why tests didn\u0027t run.\n\nInstead, we could just move all the code in the \"else\" block into a top-level function (called e.g \"main\" or \"runTest\"), and just call that function in the else block.\n\nDoes that seem like it would address your concerns?\n\nIn any case, I won\u0027t do that before merging this CR because we\u0027re at the point where I want to make changes *only* when *absolutely* required, and this doesn\u0027t seem to match that criteria. However, please feel free to let me know if you disagree with that."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":30,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"etc/cloudapi.coal.cfg","type":"DELETED","insertions":0,"deletions":-184},{"file":"lib/app.js","type":"MODIFIED","insertions":26,"deletions":-8},{"file":"lib/endpoints/networks.js","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"lib/endpoints/volumes.js","type":"ADDED","insertions":733,"deletions":0},{"file":"lib/errors.js","type":"MODIFIED","insertions":48,"deletions":-1},{"file":"lib/machines.js","type":"MODIFIED","insertions":148,"deletions":-2},{"file":"lib/middlewares/networks.js","type":"ADDED","insertions":134,"deletions":0},{"file":"lib/units.js","type":"ADDED","insertions":13,"deletions":0},{"file":"lib/validation/predicate.js","type":"ADDED","insertions":87,"deletions":0},{"file":"lib/validation/volumes.js","type":"ADDED","insertions":197,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"sapi_manifests/cloudapi/template","type":"MODIFIED","insertions":16,"deletions":-2},{"file":"test/auth.test.js","type":"MODIFIED","insertions":4,"deletions":0},{"file":"test/common.js","type":"MODIFIED","insertions":32,"deletions":-2},{"file":"test/fabrics.test.js","type":"MODIFIED","insertions":5,"deletions":-36},{"file":"test/keys.test.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/lib/config.js","type":"ADDED","insertions":46,"deletions":0},{"file":"test/lib/networks.js","type":"ADDED","insertions":43,"deletions":0},{"file":"test/lib/volumes.js","type":"ADDED","insertions":84,"deletions":0},{"file":"test/nics.test.js","type":"MODIFIED","insertions":50,"deletions":0},{"file":"test/volumes-automount.test.js","type":"ADDED","insertions":695,"deletions":0},{"file":"test/volumes-basic.test.js","type":"ADDED","insertions":338,"deletions":0},{"file":"test/volumes-create-name.test.js","type":"ADDED","insertions":147,"deletions":0},{"file":"test/volumes-create-validation.test.js","type":"ADDED","insertions":176,"deletions":0},{"file":"test/volumes-get.test.js","type":"ADDED","insertions":59,"deletions":0},{"file":"test/volumes-list-params-validation.test.js","type":"ADDED","insertions":533,"deletions":0},{"file":"test/volumes-list-predicate-validation.test.js","type":"ADDED","insertions":210,"deletions":0},{"file":"test/volumes-list-sizes.test.js","type":"ADDED","insertions":116,"deletions":0},{"file":"test/volumes-no-fabric-network.test.js","type":"ADDED","insertions":113,"deletions":0},{"file":"test/volumes-size.test.js","type":"ADDED","insertions":229,"deletions":0},{"file":"test/volumes-update-name.test.js","type":"ADDED","insertions":166,"deletions":0},{"file":"test/volumes.unavailable-size.test.js","type":"ADDED","insertions":122,"deletions":0}],"sizeInsertions":4581,"sizeDeletions":-241},{"number":"13","revision":"5cd42d3dcdcd7ba41092eaa7c6a4ee0002f1258e","parents":["f22cf71e89d96ba40f57eb08d7fef718b0c969fc"],"ref":"refs/changes/28/2528/13","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1508203103,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1508203141,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":30,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"etc/cloudapi.coal.cfg","type":"DELETED","insertions":0,"deletions":-184},{"file":"lib/app.js","type":"MODIFIED","insertions":33,"deletions":-9},{"file":"lib/endpoints/networks.js","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"lib/endpoints/volumes.js","type":"ADDED","insertions":678,"deletions":0},{"file":"lib/errors.js","type":"MODIFIED","insertions":42,"deletions":-1},{"file":"lib/machines.js","type":"MODIFIED","insertions":139,"deletions":-3},{"file":"lib/middleware/networks.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"lib/units.js","type":"ADDED","insertions":13,"deletions":0},{"file":"lib/validation/predicate.js","type":"ADDED","insertions":82,"deletions":0},{"file":"lib/validation/volumes.js","type":"ADDED","insertions":200,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"sapi_manifests/cloudapi/template","type":"MODIFIED","insertions":16,"deletions":-2},{"file":"test/auth.test.js","type":"MODIFIED","insertions":4,"deletions":0},{"file":"test/common.js","type":"MODIFIED","insertions":23,"deletions":-2},{"file":"test/fabrics.test.js","type":"MODIFIED","insertions":5,"deletions":-36},{"file":"test/keys.test.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/lib/config.js","type":"ADDED","insertions":47,"deletions":0},{"file":"test/lib/networks.js","type":"ADDED","insertions":43,"deletions":0},{"file":"test/lib/volumes.js","type":"ADDED","insertions":85,"deletions":0},{"file":"test/nics.test.js","type":"MODIFIED","insertions":50,"deletions":0},{"file":"test/volumes-automount.test.js","type":"ADDED","insertions":695,"deletions":0},{"file":"test/volumes-basic.test.js","type":"ADDED","insertions":338,"deletions":0},{"file":"test/volumes-create-name.test.js","type":"ADDED","insertions":147,"deletions":0},{"file":"test/volumes-create-validation.test.js","type":"ADDED","insertions":176,"deletions":0},{"file":"test/volumes-get.test.js","type":"ADDED","insertions":59,"deletions":0},{"file":"test/volumes-list-params-validation.test.js","type":"ADDED","insertions":533,"deletions":0},{"file":"test/volumes-list-predicate-validation.test.js","type":"ADDED","insertions":210,"deletions":0},{"file":"test/volumes-list-sizes.test.js","type":"ADDED","insertions":116,"deletions":0},{"file":"test/volumes-no-fabric-network.test.js","type":"ADDED","insertions":113,"deletions":0},{"file":"test/volumes-size.test.js","type":"ADDED","insertions":229,"deletions":0},{"file":"test/volumes-update-name.test.js","type":"ADDED","insertions":166,"deletions":0},{"file":"test/volumes.unavailable-size.test.js","type":"ADDED","insertions":122,"deletions":0}],"sizeInsertions":4378,"sizeDeletions":-244},{"number":"14","revision":"369b4d57afa0560c27554f39b358fe5068e209b2","parents":["f22cf71e89d96ba40f57eb08d7fef718b0c969fc"],"ref":"refs/changes/28/2528/14","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1508278712,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1508278759,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":30,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"etc/cloudapi.coal.cfg","type":"DELETED","insertions":0,"deletions":-184},{"file":"lib/app.js","type":"MODIFIED","insertions":33,"deletions":-9},{"file":"lib/endpoints/networks.js","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"lib/endpoints/volumes.js","type":"ADDED","insertions":664,"deletions":0},{"file":"lib/errors.js","type":"MODIFIED","insertions":42,"deletions":-1},{"file":"lib/machines.js","type":"MODIFIED","insertions":144,"deletions":-5},{"file":"lib/middleware/networks.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"lib/units.js","type":"ADDED","insertions":13,"deletions":0},{"file":"lib/validation/predicate.js","type":"ADDED","insertions":82,"deletions":0},{"file":"lib/validation/volumes.js","type":"ADDED","insertions":169,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"sapi_manifests/cloudapi/template","type":"MODIFIED","insertions":16,"deletions":-2},{"file":"test/auth.test.js","type":"MODIFIED","insertions":4,"deletions":0},{"file":"test/common.js","type":"MODIFIED","insertions":23,"deletions":-2},{"file":"test/fabrics.test.js","type":"MODIFIED","insertions":5,"deletions":-36},{"file":"test/keys.test.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/lib/config.js","type":"ADDED","insertions":47,"deletions":0},{"file":"test/lib/networks.js","type":"ADDED","insertions":43,"deletions":0},{"file":"test/lib/volumes.js","type":"ADDED","insertions":85,"deletions":0},{"file":"test/nics.test.js","type":"MODIFIED","insertions":50,"deletions":0},{"file":"test/volumes-automount.test.js","type":"ADDED","insertions":695,"deletions":0},{"file":"test/volumes-basic.test.js","type":"ADDED","insertions":338,"deletions":0},{"file":"test/volumes-create-name.test.js","type":"ADDED","insertions":147,"deletions":0},{"file":"test/volumes-create-validation.test.js","type":"ADDED","insertions":176,"deletions":0},{"file":"test/volumes-get.test.js","type":"ADDED","insertions":59,"deletions":0},{"file":"test/volumes-list-params-validation.test.js","type":"ADDED","insertions":533,"deletions":0},{"file":"test/volumes-list-predicate-validation.test.js","type":"ADDED","insertions":210,"deletions":0},{"file":"test/volumes-list-sizes.test.js","type":"ADDED","insertions":116,"deletions":0},{"file":"test/volumes-no-fabric-network.test.js","type":"ADDED","insertions":113,"deletions":0},{"file":"test/volumes-size.test.js","type":"ADDED","insertions":229,"deletions":0},{"file":"test/volumes-update-name.test.js","type":"ADDED","insertions":166,"deletions":0},{"file":"test/volumes.unavailable-size.test.js","type":"ADDED","insertions":122,"deletions":0}],"sizeInsertions":4338,"sizeDeletions":-246},{"number":"15","revision":"91d3ea085ef5d1af77a6a890861367504cfd3756","parents":["f22cf71e89d96ba40f57eb08d7fef718b0c969fc"],"ref":"refs/changes/28/2528/15","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1508282482,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1508282513,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":30,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"etc/cloudapi.coal.cfg","type":"DELETED","insertions":0,"deletions":-184},{"file":"lib/app.js","type":"MODIFIED","insertions":33,"deletions":-9},{"file":"lib/endpoints/networks.js","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"lib/endpoints/volumes.js","type":"ADDED","insertions":664,"deletions":0},{"file":"lib/errors.js","type":"MODIFIED","insertions":42,"deletions":-1},{"file":"lib/machines.js","type":"MODIFIED","insertions":144,"deletions":-5},{"file":"lib/middleware/networks.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"lib/units.js","type":"ADDED","insertions":13,"deletions":0},{"file":"lib/validation/predicate.js","type":"ADDED","insertions":82,"deletions":0},{"file":"lib/validation/volumes.js","type":"ADDED","insertions":169,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"sapi_manifests/cloudapi/template","type":"MODIFIED","insertions":16,"deletions":-2},{"file":"test/auth.test.js","type":"MODIFIED","insertions":4,"deletions":0},{"file":"test/common.js","type":"MODIFIED","insertions":23,"deletions":-2},{"file":"test/fabrics.test.js","type":"MODIFIED","insertions":5,"deletions":-36},{"file":"test/keys.test.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/lib/config.js","type":"ADDED","insertions":47,"deletions":0},{"file":"test/lib/networks.js","type":"ADDED","insertions":43,"deletions":0},{"file":"test/lib/volumes.js","type":"ADDED","insertions":85,"deletions":0},{"file":"test/nics.test.js","type":"MODIFIED","insertions":50,"deletions":0},{"file":"test/volumes-automount.test.js","type":"ADDED","insertions":695,"deletions":0},{"file":"test/volumes-basic.test.js","type":"ADDED","insertions":396,"deletions":0},{"file":"test/volumes-create-name.test.js","type":"ADDED","insertions":147,"deletions":0},{"file":"test/volumes-create-validation.test.js","type":"ADDED","insertions":176,"deletions":0},{"file":"test/volumes-get.test.js","type":"ADDED","insertions":59,"deletions":0},{"file":"test/volumes-list-params-validation.test.js","type":"ADDED","insertions":533,"deletions":0},{"file":"test/volumes-list-predicate-validation.test.js","type":"ADDED","insertions":210,"deletions":0},{"file":"test/volumes-list-sizes.test.js","type":"ADDED","insertions":116,"deletions":0},{"file":"test/volumes-no-fabric-network.test.js","type":"ADDED","insertions":113,"deletions":0},{"file":"test/volumes-size.test.js","type":"ADDED","insertions":229,"deletions":0},{"file":"test/volumes-update-name.test.js","type":"ADDED","insertions":166,"deletions":0},{"file":"test/volumes.unavailable-size.test.js","type":"ADDED","insertions":122,"deletions":0}],"sizeInsertions":4396,"sizeDeletions":-246},{"number":"16","revision":"16d4668138bb5d76283f9a245ff3a3e1b7325aa6","parents":["f22cf71e89d96ba40f57eb08d7fef718b0c969fc"],"ref":"refs/changes/28/2528/16","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1508299639,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1508299684,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"Makefile","line":8,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"2017"},{"file":"Makefile","line":8,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Done"},{"file":"test/auth.test.js","line":8,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"2017"},{"file":"test/auth.test.js","line":8,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Done"},{"file":"test/keys.test.js","line":8,"reviewer":{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},"message":"2017"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":30,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":4,"deletions":-1},{"file":"etc/cloudapi.coal.cfg","type":"DELETED","insertions":0,"deletions":-184},{"file":"lib/app.js","type":"MODIFIED","insertions":33,"deletions":-9},{"file":"lib/endpoints/networks.js","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"lib/endpoints/volumes.js","type":"ADDED","insertions":664,"deletions":0},{"file":"lib/errors.js","type":"MODIFIED","insertions":42,"deletions":-1},{"file":"lib/machines.js","type":"MODIFIED","insertions":144,"deletions":-5},{"file":"lib/middleware/networks.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"lib/units.js","type":"ADDED","insertions":13,"deletions":0},{"file":"lib/validation/predicate.js","type":"ADDED","insertions":82,"deletions":0},{"file":"lib/validation/volumes.js","type":"ADDED","insertions":174,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"sapi_manifests/cloudapi/template","type":"MODIFIED","insertions":16,"deletions":-2},{"file":"test/auth.test.js","type":"MODIFIED","insertions":4,"deletions":0},{"file":"test/common.js","type":"MODIFIED","insertions":17,"deletions":-2},{"file":"test/fabrics.test.js","type":"MODIFIED","insertions":5,"deletions":-36},{"file":"test/keys.test.js","type":"MODIFIED","insertions":2,"deletions":0},{"file":"test/lib/config.js","type":"ADDED","insertions":47,"deletions":0},{"file":"test/lib/networks.js","type":"ADDED","insertions":43,"deletions":0},{"file":"test/lib/volumes.js","type":"ADDED","insertions":85,"deletions":0},{"file":"test/nics.test.js","type":"MODIFIED","insertions":50,"deletions":0},{"file":"test/volumes-automount.test.js","type":"ADDED","insertions":695,"deletions":0},{"file":"test/volumes-basic.test.js","type":"ADDED","insertions":396,"deletions":0},{"file":"test/volumes-create-name.test.js","type":"ADDED","insertions":147,"deletions":0},{"file":"test/volumes-create-validation.test.js","type":"ADDED","insertions":172,"deletions":0},{"file":"test/volumes-get.test.js","type":"ADDED","insertions":59,"deletions":0},{"file":"test/volumes-list-params-validation.test.js","type":"ADDED","insertions":533,"deletions":0},{"file":"test/volumes-list-predicate-validation.test.js","type":"ADDED","insertions":210,"deletions":0},{"file":"test/volumes-list-sizes.test.js","type":"ADDED","insertions":112,"deletions":0},{"file":"test/volumes-no-fabric-network.test.js","type":"ADDED","insertions":110,"deletions":0},{"file":"test/volumes-size.test.js","type":"ADDED","insertions":227,"deletions":0},{"file":"test/volumes-update-name.test.js","type":"ADDED","insertions":165,"deletions":0},{"file":"test/volumes.unavailable-size.test.js","type":"ADDED","insertions":121,"deletions":0}],"sizeInsertions":4380,"sizeDeletions":-246},{"number":"17","revision":"5bfa0f409450f902c3ae811c31cc8452a8b08cf1","parents":["f22cf71e89d96ba40f57eb08d7fef718b0c969fc"],"ref":"refs/changes/28/2528/17","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1509395422,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1509395452,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":30,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"etc/cloudapi.coal.cfg","type":"DELETED","insertions":0,"deletions":-184},{"file":"lib/app.js","type":"MODIFIED","insertions":33,"deletions":-9},{"file":"lib/endpoints/networks.js","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"lib/endpoints/volumes.js","type":"ADDED","insertions":666,"deletions":0},{"file":"lib/errors.js","type":"MODIFIED","insertions":42,"deletions":-1},{"file":"lib/machines.js","type":"MODIFIED","insertions":144,"deletions":-5},{"file":"lib/middleware/networks.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"lib/units.js","type":"ADDED","insertions":13,"deletions":0},{"file":"lib/validation/predicate.js","type":"ADDED","insertions":82,"deletions":0},{"file":"lib/validation/volumes.js","type":"ADDED","insertions":174,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"sapi_manifests/cloudapi/template","type":"MODIFIED","insertions":16,"deletions":-2},{"file":"test/auth.test.js","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"test/common.js","type":"MODIFIED","insertions":17,"deletions":-2},{"file":"test/fabrics.test.js","type":"MODIFIED","insertions":5,"deletions":-36},{"file":"test/keys.test.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"test/lib/config.js","type":"ADDED","insertions":47,"deletions":0},{"file":"test/lib/networks.js","type":"ADDED","insertions":43,"deletions":0},{"file":"test/lib/volumes.js","type":"ADDED","insertions":85,"deletions":0},{"file":"test/nics.test.js","type":"MODIFIED","insertions":50,"deletions":0},{"file":"test/volumes-automount.test.js","type":"ADDED","insertions":695,"deletions":0},{"file":"test/volumes-basic.test.js","type":"ADDED","insertions":396,"deletions":0},{"file":"test/volumes-create-name.test.js","type":"ADDED","insertions":147,"deletions":0},{"file":"test/volumes-create-validation.test.js","type":"ADDED","insertions":172,"deletions":0},{"file":"test/volumes-get.test.js","type":"ADDED","insertions":59,"deletions":0},{"file":"test/volumes-list-params-validation.test.js","type":"ADDED","insertions":533,"deletions":0},{"file":"test/volumes-list-predicate-validation.test.js","type":"ADDED","insertions":210,"deletions":0},{"file":"test/volumes-list-sizes.test.js","type":"ADDED","insertions":112,"deletions":0},{"file":"test/volumes-no-fabric-network.test.js","type":"ADDED","insertions":110,"deletions":0},{"file":"test/volumes-size.test.js","type":"ADDED","insertions":227,"deletions":0},{"file":"test/volumes-update-name.test.js","type":"ADDED","insertions":165,"deletions":0},{"file":"test/volumes.unavailable-size.test.js","type":"ADDED","insertions":121,"deletions":0}],"sizeInsertions":4385,"sizeDeletions":-249},{"number":"18","revision":"28cfff9fdd0fe64878987f43a0848526adee6c35","parents":["7b3b2c1bf9b4d9a68333beaf76a2609518b636d6"],"ref":"refs/changes/28/2528/18","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1509395457,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1509395452,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":30,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"etc/cloudapi.coal.cfg","type":"DELETED","insertions":0,"deletions":-184},{"file":"lib/app.js","type":"MODIFIED","insertions":33,"deletions":-9},{"file":"lib/endpoints/networks.js","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"lib/endpoints/volumes.js","type":"ADDED","insertions":666,"deletions":0},{"file":"lib/errors.js","type":"MODIFIED","insertions":42,"deletions":-1},{"file":"lib/machines.js","type":"MODIFIED","insertions":144,"deletions":-5},{"file":"lib/middleware/networks.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"lib/units.js","type":"ADDED","insertions":13,"deletions":0},{"file":"lib/validation/predicate.js","type":"ADDED","insertions":82,"deletions":0},{"file":"lib/validation/volumes.js","type":"ADDED","insertions":174,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"sapi_manifests/cloudapi/template","type":"MODIFIED","insertions":16,"deletions":-2},{"file":"test/auth.test.js","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"test/common.js","type":"MODIFIED","insertions":17,"deletions":-2},{"file":"test/fabrics.test.js","type":"MODIFIED","insertions":5,"deletions":-36},{"file":"test/keys.test.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"test/lib/config.js","type":"ADDED","insertions":47,"deletions":0},{"file":"test/lib/networks.js","type":"ADDED","insertions":43,"deletions":0},{"file":"test/lib/volumes.js","type":"ADDED","insertions":85,"deletions":0},{"file":"test/nics.test.js","type":"MODIFIED","insertions":50,"deletions":0},{"file":"test/volumes-automount.test.js","type":"ADDED","insertions":695,"deletions":0},{"file":"test/volumes-basic.test.js","type":"ADDED","insertions":396,"deletions":0},{"file":"test/volumes-create-name.test.js","type":"ADDED","insertions":147,"deletions":0},{"file":"test/volumes-create-validation.test.js","type":"ADDED","insertions":172,"deletions":0},{"file":"test/volumes-get.test.js","type":"ADDED","insertions":59,"deletions":0},{"file":"test/volumes-list-params-validation.test.js","type":"ADDED","insertions":533,"deletions":0},{"file":"test/volumes-list-predicate-validation.test.js","type":"ADDED","insertions":210,"deletions":0},{"file":"test/volumes-list-sizes.test.js","type":"ADDED","insertions":112,"deletions":0},{"file":"test/volumes-no-fabric-network.test.js","type":"ADDED","insertions":110,"deletions":0},{"file":"test/volumes-size.test.js","type":"ADDED","insertions":227,"deletions":0},{"file":"test/volumes-update-name.test.js","type":"ADDED","insertions":165,"deletions":0},{"file":"test/volumes.unavailable-size.test.js","type":"ADDED","insertions":121,"deletions":0}],"sizeInsertions":4385,"sizeDeletions":-249},{"number":"19","revision":"e22a37fce76258d2e54bb228536962f99ac61f51","parents":["7b3b2c1bf9b4d9a68333beaf76a2609518b636d6"],"ref":"refs/changes/28/2528/19","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1509586871,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1509586902,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":30,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"etc/cloudapi.coal.cfg","type":"DELETED","insertions":0,"deletions":-184},{"file":"lib/app.js","type":"MODIFIED","insertions":33,"deletions":-9},{"file":"lib/endpoints/networks.js","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"lib/endpoints/volumes.js","type":"ADDED","insertions":666,"deletions":0},{"file":"lib/errors.js","type":"MODIFIED","insertions":58,"deletions":-1},{"file":"lib/machines.js","type":"MODIFIED","insertions":211,"deletions":-31},{"file":"lib/middleware/networks.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"lib/units.js","type":"ADDED","insertions":13,"deletions":0},{"file":"lib/validation/predicate.js","type":"ADDED","insertions":82,"deletions":0},{"file":"lib/validation/volumes.js","type":"ADDED","insertions":174,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"sapi_manifests/cloudapi/template","type":"MODIFIED","insertions":16,"deletions":-2},{"file":"test/auth.test.js","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"test/common.js","type":"MODIFIED","insertions":17,"deletions":-2},{"file":"test/fabrics.test.js","type":"MODIFIED","insertions":5,"deletions":-36},{"file":"test/keys.test.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"test/lib/config.js","type":"ADDED","insertions":47,"deletions":0},{"file":"test/lib/networks.js","type":"ADDED","insertions":43,"deletions":0},{"file":"test/lib/volumes.js","type":"ADDED","insertions":85,"deletions":0},{"file":"test/nics.test.js","type":"MODIFIED","insertions":50,"deletions":0},{"file":"test/volumes-automount.test.js","type":"ADDED","insertions":695,"deletions":0},{"file":"test/volumes-basic.test.js","type":"ADDED","insertions":396,"deletions":0},{"file":"test/volumes-create-name.test.js","type":"ADDED","insertions":147,"deletions":0},{"file":"test/volumes-create-validation.test.js","type":"ADDED","insertions":172,"deletions":0},{"file":"test/volumes-get.test.js","type":"ADDED","insertions":59,"deletions":0},{"file":"test/volumes-list-params-validation.test.js","type":"ADDED","insertions":533,"deletions":0},{"file":"test/volumes-list-predicate-validation.test.js","type":"ADDED","insertions":210,"deletions":0},{"file":"test/volumes-list-sizes.test.js","type":"ADDED","insertions":112,"deletions":0},{"file":"test/volumes-no-fabric-network.test.js","type":"ADDED","insertions":110,"deletions":0},{"file":"test/volumes-size.test.js","type":"ADDED","insertions":227,"deletions":0},{"file":"test/volumes-update-name.test.js","type":"ADDED","insertions":165,"deletions":0},{"file":"test/volumes.unavailable-size.test.js","type":"ADDED","insertions":121,"deletions":0}],"sizeInsertions":4468,"sizeDeletions":-275},{"number":"20","revision":"6897173ed96b249b53f6431235af847e764f6ea6","parents":["7b3b2c1bf9b4d9a68333beaf76a2609518b636d6"],"ref":"refs/changes/28/2528/20","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1509590750,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1509590780,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":30,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"etc/cloudapi.coal.cfg","type":"DELETED","insertions":0,"deletions":-184},{"file":"lib/app.js","type":"MODIFIED","insertions":33,"deletions":-9},{"file":"lib/endpoints/networks.js","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"lib/endpoints/volumes.js","type":"ADDED","insertions":666,"deletions":0},{"file":"lib/errors.js","type":"MODIFIED","insertions":58,"deletions":-1},{"file":"lib/machines.js","type":"MODIFIED","insertions":214,"deletions":-31},{"file":"lib/middleware/networks.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"lib/units.js","type":"ADDED","insertions":13,"deletions":0},{"file":"lib/validation/predicate.js","type":"ADDED","insertions":82,"deletions":0},{"file":"lib/validation/volumes.js","type":"ADDED","insertions":174,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"sapi_manifests/cloudapi/template","type":"MODIFIED","insertions":16,"deletions":-2},{"file":"test/auth.test.js","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"test/common.js","type":"MODIFIED","insertions":17,"deletions":-2},{"file":"test/fabrics.test.js","type":"MODIFIED","insertions":5,"deletions":-36},{"file":"test/keys.test.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"test/lib/config.js","type":"ADDED","insertions":47,"deletions":0},{"file":"test/lib/networks.js","type":"ADDED","insertions":43,"deletions":0},{"file":"test/lib/volumes.js","type":"ADDED","insertions":85,"deletions":0},{"file":"test/nics.test.js","type":"MODIFIED","insertions":50,"deletions":0},{"file":"test/volumes-automount.test.js","type":"ADDED","insertions":695,"deletions":0},{"file":"test/volumes-basic.test.js","type":"ADDED","insertions":396,"deletions":0},{"file":"test/volumes-create-name.test.js","type":"ADDED","insertions":147,"deletions":0},{"file":"test/volumes-create-validation.test.js","type":"ADDED","insertions":172,"deletions":0},{"file":"test/volumes-get.test.js","type":"ADDED","insertions":59,"deletions":0},{"file":"test/volumes-list-params-validation.test.js","type":"ADDED","insertions":533,"deletions":0},{"file":"test/volumes-list-predicate-validation.test.js","type":"ADDED","insertions":210,"deletions":0},{"file":"test/volumes-list-sizes.test.js","type":"ADDED","insertions":112,"deletions":0},{"file":"test/volumes-no-fabric-network.test.js","type":"ADDED","insertions":110,"deletions":0},{"file":"test/volumes-size.test.js","type":"ADDED","insertions":227,"deletions":0},{"file":"test/volumes-update-name.test.js","type":"ADDED","insertions":165,"deletions":0},{"file":"test/volumes.unavailable-size.test.js","type":"ADDED","insertions":121,"deletions":0}],"sizeInsertions":4471,"sizeDeletions":-275},{"number":"21","revision":"504b1c8457ecdb2fabc9716fc6999d68af6a3429","parents":["7b3b2c1bf9b4d9a68333beaf76a2609518b636d6"],"ref":"refs/changes/28/2528/21","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1509668022,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1509668053,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/endpoints/volumes.js","line":131,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Could do the reqParams thing again in the functions in this file."},{"file":"lib/endpoints/volumes.js","line":168,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"I realize there\u0027s no practical distinction here, but pointing it out regardless: req.params was validated, but req.query was used. Although I can\u0027t see how that would be a problem, methinks using what was actually validated would be safer."},{"file":"lib/endpoints/volumes.js","line":168,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Done"},{"file":"lib/endpoints/volumes.js","line":201,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"There was no assert.object() for this in the function prolog, albeit that shouldn\u0027t ever be a problem?"},{"file":"lib/endpoints/volumes.js","line":201,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Done"},{"file":"lib/endpoints/volumes.js","line":274,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"If validateVolumeSize() could handle an undefined size, you could be a tad evil and rewrite much of this function as:\n\nvar validationErrs \u003d [\u0027name\u0027, \u0027type\u0027, \u0027size\u0027, \u0027networks\u0027].map(function (name) {\n    var funcName \u003d \u0027validateVolume\u0027 + name[0].toUpperCase() + name.slice(1);\n    return volumesValidation[funcName](req.params[name]);\n}).filter(function (err) { return err; });\n\nI make no comment whether it\u0027s a good idea."},{"file":"lib/endpoints/volumes.js","line":274,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"I think I want to keep the functions in the \"volumesValidation\" module not accept undefined values, as I think it should be the responsibility of each endpoint to determine whether the absence of a given parameter is valid or not.\n\nI realize though that e.g the \"validateVolumeNetworks\" function in that module accepts undefined values as valid, butut I\u0027d rather fix that to be consistent with the model I described."},{"file":"lib/endpoints/volumes.js","line":496,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"As in: if we return a 204 with a body haproxy does something unwanted?"},{"file":"lib/endpoints/volumes.js","line":496,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"This meant that I thought sending \u0027{}\u0027 (as done below) was required when replying with a 204 HTTP status code and the HTTP response was going through haproxy.\n\nBut testing a volume deletion after removing that and just replying with \"res.send(204)\" seems to work fine, and I can\u0027t remember all the details of why that didn\u0027t seem to work as expected before, since I wrote that code \u003e 1 year ago.\n\nSo I\u0027ll remove that and replace it with \"res.send(204)\"."},{"file":"lib/endpoints/volumes.js","line":498,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Not needed."},{"file":"lib/endpoints/volumes.js","line":498,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"I agree, see above for context."},{"file":"lib/endpoints/volumes.js","line":515,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"req.query was asserted in the prolog, but not req.params."},{"file":"lib/endpoints/volumes.js","line":515,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Done"},{"file":"lib/endpoints/volumes.js","line":580,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Not sure what to think of this. I grok the reasoning, but it\u0027s inconsistent with the other POSTs in cloudapi."},{"file":"lib/endpoints/volumes.js","line":580,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Rethinking this, I\u0027m leaning towards making this endpoint to return a representation of the updated resource. However, that would require making changes to VOLAPI, and at this point I\u0027d like to avoid changes that are not absolutely necessary.\n\nSo I\u0027m suggesting to create a ticket that would address this. We don\u0027t currently care too much about backward compatibility of API changes while this API is still experimental, so I think it\u0027d be fine to make that change in the next milestone.\n\nWe could also consider that change backward compatible anyway, since any client that would expect it needs to fetch the updated resource and can\u0027t rely on the response to the UpdateVolume request could just continue doing that.\n\nWhat do you think?"},{"file":"lib/endpoints/volumes.js","line":580,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"I\u0027m cool with it as long as it\u0027s changed before experimental is removed."},{"file":"lib/endpoints/volumes.js","line":580,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Yes, that\u0027s the intention."},{"file":"lib/endpoints/volumes.js","line":580,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"FWIW, just filed https://jira.joyent.us/browse/VOLAPI-90."},{"file":"lib/machines.js","line":1152,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Oh boy, if this has to be checked we\u0027re dealing with something scary. Is there some way to use a whitelist rather than a blacklist approach?\n\nE.g.\n\nfunction validVolumeMountpoint(mountpoint) {\n    return /^(\\/[a-z0-9][\\w\\.\\-]*)+$/i.test(mountpoint);\n}\n\nThat covers all cases with no loopholes?"},{"file":"lib/machines.js","line":1152,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"The goal here was to be as liberal as possible in terms of what we accept, since what docker seems to do is to just check that the path is absolute.\n\nFor that reason the backlist approach seemed more appropriate, but if you still think we should use a whitelist approach then I\u0027ll change it to that."},{"file":"lib/machines.js","line":1152,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"No real opinion, although the one-liner is both shorter and safer."},{"file":"lib/machines.js","line":1152,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"If you don\u0027t have a strong opinion then I\u0027ll keep it this way for now."},{"file":"lib/machines.js","line":1606,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Just curious why the clone? Because of the opts.limit below?"},{"file":"lib/machines.js","line":1606,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"I wanted to clone because otherwise here we\u0027d override the \"opts.predicate\" value. We save it in \"originalPredicate\" so in practice it wouldn\u0027t have an impact, but that temporary variable is here more as an improvement for readability.\n\nI think keeping the clone here makes this code more robust to future changes that would also override other properties in \"opts\"."},{"file":"lib/units.js","line":12,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"i"},{"file":"lib/units.js","line":12,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Done"},{"file":"lib/validation/volumes.js","line":20,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"\"A-Z\" can be eliminated by tacking an \"i\" on the end of the regex to ignore case.\n\n\\w is equivalent to [a-zA-Z0-9\\_]"},{"file":"lib/validation/volumes.js","line":20,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Done"},{"file":"lib/validation/volumes.js","line":53,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"These two checks are superfluous when dealing with a regex."},{"file":"lib/validation/volumes.js","line":53,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Done"},{"file":"lib/validation/volumes.js","line":117,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Superfluous."},{"file":"lib/validation/volumes.js","line":117,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Done"},{"file":"lib/validation/volumes.js","line":142,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"This could be replaced with?\n\nvolumeNetworksValid \u003d volumeNetworks.some(function checkNetworkValidity(network) {\n    return validateVolumeNetwork(network) !\u003d\u003d undefined;\n});"},{"file":"lib/validation/volumes.js","line":142,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"We want to keep every single validation error though. We could definitely use a similar approach to what you\u0027re proposing to do that, but I\u0027d be inclined to postpone that to the next milestone, since it doesn\u0027t seem like a fundamental design issue."},{"file":"lib/validation/volumes.js","line":142,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"But none of those validation errors are being returned? Will this be changed?"},{"file":"lib/validation/volumes.js","line":142,"reviewer":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"message":"Ah that\u0027s right, I had missed that. I used your suggestion (although I used every instead of some and changed the test from !\u003d\u003d undefined to \u003d\u003d\u003d undefined, since we want to make sure that _every_ network is valid."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":30,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"etc/cloudapi.coal.cfg","type":"DELETED","insertions":0,"deletions":-184},{"file":"lib/app.js","type":"MODIFIED","insertions":33,"deletions":-9},{"file":"lib/endpoints/networks.js","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"lib/endpoints/volumes.js","type":"ADDED","insertions":666,"deletions":0},{"file":"lib/errors.js","type":"MODIFIED","insertions":58,"deletions":-1},{"file":"lib/machines.js","type":"MODIFIED","insertions":214,"deletions":-31},{"file":"lib/middleware/networks.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"lib/units.js","type":"ADDED","insertions":13,"deletions":0},{"file":"lib/validation/predicate.js","type":"ADDED","insertions":82,"deletions":0},{"file":"lib/validation/volumes.js","type":"ADDED","insertions":174,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"sapi_manifests/cloudapi/template","type":"MODIFIED","insertions":16,"deletions":-2},{"file":"test/auth.test.js","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"test/common.js","type":"MODIFIED","insertions":19,"deletions":-2},{"file":"test/fabrics.test.js","type":"MODIFIED","insertions":5,"deletions":-36},{"file":"test/keys.test.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"test/lib/config.js","type":"ADDED","insertions":47,"deletions":0},{"file":"test/lib/networks.js","type":"ADDED","insertions":43,"deletions":0},{"file":"test/lib/volumes.js","type":"ADDED","insertions":85,"deletions":0},{"file":"test/nics.test.js","type":"MODIFIED","insertions":50,"deletions":0},{"file":"test/volumes-automount.test.js","type":"ADDED","insertions":695,"deletions":0},{"file":"test/volumes-basic.test.js","type":"ADDED","insertions":396,"deletions":0},{"file":"test/volumes-create-name.test.js","type":"ADDED","insertions":147,"deletions":0},{"file":"test/volumes-create-validation.test.js","type":"ADDED","insertions":172,"deletions":0},{"file":"test/volumes-get.test.js","type":"ADDED","insertions":59,"deletions":0},{"file":"test/volumes-list-params-validation.test.js","type":"ADDED","insertions":533,"deletions":0},{"file":"test/volumes-list-predicate-validation.test.js","type":"ADDED","insertions":210,"deletions":0},{"file":"test/volumes-list-sizes.test.js","type":"ADDED","insertions":112,"deletions":0},{"file":"test/volumes-no-fabric-network.test.js","type":"ADDED","insertions":110,"deletions":0},{"file":"test/volumes-size.test.js","type":"ADDED","insertions":227,"deletions":0},{"file":"test/volumes-update-name.test.js","type":"ADDED","insertions":165,"deletions":0},{"file":"test/volumes.unavailable-size.test.js","type":"ADDED","insertions":121,"deletions":0}],"sizeInsertions":4473,"sizeDeletions":-275},{"number":"22","revision":"011c2dbda2601abb37ca373141871054ebd5a126","parents":["945d2921b9d3d4a91fec80c08cd339c8d0312af0"],"ref":"refs/changes/28/2528/22","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1509993829,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1509993859,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/endpoints/networks.js","line":204,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"literal string using double-quote instead of single"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":30,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"etc/cloudapi.coal.cfg","type":"DELETED","insertions":0,"deletions":-184},{"file":"lib/app.js","type":"MODIFIED","insertions":33,"deletions":-9},{"file":"lib/endpoints/networks.js","type":"MODIFIED","insertions":2,"deletions":-3},{"file":"lib/endpoints/volumes.js","type":"ADDED","insertions":666,"deletions":0},{"file":"lib/errors.js","type":"MODIFIED","insertions":58,"deletions":-1},{"file":"lib/machines.js","type":"MODIFIED","insertions":214,"deletions":-31},{"file":"lib/middleware/networks.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"lib/units.js","type":"ADDED","insertions":13,"deletions":0},{"file":"lib/validation/predicate.js","type":"ADDED","insertions":82,"deletions":0},{"file":"lib/validation/volumes.js","type":"ADDED","insertions":174,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"sapi_manifests/cloudapi/template","type":"MODIFIED","insertions":16,"deletions":-2},{"file":"test/auth.test.js","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"test/common.js","type":"MODIFIED","insertions":19,"deletions":-2},{"file":"test/fabrics.test.js","type":"MODIFIED","insertions":5,"deletions":-36},{"file":"test/keys.test.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"test/lib/config.js","type":"ADDED","insertions":47,"deletions":0},{"file":"test/lib/networks.js","type":"ADDED","insertions":43,"deletions":0},{"file":"test/lib/volumes.js","type":"ADDED","insertions":85,"deletions":0},{"file":"test/nics.test.js","type":"MODIFIED","insertions":50,"deletions":0},{"file":"test/volumes-automount.test.js","type":"ADDED","insertions":695,"deletions":0},{"file":"test/volumes-basic.test.js","type":"ADDED","insertions":396,"deletions":0},{"file":"test/volumes-create-name.test.js","type":"ADDED","insertions":147,"deletions":0},{"file":"test/volumes-create-validation.test.js","type":"ADDED","insertions":172,"deletions":0},{"file":"test/volumes-get.test.js","type":"ADDED","insertions":59,"deletions":0},{"file":"test/volumes-list-params-validation.test.js","type":"ADDED","insertions":533,"deletions":0},{"file":"test/volumes-list-predicate-validation.test.js","type":"ADDED","insertions":210,"deletions":0},{"file":"test/volumes-list-sizes.test.js","type":"ADDED","insertions":112,"deletions":0},{"file":"test/volumes-no-fabric-network.test.js","type":"ADDED","insertions":110,"deletions":0},{"file":"test/volumes-size.test.js","type":"ADDED","insertions":227,"deletions":0},{"file":"test/volumes-update-name.test.js","type":"ADDED","insertions":165,"deletions":0},{"file":"test/volumes.unavailable-size.test.js","type":"ADDED","insertions":121,"deletions":0}],"sizeInsertions":4473,"sizeDeletions":-275},{"number":"23","revision":"3cd1e64ff3c83a0f2fa946407e1b7575a0f9411c","parents":["945d2921b9d3d4a91fec80c08cd339c8d0312af0"],"ref":"refs/changes/28/2528/23","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1510002375,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1510002406,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":30,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"etc/cloudapi.coal.cfg","type":"DELETED","insertions":0,"deletions":-184},{"file":"lib/app.js","type":"MODIFIED","insertions":33,"deletions":-9},{"file":"lib/endpoints/networks.js","type":"MODIFIED","insertions":3,"deletions":-4},{"file":"lib/endpoints/volumes.js","type":"ADDED","insertions":663,"deletions":0},{"file":"lib/errors.js","type":"MODIFIED","insertions":58,"deletions":-1},{"file":"lib/machines.js","type":"MODIFIED","insertions":214,"deletions":-31},{"file":"lib/middleware/networks.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"lib/units.js","type":"ADDED","insertions":13,"deletions":0},{"file":"lib/validation/predicate.js","type":"ADDED","insertions":82,"deletions":0},{"file":"lib/validation/volumes.js","type":"ADDED","insertions":172,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"sapi_manifests/cloudapi/template","type":"MODIFIED","insertions":16,"deletions":-2},{"file":"test/auth.test.js","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"test/common.js","type":"MODIFIED","insertions":19,"deletions":-2},{"file":"test/fabrics.test.js","type":"MODIFIED","insertions":5,"deletions":-36},{"file":"test/keys.test.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"test/lib/config.js","type":"ADDED","insertions":47,"deletions":0},{"file":"test/lib/networks.js","type":"ADDED","insertions":43,"deletions":0},{"file":"test/lib/volumes.js","type":"ADDED","insertions":85,"deletions":0},{"file":"test/nics.test.js","type":"MODIFIED","insertions":50,"deletions":0},{"file":"test/volumes-automount.test.js","type":"ADDED","insertions":695,"deletions":0},{"file":"test/volumes-basic.test.js","type":"ADDED","insertions":396,"deletions":0},{"file":"test/volumes-create-name.test.js","type":"ADDED","insertions":147,"deletions":0},{"file":"test/volumes-create-validation.test.js","type":"ADDED","insertions":172,"deletions":0},{"file":"test/volumes-get.test.js","type":"ADDED","insertions":59,"deletions":0},{"file":"test/volumes-list-params-validation.test.js","type":"ADDED","insertions":533,"deletions":0},{"file":"test/volumes-list-predicate-validation.test.js","type":"ADDED","insertions":210,"deletions":0},{"file":"test/volumes-list-sizes.test.js","type":"ADDED","insertions":112,"deletions":0},{"file":"test/volumes-no-fabric-network.test.js","type":"ADDED","insertions":110,"deletions":0},{"file":"test/volumes-size.test.js","type":"ADDED","insertions":227,"deletions":0},{"file":"test/volumes-update-name.test.js","type":"ADDED","insertions":165,"deletions":0},{"file":"test/volumes.unavailable-size.test.js","type":"ADDED","insertions":121,"deletions":0}],"sizeInsertions":4469,"sizeDeletions":-276},{"number":"24","revision":"d7749119581f0b743bd2f5b688454f697377bd90","parents":["945d2921b9d3d4a91fec80c08cd339c8d0312af0"],"ref":"refs/changes/28/2528/24","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1510008596,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1510008627,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1510012112,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":30,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"etc/cloudapi.coal.cfg","type":"DELETED","insertions":0,"deletions":-184},{"file":"lib/app.js","type":"MODIFIED","insertions":33,"deletions":-9},{"file":"lib/endpoints/networks.js","type":"MODIFIED","insertions":3,"deletions":-4},{"file":"lib/endpoints/volumes.js","type":"ADDED","insertions":663,"deletions":0},{"file":"lib/errors.js","type":"MODIFIED","insertions":58,"deletions":-1},{"file":"lib/machines.js","type":"MODIFIED","insertions":214,"deletions":-31},{"file":"lib/middleware/networks.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"lib/units.js","type":"ADDED","insertions":13,"deletions":0},{"file":"lib/validation/predicate.js","type":"ADDED","insertions":82,"deletions":0},{"file":"lib/validation/volumes.js","type":"ADDED","insertions":165,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"sapi_manifests/cloudapi/template","type":"MODIFIED","insertions":16,"deletions":-2},{"file":"test/auth.test.js","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"test/common.js","type":"MODIFIED","insertions":19,"deletions":-2},{"file":"test/fabrics.test.js","type":"MODIFIED","insertions":5,"deletions":-36},{"file":"test/keys.test.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"test/lib/config.js","type":"ADDED","insertions":47,"deletions":0},{"file":"test/lib/networks.js","type":"ADDED","insertions":43,"deletions":0},{"file":"test/lib/volumes.js","type":"ADDED","insertions":85,"deletions":0},{"file":"test/nics.test.js","type":"MODIFIED","insertions":50,"deletions":0},{"file":"test/volumes-automount.test.js","type":"ADDED","insertions":695,"deletions":0},{"file":"test/volumes-basic.test.js","type":"ADDED","insertions":396,"deletions":0},{"file":"test/volumes-create-name.test.js","type":"ADDED","insertions":147,"deletions":0},{"file":"test/volumes-create-validation.test.js","type":"ADDED","insertions":172,"deletions":0},{"file":"test/volumes-get.test.js","type":"ADDED","insertions":59,"deletions":0},{"file":"test/volumes-list-params-validation.test.js","type":"ADDED","insertions":533,"deletions":0},{"file":"test/volumes-list-predicate-validation.test.js","type":"ADDED","insertions":210,"deletions":0},{"file":"test/volumes-list-sizes.test.js","type":"ADDED","insertions":112,"deletions":0},{"file":"test/volumes-no-fabric-network.test.js","type":"ADDED","insertions":110,"deletions":0},{"file":"test/volumes-size.test.js","type":"ADDED","insertions":227,"deletions":0},{"file":"test/volumes-update-name.test.js","type":"ADDED","insertions":165,"deletions":0},{"file":"test/volumes.unavailable-size.test.js","type":"ADDED","insertions":121,"deletions":0}],"sizeInsertions":4462,"sizeDeletions":-276},{"number":"25","revision":"7da307a90d9b1e57c2f99d540834a8c47c4af7c6","parents":["945d2921b9d3d4a91fec80c08cd339c8d0312af0"],"ref":"refs/changes/28/2528/25","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1510013407,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1510013438,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1510014837,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":30,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"etc/cloudapi.coal.cfg","type":"DELETED","insertions":0,"deletions":-184},{"file":"lib/app.js","type":"MODIFIED","insertions":33,"deletions":-9},{"file":"lib/endpoints/networks.js","type":"MODIFIED","insertions":3,"deletions":-4},{"file":"lib/endpoints/volumes.js","type":"ADDED","insertions":663,"deletions":0},{"file":"lib/errors.js","type":"MODIFIED","insertions":58,"deletions":-1},{"file":"lib/machines.js","type":"MODIFIED","insertions":214,"deletions":-31},{"file":"lib/middleware/networks.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"lib/units.js","type":"ADDED","insertions":13,"deletions":0},{"file":"lib/validation/predicate.js","type":"ADDED","insertions":82,"deletions":0},{"file":"lib/validation/volumes.js","type":"ADDED","insertions":165,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"sapi_manifests/cloudapi/template","type":"MODIFIED","insertions":16,"deletions":-2},{"file":"test/auth.test.js","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"test/common.js","type":"MODIFIED","insertions":19,"deletions":-2},{"file":"test/fabrics.test.js","type":"MODIFIED","insertions":5,"deletions":-36},{"file":"test/keys.test.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"test/lib/config.js","type":"ADDED","insertions":47,"deletions":0},{"file":"test/lib/networks.js","type":"ADDED","insertions":43,"deletions":0},{"file":"test/lib/volumes.js","type":"ADDED","insertions":85,"deletions":0},{"file":"test/nics.test.js","type":"MODIFIED","insertions":50,"deletions":0},{"file":"test/volumes-automount.test.js","type":"ADDED","insertions":695,"deletions":0},{"file":"test/volumes-basic.test.js","type":"ADDED","insertions":396,"deletions":0},{"file":"test/volumes-create-name.test.js","type":"ADDED","insertions":147,"deletions":0},{"file":"test/volumes-create-validation.test.js","type":"ADDED","insertions":172,"deletions":0},{"file":"test/volumes-get.test.js","type":"ADDED","insertions":59,"deletions":0},{"file":"test/volumes-list-params-validation.test.js","type":"ADDED","insertions":533,"deletions":0},{"file":"test/volumes-list-predicate-validation.test.js","type":"ADDED","insertions":210,"deletions":0},{"file":"test/volumes-list-sizes.test.js","type":"ADDED","insertions":112,"deletions":0},{"file":"test/volumes-no-fabric-network.test.js","type":"ADDED","insertions":110,"deletions":0},{"file":"test/volumes-size.test.js","type":"ADDED","insertions":227,"deletions":0},{"file":"test/volumes-update-name.test.js","type":"ADDED","insertions":165,"deletions":0},{"file":"test/volumes.unavailable-size.test.js","type":"ADDED","insertions":121,"deletions":0}],"sizeInsertions":4462,"sizeDeletions":-276},{"number":"26","revision":"b045465eb45c03ced574d7944b322177d6415ee8","parents":["945d2921b9d3d4a91fec80c08cd339c8d0312af0"],"ref":"refs/changes/28/2528/26","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1510192166,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1510192197,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1510195960,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}}],"comments":[{"file":"lib/machines.js","line":1200,"reviewer":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},"message":"Not necessary."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":30,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"etc/cloudapi.coal.cfg","type":"DELETED","insertions":0,"deletions":-184},{"file":"lib/app.js","type":"MODIFIED","insertions":33,"deletions":-9},{"file":"lib/endpoints/networks.js","type":"MODIFIED","insertions":3,"deletions":-4},{"file":"lib/endpoints/volumes.js","type":"ADDED","insertions":663,"deletions":0},{"file":"lib/errors.js","type":"MODIFIED","insertions":58,"deletions":-1},{"file":"lib/machines.js","type":"MODIFIED","insertions":214,"deletions":-31},{"file":"lib/middleware/networks.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"lib/units.js","type":"ADDED","insertions":13,"deletions":0},{"file":"lib/validation/predicate.js","type":"ADDED","insertions":82,"deletions":0},{"file":"lib/validation/volumes.js","type":"ADDED","insertions":165,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"sapi_manifests/cloudapi/template","type":"MODIFIED","insertions":16,"deletions":-2},{"file":"test/auth.test.js","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"test/common.js","type":"MODIFIED","insertions":19,"deletions":-2},{"file":"test/fabrics.test.js","type":"MODIFIED","insertions":5,"deletions":-36},{"file":"test/keys.test.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"test/lib/config.js","type":"ADDED","insertions":47,"deletions":0},{"file":"test/lib/networks.js","type":"ADDED","insertions":43,"deletions":0},{"file":"test/lib/volumes.js","type":"ADDED","insertions":85,"deletions":0},{"file":"test/nics.test.js","type":"MODIFIED","insertions":50,"deletions":0},{"file":"test/volumes-automount.test.js","type":"ADDED","insertions":695,"deletions":0},{"file":"test/volumes-basic.test.js","type":"ADDED","insertions":396,"deletions":0},{"file":"test/volumes-create-name.test.js","type":"ADDED","insertions":147,"deletions":0},{"file":"test/volumes-create-validation.test.js","type":"ADDED","insertions":172,"deletions":0},{"file":"test/volumes-get.test.js","type":"ADDED","insertions":59,"deletions":0},{"file":"test/volumes-list-params-validation.test.js","type":"ADDED","insertions":533,"deletions":0},{"file":"test/volumes-list-predicate-validation.test.js","type":"ADDED","insertions":210,"deletions":0},{"file":"test/volumes-list-sizes.test.js","type":"ADDED","insertions":112,"deletions":0},{"file":"test/volumes-no-fabric-network.test.js","type":"ADDED","insertions":110,"deletions":0},{"file":"test/volumes-size.test.js","type":"ADDED","insertions":227,"deletions":0},{"file":"test/volumes-update-name.test.js","type":"ADDED","insertions":165,"deletions":0},{"file":"test/volumes.unavailable-size.test.js","type":"ADDED","insertions":121,"deletions":0}],"sizeInsertions":4462,"sizeDeletions":-276},{"number":"27","revision":"644ad3ef3665b4826b75d217af7f5122c724e1ce","parents":["945d2921b9d3d4a91fec80c08cd339c8d0312af0"],"ref":"refs/changes/28/2528/27","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1510259526,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1510259561,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1510341128,"by":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1510262745,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":30,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"etc/cloudapi.coal.cfg","type":"DELETED","insertions":0,"deletions":-184},{"file":"lib/app.js","type":"MODIFIED","insertions":33,"deletions":-9},{"file":"lib/endpoints/networks.js","type":"MODIFIED","insertions":3,"deletions":-4},{"file":"lib/endpoints/volumes.js","type":"ADDED","insertions":663,"deletions":0},{"file":"lib/errors.js","type":"MODIFIED","insertions":58,"deletions":-1},{"file":"lib/machines.js","type":"MODIFIED","insertions":214,"deletions":-31},{"file":"lib/middleware/networks.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"lib/units.js","type":"ADDED","insertions":13,"deletions":0},{"file":"lib/validation/predicate.js","type":"ADDED","insertions":82,"deletions":0},{"file":"lib/validation/volumes.js","type":"ADDED","insertions":165,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"sapi_manifests/cloudapi/template","type":"MODIFIED","insertions":16,"deletions":-2},{"file":"test/auth.test.js","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"test/common.js","type":"MODIFIED","insertions":19,"deletions":-2},{"file":"test/fabrics.test.js","type":"MODIFIED","insertions":5,"deletions":-36},{"file":"test/keys.test.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"test/lib/config.js","type":"ADDED","insertions":47,"deletions":0},{"file":"test/lib/networks.js","type":"ADDED","insertions":43,"deletions":0},{"file":"test/lib/volumes.js","type":"ADDED","insertions":85,"deletions":0},{"file":"test/nics.test.js","type":"MODIFIED","insertions":50,"deletions":0},{"file":"test/volumes-automount.test.js","type":"ADDED","insertions":695,"deletions":0},{"file":"test/volumes-basic.test.js","type":"ADDED","insertions":396,"deletions":0},{"file":"test/volumes-create-name.test.js","type":"ADDED","insertions":147,"deletions":0},{"file":"test/volumes-create-validation.test.js","type":"ADDED","insertions":172,"deletions":0},{"file":"test/volumes-get.test.js","type":"ADDED","insertions":59,"deletions":0},{"file":"test/volumes-list-params-validation.test.js","type":"ADDED","insertions":533,"deletions":0},{"file":"test/volumes-list-predicate-validation.test.js","type":"ADDED","insertions":210,"deletions":0},{"file":"test/volumes-list-sizes.test.js","type":"ADDED","insertions":112,"deletions":0},{"file":"test/volumes-no-fabric-network.test.js","type":"ADDED","insertions":110,"deletions":0},{"file":"test/volumes-size.test.js","type":"ADDED","insertions":227,"deletions":0},{"file":"test/volumes-update-name.test.js","type":"ADDED","insertions":165,"deletions":0},{"file":"test/volumes.unavailable-size.test.js","type":"ADDED","insertions":121,"deletions":0}],"sizeInsertions":4462,"sizeDeletions":-276},{"number":"28","revision":"788a08f881b5063d2924aa1ce6a2c4282392d883","parents":["945d2921b9d3d4a91fec80c08cd339c8d0312af0"],"ref":"refs/changes/28/2528/28","uploader":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},"createdOn":1510341205,"author":{"name":"Julien Gilli","email":"julien.gilli@joyent.com","username":""},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1510259561,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1510341128,"by":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}},{"type":"SUBM","value":"1","grantedOn":1510341218,"by":{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1510262745,"by":{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":32,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":5,"deletions":-2},{"file":"etc/cloudapi.coal.cfg","type":"DELETED","insertions":0,"deletions":-184},{"file":"lib/app.js","type":"MODIFIED","insertions":33,"deletions":-9},{"file":"lib/endpoints/networks.js","type":"MODIFIED","insertions":3,"deletions":-4},{"file":"lib/endpoints/volumes.js","type":"ADDED","insertions":663,"deletions":0},{"file":"lib/errors.js","type":"MODIFIED","insertions":58,"deletions":-1},{"file":"lib/machines.js","type":"MODIFIED","insertions":214,"deletions":-31},{"file":"lib/middleware/networks.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"lib/units.js","type":"ADDED","insertions":13,"deletions":0},{"file":"lib/validation/predicate.js","type":"ADDED","insertions":82,"deletions":0},{"file":"lib/validation/volumes.js","type":"ADDED","insertions":165,"deletions":0},{"file":"package.json","type":"MODIFIED","insertions":3,"deletions":-2},{"file":"sapi_manifests/cloudapi/template","type":"MODIFIED","insertions":16,"deletions":-2},{"file":"test/auth.test.js","type":"MODIFIED","insertions":5,"deletions":-1},{"file":"test/common.js","type":"MODIFIED","insertions":19,"deletions":-2},{"file":"test/fabrics.test.js","type":"MODIFIED","insertions":5,"deletions":-36},{"file":"test/keys.test.js","type":"MODIFIED","insertions":3,"deletions":-1},{"file":"test/lib/config.js","type":"ADDED","insertions":47,"deletions":0},{"file":"test/lib/networks.js","type":"ADDED","insertions":43,"deletions":0},{"file":"test/lib/volumes.js","type":"ADDED","insertions":85,"deletions":0},{"file":"test/nics.test.js","type":"MODIFIED","insertions":50,"deletions":0},{"file":"test/volumes-automount.test.js","type":"ADDED","insertions":695,"deletions":0},{"file":"test/volumes-basic.test.js","type":"ADDED","insertions":396,"deletions":0},{"file":"test/volumes-create-name.test.js","type":"ADDED","insertions":147,"deletions":0},{"file":"test/volumes-create-validation.test.js","type":"ADDED","insertions":172,"deletions":0},{"file":"test/volumes-get.test.js","type":"ADDED","insertions":59,"deletions":0},{"file":"test/volumes-list-params-validation.test.js","type":"ADDED","insertions":533,"deletions":0},{"file":"test/volumes-list-predicate-validation.test.js","type":"ADDED","insertions":210,"deletions":0},{"file":"test/volumes-list-sizes.test.js","type":"ADDED","insertions":112,"deletions":0},{"file":"test/volumes-no-fabric-network.test.js","type":"ADDED","insertions":110,"deletions":0},{"file":"test/volumes-size.test.js","type":"ADDED","insertions":227,"deletions":0},{"file":"test/volumes-update-name.test.js","type":"ADDED","insertions":165,"deletions":0},{"file":"test/volumes.unavailable-size.test.js","type":"ADDED","insertions":121,"deletions":0}],"sizeInsertions":4462,"sizeDeletions":-276}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Pedro Palazón Candel","email":"pedro@joyent.com","username":"kusor"},{"name":"Marsell Kukuljevic","email":"marsell@joyent.com","username":"marsell"},{"name":"Julien Gilli","email":"jgilli@netflix.com","username":"misterdjules"},{"name":"Orlando Vazquez","email":"orlando@joyent.com","username":"orlandov"},{"name":"Todd Whiteman","email":"todd.whiteman@joyent.com","username":"twhiteman"}]}