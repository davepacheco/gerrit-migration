{"project":"joyent/node-manta","branch":"master","id":"I2cd2b3809d4d70ec784d29f3be82deba27ad41b6","number":"5292","subject":"joyent/node-manta#358 mchmod command stopped working after v5.1.1","owner":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"url":"https://cr.joyent.us/5292","commitMessage":"joyent/node-manta#358 mchmod command stopped working after v5.1.1\n","createdOn":1545940425,"lastUpdated":1546635156,"open":false,"status":"MERGED","comments":[{"timestamp":1545940425,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Uploaded patch set 1."},{"timestamp":1545940429,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Patch Set 1:\n\nNew commits:\n    \n    commit 5a93d7e34d446023e8068cdf25a1e2afbdc9acfe\n    \n    joyent/node-manta#358 mchmod command stopped working after v5.1.1"},{"timestamp":1545940453,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1545944143,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Patch Set 1:\n\nHere is the output of the new `mchmod` test cases without the fixes represented in this CR:\n\n```\n11:59:35:node-manta(grr-358 *) $ TEST_FILTER\u003dmchmod MANTA_TEST_ROLE\u003dread-only make test\nnpm install\nunset MANTA_DEFAULT_CONTENT_TYPE; \\\n        if [[ -z \"mchmod\" ]]; then \\\n                ./node_modules/.bin/nodeunit test/*.test.js; \\\n        else \\\n                echo \"# Running subset of tests matching TEST_FILTER\u003dmchmod\"; \\\n                ./node_modules/.bin/nodeunit  test/mchmod.test.js; \\\n        fi\n# Running subset of tests matching TEST_FILTER\u003dmchmod\n\nmchmod.test.js\n✔ setup: create test tree at /kelly.mclaughlin/stor/node-manta-test-mchmod-8fe4404c\n✔ minfo to verify lack of --role-tag header\n✖ mchmod to add role-tag\n\nVError: exec \"/home/kelly/.local/bin/mchmod -- +read-only /kelly.mclaughlin/stor/node-manta-test-mchmod-8fe4404c/01.data\": exited with status 1\n    at interpretChildProcessResult (/home/kelly/joyent/repos/node-manta/node_modules/forkexec/lib/forkexec.js:163:15)\n    at onChildExited (/home/kelly/joyent/repos/node-manta/node_modules/forkexec/lib/forkexec.js:75:9)\n    at /home/kelly/joyent/repos/node-manta/node_modules/forkexec/lib/forkexec.js:53:4\n    at ChildProcess.exithandler (child_process.js:206:5)\n    at emitTwo (events.js:106:13)\n    at ChildProcess.emit (events.js:191:7)\n    at maybeClose (internal/child_process.js:920:16)\n    at Socket.\u003canonymous\u003e (internal/child_process.js:351:11)\n    at emitOne (events.js:96:13)\n    at Socket.emit (events.js:188:7)\n    at Pipe._handle.close [as _onclose] (net.js:509:12)\n\nAssertion Message: no stderr\nAssertionError: \u0027\\nassert.js:357\\nassert.ifError \u003d function ifError(err) { if (err) throw err; };\\n                                                  ^\\nInvalidPathError: +read-only is not a valid Manta path\\n    at Object.getPath [as path] (/home/kelly/.local/lib/node_modules/manta/lib/client.js:319:15)\\n    at Object.assertPath (/home/kelly/.local/lib/node_mo\\\ndules/manta/lib/utils.js:19:15)\\n    at getPath (/home/kelly/.local/lib/node_modules/manta/lib/options.js:84:46)\\n    at Array.map (native)\\n    at Object.parseOptions (/home/kelly/.local/lib/node_modules/manta/lib/options.js:87:29)\\n    at main (/home/kelly/.local/lib/node_modules/manta/bin/mchmod:88:25)\\n    at Object.\u003canonymous\u003e (/home/kelly/.local/lib/node\\\n_modules/manta/bin/mchmod:145:3)\\n    at Module._compile (module.js:577:32)\\n    at Object.Module._extensions..js (module.js:586:10)\\n    at Module.load (module.js:494:32)\\n\u0027 \u003d\u003d \u0027\u0027\n    at Object.equal (/home/kelly/joyent/repos/node-manta/node_modules/nodeunit/lib/types.js:83:39)\n    at /home/kelly/joyent/repos/node-manta/test/mchmod.test.js:192:18\n    at onChildExited (/home/kelly/joyent/repos/node-manta/node_modules/forkexec/lib/forkexec.js:83:2)\n    at /home/kelly/joyent/repos/node-manta/node_modules/forkexec/lib/forkexec.js:53:4\n    at ChildProcess.exithandler (child_process.js:206:5)\n    at emitTwo (events.js:106:13)\n    at ChildProcess.emit (events.js:191:7)\n    at maybeClose (internal/child_process.js:920:16)\n    at Socket.\u003canonymous\u003e (internal/child_process.js:351:11)\n    at emitOne (events.js:96:13)\n    at Socket.emit (events.js:188:7)\n    at Pipe._handle.close [as _onclose] (net.js:509:12)\n\nAssertion Message: minfo response contains role-tag header\nAssertionError: -1 !\u003d -1\n    at Object.notEqual (/home/kelly/joyent/repos/node-manta/node_modules/nodeunit/lib/types.js:83:39)\n    at /home/kelly/joyent/repos/node-manta/test/mchmod.test.js:201:25\n    at onChildExited (/home/kelly/joyent/repos/node-manta/node_modules/forkexec/lib/forkexec.js:83:2)\n    at /home/kelly/joyent/repos/node-manta/node_modules/forkexec/lib/forkexec.js:53:4\n    at ChildProcess.exithandler (child_process.js:190:7)\n    at emitTwo (events.js:106:13)\n    at ChildProcess.emit (events.js:191:7)\n    at maybeClose (internal/child_process.js:920:16)\n    at Process.ChildProcess._handle.onexit (internal/child_process.js:230:5)\n\n✖ mchmod to remove role-tag\n\nVError: exec \"/home/kelly/.local/bin/mchmod -- -read-only /kelly.mclaughlin/stor/node-manta-test-mchmod-8fe4404c/01.data\": exited with status 1\n    at interpretChildProcessResult (/home/kelly/joyent/repos/node-manta/node_modules/forkexec/lib/forkexec.js:163:15)\n    at onChildExited (/home/kelly/joyent/repos/node-manta/node_modules/forkexec/lib/forkexec.js:75:9)\n    at /home/kelly/joyent/repos/node-manta/node_modules/forkexec/lib/forkexec.js:53:4\n    at ChildProcess.exithandler (child_process.js:206:5)\n    at emitTwo (events.js:106:13)\n    at ChildProcess.emit (events.js:191:7)\n    at maybeClose (internal/child_process.js:920:16)\n    at Process.ChildProcess._handle.onexit (internal/child_process.js:230:5)\n\nAssertion Message: no stderr\nAssertionError: \u0027\\nassert.js:357\\nassert.ifError \u003d function ifError(err) { if (err) throw err; };\\n                                                  ^\\nInvalidPathError: -read-only is not a valid Manta path\\n    at Object.getPath [as path] (/home/kelly/.local/lib/node_modules/manta/lib/client.js:319:15)\\n    at Object.assertPath (/home/kelly/.local/lib/node_mo\\\ndules/manta/lib/utils.js:19:15)\\n    at getPath (/home/kelly/.local/lib/node_modules/manta/lib/options.js:84:46)\\n    at Array.map (native)\\n    at Object.parseOptions (/home/kelly/.local/lib/node_modules/manta/lib/options.js:87:29)\\n    at main (/home/kelly/.local/lib/node_modules/manta/bin/mchmod:88:25)\\n    at Object.\u003canonymous\u003e (/home/kelly/.local/lib/node\\\n_modules/manta/bin/mchmod:145:3)\\n    at Module._compile (module.js:577:32)\\n    at Object.Module._extensions..js (module.js:586:10)\\n    at Module.load (module.js:494:32)\\n\u0027 \u003d\u003d \u0027\u0027\n    at Object.equal (/home/kelly/joyent/repos/node-manta/node_modules/nodeunit/lib/types.js:83:39)\n    at /home/kelly/joyent/repos/node-manta/test/mchmod.test.js:232:18\n    at onChildExited (/home/kelly/joyent/repos/node-manta/node_modules/forkexec/lib/forkexec.js:83:2)\n    at /home/kelly/joyent/repos/node-manta/node_modules/forkexec/lib/forkexec.js:53:4\n    at ChildProcess.exithandler (child_process.js:206:5)\n    at emitTwo (events.js:106:13)\n    at ChildProcess.emit (events.js:191:7)\n    at maybeClose (internal/child_process.js:920:16)\n    at Process.ChildProcess._handle.onexit (internal/child_process.js:230:5)\n\n✔ cleanup: rm test tree /kelly.mclaughlin/stor/node-manta-test-mchmod-8fe4404c\n✔ cleanup: rm tmp directory /tmp\n\nFAILURES: 5/15 assertions failed (19956ms)\nmake: *** [Makefile:54: test] Error 1\n```\n\nAnd here is the output of those same tests with these changes in place:\n\n```\n12:00:11:node-manta(grr-358 *) $ TEST_FILTER\u003dmchmod MANTA_TEST_ROLE\u003dread-only make test\nnpm install\nunset MANTA_DEFAULT_CONTENT_TYPE; \\\n        if [[ -z \"mchmod\" ]]; then \\\n                ./node_modules/.bin/nodeunit test/*.test.js; \\\n        else \\\n                echo \"# Running subset of tests matching TEST_FILTER\u003dmchmod\"; \\\n                ./node_modules/.bin/nodeunit  test/mchmod.test.js; \\\n        fi\n# Running subset of tests matching TEST_FILTER\u003dmchmod\n\nmchmod.test.js\n✔ setup: create test tree at /kelly.mclaughlin/stor/node-manta-test-mchmod-12897955\n✔ minfo to verify lack of --role-tag header\n✔ mchmod to add role-tag\n✔ mchmod to remove role-tag\n✔ cleanup: rm test tree /kelly.mclaughlin/stor/node-manta-test-mchmod-12897955\n✔ cleanup: rm tmp directory /tmp\n```\n\nAdditionally, here is the output from the full `node-manta` test suite with these changes:\n\n```\n12:03:51:node-manta(grr-358 *) $ MANTA_TEST_ROLE\u003dread-only make test\nnpm install\nunset MANTA_DEFAULT_CONTENT_TYPE; \\\n\tif [[ -z \"\" ]]; then \\\n\t\t./node_modules/.bin/nodeunit test/*.test.js; \\\n\telse \\\n\t\techo \"# Running subset of tests matching TEST_FILTER\u003d\"; \\\n\t\t./node_modules/.bin/nodeunit  test/client.test.js test/completion.test.js test/mchmod.test.js test/mfind.test.js test/mget.test.js test/mjob-simple.test.js test/mln.test.js test/mmkdir.test.js test/mmpu.test.js test/mput.test.js test/mrmdir.test.js test/mrm.test.js test/msign.test.js test/muntar.test.js test/options.test.js test/trackmarker.test.js test/utils.test.js; \\\n\tfi\n\nclient.test.js\n✔ mkdir\n✔ mkdir (sub)\n✔ put\n✔ #231: put (special characters)\n✔ #231: ls (special characters)\n✔ #231: get (special characters)\n✔ #231: rm (special characters)\n✔ chattr\n✔ put (zero byte streaming)\n✔ put without mkdirp\n✔ put with mkdirp\n✔ streams\n✔ put MD5 mismatch\n✔ GH-72 content-length: undefined\n✔ ls\n✔ createListStream\n✔ createListStream (dir only)\n✔ createListStream (object only)\n✔ ln\n✔ info (link)\n✔ ftw\n✔ create job (simple grep)\n✔ get job\n✔ add input keys\n✔ get job input\n✔ end job\n✔ wait for job\n✔ get job output\n✔ create and cancel job\n✔ unlink object\n✔ unlink link\n✔ rmr\n✔ mkdirp/rmr\n✔ create upload\n✔ upload part\n✔ get upload\n✔ commit upload\n✔ errant commit upload returns undefined res\n✔ abort upload\n✔ #311: create upload with special headers\n✔ GH-196 getPath ~~/\n✔ #180: Invalid key results in no client error\n✔ MANTA-2812 null signer\n✔ MANTA-2812 undefined signer\n\ncompletion.test.js\n✔ mchattr --completion\n✔ mchmod --completion\n✔ mfind --completion\n✔ mget --completion\n✔ minfo --completion\n✔ mjob --completion\n✔ mln --completion\n✔ mlogin --completion\n✔ mls --completion\n✔ mmd5 --completion\n✔ mmkdir --completion\n✔ mmpu --completion\n✔ mput --completion\n✔ mrm --completion\n✔ mrmdir --completion\n✔ msign --completion\n✔ muntar --completion\n\nmchmod.test.js\n✔ setup: create test tree at /kelly.mclaughlin/stor/node-manta-test-mchmod-d1dee24b\n✔ minfo to verify lack of --role-tag header\n✔ mchmod to add role-tag\n✔ mchmod to remove role-tag\n✔ cleanup: rm test tree /kelly.mclaughlin/stor/node-manta-test-mchmod-d1dee24b\n✔ cleanup: rm tmp directory /tmp\n\nmfind.test.js\n✔ setup: create test tree at /kelly.mclaughlin/stor/node-manta-test-mfind-b52f3019\n✔ check if operator (mfind forbidden)\n✔ mfind (no arguments)\n✔ mfind TESTDIR\n✔ mfind TESTDIR TESTDIR (same argument multiple times)\n✔ mfind -j TESTDIR\n✔ mfind TESTDIR/afile.txt\n✔ mfind TESTDIR/notafile.txt\n✔ mfind TESTDIR/notafile.txt TESTDIR/afile.txt\nWARNING: skipping mfind forbidden test: user is an operator\n✔ mfind /poseidon/stor TESTDIR/afile.txt\n✔ cleanup: rm test tree /kelly.mclaughlin/stor/node-manta-test-mfind-b52f3019\n\nmget.test.js\n✔ setup: create test tree at /kelly.mclaughlin/stor/node-manta-test-mget-d79bf025\n✔ mget TESTDIR/02.data\n✔ mget TESTDIR/01.data TESTDIR/02.data TESTDIR/03.data\n✔ mget TESTDIR/01.txt TESTDIR/02.txt TESTDIR/03.txt\n✔ mget -o TMPFILE TESTDIR/01.txt TESTDIR/02.txt TESTDIR/03.txt\n✔ mget -O TESTDIR/01.txt\n✔ mget TESTDIR/01.txt TESTDIR/02.txt TESTDIR/XX.txt TESTDIR/03.txt\n✔ mget -o TMPFILE TESTDIR/01.txt TESTDIR/02.txt TESTDIR/XX.txt TESTDIR/03.txt\n✔ cleanup: rm test tree /kelly.mclaughlin/stor/node-manta-test-mget-d79bf025\n\nmjob-simple.test.js\n✔ mjob create --close -or \"echo hello\"\n\nmln.test.js\n✔ setup: create test tree at /kelly.mclaughlin/stor/node-manta-test-mput-2330fab9\n✔ mln \n✔ mln with --role-tag option\n✔ cleanup: rm test tree /kelly.mclaughlin/stor/node-manta-test-mput-2330fab9\n✔ cleanup: rm tmp directory /tmp\n\nmmkdir.test.js\n✔ mmkdir with --role-tag option\n✔ cleanup: rm test directory /kelly.mclaughlin/stor/node-manta-test-mput-73a55298\n\nmmpu.test.js\n✔ mmpu create C_OBJ_PATH -c 1 -H m-custom-header:foo -s TEXT_SIZE -m TEXT_MD5\n✔ mmpu get C_ID\n✔ mmpu create A_OBJ_PATH -c 1 -s TEXT_SIZE -m TEXT_MD5-H durability-level 3 -H content-length:10 -H content-md5:foo\n✔ mmpu get A_ID\n✔ mmpu parts C_ID: pre-upload\n✔ mmpu parts A_ID: pre-upload\n✔ mmpu list\n✔ mmpu upload C_ID 0 -f tmpFile\n✔ mmpu upload A_ID 0\n✔ mmpu parts C_ID: post-upload\n✔ mmpu parts A_ID: post-upload\n✔ mmpu list -p\n✔ mmpu list: post part upload\n✔ mmpu commit C_ID C_ETAG0\n✔ mmpu abort A_ID\n\nmput.test.js\n✔ setup: create test tree at /kelly.mclaughlin/stor/node-manta-test-mput-8c6cbe28\n✔ mput with custom header value with colons\n✔ mput with --role-tag option\n✔ cleanup: rm test tree /kelly.mclaughlin/stor/node-manta-test-mput-8c6cbe28\n✔ cleanup: rm tmp directory /tmp\n\nmrmdir.test.js\n✔ setup: create test tree at /kelly.mclaughlin/stor/node-manta-test-mrmdir-d61f4fdf\n✔ mrmdir (no arguments)\n✔ mrmdir -I fails without tty\n✔ mrmdir 1 directory\n✔ remove remaining directories\n✔ ensure test tree is empty\n✔ cleanup: rm test tree /kelly.mclaughlin/stor/node-manta-test-mrmdir-d61f4fdf\n\nmrm.test.js\n✔ setup: create test tree at /kelly.mclaughlin/stor/node-manta-test-mrm-c3d5b591\n✔ mrm (no arguments)\n✔ mrm -I fails without tty\n✔ mrm 1 directory\n✔ remove remaining directories\n✔ mrm 1 object\n✔ remove remaining objects\n✔ ensure test tree is empty\n✔ cleanup: rm test tree /kelly.mclaughlin/stor/node-manta-test-mrm-c3d5b591\n\nmsign.test.js\n✔ msign (no arguments)\n✔ msign ~~/stor/foo\n✔ msign -e \u003cexpires\u003e ~~/stor/foo\n✔ msign -E 1h ~~/stor/foo\n✔ msign -E 1s ~~/stor/foo (good argument)\n✔ msign -E 1m ~~/stor/foo (good argument)\n✔ msign -E 1h ~~/stor/foo (good argument)\n✔ msign -E 1d ~~/stor/foo (good argument)\n✔ msign -E 1w ~~/stor/foo (good argument)\n✔ msign -E 1y ~~/stor/foo (good argument)\n✔ msign -E foo ~~/stor/foo (bad argument)\n✔ msign -E  ~~/stor/foo (bad argument)\n✔ msign -E -5s ~~/stor/foo (bad argument)\n✔ msign -E 74q ~~/stor/foo (bad argument)\n✔ msign -E 0s ~~/stor/foo (bad argument)\n✔ msign -E 0m ~~/stor/foo (bad argument)\n✔ msign -E 0h ~~/stor/foo (bad argument)\n✔ msign -E 0d ~~/stor/foo (bad argument)\n✔ msign -E 0w ~~/stor/foo (bad argument)\n✔ msign -E 0y ~~/stor/foo (bad argument)\n✔ msign -E and -e together\n\nmuntar.test.js\n✔ muntar case 0: corpus/tar1.tar\n\noptions.test.js\n✔ Run commands with --help with no manta URL specified\n✔ Run commands with --version with no manta URL specified\n\ntrackmarker.test.js\n✔ pages by name\n✔ pages by mtime\n\nutils.test.js\n✔ escapePath encoding\n✔ prettyBytes\n\nOK: 615 assertions (359095ms)\n```"},{"timestamp":1546454696,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 1:\n\n(5 comments)\n\nthe code itself looks good to me and thanks for the test output.  besides the copyright dates, i have some nits that you can feel to ignore or implement if you\u0027d like - not a huge deal to me."},{"timestamp":1546541006,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Uploaded patch set 2."},{"timestamp":1546541009,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Patch Set 2:\n\nNew commits:\n    \n    commit c13152a13bccb6bc45c6d6e049f00e4ec8e51f25\n    \n    Updates based on review feedback"},{"timestamp":1546541036,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing-1\n\n(4 comments)\n\n\"make check\" exited with status 2"},{"timestamp":1546541207,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Uploaded patch set 3."},{"timestamp":1546541214,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Patch Set 3:\n\nNew commits:\n    \n    commit 139312581807aff19cba478154ce185dc026e2f2\n    \n    Pacify jsstyle"},{"timestamp":1546541236,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1546541430,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Patch Set 1:\n\n(5 comments)"},{"timestamp":1546541519,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Uploaded patch set 4."},{"timestamp":1546541521,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Patch Set 4:\n\nNew commits:\n    \n    commit 73f3f47266d69156e70bb93e81d00f5c7401d7f8\n    \n    Update changelog"},{"timestamp":1546541548,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1546552952,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 4: Code-Review+1\n\nIf the tests pass for this then I\u0027ll give it IA"},{"timestamp":1546555800,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Patch Set 4:\n\n\u003e If the tests pass for this then I\u0027ll give it IA\n\nI did rerun the test suite after the last set of changes and it was all good. Here\u0027s the output from that:\n\n```\n11:24:54:node-manta(grr-358 *) $ MANTA_TEST_ROLE\u003dread-only make test\nnpm install\nunset MANTA_DEFAULT_CONTENT_TYPE; \\\n\tif [[ -z \"\" ]]; then \\\n\t\t./node_modules/.bin/nodeunit test/*.test.js; \\\n\telse \\\n\t\techo \"# Running subset of tests matching TEST_FILTER\u003d\"; \\\n\t\t./node_modules/.bin/nodeunit  test/client.test.js test/completion.test.js test/mchmod.test.js test/mfind.test.js test/mget.test.js test/mjob-simple.test.js test/mln.test.js test/mmkdir.test.js test/mmpu.test.js test/mput.test.js test/mrmdir.test.js test/mrm.test.js test/msign.test.js test/muntar.test.js test/options.test.js test/trackmarker.test.js test/utils.test.js; \\\n\tfi\n\nclient.test.js\n✔ mkdir\n✔ mkdir (sub)\n✔ put\n✔ #231: put (special characters)\n✔ #231: ls (special characters)\n✔ #231: get (special characters)\n✔ #231: rm (special characters)\n✔ chattr\n✔ put (zero byte streaming)\n✔ put without mkdirp\n✔ put with mkdirp\n✔ streams\n✔ put MD5 mismatch\n✔ GH-72 content-length: undefined\n✔ ls\n✔ createListStream\n✔ createListStream (dir only)\n✔ createListStream (object only)\n✔ ln\n✔ info (link)\n✔ ftw\n✔ create job (simple grep)\n✔ get job\n✔ add input keys\n✔ get job input\n✔ end job\n✔ wait for job\n✔ get job output\n✔ create and cancel job\n✔ unlink object\n✔ unlink link\n✔ rmr\n✔ mkdirp/rmr\n✔ create upload\n✔ upload part\n✔ get upload\n✔ commit upload\n✔ errant commit upload returns undefined res\n✔ abort upload\n✔ #311: create upload with special headers\n✔ GH-196 getPath ~~/\n✔ #180: Invalid key results in no client error\n✔ MANTA-2812 null signer\n✔ MANTA-2812 undefined signer\n\ncompletion.test.js\n✔ mchattr --completion\n✔ mchmod --completion\n✔ mfind --completion\n✔ mget --completion\n✔ minfo --completion\n✔ mjob --completion\n✔ mln --completion\n✔ mlogin --completion\n✔ mls --completion\n✔ mmd5 --completion\n✔ mmkdir --completion\n✔ mmpu --completion\n✔ mput --completion\n✔ mrm --completion\n✔ mrmdir --completion\n✔ msign --completion\n✔ muntar --completion\n\nmchmod.test.js\n✔ setup: create test tree at /kelly.mclaughlin/stor/node-manta-test-mchmod-186e45f7\n✔ minfo to verify lack of --role-tag header\n✔ mchmod to add role-tag\n✔ mchmod to remove role-tag\n✔ cleanup: rm test tree /kelly.mclaughlin/stor/node-manta-test-mchmod-186e45f7\n✔ cleanup: rm tmp directory /tmp\n\nmfind.test.js\n✔ setup: create test tree at /kelly.mclaughlin/stor/node-manta-test-mfind-2881f485\n✔ check if operator (mfind forbidden)\n✔ mfind (no arguments)\n✔ mfind TESTDIR\n✔ mfind TESTDIR TESTDIR (same argument multiple times)\n✔ mfind -j TESTDIR\n✔ mfind TESTDIR/afile.txt\n✔ mfind TESTDIR/notafile.txt\n✔ mfind TESTDIR/notafile.txt TESTDIR/afile.txt\nWARNING: skipping mfind forbidden test: user is an operator\n✔ mfind /poseidon/stor TESTDIR/afile.txt\n✔ cleanup: rm test tree /kelly.mclaughlin/stor/node-manta-test-mfind-2881f485\n\nmget.test.js\n✔ setup: create test tree at /kelly.mclaughlin/stor/node-manta-test-mget-a13a81a6\n✔ mget TESTDIR/02.data\n✔ mget TESTDIR/01.data TESTDIR/02.data TESTDIR/03.data\n✔ mget TESTDIR/01.txt TESTDIR/02.txt TESTDIR/03.txt\n✔ mget -o TMPFILE TESTDIR/01.txt TESTDIR/02.txt TESTDIR/03.txt\n✔ mget -O TESTDIR/01.txt\n✔ mget TESTDIR/01.txt TESTDIR/02.txt TESTDIR/XX.txt TESTDIR/03.txt\n✔ mget -o TMPFILE TESTDIR/01.txt TESTDIR/02.txt TESTDIR/XX.txt TESTDIR/03.txt\n✔ cleanup: rm test tree /kelly.mclaughlin/stor/node-manta-test-mget-a13a81a6\n\nmjob-simple.test.js\n✔ mjob create --close -or \"echo hello\"\n\nmln.test.js\n✔ setup: create test tree at /kelly.mclaughlin/stor/node-manta-test-mput-157a06c1\n✔ mln \n✔ mln with --role-tag option\n✔ cleanup: rm test tree /kelly.mclaughlin/stor/node-manta-test-mput-157a06c1\n✔ cleanup: rm tmp directory /tmp\n\nmmkdir.test.js\n✔ mmkdir with --role-tag option\n✔ cleanup: rm test directory /kelly.mclaughlin/stor/node-manta-test-mput-c5bcf269\n\nmmpu.test.js\n✔ mmpu create C_OBJ_PATH -c 1 -H m-custom-header:foo -s TEXT_SIZE -m TEXT_MD5\n✔ mmpu get C_ID\n✔ mmpu create A_OBJ_PATH -c 1 -s TEXT_SIZE -m TEXT_MD5-H durability-level 3 -H content-length:10 -H content-md5:foo\n✔ mmpu get A_ID\n✔ mmpu parts C_ID: pre-upload\n✔ mmpu parts A_ID: pre-upload\n✔ mmpu list\n✔ mmpu upload C_ID 0 -f tmpFile\n✔ mmpu upload A_ID 0\n✔ mmpu parts C_ID: post-upload\n✔ mmpu parts A_ID: post-upload\n✔ mmpu list -p\n✔ mmpu list: post part upload\n✔ mmpu commit C_ID C_ETAG0\n✔ mmpu abort A_ID\n\nmput.test.js\n✔ setup: create test tree at /kelly.mclaughlin/stor/node-manta-test-mput-82f3f21c\n✔ mput with custom header value with colons\n✔ mput with --role-tag option\n✔ cleanup: rm test tree /kelly.mclaughlin/stor/node-manta-test-mput-82f3f21c\n✔ cleanup: rm tmp directory /tmp\n\nmrmdir.test.js\n✔ setup: create test tree at /kelly.mclaughlin/stor/node-manta-test-mrmdir-ce2fb0e4\n✔ mrmdir (no arguments)\n✔ mrmdir -I fails without tty\n✔ mrmdir 1 directory\n✔ remove remaining directories\n✔ ensure test tree is empty\n✔ cleanup: rm test tree /kelly.mclaughlin/stor/node-manta-test-mrmdir-ce2fb0e4\n\nmrm.test.js\n✔ setup: create test tree at /kelly.mclaughlin/stor/node-manta-test-mrm-608d8290\n✔ mrm (no arguments)\n✔ mrm -I fails without tty\n✔ mrm 1 directory\n✔ remove remaining directories\n✔ mrm 1 object\n✔ remove remaining objects\n✔ ensure test tree is empty\n✔ cleanup: rm test tree /kelly.mclaughlin/stor/node-manta-test-mrm-608d8290\n\nmsign.test.js\n✔ msign (no arguments)\n✔ msign ~~/stor/foo\n✔ msign -e \u003cexpires\u003e ~~/stor/foo\n✔ msign -E 1h ~~/stor/foo\n✔ msign -E 1s ~~/stor/foo (good argument)\n✔ msign -E 1m ~~/stor/foo (good argument)\n✔ msign -E 1h ~~/stor/foo (good argument)\n✔ msign -E 1d ~~/stor/foo (good argument)\n✔ msign -E 1w ~~/stor/foo (good argument)\n✔ msign -E 1y ~~/stor/foo (good argument)\n✔ msign -E foo ~~/stor/foo (bad argument)\n✔ msign -E  ~~/stor/foo (bad argument)\n✔ msign -E -5s ~~/stor/foo (bad argument)\n✔ msign -E 74q ~~/stor/foo (bad argument)\n✔ msign -E 0s ~~/stor/foo (bad argument)\n✔ msign -E 0m ~~/stor/foo (bad argument)\n✔ msign -E 0h ~~/stor/foo (bad argument)\n✔ msign -E 0d ~~/stor/foo (bad argument)\n✔ msign -E 0w ~~/stor/foo (bad argument)\n✔ msign -E 0y ~~/stor/foo (bad argument)\n✔ msign -E and -e together\n\nmuntar.test.js\n✔ muntar case 0: corpus/tar1.tar\n\noptions.test.js\n✔ Run commands with --help with no manta URL specified\n✔ Run commands with --version with no manta URL specified\n\ntrackmarker.test.js\n✔ pages by name\n✔ pages by mtime\n\nutils.test.js\n✔ escapePath encoding\n✔ prettyBytes\n\nOK: 630 assertions (487721ms)\n```"},{"timestamp":1546622208,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"Patch Set 4: Integration-Approval+1"},{"timestamp":1546635156,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Kelly McLaughlin"}],"currentPatchSet":{"number":"4","revision":"2cd2b3809d4d70ec784d29f3be82deba27ad41b6","parents":["e3440f520182383c051e27816da8fcb10720e873"],"ref":"refs/changes/92/5292/4","uploader":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"createdOn":1546541519,"author":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1546541548,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1546552952,"by":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1546622208,"by":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"}},{"type":"SUBM","value":"1","grantedOn":1546635156,"by":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":1,"deletions":0},{"file":"lib/client.js","type":"MODIFIED","insertions":19,"deletions":-1},{"file":"lib/options.js","type":"MODIFIED","insertions":10,"deletions":-8},{"file":"test/mchmod.test.js","type":"ADDED","insertions":268,"deletions":0}],"sizeInsertions":298,"sizeDeletions":-9},"patchSets":[{"number":"1","revision":"01bbde04b997ffbc9673b62bdf770f8be72ab0a1","parents":["e3440f520182383c051e27816da8fcb10720e873"],"ref":"refs/changes/92/5292/1","uploader":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"createdOn":1545940425,"author":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1545940453,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/client.js","line":2,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"2019"},{"file":"lib/client.js","line":2,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Done"},{"file":"lib/client.js","line":324,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"nit: my initial reaction is to change the signature to be:\n\n isPath(p, user, opts)\n\nWhere `opts` has `opts.skipEncode`, but I see above this is meant to match `getPath` so I am cool with it as is."},{"file":"lib/client.js","line":324,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"I think I will just leave it as is for now since I just copied it from `getPath`."},{"file":"lib/client.js","line":332,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"I think you can consolidate these 2 if statements into a single regex replace without the conditional using `^~~\\/*`\n\nFor example:\n\n \u003e a \u003d \u0027~~\u0027\n \u003e b \u003d \u0027~~/\u0027\n \u003e c \u003d \u0027~~//\u0027\n \u003e d \u003d \u0027~~/foo\u0027\n \u003e e \u003d \u0027~~//foo\u0027\n \u003e re \u003d /^~~\\/*/\n\n \u003e a.replace(re, \u0027/user/\u0027);\n \u0027/user/\u0027\n \u003e b.replace(re, \u0027/user/\u0027);\n \u0027/user/\u0027\n \u003e c.replace(re, \u0027/user/\u0027);\n \u0027/user/\u0027\n \u003e d.replace(re, \u0027/user/\u0027);\n \u0027/user/foo\u0027\n \u003e e.replace(re, \u0027/user/\u0027);\n \u0027/user/foo\u0027"},{"file":"lib/client.js","line":332,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Done"},{"file":"lib/options.js","line":2,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"2019"},{"file":"lib/options.js","line":2,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Done"},{"file":"test/mchmod.test.js","line":2,"reviewer":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},"message":"2019"},{"file":"test/mchmod.test.js","line":2,"reviewer":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"message":"Done"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/client.js","type":"MODIFIED","insertions":21,"deletions":0},{"file":"lib/options.js","type":"MODIFIED","insertions":9,"deletions":-7},{"file":"test/mchmod.test.js","type":"ADDED","insertions":268,"deletions":0}],"sizeInsertions":298,"sizeDeletions":-7},{"number":"2","revision":"25622df6b386e320149c5df3710ab57f4bf64e8f","parents":["e3440f520182383c051e27816da8fcb10720e873"],"ref":"refs/changes/92/5292/2","uploader":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"createdOn":1546541006,"author":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"-1","grantedOn":1546541036,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"lib/client.js","line":330,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"missing blank before close comment"},{"file":"lib/client.js","line":330,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"comment preceded by non-blank"},{"file":"lib/client.js","line":330,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"unterminated single line comment"},{"file":"lib/client.js","line":330,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"missing blank after open comment"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/client.js","type":"MODIFIED","insertions":18,"deletions":-1},{"file":"lib/options.js","type":"MODIFIED","insertions":10,"deletions":-8},{"file":"test/mchmod.test.js","type":"ADDED","insertions":268,"deletions":0}],"sizeInsertions":296,"sizeDeletions":-9},{"number":"3","revision":"c98dba4d74eb2161781852c7ba23bbb1a1c6ae90","parents":["e3440f520182383c051e27816da8fcb10720e873"],"ref":"refs/changes/92/5292/3","uploader":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"createdOn":1546541207,"author":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1546541236,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"lib/client.js","type":"MODIFIED","insertions":19,"deletions":-1},{"file":"lib/options.js","type":"MODIFIED","insertions":10,"deletions":-8},{"file":"test/mchmod.test.js","type":"ADDED","insertions":268,"deletions":0}],"sizeInsertions":297,"sizeDeletions":-9},{"number":"4","revision":"2cd2b3809d4d70ec784d29f3be82deba27ad41b6","parents":["e3440f520182383c051e27816da8fcb10720e873"],"ref":"refs/changes/92/5292/4","uploader":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"createdOn":1546541519,"author":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1546541548,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1546552952,"by":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1546622208,"by":{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"}},{"type":"SUBM","value":"1","grantedOn":1546635156,"by":{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"CHANGES.md","type":"MODIFIED","insertions":1,"deletions":0},{"file":"lib/client.js","type":"MODIFIED","insertions":19,"deletions":-1},{"file":"lib/options.js","type":"MODIFIED","insertions":10,"deletions":-8},{"file":"test/mchmod.test.js","type":"ADDED","insertions":268,"deletions":0}],"sizeInsertions":298,"sizeDeletions":-9}],"allReviewers":[{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Dave Eddy","email":"dave.eddy@joyent.com","username":"bahamas10"},{"name":"Kelly McLaughlin","email":"kelly.mclaughlin@joyent.com","username":"kellymclaughlin"}]}