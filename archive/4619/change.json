{"project":"joyent/manta-mako","branch":"master","id":"Ib125d6750a94f5b22e44854d794d9b25dd5fb8f7","number":"4619","subject":"MANTA-3854 Mako sometimes fails to create manifests due to limitations in \u0027find\u0027","owner":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"url":"https://cr.joyent.us/4619","commitMessage":"MANTA-3854 Mako sometimes fails to create manifests due to limitations in \u0027find\u0027\n","createdOn":1533169084,"lastUpdated":1537940986,"open":false,"status":"ABANDONED","comments":[{"timestamp":1533169084,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Uploaded patch set 1."},{"timestamp":1533169112,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 1: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1533169491,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Patch Set 1:\n\n(2 comments)"},{"timestamp":1533329274,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Uploaded patch set 2."},{"timestamp":1533329302,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 2: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1533332736,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"Patch Set 2:\n\n(6 comments)"},{"timestamp":1533772583,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Uploaded patch set 3."},{"timestamp":1533772619,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 3: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1533842361,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Patch Set 2:\n\n(6 comments)"},{"timestamp":1533936139,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 3:\n\n(33 comments)"},{"timestamp":1533945734,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Uploaded patch set 4."},{"timestamp":1533945760,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 4: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1533946034,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Patch Set 4:\n\nRobert, the latest patch set only covers changes that you recommended for bin/upload_mako_ls.sh and src/makofind.c.  Since there were so many comments, particularly in makofind.c, I figured it\u0027d just be easier to say that I do agree with your feedback and I took in all of your suggestions (at least to the best of my understanding).  I know of at least one question that you asked within makofind.c that does warrant an answer and I\u0027ll comment on that.\n\nFor the remainder of the change, largely the Makefile stuff, I will sync with you and Josh on Monday when I\u0027m there in person."},{"timestamp":1533948331,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Patch Set 3:\n\n(1 comment)"},{"timestamp":1534204159,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 4:\n\n(7 comments)\n\nNote, the current version here still doesn\u0027t properly handle large file awareness. I\u0027m not sure if that\u0027s something that you were planning on addressing in this patch or it was being left open because it had to do with makefiles. It might help to actual mark the comments dealt with as done versus not to help make that intent clear versus missing something."},{"timestamp":1534273421,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Patch Set 4:\n\n(1 comment)"},{"timestamp":1534276810,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Patch Set 4:\n\n(2 comments)"},{"timestamp":1534277420,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Patch Set 4:\n\n\u003e (7 comments)\n \u003e \n \u003e Note, the current version here still doesn\u0027t properly handle large\n \u003e file awareness. I\u0027m not sure if that\u0027s something that you were\n \u003e planning on addressing in this patch or it was being left open\n \u003e because it had to do with makefiles. It might help to actual mark\n \u003e the comments dealt with as done versus not to help make that intent\n \u003e clear versus missing something.\n\nIt appears that the makefile portion of this change is in appropriate and needs to be redone pretty much entirely.  After some education from Josh yesterday, *my* opinion is that what I had there is not even respectable.  Part of the makefile changes will now rely on https://jira.joyent.us/browse/TOOLS-1997 which is assigned to me.  I will not forget to make considerations for large file awareness.\n\nRegarding marking comments as resolved, I\u0027m willing to do that.  I just didn\u0027t want to mark something as resolved if the reviewer isn\u0027t satisfied with how it was addressed yet."},{"timestamp":1534285453,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 4:\n\n\u003e \u003e (7 comments)\n \u003e \u003e\n \u003e \u003e Note, the current version here still doesn\u0027t properly handle\n \u003e large\n \u003e \u003e file awareness. I\u0027m not sure if that\u0027s something that you were\n \u003e \u003e planning on addressing in this patch or it was being left open\n \u003e \u003e because it had to do with makefiles. It might help to actual mark\n \u003e \u003e the comments dealt with as done versus not to help make that\n \u003e intent\n \u003e \u003e clear versus missing something.\n \u003e \n \u003e It appears that the makefile portion of this change is in\n \u003e appropriate and needs to be redone pretty much entirely.  After\n \u003e some education from Josh yesterday, *my* opinion is that what I had\n \u003e there is not even respectable.  Part of the makefile changes will\n \u003e now rely on https://jira.joyent.us/browse/TOOLS-1997 which is\n \u003e assigned to me.  I will not forget to make considerations for large\n \u003e file awareness.\n\nThe LFS changes are 100% independent of anything related to CTF.\n\n \u003e Regarding marking comments as resolved, I\u0027m willing to do that.  I\n \u003e just didn\u0027t want to mark something as resolved if the reviewer\n \u003e isn\u0027t satisfied with how it was addressed yet.\n\nIt\u0027s just hard for me to tell the difference between what you\u0027ve actually fixed and what you haven\u0027t in different revisions when I\u0027m trying to make sure if everything\u0027s actually covered. That\u0027s all."},{"timestamp":1534286760,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Patch Set 4:\n\n\u003e \u003e \u003e (7 comments)\n \u003e \u003e \u003e\n \u003e \u003e \u003e Note, the current version here still doesn\u0027t properly handle\n \u003e \u003e large\n \u003e \u003e \u003e file awareness. I\u0027m not sure if that\u0027s something that you were\n \u003e \u003e \u003e planning on addressing in this patch or it was being left open\n \u003e \u003e \u003e because it had to do with makefiles. It might help to actual\n \u003e mark\n \u003e \u003e \u003e the comments dealt with as done versus not to help make that\n \u003e \u003e intent\n \u003e \u003e \u003e clear versus missing something.\n \u003e \u003e\n \u003e \u003e It appears that the makefile portion of this change is in\n \u003e \u003e appropriate and needs to be redone pretty much entirely.  After\n \u003e \u003e some education from Josh yesterday, *my* opinion is that what I\n \u003e had\n \u003e \u003e there is not even respectable.  Part of the makefile changes will\n \u003e \u003e now rely on https://jira.joyent.us/browse/TOOLS-1997 which is\n \u003e \u003e assigned to me.  I will not forget to make considerations for\n \u003e large\n \u003e \u003e file awareness.\n \u003e \n \u003e The LFS changes are 100% independent of anything related to CTF.\n\nI said that part of the Makefile changes rely on TOOLS-1997 and that actually is true.  I didn\u0027t say that large file support relied on 1997 -- I never said that.  My point was that I don\u0027t want to waste your time at all looking at the Makefile until the whole thing is in a more dignified state (which it\u0027s not).  I get that including debugging information has nothing to do with building this utility to support large files.  I will tackle it once I have 1997 and the rest of makofind.c under control.  In the interim, don\u0027t look at the other stuff, especially after eating.\n\n \u003e \n \u003e \u003e Regarding marking comments as resolved, I\u0027m willing to do that. \n \u003e I\n \u003e \u003e just didn\u0027t want to mark something as resolved if the reviewer\n \u003e \u003e isn\u0027t satisfied with how it was addressed yet.\n \u003e \n \u003e It\u0027s just hard for me to tell the difference between what you\u0027ve\n \u003e actually fixed and what you haven\u0027t in different revisions when I\u0027m\n \u003e trying to make sure if everything\u0027s actually covered. That\u0027s all."},{"timestamp":1534453416,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Patch Set 3:\n\n(31 comments)"},{"timestamp":1534453504,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Uploaded patch set 5."},{"timestamp":1534453532,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 5: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1534453984,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Patch Set 5:\n\nSome disclaimers:\n* Tried to mark things that I thought didn\u0027t matter anymore, or things that I had resolved as done in previous patch sets.  I left a few things open still (like what I have for 114-155 in makofind.c) incase there\u0027s an issue there that you see that I don\u0027t.\n* The makefile stuff ctf.{defs,targ} is still in progress in TOOLS-1997, but based on some preliminary discussions with Josh, this should resemble the direction that things will go in.  It\u0027s not done yet."},{"timestamp":1534455506,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Patch Set 5:\n\n(1 comment)"},{"timestamp":1534456187,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Patch Set 5:\n\n(1 comment)"},{"timestamp":1534459851,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 5:\n\n(2 comments)\n\nI\u0027ve not reviewed the CTF makefile glue as you have indicated that\u0027s being reviewed separately. In general, this seems pretty close. Thanks for the clean up."},{"timestamp":1534461507,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Patch Set 5:\n\n(2 comments)\n\n\u003e (2 comments)\n \u003e \n \u003e I\u0027ve not reviewed the CTF makefile glue as you have indicated\n \u003e that\u0027s being reviewed separately. In general, this seems pretty\n \u003e close. Thanks for the clean up.\n\nYeah, I\u0027m hopeful that I can get a review on those wrapped up sometime today too.  Thanks for the feedback up to now.  I\u0027ve found it both cleansing and informative."},{"timestamp":1534461512,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Uploaded patch set 6."},{"timestamp":1534461540,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 6: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1534462105,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 6: Code-Review+1\n\nNote for IA. I have not reviewed the CTF glue here. Once that\u0027s finalized, it may be necessary to take another look."},{"timestamp":1534541437,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Uploaded patch set 7."},{"timestamp":1534541472,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 7: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1534798968,"reviewer":{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"},"message":"Patch Set 7:\n\n(1 comment)"},{"timestamp":1534803128,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Patch Set 7:\n\n(1 comment)"},{"timestamp":1534808301,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Uploaded patch set 8: Patch Set 7 was rebased."},{"timestamp":1534808344,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 8:\n\n\"make check\" passed ok"},{"timestamp":1534889171,"reviewer":{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"},"message":"Patch Set 7:\n\n(1 comment)"},{"timestamp":1534892650,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Patch Set 8:\n\n\u003e (1 comment)\n\nI filed https://jira.joyent.us/browse/TOOLS-2069 to track your request."},{"timestamp":1534952990,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Patch Set 8:\n\n(3 comments)\n\nLooks good, just a couple nits."},{"timestamp":1534953521,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Patch Set 8:\n\n(3 comments)"},{"timestamp":1534964090,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Uploaded patch set 9."},{"timestamp":1534964119,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 9: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1534971944,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"Patch Set 9: Code-Review+1"},{"timestamp":1534987057,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 9: Code-Review+1\n\nAgain, note to IA folks, I did not look at the CTF Makefile glue."},{"timestamp":1535094884,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Uploaded patch set 10."},{"timestamp":1535094917,"reviewer":{"name":"Joyent Automation","username":"joyent-automation"},"message":"Patch Set 10: CI-Testing+1\n\n\"make check\" passed ok"},{"timestamp":1535095181,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Patch Set 10:\n\n(2 comments)\n\nAdded another patch set because I realized that we were not obtaining the fractional part of the timestamp."},{"timestamp":1535151544,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Patch Set 10: Code-Review+1"},{"timestamp":1535161803,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Patch Set 10:\n\nA few discrepancies between the way that GNU find 4.2.33 and later versions print information led me to investigate what else has changed.  I created a directory with about 10 million files and was able to reproduce the memory exhaustion issue with GNU find 4.2.33.  Using GNU find 4.6.0, I am unable to reproduce the issue.  I believe this is due to a major enhancement where fts(3C) was introduced in 4.4.2.  At this point, I think makofind.c might be unnecessary."},{"timestamp":1537940979,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Patch Set 10:\n\nThis CR will be abandoned for another one which implements a different approach, without the need for makofind.  It can be found at: https://cr.joyent.us/4880"},{"timestamp":1537940986,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Abandoned"}],"currentPatchSet":{"number":"10","revision":"b125d6750a94f5b22e44854d794d9b25dd5fb8f7","parents":["83a52a082b4a85ded434184bbec89b4dae657953"],"ref":"refs/changes/19/4619/10","uploader":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"createdOn":1535094884,"author":{"name":"Robert Bogart","email":"robert.bogart@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1535094917,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1535151544,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":27,"deletions":-2},{"file":"bin/upload_mako_ls.sh","type":"MODIFIED","insertions":15,"deletions":-6},{"file":"src/makofind.c","type":"ADDED","insertions":162,"deletions":0},{"file":"tools/download_ctftools","type":"ADDED","insertions":90,"deletions":0},{"file":"tools/mk/Makefile.ctf.defs","type":"ADDED","insertions":49,"deletions":0},{"file":"tools/mk/Makefile.ctf.targ","type":"ADDED","insertions":29,"deletions":0},{"file":"tools/mk/Makefile.defs","type":"MODIFIED","insertions":56,"deletions":-2},{"file":"tools/mk/Makefile.targ","type":"MODIFIED","insertions":38,"deletions":-10}],"sizeInsertions":466,"sizeDeletions":-20},"patchSets":[{"number":"1","revision":"047a25b2148d3343519d0bf518197095d7f406e5","parents":["62bc8ccf55168bba094db96a07948586ec62af17"],"ref":"refs/changes/19/4619/1","uploader":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"createdOn":1533169084,"author":{"name":"Robert Bogart","email":"robert.bogart@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1533169112,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"bin/upload_mako_ls.sh","line":124,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"If the result of this operation is anything other than success (0, I guess), we need to take some kind of remedial action.  I\u0027m not sure whether or not we should cleanup the manifest that we were attempting to generate, or leave it around for analysis."},{"file":"bin/upload_mako_ls.sh","line":128,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Likewise, if this operation fails, we should do something other than fail silently.  I\u0027m tempted to file a separate CR for this since we technically are failing the upload on certain nodes due to an empty response from the server as opposed to getting the expected 100-continue.  It might take me a little more time to get to the bottom of that, and my preference would be for it to not hold up the currently proposed change, but I will defer to you."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":38,"deletions":-1},{"file":"bin/upload_mako_ls.sh","type":"MODIFIED","insertions":1,"deletions":-1},{"file":"src/makofind.c","type":"ADDED","insertions":105,"deletions":0},{"file":"tools/download_ctftools","type":"ADDED","insertions":84,"deletions":0}],"sizeInsertions":228,"sizeDeletions":-2},{"number":"2","revision":"107c6af11b358743e14b3ef5d93211373c28c3e5","parents":["62bc8ccf55168bba094db96a07948586ec62af17"],"ref":"refs/changes/19/4619/2","uploader":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"createdOn":1533329274,"author":{"name":"Robert Bogart","email":"robert.bogart@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1533329302,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"Makefile","line":80,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"If these chunks are copied from elsewhere, maybe we should put them into separate `Makefile.ctf.defs` and `Makefile.ctf.targ` makefiles?"},{"file":"Makefile","line":110,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"I moved all of this stuff out of Makefile and in to tools/mk/Makefile.ctf.defs and tools/mk/Makefile.ctf/targ."},{"file":"bin/upload_mako_ls.sh","line":124,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"We should update this comment."},{"file":"bin/upload_mako_ls.sh","line":124,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Done."},{"file":"bin/upload_mako_ls.sh","line":124,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Done"},{"file":"src/makofind.c","line":10,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"It\u0027d be nice to have a comment explaining the purpose of this program (and maybe why we don\u0027t just use `find(1)`).\n\nIt\u0027d also be good to document the output format."},{"file":"src/makofind.c","line":10,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Done."},{"file":"src/makofind.c","line":44,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"It\u0027d be nice to print `strerror(errno))` here.  The `warn(3C)` function is helpful for cases like this."},{"file":"src/makofind.c","line":44,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Done."},{"file":"src/makofind.c","line":96,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I think we might want to consider these cases errors (i.e., so the program exits non-zero), since we don\u0027t expect them to happen.  (On the other hand, maybe we could match whatever `find(1)` does.)\n\nIf we decide _not_ to make these errors, then maybe call the function `nftw_warn`?"},{"file":"src/makofind.c","line":96,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"I will bump the error count (which I changed to be a global as of patchset 3).  I renamed nftw_error to nftw_warn since I don\u0027t think that we should completely abandon the process in the case that one of these errors occurs."},{"file":"tools/download_ctftools","line":0,"reviewer":{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},"message":"I assume this is being pulled in from elsewhere?  I\u0027d rather avoid copying this script wholesale from somewhere else, and especially without a big loud comment at the top explaining that the canonical source is somewhere else."},{"file":"tools/download_ctftools","line":0,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"I got rid of this and introduced a small script that pulls this from the binder repo with a note saying that I thought that download_ctftools should go to the eng repo."},{"file":"tools/download_ctftools","line":0,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I think we should have a conversation about the new approach in person. It\u0027s probably better to just do this the right way and update eng.git. Pulling from an unversioned head of another repo is a good way for us to have build breakage and make it much harder (or impossible if it were removed) to build older releases."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":38,"deletions":-1},{"file":"bin/upload_mako_ls.sh","type":"MODIFIED","insertions":2,"deletions":-1},{"file":"src/makofind.c","type":"ADDED","insertions":105,"deletions":0},{"file":"tools/download_ctftools","type":"ADDED","insertions":84,"deletions":0}],"sizeInsertions":229,"sizeDeletions":-2},{"number":"3","revision":"292a6617177f0a0875a89cbf99a5567ef1233dbc","parents":["62bc8ccf55168bba094db96a07948586ec62af17"],"ref":"refs/changes/19/4619/3","uploader":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"createdOn":1533772583,"author":{"name":"Robert Bogart","email":"robert.bogart@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1533772619,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"bin/upload_mako_ls.sh","line":124,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"This comment doesn\u0027t seem relevant anymore as it seems like it used to describe the stat command which isn\u0027t used anywhere."},{"file":"bin/upload_mako_ls.sh","line":124,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Done"},{"file":"bin/upload_mako_ls.sh","line":125,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Probably should be a global variable."},{"file":"bin/upload_mako_ls.sh","line":125,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Probably should quote this and LISTING_FILE in case they have embedded spaces, etc."},{"file":"bin/upload_mako_ls.sh","line":125,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Why aren\u0027t we checking the exit status of this? I don\u0027t see us enabling errexit anywhere. As written it seems like this would cause us to generate a partial file. Shouldn\u0027t we write this to a temporary file and rename it into place on success? \n\nThat\u0027ll also help in case the pid file protection fails for some reason (though I haven\u0027t looked at that)."},{"file":"bin/upload_mako_ls.sh","line":125,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Done"},{"file":"bin/upload_mako_ls.sh","line":125,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Done"},{"file":"bin/upload_mako_ls.sh","line":125,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Done"},{"file":"src/makofind.c","line":12,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Manual page names are conventionally lower case, not upper case."},{"file":"src/makofind.c","line":12,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Done"},{"file":"src/makofind.c","line":15,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"What do these mean? (I know literally, but it\u0027s not clear to someone reading the code). I think the best way to handle that is to put it in the prose in the subsequent paragraph."},{"file":"src/makofind.c","line":15,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Probably should call this gfind to make it clear it\u0027s gnu find."},{"file":"src/makofind.c","line":15,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Done"},{"file":"src/makofind.c","line":15,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Done"},{"file":"src/makofind.c","line":17,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"for each object? Feels like it\u0027s missing a word."},{"file":"src/makofind.c","line":17,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Isn\u0027t it actually multiple directory trees since it takes multiple arguments?"},{"file":"src/makofind.c","line":17,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Done"},{"file":"src/makofind.c","line":17,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Done"},{"file":"src/makofind.c","line":21,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I think it\u0027s simpler to just write this as:\n\n\u0027This utility uses nftw(3C) ...\u0027"},{"file":"src/makofind.c","line":21,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Done"},{"file":"src/makofind.c","line":22,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"trees (as we\u0027re doing it for all of argc)"},{"file":"src/makofind.c","line":22,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Done"},{"file":"src/makofind.c","line":23,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"We should be specifying that this is GNU find and the versions thereof."},{"file":"src/makofind.c","line":23,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Done"},{"file":"src/makofind.c","line":45,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"The comment needs to explain why this is true. This is likely an artifact of the current directory structure that we\u0027re using in Mako."},{"file":"src/makofind.c","line":45,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Done"},{"file":"src/makofind.c","line":52,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"This should be static and really should be unsigned (in the current construction).\n\nHowever, I think the general construction should be rethought. Keeping a running tally of the number of errors isn\u0027t useful to us as you\u0027re throwing it all out to create a boolean_t. The challenge with the running set of errors is that we have to start to think about overflow and underflow, since this program appears to try to drive on in the face of all failures.\n\nI would strongly suggest that you just make this a boolean_t or integer where whenever errors are encountered you set it to 1 / B_TRUE, rather than increment.\n\nIn a lot of small cases this my not be a problem, but in the Manta case it\u0027s easy to imagine that a single storage systems with fractional Petabytes of storage capacity could easily overflow an integer in terms of number of items."},{"file":"src/makofind.c","line":52,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Done"},{"file":"src/makofind.c","line":55,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Generally written as:\n\nconst char *argv[]"},{"file":"src/makofind.c","line":55,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Done"},{"file":"src/makofind.c","line":67,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Should we consider also using FTW_MOUNT?"},{"file":"src/makofind.c","line":67,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Done"},{"file":"src/makofind.c","line":68,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"This error message doesn\u0027t really help. It occurred doing what? For example warn(\u0027failed to walk directory tree %s\", argv[i]) tells us what we were doing and why it failed (assuming the errno return case). The fact that we have output going to standard error means that we know an error occurred."},{"file":"src/makofind.c","line":68,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"warn(3C) includes the new line character for you. This will generate two newlines of output. Was that your intention?"},{"file":"src/makofind.c","line":68,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"warn(3C) already includes the name of the program. No need to include it. However, it will also unconditionally print the string form of the error, which makes sense if nftw returns -1, but not if it returns 1 which would happen if we hit the default case in nftw_cb."},{"file":"src/makofind.c","line":68,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Done"},{"file":"src/makofind.c","line":68,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Done"},{"file":"src/makofind.c","line":68,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Done"},{"file":"src/makofind.c","line":81,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Since this is only used once I would replace this with a call to errx(3C). If you want to keep the usage function, don\u0027t worry about passing the name and just use errx()."},{"file":"src/makofind.c","line":81,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Done"},{"file":"src/makofind.c","line":90,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Replace with a call to vwarnx?"},{"file":"src/makofind.c","line":90,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Done"},{"file":"src/makofind.c","line":99,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"st_blocks is in blkcnt_t which, is not an int. Especially when you are correctly dealing with large file correctly. We should use blkcnt_t here to match the type."},{"file":"src/makofind.c","line":99,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Done"},{"file":"src/makofind.c","line":100,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Is there a reason we\u0027re not using the full path name of the file? Imagine that we\u0027re coming back to debug an error and we have to now figure out which of the customer directories on a box this was, how would we figure out the full path to look in, without calculating other information."},{"file":"src/makofind.c","line":100,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Done"},{"file":"src/makofind.c","line":106,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Is this consistent with the GNU implementation?"},{"file":"src/makofind.c","line":106,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"That was at least my intention, yes.  If you see a bug, let me know.  I compared the output of the same directory between GNU find and makofind at they did match."},{"file":"src/makofind.c","line":106,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Did that include items that were an odd number of 512-byte blocks?"},{"file":"src/makofind.c","line":106,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Robert, I have tested for valid output to the best of my understanding.  I ran this on a /manta directory in my own test config.  I verified using stat(1) that some files had an even number of blocks and others contained an odd number of blocks.  I ran both makofind and gfind on the same set of files and used diff(1) to compare the output of the two utilities.  Barring any differences in whitespace (which I took care of using awk), the values for the 4th column (the one I think you\u0027re asking about) appeared to be the same among the two utilities.\n\nIf I misunderstood the GNU implementation or your question, or there\u0027s an obvious flaw with the stanza above, it would be really helpful to know what it is.  I have not worked with nftw(3c) before and only a few times in the past with stat(2).  I am willing to entertain all advice and suggestions from you.\n\nNote: the format specifiers in printf will be different in the latest the next patch set with `logical\u0027 being of type blkcnt_t now."},{"file":"src/makofind.c","line":107,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Unchecked return value."},{"file":"src/makofind.c","line":107,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Done"},{"file":"src/makofind.c","line":111,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Conventionally there\u0027s no space in symlink. Alternatively \u0027symbolic link\u0027."},{"file":"src/makofind.c","line":111,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Done"},{"file":"src/makofind.c","line":125,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"objtype is an int, not a string."},{"file":"src/makofind.c","line":125,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Done"},{"file":"tools/mk/Makefile.ctf.defs","line":29,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I don\u0027t see any large file awareness. I\u0027d suggest you either build it 64-bit or make it use large file offsets."},{"file":"tools/mk/Makefile.ctf.defs","line":29,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Done"},{"file":"tools/mk/Makefile.ctf.defs","line":31,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Why are these defined in a Makefile related to CTF? that doesn\u0027t seem to fit."},{"file":"tools/mk/Makefile.ctf.defs","line":31,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Done"},{"file":"tools/mk/Makefile.ctf.targ","line":17,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Probably should remove trailing white space."},{"file":"tools/mk/Makefile.ctf.targ","line":30,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Why is this in a CTF related Makefile?"},{"file":"tools/mk/Makefile.ctf.targ","line":30,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Done"},{"file":"tools/pre_downloadctf.sh","line":13,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"I\u0027m not sure this is the right way to do this, see the reply I had to the older version."},{"file":"tools/pre_downloadctf.sh","line":13,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"This file will be removed."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":4,"deletions":-2},{"file":"bin/upload_mako_ls.sh","type":"MODIFIED","insertions":4,"deletions":-3},{"file":"src/makofind.c","type":"ADDED","insertions":131,"deletions":0},{"file":"tools/mk/Makefile.ctf.defs","type":"ADDED","insertions":31,"deletions":0},{"file":"tools/mk/Makefile.ctf.targ","type":"ADDED","insertions":30,"deletions":0},{"file":"tools/pre_downloadctf.sh","type":"ADDED","insertions":26,"deletions":0}],"sizeInsertions":226,"sizeDeletions":-5},{"number":"4","revision":"05eb4bfacbe2544d1e651aed3171600c4bc4fdcb","parents":["62bc8ccf55168bba094db96a07948586ec62af17"],"ref":"refs/changes/19/4619/4","uploader":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"createdOn":1533945734,"author":{"name":"Robert Bogart","email":"robert.bogart@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1533945760,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"bin/upload_mako_ls.sh","line":38,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Should this include the pid in it? I guess we have the pid file so it\u0027s probably unlikely to have one trample another. But I\u0027m not sure if we want to rely on that or not."},{"file":"bin/upload_mako_ls.sh","line":125,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Presumably this should also be quoted?"},{"file":"bin/upload_mako_ls.sh","line":125,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Is there a reason there isn\u0027t a variable that covers this?"},{"file":"bin/upload_mako_ls.sh","line":129,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Shouldn\u0027t this use fatal?"},{"file":"src/makofind.c","line":63,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Looking at this now, I probably shouldn\u0027t have suggested errx, sorry. As errx will prepend that with the program\u0027s name."},{"file":"src/makofind.c","line":63,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"All the same, I agree that what I originally had didn\u0027t need to be a routine of its own, so some good came out of it."},{"file":"src/makofind.c","line":113,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Why aren\u0027t you checking the return value?"},{"file":"src/makofind.c","line":113,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"If printf does not appear to succeed, I think that continuing further execution is fruitless because I see an incomplete report as an incorrect one.  If you don\u0027t agree let me know, otherwise, that\u0027ll be the strategy I go with when checking the return value of printf."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":4,"deletions":-2},{"file":"bin/upload_mako_ls.sh","type":"MODIFIED","insertions":13,"deletions":-4},{"file":"src/makofind.c","type":"ADDED","insertions":142,"deletions":0},{"file":"tools/mk/Makefile.ctf.defs","type":"ADDED","insertions":31,"deletions":0},{"file":"tools/mk/Makefile.ctf.targ","type":"ADDED","insertions":30,"deletions":0},{"file":"tools/pre_downloadctf.sh","type":"ADDED","insertions":26,"deletions":0}],"sizeInsertions":246,"sizeDeletions":-6},{"number":"5","revision":"1e25878109272a7d22ee9fd7761047ee4e6daf86","parents":["62bc8ccf55168bba094db96a07948586ec62af17"],"ref":"refs/changes/19/4619/5","uploader":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"createdOn":1534453504,"author":{"name":"Robert Bogart","email":"robert.bogart@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1534453532,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"bin/upload_mako_ls.sh","line":128,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Perhaps we should use -ne 0 in case we have other erroneous exits (say an abort or signal kills it)."},{"file":"bin/upload_mako_ls.sh","line":128,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Yeah, that makes more sense."},{"file":"src/makofind.c","line":63,"reviewer":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},"message":"Should be cast to void to indicate you don\u0027t care about return value."},{"file":"src/makofind.c","line":63,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Done"},{"file":"src/makofind.c","line":145,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"s/systemmic/systemic/"},{"file":"tools/mk/Makefile.ctf.defs","line":29,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Nit against myself: It might be worth removing this comment since it only applies to the eng repo."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":28,"deletions":-2},{"file":"bin/upload_mako_ls.sh","type":"MODIFIED","insertions":15,"deletions":-6},{"file":"src/makofind.c","type":"ADDED","insertions":153,"deletions":0},{"file":"tools/download_ctftools","type":"ADDED","insertions":90,"deletions":0},{"file":"tools/mk/Makefile.ctf.defs","type":"ADDED","insertions":50,"deletions":0},{"file":"tools/mk/Makefile.ctf.targ","type":"ADDED","insertions":29,"deletions":0},{"file":"tools/mk/Makefile.defs","type":"MODIFIED","insertions":56,"deletions":-2},{"file":"tools/mk/Makefile.targ","type":"MODIFIED","insertions":38,"deletions":-10}],"sizeInsertions":459,"sizeDeletions":-20},{"number":"6","revision":"c19e1e16b6942e9793190524243312614e4ecd6a","parents":["62bc8ccf55168bba094db96a07948586ec62af17"],"ref":"refs/changes/19/4619/6","uploader":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"createdOn":1534461512,"author":{"name":"Robert Bogart","email":"robert.bogart@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1534462105,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1534461540,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":28,"deletions":-2},{"file":"bin/upload_mako_ls.sh","type":"MODIFIED","insertions":15,"deletions":-6},{"file":"src/makofind.c","type":"ADDED","insertions":154,"deletions":0},{"file":"tools/download_ctftools","type":"ADDED","insertions":90,"deletions":0},{"file":"tools/mk/Makefile.ctf.defs","type":"ADDED","insertions":50,"deletions":0},{"file":"tools/mk/Makefile.ctf.targ","type":"ADDED","insertions":29,"deletions":0},{"file":"tools/mk/Makefile.defs","type":"MODIFIED","insertions":56,"deletions":-2},{"file":"tools/mk/Makefile.targ","type":"MODIFIED","insertions":38,"deletions":-10}],"sizeInsertions":460,"sizeDeletions":-20},{"number":"7","revision":"3440f04faeed4042f39f4e70e1bda90b5abddeed","parents":["62bc8ccf55168bba094db96a07948586ec62af17"],"ref":"refs/changes/19/4619/7","uploader":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"createdOn":1534541437,"author":{"name":"Robert Bogart","email":"robert.bogart@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1534541472,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"tools/download_ctftools","line":17,"reviewer":{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"},"message":"It\u0027s troubling to me that this is in a personal repo. If we\u0027re writing this for Joyent/Samsung consumption and by a Joyent/Samsung employee it should be transfered to a Joyent repo.\n\nIt\u0027s also troubling to me that this component needs to download from manta to support manta."},{"file":"tools/download_ctftools","line":17,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"This is exactly what\u0027s in the eng repo (which you approved).  I think your concern around referencing personal repo\u0027s is reasonable.  I talked to Josh about it briefly and he recommended that we file a ticket to do that work separately, but in the interim, files taken from the eng repo stay faithful to their original copies.\n\nAs far as using Manta to obtain the needed files here, is a bad idea?"},{"file":"tools/download_ctftools","line":17,"reviewer":{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"},"message":"Clearly I missed that :) If we have a case to fix that, I\u0027m fine moving forward as long as you document it in the case for this work and perhaps in a comment here."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":27,"deletions":-2},{"file":"bin/upload_mako_ls.sh","type":"MODIFIED","insertions":15,"deletions":-6},{"file":"src/makofind.c","type":"ADDED","insertions":154,"deletions":0},{"file":"tools/download_ctftools","type":"ADDED","insertions":90,"deletions":0},{"file":"tools/mk/Makefile.ctf.defs","type":"ADDED","insertions":49,"deletions":0},{"file":"tools/mk/Makefile.ctf.targ","type":"ADDED","insertions":29,"deletions":0},{"file":"tools/mk/Makefile.defs","type":"MODIFIED","insertions":56,"deletions":-2},{"file":"tools/mk/Makefile.targ","type":"MODIFIED","insertions":38,"deletions":-10}],"sizeInsertions":458,"sizeDeletions":-20},{"number":"8","revision":"fe8e291a73d6e81b4bf2b95b4006c90b9378d723","parents":["83a52a082b4a85ded434184bbec89b4dae657953"],"ref":"refs/changes/19/4619/8","uploader":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"createdOn":1534808301,"author":{"name":"Robert Bogart","email":"robert.bogart@joyent.com","username":""},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1534541472,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"comments":[{"file":"src/makofind.c","line":107,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"s/ntfw/nftw/g ?"},{"file":"src/makofind.c","line":107,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Well, that\u0027s embarrassing.  I will fix that."},{"file":"src/makofind.c","line":107,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Done"},{"file":"src/makofind.c","line":125,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"No nftw_warn() here?"},{"file":"src/makofind.c","line":125,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Let\u0027s throw one in.  I agree."},{"file":"src/makofind.c","line":125,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Done"},{"file":"tools/mk/Makefile.targ","line":307,"reviewer":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"},"message":"can we quiet this error in the case of EEXISTS"},{"file":"tools/mk/Makefile.targ","line":307,"reviewer":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"message":"Since this came from the eng repo, I am required to first make a change to the original which resides there, and then bring those changes over.  I can file a ticket for that if you think it\u0027s worth it."}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":27,"deletions":-2},{"file":"bin/upload_mako_ls.sh","type":"MODIFIED","insertions":15,"deletions":-6},{"file":"src/makofind.c","type":"ADDED","insertions":154,"deletions":0},{"file":"tools/download_ctftools","type":"ADDED","insertions":90,"deletions":0},{"file":"tools/mk/Makefile.ctf.defs","type":"ADDED","insertions":49,"deletions":0},{"file":"tools/mk/Makefile.ctf.targ","type":"ADDED","insertions":29,"deletions":0},{"file":"tools/mk/Makefile.defs","type":"MODIFIED","insertions":56,"deletions":-2},{"file":"tools/mk/Makefile.targ","type":"MODIFIED","insertions":38,"deletions":-10}],"sizeInsertions":458,"sizeDeletions":-20},{"number":"9","revision":"3fe6a823ef5bc5207a0d8f9d466c29e8ed7d4441","parents":["83a52a082b4a85ded434184bbec89b4dae657953"],"ref":"refs/changes/19/4619/9","uploader":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"createdOn":1534964090,"author":{"name":"Robert Bogart","email":"robert.bogart@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1534987057,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1534964119,"by":{"name":"Joyent Automation","username":"joyent-automation"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1534971944,"by":{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":27,"deletions":-2},{"file":"bin/upload_mako_ls.sh","type":"MODIFIED","insertions":15,"deletions":-6},{"file":"src/makofind.c","type":"ADDED","insertions":155,"deletions":0},{"file":"tools/download_ctftools","type":"ADDED","insertions":90,"deletions":0},{"file":"tools/mk/Makefile.ctf.defs","type":"ADDED","insertions":49,"deletions":0},{"file":"tools/mk/Makefile.ctf.targ","type":"ADDED","insertions":29,"deletions":0},{"file":"tools/mk/Makefile.defs","type":"MODIFIED","insertions":56,"deletions":-2},{"file":"tools/mk/Makefile.targ","type":"MODIFIED","insertions":38,"deletions":-10}],"sizeInsertions":459,"sizeDeletions":-20},{"number":"10","revision":"b125d6750a94f5b22e44854d794d9b25dd5fb8f7","parents":["83a52a082b4a85ded434184bbec89b4dae657953"],"ref":"refs/changes/19/4619/10","uploader":{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},"createdOn":1535094884,"author":{"name":"Robert Bogart","email":"robert.bogart@joyent.com","username":""},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1535151544,"by":{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"}},{"type":"CI-Testing","description":"CI-Testing","value":"1","grantedOn":1535094917,"by":{"name":"Joyent Automation","username":"joyent-automation"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"Makefile","type":"MODIFIED","insertions":27,"deletions":-2},{"file":"bin/upload_mako_ls.sh","type":"MODIFIED","insertions":15,"deletions":-6},{"file":"src/makofind.c","type":"ADDED","insertions":162,"deletions":0},{"file":"tools/download_ctftools","type":"ADDED","insertions":90,"deletions":0},{"file":"tools/mk/Makefile.ctf.defs","type":"ADDED","insertions":49,"deletions":0},{"file":"tools/mk/Makefile.ctf.targ","type":"ADDED","insertions":29,"deletions":0},{"file":"tools/mk/Makefile.defs","type":"MODIFIED","insertions":56,"deletions":-2},{"file":"tools/mk/Makefile.targ","type":"MODIFIED","insertions":38,"deletions":-10}],"sizeInsertions":466,"sizeDeletions":-20}],"allReviewers":[{"name":"David Pacheco","email":"dap@joyent.com","username":"davepacheco"},{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},{"name":"Robert Bogart","email":"Robert.bogart@joyent.com","username":"rhb2"},{"name":"Richard Kiene","email":"richard.kiene@joyent.com","username":"richardkiene"},{"name":"Joyent Automation","username":"joyent-automation"},{"name":"Robert Mustacchi","email":"rm+illumos@fingolfin.org","username":"rmustacc"},{"name":"Rui Loura","email":"rui@joyent.com","username":"rjloura"}]}