From ff71716edbeb48404319f8f18722377435dbb08c Mon Sep 17 00:00:00 2001
From: Patrick Mooney <pmooney@pfmooney.com>
Date: Sat, 8 Oct 2016 03:52:04 +0000
Subject: [PATCH] OS-5706 lxbrand readdir fails on /sys/fs/cgroup

---
 usr/src/uts/common/brand/lx/sysfs/lx_sysvnops.c | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/usr/src/uts/common/brand/lx/sysfs/lx_sysvnops.c b/usr/src/uts/common/brand/lx/sysfs/lx_sysvnops.c
index 3fe074540b..cde2ecc3b9 100644
--- a/usr/src/uts/common/brand/lx/sysfs/lx_sysvnops.c
+++ b/usr/src/uts/common/brand/lx/sysfs/lx_sysvnops.c
@@ -1357,16 +1357,18 @@ lxsys_readdir_static(lxsys_node_t *lnp, uio_t *uiop, int *eofp)
 {
 	lxsys_dirent_t *dirent = NULL;
 	int i, len = 0;
+	boolean_t found = B_FALSE;
 
 	for (i = 0; i < SYSDIRLISTSZ(lxsys_dirlookup); i++) {
 		if (lnp->lxsys_instance == lxsys_dirlookup[i].dl_instance) {
 			dirent = lxsys_dirlookup[i].dl_list;
 			len = lxsys_dirlookup[i].dl_length;
+			found = B_TRUE;
 			break;
 		}
 	}
 
-	if (dirent == NULL) {
+	if (!found) {
 		return (ENOTDIR);
 	}
 
-- 
2.21.0

