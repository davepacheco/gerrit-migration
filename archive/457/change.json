{"project":"joyent/illumos-joyent","branch":"master","id":"I5cf554af1079ca06b1b977788f9c0fb796f68945","number":"457","subject":"OS-5614 acpidump cannot find RSDP on some machines Reviewed by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e Approved by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e","owner":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"url":"https://cr.joyent.us/457","commitMessage":"OS-5614 acpidump cannot find RSDP on some machines\nReviewed by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e\nApproved by: Patrick Mooney \u003cpatrick.mooney@joyent.com\u003e\n","createdOn":1473777539,"lastUpdated":1474470521,"open":false,"status":"MERGED","comments":[{"timestamp":1473777539,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 1."},{"timestamp":1473779205,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 1:\n\n(7 comments)"},{"timestamp":1473782126,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 1:\n\n(7 comments)"},{"timestamp":1473782257,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 2."},{"timestamp":1473782601,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 2: Code-Review+1"},{"timestamp":1473785269,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 3."},{"timestamp":1473785359,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Patch Set 3:\n\nI went ahead and added the additional checks in xsvc to be on the cautious side since acpidump does take addresses on the command line and I am not sure under what other conditions that could lead to a hat panic."},{"timestamp":1473785675,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 3: Code-Review+1"},{"timestamp":1474467430,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Patch Set 3: Integration-Approval+1"},{"timestamp":1474470446,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 4: Patch Set 3 was rebased."},{"timestamp":1474470511,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Uploaded patch set 5: Commit message was updated."},{"timestamp":1474470521,"reviewer":{"name":"Gerrit Code Review","email":"no-reply@cr.joyent.us"},"message":"Change has been successfully merged by Jerry Jelinek"}],"currentPatchSet":{"number":"5","revision":"5cf554af1079ca06b1b977788f9c0fb796f68945","parents":["6a41e7224f5dce21547e07eced881016dac9e18a"],"ref":"refs/changes/57/457/5","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1474470511,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1473785675,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1474467430,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"SUBM","value":"1","grantedOn":1474470521,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/cmd/acpi/acpidump/osillumostbl.c","type":"MODIFIED","insertions":64,"deletions":-24},{"file":"usr/src/uts/i86pc/io/xsvc/xsvc.c","type":"MODIFIED","insertions":16,"deletions":-1}],"sizeInsertions":80,"sizeDeletions":-25},"patchSets":[{"number":"1","revision":"f3158a0a9ac1fa1ec1098e1f7c9a27f63f45a803","parents":["d947f3808f053fb13e1fe4de8637c50e7e88c4c7"],"ref":"refs/changes/57/457/1","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1473777539,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","comments":[{"file":"usr/src/cmd/acpi/acpidump/osillumostbl.c","line":368,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Can \u0027tblp\u0027 be used in place of \u0027mp\u0027 for the non-BIOS lookup?"},{"file":"usr/src/cmd/acpi/acpidump/osillumostbl.c","line":368,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Yes, changed."},{"file":"usr/src/cmd/acpi/acpidump/osillumostbl.c","line":370,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"I would probably name this \u0027searchsize\u0027 or something since the later memcpy actions aren\u0027t consistent in using it as the actual RSDP size."},{"file":"usr/src/cmd/acpi/acpidump/osillumostbl.c","line":370,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Changed to mapsize."},{"file":"usr/src/cmd/acpi/acpidump/osillumostbl.c","line":402,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"RSDP will always be in low (\u003c32bit) memory, right?"},{"file":"usr/src/cmd/acpi/acpidump/osillumostbl.c","line":402,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Yes, but the mapping does not have to be. I fixed the cast."},{"file":"usr/src/cmd/acpi/acpidump/osillumostbl.c","line":404,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Should this be copying from mp instead of directly from physaddr?"},{"file":"usr/src/cmd/acpi/acpidump/osillumostbl.c","line":404,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Yes, fixed."},{"file":"usr/src/cmd/acpi/acpidump/osillumostbl.c","line":432,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Use ACPI_PTR_DIFF like from above?"},{"file":"usr/src/cmd/acpi/acpidump/osillumostbl.c","line":432,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"Changed."},{"file":"usr/src/uts/i86pc/io/xsvc/xsvc.c","line":885,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"Would it make sense to do the \u0027!PAGE_LOCKED(pp) \u0026\u0026 !PP_ISNORELOC(pp)\u0027 check here as well?"},{"file":"usr/src/uts/i86pc/io/xsvc/xsvc.c","line":885,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"I considered that, but we have not hit that panic and I am not certain if that extra check is even necessary, so I did not add that right now."},{"file":"usr/src/uts/i86pc/io/xsvc/xsvc.c","line":887,"reviewer":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},"message":"This should perhaps be \u0027npages \u003d i - 1\u0027 since we don\u0027t need to perform the hat_unload for the failed page.  In that case, npages would need to be a signed type.  Overall, it would probably be a good idea to clean up the types in this function.  There\u0027s quite a bit of mixing between \u0027int\u0027 and \u0027size_t\u0027."},{"file":"usr/src/uts/i86pc/io/xsvc/xsvc.c","line":887,"reviewer":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"message":"I think the code is correct as-is since the loop is checking \u003c and not \u003c\u003d"}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/acpi/acpidump/osillumostbl.c","type":"MODIFIED","insertions":61,"deletions":-24},{"file":"usr/src/uts/i86pc/io/xsvc/xsvc.c","type":"MODIFIED","insertions":15,"deletions":-1}],"sizeInsertions":76,"sizeDeletions":-25},{"number":"2","revision":"ca391cf4719791c83650d87f6cca6bd92f278a61","parents":["d947f3808f053fb13e1fe4de8637c50e7e88c4c7"],"ref":"refs/changes/57/457/2","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1473782257,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1473782601,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/acpi/acpidump/osillumostbl.c","type":"MODIFIED","insertions":64,"deletions":-24},{"file":"usr/src/uts/i86pc/io/xsvc/xsvc.c","type":"MODIFIED","insertions":15,"deletions":-1}],"sizeInsertions":79,"sizeDeletions":-25},{"number":"3","revision":"786256c44f66fae4fd7de5e1edb0d969c9886ad9","parents":["d947f3808f053fb13e1fe4de8637c50e7e88c4c7"],"ref":"refs/changes/57/457/3","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1473785269,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"REWORK","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1473785675,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1474467430,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/acpi/acpidump/osillumostbl.c","type":"MODIFIED","insertions":64,"deletions":-24},{"file":"usr/src/uts/i86pc/io/xsvc/xsvc.c","type":"MODIFIED","insertions":16,"deletions":-1}],"sizeInsertions":80,"sizeDeletions":-25},{"number":"4","revision":"5f658cf2023ab07956748d72de39f669cce2caaa","parents":["6a41e7224f5dce21547e07eced881016dac9e18a"],"ref":"refs/changes/57/457/4","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1474470446,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"TRIVIAL_REBASE","approvals":[{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1473785675,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1474467430,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":7,"deletions":0},{"file":"usr/src/cmd/acpi/acpidump/osillumostbl.c","type":"MODIFIED","insertions":64,"deletions":-24},{"file":"usr/src/uts/i86pc/io/xsvc/xsvc.c","type":"MODIFIED","insertions":16,"deletions":-1}],"sizeInsertions":80,"sizeDeletions":-25},{"number":"5","revision":"5cf554af1079ca06b1b977788f9c0fb796f68945","parents":["6a41e7224f5dce21547e07eced881016dac9e18a"],"ref":"refs/changes/57/457/5","uploader":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"createdOn":1474470511,"author":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"},"isDraft":false,"kind":"NO_CODE_CHANGE","approvals":[{"type":"SUBM","value":"1","grantedOn":1474470521,"by":{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}},{"type":"Code-Review","description":"Code-Review","value":"1","grantedOn":1473785675,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}},{"type":"Integration-Approval","description":"Integration-Approval","value":"1","grantedOn":1474467430,"by":{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"}}],"files":[{"file":"/COMMIT_MSG","type":"ADDED","insertions":9,"deletions":0},{"file":"usr/src/cmd/acpi/acpidump/osillumostbl.c","type":"MODIFIED","insertions":64,"deletions":-24},{"file":"usr/src/uts/i86pc/io/xsvc/xsvc.c","type":"MODIFIED","insertions":16,"deletions":-1}],"sizeInsertions":80,"sizeDeletions":-25}],"allReviewers":[{"name":"Joshua M. Clulow","email":"jmc@joyent.com","username":"jclulow"},{"name":"Patrick Mooney","email":"pmooney@pfmooney.com","username":"pfmooney"},{"name":"Jerry Jelinek","email":"jerry.jelinek@joyent.com","username":"jjelinek"}]}